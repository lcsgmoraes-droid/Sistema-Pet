import{bG as K,r as m,j as e,R as G}from"./vendor-react-1772136958794.js";import{a as x}from"./api-1772136958794.js";import{t as S,c as Q,n as H,g as P,e as Z,b as F,d as D,h as ee,p as V,f as se}from"./pt-BR-1772136958794.js";import"./index-1772136958794.js";function $(s,t){const n=+S(s)-+S(t);return n<0?-1:n>0?1:n}function te(s){return Q(s,Date.now())}function ne(s,t,n){const[a,r]=H(n==null?void 0:n.in,s,t),o=a.getFullYear()-r.getFullYear(),l=a.getMonth()-r.getMonth();return o*12+l}function ae(s){return t=>{const a=(s?Math[s]:Math.trunc)(t);return a===0?0:a}}function re(s,t){return+S(s)-+S(t)}function oe(s,t){const n=S(s,t==null?void 0:t.in);return n.setHours(23,59,59,999),n}function ie(s,t){const n=S(s,t==null?void 0:t.in),a=n.getMonth();return n.setFullYear(n.getFullYear(),a+1,0),n.setHours(23,59,59,999),n}function le(s,t){const n=S(s,t==null?void 0:t.in);return+oe(n,t)==+ie(n,t)}function ce(s,t,n){const[a,r,o]=H(n==null?void 0:n.in,s,s,t),l=$(r,o),c=Math.abs(ne(r,o));if(c<1)return 0;r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-l*c);let d=$(r,o)===-l;le(a)&&c===1&&$(a,o)===1&&(d=!1);const i=l*(c-+d);return i===0?0:i}function de(s,t,n){const a=re(s,t)/1e3;return ae(n==null?void 0:n.roundingMethod)(a)}function ge(s,t,n){const a=ee(),r=(n==null?void 0:n.locale)??a.locale??Z,o=2520,l=$(s,t);if(isNaN(l))throw new RangeError("Invalid time value");const c=Object.assign({},n,{addSuffix:n==null?void 0:n.addSuffix,comparison:l}),[d,i]=H(n==null?void 0:n.in,...l>0?[t,s]:[s,t]),g=de(i,d),w=(P(i)-P(d))/1e3,h=Math.round((g-w)/60);let y;if(h<2)return n!=null&&n.includeSeconds?g<5?r.formatDistance("lessThanXSeconds",5,c):g<10?r.formatDistance("lessThanXSeconds",10,c):g<20?r.formatDistance("lessThanXSeconds",20,c):g<40?r.formatDistance("halfAMinute",0,c):g<60?r.formatDistance("lessThanXMinutes",1,c):r.formatDistance("xMinutes",1,c):h===0?r.formatDistance("lessThanXMinutes",1,c):r.formatDistance("xMinutes",h,c);if(h<45)return r.formatDistance("xMinutes",h,c);if(h<90)return r.formatDistance("aboutXHours",1,c);if(h<F){const b=Math.round(h/60);return r.formatDistance("aboutXHours",b,c)}else{if(h<o)return r.formatDistance("xDays",1,c);if(h<D){const b=Math.round(h/F);return r.formatDistance("xDays",b,c)}else if(h<D*2)return y=Math.round(h/D),r.formatDistance("aboutXMonths",y,c)}if(y=ce(i,d),y<12){const b=Math.round(h/D);return r.formatDistance("xMonths",b,c)}else{const b=y%12,N=Math.trunc(y/12);return b<3?r.formatDistance("aboutXYears",N,c):b<9?r.formatDistance("overXYears",N,c):r.formatDistance("almostXYears",N+1,c)}}function me(s,t){return ge(s,te(s),t)}const f="/whatsapp",v={async getConfig(){return(await x.get(`${f}/config`)).data},async getStats(){return(await x.get(`${f}/analytics/dashboard`)).data},async getAgents(){return(await x.get(`${f}/agents`)).data},async createAgent(s){return(await x.post(`${f}/agents`,s)).data},async getAgent(s){return(await x.get(`${f}/agents/${s}`)).data},async updateAgent(s,t){return(await x.put(`${f}/agents/${s}`,t)).data},async deleteAgent(s){await x.delete(`${f}/agents/${s}`)},async getHandoffs(s){const t=s?{status:s}:{};return(await x.get(`${f}/handoffs/pending`,{params:t})).data},async createHandoff(s){return(await x.post(`${f}/handoffs`,s)).data},async getHandoff(s){return(await x.get(`${f}/handoffs/${s}`)).data},async assignHandoff(s,t){return(await x.post(`${f}/handoffs/${s}/assign`,{agent_id:t})).data},async resolveHandoff(s,t){await x.post(`${f}/handoffs/${s}/resolve`,{resolution_notes:t})},async cancelHandoff(s){await x.post(`${f}/handoffs/${s}/cancel`)},async getNotes(s){return(await x.get(`${f}/handoffs/${s}/notes`)).data},async addNote(s,t){return(await x.post(`${f}/handoffs/${s}/notes`,{content:t})).data},async getMessages(s){return(await x.get(`${f}/sessions/${s}/messages`)).data},async sendMessage(s,t){return(await x.post(`${f}/messages`,{session_id:s,message:t})).data},async createSession(s){return(await x.post(`${f}/sessions`,s)).data},async getSession(s){return(await x.get(`${f}/sessions/${s}`)).data},async testSentiment(s){return(await x.post(`${f}/sentiment/test`,{text:s})).data}},M=K()((s,t)=>({stats:null,isLoadingStats:!1,agents:[],currentAgent:null,isLoadingAgents:!1,handoffs:[],activeHandoff:null,isLoadingHandoffs:!1,filterStatus:"all",messages:{},isLoadingMessages:{},isConnected:!1,isSidebarOpen:!0,isBotAssistOpen:!1,notifications:[],fetchStats:async()=>{if(t().isLoadingStats){console.log("â­ï¸ Stats already loading, skipping...");return}console.log("ðŸ“Š Fetching stats..."),s({isLoadingStats:!0});const a=new Promise((r,o)=>setTimeout(()=>o(new Error("Stats timeout")),1e4));try{const r=await Promise.race([v.getStats(),a]);console.log("âœ… Stats received:",r),s({stats:r,isLoadingStats:!1})}catch(r){console.error("âŒ Error fetching stats:",r),s({isLoadingStats:!1})}},fetchAgents:async()=>{s({isLoadingAgents:!0});try{const n=await v.getAgents();s({agents:n,isLoadingAgents:!1})}catch(n){console.error("Error fetching agents:",n),s({isLoadingAgents:!1})}},initializeCurrentAgent:async()=>{try{console.log("ðŸ”„ Initializing current agent...");const n=localStorage.getItem("user");if(!n){console.warn("âš ï¸ No user found in localStorage");return}const a=JSON.parse(n);console.log("ðŸ‘¤ User loaded:",a.email);const r=await v.getAgents();console.log("ðŸ“‹ Agents fetched:",r.length);let o=r.find(l=>l.user_id===a.id);o?(console.log("ðŸ”„ Updating existing agent to online..."),o=await v.updateAgent(o.id,{status:"online"}),console.log("âœ… Agent set to online:",o.id)):(console.log("âž• Creating new agent..."),o=await v.createAgent({name:a.name||a.email,email:a.email,status:"online",max_concurrent_chats:5,auto_assign:!0,receive_notifications:!0}),console.log("âœ… Created new agent:",o.id)),s({currentAgent:o}),console.log("âœ… Current agent initialized")}catch(n){console.error("âŒ Error initializing current agent:",n)}},updateAgentStatus:async n=>{const{currentAgent:a}=t();if(a)try{const r=await v.updateAgent(a.id,{status:n});s({currentAgent:r}),s(o=>({agents:o.agents.map(l=>l.id===r.id?r:l)}))}catch(r){console.error("Error updating agent status:",r)}},fetchHandoffs:async n=>{s({isLoadingHandoffs:!0});try{const a=await v.getHandoffs(n);s({handoffs:a,isLoadingHandoffs:!1})}catch(a){console.error("Error fetching handoffs:",a),s({isLoadingHandoffs:!1})}},setFilterStatus:n=>{s({filterStatus:n});const a={all:void 0,pending:"pending",active:"active",my:"active"};t().fetchHandoffs(a[n])},takeHandoff:async n=>{const{currentAgent:a}=t();if(a)try{const r=await v.assignHandoff(n,a.id);s(o=>({handoffs:o.handoffs.map(l=>l.id===r.id?r:l)})),s({activeHandoff:r}),t().addNotification({type:"success",title:"Conversa assumida",message:`VocÃª assumiu a conversa com ${r.customer_name||r.phone_number}`,timestamp:new Date().toISOString()})}catch(r){console.error("Error taking handoff:",r),t().addNotification({type:"error",title:"Erro",message:"NÃ£o foi possÃ­vel assumir a conversa",timestamp:new Date().toISOString()})}},resolveHandoff:async(n,a)=>{try{await v.resolveHandoff(n,a),s(r=>{var o;return{handoffs:r.handoffs.filter(l=>l.id!==n),activeHandoff:((o=r.activeHandoff)==null?void 0:o.id)===n?null:r.activeHandoff}}),t().addNotification({type:"success",title:"Conversa resolvida",message:"A conversa foi finalizada com sucesso",timestamp:new Date().toISOString()}),t().fetchStats()}catch(r){console.error("Error resolving handoff:",r),t().addNotification({type:"error",title:"Erro",message:"NÃ£o foi possÃ­vel resolver a conversa",timestamp:new Date().toISOString()})}},setActiveHandoff:n=>{s({activeHandoff:n})},fetchMessages:async n=>{s(a=>({isLoadingMessages:{...a.isLoadingMessages,[n]:!0}}));try{const a=await v.getMessages(n);s(r=>({messages:{...r.messages,[n]:a},isLoadingMessages:{...r.isLoadingMessages,[n]:!1}}))}catch(a){console.error("Error fetching messages:",a),s(r=>({isLoadingMessages:{...r.isLoadingMessages,[n]:!1}}))}},sendMessage:async(n,a)=>{try{const r=await v.sendMessage(n,a);s(o=>({messages:{...o.messages,[n]:[...o.messages[n]||[],r]}}))}catch(r){console.error("Error sending message:",r),t().addNotification({type:"error",title:"Erro ao enviar",message:"NÃ£o foi possÃ­vel enviar a mensagem",timestamp:new Date().toISOString()})}},addMessage:(n,a)=>{s(r=>({messages:{...r.messages,[n]:[...r.messages[n]||[],a]}}))},setConnected:n=>s({isConnected:n}),toggleSidebar:()=>s(n=>({isSidebarOpen:!n.isSidebarOpen})),toggleBotAssist:()=>s(n=>({isBotAssistOpen:!n.isBotAssistOpen})),addNotification:n=>{const a=Math.random().toString(36).substring(7);s(r=>({notifications:[...r.notifications,{...n,id:a}]})),setTimeout(()=>{t().removeNotification(a)},5e3)},removeNotification:n=>{s(a=>({notifications:a.notifications.filter(r=>r.id!==n)}))}}));class ue{constructor(){this.ws=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.reconnectTimeout=null,this.pingInterval=null,this.agentId=null,this.token=null,this.handlers={},this.onConnectionChange=null,this.onMaxReconnectAttemptsReached=null}resolveWsBaseUrl(){const t="/api";return t.startsWith("/")?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}${t}`:t.replace("http://","ws://").replace("https://","wss://")}connect(t,n){var o;if(((o=this.ws)==null?void 0:o.readyState)===WebSocket.OPEN){console.log("WebSocket already connected");return}this.token=t,this.agentId=n;const r=`${this.resolveWsBaseUrl().replace(/\/+$/,"")}/ws/whatsapp/${n}?token=${t}`;console.log("ðŸ”Œ Connecting to WebSocket:",r);try{this.ws=new WebSocket(r),this.setupEventListeners()}catch(l){console.error("Error creating WebSocket:",l),this.handleReconnect()}}disconnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null),this.ws&&(this.ws.readyState===WebSocket.OPEN&&this.send({event:"leave_agent_room"}),this.ws.close(),this.ws=null),this.reconnectAttempts=0,this.token=null,this.agentId=null}setupEventListeners(){this.ws&&(this.ws.onopen=()=>{console.log("âœ… WebSocket connected"),this.reconnectAttempts=0,this.onConnectionChange&&this.onConnectionChange(!0),this.send({event:"join_agent_room"}),this.pingInterval=window.setInterval(()=>{var t;((t=this.ws)==null?void 0:t.readyState)===WebSocket.OPEN&&this.send({event:"ping"})},3e4)},this.ws.onclose=t=>{console.log("âŒ WebSocket disconnected:",t.code,t.reason),this.onConnectionChange&&this.onConnectionChange(!1),t.code!==1e3&&this.handleReconnect()},this.ws.onerror=t=>{console.error("WebSocket error:",t)},this.ws.onmessage=t=>{try{const n=JSON.parse(t.data);this.handleMessage(n)}catch(n){console.error("Error parsing WebSocket message:",n)}})}handleMessage(t){const{event:n,data:a}=t;switch(console.log("ðŸ“© WebSocket message:",n,a),n){case"connected":console.log("Connection confirmed:",a);break;case"new_handoff":this.handlers.onNewHandoff&&this.handlers.onNewHandoff(a);break;case"handoff_assigned":this.handlers.onHandoffAssigned&&this.handlers.onHandoffAssigned(a);break;case"handoff_resolved":this.handlers.onHandoffResolved&&this.handlers.onHandoffResolved(a.handoff_id);break;case"new_message":this.handlers.onNewMessage&&this.handlers.onNewMessage(a.session_id,a.message);break;case"agent_status_change":this.handlers.onAgentStatusChange&&this.handlers.onAgentStatusChange(a);break;case"typing_indicator":this.handlers.onTypingIndicator&&this.handlers.onTypingIndicator(a.session_id,a.is_typing);break;default:console.warn("Unknown WebSocket event:",n)}}handleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached"),this.onMaxReconnectAttemptsReached&&this.onMaxReconnectAttemptsReached();return}this.reconnectAttempts++;const t=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`Reconnecting in ${t}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})...`),this.reconnectTimeout=setTimeout(()=>{this.token&&this.agentId&&this.connect(this.token,this.agentId)},t)}send(t){var n;((n=this.ws)==null?void 0:n.readyState)===WebSocket.OPEN?this.ws.send(JSON.stringify(t)):console.warn("WebSocket is not open. Cannot send message:",t)}registerHandlers(t){this.handlers=t}joinAgentRoom(t){this.send({event:"join_agent_room",data:{agent_id:t}})}leaveAgentRoom(t){this.send({event:"leave_agent_room",data:{agent_id:t}})}sendTypingIndicator(t,n){this.send({event:"typing",data:{session_id:t,is_typing:n}})}isConnected(){var t;return((t=this.ws)==null?void 0:t.readyState)===WebSocket.OPEN}getSocketId(){return this.agentId}}const j=new ue,he=(s,t)=>{const[n,a]=m.useState(!1),{addNotification:r,fetchHandoffs:o,setConnected:l,addMessage:c,fetchStats:d}=M();return m.useEffect(()=>{if(!(!s||!t||n))return a(!0),console.log("ðŸ”Œ useSocket: Initializing WebSocket connection..."),j.onConnectionChange=i=>{l(i),r(i?{type:"success",title:"Conectado",message:"ConexÃ£o com servidor estabelecida",timestamp:new Date().toISOString()}:{type:"warning",title:"Desconectado",message:"Tentando reconectar ao servidor...",timestamp:new Date().toISOString()})},j.onMaxReconnectAttemptsReached=()=>{r({type:"error",title:"Erro de ConexÃ£o",message:"NÃ£o foi possÃ­vel conectar ao servidor. Recarregue a pÃ¡gina.",timestamp:new Date().toISOString()})},j.registerHandlers({onNewHandoff:i=>{console.log("ðŸ†• New handoff received:",i),o(),r({type:"info",title:"Nova Conversa",message:`${i.customer_name||i.phone_number} precisa de ajuda`,timestamp:new Date().toISOString()}),X("Nova Conversa - WhatsApp",`${i.customer_name||i.phone_number} - ${i.reason}`,i.priority),(i.priority==="urgent"||i.priority==="high")&&U()},onHandoffAssigned:i=>{console.log("ðŸ‘¤ Handoff assigned:",i),o(),i.assigned_agent_id===t&&r({type:"success",title:"Conversa AtribuÃ­da",message:`VocÃª foi atribuÃ­do Ã  conversa com ${i.customer_name||i.phone_number}`,timestamp:new Date().toISOString()})},onHandoffResolved:i=>{console.log("âœ… Handoff resolved:",i),o(),d()},onNewMessage:(i,g)=>{console.log("ðŸ’¬ New message:",i,g),c(i,g),g.sender_type==="customer"&&(r({type:"info",title:"Nova Mensagem",message:g.content.substring(0,50)+"...",timestamp:new Date().toISOString()}),U("message"))},onAgentStatusChange:i=>{console.log("ðŸ“Š Agent status changed:",i),d()},onTypingIndicator:(i,g)=>{console.log("âŒ¨ï¸ Typing indicator:",i,g)}}),j.connect(s,t),()=>{j.disconnect()}},[s,t]),{isConnected:j.isConnected(),socketId:j.getSocketId(),sendTypingIndicator:j.sendTypingIndicator.bind(j)}};function X(s,t,n){if(!("Notification"in window)){console.warn("Browser does not support notifications");return}if(Notification.permission==="granted"){const a=new Notification(s,{body:t,icon:"/logo192.png",badge:"/logo192.png",tag:"whatsapp-notification",requireInteraction:n==="urgent",silent:!1});a.onclick=()=>{window.focus(),a.close()},setTimeout(()=>a.close(),1e4)}else Notification.permission!=="denied"&&Notification.requestPermission().then(a=>{a==="granted"&&X(s,t,n)})}function U(s="handoff"){try{const t=new Audio(s==="handoff"?"/sounds/notification-handoff.mp3":"/sounds/notification-message.mp3");t.volume=.5,t.play().catch(n=>{console.warn("Could not play notification sound:",n)})}catch(t){console.warn("Error playing sound:",t)}}class xe extends m.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,n){console.error("ErrorBoundary caught an error:",t,n)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900 text-center mb-2",children:"Algo deu errado"}),e.jsx("p",{className:"text-sm text-gray-600 text-center mb-6",children:"Ocorreu um erro inesperado. Por favor, recarregue a pÃ¡gina."}),this.state.error&&e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded border border-gray-200",children:e.jsx("p",{className:"text-xs font-mono text-gray-700 break-words",children:this.state.error.message})}),e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Recarregar PÃ¡gina"})]})}):this.props.children}}const fe=m.memo(({stats:s,isLoading:t})=>{if(t)return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[...Array(6)].map((a,r)=>e.jsxs("div",{className:"bg-gray-100 rounded-lg p-4 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-3/4"})]},r))});if(!s)return null;const n=[{label:"Total",value:s.total_handoffs,icon:"ðŸ’¬",color:"bg-blue-50 text-blue-700"},{label:"Aguardando",value:s.pending_count,icon:"â³",color:"bg-yellow-50 text-yellow-700"},{label:"Ativas",value:s.active_count,icon:"ðŸ’­",color:"bg-green-50 text-green-700"},{label:"Resolvidas",value:s.resolved_count,icon:"âœ…",color:"bg-gray-50 text-gray-700"},{label:"Agentes Online",value:s.available_agents||0,icon:"ðŸ‘¤",color:"bg-purple-50 text-purple-700"},{label:"Tempo MÃ©dio",value:s.avg_response_time_seconds?Math.round(s.avg_response_time_seconds/60)+"min":"0min",icon:"âš¡",color:"bg-orange-50 text-orange-700"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:n.map((a,r)=>e.jsxs("div",{className:`rounded-lg p-4 ${a.color}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-lg",children:a.icon}),e.jsx("p",{className:"text-xs font-medium opacity-75",children:a.label})]}),e.jsx("p",{className:"text-2xl font-bold",children:a.value})]},r))})}),pe=m.memo(({agents:s,isLoading:t})=>{const{currentAgent:n,updateAgentStatus:a}=M(),r={online:"bg-green-500",busy:"bg-yellow-500",away:"bg-orange-500",offline:"bg-gray-400"},o={online:"Online",busy:"Ocupado",away:"Ausente",offline:"Offline"};return t?e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((l,c)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg animate-pulse",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3 mb-1"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-1/2"})]})]},c))}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:["Agentes (",s.length,")"]}),s.map(l=>e.jsxs("div",{className:`
            flex items-center gap-3 p-2 rounded-lg transition-colors
            ${(n==null?void 0:n.id)===l.id?"bg-blue-50":"hover:bg-gray-50"}
          `,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${r[l.status]}`}),l.status==="online"&&e.jsx("div",{className:`absolute inset-0 w-2 h-2 rounded-full ${r[l.status]} animate-ping opacity-75`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:l.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:o[l.status]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[l.current_chats,"/",l.max_concurrent_chats]})]})]}),(n==null?void 0:n.id)===l.id&&e.jsxs("select",{value:l.status,onChange:c=>a(c.target.value),className:"text-xs border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"busy",children:"Ocupado"}),e.jsx("option",{value:"away",children:"Ausente"}),e.jsx("option",{value:"offline",children:"Offline"})]})]},l.id)),s.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"Nenhum agente disponÃ­vel"})]})}),be=m.memo(({handoffs:s,activeHandoff:t,isLoading:n})=>{const{setActiveHandoff:a,takeHandoff:r}=M(),o={urgent:"bg-red-100 text-red-700 border-red-200",high:"bg-orange-100 text-orange-700 border-orange-200",medium:"bg-yellow-100 text-yellow-700 border-yellow-200",low:"bg-gray-100 text-gray-700 border-gray-200"},l={urgent:"ðŸš¨ Urgente",high:"âš ï¸ Alta",medium:"ðŸ“Œ MÃ©dia",low:"ðŸ“‹ Baixa"},c={pending:"â³",active:"ðŸ’¬",resolved:"âœ…",cancelled:"âŒ"};return n?e.jsx("div",{className:"p-4 space-y-3",children:[...Array(5)].map((d,i)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 animate-pulse",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})]})},i))}):s.length===0?e.jsx("div",{className:"flex items-center justify-center h-full p-8",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-sm font-medium",children:"Nenhuma conversa"})]})}):e.jsx("div",{className:"p-4 space-y-3",children:s.map(d=>{const i=(t==null?void 0:t.id)===d.id,g=d.status==="pending";return e.jsx("div",{onClick:()=>a(d),className:`
              border rounded-lg p-3 cursor-pointer transition-all
              ${i?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:shadow-sm"}
            `,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`
                w-10 h-10 rounded-full flex items-center justify-center text-lg font-semibold
                ${o[d.priority]}
              `,children:d.customer_name?d.customer_name.charAt(0).toUpperCase():"ðŸ‘¤"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:d.customer_name||"Cliente"}),e.jsx("span",{className:"text-xs text-gray-500 whitespace-nowrap",children:me(new Date(d.created_at),{addSuffix:!0,locale:V})})]}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:d.phone_number}),e.jsx("p",{className:"text-sm text-gray-700 mb-2 line-clamp-2",children:d.reason_details||d.reason}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`
                    text-xs px-2 py-1 rounded border
                    ${o[d.priority]}
                  `,children:l[d.priority]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:c[d.status]}),g&&e.jsx("button",{onClick:w=>{w.stopPropagation(),r(d.id)},className:"text-xs px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Assumir"})]})]})]})]})},d.id)})})}),ve=({handoff:s})=>{const{messages:t,isLoadingMessages:n,fetchMessages:a,sendMessage:r,resolveHandoff:o,toggleBotAssist:l}=M(),[c,d]=m.useState(""),[i,g]=m.useState(!1),[w,h]=m.useState(""),y=m.useRef(null),b=t[s.session_id]||[],N=n[s.session_id]||!1;m.useEffect(()=>{s.session_id&&a(s.session_id)},[s.session_id]),m.useEffect(()=>{var u;(u=y.current)==null||u.scrollIntoView({behavior:"smooth"})},[b]);const _=async()=>{c.trim()&&(await r(s.session_id,c),d(""))},C=async()=>{if(!w.trim()){alert("Por favor, adicione notas de resoluÃ§Ã£o");return}await o(s.id,w),g(!1),h("")},L=u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),_())},E={urgent:"border-red-500 bg-red-50",high:"border-orange-500 bg-orange-50",medium:"border-yellow-500 bg-yellow-50",low:"border-gray-500 bg-gray-50"};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:`border-b-4 ${E[s.priority]} p-4`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white text-lg font-semibold",children:s.customer_name?s.customer_name.charAt(0).toUpperCase():"ðŸ‘¤"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:s.customer_name||"Cliente"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.phone_number})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:l,className:"p-2 rounded-lg hover:bg-white hover:shadow transition-all",title:"Bot Assist",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),s.status==="active"&&e.jsx("button",{onClick:()=>g(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:"Resolver"})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Motivo:"})," ",s.reason]}),s.reason_details&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.reason_details})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:N?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"Carregando mensagens..."})]})}):b.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("p",{className:"text-sm font-medium",children:"Nenhuma mensagem ainda"})]})}):e.jsxs(e.Fragment,{children:[b.map(u=>{const A=u.sender_type==="agent";return u.sender_type==="system"?e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"bg-gray-100 text-gray-600 text-xs px-3 py-1 rounded-full",children:u.content})},u.id):e.jsx("div",{className:`flex ${A?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[70%] ${A?"order-2":"order-1"}`,children:[e.jsx("div",{className:`
                      rounded-lg px-4 py-2
                      ${A?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}
                    `,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:u.content})}),e.jsx("p",{className:`text-xs text-gray-500 mt-1 ${A?"text-right":"text-left"}`,children:se(new Date(u.timestamp),"HH:mm",{locale:V})})]})},u.id)}),e.jsx("div",{ref:y})]})}),s.status==="active"&&!i&&e.jsx("div",{className:"border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("textarea",{value:c,onChange:u=>d(u.target.value),onKeyPress:L,placeholder:"Digite sua mensagem...",rows:3,className:"flex-1 border border-gray-300 rounded-lg px-4 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:_,disabled:!c.trim(),className:"px-6 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-medium",children:"Enviar"})]})}),i&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Resolver Conversa"}),e.jsx("textarea",{value:w,onChange:u=>h(u.target.value),placeholder:"Descreva como foi resolvido o atendimento...",rows:4,className:"w-full border border-gray-300 rounded-lg px-4 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{g(!1),h("")},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:C,disabled:!w.trim(),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:"Confirmar ResoluÃ§Ã£o"})]})]})})]})},ye=({handoff:s})=>{const[t,n]=m.useState(""),[a,r]=m.useState(null),[o,l]=m.useState(!1),c=async()=>{if(t.trim()){l(!0);try{const i=await v.testSentiment(t);r(i)}catch(i){console.error("Error analyzing sentiment:",i)}finally{l(!1)}}},d=["Entendo sua frustraÃ§Ã£o. Vou verificar isso imediatamente.","Obrigado por aguardar. Estou analisando sua solicitaÃ§Ã£o.","Vou encaminhar para o setor responsÃ¡vel e retorno em breve.","Consegui resolver! Precisa de mais alguma coisa?"];return s?e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Bot Assist ðŸ¤–"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"AnÃ¡lise de sentimento e sugestÃµes"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Analisar Sentimento"}),e.jsx("textarea",{value:t,onChange:i=>n(i.target.value),placeholder:"Cole uma mensagem do cliente...",rows:4,className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:c,disabled:!t.trim()||o,className:"mt-2 w-full px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:o?"Analisando...":"Analisar"}),a&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Score:"}),e.jsx("span",{className:`text-sm font-bold ${a.score>0?"text-green-600":a.score<0?"text-red-600":"text-gray-600"}`,children:a.score.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Label:"}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:a.label})]}),a.emotions.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"EmoÃ§Ãµes:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:a.emotions.map((i,g)=>e.jsx("span",{className:"text-xs px-2 py-0.5 bg-purple-100 text-purple-700 rounded",children:i},g))})]}),a.triggers.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Gatilhos:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:a.triggers.map((i,g)=>e.jsx("span",{className:"text-xs px-2 py-0.5 bg-red-100 text-red-700 rounded",children:i},g))})]}),a.should_handoff&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsx("span",{className:"text-xs font-medium text-red-600",children:"âš ï¸ Recomenda handoff humano"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Respostas Sugeridas"}),e.jsx("div",{className:"space-y-2",children:d.map((i,g)=>e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(i)},className:"w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg border border-gray-200 text-sm text-gray-700 transition-colors",children:i},g))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"AÃ§Ãµes RÃ¡pidas"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{className:"w-full px-4 py-2 bg-orange-50 text-orange-700 border border-orange-200 rounded-lg text-sm font-medium hover:bg-orange-100 transition-colors",children:"ðŸ“‹ Ver histÃ³rico completo"}),e.jsx("button",{className:"w-full px-4 py-2 bg-purple-50 text-purple-700 border border-purple-200 rounded-lg text-sm font-medium hover:bg-purple-100 transition-colors",children:"ðŸ“Š AnÃ¡lise de perfil"}),e.jsx("button",{className:"w-full px-4 py-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors",children:"ðŸ”— Criar ticket"})]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full p-8",children:e.jsx("p",{className:"text-sm text-gray-400 text-center",children:"Selecione uma conversa para ver sugestÃµes"})})},we=({notification:s,onClose:t})=>{const[n,a]=m.useState(!1);m.useEffect(()=>{const l=setTimeout(()=>{a(!0),setTimeout(t,300)},5e3);return()=>clearTimeout(l)},[t]);const r={info:"bg-blue-50 border-blue-200 text-blue-800",success:"bg-green-50 border-green-200 text-green-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800",error:"bg-red-50 border-red-200 text-red-800"},o={info:"â„¹ï¸",success:"âœ…",warning:"âš ï¸",error:"âŒ"};return e.jsx("div",{className:`
        max-w-sm w-full bg-white border-2 rounded-lg shadow-lg p-4
        transform transition-all duration-300 ease-out
        ${n?"translate-x-full opacity-0":"translate-x-0 opacity-100"}
        ${r[s.type]}
      `,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-xl",children:o[s.type]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm mb-1",children:s.title}),e.jsx("p",{className:"text-sm opacity-90",children:s.message})]}),e.jsx("button",{onClick:()=>{a(!0),setTimeout(t,300)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})},je=m.memo(({isConnected:s,socketId:t})=>e.jsxs("div",{className:`
      flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-medium
      ${s?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}
    `,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`
          w-2 h-2 rounded-full
          ${s?"bg-green-500":"bg-red-500"}
        `}),s&&e.jsx("div",{className:"absolute inset-0 w-2 h-2 bg-green-500 rounded-full animate-ping opacity-75"})]}),e.jsx("span",{children:s?"Online":"Desconectado"}),s&&t&&e.jsxs("span",{className:"text-[10px] opacity-50 font-mono",title:`Socket ID: ${t}`,children:["â€¢ ",t.substring(0,6)]})]})),Ne=()=>{const[s,t]=m.useState("default"),[n,a]=m.useState(!1);m.useEffect(()=>{"Notification"in window&&(t(Notification.permission),Notification.permission==="default"&&a(!0))},[]);const r=async()=>{if("Notification"in window){const o=await Notification.requestPermission();t(o),o==="granted"&&(a(!1),new Notification("NotificaÃ§Ãµes Ativadas",{body:"VocÃª receberÃ¡ alertas de novas conversas",icon:"/logo192.png"}))}};return!n||s==="granted"?null:e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-1",children:"Ativar NotificaÃ§Ãµes"}),e.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"Receba alertas instantÃ¢neos quando novas conversas precisarem de atendimento"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors",children:"Ativar NotificaÃ§Ãµes"}),e.jsx("button",{onClick:()=>a(!1),className:"px-4 py-2 bg-white text-blue-700 text-sm font-medium rounded-lg border border-blue-200 hover:bg-blue-50 transition-colors",children:"Agora NÃ£o"})]})]}),e.jsx("button",{onClick:()=>a(!1),className:"flex-shrink-0 text-blue-400 hover:text-blue-600 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})},_e=()=>{const[s,t]=G.useState(!0);console.log("ðŸŽ¯ WhatsAppDashboard component rendering...");const{stats:n,agents:a,handoffs:r,activeHandoff:o,filterStatus:l,isLoadingStats:c,isLoadingAgents:d,isLoadingHandoffs:i,isSidebarOpen:g,isBotAssistOpen:w,isConnected:h,notifications:y,currentAgent:b,fetchStats:N,fetchAgents:_,fetchHandoffs:C,initializeCurrentAgent:L,setFilterStatus:E,toggleSidebar:u,removeNotification:A}=M(),O=localStorage.getItem("access_token"),{socketId:Y}=he(O,(b==null?void 0:b.id)||null);return m.useEffect(()=>{let p=!0,T=!1,I=null,R=!1;const q=async()=>{if(!(!p||T)){T=!0;try{console.log("ðŸš€ Initializing WhatsApp Dashboard...");const k=new Promise((B,J)=>setTimeout(()=>J(new Error("Initialization timeout")),15e3));try{await Promise.race([Promise.all([L(),N(),_(),C()]),k])}catch(B){console.warn("âš ï¸ Initialization timeout, continuing anyway:",B)}console.log("âœ… Dashboard initialized")}catch(k){console.error("âŒ Error initializing dashboard:",k)}finally{p&&t(!1)}}},W=async()=>{if(!(R||!p)){if(document.hidden){console.log("â¸ï¸ Page hidden, skipping refresh");return}R=!0,console.log("ðŸ”„ Refreshing dashboard data...");try{await Promise.all([N(),C(l==="all"?void 0:l)])}catch(k){console.error("Error refreshing data:",k)}finally{R=!1}}};q(),I=setInterval(W,6e4);const z=()=>{!document.hidden&&p&&(console.log("ðŸ‘ï¸ Page visible again, refreshing data"),W())};return document.addEventListener("visibilitychange",z),()=>{p=!1,I&&clearInterval(I),document.removeEventListener("visibilitychange",z)}},[]),s?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando WhatsApp Dashboard..."})]})}):e.jsx(xe,{children:e.jsxs("div",{className:"flex h-screen bg-gray-50",role:"main","aria-label":"WhatsApp Dashboard",children:[e.jsx("div",{className:`
        transition-all duration-300 ease-in-out
        ${g?"w-80":"w-0"}
        border-r border-gray-200 bg-white overflow-hidden
      `,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Atendimento WhatsApp"}),e.jsx("div",{className:"mt-2",children:e.jsx(je,{isConnected:h,socketId:Y})})]}),e.jsx("button",{onClick:u,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Recolher painel",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"})})})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","active","my"].map(p=>e.jsxs("button",{onClick:()=>E(p),className:`
                    px-3 py-1.5 rounded-lg text-sm font-medium transition-colors
                    ${l===p?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}
                  `,children:[p==="all"&&"Todas",p==="pending"&&"Aguardando",p==="active"&&"Ativas",p==="my"&&"Minhas"]},p))})]}),e.jsx("div",{className:"px-4 py-3 border-b border-gray-200",children:e.jsx(pe,{agents:a,isLoading:d})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(be,{handoffs:r,activeHandoff:o,isLoading:i})})]})}),!g&&e.jsx("button",{onClick:u,className:"absolute top-4 left-4 z-10 p-2 bg-white rounded-lg shadow-lg hover:bg-gray-50 transition-colors",title:"Expandir painel",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 bg-white border-b border-gray-200",children:e.jsx(Ne,{})}),e.jsx("div",{className:"p-4 bg-white border-b border-gray-200",children:e.jsx(fe,{stats:n,isLoading:c})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"flex-1",children:o?e.jsx(ve,{handoff:o}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("p",{className:"text-lg font-medium",children:"Selecione uma conversa"}),e.jsx("p",{className:"text-sm mt-1",children:"Escolha uma conversa da fila para comeÃ§ar"})]})})}),w&&e.jsx("div",{className:"w-80 border-l border-gray-200 bg-white",children:e.jsx(ye,{handoff:o})})]})]}),e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:y.map(p=>e.jsx(we,{notification:p,onClose:()=>A(p.id)},p.id))})]})})};export{_e as WhatsAppDashboard};
