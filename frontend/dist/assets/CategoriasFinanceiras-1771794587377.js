import{r as l,j as e}from"./vendor-react-1771794587377.js";import{S as P,t as te,u as A,U as re,V as q}from"./vendor-icons-1771794587377.js";import{a as u}from"./index-1771794587377.js";import{n as c}from"./vendor-utils-1771794587377.js";const le=()=>{const[g,M]=l.useState([]),[w,S]=l.useState([]),[K,C]=l.useState(!0),[I,x]=l.useState(!1),[O,E]=l.useState(!1),[p,D]=l.useState(null),[h,V]=l.useState(null),[k,W]=l.useState(new Set),[b,j]=l.useState("todos"),[s,n]=l.useState({nome:"",tipo:"despesa",cor:"#6366f1",icone:"ðŸ“‹",descricao:"",ativo:!0,novasSubcategorias:[]}),[i,f]=l.useState({categoria_id:null,nome:"",descricao:"",ativo:!0}),L=["ðŸ’°","ðŸ’¸","ðŸ“‹","ðŸ ","âš¡","ðŸ’§","ðŸ“¡","ðŸ‘¥","ðŸ“¦","ðŸ”§","ðŸš—","ðŸ½ï¸","ðŸ“","ðŸ›¡ï¸","ðŸ›’","âœ¨","ðŸ•","ðŸ©º","ðŸ¨","ðŸŽ“"],U=["#ef4444","#f97316","#f59e0b","#84cc16","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899"];l.useEffect(()=>{y()},[]);const y=async()=>{await Promise.all([B(),G()])},B=async()=>{try{C(!0);const a=await u.get("/categorias-financeiras/");console.log("ðŸ“‚ Categorias carregadas:",a.data.length),console.log("ðŸ” Primeira categoria:",a.data[0]),M(a.data)}catch(a){console.error("Erro ao carregar categorias:",a),c.error("Erro ao carregar categorias financeiras")}finally{C(!1)}},G=async()=>{var a,t;try{console.log("ðŸ”„ Iniciando carregamento de subcategorias DRE...");const r=await u.get("/dre/subcategorias");console.log("âœ… Resposta recebida:",r),console.log("ðŸ“‹ Subcategorias DRE carregadas:",r.data.length),console.log("ðŸ” Primeira subcategoria:",r.data[0]),console.log("ðŸ“¦ Todas as subcategorias:",r.data),S(r.data)}catch(r){console.error("âŒ ERRO ao carregar subcategorias DRE:",r),console.error("âŒ Erro completo:",((a=r.response)==null?void 0:a.data)||r.message),console.error("âŒ Status:",(t=r.response)==null?void 0:t.status),S([])}},H=a=>{const t=new Set(k);t.has(a)?t.delete(a):t.add(a),W(t)},R=a=>{if(!a.dre_subcategoria_id)return[];const t=w.find(o=>o.id===a.dre_subcategoria_id);if(!t)return console.log(`âš ï¸ Categoria "${a.nome}" tem dre_subcategoria_id=${a.dre_subcategoria_id} mas nÃ£o encontrada`),[];const r=w.filter(o=>o.categoria_id===t.categoria_id);return console.log(`ðŸ“¦ Categoria "${a.nome}" â†’ ${r.length} subcategorias DRE`),r},J=async a=>{var t,r;if(a.preventDefault(),!s.nome||!s.tipo){c.error("Preencha nome e tipo");return}try{let o;if(p)await u.put(`/categorias-financeiras/${p}`,{nome:s.nome,tipo:s.tipo,cor:s.cor,icone:s.icone,descricao:s.descricao,ativo:s.ativo}),o=p,c.success("Categoria atualizada com sucesso!");else if(o=(await u.post("/categorias-financeiras/",{nome:s.nome,tipo:s.tipo,cor:s.cor,icone:s.icone,descricao:s.descricao,ativo:s.ativo})).data.id,c.success("Categoria criada com sucesso!"),s.novasSubcategorias.length>0){const N=s.novasSubcategorias.filter(m=>m.nome.trim());for(const m of N)try{await u.post("/subcategorias/",{categoria_id:o,nome:m.nome,descricao:m.descricao,ativo:m.ativo})}catch(se){console.error("Erro ao criar subcategoria:",se),c.error(`Erro ao criar subcategoria: ${m.nome}`)}N.length>0&&c.success(`${N.length} subcategoria(s) criada(s)!`)}x(!1),v(),y()}catch(o){console.error("Erro ao salvar:",o),c.error(((r=(t=o.response)==null?void 0:t.data)==null?void 0:r.detail)||"Erro ao salvar categoria")}},Q=async a=>{console.log(`ðŸ”§ Editando categoria "${a.nome}" (ID: ${a.id})`);const t=R(a);console.log(`ðŸ“¦ Subcategorias DRE encontradas: ${t.length}`,t);const r=t.map(o=>({id:o.id,nome:o.nome,descricao:o.descricao||"",ativo:o.ativo,tipo_custo:o.tipo_custo,escopo_rateio:o.escopo_rateio}));n({nome:a.nome,tipo:a.tipo,cor:a.cor||"#6366f1",icone:a.icone||"ðŸ“‹",descricao:a.descricao||"",ativo:a.ativo,novasSubcategorias:r}),D(a.id),x(!0)},X=async a=>{var t,r;if(window.confirm("Deseja realmente excluir esta categoria?"))try{await u.delete(`/categorias-financeiras/${a}`),c.success("Categoria excluÃ­da com sucesso!"),y()}catch(o){console.error("Erro ao excluir:",o),c.error(((r=(t=o.response)==null?void 0:t.data)==null?void 0:r.detail)||"Erro ao excluir categoria")}},v=()=>{n({nome:"",tipo:"despesa",cor:"#6366f1",icone:"ðŸ“‹",descricao:"",ativo:!0,novasSubcategorias:[]}),D(null)},_=(a="")=>{n({...s,novasSubcategorias:[...s.novasSubcategorias,{nome:a,descricao:"",ativo:!0}]})},Y=(a,t,r)=>{const o=[...s.novasSubcategorias];o[a][t]=r,n({...s,novasSubcategorias:o})},Z=a=>{const t=s.novasSubcategorias.filter((r,o)=>o!==a);n({...s,novasSubcategorias:t})},ee=(a,t)=>{a.key==="Tab"&&!a.shiftKey&&t===s.novasSubcategorias.length-1&&(a.preventDefault(),_())},$=()=>{f({categoria_id:null,nome:"",descricao:"",ativo:!0}),V(null)},ae=async a=>{var t,r;if(a.preventDefault(),!i.categoria_id||!i.nome){c.error("Preencha categoria e nome");return}try{h?(await u.put(`/subcategorias/${h}`,i),c.success("Subcategoria atualizada!")):(await u.post("/subcategorias",i),c.success("Subcategoria criada!")),E(!1),$(),carregarSubcategorias()}catch(o){console.error("Erro ao salvar:",o),c.error(((r=(t=o.response)==null?void 0:t.data)==null?void 0:r.detail)||"Erro ao salvar subcategoria")}},z=g.filter(a=>b==="todos"?!0:a.tipo===b),F=g.filter(a=>a.tipo==="despesa").length,T=g.filter(a=>a.tipo==="receita").length;return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"ðŸ·ï¸ Categorias Financeiras"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Organize suas receitas e despesas |",e.jsxs("span",{className:"text-red-600 ml-2",children:["ðŸ’¸ ",F," despesas"]}),e.jsxs("span",{className:"text-green-600 ml-2",children:["ðŸ’° ",T," receitas"]})]})]}),e.jsxs("button",{onClick:()=>{v(),x(!0)},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:[e.jsx(P,{})," Nova Categoria"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:()=>j("todos"),className:`px-4 py-2 rounded-lg ${b==="todos"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"}`,children:["ðŸ“Š Todas (",g.length,")"]}),e.jsxs("button",{onClick:()=>j("despesa"),className:`px-4 py-2 rounded-lg ${b==="despesa"?"bg-red-600 text-white":"bg-gray-200 text-gray-700"}`,children:["ðŸ’¸ Despesas (",F,")"]}),e.jsxs("button",{onClick:()=>j("receita"),className:`px-4 py-2 rounded-lg ${b==="receita"?"bg-green-600 text-white":"bg-gray-200 text-gray-700"}`,children:["ðŸ’° Receitas (",T,")"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:K?e.jsx("div",{className:"px-6 py-8 text-center text-gray-500",children:"Carregando..."}):z.length===0?e.jsx("div",{className:"px-6 py-8 text-center text-gray-500",children:"Nenhuma categoria encontrada"}):e.jsx("div",{className:"divide-y divide-gray-200",children:z.map(a=>{const t=R(a),r=k.has(a.id),o=t.length>0;return e.jsxs("div",{children:[e.jsxs("div",{className:"px-6 py-4 hover:bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("button",{onClick:()=>H(a.id),className:`flex items-center justify-center w-10 h-10 rounded-lg transition-all duration-200 transform hover:scale-105 ${o?r?"text-white bg-gradient-to-r from-purple-600 to-purple-700 shadow-lg hover:shadow-xl":"text-purple-600 bg-purple-100 hover:bg-purple-200 hover:text-purple-700 shadow-md hover:shadow-lg":"text-gray-300 cursor-not-allowed bg-gray-50"}`,disabled:!o,title:o?r?"Recolher subcategorias":"Expandir subcategorias":"Sem subcategorias DRE",children:o?r?e.jsx(te,{size:22,strokeWidth:2.5}):e.jsx(A,{size:22,strokeWidth:2.5}):e.jsx(A,{size:22})}),e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("span",{style:{backgroundColor:a.cor},className:"w-10 h-10 rounded-full flex items-center justify-center text-white text-lg",children:a.icone||"ðŸ“‹"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800",children:a.nome}),a.descricao&&e.jsx("div",{className:"text-sm text-gray-500",children:a.descricao})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${a.tipo==="receita"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.tipo==="receita"?"ðŸ’° Receita":"ðŸ’¸ Despesa"}),o&&e.jsxs("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-medium flex items-center gap-1",children:[e.jsx("span",{children:"ðŸ“Š DRE"}),e.jsx("span",{className:"bg-purple-200 text-purple-900 px-1.5 rounded-full font-bold",children:t.length})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>Q(a),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-md",title:"Editar",children:e.jsx(re,{size:18})}),e.jsx("button",{onClick:()=>X(a.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-md",title:"Excluir",children:e.jsx(q,{size:18})})]})]}),r&&e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 border-t border-purple-100",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-6 py-2 bg-purple-100/50 border-b border-purple-200",children:e.jsxs("span",{className:"text-xs font-semibold text-purple-700 uppercase tracking-wide",children:["ðŸ—ï¸ Subcategorias DRE (",t.length,")"]})}),t.map(d=>e.jsxs("div",{className:"px-6 py-3 flex items-center gap-4 ml-9",children:[e.jsx("span",{className:"text-purple-400 text-lg",children:"â””â”€"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:d.nome}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500 bg-white px-2 py-0.5 rounded",children:d.tipo_custo}),d.escopo_rateio&&e.jsx("span",{className:"text-xs text-gray-500 bg-white px-2 py-0.5 rounded",children:d.escopo_rateio})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${d.ativo?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"}`,children:d.ativo?"âœ“ Ativo":"âœ— Inativo"})]},d.id))]}):e.jsx("div",{className:"px-6 py-4 ml-9 text-center",children:e.jsxs("div",{className:"text-gray-400 text-sm",children:[e.jsx("div",{className:"mb-2",children:"ðŸ“­"}),e.jsx("div",{className:"font-medium",children:"Nenhuma subcategoria DRE cadastrada"}),e.jsx("div",{className:"text-xs mt-1",children:"Configure subcategorias no mÃ³dulo DRE"})]})})})]},a.id)})})}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full m-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("h3",{className:"text-xl font-bold",children:p?"Editar Categoria":"Nova Categoria"}),e.jsx("button",{onClick:()=>{x(!1),v()},className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),e.jsxs("form",{onSubmit:J,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",value:s.nome,onChange:a=>n({...s,nome:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo *"}),e.jsxs("select",{value:s.tipo,onChange:a=>n({...s,tipo:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"despesa",children:"ðŸ’¸ Despesa"}),e.jsx("option",{value:"receita",children:"ðŸ’° Receita"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ãcone"}),e.jsx("select",{value:s.icone,onChange:a=>n({...s,icone:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:L.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:s.cor,onChange:a=>n({...s,cor:a.target.value}),className:"w-12 h-10 border border-gray-300 rounded-md"}),e.jsx("select",{value:s.cor,onChange:a=>n({...s,cor:a.target.value}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:U.map(a=>e.jsx("option",{value:a,children:a},a))})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:s.descricao,onChange:a=>n({...s,descricao:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",rows:"3"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"ativo",checked:s.ativo,onChange:a=>n({...s,ativo:a.target.checked}),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("label",{htmlFor:"ativo",className:"text-sm text-gray-700",children:"Categoria ativa"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subcategorias DRE (opcional)"}),e.jsxs("button",{type:"button",onClick:()=>_(),className:"text-sm text-purple-600 hover:text-purple-800 flex items-center gap-1",children:[e.jsx(P,{size:14})," Adicionar"]})]}),s.novasSubcategorias.length>0&&e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:s.novasSubcategorias.map((a,t)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-md",children:[e.jsx("input",{type:"text",value:a.nome,onChange:r=>Y(t,"nome",r.target.value),onKeyDown:r=>ee(r,t),placeholder:"Nome da subcategoria (Tab para adicionar mais)",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>Z(t),className:"text-red-600 hover:text-red-800 p-1",title:"Remover",children:e.jsx(q,{size:16})})]},t))}),s.novasSubcategorias.length===0&&e.jsx("p",{className:"text-sm text-gray-500 italic",children:'Clique em "Adicionar" ou crie a categoria primeiro e depois adicione subcategorias'})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{x(!1),v()},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:p?"Atualizar":"Criar"})]})]})]})}),O&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:h?"Editar Subcategoria DRE":"Nova Subcategoria DRE"}),i.categoria_id&&g.find(a=>a.id===i.categoria_id)&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-md border border-blue-200",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Categoria: "}),e.jsx("span",{className:"font-semibold text-gray-800",children:g.find(a=>a.id===i.categoria_id).nome})]}),e.jsxs("form",{onSubmit:ae,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Subcategoria *"}),e.jsx("input",{type:"text",value:i.nome,onChange:a=>f({...i,nome:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:i.descricao,onChange:a=>f({...i,descricao:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",rows:"3"})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:i.ativo,onChange:a=>f({...i,ativo:a.target.checked}),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Ativo"})]})}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{E(!1),$()},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:h?"Atualizar":"Criar"})]})]})]})})]})};export{le as default};
