import{r as l,j as e,a9 as y,T as p,R as L,B as M,D as q,ab as T,ac as B}from"./vendor-react-1772138187586.js";import{a as x}from"./index-1772138187586.js";const V=()=>{const[_,w]=l.useState([]),[C,h]=l.useState(!0),[E,n]=l.useState(!1),[u,c]=l.useState(null),[g,S]=l.useState(new Set),[o,i]=l.useState({nome:"",descricao:"",categoria_pai_id:null,ordem:0}),d=4;l.useEffect(()=>{m()},[]);const m=async()=>{try{h(!0);const s=await x.get("/produtos/categorias");w(s.data)}catch(s){console.error("Erro ao carregar categorias:",s),alert("Erro ao carregar categorias")}finally{h(!1)}},k=s=>{const a=new Set(g);a.has(s)?a.delete(s):a.add(s),S(a)},F=async s=>{var a,t;s.preventDefault();try{u?await x.put(`/produtos/categorias/${u}`,o):await x.post("/produtos/categorias",o),n(!1),c(null),i({nome:"",descricao:"",categoria_pai_id:null,ordem:0}),m()}catch(r){console.error("Erro ao salvar categoria:",r),(t=(a=r.response)==null?void 0:a.data)!=null&&t.detail?alert(r.response.data.detail):alert("Erro ao salvar categoria")}},z=s=>{c(s.id),i({nome:s.nome,descricao:s.descricao||"",categoria_pai_id:s.categoria_pai_id,ordem:s.ordem}),n(!0)},D=async s=>{var a,t;if(s.total_filhos>0){alert(`Esta categoria possui ${s.total_filhos} subcategoria(s). Remova-as primeiro.`);return}if(!(s.total_produtos>0&&!confirm(`Esta categoria possui ${s.total_produtos} produto(s). Deseja realmente excluir?`)))try{await x.delete(`/produtos/categorias/${s.id}`),m()}catch(r){console.error("Erro ao excluir categoria:",r),alert(((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.detail)||"Erro ao excluir categoria")}},$=s=>{if(s.nivel>=d){alert(`Limite de ${d} níveis de categorias atingido.`);return}c(null),i({nome:"",descricao:"",categoria_pai_id:s.id,ordem:0}),n(!0)},b=()=>{c(null),i({nome:"",descricao:"",categoria_pai_id:null,ordem:0}),n(!0)},f=(s=null,a=1)=>_.filter(t=>t.categoria_pai_id===s).sort((t,r)=>t.ordem-r.ordem||t.nome.localeCompare(r.nome)).map(t=>({...t,nivel:a,filhos:f(t.id,a+1)})),j=(s,a=1)=>{const t=s.filhos&&s.filhos.length>0,r=g.has(s.id),v=a<d,R=(a-1)*30;return e.jsxs(L.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white hover:bg-gray-50 border-b",style:{paddingLeft:`${20+R}px`},children:[e.jsx("div",{className:"w-5 flex items-center justify-center",children:t?e.jsx("button",{onClick:()=>k(s.id),className:"text-gray-500 hover:text-gray-700 transition-colors",children:r?e.jsx(M,{size:18}):e.jsx(q,{size:18})}):e.jsx("span",{className:"text-gray-300",children:"•"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-800",children:s.nome}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Nível ",a]}),s.total_filhos>0&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:[s.total_filhos," sub"]}),s.total_produtos>0&&e.jsxs("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded",children:[s.total_produtos," produtos"]})]}),s.descricao&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.descricao})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[v&&e.jsx("button",{onClick:()=>$(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Adicionar subcategoria",children:e.jsx(y,{size:18})}),!v&&e.jsx("span",{className:"p-2 text-gray-300 cursor-not-allowed",title:`Limite de ${d} níveis atingido`,children:e.jsx(p,{size:18})}),e.jsx("button",{onClick:()=>z(s),className:"p-2 text-yellow-600 hover:bg-yellow-50 rounded transition-colors",title:"Editar",children:e.jsx(T,{size:18})}),e.jsx("button",{onClick:()=>D(s),className:"p-2 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Excluir",children:e.jsx(B,{size:18})})]})]}),t&&r&&e.jsx("div",{children:s.filhos.map(A=>j(A,a+1))})]},s.id)},N=f();return C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-600",children:"Carregando categorias..."})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Categorias"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Gerencie suas categorias hierarquicamente (até ",d," níveis)"]})]}),e.jsxs("button",{onClick:b,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors",children:[e.jsx(y,{size:20}),"Nova Categoria"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:N.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(p,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhuma categoria cadastrada"}),e.jsx("button",{onClick:b,className:"mt-4 text-blue-600 hover:text-blue-700",children:"Criar primeira categoria"})]}):e.jsx("div",{children:N.map(s=>j(s))})}),E&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:u?"Editar Categoria":o.categoria_pai_id?"Nova Subcategoria":"Nova Categoria"}),e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",value:o.nome,onChange:s=>i({...o,nome:s.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,autoFocus:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrição"}),e.jsx("textarea",{value:o.descricao,onChange:s=>i({...o,descricao:s.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ordem"}),e.jsx("input",{type:"number",value:o.ordem,onChange:s=>i({...o,ordem:parseInt(s.target.value)||0}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Menor valor aparece primeiro"})]}),o.categoria_pai_id&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx(p,{className:"inline mr-1"}),"Esta será uma subcategoria"]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{n(!1),c(null),i({nome:"",descricao:"",categoria_pai_id:null,ordem:0})},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded hover:bg-gray-300 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:u?"Salvar":"Criar"})]})]})]})})]})};export{V as default};
