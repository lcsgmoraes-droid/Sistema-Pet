import{r as l,j as e}from"./vendor-react-1772318170511.js";import{a as g}from"./api-1772318170511.js";import"./index-1772318170511.js";function C(){const[m,d]=l.useState(!0),[o,u]=l.useState([]),[t,h]=l.useState([]),[x,y]=l.useState(null),[p,j]=l.useState(!1);l.useEffect(()=>{f()},[]);async function f(){d(!0);try{const[a,r]=await Promise.all([g.get("/rotas-entrega/vendas-pendentes/listar"),g.get("/configuracoes/entregas").catch(()=>({data:null}))]);u(Array.isArray(a.data)?a.data:[]),y(r.data)}catch(a){console.error(a),alert("Erro ao carregar vendas pendentes"),u([])}finally{d(!1)}}async function z(){var n,c,s;if(o.length===0){alert("NÃ£o hÃ¡ vendas para otimizar");return}if(!x||!x.logradouro){alert("âš ï¸ Configure o endereÃ§o da loja em ConfiguraÃ§Ãµes > Entregas antes de otimizar rotas");return}if(confirm(`âš ï¸ ATENÃ‡ÃƒO - ESTA OPERAÃ‡ÃƒO TEM CUSTO!

ðŸ’µ Custo estimado: 5 centavos
ðŸ“ Entregas a otimizar: ${o.length}
ðŸ—ºï¸ SerÃ¡ feita 1 chamada ao Google Maps API
ðŸ’¾ A ordem serÃ¡ salva no banco (nÃ£o cobra novamente)

Deseja continuar?`)){j(!0);try{console.log("ðŸ—ºï¸ Chamando endpoint de otimizaÃ§Ã£o...");const i=await g.post("/rotas-entrega/vendas-pendentes/otimizar");console.log("âœ… Resposta da otimizaÃ§Ã£o:",i.data),alert(`âœ… ROTAS OTIMIZADAS COM SUCESSO!

${i.data.message}

Total otimizado: ${i.data.total_otimizado||o.length} entregas`),await f()}catch(i){console.error("âŒ Erro ao otimizar:",i),console.error("Detalhes:",(n=i.response)==null?void 0:n.data);const b=((s=(c=i.response)==null?void 0:c.data)==null?void 0:s.detail)||"Erro ao otimizar rotas. Verifique se o Google Maps estÃ¡ configurado.";alert(`âŒ ERRO AO OTIMIZAR ROTAS

${b}`)}finally{j(!1)}}}function S(a){h(r=>r.includes(a)?r.filter(n=>n!==a):[...r,a])}async function E(){var a,r;if(t.length===0){alert("Selecione pelo menos uma entrega");return}if(confirm(`Deseja criar uma rota com ${t.length} entrega(s)?`))try{d(!0);const n=o.filter(s=>t.includes(s.id)),c=n.filter(s=>!s.entregador_id);if(c.length>0){alert(`âŒ As seguintes vendas nÃ£o tÃªm entregador atribuÃ­do:
${c.map(s=>s.numero_venda).join(", ")}

Atribua um entregador antes de criar a rota.`),d(!1);return}await g.post("/rotas-entrega/",{vendas_ids:t,entregador_id:n[0].entregador_id,moto_da_loja:!1}),alert(`âœ… Rota criada com ${t.length} entrega(s)!

As entregas foram movidas para "Rotas de Entrega"`),h([]),f()}catch(n){console.error(n),alert(((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.detail)||"Erro ao criar rota. Verifique se todas as entregas tÃªm entregador atribuÃ­do.")}finally{d(!1)}}return m?e.jsx("div",{className:"page",children:"Carregando..."}):e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"Entregas em Aberto"}),e.jsx("p",{style:{color:"#666",marginBottom:20},children:"Vendas com entrega que estÃ£o aguardando iniciar a rota"}),!Array.isArray(o)||o.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"âœ… NÃ£o hÃ¡ entregas pendentes"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:20,display:"flex",gap:10,alignItems:"center"},children:[e.jsx("button",{onClick:z,disabled:p||m,className:"btn-secondary",title:"Reorganizar entregas usando Google Maps para menor distÃ¢ncia",children:p?"ðŸ”„ Otimizando...":"ðŸ—ºï¸ Otimizar Rotas"}),e.jsxs("span",{style:{color:"#666",fontSize:"0.9em"},children:["â„¹ï¸ ",o.filter(a=>a.ordem_otimizada).length>0?`${o.filter(a=>a.ordem_otimizada).length} entregas jÃ¡ otimizadas. `:"","Clique para ordenar pela rota mais eficiente"]})]}),e.jsxs("table",{className:"table-entregas",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:40},children:e.jsx("input",{type:"checkbox",checked:t.length===o.length&&o.length>0,onChange:a=>h(a.target.checked?o.map(r=>r.id):[])})}),e.jsx("th",{children:"Ordem"}),e.jsx("th",{children:"Venda"}),e.jsx("th",{children:"Data da Venda"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Entregador"}),e.jsx("th",{children:"EndereÃ§o"}),e.jsx("th",{children:"Taxa Entrega"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:o.map((a,r)=>e.jsxs("tr",{style:{backgroundColor:t.includes(a.id)?"#e3f2fd":a.ordem_otimizada?"#f0f8ff":"white"},children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:t.includes(a.id),onChange:()=>S(a.id)})}),e.jsx("td",{children:e.jsxs("strong",{style:{color:a.ordem_otimizada?"#007bff":"#999",fontSize:"1.1em"},children:[r+1,a.ordem_otimizada&&" ðŸ—ºï¸"]})}),e.jsx("td",{children:a.numero_venda}),e.jsx("td",{style:{fontSize:"0.9em"},children:a.data_venda?new Date(a.data_venda).toLocaleDateString("pt-BR"):"N/A"}),e.jsx("td",{children:a.cliente_nome}),e.jsx("td",{children:e.jsx("span",{style:{color:a.entregador_nome?"#28a745":"#999",fontWeight:a.entregador_nome?"600":"normal"},children:a.entregador_nome||"NÃ£o atribuÃ­do"})}),e.jsx("td",{style:{maxWidth:300,fontSize:"0.9em"},children:a.endereco_entrega||"N/A"}),e.jsxs("td",{children:["R$ ",parseFloat(a.taxa_entrega||0).toFixed(2)]}),e.jsxs("td",{children:["R$ ",parseFloat(a.total||0).toFixed(2)]}),e.jsx("td",{children:e.jsx("span",{style:{padding:"4px 8px",borderRadius:4,fontSize:12,fontWeight:"bold",color:"#fff",backgroundColor:"#ffa500"},children:"AGUARDANDO"})})]},a.id))})]}),e.jsxs("div",{style:{marginTop:20,display:"flex",gap:10},children:[e.jsxs("button",{onClick:E,disabled:t.length===0||m,className:"btn-primary",style:{backgroundColor:t.length>0?"#28a745":"#ccc",cursor:t.length>0?"pointer":"not-allowed"},children:["âœ… Criar Rota (",t.length," selecionada",t.length!==1?"s":"",")"]}),e.jsx("span",{style:{color:"#666",fontSize:"0.9em",alignSelf:"center"},children:"ðŸ’¡ Selecione as entregas e clique para criar uma rota"})]})]})]})}export{C as default};
