import{r as n,j as e}from"./vendor-react-1771892120512.js";import{a as g}from"./index-1771892120512.js";import{ac as y,aL as Q,az as W,ag as P,a4 as v,af as Y,ar as X,aK as M,ao as ee,X as U,a3 as ae}from"./vendor-icons-1771892120512.js";import"./vendor-utils-1771892120512.js";function ce(){var B,_,R;const[I,O]=n.useState([]),[w,C]=n.useState(!0),[o,V]=n.useState(""),[x,J]=n.useState(""),[m,Z]=n.useState(""),[p,G]=n.useState(""),[E,S]=n.useState(""),[r,F]=n.useState(null),[u,b]=n.useState(null),[d,j]=n.useState(""),[f,k]=n.useState(!1),K=[{value:"",label:"Todas"},{value:"Autorizada",label:"Autorizada"},{value:"Emitida DANFE",label:"Emitida DANFE"},{value:"Cancelada",label:"Cancelada"},{value:"Pendente",label:"Pendente"}];n.useEffect(()=>{N()},[o,x,m]);const N=async()=>{try{C(!0),S("");const a=new URLSearchParams;o&&a.append("situacao",o),x&&a.append("data_inicial",x),m&&a.append("data_final",m);const t=await g.get(`/nfe/?${a.toString()}`);O(t.data.notas||[])}catch(a){console.error("Erro ao carregar notas:",a),S("Erro ao carregar notas fiscais")}finally{C(!1)}},L=async(a,t)=>{try{const s=await g.get(`/nfe/${a}/danfe`,{responseType:"blob"}),c=window.URL.createObjectURL(new Blob([s.data])),l=document.createElement("a");l.href=c,l.setAttribute("download",`danfe_${t}.pdf`),document.body.appendChild(l),l.click(),l.remove()}catch(s){console.error("Erro ao baixar DANFE:",s),alert("Erro ao baixar DANFE")}},A=async(a,t)=>{try{const s=await g.get(`/nfe/${a}/xml`),c=new Blob([s.data.xml],{type:"application/xml"}),l=window.URL.createObjectURL(c),i=document.createElement("a");i.href=l,i.setAttribute("download",`nfe_${t}.xml`),document.body.appendChild(i),i.click(),i.remove()}catch(s){console.error("Erro ao baixar XML:",s),alert("Erro ao baixar XML")}},q=async()=>{var a,t;if(!d||d.length<15){alert("A justificativa deve ter no mínimo 15 caracteres");return}try{k(!0),await g.post(`/nfe/${u.id}/cancelar`,{justificativa:d}),alert("Nota fiscal cancelada com sucesso!"),b(null),j(""),N()}catch(s){console.error("Erro ao cancelar nota:",s),alert(((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.detail)||"Erro ao cancelar nota fiscal")}finally{k(!1)}},H=async(a,t)=>{var s,c;if(confirm(`Deseja realmente excluir a nota ${t}?

Isso apenas remove os dados da nota do sistema, não cancela no Bling/SEFAZ.`))try{await g.delete(`/nfe/${a}`),alert("Nota fiscal excluída com sucesso!"),N()}catch(l){console.error("Erro ao excluir nota:",l),alert(((c=(s=l.response)==null?void 0:s.data)==null?void 0:c.detail)||"Erro ao excluir nota fiscal")}},D=a=>{switch(a==null?void 0:a.toLowerCase()){case"autorizada":case"emitida danfe":return"bg-green-100 text-green-800";case"cancelada":return"bg-red-100 text-red-800";case"pendente":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},$=a=>{switch(a==null?void 0:a.toLowerCase()){case"autorizada":case"emitida danfe":return e.jsx(ae,{className:"w-4 h-4"});case"cancelada":return e.jsx(U,{className:"w-4 h-4"});case"pendente":return e.jsx(P,{className:"w-4 h-4"});default:return e.jsx(y,{className:"w-4 h-4"})}},h=I.filter(a=>{var s,c,l,i,z,T;if(!p)return!0;const t=p.toLowerCase();return((s=a.numero)==null?void 0:s.toLowerCase().includes(t))||((c=a.serie)==null?void 0:c.toLowerCase().includes(t))||((i=(l=a.cliente)==null?void 0:l.nome)==null?void 0:i.toLowerCase().includes(t))||((T=(z=a.cliente)==null?void 0:z.cpf_cnpj)==null?void 0:T.toLowerCase().includes(t))});return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(y,{className:"w-8 h-8 text-blue-600"}),"Notas Fiscais de Saída"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie suas NF-e e NFC-e emitidas"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Q,{className:"w-5 h-5 text-gray-600"}),e.jsx("h2",{className:"font-semibold text-gray-800",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por número, cliente...",value:p,onChange:a=>G(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("div",{children:e.jsx("input",{type:"date",value:x,onChange:a=>J(a.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),e.jsx("div",{children:e.jsx("input",{type:"date",value:m,onChange:a=>Z(a.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),e.jsx("select",{value:o,onChange:a=>V(a.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:K.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),E&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 rounded-lg p-4 mb-6 flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),E]}),w?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Carregando notas fiscais..."})]}):h.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(y,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Nenhuma nota encontrada"}),e.jsx("p",{className:"text-gray-600",children:p||o||x||m?"Tente ajustar os filtros":"Emita sua primeira nota fiscal em uma venda"})]}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Número"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Emissão"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Situação"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(a=>{var t,s,c,l;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.numero}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Série ",a.serie]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:a.data_emissao?new Date(a.data_emissao).toLocaleDateString("pt-BR"):"-"})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((t=a.cliente)==null?void 0:t.nome)||"Cliente não informado"}),e.jsx("div",{className:"text-sm text-gray-500",children:((s=a.cliente)==null?void 0:s.cpf_cnpj)||""})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium ${D(a.status)}`,children:[$(a.status),a.status||"Pendente"]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["R$ ",a.valor.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[(((c=a.status)==null?void 0:c.toLowerCase())==="autorizada"||((l=a.status)==null?void 0:l.toLowerCase())==="emitida danfe")&&e.jsx("button",{onClick:()=>b(a),className:"text-red-600 hover:text-red-900 p-1 hover:bg-red-50 rounded",title:"Cancelar NF-e",children:e.jsx(v,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>H(a.venda_id,a.numero),className:"text-gray-600 hover:text-gray-900 p-1 hover:bg-gray-50 rounded",title:"Excluir nota do sistema",children:e.jsx(Y,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>L(a.id,a.numero),className:"text-blue-600 hover:text-blue-900 p-1 hover:bg-blue-50 rounded",title:"Baixar DANFE",children:e.jsx(X,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>A(a.id,a.numero),className:"text-green-600 hover:text-green-900 p-1 hover:bg-green-50 rounded",title:"Baixar XML",children:e.jsx(M,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>F(a),className:"text-gray-600 hover:text-gray-900 p-1 hover:bg-gray-50 rounded",title:"Ver Detalhes",children:e.jsx(ee,{className:"w-5 h-5"})})]})})]},a.id)})})]})}),!w&&h.length>0&&e.jsxs("div",{className:"mt-4 text-sm text-gray-600 text-center",children:[h.length," ",h.length===1?"nota encontrada":"notas encontradas"]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto m-4",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800",children:["Detalhes da Nota Fiscal #",r.numero]}),e.jsx("button",{onClick:()=>F(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(U,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Número"}),e.jsx("p",{className:"text-gray-900",children:r.numero})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Série"}),e.jsx("p",{className:"text-gray-900",children:r.serie})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Modelo"}),e.jsx("p",{className:"text-gray-900",children:r.modelo})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Tipo"}),e.jsx("p",{className:"text-gray-900",children:r.tipo==="nfe"?"NF-e":"NFC-e"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Chave de Acesso"}),e.jsx("p",{className:"text-gray-900 text-xs break-all",children:r.chave||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Cliente"}),e.jsx("p",{className:"text-gray-900",children:(B=r.cliente)==null?void 0:B.nome})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"CPF/CNPJ"}),e.jsx("p",{className:"text-gray-900",children:(_=r.cliente)==null?void 0:_.cpf_cnpj})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Valor Total"}),e.jsxs("p",{className:"text-gray-900 text-lg font-bold",children:["R$ ",r.valor.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Situação"}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium ${D(r.status)}`,children:[$(r.status),r.status]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{onClick:()=>L(r.id,r.numero),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(X,{className:"w-5 h-5"}),"Baixar DANFE"]}),e.jsxs("button",{onClick:()=>A(r.id,r.numero),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[e.jsx(M,{className:"w-5 h-5"}),"Baixar XML"]})]})]})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full m-4",children:[e.jsxs("div",{className:"bg-red-50 border-b px-6 py-4 flex items-center gap-3",children:[e.jsx(v,{className:"w-6 h-6 text-red-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Cancelar Nota Fiscal"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Atenção:"})," O cancelamento de uma nota fiscal é irreversível e será enviado para a SEFAZ."]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Nota:"})," #",u.numero," - Série ",u.serie]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Cliente:"})," ",(R=u.cliente)==null?void 0:R.nome]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Justificativa do Cancelamento *"}),e.jsx("textarea",{value:d,onChange:a=>j(a.target.value),placeholder:"Digite o motivo do cancelamento (mínimo 15 caracteres)",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[d.length,"/15 caracteres"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{b(null),j("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",disabled:f,children:"Voltar"}),e.jsx("button",{onClick:q,disabled:f||d.length<15,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Cancelando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-5 h-5"}),"Confirmar Cancelamento"]})})]})]})]})})]})}export{ce as default};
