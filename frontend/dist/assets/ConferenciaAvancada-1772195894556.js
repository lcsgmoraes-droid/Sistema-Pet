import{ah as re,S as le,r as t,j as e}from"./vendor-react-1772195894556.js";import{a as m}from"./index-1772195894556.js";const me=()=>{const{funcionario_id:u}=re(),q=le(),[Q,g]=t.useState(!0),[de,b]=t.useState(null),[j,H]=t.useState(null),[i,S]=t.useState([]),[x,w]=t.useState(null),[n,P]=t.useState(null),[J,K]=t.useState([]),[ne,ie]=t.useState([]),[U,W]=t.useState([]),[y,$]=t.useState(""),[f,C]=t.useState(""),[R,k]=t.useState(""),[D,E]=t.useState(""),[X,v]=t.useState(!1),[l,p]=t.useState(new Set),[d,z]=t.useState(""),[T,I]=t.useState("nao_informado"),[V,O]=t.useState(new Date().toISOString().split("T")[0]),[A,L]=t.useState(""),[N,B]=t.useState(!1),[G,h]=t.useState(null);t.useEffect(()=>{F()},[u]);const F=async()=>{var a,r;try{g(!0),b(null);const s=await m.get(`/comissoes/conferencia-avancada/${u}`);s.data.success&&(H(s.data.funcionario),S(s.data.comissoes),w(s.data.resumo),P(s.data.periodo_selecionado));const o=await m.get("/comissoes/formas-pagamento");o.data.success&&W(o.data.formas);const _=await m.get("/produtos/categorias");_.data.data&&K(_.data.data)}catch(s){b(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.detail)||"Erro ao carregar dados"),console.error("Erro:",s)}finally{g(!1)}},Y=async()=>{var a,r;try{g(!0);const s={grupo_produto:y?parseInt(y):void 0,produto_id:f?parseInt(f):void 0,data_inicio:R||void 0,data_fim:D||void 0},o=await m.get(`/comissoes/conferencia-avancada/${u}`,{params:Object.fromEntries(Object.entries(s).filter(([_,oe])=>oe!==void 0))});o.data.success&&(S(o.data.comissoes),w(o.data.resumo),P(o.data.periodo_selecionado))}catch(s){b(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.detail)||"Erro ao aplicar filtros")}finally{g(!1)}},Z=()=>{$(""),C(""),k(""),E(""),setTimeout(()=>F(),100)},ee=a=>{const r=new Set(l);r.has(a)?r.delete(a):r.add(a),p(r)},ae=()=>{l.size===i.length?p(new Set):p(new Set(i.map(a=>a.id)))},te=()=>{if(l.size===0){alert("Selecione pelo menos uma comissão");return}O(new Date().toISOString().split("T")[0]),z(""),I("nao_informado"),L(""),h(null),v(!0)},se=async()=>{var a,r;try{if(!d||parseFloat(d)<=0){h("Valor a pagar deve ser maior que zero");return}B(!0),h(null);const s={comissoes_ids:Array.from(l),valor_pago:parseFloat(d),forma_pagamento:T,data_pagamento:V,observacoes:A||null},o=await m.post("/comissoes/fechar-com-pagamento",s);o.data.success&&(alert(`✅ Fechamento realizado com sucesso!

Processadas: ${o.data.total_processadas}
Valor total: R$ ${o.data.valor_total_fechado.toFixed(2)}
Valor pago: R$ ${o.data.valor_total_pago.toFixed(2)}
Saldo restante: R$ ${o.data.saldo_total_restante.toFixed(2)}
Comissões com saldo: ${o.data.comissoes_com_saldo}`),v(!1),p(new Set),F())}catch(s){h(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.detail)||"Erro ao fechar comissões")}finally{B(!1)}};if(Q)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})});const c=Array.from(l).reduce((a,r)=>{const s=i.find(o=>o.id===r);return a+(s?s.valor_comissao:0)},0),M=c-(parseFloat(d)||0);return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Conferência de Comissões"}),e.jsx("p",{className:"text-gray-600 mt-1",children:j?`${j.nome} (ID: ${j.id})`:"Carregando..."})]}),e.jsx("button",{onClick:()=>q("/comissoes/abertas"),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"← Voltar"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Filtros Avançados"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Grupo de Produto"}),e.jsxs("select",{value:y,onChange:a=>$(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"",children:"Todos"}),J.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Produto"}),e.jsx("input",{type:"text",placeholder:"Buscar produto...",value:f,onChange:a=>C(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Início"}),e.jsx("input",{type:"date",value:R,onChange:a=>k(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Fim"}),e.jsx("input",{type:"date",value:D,onChange:a=>E(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:Y,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Aplicar Filtros"}),e.jsx("button",{onClick:Z,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Limpar"})]})]}),n&&x&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 mb-6 border border-blue-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Período Selecionado"}),e.jsx("p",{className:"text-gray-600",children:n.data_inicio&&n.data_fim?`${new Date(n.data_inicio).toLocaleDateString("pt-BR")} até ${new Date(n.data_fim).toLocaleDateString("pt-BR")}`:"Sem período específico"}),n.grupo_produto_nome&&e.jsxs("p",{className:"text-gray-600 text-sm",children:["Grupo: ",n.grupo_produto_nome]}),n.produto_nome&&e.jsxs("p",{className:"text-gray-600 text-sm",children:["Produto: ",n.produto_nome]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Resumo do Período"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Quantidade"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:x.quantidade_comissoes})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["R$ ",x.valor_total.toFixed(2)]})]}),x.valor_pago_total>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pago"}),e.jsxs("p",{className:"text-lg font-semibold text-blue-600",children:["R$ ",x.valor_pago_total.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Saldo"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["R$ ",x.saldo_restante_total.toFixed(2)]})]})]})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden mb-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:l.size===i.length&&i.length>0,onChange:ae})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Quantidade"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Base"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"%"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Pago"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Saldo"})]})}),e.jsx("tbody",{children:i.map(a=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:l.has(a.id),onChange:()=>ee(a.id)})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(a.data_venda).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"px-4 py-3 text-sm",children:a.nome_produto}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:a.cliente_nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:a.quantidade.toFixed(2)}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right",children:["R$ ",a.valor_base_calculo.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right",children:[a.percentual_comissao.toFixed(2),"%"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right font-semibold text-green-600",children:["R$ ",a.valor_comissao.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-blue-600",children:a.valor_pago?`R$ ${a.valor_pago.toFixed(2)}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-orange-600",children:a.saldo_restante?`R$ ${a.saldo_restante.toFixed(2)}`:"-"})]},a.id))})]})})}),e.jsx("div",{className:"bg-gray-900 text-white rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-300",children:[l.size," de ",i.length," comissões selecionadas"]})}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Total Selecionado"}),e.jsxs("p",{className:"text-2xl font-bold text-green-400",children:["R$ ",c.toFixed(2)]})]}),parseFloat(d)>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Será Pago"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-400",children:["R$ ",parseFloat(d).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Saldo Restante"}),e.jsxs("p",{className:`text-2xl font-bold ${M>0?"text-orange-400":"text-green-400"}`,children:["R$ ",M.toFixed(2)]})]})]}),e.jsx("button",{onClick:te,disabled:l.size===0,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-500 rounded-lg font-semibold transition",children:"Fechar e Pagar"})]})]})}),X&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-2xl p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Fechamento com Pagamento"}),G&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:G}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded border border-blue-200",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Comissões a processar: ",l.size]}),e.jsxs("p",{className:"text-lg font-bold text-gray-800",children:["Valor Total: R$ ",c.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de Pagamento *"}),e.jsx("select",{value:T,onChange:a=>I(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:U.map(a=>e.jsx("option",{value:a.nome,children:a.descricao},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor a Pagar *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"flex items-center bg-gray-100 px-3 py-2 rounded-lg border border-gray-300",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:c,value:d,onChange:a=>z(a.target.value),placeholder:"0.00",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Máximo: R$ ",c.toFixed(2),parseFloat(d)<c&&parseFloat(d)>0&&e.jsxs("span",{className:"text-orange-600 font-semibold ml-2",children:["(Pagamento Parcial - Saldo: R$ ",(c-parseFloat(d)).toFixed(2),")"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data de Pagamento *"}),e.jsx("input",{type:"date",value:V,onChange:a=>O(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observações"}),e.jsx("textarea",{value:A,onChange:a=>L(a.target.value),placeholder:"Observações opcionais...",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>v(!1),disabled:N,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:se,disabled:N,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:N?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"⏳"}),"Processando..."]}):"Confirmar Fechamento"})]})]})})]})};export{me as default};
