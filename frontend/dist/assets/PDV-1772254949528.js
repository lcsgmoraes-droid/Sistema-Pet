import{j as e,r,an as pa,aw as Aa,ax as Ye,X as ue,ay as ba,az as Ca,aA as _e,aB as ht,aC as ft,aD as jt,aE as ea,aF as na,C as ua,aG as ha,ak as Fa,aH as As,aI as Ts,al as ga,aJ as vt,z as De,am as yt,d as Ia,aK as qa,aL as _s,aM as Cs,aN as Nt,aO as wt,aP as Ze,aQ as Va,aR as Fs,aS as _t,Z as Ta,T as oa,as as Ct,U as Ft,aT as St,a0 as kt,p as Ps,o as $t,h as Et,l as Rt,aU as Dt,e as Ma,aV as At,a5 as Tt,aW as Pt,B as Vt,y as Mt,$ as It,R as qt,a3 as Ss,ap as zt,L as Ot,aX as _a,aY as Vs,S as Lt,ai as Bt,aZ as Kt,a_ as ks,a$ as $s,b0 as Es,b1 as Na,aj as Qt,b2 as Ut,b3 as Pa,b4 as Ht,b5 as Jt,b6 as Gt}from"./vendor-react-1772254949528.js";import{a as P,e as Xt,u as Wt}from"./index-1772254949528.js";import{A as Zt}from"./produtos-17722549495282.js";import{v as Yt}from"./alertasEstoque-17722549495282.js";import{a as er,b as za,o as Ms,f as ar,c as sr}from"./caixa-1772254949528.js";const Rs=async(i={})=>(await P.get("/vendas",{params:i})).data,wa=async i=>(await P.get(`/vendas/${i}`)).data,Is=async i=>(await P.post("/vendas",i)).data,tr=async(i,y)=>(await P.post(`/vendas/${i}/finalizar`,{pagamentos:y})).data,rr=async(i={})=>{const y=await P.get("/clientes/",{params:i});return y.data.items||y.data.clientes||y.data||[]},ma=async i=>(await P.get(`/clientes/${i}`)).data,or=({status:i,className:y=""})=>{if(!i)return null;const c={verde:{cor:"bg-green-500",borda:"border-green-500",texto:"text-green-700",fundo:"bg-green-50",icone:"‚úÖ",mensagem:"Margem Saud√°vel",descricao:"Venda em condi√ß√µes ideais"},amarelo:{cor:"bg-yellow-500",borda:"border-yellow-500",texto:"text-yellow-700",fundo:"bg-yellow-50",icone:"‚ö†Ô∏è",mensagem:"Margem em Alerta",descricao:"Aten√ß√£o com parcelamento e descontos"},vermelho:{cor:"bg-red-500",borda:"border-red-500",texto:"text-red-700",fundo:"bg-red-50",icone:"üî¥",mensagem:"Margem Cr√≠tica",descricao:"Evite mais descontos ou parcelamentos longos"}},u=c[i]||c.verde;return e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg border ${u.borda} ${u.fundo} ${y}`,children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${u.cor} animate-pulse`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`text-sm font-semibold ${u.texto}`,children:[u.icone," ",u.mensagem]}),e.jsx("div",{className:"text-xs text-gray-600",children:u.descricao})]})]})},nr=(i,y)=>{const c=(i||y||"").toLowerCase();return c.includes("pix")?e.jsx(ht,{className:"w-6 h-6"}):c.includes("dinheiro")||c.includes("cash")?e.jsx(ft,{className:"w-6 h-6"}):c.includes("debito")||c.includes("d√©bito")?e.jsx(Ye,{className:"w-6 h-6"}):c.includes("parcelado")?e.jsx(Ye,{className:"w-6 h-6"}):c.includes("credito")||c.includes("cr√©dito")?e.jsx(Ye,{className:"w-6 h-6"}):c.includes("transfer")||c.includes("banc")?e.jsx(jt,{className:"w-6 h-6"}):c.includes("boleto")?e.jsx(ea,{className:"w-6 h-6"}):c.includes("wallet")||c.includes("carteira")?e.jsx(ba,{className:"w-6 h-6"}):e.jsx(Ye,{className:"w-6 h-6"})},lr=["Visa","Mastercard","Elo","American Express","Hipercard","Outros"];function ir({venda:i,onClose:y,onConfirmar:c,onVendaAtualizada:u,onAnalisarVenda:s}){var Je;const[g,_]=r.useState([]),[x,b]=r.useState([]),[N,H]=r.useState([]),[h,M]=r.useState([]),[S,k]=r.useState(null),[t,q]=r.useState(null),[E,U]=r.useState(""),[te,w]=r.useState(""),[F,I]=r.useState(1),[Q,R]=r.useState(""),[oe,le]=r.useState(!1),[ce,j]=r.useState(!1),[J,G]=r.useState(""),[z,ne]=r.useState(0),[Ne,v]=r.useState(!1),[W,xe]=r.useState(null),[be,$e]=r.useState(null),[Oe,m]=r.useState(!1),[V,O]=r.useState(""),[D,A]=r.useState(""),[$,he]=r.useState({}),[de,we]=r.useState(!1),[me,fe]=r.useState(null),ke=r.useRef(null);r.useEffect(()=>{(async()=>{try{const f=await P.get("/financeiro/formas-pagamento");H(f.data)}catch(f){console.error("Erro ao carregar formas:",f)}})()},[]),r.useEffect(()=>{(async()=>{try{const f=await P.get("/operadoras-cartao?apenas_ativas=true");M(f.data);const C=f.data.find(B=>B.padrao);C&&k(C)}catch(f){console.error("Erro ao carregar operadoras:",f)}})()},[]),r.useEffect(()=>{(async()=>{var f;if(i.id){j(!0);try{const C=await P.get(`/vendas/${i.id}/pagamentos`);b(C.data.pagamentos||[]),ne(C.data.total_pago||0)}catch(C){console.error("Erro ao buscar pagamentos:",C),((f=C.response)==null?void 0:f.status)!==404&&G("Erro ao carregar pagamentos existentes")}finally{j(!1)}}})()},[i.id,i.status]),r.useEffect(()=>{t!=null&&t.permite_parcelamento&&ke.current&&setTimeout(()=>{var l;(l=ke.current)==null||l.scrollIntoView({behavior:"smooth",block:"nearest"})},100)},[t==null?void 0:t.permite_parcelamento]);const Ee=i.total,Te=g.reduce((l,f)=>l+f.valor,0)+z,ee=Ee-Te,ve=Q?parseFloat(Q)-ee:0,la=async()=>{var l,f,C;m(!0);try{const B=[{forma_pagamento_id:1,valor:i.total,parcelas:1}],Y=(i.itens||[]).map(ie=>({produto_id:ie.produto_id,quantidade:ie.quantidade,preco_venda:ie.preco_unitario||ie.preco_venda||0,custo:ie.custo||null})),Z=await P.post("/formas-pagamento/analisar-venda",{items:Y,formas_pagamento:B,desconto:i.desconto_valor||0,taxa_entrega:((l=i.entrega)==null?void 0:l.taxa_entrega_total)||0});(C=(f=Z.data)==null?void 0:f.resultado)!=null&&C.cor_indicador&&($e(Z.data.resultado.cor_indicador),console.log("‚úÖ Status inicial calculado:",Z.data.resultado.cor_indicador))}catch(B){console.error("‚ùå Erro ao calcular status inicial:",B),$e(null)}finally{m(!1)}},fa=async()=>{var l,f,C;if(!(g.length===0&&x.length===0)){m(!0);try{const B=[...x,...g],Y=(i.itens||[]).map(ie=>({produto_id:ie.produto_id,quantidade:ie.quantidade,preco_venda:ie.preco_unitario||ie.preco_venda||0,custo:ie.custo||null})),Z=await P.post("/formas-pagamento/analisar-venda",{items:Y,formas_pagamento:B,desconto:i.desconto_valor||0,taxa_entrega:((l=i.entrega)==null?void 0:l.taxa_entrega_total)||0});(C=(f=Z.data)==null?void 0:f.resultado)!=null&&C.cor_indicador&&$e(Z.data.resultado.cor_indicador)}catch(B){console.error("Erro ao calcular status de margem:",B),$e(null)}finally{m(!1)}}};r.useEffect(()=>{const l=setTimeout(()=>{fa()},500);return()=>clearTimeout(l)},[g,F]),r.useEffect(()=>{console.log("üé¨ Modal de pagamento aberto - Calculando status inicial..."),la()},[]),r.useEffect(()=>{if(N&&N.length>0){const l=N.filter(f=>f.permite_parcelamento);l.length>0&&Object.keys($).length===0&&(console.log("üìä Simulando parcelamentos ao carregar formas..."),ja(l[0]))}},[N]);const ja=async l=>{var B,Y,Z;if(!l||!l.permite_parcelamento){console.log("‚è≠Ô∏è Forma de pagamento inv√°lida ou n√£o permite parcelamento");return}const f=(l==null?void 0:l.parcelas_maximas)??12,C=l.id;console.log(`üé≤ Simulando parcelamentos para ${l.nome} (at√© ${f}x)...`),we(!0);try{const ie={},Le=(i.itens||[]).map(ge=>({produto_id:ge.produto_id,quantidade:ge.quantidade,preco_venda:ge.preco_unitario||ge.preco_venda||0,custo:ge.custo||null}));for(let ge=1;ge<=f;ge++){const Se=[{forma_pagamento_id:C,valor:i.total,parcelas:ge}];try{const je=await P.post("/formas-pagamento/analisar-venda",{items:Le,formas_pagamento:Se,desconto:i.desconto_valor||0,taxa_entrega:((B=i.entrega)==null?void 0:B.taxa_entrega_total)||0});(Z=(Y=je.data)==null?void 0:Y.resultado)!=null&&Z.cor_indicador&&(ie[ge]={cor:je.data.resultado.cor_indicador,classificacao:je.data.resultado.cor_indicador})}catch(je){console.error(`Erro ao simular ${ge}x:`,je),ie[ge]={cor:null,classificacao:"verde"}}}he(ge=>({...ge,[C]:ie}));const Ae=Pe(ie,f);fe(Ae),console.log("‚úÖ Simula√ß√µes conclu√≠das:",ie),console.log("üìä Faixas calculadas:",Ae)}catch(ie){console.error("‚ùå Erro ao simular parcelamentos:",ie)}finally{we(!1)}},Pe=(l,f)=>{const C={saudavel:{min:1,max:0},alerta:{min:0,max:0},proibido:{min:0,max:f}};let B=0,Y=f+1;for(let Z=1;Z<=f;Z++){const ie=l[Z];ie&&(ie.cor==="verde"?B=Z:ie.cor==="vermelho"&&Z<Y&&(Y=Z))}return C.saudavel.max=B,C.alerta.min=B+1,C.alerta.max=Y-1,C.proibido.min=Y,C};r.useEffect(()=>{if(t!=null&&t.permite_parcelamento)if(!$[t.id])ja(t);else{const l=$[t.id],f=Pe(l,(t==null?void 0:t.parcelas_maximas)??12);fe(f),console.log("‚ôªÔ∏è Reutilizando simula√ß√£o existente")}else if(!t){const l=Object.keys($)[0];if(l&&N.length>0){const f=N.find(C=>C.id===parseInt(l));if(f){const C=Pe($[l],(f==null?void 0:f.parcelas_maximas)??12);fe(C)}}}},[t==null?void 0:t.id]);const L=()=>{var Y;if(!t){G("Selecione uma forma de pagamento");return}const l=parseFloat(Q)||0;if(l<=0){G("Informe o valor recebido");return}if(t.id==="credito_cliente"&&l>t.credito_disponivel){G(`Valor excede o cr√©dito dispon√≠vel (R$ ${t.credito_disponivel.toFixed(2)})`);return}if(["cartao_credito","cartao_debito"].includes(t.tipo)&&!E){G("Selecione a bandeira do cart√£o");return}if(["cartao_credito","cartao_debito"].includes(t.tipo)&&!S){G("Selecione a operadora do cart√£o");return}if(S&&F>S.max_parcelas){G(`A operadora ${S.nome} permite no m√°ximo ${S.max_parcelas}x`);return}console.log("üîç DEBUG formaPagamentoSelecionada:",t);const f={forma_pagamento:t.nome,forma_id:t.id,forma_pagamento_id:t.id,nome:t.nome,valor:Math.min(l,ee),bandeira:["cartao_credito","cartao_debito"].includes(t.tipo)?E:null,nsu_cartao:["cartao_credito","cartao_debito"].includes(t.tipo)&&te?te:null,operadora_id:(S==null?void 0:S.id)||null,numero_parcelas:t.permite_parcelamento?F:1,parcelas:t.permite_parcelamento?F:1,valor_recebido:l,troco:t.tipo==="dinheiro"&&ve>0?ve:null,is_credito_cliente:t.nome==="Cr√©dito Cliente"||t.tipo==="credito_cliente"};console.log("üì§ DEBUG novoPagamento:",f);let C="verde";if(t!=null&&t.permite_parcelamento&&$[t.id]){const Z=(Y=$[t.id])==null?void 0:Y[F];C=(Z==null?void 0:Z.cor)??"verde",console.log(`‚ôªÔ∏è Reutilizando simula√ß√£o do backend: ${F}x = cor ${C}`)}if(be==="vermelho"||C==="vermelho"){if(!V||V.trim().length<10){A("‚ö†Ô∏è Justificativa obrigat√≥ria para margem cr√≠tica (m√≠nimo 10 caracteres)"),G("Por favor, preencha a justificativa abaixo");return}const Z=i.observacoes?`${i.observacoes}

‚ö†Ô∏è JUSTIFICATIVA (Margem Cr√≠tica): ${V}`:`‚ö†Ô∏è JUSTIFICATIVA (Margem Cr√≠tica): ${V}`;i.observacoes=Z}_([...g,f]),q(null),R(""),U(""),k(h.find(Z=>Z.padrao)||null),w(""),I(1),G(""),A("")},Ve=l=>{_(g.filter((f,C)=>C!==l))},Sa=async l=>{var f,C;if(confirm("Deseja realmente excluir este pagamento?")){le(!0),G("");try{console.log(`üóëÔ∏è Excluindo pagamento ID ${l}...`),await P.delete(`/vendas/pagamentos/${l}`),console.log("‚úÖ Pagamento exclu√≠do com sucesso!");const B=await P.get(`/vendas/${i.id}/pagamentos`);b(B.data.pagamentos||[]),ne(B.data.total_pago||0),B.data.pagamentos.length===0&&u&&await u(),G("")}catch(B){console.error("‚ùå Erro ao excluir pagamento:",B),console.error("   Response:",B.response),console.error("   Message:",B.message),B.message&&B.message.includes("CORS")?G("‚ö†Ô∏è Erro de CORS: O backend precisa ser reiniciado. Feche e abra novamente o servidor backend."):G(((C=(f=B.response)==null?void 0:f.data)==null?void 0:C.detail)||B.message||"Erro ao excluir pagamento")}finally{le(!1)}}},aa=async()=>{var l,f,C,B,Y,Z,ie,Le;if(g.length===0){G("Adicione pelo menos uma forma de pagamento");return}le(!0),G("");try{const Ae=i.itens.filter(je=>je.tipo==="produto"&&je.produto_id).map(je=>({produto_id:je.produto_id,quantidade:je.quantidade}));if(Ae.length>0){const Be=(await Yt(Ae)).data||[];if(Be.length>0){const ia=Be.map(Re=>`‚Ä¢ ${Re.produto_nome}: estoque atual ${Re.estoque_atual}, ap√≥s venda ficar√° ${Re.estoque_resultante}`).join(`
`);if(!window.confirm(`‚ö†Ô∏è ATEN√á√ÉO: Os seguintes produtos ficar√£o com ESTOQUE NEGATIVO:

${ia}

Deseja continuar mesmo assim?`)){le(!1);return}}}let ge=i.id;if(!ge){const je=((l=i.entrega)==null?void 0:l.taxa_entrega_total)||0,Be=((f=i.entrega)==null?void 0:f.taxa_loja)||0,ia=((C=i.entrega)==null?void 0:C.taxa_entregador)||0,re=je>0?(Be/je*100).toFixed(2):100,Re=je>0?(ia/je*100).toFixed(2):0;ge=(await Is({cliente_id:(B=i.cliente)==null?void 0:B.id,funcionario_id:i.funcionario_id,itens:i.itens,desconto_valor:i.desconto_valor,desconto_percentual:i.desconto_percentual,observacoes:i.observacoes,tem_entrega:i.tem_entrega,taxa_entrega:je,percentual_taxa_loja:parseFloat(re),percentual_taxa_entregador:parseFloat(Re),entregador_id:i.entregador_id,endereco_entrega:(Y=i.entrega)==null?void 0:Y.endereco_completo,observacoes_entrega:(Z=i.entrega)==null?void 0:Z.observacoes_entrega})).id}const Se=await tr(ge,g);xe(ge),(Se==null?void 0:Se.status)==="finalizada"||(Se==null?void 0:Se.status)==="pago_nf"?v(!0):c()}catch(Ae){console.error("Erro ao finalizar venda:",Ae),G(((Le=(ie=Ae.response)==null?void 0:ie.data)==null?void 0:Le.detail)||"Erro ao finalizar venda")}finally{le(!1)}},Me=async l=>{var f,C;le(!0),G("");try{await P.post("/nfe/emitir",{venda_id:W,tipo_nota:l}),alert(`${l==="nfe"?"NF-e":"NFC-e"} emitida com sucesso!`),c()}catch(B){console.error("Erro ao emitir nota:",B),alert(((C=(f=B.response)==null?void 0:f.data)==null?void 0:C.detail)||"Erro ao emitir nota fiscal. Voc√™ pode emiti-la depois na tela de vendas."),c()}finally{le(!1)}};return Ne?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(pa,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Venda Finalizada!"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Deseja emitir nota fiscal?"})]})]}),e.jsxs("div",{className:"space-y-3",children:[(Je=i.cliente)!=null&&Je.cnpj?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>Me("nfe"),disabled:oe,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(Aa,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NF-e (Empresa)"})]}),e.jsxs("button",{onClick:()=>Me("nfce"),disabled:oe,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(Aa,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NFC-e (Cupom)"})]})]}):e.jsxs("button",{onClick:()=>Me("nfce"),disabled:oe,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(Aa,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NFC-e"})]}),e.jsx("button",{onClick:c,disabled:oe,className:"w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"N√£o emitir agora"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-4",children:"Voc√™ pode emitir a nota fiscal depois na tela de vendas"})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Ye,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Registrar Recebimento"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Selecione as formas de pagamento"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!1,e.jsx("button",{onClick:y,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Selecione a forma de pagamento"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.cliente&&i.cliente.credito>0&&e.jsxs("button",{onClick:()=>{q({id:"credito_cliente",nome:"Cr√©dito Cliente",tipo:"credito_cliente",icone:"üéÅ",credito_disponivel:parseFloat(i.cliente.credito)}),I(1),U(""),w(""),R(Math.min(parseFloat(i.cliente.credito),ee).toFixed(2))},className:`p-4 rounded-lg border-2 transition-all ${(t==null?void 0:t.id)==="credito_cliente"?"border-purple-500 bg-purple-50":"border-purple-200 bg-purple-50/50 hover:border-purple-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:"üéÅ"}),e.jsx("div",{className:`text-sm font-medium ${(t==null?void 0:t.id)==="credito_cliente"?"text-purple-900":"text-purple-700"}`,children:"Cr√©dito Cliente"}),e.jsxs("div",{className:"text-xs text-purple-600 mt-1 font-semibold",children:["R$ ",parseFloat(i.cliente.credito).toFixed(2).replace(".",",")]})]}),N.map(l=>{const f=(t==null?void 0:t.id)===l.id;return e.jsxs("button",{onClick:()=>{q(l),I(1),U(""),w("")},className:`p-4 rounded-lg border-2 transition-all ${f?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"flex justify-center mb-1 text-gray-500",children:nr(l.icone,l.nome)}),e.jsx("div",{className:`text-sm font-medium ${f?"text-blue-900":"text-gray-700"}`,children:l.nome}),l.taxa_percentual>0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Taxa: ",l.taxa_percentual,"%"]})]},l.id)})]})]}),t&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[t.id==="credito_cliente"&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-800 mb-2",children:[e.jsx(ba,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"Cr√©dito Dispon√≠vel"})]}),e.jsxs("div",{className:"text-lg font-bold text-purple-600",children:["R$ ",t.credito_disponivel.toFixed(2).replace(".",",")]}),e.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"üí° N√£o gera movimenta√ß√£o de caixa"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t.id==="credito_cliente"?"Valor a Utilizar":"Valor Recebido"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:Q,onChange:l=>{R(l.target.value)},onBlur:l=>{const f=parseFloat(l.target.value)||0;if(t.id==="credito_cliente"){const C=Math.min(t.credito_disponivel,ee);f>C&&(R(C.toFixed(2)),G(`Valor ajustado para o cr√©dito dispon√≠vel: R$ ${C.toFixed(2)}`),setTimeout(()=>G(""),3e3))}},placeholder:ee.toFixed(2),max:t.id==="credito_cliente"?Math.min(t.credito_disponivel,ee):void 0,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]}),t.id==="credito_cliente"&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["M√°ximo: R$ ",Math.min(t.credito_disponivel,ee).toFixed(2)]})]}),t.tipo==="dinheiro"&&Q&&e.jsx("div",{className:`rounded-lg p-3 ${ve>0?"bg-yellow-50 border border-yellow-200":"bg-gray-100"}`,children:e.jsx("div",{className:"text-sm font-medium",children:e.jsxs("span",{className:ve>0?"text-yellow-800":"text-gray-600",children:["Troco: R$ ",ve.toFixed(2)]})})}),(t==null?void 0:t.tipo)&&["cartao_credito","cartao_debito"].includes(t.tipo)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Operadora *"}),e.jsxs("select",{value:(S==null?void 0:S.id)||"",onChange:l=>{const f=h.find(C=>C.id===parseInt(l.target.value));k(f),f&&F>f.max_parcelas&&I(f.max_parcelas)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione a operadora..."}),h.map(l=>e.jsxs("option",{value:l.id,children:[l.nome," (",l.max_parcelas,"x m√°x)"]},l.id))]}),S&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["M√°ximo de ",S.max_parcelas," parcelas"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bandeira"}),e.jsxs("select",{value:E,onChange:l=>U(l.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),lr.map(l=>e.jsx("option",{value:l,children:l},l))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["NSU (N√∫mero Sequencial √önico)",e.jsx("span",{className:"text-gray-500 text-xs ml-1",children:"(Opcional - para concilia√ß√£o)"})]}),e.jsx("input",{type:"text",value:te,onChange:l=>w(l.target.value),placeholder:"Ex: 123456789",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),(t==null?void 0:t.permite_parcelamento)&&e.jsxs("div",{ref:ke,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"N√∫mero de Parcelas"}),e.jsx("select",{value:F,onChange:l=>I(parseInt(l.target.value)),className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${(()=>{var C;const l=(C=$[t.id])==null?void 0:C[F],f=(l==null?void 0:l.cor)||be||"verde";return f==="verde"?"border-gray-300 bg-white":f==="amarelo"?"border-yellow-400 bg-yellow-50 text-yellow-900":"border-red-400 bg-red-50 text-red-900"})()}`,children:Array.from({length:(S==null?void 0:S.max_parcelas)||t.parcelas_maximas||12},(l,f)=>f+1).map(l=>{var Z;const f=parseFloat(Q)||ee,C=f/l,B=(Z=$[t.id])==null?void 0:Z[l],Y=(B==null?void 0:B.cor)||"verde";return e.jsxs("option",{value:l,className:Y==="verde"?"":Y==="amarelo"?"bg-yellow-100 text-yellow-900":"bg-red-100 text-red-900",children:[Y==="vermelho"?"üö´ ":Y==="amarelo"?"‚ö†Ô∏è ":"",l,"x de R$ ",C.toFixed(2)," ",Q?`(Total: R$ ${f.toFixed(2)})`:""]},l)})}),Q&&F>1&&e.jsxs("div",{className:`mt-2 p-3 border rounded-lg ${(()=>{var C;const l=(C=$[t.id])==null?void 0:C[F],f=(l==null?void 0:l.cor)||be||"verde";return f==="verde"?"bg-blue-50 border-blue-200":f==="amarelo"?"bg-yellow-50 border-yellow-300":"bg-red-50 border-red-300"})()}`,children:[e.jsx("p",{className:`text-sm font-medium ${(()=>{var C;const l=(C=$[t.id])==null?void 0:C[F],f=(l==null?void 0:l.cor)||be||"verde";return f==="verde"?"text-blue-800":f==="amarelo"?"text-yellow-800":"text-red-800"})()}`,children:(()=>{var C;const l=(C=$[t.id])==null?void 0:C[F],f=(l==null?void 0:l.cor)||be||"verde";return e.jsxs(e.Fragment,{children:[f==="vermelho"&&"üö´ ",f==="amarelo"&&"‚ö†Ô∏è ","üí≥ ",F,"x de R$ ",(parseFloat(Q)/F).toFixed(2)]})})()}),e.jsxs("p",{className:`text-xs mt-1 ${(()=>{var C;const l=(C=$[t.id])==null?void 0:C[F],f=(l==null?void 0:l.cor)||be||"verde";return f==="verde"?"text-blue-600":f==="amarelo"?"text-yellow-700":"text-red-700"})()}`,children:["Valor total parcelado: R$ ",parseFloat(Q).toFixed(2),(()=>{var C;const l=(C=$[t.id])==null?void 0:C[F],f=(l==null?void 0:l.cor)||be||"verde";return f==="amarelo"?" - Requer aten√ß√£o":f==="vermelho"?" - Requer justificativa":""})()]})]})]}),e.jsx("button",{onClick:L,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Adicionar Pagamento"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Resumo da Venda"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total da Venda:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",Ee.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Valor Pago:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",Te.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-blue-600 text-lg font-semibold border-t pt-3",children:[e.jsx("span",{children:"Restante:"}),e.jsxs("span",{children:["R$ ",ee.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Formas de Pagamento"}),x.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-600 mb-2",children:["üí∞ Pagamentos Registrados (",x.length,")"]}),e.jsx("div",{className:"space-y-2",children:x.map((l,f)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:l.forma_pagamento==="dinheiro"?"üíµ Dinheiro":l.forma_pagamento==="pix"?"üì± PIX":l.forma_pagamento==="credito"?"üí≥ Cart√£o de Cr√©dito":l.forma_pagamento==="debito"?"üí≥ Cart√£o de D√©bito":l.forma_pagamento==="boleto"?"üìÑ Boleto":l.forma_pagamento}),e.jsxs("span",{className:"px-2 py-0.5 bg-green-200 text-green-800 text-xs rounded-full font-medium",children:["Pagamento ",f+1]})]}),l.bandeira&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Bandeira: ",l.bandeira]}),l.nsu_cartao&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1 font-mono",children:["üî¢ NSU: ",l.nsu_cartao]}),l.numero_parcelas&&l.numero_parcelas>1&&e.jsxs("div",{className:"text-sm text-blue-600 mt-1 font-medium",children:["üî¢ Parcelado em ",l.numero_parcelas,"x de R$ ",(parseFloat(l.valor)/l.numero_parcelas).toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["üìÖ ",new Date(l.data_pagamento).toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-green-700 text-lg",children:["R$ ",parseFloat(l.valor).toFixed(2)]}),l.troco&&parseFloat(l.troco)>0&&e.jsxs("div",{className:"text-xs text-yellow-600",children:["Troco: R$ ",parseFloat(l.troco).toFixed(2)]})]}),e.jsx("button",{onClick:()=>Sa(l.id),disabled:oe,className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors disabled:opacity-50",title:"Excluir pagamento",children:e.jsx(Ca,{className:"w-4 h-4"})})]})]},l.id))})]}),g.length===0&&x.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400 bg-gray-50 rounded-lg border-2 border-dashed",children:[e.jsx(ba,{className:"w-12 h-12 mx-auto mb-2 opacity-40"}),e.jsx("p",{className:"text-sm font-medium",children:"Nenhuma forma de pagamento adicionada"}),e.jsx("p",{className:"text-xs mt-1",children:"Selecione uma forma acima para come√ßar"})]}):g.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 mb-2",children:"‚è≥ Novos Pagamentos (a confirmar)"}),e.jsx("div",{className:"space-y-3",children:g.map((l,f)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:l.nome}),e.jsx("span",{className:"px-2 py-0.5 bg-blue-200 text-blue-800 text-xs rounded-full font-medium",children:"Novo"})]}),l.bandeira&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Bandeira: ",l.bandeira]}),l.nsu_cartao&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1 font-mono",children:["üî¢ NSU: ",l.nsu_cartao]}),l.numero_parcelas>1&&e.jsxs("div",{className:"text-sm text-blue-600 mt-1 font-medium",children:["üî¢ ",l.numero_parcelas,"x de R$ ",(l.valor/l.numero_parcelas).toFixed(2)]}),l.troco&&l.troco>0&&e.jsxs("div",{className:"text-sm text-yellow-600 mt-1",children:["üíµ Troco: R$ ",l.troco.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"font-semibold text-blue-700 text-lg",children:["R$ ",l.valor.toFixed(2)]}),e.jsx("button",{onClick:()=>Ve(f),className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors",title:"Remover",children:e.jsx(ue,{className:"w-5 h-5"})})]})]},f))})]}):null]}),be&&e.jsx(or,{status:be,loading:Oe}),me&&Object.keys($).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center space-x-2",children:[e.jsx("span",{className:"text-xl",children:"üìä"}),e.jsx("span",{children:"Parcelamento Recomendado"})]}),de?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin inline-block w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full"}),e.jsx("p",{className:"text-sm text-blue-700 mt-2",children:"Analisando op√ß√µes..."})]}):e.jsxs("div",{className:"space-y-2",children:[me.saudavel.max>0&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-green-100 border border-green-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"üü¢"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-green-900",children:[me.saudavel.min===me.saudavel.max?`${me.saudavel.max}x`:`${me.saudavel.min}x a ${me.saudavel.max}x`,e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- Saud√°vel"})]}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"Margem adequada, sem restri√ß√µes"})]})]}),me.alerta.max>=me.alerta.min&&me.alerta.min>0&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-yellow-100 border border-yellow-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"üü°"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-yellow-900",children:[me.alerta.min===me.alerta.max?`${me.alerta.max}x`:`${me.alerta.min}x a ${me.alerta.max}x`,e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- Aten√ß√£o"})]}),e.jsx("div",{className:"text-xs text-yellow-700 mt-1",children:"Margem pr√≥xima ao m√≠nimo, evite se poss√≠vel"})]})]}),me.proibido.min<=((t==null?void 0:t.parcelas_maximas)??12)&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-red-100 border border-red-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"üî¥"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-red-900",children:[me.proibido.min,"x ou mais",e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- Exige justificativa"})]}),e.jsx("div",{className:"text-xs text-red-700 mt-1",children:"Margem cr√≠tica, justificativa obrigat√≥ria"})]})]})]})]}),(()=>{var B,Y;let l="verde";return t!=null&&t.permite_parcelamento&&((B=$[t.id])!=null&&B[F])&&(l=((Y=$[t.id][F])==null?void 0:Y.cor)??"verde"),be==="vermelho"||l==="vermelho"||V&&V.trim().length>0?e.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-3",children:[e.jsx(_e,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-red-900",children:"‚ö†Ô∏è Justificativa Obrigat√≥ria"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Esta venda tem margem cr√≠tica. Informe o motivo para prosseguir."})]})]}),e.jsx("textarea",{value:V,onChange:Z=>{O(Z.target.value),Z.target.value.trim().length>=10&&A("")},placeholder:"Ex: Cliente especial, promo√ß√£o de lan√ßamento, acordo comercial...",className:`w-full px-3 py-2 border-2 rounded-lg focus:ring-2 focus:ring-red-500 resize-none ${D?"border-red-500":"border-red-300"}`,rows:3}),D&&e.jsx("p",{className:"text-xs text-red-700 font-medium mt-2",children:D}),e.jsx("p",{className:"text-xs text-red-600 mt-2",children:"üí° M√≠nimo 10 caracteres"})]}):null})()]})]})}),e.jsxs("div",{className:"border-t p-6 bg-gray-50",children:[J&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(_e,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:J})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:y,disabled:oe,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:aa,disabled:oe||g.length===0,className:"flex items-center space-x-2 px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:oe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(pa,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"})]})})]})]})]})})}function dr({onClose:i,onSucesso:y}){const[c,u]=r.useState(""),[s,g]=r.useState(""),[_,x]=r.useState(""),[b,N]=r.useState({n2:0,n5:0,n10:0,n20:0,n50:0,n100:0,n200:0,moedas:0}),[H,h]=r.useState(!1),[M,S]=r.useState(!1),[k,t]=r.useState(""),q=()=>b.n200*200+b.n100*100+b.n50*50+b.n20*20+b.n10*10+b.n5*5+b.n2*2+parseFloat(b.moedas||0),E=()=>{const w=q();u(w.toFixed(2)),h(!1)},U=()=>{N({n2:0,n5:0,n10:0,n20:0,n50:0,n100:0,n200:0,moedas:0})},te=async()=>{var F,I;const w=parseFloat(c);if(!w||w<0){t("Informe um valor v√°lido para abertura");return}S(!0),t("");try{await er({valor_abertura:w,conta_origem_nome:s||"Dinheiro em m√£os",observacoes_abertura:_}),y()}catch(Q){console.error("Erro ao abrir caixa:",Q),t(((I=(F=Q.response)==null?void 0:F.data)==null?void 0:I.detail)||"Erro ao abrir caixa")}finally{S(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(na,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Abrir Caixa"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Informe o valor inicial do caixa"})]})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor de Abertura *"}),e.jsxs("button",{type:"button",onClick:()=>h(!H),className:"flex items-center space-x-1 px-3 py-1.5 text-sm bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 rounded-lg transition-colors",children:[e.jsx(ua,{className:"w-4 h-4"}),e.jsx("span",{children:"Auxiliar Contagem"})]})]}),H&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-xl p-5 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center",children:[e.jsx(ua,{className:"w-5 h-5 mr-2 text-blue-600"}),"Auxiliar de Contagem"]}),e.jsx("button",{onClick:()=>h(!1),className:"p-1 hover:bg-blue-100 rounded-lg transition-colors",type:"button",children:e.jsx(ue,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-gray-200 hover:border-gray-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-gray-500 to-gray-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 2"}),e.jsx("input",{type:"number",min:"0",value:b.n2,onChange:w=>N({...b,n2:parseInt(w.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-gray-500 focus:ring-2 focus:ring-gray-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-gray-600",children:["R$ ",(b.n2*2).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-purple-200 hover:border-purple-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 5"}),e.jsx("input",{type:"number",min:"0",value:b.n5,onChange:w=>N({...b,n5:parseInt(w.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-purple-600",children:["R$ ",(b.n5*5).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-red-200 hover:border-red-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-red-500 to-red-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 10"}),e.jsx("input",{type:"number",min:"0",value:b.n10,onChange:w=>N({...b,n10:parseInt(w.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-red-500 focus:ring-2 focus:ring-red-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-red-600",children:["R$ ",(b.n10*10).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-yellow-200 hover:border-yellow-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-yellow-500 to-yellow-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 20"}),e.jsx("input",{type:"number",min:"0",value:b.n20,onChange:w=>N({...b,n20:parseInt(w.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-yellow-600",children:["R$ ",(b.n20*20).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-blue-200 hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 50"}),e.jsx("input",{type:"number",min:"0",value:b.n50,onChange:w=>N({...b,n50:parseInt(w.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:["R$ ",(b.n50*50).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-green-200 hover:border-green-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-green-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 100"}),e.jsx("input",{type:"number",min:"0",value:b.n100,onChange:w=>N({...b,n100:parseInt(w.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-green-500 focus:ring-2 focus:ring-green-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",(b.n100*100).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-orange-200 hover:border-orange-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 200"}),e.jsx("input",{type:"number",min:"0",value:b.n200,onChange:w=>N({...b,n200:parseInt(w.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["R$ ",(b.n200*200).toFixed(2)]})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t-2 border-blue-300",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-amber-200 hover:border-amber-400 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-amber-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"üí∞ Moedas"})}),e.jsxs("span",{className:"text-lg font-bold text-amber-600",children:["R$ ",parseFloat(b.moedas||0).toFixed(2)]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:b.moedas,onChange:w=>N({...b,moedas:parseFloat(w.target.value)||0}),className:"w-full px-4 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200",placeholder:"0.00"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl p-4 mb-4 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-semibold text-sm",children:"TOTAL CONTADO"}),e.jsxs("span",{className:"text-3xl font-bold text-white",children:["R$ ",q().toFixed(2)]})]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:U,className:"flex-1 px-4 py-3 border-2 border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-semibold transition-colors",children:"üóëÔ∏è Limpar"}),e.jsx("button",{type:"button",onClick:E,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg font-semibold shadow-md transition-colors",children:"‚úì Aplicar"})]})]}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:c,onChange:w=>u(w.target.value),placeholder:"0,00",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-lg font-semibold",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conta de Origem"}),e.jsxs("select",{value:s,onChange:w=>g(w.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Dinheiro em m√£os",children:"Dinheiro em m√£os"}),e.jsx("option",{value:"Caixa geral",children:"Caixa geral"}),e.jsx("option",{value:"Banco",children:"Banco"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes (opcional)"}),e.jsx("textarea",{value:_,onChange:w=>x(w.target.value),rows:3,placeholder:"Ex: Troco do dia anterior...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"border-t p-6 bg-gray-50",children:[k&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(_e,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:k})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:i,disabled:M,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:te,disabled:M||!c,className:"px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:M?"Abrindo...":"Abrir Caixa"})]})]})]})})}function cr({caixaId:i,onClose:y,onSucesso:c}){const[u,s]=r.useState(""),[g,_]=r.useState(""),[x,b]=r.useState(""),[N,H]=r.useState(!1),[h,M]=r.useState(""),S=async()=>{var t,q;const k=parseFloat(u);if(!k||k<=0){M("Informe um valor v√°lido");return}H(!0);try{await za(i,{tipo:"suprimento",valor:k,forma_pagamento:"Dinheiro",conta_origem_nome:g||"N√£o informado",descricao:x}),c()}catch(E){M(((q=(t=E.response)==null?void 0:t.data)==null?void 0:q.detail)||"Erro ao adicionar suprimento")}finally{H(!1)}};return e.jsx(Oa,{titulo:"Suprimento para o caixa",icone:ha,corIcone:"green",onClose:y,erro:h,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conta de origem*"}),e.jsxs("select",{value:g,onChange:k=>_(k.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Dinheiro em m√£os",children:"Dinheiro em m√£os"}),e.jsx("option",{value:"Caixa geral",children:"Caixa geral"}),e.jsx("option",{value:"Banco",children:"Banco"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:u,onChange:k=>s(k.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descri√ß√£o*"}),e.jsx("textarea",{value:x,onChange:k=>b(k.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Motivo do suprimento..."})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:y,disabled:N,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:S,disabled:N,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors",children:N?"Salvando...":"Salvar"})]})]})})}function xr({caixaId:i,saldoAtual:y,onClose:c,onSucesso:u}){const[s,g]=r.useState(""),[_,x]=r.useState(""),[b,N]=r.useState(""),[H,h]=r.useState(!1),[M,S]=r.useState(""),k=async()=>{var q,E;const t=parseFloat(s);if(!t||t<=0){S("Informe um valor v√°lido");return}h(!0);try{await za(i,{tipo:"sangria",valor:t,forma_pagamento:"Dinheiro",conta_destino_nome:_||"N√£o informado",descricao:b}),u()}catch(U){S(((E=(q=U.response)==null?void 0:q.data)==null?void 0:E.detail)||"Erro ao adicionar sangria")}finally{h(!1)}};return e.jsx(Oa,{titulo:"Sangria no caixa",icone:Fa,corIcone:"orange",onClose:c,erro:M,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Em caixa:"})," R$ ",y.toFixed(2)]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor da Sangria*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:s,onChange:t=>g(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecione a conta de destino*"}),e.jsxs("select",{value:_,onChange:t=>x(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Cofre",children:"Cofre"}),e.jsx("option",{value:"Banco",children:"Banco"}),e.jsx("option",{value:"Outro caixa",children:"Outro caixa"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descri√ß√£o"}),e.jsx("textarea",{value:b,onChange:t=>N(t.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Motivo da sangria..."})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:c,disabled:H,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:k,disabled:H,className:"flex-1 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors",children:H?"Salvando...":"Salvar"})]})]})})}function mr({caixaId:i,onClose:y,onSucesso:c}){const[u,s]=r.useState(""),[g,_]=r.useState(""),[x,b]=r.useState(""),[N,H]=r.useState("Dinheiro"),[h,M]=r.useState(""),[S,k]=r.useState(""),[t,q]=r.useState(!1),[E,U]=r.useState(""),te=["√Ågua e Luz","Aluguel","Telefone/Internet","Material de Limpeza","Material de Escrit√≥rio","Manuten√ß√£o","Outros"],w=async()=>{var I,Q;const F=parseFloat(x);if(!F||F<=0){U("Informe um valor v√°lido");return}if(!u){U("Selecione uma categoria");return}q(!0);try{await za(i,{tipo:"despesa",valor:F,categoria:u,descricao:g,forma_pagamento:N,fornecedor_nome:h,documento:S}),c()}catch(R){U(((Q=(I=R.response)==null?void 0:I.data)==null?void 0:Q.detail)||"Erro ao adicionar despesa")}finally{q(!1)}};return e.jsx(Oa,{titulo:"Despesa no caixa",icone:ea,corIcone:"red",onClose:y,erro:E,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categoria*"}),e.jsxs("select",{value:u,onChange:F=>s(F.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),te.map(F=>e.jsx("option",{value:F,children:F},F))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descri√ß√£o*"}),e.jsx("input",{type:"text",value:g,onChange:F=>_(F.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Ex: Conta de luz - Janeiro"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de pagamento*"}),e.jsxs("select",{value:N,onChange:F=>H(F.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Dinheiro",children:"Dinheiro"}),e.jsx("option",{value:"PIX",children:"PIX"}),e.jsx("option",{value:"Cart√£o de Cr√©dito",children:"Cart√£o de Cr√©dito"}),e.jsx("option",{value:"Cart√£o de D√©bito",children:"Cart√£o de D√©bito"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:x,onChange:F=>b(F.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fornecedor"}),e.jsx("input",{type:"text",value:h,onChange:F=>M(F.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Documento / NF"}),e.jsx("input",{type:"text",value:S,onChange:F=>k(F.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:y,disabled:t,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:w,disabled:t,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:t?"Salvando...":"Salvar"})]})]})})}function Oa({titulo:i,icone:y,corIcone:c,children:u,onClose:s,erro:g}){const _={green:"bg-green-100 text-green-600",orange:"bg-orange-100 text-orange-600",red:"bg-red-100 text-red-600",blue:"bg-blue-100 text-blue-600",purple:"bg-purple-100 text-purple-600"};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-12 h-12 ${_[c]} rounded-full flex items-center justify-center`,children:e.jsx(y,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:i})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[g&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(_e,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:g})]}),u]})]})})}function ur({caixaId:i,onClose:y,onSuccess:c}){const[u,s]=r.useState(null),[g,_]=r.useState(""),[x,b]=r.useState(""),[N,H]=r.useState(!0),[h,M]=r.useState(!1),[S,k]=r.useState(!1),[t,q]=r.useState({n100:0,n50:0,n20:0,n10:0,n5:0,n2:0,moedas:0});r.useEffect(()=>{E()},[i]);const E=async()=>{try{const R=await Ms(i);console.log("üìä Resumo do caixa recebido:",R),console.log("üìä vendas_por_forma_pagamento:",R.vendas_por_forma_pagamento),s(R),_(R.totais.saldo_atual.toFixed(2))}catch(R){console.error("Erro ao carregar resumo:",R),alert("Erro ao carregar dados do caixa")}finally{H(!1)}},U=()=>!u||!g?0:parseFloat(g)-u.totais.saldo_atual,te=()=>t.n100*100+t.n50*50+t.n20*20+t.n10*10+t.n5*5+t.n2*2+parseFloat(t.moedas||0),w=()=>{const R=te();_(R.toFixed(2)),k(!1)},F=()=>{q({n100:0,n50:0,n20:0,n10:0,n5:0,n2:0,moedas:0})},I=async()=>{var oe,le;if(!g){alert("Informe o valor contado no caixa");return}const R=U();if(!(Math.abs(R)>.01&&!window.confirm(`Diferen√ßa de R$ ${Math.abs(R).toFixed(2)} ${R>0?"a mais":"a menos"}

Deseja continuar com o fechamento?`))){M(!0);try{await ar(i,{valor_informado:parseFloat(g),observacoes_fechamento:x||null}),alert("Caixa fechado com sucesso!"),c(),y()}catch(ce){console.error("Erro ao fechar caixa:",ce),alert(((le=(oe=ce.response)==null?void 0:oe.data)==null?void 0:le.detail)||"Erro ao fechar caixa")}finally{M(!1)}}};if(N)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})});if(!u)return null;const Q=U();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-red-600 to-orange-600 text-white p-6 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center",children:[e.jsx(ea,{className:"w-7 h-7 mr-3"}),"Fechar Caixa"]}),e.jsxs("p",{className:"text-red-100 mt-1",children:["Caixa #",u.caixa.numero_caixa," - ",u.caixa.usuario_nome]})]}),e.jsx("button",{onClick:y,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-6 border-2 border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center",children:[e.jsx(ua,{className:"w-5 h-5 mr-2 text-gray-700"}),"Resumo do Movimento"]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Valor de Abertura"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",u.caixa.valor_abertura.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(u.caixa.data_abertura).toLocaleString("pt-BR")})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-green-700 mb-1",children:[e.jsx(ea,{className:"w-4 h-4 mr-1"}),"Entradas"]}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["+ R$ ",u.totais.vendas.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Movimento de entrada"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-blue-700 mb-1",children:[e.jsx(ha,{className:"w-4 h-4 mr-1"}),"Suprimentos"]}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["+ R$ ",u.totais.suprimentos.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-orange-700 mb-1",children:[e.jsx(Fa,{className:"w-4 h-4 mr-1"}),"Sangrias"]}),e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["- R$ ",u.totais.sangrias.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-red-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-red-700 mb-1",children:[e.jsx(na,{className:"w-4 h-4 mr-1"}),"Despesas"]}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["- R$ ",u.totais.despesas.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900",children:"Valor Contado no Caixa *"}),e.jsxs("button",{type:"button",onClick:()=>k(!S),className:"flex items-center space-x-1 px-3 py-1.5 text-sm bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors border border-blue-200",title:"Auxiliar na contagem de notas",children:[e.jsx(ua,{className:"w-4 h-4"}),e.jsx("span",{children:"Auxiliar Contagem"})]})]}),S&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-xl p-5 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center",children:[e.jsx(ua,{className:"w-5 h-5 mr-2 text-blue-600"}),"Auxiliar de Contagem"]}),e.jsx("button",{onClick:()=>k(!1),className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-gray-200 hover:border-gray-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-gray-500 to-gray-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 2"}),e.jsx("input",{type:"number",min:"0",value:t.n2,onChange:R=>q({...t,n2:parseInt(R.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-gray-500 focus:ring-2 focus:ring-gray-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-gray-600",children:["R$ ",(t.n2*2).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-purple-200 hover:border-purple-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 5"}),e.jsx("input",{type:"number",min:"0",value:t.n5,onChange:R=>q({...t,n5:parseInt(R.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-purple-600",children:["R$ ",(t.n5*5).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-red-200 hover:border-red-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-red-500 to-red-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 10"}),e.jsx("input",{type:"number",min:"0",value:t.n10,onChange:R=>q({...t,n10:parseInt(R.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-red-500 focus:ring-2 focus:ring-red-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-red-600",children:["R$ ",(t.n10*10).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-yellow-200 hover:border-yellow-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-yellow-500 to-yellow-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 20"}),e.jsx("input",{type:"number",min:"0",value:t.n20,onChange:R=>q({...t,n20:parseInt(R.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-yellow-600",children:["R$ ",(t.n20*20).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-blue-200 hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 50"}),e.jsx("input",{type:"number",min:"0",value:t.n50,onChange:R=>q({...t,n50:parseInt(R.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:["R$ ",(t.n50*50).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-green-200 hover:border-green-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-green-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 100"}),e.jsx("input",{type:"number",min:"0",value:t.n100,onChange:R=>q({...t,n100:parseInt(R.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-green-500 focus:ring-2 focus:ring-green-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",(t.n100*100).toFixed(2)]})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t-2 border-blue-300",children:e.jsx("div",{className:"bg-white rounded-lg p-4 border-2 border-amber-200 hover:border-amber-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-amber-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"üí∞ Moedas"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:t.moedas,onChange:R=>q({...t,moedas:parseFloat(R.target.value)||0}),className:"w-32 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200",placeholder:"0.00"})]}),e.jsxs("span",{className:"text-lg font-bold text-amber-600",children:["R$ ",(t.moedas||0).toFixed(2)]})]})})}),e.jsxs("div",{className:"mt-5 pt-5 border-t-2 border-blue-300",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl p-4 mb-4 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-semibold text-sm",children:"TOTAL CONTADO"}),e.jsxs("span",{className:"text-3xl font-bold text-white",children:["R$ ",te().toFixed(2)]})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:F,className:"flex-1 px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-semibold transition-colors",children:"üóëÔ∏è Limpar"}),e.jsx("button",{type:"button",onClick:w,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 font-bold shadow-md transition-all",children:"‚úì Aplicar"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(na,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:g,onChange:R=>_(R.target.value),className:"w-full pl-10 pr-4 py-3 text-lg font-semibold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",autoFocus:!0})]}),g&&Math.abs(Q)>.01&&e.jsx("div",{className:`mt-3 p-4 rounded-lg border-2 ${Q>0?"bg-blue-50 border-blue-300":"bg-yellow-50 border-yellow-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-semibold text-gray-900",children:[Q>0?"Sobra":"Falta",":"]}),e.jsxs("span",{className:`text-xl font-bold ${Q>0?"text-blue-600":"text-yellow-700"}`,children:["R$ ",Math.abs(Q).toFixed(2)]})]})}),g&&Math.abs(Q)<=.01&&e.jsx("div",{className:"mt-3 p-4 rounded-lg border-2 bg-green-50 border-green-300",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-green-700 font-semibold",children:[e.jsx("span",{className:"text-2xl",children:"‚úì"}),e.jsx("span",{children:"Caixa conferido - Valores corretos!"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Observa√ß√µes (opcional)"}),e.jsx("textarea",{value:x,onChange:R=>b(R.target.value),placeholder:"Adicione observa√ß√µes sobre o fechamento...",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),u.vendas_por_forma_pagamento&&Object.keys(u.vendas_por_forma_pagamento).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center",children:[e.jsx(ea,{className:"w-4 h-4 mr-1.5 text-blue-600"}),"Vendas por Forma de Pagamento (Informativo)"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(u.vendas_por_forma_pagamento).map(([R,oe])=>{const le=R==="Dinheiro";return e.jsx("div",{className:`bg-white rounded-lg p-3 border ${le?"border-green-300 bg-green-50":"border-gray-200"} hover:shadow-sm transition-shadow cursor-pointer`,title:"Clique para ver detalhes das vendas",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${R==="Dinheiro"?"bg-green-500":R==="PIX"?"bg-purple-500":R.includes("D√©bito")?"bg-blue-500":R.includes("Cr√©dito")?"bg-orange-500":"bg-gray-400"}`}),e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:R}),le&&e.jsx("span",{className:"text-xs bg-green-600 text-white px-1.5 py-0.5 rounded",children:"CAIXA"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[oe.quantidade," venda",oe.quantidade!==1?"s":""]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:["R$ ",oe.total.toFixed(2)]})})]})},R)})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200 text-xs text-gray-600",children:["üí° ",e.jsx("strong",{children:"Dica:"})," Apenas ",e.jsx("strong",{children:"Dinheiro"})," afeta o saldo f√≠sico do caixa. Demais formas v√£o para banco/financeiro."]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:y,disabled:h,className:"px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),e.jsx("button",{onClick:I,disabled:h||!g,className:"px-8 py-3 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white rounded-lg font-bold transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Fechando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ea,{className:"w-5 h-5"}),e.jsx("span",{children:"Fechar Caixa"})]})})]})]})]})})}function gr({caixaId:i,onClose:y,onSucesso:c}){var Oe;const[u,s]=r.useState(1),[g,_]=r.useState([]),[x,b]=r.useState(null),[N,H]=r.useState({}),[h,M]=r.useState({}),[S,k]=r.useState(""),[t,q]=r.useState(!1),[E,U]=r.useState(!1),[te,w]=r.useState(""),[F,I]=r.useState({}),[Q,R]=r.useState({}),[oe,le]=r.useState({}),[ce,j]=r.useState({busca:"",data_inicio:"",data_fim:"",status:"finalizada"});r.useEffect(()=>{J()},[ce]);const J=async()=>{U(!0),w("");try{const m={per_page:50,...ce},V=await P.get("/vendas",{params:m});_(V.data.vendas||[])}catch(m){console.error("Erro ao buscar vendas:",m),w("Erro ao carregar vendas")}finally{U(!1)}},G=async m=>{var V,O;U(!0),w("");try{const D=await P.get(`/vendas/${m.id}`);b(D.data);const A={};D.data.itens.forEach($=>{A[$.id]=$.quantidade}),M(A),s(2)}catch(D){console.error("Erro ao buscar venda:",D),w(((O=(V=D.response)==null?void 0:V.data)==null?void 0:O.detail)||"Erro ao carregar detalhes da venda")}finally{U(!1)}},z=m=>{const V=N[m];H(O=>({...O,[m]:!O[m]})),V&&(I(O=>{const D={...O};return delete D[m],D}),R(O=>{const D={...O};return delete D[m],D}),le(O=>{const D={...O};return delete D[m],D}))},ne=(m,V)=>{const D=x.itens.find($=>$.id===m).quantidade,A=Math.min(Math.max(0,parseFloat(V)||0),D);M($=>({...$,[m]:A}))},Ne=m=>m.tipo_produto==="KIT"&&m.composicao_kit&&m.composicao_kit.length>0,v=(m,V)=>{if(I(O=>({...O,[m]:V})),V==="componentes"){const O=x.itens.find(D=>D.id===m);if(O&&O.composicao_kit){const D={},A={};O.composicao_kit.forEach(($,he)=>{D[he]=!1,A[he]=$.quantidade*O.quantidade}),R($=>({...$,[m]:D})),le($=>({...$,[m]:A}))}}},W=(m,V)=>{R(O=>{var D;return{...O,[m]:{...O[m]||{},[V]:!((D=O[m])!=null&&D[V])}}})},xe=(m,V,O)=>{const D=x.itens.find(de=>de.id===m),$=D.composicao_kit[V].quantidade*D.quantidade,he=Math.min(Math.max(0,parseFloat(O)||0),$);le(de=>({...de,[m]:{...de[m]||{},[V]:he}}))},be=async()=>{var D,A;if(Object.keys(N).filter($=>N[$]).filter($=>{const he=x.itens.find(de=>de.id===parseInt($));return Ne(he)&&!F[$]}).length>0){w("Para itens KIT, voc√™ deve escolher entre devolver o KIT inteiro ou selecionar componentes");return}const V=[];if(Object.keys(N).filter($=>N[$]).forEach($=>{const he=parseInt($),de=x.itens.find(we=>we.id===he);if(Ne(de)){const we=F[$];if(we==="kit_inteiro")V.push({item_id:he,quantidade:h[$]});else if(we==="componentes"){const me=Q[$]||{},fe=oe[$]||{},ke=Object.keys(me).filter(Ee=>me[Ee]).map(Ee=>parseInt(Ee));if(ke.length===0){w(`Voc√™ deve selecionar pelo menos um componente do KIT "${de.produto_nome}"`);return}ke.forEach(Ee=>{const Te=de.composicao_kit[Ee],ee=fe[Ee]||0;if(ee<=0){w(`Quantidade do componente "${Te.produto_nome}" deve ser maior que zero`);return}V.push({produto_id:Te.produto_id,quantidade:ee,preco_unitario:de.preco_unitario/de.composicao_kit.reduce((ve,la)=>ve+la.quantidade,0)*Te.quantidade,is_componente_kit:!0,kit_item_id:he})})}}else V.push({item_id:he,quantidade:h[$]})}),V.length===0){w("Selecione pelo menos um item para devolu√ß√£o");return}if(V.some($=>$.quantidade<=0)){w("Todas as quantidades devem ser maiores que zero");return}if(!S.trim()){w("Informe o motivo da devolu√ß√£o");return}U(!0),w("");try{await P.post(`/vendas/${x.id}/devolucao`,{caixa_id:i,itens:V,motivo:S,gerar_credito:t}),alert("Devolu√ß√£o registrada com sucesso!"),c()}catch($){console.error("Erro ao registrar devolu√ß√£o:",$),w(((A=(D=$.response)==null?void 0:D.data)==null?void 0:A.detail)||"Erro ao registrar devolu√ß√£o")}finally{U(!1)}},$e=()=>{if(!x)return 0;let m=0;return Object.keys(N).filter(V=>N[V]).forEach(V=>{const O=x.itens.find(D=>D.id===parseInt(V));if(Ne(O)){const D=F[V];if(D==="kit_inteiro"){const A=h[V]||0;m+=O.preco_unitario*A}else if(D==="componentes"){const A=Q[V]||{},$=oe[V]||{},he=O.composicao_kit.reduce((de,we)=>de+we.quantidade,0);Object.keys(A).filter(de=>A[de]).forEach(de=>{const we=O.composicao_kit[de],me=$[de]||0,fe=O.preco_unitario/he*we.quantidade,ke=me/we.quantidade;m+=fe*ke})}}else{const D=h[V]||0;m+=O.preco_unitario*D}}),m};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(As,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Devolu√ß√£o"}),e.jsx("p",{className:"text-sm text-gray-500",children:u===1?"Selecione a venda":"Selecionar itens para devolu√ß√£o"})]})]}),e.jsx("button",{onClick:y,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[u===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar"}),e.jsx("input",{type:"text",value:ce.busca,onChange:m=>j({...ce,busca:m.target.value}),placeholder:"N√∫mero da venda, cliente...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data In√≠cio"}),e.jsx("input",{type:"date",value:ce.data_inicio,onChange:m=>j({...ce,data_inicio:m.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Fim"}),e.jsx("input",{type:"date",value:ce.data_fim,onChange:m=>j({...ce,data_fim:m.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})}),E?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando vendas..."})]}):g.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(_e,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Nenhuma venda encontrada"})]}):e.jsx("div",{className:"space-y-2",children:g.map(m=>{var V;return e.jsx("button",{onClick:()=>G(m),className:"w-full text-left p-4 border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:["Venda #",m.numero_venda||m.id]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Cliente: ",((V=m.cliente)==null?void 0:V.nome)||"Consumidor Final"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:m.data_criacao?new Date(m.data_criacao).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Data n√£o dispon√≠vel"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold text-green-600",children:["R$ ",m.total.toFixed(2)]}),e.jsx("div",{className:`text-xs mt-1 px-2 py-1 rounded ${m.status==="finalizada"?"bg-green-100 text-green-800":m.status==="baixa_parcial"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:m.status==="finalizada"?"Finalizada":m.status==="baixa_parcial"?"Parcial":"Aberta"})]})]})},m.id)})}),te&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(_e,{className:"w-5 h-5"}),e.jsx("span",{children:te})]})]}),u===2&&x&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-2",children:["Venda #",x.numero_venda||x.id]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{className:"ml-2 font-medium",children:x.data_criacao?new Date(x.data_criacao).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Data n√£o dispon√≠vel"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Cliente:"}),e.jsx("span",{className:"ml-2 font-medium",children:((Oe=x.cliente)==null?void 0:Oe.nome)||"Consumidor Final"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"ml-2 font-medium text-green-600",children:["R$ ",x.total.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Itens da Venda"}),e.jsx("div",{className:"space-y-2",children:x.itens.map(m=>{const V=Ne(m),O=F[m.id];return e.jsx("div",{className:`border rounded-lg p-4 transition-colors ${N[m.id]?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("input",{type:"checkbox",checked:N[m.id]||!1,onChange:()=>z(m.id),className:"mt-1 w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:m.produto_nome}),V&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded",children:[e.jsx(Ts,{className:"w-3 h-3"}),"KIT"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Pre√ßo unit√°rio: R$ ",m.preco_unitario.toFixed(2)," | Qtd vendida: ",m.quantidade]}),N[m.id]&&V&&e.jsxs("div",{className:"mt-4 bg-white border-2 border-purple-300 rounded-lg p-4",children:[e.jsxs("div",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(ga,{className:"w-5 h-5 text-purple-600"}),"Como deseja devolver este KIT?"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:`modo-kit-${m.id}`,checked:O==="kit_inteiro",onChange:()=>v(m.id,"kit_inteiro"),className:"mt-1 w-4 h-4 text-blue-600 focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800 group-hover:text-blue-700 transition-colors",children:"üì¶ Devolver KIT Inteiro"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Devolve o KIT completo como uma unidade"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:`modo-kit-${m.id}`,checked:O==="componentes",onChange:()=>v(m.id,"componentes"),className:"mt-1 w-4 h-4 text-purple-600 focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800 group-hover:text-purple-700 transition-colors",children:"üß© Selecionar Componentes"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Escolha quais componentes do KIT devolver"})]})]})]})]}),N[m.id]&&!V&&e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantidade a devolver:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:m.quantidade,value:h[m.id],onChange:D=>ne(m.id,D.target.value),className:"w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Subtotal: R$ ",(m.preco_unitario*(h[m.id]||0)).toFixed(2)]})]}),N[m.id]&&V&&O==="kit_inteiro"&&e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantidade de KITs a devolver:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:m.quantidade,value:h[m.id],onChange:D=>ne(m.id,D.target.value),className:"w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Subtotal: R$ ",(m.preco_unitario*(h[m.id]||0)).toFixed(2)]})]}),N[m.id]&&V&&O==="componentes"&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-purple-50 to-blue-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold text-gray-800 mb-3",children:"Selecione os componentes a devolver:"}),e.jsx("div",{className:"space-y-3",children:m.composicao_kit.map((D,A)=>{var de,we;const $=(de=Q[m.id])==null?void 0:de[A],he=D.quantidade*m.quantidade;return e.jsx("div",{className:`border rounded-lg p-3 transition-colors ${$?"border-purple-500 bg-white":"border-gray-200 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:$||!1,onChange:()=>W(m.id,A),className:"mt-1 w-4 h-4 text-purple-600 rounded focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ga,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-800",children:D.produto_nome})]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["Qtd no KIT: ",D.quantidade," | Qtd total dispon√≠vel: ",he]}),$&&e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Quantidade:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:he,value:((we=oe[m.id])==null?void 0:we[A])||0,onChange:me=>xe(m.id,A,me.target.value),className:"w-24 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500"})]})]})]})},A)})})]})]})]})},m.id)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Motivo da Devolu√ß√£o *"}),e.jsx("textarea",{value:S,onChange:m=>k(m.target.value),placeholder:"Descreva o motivo da devolu√ß√£o...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 border-2 border-purple-200 rounded-lg p-5",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-3",children:"üí≥ Tipo de Devolu√ß√£o"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",checked:!t,onChange:()=>q(!1),className:"mt-1 w-5 h-5 text-green-600 focus:ring-2 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800 group-hover:text-green-700 transition-colors",children:"üíµ Devolver em Dinheiro"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"O valor ser√° devolvido em dinheiro e registrado como sa√≠da de caixa"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",checked:t,onChange:()=>q(!0),className:"mt-1 w-5 h-5 text-purple-600 focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800 group-hover:text-purple-700 transition-colors",children:"üéÅ Gerar Cr√©dito para o Cliente"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"O valor ser√° convertido em cr√©dito para uso em futuras compras (sem movimenta√ß√£o de caixa)"})]})]})]}),t&&!(x!=null&&x.cliente_id)&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-300 rounded-lg",children:e.jsxs("p",{className:"text-xs text-yellow-800 flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Aten√ß√£o:"})," Esta venda n√£o possui cliente vinculado. Para gerar cr√©dito, √© necess√°rio ter um cliente cadastrado."]})]})})]}),e.jsx("div",{className:`border-2 rounded-lg p-4 ${t?"bg-purple-50 border-purple-300":"bg-orange-50 border-orange-200"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:t?"Cr√©dito a Gerar:":"Total da Devolu√ß√£o:"}),t&&(x==null?void 0:x.cliente)&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Cliente: ",e.jsx("strong",{children:x.cliente.nome})]})]}),e.jsxs("span",{className:`text-2xl font-bold ${t?"text-purple-600":"text-orange-600"}`,children:["R$ ",$e().toFixed(2)]})]})}),te&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(_e,{className:"w-5 h-5"}),e.jsx("span",{children:te})]})]})]}),e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:u===1?y:()=>{s(1),b(null),H({}),M({}),k(""),w("")},disabled:E,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:u===1?"Cancelar":"Voltar"}),u===2&&e.jsx("button",{onClick:be,disabled:E||Object.values(N).filter(Boolean).length===0,className:"flex items-center gap-2 px-8 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:E?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(vt,{className:"w-5 h-5"}),e.jsx("span",{children:"Confirmar Devolu√ß√£o"})]})})]})})]})})}function pr({caixaId:i,onClose:y}){const[c,u]=r.useState([]),[s,g]=r.useState(null),[_,x]=r.useState(!0);r.useEffect(()=>{b()},[i]);const b=async()=>{try{x(!0);const h=await P.get(`/caixas/${i}/movimentacoes`);u(h.data.movimentacoes),g(h.data.caixa)}catch(h){console.error("Erro ao carregar movimenta√ß√µes:",h),De.error("Erro ao carregar movimenta√ß√µes do caixa")}finally{x(!1)}},N=h=>{const M=new Date(h);return new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}).format(M)},H=h=>({venda:"Venda",suprimento:"Suprimento",sangria:"Sangria",despesa:"Despesa",devolucao:"Devolu√ß√£o",transferencia:"Transfer√™ncia"})[h]||h;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-blue-50 to-purple-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:"üìã Extrato do Caixa"}),s&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Caixa #",s.id," - ",s.nome," | Status: ",s.status]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,className:"p-2 hover:bg-white rounded-lg transition-colors",title:"Atualizar",children:e.jsx(yt,{className:`w-5 h-5 text-gray-600 ${_?"animate-spin":""}`})}),e.jsx("button",{onClick:y,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(ue,{className:"w-5 h-5 text-gray-600"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:_?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üì≠"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhuma movimenta√ß√£o registrada"})]}):e.jsx("div",{className:"space-y-3",children:c.map(h=>e.jsx("div",{className:`p-4 rounded-lg border-2 ${h.natureza==="entrada"?"bg-green-50 border-green-200":h.natureza==="saida"?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"text-3xl",children:h.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:H(h.tipo)}),h.forma_pagamento&&e.jsx("span",{className:"text-xs bg-white px-2 py-1 rounded border",children:h.forma_pagamento})]}),h.descricao&&e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:h.descricao}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-2 text-xs text-gray-600",children:[e.jsxs("span",{children:["üïê ",N(h.data_movimento)]}),e.jsxs("span",{children:["üë§ ",h.usuario_nome]}),h.venda_id&&e.jsxs("span",{children:["üßæ Venda #",h.venda_numero||h.venda_id]}),h.documento&&e.jsxs("span",{children:["üìÑ ",h.documento]})]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("div",{className:`text-2xl font-bold ${h.natureza==="entrada"?"text-green-600":h.natureza==="saida"?"text-red-600":"text-gray-600"}`,children:[h.natureza==="entrada"&&"+",h.natureza==="saida"&&"-","R$ ",h.valor.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:h.natureza==="entrada"?e.jsxs("span",{className:"flex items-center gap-1 justify-end",children:[e.jsx(ha,{className:"w-3 h-3"})," Entrada"]}):h.natureza==="saida"?e.jsxs("span",{className:"flex items-center gap-1 justify-end",children:[e.jsx(Fa,{className:"w-3 h-3"})," Sa√≠da"]}):"Neutro"})]})]})},h.id))})}),e.jsx("div",{className:"border-t p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[c.length," movimenta√ß√£o(√µes) encontrada(s)"]}),e.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Fechar"})]})})]})})}function br({onAbrirCaixa:i}){var te,w,F;const[y,c]=r.useState(null),[u,s]=r.useState(null),[g,_]=r.useState(!1),[x,b]=r.useState(null),[N,H]=r.useState(!0),[h,M]=r.useState(!1),[S,k]=r.useState(!1);r.useEffect(()=>{q();const I=setInterval(q,3e4);return()=>clearInterval(I)},[]),r.useEffect(()=>{const I=()=>{M(!1)};if(h)return document.addEventListener("mouseup",I),()=>document.removeEventListener("mouseup",I)},[h]);const t=()=>{_(!1),k(!1),M(!1)},q=async()=>{try{const I=await sr();if(c(I),I){const Q=await Ms(I.id);s(Q)}}catch(I){console.error("Erro ao carregar caixa:",I)}finally{H(!1)}},E=()=>{b(null),q()},U=async()=>{await i(),setTimeout(q,500)};return N?e.jsx("div",{className:"px-4 py-2 bg-gray-100 rounded-lg",children:e.jsx("div",{className:"animate-pulse h-10 bg-gray-200 rounded"})}):y?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>_(!g),className:"flex items-center space-x-3 px-4 py-2 bg-white border-2 border-green-500 rounded-lg hover:bg-green-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["Caixa #",y.numero_caixa]})]}),e.jsx(Ia,{className:`w-5 h-5 text-gray-400 transition-transform ${g?"rotate-180":""}`})]}),g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:t}),e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 z-50",children:[e.jsxs("div",{className:"p-4 border-b bg-gradient-to-r from-green-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Caixa #",y.numero_caixa]}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:y.usuario_nome})]}),e.jsx("button",{onClick:t,className:"p-1 hover:bg-white rounded-lg transition-colors",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(qa,{className:"w-4 h-4 mr-1"}),"Aberto em ",new Date(y.data_abertura).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Saldo Atual"}),e.jsx("div",{className:`text-sm font-bold ${h?"text-green-600":"text-gray-400"}`,children:h?`R$ ${((w=(te=u==null?void 0:u.totais)==null?void 0:te.saldo_atual)==null?void 0:w.toFixed(2))||"0,00"}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsx("button",{onMouseDown:()=>M(!0),className:"p-1 hover:bg-blue-100 rounded transition-colors",children:h?e.jsx(_s,{className:"w-4 h-4 text-blue-600"}):e.jsx(Cs,{className:"w-4 h-4 text-gray-400"})})]})]})]}),u&&e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900",children:"Resumo do Movimento"}),e.jsx("button",{onClick:()=>k(!S),className:"p-1 hover:bg-gray-200 rounded transition-colors",children:S?e.jsx(_s,{className:"w-4 h-4 text-blue-600"}):e.jsx(Cs,{className:"w-4 h-4 text-gray-400"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Abertura"}),e.jsx("div",{className:`font-semibold ${S?"text-gray-900":"text-gray-300"}`,children:S?`R$ ${y.valor_abertura.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Entradas"}),e.jsx("div",{className:`font-semibold ${S?"text-green-600":"text-green-300"}`,children:S?`+ R$ ${u.totais.vendas.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Suprimentos"}),e.jsx("div",{className:`font-semibold ${S?"text-green-600":"text-green-300"}`,children:S?`+ R$ ${u.totais.suprimentos.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Sangrias"}),e.jsx("div",{className:`font-semibold ${S?"text-orange-600":"text-orange-300"}`,children:S?`- R$ ${u.totais.sangrias.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Despesas"}),e.jsx("div",{className:`font-semibold ${S?"text-red-600":"text-red-300"}`,children:S?`- R$ ${u.totais.despesas.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]})]})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{onClick:()=>{b("suprimento"),_(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-green-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(ha,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Suprimento"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Adicionar dinheiro ao caixa"})]})]}),e.jsxs("button",{onClick:()=>{b("sangria"),_(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-orange-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(Fa,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Sangria"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Retirar dinheiro do caixa"})]})]}),e.jsxs("button",{onClick:()=>{b("despesa"),_(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-red-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(ea,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Despesa"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Registrar pagamento de despesa"})]})]}),e.jsxs("button",{onClick:()=>{b("devolucao"),_(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-purple-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(As,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Devolu√ß√£o"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Estornar venda e devolver ao estoque"})]})]}),e.jsxs("button",{onClick:()=>{b("movimentacoes"),_(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-blue-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Nt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Extrato do Caixa"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Ver todas as movimenta√ß√µes"})]})]})]}),e.jsx("div",{className:"p-4 border-t",children:e.jsx("button",{onClick:()=>{b("fechar"),_(!1)},className:"w-full px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Fechar Caixa"})})]})]})]}),x==="suprimento"&&e.jsx(cr,{caixaId:y.id,onClose:()=>b(null),onSucesso:E}),x==="sangria"&&e.jsx(xr,{caixaId:y.id,saldoAtual:((F=u==null?void 0:u.totais)==null?void 0:F.saldo_atual)||0,onClose:()=>b(null),onSucesso:E}),x==="despesa"&&e.jsx(mr,{caixaId:y.id,onClose:()=>b(null),onSucesso:E}),x==="fechar"&&e.jsx(ur,{caixaId:y.id,onClose:()=>b(null),onSuccess:()=>{b(null),q()}}),x==="devolucao"&&e.jsx(gr,{caixaId:y.id,onClose:()=>b(null),onSucesso:E}),x==="movimentacoes"&&e.jsx(pr,{caixaId:y.id,onClose:()=>b(null)})]}):e.jsxs("button",{onClick:U,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(na,{className:"w-5 h-5"}),e.jsx("span",{children:"Abrir Caixa"})]})}function hr({venda:i,onClose:y}){var u,s;const c=()=>{window.print()};return i?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:c,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-800 text-white rounded-lg transition-colors print:hidden",children:[e.jsx(wt,{className:"w-5 h-5"}),e.jsx("span",{children:"Imprimir Cupom"})]}),e.jsx("style",{children:`
        @media print {
          /* Esconder tudo exceto o cupom */
          body * {
            visibility: hidden;
          }
          .cupom-impressao, .cupom-impressao * {
            visibility: visible;
          }
          .cupom-impressao {
            position: absolute;
            left: 0;
            top: 0;
            width: 80mm;
            margin: 0;
            padding: 0;
          }
          
          /* Reset de margens para impress√£o */
          @page {
            size: 80mm auto;
            margin: 5mm;
          }
        }
      `}),e.jsxs("div",{className:"cupom-impressao hidden print:block",style:{width:"80mm",fontFamily:"monospace"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"10px"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold"},children:"PET SHOP PRO"}),e.jsx("div",{style:{fontSize:"12px"},children:"Central de Gest\\u00e3o"}),e.jsx("div",{style:{fontSize:"10px",marginTop:"5px"},children:new Date().toLocaleString("pt-BR")})]}),e.jsxs("div",{style:{borderTop:"1px dashed #000",marginBottom:"10px",paddingTop:"10px"},children:[e.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"5px"},children:["VENDA #",i.numero_venda||i.id]}),e.jsxs("div",{style:{fontSize:"11px"},children:[e.jsxs("div",{children:["Data: ",i.data_venda?new Date(i.data_venda).toLocaleString("pt-BR"):new Date().toLocaleString("pt-BR")]}),i.cliente&&e.jsxs("div",{children:["Cliente: ",i.cliente.nome||i.cliente_nome]}),i.pet&&e.jsxs("div",{children:["Pet: ",i.pet.nome]})]})]}),e.jsx("div",{style:{borderTop:"1px dashed #000",marginBottom:"10px",paddingTop:"10px"},children:e.jsxs("table",{style:{width:"100%",fontSize:"10px",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid #000"},children:[e.jsx("th",{style:{textAlign:"left",paddingBottom:"5px"},children:"Item"}),e.jsx("th",{style:{textAlign:"center",paddingBottom:"5px"},children:"Qtd"}),e.jsx("th",{style:{textAlign:"right",paddingBottom:"5px"},children:"Valor"})]})}),e.jsx("tbody",{children:(u=i.itens)==null?void 0:u.map((g,_)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{paddingTop:"5px",paddingBottom:"5px"},children:[g.produto_nome,e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"9px",color:"#666"},children:[g.quantidade," x R$ ",g.preco_unitario.toFixed(2),g.desconto_valor>0&&e.jsxs("span",{style:{color:"#ff8c00"},children:[" ","com R$ ",g.desconto_valor.toFixed(2)," de desconto"]})]})]}),e.jsx("td",{style:{textAlign:"center",paddingTop:"5px",paddingBottom:"5px"},children:g.quantidade}),e.jsxs("td",{style:{textAlign:"right",paddingTop:"5px",paddingBottom:"5px"},children:["R$ ",g.subtotal.toFixed(2)]})]},_))})]})}),e.jsxs("div",{style:{borderTop:"1px dashed #000",paddingTop:"10px",fontSize:"11px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Total bruto:"}),e.jsxs("span",{children:["R$ ",(i.subtotal+i.desconto_valor).toFixed(2)]})]}),i.desconto_valor>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px",color:"#ff8c00"},children:[e.jsxs("span",{children:[(i.desconto_valor/(i.subtotal+i.desconto_valor)*100).toFixed(2),"% de desconto:"]}),e.jsxs("span",{children:["R$ ",i.desconto_valor.toFixed(2)]})]}),i.tem_entrega&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsxs("span",{children:["R$ ",(((s=i.entrega)==null?void 0:s.taxa_entrega_total)||0).toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",paddingTop:"10px",borderTop:"1px solid #000",fontSize:"14px",fontWeight:"bold"},children:[e.jsx("span",{children:"TOTAL:"}),e.jsxs("span",{children:["R$ ",i.total.toFixed(2)]})]})]}),i.pagamentos&&i.pagamentos.length>0&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"PAGAMENTOS:"}),i.pagamentos.map((g,_)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"3px"},children:[e.jsx("span",{children:g.forma_pagamento}),e.jsxs("span",{children:["R$ ",g.valor.toFixed(2)]})]},_))]}),i.tem_entrega&&i.entrega&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"ENTREGA:"}),e.jsx("div",{children:i.entrega.endereco_completo}),i.entrega.observacoes_entrega&&e.jsxs("div",{style:{marginTop:"3px",fontStyle:"italic"},children:["Obs: ",i.entrega.observacoes_entrega]})]}),i.observacoes&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"OBSERVA\\u00c7\\u00d5ES:"}),e.jsx("div",{children:i.observacoes})]}),e.jsxs("div",{style:{textAlign:"center",marginTop:"15px",paddingTop:"10px",borderTop:"1px dashed #000",fontSize:"10px"},children:[e.jsx("div",{children:"Obrigado pela preferencia!"}),e.jsx("div",{style:{marginTop:"5px"},children:"Volte sempre!"})]})]})]}):null}function fr({clienteId:i,clienteNome:y,onClose:c,onSucesso:u}){const[s,g]=r.useState([]),[_,x]=r.useState([]),[b,N]=r.useState(!0),[H,h]=r.useState(!1),[M,S]=r.useState(""),[k,t]=r.useState("dinheiro"),[q,E]=r.useState(""),[U,te]=r.useState(""),[w,F]=r.useState({total_vendas:0,total_em_aberto:0}),[I,Q]=r.useState("antiga");r.useEffect(()=>{R()},[i]);const R=async()=>{try{N(!0);const z=await P.get(`/clientes/${i}/vendas-em-aberto`);g(z.data.vendas||[]),F(z.data.resumo||{total_vendas:0,total_em_aberto:0})}catch(z){console.error("Erro ao carregar vendas em aberto:",z),Ze.error("Erro ao carregar vendas em aberto")}finally{N(!1)}},oe=z=>{x(ne=>ne.includes(z)?ne.filter(Ne=>Ne!==z):[...ne,z])},le=()=>{_.length===s.length?x([]):x(s.map(z=>z.id))},ce=z=>{const ne=new Date,Ne=new Date(z),v=Math.abs(ne-Ne);return Math.ceil(v/(1e3*60*60*24))},j=[...s].sort((z,ne)=>I==="antiga"?new Date(z.data_venda)-new Date(ne.data_venda):new Date(ne.data_venda)-new Date(z.data_venda)),J=s.filter(z=>_.includes(z.id)).reduce((z,ne)=>z+parseFloat(ne.saldo_devedor),0),G=async()=>{var z,ne,Ne,v;if(_.length===0){Ze.error("Selecione ao menos uma venda");return}if(!M||parseFloat(M)<=0){Ze.error("Informe um valor v√°lido");return}if(parseFloat(M)>J){Ze.error("Valor do pagamento n√£o pode ser maior que o total selecionado");return}try{h(!0),console.log("Enviando requisi√ß√£o:",{vendas_ids:_,valor_total:parseFloat(M),forma_pagamento:k,numero_transacao:q||null,observacoes:U||null});const W=await P.post(`/clientes/${i}/baixar-vendas-lote`,{vendas_ids:_,valor_total:parseFloat(M),forma_pagamento:k,numero_transacao:q||null,observacoes:U||null});if(console.log("Resposta completa:",W),console.log("Response.data:",W.data),!W.data)throw new Error("Resposta vazia do servidor");const{vendas_quitadas:xe,vendas_parciais:be,total_vendas_afetadas:$e,valor_total_baixado:Oe}=W.data;let m=`üí∞ Total baixado: R$ ${Oe.toFixed(2)}
`;xe.length>0&&(m+=`
‚úÖ ${xe.length} venda(s) quitada(s):`,xe.forEach(V=>{m+=`
  ‚Ä¢ ${V.numero_venda}: R$ ${V.valor_baixado.toFixed(2)}`})),be.length>0&&(m+=`

‚ö†Ô∏è ${be.length} venda(s) parcial:`,be.forEach(V=>{m+=`
  ‚Ä¢ ${V.numero_venda}:`,m+=`
    Baixado: R$ ${V.valor_baixado.toFixed(2)}`,m+=`
    Falta: R$ ${V.saldo_restante.toFixed(2)}`})),Ze.success(m,{duration:6e3}),u&&u(),c()}catch(W){console.error("Erro completo:",W),console.error("Erro response:",W.response),console.error("Erro response data:",(z=W.response)==null?void 0:z.data),console.error("Erro response status:",(ne=W.response)==null?void 0:ne.status);const xe=((v=(Ne=W.response)==null?void 0:Ne.data)==null?void 0:v.detail)||W.message||"Erro ao baixar vendas";Ze.error(xe)}finally{h(!1)}};return b?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-8 max-w-4xl w-full mx-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Va,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando vendas..."})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-red-50 to-orange-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Vendas em Aberto"}),e.jsx("p",{className:"text-gray-600 mt-1",children:y})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Vendas"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:w.total_vendas})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total em Aberto"}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["R$ ",w.total_em_aberto.toFixed(2)]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(pa,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-medium text-gray-900",children:"Nenhuma venda em aberto!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Este cliente n√£o possui d√©bitos pendentes."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:le,className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:_.length===s.length?"Desmarcar todas":"Selecionar todas"}),e.jsxs("button",{onClick:()=>Q(I==="antiga"?"recente":"antiga"),className:"text-sm text-gray-600 hover:text-gray-700 flex items-center gap-1 font-medium",children:["üìÖ ",I==="antiga"?"‚Üë Mais Antigas":"‚Üì Mais Recentes"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[_.length," de ",s.length," selecionada(s)"]})]}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden mb-6",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:e.jsx("input",{type:"checkbox",checked:_.length===s.length,onChange:le,className:"rounded border-gray-300"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Venda"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Pago"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Saldo Devedor"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Dias"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(z=>{const ne=ce(z.data_venda),Ne=ne>30;return e.jsxs("tr",{className:`hover:bg-gray-50 ${_.includes(z.id)?"bg-blue-50":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:_.includes(z.id),onChange:()=>oe(z.id),className:"rounded border-gray-300"})}),e.jsxs("td",{className:"px-4 py-3 font-medium text-gray-900",children:["#",z.numero_venda]}),e.jsx("td",{className:"px-4 py-3 text-gray-600 text-sm",children:new Date(z.data_venda).toLocaleDateString("pt-BR")}),e.jsxs("td",{className:"px-4 py-3 text-right text-gray-900",children:["R$ ",parseFloat(z.total).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right text-green-600",children:["R$ ",parseFloat(z.total_pago).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-red-600",children:["R$ ",parseFloat(z.saldo_devedor).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${Ne?"bg-red-100 text-red-800":ne>15?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:[ne," ",ne===1?"dia":"dias"]})})]},z.id)})})]})}),_.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Registrar Pagamento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor Total Selecionado"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["R$ ",J.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor do Pagamento *"}),e.jsx("input",{type:"number",step:"0.01",value:M,onChange:z=>S(z.target.value),placeholder:"0.00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de Pagamento *"}),e.jsxs("select",{value:k,onChange:z=>t(z.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"dinheiro",children:"Dinheiro"}),e.jsx("option",{value:"pix",children:"PIX"}),e.jsx("option",{value:"debito",children:"Cart√£o de D√©bito"}),e.jsx("option",{value:"credito",children:"Cart√£o de Cr√©dito"}),e.jsx("option",{value:"transferencia",children:"Transfer√™ncia"})]})]}),(k==="pix"||k==="transferencia")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"N√∫mero da Transa√ß√£o"}),e.jsx("input",{type:"text",value:q,onChange:z=>E(z.target.value),placeholder:"C√≥digo/ID da transa√ß√£o",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes"}),e.jsx("textarea",{value:U,onChange:z=>te(z.target.value),rows:"2",placeholder:"Informa√ß√µes adicionais sobre o pagamento...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-start space-x-2 mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(_e,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Aten√ß√£o:"})," O valor ser√° aplicado automaticamente da venda mais antiga para a mais recente. Se o valor for insuficiente para quitar todas as vendas selecionadas, a √∫ltima venda ficar√° parcialmente paga."]})]}),e.jsx("button",{onClick:G,disabled:H||!M||parseFloat(M)<=0,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:H?e.jsxs(e.Fragment,{children:[e.jsx(Va,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(na,{className:"w-5 h-5"}),e.jsx("span",{children:"Baixar Vendas Selecionadas"})]})})]})]})})]})})}function jr({clienteId:i,clienteNome:y,onClose:c}){var M,S,k;const[u,s]=r.useState(null),[g,_]=r.useState(!0),[x,b]=r.useState("todos");r.useEffect(()=>{N()},[i]);const N=async()=>{try{_(!0);const t=await P.get(`/clientes/${i}/historico-compras`);s(t.data)}catch(t){console.error("Erro ao carregar hist√≥rico:",t),Ze.error("Erro ao carregar hist√≥rico do cliente")}finally{_(!1)}},H=t=>{const q={finalizada:"bg-green-100 text-green-800",baixa_parcial:"bg-yellow-100 text-yellow-800",pendente:"bg-blue-100 text-blue-800",cancelada:"bg-red-100 text-red-800",finalizada_devolucao_parcial:"bg-orange-100 text-orange-800",finalizada_devolucao_total:"bg-gray-100 text-gray-800"},E={finalizada:"Finalizada",baixa_parcial:"Baixa Parcial",pendente:"Pendente",cancelada:"Cancelada",finalizada_devolucao_parcial:"Dev. Parcial",finalizada_devolucao_total:"Dev. Total"};return e.jsx("span",{className:`inline-flex px-2 py-1 rounded-full text-xs font-medium ${q[t]||"bg-gray-100 text-gray-800"}`,children:E[t]||t})},h=((M=u==null?void 0:u.vendas)==null?void 0:M.filter(t=>x==="todos"?!0:t.status===x))||[];return g?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-8 max-w-4xl w-full mx-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Va,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando hist√≥rico..."})]})})}):u?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Hist√≥rico de Compras"}),e.jsx("p",{className:"text-gray-600 mt-1",children:y})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Fs,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Compras"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:u.total_compras})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(na,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Gasto"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",u.valor_total_gasto.toFixed(2)]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(ha,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Ticket M√©dio"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",u.ticket_medio.toFixed(2)]})]})]})})]}),u.ultima_compra&&e.jsxs("div",{className:"mt-4 bg-white rounded-lg p-3 shadow-sm flex items-center space-x-2 text-sm",children:[e.jsx(_t,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-gray-600",children:["√öltima compra: ",new Date(u.ultima_compra).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"})]})]})]}),e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtrar por status:"}),e.jsxs("select",{value:x,onChange:t=>b(t.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500",children:[e.jsxs("option",{value:"todos",children:["Todos (",((S=u.vendas)==null?void 0:S.length)||0,")"]}),e.jsx("option",{value:"finalizada",children:"Finalizadas"}),e.jsx("option",{value:"baixa_parcial",children:"Baixa Parcial"}),e.jsx("option",{value:"pendente",children:"Pendentes"}),e.jsx("option",{value:"cancelada",children:"Canceladas"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:h.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Fs,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:"Nenhuma venda encontrada"}),e.jsx("p",{className:"text-gray-600 mt-2",children:x==="todos"?"Este cliente ainda n√£o realizou compras.":"N√£o h√° vendas com este status."})]}):e.jsx("div",{className:"space-y-3",children:h.map(t=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Venda #",t.numero_venda]}),H(t.status)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Data:"}),e.jsx("div",{className:"font-medium text-gray-900",children:new Date(t.data_venda).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal:"}),e.jsxs("div",{className:"font-medium text-gray-900",children:["R$ ",t.subtotal.toFixed(2)]})]}),t.desconto_valor>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Desconto:"}),e.jsxs("div",{className:"font-medium text-red-600",children:["- R$ ",t.desconto_valor.toFixed(2)]})]}),t.taxa_entrega>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Taxa Entrega:"}),e.jsxs("div",{className:"font-medium text-gray-900",children:["R$ ",t.taxa_entrega.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total:"}),e.jsxs("div",{className:"font-bold text-gray-900 text-lg",children:["R$ ",t.total.toFixed(2)]})]}),t.saldo_devedor>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Saldo Devedor:"}),e.jsxs("div",{className:"font-bold text-red-600",children:["R$ ",t.saldo_devedor.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Itens:"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.total_itens})]}),t.vendedor_nome&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Vendedor:"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.vendedor_nome})]})]})]})})},t.id))})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[e.jsxs("span",{children:["Mostrando ",h.length," de ",((k=u.vendas)==null?void 0:k.length)||0," vendas"]}),e.jsx("button",{onClick:c,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:"Fechar"})]})})]})}):null}function vr({clienteId:i}){const[y,c]=r.useState(!1),[u,s]=r.useState(null),[g,_]=r.useState(null),[x,b]=r.useState(""),[N,H]=r.useState([]),[h,M]=r.useState(!1),S=r.useRef(null),[k,t]=r.useState({resumo:!1,pets:!1,compras:!1,oportunidades:!1,sugestoes:!1,relacionados:!1,sazonalidade:!1,chat:!1});r.useEffect(()=>{i&&q()},[i]);const q=async()=>{var j,J;try{c(!0),_(null);const G=await P.get(`/clientes/${i}/info-pdv`);s(G.data)}catch(G){console.error("Erro ao carregar informa√ß√µes do cliente:",G),_(((J=(j=G.response)==null?void 0:j.data)==null?void 0:J.detail)||"Erro ao carregar dados")}finally{c(!1)}},E=j=>{t(J=>({...J,[j]:!J[j]}))},U=async()=>{if(!x.trim())return;const j=x;b(""),H(J=>[...J,{tipo:"user",texto:j}]);try{M(!0);const J=await P.post(`/clientes/${i}/chat-pdv`,{mensagem:j});H(G=>[...G,{tipo:"ia",texto:J.data.resposta,ia_disponivel:J.data.ia_disponivel}]),setTimeout(()=>{var G;return(G=S.current)==null?void 0:G.scrollIntoView({behavior:"smooth"})},100)}catch(J){console.error("Erro no chat:",J),H(G=>[...G,{tipo:"erro",texto:"Erro ao processar mensagem. Tente novamente."}])}finally{M(!1)}},te=j=>{j.key==="Enter"&&!j.shiftKey&&(j.preventDefault(),U())};if(!i)return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 text-center text-gray-500",children:[e.jsx(Ta,{className:"mx-auto text-4xl mb-2"}),e.jsx("p",{children:"Selecione um cliente para ver informa√ß√µes"})]});if(y)return e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})});if(g)return e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:[e.jsx(oa,{className:"inline mr-2"}),g]});if(!u)return null;const{cliente:w,resumo_financeiro:F,pets:I,ultimas_compras:Q,oportunidades:R,sugestoes:oe,produtos_relacionados:le,padroes_sazonais:ce}=u;return e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden max-h-[85vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-100 to-purple-100 p-4 border-b",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 mb-1",children:w.nome}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[w.cpf_cnpj&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(Ta,{className:"text-xs"}),w.cpf_cnpj]}),w.telefone&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(Ct,{className:"text-xs"}),w.telefone]}),w.email&&e.jsxs("p",{className:"flex items-center gap-1 truncate",children:[e.jsx(Ft,{className:"text-xs"}),w.email]}),w.endereco&&e.jsxs("p",{className:"flex items-center gap-1 text-xs",children:[e.jsx(St,{className:"text-xs"}),w.endereco,", ",w.bairro," - ",w.cidade,"/",w.estado]})]})]})})}),e.jsxs(He,{titulo:"Resumo Financeiro",icone:e.jsx(Ps,{}),expandido:k.resumo,onToggle:()=>E("resumo"),badge:F.numero_compras,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:"Total Gasto"}),e.jsxs("p",{className:"text-lg font-bold text-green-700",children:["R$ ",F.total_gasto.toFixed(2)]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"Ticket M√©dio"}),e.jsxs("p",{className:"text-lg font-bold text-blue-700",children:["R$ ",F.ticket_medio.toFixed(2)]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-purple-600 font-medium mb-1",children:"N¬∫ Compras"}),e.jsx("p",{className:"text-lg font-bold text-purple-700",children:F.numero_compras})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-orange-600 font-medium mb-1",children:"Maior Compra"}),e.jsxs("p",{className:"text-lg font-bold text-orange-700",children:["R$ ",F.maior_compra.valor.toFixed(2)]}),F.maior_compra.data&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:F.maior_compra.data})]})]}),F.ultima_compra.data&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(kt,{className:"text-xs"}),"√öltima compra: ",F.ultima_compra.data," - R$ ",F.ultima_compra.valor.toFixed(2)]})})]}),I&&I.length>0&&e.jsx(He,{titulo:"Pets Registrados",icone:e.jsx(Ta,{}),expandido:k.pets,onToggle:()=>E("pets"),badge:I.length,children:e.jsx("div",{className:"space-y-2",children:I.map(j=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold",children:j.nome[0].toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800",children:j.nome}),e.jsxs("p",{className:"text-xs text-gray-500",children:[j.especie," ",j.raca&&`‚Ä¢ ${j.raca}`,j.peso&&` ‚Ä¢ ${j.peso}kg`,j.idade_anos!==null&&` ‚Ä¢ ${j.idade_anos} anos`]})]})]},j.id))})}),R&&R.length>0&&e.jsx(He,{titulo:"Oportunidades de Venda",icone:e.jsx(oa,{}),expandido:k.oportunidades,onToggle:()=>E("oportunidades"),badge:R.length,badgeColor:"bg-orange-500",children:e.jsx("div",{className:"space-y-2",children:R.map((j,J)=>e.jsxs("div",{className:`p-3 rounded-lg border-l-4 ${j.urgencia==="alta"?"bg-red-50 border-red-400":"bg-yellow-50 border-yellow-400"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:j.produto_nome}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:j.mensagem})]}),j.urgencia==="alta"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-red-500 text-white text-xs rounded-full",children:"Urgente"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Atrasado ",j.dias_atraso," dias"]})]},J))})}),oe&&oe.length>0&&e.jsx(He,{titulo:"Produtos Favoritos",icone:e.jsx($t,{}),expandido:k.sugestoes,onToggle:()=>E("sugestoes"),badge:oe.length,children:e.jsx("div",{className:"space-y-2",children:oe.map((j,J)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:j.nome}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Comprado ",j.vezes_comprado,"x",j.ultima_compra&&` ‚Ä¢ √öltima: ${j.ultima_compra}`]})]}),e.jsxs("p",{className:"font-bold text-indigo-600 ml-2",children:["R$ ",j.preco.toFixed(2)]})]},J))})}),Q&&Q.length>0&&e.jsx(He,{titulo:"√öltimas Compras",icone:e.jsx(Rt,{}),expandido:k.compras,onToggle:()=>E("compras"),badge:Q.length,children:e.jsx("div",{className:"space-y-3",children:Q.map((j,J)=>e.jsxs("div",{className:"border-l-4 border-indigo-300 pl-3 py-2 bg-gray-50 rounded-r-lg",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500",children:[j.data," ‚Ä¢ Venda #",j.numero_venda]}),e.jsxs("p",{className:"font-bold text-indigo-600",children:["R$ ",j.valor_total.toFixed(2)]})]})}),j.produtos&&j.produtos.length>0&&e.jsx("div",{className:"space-y-1 mt-2",children:j.produtos.map((G,z)=>e.jsxs("p",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(Et,{className:"text-xs"}),G.quantidade,"x ",G.nome," - R$ ",G.valor.toFixed(2)]},z))})]},J))})}),le&&le.length>0&&e.jsx(He,{titulo:"Produtos Comprados Juntos",icone:e.jsx(Dt,{}),expandido:k.relacionados,onToggle:()=>E("relacionados"),badge:le.length,badgeColor:"bg-purple-500",children:e.jsx("div",{className:"space-y-2",children:le.map((j,J)=>e.jsxs("div",{className:"p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"text-xs font-semibold text-purple-600",children:[j.vezes_juntos,"x comprados juntos"]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-800",children:j.produto1.nome}),e.jsxs("span",{className:"text-purple-600 font-bold",children:["R$ ",j.produto1.preco.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-800",children:j.produto2.nome}),e.jsxs("span",{className:"text-purple-600 font-bold",children:["R$ ",j.produto2.preco.toFixed(2)]})]})]}),e.jsx("p",{className:"text-xs text-purple-600 mt-2 italic",children:"üí° Sugest√£o: Oferecer combo!"})]},J))})}),ce&&ce.length>0&&e.jsx(He,{titulo:"Padr√µes de Compra",icone:e.jsx(Ma,{}),expandido:k.sazonalidade,onToggle:()=>E("sazonalidade"),badge:ce.length,badgeColor:"bg-green-500",children:e.jsx("div",{className:"space-y-2",children:ce.map((j,J)=>e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-green-700",children:j.mes_ano}),e.jsxs("span",{className:"text-sm text-green-600",children:[j.numero_compras," compras"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"font-bold text-green-700 ml-1",children:["R$ ",j.total_gasto.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Ticket m√©dio:"}),e.jsxs("span",{className:"font-bold text-green-700 ml-1",children:["R$ ",j.ticket_medio.toFixed(2)]})]})]})]},J))})}),e.jsx(He,{titulo:"Chat IA - Assistente de Vendas",icone:e.jsx(Tt,{}),expandido:k.chat,onToggle:()=>E("chat"),badgeColor:"bg-blue-500",children:e.jsxs("div",{className:"space-y-3",children:[N.length===0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Perguntas sugeridas:"}),["Quais os produtos favoritos?","Quando foi a √∫ltima compra?","Quais pets ele tem?","Quanto j√° gastou total?"].map((j,J)=>e.jsx("button",{onClick:()=>{b(j),setTimeout(()=>U(),100)},className:"w-full text-left px-3 py-2 text-xs bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition-colors",children:j},J))]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto space-y-2",children:[N.map((j,J)=>e.jsx("div",{className:`flex ${j.tipo==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] px-3 py-2 rounded-lg text-sm ${j.tipo==="user"?"bg-blue-600 text-white":j.tipo==="erro"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-800"}`,children:[j.texto,j.tipo==="ia"&&!j.ia_disponivel&&e.jsx("p",{className:"text-xs mt-1 opacity-70",children:"üí° Modo b√°sico (IA n√£o configurada)"})]})},J)),e.jsx("div",{ref:S})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:j=>b(j.target.value),onKeyPress:te,placeholder:"Digite sua pergunta...",disabled:h,className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"}),e.jsx("button",{onClick:U,disabled:h||!x.trim(),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(At,{className:"w-4 h-4"})})]})]})})]})}function He({titulo:i,icone:y,expandido:c,onToggle:u,badge:s,badgeColor:g="bg-indigo-500",children:_}){return e.jsxs("div",{className:"border-b border-gray-200",children:[e.jsxs("button",{onClick:u,className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-indigo-600",children:y}),e.jsx("h4",{className:"font-semibold text-gray-800",children:i}),s!==void 0&&e.jsx("span",{className:`${g} text-white text-xs px-2 py-1 rounded-full`,children:s})]}),c?e.jsx(Pt,{className:"text-gray-400"}):e.jsx(Vt,{className:"text-gray-400"})]}),c&&e.jsx("div",{className:"px-4 pb-4",children:_})]})}const yr=({mostrar:i,onFechar:y,dados:c,carregando:u})=>{if(r.useEffect(()=>{const x=b=>{b.key==="Escape"&&i&&y()};if(i)return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[i,y]),!i)return null;const s=x=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(x||0),g=x=>{switch(x){case"verde":return"bg-green-100 border-green-500 text-green-800";case"amarelo":return"bg-yellow-100 border-yellow-500 text-yellow-800";case"vermelho":return"bg-red-100 border-red-500 text-red-800";default:return"bg-gray-100 border-gray-500 text-gray-800"}},_=x=>{switch(x){case"success":return e.jsx(zt,{className:"text-green-500"});case"error":return e.jsx(oa,{className:"text-red-500"});case"warning":return e.jsx(oa,{className:"text-yellow-500"});case"info":return e.jsx(Ss,{className:"text-blue-500"});default:return e.jsx(Ss,{className:"text-gray-500"})}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:y}),e.jsxs("div",{className:"fixed right-0 top-0 h-full w-96 bg-white shadow-2xl z-50 flex flex-col animate-slide-in-right",children:[e.jsxs("div",{className:"p-4 border-b bg-gradient-to-r from-blue-600 to-blue-700 text-white flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ma,{className:"w-5 h-5"}),e.jsx("h3",{className:"text-lg font-bold",children:"An√°lise da Venda"})]}),e.jsx("button",{onClick:y,className:"hover:bg-white hover:bg-opacity-20 p-1 rounded transition-colors",children:e.jsx(Mt,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:u?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ps,{className:"text-blue-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"Composi√ß√£o Financeira"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Total dos Produtos"}),e.jsx("span",{className:"font-semibold",children:s(c.composicao.total_produtos)})]}),c.composicao.desconto>0&&e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"(-) Descontos Aplicados"}),e.jsxs("span",{className:"font-semibold",children:[s(c.composicao.desconto),e.jsxs("span",{className:"text-xs ml-1",children:["(",(c.composicao.desconto/c.composicao.total_produtos*100).toFixed(1),"%)"]})]})]}),c.composicao.taxa_entrega>0&&e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"(-) Taxa de Entrega"}),e.jsx("span",{className:"font-semibold",children:s(c.composicao.taxa_entrega)})]}),e.jsx("div",{className:"border-t-2 border-blue-600 pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-blue-700",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:s(c.composicao.subtotal)})]})})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(It,{className:"text-orange-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"Dedu√ß√µes"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[c.deducoes.comissao.valor>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Comiss√£o do Vendedor (",c.deducoes.comissao.percentual,"%)"]}),e.jsx("span",{className:"font-semibold text-red-600",children:s(c.deducoes.comissao.valor)})]}),c.detalhamento_taxas&&c.detalhamento_taxas.length>0&&e.jsx(e.Fragment,{children:c.detalhamento_taxas.map((x,b)=>e.jsxs(qt.Fragment,{children:[x.taxa_percentual>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-600",children:["Taxa ",x.forma," (",x.taxa_percentual,"%)"]}),e.jsx("span",{className:"text-xs text-gray-500",children:s(x.valor_pagamento)})]}),e.jsx("span",{className:"font-semibold text-red-600",children:s(x.valor_taxa_percentual)})]}),x.taxa_fixa>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-600",children:["Taxa Fixa ",x.forma]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["R$ ",x.taxa_fixa.toFixed(2)]})]}),e.jsx("span",{className:"font-semibold text-red-600",children:s(x.valor_taxa_fixa)})]})]},b))}),(!c.detalhamento_taxas||c.detalhamento_taxas.length===0)&&c.deducoes.taxa_percentual>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Taxa Percentual"}),e.jsx("span",{className:"font-semibold text-red-600",children:s(c.deducoes.taxa_percentual)})]}),(!c.detalhamento_taxas||c.detalhamento_taxas.length===0)&&c.deducoes.taxa_fixa>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Taxa Fixa"}),e.jsx("span",{className:"font-semibold text-red-600",children:s(c.deducoes.taxa_fixa)})]}),c.deducoes.impostos.valor>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Impostos Estimados (",c.deducoes.impostos.percentual,"%)"]}),e.jsx("span",{className:"font-semibold text-red-600",children:s(c.deducoes.impostos.valor)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Custo dos Produtos"}),e.jsx("span",{className:"font-semibold text-red-600",children:s(c.deducoes.custos)})]}),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-semibold text-gray-700",children:[e.jsx("span",{children:"Total de Dedu√ß√µes"}),e.jsx("span",{className:"text-red-600",children:s(c.deducoes.total_deducoes)})]})})]})]}),e.jsxs("div",{className:`rounded-lg p-4 border-2 ${g(c.resultado.cor_indicador)}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ma,{className:"w-5 h-5"}),e.jsx("h4",{className:"font-bold",children:"Resultado Final"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold",children:"Lucro L√≠quido Estimado"}),e.jsx("span",{className:"text-2xl font-bold",children:s(c.resultado.lucro_liquido)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Margem L√≠quida"}),e.jsxs("span",{className:"text-xl font-bold",children:[c.resultado.margem_liquida.toFixed(2),"%"]})]})]})]}),c.alertas&&c.alertas.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(oa,{className:"text-purple-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"Alertas e Sugest√µes"})]}),e.jsx("div",{className:"space-y-2",children:c.alertas.map((x,b)=>e.jsxs("div",{className:`flex items-start gap-2 p-2 rounded text-sm ${x.tipo==="success"?"bg-green-50":x.tipo==="error"?"bg-red-50":x.tipo==="warning"?"bg-yellow-50":"bg-blue-50"}`,children:[e.jsx("span",{className:"flex-shrink-0 mt-0.5",children:_(x.tipo)}),e.jsxs("span",{className:"flex-1",children:[e.jsx("span",{className:"mr-1",children:x.icone}),x.mensagem]})]},b))})]}),c.detalhamento_comissoes&&c.detalhamento_comissoes.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-3",children:"Detalhamento de Comiss√µes"}),e.jsx("div",{className:"space-y-2 text-sm",children:c.detalhamento_comissoes.map((x,b)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-700",children:x.produto}),e.jsxs("div",{className:"text-xs text-gray-500",children:[x.percentual,"% de comiss√£o"]})]}),e.jsx("span",{className:"font-semibold text-blue-600",children:s(x.valor)})]},b))})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(oa,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"Erro ao carregar an√°lise"})]})})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("button",{onClick:y,className:"w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Fechar"}),e.jsx("span",{className:"text-xs text-gray-300",children:"(ESC)"})]})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes slide-in-right {
          from {
            transform: translateX(100%);
          }
          to {
            transform: translateX(0);
          }
        }
        
        .animate-slide-in-right {
          animation: slide-in-right 0.3s ease-out;
        }
      `})]})};function Nr({itensCarrinho:i=[],onClose:y=()=>{},isOpen:c=!1,racaoIdFechada:u=null}){const[s,g]=r.useState(null),[_,x]=r.useState(!1),[b,N]=r.useState(null),[H,h]=r.useState(null),[M,S]=r.useState(!1),k=i.filter(E=>Xt(E));r.useEffect(()=>{c&&(console.log("ü•´ Modal: Ra√ß√µes encontradas:",k.length),k.forEach((E,U)=>{console.log(`  ${U+1}. ${E.produto_nome} - peso_embalagem: ${E.peso_embalagem}`)}))},[c,k.length]),r.useEffect(()=>{if(c&&k.length>0){const E=k[k.length-1];u!==E.produto_id&&(g(E.produto_id),N(null),h(null),x(!1))}},[c,k.length,u]);const t=k.find(E=>E.produto_id===s),q=async()=>{if(!t){h("Ra√ß√£o n√£o selecionada");return}if(!(t.peso_embalagem||t.peso_pacote_kg)||!t.preco_unitario){console.error("‚ùå Modal: Dados da ra√ß√£o incompletos",{peso_embalagem:t.peso_embalagem,peso_pacote_kg:t.peso_pacote_kg,preco_unitario:t.preco_unitario}),h("Dados da ra√ß√£o incompletos");return}try{x(!0),h(null),N(null);const U=t.peso_embalagem||t.peso_pacote_kg||1,te={especie:"cao",peso_kg:15,fase:"adulto",porte:"medio",tipo_racao:"premium",peso_pacote_kg:parseFloat(U),preco_pacote:parseFloat(t.preco_unitario)||0};console.log("üßë Modal: Enviando payload:",te);const w=await P.post("/internal/racao/calcular",te);w.data?N(w.data):h("Sem resposta do servidor")}catch(U){console.error("Erro ao calcular:",U),h(null)}finally{x(!1)}};return!c||k.length===0?(c&&k.length===0&&console.warn("‚ö†Ô∏è Modal: isOpen=true mas racoes.length=0"),null):(console.log("‚úÖ Modal: Renderizando com",k.length,"ra√ß√µes"),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-4 flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ü•´"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Calculadora de Ra√ß√£o"}),e.jsx("p",{className:"text-sm text-blue-100",children:"Informa√ß√µes r√°pidas"})]})]}),e.jsx("button",{onClick:()=>{y()},className:"p-1 hover:bg-blue-400 rounded-lg transition-colors",title:"Fechar",children:e.jsx(ue,{size:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[k.length>1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Selecionar Ra√ß√£o"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>S(!M),className:"w-full px-4 py-2 bg-white border border-gray-300 rounded-lg text-left flex items-center justify-between hover:border-blue-500 transition-colors",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:(t==null?void 0:t.produto_nome)||"Selecione uma ra√ß√£o"}),e.jsx(Ia,{size:20,className:`text-gray-500 transition-transform ${M?"rotate-180":""}`})]}),M&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg z-10 max-h-48 overflow-y-auto",children:k.map((E,U)=>e.jsxs("button",{onClick:()=>{g(E.produto_id),S(!1),N(null)},className:`w-full px-4 py-3 text-left border-b last:border-b-0 hover:bg-blue-50 transition-colors ${E.produto_id===s?"bg-blue-100 border-l-4 border-l-blue-600":""}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:E.produto_nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:[E.peso_embalagem||E.peso_pacote_kg?`${E.peso_embalagem||E.peso_pacote_kg}kg`:""," ‚Ä¢ R$ ",(E.preco_unitario||0).toFixed(2)]})]},U))})]})]}),t&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 space-y-2",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:t.produto_nome}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Pacote:"}),e.jsx("span",{className:"font-medium",children:t.peso_pacote_kg?`${t.peso_pacote_kg}kg`:"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Pre√ßo:"}),e.jsxs("span",{className:"font-medium text-blue-600",children:["R$ ",(t.preco_unitario||0).toFixed(2)]})]})]})]}),e.jsx("button",{onClick:q,disabled:_||!t,className:`w-full py-3 rounded-lg font-semibold transition-colors ${_||!t?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white cursor-pointer"}`,children:_?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ot,{size:18,className:"animate-spin"}),"Calculando..."]}):"üìä Calcular Consumo"}),b&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 space-y-3 border border-green-200",children:[e.jsx("h3",{className:"font-bold text-green-900 text-center",children:"‚úÖ C√°lculo Realizado"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Consumo Di√°rio"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:[(b.consumo_diario_gramas||0).toFixed(0),"g"]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Dura√ß√£o"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:[(b.duracao_pacote_dias||0).toFixed(1),"d"]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/Dia"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(b.custo_diario||0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/M√™s"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(b.custo_mensal||0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100 col-span-2",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/kg"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(b.custo_por_kg||0).toFixed(2)]})]})]})]}),H&&e.jsx("div",{className:"bg-yellow-50 rounded-lg p-3 text-sm text-yellow-700 border border-yellow-200",children:"‚ö†Ô∏è N√£o foi poss√≠vel calcular. Tente novamente."}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 text-xs text-gray-600 border border-gray-200 italic",children:"üí° Valores calculados com base em dados padr√£o. Para an√°lises personalizadas, utilize a calculadora completa."})]}),e.jsx("div",{className:"bg-gray-50 border-t px-6 py-3 flex justify-end gap-3 flex-shrink-0",children:e.jsx("button",{onClick:y,className:"px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-medium transition-colors",children:"Fechar"})})]})}))}function wr({isOpen:i,onClose:y,clienteId:c,produtoId:u=null,onPendenciaAdicionada:s=()=>{}}){const[g,_]=r.useState("listar"),[x,b]=r.useState([]),[N,H]=r.useState([]),[h,M]=r.useState(!1),[S,k]=r.useState(""),[t,q]=r.useState([]),[E,U]=r.useState(!1),[te,w]=r.useState(null),F=r.useRef(null),[I,Q]=r.useState({produto_id:u||"",quantidade_desejada:1,prioridade:"media",observacoes:""});r.useEffect(()=>{i&&c&&(R(),u||oe())},[i,c]),r.useEffect(()=>{if(S.trim()==="")q(N);else{const v=N.filter(W=>{var xe;return W.nome.toLowerCase().includes(S.toLowerCase())||((xe=W.codigo)==null?void 0:xe.toLowerCase().includes(S.toLowerCase()))});q(v)}},[S,N]),r.useEffect(()=>{const v=W=>{F.current&&!F.current.contains(W.target)&&U(!1)};return document.addEventListener("mousedown",v),()=>{document.removeEventListener("mousedown",v)}},[]);const R=async()=>{try{M(!0);const W=(await P.get(`/pendencias-estoque/cliente/${c}`)).data;b(Array.isArray(W==null?void 0:W.pendencias)?W.pendencias:[])}catch(v){console.error("Erro ao carregar pend√™ncias:",v),De.error("Erro ao carregar lista de espera"),b([])}finally{M(!1)}},oe=async()=>{var v;try{const W=await P.get("/produtos/",{params:{page:1,page_size:1e3,ativo:!0}}),xe=Array.isArray((v=W.data)==null?void 0:v.items)?W.data.items:[];console.log("Produtos carregados:",xe.length,xe),H(xe),q(xe)}catch(W){console.error("Erro ao carregar produtos:",W),De.error("Erro ao carregar produtos"),H([]),q([])}},le=v=>{w(v),k(v.nome),Q({...I,produto_id:v.id}),U(!1)},ce=()=>{w(null),k(""),Q({...I,produto_id:""}),q(N)},j=async()=>{var W,xe;if(!I.produto_id){De.error("Selecione um produto");return}const v={baixa:0,media:1,alta:2};try{M(!0),await P.post("/pendencias-estoque/",{cliente_id:c,produto_id:parseInt(I.produto_id),quantidade_desejada:parseFloat(I.quantidade_desejada),prioridade:v[I.prioridade]||1,observacoes:I.observacoes||null}),De.success("Cliente adicionado √† lista de espera!"),Q({produto_id:"",quantidade_desejada:1,prioridade:"media",observacoes:""}),ce(),_("listar"),R(),s()}catch(be){console.error("Erro ao adicionar pend√™ncia:",be),De.error(((xe=(W=be.response)==null?void 0:W.data)==null?void 0:xe.detail)||"Erro ao adicionar √† lista de espera")}finally{M(!1)}},J=async v=>{if(confirm("Deseja realmente cancelar esta pend√™ncia?"))try{await P.delete(`/pendencias-estoque/${v}`),De.success("Pend√™ncia cancelada"),R()}catch(W){console.error("Erro ao cancelar pend√™ncia:",W),De.error("Erro ao cancelar pend√™ncia")}},G=async(v,W)=>{try{await P.put(`/pendencias-estoque/${v}`,{prioridade:parseInt(W)}),De.success("Prioridade atualizada"),R()}catch(xe){console.error("Erro ao alterar prioridade:",xe),De.error("Erro ao alterar prioridade")}};if(!i)return null;const z=v=>{switch(v){case 2:return"text-red-600 bg-red-50";case 1:return"text-yellow-600 bg-yellow-50";case 0:return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},ne=v=>{switch(v){case 2:return"ALTA";case 1:return"M√âDIA";case 0:return"BAIXA";default:return"N/A"}},Ne=v=>{switch(v){case"pendente":return e.jsx(qa,{className:"w-4 h-4 text-yellow-500"});case"notificado":return e.jsx(Vs,{className:"w-4 h-4 text-blue-500"});case"finalizado":return e.jsx(pa,{className:"w-4 h-4 text-green-500"});default:return e.jsx(_e,{className:"w-4 h-4 text-gray-500"})}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-blue-50 to-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_e,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Lista de Espera - Produtos Sem Estoque"})]}),e.jsx("button",{onClick:y,className:"text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-200 transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{onClick:()=>_("listar"),className:`flex-1 px-4 py-3 font-medium transition-colors ${g==="listar"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:bg-gray-50"}`,children:["Lista de Espera (",x.length,")"]}),e.jsx("button",{onClick:()=>_("adicionar"),className:`flex-1 px-4 py-3 font-medium transition-colors ${g==="adicionar"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:bg-gray-50"}`,children:"Adicionar Pend√™ncia"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:g==="listar"?e.jsx("div",{className:"space-y-3",children:h?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Carregando..."}):x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_e,{className:"w-16 h-16 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Nenhuma pend√™ncia registrada"}),e.jsx("button",{onClick:()=>_("adicionar"),className:"mt-4 text-blue-600 hover:text-blue-700 font-medium",children:"Adicionar primeira pend√™ncia"})]}):x.map(v=>e.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Ne(v.status),e.jsx("h3",{className:"font-semibold text-gray-900",children:v.produto_nome||"Produto n√£o encontrado"}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${z(v.prioridade)}`,children:ne(v.prioridade)})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[v.produto_codigo&&e.jsxs("p",{children:["C√≥digo: ",e.jsx("span",{className:"font-medium",children:v.produto_codigo})]}),e.jsxs("p",{children:["Quantidade: ",v.quantidade_desejada," un."]}),v.valor_referencia&&e.jsxs("p",{children:["Valor ref.: R$ ",parseFloat(v.valor_referencia).toFixed(2)]}),e.jsxs("p",{children:["Status: ",e.jsx("span",{className:"font-medium",children:v.status})]}),e.jsxs("p",{children:["Registrado em: ",new Date(v.data_registro).toLocaleDateString("pt-BR")]}),v.data_notificacao&&e.jsxs("p",{children:["Notificado em: ",new Date(v.data_notificacao).toLocaleDateString("pt-BR")]}),v.observacoes&&e.jsxs("p",{className:"italic",children:["Obs: ",v.observacoes]})]})]}),e.jsx("div",{className:"flex flex-col gap-2 ml-4",children:v.status==="pendente"&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:v.prioridade,onChange:W=>G(v.id,W.target.value),className:"text-xs border rounded px-2 py-1",children:[e.jsx("option",{value:"0",children:"Baixa"}),e.jsx("option",{value:"1",children:"M√©dia"}),e.jsx("option",{value:"2",children:"Alta"})]}),e.jsx("button",{onClick:()=>J(v.id),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Cancelar pend√™ncia",children:e.jsx(Ca,{className:"w-4 h-4"})})]})})]})},v.id))}):e.jsxs("div",{className:"space-y-4 max-w-lg mx-auto",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Produto *"}),u?e.jsx("input",{type:"text",value:"Produto selecionado",disabled:!0,className:"w-full px-3 py-2 border rounded-lg bg-gray-50"}):e.jsxs("div",{ref:F,className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_a,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",value:S,onChange:v=>k(v.target.value),onFocus:()=>U(!0),placeholder:"Digite para buscar o produto...",className:"w-full pl-10 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),S&&e.jsx("button",{type:"button",onClick:ce,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(ue,{className:"w-4 h-4"})})]}),E&&t.length>0&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[t.slice(0,50).map(v=>e.jsxs("button",{type:"button",onClick:()=>le(v),className:"w-full px-4 py-3 text-left hover:bg-blue-50 border-b last:border-b-0 transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900",children:v.nome}),e.jsxs("div",{className:"text-sm text-gray-500",children:[v.codigo&&`C√≥digo: ${v.codigo} ‚Ä¢ `,"Estoque: ",v.estoque_atual||0,v.preco_venda&&` ‚Ä¢ R$ ${parseFloat(v.preco_venda).toFixed(2)}`]})]},v.id)),t.length>50&&e.jsxs("div",{className:"px-4 py-2 text-sm text-gray-500 text-center bg-gray-50",children:["Mostrando 50 de ",t.length," produtos. Continue digitando para refinar."]})]}),E&&S&&t.length===0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg p-4",children:e.jsx("p",{className:"text-gray-500 text-center",children:"Nenhum produto encontrado"})}),te&&e.jsx("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"‚úì Produto selecionado"}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:te.nome})]})})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantidade Desejada *"}),e.jsx("input",{type:"number",min:"1",value:I.quantidade_desejada,onChange:v=>Q({...I,quantidade_desejada:parseInt(v.target.value)||1}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prioridade"}),e.jsxs("select",{value:I.prioridade,onChange:v=>Q({...I,prioridade:v.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"baixa",children:"Baixa - N√£o tem pressa"}),e.jsx("option",{value:"media",children:"M√©dia - Normal"}),e.jsx("option",{value:"alta",children:"Alta - Urgente"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes"}),e.jsx("textarea",{value:I.observacoes,onChange:v=>Q({...I,observacoes:v.target.value}),rows:"3",placeholder:"Ex: Cliente pediu para avisar assim que chegar...",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"üì≤ O cliente ser√° notificado automaticamente via WhatsApp"})," quando o produto entrar no estoque."]})}),e.jsx("button",{onClick:j,disabled:h,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition-colors",children:h?"Adicionando...":"Adicionar √† Lista de Espera"})]})})]})})}function Ds(i){return i?i.variation_attributes&&typeof i.variation_attributes=="object"?Object.entries(i.variation_attributes).map(([c,u])=>`${c.charAt(0).toUpperCase()+c.slice(1)}: ${u}`).join(" | "):i.variation_signature?i.variation_signature.split("|").map(c=>{const[u,s]=c.split(":");return u&&s?`${u.charAt(0).toUpperCase()+u.slice(1)}: ${s}`:c}).join(" | "):"":""}function Rr(){var os,ns,ls,is,ds,cs,xs,ms,us;const i=Lt(),[y]=Bt(),{user:c}=Wt(),u=(c==null?void 0:c.is_admin)===!0,[s,g]=r.useState({cliente:null,pet:null,itens:[],subtotal:0,desconto_valor:0,desconto_percentual:0,total:0,observacoes:"",funcionario_id:null,entregador_id:null,tem_entrega:!1,entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}}),[_,x]=r.useState(""),[b,N]=r.useState(""),[H,h]=r.useState([]),[M,S]=r.useState([]),[k,t]=r.useState(!1),[q,E]=r.useState(!1),[U,te]=r.useState(!1),[w,F]=r.useState(!1),[I,Q]=r.useState(!1),[R,oe]=r.useState(!1),[le,ce]=r.useState(0),[j,J]=r.useState(null),[G,z]=r.useState([]),[ne,Ne]=r.useState("24h"),[v,W]=r.useState("todas"),[xe,be]=r.useState({vendaId:null,nome:""}),[$e,Oe]=r.useState(!1),[m,V]=r.useState(""),[O,D]=r.useState(!1),[A,$]=r.useState(!1),[he,de]=r.useState(""),[we,me]=r.useState(0),[fe,ke]=r.useState(!1),[Ee,Te]=r.useState(!1),[ee,ve]=r.useState(null),[la,fa]=r.useState(!1),[ja,Pe]=r.useState(!1),[L,Ve]=r.useState(null),[Sa,aa]=r.useState(!1),[Me,Je]=r.useState("valor"),[l,f]=r.useState(0),[C,B]=r.useState(!1),[Y,Z]=r.useState(null),[ie,Le]=r.useState([]),[Ae,ge]=r.useState(""),[Se,je]=r.useState(null),[Be,ia]=r.useState([]),[re,Re]=r.useState(null),[ka,$a]=r.useState(0);r.useEffect(()=>{g(a=>({...a,funcionario_id:(Y==null?void 0:Y.id)||null}))},[Y]),r.useEffect(()=>{console.log("üîÑ Sincronizando entregador_id:",(re==null?void 0:re.id)||null),g(a=>({...a,entregador_id:(re==null?void 0:re.id)||null}))},[re]);const[qs,Ea]=r.useState(!1),[zs,Os]=r.useState(null),[Ls,La]=r.useState(!1),[Bs,Ks]=r.useState({}),[Ke,Ba]=r.useState(()=>{const a=localStorage.getItem("pdv_painel_vendas_aberto");return a?JSON.parse(a):!1}),[Ge,Qs]=r.useState(()=>{const a=localStorage.getItem("pdv_painel_cliente_aberto");return a?JSON.parse(a):!1}),[Us,Ka]=r.useState(!1),[sa,da]=r.useState([]),[Cr,Qa]=r.useState({}),[Ua,Ha]=r.useState(0),[Ja,Hs]=r.useState(!1),[Js,Gs]=r.useState(null),Ga=r.useRef(null);r.useEffect(()=>{localStorage.setItem("pdv_painel_vendas_aberto",JSON.stringify(Ke))},[Ke]),r.useEffect(()=>{s.cliente&&Wa()},[s.cliente]),r.useEffect(()=>{var a;s.itens&&s.itens.length>0?sessionStorage.setItem("pdv_calculadora_data",JSON.stringify({itens:s.itens,clienteId:((a=s.cliente)==null?void 0:a.id)||null})):sessionStorage.removeItem("pdv_calculadora_data")},[s.itens,s.cliente]),r.useEffect(()=>{localStorage.setItem("pdv_painel_cliente_aberto",JSON.stringify(Ge))},[Ge]),r.useEffect(()=>{Xa();const a=setInterval(()=>{Xa()},3e4);return()=>clearInterval(a)},[we]);const Xa=async()=>{try{const a=await P.get("/caixas/aberto");ke(!!a.data)}catch{ke(!1)}};r.useEffect(()=>{Xs()},[]);const Xs=async()=>{try{const a=await P.get("/clientes/",{params:{is_entregador:!0,incluir_inativos:!1,limit:100}});let o=a.data.items||a.data.clientes||a.data||[];Array.isArray(o)||(console.error("‚ùå Resposta da API n√£o √© um array:",o),o=[]),ia(o);const n=o.find(d=>d.entregador_padrao===!0);n&&(Re(n),g(d=>({...d,entregador_id:n.id})),ca(n))}catch(a){console.error("Erro ao carregar entregadores:",a),De.error("Erro ao carregar lista de entregadores")}},ca=async a=>{if(!a){$a(0);return}let o=0;if(a.modelo_custo_entrega==="taxa_fixa"&&a.taxa_fixa_entrega)o=Number(a.taxa_fixa_entrega);else if(a.modelo_custo_entrega==="por_km"&&a.valor_por_km_entrega)o=0;else if(a.modelo_custo_entrega==="rateio_rh"&&a.controla_rh)try{o=(await P.get(`/entregadores/${a.id}/custo-operacional`)).data.custo_por_entrega||0}catch(n){console.error("Erro ao buscar custo RH:",n),o=a.custo_rh_ajustado||0}else try{o=(await P.get("/configuracoes/entregas")).data.taxa_fixa||0}catch(n){console.error("Erro ao buscar configura√ß√£o de entrega:",n),o=10}$a(o)};r.useEffect(()=>{s.tem_entrega&&re?ca(re):$a(0)},[re,s.tem_entrega]);const Wa=async()=>{if(!s.cliente){ce(0);return}try{const o=(await P.get(`/pendencias-estoque/cliente/${s.cliente.id}`)).data.filter(n=>n.status==="pendente"||n.status==="notificado");ce(o.length)}catch{ce(0)}},Ws=async a=>{if(!a||!s.cliente){da([]);return}try{const n=(await P.get(`/internal/pdv/oportunidades/${a}`)).data;n&&Array.isArray(n.oportunidades)?da(n.oportunidades):da([])}catch{da([])}},Ra=async(a,o)=>{try{const n={opportunity_id:o.id,event_type:a,user_id:c==null?void 0:c.id,contexto:"PDV",extra_data:{produto_origem_id:o.produto_origem_id||null,produto_sugerido_id:o.produto_sugerido_id||null,tipo_oportunidade:o.tipo||null,venda_id:s.id||null}};P.post("/internal/pdv/eventos-oportunidade",n).catch(()=>{})}catch{}};async function Zs(a){try{const o={produto_id:a.produto_id,preco_unitario:a.preco_unitario,quantidade:a.quantidade},{data:n}=await P.post("/pdv/fiscal/calcular",o);return n}catch(o){return console.error("Erro ao calcular fiscal:",o),null}}r.useEffect(()=>{async function a(){let o=0;const n={};for(const d of s.itens){const p=await Zs(d);p&&(n[d.produto_id]=p,o+=Number(p.total_impostos))}Qa(n),Ha(o.toFixed(2))}s.itens&&s.itens.length>0?a():(Qa({}),Ha(0))},[s.itens]),r.useEffect(()=>{ta()},[ne,v,$e,m]),r.useEffect(()=>{const a=y.get("venda");a&&va(parseInt(a))},[y]),r.useEffect(()=>{const a=sessionStorage.getItem("abrirVenda"),o=sessionStorage.getItem("abrirModalPagamento");a&&o==="true"&&(sessionStorage.removeItem("abrirVenda"),sessionStorage.removeItem("abrirModalPagamento"),va(parseInt(a),!0))},[]);const Ys=()=>{ve({tipo:"entrega",apelido:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",estado:""}),Te(!0)},Da=()=>{Te(!1),ve(null)},et=async a=>{if(!(!a||a.length!==9)){fa(!0);try{const n=await(await fetch(`https://viacep.com.br/ws/${a.replace("-","")}/json/`)).json();if(n.erro){alert("CEP n√£o encontrado");return}ve(d=>({...d,endereco:n.logradouro||"",bairro:n.bairro||"",cidade:n.localidade||"",estado:n.uf||""}))}catch(o){console.error("Erro ao buscar CEP:",o),alert("Erro ao buscar CEP")}finally{fa(!1)}}},at=async()=>{if(!ee.cep||!ee.endereco||!ee.cidade){alert("Preencha pelo menos CEP, Endere√ßo e Cidade");return}if(!s.cliente||!s.cliente.id){alert("Selecione um cliente primeiro");return}try{const a=await ma(s.cliente.id),o=a.enderecos_adicionais||[];o.push({...ee}),await P.put(`/clientes/${s.cliente.id}`,{...a,enderecos_adicionais:o});const n=await ma(s.cliente.id);g({...s,cliente:n}),alert("Endere√ßo adicionado com sucesso!"),Da()}catch(a){console.error("Erro ao salvar endere√ßo:",a),alert("Erro ao salvar endere√ßo. Tente novamente.")}},st=a=>{Ve({...a,preco:a.preco_unitario,descontoValor:a.desconto_valor||0,descontoPercentual:a.desconto_percentual||0,tipoDesconto:"valor"}),Pe(!0)},tt=()=>{const a=s.itens.map(o=>{if(o.produto_id===L.produto_id){const n=L.preco,d=o.quantidade,p=n*d;let T=0,K=0;L.tipoDesconto==="valor"?(T=parseFloat(L.descontoValor)||0,K=p>0?T/p*100:0):(K=parseFloat(L.descontoPercentual)||0,T=p*K/100);const se=n-T/d,ae=p-T;return{...o,desconto_valor:T,desconto_percentual:K,tipo_desconto_aplicado:L.tipoDesconto,preco_com_desconto:se,subtotal:ae}}return o});Xe(a),Pe(!1),Ve(null)},rt=()=>{s.desconto_valor>0?(Je("valor"),f(s.desconto_valor)):(Je("valor"),f(0)),aa(!0)},ot=(a,o)=>{const n=s.itens;if(n.length===0)return;const d=n.map(ae=>(ae.preco_unitario||ae.preco_venda)*ae.quantidade),p=d.reduce((ae,X)=>ae+X,0);let T=0;if(a==="valor")T=Math.min(parseFloat(o)||0,p);else{const ae=Math.min(parseFloat(o)||0,100);T=p*ae/100}let K=0;const se=n.map((ae,X)=>{const pe=d[X];let ye;if(X===n.length-1)ye=parseFloat((T-K).toFixed(2));else{const ya=p>0?pe/p:0;ye=parseFloat((T*ya).toFixed(2)),K+=ye}const Ie=pe>0?ye/pe*100:0,qe=pe-ye,ra=ae.quantidade>0?qe/ae.quantidade:0;return{...ae,desconto_valor:ye,desconto_percentual:Ie,tipo_desconto_aplicado:a,preco_com_desconto:ra,subtotal:qe}});Xe(se),aa(!1)},nt=()=>{const a=s.itens.map(o=>{const n=(o.preco_unitario||o.preco_venda)*o.quantidade;return{...o,desconto_valor:0,desconto_percentual:0,tipo_desconto_aplicado:null,preco_com_desconto:o.preco_unitario||o.preco_venda,subtotal:n}});Xe(a)},ta=async()=>{try{const a=new Date;let o;ne==="24h"?o=new Date(a.getTime()-24*60*60*1e3):ne==="7d"?o=new Date(a.getTime()-7*24*60*60*1e3):o=new Date(a.getTime()-30*24*60*60*1e3);const n={data_inicio:o.toISOString().split("T")[0],data_fim:a.toISOString().split("T")[0],per_page:50};m.trim()?(n.busca=m.trim(),delete n.data_inicio,delete n.data_fim):(v==="pago"?n.status="finalizada":v==="aberta"&&(n.status="aberta"),$e===!0&&(n.tem_entrega=!0)),console.log("üìä Par√¢metros de busca de vendas:",n);const d=await Rs(n);z(d.vendas||[])}catch(a){console.error("Erro ao carregar vendas:",a)}},lt=(a,o)=>{a.stopPropagation(),be({vendaId:o,nome:""})},Za=async(a,o)=>{a.stopPropagation();try{await P.post(`/vendas/${o}/marcar-entregue`,{retirado_por:xe.nome.trim()||null}),be({vendaId:null,nome:""}),ta()}catch(n){console.error("Erro ao confirmar retirada:",n)}},va=async(a,o=!1)=>{var n;try{D(!0);const d=await wa(a);if(!d){alert("Venda n√£o encontrada");return}let p=null;if(d.cliente_id)try{p=await ma(d.cliente_id)}catch(X){console.error("Erro ao buscar cliente:",X)}let T=[],K=0;try{const X=await P.get(`/vendas/${a}/pagamentos`);T=X.data.pagamentos||[],K=X.data.total_pago||0}catch(X){console.error("Erro ao buscar pagamentos:",X)}console.log("üîç Venda carregada - funcionario_id:",d.funcionario_id);let se=null;if(d.funcionario_id)try{const pe=((n=(await P.get("/comissoes/configuracoes/funcionarios")).data)==null?void 0:n.data)||[];console.log("üìã Funcion√°rios dispon√≠veis:",pe),se=pe.find(ye=>ye.id===d.funcionario_id),se?(B(!0),Z(se),console.log("‚úÖ Funcion√°rio comiss√£o carregado:",se)):console.warn("‚ö†Ô∏è Funcion√°rio ID",d.funcionario_id,"n√£o encontrado na lista")}catch(X){console.error("Erro ao carregar funcion√°rio de comiss√£o:",X)}else console.log("‚ÑπÔ∏è Venda sem funcionario_id - limpando estados de comiss√£o"),B(!1),Z(null),ge("");const ae={id:d.id,numero_venda:d.numero_venda,status:d.status,data_venda:d.data_venda,cliente:p,pet:null,itens:d.itens||[],subtotal:d.subtotal||0,desconto_valor:d.desconto_valor||0,desconto_percentual:d.desconto_percentual||0,total:d.total||0,observacoes:d.observacoes||"",funcionario_id:d.funcionario_id||null,entregador_id:d.entregador_id||null,tem_entrega:d.tem_entrega||!1,entrega:d.entrega||{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""},pagamentos:T,total_pago:K};if(g(ae),$(!0),d.entregador_id){console.log("üîç Venda tem entregador_id:",d.entregador_id);try{const pe=(await P.get(`/clientes/${d.entregador_id}`)).data;pe&&pe.is_entregador?(console.log("‚úÖ Entregador carregado:",pe.nome),Re(pe),ca(pe)):console.warn("‚ö†Ô∏è Cliente ID",d.entregador_id,"n√£o √© um entregador v√°lido")}catch(X){console.error("‚ùå Erro ao carregar entregador:",X);const pe=Be.find(ye=>ye.id===d.entregador_id);pe&&(console.log("‚úÖ Entregador encontrado no array (fallback):",pe.nome),Re(pe),ca(pe))}}else console.log("‚ÑπÔ∏è Venda sem entregador_id - limpando entregadorSelecionado"),Re(null);o&&setTimeout(()=>{t(!0)},500)}catch(d){console.error("Erro ao carregar venda:",d),alert("Erro ao carregar venda: "+(d.message||"Erro desconhecido"))}finally{D(!1)}},Ya=async()=>{var a;if(he.trim())try{D(!0);const o=he.replace(/\D/g,"");if(!o){alert("Digite um n√∫mero de venda v√°lido"),D(!1);return}console.log("üîç Buscando venda com n√∫mero:",o);const n=await Rs({busca:o,per_page:50});if(console.log("üìä Vendas encontradas:",(a=n.vendas)==null?void 0:a.length),!n.vendas||n.vendas.length===0){alert(`Nenhuma venda encontrada com "${o}"`),D(!1);return}if(n.vendas.length===1){await va(n.vendas[0].id),de("");return}const d=n.vendas.slice(0,10).map((K,se)=>`${se+1}. ${K.numero_venda} - ${K.cliente_nome||"Sem cliente"} - ${K.status}`).join(`
`),p=prompt(`Encontradas ${n.vendas.length} vendas. Digite o n√∫mero da op√ß√£o:

${d}`),T=parseInt(p)-1;T>=0&&T<n.vendas.length&&(await va(n.vendas[T].id),de(""))}catch(o){console.error("Erro ao buscar venda:",o),alert("Erro ao buscar venda: "+(o.message||"Erro desconhecido"))}finally{D(!1)}};r.useEffect(()=>{if(_.length>=2){const a=setTimeout(async()=>{try{const o=_.replace(/[()\-\s]/g,""),n=await rr({search:o});h(n||[])}catch(o){console.error("Erro ao buscar clientes:",o),h([])}},300);return()=>clearTimeout(a)}else h([])},[_]),r.useEffect(()=>{if(b.length>=2){const a=setTimeout(async()=>{try{const n=(await Zt({busca:b})).data.items||[];S(n)}catch(o){console.error("Erro ao buscar produtos:",o),S([])}},300);return()=>clearTimeout(a)}else S([])},[b]);const es=async a=>{g({...s,cliente:a,pet:null}),x(""),h([]);try{const o=await P.get(`/clientes/${a.id}/vendas-em-aberto`);o.data.resumo.total_vendas>0?J(o.data.resumo):J(null)}catch(o){console.error("Erro ao verificar vendas em aberto:",o),J(null)}},it=a=>{g({...s,pet:a})},dt=a=>{var d,p;if(!fe){alert("‚ùå N√£o √© poss√≠vel adicionar produtos sem caixa aberto. Abra um caixa primeiro.");return}console.log("üõí Produto sendo adicionado:",{nome:a.nome,categoria_id:a.categoria_id,categoria_nome:a.categoria_nome,peso_embalagem:a.peso_embalagem,classificacao_racao:a.classificacao_racao});const o=s.itens.find(T=>T.produto_id===a.id);let n;o?n=s.itens.map(T=>T.produto_id===a.id?{...T,quantidade:T.quantidade+1,subtotal:(T.quantidade+1)*T.preco_unitario}:T):n=[...s.itens,{tipo:"produto",produto_id:a.id,produto_nome:a.nome,quantidade:1,preco_unitario:parseFloat(a.preco_venda),desconto_item:0,subtotal:parseFloat(a.preco_venda),pet_id:((d=s.pet)==null?void 0:d.id)||null,tipo_produto:a.tipo_produto,tipo_kit:a.tipo_kit,composicao_kit:a.composicao_kit||[],categoria_id:a.categoria_id,categoria_nome:a.categoria_nome,peso_pacote_kg:a.peso_liquido||a.peso_bruto,peso_embalagem:a.peso_embalagem,classificacao_racao:a.classificacao_racao}],Xe(n),N(""),S([]),(p=Ga.current)==null||p.focus()},as=(a,o)=>{const n=s.itens.map((d,p)=>{if(p===a){const T=Math.max(1,d.quantidade+o),K=T*d.preco_unitario;let se=d.desconto_valor||0;d.tipo_desconto_aplicado==="percentual"&&d.desconto_percentual>0&&(se=K*d.desconto_percentual/100);const ae=K-se;return{...d,quantidade:T,desconto_valor:se,subtotal:ae}}return d});Xe(n)},ss=a=>{const o=s.itens.filter((n,d)=>d!==a);Xe(o)},ct=a=>{Ks(o=>({...o,[a]:!o[a]}))},Xe=a=>{var se;const o=a.reduce((ae,X)=>ae+X.subtotal,0),n=a.reduce((ae,X)=>ae+(X.desconto_valor||0),0),d=o+n,p=d>0?n/d*100:0,T=s.tem_entrega&&((se=s.entrega)==null?void 0:se.taxa_entrega_total)||0,K=o+T;g({...s,itens:a,subtotal:o,desconto_valor:n,desconto_percentual:p,total:K})},ts=async()=>{var a,o,n,d,p,T,K,se,ae,X,pe,ye,Ie,qe,ra,ya,gs,ps,bs,hs,fs,js,vs,ys;if(s.itens.length===0){alert("Adicione pelo menos um produto ou servi√ßo");return}if(!fe){alert("‚ùå N√£o √© poss√≠vel salvar venda sem caixa aberto. Abra um caixa primeiro.");return}if(!O){D(!0);try{if(s.id){await P.put(`/vendas/${s.id}`,{cliente_id:(a=s.cliente)==null?void 0:a.id,funcionario_id:s.funcionario_id,itens:s.itens.map(Fe=>{var xa;return{tipo:Fe.tipo,produto_id:Fe.produto_id,servico_descricao:Fe.servico_descricao,quantidade:Fe.quantidade,preco_unitario:Fe.preco_unitario||Fe.preco_venda,desconto_item:0,subtotal:Fe.subtotal,lote_id:Fe.lote_id,pet_id:Fe.pet_id||((xa=s.pet)==null?void 0:xa.id)}}),desconto_valor:0,desconto_percentual:0,observacoes:s.observacoes,tem_entrega:s.tem_entrega,taxa_entrega:((o=s.entrega)==null?void 0:o.taxa_entrega_total)||0,endereco_entrega:(n=s.entrega)==null?void 0:n.endereco_completo,observacoes_entrega:(d=s.entrega)==null?void 0:d.observacoes_entrega,distancia_km:(p=s.entrega)==null?void 0:p.distancia_km,valor_por_km:(T=s.entrega)==null?void 0:T.valor_por_km,loja_origem:(K=s.entrega)==null?void 0:K.loja_origem,entregador_id:s.entregador_id}),console.log("üö® DEBUG - Payload sendo enviado:",{tem_entrega:s.tem_entrega,entregador_id:s.entregador_id,vendaAtual_completo:s});let Ce=0;try{Ce=(await P.get(`/vendas/${s.id}/pagamentos`)).data.total_pago||0}catch(Fe){console.error("Erro ao buscar pagamentos:",Fe)}const We=s.total;let Ue="aberta";Ce>=We-.01?Ue="finalizada":Ce>0&&(Ue="baixa_parcial"),s.status!==Ue&&(await P.patch(`/vendas/${s.id}/status`,{status:Ue}),console.log(`‚úÖ Status atualizado: ${s.status} ‚Üí ${Ue}`)),alert("Venda atualizada com sucesso!"),Qe()}else{console.log("üöÄ CRIANDO VENDA - Vers√£o 2.0 - DESCONTOS ZERADOS"),console.log("Desconto valor:",0),console.log("Desconto percentual:",0),console.log("‚úÖ Checkbox Venda Comissionada:",C),console.log("üíº Funcion√°rio Comiss√£o:",Y),console.log("üìã Funcion√°rio ID enviado:",(Y==null?void 0:Y.id)||null),C&&!Y&&console.error("‚ö†Ô∏è ERRO: Checkbox marcado mas funcion√°rio n√£o selecionado!");const Ce=((se=s.entrega)==null?void 0:se.taxa_entrega_total)||0,We=((ae=s.entrega)==null?void 0:ae.taxa_loja)||0,Ue=((X=s.entrega)==null?void 0:X.taxa_entregador)||0,Fe=Ce>0?We/Ce*100:100,xa=Ce>0?Ue/Ce*100:0,Ns={cliente_id:(pe=s.cliente)==null?void 0:pe.id,funcionario_id:s.funcionario_id,itens:s.itens.map(ze=>{var ws;return{tipo:ze.tipo,produto_id:ze.produto_id,servico_descricao:ze.servico_descricao,quantidade:ze.quantidade,preco_unitario:ze.preco_unitario||ze.preco_venda,desconto_item:0,subtotal:ze.subtotal,lote_id:ze.lote_id,pet_id:ze.pet_id||((ws=s.pet)==null?void 0:ws.id)}}),desconto_valor:0,desconto_percentual:0,observacoes:s.observacoes,tem_entrega:s.tem_entrega,taxa_entrega:((ye=s.entrega)==null?void 0:ye.taxa_entrega_total)||0,percentual_taxa_loja:Fe,percentual_taxa_entregador:xa,endereco_entrega:(Ie=s.entrega)==null?void 0:Ie.endereco_completo,observacoes_entrega:(qe=s.entrega)==null?void 0:qe.observacoes_entrega,distancia_km:(ra=s.entrega)==null?void 0:ra.distancia_km,valor_por_km:(ya=s.entrega)==null?void 0:ya.valor_por_km,loja_origem:(gs=s.entrega)==null?void 0:gs.loja_origem,entregador_id:s.entregador_id};console.log("üì¶ PAYLOAD COMPLETO antes de enviar:",JSON.stringify(Ns,null,2)),console.log("üöö Dados de entrega:",{tem_entrega:s.tem_entrega,entregador_id:s.entregador_id,entregadorSelecionado:re==null?void 0:re.id,vendaAtual_completo:s}),console.log("üí∞ Percentuais calculados:",{taxaTotal:Ce,taxaLoja:We,taxaEntregador:Ue,percentualLoja:`${Fe.toFixed(2)}%`,percentualEntregador:`${xa.toFixed(2)}%`}),await Is(Ns),alert("Venda salva com sucesso!"),Qe()}ta()}catch(Ce){console.error("‚ùå Erro ao salvar venda:",Ce),console.error("‚ùå Resposta do servidor:",(ps=Ce.response)==null?void 0:ps.data),console.error("‚ùå Status:",(bs=Ce.response)==null?void 0:bs.status),console.error("‚ùå Headers:",(hs=Ce.response)==null?void 0:hs.headers);const We=((js=(fs=Ce.response)==null?void 0:fs.data)==null?void 0:js.detail)||((ys=(vs=Ce.response)==null?void 0:vs.data)==null?void 0:ys.message)||"Erro ao salvar venda";console.error("‚ùå Detalhes do erro:",We),alert(`Erro ao salvar venda: ${We}`)}finally{D(!1)}}},xt=async a=>{var o;console.log("üîç DEBUG formasPagamento recebidas:",a),La(!0),Ea(!0);try{console.log("üí∞ Enviando an√°lise com m√∫ltiplas formas:",a);const n=await P.post("/formas-pagamento/analisar-venda",{items:s.itens.map(d=>({produto_id:d.produto_id,quantidade:d.quantidade,preco_venda:d.preco_unitario||d.preco_venda,custo:d.custo})),desconto:s.desconto_valor||0,taxa_entrega:((o=s.entrega)==null?void 0:o.taxa_entrega_total)||0,formas_pagamento:a,vendedor_id:s.funcionario_id});console.log("‚úÖ Resposta da an√°lise:",n.data),Os(n.data)}catch(n){console.error("Erro ao buscar an√°lise:",n),alert("Erro ao carregar an√°lise da venda"),Ea(!1)}finally{La(!1)}},rs=()=>{if(s.itens.length===0){alert("Adicione pelo menos um produto ou servi√ßo");return}if(s.status==="finalizada"||s.status==="pago_nf"){alert('Esta venda est√° finalizada. Clique em "Reabrir Venda" para modificar.');return}t(!0)},Qe=()=>{g({cliente:null,pet:null,itens:[],subtotal:0,desconto_valor:0,desconto_percentual:0,total:0,observacoes:"",funcionario_id:null,entregador_id:(re==null?void 0:re.id)||null,tem_entrega:!1,entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}}),B(!1),Z(null),ge(""),$(!1)},mt=async a=>{var o,n,d;try{const p=await wa(a.id);let T=null;p.cliente_id&&(T=await ma(p.cliente_id));let K=[],se=0;try{const X=await P.get(`/vendas/${a.id}/pagamentos`);K=X.data.pagamentos||[],se=X.data.total_pago||0}catch(X){console.error("Erro ao buscar pagamentos:",X)}if(console.log("üîç Venda carregada - funcionario_id:",p.funcionario_id),p.funcionario_id)try{const ye=(((o=(await P.get("/comissoes/configuracoes/funcionarios")).data)==null?void 0:o.data)||[]).find(Ie=>Ie.id===p.funcionario_id);ye?(B(!0),Z(ye),console.log("‚úÖ Funcion√°rio comiss√£o carregado:",ye)):console.warn("‚ö†Ô∏è Funcion√°rio ID",p.funcionario_id,"n√£o encontrado na lista")}catch(X){console.error("Erro ao carregar funcion√°rio de comiss√£o:",X)}else console.log("‚ÑπÔ∏è Venda sem funcionario_id - limpando estados de comiss√£o"),B(!1),Z(null),ge("");const ae={id:p.id,numero_venda:p.numero_venda,data_venda:p.data_venda,cliente:T,pet:null,itens:p.itens||[],subtotal:parseFloat(p.subtotal||p.total),desconto_valor:parseFloat(p.desconto_valor||0),desconto_percentual:parseFloat(p.desconto_percentual||0),total:parseFloat(p.total),observacoes:p.observacoes||"",status:p.status,tem_entrega:p.tem_entrega||!1,entregador_id:p.entregador_id||null,entrega:{endereco_completo:p.endereco_entrega||"",endereco_id:p.endereco_id||null,taxa_entrega_total:parseFloat(parseFloat(p.taxa_entrega||0).toFixed(2)),taxa_loja:parseFloat(parseFloat(((n=p.entrega)==null?void 0:n.taxa_loja)||0).toFixed(2)),taxa_entregador:parseFloat(parseFloat(((d=p.entrega)==null?void 0:d.taxa_entregador)||0).toFixed(2)),observacoes_entrega:p.observacoes_entrega||"",distancia_km:p.distancia_km||0,valor_por_km:p.valor_por_km||0,loja_origem:p.loja_origem||"",status_entrega:p.status_entrega||"pendente"},pagamentos:K,total_pago:se};g(ae),$(!0),window.scrollTo({top:0,behavior:"smooth"})}catch(p){console.error("Erro ao reabrir venda:",p),alert("Erro ao carregar os dados da venda")}},ut=()=>{$(!1)},gt=async()=>{if(!s.id){Qe();return}if(Se&&s.status!==Se)try{D(!0),await P.patch(`/vendas/${s.id}/status`,{status:Se}),console.log(`‚úÖ Status restaurado para: ${Se} (altera√ß√µes descartadas)`)}catch(a){console.error("Erro ao restaurar status:",a)}finally{D(!1)}je(null),Qe()},pt=async()=>{var o,n;if(!(!s.id||!window.confirm(`Deseja realmente excluir esta venda?

Esta a√ß√£o n√£o pode ser desfeita e o estoque ser√° devolvido.`)))try{D(!0),await P.delete(`/vendas/${s.id}`),Qe(),ta(),alert("Venda exclu√≠da com sucesso!")}catch(d){console.error("Erro ao excluir venda:",d);const p=(n=(o=d.response)==null?void 0:o.data)==null?void 0:n.detail;if(p&&typeof p=="object"){let T=`‚ùå ${p.erro||"Erro ao excluir venda"}

`;T+=`${p.mensagem||""}

`,p.solucao&&(T+=`üí° Solu√ß√£o:
${p.solucao}

`),p.passos&&Array.isArray(p.passos)&&(T+=`üìã Passos para resolver:
`,p.passos.forEach(K=>{T+=`${K}
`})),p.rota_id&&(T+=`
üöö Rota ID: ${p.rota_id}`,p.rota_status&&(T+=` (${p.rota_status})`)),alert(T)}else alert(typeof p=="string"?p:"Erro ao excluir venda. Verifique se n√£o h√° v√≠nculos pendentes.")}finally{D(!1)}},bt=async()=>{var o,n;if(!(!s.id||!window.confirm(`Deseja reabrir esta venda?

Os pagamentos ser√£o mantidos e o status mudar√° para "aberta".`))){je(s.status);try{D(!0),await P.post(`/vendas/${s.id}/reabrir`);const d=await wa(s.id);let p=null;d.cliente_id&&(p=await ma(d.cliente_id)),g({id:d.id,numero_venda:d.numero_venda,data_venda:d.data_venda,cliente:p,pet:null,itens:d.itens||[],subtotal:parseFloat(d.subtotal||d.total),desconto_valor:parseFloat(d.desconto_valor||0),desconto_percentual:parseFloat(d.desconto_percentual||0),total:parseFloat(d.total),observacoes:d.observacoes||"",status:"aberta",tem_entrega:d.tem_entrega||!1,entrega:{endereco_completo:d.endereco_entrega||"",endereco_id:d.endereco_id||null,taxa_entrega_total:parseFloat(parseFloat(d.taxa_entrega||0).toFixed(2)),taxa_loja:parseFloat(parseFloat(d.taxa_loja||0).toFixed(2)),taxa_entregador:parseFloat(parseFloat(d.taxa_entregador||0).toFixed(2)),observacoes_entrega:d.observacoes_entrega||"",distancia_km:d.distancia_km||0,valor_por_km:d.valor_por_km||0,loja_origem:d.loja_origem||"",status_entrega:d.status_entrega||"pendente"}}),$(!1),alert(`Venda reaberta com sucesso! Agora voc√™ pode edit√°-la.

ATEN√á√ÉO: Se voc√™ n√£o fizer altera√ß√µes e sair, a venda voltar√° ao status anterior.`)}catch(d){console.error("Erro ao reabrir venda:",d),alert(((n=(o=d.response)==null?void 0:o.data)==null?void 0:n.detail)||"Erro ao reabrir venda")}finally{D(!1)}}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"bg-white border-b px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Kt,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Ponto de Venda"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Buscar venda (Ex: 0011)",value:he,onChange:a=>de(a.target.value),onKeyPress:a=>{a.key==="Enter"&&he.trim()&&Ya()},className:"pl-10 pr-4 py-2 w-64 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"}),e.jsx(_a,{className:"w-5 h-5 text-gray-400 absolute left-3 top-2.5"})]}),e.jsx("button",{onClick:Ya,disabled:!he.trim()||O,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Buscar"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[s.cliente&&e.jsxs("button",{onClick:()=>oe(!0),className:"flex items-center space-x-2 px-4 py-2 bg-white hover:bg-orange-50 border-2 border-orange-400 rounded-lg transition-colors relative",title:"Lista de espera - Produtos sem estoque",children:[e.jsx(Vs,{className:"w-5 h-5 text-orange-500"}),le>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center",children:le})]}),s.cliente&&e.jsxs("button",{onClick:()=>{Ka(!0),s.id&&Ws(s.id)},className:"flex items-center space-x-2 px-4 py-2 bg-white hover:bg-yellow-50 border-2 border-yellow-400 rounded-lg transition-colors",title:"Ver oportunidades de venda",children:[e.jsx(ks,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"}),sa.length>0&&e.jsx("span",{className:"font-semibold text-yellow-600",children:Math.min(sa.length,6)})]}),e.jsx(br,{onAbrirCaixa:()=>te(!0)},we),e.jsxs("button",{onClick:()=>i("/meus-caixas"),className:"flex items-center space-x-2 px-4 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-colors",title:"Ver hist√≥rico de caixas",children:[e.jsx(ba,{className:"w-5 h-5"}),e.jsx("span",{children:"Meus Caixas"})]}),!A&&s.id&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:gt,disabled:O,className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ue,{className:"w-5 h-5"}),e.jsx("span",{children:"Cancelar Edi√ß√£o"})]}),e.jsxs("button",{onClick:pt,disabled:O,className:"flex items-center space-x-2 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ca,{className:"w-5 h-5"}),e.jsx("span",{children:"Excluir"})]})]}),e.jsxs("button",{onClick:ts,disabled:O||A||!fe,className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:fe?"Salvar venda atual":"üîí Caixa fechado - Abra o caixa para salvar vendas",children:[e.jsx($s,{className:"w-5 h-5"}),e.jsx("span",{children:"Salvar"}),!fe&&e.jsx("span",{className:"text-xs",children:"üîí"})]}),e.jsxs("button",{onClick:rs,disabled:O||s.status==="finalizada"||s.status==="pago_nf"||!fe,className:"flex items-center space-x-2 px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:fe?"Registrar pagamento da venda":"üîí Caixa fechado - Abra o caixa para registrar recebimentos",children:[e.jsx(Ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"}),!fe&&e.jsx("span",{className:"text-xs",children:"üîí"})]})]})]})}),!fe&&!A&&e.jsx("div",{className:"bg-red-50 border-b border-red-200 px-6 py-3",children:e.jsx("div",{className:"flex items-center justify-center max-w-5xl mx-auto",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-800",children:[e.jsx(_e,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold text-lg",children:"üîí CAIXA FECHADO"}),e.jsx("span",{className:"text-sm",children:"- √â necess√°rio abrir o caixa para registrar vendas e recebimentos"})]})})}),s.id&&s.numero_venda&&e.jsx("div",{className:"bg-blue-50 border-b border-blue-200 px-4 py-1.5",children:e.jsxs("div",{className:"flex items-center justify-between max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-blue-800",children:"Venda:"}),e.jsxs("div",{className:"flex items-center gap-1.5 bg-white px-2 py-0.5 rounded border border-blue-300",children:[e.jsxs("span",{className:"font-bold text-blue-700 text-sm",children:["#",s.numero_venda]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(s.numero_venda);const a=event.target.closest("button"),o=a.innerHTML;a.innerHTML="‚úì",a.classList.add("text-green-600"),setTimeout(()=>{a.innerHTML=o,a.classList.remove("text-green-600")},1500)},className:"text-blue-600 hover:text-blue-800 transition-colors text-xs",title:"Copiar n√∫mero da venda",children:"üìã"})]})]}),s.data_venda&&e.jsx("span",{className:"text-xs text-blue-600",children:(()=>{const a=s.data_venda;if(typeof a=="string"&&a.includes("T")){const[o]=a.split("T"),[n,d,p]=o.split("-");return`${p}/${d}/${n}`}return new Date(a).toLocaleDateString("pt-BR")})()})]})}),A&&e.jsx("div",{className:"bg-yellow-50 border-b border-yellow-200 px-6 py-3",children:e.jsxs("div",{className:"flex items-center justify-between max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-800",children:[e.jsx(_e,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Modo Visualiza√ß√£o - Venda ",s.status==="finalizada"?"Finalizada":s.status==="baixa_parcial"?"com Baixa Parcial":"Aberta"]}),e.jsx("span",{className:"text-sm",children:"(Clique em Editar para modificar)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hr,{venda:s}),e.jsxs("button",{onClick:()=>{$(!1),Qe()},className:"flex items-center gap-2 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(ue,{className:"w-4 h-4"}),"Voltar"]}),(s.status==="finalizada"||s.status==="baixa_parcial")&&e.jsxs("button",{onClick:bt,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(_e,{className:"w-4 h-4"}),"Reabrir Venda"]}),s.status==="aberta"&&e.jsx("button",{onClick:ut,className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg font-medium transition-colors",children:"Editar"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"max-w-5xl mx-auto space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(Es,{className:"w-5 h-5 mr-2 text-blue-600"}),"Cliente"]}),s.cliente&&!A&&e.jsx("button",{onClick:()=>g({...s,cliente:null,pet:null}),className:"text-sm text-red-600 hover:text-red-700",children:"Remover"})]}),s.cliente?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-blue-900",children:s.cliente.nome}),e.jsxs("div",{className:"text-sm text-blue-700 mt-1",children:[s.cliente.cpf&&`CPF: ${s.cliente.cpf}`,s.cliente.telefone&&` ‚Ä¢ Tel: ${s.cliente.telefone}`]})]})}),s.cliente.credito>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ba,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Cr√©dito Dispon√≠vel:"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",parseFloat(s.cliente.credito||0).toFixed(2).replace(".",",")]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"üí° Este cr√©dito pode ser usado como forma de pagamento"})]}),j&&j.total_vendas>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-blue-300",children:e.jsxs("div",{className:"flex items-center justify-between p-2 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qt,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-yellow-900",children:[j.total_vendas," venda(s) em aberto"]}),e.jsxs("div",{className:"text-xs text-yellow-700",children:["Total: R$ ",j.total_em_aberto.toFixed(2)]})]})]}),e.jsx("button",{onClick:()=>F(!0),className:"px-3 py-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs font-medium rounded transition-colors",children:"Ver Vendas"})]})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-300 flex gap-2",children:[e.jsxs("button",{onClick:()=>Q(!0),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(Ut,{className:"w-4 h-4"}),"Hist√≥rico"]}),!A&&e.jsx("button",{onClick:()=>{g({...s,cliente:null,pet:null}),J(null)},className:"px-4 py-2 text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Trocar"})]})]}),s.cliente.pets&&s.cliente.pets.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pet (opcional)"}),e.jsxs("select",{value:((os=s.pet)==null?void 0:os.id)||"",onChange:a=>{const o=s.cliente.pets.find(n=>n.id===parseInt(a.target.value));it(o||null)},disabled:A,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Sem pet espec√≠fico"}),s.cliente.pets.map(a=>e.jsxs("option",{value:a.id,children:[a.codigo," - ",a.nome," (",a.especie,a.raca&&` - ${a.raca}`,")"]},a.id))]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:_,onChange:a=>x(a.target.value),placeholder:"Digite nome, CPF ou telefone do cliente...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:A}),e.jsx(_a,{className:"w-5 h-5 text-gray-400 absolute right-3 top-1/2 -translate-y-1/2"})]}),e.jsxs("button",{onClick:()=>E(!0),disabled:A,className:"flex items-center space-x-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Na,{className:"w-5 h-5"}),e.jsx("span",{children:"Novo"})]})]}),H.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:H.map(a=>e.jsxs("button",{onClick:()=>es(a),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.nome}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a.cpf&&`CPF: ${a.cpf}`,a.telefone&&` ‚Ä¢ ${a.telefone}`]}),a.pets&&a.pets.length>0&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:[a.pets.length," pet(s)"]})]},a.id))})]}),_.length>=2&&H.length===0&&e.jsx("div",{className:"text-sm text-gray-500 text-center py-2",children:"Nenhum cliente encontrado"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(ga,{className:"w-5 h-5 mr-2 text-blue-600"}),"Produtos e Servi√ßos"]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{ref:Ga,type:"text",value:b,onChange:a=>N(a.target.value),placeholder:"Digite o nome do produto, c√≥digo de barras ou servi√ßo...",disabled:A,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",autoFocus:!A}),e.jsx(_a,{className:"w-5 h-5 text-gray-400 absolute right-3"})]}),M.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:M.map(a=>e.jsx("button",{onClick:()=>dt(a),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b last:border-b-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.nome}),a.tipo_produto==="VARIACAO"&&Ds(a)&&e.jsxs("div",{className:"text-xs text-blue-600 font-medium mt-0.5",children:["üîπ ",Ds(a)]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a.codigo&&`C√≥d: ${a.codigo}`,a.tipo_produto==="KIT"&&a.tipo_kit==="VIRTUAL"?a.estoque_virtual!==void 0&&` ‚Ä¢ Estoque: ${a.estoque_virtual}`:a.estoque_atual!==void 0&&` ‚Ä¢ Estoque: ${a.estoque_atual}`]})]}),e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:["R$ ",parseFloat(a.preco_venda).toFixed(2)]})]})},a.id))})]}),s.itens.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(ga,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhum item adicionado"}),e.jsx("p",{className:"text-sm mt-1",children:"Busque e adicione produtos ou servi√ßos"})]}):e.jsx("div",{className:"space-y-3",children:s.itens.map((a,o)=>{var T;const n=a.tipo_produto==="KIT",d=Bs[o],p=n&&a.composicao_kit&&a.composicao_kit.length>0;return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200 hover:border-blue-400 space-y-3 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>!A&&st(a),children:[e.jsxs("div",{className:"flex-1 flex items-start gap-2",children:[p&&e.jsx("button",{onClick:K=>{K.stopPropagation(),ct(o)},className:"mt-1 text-gray-500 hover:text-blue-600 transition-colors",children:d?e.jsx(Ia,{className:"w-5 h-5"}):e.jsx(Pa,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.produto_nome}),n&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-700",children:[e.jsx(Ts,{className:"w-3 h-3"}),"KIT"]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a.quantidade," Unidade",a.quantidade!==1?"s":""," x R$ ",a.preco_unitario.toFixed(2),a.desconto_valor>0&&e.jsxs("span",{className:"text-orange-600 ml-1",children:["com R$ ",a.desconto_valor.toFixed(2)," de desconto"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",onClick:K=>K.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center space-x-2 bg-white border border-gray-300 rounded-lg",children:[e.jsx("button",{onClick:()=>as(o,-1),disabled:A,className:"p-2 hover:bg-gray-100 rounded-l-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Ht,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:a.quantidade,onChange:K=>{const se=parseFloat(K.target.value)||0,ae=s.itens.map((X,pe)=>{if(pe===o){const ye=Math.max(.001,se),Ie=ye*X.preco_unitario;let qe=X.desconto_valor||0;X.tipo_desconto_aplicado==="percentual"&&X.desconto_percentual>0&&(qe=Ie*X.desconto_percentual/100);const ra=Ie-qe;return{...X,quantidade:ye,desconto_valor:qe,subtotal:ra}}return X});Xe(ae)},disabled:A,step:"0.001",min:"0.001",className:"w-20 px-2 py-1 text-center font-medium border-none focus:ring-0 disabled:bg-gray-50"}),e.jsx("button",{onClick:()=>as(o,1),disabled:A,className:"p-2 hover:bg-gray-100 rounded-r-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Na,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900 w-24 text-right",children:["R$ ",a.subtotal.toFixed(2)]}),e.jsx("button",{onClick:()=>ss(o),disabled:A,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Ca,{className:"w-5 h-5"})})]})]}),p&&d&&e.jsxs("div",{className:"ml-7 mt-3 p-3 bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-600 uppercase mb-2",children:"Composi√ß√£o do KIT"}),e.jsx("div",{className:"space-y-1.5",children:a.composicao_kit.map((K,se)=>e.jsxs("div",{className:"flex items-center justify-between text-sm py-1.5 px-2 rounded hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ga,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:K.produto_nome})]}),e.jsxs("span",{className:"text-gray-500 font-medium",children:[K.quantidade,"x"]})]},se))}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 italic",children:"Componentes apenas informativos (n√£o edit√°veis)"})]}),((T=s.cliente)==null?void 0:T.pets)&&s.cliente.pets.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",onClick:K=>K.stopPropagation(),children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 w-16",children:"Pet:"}),e.jsxs("select",{value:a.pet_id||"",onChange:K=>{const se=s.itens.map((ae,X)=>X===o?{...ae,pet_id:K.target.value?parseInt(K.target.value):null}:ae);g({...s,itens:se})},disabled:A,className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"N√£o especificado"}),s.cliente.pets.map(K=>e.jsxs("option",{value:K.id,children:[K.codigo," - ",K.nome]},K.id))]})]})]},o)})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Observa√ß√µes"}),e.jsx("textarea",{value:s.observacoes||"",onChange:a=>g({...s,observacoes:a.target.value}),placeholder:"Observa√ß√µes da venda (opcional)...",disabled:A,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:3})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Entrega"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.tem_entrega,onChange:a=>{var p;const o=a.target.checked,n=o&&((p=s.entrega)==null?void 0:p.taxa_entrega_total)||0,d=s.subtotal+n;g({...s,tem_entrega:o,total:d,entrega:o?s.entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}})},disabled:A,className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Tem entrega?"})]})]}),s.tem_entrega&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Endere√ßo Completo *"}),s.cliente&&e.jsxs("div",{className:"mb-2 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Endere√ßos cadastrados:"}),e.jsxs("button",{type:"button",onClick:a=>{a.preventDefault(),a.stopPropagation(),Ys()},disabled:A,className:"flex items-center gap-1 px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Na,{size:14}),"Adicionar Endere√ßo"]})]}),e.jsxs("div",{className:"space-y-2",children:[(s.cliente.endereco||s.cliente.cidade)&&e.jsxs("button",{type:"button",onClick:a=>{a.preventDefault(),a.stopPropagation();const o=`${s.cliente.endereco}${s.cliente.numero?", "+s.cliente.numero:""}${s.cliente.complemento?" - "+s.cliente.complemento:""}, ${s.cliente.bairro}, ${s.cliente.cidade}/${s.cliente.estado}`;g({...s,entrega:{...s.entrega,endereco_completo:o}})},disabled:A,className:"w-full text-left px-3 py-2 bg-white hover:bg-blue-100 border border-blue-300 rounded text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"font-medium text-blue-700",children:"üè† Cadastro Principal:"})," ",e.jsxs("span",{className:"text-gray-700",children:[s.cliente.endereco,", ",s.cliente.numero," - ",s.cliente.bairro]})]}),s.cliente.enderecos_adicionais&&s.cliente.enderecos_adicionais.map((a,o)=>e.jsxs("button",{type:"button",onClick:n=>{n.preventDefault(),n.stopPropagation();const d=`${a.endereco}, ${a.numero}${a.complemento?" - "+a.complemento:""}, ${a.bairro}, ${a.cidade}/${a.estado}`;g({...s,entrega:{...s.entrega,endereco_completo:d}})},disabled:A,className:"w-full text-left px-3 py-2 bg-white hover:bg-blue-100 border border-blue-300 rounded text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsxs("span",{className:`inline-block px-2 py-0.5 text-xs font-medium rounded mr-2 ${a.tipo==="entrega"?"bg-blue-100 text-blue-800":a.tipo==="cobranca"?"bg-green-100 text-green-800":a.tipo==="comercial"?"bg-purple-100 text-purple-800":a.tipo==="residencial"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:[a.tipo==="entrega"?"üì¶":a.tipo==="cobranca"?"üí∞":a.tipo==="comercial"?"üè¢":a.tipo==="residencial"?"üè†":"üìç"," ",a.apelido||a.tipo]}),e.jsxs("span",{className:"text-gray-700",children:[a.endereco,", ",a.numero," - ",a.bairro]})]},o)),!s.cliente.endereco&&(!s.cliente.enderecos_adicionais||s.cliente.enderecos_adicionais.length===0)&&e.jsx("p",{className:"text-sm text-gray-600 italic",children:'Nenhum endere√ßo cadastrado. Clique em "+ Adicionar Endere√ßo"'})]})]}),e.jsx("textarea",{value:((ns=s.entrega)==null?void 0:ns.endereco_completo)??"",onChange:a=>g({...s,entrega:{...s.entrega,endereco_completo:a.target.value}}),placeholder:"Rua, n√∫mero, complemento, bairro, cidade...",disabled:A,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Entregador"}),e.jsxs("select",{value:(re==null?void 0:re.id)||"",onChange:a=>{const o=Be.find(n=>n.id===parseInt(a.target.value));Re(o),g({...s,entregador_id:(o==null?void 0:o.id)||null}),o&&ca(o)},disabled:A,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Selecione um entregador"}),Be.map(a=>e.jsxs("option",{value:a.id,children:[a.nome_fantasia||a.nome,a.entregador_padrao&&" (Padr√£o)"]},a.id))]}),re&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Modelo: ",re.modelo_custo_entrega==="taxa_fixa"?"üíµ Taxa Fixa":re.modelo_custo_entrega==="por_km"?"üöó Por KM":re.modelo_custo_entrega==="rateio_rh"?"üëî Rateio RH":"‚öôÔ∏è Configura√ß√£o Global"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa de Entrega Total"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((ls=s.entrega)==null?void 0:ls.taxa_entrega_total)??0,onChange:a=>{var ae;const o=parseFloat(a.target.value)||0,n=parseFloat(o.toFixed(2)),d=((ae=s.entrega)==null?void 0:ae.taxa_loja)||0,p=parseFloat((o-d).toFixed(2)),T={...s,entrega:{...s.entrega,taxa_entrega_total:n,taxa_loja:parseFloat(d.toFixed(2)),taxa_entregador:p}},K=T.tem_entrega?n:0,se=parseFloat((T.subtotal+K).toFixed(2));g({...T,total:se})},disabled:A,className:"w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa Loja"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:((is=s.entrega)==null?void 0:is.taxa_entrega_total)??0,value:parseFloat((((ds=s.entrega)==null?void 0:ds.taxa_loja)??0).toFixed(2)),onChange:a=>{var T;const o=parseFloat(a.target.value)||0,n=((T=s.entrega)==null?void 0:T.taxa_entrega_total)||0,d=parseFloat(o.toFixed(2)),p=parseFloat((n-o).toFixed(2));g({...s,entrega:{...s.entrega,taxa_loja:d,taxa_entregador:p}})},disabled:A,className:"w-full pl-12 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa Entregador"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:((cs=s.entrega)==null?void 0:cs.taxa_entrega_total)??0,value:parseFloat((((xs=s.entrega)==null?void 0:xs.taxa_entregador)??0).toFixed(2)),onChange:a=>{var T;const o=parseFloat(a.target.value)||0,n=((T=s.entrega)==null?void 0:T.taxa_entrega_total)||0,d=parseFloat(o.toFixed(2)),p=parseFloat((n-o).toFixed(2));g({...s,entrega:{...s.entrega,taxa_entregador:d,taxa_loja:p}})},disabled:A,className:"w-full pl-12 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Preencha a taxa total e depois divida entre loja e entregador. Ao alterar uma, a outra √© calculada automaticamente."}),re&&ka>0&&e.jsxs("div",{className:"mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-amber-600",children:"üíº"}),e.jsx("span",{className:"text-sm font-medium text-amber-900",children:"Custo Operacional"})]}),e.jsxs("span",{className:"text-sm font-semibold text-amber-700",children:["R$ ",ka.toFixed(2)]})]}),e.jsxs("p",{className:"text-xs text-amber-600 mt-1 italic",children:[re.nome_fantasia||re.nome," -",re.modelo_custo_entrega==="taxa_fixa"&&" Taxa Fixa",re.modelo_custo_entrega==="por_km"&&" Valor por KM",re.modelo_custo_entrega==="rateio_rh"&&" Rateio de RH"," ","(n√£o aparece no cupom)"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes da Entrega"}),e.jsx("textarea",{value:((ms=s.entrega)==null?void 0:ms.observacoes_entrega)??"",onChange:a=>g({...s,entrega:{...s.entrega,observacoes_entrega:a.target.value}}),placeholder:"Hor√°rio preferencial, ponto de refer√™ncia...",disabled:A,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:2})]})]})]}),s.itens.length>0&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total bruto:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",(s.subtotal+s.desconto_valor).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:s.desconto_valor>0?"text-orange-600 text-sm":"text-gray-500 text-sm",children:s.desconto_valor>0?`${(s.desconto_valor/(s.subtotal+s.desconto_valor)*100).toFixed(2)}% de desconto:`:"Desconto:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.desconto_valor>0&&e.jsxs("span",{className:"font-medium text-orange-600 text-sm",children:["- R$ ",s.desconto_valor.toFixed(2)]}),e.jsxs("button",{onClick:rt,disabled:A,className:"flex items-center gap-1 px-2 py-1 text-xs text-blue-600 hover:bg-blue-50 rounded border border-blue-200 disabled:opacity-50 transition-colors",title:"Aplicar desconto no total da venda",children:[e.jsx(Jt,{className:"w-3 h-3"}),e.jsx("span",{children:s.desconto_valor>0?"Editar":"Adicionar"})]}),s.desconto_valor>0&&e.jsx("button",{onClick:nt,disabled:A,className:"p-1 text-red-400 hover:bg-red-50 rounded disabled:opacity-50 transition-colors",title:"Remover desconto",children:e.jsx(ue,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",s.subtotal.toFixed(2)]})]}),s.tem_entrega&&e.jsxs("div",{className:"flex justify-between text-blue-600",children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsxs("span",{className:"font-medium",children:["+ R$ ",(((us=s.entrega)==null?void 0:us.taxa_entrega_total)||0).toFixed(2)]})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold text-gray-900",children:[e.jsx("span",{children:"Total da Venda:"}),e.jsxs("span",{children:["R$ ",s.total.toFixed(2)]})]})}),Ua>0&&e.jsxs("div",{className:"flex justify-between text-sm text-blue-600 bg-blue-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium",children:"Total de Impostos:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",Ua]})]}),s.total_pago>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-green-600 border-t pt-3",children:[e.jsx("span",{className:"font-medium",children:"(-) Valor Pago:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",s.total_pago.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-2xl font-bold border-t-2 pt-3",children:[e.jsx("span",{className:s.total-s.total_pago>0?"text-orange-600":"text-green-600",children:s.total-s.total_pago>0?"Saldo Restante:":"Totalmente Pago:"}),e.jsxs("span",{className:s.total-s.total_pago>0?"text-orange-600":"text-green-600",children:["R$ ",Math.max(0,s.total-s.total_pago).toFixed(2)]})]})]}),!s.total_pago&&e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"flex justify-between text-2xl font-bold text-gray-900",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["R$ ",s.total.toFixed(2)]})]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Comiss√£o"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:a=>{B(a.target.checked),a.target.checked||Z(null)},disabled:A,className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Venda comissionada?"})]})]}),C&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Funcion√°rio/Veterin√°rio * ",e.jsx("span",{className:"text-xs text-gray-500",children:"(apenas com comiss√£o configurada)"})]}),Y?e.jsxs("div",{className:"p-4 bg-green-50 border-2 border-green-300 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white font-bold",children:Y.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-green-900",children:Y.nome}),e.jsx("div",{className:"text-sm text-green-700 capitalize",children:Y.cargo})]})]}),e.jsx("button",{onClick:()=>{Z(null),ge("")},disabled:A,className:"p-2 text-green-600 hover:bg-green-100 rounded-lg transition-colors disabled:cursor-not-allowed",title:"Remover sele√ß√£o",children:e.jsx(ue,{size:20})})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:Ae,placeholder:"Buscar funcion√°rio ou veterin√°rio...",disabled:A,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",onFocus:async()=>{if(!A)try{const a=await P.get("/comissoes/configuracoes/funcionarios");Le(a.data.data||[])}catch(a){console.error("Erro ao buscar funcion√°rios:",a)}},onChange:async a=>{const o=a.target.value;ge(o);try{const d=(await P.get("/comissoes/configuracoes/funcionarios")).data.data||[],p=o?d.filter(T=>T.nome.toLowerCase().includes(o.toLowerCase())):d;Le(p)}catch(n){console.error("Erro ao buscar funcion√°rios:",n)}}}),ie.length>0&&e.jsx("div",{className:"mt-2 border border-gray-200 rounded-lg max-h-48 overflow-y-auto",children:ie.map(a=>e.jsxs("button",{onClick:()=>{Z(a),Le([]),ge("")},className:"w-full px-4 py-2 text-left hover:bg-gray-50 border-b last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:a.nome}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:a.cargo})]},a.id))})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"‚ÑπÔ∏è A comiss√£o ser√° calculada automaticamente conforme configurado no m√≥dulo de comiss√µes"})]})]})]}),s.itens.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[!fe&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-700",children:[e.jsx(_e,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:'üîí Caixa fechado - Use o bot√£o "Abrir Caixa" no topo da p√°gina para continuar'})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[s.itens.length>0&&!s.id&&e.jsxs("button",{onClick:()=>{window.confirm("Descartar venda atual sem salvar?")&&Qe()},disabled:O||A,className:"flex items-center space-x-2 px-4 py-3 bg-red-50 hover:bg-red-100 text-red-600 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed border border-red-200",title:"Descartar venda atual e come√ßar uma nova",children:[e.jsx(ue,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Nova Venda"})]}),e.jsxs("button",{onClick:ts,disabled:O||A||!fe,className:"flex items-center space-x-2 px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:fe?"Salvar venda atual":"üîí Caixa fechado - Abra o caixa para salvar vendas",children:[e.jsx($s,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Salvar Venda"}),!fe&&e.jsx("span",{className:"text-xs",children:"üîí"})]}),e.jsxs("button",{onClick:rs,disabled:O||s.status==="finalizada"||s.status==="pago_nf"||!fe,className:"flex items-center space-x-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors shadow-md disabled:opacity-50 disabled:cursor-not-allowed",title:fe?"Registrar pagamento da venda":"üîí Caixa fechado - Abra o caixa para registrar recebimentos",children:[e.jsx(Ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"}),!fe&&e.jsx("span",{className:"text-xs",children:"üîí"})]})]})]})]})]}),s.cliente&&Ge&&e.jsx("div",{className:"w-80 bg-gray-50 border-l flex flex-col overflow-hidden",children:e.jsx(vr,{clienteId:s.cliente.id})}),s.cliente&&e.jsx("button",{onClick:()=>Qs(!Ge),className:"fixed right-0 top-1/2 -translate-y-1/2 bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-l-lg shadow-lg transition-all z-10",style:{right:Ge?"320px":"0"},title:Ge?"Recolher informa√ß√µes do cliente":"Expandir informa√ß√µes do cliente",children:Ge?e.jsx(Pa,{className:"w-5 h-5"}):e.jsx(Es,{className:"w-5 h-5"})}),Ke&&e.jsxs("div",{className:"w-52 bg-white border-l flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 flex items-center",children:[e.jsx(qa,{className:"w-4 h-4 mr-2 text-blue-600"}),"Vendas Recentes"]}),e.jsx("button",{onClick:()=>Ba(!1),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Fechar painel",children:e.jsx(ue,{className:"w-4 h-4 text-gray-500"})})]}),e.jsx("div",{className:"flex space-x-1 mb-3",children:["24h","7d","30d"].map(a=>e.jsxs("button",{onClick:()=>Ne(a),className:`flex-1 px-2 py-1.5 rounded-lg text-xs font-medium transition-colors ${ne===a?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[a==="24h"&&"√öltimas 24h",a==="7d"&&"7 dias",a==="30d"&&"30 dias"]},a))}),e.jsx("div",{className:"flex space-x-1 mb-2",children:[{id:"todas",label:"Todas"},{id:"pago",label:"Pago"},{id:"aberta",label:"Aberta"}].map(a=>e.jsx("button",{onClick:()=>W(a.id),className:`flex-1 px-2 py-1.5 rounded-lg text-xs font-medium transition-colors ${v===a.id?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:a.label},a.id))}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 hover:bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",checked:$e,onChange:a=>Oe(a.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Apenas com entrega"})]}),e.jsx("div",{className:"px-2 pb-2",children:e.jsx("input",{type:"text",value:m,onChange:a=>V(a.target.value),placeholder:"Buscar por n√∫mero...",className:"w-full px-3 py-2 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:G.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(_e,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-xs",children:"Nenhuma venda encontrada"})]}):G.map(a=>{const o={ecommerce:{cor:"border-l-purple-500",bg:"bg-purple-50",icon:"üõí",label:"Ecommerce"},aplicativo:{cor:"border-l-green-500",bg:"bg-green-50",icon:"üì±",label:"App"},loja_fisica:{cor:"border-l-blue-500",bg:"bg-blue-50",icon:"üè™",label:"PDV"}}[a.canal]||{cor:"border-l-gray-400",bg:"bg-gray-50",icon:"üè™",label:"PDV"};return e.jsxs("div",{onClick:()=>mt(a),className:`rounded-lg p-2.5 border border-gray-200 border-l-4 ${o.cor} hover:border-blue-300 cursor-pointer transition-colors ${o.bg}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-[10px] text-gray-500 flex items-center gap-0.5",children:[e.jsx("span",{children:o.icon}),e.jsx("span",{children:o.label}),a.tem_entrega&&e.jsx("span",{className:"ml-1",title:"Entrega",children:"üöö"})]}),a.palavra_chave_retirada&&e.jsxs("span",{className:"text-[10px] bg-orange-100 text-orange-700 font-semibold px-1.5 py-0.5 rounded-full border border-orange-200",title:"Senha de retirada",children:["üîë ",a.palavra_chave_retirada]})]}),e.jsxs("div",{className:"flex items-start justify-between mb-1.5",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:a.cliente_nome||"Cliente n√£o informado"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["#",a.numero_venda]})]}),e.jsxs("div",{className:"text-right ml-2 flex-shrink-0",children:[a.status==="baixa_parcial"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[10px] text-gray-500",children:"Pago"}),e.jsxs("div",{className:"text-xs font-semibold text-green-600",children:["R$ ",(a.valor_pago||0).toFixed(2)]}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-0.5",children:["de R$ ",(a.total||0).toFixed(2)]})]}):e.jsxs("div",{className:"text-sm font-semibold text-green-600",children:["R$ ",(a.total||0).toFixed(2)]}),e.jsxs("div",{className:`text-[10px] font-medium px-1.5 py-0.5 rounded-full mt-1 inline-block ${a.status==="pago_nf"?"bg-emerald-100 text-emerald-700":a.status==="finalizada"?"bg-green-100 text-green-700":a.status==="baixa_parcial"?"bg-blue-100 text-blue-700":a.status==="aberta"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[a.status==="pago_nf"&&"Pago NF",a.status==="finalizada"&&"Pago",a.status==="baixa_parcial"&&"Parcial",a.status==="aberta"&&"Aberta",a.status==="cancelada"&&"Cancelada"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[10px] text-gray-500",children:(()=>{const n=a.data_venda;if(typeof n=="string"&&n.includes("T")){const[d,p]=n.split("T"),T=p.split("-")[0].split("+")[0],[K,se,ae]=d.split("-"),[X,pe]=T.split(":");return`${ae}/${se} ${X}:${pe}`}return new Date(n).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})()}),a.tipo_retirada==="terceiro"&&a.status_entrega!=="entregue"&&xe.vendaId!==a.id&&e.jsx("button",{onClick:n=>lt(n,a.id),className:"text-[10px] bg-white hover:bg-green-50 text-green-700 font-semibold px-2 py-0.5 rounded border border-green-600 transition-colors",children:"Confirmar retirada"}),a.status_entrega==="entregue"&&a.retirado_por&&e.jsxs("span",{className:"text-[10px] text-green-600 font-medium",title:`Retirado por: ${a.retirado_por}`,children:["‚úÖ ",a.retirado_por]}),a.status_entrega==="entregue"&&!a.retirado_por&&e.jsx("span",{className:"text-[10px] text-green-600 font-medium",children:"‚úÖ Retirado"})]}),xe.vendaId===a.id&&e.jsxs("div",{onClick:n=>n.stopPropagation(),className:"mt-1.5 flex flex-col gap-1.5",children:[e.jsx("input",{autoFocus:!0,type:"text",placeholder:"Nome de quem est√° retirando (opcional)",value:xe.nome,onChange:n=>be(d=>({...d,nome:n.target.value})),onKeyDown:n=>{n.key==="Enter"&&Za(n,a.id),n.key==="Escape"&&be({vendaId:null,nome:""})},className:"w-full text-[11px] px-2 py-1 border border-gray-300 rounded focus:outline-none focus:border-green-500"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:n=>Za(n,a.id),className:"flex-1 text-[10px] bg-green-600 hover:bg-green-700 text-white font-semibold py-1 rounded transition-colors",children:"‚úÖ Confirmar"}),e.jsx("button",{onClick:n=>{n.stopPropagation(),be({vendaId:null,nome:""})},className:"text-[10px] bg-gray-200 hover:bg-gray-300 text-gray-600 font-semibold px-2 py-1 rounded transition-colors",children:"‚úï"})]})]})]},a.id)})})]}),Us&&s.cliente&&e.jsx("div",{className:"fixed inset-0 z-40",children:e.jsxs("div",{className:"absolute top-0 right-0 w-80 h-full bg-gray-50 border-l border-gray-300 shadow-lg flex flex-col animate-in slide-in-from-right duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-300 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"w-4 h-4 text-gray-600"}),e.jsx("h2",{className:"text-sm font-medium text-gray-700",children:"Oportunidades"})]}),e.jsx("button",{onClick:()=>Ka(!1),className:"p-1 hover:bg-gray-100 rounded transition-colors",children:e.jsx(ue,{className:"w-4 h-4 text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:[sa.slice(0,5).map(a=>e.jsxs("div",{className:"p-3 bg-white border border-gray-200 rounded hover:bg-gray-50 transition-colors",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:a.titulo}),e.jsx("p",{className:"text-xs text-gray-700 mb-2 leading-relaxed",children:a.descricao_curta}),e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs mt-2",children:[e.jsxs("button",{onClick:()=>{Ra("oportunidade_convertida",a),console.log("Adicionar ao carrinho:",a.id)},className:"flex items-center gap-1 text-green-500 hover:text-green-600 transition-colors whitespace-nowrap font-medium",title:"Adicionar ao carrinho",children:[e.jsx(Na,{className:"w-3 h-3"}),e.jsx("span",{children:"Adicionar"})]}),e.jsx("button",{onClick:()=>{Ra("oportunidade_refinada",a),console.log("Buscar alternativa:",a.id)},className:"text-orange-600 hover:text-orange-700 transition-colors whitespace-nowrap flex-1 text-center font-medium",title:"Ver alternativa",children:"Alternativa"}),e.jsxs("button",{onClick:()=>{Ra("oportunidade_rejeitada",a),da(o=>o.filter(n=>n.id!==a.id))},className:"flex items-center gap-1 text-red-500 hover:text-red-600 transition-colors whitespace-nowrap font-medium",title:"Ignorar sugest√£o",children:[e.jsx("span",{children:"Ignorar"}),e.jsx(ue,{className:"w-3 h-3"})]})]})]},a.id)),sa.length===0&&e.jsx("div",{className:"flex items-center justify-center py-8 text-gray-400",children:e.jsx("p",{className:"text-xs",children:"Nenhuma oportunidade dispon√≠vel"})})]}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-200 bg-white",children:e.jsx("p",{className:"text-[10px] text-gray-400 text-center",children:sa.length>0?`${Math.min(sa.length,6)} oportunidades`:""})})]})}),e.jsx("button",{onClick:()=>Ba(!Ke),className:"fixed right-0 bottom-20 bg-blue-600 hover:bg-blue-700 text-white rounded-l-lg shadow-lg transition-all z-10 flex items-center gap-1",style:{right:Ke?"208px":"0",padding:Ke?"6px":"6px 8px"},title:Ke?"Recolher vendas recentes":"Expandir vendas recentes",children:Ke?e.jsx(Pa,{className:"w-4 h-4"}):e.jsxs(e.Fragment,{children:[e.jsx(Gt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-[10px] font-medium whitespace-nowrap",children:"Vendas"})]})}),k&&e.jsx(ir,{venda:s,onClose:()=>t(!1),onAnalisarVenda:u?xt:null,onConfirmar:async()=>{if(t(!1),A&&s.id)try{const o=(await P.get(`/vendas/${s.id}`)).data;let n=[],d=0;try{const p=await P.get(`/vendas/${s.id}/pagamentos`);n=p.data.pagamentos||[],d=p.data.total_pago||0}catch(p){console.error("Erro ao buscar pagamentos:",p)}g({...o,pagamentos:n,total_pago:d}),console.log("‚úÖ Venda recarregada:",o)}catch(a){console.error("Erro ao recarregar venda:",a)}else Qe();ta(),me(a=>a+1)},onVendaAtualizada:async()=>{if(s.id){const a=await wa(s.id);let o=[],n=0;try{const d=await P.get(`/vendas/${s.id}/pagamentos`);o=d.data.pagamentos||[],n=d.data.total_pago||0}catch(d){console.error("Erro ao buscar pagamentos:",d)}g({...a,pagamentos:o,total_pago:n}),$(a.status==="finalizada"||a.status==="baixa_parcial"),ta()}}}),U&&e.jsx(dr,{onClose:()=>te(!1),onSucesso:()=>{te(!1),me(a=>a+1),ke(!0)}}),Ja&&e.jsx(Nr,{isOpen:Ja,itensCarrinho:s.itens,racaoIdFechada:Js,onClose:()=>{const a=s.itens.filter(o=>{const n=(o.categoria_nome||"").toLowerCase();return n.includes("ra√ß√£o")||n.includes("racao")});a.length>0&&Gs(a[a.length-1].produto_id),Hs(!1)}}),R&&s.cliente&&e.jsx(wr,{isOpen:R,onClose:()=>oe(!1),clienteId:s.cliente.id,onPendenciaAdicionada:()=>Wa()}),q&&e.jsx(_r,{onClose:()=>E(!1),onClienteCriado:a=>{es(a),E(!1)}}),Ee&&ee&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between z-10",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Adicionar Novo Endere√ßo ao Cliente"}),e.jsx("button",{onClick:Da,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ue,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Endere√ßo *"}),e.jsxs("select",{value:ee.tipo,onChange:a=>ve({...ee,tipo:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"entrega",children:"üì¶ Entrega"}),e.jsx("option",{value:"cobranca",children:"üí∞ Cobran√ßa"}),e.jsx("option",{value:"comercial",children:"üè¢ Comercial"}),e.jsx("option",{value:"residencial",children:"üè† Residencial"}),e.jsx("option",{value:"trabalho",children:"üìç Trabalho"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apelido (opcional)"}),e.jsx("input",{type:"text",value:ee.apelido,onChange:a=>ve({...ee,apelido:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Ex: Casa da m√£e, Escrit√≥rio, Loja"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:ee.cep,onChange:a=>{const o=a.target.value.replace(/\D/g,""),n=o.length>5?`${o.slice(0,5)}-${o.slice(5,8)}`:o;ve({...ee,cep:n})},onBlur:a=>et(a.target.value),maxLength:"9",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"00000-000"}),la&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Endere√ßo *"}),e.jsx("input",{type:"text",value:ee.endereco,onChange:a=>ve({...ee,endereco:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Rua, Avenida, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N√∫mero"}),e.jsx("input",{type:"text",value:ee.numero,onChange:a=>ve({...ee,numero:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"123"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complemento"}),e.jsx("input",{type:"text",value:ee.complemento,onChange:a=>ve({...ee,complemento:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Apto, Bloco, Sala..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bairro"}),e.jsx("input",{type:"text",value:ee.bairro,onChange:a=>ve({...ee,bairro:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Centro, Jardim..."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cidade *"}),e.jsx("input",{type:"text",value:ee.cidade,onChange:a=>ve({...ee,cidade:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"S√£o Paulo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsx("input",{type:"text",value:ee.estado,onChange:a=>ve({...ee,estado:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",maxLength:"2",placeholder:"SP"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"* Campos obrigat√≥rios"})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:Da,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:at,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Salvar Endere√ßo"})]})]})}),ja&&L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Alterar item da venda"}),e.jsx("button",{onClick:()=>Pe(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ue,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:L.produto_nome}),e.jsxs("p",{className:"text-sm text-gray-600",children:["C√≥digo: ",L.produto_codigo]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Pre√ßo ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:L.preco,onChange:a=>Ve({...L,preco:parseFloat(a.target.value)||0}),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade"}),e.jsx("input",{type:"number",step:"0.001",value:L.quantidade,readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subtotal"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:"R$"}),e.jsx("input",{type:"text",value:(L.preco*L.quantidade).toFixed(2),readOnly:!0,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-100"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de desconto"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Ve({...L,tipoDesconto:"valor",descontoPercentual:0}),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${L.tipoDesconto==="valor"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"R$"}),e.jsx("button",{onClick:()=>Ve({...L,tipoDesconto:"percentual",descontoValor:0}),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${L.tipoDesconto==="percentual"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor do desconto"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:L.tipoDesconto==="valor"?"R$":"%"}),e.jsx("input",{type:"number",step:"0.01",value:L.tipoDesconto==="valor"?L.descontoValor:L.descontoPercentual,onChange:a=>{const o=parseFloat(a.target.value)||0;L.tipoDesconto==="valor"?Ve({...L,descontoValor:o}):Ve({...L,descontoPercentual:o})},className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Total bruto"}),e.jsxs("span",{className:"font-medium",children:["R$ ",(L.preco*L.quantidade).toFixed(2)]})]}),(L.descontoValor>0||L.descontoPercentual>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm text-red-600 mt-1",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{className:"font-medium",children:["- R$ ",L.tipoDesconto==="valor"?L.descontoValor.toFixed(2):(L.preco*L.quantidade*L.descontoPercentual/100).toFixed(2)]})]}),e.jsx("div",{className:"flex justify-between text-sm text-orange-600 mt-1",children:e.jsxs("span",{children:[L.tipoDesconto==="percentual"&&`${L.descontoPercentual.toFixed(2)}% de desconto`,L.tipoDesconto==="valor"&&`${(L.descontoValor/(L.preco*L.quantidade)*100).toFixed(2)}% de desconto`]})})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg mt-2 pt-2 border-t border-blue-200",children:[e.jsx("span",{children:"Total l√≠quido"}),e.jsxs("span",{className:"text-green-600",children:["R$ ",(L.preco*L.quantidade-(L.tipoDesconto==="valor"?L.descontoValor:L.preco*L.quantidade*L.descontoPercentual/100)).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-between gap-3",children:[e.jsx("button",{onClick:()=>Pe(!1),className:"flex-1 px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Fechar"}),e.jsx("button",{onClick:()=>{s.itens.map(a=>(a.produto_id===L.produto_id&&ss(s.itens.indexOf(a)),a)).filter(Boolean),Pe(!1)},className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Remover"}),e.jsx("button",{onClick:tt,className:"flex-1 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Salvar"})]})]})}),Sa&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"üí∞ Aplicar desconto"}),e.jsx("button",{onClick:()=>aa(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ue,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total bruto (sem desconto)"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",s.itens.reduce((a,o)=>a+(o.preco_unitario||o.preco_venda)*o.quantidade,0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de desconto"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Je("valor"),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${Me==="valor"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"R$"}),e.jsx("button",{onClick:()=>Je("percentual"),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${Me==="percentual"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-3 text-gray-500",children:Me==="valor"?"R$":"%"}),e.jsx("input",{type:"number",step:"0.01",value:l,onChange:a=>f(parseFloat(a.target.value)||0),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),(()=>{const a=s.itens.reduce((n,d)=>n+(d.preco_unitario||d.preco_venda)*d.quantidade,0),o=Me==="valor"?Math.min(l,a):a*Math.min(l,100)/100;return e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-700",children:"Desconto"}),e.jsxs("span",{className:"text-red-600 font-medium",children:["- R$ ",o.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-baseline border-t border-blue-200 pt-2 mt-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Total l√≠quido"}),e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:["R$ ",Math.max(0,a-o).toFixed(2)]})]})]})})()]}),e.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>aa(!1),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Fechar"}),e.jsx("button",{onClick:()=>ot(Me,l),className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Aplicar"})]})]})}),w&&s.cliente&&e.jsx(fr,{clienteId:s.cliente.id,clienteNome:s.cliente.nome,onClose:()=>F(!1),onSucesso:()=>{P.get(`/clientes/${s.cliente.id}/vendas-em-aberto`).then(a=>{a.data.resumo.total_vendas>0?J(a.data.resumo):J(null)}).catch(()=>J(null))}}),I&&s.cliente&&e.jsx(jr,{clienteId:s.cliente.id,clienteNome:s.cliente.nome,onClose:()=>Q(!1)}),u&&e.jsx(yr,{mostrar:qs,onFechar:()=>Ea(!1),dados:zs,carregando:Ls})]})})}function _r({onClose:i,onClienteCriado:y}){const[c,u]=r.useState({nome:"",telefone:"",cpf:"",email:""}),[s,g]=r.useState(!1),[_,x]=r.useState(""),b=async N=>{if(N.preventDefault(),!c.nome||!c.telefone){x("Nome e telefone s√£o obrigat√≥rios");return}g(!0),x("");try{const H=await P.post("/clientes",{...c,tipo_cadastro:"cliente",tipo_pessoa:"PF"});y(H.data)}catch(H){console.error("Erro:",H),x("Erro ao cadastrar cliente")}finally{g(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Cadastro R√°pido"}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-4",children:[_&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:_}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome *"}),e.jsx("input",{type:"text",value:c.nome,onChange:N=>u({...c,nome:N.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefone *"}),e.jsx("input",{type:"tel",value:c.telefone,onChange:N=>u({...c,telefone:N.target.value}),placeholder:"(00) 00000-0000",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CPF"}),e.jsx("input",{type:"text",value:c.cpf,onChange:N=>u({...c,cpf:N.target.value}),placeholder:"000.000.000-00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail"}),e.jsx("input",{type:"email",value:c.email,onChange:N=>u({...c,email:N.target.value}),placeholder:"cliente@email.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:i,disabled:s,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:s,className:"flex items-center space-x-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Cadastrando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(pa,{className:"w-5 h-5"}),e.jsx("span",{children:"Cadastrar"})]})})]})]})]})})}export{Rr as default};
