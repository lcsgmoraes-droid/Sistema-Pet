import{r as t,j as e,z as d}from"./vendor-react-1772254949528.js";import{a as x}from"./api-1772254949528.js";import"./index-1772254949528.js";function J(){const[A,E]=t.useState(!0),[j,y]=t.useState(!1),[N,v]=t.useState(!1),g=r=>{if(console.log("üîß normalizeCnaesSecundarios chamado com:",r,"tipo:",typeof r),!r)return[];if(Array.isArray(r))return r;if(typeof r=="string")try{const o=JSON.parse(r);return Array.isArray(o)?o:[]}catch{return[]}return console.warn("‚ö†Ô∏è Valor inesperado para CNAEs, retornando array vazio"),[]},[_,C]=t.useState(""),[w,f]=t.useState([]),[n,b]=t.useState({cnpj:"",razao_social:"",nome_fantasia:"",inscricao_estadual:"",inscricao_municipal:"",email:"",telefone:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",uf:""}),[c,m]=t.useState({regime_tributario:"",simples_anexo:"I",aliquota_simples_vigente:0,aliquota_simples_sugerida:0,cnae_principal:"",cnae_descricao:"",cnaes_secundarios:[],uf:""});t.useEffect(()=>{async function r(){try{const o=await x.get("/empresa/fiscal");console.log("üìä Dados fiscais carregados:",o.data),console.log("üîç cnaes_secundarios recebido:",o.data.cnaes_secundarios),console.log("üîç Tipo:",typeof o.data.cnaes_secundarios),console.log("üîç √â array?",Array.isArray(o.data.cnaes_secundarios));const a=g(o.data.cnaes_secundarios);console.log("‚úÖ Ap√≥s normalizar:",a),console.log("‚úÖ √â array agora?",Array.isArray(a)),m({regime_tributario:o.data.regime_tributario||"",simples_anexo:o.data.simples_anexo||"I",aliquota_simples_vigente:o.data.aliquota_simples_vigente??0,aliquota_simples_sugerida:o.data.aliquota_simples_sugerida??0,cnae_principal:o.data.cnae_principal||"",cnae_descricao:o.data.cnae_descricao||"",cnaes_secundarios:a,uf:o.data.uf||""}),o.data.cnae_descricao&&C(o.data.cnae_descricao),f(a);try{const s=await x.get("/empresa/dados-cadastrais");s.data&&b({cnpj:s.data.cnpj||"",razao_social:s.data.razao_social||"",nome_fantasia:s.data.nome_fantasia||"",inscricao_estadual:s.data.inscricao_estadual||"",inscricao_municipal:s.data.inscricao_municipal||"",email:s.data.email||"",telefone:s.data.telefone||"",cep:s.data.cep||"",endereco:s.data.endereco||"",numero:s.data.numero||"",complemento:s.data.complemento||"",bairro:s.data.bairro||"",cidade:s.data.cidade||"",uf:s.data.uf||""})}catch{console.log("Endpoint de dados cadastrais n√£o existe ainda")}}catch(o){console.error("‚ùå Erro ao carregar configura√ß√µes:",o),console.error("‚ùå Resposta completa:",o.response),d.error("Erro ao carregar configura√ß√µes da empresa"),f([]),m(a=>({...a,cnaes_secundarios:[]}))}finally{E(!1)}}r()},[]);function u(r){const{name:o,value:a}=r.target;m(s=>{const i={...s,[o]:a};return o==="regime_tributario"&&a==="Simples Nacional"&&((!i.simples_anexo||i.simples_anexo==="")&&(i.simples_anexo="I"),(!i.aliquota_simples_vigente||i.aliquota_simples_vigente===0)&&(i.aliquota_simples_vigente=4)),i})}function l(r){const{name:o,value:a}=r.target;b(s=>({...s,[o]:a}))}async function k(){const r=n.cnpj.replace(/[^0-9]/g,"");if(r.length!==14){d.error("CNPJ deve ter 14 d√≠gitos");return}v(!0);try{const o=await fetch(`https://brasilapi.com.br/api/cnpj/v1/${r}`);if(!o.ok)throw new Error("CNPJ n√£o encontrado");const a=await o.json();console.log("üîç Dados completos da API:",a),console.log("üìã CNAE Fiscal:",a.cnae_fiscal),console.log("üìã CNAE Descri√ß√£o:",a.cnae_fiscal_descricao),console.log("üìã CNAEs Secund√°rios:",a.cnaes_secundarios);const s={...n};a.razao_social&&(s.razao_social=a.razao_social),a.nome_fantasia&&(s.nome_fantasia=a.nome_fantasia),a.email&&(s.email=a.email),a.inscricao_estadual&&(s.inscricao_estadual=a.inscricao_estadual);const i=a.ddd_telefone_1||a.telefone;if(i&&(s.telefone=i),a.cep&&(s.cep=a.cep.replace(/[^0-9]/g,"")),a.logradouro&&(s.endereco=a.logradouro),a.numero&&(s.numero=a.numero),a.complemento&&(s.complemento=a.complemento),a.bairro&&(s.bairro=a.bairro),a.municipio&&(s.cidade=a.municipio),a.uf&&(s.uf=a.uf),b(s),a.cnae_fiscal){const S=a.cnae_fiscal.toString();console.log("‚úÖ CNAE encontrado:",S);const p=g(a.cnaes_secundarios);m(z=>({...z,cnae_principal:S,cnae_descricao:a.cnae_fiscal_descricao||"",cnaes_secundarios:p})),a.cnae_fiscal_descricao&&C(a.cnae_fiscal_descricao),f(p),p.length>0&&console.log(`üìã Encontrados ${p.length} CNAEs secund√°rios`)}d.success("‚úÖ Dados preenchidos com sucesso!")}catch(o){console.error("Erro ao buscar CNPJ:",o),d.error("‚ùå Erro ao buscar CNPJ. Verifique o n√∫mero.")}finally{v(!1)}}async function P(){var r,o;y(!0);try{const a={...c,cnaes_secundarios:g(c.cnaes_secundarios)};console.log("üíæ Salvando dados fiscais:",a),console.log("üìã CNAE Descri√ß√£o no form:",c.cnae_descricao),console.log("üìã CNAEs Secund√°rios no form:",c.cnaes_secundarios);const s=await x.put("/empresa/fiscal",a);console.log("‚úÖ Resposta do servidor (fiscal):",s.data);try{console.log("üíæ Salvando dados cadastrais:",n),await x.put("/empresa/dados-cadastrais",n)}catch{console.log("Endpoint de dados cadastrais n√£o implementado ainda")}d.success("Configura√ß√µes salvas com sucesso!")}catch(a){console.error("Erro ao salvar:",a),d.error(((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.detail)||"Erro ao salvar configura√ß√µes")}finally{y(!1)}}if(A)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando configura√ß√µes..."})]})});const h=Array.isArray(w)?w:[],I=c.regime_tributario==="Simples Nacional";return e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Configura√ß√£o da Empresa"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure os dados cadastrais, fiscais e tribut√°rios da sua empresa"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"bg-blue-50 px-6 py-4 border-b border-blue-100",children:[e.jsx("h2",{className:"text-lg font-semibold text-blue-900",children:"üìã Dados Cadastrais"}),e.jsxs("p",{className:"text-sm text-blue-700 mt-2",children:["üí° ",e.jsx("strong",{children:"Dica:"})," Digite o CNPJ e clique no bot√£o üîç para preencher automaticamente os dados da empresa (raz√£o social, endere√ßo, CNAEs, etc.) consultando a Receita Federal."]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["CNPJ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",name:"cnpj",value:n.cnpj,onChange:l,placeholder:"00.000.000/0000-00",maxLength:"18",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:k,disabled:N||!n.cnpj,title:"Buscar dados da Receita Federal pelo CNPJ",className:"px-3 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed flex items-center justify-center shadow-md hover:shadow-lg transition-all duration-200",children:N?e.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Raz√£o Social ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"razao_social",value:n.razao_social,onChange:l,placeholder:"Nome empresarial completo",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome Fantasia"}),e.jsx("input",{type:"text",name:"nome_fantasia",value:n.nome_fantasia,onChange:l,placeholder:"Nome comercial",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Inscri√ß√£o Estadual"}),e.jsx("input",{type:"text",name:"inscricao_estadual",value:n.inscricao_estadual,onChange:l,placeholder:"000.000.000.000",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Inscri√ß√£o Municipal"}),e.jsx("input",{type:"text",name:"inscricao_municipal",value:n.inscricao_municipal,onChange:l,placeholder:"000000",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail"}),e.jsx("input",{type:"email",name:"email",value:n.email,onChange:l,placeholder:"contato@empresa.com.br",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefone"}),e.jsx("input",{type:"text",name:"telefone",value:n.telefone,onChange:l,placeholder:"(00) 0000-0000",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CEP"}),e.jsx("input",{type:"text",name:"cep",value:n.cep,onChange:l,placeholder:"00000-000",maxLength:"9",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Endere√ßo"}),e.jsx("input",{type:"text",name:"endereco",value:n.endereco,onChange:l,placeholder:"Rua, Avenida, etc",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"N√∫mero"}),e.jsx("input",{type:"text",name:"numero",value:n.numero,onChange:l,placeholder:"123",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Complemento"}),e.jsx("input",{type:"text",name:"complemento",value:n.complemento,onChange:l,placeholder:"Sala, Apto, etc",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bairro"}),e.jsx("input",{type:"text",name:"bairro",value:n.bairro,onChange:l,placeholder:"Centro",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"UF"}),e.jsxs("select",{name:"uf",value:n.uf,onChange:l,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"-"}),e.jsx("option",{value:"SP",children:"SP"}),e.jsx("option",{value:"RJ",children:"RJ"}),e.jsx("option",{value:"MG",children:"MG"}),e.jsx("option",{value:"RS",children:"RS"}),e.jsx("option",{value:"PR",children:"PR"}),e.jsx("option",{value:"SC",children:"SC"}),e.jsx("option",{value:"BA",children:"BA"}),e.jsx("option",{value:"PE",children:"PE"}),e.jsx("option",{value:"CE",children:"CE"}),e.jsx("option",{value:"GO",children:"GO"}),e.jsx("option",{value:"DF",children:"DF"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cidade"}),e.jsx("input",{type:"text",name:"cidade",value:n.cidade,onChange:l,placeholder:"Nome da cidade",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-green-50 px-6 py-4 border-b border-green-100",children:e.jsx("h2",{className:"text-lg font-semibold text-green-900",children:"üí∞ Configura√ß√£o Fiscal e Tribut√°ria"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CNAE Principal"}),e.jsx("input",{type:"text",name:"cnae_principal",value:c.cnae_principal,onChange:u,placeholder:"0000-0/00",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),_&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-900 font-medium",children:["üìã ",_]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"C√≥digo da Classifica√ß√£o Nacional de Atividades Econ√¥micas"})]}),h.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["CNAEs Secund√°rios (",h.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:h.map((r,o)=>e.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-md text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:(r==null?void 0:r.codigo)||"N/A"}),e.jsxs("span",{className:"text-gray-600",children:[" - ",(r==null?void 0:r.descricao)||"Sem descri√ß√£o"]})]},o))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Regime Tribut√°rio ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"regime_tributario",value:c.regime_tributario,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Simples Nacional",children:"Simples Nacional"}),e.jsx("option",{value:"Lucro Presumido",children:"Lucro Presumido"}),e.jsx("option",{value:"Lucro Real",children:"Lucro Real"})]})]}),I&&e.jsxs("div",{className:"border-l-4 border-blue-500 bg-blue-50 p-4 space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-blue-900",children:"Par√¢metros do Simples Nacional"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Anexo"}),e.jsxs("select",{name:"simples_anexo",value:c.simples_anexo||"I",onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"I",children:"Anexo I - Com√©rcio"}),e.jsx("option",{value:"II",children:"Anexo II - Ind√∫stria"}),e.jsx("option",{value:"III",children:"Anexo III - Servi√ßos"}),e.jsx("option",{value:"IV",children:"Anexo IV - Servi√ßos (Constru√ß√£o)"}),e.jsx("option",{value:"V",children:"Anexo V - Servi√ßos (Intelectual)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Al√≠quota Vigente (%)"}),e.jsx("input",{type:"number",name:"aliquota_simples_vigente",value:c.aliquota_simples_vigente||"",onChange:u,step:"0.01",min:"0",max:"100",placeholder:"Ex: 4.00",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Al√≠quota atual utilizada para calcular provis√µes"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Al√≠quota Sugerida (%)"}),e.jsx("input",{type:"number",name:"aliquota_simples_sugerida",value:c.aliquota_simples_sugerida||"",onChange:u,step:"0.01",min:"0",max:"100",placeholder:"Ex: 4.50",className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Sugest√£o baseada no hist√≥rico de fechamentos (informativo)"})]})]})]})]}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx("button",{type:"button",onClick:P,disabled:j,className:"px-8 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium",children:j?"Salvando...":"Salvar Todas as Configura√ß√µes"})})]})]})}export{J as default};
