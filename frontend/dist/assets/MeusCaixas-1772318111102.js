import{S as y,r as n,j as e,aA as w,aF as _,aS as C,aK as F,am as k,b7 as D,ao as R,an as S}from"./vendor-react-1772318111102.js";import{l as E,r as $}from"./caixa-1772318111102.js";import"./index-1772318111102.js";function I(){const g=y(),[d,h]=n.useState([]),[b,c]=n.useState(!0),[r,i]=n.useState({data_inicio:"",data_fim:"",status:""});n.useEffect(()=>{u()},[r]);const u=async()=>{try{c(!0);const a={};r.data_inicio&&(a.data_inicio=r.data_inicio),r.data_fim&&(a.data_fim=r.data_fim),r.status&&(a.status_filter=r.status);const s=await E(a);h(s)}catch(a){console.error("Erro ao carregar caixas:",a),alert("Erro ao carregar histÃ³rico de caixas")}finally{c(!1)}},p=async a=>{var s,t;if(confirm("Deseja realmente reabrir este caixa?"))try{await $(a),alert("Caixa reaberto com sucesso!"),g("/pdv")}catch(o){console.error("Erro ao reabrir caixa:",o),alert(((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.detail)||"Erro ao reabrir caixa")}},f=async(a,s)=>{try{const t="/api",o=localStorage.getItem("access_token")||localStorage.getItem("token"),m=await fetch(`${t}/caixas/${a}/pdf`,{headers:{Authorization:`Bearer ${o}`}});if(!m.ok)throw new Error("Erro ao gerar PDF");const N=await m.blob(),x=window.URL.createObjectURL(N),l=document.createElement("a");l.href=x,l.download=`Caixa_${s}_${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(x),document.body.removeChild(l),alert("PDF baixado com sucesso!")}catch(t){console.error("Erro ao baixar PDF:",t),alert("Erro ao gerar PDF do caixa")}},j=a=>{const s={aberto:{cor:"bg-green-100 text-green-800",icone:S,texto:"Aberto"},fechado:{cor:"bg-gray-100 text-gray-800",icone:R,texto:"Fechado"}},t=s[a]||s.fechado,o=t.icone;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium ${t.cor}`,children:[e.jsx(o,{className:"w-4 h-4"}),t.texto]})},v=(a,s)=>{const t=s-a;return{valor:Math.abs(t),tipo:t>0?"sobra":t<0?"falta":"ok"}};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Meus Caixas"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"HistÃ³rico e gestÃ£o dos seus caixas"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:r.data_inicio,onChange:a=>i({...r,data_inicio:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Fim"}),e.jsx("input",{type:"date",value:r.data_fim,onChange:a=>i({...r,data_fim:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:r.status,onChange:a=>i({...r,status:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"aberto",children:"Aberto"}),e.jsx("option",{value:"fechado",children:"Fechado"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>i({data_inicio:"",data_fim:"",status:""}),className:"w-full px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:"Limpar Filtros"})})]})}),b?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando caixas..."})]}):d.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg shadow-sm",children:[e.jsx(w,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Nenhum caixa encontrado"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:d.map(a=>{const s=a.status==="fechado"&&a.valor_esperado?v(a.valor_esperado,a.valor_informado):null;return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(_,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["Caixa #",a.numero_caixa]}),e.jsx("p",{className:"text-sm text-gray-600",children:a.usuario_nome})]})]}),j(a.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsxs("span",{children:["Abertura: ",new Date(a.data_abertura).toLocaleString("pt-BR")]})]}),a.data_fechamento&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsxs("span",{children:["Fechamento: ",new Date(a.data_fechamento).toLocaleString("pt-BR")]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Abertura"}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["R$ ",a.valor_abertura.toFixed(2)]})]}),a.status==="fechado"&&a.valor_esperado&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Esperado"}),e.jsxs("div",{className:"text-lg font-semibold text-blue-900",children:["R$ ",a.valor_esperado.toFixed(2)]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Informado"}),e.jsxs("div",{className:"text-lg font-semibold text-green-900",children:["R$ ",a.valor_informado.toFixed(2)]})]}),e.jsxs("div",{className:`rounded-lg p-3 ${s.tipo==="ok"?"bg-gray-50":s.tipo==="sobra"?"bg-green-50":"bg-red-50"}`,children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"DiferenÃ§a"}),e.jsxs("div",{className:`text-lg font-semibold ${s.tipo==="ok"?"text-gray-900":s.tipo==="sobra"?"text-green-900":"text-red-900"}`,children:[s.tipo==="sobra"&&"+",s.tipo==="falta"&&"-","R$ ",s.valor.toFixed(2)]})]})]})]}),(a.observacoes_abertura||a.observacoes_fechamento)&&e.jsxs("div",{className:"border-t pt-4 mb-4",children:[a.observacoes_abertura&&e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Obs. Abertura:"})," ",a.observacoes_abertura]}),a.observacoes_fechamento&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Obs. Fechamento:"})," ",a.observacoes_fechamento]})]}),a.status==="fechado"&&e.jsxs("div",{className:"border-t pt-4 flex gap-3",children:[e.jsxs("button",{onClick:()=>p(a.id),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(k,{className:"w-4 h-4"}),"Reabrir Caixa"]}),e.jsxs("button",{onClick:()=>f(a.id,a.numero_caixa),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[e.jsx(D,{className:"w-4 h-4"}),"Baixar PDF"]})]})]})},a.id)})})]})}export{I as default};
