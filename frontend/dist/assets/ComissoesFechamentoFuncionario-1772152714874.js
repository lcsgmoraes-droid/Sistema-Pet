import{ah as G,S as Q,r as t,j as e}from"./vendor-react-1772152714874.js";import{a as B}from"./index-1772152714874.js";const H=()=>{const{funcionario_id:f}=G(),y=Q(),[o,P]=t.useState([]),[p,V]=t.useState(null),[I,N]=t.useState(!0),[v,m]=t.useState(null),[g,z]=t.useState(0),[b,w]=t.useState(""),[j,k]=t.useState(""),[W,C]=t.useState(!1),[h,F]=t.useState(""),[_,L]=t.useState(""),[r,S]=t.useState(!1),[M,c]=t.useState(null);t.useEffect(()=>{u()},[f]);const u=async()=>{var s,l,d;try{N(!0),m(null);const a=new URLSearchParams;b&&a.append("data_inicio",b),j&&a.append("data_fim",j);const x=`/comissoes/fechamento/${f}${a.toString()?"?"+a.toString():""}`,i=await B.get(x);i.data.success?(P(i.data.comissoes||[]),V(i.data.funcionario),z(i.data.valor_total||0)):m("Erro ao carregar comissões")}catch(a){console.error("Erro ao carregar comissões:",a),((s=a.response)==null?void 0:s.status)===404?m("Funcionário não encontrado"):m(((d=(l=a.response)==null?void 0:l.data)==null?void 0:d.detail)||"Erro ao carregar comissões")}finally{N(!1)}},$=()=>{u()},O=()=>{w(""),k(""),setTimeout(()=>u(),100)},E=()=>{y("/comissoes/abertas")},R=()=>{const s=new Date().toISOString().split("T")[0];F(s),L(""),c(null),C(!0)},D=()=>{r||(C(!1),c(null))},A=async()=>{var s,l;try{S(!0),c(null);const a={comissoes_ids:o.map(i=>i.id),data_pagamento:h,observacao:_||null},x=await B.post("/comissoes/fechar",a);x.data.success?(alert(`✅ Fechamento realizado com sucesso!

Comissões processadas: ${x.data.total_processadas}
Valor total: ${n(x.data.valor_total_fechamento)}
Data do pagamento: ${T(h)}`),y("/comissoes/abertas")):c("Erro ao processar fechamento")}catch(d){console.error("Erro ao fechar comissões:",d),c(((l=(s=d.response)==null?void 0:s.data)==null?void 0:l.detail)||"Erro ao fechar comissões. Tente novamente.")}finally{S(!1)}},q=s=>{window.open(`/pdv?venda_id=${s}`,"_blank")},n=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),T=s=>s?new Date(s+"T00:00:00").toLocaleDateString("pt-BR"):"-";return I?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"bg-white shadow-md rounded-lg p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando comissões..."})]})})}):v?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-6 w-6 text-red-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-medium",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:v})]})]}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsx("button",{onClick:u,className:"px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-md transition-colors",children:"Tentar Novamente"}),e.jsx("button",{onClick:E,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md transition-colors",children:"Voltar"})]})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-8",children:[e.jsx("div",{className:"mb-6 border-b border-gray-200 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Conferência de Comissões"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Funcionário: ",e.jsx("span",{className:"font-semibold text-gray-800",children:p==null?void 0:p.nome})]})]}),e.jsxs("button",{onClick:E,className:"flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-md transition-colors",children:[e.jsx("svg",{className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Voltar"]})]})}),e.jsxs("div",{className:"mb-6 bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Filtros"}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Início"}),e.jsx("input",{type:"date",value:b,onChange:s=>w(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:j,onChange:s=>k(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:$,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors",children:"Aplicar"}),e.jsx("button",{onClick:O,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md transition-colors",children:"Limpar"})]})]})]}),e.jsx("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total de Comissões"}),e.jsx("p",{className:"text-2xl font-bold text-blue-800",children:o.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Valor Total"}),e.jsx("p",{className:"text-2xl font-bold text-blue-800",children:n(g)})]})]})}),o.length===0?e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"h-16 w-16 text-yellow-500 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-xl font-semibold text-yellow-800 mb-2",children:"Nenhuma comissão encontrada"}),e.jsx("p",{className:"text-yellow-600",children:"Não há comissões pendentes para este funcionário no período selecionado."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto mb-6",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Venda"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qtde"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Base"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"%"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Comissão"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("button",{onClick:()=>q(s.venda_id),className:"text-blue-600 hover:text-blue-800 hover:underline font-medium",children:["#",s.venda_id]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-600",children:T(s.data_venda)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:s.cliente_nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsx("div",{className:"max-w-xs truncate",title:s.nome_produto,children:s.nome_produto})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-gray-600",children:s.quantidade}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-gray-900",children:n(s.valor_base_calculo)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsxs("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:[s.percentual_comissao,"%"]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-semibold text-green-600",children:n(s.valor_comissao_gerada)})]},s.id))})]})}),e.jsx("div",{className:"border-t-2 border-gray-300 pt-4 mt-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-lg font-semibold text-gray-700",children:["Total Geral: ",e.jsx("span",{className:"text-2xl text-green-600",children:n(g)})]}),e.jsx("button",{onClick:R,disabled:o.length===0,className:"px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-md transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Fechar Comissões"})]})})]})]}),W&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Fechar Comissões"}),e.jsx("button",{onClick:D,disabled:r,className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-600 mt-0.5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-blue-800 font-medium",children:["Você está prestes a fechar ",o.length," comissão(ões)"]}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["Total: ",n(g)]})]})]})}),M&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-sm text-red-800",children:M})}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Data do Pagamento ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:h,onChange:s=>F(s.target.value),disabled:r,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observação (opcional)"}),e.jsx("textarea",{value:_,onChange:s=>L(s.target.value),disabled:r,rows:3,placeholder:"Ex: Pagamento via PIX",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed resize-none"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:D,disabled:r,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),e.jsx("button",{onClick:A,disabled:!h||r,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-md transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Confirmar Fechamento"]})})]})]})})]})};export{H as default};
