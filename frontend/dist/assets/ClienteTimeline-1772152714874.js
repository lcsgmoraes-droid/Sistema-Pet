import{r as c,j as e,T as _,av as n,a5 as T,q as $,p as f,h as F,P as g,l as k,a0 as P,b9 as o}from"./vendor-react-1772152714874.js";import{a as z}from"./index-1772152714874.js";const B={venda:k,conta_receber:f,pet_cadastro:g,pet_atualizacao:g,pedido_compra:F,conta_pagar:f,recebimento:$,vacina:n,consulta:n,whatsapp:T},j={green:"bg-green-100 text-green-700 border-green-300",yellow:"bg-yellow-100 text-yellow-700 border-yellow-300",red:"bg-red-100 text-red-700 border-red-300",blue:"bg-blue-100 text-blue-700 border-blue-300",purple:"bg-purple-100 text-purple-700 border-purple-300",gray:"bg-gray-100 text-gray-700 border-gray-300"},I=({clienteId:y,fornecedorId:N,tipo:d="cliente",limit:m=5,showHeader:v=!0,onVerMais:i})=>{const[x,p]=c.useState([]),[w,b]=c.useState(!0),[h,u]=c.useState(""),l=d==="fornecedor"?N:y,E=d==="fornecedor"?`/clientes/fornecedor/${l}/timeline`:`/clientes/${l}/timeline`;c.useEffect(()=>{l&&C()},[l,m,d]);const C=async()=>{var t,s,a;try{b(!0),u("");const r=await z.get(`${E}?limit=${m}`);p(r.data)}catch(r){((t=r.response)==null?void 0:t.status)===500||((s=r.response)==null?void 0:s.status)===404?(console.warn("Timeline não disponível:",(a=r.response)==null?void 0:a.status),p([]),u("")):(console.error("Erro ao carregar timeline:",r),u("Erro ao carregar timeline"))}finally{b(!1)}},S=t=>{const s=new Date(t),a=new Date,r=new Date(a);return r.setDate(r.getDate()-1),s.toDateString()===a.toDateString()?`Hoje às ${s.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:s.toDateString()===r.toDateString()?`Ontem às ${s.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:s.toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})},D=t=>{console.log("Evento clicado:",t)};return w?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Carregando timeline..."})]})}):h?e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(_,{}),h]}):x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(n,{className:"mx-auto text-gray-300 mb-4",size:48}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nenhum evento registrado"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Eventos do cliente aparecerão aqui conforme forem acontecendo"})]}):e.jsxs("div",{className:"space-y-4",children:[v&&e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(n,{className:"text-blue-600"}),"Linha do Tempo"]}),i&&e.jsx("button",{onClick:i,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Ver completa →"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-[19px] top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-6",children:x.map((t,s)=>{const a=B[t.tipo_evento]||n,r=j[t.cor_badge]||j.gray;return e.jsxs("div",{className:"relative pl-12 group",children:[e.jsx("div",{className:"absolute left-0 top-0 w-10 h-10 rounded-full bg-white border-2 border-gray-200 flex items-center justify-center group-hover:border-blue-400 transition-colors",children:e.jsx(a,{className:"text-gray-600 group-hover:text-blue-600 transition-colors",size:18})}),e.jsxs("div",{onClick:()=>D(t),className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md hover:border-gray-300 transition-all cursor-pointer",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:t.titulo}),e.jsx("p",{className:"text-sm text-gray-600",children:t.descricao})]}),e.jsx("span",{className:`ml-3 px-2 py-1 text-xs font-medium rounded border ${r} whitespace-nowrap`,children:t.status})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-3 pt-3 border-t border-gray-100",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(P,{size:12}),S(t.data_evento)]}),t.pet_id&&e.jsxs("span",{className:"flex items-center gap-1 text-blue-600",children:[e.jsx(g,{size:12}),"Pet relacionado"]})]})]})]},`${t.tipo_evento}-${t.evento_id}-${s}`)})})]}),x.length>=m&&i&&e.jsx("div",{className:"text-center pt-4",children:e.jsx("button",{onClick:i,className:"text-sm text-blue-600 hover:text-blue-700 font-medium underline",children:"Ver todos os eventos →"})})]})};I.propTypes={clienteId:o.number,fornecedorId:o.number,tipo:o.oneOf(["cliente","fornecedor"]),limit:o.number,showHeader:o.bool,onVerMais:o.func};export{I as C};
