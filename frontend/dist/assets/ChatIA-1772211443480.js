import{r,aP as o,j as e,bC as p,b1 as k,bD as N,az as M,aQ as w,b0 as A,bv as D}from"./vendor-react-1772211443480.js";import{a as c}from"./index-1772211443480.js";function R(){const[i,x]=r.useState([]),[t,u]=r.useState(null),[l,d]=r.useState([]),[m,h]=r.useState(""),[C,f]=r.useState(!1),[g,b]=r.useState(!1),v=r.useRef(null);r.useEffect(()=>{j()},[]),r.useEffect(()=>{t&&_(t)},[t]),r.useEffect(()=>{E()},[l]);const E=()=>{var s;(s=v.current)==null||s.scrollIntoView({behavior:"smooth"})},j=async()=>{try{const s=await c.get("/chat/conversas");x(s.data)}catch(s){console.error("Erro ao carregar conversas:",s)}},_=async s=>{f(!0);try{const a=await c.get(`/chat/conversa/${s}/mensagens`);d(a.data)}catch(a){console.error("Erro ao carregar mensagens:",a),o.error("Erro ao carregar mensagens")}finally{f(!1)}},y=async()=>{try{const s=await c.post("/chat/nova-conversa",{});x([s.data,...i]),u(s.data.id),d([]),o.success("Nova conversa criada!")}catch(s){console.error("Erro ao criar conversa:",s),o.error("Erro ao criar conversa")}},S=async s=>{if(s.preventDefault(),!m.trim()||!t)return;b(!0);const a=m;h("");try{const n=await c.post("/chat/enviar",{conversa_id:t,mensagem:a});d([...l,{id:n.data.mensagem_usuario.id,tipo:"usuario",conteudo:n.data.mensagem_usuario.conteudo,criado_em:n.data.mensagem_usuario.criado_em},{id:n.data.mensagem_ia.id,tipo:"assistente",conteudo:n.data.mensagem_ia.conteudo,criado_em:n.data.mensagem_ia.criado_em}]),j()}catch(n){console.error("Erro ao enviar mensagem:",n),o.error("Erro ao enviar mensagem"),h(a)}finally{b(!1)}},$=async s=>{if(confirm("Deseja deletar esta conversa?"))try{await c.delete(`/chat/conversa/${s}`),x(i.filter(a=>a.id!==s)),t===s&&(u(null),d([])),o.success("Conversa deletada")}catch(a){console.error("Erro ao deletar conversa:",a),o.error("Erro ao deletar conversa")}};return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(p,{className:"w-8 h-8 text-blue-600"}),"Chat IA Financeiro"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Pergunte sobre seu fluxo de caixa, projeções e saúde financeira"})]}),e.jsxs("button",{onClick:y,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(k,{className:"w-5 h-5"}),"Nova Conversa"]})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"w-80 bg-white border-r border-gray-200 overflow-y-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Conversas Recentes"}),i.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Nenhuma conversa ainda"}),e.jsx("button",{onClick:y,className:"mt-3 text-blue-600 text-sm hover:underline",children:"Criar primeira conversa"})]}):e.jsx("div",{className:"space-y-2",children:i.map(s=>e.jsx("div",{onClick:()=>u(s.id),className:`p-3 rounded-lg cursor-pointer transition-colors group ${t===s.id?"bg-blue-50 border-2 border-blue-200":"bg-gray-50 hover:bg-gray-100"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.titulo||"Nova conversa"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[s.total_mensagens," mensagens"]})]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),$(s.id)},className:"opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-700 transition-opacity",children:e.jsx(M,{className:"w-4 h-4"})})]})},s.id))})]})}),e.jsx("div",{className:"flex-1 flex flex-col bg-gray-50",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[C?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(w,{className:"w-8 h-8 animate-spin text-blue-600"})}):l.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Inicie a conversa fazendo uma pergunta"}),e.jsxs("div",{className:"mt-4 text-sm space-y-1",children:[e.jsx("p",{className:"text-gray-400",children:"Exemplos:"}),e.jsx("p",{className:"text-blue-600",children:'"Qual é meu saldo atual?"'}),e.jsx("p",{className:"text-blue-600",children:'"Como está minha situação financeira?"'}),e.jsx("p",{className:"text-blue-600",children:'"Há algum alerta?"'})]})]})}):l.map(s=>e.jsx("div",{className:`flex ${s.tipo==="usuario"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex gap-3 max-w-3xl ${s.tipo==="usuario"?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${s.tipo==="usuario"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"}`,children:s.tipo==="usuario"?e.jsx(A,{className:"w-5 h-5"}):e.jsx(p,{className:"w-5 h-5"})}),e.jsx("div",{className:`px-4 py-3 rounded-lg ${s.tipo==="usuario"?"bg-blue-600 text-white":"bg-white text-gray-900 border border-gray-200"}`,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.conteudo})})]})},s.id)),e.jsx("div",{ref:v})]}),e.jsx("div",{className:"border-t border-gray-200 bg-white p-4",children:e.jsxs("form",{onSubmit:S,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:m,onChange:s=>h(s.target.value),placeholder:"Digite sua pergunta...",disabled:g,className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"}),e.jsx("button",{type:"submit",disabled:g||!m.trim(),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:g?e.jsx(w,{className:"w-5 h-5 animate-spin"}):e.jsx(D,{className:"w-5 h-5"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"Selecione ou crie uma conversa"}),e.jsx("p",{className:"text-sm mt-2",children:"Faça perguntas sobre seu fluxo de caixa e receba análises inteligentes"})]})})})]})]})}export{R as default};
