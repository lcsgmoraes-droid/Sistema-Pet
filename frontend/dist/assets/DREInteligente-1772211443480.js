import{r,aP as l,j as e,bk as N,aS as f,aF as w,aG as v,bo as I,bs as K,aj as z,bE as G,an as O,al as U,bF as X,ak as Y}from"./vendor-react-1772211443480.js";import{a as c}from"./index-1772211443480.js";import{R as _,B as Q,C as H,X as J,Y as V,T as C,c as W,P as Z,e as ee,d as ae}from"./vendor-charts-1772211443480.js";const E=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8"];function ce(){const[se,R]=r.useState([]),[s,n]=r.useState(null),[x,D]=r.useState([]),[g,S]=r.useState([]),[b,P]=r.useState([]),[A,j]=r.useState(!1),[h,d]=r.useState(!1),[o,u]=r.useState({data_inicio:"",data_fim:""});r.useEffect(()=>{m()},[]);const m=async()=>{j(!0);try{const a=await c.get("/ia/dre/listar");R(a.data),a.data.length>0&&k(a.data[0].id)}catch(a){console.error("Erro ao carregar DREs:",a),l.error("Erro ao carregar histórico de DREs")}finally{j(!1)}},k=async a=>{try{const i=await c.get(`/ia/dre/${a}`);n(i.data);const M=await c.get(`/ia/dre/${a}/produtos`);D(M.data);const T=await c.get(`/ia/dre/${a}/categorias`);S(T.data);const q=await c.get(`/ia/dre/${a}/insights`);P(q.data)}catch(i){console.error("Erro ao carregar detalhes:",i),l.error("Erro ao carregar detalhes do DRE")}},y=async()=>{d(!0);try{const a=await c.post("/ia/dre/calcular-mes-atual",{});l.success("DRE do mês atual calculado!"),m(),n(a.data)}catch(a){console.error("Erro ao calcular:",a),l.error("Erro ao calcular DRE")}finally{d(!1)}},$=async()=>{d(!0);try{const a=await c.post("/ia/dre/calcular-mes-passado",{});l.success("DRE do mês passado calculado!"),m(),n(a.data)}catch(a){console.error("Erro ao calcular:",a),l.error("Erro ao calcular DRE")}finally{d(!1)}},F=async()=>{if(!o.data_inicio||!o.data_fim){l.error("Selecione o período");return}d(!0);try{const a=await c.post("/ia/dre/calcular",o);l.success("DRE calculado!"),m(),n(a.data),u({data_inicio:"",data_fim:""})}catch(a){console.error("Erro ao calcular:",a),l.error("Erro ao calcular DRE")}finally{d(!1)}},t=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a||0),p=a=>`${(a||0).toFixed(1)}%`,L=a=>{switch(a){case"lucro":return"text-green-600 bg-green-50 border-green-200";case"prejuizo":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},B=a=>{switch(a){case"lucro":return e.jsx(v,{className:"w-6 h-6"});case"prejuizo":return e.jsx(Y,{className:"w-6 h-6"});default:return e.jsx(w,{className:"w-6 h-6"})}};return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(N,{className:"w-8 h-8 text-blue-600"}),"DRE Inteligente"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Análise de rentabilidade com insights automáticos"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Calcular Novo DRE"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{onClick:y,disabled:h,className:"px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 transition-colors flex items-center justify-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"Mês Atual"]}),e.jsxs("button",{onClick:$,disabled:h,className:"px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 transition-colors flex items-center justify-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"Mês Passado"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:o.data_inicio,onChange:a=>u({...o,data_inicio:a.target.value}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm"}),e.jsx("input",{type:"date",value:o.data_fim,onChange:a=>u({...o,data_fim:a.target.value}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm"}),e.jsx("button",{onClick:F,disabled:h,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 transition-colors",children:"Calcular"})]})]})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Receita Líquida"}),e.jsx(w,{className:"w-5 h-5 text-blue-600"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t(s.receita_liquida)})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Lucro Bruto"}),e.jsx(v,{className:"w-5 h-5 text-green-600"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t(s.lucro_bruto)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Margem: ",p(s.margem_bruta_percent)]})]}),e.jsxs("div",{className:`rounded-lg border p-4 ${L(s.status)}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Lucro Líquido"}),B(s.status)]}),e.jsx("p",{className:"text-2xl font-bold",children:t(s.lucro_liquido)}),e.jsxs("p",{className:"text-xs mt-1",children:["Margem: ",p(s.margem_liquida_percent)]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Score de Saúde"}),e.jsx(I,{className:"w-5 h-5 text-purple-600"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[s.score_saude,"/100"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${s.score_saude}%`}})})]})]}),b.length>0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(K,{className:"w-6 h-6 text-yellow-500"}),"Insights Automáticos"]}),e.jsx("div",{className:"space-y-3",children:b.map(a=>e.jsx("div",{className:`p-4 rounded-lg border ${a.tipo==="alerta"?"bg-red-50 border-red-200":a.tipo==="oportunidade"?"bg-blue-50 border-blue-200":"bg-green-50 border-green-200"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[a.tipo==="alerta"&&e.jsx(z,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),a.tipo==="oportunidade"&&e.jsx(G,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),a.tipo==="recomendacao"&&e.jsx(O,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:a.titulo}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:a.descricao}),a.acao_sugerida&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("strong",{children:"Ação:"})," ",a.acao_sugerida]}),a.impacto_estimado>0&&e.jsxs("p",{className:"text-sm font-medium mt-2",children:["Impacto estimado: ",t(a.impacto_estimado)]})]})]})},a.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[x.length>0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(U,{className:"w-6 h-6 text-blue-600"}),"Top 10 Produtos Mais Lucrativos"]}),e.jsx(_,{width:"100%",height:300,children:e.jsxs(Q,{data:x.slice(0,10),children:[e.jsx(H,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"produto_nome",angle:-45,textAnchor:"end",height:100}),e.jsx(V,{}),e.jsx(C,{formatter:a=>t(a)}),e.jsx(W,{dataKey:"lucro_total",fill:"#0088FE"})]})})]}),g.length>0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(X,{className:"w-6 h-6 text-green-600"}),"Receita por Categoria"]}),e.jsx(_,{width:"100%",height:300,children:e.jsxs(Z,{children:[e.jsx(ee,{data:g,dataKey:"receita_total",nameKey:"categoria_nome",cx:"50%",cy:"50%",outerRadius:100,label:a=>`${a.categoria_nome}: ${t(a.receita_total)}`,children:g.map((a,i)=>e.jsx(ae,{fill:E[i%E.length]},`cell-${i}`))}),e.jsx(C,{formatter:a=>t(a)})]})})]})]}),x.length>0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold",children:"Todos os Produtos"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Categoria"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Qtd"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Receita"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Custo"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Lucro"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Margem"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:x.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:a.ranking_rentabilidade}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:a.produto_nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:a.categoria}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right",children:a.quantidade_vendida}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right",children:t(a.receita_total)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right",children:t(a.custo_total)}),e.jsx("td",{className:`px-4 py-3 text-sm font-medium text-right ${a.lucro_total>0?"text-green-600":"text-red-600"}`,children:t(a.lucro_total)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right",children:p(a.margem_percent)}),e.jsx("td",{className:"px-4 py-3",children:a.eh_lucrativo?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Lucrativo"}):e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"Prejuízo"})})]},a.id))})]})})]})]}),!s&&!A&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx(N,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nenhum DRE calculado ainda"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Calcule seu primeiro DRE para começar a análise de rentabilidade"}),e.jsx("button",{onClick:y,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Calcular Mês Atual"})]})]})}export{ce as default};
