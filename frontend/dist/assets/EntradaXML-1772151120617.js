import{S as We,r as m,aP as c,j as e}from"./vendor-react-1772151120617.js";import{a as p}from"./index-1772151120617.js";const Ye=()=>{var fe,Ne;const _e=We(),[S,we]=m.useState([]),[V,Ce]=m.useState([]),[h,j]=m.useState(!1),[A,te]=m.useState(!1),[l,b]=m.useState(null),[K,E]=m.useState(!1),[Fe,O]=m.useState(!1),[C,re]=m.useState(!1),[$e,G]=m.useState(!1),[f,Q]=m.useState(null),[ke,W]=m.useState(!1),[oe,le]=m.useState([]),[de,ne]=m.useState(null),[Pe,ie]=m.useState(!1),[Ee,Z]=m.useState(!1),[w,J]=m.useState(null),[ce,Y]=m.useState({}),[F,z]=m.useState("todos"),[U,xe]=m.useState("loja"),[q,ue]=m.useState({}),[qe,I]=m.useState(!1),[$,H]=m.useState(null),[k,B]=m.useState(null),[Re,me]=m.useState(!1),[u,v]=m.useState({sku:"",nome:"",descricao:"",preco_custo:"",preco_venda:"",margem_lucro:"",estoque_minimo:10,estoque_maximo:100}),[R,pe]=m.useState({});m.useEffect(()=>{console.log("ðŸ”„ [EntradaXML] Componente montado, iniciando carregamento..."),P()},[]);const P=async()=>{var s,a,r,t,o,d,n,i,x;console.log("ðŸ“Š [EntradaXML] Carregando dados...");try{const g=localStorage.getItem("access_token")||localStorage.getItem("token");console.log("ðŸ”‘ [EntradaXML] Token obtido:",g?"SIM":"NÃƒO");const N={Authorization:`Bearer ${g}`};console.log("ðŸŒ [EntradaXML] Fazendo requisiÃ§Ãµes para:",{notasEntrada:"/notas-entrada/",produtos:"/produtos/"});const[L,y]=await Promise.all([p.get("/notas-entrada/",{headers:N}),p.get("/produtos/",{headers:N,params:{ativo:null}})]);console.log("âœ… [EntradaXML] Dados carregados:",{notasEntrada:((s=L.data)==null?void 0:s.length)||0,produtos:((r=(a=y.data)==null?void 0:a.items)==null?void 0:r.length)||((t=y.data)==null?void 0:t.length)||0});const M=((o=y.data)==null?void 0:o.items)||y.data,T=M.filter(D=>D.ativo===!0).length,X=M.filter(D=>D.ativo===!1).length;console.log("ðŸ“Š [EntradaXML] Produtos por status:",{ativos:T,inativos:X,total:M.length}),we(L.data),Ce(M)}catch(g){console.error("âŒ [EntradaXML] ERRO ao carregar dados:"),console.error("  - Mensagem:",g.message),console.error("  - Response:",(d=g.response)==null?void 0:d.data),console.error("  - Status:",(n=g.response)==null?void 0:n.status),console.error("  - Stack:",g.stack),c.error(`Erro ao carregar dados: ${((x=(i=g.response)==null?void 0:i.data)==null?void 0:x.detail)||g.message}`)}},Le=async s=>{var t,o,d,n,i;const a=s.target.files[0];if(console.log("ðŸ“¤ [EntradaXML] Upload iniciado"),console.log("  - Arquivo selecionado:",a==null?void 0:a.name),console.log("  - Tamanho:",a==null?void 0:a.size,"bytes"),console.log("  - Tipo:",a==null?void 0:a.type),!a){console.warn("âš ï¸ [EntradaXML] Nenhum arquivo selecionado");return}if(!a.name.toLowerCase().endsWith(".xml")){console.error("âŒ [EntradaXML] Arquivo nÃ£o Ã© XML:",a.name),c.error("âŒ Por favor, selecione um arquivo XML");return}te(!0);const r=new FormData;r.append("file",a),console.log("ðŸš€ [EntradaXML] Enviando arquivo para:","/notas-entrada/upload"),console.log("ðŸ“¦ [EntradaXML] FormData preparado:",a.name,a.size,"bytes");try{const x=await p.post("/notas-entrada/upload",r,{headers:{"Content-Type":"multipart/form-data"}});console.log("âœ… [EntradaXML] Upload bem-sucedido!"),console.log("  - Response data:",x.data);const g=x.data.produtos_vinculados||0,N=x.data.itens_total||0;console.log(`ðŸ“Š [EntradaXML] Produtos vinculados: ${g}/${N}`),x.data.fornecedor_criado_automaticamente&&c.success(`ðŸ¢ Novo fornecedor cadastrado: ${x.data.fornecedor}`,{duration:4e3}),x.data.produtos_reativados>0&&c.success(`â™»ï¸ ${x.data.produtos_reativados} produto(s) inativo(s) reativado(s) automaticamente`,{duration:4e3}),c.success(`âœ… NF-e ${x.data.numero_nota} processada! ${g}/${N} produtos vinculados automaticamente`,{duration:5e3}),P(),s.target.value=""}catch(x){console.error("âŒ [EntradaXML] ERRO no upload:"),console.error("  - Mensagem:",x.message),console.error("  - Response data:",(t=x.response)==null?void 0:t.data),console.error("  - Status:",(o=x.response)==null?void 0:o.status),console.error("  - Headers:",(d=x.response)==null?void 0:d.headers),console.error("  - Stack completo:",x.stack);const g=((i=(n=x.response)==null?void 0:n.data)==null?void 0:i.detail)||x.message||"Erro ao processar XML da NF-e";console.error("  - Mensagem para usuÃ¡rio:",g),c.error(`âŒ ${g}`)}finally{te(!1),console.log("ðŸ [EntradaXML] Upload finalizado")}},Me=async s=>{var o,d;const a=Array.from(s.target.files);if(console.log("ðŸ“¦ [EntradaXML] Upload em lote iniciado -",a.length,"arquivos"),a.length===0){console.warn("âš ï¸ [EntradaXML] Nenhum arquivo selecionado");return}const r=a.filter(n=>!n.name.toLowerCase().endsWith(".xml"));if(r.length>0){c.error(`âŒ ${r.length} arquivo(s) nÃ£o sÃ£o XML: ${r.map(n=>n.name).join(", ")}`);return}re(!0),G(!0),Q(null);const t=new FormData;a.forEach(n=>{t.append("files",n)}),console.log("ðŸš€ [EntradaXML] Enviando",a.length,"arquivos para:","/notas-entrada/upload-lote");try{const n=await p.post("/notas-entrada/upload-lote",t);console.log("âœ… [EntradaXML] Upload em lote bem-sucedido!"),console.log("  - Response:",n.data),Q(n.data),n.data.sucessos>0&&c.success(`âœ… ${n.data.sucessos}/${n.data.total_arquivos} nota(s) processada(s) com sucesso!`,{duration:5e3}),n.data.erros>0&&c.error(`âš ï¸ ${n.data.erros}/${n.data.total_arquivos} nota(s) com erro`,{duration:5e3}),P(),s.target.value=""}catch(n){console.error("âŒ [EntradaXML] ERRO no upload em lote:",n),c.error(`âŒ Erro ao processar lote: ${((d=(o=n.response)==null?void 0:o.data)==null?void 0:d.detail)||n.message}`),G(!1)}finally{re(!1)}},ge=async s=>{try{const a=await p.get(`/notas-entrada/${s}`);a.data.itens&&a.data.itens.sort((r,t)=>r.id-t.id),b(a.data),E(!0),xe(a.data.tipo_rateio||"loja")}catch{c.error("Erro ao carregar detalhes da nota")}},Se=async s=>{try{const a=await p.get(`/notas-entrada/${s}`);b(a.data),O(!0)}catch{c.error("Erro ao carregar nota")}},he=async(s,a,r)=>{var t,o;try{await p.post(`/notas-entrada/${s}/itens/${a}/vincular?produto_id=${parseInt(r)}`),c.success("âœ… Produto vinculado com sucesso!");const d=await p.get(`/notas-entrada/${s}`);d.data.itens&&d.data.itens.sort((n,i)=>n.id-i.id),b(d.data)}catch(d){console.error("âŒ Erro ao vincular produto:",d),c.error(((o=(t=d.response)==null?void 0:t.data)==null?void 0:o.detail)||"Erro ao vincular produto")}},ee=async(s,a)=>{var r,t;try{await p.post(`/notas-entrada/${s}/rateio`,{tipo_rateio:a}),c.success(`âœ… Nota configurada: ${a==="online"?"100% Online":a==="loja"?"100% Loja FÃ­sica":"Rateio Parcial"}`);const o=await p.get(`/notas-entrada/${s}`);b(o.data),xe(a)}catch(o){console.error("âŒ Erro ao salvar tipo de rateio:",o),c.error(((t=(r=o.response)==null?void 0:r.data)==null?void 0:t.detail)||"Erro ao salvar tipo de rateio")}},Ae=async(s,a,r)=>{var t,o;try{const d=await p.post(`/notas-entrada/${s}/itens/${a}/rateio`,{quantidade_online:parseFloat(r)||0});c.success("ðŸ“Š Quantidade online configurada!");const n=d.data.nota_totais;c.success(`Nota: ${n.percentual_online.toFixed(1)}% Online (R$ ${n.valor_online.toFixed(2)}) | ${n.percentual_loja.toFixed(1)}% Loja (R$ ${n.valor_loja.toFixed(2)})`),b(i=>({...i,percentual_online:n.percentual_online,percentual_loja:n.percentual_loja,valor_online:n.valor_online,valor_loja:n.valor_loja,itens:i.itens.map(x=>x.id===a?{...x,quantidade_online:parseFloat(r)||0}:x)})),ue(i=>({...i,[a]:parseFloat(r)||0}))}catch(d){console.error("âŒ Erro ao salvar quantidade online:",d),c.error(((o=(t=d.response)==null?void 0:t.data)==null?void 0:o.detail)||"Erro ao salvar")}},se=async s=>{var a,r;try{const t=await p.get(`/notas-entrada/${s}/preview-processamento`);J(t.data),Z(!0),E(!1);const o={};t.data.itens.forEach(d=>{d.produto_vinculado&&(o[d.produto_vinculado.produto_id]={preco_venda:d.produto_vinculado.preco_venda_atual,margem:d.produto_vinculado.margem_atual})}),Y(o)}catch(t){c.error(((r=(a=t.response)==null?void 0:a.data)==null?void 0:r.detail)||"Erro ao carregar preview")}},De=se,Ve=async()=>{var s,a;j(!0);try{const r=[];Object.entries(ce).forEach(([o,d])=>{const n=w.itens.find(i=>i.produto_vinculado&&i.produto_vinculado.produto_id==o);n&&n.produto_vinculado&&d.preco_venda!==n.produto_vinculado.preco_venda_atual&&r.push({produto_id:parseInt(o),preco_venda:d.preco_venda})}),r.length>0&&await p.post(`/notas-entrada/${w.nota_id}/atualizar-precos`,r);const t=await p.post(`/notas-entrada/${w.nota_id}/processar`,{});c.success(`âœ… Nota processada! ${t.data.itens_processados} itens lanÃ§ados no estoque`,{duration:5e3}),E(!1),b(null),Z(!1),J(null),P()}catch(r){c.error(((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.detail)||"Erro ao processar nota")}finally{j(!1)}},ae=(s,a)=>a>=100?s*2:s/(1-a/100),Oe=(s,a)=>s<=0?0:(s-a)/s*100,Ue=(s,a,r)=>{const t=Oe(a,r);Y(o=>({...o,[s]:{preco_venda:a,margem:t}}))},Te=(s,a,r)=>{const t=ae(r,a);Y(o=>({...o,[s]:{preco_venda:t,margem:a}}))},be=async(s,a)=>{var r,t;if(confirm(`Tem certeza que deseja excluir a nota ${a}?`)){j(!0);try{await p.delete(`/notas-entrada/${s}`),c.success("ðŸ—‘ï¸ Nota excluÃ­da com sucesso!"),K&&(E(!1),b(null)),P()}catch(o){c.error(((t=(r=o.response)==null?void 0:r.data)==null?void 0:t.detail)||"Erro ao excluir nota")}finally{j(!1)}}},Xe=async(s,a)=>{ie(!0),ne({id:s,nome:a}),W(!0);try{const r=await p.get(`/produtos/${s}/historico-precos`);le(r.data)}catch{c.error("Erro ao carregar histÃ³rico de preÃ§os"),W(!1)}finally{ie(!1)}},ve=async(s,a)=>{var r,t;if(confirm(`âš ï¸ Tem certeza que deseja REVERTER a entrada da nota ${a}?

Isso irÃ¡:
â€¢ Remover as quantidades do estoque
â€¢ Excluir os lotes criados
â€¢ Estornar as contas a pagar lanÃ§adas
â€¢ Restaurar o status da nota para pendente`)){j(!0);try{const o=await p.post(`/notas-entrada/${s}/reverter`,{});c.success(`âœ… Entrada revertida! ${o.data.itens_revertidos} produtos ajustados`,{duration:5e3}),K&&(E(!1),b(null)),P()}catch(o){c.error(((t=(r=o.response)==null?void 0:r.data)==null?void 0:t.detail)||"Erro ao reverter entrada")}finally{j(!1)}}},ze=async(s,a)=>{var r,t;try{await p.post(`/notas-entrada/${s}/itens/${a}/desvincular`),c.success("âœ… Produto desvinculado!");const o=await p.get(`/notas-entrada/${s}`);o.data.itens&&o.data.itens.sort((d,n)=>d.id-n.id),b(o.data)}catch(o){c.error(((t=(r=o.response)==null?void 0:r.data)==null?void 0:t.detail)||"Erro ao desvincular produto")}},Ie=s=>{var D;const a=((D=s.produto_vinculado)==null?void 0:D.produto_nome)||s.produto_nome;if(!a)return[];const r=[],t=s.descricao_nf||s.descricao||"",o=a||"";if(!t||!o)return[];const d=t.toLowerCase(),n=o.toLowerCase(),i=/(\d+(?:[.,]\d+)?)\s*(kg|g|ml|l|un|und|unid)/gi,x=[...d.matchAll(i)],g=[...n.matchAll(i)];if(x.length>0&&g.length>0){const _=x[0][0],ye=g[0][0];_!==ye&&r.push(`Peso/Tamanho diferente: NF="${_}" vs Produto="${ye}"`)}const N=["preto","branco","vermelho","azul","verde","amarelo","rosa","roxo","laranja","marrom","cinza"],L=N.find(_=>d.includes(_)),y=N.find(_=>n.includes(_));L&&y&&L!==y&&r.push(`Cor diferente: NF="${L}" vs Produto="${y}"`);const M=["frango","carne","peixe","cordeiro","salmao","salmÃ£o","atum","vegetais"],T=M.find(_=>d.includes(_)),X=M.find(_=>n.includes(_));return T&&X&&T!==X&&r.push(`Sabor diferente: NF="${T}" vs Produto="${X}"`),(d.includes("cao")||d.includes("cachorro")||d.includes("dog"))&&(n.includes("gato")||n.includes("cat"))&&r.push("âš ï¸ Animal diferente: NF para CACHORRO mas produto Ã© para GATO"),(d.includes("gato")||d.includes("cat"))&&(n.includes("cao")||n.includes("cachorro")||n.includes("dog"))&&r.push("âš ï¸ Animal diferente: NF para GATO mas produto Ã© para CACHORRO"),r},He=async s=>{H(s),I(!0),me(!0),v({sku:"",nome:"",descricao:"",preco_custo:"",preco_venda:"",margem_lucro:"",estoque_minimo:10,estoque_maximo:100});try{const a=await p.get(`/notas-entrada/${l.id}/itens/${s.id}/sugerir-sku`);B(a.data);let r=a.data.sku_proposto||s.codigo_produto||"PROD-"+s.id;a.data.ja_existe&&a.data.sugestoes&&a.data.sugestoes.length>0&&(r=(a.data.sugestoes.find(o=>o.padrao)||a.data.sugestoes[0]).sku),v({sku:r,nome:s.descricao||s.descricao_produto||"Produto sem nome",descricao:s.descricao||s.descricao_produto||"",preco_custo:s.valor_unitario.toString(),preco_venda:(s.valor_unitario*1.5).toFixed(2),margem_lucro:"50",estoque_minimo:10,estoque_maximo:100}),console.log("âœ… FormulÃ¡rio preenchido:",{sku:r,nome:s.descricao,preco_custo:s.valor_unitario})}catch(a){c.error("Erro ao buscar sugestÃµes de SKU"),console.error("Erro ao buscar SKU:",a),v({sku:s.codigo_produto||"PROD-"+s.id,nome:s.descricao||"Produto sem nome",descricao:s.descricao||"",preco_custo:s.valor_unitario.toString(),preco_venda:(s.valor_unitario*1.5).toFixed(2),margem_lucro:"50",estoque_minimo:10,estoque_maximo:100})}finally{me(!1)}},Be=async()=>{var s,a;try{j(!0);const r={...u,preco_custo:parseFloat(u.preco_custo)||0,preco_venda:parseFloat(u.preco_venda)||0,margem_lucro:parseFloat(u.margem_lucro)||0,estoque_minimo:parseInt(u.estoque_minimo)||10,estoque_maximo:parseInt(u.estoque_maximo)||100},t=await p.post(`/notas-entrada/${l.id}/itens/${$.id}/criar-produto`,r);c.success(`âœ… Produto ${t.data.produto.codigo} criado e vinculado!`),I(!1),H(null),B(null),await P();const o=await p.get(`/notas-entrada/${l.id}`);b(o.data)}catch(r){c.error(((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.detail)||"Erro ao criar produto"),console.error(r)}finally{j(!1)}},Ke=async()=>{var r;const s=l.itens.filter(t=>!t.produto_id);if(s.length===0){c.success("Todos os produtos jÃ¡ estÃ£o vinculados!");return}if(window.confirm(`Criar ${s.length} produto(s) automaticamente?

PadrÃµes aplicados:
â€¢ Estoque mÃ­nimo: 10
â€¢ Estoque mÃ¡ximo: 100
â€¢ Margem de lucro: 50%

VocÃª poderÃ¡ editar os produtos depois no cadastro.`))try{j(!0);let t=0,o=0;const d=c.loading(`ðŸ“¦ Criando ${s.length} produtos...`);for(const i of s)try{const x=await p.get(`/notas-entrada/${l.id}/itens/${i.id}/sugerir-sku`);let g=x.data.sku_proposto||i.codigo_produto||`PROD-${i.id}`;x.data.ja_existe&&((r=x.data.sugestoes)==null?void 0:r.length)>0&&(g=(x.data.sugestoes.find(y=>y.padrao)||x.data.sugestoes[0]).sku);const N={sku:g,nome:i.descricao||"Produto sem nome",descricao:i.descricao||"",preco_custo:parseFloat(i.valor_unitario)||0,preco_venda:parseFloat((i.valor_unitario*1.5).toFixed(2)),margem_lucro:50,estoque_minimo:10,estoque_maximo:100};await p.post(`/notas-entrada/${l.id}/itens/${i.id}/criar-produto`,N),t++}catch(x){console.error(`Erro ao criar produto do item ${i.id}:`,x),o++}c.dismiss(d),t>0&&c.success(`âœ… ${t} produto(s) criado(s) com sucesso!`),o>0&&c.error(`âŒ ${o} erro(s) ao criar produtos`),await P();const n=await p.get(`/notas-entrada/${l.id}`);b(n.data)}catch(t){c.error("Erro ao criar produtos em lote"),console.error(t)}finally{j(!1)}},Ge=(s,a)=>s===0?0:((a-s)/s*100).toFixed(2),je=s=>{const a={pendente:"bg-yellow-200 text-yellow-800",processada:"bg-green-200 text-green-800",cancelada:"bg-red-200 text-red-800",erro:"bg-red-300 text-red-900"};return e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${a[s]||"bg-gray-200"}`,children:s.toUpperCase()})},Qe=s=>{if(!s)return e.jsx("span",{className:"text-gray-400 text-sm",children:"NÃ£o vinculado"});const a=s>=90?"alta":s>=70?"media":"baixa",r={alta:"bg-green-100 text-green-800",media:"bg-yellow-100 text-yellow-800",baixa:"bg-orange-100 text-orange-800"};return e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-semibold ${r[a]}`,children:[s.toFixed(1),"% ",a==="alta"?"âœ…":a==="media"?"âš ï¸":"âš¡"]})};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"ðŸ“„ Entrada por NF-e (XML)"}),e.jsx("p",{className:"text-gray-600",children:"Importe notas fiscais eletrÃ´nicas e vincule produtos automaticamente"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-8 mb-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx("svg",{className:"mx-auto h-16 w-16 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:A?"â³ Processando XML...":"Selecione o arquivo XML da NF-e"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"O sistema irÃ¡ processar automaticamente os dados da nota fiscal"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("label",{className:"inline-block",children:[e.jsx("input",{type:"file",accept:".xml",onChange:Le,disabled:A||C,className:"hidden"}),e.jsx("span",{className:`
                px-6 py-3 rounded-lg font-semibold cursor-pointer inline-block
                ${A||C?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}
              `,children:A?"â³ Processando...":"ðŸ“ Upload Ãšnico"})]}),e.jsxs("label",{className:"inline-block",children:[e.jsx("input",{type:"file",accept:".xml",multiple:!0,onChange:Me,disabled:A||C,className:"hidden"}),e.jsx("span",{className:`
                px-6 py-3 rounded-lg font-semibold cursor-pointer inline-block
                ${A||C?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"}
              `,children:C?"â³ Processando Lote...":"ðŸ“¦ Upload MÃºltiplo"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"Formatos aceitos: XML de NF-e (padrÃ£o SEFAZ)"})]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:S.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Notas"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:S.filter(s=>s.status==="pendente").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pendentes"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:S.filter(s=>s.status==="processada").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Processadas"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:["R$ ",S.filter(s=>s.status==="processada").reduce((s,a)=>s+(a.valor_total||0),0).toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Valor Processado"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b bg-gray-50",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Notas Fiscais Importadas"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Chave NF-e"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Fornecedor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Data EmissÃ£o"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Itens"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{children:S.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500",children:"Nenhuma nota fiscal importada ainda. FaÃ§a o upload de um XML acima."})}):S.map(s=>e.jsxs("tr",{onClick:()=>Se(s.id),className:"border-t hover:bg-blue-50 cursor-pointer transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"font-mono text-xs",children:[s.chave_acesso.substring(0,20),"..."]})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold",children:s.fornecedor_nome}),e.jsx("div",{className:"text-xs text-gray-500",children:s.fornecedor_cnpj})]}),e.jsx("td",{className:"px-4 py-3",children:new Date(s.data_emissao).toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold",children:["R$ ",(s.valor_total||0).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-semibold",children:[s.produtos_vinculados+s.produtos_nao_vinculados," itens"]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:je(s.status)}),e.jsx("td",{className:"px-4 py-3 text-center",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"flex gap-2 justify-center",children:[s.status==="pendente"&&e.jsx("button",{onClick:()=>ge(s.id),className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded font-semibold text-sm",title:"Vincular produtos",children:"ðŸ”— Vincular"}),s.entrada_estoque_realizada?e.jsx("button",{onClick:()=>ve(s.id,s.numero_nota),className:"text-orange-600 hover:text-orange-800 font-semibold text-sm",title:"Reverter entrada no estoque",children:"â†©ï¸ Reverter"}):e.jsx("button",{onClick:()=>be(s.id,s.numero_nota),className:"text-red-600 hover:text-red-800 font-semibold text-sm",title:"Excluir nota",children:"ðŸ—‘ï¸ Excluir"})]})})]},s.id))})]})})]}),K&&l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"ðŸ“„ Detalhes da NF-e"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Chave: ",l.chave_acesso]})]}),e.jsx("button",{onClick:()=>{E(!1),b(null)},className:"text-gray-500 hover:text-gray-700 text-2xl",children:"Ã—"})]}),e.jsx("div",{className:"px-6 py-4 border-b bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Fornecedor:"}),e.jsx("div",{className:"font-semibold",children:l.fornecedor_nome}),e.jsx("div",{className:"text-xs text-gray-500",children:l.fornecedor_cnpj}),l.fornecedor_id&&e.jsx("div",{className:"text-xs text-green-600 mt-1",children:"âœ… Cadastrado"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Data EmissÃ£o:"}),e.jsx("div",{className:"font-semibold",children:new Date(l.data_emissao).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Valor Total:"}),e.jsxs("div",{className:"font-bold text-lg text-green-600",children:["R$ ",(l.valor_total||0).toFixed(2)]})]})]})}),l.fornecedor_id&&l.fornecedor_criado_automaticamente&&e.jsx("div",{className:"px-6 py-2 bg-blue-50 border-b border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:l.fornecedor_nome})," foi cadastrado automaticamente."]}),e.jsx("button",{onClick:()=>_e(`/clientes/${l.fornecedor_id}`),className:"px-3 py-1 bg-blue-600 text-white rounded font-medium hover:bg-blue-700 text-xs",children:"ðŸ“ Completar Cadastro"})]})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-bold text-xl text-gray-800",children:["ðŸ“¦ Produtos da Nota (",l.itens.length,")"]}),l.status==="pendente"&&l.itens.some(s=>!s.produto_id)&&e.jsxs("button",{onClick:Ke,disabled:h,className:"px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400 flex items-center gap-2 text-sm",title:"Cria automaticamente todos os produtos nÃ£o vinculados com os padrÃµes: Estoque mÃ­n: 10, mÃ¡x: 100, Margem: 50%",children:[e.jsx("span",{children:"âœ¨ Criar Todos NÃ£o Vinculados"}),e.jsx("span",{className:"text-xs bg-purple-800 px-2 py-0.5 rounded",children:l.itens.filter(s=>!s.produto_id).length})]})]}),e.jsx("div",{className:"space-y-3",children:l.itens.map(s=>{const a=Ie(s),r=a.length>0;return e.jsxs("div",{className:"border-2 border-gray-400 rounded-lg overflow-hidden bg-white shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] gap-0",children:[e.jsxs("div",{className:"bg-blue-50 border-r-2 border-gray-300 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs font-bold",children:"NF-e"}),Qe(s.confianca_vinculo)]}),e.jsx("div",{className:"font-semibold text-base mb-2 text-blue-900",children:s.descricao}),e.jsxs("div",{className:"space-y-1.5 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"CÃ³digo:"}),e.jsx("span",{className:"font-mono font-semibold",children:s.codigo_produto})]}),s.ean&&s.ean!=="SEM GTIN"&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"EAN:"}),e.jsx("span",{className:"font-mono font-semibold",children:s.ean})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"NCM:"}),e.jsx("span",{className:"font-mono font-semibold",children:s.ncm})]}),e.jsxs("div",{className:"flex justify-between border-t pt-1.5 mt-1.5",children:[e.jsx("span",{className:"text-gray-600",children:"Qtd:"}),e.jsx("span",{className:"font-semibold",children:s.quantidade})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Unit.:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",s.valor_unitario.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["R$ ",s.valor_total.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"CFOP:"}),e.jsx("span",{className:"font-semibold",children:s.cfop})]})]}),(s.lote||s.data_validade)&&e.jsxs("div",{className:"mt-3 pt-3 border-t space-y-2",children:[s.lote&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"ðŸ“¦ Lote:"}),e.jsx("div",{className:"font-semibold text-purple-800",children:s.lote})]}),s.data_validade&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"ðŸ“… Validade:"}),e.jsx("div",{className:"font-semibold text-orange-800",children:new Date(s.data_validade).toLocaleDateString("pt-BR")})]})]})]}),e.jsx("div",{className:"flex flex-col items-center justify-center bg-gray-100 px-2 py-4",children:s.produto_id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ze(l.id,s.id),className:"text-3xl text-green-600 hover:text-red-600 transition-colors mb-2",title:"âœ… Vinculado - Clique para desvincular",children:"âœ“"}),r&&e.jsx("div",{className:"bg-red-100 border-2 border-red-500 rounded-lg p-2 max-w-[200px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:"âš ï¸"}),e.jsx("div",{className:"font-bold text-red-700 text-xs mb-1",children:"DIVERGÃŠNCIA!"}),e.jsx("div",{className:"text-[10px] text-red-600 space-y-0.5",children:a.map((t,o)=>e.jsxs("div",{children:["â€¢ ",t]},o))})]})})]}):e.jsx("div",{className:"text-3xl text-gray-400",title:"âŒ NÃ£o vinculado",children:"âœ•"})}),e.jsx("div",{className:`p-4 ${s.produto_id?"bg-green-50":"bg-gray-50"}`,children:e.jsx("div",{className:`p-4 ${s.produto_id?"bg-green-50":"bg-gray-50"}`,children:l.status==="pendente"?e.jsx(e.Fragment,{children:s.produto_id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsx("div",{className:"bg-green-600 text-white px-2 py-1 rounded text-xs font-bold",children:"âœ… PRODUTO SISTEMA"})}),e.jsx("div",{className:"font-semibold text-base mb-3 text-green-900",children:s.produto_nome}),e.jsx("div",{className:"text-xs text-green-700 mb-3 italic",children:"ðŸ’¡ Para alterar o vÃ­nculo, selecione outro produto ou clique no âœ“ para desvincular"}),e.jsxs("select",{value:s.produto_id,onChange:t=>{t.target.value&&t.target.value!=s.produto_id&&he(l.id,s.id,t.target.value)},className:"w-full px-3 py-2 border-2 border-green-400 rounded text-sm focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:s.produto_id,children:s.produto_nome}),Array.isArray(V)&&V.filter(t=>t.id!==s.produto_id).map(t=>e.jsxs("option",{value:t.id,children:[t.codigo," - ",t.nome," ",t.descricao?`| ${t.descricao.substring(0,50)}...`:""," (Est: ",t.estoque_atual||0,")"]},t.id))]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsx("div",{className:"bg-orange-600 text-white px-2 py-1 rounded text-xs font-bold",children:"âš ï¸ NÃƒO VINCULADO"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1",children:"ðŸ” Pesquisar produto existente:"}),e.jsx("input",{type:"text",placeholder:"Digite nome ou SKU...",value:R[s.id]||"",onChange:t=>pe({...R,[s.id]:t.target.value}),className:"w-full px-3 py-2 border-2 border-gray-400 rounded focus:ring-2 focus:ring-blue-500 text-sm"})]}),R[s.id]&&R[s.id].length>=2&&e.jsxs("div",{className:"border-2 border-gray-300 rounded max-h-48 overflow-y-auto bg-white",children:[Array.isArray(V)&&V.filter(t=>{var d,n,i;const o=R[s.id].toLowerCase();return((d=t.nome)==null?void 0:d.toLowerCase().includes(o))||((n=t.codigo)==null?void 0:n.toLowerCase().includes(o))||((i=t.descricao)==null?void 0:i.toLowerCase().includes(o))}).sort((t,o)=>t.ativo===o.ativo?0:t.ativo?-1:1).slice(0,15).map(t=>e.jsxs("button",{type:"button",onClick:()=>{he(l.id,s.id,t.id),pe({...R,[s.id]:""})},className:`w-full text-left px-3 py-2 hover:bg-blue-50 border-b border-gray-200 last:border-b-0 text-xs ${t.ativo?"":"text-red-600 font-bold"}`,children:[!t.ativo&&"ðŸ”´ ",t.codigo," - ",t.nome,!t.ativo&&" [INATIVO]",e.jsxs("span",{className:"text-gray-500 ml-1",children:["(Est: ",t.estoque_atual||0,")"]})]},`produto-${s.id}-${t.id}`)),V.filter(t=>{var d,n,i;const o=R[s.id].toLowerCase();return((d=t.nome)==null?void 0:d.toLowerCase().includes(o))||((n=t.codigo)==null?void 0:n.toLowerCase().includes(o))||((i=t.descricao)==null?void 0:i.toLowerCase().includes(o))}).length===0&&e.jsx("div",{className:"px-3 py-4 text-center text-gray-500 text-xs",children:"âŒ Nenhum produto encontrado"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 border-t border-gray-300"}),e.jsx("span",{className:"text-xs text-gray-500",children:"ou"}),e.jsx("div",{className:"flex-1 border-t border-gray-300"})]}),e.jsx("button",{onClick:()=>He(s),className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 text-sm",children:"âž• Criar Novo Produto"})]})]})}):e.jsx("div",{children:s.produto_id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-green-600 text-white px-2 py-1 rounded text-xs font-bold inline-block mb-2",children:"âœ… VINCULADO"}),e.jsx("div",{className:"font-semibold text-base text-green-900",children:s.produto_nome})]}):e.jsx("div",{className:"bg-gray-600 text-white px-2 py-1 rounded text-xs font-bold inline-block",children:"âš ï¸ NÃƒO VINCULADO"})})})}),l.status==="pendente"&&U==="parcial"&&s.produto_id&&e.jsxs("div",{className:"col-span-3 p-4 border-t-2 border-gray-300 bg-gradient-to-r from-blue-50 via-gray-50 to-green-50",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-3 flex items-center text-sm",children:"ðŸ“¦ Quantidade destinada ao estoque online"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"ðŸ“‹ Total NF"}),e.jsx("input",{type:"number",value:s.quantidade,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded bg-gray-100 text-base font-semibold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"ðŸŒ Online"}),e.jsx("input",{type:"number",min:"0",max:s.quantidade,step:"0.01",value:q[s.id]??s.quantidade_online??0,onChange:t=>{const o=parseFloat(t.target.value)||0;ue({...q,[s.id]:Math.min(o,s.quantidade)})},className:"w-full px-3 py-2 border-2 border-blue-400 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base font-semibold",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"ðŸª Loja"}),e.jsx("input",{type:"number",value:(s.quantidade-(q[s.id]??s.quantidade_online??0)).toFixed(2),disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded bg-gray-100 text-base font-semibold"})]})]}),e.jsxs("div",{className:"mt-3 text-sm text-gray-700 bg-white rounded-lg p-3 border border-gray-300 font-medium",children:["ðŸ’µ Valor online: R$ ",((q[s.id]??s.quantidade_online??0)*s.valor_unitario).toFixed(2)]}),q[s.id]!==void 0&&q[s.id]!==s.quantidade_online?e.jsx("button",{onClick:()=>Ae(l.id,s.id,q[s.id]),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 mt-3 text-sm",children:"ðŸ’¾ Salvar DistribuiÃ§Ã£o"}):s.quantidade_online!==null&&s.quantidade_online!==void 0&&e.jsxs("div",{className:"mt-3 text-sm text-green-700 bg-green-50 rounded-lg p-3 border border-green-200 flex items-center justify-center font-medium",children:["âœ… Salvo: ",s.quantidade_online," online / ",(s.quantidade-s.quantidade_online).toFixed(2)," loja"]})]})]}),l.status==="processada"&&s.produto_id&&e.jsxs("div",{className:"mt-3 pt-3 border-t bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("span",{className:"text-blue-800 font-semibold",children:"âœ… LanÃ§ado no estoque:"}),e.jsx("span",{className:"ml-2",children:s.produto_nome})]})]},s.id)})})]}),l.status==="pendente"&&e.jsxs("div",{className:"sticky bottom-0 bg-white border-t px-6 py-4 space-y-3",children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"ðŸ“Š DistribuiÃ§Ã£o (informativo para relatÃ³rios)"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Estoque unificado â€¢ ClassificaÃ§Ã£o apenas para anÃ¡lises"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ee(l.id,"loja"),disabled:h,className:`px-3 py-1 rounded text-xs font-medium transition-colors ${U==="loja"?"bg-gray-800 text-white":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-100"} ${h?"opacity-50 cursor-not-allowed":""}`,children:"ðŸª Loja"}),e.jsx("button",{onClick:()=>ee(l.id,"online"),disabled:h,className:`px-3 py-1 rounded text-xs font-medium transition-colors ${U==="online"?"bg-gray-800 text-white":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-100"} ${h?"opacity-50 cursor-not-allowed":""}`,children:"ðŸŒ Online"}),e.jsx("button",{onClick:()=>ee(l.id,"parcial"),disabled:h,className:`px-3 py-1 rounded text-xs font-medium transition-colors ${U==="parcial"?"bg-gray-800 text-white":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-100"} ${h?"opacity-50 cursor-not-allowed":""}`,children:"ðŸ“Š Parcial"}),(l.percentual_online>0||l.tipo_rateio)&&e.jsxs("div",{className:"ml-auto flex gap-3 text-xs text-gray-600",children:[e.jsxs("span",{children:["Online: ",(l.percentual_online||0).toFixed(0),"%"]}),e.jsxs("span",{children:["Loja: ",(l.percentual_loja||100).toFixed(0),"%"]})]})]}),U==="parcial"&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-gray-100 rounded p-2",children:["ðŸ’¡ Defina a quantidade destinada ao ",e.jsx("strong",{children:"estoque online"})," em cada produto acima. O sistema calcula automaticamente a % baseado nos valores."]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[l.itens.filter(s=>s.produto_id).length," de ",l.itens.length," produtos vinculados"]}),e.jsxs("div",{className:"flex gap-3",children:[l.entrada_estoque_realizada?e.jsx("button",{onClick:()=>ve(l.id,l.numero_nota),disabled:h,className:"px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 disabled:bg-gray-400",children:h?"â³ Revertendo...":"â†©ï¸ Reverter Entrada"}):e.jsxs(e.Fragment,{children:[!l.entrada_estoque_realizada&&e.jsx("button",{onClick:()=>be(l.id,l.numero_nota),disabled:h,className:"px-6 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 disabled:bg-gray-400",children:"ðŸ—‘ï¸ Excluir Nota"}),l.itens.some(s=>s.produto_id)&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>De(l.id),disabled:h,className:"px-6 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400",children:"ðŸ’° Revisar PreÃ§os"}),e.jsx("button",{onClick:()=>se(l.id),disabled:h,className:"px-6 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 disabled:bg-gray-400",children:h?"â³ Processando...":"âœ… Processar Nota"})]})]}),e.jsx("button",{onClick:()=>{E(!1),b(null)},className:"px-6 py-2 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50",children:"Fechar"})]})]})]})]})}),qe&&$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"âž• Criar Novo Produto"}),e.jsx("p",{className:"text-sm text-gray-600",children:"A partir do item da NF-e"})]}),e.jsx("button",{onClick:()=>{I(!1),H(null),B(null)},className:"text-gray-500 hover:text-gray-700 text-2xl",children:"Ã—"})]}),e.jsx("div",{className:"px-6 py-4",children:Re?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Gerando sugestÃµes de SKU..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ“„ Dados da NF-e:"}),e.jsxs("div",{className:"text-sm space-y-1 text-blue-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"DescriÃ§Ã£o:"})," ",$.descricao]}),e.jsxs("div",{children:[e.jsx("strong",{children:"CÃ³digo Fornecedor:"})," ",$.codigo_produto]}),e.jsxs("div",{children:[e.jsx("strong",{children:"NCM:"})," ",$.ncm]}),$.ean&&e.jsxs("div",{children:[e.jsx("strong",{children:"EAN:"})," ",$.ean]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Valor UnitÃ¡rio:"})," R$ ",$.valor_unitario.toFixed(2)]})]})]}),(k==null?void 0:k.ja_existe)&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-300 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"âš ï¸"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-semibold text-yellow-900 mb-2",children:['CÃ³digo do fornecedor "',k.sku_proposto,'" jÃ¡ estÃ¡ em uso!']}),e.jsxs("div",{className:"text-sm text-yellow-800 mb-3",children:["Produto existente: ",e.jsx("strong",{children:k.produto_existente.nome}),e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Um SKU alternativo foi sugerido automaticamente. VocÃª pode alterar se preferir."})]}),e.jsx("div",{className:"text-sm text-yellow-800 mb-2 font-semibold",children:"Outras opÃ§Ãµes de SKU disponÃ­veis:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.sugestoes.map(s=>e.jsxs("button",{onClick:()=>v({...u,sku:s.sku}),className:`px-3 py-1 rounded-lg text-sm font-semibold transition-all ${u.sku===s.sku?"bg-blue-600 text-white shadow-md":"bg-white border border-blue-300 text-blue-700 hover:bg-blue-50"} ${s.padrao?"ring-2 ring-yellow-400":""}`,children:[s.sku," ",s.padrao&&"â­"]},s.sku))})]})]})}),k&&!k.ja_existe&&e.jsx("div",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"âœ…"}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("strong",{children:"SKU disponÃ­vel!"})," O cÃ³digo do fornecedor pode ser usado diretamente."]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["SKU / CÃ³digo do Produto *",e.jsx("span",{className:"text-xs text-gray-500 font-normal ml-2",children:"(Baseado no cÃ³digo do fornecedor)"})]}),e.jsx("input",{type:"text",value:u.sku,onChange:s=>v({...u,sku:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 font-mono",placeholder:"Ex: MGZ-12345"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ðŸ’¡ VocÃª pode editar o SKU se preferir"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Nome do Produto *"}),e.jsx("input",{type:"text",value:u.nome,onChange:s=>v({...u,nome:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Nome completo do produto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:u.descricao,onChange:s=>v({...u,descricao:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:"2",placeholder:"DescriÃ§Ã£o detalhada (opcional)"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"PreÃ§o de Custo *"}),e.jsx("input",{type:"number",step:"0.01",value:u.preco_custo,onChange:s=>{const a=s.target.value,r=parseFloat(u.margem_lucro)||0;v({...u,preco_custo:a,preco_venda:a?ae(parseFloat(a),r):""})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Margem (%) *"}),e.jsx("input",{type:"number",step:"0.01",value:u.margem_lucro,onChange:s=>{const a=s.target.value,r=parseFloat(u.preco_custo)||0;v({...u,margem_lucro:a,preco_venda:r&&a?ae(r,parseFloat(a)):""})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"PreÃ§o de Venda *"}),e.jsx("input",{type:"number",step:"0.01",value:u.preco_venda,onChange:s=>{const a=s.target.value,r=parseFloat(u.preco_custo)||0;v({...u,preco_venda:a,margem_lucro:r&&a?Ge(r,parseFloat(a)):""})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Estoque MÃ­nimo"}),e.jsx("input",{type:"number",value:u.estoque_minimo,onChange:s=>v({...u,estoque_minimo:parseInt(s.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Estoque MÃ¡ximo"}),e.jsx("input",{type:"number",value:u.estoque_maximo,onChange:s=>v({...u,estoque_maximo:parseInt(s.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]})]})}),e.jsxs("div",{className:"sticky bottom-0 bg-white border-t px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{I(!1),H(null),B(null)},className:"px-6 py-2 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{onClick:Be,disabled:h||!u.sku||!u.nome||!u.preco_custo||parseFloat(u.preco_custo)<=0||!u.preco_venda||parseFloat(u.preco_venda)<=0,className:"px-6 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:h?"â³ Criando...":"âœ… Criar e Vincular Produto"})]})]})}),Fe&&l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["ðŸ“„ NF-e ",l.numero_nota]}),e.jsxs("p",{className:"text-blue-100 mt-1",children:["SÃ©rie: ",l.serie]})]}),e.jsx("button",{onClick:()=>{O(!1),b(null)},className:"text-white hover:bg-white/20 rounded-full p-2 transition-colors",children:"âœ•"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-3",children:"ðŸ“‹ Dados da Nota"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Data EmissÃ£o:"}),e.jsx("span",{className:"font-semibold",children:new Date(l.data_emissao).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{children:je(l.status)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Total:"}),e.jsxs("span",{className:"font-bold text-green-600",children:["R$ ",l.valor_total.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-3",children:"ðŸ¢ Fornecedor"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Nome:"}),e.jsx("div",{className:"font-semibold",children:l.fornecedor_nome})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"CNPJ:"}),e.jsx("div",{className:"font-mono text-xs",children:l.fornecedor_cnpj})]})]})]})]}),e.jsxs("div",{className:"mb-6 p-3 bg-gray-50 rounded",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"ðŸ”‘ Chave de Acesso"}),e.jsx("div",{className:"font-mono text-xs break-all",children:l.chave_acesso})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((fe=l.itens)==null?void 0:fe.length)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Itens"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:l.produtos_vinculados}),e.jsx("div",{className:"text-sm text-gray-600",children:"Vinculados"})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:l.produtos_nao_vinculados}),e.jsx("div",{className:"text-sm text-gray-600",children:"NÃ£o Vinculados"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-3",children:"ðŸ“¦ Itens da Nota"}),e.jsx("div",{className:"space-y-3",children:(Ne=l.itens)==null?void 0:Ne.map((s,a)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:s.descricao}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["CÃ³digo: ",s.codigo_produto," | NCM: ",s.ncm]})]}),s.vinculado?e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded",children:"âœ“ Vinculado"}):e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs font-semibold rounded",children:"âš  NÃ£o Vinculado"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 text-sm mt-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Qtd:"}),e.jsx("div",{className:"font-semibold",children:s.quantidade})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Unit:"}),e.jsxs("div",{className:"font-semibold",children:["R$ ",s.valor_unitario.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("div",{className:"font-semibold text-green-600",children:["R$ ",s.valor_total.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"CFOP:"}),e.jsx("div",{className:"font-semibold",children:s.cfop})]})]}),(s.lote||s.data_validade)&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3 text-sm",children:[s.lote&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsx("span",{className:"text-gray-600",children:"ðŸ“¦ Lote:"}),e.jsx("div",{className:"font-semibold text-purple-800",children:s.lote})]}),s.data_validade&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded p-2",children:[e.jsx("span",{className:"text-gray-600",children:"ðŸ“… Validade:"}),e.jsx("div",{className:"font-semibold text-orange-800",children:new Date(s.data_validade).toLocaleDateString("pt-BR")})]})]}),s.vinculado&&s.produto_nome&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"â†’ Produto vinculado: "}),e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:s.produto_nome})]})]},s.id))})]})]}),e.jsxs("div",{className:"border-t p-6 bg-gray-50 flex justify-between items-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:l.entrada_estoque_realizada?e.jsx("span",{className:"text-green-600 font-semibold",children:"âœ… Entrada realizada no estoque"}):e.jsx("span",{className:"text-orange-600 font-semibold",children:"âš ï¸ Entrada ainda nÃ£o processada"})}),e.jsxs("div",{className:"flex gap-3",children:[l.status==="pendente"&&l.produtos_vinculados>0&&!l.entrada_estoque_realizada&&e.jsx(e.Fragment,{children:e.jsx("button",{onClick:()=>{O(!1),se(l.id)},className:"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold",children:"ðŸ’° Revisar PreÃ§os e Processar"})}),l.status==="pendente"&&e.jsx("button",{onClick:()=>{O(!1),ge(l.id)},className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold",children:"ðŸ”— Vincular Produtos"}),e.jsx("button",{onClick:()=>{O(!1),b(null)},className:"px-6 py-2 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50",children:"Fechar"})]})]})]})}),Ee&&w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white p-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"ðŸ’° RevisÃ£o de PreÃ§os e Custos"}),e.jsxs("p",{className:"text-purple-100 mt-1",children:["NF-e ",w.numero_nota," - ",w.fornecedor_nome]})]}),e.jsx("div",{className:"px-6 py-3 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Filtrar:"}),(()=>{const s=w.itens.filter(d=>d.produto_vinculado!==null||d.produto_id!==null),a=s.filter(d=>{var i;return(((i=d.produto_vinculado)==null?void 0:i.variacao_custo_percentual)||d.variacao_custo_percentual||0)>0}).length,r=s.filter(d=>{var i;return(((i=d.produto_vinculado)==null?void 0:i.variacao_custo_percentual)||d.variacao_custo_percentual||0)<0}).length,t=s.filter(d=>{var i;return(((i=d.produto_vinculado)==null?void 0:i.variacao_custo_percentual)||d.variacao_custo_percentual||0)===0}).length,o=s.length;return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>z("todos"),className:`px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1 transition-all ${F==="todos"?"bg-blue-600 text-white shadow-md":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx("span",{className:"text-base",children:"ðŸ“‹"}),"Todos (",o,")"]}),a>0&&e.jsxs("button",{onClick:()=>z("aumentou"),className:`px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1 transition-all ${F==="aumentou"?"bg-red-600 text-white shadow-md":"bg-red-100 text-red-700 hover:bg-red-200"}`,children:[e.jsx("span",{className:"text-base",children:"ðŸ“ˆ"}),a," custo",a>1?"s":""," maior",a>1?"es":""]}),r>0&&e.jsxs("button",{onClick:()=>z("diminuiu"),className:`px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1 transition-all ${F==="diminuiu"?"bg-green-600 text-white shadow-md":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:[e.jsx("span",{className:"text-base",children:"ðŸ“‰"}),r," custo",r>1?"s":""," menor",r>1?"es":""]}),t>0&&e.jsxs("button",{onClick:()=>z("igual"),className:`px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1 transition-all ${F==="igual"?"bg-gray-600 text-white shadow-md":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx("span",{className:"text-base",children:"âž¡ï¸"}),t," sem alteraÃ§Ã£o"]})]})})()]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"space-y-6",children:w.itens.filter(s=>{var t;if(!(s.produto_vinculado!==null||s.produto_id!==null))return!1;const r=((t=s.produto_vinculado)==null?void 0:t.variacao_custo_percentual)||s.variacao_custo_percentual||0;return F==="todos"?!0:F==="aumentou"?r>0:F==="diminuiu"?r<0:F==="igual"?r===0:!0}).map(s=>{const a=s.produto_vinculado||{produto_id:s.produto_id,produto_nome:s.produto_nome,produto_codigo:s.produto_codigo,produto_ean:s.produto_ean,custo_anterior:s.custo_anterior,custo_novo:s.custo_novo,variacao_custo_percentual:s.variacao_custo_percentual,preco_venda_atual:s.preco_venda_atual,margem_atual:s.margem_atual,estoque_atual:s.estoque_atual};if(!a.produto_id||!a.produto_id)return null;const r=a.variacao_custo_percentual||0,t=r>0,o=ce[a.produto_id]||{preco_venda:a.preco_venda_atual||0,margem:a.margem_atual||0};return e.jsxs("div",{className:"border-2 border-gray-300 rounded-xl overflow-hidden shadow-md hover:shadow-xl transition-all",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-500 text-white p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-xl mb-1",children:a.produto_nome}),e.jsxs("p",{className:"text-sm text-blue-100",children:["SKU: ",a.produto_codigo]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("button",{onClick:()=>Xe(a.produto_id,a.produto_nome),className:"px-3 py-1 bg-white/20 hover:bg-white/30 rounded text-sm font-medium transition-colors",children:"ðŸ“Š HistÃ³rico"}),e.jsxs("div",{className:"mt-1 text-sm",children:["Quantidade ",e.jsx("strong",{children:s.quantidade||s.quantidade_nf||0})]})]})]})}),e.jsxs("div",{className:"p-5 bg-white space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"ðŸ’µ Custo Anterior"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-700",children:["R$ ",(a.custo_anterior||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"ðŸ†• Custo Novo"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["R$ ",(a.custo_novo||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"ðŸ“Š VariaÃ§Ã£o"}),e.jsxs("div",{className:`text-2xl font-bold ${t?"text-red-600":r<0?"text-green-600":"text-gray-600"}`,children:[r>0?"â†—":r<0?"â†˜":"âž¡"," ",Math.abs(r).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"ðŸ’° PreÃ§o de Venda"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:o.preco_venda,onChange:d=>Ue(a.produto_id,parseFloat(d.target.value)||0,a.custo_novo),className:"w-full pl-10 pr-3 py-3 border-2 border-gray-300 rounded-lg text-xl font-bold focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Anterior: R$ ",a.preco_venda_atual.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"ðŸ“ˆ Margem de Lucro"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.1",value:o.margem,onChange:d=>Te(a.produto_id,parseFloat(d.target.value)||0,a.custo_novo),className:"w-full pr-10 pl-3 py-3 border-2 border-gray-300 rounded-lg text-xl font-bold focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:"%"})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"Com o novo custo"})]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-purple-800 mb-3",children:"ðŸ“Š AnÃ¡lise Comparativa (Valores Anteriores)"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"ðŸ’µ Custo Anterior"}),e.jsxs("div",{className:"text-lg font-bold text-gray-700",children:["R$ ",(a.custo_anterior||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"ðŸ’° PreÃ§o Anterior"}),e.jsxs("div",{className:"text-lg font-bold text-blue-700",children:["R$ ",(a.preco_venda_atual||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"ðŸ“ˆ Margem Anterior"}),e.jsxs("div",{className:"text-lg font-bold text-purple-700",children:[(a.margem_atual||0).toFixed(1),"%"]})]})]})]})]})]},s.item_id)}).filter(Boolean)})}),e.jsxs("div",{className:"border-t border-gray-200 p-6 bg-gray-50 flex justify-between items-center",children:[e.jsx("button",{onClick:()=>{Z(!1),J(null)},className:"px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors",children:"âŒ Cancelar"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Valor Total da Nota"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["R$ ",w.valor_total.toFixed(2)]})]}),e.jsx("button",{onClick:Ve,disabled:h,className:"px-8 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-lg font-bold text-lg shadow-lg disabled:opacity-50 transition-all",children:h?"â³ Processando...":"âœ… Confirmar e Processar Nota"})]})]})]})}),ke&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"ðŸ“Š HistÃ³rico de AlteraÃ§Ãµes de PreÃ§os"}),de&&e.jsx("p",{className:"mt-2 text-purple-100",children:de.nome})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:Pe?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-purple-600"})}):oe.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhuma alteraÃ§Ã£o de preÃ§o registrada"})}):e.jsx("div",{className:"space-y-4",children:oe.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:s.motivo==="nfe_entrada"?"ðŸ“¦":s.motivo==="nfe_revisao_precos"?"ðŸ’°":s.motivo==="manual"?"âœï¸":"ðŸ“"}),e.jsx("span",{className:"font-semibold text-gray-800",children:s.motivo==="nfe_entrada"?"Entrada NF-e":s.motivo==="nfe_revisao_precos"?"RevisÃ£o de PreÃ§os":s.motivo==="manual"?"Ajuste Manual":s.motivo})]}),s.referencia&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.referencia}),s.nota_numero&&e.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["Nota: ",s.nota_numero]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-500",children:[new Date(s.data).toLocaleString("pt-BR"),s.usuario&&e.jsx("div",{className:"text-xs mt-1",children:s.usuario})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.preco_custo_anterior!==null&&s.preco_custo_novo!==null&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 font-semibold mb-2",children:"ðŸ’µ CUSTO"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Anterior"}),e.jsxs("div",{className:"text-lg font-bold",children:["R$ ",s.preco_custo_anterior.toFixed(2)]})]}),e.jsx("div",{className:"text-2xl",children:"â†’"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Novo"}),e.jsxs("div",{className:"text-lg font-bold text-blue-700",children:["R$ ",s.preco_custo_novo.toFixed(2)]})]})]}),s.variacao_custo_percentual!==null&&s.variacao_custo_percentual!==0&&e.jsxs("div",{className:`mt-2 text-sm font-semibold text-center ${s.variacao_custo_percentual>0?"text-red-600":"text-green-600"}`,children:[s.variacao_custo_percentual>0?"â†‘":"â†“"," ",Math.abs(s.variacao_custo_percentual).toFixed(2),"%"]})]}),s.preco_venda_anterior!==null&&s.preco_venda_novo!==null&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 font-semibold mb-2",children:"ðŸ’² PREÃ‡O DE VENDA"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Anterior"}),e.jsxs("div",{className:"text-lg font-bold",children:["R$ ",s.preco_venda_anterior.toFixed(2)]})]}),e.jsx("div",{className:"text-2xl",children:"â†’"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Novo"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",s.preco_venda_novo.toFixed(2)]})]})]}),s.variacao_venda_percentual!==null&&s.variacao_venda_percentual!==0&&e.jsxs("div",{className:`mt-2 text-sm font-semibold text-center ${s.variacao_venda_percentual>0?"text-green-600":"text-red-600"}`,children:[s.variacao_venda_percentual>0?"â†‘":"â†“"," ",Math.abs(s.variacao_venda_percentual).toFixed(2),"%"]})]})]}),s.margem_anterior!==null&&s.margem_nova!==null&&e.jsxs("div",{className:"mt-3 bg-purple-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 font-semibold mb-2",children:"ðŸ“ˆ MARGEM DE LUCRO"}),e.jsxs("div",{className:"flex items-center justify-around",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Anterior"}),e.jsxs("div",{className:"text-xl font-bold",children:[s.margem_anterior.toFixed(1),"%"]})]}),e.jsx("div",{className:"text-2xl",children:"â†’"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Nova"}),e.jsxs("div",{className:"text-xl font-bold text-purple-700",children:[s.margem_nova.toFixed(1),"%"]})]})]})]}),s.observacoes&&e.jsx("div",{className:"mt-3 text-sm text-gray-600 italic bg-gray-50 rounded p-2",children:s.observacoes})]},s.id))})}),e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsx("button",{onClick:()=>{W(!1),le([]),ne(null)},className:"w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors",children:"Fechar"})})]})}),$e&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white p-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"ðŸ“¦ Resultado do Processamento em Lote"}),f&&e.jsxs("p",{className:"mt-2",children:[f.sucessos," sucesso(s) | ",f.erros," erro(s) | Total: ",f.total_arquivos]})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1",children:[C&&!f&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-green-600 mb-4"}),e.jsx("p",{className:"text-lg text-gray-600",children:"Processando arquivos..."})]}),f&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-100 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:f.total_arquivos}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:f.sucessos}),e.jsx("div",{className:"text-sm text-gray-600",children:"Sucessos"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:f.erros}),e.jsx("div",{className:"text-sm text-gray-600",children:"Erros"})]})]}),e.jsx("div",{className:"space-y-3",children:f.resultados.map((s,a)=>{var r;return e.jsx("div",{className:`border rounded-lg p-4 ${s.sucesso?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:s.sucesso?"âœ…":"âŒ"}),e.jsx("span",{className:"font-semibold text-gray-800",children:s.arquivo})]}),s.sucesso?e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Nota:"})," ",s.numero_nota]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Fornecedor:"})," ",s.fornecedor]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Valor:"})," R$ ",(r=s.valor_total)==null?void 0:r.toFixed(2)]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Produtos:"})," ",s.produtos_vinculados," vinculados, ",s.produtos_nao_vinculados," nÃ£o vinculados"]})]}):e.jsx("p",{className:"text-sm text-red-700",children:s.mensagem})]}),e.jsxs("span",{className:"text-sm text-gray-500 ml-4",children:["#",s.ordem]})]})},a)})})]})]}),e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsx("button",{onClick:()=>{G(!1),Q(null)},disabled:C,className:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold disabled:opacity-50 transition-colors",children:C?"â³ Processando...":"Fechar"})})]})})]})};export{Ye as default};
