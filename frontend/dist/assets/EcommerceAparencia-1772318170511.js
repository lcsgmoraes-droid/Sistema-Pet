import{r as c,j as e}from"./vendor-react-1772318170511.js";import{a as w}from"./api-1772318170511.js";import"./index-1772318170511.js";const B=[{key:"logo",label:"Logo da Loja",desc:"Aparece no cabeÃ§alho da loja virtual (recomendado: 200Ã—80 px)",targetW:400,targetH:160},{key:"banner_1",label:"Banner 1",desc:"Primeiro slide do banner rotativo â€” serÃ¡ redimensionado para atÃ© 1200 px de largura",targetW:1200,targetH:null},{key:"banner_2",label:"Banner 2",desc:"Segundo slide (opcional)",targetW:1200,targetH:null},{key:"banner_3",label:"Banner 3",desc:"Terceiro slide (opcional)",targetW:1200,targetH:null}];function L(p,l,n,b=.9){return new Promise((i,v)=>{const r=new Image,x=URL.createObjectURL(p);r.onload=()=>{URL.revokeObjectURL(x);const s=document.createElement("canvas"),j=s.getContext("2d");if(n===null){const d=r.naturalWidth>l?l/r.naturalWidth:1;s.width=Math.round(r.naturalWidth*d),s.height=Math.round(r.naturalHeight*d),j.drawImage(r,0,0,s.width,s.height)}else{s.width=l,s.height=n,j.fillStyle="#ffffff",j.fillRect(0,0,l,n);const d=Math.min(l/r.naturalWidth,n/r.naturalHeight),h=r.naturalWidth*d,f=r.naturalHeight*d,S=(l-h)/2,k=(n-f)/2;j.drawImage(r,S,k,h,f)}s.toBlob(d=>d?i(d):v(new Error("canvas toBlob falhou")),"image/jpeg",b)},r.onerror=()=>{URL.revokeObjectURL(x),v(new Error("Falha ao carregar imagem"))},r.src=x})}function I({url:p,label:l,cacheBuster:n,isBanner:b}){if(!p)return e.jsx("div",{style:{width:"100%",minHeight:120,background:"#f3f4f6",border:"2px dashed #d1d5db",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",color:"#9ca3af",fontSize:14},children:"Sem imagem"});const i=p.startsWith("/uploads/")?`${p}?t=${n}`:p;return e.jsx("img",{src:i,alt:l,style:{width:"100%",height:b?140:100,objectFit:"contain",background:"#111",borderRadius:8,border:"1px solid #e5e7eb",display:"block"}})}function $(){const[p,l]=c.useState({logo_url:null,banner_1_url:null,banner_2_url:null,banner_3_url:null}),[n,b]=c.useState(""),[i,v]=c.useState(""),[r,x]=c.useState(!1),[s,j]=c.useState(!0),[d,h]=c.useState({}),[f,S]=c.useState(null),[k,W]=c.useState(Date.now()),z=c.useRef({});c.useEffect(()=>{const a=w.get("/ecommerce-aparencia").then(t=>l(t.data)).catch(()=>S({tipo:"erro",texto:"NÃ£o foi possÃ­vel carregar as configuraÃ§Ãµes."})),o=w.get("/ecommerce-aparencia/tenant-context").then(t=>{b(t.data.ecommerce_slug||""),v(t.data.ecommerce_slug||"")}).catch(()=>{});Promise.all([a,o]).finally(()=>j(!1))},[]);function y(a,o){S({tipo:a,texto:o}),setTimeout(()=>S(null),4e3)}async function C(){var a,o;x(!0);try{await w.put("/ecommerce-aparencia/slug",{slug:n.trim()}),v(n.trim()),y("ok","EndereÃ§o da loja salvo com sucesso!")}catch(t){const m=(o=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:o.detail;y("erro",m||"Erro ao salvar o endereÃ§o.")}finally{x(!1)}}async function _(a,o){h(t=>({...t,[a]:!0}));try{const t=B.find(R=>R.key===a);let m=o;if(t&&o.type.startsWith("image/")){const R=await L(o,t.targetW,t.targetH);m=new File([R],o.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})}const u=new FormData;u.append("file",m);const g=await w.post(`/ecommerce-aparencia/upload/${a}`,u,{headers:{"Content-Type":"multipart/form-data"}});l(g.data),W(Date.now()),y("ok","Imagem salva com sucesso!")}catch{y("erro","Erro ao enviar a imagem. Verifique o formato e o tamanho (mÃ¡x. 5 MB).")}finally{h(t=>({...t,[a]:!1}))}}async function E(a){h(o=>({...o,[a]:!0}));try{const o=await w.delete(`/ecommerce-aparencia/${a}`);l(o.data),W(Date.now()),y("ok","Imagem removida.")}catch{y("erro","Erro ao remover a imagem.")}finally{h(o=>({...o,[a]:!1}))}}return s?e.jsx("div",{style:{padding:40,textAlign:"center",color:"#6b7280"},children:"Carregando..."}):e.jsxs("div",{style:{maxWidth:800,margin:"0 auto",padding:"32px 24px"},children:[e.jsx("h1",{style:{fontSize:24,fontWeight:700,color:"#111827",marginBottom:4},children:"ðŸ–¼ï¸ AparÃªncia da Loja"}),e.jsx("p",{style:{color:"#6b7280",marginBottom:32},children:"Configure o logo e os banners que aparecem na sua loja virtual."}),f&&e.jsxs("div",{style:{padding:"12px 16px",borderRadius:8,marginBottom:24,background:f.tipo==="ok"?"#f0fdf4":"#fef2f2",color:f.tipo==="ok"?"#166534":"#991b1b",border:`1px solid ${f.tipo==="ok"?"#bbf7d0":"#fecaca"}`,fontWeight:500},children:[f.tipo==="ok"?"âœ… ":"âŒ ",f.texto]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsxs("div",{style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:24,boxShadow:"0 1px 3px rgba(0,0,0,0.06)"},children:[e.jsx("div",{style:{marginBottom:4},children:e.jsx("span",{style:{fontWeight:600,fontSize:16,color:"#111827"},children:"ðŸ”— EndereÃ§o da loja"})}),e.jsx("p",{style:{fontSize:13,color:"#9ca3af",margin:"0 0 12px"},children:"Define a URL pÃºblica da sua loja. Use apenas letras minÃºsculas, nÃºmeros e hÃ­fens."}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("span",{style:{fontSize:13,color:"#6b7280",whiteSpace:"nowrap",flexShrink:0},children:"mlprohub.com.br/"}),e.jsx("input",{type:"text",value:n,onChange:a=>b(a.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"")),placeholder:"nome-da-loja",style:{flex:1,minWidth:160,padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:7,fontSize:14}}),e.jsx("button",{onClick:C,disabled:r||n===i,style:{padding:"8px 18px",background:r||n===i?"#d1d5db":"#6366f1",color:"#fff",border:"none",borderRadius:7,fontWeight:600,cursor:r||n===i?"not-allowed":"pointer",fontSize:14,flexShrink:0},children:r?"Salvando...":"Salvar"})]}),i&&e.jsxs("div",{style:{marginTop:8,fontSize:12,color:"#6b7280"},children:["ðŸŒ Loja pÃºblica:"," ",e.jsxs("a",{href:`/${i}`,target:"_blank",rel:"noreferrer",style:{color:"#6366f1"},children:["mlprohub.com.br/",i]})]})]}),B.map(({key:a,label:o,desc:t})=>{const m=p[`${a}_url`],u=d[a];return e.jsxs("div",{style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:24,boxShadow:"0 1px 3px rgba(0,0,0,0.06)"},children:[e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("span",{style:{fontWeight:600,fontSize:16,color:"#111827"},children:o}),e.jsx("span",{style:{marginLeft:10,fontSize:13,color:"#9ca3af"},children:t})]}),e.jsx(I,{url:m,label:o,cacheBuster:k,isBanner:a!=="logo"}),e.jsxs("div",{style:{marginTop:14,display:"flex",gap:10,flexWrap:"wrap",alignItems:"center"},children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",style:{display:"none"},ref:g=>z.current[a]=g,onChange:g=>g.target.files[0]&&_(a,g.target.files[0])}),e.jsx("button",{onClick:()=>{var g;return(g=z.current[a])==null?void 0:g.click()},disabled:u,style:{padding:"8px 18px",background:u?"#d1d5db":"#6366f1",color:"#fff",border:"none",borderRadius:7,fontWeight:600,cursor:u?"not-allowed":"pointer",fontSize:14},children:u?"Enviando...":m?"ðŸ”„ Trocar imagem":"ðŸ“¤ Fazer upload"}),m&&e.jsx("button",{onClick:()=>E(a),disabled:u,style:{padding:"8px 14px",background:"#fff",color:"#dc2626",border:"1px solid #fca5a5",borderRadius:7,fontWeight:500,cursor:u?"not-allowed":"pointer",fontSize:14},children:"ðŸ—‘ Remover"})]})]},a)})]}),e.jsxs("div",{style:{marginTop:32,padding:16,background:"#fffbeb",borderRadius:10,border:"1px solid #fde68a",fontSize:13,color:"#92400e"},children:[e.jsx("strong",{children:"ðŸ’¡ Dica:"})," As imagens sÃ£o redimensionadas automaticamente ao fazer upload. Para ver o resultado, acesse a ",e.jsx("a",{href:"/ecommerce",style:{color:"#6366f1"},children:"prÃ©via da loja"}),"."]})]})}export{$ as default};
