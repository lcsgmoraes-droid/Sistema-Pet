import{r as a,j as e,N as ur,C as Rs,M as rl,b as ol,u as _r,X as ma,d as Ms,L as pr,z as Se,F as ll,e as Qt,f as wo,P as Ea,h as Et,i as Co,k as nl,l as st,m as il,n as dl,o as Vs,p as Ga,q as Zs,s as bt,t as cl,v as xl,w as ko,x as Zr,y as us,B as Os,D as Ls,E as tt,G as ml,O as ul,H as fa,I as Na,J as wr,K as gr,Q as hr,S as Xt,T as is,U as os,V as Ns,W as qs,Y as vt,Z as or,_ as So,$ as ft,a0 as zs,a1 as Eo,a2 as Cr,a3 as Fo,a4 as pl,a5 as Qa,a6 as Jt,a7 as _s,a8 as ps,a9 as yt,aa as Yt,ab as rt,ac as Is,R as ts,ad as Bs,ae as lr,af as Ra,ag as Va,ah as Za,ai as Fa,aj as ha,ak as ds,al as ws,am as kr,an as br,ao as $o,ap as gl,aq as eo,ar as Xa,as as ot,at as lt,au as gs,av as da,aw as La,ax as Aa,ay as Ys,az as Po,aA as Ro,aB as Ao,aC as Ts,aD as Nt,aE as Zt,aF as hl,aG as fr,aH as ce,aI as nt,aJ as ao,aK as Cs,aL as bl,aM as fl,aN as jl,aO as Do,aP as As,aQ as Mo,aR as er,aS as so,aT as _t,aU as ar,aV as rs,aW as vl,aX as et,aY as nr,aZ as yl,a_ as wt,a$ as Ct,b0 as to,b1 as Nl,b2 as ms,b3 as Lo,b4 as Sr,b5 as _l,b6 as wl,b7 as sr,b8 as tr,b9 as qo,ba as zo,bb as kt,bc as St,bd as js,be as vs,bf as Io,bg as To,bh as Cl,bi as Ot,bj as Ht,bk as ro,bl as Vo,bm as kl,bn as Sl,bo as El,bp as Er,bq as Bt,br as Fl,bs as $l,bt as ir,bu as oo,bv as Pl,bw as Oo,bx as Rl,by as Al,bz as Dl,bA as Ml,bB as Ge,bC as Ll}from"./vendor-react-1772053531876.js";import{as as Bo,P as Gs,at as ql,au as Uo,av as Fr,aw as zl}from"./vendor-1772053531876.js";import{R as Ma,L as it,C as Oa,X as Ba,Y as Ia,T as Pa,a as Ta,b as ls,B as ns,c as Ka,d as Gt,P as jr,e as vr,A as Il,f as lo}from"./vendor-charts-1772053531876.js";import{u as $s,w as Tl,F as Vl}from"./vendor-utils-1772053531876.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))m(r);new MutationObserver(r=>{for(const g of r)if(g.type==="childList")for(const o of g.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&m(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const g={};return r.integrity&&(g.integrity=r.integrity),r.referrerPolicy&&(g.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?g.credentials="include":r.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function m(r){if(r.ep)return;r.ep=!0;const g=t(r);fetch(r.href,g)}})();const Ol="/api",Bl=Ol,Wo=(...s)=>{},Ul=(...s)=>{},F=Bo.create({baseURL:Bl,headers:{"Content-Type":"application/json"}});F.interceptors.request.use(s=>{const l=localStorage.getItem("access_token")||localStorage.getItem("token");return l&&(s.headers.Authorization=`Bearer ${l}`),Wo("[API Request]",{method:s.method,url:s.url,baseURL:s.baseURL}),s},s=>Promise.reject(s));F.interceptors.response.use(s=>{var l;return Wo("[API Response]",{status:s.status,url:(l=s.config)==null?void 0:l.url}),s},s=>{var t,m,r,g;const l=(t=s.response)==null?void 0:t.status;return Ul("[API Response Error]",{status:l,url:(m=s.config)==null?void 0:m.url,fullURL:`${((r=s.config)==null?void 0:r.baseURL)||""}${((g=s.config)==null?void 0:g.url)||""}`}),l===401&&(localStorage.removeItem("access_token"),localStorage.removeItem("token"),localStorage.removeItem("tenants"),window.location.href="/login"),Promise.reject(s)});const Ko=a.createContext(),ct=()=>{const s=a.useContext(Ko);if(!s)throw new Error("useAuth deve ser usado dentro de AuthProvider");return s},Wl=({children:s})=>{const[l,t]=a.useState(null),[m,r]=a.useState(!0);a.useEffect(()=>{(async()=>{try{const d=localStorage.getItem("access_token"),x=localStorage.getItem("user");d&&x?(t(JSON.parse(x)),await g()):r(!1)}catch(d){console.error("Erro ao inicializar auth:",d),r(!1)}})()},[]);const g=async()=>{try{const N=await F.get("/auth/me-multitenant");t(N.data),localStorage.setItem("user",JSON.stringify(N.data)),r(!1)}catch(N){console.error("Erro ao buscar usuÃ¡rio:",N),localStorage.removeItem("access_token"),localStorage.removeItem("tenants"),localStorage.removeItem("user"),t(null),r(!1)}},f={user:l,loading:m,login:async(N,d)=>{var x,k;try{console.log("ðŸ” Iniciando login para:",N);const w=await F.post("/auth/login-multitenant",{email:N,password:d}),{access_token:c,tenants:b}=w.data;if(console.log("âœ… Login fase 1 OK - Tenants:",b.length),b&&b.length>0){localStorage.setItem("tempToken",c),console.log("ðŸ“ Selecionando tenant:",b[0].name);const i=(await F.post("/auth/select-tenant",{tenant_id:b[0].id},{headers:{Authorization:`Bearer ${c}`}})).data.access_token;localStorage.setItem("access_token",i),localStorage.setItem("selectedTenant",JSON.stringify(b[0])),console.log("âœ… Tenant selecionado OK");const u=await F.get("/auth/me-multitenant");return t(u.data),localStorage.setItem("user",JSON.stringify(u.data)),console.log("âœ… Login completo! Redirecionando..."),{success:!0}}else return console.error("âŒ Nenhum tenant disponÃ­vel"),{success:!1,error:"Nenhuma empresa disponÃ­vel para este usuÃ¡rio"}}catch(w){return console.error("Erro no login:",w),{success:!1,error:((k=(x=w.response)==null?void 0:x.data)==null?void 0:k.detail)||"Erro ao fazer login"}}},register:async(N,d,x)=>{var k,w;try{const c=await F.post("/auth/register",{email:N,password:d,nome:x}),{access_token:b}=c.data;localStorage.setItem("access_token",b);const p=await F.get("/auth/me-multitenant");return t(p.data),localStorage.setItem("user",JSON.stringify(p.data)),{success:!0}}catch(c){return console.error("Erro no registro:",c),{success:!1,error:((w=(k=c.response)==null?void 0:k.data)==null?void 0:w.detail)||"Erro ao criar conta"}}},logout:async()=>{try{await F.post("/auth/logout-multitenant")}catch(N){console.error("Erro ao fazer logout:",N)}finally{localStorage.removeItem("access_token"),localStorage.removeItem("tenants"),localStorage.removeItem("user"),localStorage.removeItem("selectedTenant"),localStorage.removeItem("tempToken"),t(null),window.location.href="/login"}},isAuthenticated:!!l};return e.jsx(Ko.Provider,{value:f,children:s})},ba=({children:s,permission:l,requiredPermissions:t})=>{var o,v;const{isAuthenticated:m,loading:r,user:g}=ct();if(r)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})});if(!m)return e.jsx(ur,{to:"/login",replace:!0});if(l||t){const j=(g==null?void 0:g.permissions)||[];if(((v=(o=g==null?void 0:g.role)==null?void 0:o.name)==null?void 0:v.toLowerCase())==="admin")return s;if(l&&!j.includes(l))return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ”’"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Acesso Negado"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"VocÃª nÃ£o tem permissÃ£o para acessar esta pÃ¡gina."}),e.jsxs("p",{className:"text-sm text-gray-500",children:["PermissÃ£o necessÃ¡ria: ",l]}),e.jsx("button",{onClick:()=>window.history.back(),className:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Voltar"})]})});if(t&&t.length>0&&!t.every(d=>j.includes(d)))return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ”’"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Acesso Negado"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"VocÃª nÃ£o tem permissÃ£o para acessar esta pÃ¡gina."}),e.jsxs("p",{className:"text-sm text-gray-500",children:["PermissÃµes necessÃ¡rias: ",t.join(", ")]}),e.jsx("button",{onClick:()=>window.history.back(),className:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Voltar"})]})})}return s};function Kl({onClick:s}){const[l,t]=a.useState(window.innerWidth<768),[m,r]=a.useState(!1),[g,o]=a.useState(!1),[v,j]=a.useState({x:0,y:0}),[f,N]=a.useState({x:0,y:0});a.useEffect(()=>{const C=()=>{t(window.innerWidth<768)};return window.addEventListener("resize",C),()=>window.removeEventListener("resize",C)},[]);const d=(C,h)=>{const _=window.innerWidth-(h?60:200),E=window.innerHeight-(h?60:300);return{x:Math.max(20,Math.min(C.x,_)),y:Math.max(20,Math.min(C.y,E))}},[x,k]=a.useState(()=>{if(window.innerWidth<768)return{x:window.innerWidth-70,y:80};const C=localStorage.getItem("calc_button_pos"),h={x:window.innerWidth-150,y:window.innerHeight-150};if(C)try{const _=JSON.parse(C);return d(_,!0)}catch{return h}return h}),[w,c]=a.useState(()=>localStorage.getItem("calc_button_minimizado")==="true"),b=C=>{if(l)return;if(C.target.closest('button[title="Expandir"], button[title="Minimizar"]')){C.stopPropagation();return}r(!0),o(!1),N({x:C.clientX,y:C.clientY}),j({x:C.clientX-x.x,y:C.clientY-x.y})},p=C=>{if(m){Math.sqrt(Math.pow(C.clientX-f.x,2)+Math.pow(C.clientY-f.y,2))>5&&o(!0);const _=C.clientX-v.x,E=C.clientY-v.y,$=window.innerWidth-(w?60:200),K=window.innerHeight-(w?60:300),te={x:Math.max(20,Math.min(_,$)),y:Math.max(20,Math.min(E,K))};k(te)}},i=()=>{m&&(r(!1),localStorage.setItem("calc_button_pos",JSON.stringify(x)))};a.useEffect(()=>{if(m)return document.addEventListener("mousemove",p),document.addEventListener("mouseup",i),()=>{document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",i)}},[m,v,x]);const u=C=>{console.log("ðŸ–±ï¸ Clique detectado, hasDragged:",g),g?console.log("âŒ Ignorando clique (foi arraste)"):(console.log("âœ… Abrindo calculadora..."),s())},n=C=>{C.stopPropagation();const h=!w;if(!h){const _=d(x,!1);(_.x!==x.x||_.y!==x.y)&&(k(_),localStorage.setItem("calc_button_pos",JSON.stringify(_)))}c(h),localStorage.setItem("calc_button_minimizado",h.toString())};return a.useEffect(()=>{const C=()=>{if(window.innerWidth<768)k({x:window.innerWidth-70,y:80});else{const _=d(x,w);(_.x!==x.x||_.y!==x.y)&&(k(_),localStorage.setItem("calc_button_pos",JSON.stringify(_)))}};return window.addEventListener("resize",C),()=>window.removeEventListener("resize",C)},[x,w]),e.jsx("div",{className:"fixed z-50",style:{left:`${x.x}px`,top:`${x.y}px`},children:w?e.jsxs("div",{className:`relative group ${l?"":"cursor-move"}`,onMouseDown:l?void 0:b,children:[e.jsx("button",{onClick:u,onMouseDown:C=>C.stopPropagation(),className:`calc-button-main\r
              flex items-center justify-center\r
              w-12 h-12 md:w-12 md:h-12\r
              bg-gradient-to-br from-orange-500 to-orange-600\r
              hover:from-orange-600 hover:to-orange-700\r
              text-white\r
              rounded-full\r
              shadow-lg hover:shadow-xl\r
              transition-all duration-200\r
              hover:scale-110\r
              active:scale-95\r
              pointer-events-auto\r
            `,title:"Calculadora de RaÃ§Ã£o",children:e.jsx(Rs,{size:20})}),!l&&e.jsx("button",{onClick:n,onMouseDown:C=>C.stopPropagation(),className:`\r
                absolute -bottom-1 -right-1\r
                bg-blue-600 hover:bg-blue-700\r
                text-white\r
                w-6 h-6\r
                rounded-full\r
                flex items-center justify-center\r
                opacity-0 group-hover:opacity-100\r
                transition-opacity\r
                shadow-md\r
              `,title:"Expandir",children:e.jsx(rl,{size:12})})]}):e.jsxs("div",{className:`\r
            flex flex-col gap-2\r
            bg-white\r
            rounded-2xl\r
            shadow-2xl\r
            p-3\r
            border-2 border-orange-500\r
            min-w-[140px]\r
          `,style:{cursor:m?"grabbing":"default"},children:[e.jsxs("div",{className:`flex items-center justify-between gap-2 drag-handle ${l?"":"cursor-move"}`,onMouseDown:l?void 0:b,children:[e.jsxs("div",{className:"flex items-center gap-2 pointer-events-none",children:[e.jsx("div",{className:`\r
                w-10 h-10\r
                bg-gradient-to-br from-orange-500 to-orange-600\r
                rounded-full\r
                flex items-center justify-center\r
                text-white\r
              `,children:e.jsx(Rs,{size:20})}),e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"Calculadora"})]}),e.jsx("button",{onClick:n,className:`\r
                p-1 hover:bg-gray-100 \r
                rounded-lg transition-colors\r
                pointer-events-auto\r
              `,title:"Minimizar",children:e.jsx(ol,{size:16,className:"text-gray-500"})})]}),e.jsx("button",{onClick:u,className:`calc-button-main\r
              w-full\r
              px-4 py-2\r
              bg-gradient-to-r from-orange-500 to-orange-600\r
              hover:from-orange-600 hover:to-orange-700\r
              text-white\r
              rounded-lg\r
              font-medium text-sm\r
              transition-all\r
              hover:shadow-lg\r
            `,children:"ðŸ¥« Calcular RaÃ§Ã£o"}),!l&&e.jsx("div",{className:"text-[10px] text-gray-500 text-center",children:"Arraste para mover"})]})})}function Ho(s){var r,g;if(!s)return!1;if(s.peso_embalagem&&s.peso_embalagem>0)return!0;const l=((r=s.classificacao_racao)==null?void 0:r.toLowerCase())||"",t=s.categoria_id||s.category_id,m=((g=s.categoria_nome)==null?void 0:g.toLowerCase())||"";return l&&l!=="nÃ£o Ã© raÃ§Ã£o"||m.includes("raÃ§Ã£o")||m.includes("racao")||t===5}function Hl({isOpen:s=!1,onClose:l=()=>{},itensCarrinho:t=[],clienteId:m=null}){var O,z,ae,W,ne;const g=_r().pathname==="/pdv",[o,v]=a.useState(window.innerWidth<768);a.useEffect(()=>{const H=()=>{v(window.innerWidth<768)};return window.addEventListener("resize",H),()=>window.removeEventListener("resize",H)},[]);const[j,f]=a.useState(null),[N,d]=a.useState(null),[x,k]=a.useState(null),[w,c]=a.useState(!1),[b,p]=a.useState(null),[i,u]=a.useState(null),[n,C]=a.useState(!1),[h,_]=a.useState(""),[E,$]=a.useState([]),[K,te]=a.useState(!1),[M,A]=a.useState({peso_pet_kg:"",idade_meses:"",nivel_atividade:"normal"}),[Q,re]=a.useState(!1),[q,Z]=a.useState({x:0,y:0}),[R,J]=a.useState({x:0,y:0}),S=g?(()=>{try{const H=sessionStorage.getItem("pdv_calculadora_data");if(console.log("ðŸ” Calculadora Universal - Dados do PDV:",H),H){const{itens:ee}=JSON.parse(H),de=(ee||[]).filter(ue=>Ho(ue));return console.log("ðŸ¥« RaÃ§Ãµes encontradas:",de),de}}catch(H){console.error("Erro ao ler dados do PDV:",H)}return[]})():[];a.useEffect(()=>{if(!g&&h.length>=2){const H=setTimeout(async()=>{te(!0);try{const ee=await F.get("/produtos/",{params:{busca:h}}),ue=(ee.data.items||ee.data.produtos||[]).filter(Re=>Re.peso_embalagem&&Re.peso_embalagem>0);$(ue)}catch(ee){console.error("Erro ao buscar raÃ§Ãµes:",ee)}finally{te(!1)}},300);return()=>clearTimeout(H)}else $([])},[h,g]),a.useEffect(()=>{s||Z({x:0,y:0})},[s]),a.useEffect(()=>{if(s&&g&&S.length>0){const H=S[S.length-1];f(H.produto_id),d(H),H.pet_id&&P(H.pet_id)}},[s,S.length,g]);const P=async H=>{try{const de=(await F.get(`/pets/${H}`)).data;k(de),A({...M,peso_pet_kg:de.peso_kg||de.peso||"",idade_meses:de.idade_meses||de.idade_aproximada||""})}catch(ee){console.error("Erro ao buscar pet:",ee)}},G=async()=>{if(console.log("ðŸ” Iniciando cÃ¡lculo..."),console.log("ðŸ“¦ RaÃ§Ã£o selecionada:",N),console.log("ðŸ“ FormulÃ¡rio:",M),!N){console.log("âŒ Nenhuma raÃ§Ã£o selecionada"),Se.error("Selecione uma raÃ§Ã£o");return}if(!M.peso_pet_kg){console.log("âŒ Peso do pet nÃ£o informado"),Se.error("Informe o peso do pet");return}try{c(!0),u(null),p(null);const ee={produto_id:N.produto_id||N.id,peso_pet_kg:parseFloat(M.peso_pet_kg),idade_meses:M.idade_meses?parseInt(M.idade_meses):null,nivel_atividade:M.nivel_atividade};console.log("ðŸ“¤ Enviando payload:",ee);const de=await F.post("/produtos/calculadora-racao",ee);if(console.log("ðŸ“¥ Resposta recebida:",de.data),de.data){const ue={duracao_pacote_dias:de.data.duracao_dias,duracao_meses:de.data.duracao_meses,consumo_diario_gramas:de.data.quantidade_diaria_g,custo_por_kg:de.data.custo_por_kg,custo_diario:de.data.custo_por_dia,custo_mensal:de.data.custo_mensal};p(ue),Se.success("CÃ¡lculo realizado!")}}catch(ee){console.error("âŒ Erro ao calcular:",ee),Se.error("Erro ao calcular. Tente novamente.")}finally{c(!1)}},B=H=>{f(H.id),d(H),_(`${H.nome} - ${H.peso_embalagem}kg`),C(!1)},y=H=>{o||H.target.closest("button")||H.target.closest("input")||H.target.closest("select")||(re(!0),J({x:H.clientX-q.x,y:H.clientY-q.y}))};return a.useEffect(()=>{const H=de=>{Q&&Z({x:de.clientX-R.x,y:de.clientY-R.y})},ee=()=>{re(!1)};if(Q)return window.addEventListener("mousemove",H),window.addEventListener("mouseup",ee),()=>{window.removeEventListener("mousemove",H),window.removeEventListener("mouseup",ee)}},[Q,R]),s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start md:items-center justify-center z-50 p-0 md:p-4 overflow-y-auto",children:e.jsxs("div",{className:`
          bg-white 
          ${o?"w-full min-h-screen rounded-none":"rounded-xl w-full max-w-2xl max-h-[90vh]"} 
          shadow-2xl overflow-hidden flex flex-col
        `,style:o?{}:{transform:`translate(${q.x}px, ${q.y}px)`,cursor:Q?"grabbing":"default"},children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white px-4 md:px-6 py-3 md:py-4 flex items-center justify-between",onMouseDown:o?void 0:y,style:{cursor:o?"default":Q?"grabbing":"grab"},children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("span",{className:"text-2xl md:text-3xl",children:"ðŸ¥«"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold",children:"Calculadora de RaÃ§Ã£o"}),e.jsx("p",{className:"text-xs md:text-sm text-orange-100",children:g?"RaÃ§Ãµes do carrinho":"Buscar raÃ§Ã£o manualmente"})]})]}),e.jsx("button",{onClick:l,className:"p-1.5 md:p-2 hover:bg-orange-400 rounded-lg transition-colors",children:e.jsx(ma,{size:o?20:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700",children:[g?"RaÃ§Ã£o do Carrinho":"Buscar RaÃ§Ã£o"," *"]}),g?S.length>0?e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:(N==null?void 0:N.produto_nome)||"",readOnly:!0,className:"w-full px-4 py-3 pr-10 bg-gray-50 border-2 border-gray-300 rounded-lg text-gray-700 font-medium cursor-pointer",placeholder:"Nenhuma raÃ§Ã£o no carrinho"}),e.jsx("button",{type:"button",onClick:()=>C(!n),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:e.jsx(Ms,{size:20,className:`transition-transform ${n?"rotate-180":""}`})}),n&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-300 rounded-lg shadow-xl z-10 max-h-48 overflow-y-auto",children:S.map((H,ee)=>e.jsxs("button",{type:"button",onClick:()=>{f(H.produto_id),d(H),C(!1),H.pet_id&&P(H.pet_id)},className:`w-full px-4 py-3 text-left hover:bg-orange-50 transition-colors ${H.produto_id===j?"bg-orange-100 border-l-4 border-l-orange-600":""}`,children:[e.jsx("div",{className:"font-medium",children:H.produto_nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:[H.peso_embalagem,"kg â€¢ R$ ",H.preco_unitario.toFixed(2),H.pet_id&&" â€¢ ðŸ¾ Pet vinculado"]})]},ee))})]}):e.jsx("div",{className:"px-4 py-3 bg-yellow-50 border-2 border-yellow-300 rounded-lg text-yellow-700",children:"Adicione raÃ§Ãµes ao carrinho para calcular"}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:h,onChange:H=>_(H.target.value),onFocus:()=>E.length>0&&C(!0),placeholder:"Digite para buscar raÃ§Ã£o...",className:"w-full px-4 py-3 pr-20 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200"}),K?e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx(pr,{size:20,className:"animate-spin text-orange-500"})}):E.length>0&&e.jsx("button",{type:"button",onClick:()=>C(!n),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:e.jsx(Ms,{size:20,className:`transition-transform ${n?"rotate-180":""}`})})]}),n&&E.length>0&&e.jsx("div",{className:"bg-white border-2 border-gray-300 rounded-lg shadow-xl max-h-64 overflow-y-auto",children:E.map(H=>{var ee;return e.jsxs("button",{type:"button",onClick:()=>B(H),className:`w-full px-4 py-3 text-left hover:bg-orange-50 transition-colors border-b last:border-b-0 ${H.id===j?"bg-orange-100 border-l-4 border-l-orange-600":""}`,children:[e.jsx("div",{className:"font-medium",children:H.nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:[H.peso_embalagem,"kg â€¢ R$ ",(ee=H.preco_venda)==null?void 0:ee.toFixed(2),H.classificacao_racao&&` â€¢ ${H.classificacao_racao}`]})]},H.id)})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Peso do Pet (kg) *"}),e.jsx("input",{type:"number",step:"0.1",value:M.peso_pet_kg,onChange:H=>A({...M,peso_pet_kg:H.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200",placeholder:"Ex: 8.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Idade (meses)"}),e.jsx("input",{type:"number",value:M.idade_meses,onChange:H=>A({...M,idade_meses:H.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200",placeholder:"Ex: 24"})]})]}),g&&x&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx("span",{className:"text-xl",children:"ðŸ•"}),e.jsx("span",{className:"font-medium",children:x.nome})]}),e.jsx("div",{className:"text-sm text-blue-600 mt-1",children:"Dados carregados automaticamente do cadastro"})]}),b&&e.jsxs("div",{className:"bg-green-50 border-2 border-green-200 rounded-xl p-6 space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-green-800 flex items-center gap-2",children:[e.jsx("span",{children:"âœ…"})," Resultados do CÃ¡lculo"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"â±ï¸ DuraÃ§Ã£o"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[Math.floor(b.duracao_pacote_dias)," dias"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(O=b.duracao_meses)==null?void 0:O.toFixed(1)," meses"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"ðŸ¥« Consumo diÃ¡rio"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[(z=b.consumo_diario_gramas)==null?void 0:z.toFixed(0),"g"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"ðŸ’° Custo/kg"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",(ae=b.custo_por_kg)==null?void 0:ae.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"ðŸ“… Custo/dia"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",(W=b.custo_diario)==null?void 0:W.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 col-span-1 sm:col-span-2",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"ðŸ“† Custo mensal"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",(ne=b.custo_mensal)==null?void 0:ne.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border-t px-4 md:px-6 py-3 md:py-4 flex flex-col-reverse sm:flex-row justify-end gap-2 md:gap-3",children:[e.jsx("button",{onClick:l,className:"px-6 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors font-medium",children:"Fechar"}),e.jsx("button",{onClick:G,disabled:w,className:"px-6 py-3 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white rounded-lg font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:w?e.jsxs(e.Fragment,{children:[e.jsx(pr,{size:20,className:"animate-spin"}),"Calculando..."]}):e.jsx(e.Fragment,{children:"ðŸ§® Calcular Consumo"})})]})]})}):null}const Gl=()=>{var i,u,n,C;const s=_r(),{user:l,logout:t}=ct(),[m,r]=a.useState(window.innerWidth<768);a.useEffect(()=>{const h=()=>{r(window.innerWidth<768)};return window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]);const g=h=>{var E,$;return l?((E=l.role)==null?void 0:E.name)==="admin"||(($=l.role)==null?void 0:$.name)==="Admin"?!0:!l.permissions||!Array.isArray(l.permissions)?!1:l.permissions.includes(h):!1},[o,v]=a.useState(()=>{if(window.innerWidth<768)return!1;const h=localStorage.getItem("sidebar_open");return h!==null?JSON.parse(h):s.pathname!=="/pdv"}),[j,f]=a.useState({}),[N,d]=a.useState(()=>{const h=localStorage.getItem("sidebar_visible");return h!==null?JSON.parse(h):!0}),[x,k]=a.useState(!1),w=()=>{m&&v(!1)};a.useEffect(()=>{m||localStorage.setItem("sidebar_open",JSON.stringify(o))},[o,m]),a.useEffect(()=>{m||localStorage.setItem("sidebar_visible",JSON.stringify(N))},[N,m]),a.useEffect(()=>{m&&v(!1)},[s.pathname,m]);const b=[{path:"/dashboard",icon:ll,label:"Dashboard",permission:"relatorios.gerencial"},{path:"/dashboard-gerencial",icon:Qt,label:"ðŸ“Š Dashboard Gerencial",highlight:!0,permission:"relatorios.gerencial"},{path:"/clientes",icon:wo,label:"Pessoas",permission:"clientes.visualizar"},{path:"/pets",icon:Ea,label:"ðŸ¾ Pets",highlight:!0,permission:"clientes.visualizar"},{path:"/produtos",icon:Et,label:"Produtos",permission:"produtos.visualizar",submenu:[{path:"/produtos",label:"Listar Produtos",permission:"produtos.visualizar"},{path:"/produtos/relatorio",label:"RelatÃ³rio de MovimentaÃ§Ãµes",permission:"produtos.visualizar"},{path:"/estoque/alertas",label:"Alertas de Estoque",permission:"produtos.visualizar"}]},{path:"/lembretes",icon:Co,label:"Lembretes",badge:!0,permission:null},{path:"/calculadora-racao",icon:nl,label:"Calculadora de RaÃ§Ã£o",permission:null},{path:"/pdv",icon:st,label:"PDV (Vendas)",permission:"vendas.criar"},{path:"/notas-fiscais",icon:il,label:"Notas Fiscais",permission:"vendas.visualizar"},{path:"/compras",icon:dl,label:"Compras",permission:"compras.gerenciar",submenu:[{path:"/compras/pedidos",label:"Pedidos de Compra",permission:"compras.pedidos"},{path:"/compras/entrada-xml",label:"Entrada por XML",permission:"compras.entrada_xml"},{path:"/compras/bling",label:"Sinc. Bling",permission:"compras.sincronizacao_bling"}]},{path:"/financeiro",icon:Vs,label:"Financeiro/ContÃ¡bil",permission:"relatorios.financeiro",submenu:[{path:"/financeiro",label:"Dashboard",permission:"financeiro.dashboard"},{path:"/financeiro/vendas",label:"Vendas",permission:"financeiro.vendas"},{path:"/financeiro/fluxo-caixa",label:"Fluxo de Caixa",permission:"financeiro.fluxo_caixa"},{path:"/financeiro/dre",label:"DRE",permission:"financeiro.dre"},{path:"/financeiro/contas-pagar",label:"Contas a Pagar",permission:"financeiro.contas_pagar"},{path:"/financeiro/contas-receber",label:"Contas a Receber",permission:"financeiro.contas_receber"},{path:"/financeiro/conciliacao-bancaria",label:"ConciliaÃ§Ã£o BancÃ¡ria",permission:"financeiro.conciliacao_bancaria"},{path:"/financeiro/conciliacao-3abas",label:"ConciliaÃ§Ã£o 3 Abas",highlight:!0,permission:"financeiro.conciliacao_cartao"}]},{path:"/comissoes",icon:Ga,label:"ComissÃµes",permission:"relatorios.financeiro",submenu:[{path:"/comissoes",label:"ConfiguraÃ§Ã£o",permission:"comissoes.configurar"},{path:"/comissoes/demonstrativo",label:"Demonstrativo",permission:"comissoes.demonstrativo"},{path:"/comissoes/abertas",label:"ComissÃµes em Aberto",permission:"comissoes.abertas"},{path:"/comissoes/fechamentos",label:"HistÃ³rico de Fechamentos",permission:"comissoes.fechamentos"},{path:"/comissoes/relatorios",label:"ðŸ“Š RelatÃ³rios AnalÃ­ticos",permission:"comissoes.relatorios"}]},{path:"/entregas",icon:Zs,label:"Entregas",permission:"vendas.visualizar",submenu:[{path:"/entregas/abertas",label:"Entregas em Aberto",permission:"entregas.abertas"},{path:"/entregas/rotas",label:"Rotas de Entrega",permission:"entregas.rotas"},{path:"/entregas/historico",label:"ðŸ“œ HistÃ³rico",permission:"entregas.historico"},{path:"/entregas/financeiro",label:"ðŸ“Š Dashboard Financeiro",permission:"entregas.dashboard"}]},{path:"/cadastros",icon:bt,label:"Cadastros",permission:"configuracoes.editar",submenu:[{path:"/cadastros/cargos",label:"Cargos",permission:"cadastros.cargos"},{path:"/cadastros/categorias",label:"Categorias de Produtos",permission:"cadastros.categorias_produtos"},{path:"/cadastros/categorias-financeiras",label:"Categorias Financeiras",permission:"cadastros.categorias_financeiras"},{path:"/cadastros/especies-racas",label:"EspÃ©cies e RaÃ§as",permission:"cadastros.especies_racas"},{path:"/cadastros/opcoes-racao",label:"OpÃ§Ãµes de RaÃ§Ã£o",permission:"produtos.editar"},{path:"/cadastros/financeiro/bancos",label:"Bancos",permission:"cadastros.bancos"},{path:"/cadastros/financeiro/formas-pagamento",label:"Formas de Pagamento",permission:"cadastros.formas_pagamento"},{path:"/cadastros/financeiro/operadoras",label:"Operadoras de CartÃ£o",permission:"cadastros.operadoras"}]},{path:"/rh",icon:cl,label:"Recursos Humanos",permission:"usuarios.manage",submenu:[{path:"/rh/funcionarios",label:"FuncionÃ¡rios",permission:"rh.funcionarios"}]},{path:"/ia",icon:xl,label:"InteligÃªncia Artificial",permission:null,submenu:[{path:"/ia/chat",label:"Chat IA",permission:null},{path:"/ia/fluxo-caixa",label:"Fluxo de Caixa Preditivo",permission:"ia.fluxo_caixa"},{path:"/ia/whatsapp",label:"Bot WhatsApp",permission:"ia.whatsapp"},{path:"/ia/alertas-racao",label:"âš  Alertas RaÃ§Ãµes",permission:"produtos.editar"}]},{path:"/admin",icon:ko,label:"AdministraÃ§Ã£o",permission:"usuarios.manage",submenu:[{path:"/admin/usuarios",label:"UsuÃ¡rios",permission:"usuarios.manage"},{path:"/admin/roles",label:"Roles & PermissÃµes",permission:"usuarios.manage"}]},{path:"/configuracoes",icon:bt,label:"ConfiguraÃ§Ãµes",permission:"configuracoes.editar",submenu:[{path:"/configuracoes/fiscal",label:"ConfiguraÃ§Ã£o da Empresa",permission:"configuracoes.empresa"},{path:"/configuracoes/entregas",label:"Entregas",permission:"configuracoes.entregas"},{path:"/configuracoes/custos-moto",label:"Custos da Moto",permission:"configuracoes.custos_moto"},{path:"/configuracoes/estoque",label:"Estoque"},{path:"/configuracoes/simples/fechamento",label:"Fechamento Mensal",permission:"configuracoes.fechamento_mensal"}]}].filter(h=>{if(h.submenu&&Array.isArray(h.submenu)){const _=h.submenu.filter(E=>E.permission?g(E.permission):!0);if(_.length===0)return!1;h.submenu=_}return h.permission?g(h.permission):!0}),p=h=>s.pathname===h;return e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[m&&o&&N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden",onClick:()=>v(!1)}),N&&e.jsxs("aside",{className:`${m?`fixed inset-y-0 left-0 z-50 w-64 transform transition-transform duration-300 ${o?"translate-x-0":"-translate-x-full"}`:`${o?"w-64":"w-20"} transition-all duration-300`} bg-gradient-to-b from-indigo-50 to-purple-50 border-r border-indigo-100 flex flex-col shadow-lg`,children:[e.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-indigo-100 bg-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[!m&&e.jsx("button",{onClick:()=>v(!o),className:"w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-400 to-purple-500 hover:from-indigo-500 hover:to-purple-600 flex items-center justify-center shadow-md transition-all cursor-pointer",title:o?"Recolher menu":"Expandir menu",children:e.jsx(Zr,{className:"text-white w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg text-gray-800",children:"Pet Shop Pro"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Central de GestÃ£o"})]})]}),e.jsx("button",{onClick:()=>m?v(!1):d(!1),className:"p-2 hover:bg-indigo-100 rounded-lg transition-colors",title:m?"Fechar menu":"Esconder menu completamente",children:m?e.jsx(us,{className:"w-6 h-6 text-indigo-600"}):e.jsx(Ea,{className:"w-5 h-5 text-indigo-600"})})]}),e.jsx("nav",{className:"flex-1 py-4 overflow-y-auto",children:Array.isArray(b)&&b.map(h=>e.jsx("div",{children:h.submenu?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{f(_=>({..._,[h.path]:!_[h.path]}))},className:`w-full flex items-center justify-between gap-3 px-4 py-3 mx-2 rounded-lg transition-all ${s.pathname.startsWith(h.path)?"bg-gradient-to-r from-indigo-100 to-purple-100 text-indigo-700 shadow-sm":"text-gray-700 hover:bg-white/60"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h.icon,{className:"text-lg flex-shrink-0"}),o&&e.jsx("span",{className:"font-medium text-sm",children:h.label})]}),o&&(j[h.path]?e.jsx(Os,{className:"text-sm text-gray-400"}):e.jsx(Ls,{className:"text-sm text-gray-400"}))]}),j[h.path]&&o&&e.jsx("div",{className:"mt-1 mb-2 space-y-1",children:Array.isArray(h.submenu)&&h.submenu.map(_=>e.jsx(tt,{to:_.path,onClick:w,className:`flex items-center gap-3 px-4 py-2 mx-2 ml-12 rounded-lg transition-all text-sm ${p(_.path)?"bg-white text-indigo-600 shadow-sm font-medium":"text-gray-600 hover:bg-white/50"}`,children:e.jsx("span",{children:_.label})},_.path))})]}):e.jsxs(tt,{to:h.path,onClick:w,className:`flex items-center gap-3 px-4 py-3 mx-2 my-1 rounded-lg transition-all ${p(h.path)?"bg-gradient-to-r from-indigo-100 to-purple-100 text-indigo-700 shadow-sm":"text-gray-700 hover:bg-white/60"}`,title:o?"":h.label,children:[e.jsx(h.icon,{className:"text-lg flex-shrink-0"}),o&&e.jsxs("div",{className:"flex items-center justify-between flex-1",children:[e.jsx("span",{className:"font-medium text-sm",children:h.label}),h.badge&&e.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full animate-pulse"})]})]})},h.path))}),e.jsx("div",{className:"border-t border-indigo-100 bg-white/30",children:e.jsxs("button",{onClick:t,className:"w-full flex items-center gap-3 px-4 py-3 mx-2 my-2 rounded-lg text-gray-700 hover:bg-red-50 hover:text-red-600 transition-all text-left",title:o?"":"Sair",children:[e.jsx(ml,{className:"text-lg"}),o&&e.jsx("span",{className:"font-medium text-sm",children:"Sair"})]})})]}),!N&&!m&&e.jsx("button",{onClick:()=>d(!0),className:"fixed left-0 top-4 z-50 p-3 bg-gradient-to-br from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white rounded-r-xl shadow-lg transition-all",title:"Mostrar menu",children:e.jsx(Ea,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-3 md:px-6 py-3 md:py-4 flex items-center justify-between",children:[m&&N&&e.jsx("button",{onClick:()=>v(!o),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors md:hidden","aria-label":"Toggle menu",children:e.jsx(Zr,{className:"w-6 h-6 text-gray-700"})}),m&&!N&&e.jsx("button",{onClick:()=>d(!0),className:"p-2 rounded-lg hover:bg-indigo-100 transition-colors md:hidden","aria-label":"Mostrar menu",children:e.jsx(Ea,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 ml-auto",children:[e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:(l==null?void 0:l.nome)||(l==null?void 0:l.email)}),e.jsx("p",{className:"text-xs text-gray-500",children:l==null?void 0:l.email})]}),e.jsx("div",{className:"w-9 h-9 md:w-10 md:h-10 rounded-full bg-purple-600 flex items-center justify-center text-white font-bold text-sm md:text-base",children:((u=(i=l==null?void 0:l.nome)==null?void 0:i[0])==null?void 0:u.toUpperCase())||((C=(n=l==null?void 0:l.email)==null?void 0:n[0])==null?void 0:C.toUpperCase())})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-3 md:p-6",children:e.jsx(ul,{})})]}),e.jsx(Kl,{onClick:()=>{console.log("ðŸŽ¯ Layout: Abrindo calculadora..."),k(!0)}}),x&&e.jsx(Hl,{isOpen:x,onClose:()=>{console.log("ðŸŽ¯ Layout: Fechando calculadora..."),k(!1)}})]})},Ql=()=>{const[s,l]=a.useState(""),[t,m]=a.useState(""),[r,g]=a.useState(""),[o,v]=a.useState(!1),[j,f]=a.useState(!1),{login:N}=ct(),d=fa(),x=async k=>{var w,c;k.preventDefault(),g(""),f(!0);try{const b=await N(s,t);if(b.success){const p=localStorage.getItem("user");if(p){const i=JSON.parse(p),u=(c=(w=i.role)==null?void 0:w.name)==null?void 0:c.toLowerCase();console.log("ðŸ‘¤ Role do usuÃ¡rio:",u),console.log("ðŸ‘¤ PermissÃµes:",i.permissions),u==="caixa"?(console.log("ðŸŽ¯ UsuÃ¡rio caixa - Navegando para /pdv"),d("/pdv")):u==="admin"||u==="gerente"?(console.log("ðŸŽ¯ UsuÃ¡rio gerencial - Navegando para /dashboard"),d("/dashboard")):(console.log("ðŸŽ¯ Redirecionando para /lembretes"),d("/lembretes"))}else d("/lembretes")}else console.error("âŒ Login falhou:",b.error),g(b.error||"Erro desconhecido ao fazer login")}catch(b){console.error("âŒ Erro inesperado:",b),g("Erro inesperado ao fazer login")}finally{f(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-purple-700 to-purple-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 animate-fade-in",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-purple-100 rounded-full mb-4",children:e.jsx(Ea,{className:"w-8 h-8 text-purple-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Pet Shop Pro"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Sistema de GestÃ£o Completo"})]}),r&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(Na,{className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:r})]}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(wr,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"email",value:s,onChange:k=>l(k.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"seu@email.com",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(gr,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:o?"text":"password",value:t,onChange:k=>m(k.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0}),"              ",e.jsx("button",{type:"button",onClick:()=>v(!o),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition",children:o?e.jsx(hr,{}):e.jsx(Xt,{})}),"            "]})]}),e.jsx("button",{type:"submit",disabled:j,className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Entrando...":"Entrar"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["NÃ£o tem uma conta?"," ",e.jsx(tt,{to:"/register",className:"text-purple-600 hover:text-purple-700 font-semibold",children:"Criar conta"})]})})]})})},Xl=()=>{const[s,l]=a.useState(""),[t,m]=a.useState(""),[r,g]=a.useState(""),[o,v]=a.useState(""),[j,f]=a.useState(""),[N,d]=a.useState(!1),[x,k]=a.useState(!1),[w,c]=a.useState(!1),{register:b}=ct(),p=fa(),i=async u=>{if(u.preventDefault(),f(""),r!==o){f("As senhas nÃ£o coincidem");return}if(r.length<6){f("A senha deve ter no mÃ­nimo 6 caracteres");return}c(!0);const n=await b(t,r,s);n.success?p("/dashboard"):f(n.error),c(!1)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-purple-700 to-purple-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 animate-fade-in",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-purple-100 rounded-full mb-4",children:e.jsx(Ea,{className:"w-8 h-8 text-purple-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Criar Conta"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Comece a usar o Pet Shop Pro"})]}),j&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(Na,{className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:j})]}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome"}),e.jsxs("div",{className:"relative",children:[e.jsx(is,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:s,onChange:u=>l(u.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"Seu nome",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(wr,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"email",value:t,onChange:u=>m(u.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"seu@email.com",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(gr,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:N?"text":"password",value:r,onChange:u=>g(u.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0}),e.jsx("button",{type:"button",onClick:()=>d(!N),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition",children:N?e.jsx(hr,{}):e.jsx(Xt,{})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirmar Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(gr,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:x?"text":"password",value:o,onChange:u=>v(u.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0}),e.jsx("button",{type:"button",onClick:()=>k(!x),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition",children:x?e.jsx(hr,{}):e.jsx(Xt,{})})]})]}),e.jsx("button",{type:"submit",disabled:w,className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:w?"Criando conta...":"Criar Conta"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["JÃ¡ tem uma conta?"," ",e.jsx(tt,{to:"/login",className:"text-purple-600 hover:text-purple-700 font-semibold",children:"Fazer login"})]})})]})})};function Jl({isOpen:s,onClose:l,onSuccess:t}){var b,p;const[m,r]=a.useState(null),[g,o]=a.useState(!1),[v,j]=a.useState(null),[f,N]=a.useState("upload"),d=i=>{const u=i.target.files[0];u&&(u.name.endsWith(".xlsx")||u.name.endsWith(".xls")?(r(u),j(null)):(Se.error("Arquivo deve ser Excel (.xlsx ou .xls)"),i.target.value=""))},x=async()=>{try{const i=localStorage.getItem("access_token")||localStorage.getItem("token"),u=await F.get("/pessoas/template-importacao",{headers:{Authorization:`Bearer ${i}`},responseType:"blob"}),n=window.URL.createObjectURL(new Blob([u.data])),C=document.createElement("a");C.href=n,C.setAttribute("download",`template_pessoas_${new Date().toISOString().split("T")[0]}.xlsx`),document.body.appendChild(C),C.click(),C.remove(),window.URL.revokeObjectURL(n),Se.success("Template baixado com sucesso!")}catch(i){console.error("Erro ao baixar template:",i),Se.error("Erro ao baixar template")}},k=async()=>{var i,u,n,C;if(!m){Se.error("Selecione um arquivo para importar");return}o(!0),N("processando");try{const h=new FormData;h.append("file",m);const _=await F.post("/pessoas/importar",h);j(_.data),N("resultado");const E=(((i=_.data.criados)==null?void 0:i.length)||0)+(((u=_.data.atualizados)==null?void 0:u.length)||0);E>0&&(Se.success(`${E} pessoas processadas com sucesso!`),t&&t()),_.data.total_erros>0&&Se.error(`${_.data.total_erros} pessoas com erro`)}catch(h){console.error("Erro ao importar:",h),Se.error(((C=(n=h.response)==null?void 0:n.data)==null?void 0:C.detail)||"Erro ao importar pessoas"),N("upload")}finally{o(!1)}},w=()=>{r(null),j(null),N("upload")},c=()=>{w(),l()};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gradient-to-r from-purple-600 to-purple-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"ImportaÃƒÂ§ÃƒÂ£o de Pessoas em Lote"})]}),e.jsx("button",{onClick:c,className:"text-white hover:text-gray-200 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[f==="upload"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-purple-900 mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Como funciona"]}),e.jsxs("ul",{className:"text-sm text-purple-800 space-y-1 ml-7",children:[e.jsx("li",{children:"1. Baixe o template Excel clicando no botÃƒÂ£o abaixo"}),e.jsx("li",{children:"2. Preencha os dados das pessoas (clientes, fornecedores, veterinÃƒÂ¡rios)"}),e.jsx("li",{children:"3. Salve o arquivo e faÃƒÂ§a o upload aqui"}),e.jsx("li",{children:"4. Pessoas novas serÃƒÂ£o criadas, existentes serÃƒÂ£o atualizadas (baseado no CPF/CNPJ)"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:x,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Baixar Template Excel"]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecione a Planilha Preenchida"}),e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx("svg",{className:"w-12 h-12 mb-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:"Clique para selecionar"})," ou arraste o arquivo"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Apenas arquivos Excel (.xlsx, .xls)"}),m&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-purple-600",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"font-medium",children:m.name})]})]}),e.jsx("input",{type:"file",className:"hidden",accept:".xlsx,.xls",onChange:d})]})})]})]}),f==="processando"&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mb-4"}),e.jsx("p",{className:"text-lg text-gray-700",children:"Processando planilha..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Isso pode levar alguns segundos"})]}),f==="resultado"&&v&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:v.total_processados||0}),e.jsx("div",{className:"text-sm text-blue-800 mt-1",children:"Total Processado"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:((b=v.criados)==null?void 0:b.length)||0}),e.jsx("div",{className:"text-sm text-green-800 mt-1",children:"Criados"})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:((p=v.atualizados)==null?void 0:p.length)||0}),e.jsx("div",{className:"text-sm text-yellow-800 mt-1",children:"Atualizados"})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:v.total_erros||0}),e.jsx("div",{className:"text-sm text-red-800 mt-1",children:"Erros"})]})]}),v.criados&&v.criados.length>0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-green-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Pessoas Criadas (",v.criados.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-1",children:v.criados.map((i,u)=>e.jsxs("li",{className:"text-green-800",children:["Linha ",i.linha,": ",e.jsx("span",{className:"font-medium",children:i.nome})," (",i.tipo,")"]},u))})})]}),v.atualizados&&v.atualizados.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-yellow-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Pessoas Atualizadas (",v.atualizados.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-1",children:v.atualizados.map((i,u)=>e.jsxs("li",{className:"text-yellow-800",children:["Linha ",i.linha,": ",e.jsx("span",{className:"font-medium",children:i.nome})," (",i.tipo,")"]},u))})})]}),v.erros&&v.erros.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-red-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Erros (",v.erros.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-2",children:v.erros.map((i,u)=>e.jsxs("li",{className:"text-red-800",children:[e.jsxs("strong",{children:["Linha ",i.linha]})," (",i.nome||"?","): ",i.erro]},u))})})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3 bg-gray-50",children:[f==="upload"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:k,disabled:!m||g,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Importando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Importar Pessoas"]})})]}),f==="resultado"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:w,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Importar Novamente"}),e.jsx("button",{onClick:c,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Concluir"})]})]})]})}):null}const Yl={venda:st,conta_receber:Ga,pet_cadastro:Ea,pet_atualizacao:Ea,pedido_compra:Et,conta_pagar:Ga,recebimento:Zs,vacina:os,consulta:os,whatsapp:Ns},no={green:"bg-green-100 text-green-700 border-green-300",yellow:"bg-yellow-100 text-yellow-700 border-yellow-300",red:"bg-red-100 text-red-700 border-red-300",blue:"bg-blue-100 text-blue-700 border-blue-300",purple:"bg-purple-100 text-purple-700 border-purple-300",gray:"bg-gray-100 text-gray-700 border-gray-300"},$r=({clienteId:s,fornecedorId:l,tipo:t="cliente",limit:m=5,showHeader:r=!0,onVerMais:g})=>{const[o,v]=a.useState([]),[j,f]=a.useState(!0),[N,d]=a.useState(""),x=t==="fornecedor"?l:s,k=t==="fornecedor"?`/clientes/fornecedor/${x}/timeline`:`/clientes/${x}/timeline`;a.useEffect(()=>{x&&w()},[x,m,t]);const w=async()=>{var p,i,u;try{f(!0),d("");const n=await F.get(`${k}?limit=${m}`);v(n.data)}catch(n){((p=n.response)==null?void 0:p.status)===500||((i=n.response)==null?void 0:i.status)===404?(console.warn("Timeline nÃ£o disponÃ­vel:",(u=n.response)==null?void 0:u.status),v([]),d("")):(console.error("Erro ao carregar timeline:",n),d("Erro ao carregar timeline"))}finally{f(!1)}},c=p=>{const i=new Date(p),u=new Date,n=new Date(u);return n.setDate(n.getDate()-1),i.toDateString()===u.toDateString()?`Hoje Ã s ${i.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:i.toDateString()===n.toDateString()?`Ontem Ã s ${i.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:i.toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})},b=p=>{console.log("Evento clicado:",p)};return j?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Carregando timeline..."})]})}):N?e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(Na,{}),N]}):o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(os,{className:"mx-auto text-gray-300 mb-4",size:48}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nenhum evento registrado"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Eventos do cliente aparecerÃ£o aqui conforme forem acontecendo"})]}):e.jsxs("div",{className:"space-y-4",children:[r&&e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(os,{className:"text-blue-600"}),"Linha do Tempo"]}),g&&e.jsx("button",{onClick:g,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Ver completa â†’"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-[19px] top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-6",children:o.map((p,i)=>{const u=Yl[p.tipo_evento]||os,n=no[p.cor_badge]||no.gray;return e.jsxs("div",{className:"relative pl-12 group",children:[e.jsx("div",{className:"absolute left-0 top-0 w-10 h-10 rounded-full bg-white border-2 border-gray-200 flex items-center justify-center group-hover:border-blue-400 transition-colors",children:e.jsx(u,{className:"text-gray-600 group-hover:text-blue-600 transition-colors",size:18})}),e.jsxs("div",{onClick:()=>b(p),className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md hover:border-gray-300 transition-all cursor-pointer",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:p.titulo}),e.jsx("p",{className:"text-sm text-gray-600",children:p.descricao})]}),e.jsx("span",{className:`ml-3 px-2 py-1 text-xs font-medium rounded border ${n} whitespace-nowrap`,children:p.status})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-3 pt-3 border-t border-gray-100",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(qs,{size:12}),c(p.data_evento)]}),p.pet_id&&e.jsxs("span",{className:"flex items-center gap-1 text-blue-600",children:[e.jsx(Ea,{size:12}),"Pet relacionado"]})]})]})]},`${p.tipo_evento}-${p.evento_id}-${i}`)})})]}),o.length>=m&&g&&e.jsx("div",{className:"text-center pt-4",children:e.jsx("button",{onClick:g,className:"text-sm text-blue-600 hover:text-blue-700 font-medium underline",children:"Ver todos os eventos â†’"})})]})};$r.propTypes={clienteId:Gs.number,fornecedorId:Gs.number,tipo:Gs.oneOf(["cliente","fornecedor"]),limit:Gs.number,showHeader:Gs.bool,onVerMais:Gs.func};const dt={VIP:{color:"purple",bgClass:"bg-purple-100",textClass:"text-purple-800",borderClass:"border-purple-300",icon:So,descricao:"Cliente de alto valor",emoji:"ðŸ‘‘"},Recorrente:{color:"blue",bgClass:"bg-blue-100",textClass:"text-blue-800",borderClass:"border-blue-300",icon:Vs,descricao:"Compra com frequÃªncia",emoji:"ðŸ”„"},Novo:{color:"green",bgClass:"bg-green-100",textClass:"text-green-800",borderClass:"border-green-300",icon:is,descricao:"Cliente recente",emoji:"ðŸŒŸ"},Inativo:{color:"gray",bgClass:"bg-gray-100",textClass:"text-gray-800",borderClass:"border-gray-300",icon:qs,descricao:"Sem compras recentes",emoji:"â°"},Endividado:{color:"red",bgClass:"bg-red-100",textClass:"text-red-800",borderClass:"border-red-300",icon:Na,descricao:"Alto saldo devedor",emoji:"âš ï¸"},Risco:{color:"orange",bgClass:"bg-orange-100",textClass:"text-orange-800",borderClass:"border-orange-300",icon:or,descricao:"DiminuiÃ§Ã£o de frequÃªncia",emoji:"ðŸ“‰"},Regular:{color:"gray",bgClass:"bg-gray-100",textClass:"text-gray-600",borderClass:"border-gray-200",icon:is,descricao:"Cliente regular",emoji:"ðŸ‘¤"}};function Zl({segmento:s,size:l="sm",showIcon:t=!1}){if(!s)return null;const m=dt[s]||dt.Regular,r=m.icon,g={xs:"text-xs px-2 py-0.5",sm:"text-xs px-2 py-1",md:"text-sm px-3 py-1.5",lg:"text-base px-4 py-2"};return e.jsxs("span",{className:`inline-flex items-center gap-1 font-medium rounded-full ${m.bgClass} ${m.textClass} ${g[l]}`,title:m.descricao,children:[t&&e.jsx(r,{size:l==="xs"?10:l==="sm"?12:14}),m.emoji," ",s]})}function en({tag:s}){const l=dt[s]||dt.Regular;return e.jsxs("span",{className:`inline-flex items-center gap-1 text-xs font-medium px-2 py-1 rounded-md ${l.bgClass} ${l.textClass}`,title:l.descricao,children:[l.emoji," ",s]})}function Ut(s){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s)}function an({clienteId:s,compact:l=!1}){const[t,m]=a.useState(null),[r,g]=a.useState(!0),[o,v]=a.useState(null),[j,f]=a.useState(!1);a.useEffect(()=>{s&&N()},[s]);const N=async()=>{var p;try{g(!0),v(null);const i=await F.get(`/segmentacao/clientes/${s}`);m(i.data)}catch(i){((p=i.response)==null?void 0:p.status)===404?v("not_calculated"):(v("Erro ao carregar segmentaÃ§Ã£o"),console.error("Erro ao carregar segmentaÃ§Ã£o:",i))}finally{g(!1)}},d=async()=>{try{f(!0);const p=await F.post(`/segmentacao/clientes/${s}/recalcular`);m(p.data),v(null)}catch(p){console.error("Erro ao recalcular segmento:",p),alert("Erro ao recalcular segmento. Tente novamente.")}finally{f(!1)}};if(r)return e.jsxs("div",{className:"animate-pulse bg-gray-100 rounded-lg p-6",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]});if(o==="not_calculated")return e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Na,{className:"text-yellow-600 mt-1",size:20}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-yellow-900 mb-2",children:"SegmentaÃ§Ã£o nÃ£o calculada"}),e.jsx("p",{className:"text-sm text-yellow-800 mb-4",children:"Este cliente ainda nÃ£o foi segmentado. Clique abaixo para calcular."}),e.jsxs("button",{onClick:d,disabled:j,className:"flex items-center gap-2 px-4 py-2 bg-yellow-600 hover:bg-yellow-700 disabled:bg-yellow-400 text-white rounded-lg transition-colors text-sm font-medium",children:[e.jsx(vt,{className:j?"animate-spin":""}),j?"Calculando...":"Calcular segmento"]})]})]})});if(o&&o!=="not_calculated")return e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-red-800",children:o})});if(!t)return null;const x=dt[t.segmento]||dt.Regular,k=x.icon,w=t.metricas||{},c={purple:"bg-gradient-to-br from-purple-50 to-purple-100 border-2 border-purple-300",blue:"bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-300",green:"bg-gradient-to-br from-green-50 to-green-100 border-2 border-green-300",gray:"bg-gradient-to-br from-gray-50 to-gray-100 border-2 border-gray-300",red:"bg-gradient-to-br from-red-50 to-red-100 border-2 border-red-300",orange:"bg-gradient-to-br from-orange-50 to-orange-100 border-2 border-orange-300"},b=c[x.color]||c.gray;return l?e.jsx(Zl,{segmento:t.segmento,size:"sm"}):e.jsxs("div",{className:`${b} rounded-xl p-6 shadow-sm`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-3 ${x.bgClass} rounded-lg`,children:e.jsx(k,{className:x.textClass,size:24})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[x.emoji," SegmentaÃ§Ã£o: ",e.jsx("span",{className:x.textClass,children:t.segmento})]}),e.jsx("p",{className:"text-sm text-gray-600",children:x.descricao})]})]}),e.jsxs("button",{onClick:d,disabled:j,className:"flex items-center gap-2 px-3 py-2 bg-white hover:bg-gray-50 disabled:bg-gray-100 border border-gray-300 text-gray-700 rounded-lg transition-colors text-sm",title:"Recalcular segmento",children:[e.jsx(vt,{size:14,className:j?"animate-spin":""}),j?"Calculando...":"Atualizar"]})]}),t.tags&&t.tags.length>1&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-2",children:"TambÃ©m se enquadra em:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tags.filter(p=>p!==t.segmento).map(p=>e.jsx(en,{tag:p},p))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ga,{className:"text-gray-500",size:16}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Total 90 dias"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:Ut(w.total_compras_90d||0)})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(st,{className:"text-gray-500",size:16}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Compras 90d"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:w.compras_90d||0})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Vs,{className:"text-gray-500",size:16}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Ticket mÃ©dio"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:Ut(w.ticket_medio||0)})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(qs,{className:"text-gray-500",size:16}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Ãšltima compra"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:w.ultima_compra_dias===9999?"Nunca":`${w.ultima_compra_dias} dias`})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white/60 rounded-lg p-2",children:[e.jsx("span",{className:"text-gray-600",children:"Total em aberto:"}),e.jsx("span",{className:`font-semibold ${w.total_em_aberto>0?"text-red-600":"text-green-600"}`,children:Ut(w.total_em_aberto||0)})]}),e.jsxs("div",{className:"flex justify-between items-center bg-white/60 rounded-lg p-2",children:[e.jsx("span",{className:"text-gray-600",children:"Cliente hÃ¡:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:w.primeira_compra_dias>0?`${w.primeira_compra_dias} dias`:"Sem compras"})]}),e.jsxs("div",{className:"flex justify-between items-center bg-white/60 rounded-lg p-2",children:[e.jsx("span",{className:"text-gray-600",children:"Total histÃ³rico:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:Ut(w.total_historico||0)})]}),e.jsxs("div",{className:"flex justify-between items-center bg-white/60 rounded-lg p-2",children:[e.jsx("span",{className:"text-gray-600",children:"Total de compras:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:w.total_compras_historico||0})]})]}),t.updated_at&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-300/50",children:e.jsxs("p",{className:"text-xs text-gray-600",children:["Atualizado em: ",new Date(t.updated_at).toLocaleString("pt-BR")]})})]})}const sn={RISCO:{color:"red",bgClass:"bg-red-50",borderClass:"border-red-200",tagClass:"bg-red-100 text-red-700",label:"âš ï¸ Risco"},OPORTUNIDADE:{color:"green",bgClass:"bg-green-50",borderClass:"border-green-200",tagClass:"bg-green-100 text-green-700",label:"ðŸ’¡ Oportunidade"},ATENCAO:{color:"yellow",bgClass:"bg-yellow-50",borderClass:"border-yellow-200",tagClass:"bg-yellow-100 text-yellow-700",label:"ðŸ‘€ AtenÃ§Ã£o"}};function tn(s,l,t,m){const r=[],g=new Date;if((l==null?void 0:l.segmento)==="VIP"&&(l==null?void 0:l.dias_desde_ultima_compra)>20&&r.push({tipo:"RISCO",icone:Eo,titulo:"VIP em risco de churn",descricao:`Sem compras hÃ¡ ${l.dias_desde_ultima_compra} dias. Cliente VIP precisa de atenÃ§Ã£o especial.`,prioridade:10}),(l==null?void 0:l.dias_desde_ultima_compra)>90&&r.push({tipo:"RISCO",icone:qs,titulo:"Cliente inativo hÃ¡ muito tempo",descricao:`Ãšltima compra foi hÃ¡ ${l.dias_desde_ultima_compra} dias. Considere campanha de reativaÃ§Ã£o.`,prioridade:8}),(l==null?void 0:l.saldo_devedor)>0&&(l==null?void 0:l.total_90d)>0&&(l==null?void 0:l.dias_desde_ultima_compra)<30){const o=l.saldo_devedor/l.total_90d*100;o>50&&r.push({tipo:"ATENCAO",icone:Ga,titulo:"Alto endividamento com atividade recente",descricao:`Saldo devedor de R$ ${l.saldo_devedor.toFixed(2)} (${o.toFixed(0)}% das compras). Avaliar condiÃ§Ãµes.`,prioridade:9})}if((l==null?void 0:l.segmento)==="Novo"&&(l==null?void 0:l.ticket_medio)>200&&r.push({tipo:"OPORTUNIDADE",icone:Vs,titulo:"Novo cliente de alto valor",descricao:`Ticket mÃ©dio de R$ ${l.ticket_medio.toFixed(2)}. Potencial para se tornar VIP.`,prioridade:7}),m||r.push({tipo:"ATENCAO",icone:Ns,titulo:"WhatsApp nÃ£o registrado",descricao:"Adicione o nÃºmero para facilitar comunicaÃ§Ã£o e envio de promoÃ§Ãµes.",prioridade:5}),t&&t.length>0){const o=t.filter(v=>{if(!v.ultima_consulta)return!0;const j=new Date(v.ultima_consulta);return Math.floor((g-j)/(1e3*60*60*24))>60});if(o.length>0){const v=o[0].nome;r.push({tipo:"OPORTUNIDADE",icone:Cr,titulo:`Pet ${v} sem consulta hÃ¡ mais de 60 dias`,descricao:`${o.length===1?"Considere":`${o.length} pets precisam de`} check-up ou retorno.`,prioridade:6})}}return(l==null?void 0:l.segmento)==="Recorrente"&&(l==null?void 0:l.dias_desde_ultima_compra)>30&&r.push({tipo:"ATENCAO",icone:qs,titulo:"Cliente recorrente com atraso",descricao:`Costuma comprar regularmente, mas estÃ¡ hÃ¡ ${l.dias_desde_ultima_compra} dias sem aparecer.`,prioridade:7}),(l==null?void 0:l.saldo_credito)>0&&r.push({tipo:"OPORTUNIDADE",icone:Ga,titulo:"Cliente tem crÃ©dito disponÃ­vel",descricao:`R$ ${l.saldo_credito.toFixed(2)} de crÃ©dito pode ser usado. Incentive o uso.`,prioridade:4}),r.sort((o,v)=>v.prioridade-o.prioridade).slice(0,3)}function rn({clienteId:s,cliente:l,metricas:t}){const[m,r]=a.useState([]),[g,o]=a.useState(!1),[v,j]=a.useState([]);a.useEffect(()=>{s&&f()},[s,t]);const f=async()=>{try{o(!0);let N=(l==null?void 0:l.pets)||[];if(N.length===0&&s)try{N=(await F.get(`/clientes/${s}`)).data.pets||[]}catch(k){console.error("Erro ao carregar pets:",k)}j(N);const d=(l==null?void 0:l.celular)&&l.celular.trim()!=="",x=tn(l,t,N,d);r(x)}catch(N){console.error("Erro ao calcular insights:",N),r([])}finally{o(!1)}};return g?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ft,{className:"text-yellow-500",size:24}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"âš¡ Insights & AÃ§Ãµes"})]}),e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm",children:"Analisando cliente..."})]})]}):!m||m.length===0?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ft,{className:"text-yellow-500",size:24}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"âš¡ Insights & AÃ§Ãµes"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-700",children:[e.jsx(zs,{size:20}),e.jsx("p",{className:"font-medium",children:"âœ… Cliente em dia!"})]}),e.jsx("p",{className:"text-sm text-green-600 mt-1",children:"Nenhuma aÃ§Ã£o prioritÃ¡ria no momento"})]})]}):e.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 border-2 border-yellow-300 rounded-xl p-6 shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(ft,{className:"text-yellow-600",size:24}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"âš¡ Insights & AÃ§Ãµes"}),e.jsxs("span",{className:"ml-auto text-xs text-gray-500 bg-white px-2 py-1 rounded-full",children:[m.length," ",m.length===1?"insight":"insights"]})]}),e.jsx("div",{className:"space-y-3",children:m.map((N,d)=>{const x=sn[N.tipo],k=N.icone;return e.jsx("div",{className:`${x.bgClass} border ${x.borderClass} rounded-lg p-4 transition-all hover:shadow-md`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx(k,{className:`text-${x.color}-600`,size:20})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:N.titulo}),e.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${x.tagClass}`,children:x.label})]}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:N.descricao})]})]})},d)})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-yellow-200",children:e.jsxs("p",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(zs,{size:12}),"Insights calculados automaticamente com base no histÃ³rico do cliente"]})})]})}const on=()=>{var ea,oa,ia,Ue,wa;const s=fa(),[l,t]=a.useState([]),[m,r]=a.useState(!0),[g,o]=a.useState(""),[v,j]=a.useState(!1),[f,N]=a.useState(!1),[d,x]=a.useState(null),[k,w]=a.useState(""),[c,b]=a.useState("todos"),[p,i]=a.useState(1),[u,n]=a.useState(0),[C,h]=a.useState(20),[_,E]=a.useState(!1),[$,K]=a.useState(1),[te,M]=a.useState([]),[A,Q]=a.useState(null),[re,q]=a.useState(""),[Z,R]=a.useState(null),[J,S]=a.useState(!1),[P,G]=a.useState(!1),[B,y]=a.useState([]),[O,z]=a.useState({}),[ae,W]=a.useState(null),[ne,H]=a.useState(null),[ee,de]=a.useState(null),[ue,Re]=a.useState(!1),[se,_e]=a.useState({tipo_cadastro:"cliente",tipo_pessoa:"PF",nome:"",cpf:"",email:"",telefone:"",celular:"",celular_whatsapp:!0,cnpj:"",inscricao_estadual:"",razao_social:"",nome_fantasia:"",responsavel:"",crmv:"",parceiro_ativo:!1,parceiro_desde:"",parceiro_observacoes:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",estado:"",endereco_entrega:"",endereco_entrega_2:"",is_entregador:!1,entregador_ativo:!0,entregador_padrao:!1,tipo_vinculo_entrega:"",controla_rh:!1,gera_conta_pagar_custo_entrega:!1,media_entregas_configurada:"",custo_rh_ajustado:"",modelo_custo_entrega:"",taxa_fixa_entrega:"",valor_por_km_entrega:"",moto_propria:!0,tipo_acerto_entrega:"",dia_semana_acerto:"",dia_mes_acerto:"",is_terceirizado:!1,recebe_repasse:!1,gera_conta_pagar:!1,observacoes:"",tags:""}),[ke,Ze]=a.useState([]),[ze,Xe]=a.useState(null),[be,Ee]=a.useState(!1),[he,Qe]=a.useState({nome:"",especie:"",raca:"",sexo:"",data_nascimento:"",cor:"",peso:"",observacoes:"",castrado:!1,porte:"",microchip:"",alergias:"",doencas_cronicas:"",medicamentos_continuos:"",historico_clinico:"",foto_url:"",idade_aproximada:""}),Ye=[{number:1,title:"InformaÃ§Ãµes do cliente"},{number:2,title:"Contatos"},{number:3,title:"EndereÃ§o"},{number:4,title:"InformaÃ§Ãµes complementares"},{number:5,title:"Animais"},{number:6,title:"Financeiro"}];a.useEffect(()=>{ra()},[c,p,C]),a.useEffect(()=>{const V=setTimeout(()=>{p!==1?i(1):ra()},500);return()=>clearTimeout(V)},[g]),a.useEffect(()=>{he&&he.especie?ca(he.especie):y([])},[he==null?void 0:he.especie]),a.useEffect(()=>{if(ne&&te.length>0){const V=te.findIndex($e=>$e.id===ne);V!==-1&&(Oe(V),H(null))}},[te,ne]);const ca=async V=>{try{const $e=await F.get(`/clientes/racas?especie=${V}`);y($e.data)}catch($e){console.error("Erro ao carregar raÃ§as:",$e),y([])}},ra=async()=>{try{r(!0);const V=(p-1)*C,$e=new URLSearchParams({skip:V.toString(),limit:C.toString()});c!=="todos"&&$e.append("tipo_cadastro",c),g&&g.trim()&&$e.append("search",g.trim());const Te=`/clientes/?${$e.toString()}`,We=await F.get(Te);We.data.items?(t(We.data.items),n(We.data.total)):(t(We.data),n(We.data.length))}catch(V){w("Erro ao carregar pessoas"),console.error(V)}finally{r(!1)}},pa=async V=>{const $e=V.replace(/\D/g,"");if($e.length===8){E(!0),q(""),w("");try{const We=await(await fetch(`https://viacep.com.br/ws/${$e}/json/`)).json();if(We.erro){q("CEP nÃ£o encontrado");return}_e(ua=>({...ua,endereco:We.logradouro||"",bairro:We.bairro||"",cidade:We.localidade||"",estado:We.uf||"",cep:V}))}catch(Te){console.error("Erro ao buscar CEP:",Te)}finally{E(!1)}}},na=(V=null)=>{Xe(V!==null?{...ke[V],index:V}:{tipo:"entrega",apelido:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",estado:""}),Ee(!0)},oe=()=>{Ee(!1),Xe(null)},ye=async V=>{if(!(!V||V.length!==9)){E(!0);try{const Te=await(await fetch(`https://viacep.com.br/ws/${V.replace("-","")}/json/`)).json();if(Te.erro){alert("CEP nÃ£o encontrado");return}Xe(We=>({...We,endereco:Te.logradouro||"",bairro:Te.bairro||"",cidade:Te.localidade||"",estado:Te.uf||""}))}catch($e){console.error("Erro ao buscar CEP:",$e),alert("Erro ao buscar CEP")}finally{E(!1)}}},Ce=()=>{if(!ze.cep||!ze.endereco||!ze.cidade){alert("Preencha pelo menos CEP, EndereÃ§o e Cidade");return}const V=[...ke];ze.index!==void 0?(V[ze.index]={...ze},delete V[ze.index].index):V.push({...ze}),Ze(V),oe()},Be=V=>{if(confirm("Deseja realmente remover este endereÃ§o?")){const $e=ke.filter((Te,We)=>We!==V);Ze($e)}},Ie=async()=>{var V,$e,Te,We,ua;w("");try{const xe=[];if((!se.nome||se.nome.trim()==="")&&xe.push("Nome"),se.tipo_pessoa==="PJ"&&((!se.cnpj||se.cnpj.trim()==="")&&xe.push("CNPJ"),(!se.razao_social||se.razao_social.trim()==="")&&xe.push("RazÃ£o Social")),se.tipo_pessoa==="PF"&&se.tipo_cadastro==="cliente"&&(!se.cpf||se.cpf.trim()),xe.length>0){const ja=`âŒ Faltam os seguintes campos obrigatÃ³rios:

`+xe.map(Sa=>`â€¢ ${Sa}`).join(`
`);alert(ja),w(ja);return}if(se.is_entregador){if(!se.tipo_acerto_entrega){alert("Informe o tipo de acerto do entregador (semanal, quinzenal ou mensal)");return}if(se.tipo_acerto_entrega==="semanal"&&!se.dia_semana_acerto){alert("Informe o dia da semana para o acerto semanal");return}if(se.tipo_acerto_entrega==="mensal"&&!se.dia_mes_acerto){alert("Informe o dia do mÃªs para o acerto mensal");return}if(se.tipo_acerto_entrega==="mensal"){const ja=parseInt(se.dia_mes_acerto);if(ja<1||ja>28){alert("O dia do mÃªs deve estar entre 1 e 28");return}}}const{celular_whatsapp:Ae,tags:qe,...sa}=se;sa.is_entregador&&(sa.tipo_cadastro==="funcionario"?(sa.tipo_vinculo_entrega="funcionario",sa.is_terceirizado=!1):sa.tipo_cadastro==="fornecedor"&&(sa.is_terceirizado=!0,sa.tipo_vinculo_entrega="terceirizado")),sa.enderecos_adicionais=ke.length>0?ke:null,Object.keys(sa).forEach(ja=>{sa[ja]===""&&(sa[ja]=null)}),sa.tipo_cadastro==="todos"&&(sa.tipo_cadastro="cliente");let qa;d?(await F.put(`/clientes/${d.id}`,sa),qa=d.id):qa=(await F.post("/clientes/",sa)).data.id;for(const ja of te){const Sa=ja.id,ya={...ja};delete ya.id,delete ya.created_at,delete ya.updated_at,delete ya.cliente_id,delete ya.user_id,delete ya.ativo,delete ya.codigo,Object.keys(ya).forEach(Ja=>{ya[Ja]===""&&(ya[Ja]=null)}),ya.peso!==null&&ya.peso!==void 0&&(ya.peso=parseFloat(ya.peso)||null),Sa?(console.log(`Atualizando pet ${Sa}:`,ya),await F.put(`/clientes/pets/${Sa}`,ya)):(console.log("Criando novo pet:",ya),await F.post(`/clientes/${qa}/pets`,ya))}ra(),X()}catch(xe){const Ae=($e=(V=xe.response)==null?void 0:V.data)==null?void 0:$e.details;console.error("Erro completo:",(Te=xe.response)==null?void 0:Te.data),console.error("Detalhes de validaÃ§Ã£o:",Ae);const qe={nome:"Nome",cpf:"CPF",cnpj:"CNPJ",razao_social:"RazÃ£o Social",nome_fantasia:"Nome Fantasia",inscricao_estadual:"InscriÃ§Ã£o Estadual",responsavel:"ResponsÃ¡vel",telefone:"Telefone",celular:"Celular",email:"E-mail",cep:"CEP",endereco:"EndereÃ§o",numero:"NÃºmero",bairro:"Bairro",cidade:"Cidade",estado:"Estado",tipo_pessoa:"Tipo de Pessoa",tipo_cadastro:"Tipo de Cadastro",crmv:"CRMV",tipo_acerto_entrega:"Tipo de Acerto",dia_semana_acerto:"Dia da Semana para Acerto",dia_mes_acerto:"Dia do MÃªs para Acerto",tipo_vinculo_entrega:"Tipo de VÃ­nculo"};let sa="";if(Ae&&Array.isArray(Ae)){const ja=[];Ae.forEach(Sa=>{const ya=Sa.loc[Sa.loc.length-1],Ja=qe[ya]||ya;Sa.type==="missing"||Sa.type==="value_error.missing"?ja.push(Ja):Sa.msg&&ja.push(`${Ja}: ${Sa.msg}`),console.error(`Campo: ${Ja} | Tipo: ${Sa.type} | Mensagem: ${Sa.msg}`)}),ja.length>0&&(sa=`âŒ Faltam os seguintes campos obrigatÃ³rios:

`+ja.map(Sa=>`â€¢ ${Sa}`).join(`
`))}const qa=sa||((ua=(We=xe.response)==null?void 0:We.data)==null?void 0:ua.message)||"Erro ao salvar cliente";w(qa),sa&&alert(sa)}},Y=async V=>{var $e,Te;if(confirm("Tem certeza que deseja excluir este cliente?"))try{console.log("Excluindo cliente ID:",V);const We=await F.delete(`/clientes/${V}`);console.log("Cliente excluÃ­do com sucesso:",We),await ra()}catch(We){console.error("Erro ao excluir cliente:",We),console.error("Resposta do erro:",We.response),w(((Te=($e=We.response)==null?void 0:$e.data)==null?void 0:Te.detail)||"Erro ao excluir cliente")}},je=async V=>{var $e,Te;if(confirm("Tem certeza que deseja excluir este pet?"))try{console.log("Excluindo pet ID:",V),await F.delete(`/clientes/pets/${V}`),console.log("Pet excluÃ­do com sucesso"),z({}),await ra(),console.log("Lista de clientes atualizada")}catch(We){console.error("Erro ao excluir pet:",We),alert(((Te=($e=We.response)==null?void 0:$e.data)==null?void 0:Te.detail)||"Erro ao excluir pet")}},Me=async V=>{var $e;if(V)try{Re(!0);const Te=await F.get(`/financeiro/cliente/${V}/resumo`);de(Te.data.resumo)}catch(Te){(($e=Te.response)==null?void 0:$e.status)!==404&&console.error("Erro ao carregar resumo financeiro:",Te),de(null)}finally{Re(!1)}},I=(V=null,$e=null,Te=null)=>{if(V)x(V),console.log("ðŸ› Cliente carregado do backend:",{id:V.id,nome:V.nome,is_entregador:V.is_entregador,entregador_padrao:V.entregador_padrao,entregador_padrao_tipo:typeof V.entregador_padrao}),_e({tipo_cadastro:V.tipo_cadastro||"cliente",tipo_pessoa:V.tipo_pessoa||"PF",nome:V.nome,cpf:V.cpf||"",email:V.email||"",telefone:V.telefone||"",celular:V.celular||"",celular_whatsapp:!0,cnpj:V.cnpj||"",inscricao_estadual:V.inscricao_estadual||"",razao_social:V.razao_social||"",nome_fantasia:V.nome_fantasia||"",responsavel:V.responsavel||"",crmv:V.crmv||"",parceiro_ativo:V.parceiro_ativo||!1,parceiro_desde:V.parceiro_desde||"",parceiro_observacoes:V.parceiro_observacoes||"",cep:V.cep||"",endereco:V.endereco||"",numero:V.numero||"",complemento:V.complemento||"",bairro:V.bairro||"",cidade:V.cidade||"",estado:V.estado||"",endereco_entrega:V.endereco_entrega||"",endereco_entrega_2:V.endereco_entrega_2||"",is_entregador:V.is_entregador||!1,entregador_ativo:V.entregador_ativo!==void 0?V.entregador_ativo:!0,entregador_padrao:V.entregador_padrao||!1,tipo_vinculo_entrega:V.tipo_vinculo_entrega||"",controla_rh:V.controla_rh||!1,gera_conta_pagar_custo_entrega:V.gera_conta_pagar_custo_entrega||!1,media_entregas_configurada:V.media_entregas_configurada||"",custo_rh_ajustado:V.custo_rh_ajustado||"",modelo_custo_entrega:V.modelo_custo_entrega||"",taxa_fixa_entrega:V.taxa_fixa_entrega||"",valor_por_km_entrega:V.valor_por_km_entrega||"",moto_propria:V.moto_propria!==void 0?V.moto_propria:!0,tipo_acerto_entrega:V.tipo_acerto_entrega||"",dia_semana_acerto:V.dia_semana_acerto||"",dia_mes_acerto:V.dia_mes_acerto||"",is_terceirizado:V.is_terceirizado||!1,recebe_repasse:V.recebe_repasse||!1,gera_conta_pagar:V.gera_conta_pagar||!1,observacoes:V.observacoes||"",tags:""}),M(V.pets||[]),Ze(V.enderecos_adicionais||[]),Me(V.id),Te?(H(Te),K(5)):(K(1),H(null));else{x(null);const We=$e||(c==="todos"?"cliente":c);_e({tipo_cadastro:We,tipo_pessoa:We==="fornecedor"?"PJ":"PF",nome:"",cpf:"",email:"",telefone:"",celular:"",celular_whatsapp:!0,cnpj:"",inscricao_estadual:"",razao_social:"",nome_fantasia:"",responsavel:"",crmv:"",parceiro_ativo:!1,parceiro_desde:"",parceiro_observacoes:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",estado:"",is_entregador:!1,entregador_ativo:!0,tipo_vinculo_entrega:"",controla_rh:!1,media_entregas_configurada:"",custo_rh_ajustado:"",modelo_custo_entrega:"",taxa_fixa_entrega:"",valor_por_km_entrega:"",moto_propria:!0,is_terceirizado:!1,recebe_repasse:!1,gera_conta_pagar:!1,observacoes:"",tags:""}),M([]),Ze([]),K(1)}j(!0),w("")},X=()=>{j(!1),x(null),K(1),M([]),R(null),S(!1),G(!1),W(null),H(null),de(null)},fe=async()=>{try{const V=new URLSearchParams;if(se.cpf&&V.append("cpf",se.cpf),se.cnpj&&V.append("cnpj",se.cnpj),se.telefone&&V.append("telefone",se.telefone),se.celular&&V.append("celular",se.celular),se.crmv&&V.append("crmv",se.crmv),d&&V.append("cliente_id",d.id),V.toString()){const $e=await F.get(`/clientes/verificar-duplicata/campo?${V.toString()}`);if($e.data.duplicado)return R($e.data),S(!0),!0}return!1}catch(V){return console.error("Erro ao verificar duplicata:",V),!1}},U=async()=>{if($<6){if(w(""),q(""),$===1&&await fe()||$===2&&await fe())return;K($+1)}},ie=V=>["cpf","cnpj","crmv"].includes(V),Ne=()=>{G(!0)},Pe=async()=>{var V,$e;try{r(!0);const Te=(d==null?void 0:d.codigo)||(l.length>0?Math.max(...l.map(We=>We.codigo))+1:1);await F.put(`/clientes/${Z.cliente.id}/remover-campo`,null,{params:{campo:Z.campo,novo_cliente_codigo:Te}}),G(!1),S(!1),R(null),K($+1)}catch(Te){w((($e=(V=Te.response)==null?void 0:V.data)==null?void 0:$e.detail)||"Erro ao remover campo duplicado")}finally{r(!1)}},L=()=>{G(!1)},le=()=>{X();const V=document.getElementById(`cliente-${Z.cliente.id}`);V&&(V.scrollIntoView({behavior:"smooth",block:"center"}),V.classList.add("ring-4","ring-yellow-400"),setTimeout(()=>{V.classList.remove("ring-4","ring-yellow-400")},3e3))},pe=()=>{const V=l.find($e=>$e.id===Z.cliente.id);V&&(S(!1),R(null),G(!1),I(V))},Fe=()=>{$>1&&(w(""),q(""),K($-1))},Oe=V=>{const $e=te[V];Qe({nome:$e.nome||"",especie:$e.especie||"",raca:$e.raca||"",sexo:$e.sexo||"",data_nascimento:$e.data_nascimento||"",cor:$e.cor||"",peso:$e.peso||"",observacoes:$e.observacoes||"",castrado:$e.castrado||!1,porte:$e.porte||"",microchip:$e.microchip||"",alergias:$e.alergias||"",doencas_cronicas:$e.doencas_cronicas||"",medicamentos_continuos:$e.medicamentos_continuos||"",historico_clinico:$e.historico_clinico||"",foto_url:$e.foto_url||"",idade_aproximada:$e.idade_aproximada||""}),Q(V),$e!=null&&$e.id&&W($e.id)},Ke=l.filter(V=>{var $e,Te,We,ua;return(($e=V.codigo)==null?void 0:$e.includes(g))||V.nome.toLowerCase().includes(g.toLowerCase())||((Te=V.cpf)==null?void 0:Te.includes(g))||((We=V.email)==null?void 0:We.toLowerCase().includes(g.toLowerCase()))||((ua=V.celular)==null?void 0:ua.includes(g))});function He({clienteId:V}){const[$e,Te]=a.useState([]),[We,ua]=a.useState(!0);a.useEffect(()=>{V&&xe()},[V]);const xe=async()=>{try{ua(!0);const Ae=await F.get(`/whatsapp/clientes/${V}/whatsapp/ultimas?limit=5`);Te(Ae.data)}catch(Ae){console.error("Erro ao carregar mensagens:",Ae),Te([])}finally{ua(!1)}};return We?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Carregando mensagens..."})]}):$e.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(Ns,{size:32,className:"mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm",children:"Nenhuma mensagem registrada ainda"}),e.jsx("p",{className:"text-xs mt-1",children:"As mensagens enviadas e recebidas aparecerÃ£o aqui"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"Ãšltimas 5 mensagens:"}),$e.map(Ae=>e.jsxs("div",{className:`p-3 rounded-lg border ${Ae.direcao==="enviada"?"bg-green-50 border-green-200 ml-6":"bg-blue-50 border-blue-200 mr-6"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-semibold ${Ae.direcao==="enviada"?"text-green-700":"text-blue-700"}`,children:Ae.direcao==="enviada"?"â†’ Enviada":"â† Recebida"}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${Ae.status==="lido"?"bg-green-200 text-green-800":Ae.status==="enviado"?"bg-yellow-200 text-yellow-800":Ae.status==="recebido"?"bg-blue-200 text-blue-800":"bg-red-200 text-red-800"}`,children:Ae.status})]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(Ae.created_at).toLocaleString("pt-BR")})]}),e.jsx("p",{className:"text-sm text-gray-700",children:Ae.preview||Ae.conteudo})]},Ae.id))]})}return m?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando..."})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Cadastros"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerenciamento de clientes, fornecedores, veterinÃ¡rios, funcionÃ¡rios e pets"})]}),e.jsx("div",{className:"mb-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{b("todos"),i(1)},className:`px-4 py-2 font-medium border-b-2 transition-colors ${c==="todos"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Todos"}),e.jsx("button",{onClick:()=>{b("cliente"),i(1)},className:`px-4 py-2 font-medium border-b-2 transition-colors ${c==="cliente"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Clientes"}),e.jsx("button",{onClick:()=>{b("fornecedor"),i(1)},className:`px-4 py-2 font-medium border-b-2 transition-colors ${c==="fornecedor"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Fornecedores"}),e.jsx("button",{onClick:()=>{b("veterinario"),i(1)},className:`px-4 py-2 font-medium border-b-2 transition-colors ${c==="veterinario"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"VeterinÃ¡rios"}),e.jsx("button",{onClick:()=>{b("funcionario"),i(1)},className:`px-4 py-2 font-medium border-b-2 transition-colors ${c==="funcionario"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"FuncionÃ¡rios"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6 flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Fo,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por cÃ³digo, nome, CPF/CNPJ, email ou telefone...",value:g,onChange:V=>o(V.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx(pl,{})," Importar Excel"]}),e.jsxs("button",{onClick:()=>I(null,c),className:"flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx(Qa,{})," Novo ",c==="cliente"?"Cliente":c==="fornecedor"?"Fornecedor":c==="veterinario"?"VeterinÃ¡rio":c==="funcionario"?"FuncionÃ¡rio":"Cadastro"]})]})]}),k&&!v&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(Na,{}),e.jsx("span",{children:k})]}),!m&&u>0&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border border-gray-200 rounded-t-lg flex items-center justify-between mb-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",(p-1)*C+1," a ",Math.min(p*C,u)," de ",u," pessoas"]}),e.jsxs("select",{value:C,onChange:V=>{h(Number(V.target.value)),i(1)},className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10 por pÃ¡gina"}),e.jsx("option",{value:20,children:"20 por pÃ¡gina"}),e.jsx("option",{value:30,children:"30 por pÃ¡gina"}),e.jsx("option",{value:50,children:"50 por pÃ¡gina"}),e.jsx("option",{value:100,children:"100 por pÃ¡gina"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(1),disabled:p===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Primeira"}),e.jsx("button",{onClick:()=>i(V=>Math.max(V-1,1)),disabled:p===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(Math.ceil(u/C),5)},(V,$e)=>{const Te=Math.ceil(u/C);let We;return Te<=5||p<=3?We=$e+1:p>=Te-2?We=Te-4+$e:We=p-2+$e,e.jsx("button",{onClick:()=>i(We),className:`px-3 py-1 text-sm font-medium rounded-lg transition-colors ${p===We?"bg-purple-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:We},We)})}),e.jsx("button",{onClick:()=>i(V=>Math.min(V+1,Math.ceil(u/C))),disabled:p===Math.ceil(u/C),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"PrÃ³xima"}),e.jsx("button",{onClick:()=>i(Math.ceil(u/C)),disabled:p===Math.ceil(u/C),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Ãšltima"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[Ke.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CPF/CNPJ"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Celular"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pets"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Segmento"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ke.map(V=>{var $e;return e.jsxs(a.Fragment,{children:[e.jsxs("tr",{id:`cliente-${V.id}`,onClick:()=>I(V),className:"hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-medium",children:V.codigo}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:V.nome}),V.tipo_pessoa==="PJ"&&V.razao_social&&e.jsx("span",{className:"text-xs text-gray-500",children:V.razao_social}),V.parceiro_ativo&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-green-700 bg-green-100 px-2 py-0.5 rounded-full w-fit",children:[e.jsx(Ga,{size:12}),"Parceiro"]})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700",children:V.tipo_pessoa==="PF"?V.cpf||"-":V.cnpj||"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700",children:V.celular||"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",onClick:Te=>Te.stopPropagation(),children:e.jsxs("button",{onClick:()=>z({...O,[V.id]:!O[V.id]}),className:"flex items-center gap-2 text-sm text-gray-700 hover:text-gray-900 transition-colors",children:[e.jsx(Ea,{size:16,className:"text-gray-400"}),e.jsx("span",{children:(($e=V.pets)==null?void 0:$e.length)||0}),V.pets&&V.pets.length>0&&e.jsx(Jt,{size:14,className:`transform transition-transform ${O[V.id]?"rotate-90":""}`})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:"text-xs text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",onClick:Te=>Te.stopPropagation(),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[V.celular&&e.jsx("button",{onClick:()=>{const Te=V.celular.replace(/\D/g,"");window.open(`https://wa.me/55${Te}`,"_blank")},className:"text-green-600 hover:text-green-900 transition-colors",title:"Abrir WhatsApp",children:e.jsx(Ns,{size:16})}),e.jsx("button",{onClick:()=>I(V),className:"text-blue-600 hover:text-blue-900 transition-colors",title:"Editar",children:e.jsx(_s,{size:16})}),e.jsx("button",{onClick:()=>Y(V.id),className:"text-red-600 hover:text-red-900 transition-colors",title:"Excluir",children:e.jsx(ps,{size:16})})]})})]}),O[V.id]&&V.pets&&V.pets.length>0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-3 bg-gray-50",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-xs font-semibold text-gray-700 mb-2",children:["Pets de ",V.nome,":"]}),V.pets.map(Te=>e.jsxs("div",{className:`bg-white rounded-lg p-3 flex justify-between items-start border border-gray-200 ${ae===Te.id?"ring-2 ring-blue-400 shadow-lg bg-blue-50":""}`,children:[e.jsxs("div",{className:"flex-1 grid grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Nome"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:Te.nome})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"EspÃ©cie/RaÃ§a"}),e.jsxs("p",{className:"text-sm text-gray-700",children:[Te.especie," ",Te.raca&&`- ${Te.raca}`]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Sexo"}),e.jsx("p",{className:"text-sm text-gray-700",children:Te.sexo||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Nascimento"}),e.jsx("p",{className:"text-sm text-gray-700",children:Te.data_nascimento?new Date(Te.data_nascimento).toLocaleDateString("pt-BR"):"-"})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx("button",{onClick:()=>{W(Te.id),I(V,null,Te.id)},className:"text-blue-600 hover:text-blue-900 p-1 transition-colors",title:"Editar pet",children:e.jsx(_s,{size:14})}),e.jsx("button",{onClick:()=>je(Te.id),className:"text-red-600 hover:text-red-900 p-1 transition-colors",title:"Excluir pet",children:e.jsx(ps,{size:14})})]})]},Te.id))]})})})]},V.id)})})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(is,{className:"mx-auto text-gray-400 mb-4",size:48}),e.jsx("p",{className:"text-gray-600",children:"Nenhum cliente encontrado"})]}),!m&&u>0&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",(p-1)*C+1," a ",Math.min(p*C,u)," de ",u," pessoas"]}),e.jsxs("select",{value:C,onChange:V=>{h(Number(V.target.value)),i(1)},className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10 por pÃ¡gina"}),e.jsx("option",{value:20,children:"20 por pÃ¡gina"}),e.jsx("option",{value:30,children:"30 por pÃ¡gina"}),e.jsx("option",{value:50,children:"50 por pÃ¡gina"}),e.jsx("option",{value:100,children:"100 por pÃ¡gina"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(1),disabled:p===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Primeira"}),e.jsx("button",{onClick:()=>i(V=>Math.max(V-1,1)),disabled:p===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(Math.ceil(u/C),5)},(V,$e)=>{const Te=Math.ceil(u/C);let We;return Te<=5||p<=3?We=$e+1:p>=Te-2?We=Te-4+$e:We=p-2+$e,e.jsx("button",{onClick:()=>i(We),className:`px-3 py-1 text-sm font-medium rounded-lg transition-colors ${p===We?"bg-purple-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:We},We)})}),e.jsx("button",{onClick:()=>i(V=>Math.min(V+1,Math.ceil(u/C))),disabled:p===Math.ceil(u/C),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"PrÃ³xima"}),e.jsx("button",{onClick:()=>i(Math.ceil(u/C)),disabled:p===Math.ceil(u/C),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Ãšltima"})]})]})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:d?`Editar ${d.tipo_cadastro==="cliente"?"Cliente":d.tipo_cadastro==="fornecedor"?"Fornecedor":"VeterinÃ¡rio"}`:`Adicionar ${se.tipo_cadastro==="cliente"?"Cliente":se.tipo_cadastro==="fornecedor"?"Fornecedor":"VeterinÃ¡rio"}`}),e.jsx("button",{onClick:X,className:"text-gray-400 hover:text-gray-600",children:e.jsx(us,{size:24})})]}),e.jsx("div",{className:"flex items-center justify-between mb-2",children:Ye.map((V,$e)=>e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("button",{onClick:()=>K(V.number),className:`w-8 h-8 rounded-full flex items-center justify-center font-semibold text-sm transition-all hover:scale-110 cursor-pointer ${$>V.number?"bg-green-500 text-white hover:bg-green-600":$===V.number?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-600 hover:bg-gray-400"}`,type:"button",title:`Ir para: ${V.title}`,children:$>V.number?e.jsx(yt,{}):V.number}),e.jsx("span",{className:"text-xs mt-1 text-center hidden md:block",children:V.title})]}),$e<Ye.length-1&&e.jsx("div",{className:`h-0.5 flex-1 ${$>V.number?"bg-green-500":"bg-gray-300"}`})]},V.number))}),e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[$,"/6"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[k&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(Na,{}),e.jsx("span",{children:k})]}),J&&Z&&e.jsx("div",{className:"mb-4 p-4 bg-yellow-50 border-2 border-yellow-400 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Na,{className:"text-yellow-600 mt-1",size:24}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-yellow-900 mb-2",children:"âš ï¸ Cliente jÃ¡ cadastrado!"}),e.jsxs("p",{className:"text-sm text-yellow-800 mb-3",children:["JÃ¡ existe um cliente com o mesmo ",e.jsx("strong",{children:Z.campo})," cadastrado:"]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-yellow-300 mb-3",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:Z.cliente.nome}),e.jsxs("p",{className:"text-sm text-gray-600",children:["CÃ³digo: ",Z.cliente.codigo]}),Z.cliente.cpf&&e.jsxs("p",{className:"text-sm text-gray-600",children:["CPF: ",Z.cliente.cpf]}),Z.cliente.celular&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Celular: ",Z.cliente.celular]}),Z.cliente.telefone&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Telefone: ",Z.cliente.telefone]})]}),ie(Z.campo)?e.jsxs("div",{children:[e.jsxs("div",{className:"bg-red-50 border border-red-300 rounded-lg p-4 mb-3",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 mb-2",children:"ðŸš« NÃ£o Ã© possÃ­vel criar novo cadastro"}),e.jsxs("p",{className:"text-sm text-red-800 mb-2",children:[Z.campo.toUpperCase()," Ã© um documento Ãºnico e jÃ¡ estÃ¡ cadastrado."]}),e.jsx("p",{className:"text-sm text-red-700",children:"VocÃª pode editar o cadastro existente ou visualizÃ¡-lo."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:pe,className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:"âœï¸ Editar cadastro existente"}),e.jsx("button",{onClick:le,className:"flex-1 px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm font-medium transition-colors",children:"ðŸ‘ï¸ Ver cadastro"})]})]}):P?e.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-lg p-4 mb-3",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 mb-2",children:"âš ï¸ AtenÃ§Ã£o!"}),e.jsxs("p",{className:"text-sm text-red-800 mb-3",children:["O ",e.jsx("strong",{children:Z.campo})," serÃ¡ removido do cadastro do cliente ",e.jsx("strong",{children:Z.cliente.nome})," (CÃ³digo ",Z.cliente.codigo,") e uma observaÃ§Ã£o serÃ¡ adicionada informando a transferÃªncia."]}),e.jsxs("p",{className:"text-xs text-red-700 mb-3",children:['No cadastro antigo ficarÃ¡ registrado: "Sem nÃºmero por cadastro novo do cliente cÃ³digo ',(d==null?void 0:d.codigo)||(l.length>0?Math.max(...l.map(V=>V.codigo))+1:1),'"']}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Pe,disabled:m,className:"flex-1 px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition-colors disabled:opacity-50",children:m?"Processando...":"Confirmar e continuar"}),e.jsx("button",{onClick:L,disabled:m,className:"flex-1 px-3 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg text-sm font-medium transition-colors disabled:opacity-50",children:"Cancelar"})]})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:le,className:"flex-1 px-3 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg text-sm font-medium transition-colors",children:"Ver cadastro existente"}),e.jsxs("button",{onClick:Ne,className:"flex-1 px-3 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-medium transition-colors",children:["Transferir ",Z.campo]})]})]})]})}),$===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"InformaÃ§Ãµes do cadastro"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de cadastro *"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"cliente",checked:se.tipo_cadastro==="cliente",onChange:V=>{_e({...se,tipo_cadastro:V.target.value,tipo_pessoa:"PF"})},className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Cliente"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"fornecedor",checked:se.tipo_cadastro==="fornecedor",onChange:V=>{_e({...se,tipo_cadastro:V.target.value,tipo_pessoa:"PJ"})},className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Fornecedor"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"veterinario",checked:se.tipo_cadastro==="veterinario",onChange:V=>_e({...se,tipo_cadastro:V.target.value}),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"VeterinÃ¡rio"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"funcionario",checked:se.tipo_cadastro==="funcionario",onChange:V=>_e({...se,tipo_cadastro:V.target.value,tipo_pessoa:"PF"}),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"FuncionÃ¡rio"})]})]})]}),(se.tipo_cadastro==="funcionario"||se.tipo_cadastro==="fornecedor")&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0"})}),e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Ã‰ entregador"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-auto",children:[e.jsx("input",{type:"checkbox",checked:se.is_entregador||!1,onChange:V=>_e({...se,is_entregador:V.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"})]})]}),se.is_entregador&&e.jsxs("div",{className:"ml-5 mt-2 space-y-2 border-l-2 border-blue-300 pl-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.entregador_padrao||!1,onChange:V=>_e({...se,entregador_padrao:V.target.checked}),className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Entregador padrÃ£o"}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"(prÃ©-selecionado nas rotas)"})]}),se.tipo_cadastro==="funcionario"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-start gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.controla_rh||!1,onChange:V=>{const $e=V.target.checked;_e({...se,controla_rh:$e,modelo_custo_entrega:$e?"":se.modelo_custo_entrega,taxa_fixa_entrega:$e?"":se.taxa_fixa_entrega,valor_por_km_entrega:$e?"":se.valor_por_km_entrega,gera_conta_pagar_custo_entrega:!1})},className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Controla RH"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5",children:"Custo rateado na folha (nÃ£o gera contas a pagar)"})]})]}),se.controla_rh&&e.jsx("div",{className:"ml-5 pl-3 border-l-2 border-blue-300",children:e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"MÃ©dia de entregas por mÃªs"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5 mb-1",children:"Define o rateio inicial do custo do funcionÃ¡rio por entrega. SerÃ¡ ajustado automaticamente no final do mÃªs."}),e.jsx("input",{type:"number",min:"1",step:"1",value:se.media_entregas_configurada||"",onChange:V=>_e({...se,media_entregas_configurada:V.target.value}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"Ex: 100 entregas/mÃªs"}),e.jsx("p",{className:"text-[10px] text-blue-600 mt-1",children:"ðŸ’¡ Exemplo: Se o custo mensal Ã© R$ 3.000 e mÃ©dia Ã© 100 entregas, cada entrega custarÃ¡ R$ 30,00 inicialmente"})]})}),!se.controla_rh&&e.jsxs("label",{className:"flex items-start gap-2 cursor-pointer ml-5 pl-2 border-l border-gray-300",children:[e.jsx("input",{type:"checkbox",checked:se.gera_conta_pagar_custo_entrega||!1,onChange:V=>_e({...se,gera_conta_pagar_custo_entrega:V.target.checked}),className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Gerar contas a pagar por entrega"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5",children:"Marque se este funcionÃ¡rio recebe por KM ou taxa fixa a cada entrega"})]})]})]}),(se.tipo_cadastro==="fornecedor"||se.tipo_cadastro==="funcionario"&&!se.controla_rh)&&e.jsxs("div",{className:"space-y-2",children:[se.tipo_cadastro==="fornecedor"&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-1.5 text-[10px] text-yellow-800",children:["âš ï¸ ",e.jsx("strong",{children:"Terceirizado"})," - Sempre gera contas a pagar"]}),se.tipo_cadastro==="funcionario"&&!se.controla_rh&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-1.5 text-[10px] text-blue-800",children:["â„¹ï¸ ",e.jsx("strong",{children:"FuncionÃ¡rio sem RH"})," - ",se.gera_conta_pagar_custo_entrega?"Gera CP por entrega":"NÃ£o gera CP"]}),e.jsxs("label",{className:"flex items-start gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.modelo_custo_entrega==="taxa_fixa",onChange:V=>_e({...se,modelo_custo_entrega:V.target.checked?"taxa_fixa":"",valor_por_km_entrega:""}),className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Taxa Fixa"}),se.modelo_custo_entrega==="taxa_fixa"&&e.jsx("input",{type:"number",step:"0.01",min:"0",value:se.taxa_fixa_entrega||"",onChange:V=>_e({...se,taxa_fixa_entrega:V.target.value}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded mt-1 focus:ring-1 focus:ring-blue-500",placeholder:"Ex: 15.00"})]})]}),e.jsxs("label",{className:"flex items-start gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.modelo_custo_entrega==="por_km",onChange:V=>_e({...se,modelo_custo_entrega:V.target.checked?"por_km":"",taxa_fixa_entrega:""}),className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Valor por KM"}),se.modelo_custo_entrega==="por_km"&&e.jsx("input",{type:"number",step:"0.01",min:"0",value:se.valor_por_km_entrega||"",onChange:V=>_e({...se,valor_por_km_entrega:V.target.value}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded mt-1 focus:ring-1 focus:ring-blue-500",placeholder:"Ex: 2.50"})]})]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.moto_propria||!1,onChange:V=>_e({...se,moto_propria:V.target.checked}),className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-700",children:se.moto_propria?"âœ… Moto prÃ³pria":"ðŸ¢ Moto da loja"})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-blue-200",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700 mb-2",children:"ðŸ“† Acerto Financeiro"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-gray-600 mb-0.5",children:"Periodicidade"}),e.jsxs("select",{value:se.tipo_acerto_entrega||"",onChange:V=>_e({...se,tipo_acerto_entrega:V.target.value,dia_semana_acerto:"",dia_mes_acerto:""}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione"}),e.jsx("option",{value:"semanal",children:"Semanal"}),e.jsx("option",{value:"quinzenal",children:"Quinzenal (dias 1 e 15)"}),e.jsx("option",{value:"mensal",children:"Mensal"})]})]}),se.tipo_acerto_entrega==="semanal"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-gray-600 mb-0.5",children:"Dia da semana"}),e.jsxs("select",{value:se.dia_semana_acerto||"",onChange:V=>_e({...se,dia_semana_acerto:V.target.value}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione"}),e.jsx("option",{value:"1",children:"Segunda"}),e.jsx("option",{value:"2",children:"TerÃ§a"}),e.jsx("option",{value:"3",children:"Quarta"}),e.jsx("option",{value:"4",children:"Quinta"}),e.jsx("option",{value:"5",children:"Sexta"}),e.jsx("option",{value:"6",children:"SÃ¡bado"}),e.jsx("option",{value:"7",children:"Domingo"})]})]}),se.tipo_acerto_entrega==="mensal"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-gray-600 mb-0.5",children:"Dia do mÃªs (1 a 28)"}),e.jsx("input",{type:"number",min:"1",max:"28",value:se.dia_mes_acerto||"",onChange:V=>_e({...se,dia_mes_acerto:V.target.value}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"Ex: 5"})]}),se.tipo_acerto_entrega==="quinzenal"&&e.jsxs("div",{className:"bg-blue-50 p-1.5 rounded text-[10px] text-blue-700",children:["â„¹ï¸ Acerto nos dias ",e.jsx("strong",{children:"1"})," e ",e.jsx("strong",{children:"15"})]})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ga,{className:"text-green-600",size:20}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Ativar como parceiro (comissÃµes)"}),se.parceiro_ativo&&e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 bg-green-600 text-white rounded-full text-xs font-semibold animate-fade-in",children:[e.jsx(yt,{size:14,className:"font-bold"}),e.jsx("span",{children:"Parceiro habilitado para comissÃ£o"})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.parceiro_ativo,onChange:V=>_e({...se,parceiro_ativo:V.target.checked,parceiro_desde:V.target.checked&&!se.parceiro_desde?new Date().toISOString().split("T")[0]:se.parceiro_desde||""}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-7",children:"Ao ativar, esta pessoa poderÃ¡ receber comissÃµes de vendas, independente do tipo de cadastro"}),se.parceiro_ativo&&e.jsxs("div",{className:"mt-3 ml-7",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"ObservaÃ§Ãµes do parceiro (opcional)"}),e.jsx("textarea",{value:se.parceiro_observacoes,onChange:V=>_e({...se,parceiro_observacoes:V.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none",placeholder:"Ex: Especialista em produtos de higiene...",rows:"2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:se.tipo_pessoa==="PJ"?"Tipo de pessoa jurÃ­dica *":"Tipo de pessoa *"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"PF",checked:se.tipo_pessoa==="PF",onChange:V=>_e({...se,tipo_pessoa:V.target.value}),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Pessoa FÃ­sica"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"PJ",checked:se.tipo_pessoa==="PJ",onChange:V=>_e({...se,tipo_pessoa:V.target.value}),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Pessoa JurÃ­dica"})]})]})]}),se.tipo_pessoa==="PF"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome completo *"}),e.jsx("input",{type:"text",value:se.nome,onChange:V=>_e({...se,nome:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Digite o nome completo",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CPF"}),e.jsx("input",{type:"text",value:se.cpf,onChange:V=>{_e({...se,cpf:V.target.value}),S(!1),R(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"000.000.000-00",maxLength:"14"})]}),se.tipo_cadastro==="veterinario"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CRMV"}),e.jsx("input",{type:"text",value:se.crmv,onChange:V=>{_e({...se,crmv:V.target.value}),S(!1),R(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"CRMV XX 1234",maxLength:"20"})]})]}),se.tipo_pessoa==="PJ"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"RazÃ£o Social *"}),e.jsx("input",{type:"text",value:se.razao_social,onChange:V=>_e({...se,razao_social:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"RazÃ£o social da empresa"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Fantasia *"}),e.jsx("input",{type:"text",value:se.nome,onChange:V=>_e({...se,nome:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Nome fantasia da empresa",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CNPJ *"}),e.jsx("input",{type:"text",value:se.cnpj,onChange:V=>{_e({...se,cnpj:V.target.value}),S(!1),R(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"00.000.000/0000-00",maxLength:"18"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"InscriÃ§Ã£o Estadual"}),e.jsx("input",{type:"text",value:se.inscricao_estadual,onChange:V=>_e({...se,inscricao_estadual:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"IE"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ResponsÃ¡vel / Contato"}),e.jsx("input",{type:"text",value:se.responsavel,onChange:V=>_e({...se,responsavel:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Nome do responsÃ¡vel ou contato"})]})]})]}),$===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Contatos"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Celular *"}),e.jsx("input",{type:"text",value:se.celular,onChange:V=>{_e({...se,celular:V.target.value}),S(!1),R(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"(00) 00000-0000"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Este nÃºmero Ã© WhatsApp?"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:se.celular_whatsapp===!0,onChange:()=>_e({...se,celular_whatsapp:!0}),className:"text-blue-600"}),e.jsx("span",{className:"text-sm",children:"Sim"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:se.celular_whatsapp===!1,onChange:()=>_e({...se,celular_whatsapp:!1}),className:"text-blue-600"}),e.jsx("span",{className:"text-sm",children:"NÃ£o"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone fixo"}),e.jsx("input",{type:"text",value:se.telefone,onChange:V=>{_e({...se,telefone:V.target.value}),S(!1),R(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"(00) 0000-0000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-mail"}),e.jsx("input",{type:"email",value:se.email,onChange:V=>_e({...se,email:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"email@exemplo.com"})]})]}),$===3&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"EndereÃ§o"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:se.cep,onChange:V=>{const $e=V.target.value;_e({...se,cep:$e}),$e.replace(/\D/g,"").length===8&&pa($e)},className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"00000-000",maxLength:"9"}),e.jsx("button",{type:"button",onClick:()=>pa(se.cep),disabled:_,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50",children:_?"Buscando...":"Buscar"})]}),re&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:re}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Digite o CEP para preencher o endereÃ§o automaticamente"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EndereÃ§o"}),e.jsx("input",{type:"text",value:se.endereco,onChange:V=>_e({...se,endereco:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Rua, Avenida..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NÃºmero"}),e.jsx("input",{type:"text",value:se.numero,onChange:V=>_e({...se,numero:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"123"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complemento"}),e.jsx("input",{type:"text",value:se.complemento,onChange:V=>_e({...se,complemento:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Apto, Bloco..."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bairro"}),e.jsx("input",{type:"text",value:se.bairro,onChange:V=>_e({...se,bairro:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cidade"}),e.jsx("input",{type:"text",value:se.cidade,onChange:V=>_e({...se,cidade:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsx("input",{type:"text",value:se.estado,onChange:V=>_e({...se,estado:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",maxLength:"2",placeholder:"SP"})]})]})]}),$===4&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"InformaÃ§Ãµes complementares"}),e.jsxs("div",{className:"border-b pb-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800",children:"EndereÃ§os Adicionais"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Cadastre mÃºltiplos endereÃ§os para entrega, cobranÃ§a, etc."})]}),e.jsxs("button",{type:"button",onClick:()=>na(),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Adicionar EndereÃ§o"]})]}),ke.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-4",children:ke.map((V,$e)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 bg-gray-50 hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${V.tipo==="entrega"?"bg-blue-100 text-blue-800":V.tipo==="cobranca"?"bg-green-100 text-green-800":V.tipo==="comercial"?"bg-purple-100 text-purple-800":V.tipo==="residencial"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:V.tipo==="entrega"?"ðŸ“¦ Entrega":V.tipo==="cobranca"?"ðŸ’° CobranÃ§a":V.tipo==="comercial"?"ðŸ¢ Comercial":V.tipo==="residencial"?"ðŸ  Residencial":"ðŸ“ Trabalho"}),e.jsxs("span",{className:"text-xs font-medium text-gray-500",children:["+",$e+1]})]}),V.apelido&&e.jsx("p",{className:"text-sm font-semibold text-gray-900 mb-1",children:V.apelido}),e.jsxs("p",{className:"text-sm text-gray-700",children:[V.endereco,", ",V.numero,V.complemento&&` - ${V.complemento}`]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[V.bairro,", ",V.cidade,"/",V.estado]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["CEP: ",V.cep]})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx("button",{type:"button",onClick:()=>na($e),className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Editar",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{type:"button",onClick:()=>Be($e),className:"p-1.5 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Excluir",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},$e))}):e.jsxs("div",{className:"text-center py-8 text-gray-500 text-sm",children:[e.jsxs("svg",{className:"w-12 h-12 mx-auto mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Nenhum endereÃ§o adicional cadastrado"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"MarcaÃ§Ãµes / Tags"}),e.jsx("input",{type:"text",value:se.tags,onChange:V=>_e({...se,tags:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Ex: Bom pagador, Cliente fiel, VIP"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Separe por vÃ­rgula para mÃºltiplas tags"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ObservaÃ§Ãµes"}),e.jsx("textarea",{value:se.observacoes,onChange:V=>_e({...se,observacoes:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",rows:"4",placeholder:"InformaÃ§Ãµes adicionais sobre o cliente..."})]})]}),$===5&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ea,{className:"text-blue-600",size:24}),"Pets do Cliente"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Use o mÃ³dulo dedicado para gerenciar pets com informaÃ§Ãµes completas"})]})}),e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-lg p-5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ea,{className:"text-blue-600 flex-shrink-0 mt-1",size:24}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"ðŸŽ¯ GestÃ£o Profissional de Pets"}),e.jsxs("p",{className:"text-sm text-blue-800 mb-3",children:["Agora os pets possuem um ",e.jsx("strong",{children:"mÃ³dulo dedicado"})," com funcionalidades completas: histÃ³rico mÃ©dico, vacinas, consultas, serviÃ§os e muito mais."]}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 mb-4",children:[e.jsx("li",{children:"âœ… Cadastro completo com campos veterinÃ¡rios"}),e.jsx("li",{children:"âœ… HistÃ³rico de saÃºde e medicaÃ§Ãµes"}),e.jsx("li",{children:"âœ… Controle de vacinas e consultas"}),e.jsx("li",{children:"âœ… Timeline de eventos"}),e.jsx("li",{children:"âœ… Preparado para uso clÃ­nico real"})]})]})]})}),te.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3",children:["Pets cadastrados (",te.length,")"]}),e.jsx("div",{className:"space-y-2",children:te.map(V=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ea,{className:"text-blue-600",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:V.nome}),e.jsxs("p",{className:"text-sm text-gray-600",children:[V.especie," ",V.raca&&`â€¢ ${V.raca}`]})]})]}),V.id&&e.jsx("button",{onClick:()=>s(`/pets/${V.id}`),className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm font-medium transition-colors",children:"Ver Detalhes"})]},V.id||V.nome))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>{d!=null&&d.id?s(`/pets?cliente_id=${d.id}`):alert("âš ï¸ Salve o cliente primeiro para gerenciar pets")},className:"flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg transition-all font-semibold shadow-md",children:[e.jsx(Ea,{size:24}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{children:"ðŸ¾ Gerenciar Pets"}),e.jsx("div",{className:"text-xs font-normal opacity-90",children:"MÃ³dulo completo de gestÃ£o"})]})]}),e.jsxs("button",{type:"button",onClick:()=>{d!=null&&d.id?s("/pets/novo",{state:{clienteId:d.id}}):alert("âš ï¸ Salve o cliente primeiro para adicionar pets")},className:"flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-lg transition-all font-semibold shadow-md",children:[e.jsx(Qa,{size:24}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{children:"âž• Adicionar Pet"}),e.jsx("div",{className:"text-xs font-normal opacity-90",children:"Cadastro completo"})]})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:["ðŸ’¡ ",e.jsx("strong",{children:"Dica:"})," Pets podem ser adicionados agora ou depois. Todas as informaÃ§Ãµes mÃ©dicas e histÃ³rico ficam no mÃ³dulo dedicado de pets."]})}),!d&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-orange-800",children:["âš ï¸ ",e.jsx("strong",{children:"AtenÃ§Ã£o:"})," Salve o cliente primeiro (etapa 6) para poder gerenciar seus pets."]})})]}),$===6&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ga,{className:"text-green-600"}),"InformaÃ§Ãµes Financeiras"]}),e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800 mb-1",children:"ðŸ’° Saldo de CrÃ©dito"}),e.jsxs("p",{className:"text-3xl font-bold text-green-600",children:["R$ ",d!=null&&d.credito?parseFloat(d.credito).toFixed(2).replace(".",","):"0,00"]}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"DisponÃ­vel para uso em compras"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50",disabled:!d,onClick:async()=>{var We,ua;if(!d){alert("Salve o cliente primeiro antes de adicionar crÃ©dito");return}const V=prompt("Digite o valor a adicionar ao crÃ©dito:");if(!V||isNaN(parseFloat(V)))return;const $e=parseFloat(V);if($e<=0){alert("Valor deve ser maior que zero");return}const Te=prompt("Motivo da adiÃ§Ã£o de crÃ©dito:","Ajuste manual");if(Te)try{const xe=await F.post(`/clientes/${d.id}/credito/adicionar`,{valor:$e,motivo:Te});alert(`âœ… ${xe.data.message}

CrÃ©dito anterior: R$ ${xe.data.credito_anterior.toFixed(2)}
Valor adicionado: R$ ${xe.data.valor_adicionado.toFixed(2)}
Novo saldo: R$ ${xe.data.credito_atual.toFixed(2)}`),x({...d,credito:xe.data.credito_atual}),ra()}catch(xe){console.error("Erro ao adicionar crÃ©dito:",xe),alert("âŒ Erro ao adicionar crÃ©dito: "+(((ua=(We=xe.response)==null?void 0:We.data)==null?void 0:ua.detail)||xe.message))}},children:[e.jsx(Vs,{})," Adicionar CrÃ©dito"]}),e.jsxs("button",{type:"button",className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50",disabled:!d,onClick:async()=>{var ua,xe;if(!d){alert("Salve o cliente primeiro antes de remover crÃ©dito");return}const V=parseFloat(d.credito||0);if(V<=0){alert("Cliente nÃ£o possui crÃ©dito para remover");return}const $e=prompt(`Digite o valor a remover (mÃ¡x: R$ ${V.toFixed(2)}):`);if(!$e||isNaN(parseFloat($e)))return;const Te=parseFloat($e);if(Te<=0){alert("Valor deve ser maior que zero");return}if(Te>V){alert(`Valor excede o crÃ©dito disponÃ­vel (R$ ${V.toFixed(2)})`);return}const We=prompt("Motivo da remoÃ§Ã£o de crÃ©dito:","Ajuste manual");if(We)try{const Ae=await F.post(`/clientes/${d.id}/credito/remover`,{valor:Te,motivo:We});alert(`âœ… ${Ae.data.message}

CrÃ©dito anterior: R$ ${Ae.data.credito_anterior.toFixed(2)}
Valor removido: R$ ${Ae.data.valor_removido.toFixed(2)}
Novo saldo: R$ ${Ae.data.credito_atual.toFixed(2)}`),x({...d,credito:Ae.data.credito_atual}),ra()}catch(Ae){console.error("Erro ao remover crÃ©dito:",Ae),alert("âŒ Erro ao remover crÃ©dito: "+(((xe=(ua=Ae.response)==null?void 0:ua.data)==null?void 0:xe.detail)||Ae.message))}},children:[e.jsx(or,{})," Remover CrÃ©dito"]})]})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("h4",{className:"text-md font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Yt,{}),"Resumo Financeiro (Ãšltimos 90 dias)"]}),d?e.jsx("div",{className:"space-y-4",children:ue?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600 text-sm",children:"Carregando resumo..."})]}):e.jsxs(e.Fragment,{children:[ee?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"ðŸ’° Total Comprado"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["R$ ",((ea=ee.total_vendas)==null?void 0:ea.toFixed(2).replace(".",","))||"0,00"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[ee.quantidade_vendas||0," vendas"]})]}),e.jsxs("div",{className:`rounded-lg p-4 border ${ee.tem_debitos_vencidos?"bg-red-50 border-red-300":ee.tem_debitos?"bg-orange-50 border-orange-200":"bg-green-50 border-green-200"}`,children:[e.jsxs("p",{className:"text-xs text-gray-600 mb-1",children:[ee.tem_debitos_vencidos?"âš ï¸":"ðŸ“‹"," Em Aberto"]}),e.jsxs("p",{className:`text-2xl font-bold ${ee.tem_debitos_vencidos?"text-red-600":ee.tem_debitos?"text-orange-600":"text-green-600"}`,children:["R$ ",((oa=ee.total_em_aberto)==null?void 0:oa.toFixed(2).replace(".",","))||"0,00"]}),ee.tem_debitos_vencidos&&e.jsxs("p",{className:"text-xs text-red-600 font-semibold mt-1",children:["R$ ",((ia=ee.total_vencido)==null?void 0:ia.toFixed(2).replace(".",","))||"0,00"," vencido"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 border border-purple-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"ðŸ“Š Ticket MÃ©dio"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["R$ ",((Ue=ee.ticket_medio)==null?void 0:Ue.toFixed(2).replace(".",","))||"0,00"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"por compra"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"ðŸ• Ãšltima Compra"}),ee.ultima_compra?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-2xl font-bold text-gray-700",children:["R$ ",((wa=ee.ultima_compra.valor)==null?void 0:wa.toFixed(2).replace(".",","))||"0,00"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[new Date(ee.ultima_compra.data).toLocaleDateString("pt-BR")," ","(hÃ¡ ",ee.ultima_compra.dias_atras," dias)"]})]}):e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Nenhuma compra"})]})]})}):e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx("p",{className:"mb-2",children:"ðŸ“‹ Nenhuma informaÃ§Ã£o financeira"}),e.jsx("p",{className:"text-sm",children:"Dados aparecerÃ£o apÃ³s a primeira venda"})]}),e.jsxs("button",{type:"button",onClick:()=>s(`/clientes/${d.id}/financeiro`),className:"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-lg transition-all flex items-center justify-center gap-2 font-semibold shadow-md",children:[e.jsx(Yt,{}),"ðŸ“Š Ver HistÃ³rico Financeiro Completo",ee&&e.jsxs("span",{className:"text-xs bg-white bg-opacity-20 px-2 py-1 rounded",children:[ee.total_transacoes_historico||0," transaÃ§Ãµes"]})]})]})}):e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:e.jsx("p",{className:"text-blue-800 text-sm",children:"â„¹ï¸ Salve o cliente primeiro para visualizar o resumo financeiro"})})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:["ðŸ’¡ ",e.jsx("strong",{children:"Dica:"})," O crÃ©dito pode ser gerado automaticamente nas devoluÃ§Ãµes de produtos e utilizado como forma de pagamento no PDV."]})}),d&&e.jsx(an,{clienteId:d.id}),d&&e.jsx(rn,{clienteId:d.id,cliente:d,metricas:ee}),d&&d.celular&&e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"text-green-600",size:24}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ðŸ’¬ WhatsApp"})]}),e.jsxs("button",{type:"button",onClick:()=>{const V=d.celular.replace(/\D/g,"");window.open(`https://wa.me/55${V}`,"_blank")},className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm font-medium",children:[e.jsx(Ns,{}),"Abrir conversa"]})]}),e.jsx(He,{clienteId:d.id})]}),d&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm",children:e.jsx($r,{clienteId:d.tipo_cadastro==="cliente"?d.id:null,fornecedorId:d.tipo_cadastro==="fornecedor"?d.id:null,tipo:d.tipo_cadastro==="fornecedor"?"fornecedor":"cliente",limit:5,showHeader:!0,onVerMais:()=>s(`/clientes/${d.id}/timeline`)})})]})]}),e.jsxs("div",{className:"border-t border-gray-200 p-4 bg-gray-50 flex justify-between",children:[e.jsxs("button",{onClick:Fe,disabled:$===1,className:"flex items-center gap-2 px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(rt,{})," Voltar"]}),$<6?e.jsxs("button",{onClick:U,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:["AvanÃ§ar ",e.jsx(Jt,{})]}):e.jsxs("button",{onClick:Ie,className:"flex items-center gap-2 px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[e.jsx(Is,{})," Salvar Cliente"]})]})]})}),be&&ze&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between z-10",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:ze.index!==void 0?"Editar EndereÃ§o":"Adicionar Novo EndereÃ§o"}),e.jsx("button",{onClick:oe,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de EndereÃ§o *"}),e.jsxs("select",{value:ze.tipo,onChange:V=>Xe({...ze,tipo:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"entrega",children:"ðŸ“¦ Entrega"}),e.jsx("option",{value:"cobranca",children:"ðŸ’° CobranÃ§a"}),e.jsx("option",{value:"comercial",children:"ðŸ¢ Comercial"}),e.jsx("option",{value:"residencial",children:"ðŸ  Residencial"}),e.jsx("option",{value:"trabalho",children:"ðŸ“ Trabalho"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apelido (opcional)"}),e.jsx("input",{type:"text",value:ze.apelido,onChange:V=>Xe({...ze,apelido:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Ex: Casa da mÃ£e, EscritÃ³rio, Loja"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:ze.cep,onChange:V=>{const $e=V.target.value.replace(/\D/g,""),Te=$e.length>5?`${$e.slice(0,5)}-${$e.slice(5,8)}`:$e;Xe({...ze,cep:Te})},onBlur:V=>ye(V.target.value),maxLength:"9",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"00000-000"}),_&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EndereÃ§o *"}),e.jsx("input",{type:"text",value:ze.endereco,onChange:V=>Xe({...ze,endereco:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Rua, Avenida, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NÃºmero"}),e.jsx("input",{type:"text",value:ze.numero,onChange:V=>Xe({...ze,numero:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"123"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complemento"}),e.jsx("input",{type:"text",value:ze.complemento,onChange:V=>Xe({...ze,complemento:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Apto, Bloco, Sala..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bairro"}),e.jsx("input",{type:"text",value:ze.bairro,onChange:V=>Xe({...ze,bairro:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Centro, Jardim..."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cidade *"}),e.jsx("input",{type:"text",value:ze.cidade,onChange:V=>Xe({...ze,cidade:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"SÃ£o Paulo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsx("input",{type:"text",value:ze.estado,onChange:V=>Xe({...ze,estado:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",maxLength:"2",placeholder:"SP"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"* Campos obrigatÃ³rios"})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:oe,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:Ce,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Salvar EndereÃ§o"})]})]})}),e.jsx(Jl,{isOpen:f,onClose:()=>{N(!1),fetchClientes()}}),e.jsx("style",{children:`
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: scale(0.95);
          }
          to {
            opacity: 1;
            transform: scale(1);
          }
        }
        
        .animate-fade-in {
          animation: fadeIn 0.3s ease-out;
        }
      `})]})},Go=(s={})=>F.get("/produtos/categorias",{params:s}),Qo=(s={})=>F.get("/produtos/marcas",{params:s}),ln=(s={})=>F.get("/produtos/departamentos",{params:s}),Xo=(s={})=>F.get("/produtos/",{params:s}),nn=(s={})=>F.get("/produtos/vendaveis",{params:s}),io=s=>F.get(`/produtos/${s}`),dr=s=>F.get(`/produtos/${s}/variacoes`),co=s=>F.post("/produtos/",s),dn=(s,l)=>F.put(`/produtos/${s}`,l),yr=s=>F.delete(`/produtos/${s}`),cn=(s="")=>F.post("/produtos/gerar-sku",{prefixo:s}),xn=s=>F.post("/produtos/gerar-codigo-barras",{sku:s}),Wt=s=>F.get(`/produtos/${s}/lotes`),mn=(s,l)=>F.post(`/produtos/${s}/entrada`,l),un=(s,l,t)=>F.put(`/produtos/${s}/lotes/${l}`,t),pn=(s,l)=>F.delete(`/produtos/${s}/lotes/${l}`),gn=(s,l)=>F.post(`/produtos/${s}/imagens`,l,{headers:{"Content-Type":"multipart/form-data"}}),hn=s=>F.delete(`/produtos/imagens/${s}`),cr=s=>F.get(`/produtos/${s}/fornecedores`),bn=(s,l)=>F.post(`/produtos/${s}/fornecedores`,l),fn=(s,l)=>F.put(`/produtos/fornecedores/${s}`,l),jn=s=>F.delete(`/produtos/fornecedores/${s}`),vn=(s={})=>F.get("/produtos/relatorio/movimentacoes",{params:s}),yn=(s,l)=>s*(1+l/100),xo=(s,l)=>!s||s===0?0:(l-s)/s*100,Ds=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s||0),Nr=s=>s?new Date(s).toLocaleDateString("pt-BR"):"-";function Nn({isOpen:s,onClose:l,onSuccess:t}){const[m,r]=a.useState(null),[g,o]=a.useState(!1),[v,j]=a.useState(null),[f,N]=a.useState("upload"),d=b=>{const p=b.target.files[0];p&&(p.name.endsWith(".xlsx")||p.name.endsWith(".xls")?(r(p),j(null)):(Se.error("Arquivo deve ser Excel (.xlsx ou .xls)"),b.target.value=""))},x=async()=>{try{const b=localStorage.getItem("access_token")||localStorage.getItem("token"),p=await F.get("/produtos/template-importacao",{headers:{Authorization:`Bearer ${b}`},responseType:"blob"}),i=window.URL.createObjectURL(new Blob([p.data])),u=document.createElement("a");u.href=i,u.setAttribute("download",`template_produtos_${new Date().toISOString().split("T")[0]}.xlsx`),document.body.appendChild(u),u.click(),u.remove(),window.URL.revokeObjectURL(i),Se.success("Template baixado com sucesso!")}catch(b){console.error("Erro ao baixar template:",b),Se.error("Erro ao baixar template")}},k=async()=>{var b,p;if(!m){Se.error("Selecione um arquivo para importar");return}o(!0),N("processando");try{const i=new FormData;i.append("file",m);const u=await F.post("/produtos/importar",i);j(u.data),N("resultado"),u.data.total_sucesso>0&&(Se.success(`${u.data.total_sucesso} produtos processados com sucesso!`),t&&t()),u.data.total_erros>0&&Se.error(`${u.data.total_erros} produtos com erro`)}catch(i){console.error("Erro ao importar:",i),Se.error(((p=(b=i.response)==null?void 0:b.data)==null?void 0:p.detail)||"Erro ao importar produtos"),N("upload")}finally{o(!1)}},w=()=>{r(null),j(null),N("upload")},c=()=>{w(),l()};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gradient-to-r from-blue-600 to-blue-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"ImportaÃƒÂ§ÃƒÂ£o de Produtos em Lote"})]}),e.jsx("button",{onClick:c,className:"text-white hover:text-gray-200 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[f==="upload"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Como funciona"]}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 ml-7",children:[e.jsx("li",{children:"1. Baixe o template Excel clicando no botÃƒÂ£o abaixo"}),e.jsx("li",{children:"2. Preencha os dados dos produtos na planilha"}),e.jsx("li",{children:"3. Salve o arquivo e faÃƒÂ§a o upload aqui"}),e.jsx("li",{children:"4. Produtos novos serÃƒÂ£o criados, existentes serÃƒÂ£o atualizados (baseado no SKU)"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:x,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Baixar Template Excel"]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecione a Planilha Preenchida"}),e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx("svg",{className:"w-12 h-12 mb-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:"Clique para selecionar"})," ou arraste o arquivo"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Apenas arquivos Excel (.xlsx, .xls)"}),m&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-blue-600",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"font-medium",children:m.name})]})]}),e.jsx("input",{type:"file",className:"hidden",accept:".xlsx,.xls",onChange:d})]})})]})]}),f==="processando"&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mb-4"}),e.jsx("p",{className:"text-lg text-gray-700",children:"Processando planilha..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Isso pode levar alguns segundos"})]}),f==="resultado"&&v&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:v.total_processado}),e.jsx("div",{className:"text-sm text-blue-800 mt-1",children:"Total Processado"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:v.total_criados}),e.jsx("div",{className:"text-sm text-green-800 mt-1",children:"Criados"})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:v.total_atualizados}),e.jsx("div",{className:"text-sm text-yellow-800 mt-1",children:"Atualizados"})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:v.total_erros}),e.jsx("div",{className:"text-sm text-red-800 mt-1",children:"Erros"})]})]}),v.detalhes.criados.length>0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-green-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Produtos Criados (",v.detalhes.criados.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-1",children:v.detalhes.criados.map((b,p)=>e.jsxs("li",{className:"text-green-800",children:["Linha ",b.linha,": ",e.jsx("span",{className:"font-medium",children:b.sku})," - ",b.nome]},p))})})]}),v.detalhes.atualizados.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-yellow-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Produtos Atualizados (",v.detalhes.atualizados.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-1",children:v.detalhes.atualizados.map((b,p)=>e.jsxs("li",{className:"text-yellow-800",children:["Linha ",b.linha,": ",e.jsx("span",{className:"font-medium",children:b.sku})," - ",b.nome]},p))})})]}),v.detalhes.erros.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-red-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Erros (",v.detalhes.erros.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-2",children:v.detalhes.erros.map((b,p)=>e.jsxs("li",{className:"text-red-800",children:[e.jsxs("strong",{children:["Linha ",b.linha]})," (",b.sku,"): ",b.erro]},p))})})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3 bg-gray-50",children:[f==="upload"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:k,disabled:!m||g,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Importando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Importar Produtos"]})})]}),f==="resultado"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:w,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Importar Novamente"}),e.jsx("button",{onClick:c,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Concluir"})]})]})]})}):null}const gt=[{key:"checkbox",label:"",visible:!0,renderHeader:s=>e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:s.produtos.length>0&&s.selecionados.length===s.produtos.length,onChange:s.handleSelecionarTodos,className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"})}),renderCell:(s,l)=>e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:l.selecionados.includes(s.id),onChange:t=>l.handleSelecionar(s.id,t.nativeEvent),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 cursor-pointer"})})},{key:"imagem",label:"Imagem",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Imagem"}),renderCell:(s,l)=>{const t=s.tipo_produto==="VARIACAO";return e.jsx("td",{className:`px-4 py-3 ${t?"pl-12":""}`,children:e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden border border-gray-200 flex-shrink-0",children:s.imagem_principal?e.jsx("img",{src:s.imagem_principal.startsWith("http")?s.imagem_principal:`${window.location.origin}${s.imagem_principal}`,alt:s.nome,className:"w-full h-full object-cover object-center",onError:m=>{console.error("Erro ao carregar imagem:",s.imagem_principal),m.target.style.display="none",m.target.parentElement.innerHTML='<svg class="w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>'}}):e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})})}},{key:"descricao",label:"DescriÃ§Ã£o",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"DescriÃ§Ã£o"}),renderCell:(s,l)=>{const t=s.tipo_produto==="VARIACAO",m=s.tipo_produto==="PAI",r=s.tipo_produto==="KIT",g=(l.kitsExpandidos||[]).includes(s.id),o=(l.paisExpandidos||[]).includes(s.id);return e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`flex-1 ${t?"pl-6":""}`,children:[e.jsxs("div",{className:"flex items-center",children:[t&&e.jsx("svg",{className:"w-4 h-4 text-blue-400 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),m&&e.jsx("button",{onClick:v=>{v.preventDefault(),v.stopPropagation(),l.togglePaiExpandido(s.id)},className:"flex items-center text-blue-600 hover:text-blue-700 transition-colors mr-1",title:o?"Ocultar variaÃ§Ãµes":"Ver variaÃ§Ãµes",children:e.jsx("svg",{className:`w-4 h-4 transition-transform ${o?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),r&&e.jsx("button",{onClick:v=>{v.preventDefault(),v.stopPropagation(),l.toggleKitExpandido(s.id)},className:`flex items-center transition-colors mr-1 ${s.tipo_kit==="VIRTUAL"?"text-indigo-600 hover:text-indigo-700":"text-green-600 hover:text-green-700"}`,title:g?"Ocultar composiÃ§Ã£o":"Ver composiÃ§Ã£o",children:e.jsx("svg",{className:`w-4 h-4 transition-transform ${g?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[s.nome,m&&e.jsxs("span",{className:"ml-2 text-xs text-blue-600",children:["(Pai ",s.total_variacoes||0,")"]}),r&&s.tipo_kit==="VIRTUAL"&&e.jsx("span",{className:"ml-2 text-xs text-indigo-600",children:"(Kit â€¢ Virtual)"}),r&&s.tipo_kit==="FISICO"&&e.jsx("span",{className:"ml-2 text-xs text-green-600",children:"(Kit â€¢ FÃ­sico)"}),s.data_descontinuacao&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800",children:"âš ï¸ Descontinuado"})]})]}),s.descricao&&e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-xs mt-1",children:s.descricao})]}),e.jsx("button",{onClick:v=>{v.stopPropagation(),l.copiarTexto(s.nome,"Nome")},className:"text-gray-400 hover:text-gray-600",title:"Copiar nome",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})})}},{key:"codigo",label:"CÃ³digo",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CÃ³digo"}),renderCell:(s,l)=>e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900 font-mono",children:s.codigo||s.sku}),s.codigo_barras&&e.jsx("div",{className:"text-xs text-gray-500 font-mono",children:s.codigo_barras})]}),e.jsx("button",{onClick:t=>{t.stopPropagation(),l.copiarTexto(s.codigo||s.sku,"SKU")},className:"text-gray-400 hover:text-gray-600",title:"Copiar SKU",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})})},{key:"unidade",label:"Unidade",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unidade"}),renderCell:s=>e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-sm text-gray-700",children:s.unidade||"UN"})})},{key:"custo",label:"Custo",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Custo"}),renderCell:(s,l)=>e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:"text-sm text-gray-900",children:Ds(s.preco_custo)})})},{key:"preco_venda",label:"PV",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PV"}),renderCell:(s,l)=>e.jsx("td",{className:"px-4 py-3 text-right",children:l.editandoPreco===s.id?e.jsxs("div",{className:"flex items-center gap-1 justify-end",onClick:t=>t.stopPropagation(),children:[e.jsx("input",{type:"number",step:"0.01",value:l.novoPreco,onChange:t=>l.setNovoPreco(t.target.value),className:"w-24 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",autoFocus:!0}),e.jsx("button",{onClick:()=>l.handleSalvarPreco(s.id),className:"text-green-600 hover:text-green-800",title:"Salvar",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("button",{onClick:l.handleCancelarEdicaoPreco,className:"text-red-600 hover:text-red-800",title:"Cancelar",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("span",{className:"text-sm font-semibold text-green-600",children:Ds(s.preco_venda)}),e.jsx("button",{onClick:t=>{t.stopPropagation(),l.handleEditarPreco(s.id,s.preco_venda)},className:"text-blue-600 hover:text-blue-800",title:"Editar preÃ§o",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})})},{key:"validade",label:"Validade",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Validade"}),renderCell:(s,l)=>e.jsx("td",{className:"px-4 py-3 text-center text-sm",children:l.getValidadeMaisProxima(s)})},{key:"estoque",label:"Estoque",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque"}),renderCell:(s,l)=>{const t=s.tipo_produto==="KIT"&&s.tipo_kit==="VIRTUAL",m=t?s.estoque_virtual??0:s.estoque_atual||0;return e.jsx("td",{className:"px-4 py-3 text-center",children:s.controlar_estoque?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:`text-sm ${l.getCorEstoque(s)}`,children:m}),t&&e.jsx("span",{className:"text-xs text-gray-400 mt-0.5",children:"estoque virtual"})]}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})})}},{key:"acoes",label:"AÃ§Ãµes",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"}),renderCell:(s,l)=>e.jsx("td",{className:"px-4 py-3 text-center",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),console.log("Produto:",s.nome,"Controla estoque:",s.controlar_estoque,"Estoque atual:",s.estoque_atual),l.navigate(`/produtos/${s.id}/movimentacoes`)},className:`rounded hover:opacity-80 transition-opacity ${s.controlar_estoque===!0&&(s.estoque_atual||0)>0?"text-green-600 hover:text-green-800":s.controlar_estoque===!0&&(s.estoque_atual||0)===0?"text-red-600 hover:text-red-800":"text-gray-400 hover:text-gray-600"}`,title:"Ver movimentaÃ§Ãµes de estoque",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),l.navigate(`/produtos/${s.id}/editar`)},className:"text-blue-600 hover:text-blue-800 transition-colors",title:"Editar",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),l.handleExcluir(s.id)},className:"text-red-600 hover:text-red-800 transition-colors",title:"Excluir",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})}];function _n(){const s=fa(),[l,t]=a.useState([]),[m,r]=a.useState([]),[g,o]=a.useState([]),[v,j]=a.useState(!0),[f,N]=a.useState([]),[d,x]=a.useState(null),[k,w]=a.useState(null),[c,b]=a.useState(""),[p,i]=a.useState([]),[u,n]=a.useState([]),[C,h]=a.useState(()=>{const Y=localStorage.getItem("produtos_colunas_visiveis");return Y?JSON.parse(Y):null}),[_,E]=a.useState(!1),[$,K]=a.useState([]),[te,M]=a.useState(!1),[A,Q]=a.useState({marca_id:"",categoria_id:"",departamento_id:""}),[re,q]=a.useState([]),[Z,R]=a.useState(!1),[J,S]=a.useState({busca:"",categoria_id:"",marca_id:"",estoque_baixo:!1,em_promocao:!1}),[P,G]=a.useState(1),[B,y]=a.useState(20),O=a.useMemo(()=>{if(!l||l.length===0)return[];const Y=[],je=l.filter(X=>X.tipo_produto==="PAI"),Me=l.filter(X=>X.tipo_produto==="VARIACAO"),I=l.filter(X=>X.tipo_produto!=="PAI"&&X.tipo_produto!=="VARIACAO");return Y.push(...I),je.forEach(X=>{if(Y.push(X),u.includes(X.id)){const fe=Me.filter(U=>U.produto_pai_id===X.id);Y.push(...fe)}}),Y},[l,u]),z=a.useMemo(()=>{let Y=[...O];if(J.busca.trim()){const je=J.busca.toLowerCase();Y=Y.filter(Me=>Me.nome&&Me.nome.toLowerCase().includes(je)||Me.codigo&&Me.codigo.toLowerCase().includes(je))}return J.categoria_id&&(Y=Y.filter(je=>je.categoria_id==J.categoria_id)),J.marca_id&&(Y=Y.filter(je=>je.marca_id==J.marca_id)),J.estoque_baixo&&(Y=Y.filter(je=>{const Me=je.tipo_produto==="KIT"&&je.tipo_kit==="VIRTUAL"?je.estoque_virtual??0:je.estoque_atual||0,I=je.estoque_minimo||0;return je.controlar_estoque&&Me<=I})),J.em_promocao&&(Y=Y.filter(je=>je.promocao_ativa===!0)),Y},[O,J]),{produtosPaginados:ae,totalPaginas:W,totalItens:ne}=a.useMemo(()=>{const Y=Math.ceil(z.length/B),je=(P-1)*B,Me=je+B;return{produtosPaginados:z.slice(je,Me),totalPaginas:Y,totalItens:z.length}},[z,P,B]),H=ae;a.useEffect(()=>{G(1)},[J]),a.useEffect(()=>{ee(),de(),ue(),Re()},[]);const ee=async()=>{try{j(!0);const Y={};Object.keys(J).forEach(I=>{const X=J[I];X!==""&&X!==null&&X!==void 0&&(Y[I]=X)});const je=await Xo(Y);let Me;if(Array.isArray(je.data))Me=je.data;else if(je.data.itens)Me=je.data.itens;else if(je.data.produtos)Me=je.data.produtos;else if(je.data.data)Me=je.data.data;else{const I=Object.keys(je.data).filter(X=>Array.isArray(je.data[X]));I.length>0?Me=je.data[I[0]]:Me=[]}t(Me)}catch(Y){console.error("Erro ao carregar produtos:",Y),alert("Erro ao carregar produtos")}finally{j(!1)}},de=async()=>{try{const Y=await Go();r(Y.data)}catch(Y){console.error("Erro ao carregar categorias:",Y)}},ue=async()=>{try{const Y=await Qo();o(Y.data)}catch(Y){console.error("Erro ao carregar marcas:",Y)}},Re=async()=>{try{const Y=await F.get("/produtos/departamentos");q(Y.data)}catch(Y){console.error("Erro ao carregar departamentos:",Y)}},se=(Y,je)=>{S(Me=>({...Me,[Y]:je}))},_e=(Y,je)=>{if(!Y){console.error("Erro: ID do produto Ã© undefined ou null");return}if(je!=null&&je.shiftKey&&d!==null){const Me=H.findIndex(X=>X.id===d),I=H.findIndex(X=>X.id===Y);if(Me!==-1&&I!==-1){const X=Math.min(Me,I),fe=Math.max(Me,I),U=H.slice(X,fe+1).map(ie=>ie.id);N(ie=>{const Ne=new Set(ie);return U.forEach(Pe=>Ne.add(Pe)),Array.from(Ne)}),x(Y);return}}N(Me=>Me.includes(Y)?Me.filter(I=>I!==Y):[...Me,Y]),x(Y)},ke=()=>{f.length===H.length?N([]):N(H.map(Y=>Y.id))},Ze=async Y=>{if(confirm("Deseja realmente excluir este produto?"))try{await yr(Y),alert("Produto excluÃ­do com sucesso!"),ee()}catch(je){console.error("Erro ao excluir produto:",je),alert("Erro ao excluir produto")}},ze=async()=>{if(confirm(`Deseja realmente excluir ${f.length} produtos?`))try{await Promise.all(f.map(Y=>yr(Y))),alert("Produtos excluÃ­dos com sucesso!"),N([]),ee()}catch(Y){console.error("Erro ao excluir produtos:",Y),alert("Erro ao excluir produtos")}},Xe=(Y,je)=>{navigator.clipboard.writeText(Y),Se.success(`${je} copiado!`)},be=(Y,je)=>{w(Y),b(je.toString())},Ee=async Y=>{try{await F.patch(`/produtos/${Y}?preco_venda=${c}`,{}),Se.success("PreÃ§o atualizado!"),w(null),ee()}catch(je){console.error("Erro ao atualizar preÃ§o:",je),Se.error("Erro ao atualizar preÃ§o")}},he=()=>{w(null)},Qe=()=>{if(f.length===0){Se.error("Selecione pelo menos um produto");return}Q({marca_id:"",categoria_id:"",departamento_id:""}),M(!0)},Ye=async()=>{try{if(Object.values(A).filter(Me=>Me!=="").length===0){Se.error("Preencha pelo menos um campo para atualizar");return}const je={};A.marca_id&&(je.marca_id=parseInt(A.marca_id)),A.categoria_id&&(je.categoria_id=parseInt(A.categoria_id)),A.departamento_id&&(je.departamento_id=parseInt(A.departamento_id)),await F.patch("/produtos/atualizar-lote",{produto_ids:f,...je}),Se.success(`${f.length} produto(s) atualizado(s) com sucesso!`),M(!1),N([]),ee()}catch(Y){console.error("Erro ao atualizar produtos:",Y),Se.error("Erro ao atualizar produtos")}},ca=Y=>{if(!Y.controlar_estoque)return"text-gray-500";const je=Y.tipo_produto==="KIT"&&Y.tipo_kit==="VIRTUAL"?Y.estoque_virtual??0:Y.estoque_atual||0,Me=Y.estoque_minimo||0;return je<=0?"text-red-600 font-semibold":je<=Me?"text-yellow-600 font-medium":"text-gray-700"},ra=Y=>{if(!Y.lotes||Y.lotes.length===0)return"-";const je=Y.lotes.filter(fe=>fe.data_validade).sort((fe,U)=>new Date(fe.data_validade)-new Date(U.data_validade));if(je.length===0)return"-";const Me=je[0].data_validade,I=Math.floor((new Date(Me)-new Date)/(1e3*60*60*24));let X="text-gray-700";return I<0?X="text-red-600 font-bold":I<=30?X="text-orange-600 font-semibold":I<=90&&(X="text-yellow-600"),e.jsx("span",{className:X,children:Nr(Me)})},pa=Y=>{i(je=>je.includes(Y)?je.filter(Me=>Me!==Y):[...je,Y])},na=Y=>{n(je=>je.includes(Y)?je.filter(Me=>Me!==Y):[...je,Y])},oe=()=>{const Y=C||gt.map(je=>je.key);K(Y),E(!0)},ye=Y=>{K(je=>je.includes(Y)?je.filter(Me=>Me!==Y):[...je,Y])},Ce=()=>{localStorage.setItem("produtos_colunas_visiveis",JSON.stringify($)),h($),E(!1),Se.success("PreferÃªncias de colunas salvas!")},Be=()=>{localStorage.removeItem("produtos_colunas_visiveis"),h(null),K(gt.map(Y=>Y.key)),Se.success("Colunas restauradas para o padrÃ£o!")},Ie=Y=>C?C.includes(Y.key):!0;return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Produtos"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie seu estoque de produtos"})]}),e.jsxs("div",{className:"flex gap-2",children:[f.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Qe,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:["âœï¸ Editar em Lote (",f.length,")"]}),e.jsxs("button",{onClick:ze,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:["Excluir Selecionados (",f.length,")"]})]}),e.jsxs("button",{onClick:()=>R(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Importar Excel"]}),e.jsxs("button",{onClick:oe,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium flex items-center gap-2",title:"Configurar colunas visÃ­veis",children:[e.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Colunas"]}),e.jsx("button",{onClick:()=>s("/produtos/novo"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"+ Novo Produto"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx("input",{type:"text",placeholder:"Buscar por cÃ³digo, nome ou cÃ³digo de barras...",value:J.busca,onChange:Y=>se("busca",Y.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),e.jsx("div",{children:e.jsxs("select",{value:J.categoria_id,onChange:Y=>se("categoria_id",Y.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas as Categorias"}),m.map(Y=>e.jsxs("option",{value:Y.id,children:[Y.categoria_pai_id?"  â””â”€ ":"",Y.nome]},Y.id))]})}),e.jsx("div",{children:e.jsxs("select",{value:J.marca_id,onChange:Y=>se("marca_id",Y.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas as Marcas"}),g.map(Y=>e.jsx("option",{value:Y.id,children:Y.nome},Y.id))]})}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:J.estoque_baixo,onChange:Y=>se("estoque_baixo",Y.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Estoque Baixo"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:J.em_promocao,onChange:Y=>se("em_promocao",Y.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Em PromoÃ§Ã£o"})]})]})]})}),!v&&ne>0&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border border-gray-200 rounded-t-lg flex items-center justify-between mt-6 mb-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",(P-1)*B+1," a ",Math.min(P*B,ne)," de ",ne," produtos"]}),e.jsxs("select",{value:B,onChange:Y=>{y(Number(Y.target.value)),G(1)},className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10 por pÃ¡gina"}),e.jsx("option",{value:20,children:"20 por pÃ¡gina"}),e.jsx("option",{value:30,children:"30 por pÃ¡gina"}),e.jsx("option",{value:50,children:"50 por pÃ¡gina"}),e.jsx("option",{value:100,children:"100 por pÃ¡gina"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>G(1),disabled:P===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Primeira"}),e.jsx("button",{onClick:()=>G(Y=>Math.max(Y-1,1)),disabled:P===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(W,5)},(Y,je)=>{let Me;return W<=5||P<=3?Me=je+1:P>=W-2?Me=W-4+je:Me=P-2+je,e.jsx("button",{onClick:()=>G(Me),className:`px-3 py-1 text-sm font-medium rounded-lg transition-colors ${P===Me?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:Me},Me)})}),e.jsx("button",{onClick:()=>G(Y=>Math.min(Y+1,W)),disabled:P===W,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"PrÃ³xima"}),e.jsx("button",{onClick:()=>G(W),disabled:P===W,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Ãšltima"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:gt.filter(Ie).map(Y=>e.jsx(ts.Fragment,{children:Y.renderHeader({produtos:H,selecionados:f,handleSelecionarTodos:ke})},Y.key))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"px-4 py-8 text-center text-gray-500",children:"Carregando produtos..."})}):H.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"px-4 py-8 text-center text-gray-500",children:"Nenhum produto encontrado"})}):H.map((Y,je)=>{if(!Y||!Y.id)return console.error(`Produto invÃ¡lido no Ã­ndice ${je}:`,Y),null;const Me=Y.tipo_produto==="KIT",I=p.includes(Y.id);return e.jsxs(ts.Fragment,{children:[e.jsx("tr",{className:`hover:bg-gray-50 transition-colors cursor-pointer ${Y.tipo_produto==="VARIACAO"?"bg-blue-50/30":""} ${Me?"bg-amber-50/30":""}`,onClick:X=>{X.target.closest("button, input, a, svg")||s(`/produtos/${Y.id}/editar`)},children:gt.filter(Ie).map(X=>e.jsx(ts.Fragment,{children:X.renderCell(Y,{selecionados:f,handleSelecionar:_e,kitsExpandidos:p,toggleKitExpandido:pa,paisExpandidos:u,togglePaiExpandido:na,copiarTexto:Xe,editandoPreco:k,novoPreco:c,setNovoPreco:b,handleSalvarPreco:Ee,handleCancelarEdicaoPreco:he,handleEditarPreco:be,getValidadeMaisProxima:ra,getCorEstoque:ca,navigate:s,handleExcluir:Ze})},X.key))}),Me&&I&&Y.composicao_kit&&Y.composicao_kit.length>0&&e.jsx("tr",{className:"bg-amber-50/50 border-l-4 border-amber-400",children:e.jsx("td",{colSpan:"10",className:"px-4 py-3",children:e.jsxs("div",{className:"ml-12",children:[e.jsxs("div",{className:"text-xs font-semibold text-amber-800 mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"COMPOSIÃ‡ÃƒO DO KIT:"]}),e.jsx("div",{className:"grid gap-1",children:Y.composicao_kit.map((X,fe)=>e.jsxs("div",{className:"flex items-center gap-3 text-xs bg-white rounded px-3 py-2 border border-amber-200",children:[e.jsxs("span",{className:"font-mono font-semibold text-amber-700 min-w-[40px]",children:[X.quantidade,"x"]}),e.jsx("span",{className:"flex-1 text-gray-700",children:X.produto_nome||X.nome||`Produto #${X.produto_id||X.produto_componente_id}`}),X.produto_estoque!==void 0&&e.jsxs("span",{className:"text-gray-500",children:["Estoque: ",e.jsx("span",{className:X.produto_estoque>0?"text-green-600 font-semibold":"text-red-600 font-semibold",children:X.produto_estoque})]})]},fe))})]})})},`kit-${Y.id}`)]},Y.id)})})]})}),!v&&ne>0&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",(P-1)*B+1," a ",Math.min(P*B,ne)," de ",ne," produtos"]}),e.jsxs("select",{value:B,onChange:Y=>{y(Number(Y.target.value)),G(1)},className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10 por pÃ¡gina"}),e.jsx("option",{value:20,children:"20 por pÃ¡gina"}),e.jsx("option",{value:30,children:"30 por pÃ¡gina"}),e.jsx("option",{value:50,children:"50 por pÃ¡gina"}),e.jsx("option",{value:100,children:"100 por pÃ¡gina"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>G(1),disabled:P===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Primeira"}),e.jsx("button",{onClick:()=>G(Y=>Math.max(Y-1,1)),disabled:P===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(W,5)},(Y,je)=>{let Me;return W<=5||P<=3?Me=je+1:P>=W-2?Me=W-4+je:Me=P-2+je,e.jsx("button",{onClick:()=>G(Me),className:`px-3 py-1 text-sm font-medium rounded-lg transition-colors ${P===Me?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:Me},Me)})}),e.jsx("button",{onClick:()=>G(Y=>Math.min(Y+1,W)),disabled:P===W,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"PrÃ³xima"}),e.jsx("button",{onClick:()=>G(W),disabled:P===W,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Ãšltima"})]})]}),!v&&f.length>0&&e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200",children:e.jsx("div",{className:"flex justify-between items-center text-sm text-gray-600",children:e.jsxs("span",{children:[f.length," produto",f.length>1?"s":""," selecionado",f.length>1?"s":""]})})})]}),te&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Editar em Lote"}),e.jsx("button",{onClick:()=>M(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Atualizar ",e.jsx("strong",{children:f.length})," produto(s) selecionado(s)"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Marca"}),e.jsxs("select",{value:A.marca_id,onChange:Y=>Q({...A,marca_id:Y.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"NÃ£o alterar"}),g.map(Y=>e.jsx("option",{value:Y.id,children:Y.nome},Y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria"}),e.jsxs("select",{value:A.categoria_id,onChange:Y=>Q({...A,categoria_id:Y.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"NÃ£o alterar"}),m.map(Y=>e.jsxs("option",{value:Y.id,children:[Y.categoria_pai_id?"  â””â”€ ":"",Y.nome]},Y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Departamento"}),e.jsxs("select",{value:A.departamento_id,onChange:Y=>Q({...A,departamento_id:Y.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"NÃ£o alterar"}),re.map(Y=>e.jsx("option",{value:Y.id,children:Y.nome},Y.id))]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>M(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:Ye,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Salvar AlteraÃ§Ãµes"})]})]})}),_&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Configurar Colunas"}),e.jsx("button",{onClick:()=>E(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"px-6 py-4 max-h-96 overflow-y-auto",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Selecione quais colunas deseja visualizar na tabela:"}),e.jsx("div",{className:"space-y-2",children:gt.map(Y=>e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:$.includes(Y.key),onChange:()=>ye(Y.key),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:Y.label||Y.key})]},Y.key))})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-between gap-3",children:[e.jsx("button",{onClick:Be,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Restaurar PadrÃ£o"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>E(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:Ce,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors",children:"Salvar"})]})]})]})}),e.jsx(Nn,{isOpen:Z,onClose:()=>R(!1),onSuccess:()=>{ee(),R(!1)}})]})}const wn=({value:s,onChange:l,pesoEmbalagem:t})=>{const[m,r]=a.useState("filhote_peso_adulto"),[g,o]=a.useState([]),[v,j]=a.useState(!1),f=a.useRef(null),[N]=a.useState([{id:"2m",label:"2 meses"},{id:"3m",label:"3 meses"},{id:"4m",label:"4 meses"},{id:"6m",label:"6 meses"},{id:"8m",label:"8 meses"},{id:"10m",label:"10 meses"},{id:"12m",label:"12 meses"},{id:"15m",label:"15 meses"},{id:"18m",label:"18 meses"},{id:"adulto",label:"Adulto"}]);a.useEffect(()=>{if(s&&!v)try{const n=typeof s=="string"?JSON.parse(s):s;if(console.log("ðŸ“¥ Carregando tabela:",n),n.tipo&&r(n.tipo),n.dados){const C=Object.entries(n.dados).map(([h,_])=>({peso:h,consumos:_}));o(C)}j(!0)}catch(n){console.error("Erro ao carregar tabela:",n),j(!0)}},[s,v]);const d=()=>{switch(m){case"filhote_peso_adulto":return"Peso Adulto Esperado";case"adulto":return"Peso Atual";default:return"Peso"}},x=()=>{switch(m){case"filhote_peso_adulto":return"Ex: 5kg, 10kg, 15kg, 20kg";case"adulto":return"Ex: 5kg, 10kg, 15kg, 20kg";default:return""}},k=()=>{const n={peso:"",consumos:{}},C=[...g,n];o(C)},w=n=>{const C=g.filter((h,_)=>_!==n);o(C),i(C)},c=(n,C)=>{const h=[...g];h[n].peso=C,o(h)},b=(n,C,h)=>{const _=[...g];_[n].consumos||(_[n].consumos={});const E=parseFloat(h)||0;_[n].consumos[C]=E,o(_)},p=n=>{if(!t||!n)return"-";const C=t*1e3;return`${Math.floor(C/n)}d`},i=a.useCallback(n=>{if(!v){console.log("â¸ï¸ Aguardando carregamento inicial...");return}const C=n||g,h={};C.forEach($=>{$.peso&&(h[$.peso]=$.consumos)});const _={tipo:m,dados:h},E=JSON.stringify(_);if(f.current===E){console.log("â­ï¸ Ignorando - jÃ¡ estÃ¡ salvo");return}console.log("ðŸ’¾ Salvando tabela:",_),f.current=E,l(E)},[g,m,l,v]),u=()=>{i(),alert("âœ… Tabela de consumo salva com sucesso!")};return e.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2 flex items-center gap-2",children:"ðŸ“Š Tabela de Consumo da Embalagem"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Preencha a tabela com as informaÃ§Ãµes da embalagem. A IA usarÃ¡ esses dados para calcular duraÃ§Ã£o e custo-benefÃ­cio."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Tabela da Embalagem:"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"filhote_peso_adulto",checked:m==="filhote_peso_adulto",onChange:n=>r(n.target.value),className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"ðŸ¶ Filhote (Peso Adulto Esperado)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"adulto",checked:m==="adulto",onChange:n=>r(n.target.value),className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"ðŸ• Adulto (Peso Atual)"})]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-semibold text-gray-700 w-32",children:d()}),N.map(n=>e.jsxs("th",{className:"border border-gray-300 px-2 py-2 text-center text-xs font-semibold text-gray-700 min-w-[90px]",children:[n.label,e.jsx("div",{className:"text-[10px] text-gray-500 font-normal",children:"g/dia | dias"})]},n.id)),e.jsx("th",{className:"border border-gray-300 px-2 py-2 text-center text-sm font-semibold text-gray-700 w-16",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{children:g.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:N.length+2,className:"border border-gray-300 px-4 py-8 text-center text-gray-500",children:[e.jsx(Na,{className:"inline-block mr-2"}),'Nenhuma linha adicionada. Clique em "Adicionar Linha" para comeÃ§ar.']})}):g.map((n,C)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 px-2 py-2",children:e.jsx("input",{type:"text",value:n.peso,onChange:h=>c(C,h.target.value),onBlur:()=>i(),placeholder:x(),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})}),N.map(h=>{var $;const _=(($=n.consumos)==null?void 0:$[h.id])||"",E=p(_);return e.jsxs("td",{className:"border border-gray-300 px-1 py-1",children:[e.jsx("input",{type:"number",value:_,onChange:K=>b(C,h.id,K.target.value),onBlur:()=>i(),placeholder:"0",className:"w-full px-2 py-1 text-sm text-center border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("div",{className:"text-[10px] text-center text-gray-500 mt-0.5",children:E})]},h.id)}),e.jsx("td",{className:"border border-gray-300 px-2 py-2 text-center",children:e.jsx("button",{type:"button",onClick:()=>w(C),className:"text-red-600 hover:text-red-800 p-1",title:"Remover linha",children:e.jsx(ps,{size:16})})})]},C))})]})}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsxs("button",{type:"button",onClick:k,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(Qa,{size:16}),"Adicionar Linha"]}),e.jsxs("button",{type:"button",onClick:u,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:[e.jsx(Is,{size:16}),"Salvar Tabela"]})]}),t&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:["ðŸ’¡ ",e.jsx("strong",{children:"Peso da embalagem:"})," ",t,"kg (",t*1e3,"g)",e.jsx("br",{}),"A duraÃ§Ã£o (dias) Ã© calculada automaticamente: ",e.jsx("code",{children:"peso_embalagem Ã· consumo_diÃ¡rio"})]})})]})},as=s=>{if(s===""||s===null||s===void 0)return 0;const t=s.toString().replace(/[^\d.,]/g,"").replace(",","."),m=parseFloat(t);return isNaN(m)?0:m};function mo(){var mt,Pt,Us,Rt,At,Ws,Dt,Mt,Lt,qt,zt,It,hs,Ss,ut;const s=fa(),{id:l}=Bs(),[t]=lr(),m=!!l,[r,g]=a.useState(1),[o,v]=a.useState({codigo:"",sku:"",nome:"",codigo_barras:"",categoria_id:"",marca_id:"",departamento_id:"",tipo:"produto",unidade:"UN",descricao:"",preco_custo:"",preco_venda:"",preco_promocional:"",data_inicio_promocao:"",data_fim_promocao:"",markup:"",tipo_produto:"SIMPLES",produto_pai_id:null,tipo_kit:null,e_kit_fisico:!1,composicao_kit:[],produto_predecessor_id:null,motivo_descontinuacao:"",controle_lote:!0,estoque_minimo:"",estoque_maximo:"",tributacao:{origem:null,herdado_da_empresa:!1,origem_mercadoria:"0",ncm:"",cest:"",cfop:"",cst_icms:"",icms_aliquota:"",icms_st:!1,pis_aliquota:"",cofins_aliquota:""},origem:"0",ncm:"",cest:"",cfop:"",aliquota_icms:"",aliquota_pis:"",aliquota_cofins:"",tem_recorrencia:!1,tipo_recorrencia:"monthly",intervalo_dias:"",numero_doses:"",observacoes_recorrencia:"",especie_compativel:"both",classificacao_racao:"",peso_embalagem:"",tabela_nutricional:"",tabela_consumo:"",categoria_racao:"",especies_indicadas:"both",linha_racao_id:"",porte_animal_id:"",fase_publico_id:"",tipo_tratamento_id:"",sabor_proteina_id:"",apresentacao_peso_id:""}),[j,f]=a.useState([]),[N,d]=a.useState([]),[x,k]=a.useState([]),[w,c]=a.useState([]),[b,p]=a.useState([]),[i,u]=a.useState([]),[n,C]=a.useState([]),[h,_]=a.useState([]),[E,$]=a.useState([]),[K,te]=a.useState([]),[M,A]=a.useState([]),[Q,re]=a.useState([]),[q,Z]=a.useState([]),[R,J]=a.useState([]),[S,P]=a.useState([]),[G,B]=a.useState({sku:"",nome:"",codigo_barras:"",preco_custo:"",preco_venda:"",estoque_minimo:0,e_kit:!1,e_kit_fisico:!1,composicao_kit:[]}),[y,O]=a.useState(!1),[z,ae]=a.useState([]),[W,ne]=a.useState(""),[H,ee]=a.useState(""),[de,ue]=a.useState(0),[Re,se]=a.useState(!1),[_e,ke]=a.useState([]),[Ze,ze]=a.useState(""),[Xe,be]=a.useState(null),[Ee,he]=a.useState(null),[Qe,Ye]=a.useState(null),[ca,ra]=a.useState(!1),[pa,na]=a.useState(!1),[oe,ye]=a.useState(!1),[Ce,Be]=a.useState(!1),[Ie,Y]=a.useState({quantidade:"",nome_lote:"",data_fabricacao:"",data_validade:"",preco_custo:""}),[je,Me]=a.useState(!1),[I,X]=a.useState({preco_custo:!1,markup:!1,preco_venda:!1,preco_promocional:!1}),[fe,U]=a.useState(null),[ie,Ne]=a.useState(!1),[Pe,L]=a.useState(null),[le,pe]=a.useState({fornecedor_id:"",codigo_fornecedor:"",preco_custo:"",prazo_entrega:"",estoque_fornecedor:"",e_principal:!1});a.useEffect(()=>{Oe(),m&&ea()},[l]),a.useEffect(()=>{if(!m&&o.nome){const D=o.nome.toLowerCase();(D.includes("racao")||D.includes("raÃ§Ã£o"))&&o.classificacao_racao!=="sim"&&v(De=>({...De,classificacao_racao:"sim"}))}},[o.nome,m,o.classificacao_racao]),a.useEffect(()=>{if(!ca&&m){const D=t.get("aba");D&&g(parseInt(D))}},[ca,t,m]),a.useEffect(()=>{m&&o.tipo_produto==="VARIACAO"&&r===8&&g(1)},[o.tipo_produto,r,m]),a.useEffect(()=>{m&&r===8&&o.tipo_produto==="PAI"&&Fe()},[r,m,o.tipo_produto]);const Fe=async()=>{try{const D=await dr(l);P(D.data)}catch(D){console.error("Erro ao carregar variaÃ§Ãµes:",D)}},Oe=async()=>{try{const[D,ge,De,Je]=await Promise.all([Go(),Qo(),ln(),F.get("/clientes/",{params:{tipo_cadastro:"fornecedor",apenas_ativos:!0}})]);f(D.data);const Ve=He(D.data);d(Ve),k(ge.data),c(De.data),_(Je.data),Ke()}catch(D){console.error("Erro ao carregar dados auxiliares:",D)}},Ke=async()=>{try{const[D,ge,De,Je,Ve,va]=await Promise.all([F.get("/opcoes-racao/linhas",{params:{apenas_ativos:!0}}),F.get("/opcoes-racao/portes",{params:{apenas_ativos:!0}}),F.get("/opcoes-racao/fases",{params:{apenas_ativos:!0}}),F.get("/opcoes-racao/tratamentos",{params:{apenas_ativos:!0}}),F.get("/opcoes-racao/sabores",{params:{apenas_ativos:!0}}),F.get("/opcoes-racao/apresentacoes",{params:{apenas_ativos:!0}})]);$(D.data),te(ge.data),A(De.data),re(Je.data),Z(Ve.data),J(va.data)}catch(D){console.error("Erro ao carregar opÃ§Ãµes de raÃ§Ã£o:",D)}},He=(D,ge=null,De=0)=>{let Je=[];return D.filter(va=>va.categoria_pai_id===ge).forEach(va=>{const Ua="Â Â Â Â ".repeat(De),Ca=De>0?"â†’ ":"";Je.push({...va,nomeFormatado:Ua+Ca+va.nome,nivel:De});const za=He(D,va.id,De+1);Je=Je.concat(za)}),Je},ea=async()=>{var D,ge,De;try{ra(!0),he(null),Ye(null);const Ve=(await io(l)).data;let va="";if(Ve.preco_custo&&Ve.preco_venda&&Ve.preco_custo>0&&(va=xo(Ve.preco_custo,Ve.preco_venda).toFixed(2)),v({...Ve,sku:Ve.codigo||"",codigo:Ve.codigo||"",nome:Ve.nome||"",codigo_barras:Ve.codigo_barras||"",categoria_id:Ve.categoria_id||"",marca_id:Ve.marca_id||"",departamento_id:Ve.departamento_id||"",unidade:Ve.unidade||"UN",descricao:Ve.descricao_curta||"",tipo:Ve.tipo||"produto",preco_custo:Ve.preco_custo||"",preco_venda:Ve.preco_venda||"",preco_promocional:Ve.preco_promocional||"",data_inicio_promocao:Ve.promocao_inicio||"",data_fim_promocao:Ve.promocao_fim||"",estoque_minimo:Ve.estoque_minimo||"",estoque_maximo:Ve.estoque_maximo||"",controle_lote:Ve.controle_lote??!0,markup:va,tipo_produto:Ve.tipo_produto||"SIMPLES",produto_pai_id:Ve.produto_pai_id||null,tipo_kit:Ve.tipo_kit||null,e_kit_fisico:Ve.e_kit_fisico||!1,composicao_kit:Ve.composicao_kit||[],origem:Ve.origem||"0",ncm:Ve.ncm||"",cest:Ve.cest||"",cfop:Ve.cfop||"",aliquota_icms:Ve.aliquota_icms||"",aliquota_pis:Ve.aliquota_pis||"",aliquota_cofins:Ve.aliquota_cofins||"",tem_recorrencia:Ve.tem_recorrencia||!1,tipo_recorrencia:Ve.tipo_recorrencia||"monthly",intervalo_dias:Ve.intervalo_dias||"",numero_doses:Ve.numero_doses||"",especie_compativel:Ve.especie_compativel||"both",observacoes_recorrencia:Ve.observacoes_recorrencia||"",classificacao_racao:Ve.classificacao_racao||"",peso_embalagem:Ve.peso_embalagem||"",tabela_nutricional:Ve.tabela_nutricional||"",tabela_consumo:Ve.tabela_consumo||"",categoria_racao:Ve.categoria_racao||"",especies_indicadas:Ve.especies_indicadas||"both",linha_racao_id:Ve.linha_racao_id||"",porte_animal_id:Ve.porte_animal_id||"",fase_publico_id:Ve.fase_publico_id||"",tipo_tratamento_id:Ve.tipo_tratamento_id||"",sabor_proteina_id:Ve.sabor_proteina_id||"",apresentacao_peso_id:Ve.apresentacao_peso_id||""}),Ve.produto_predecessor_id)try{const Ca=await io(Ve.produto_predecessor_id);he({id:Ca.data.id,codigo:Ca.data.codigo,nome:Ca.data.nome,motivo_descontinuacao:Ve.motivo_descontinuacao,data_descontinuacao:(D=Ve.predecessor)==null?void 0:D.data_descontinuacao})}catch(Ca){console.error("Erro ao carregar predecessor:",Ca)}if(Ve.data_descontinuacao)try{const Ca=await F.get("/produtos/",{params:{produto_predecessor_id:Ve.id,ativo:null}}),za=Array.isArray(Ca.data)?Ca.data:Ca.data.items||[];if(za&&za.length>0){const bs=za[0];Ye({id:bs.id,codigo:bs.codigo,nome:bs.nome,motivo_descontinuacao:Ve.motivo_descontinuacao,data_descontinuacao:Ve.data_descontinuacao})}}catch(Ca){console.error("âŒ Erro ao carregar sucessor:",Ca)}try{const Ca=await F.get(`/produtos/${l}/imagens`);u(Ca.data||[])}catch(Ca){console.error("Erro ao carregar imagens:",Ca),u([])}if(Ve.controle_lote){const Ca=await Wt(l);p(Ca.data)}const Ua=await cr(l);C(Ua.data),await oa(Ve)}catch(Je){console.error("âŒ Erro ao carregar produto:",Je),alert("Erro ao carregar produto: "+(((De=(ge=Je.response)==null?void 0:ge.data)==null?void 0:De.detail)||Je.message))}finally{ra(!1)}},oa=async D=>{try{const ge=D.tipo_produto==="KIT",{data:De}=ge?await F.get(`/produtos/${D.id}/kit/fiscal`):await F.get(`/produtos/${D.id}/fiscal`);v(Je=>({...Je,tributacao:{origem:De.origem,herdado_da_empresa:De.herdado_da_empresa,origem_mercadoria:De.origem_mercadoria??"0",ncm:De.ncm??"",cest:De.cest??"",cfop:De.cfop??"",cst_icms:De.cst_icms??"",icms_aliquota:De.icms_aliquota??"",icms_st:De.icms_st??!1,pis_aliquota:De.pis_aliquota??"",cofins_aliquota:De.cofins_aliquota??""}}))}catch(ge){console.error("Erro ao carregar fiscal:",ge)}},ia=async D=>{const ge={origem_mercadoria:o.tributacao.origem_mercadoria,ncm:o.tributacao.ncm,cest:o.tributacao.cest,cfop:o.tributacao.cfop,cst_icms:o.tributacao.cst_icms,icms_aliquota:o.tributacao.icms_aliquota,icms_st:o.tributacao.icms_st,pis_aliquota:o.tributacao.pis_aliquota,cofins_aliquota:o.tributacao.cofins_aliquota};D.tipo_produto==="KIT"?await F.put(`/produtos/${D.id}/kit/fiscal`,ge):await F.put(`/produtos/${D.id}/fiscal`,ge)},Ue=(D,ge)=>{v(De=>{const Je={...De,[D]:ge};if(D==="preco_custo"||D==="preco_venda"){const Ve=as(D==="preco_custo"?ge:De.preco_custo),va=as(D==="preco_venda"?ge:De.preco_venda);if(Ve&&va&&Ve>0){const Ua=xo(Ve,va);Je.markup=Ua.toFixed(2)}}if(D==="markup"){const Ve=as(De.preco_custo),va=as(ge);if(Ve&&Ve>0&&va>=0){const Ua=yn(Ve,va);Je.preco_venda=Ua.toFixed(2)}}return Je})},wa=async()=>{try{const D=await cn("PROD");v(ge=>({...ge,sku:D.data.sku})),alert("SKU gerado com sucesso!")}catch(D){console.error("Erro ao gerar SKU:",D),alert("Erro ao gerar SKU")}},V=async()=>{if(!o.sku){alert("Gere ou informe um SKU primeiro!");return}try{const D=await xn(o.sku);v(ge=>({...ge,codigo_barras:D.data.codigo_barras})),alert("CÃ³digo de barras gerado com sucesso!")}catch(D){console.error("Erro ao gerar cÃƒÂ³digo de barras:",D),alert("Erro ao gerar cÃƒÂ³digo de barras")}},$e=async()=>{var D,ge;if(!Ie.quantidade||!Ie.preco_custo){alert("Preencha quantidade e preÃƒÂ§o de custo!");return}try{const De=Ie.nome_lote||`LOTE-${Date.now()}`,Je=Ie.data_fabricacao?new Date(Ie.data_fabricacao+"T00:00:00").toISOString():null,Ve=Ie.data_validade?new Date(Ie.data_validade+"T23:59:59").toISOString():null;await mn(l,{nome_lote:De,quantidade:parseFloat(Ie.quantidade),preco_custo:parseFloat(Ie.preco_custo),data_fabricacao:Je,data_validade:Ve,observacoes:Ie.observacoes||null}),alert("Entrada de estoque realizada com sucesso!"),Be(!1),Y({quantidade:"",nome_lote:"",data_fabricacao:"",data_validade:"",preco_custo:""});const va=await Wt(l);p(va.data)}catch(De){console.error("Erro ao registrar entrada:",De),alert(((ge=(D=De.response)==null?void 0:D.data)==null?void 0:ge.detail)||"Erro ao registrar entrada de estoque")}},Te=D=>{var ge,De;U({id:D.id,nome_lote:D.nome_lote,quantidade_inicial:D.quantidade_inicial,data_fabricacao:((ge=D.data_fabricacao)==null?void 0:ge.split("T")[0])||"",data_validade:((De=D.data_validade)==null?void 0:De.split("T")[0])||"",custo_unitario:D.custo_unitario}),Me(!0)},We=async()=>{var D,ge;try{const De=fe.data_fabricacao?new Date(fe.data_fabricacao+"T00:00:00").toISOString():null,Je=fe.data_validade?new Date(fe.data_validade+"T23:59:59").toISOString():null,Ve={nome_lote:fe.nome_lote,quantidade_inicial:parseFloat(fe.quantidade_inicial),data_fabricacao:De,data_validade:Je,custo_unitario:parseFloat(fe.custo_unitario)};await un(l,fe.id,Ve),alert("Lote atualizado com sucesso!"),Me(!1),U(null);const va=await Wt(l);p(va.data)}catch(De){console.error("Erro ao atualizar lote:",De),alert(((ge=(D=De.response)==null?void 0:D.data)==null?void 0:ge.detail)||"Erro ao atualizar lote")}},ua=async D=>{var ge,De;if(window.confirm(`Deseja realmente excluir o lote ${D.nome_lote}?

Quantidade: ${D.quantidade_disponivel} unidades
Isso removerÃ¡ o registro de entrada do estoque.`))try{await pn(l,D.id),alert("Lote excluÃ­do com sucesso!");const Je=await Wt(l);p(Je.data)}catch(Je){console.error("Erro ao excluir lote:",Je),alert(((De=(ge=Je.response)==null?void 0:ge.data)==null?void 0:De.detail)||"Erro ao excluir lote")}},xe=async D=>{var Ve,va,Ua,Ca;const ge=Array.from(D.target.files);if(ge.length===0)return;const De=["image/jpeg","image/png","image/webp"],Je=5*1024*1024;for(const za of ge){if(!De.includes(za.type)){alert(`${za.name}: Apenas JPG, PNG e WebP sÃ£o permitidos`);return}if(za.size>Je){alert(`${za.name}: Imagem deve ter no mÃ¡ximo 5MB`);return}}try{ye(!0);const za=[];for(const es of ge){const Tt=new FormData;Tt.append("file",es);try{const Ks=await gn(l,Tt);za.push(Ks.data)}catch(Ks){console.error(`Erro ao enviar ${es.name}:`,Ks),alert(`Erro ao enviar ${es.name}: ${((va=(Ve=Ks.response)==null?void 0:Ve.data)==null?void 0:va.detail)||"Erro desconhecido"}`)}}const bs=await F.get(`/produtos/${l}/imagens`);u(bs.data||[]),alert(`${za.length} imagem(ns) enviada(s) com sucesso!`)}catch(za){console.error("Erro ao enviar imagens:",za),alert(((Ca=(Ua=za.response)==null?void 0:Ua.data)==null?void 0:Ca.detail)||"Erro ao enviar imagens")}finally{ye(!1),D.target.value=""}},Ae=async D=>{if(confirm("Deseja realmente excluir esta imagem?"))try{await hn(D);const ge=await F.get(`/produtos/${l}/imagens`);u(ge.data||[]),alert("Imagem excluÃ­da com sucesso!")}catch(ge){console.error("Erro ao excluir imagem:",ge),alert("Erro ao excluir imagem")}},qe=async D=>{try{await F.put(`/produtos/imagens/${D}`,{principal:!0});const ge=await F.get(`/produtos/${l}/imagens`);u(ge.data||[]),alert("Imagem principal atualizada!")}catch(ge){console.error("Erro ao definir imagem principal:",ge),alert("Erro ao definir imagem principal")}},sa=()=>{L(null),pe({fornecedor_id:"",codigo_fornecedor:"",preco_custo:"",prazo_entrega:"",estoque_fornecedor:"",e_principal:!1}),Ne(!0)},qa=D=>{L(D),pe({fornecedor_id:D.fornecedor_id,codigo_fornecedor:D.codigo_fornecedor||"",preco_custo:D.preco_custo||"",prazo_entrega:D.prazo_entrega||"",estoque_fornecedor:D.estoque_fornecedor||"",e_principal:D.e_principal||!1}),Ne(!0)},ja=async()=>{var D,ge;if(!le.fornecedor_id){alert("Selecione um fornecedor");return}try{const De={...le,preco_custo:le.preco_custo?parseFloat(le.preco_custo):null,prazo_entrega:le.prazo_entrega?parseInt(le.prazo_entrega):null,estoque_fornecedor:le.estoque_fornecedor?parseFloat(le.estoque_fornecedor):null};Pe?(await fn(Pe.id,De),alert("Fornecedor atualizado!")):(await bn(l,De),alert("Fornecedor vinculado!"));const Je=await cr(l);C(Je.data),Ne(!1)}catch(De){console.error("Erro ao salvar fornecedor:",De),alert(((ge=(D=De.response)==null?void 0:D.data)==null?void 0:ge.detail)||"Erro ao salvar fornecedor")}},Sa=async D=>{if(confirm("Deseja realmente desvincular este fornecedor?"))try{await jn(D);const ge=await cr(l);C(ge.data),alert("Fornecedor desvinculado!")}catch(ge){console.error("Erro ao desvincular fornecedor:",ge),alert("Erro ao desvincular fornecedor")}},ya=async()=>{try{const D=await F.get("/produtos/",{params:{apenas_ativos:!0,tipo_produto:"SIMPLES"}});ae(D.data.items||[])}catch(D){console.error("Erro ao carregar produtos:",D),ae([])}},Ja=()=>{if(!W||!H||H<=0){alert("Selecione um produto e informe a quantidade!");return}if(o.composicao_kit.find(Je=>Je.produto_id===parseInt(W))){alert("Este produto jÃ¡ foi adicionado ao kit!");return}const ge=z.find(Je=>Je.id===parseInt(W)),De={produto_componente_id:ge.id,produto_id:ge.id,produto_nome:ge.nome,produto_sku:ge.codigo,quantidade:parseFloat(H),estoque_componente:ge.estoque_atual||0};v(Je=>({...Je,composicao_kit:[...Je.composicao_kit,De]})),ne(""),ee(""),xt([...o.composicao_kit,De])},$t=D=>{const ge=o.composicao_kit.filter(De=>De.produto_id!==D);v(De=>({...De,composicao_kit:ge})),xt(ge)},xt=D=>{if(!D||D.length===0){ue(0);return}const ge=D.map(Je=>{const Ve=Je.estoque_componente||0,va=Je.quantidade||1;return Math.floor(Ve/va)}),De=Math.min(...ge);ue(De>=0?De:0)};a.useEffect(()=>{const D=o.tipo_produto==="KIT"||o.tipo_produto==="VARIACAO"&&o.tipo_kit;r===9&&D&&(ya(),o.composicao_kit&&o.composicao_kit.length>0&&xt(o.composicao_kit))},[r,o.tipo_produto,o.tipo_kit]);const ks=async D=>{var ge,De;if(D.preventDefault(),!o.nome){alert("Preencha o campo Nome");return}if(o.tipo_produto!=="PAI"&&!o.preco_venda){alert("Preencha o PreÃ§o de Venda");return}if(!o.codigo&&!o.sku){alert("Preencha o campo SKU/CÃ³digo");return}try{na(!0);const Je={codigo:o.codigo||o.sku,nome:o.nome,descricao_curta:o.descricao||null,codigo_barras:o.codigo_barras||null,unidade:o.unidade||"UN",preco_custo:o.preco_custo?parseFloat(o.preco_custo):0,preco_venda:parseFloat(o.preco_venda),preco_promocional:o.preco_promocional?parseFloat(o.preco_promocional):null,promocao_inicio:o.data_inicio_promocao||null,promocao_fim:o.data_fim_promocao||null,controle_lote:o.controle_lote||!1,estoque_minimo:o.estoque_minimo?parseInt(o.estoque_minimo):0,estoque_maximo:o.estoque_maximo?parseInt(o.estoque_maximo):null,categoria_id:o.categoria_id?parseInt(o.categoria_id):null,marca_id:o.marca_id?parseInt(o.marca_id):null,departamento_id:o.departamento_id?parseInt(o.departamento_id):null,tipo_produto:o.tipo_produto||"SIMPLES",produto_pai_id:o.produto_pai_id||null,tipo_kit:o.tipo_produto==="KIT"||o.tipo_produto==="VARIACAO"&&o.tipo_kit?o.e_kit_fisico?"FISICO":"VIRTUAL":null,e_kit_fisico:o.tipo_produto==="KIT"||o.tipo_produto==="VARIACAO"&&o.tipo_kit?o.e_kit_fisico:null,composicao_kit:o.tipo_produto==="KIT"||o.tipo_produto==="VARIACAO"&&o.tipo_kit?o.composicao_kit:null,produto_predecessor_id:o.produto_predecessor_id||null,motivo_descontinuacao:o.motivo_descontinuacao||null,tem_recorrencia:o.tem_recorrencia||!1,tipo_recorrencia:o.tem_recorrencia?o.tipo_recorrencia:null,intervalo_dias:o.tem_recorrencia&&o.intervalo_dias?parseInt(o.intervalo_dias):null,numero_doses:o.tem_recorrencia&&o.numero_doses?parseInt(o.numero_doses):null,especie_compativel:o.tem_recorrencia?o.especie_compativel:null,observacoes_recorrencia:o.tem_recorrencia?o.observacoes_recorrencia:null,classificacao_racao:o.classificacao_racao||null,peso_embalagem:o.peso_embalagem?parseFloat(o.peso_embalagem):null,tabela_nutricional:o.tabela_nutricional||null,tabela_consumo:o.tabela_consumo||null,categoria_racao:o.categoria_racao||null,especies_indicadas:o.especies_indicadas||null,linha_racao_id:o.linha_racao_id?parseInt(o.linha_racao_id):null,porte_animal_id:o.porte_animal_id?parseInt(o.porte_animal_id):null,fase_publico_id:o.fase_publico_id?parseInt(o.fase_publico_id):null,tipo_tratamento_id:o.tipo_tratamento_id?parseInt(o.tipo_tratamento_id):null,sabor_proteina_id:o.sabor_proteina_id?parseInt(o.sabor_proteina_id):null,apresentacao_peso_id:o.apresentacao_peso_id?parseInt(o.apresentacao_peso_id):null};if(console.log("Ã°Å¸â€œÂ¤ Enviando dados para API:",Je),m)await ia({id:l,tipo_produto:o.tipo_produto}),await dn(l,Je),alert("Produto atualizado com sucesso!"),s("/produtos");else{const va=(await co(Je)).data.id;o.tipo_produto==="PAI"?(alert("Produto PAI criado com sucesso! Agora cadastre as variaÃ§Ãµes."),s(`/produtos/${va}/editar?aba=variacoes`)):(alert("Produto cadastrado com sucesso!"),s("/produtos"))}}catch(Je){console.error("Erro ao salvar produto:",Je),alert(((De=(ge=Je.response)==null?void 0:ge.data)==null?void 0:De.detail)||"Erro ao salvar produto")}finally{na(!1)}};return ca?e.jsx("div",{className:"p-6 flex justify-center items-center h-96",children:e.jsx("div",{className:"text-gray-600",children:"Carregando produto..."})}):m&&!o.nome?e.jsx("div",{className:"p-6 flex justify-center items-center h-96",children:e.jsx("div",{className:"text-gray-600",children:"Carregando dados..."})}):e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>{o.tipo_produto==="VARIACAO"&&o.produto_pai_id?s(`/produtos/${o.produto_pai_id}/editar?aba=8`):s("/produtos")},className:"text-blue-600 hover:text-blue-800 mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Voltar"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:m?"Editar Produto":"Novo Produto"}),m&&o.codigo&&e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"SKU:"}),e.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-800 rounded-lg font-mono",children:o.codigo})]}),o.nome&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"DescriÃ§Ã£o:"}),e.jsx("span",{className:"text-gray-600",children:o.nome})]})]})]}),e.jsxs("a",{href:"/cadastros/categorias",target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 border border-blue-200 flex items-center gap-2 text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Gerenciar Categorias"]})]})}),e.jsx("div",{className:"mb-6 border-b border-gray-200",children:e.jsx("nav",{className:"flex gap-8",children:[{id:1,label:"CaracterÃ­sticas"},{id:2,label:"Imagens"},{id:3,label:"Estoque/Lotes"},{id:4,label:"Fornecedores"},{id:5,label:"TributaÃ§Ã£o"},{id:6,label:"ðŸ”„ RecorrÃªncia"},{id:7,label:"ðŸ¥« RaÃ§Ã£o"},...o.tipo_produto==="PAI"?[{id:8,label:"ðŸ“¦ VariaÃ§Ãµes"}]:[],...o.tipo_produto==="KIT"||o.tipo_produto==="VARIACAO"&&o.tipo_kit?[{id:9,label:"ðŸ§© ComposiÃ§Ã£o"}]:[]].map(D=>e.jsx("button",{onClick:()=>g(D.id),className:`pb-4 px-1 border-b-2 font-medium text-sm transition-colors ${r===D.id?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:D.label},D.id))})}),m&&Ee&&e.jsx("div",{className:"mb-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 p-5 rounded-lg shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"w-7 h-7 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ðŸ”— Este produto Ã© continuaÃ§Ã£o de outro"})}),e.jsxs("p",{className:"text-sm text-gray-700 mb-3",children:["Este produto substitui:"," ",e.jsxs("button",{type:"button",onClick:()=>s(`/produtos/${Ee.id}/editar`),className:"font-bold text-blue-700 hover:text-blue-900 hover:underline",children:[Ee.codigo," - ",Ee.nome]})]}),Ee.motivo_descontinuacao&&e.jsxs("div",{className:"bg-white/70 rounded-md px-3 py-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Motivo da substituiÃ§Ã£o:"})," ",e.jsx("span",{className:"text-gray-900",children:Ee.motivo_descontinuacao})]})]})]})}),m&&Qe&&e.jsx("div",{className:"mb-6 bg-gradient-to-r from-red-50 to-orange-50 border-l-4 border-red-500 p-5 rounded-lg shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"w-7 h-7 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"âš ï¸ Este produto foi descontinuado"})}),e.jsxs("p",{className:"text-sm text-gray-700 mb-3",children:["Descontinuado em"," ",e.jsx("span",{className:"font-semibold",children:new Date(Qe.data_descontinuacao).toLocaleDateString("pt-BR")})]}),e.jsxs("p",{className:"text-sm text-gray-700 mb-3",children:["SubstituÃ­do por:"," ",e.jsxs("button",{type:"button",onClick:()=>s(`/produtos/${Qe.id}/editar`),className:"font-bold text-red-700 hover:text-red-900 hover:underline",children:[Qe.codigo," - ",Qe.nome]})]}),Qe.motivo_descontinuacao&&e.jsxs("div",{className:"bg-white/70 rounded-md px-3 py-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Motivo:"})," ",e.jsx("span",{className:"text-gray-900",children:Qe.motivo_descontinuacao})]})]})]})}),e.jsxs("form",{onSubmit:ks,children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[r===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o.sku,onChange:D=>Ue("sku",D.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: PROD0001"}),e.jsx("button",{type:"button",onClick:wa,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm",children:"Gerar"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CÃ³digo de Barras"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o.codigo_barras,onChange:D=>Ue("codigo_barras",D.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"EAN-13"}),e.jsx("button",{type:"button",onClick:V,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm",children:"Gerar"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Produto *"}),e.jsx("input",{type:"text",value:o.nome,onChange:D=>Ue("nome",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: RaÃ§Ã£o Golden para CÃ£es Adultos 15kg",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria"}),e.jsxs("select",{value:o.categoria_id,onChange:D=>Ue("categoria_id",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),N.map(D=>e.jsx("option",{value:D.id,children:D.nomeFormatado},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Marca"}),e.jsxs("select",{value:o.marca_id,onChange:D=>Ue("marca_id",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),x.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Departamento"}),e.jsxs("select",{value:o.departamento_id,onChange:D=>Ue("departamento_id",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),w.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:o.tipo,onChange:D=>Ue("tipo",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"produto",children:"Produto"}),e.jsx("option",{value:"servico",children:"ServiÃ§o"}),e.jsx("option",{value:"ambos",children:"Produto e ServiÃ§o"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unidade"}),e.jsxs("select",{value:o.unidade,onChange:D=>Ue("unidade",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"UN",children:"UN - Unidade"}),e.jsx("option",{value:"KG",children:"KG - Quilograma"}),e.jsx("option",{value:"G",children:"G - Grama"}),e.jsx("option",{value:"L",children:"L - Litro"}),e.jsx("option",{value:"ML",children:"ML - Mililitro"}),e.jsx("option",{value:"M",children:"M - Metro"}),e.jsx("option",{value:"CX",children:"CX - Caixa"}),e.jsx("option",{value:"PCT",children:"PCT - Pacote"})]})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:o.descricao,onChange:D=>Ue("descricao",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"2",placeholder:"DescriÃ§Ã£o detalhada do produto..."})]})]}),o.tipo_produto!=="PAI"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PreÃ§o de Custo"}),e.jsx("input",{type:"text",value:I.preco_custo?o.preco_custo||"":o.preco_custo?`R$ ${as(o.preco_custo).toFixed(2).replace(".",",")}`:"R$ 0,00",onChange:D=>{const ge=D.target.value.replace(/[^\d.,]/g,"").replace(",",".");Ue("preco_custo",ge)},onFocus:D=>{X(ge=>({...ge,preco_custo:!0})),D.target.select()},onBlur:D=>{X(De=>({...De,preco_custo:!1}));const ge=as(D.target.value);Ue("preco_custo",ge>0?ge.toFixed(2):"")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"R$ 0,00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Markup"}),e.jsx("input",{type:"text",value:I.markup?o.markup||"":o.markup?`${as(o.markup).toFixed(2).replace(".",",")}%`:"0,00%",onChange:D=>{const ge=D.target.value.replace(/[^\d.,]/g,"").replace(",",".");Ue("markup",ge)},onFocus:D=>{X(ge=>({...ge,markup:!0})),D.target.select()},onBlur:D=>{X(De=>({...De,markup:!1}));const ge=as(D.target.value);Ue("markup",ge>=0?ge.toFixed(2):"")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0,00%"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PreÃ§o de Venda *"}),e.jsx("input",{type:"text",value:I.preco_venda?o.preco_venda||"":o.preco_venda?`R$ ${as(o.preco_venda).toFixed(2).replace(".",",")}`:"R$ 0,00",onChange:D=>{const ge=D.target.value.replace(/[^\d.,]/g,"").replace(",",".");Ue("preco_venda",ge)},onFocus:D=>{X(ge=>({...ge,preco_venda:!0})),D.target.select()},onBlur:D=>{X(De=>({...De,preco_venda:!1}));const ge=as(D.target.value);Ue("preco_venda",ge>0?ge.toFixed(2):"")},required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"R$ 0,00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PreÃ§o Promocional"}),e.jsx("input",{type:"text",value:I.preco_promocional?o.preco_promocional||"":o.preco_promocional?`R$ ${as(o.preco_promocional).toFixed(2).replace(".",",")}`:"R$ 0,00",onChange:D=>{const ge=D.target.value.replace(/[^\d.,]/g,"").replace(",",".");Ue("preco_promocional",ge)},onFocus:D=>{X(ge=>({...ge,preco_promocional:!0})),D.target.select()},onBlur:D=>{X(De=>({...De,preco_promocional:!1}));const ge=as(D.target.value);Ue("preco_promocional",ge>0?ge.toFixed(2):"")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"R$ 0,00"})]})]}),o.preco_promocional&&o.tipo_produto!=="PAI"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"InÃ­cio da PromoÃ§Ã£o"}),e.jsx("input",{type:"date",value:o.data_inicio_promocao,onChange:D=>Ue("data_inicio_promocao",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fim da PromoÃ§Ã£o"}),e.jsx("input",{type:"date",value:o.data_fim_promocao,onChange:D=>Ue("data_fim_promocao",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),!m&&e.jsx("div",{className:"border-t pt-6 mt-6",children:e.jsxs("div",{className:"p-6 bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg border border-amber-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"EvoluÃ§Ã£o do Produto"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Re,onChange:D=>{se(D.target.checked),D.target.checked||(be(null),Ue("produto_predecessor_id",null),Ue("motivo_descontinuacao",""))},className:"h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Este produto substitui outro"})]})]}),Re&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-white rounded-lg border-2 border-amber-300",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ðŸ” Buscar Produto Anterior"}),e.jsx("input",{type:"text",placeholder:"Digite o nome ou cÃ³digo do produto...",value:Ze,onChange:async D=>{if(ze(D.target.value),D.target.value.length>=2)try{const ge=await F.get("/produtos/",{params:{busca:D.target.value,page_size:10}});ke(ge.data.items||[])}catch(ge){console.error("Erro ao buscar produtos:",ge)}else ke([])},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),_e.length>0&&e.jsx("div",{className:"mt-2 max-h-48 overflow-y-auto border border-gray-300 rounded-lg",children:_e.map(D=>{var ge;return e.jsxs("div",{onClick:()=>{be(D),Ue("produto_predecessor_id",D.id),ze(""),ke([])},className:"p-3 hover:bg-amber-50 cursor-pointer border-b border-gray-200 last:border-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:D.nome}),e.jsxs("div",{className:"text-sm text-gray-600",children:["SKU: ",D.codigo," | PreÃ§o: R$ ",(ge=D.preco_venda)==null?void 0:ge.toFixed(2)]})]},D.id)})}),Xe&&e.jsx("div",{className:"mt-3 p-3 bg-green-50 border border-green-300 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-green-800",children:"âœ… Produto Selecionado:"}),e.jsx("div",{className:"font-semibold text-gray-900 mt-1",children:Xe.nome}),e.jsxs("div",{className:"text-sm text-gray-600",children:["SKU: ",Xe.codigo]})]}),e.jsx("button",{type:"button",onClick:()=>{be(null),Ue("produto_predecessor_id",null)},className:"text-red-600 hover:text-red-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]}),Xe&&e.jsxs("div",{className:"p-4 bg-white rounded-lg border-2 border-amber-300",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ðŸ“ Motivo da SubstituiÃ§Ã£o"}),e.jsxs("select",{value:o.motivo_descontinuacao,onChange:D=>Ue("motivo_descontinuacao",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent mb-2",children:[e.jsx("option",{value:"",children:"Selecione o motivo..."}),e.jsx("option",{value:"MudanÃ§a de embalagem",children:"MudanÃ§a de embalagem"}),e.jsx("option",{value:"MudanÃ§a de peso/gramatura",children:"MudanÃ§a de peso/gramatura"}),e.jsx("option",{value:"ReformulaÃ§Ã£o do produto",children:"ReformulaÃ§Ã£o do produto"}),e.jsx("option",{value:"MudanÃ§a de fornecedor",children:"MudanÃ§a de fornecedor"}),e.jsx("option",{value:"Upgrade de linha",children:"Upgrade de linha"}),e.jsx("option",{value:"Outro",children:"Outro (descrever abaixo)"})]}),o.motivo_descontinuacao==="Outro"&&e.jsx("textarea",{value:o.motivo_descontinuacao,onChange:D=>Ue("motivo_descontinuacao",D.target.value),placeholder:"Descreva o motivo...",rows:"2",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800",children:[e.jsx("strong",{children:"â„¹ï¸ O que acontecerÃ¡:"}),e.jsxs("ul",{className:"mt-2 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:['O produto "',e.jsx("strong",{children:Xe.nome}),'" serÃ¡ marcado como ',e.jsx("strong",{children:"descontinuado"})]}),e.jsx("li",{children:"Todo o histÃ³rico de vendas serÃ¡ mantido e poderÃ¡ ser consultado"}),e.jsx("li",{children:"VocÃª poderÃ¡ gerar relatÃ³rios consolidados somando ambos os produtos"})]})]})]})]}),!Re&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Marque esta opÃ§Ã£o se este produto substitui outro jÃ¡ cadastrado (ex: mudanÃ§a de embalagem de 350g para 300g). Isso permite manter o histÃ³rico consolidado de vendas."})]})}),!m&&e.jsx("div",{className:"border-t pt-6",children:e.jsxs("div",{className:"p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),"Tipo do Produto"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Escolha o tipo de produto que estÃ¡ cadastrando:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-white rounded-lg border-2 hover:border-blue-400 transition-colors",style:{borderColor:o.tipo_produto==="SIMPLES"?"#3b82f6":"#e5e7eb"},children:[e.jsx("input",{type:"radio",id:"tipo_simples",name:"tipo_produto",value:"SIMPLES",checked:o.tipo_produto==="SIMPLES",onChange:D=>{Ue("tipo_produto","SIMPLES"),v(ge=>({...ge,composicao_kit:[],e_kit_fisico:!1}))},className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"tipo_simples",className:"font-medium text-gray-900 cursor-pointer",children:"âœ… Produto Simples"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Produto Ãºnico, vendÃ¡vel, com controle de estoque prÃ³prio."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-white rounded-lg border-2 hover:border-blue-400 transition-colors",style:{borderColor:o.tipo_produto==="PAI"?"#3b82f6":"#e5e7eb"},children:[e.jsx("input",{type:"radio",id:"tipo_variacoes",name:"tipo_produto",value:"PAI",checked:o.tipo_produto==="PAI",onChange:D=>{Ue("tipo_produto","PAI"),v(ge=>({...ge,preco_custo:"",preco_venda:"",preco_promocional:"",composicao_kit:[],e_kit_fisico:!1}))},className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"tipo_variacoes",className:"font-medium text-gray-900 cursor-pointer",children:"ðŸ“¦ Produto com VariaÃ§Ãµes"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Produto agrupador (nÃ£o vendÃ¡vel). TerÃ¡ variaÃ§Ãµes com SKU, preÃ§o e estoque prÃ³prios.",e.jsx("br",{}),e.jsx("span",{className:"text-xs italic",children:"Exemplo: Camiseta (produto pai) â†’ P, M, G (variaÃ§Ãµes)"})]}),o.tipo_produto==="PAI"&&!m&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:["âš ï¸ ",e.jsx("strong",{children:"Salve o produto primeiro"}),' para depois cadastrar as variaÃ§Ãµes na aba "VariaÃ§Ãµes".']}),o.tipo_produto==="PAI"&&m&&e.jsx("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded text-sm text-green-800",children:'âœ… Produto salvo! VÃ¡ para a aba "ðŸ“¦ VariaÃ§Ãµes" para cadastrar as variaÃ§Ãµes.'})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-white rounded-lg border-2 hover:border-blue-400 transition-colors",style:{borderColor:o.tipo_produto==="KIT"?"#3b82f6":"#e5e7eb"},children:[e.jsx("input",{type:"radio",id:"tipo_kit",name:"tipo_produto",value:"KIT",checked:o.tipo_produto==="KIT",onChange:D=>{Ue("tipo_produto","KIT"),g(9)},className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"tipo_kit",className:"font-medium text-gray-900 cursor-pointer",children:"ðŸ§© Produto com ComposiÃ§Ã£o (Kit)"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Kit composto por outros produtos existentes.",e.jsx("br",{}),e.jsx("span",{className:"text-xs italic",children:"Exemplo: Kit Banho (shampoo + condicionador + toalha)"})]}),o.tipo_produto==="KIT"&&e.jsxs("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded text-sm text-green-800",children:["âœ… ",e.jsx("strong",{children:'Aba "ðŸ§© ComposiÃ§Ã£o" aberta!'})," VÃ¡ para a aba ComposiÃ§Ã£o para definir se o kit terÃ¡ estoque virtual ou fÃ­sico e adicionar os produtos que o compÃµem."]})]})]})]})]})}),m&&o.tipo_produto==="VARIACAO"&&e.jsx("div",{className:"border-t pt-6",children:e.jsxs("div",{className:"p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),"ComposiÃ§Ã£o (Kit)"]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-white rounded-lg border-2 border-gray-300",children:[e.jsx("input",{type:"checkbox",id:"variacao_e_kit",checked:!!o.tipo_kit,onChange:D=>{D.target.checked?(Ue("tipo_kit","VIRTUAL"),Ue("e_kit_fisico",!1),g(9)):(Ue("tipo_kit",null),Ue("composicao_kit",[]),Ue("e_kit_fisico",!1))},className:"mt-1 h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"variacao_e_kit",className:"font-medium text-gray-900 cursor-pointer text-lg",children:"ðŸ§© Esta variaÃ§Ã£o Ã© um KIT (possui composiÃ§Ã£o)"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Marque esta opÃ§Ã£o se esta variaÃ§Ã£o Ã© composta por outros produtos.",e.jsx("br",{}),e.jsx("span",{className:"text-xs italic",children:"Exemplo: Camiseta P - Kit (camiseta + brinde)"})]}),o.tipo_kit&&e.jsxs("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded text-sm text-green-800",children:["âœ… ",e.jsx("strong",{children:"VariaÃ§Ã£o configurada como KIT!"}),' VÃ¡ para a aba "ðŸ§© ComposiÃ§Ã£o" para definir os produtos que compÃµem este kit.']})]})]})]})})]}),r===2&&e.jsx("div",{className:"space-y-6",children:m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Imagens do Produto"}),e.jsxs("label",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer",children:[oe?"Enviando...":"+ Adicionar Imagens",e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/webp",onChange:xe,disabled:oe,className:"hidden",multiple:!0})]})]}),i.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"ðŸ“· Nenhuma imagem cadastrada"}),e.jsx("p",{className:"text-sm",children:'Clique em "Adicionar Imagem" para enviar fotos do produto'})]}):e.jsx("div",{className:"grid grid-cols-4 gap-4",children:i.map(D=>e.jsxs("div",{className:"relative group border rounded-lg overflow-hidden",children:[e.jsx("img",{src:`/api${D.url}`,alt:"Imagem do produto",className:"w-full h-48 object-cover"}),D.e_principal&&e.jsx("div",{className:"absolute top-2 left-2 px-2 py-1 bg-blue-600 text-white text-xs rounded",children:"Principal"}),e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100",children:[!D.e_principal&&e.jsx("button",{type:"button",onClick:()=>qe(D.id),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",title:"Definir como principal",children:"â­ Principal"}),e.jsx("button",{type:"button",onClick:()=>Ae(D.id),className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700",title:"Excluir",children:"ðŸ—‘ï¸ Excluir"})]})]},D.id))}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Dica:"}),' A primeira imagem marcada como "Principal" serÃ¡ exibida na listagem de produtos. Formatos aceitos: JPG, PNG, WebP (mÃ¡x. 5MB).']})})]}):e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Salve o produto primeiro para adicionar imagens"})]})}),r===3&&e.jsx("div",{className:"space-y-6",children:o.tipo_produto==="PAI"?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-blue-300 rounded-lg bg-blue-50",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),e.jsx("p",{className:"mt-4 text-lg font-medium text-blue-900",children:"Produto com VariaÃ§Ãµes"}),e.jsxs("p",{className:"mt-2 text-sm text-blue-700",children:["Produtos PAI nÃ£o possuem estoque prÃ³prio.",e.jsx("br",{}),"O controle de estoque Ã© feito individualmente nas variaÃ§Ãµes."]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.controle_lote,onChange:D=>Ue("controle_lote",D.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Controlar Estoque"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estoque MÃ­nimo"}),e.jsx("input",{type:"number",step:"0.01",value:o.estoque_minimo,onChange:D=>Ue("estoque_minimo",D.target.value),disabled:!o.controle_lote,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estoque MÃ¡ximo"}),e.jsx("input",{type:"number",step:"0.01",value:o.estoque_maximo,onChange:D=>Ue("estoque_maximo",D.target.value),disabled:!o.controle_lote,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100",placeholder:"0"})]})]}),m&&o.controle_lote&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Lotes (FIFO)"}),e.jsx("button",{type:"button",onClick:()=>Be(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"+ Nova Entrada"})]}),b.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Nenhum lote cadastrado"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Lote"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Qtd DisponÃ­vel"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"FabricaÃ§Ã£o"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Validade"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Custo Unit."}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map(D=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:D.nome_lote||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-gray-900",children:D.quantidade_disponivel}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:Nr(D.data_fabricacao)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:Nr(D.data_validade)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:Ds(D.custo_unitario)}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>Te(D),className:"text-blue-600 hover:text-blue-800",title:"Editar lote",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{type:"button",onClick:()=>ua(D),className:"text-red-600 hover:text-red-800",title:"Excluir lote",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},D.id))})]})})]}),!m&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Salve o produto primeiro para gerenciar lotes"})]})}),r===4&&e.jsx("div",{className:"space-y-6",children:m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Fornecedores do Produto"}),e.jsx("button",{type:"button",onClick:sa,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"+ Adicionar Fornecedor"})]}),n.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"ðŸ­ Nenhum fornecedor vinculado"}),e.jsx("p",{className:"text-sm",children:'Clique em "Adicionar Fornecedor" para vincular fornecedores a este produto'})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fornecedor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"CÃ³digo"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"PreÃ§o Custo"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Prazo (dias)"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Principal"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(D=>e.jsxs("tr",{className:D.ativo?"":"opacity-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:D.fornecedor_nome}),e.jsx("p",{className:"text-xs text-gray-500",children:D.fornecedor_cpf_cnpj})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:D.codigo_fornecedor||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right",children:D.preco_custo?Ds(D.preco_custo):"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-center",children:D.prazo_entrega||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-center",children:D.estoque_fornecedor||"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:D.e_principal&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:"Principal"})}),e.jsxs("td",{className:"px-4 py-3 text-right space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>qa(D),className:"text-blue-600 hover:text-blue-800 text-sm",children:"Editar"}),e.jsx("button",{type:"button",onClick:()=>Sa(D.id),className:"text-red-600 hover:text-red-800 text-sm",children:"Excluir"})]})]},D.id))})]})})]}):e.jsx("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg",children:e.jsx("p",{className:"text-gray-600",children:"Salve o produto primeiro para vincular fornecedores"})})}),r===5&&e.jsxs("div",{className:"space-y-6",children:[m&&o.tributacao&&e.jsxs("div",{className:"mb-4 flex gap-2",children:[o.tributacao.origem==="produto_legado"&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-200 text-gray-800",children:"âšª Legado"}),(o.tributacao.origem==="produto_fiscal_v2"||o.tributacao.origem==="kit_fiscal_v2")&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-yellow-200 text-yellow-800",children:"ðŸŸ¡ Personalizado"}),o.tributacao.herdado_da_empresa&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-200 text-blue-800",children:"ðŸ”µ Herdado da empresa"})]}),m&&((mt=o.tributacao)==null?void 0:mt.herdado_da_empresa)===!0&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Esta configuraÃ§Ã£o fiscal estÃ¡ sendo herdada da empresa. Para editar, personalize o fiscal deste produto."}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{type:"button",className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500",onClick:()=>v(D=>({...D,tributacao:{...D.tributacao,herdado_da_empresa:!1}})),children:"âœï¸ Personalizar fiscal deste produto"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Origem",e.jsx("span",{className:"tooltip-icon",title:"Define se o produto Ã© nacional ou importado. Impacta o cÃ¡lculo do ICMS.",children:"ðŸ›ˆ"})]}),e.jsxs("select",{value:((Pt=o.tributacao)==null?void 0:Pt.origem_mercadoria)||"0",onChange:D=>v(ge=>({...ge,tributacao:{...ge.tributacao,origem_mercadoria:D.target.value}})),disabled:((Us=o.tributacao)==null?void 0:Us.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"0",children:"0 - Nacional"}),e.jsx("option",{value:"1",children:"1 - Estrangeira (ImportaÃ§Ã£o direta)"}),e.jsx("option",{value:"2",children:"2 - Estrangeira (Adquirida no mercado interno)"}),e.jsx("option",{value:"3",children:"3 - Nacional (> 40% conteÃºdo importado)"}),e.jsx("option",{value:"4",children:"4 - Nacional (Conforme processo produtivo bÃ¡sico)"}),e.jsx("option",{value:"5",children:"5 - Nacional (< 40% conteÃºdo importado)"}),e.jsx("option",{value:"6",children:"6 - Estrangeira (ImportaÃ§Ã£o direta sem similar)"}),e.jsx("option",{value:"7",children:"7 - Estrangeira (Mercado interno sem similar)"}),e.jsx("option",{value:"8",children:"8 - Nacional (> 70% conteÃºdo importado)"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["NCM",e.jsx("span",{className:"tooltip-icon",title:"Nomenclatura Comum do Mercosul. ClassificaÃ§Ã£o fiscal do produto, base para impostos.",children:"ðŸ›ˆ"})]}),e.jsx("input",{type:"text",value:((Rt=o.tributacao)==null?void 0:Rt.ncm)||"",onChange:D=>v(ge=>({...ge,tributacao:{...ge.tributacao,ncm:D.target.value}})),disabled:((At=o.tributacao)==null?void 0:At.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"00000000"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["CEST",e.jsx("span",{className:"tooltip-icon",title:"CÃ³digo Especificador da SubstituiÃ§Ã£o TributÃ¡ria. Para produtos sujeitos a ICMS ST.",children:"ðŸ›ˆ"})]}),e.jsx("input",{type:"text",value:((Ws=o.tributacao)==null?void 0:Ws.cest)||"",onChange:D=>v(ge=>({...ge,tributacao:{...ge.tributacao,cest:D.target.value}})),disabled:((Dt=o.tributacao)==null?void 0:Dt.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0000000"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["CFOP",e.jsx("span",{className:"tooltip-icon",title:"CÃ³digo Fiscal de OperaÃ§Ãµes e PrestaÃ§Ãµes. Define a natureza da operaÃ§Ã£o de venda.",children:"ðŸ›ˆ"})]}),e.jsx("input",{type:"text",value:((Mt=o.tributacao)==null?void 0:Mt.cfop)||"",onChange:D=>v(ge=>({...ge,tributacao:{...ge.tributacao,cfop:D.target.value}})),disabled:((Lt=o.tributacao)==null?void 0:Lt.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0000"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["AlÃ­quota ICMS (%)",e.jsx("span",{className:"tooltip-icon",title:"Imposto sobre CirculaÃ§Ã£o de Mercadorias. AlÃ­quota estadual aplicada na venda. Impacta o preÃ§o final.",children:"ðŸ›ˆ"})]}),e.jsx("input",{type:"number",step:"0.01",value:((qt=o.tributacao)==null?void 0:qt.icms_aliquota)||"",onChange:D=>v(ge=>({...ge,tributacao:{...ge.tributacao,icms_aliquota:D.target.value}})),disabled:((zt=o.tributacao)==null?void 0:zt.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0,00"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["AlÃ­quota PIS (%)",e.jsx("span",{className:"tooltip-icon",title:"Programa de IntegraÃ§Ã£o Social. ContribuiÃ§Ã£o federal sobre a venda. Geralmente 1,65%.",children:"ðŸ›ˆ"})]}),e.jsx("input",{type:"number",step:"0.01",value:((It=o.tributacao)==null?void 0:It.pis_aliquota)||"",onChange:D=>v(ge=>({...ge,tributacao:{...ge.tributacao,pis_aliquota:D.target.value}})),disabled:((hs=o.tributacao)==null?void 0:hs.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0,00"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["AlÃ­quota COFINS (%)",e.jsx("span",{className:"tooltip-icon",title:"ContribuiÃ§Ã£o para Financiamento da Seguridade Social. ContribuiÃ§Ã£o federal sobre a venda. Geralmente 7,6%.",children:"ðŸ›ˆ"})]}),e.jsx("input",{type:"number",step:"0.01",value:((Ss=o.tributacao)==null?void 0:Ss.cofins_aliquota)||"",onChange:D=>v(ge=>({...ge,tributacao:{...ge.tributacao,cofins_aliquota:D.target.value}})),disabled:((ut=o.tributacao)==null?void 0:ut.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0,00"})]})]})]}),r===6&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-purple-50 border-l-4 border-purple-500 p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-purple-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-purple-800",children:"Sistema de RecorrÃªncia (Fase 1)"}),e.jsxs("div",{className:"mt-2 text-sm text-purple-700",children:[e.jsx("p",{children:"Configure produtos que precisam ser recomprados periodicamente (vacinas, antipulgas, raÃ§Ãµes)."}),e.jsx("p",{className:"mt-1",children:"O sistema criarÃ¡ lembretes automÃ¡ticos para notificar clientes 7 dias antes."})]})]})]})}),e.jsxs("div",{className:"flex items-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"tem_recorrencia",checked:o.tem_recorrencia,onChange:D=>Ue("tem_recorrencia",D.target.checked),className:"h-5 w-5 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"}),e.jsxs("label",{htmlFor:"tem_recorrencia",className:"ml-3",children:[e.jsx("span",{className:"text-base font-medium text-gray-900",children:"Produto com RecorrÃªncia"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Ativar lembretes automÃ¡ticos para este produto"})]})]}),o.tem_recorrencia&&e.jsxs("div",{className:"space-y-4 border-t pt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de RecorrÃªncia *"}),e.jsxs("select",{value:o.tipo_recorrencia,onChange:D=>{Ue("tipo_recorrencia",D.target.value),D.target.value==="daily"?Ue("intervalo_dias","1"):D.target.value==="weekly"?Ue("intervalo_dias","7"):D.target.value==="monthly"?Ue("intervalo_dias","30"):D.target.value==="yearly"&&Ue("intervalo_dias","365")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"daily",children:"DiÃ¡ria"}),e.jsx("option",{value:"weekly",children:"Semanal (7 dias)"}),e.jsx("option",{value:"monthly",children:"Mensal (30 dias)"}),e.jsx("option",{value:"yearly",children:"Anual (365 dias)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Intervalo (em dias) *"}),e.jsx("input",{type:"number",min:"1",value:o.intervalo_dias,onChange:D=>Ue("intervalo_dias",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Ex: 30 (para Nexgard)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Exemplos: Nexgard = 30, Vacina Anual = 365"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NÃºmero de Doses (opcional)"}),e.jsx("input",{type:"number",min:"1",value:o.numero_doses,onChange:D=>Ue("numero_doses",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Ex: 3 (para vacina com 3 doses)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ðŸ’‰ Se vazio, serÃ¡ recorrente indefinidamente. Se preenchido (ex: 3), o sistema finalizarÃ¡ apÃ³s a Ãºltima dose."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Compatibilidade por EspÃ©cie"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especie_compativel",value:"both",checked:o.especie_compativel==="both",onChange:D=>Ue("especie_compativel",D.target.value),className:"h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"ðŸ¶ðŸ± CÃ£es e Gatos"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especie_compativel",value:"dog",checked:o.especie_compativel==="dog",onChange:D=>Ue("especie_compativel",D.target.value),className:"h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"ðŸ¶ Apenas CÃ£es"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especie_compativel",value:"cat",checked:o.especie_compativel==="cat",onChange:D=>Ue("especie_compativel",D.target.value),className:"h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"ðŸ± Apenas Gatos"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ObservaÃ§Ãµes / InstruÃ§Ãµes"}),e.jsx("textarea",{value:o.observacoes_recorrencia,onChange:D=>Ue("observacoes_recorrencia",D.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Ex: Aplicar mensalmente no mesmo dia. NÃ£o atrasar mais de 5 dias."})]}),o.intervalo_dias&&e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-purple-900 mb-2",children:"ðŸ“Œ Preview do Lembrete"}),e.jsxs("div",{className:"text-sm text-purple-700 space-y-1",children:[e.jsxs("p",{children:["âœ“ Cliente serÃ¡ notificado ",e.jsx("strong",{children:"7 dias antes"})," da prÃ³xima dose"]}),e.jsxs("p",{children:["âœ“ Intervalo configurado: ",e.jsxs("strong",{children:[o.intervalo_dias," dias"]})]}),e.jsx("p",{children:"âœ“ ApÃ³s a compra, um novo lembrete serÃ¡ criado automaticamente"}),o.especie_compativel!=="both"&&e.jsx("p",{className:"mt-2 text-purple-800",children:"âš ï¸ Sistema validarÃ¡ se o pet Ã© compatÃ­vel na hora da venda"})]})]})]})]}),r===7&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-orange-50 border-l-4 border-orange-500 p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-orange-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-orange-800",children:"Calculadora de RaÃ§Ã£o (Fase 2)"}),e.jsxs("div",{className:"mt-2 text-sm text-orange-700",children:[e.jsx("p",{children:"Configure informaÃ§Ãµes de raÃ§Ã£o para usar na calculadora de duraÃ§Ã£o e custo."}),e.jsx("p",{className:"mt-1",children:"A IA usarÃ¡ esses dados para recomendar raÃ§Ãµes aos clientes."})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ã‰ raÃ§Ã£o?"}),e.jsxs("select",{value:o.classificacao_racao||"nao",onChange:D=>{const ge=D.target.value;v(De=>({...De,classificacao_racao:ge,linha_racao_id:ge==="sim"?De.linha_racao_id:"",porte_animal_id:ge==="sim"?De.porte_animal_id:"",fase_publico_id:ge==="sim"?De.fase_publico_id:"",tipo_tratamento_id:ge==="sim"?De.tipo_tratamento_id:"",sabor_proteina_id:ge==="sim"?De.sabor_proteina_id:"",apresentacao_peso_id:ge==="sim"?De.apresentacao_peso_id:"",peso_embalagem:ge==="sim"?De.peso_embalagem:"",categoria_racao:ge==="sim"?De.categoria_racao:""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:"nao",children:"NÃ£o"}),e.jsx("option",{value:"sim",children:"Sim"})]})]})}),o.classificacao_racao==="sim"&&e.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-4",children:"ðŸ“‹ InformaÃ§Ãµes Detalhadas da RaÃ§Ã£o"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Linha"}),e.jsxs("select",{value:o.linha_racao_id,onChange:D=>Ue("linha_racao_id",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),E.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Porte do Animal"}),e.jsxs("select",{value:o.porte_animal_id,onChange:D=>Ue("porte_animal_id",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),K.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fase/PÃºblico"}),e.jsxs("select",{value:o.fase_publico_id,onChange:D=>{const ge=D.target.value,De=M.find(Je=>String(Je.id)===String(ge));v(Je=>({...Je,fase_publico_id:ge,categoria_racao:De?De.nome:""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),M.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Tratamento ",e.jsx("span",{className:"text-gray-400",children:"(Opcional)"})]}),e.jsxs("select",{value:o.tipo_tratamento_id,onChange:D=>Ue("tipo_tratamento_id",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Nenhum"}),Q.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sabor/ProteÃ­na"}),e.jsxs("select",{value:o.sabor_proteina_id,onChange:D=>Ue("sabor_proteina_id",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),q.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ApresentaÃ§Ã£o (Peso)"}),e.jsxs("select",{value:o.apresentacao_peso_id,onChange:D=>{const ge=D.target.value,De=R.find(Je=>String(Je.id)===String(ge));v(Je=>({...Je,apresentacao_peso_id:ge,peso_embalagem:De?String(De.peso_kg):Je.peso_embalagem}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),R.map(D=>e.jsxs("option",{value:D.id,children:[D.peso_kg,"kg"]},D.id))]})]})]}),e.jsxs("p",{className:"text-xs text-blue-600 mt-3",children:["ðŸ’¡ ",e.jsx("strong",{children:"Dica:"})," Essas informaÃ§Ãµes ajudam a IA a recomendar a raÃ§Ã£o ideal para cada pet no PDV. VocÃª pode gerenciar as opÃ§Ãµes disponÃ­veis em ",e.jsx("strong",{children:"Cadastros > OpÃ§Ãµes de RaÃ§Ã£o"}),"."]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"EspÃ©cies Indicadas"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especies_indicadas",value:"both",checked:o.especies_indicadas==="both",onChange:D=>Ue("especies_indicadas",D.target.value),className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"ðŸ¶ðŸ± Ambos"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especies_indicadas",value:"dog",checked:o.especies_indicadas==="dog",onChange:D=>Ue("especies_indicadas",D.target.value),className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"ðŸ¶ CÃ£es"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especies_indicadas",value:"cat",checked:o.especies_indicadas==="cat",onChange:D=>Ue("especies_indicadas",D.target.value),className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"ðŸ± Gatos"})]})]})]})}),e.jsx("input",{type:"hidden",value:o.tabela_nutricional}),e.jsx("div",{children:e.jsx(wn,{value:o.tabela_consumo,onChange:D=>Ue("tabela_consumo",D),pesoEmbalagem:parseFloat(o.peso_embalagem)||null})}),o.peso_embalagem&&o.classificacao_racao&&e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-orange-900 mb-2",children:"ðŸ“Š Preview da Calculadora"}),e.jsxs("div",{className:"text-sm text-orange-700 space-y-1",children:[e.jsxs("p",{children:["âœ“ Peso: ",e.jsxs("strong",{children:[o.peso_embalagem,"kg"]})]}),e.jsxs("p",{children:["âœ“ ClassificaÃ§Ã£o: ",e.jsx("strong",{children:o.classificacao_racao.replace("_"," ")})]}),o.categoria_racao&&e.jsxs("p",{children:["âœ“ Categoria: ",e.jsx("strong",{children:o.categoria_racao})]}),o.tabela_consumo&&e.jsx("p",{className:"text-green-600",children:"âœ“ Tabela de consumo configurada"}),!o.tabela_consumo&&e.jsx("p",{className:"text-yellow-600",children:"âš ï¸ Sem tabela de consumo (usarÃ¡ cÃ¡lculo genÃ©rico)"}),e.jsx("p",{className:"mt-2 text-orange-800",children:"ðŸ’¡ Use a Calculadora de RaÃ§Ã£o para ver duraÃ§Ã£o e custo/dia"})]})]})]}),r===8&&o.tipo_produto==="PAI"&&e.jsx("div",{className:"space-y-6",children:m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:["VariaÃ§Ãµes do Produto: ",o.nome]}),e.jsx("p",{className:"text-sm text-blue-700",children:"Cadastre as variaÃ§Ãµes deste produto. Cada variaÃ§Ã£o Ã© um produto vendÃ¡vel independente com seu prÃ³prio SKU, preÃ§o e estoque."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-md font-semibold",children:"VariaÃ§Ãµes Cadastradas"}),e.jsx("button",{type:"button",onClick:()=>O(!y),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:y?"âŒ Cancelar":"âž• Nova VariaÃ§Ã£o"})]}),y&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4",children:[e.jsx("h5",{className:"font-semibold mb-3",children:"Cadastrar Nova VariaÃ§Ã£o"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU *"}),e.jsx("input",{type:"text",value:G.sku,onChange:D=>B({...G,sku:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Ex: PROD001-P"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Complementar *"}),e.jsx("input",{type:"text",value:G.nome,onChange:D=>B({...G,nome:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Ex: Tamanho P"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CÃ³digo de Barras"}),e.jsx("input",{type:"text",value:G.codigo_barras,onChange:D=>B({...G,codigo_barras:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"EAN-13"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PreÃ§o de Custo"}),e.jsx("input",{type:"number",step:"0.01",value:G.preco_custo,onChange:D=>B({...G,preco_custo:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PreÃ§o de Venda *"}),e.jsx("input",{type:"number",step:"0.01",value:G.preco_venda,onChange:D=>B({...G,preco_venda:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estoque MÃ­nimo"}),e.jsx("input",{type:"number",value:G.estoque_minimo,onChange:D=>B({...G,estoque_minimo:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"0"})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:G.e_kit,onChange:D=>B({...G,e_kit:D.target.checked}),className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:"ðŸ§© Esta variaÃ§Ã£o Ã© um KIT (possui composiÃ§Ã£o)"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Se marcado, vocÃª poderÃ¡ definir a composiÃ§Ã£o do kit apÃ³s salvar a variaÃ§Ã£o."})]})]})}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{O(!1),B({sku:"",nome:"",codigo_barras:"",preco_custo:"",preco_venda:"",estoque_minimo:0,e_kit:!1,e_kit_fisico:!1,composicao_kit:[]})},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:async()=>{var D,ge;if(!G.sku||!G.nome||!G.preco_venda){alert("Preencha SKU, Nome e PreÃ§o de Venda");return}try{const De={codigo:G.sku,nome:`${o.nome} - ${G.nome}`,codigo_barras:G.codigo_barras||null,preco_custo:parseFloat(G.preco_custo)||0,preco_venda:parseFloat(G.preco_venda),estoque_minimo:parseInt(G.estoque_minimo)||0,tipo_produto:"VARIACAO",produto_pai_id:parseInt(l),categoria_id:o.categoria_id||null,marca_id:o.marca_id||null,unidade:o.unidade||"UN"};G.e_kit&&(De.tipo_kit="VIRTUAL",De.e_kit_fisico=!1,De.composicao_kit=[]),await co(De),alert("VariaÃ§Ã£o cadastrada com sucesso!"),O(!1),B({sku:"",nome:"",codigo_barras:"",preco_custo:"",preco_venda:"",estoque_minimo:0,e_kit:!1,e_kit_fisico:!1,composicao_kit:[]});const Je=await dr(l);P(Je.data)}catch(De){console.error("Erro ao cadastrar variaÃ§Ã£o:",De),alert(((ge=(D=De.response)==null?void 0:D.data)==null?void 0:ge.detail)||"Erro ao cadastrar variaÃ§Ã£o")}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Salvar VariaÃ§Ã£o"})]})]}),S.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx("p",{className:"text-gray-500",children:"Nenhuma variaÃ§Ã£o cadastrada ainda."}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:'Clique em "Nova VariaÃ§Ã£o" para comeÃ§ar.'})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"SKU"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"CÃ³digo de Barras"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Custo"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Venda"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:S.map(D=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:D.codigo}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:D.nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:D.codigo_barras||"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:["R$ ",(D.preco_custo||0).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-gray-900 font-semibold",children:["R$ ",D.preco_venda.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:e.jsx("span",{className:`font-semibold ${D.estoque_atual<=D.estoque_minimo?"text-red-600":"text-green-600"}`,children:D.estoque_atual||0})}),e.jsxs("td",{className:"px-4 py-3 text-center",children:[e.jsx("button",{type:"button",onClick:()=>s(`/produtos/${D.id}/editar`),className:"text-blue-600 hover:text-blue-800 mr-2",title:"Editar",children:"âœï¸"}),e.jsx("button",{type:"button",onClick:async()=>{if(confirm(`Deseja excluir a variaÃ§Ã£o ${D.nome}?`))try{await yr(D.id),alert("VariaÃ§Ã£o excluÃ­da com sucesso!");const ge=await dr(l);P(ge.data||[])}catch(ge){console.error("Erro ao excluir variaÃ§Ã£o:",ge),alert("Erro ao excluir variaÃ§Ã£o")}},className:"text-red-600 hover:text-red-800",title:"Excluir",children:"ðŸ—‘ï¸"})]})]},D.id))})]})})]})]}):e.jsxs("div",{className:"text-center py-16 border-2 border-dashed border-yellow-300 rounded-lg bg-yellow-50",children:[e.jsx("svg",{className:"mx-auto h-16 w-16 text-yellow-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),e.jsx("p",{className:"mt-4 text-xl font-semibold text-yellow-900",children:"Aba Bloqueada"}),e.jsx("p",{className:"mt-2 text-sm text-yellow-800",children:"Salve o produto primeiro para habilitar o cadastro de variaÃ§Ãµes."}),e.jsx("p",{className:"mt-4 text-xs text-yellow-700",children:"ApÃ³s salvar, vocÃª serÃ¡ redirecionado automaticamente para cadastrar as variaÃ§Ãµes."})]})}),r===9&&(o.tipo_produto==="KIT"||o.tipo_produto==="VARIACAO"&&o.tipo_kit)&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border-2 border-gray-300 rounded-lg p-5",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Tipo de Estoque do Kit"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{onClick:()=>Ue("e_kit_fisico",!1),className:`cursor-pointer p-4 border-2 rounded-lg transition-all ${o.e_kit_fisico?"border-gray-300 bg-white hover:border-blue-300":"border-blue-500 bg-blue-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"radio",name:"tipo_estoque_kit",checked:!o.e_kit_fisico,onChange:()=>Ue("e_kit_fisico",!1),className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“Š"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:"Estoque Virtual"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["O estoque Ã© calculado ",e.jsx("strong",{children:"automaticamente"})," com base nos componentes disponÃ­veis."]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:[e.jsx("div",{children:"âœ“ NÃ£o permite movimentaÃ§Ã£o manual"}),e.jsx("div",{children:"âœ“ Estoque = menor disponibilidade dos componentes"}),e.jsx("div",{children:"âœ“ Ideal para kits montados sob demanda"})]})]})]})}),e.jsx("div",{onClick:()=>Ue("e_kit_fisico",!0),className:`cursor-pointer p-4 border-2 rounded-lg transition-all ${o.e_kit_fisico?"border-green-500 bg-green-50":"border-gray-300 bg-white hover:border-green-300"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"radio",name:"tipo_estoque_kit",checked:o.e_kit_fisico,onChange:()=>Ue("e_kit_fisico",!0),className:"mt-1 h-4 w-4 text-green-600 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“¦"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:"Estoque FÃ­sico"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["O kit possui estoque ",e.jsx("strong",{children:"prÃ³prio e independente"})," dos componentes."]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:[e.jsx("div",{children:"âœ“ Permite movimentaÃ§Ã£o manual"}),e.jsx("div",{children:"âœ“ Entrada: diminui componentes (montou kits)"}),e.jsx("div",{children:"âœ“ Ideal para kits prÃ©-montados"})]})]})]})})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-purple-600 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"ComposiÃ§Ã£o do Kit"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Defina quais produtos compÃµem este kit e as quantidades necessÃ¡rias de cada um."}),!o.e_kit_fisico&&e.jsxs("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800",children:[e.jsx("strong",{children:"ðŸ“Š Estoque Virtual Ativo"}),e.jsx("br",{}),"O estoque deste kit serÃ¡ calculado automaticamente baseado nos componentes.",e.jsx("br",{}),e.jsx("span",{className:"text-xs italic",children:"Estoque do kit = menor disponibilidade entre os componentes (considerando as quantidades necessÃ¡rias)"})]}),o.e_kit_fisico&&e.jsxs("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded text-sm text-green-800",children:[e.jsx("strong",{children:"ðŸ“¦ Estoque FÃ­sico Ativo"}),e.jsx("br",{}),e.jsx("strong",{children:"Entrada no kit:"})," Os componentes serÃ£o automaticamente DIMINUÃDOS (unitÃ¡rios viraram kit).",e.jsx("br",{}),e.jsx("strong",{children:"SaÃ­da manual:"})," VocÃª poderÃ¡ escolher se os componentes voltam ao estoque (desfez o kit) ou nÃ£o (perda/roubo)."]})]})]})}),!o.e_kit_fisico&&o.composicao_kit.length>0&&e.jsx("div",{className:"bg-white border-2 border-green-300 rounded-lg p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Estoque Virtual do Kit"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Calculado automaticamente"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-4xl font-bold text-green-600",children:de}),e.jsx("p",{className:"text-xs text-gray-500",children:"kits disponÃ­veis"})]})]})}),e.jsxs("div",{className:"border border-gray-300 rounded-lg p-5 bg-gray-50",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Adicionar Produto ao Kit"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Produto"}),e.jsxs("select",{value:W,onChange:D=>ne(D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione um produto..."}),z.map(D=>e.jsxs("option",{value:D.id,children:["[",D.codigo,"] ",D.nome," - Estoque: ",D.estoque_atual||0]},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade"}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",value:H,onChange:D=>ee(D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"1"})]})]}),e.jsxs("button",{type:"button",onClick:Ja,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Adicionar ao Kit"]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-3",children:["Produtos no Kit (",o.composicao_kit.length,")"]}),o.composicao_kit.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Nenhum produto adicionado ao kit ainda"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"SKU"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Quantidade"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Kits PossÃ­veis"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.composicao_kit.map((D,ge)=>{const De=Math.floor(D.estoque_componente/D.quantidade),Je=De===de&&de>0;return e.jsxs("tr",{className:`hover:bg-gray-50 ${Je?"bg-yellow-50":""}`,children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:D.produto_sku||"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-700",children:[D.produto_nome,Je&&e.jsx("span",{className:"ml-2 text-xs bg-yellow-200 text-yellow-800 px-2 py-1 rounded",children:"âš ï¸ LIMITADOR"})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-900 font-semibold",children:D.quantidade}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:D.estoque_componente||0}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsx("span",{className:`font-semibold ${De===0?"text-red-600":De<5?"text-yellow-600":"text-green-600"}`,children:De})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{type:"button",onClick:()=>$t(D.produto_id),className:"text-red-600 hover:text-red-800",title:"Remover do kit",children:"ðŸ—‘ï¸"})})]},D.produto_id)})})]})})]}),o.composicao_kit.length>0&&de===0&&!o.e_kit_fisico&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{className:"text-sm text-red-800",children:[e.jsx("strong",{children:"Kit sem estoque disponÃ­vel!"}),e.jsx("p",{className:"mt-1",children:"Pelo menos um dos componentes estÃ¡ sem estoque suficiente para montar o kit."})]})]})})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>s("/produtos"),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:pa,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400",children:pa?"Salvando...":m?"Atualizar":"Cadastrar"})]})]}),Ce&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Nova Entrada de Estoque"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade *"}),e.jsx("input",{type:"number",step:"0.01",value:Ie.quantidade,onChange:D=>Y({...Ie,quantidade:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex justify-between items-center",children:[e.jsx("span",{children:"NÃƒÂºmero do Lote"}),e.jsx("button",{type:"button",onClick:()=>{const D=`LOTE-${new Date().toISOString().split("T")[0].replace(/-/g,"")}-${Math.floor(Math.random()*1e3).toString().padStart(3,"0")}`;Y({...Ie,nome_lote:D})},className:"text-xs text-blue-600 hover:text-blue-800",children:"Gerar SugestÃƒÂ£o"})]}),e.jsx("input",{type:"text",value:Ie.nome_lote,onChange:D=>Y({...Ie,nome_lote:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: LOTE-20260105-001 (deixe vazio para gerar automaticamente)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de FabricaÃ§Ã£o"}),e.jsx("input",{type:"date",value:Ie.data_fabricacao,onChange:D=>Y({...Ie,data_fabricacao:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Validade"}),e.jsx("input",{type:"date",value:Ie.data_validade,onChange:D=>Y({...Ie,data_validade:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PreÃ§o de Custo *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:Ie.preco_custo,onChange:D=>Y({...Ie,preco_custo:D.target.value}),className:"w-full pl-12 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0,00"})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>Be(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:$e,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Registrar Entrada"})]})]})}),je&&fe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Editar Lote"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Lote *"}),e.jsx("input",{type:"text",value:fe.nome_lote,onChange:D=>U({...fe,nome_lote:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nome do lote"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade *"}),e.jsx("input",{type:"number",step:"0.01",value:fe.quantidade_inicial,onChange:D=>U({...fe,quantidade_inicial:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de FabricaÃ§Ã£o"}),e.jsx("input",{type:"date",value:fe.data_fabricacao,onChange:D=>U({...fe,data_fabricacao:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Validade"}),e.jsx("input",{type:"date",value:fe.data_validade,onChange:D=>U({...fe,data_validade:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Custo UnitÃ¡rio *"}),e.jsx("input",{type:"number",step:"0.01",value:fe.custo_unitario,onChange:D=>U({...fe,custo_unitario:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0,00"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{Me(!1),U(null)},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:We,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Salvar AlteraÃ§Ãµes"})]})]})}),ie&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:Pe?"Editar Fornecedor":"Adicionar Fornecedor"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fornecedor *"}),e.jsxs("select",{value:le.fornecedor_id,onChange:D=>pe({...le,fornecedor_id:D.target.value}),disabled:!!Pe,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",children:[e.jsx("option",{value:"",children:"Selecione..."}),h.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CÃ³digo no Fornecedor"}),e.jsx("input",{type:"text",value:le.codigo_fornecedor,onChange:D=>pe({...le,codigo_fornecedor:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"SKU-FORNECEDOR-001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PreÃ§o de Custo"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:le.preco_custo,onChange:D=>pe({...le,preco_custo:D.target.value}),className:"w-full pl-12 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0,00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prazo de Entrega (dias)"}),e.jsx("input",{type:"number",value:le.prazo_entrega,onChange:D=>pe({...le,prazo_entrega:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"7"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estoque no Fornecedor"}),e.jsx("input",{type:"number",step:"0.01",value:le.estoque_fornecedor,onChange:D=>pe({...le,estoque_fornecedor:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"100"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:le.e_principal,onChange:D=>pe({...le,e_principal:D.target.checked}),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Fornecedor Principal"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>Ne(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:ja,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Salvar"})]})]})})]})}function Cn(){const s=fa(),[l,t]=a.useState([]),[m,r]=a.useState([]),[g,o]=a.useState(!1),[v,j]=a.useState({totalEntradas:0,totalSaidas:0,valorTotal:0}),[f,N]=a.useState({data_inicio:k("mes"),data_fim:w(),produto_id:"",tipo_movimentacao:""}),[d,x]=a.useState("mes");a.useEffect(()=>{c()},[]),a.useEffect(()=>{b()},[f]);function k(h){const _=new Date,E=new Date(_);switch(h){case"mes":E.setDate(1);break;case"3meses":E.setMonth(_.getMonth()-3);break;case"6meses":E.setMonth(_.getMonth()-6);break;case"ano":E.setMonth(0),E.setDate(1);break;default:return""}return E.toISOString().split("T")[0]}function w(){return new Date().toISOString().split("T")[0]}const c=async()=>{try{const h=await Xo();h.data&&Array.isArray(h.data.items)?r(h.data.items):Array.isArray(h.data)?r(h.data):(console.warn("Resposta de produtos nÃ£o Ã© um array:",h.data),r([]))}catch(h){console.error("Erro ao carregar produtos:",h),r([])}},b=async()=>{var h,_,E;try{o(!0);const K=(await vn(f)).data;let te=[];K&&Array.isArray(K.movimentacoes)?te=K.movimentacoes:Array.isArray(K)?te=K:console.warn("Resposta de movimentaÃ§Ãµes nÃ£o Ã© um array:",K),t(te);const M=te.reduce((A,Q)=>(A.totalEntradas+=Q.entrada||0,A.totalSaidas+=Q.saida||0,A.valorTotal+=Q.valor_total||0,A),{totalEntradas:0,totalSaidas:0,valorTotal:0});j(M)}catch($){console.error("Erro ao carregar relatÃ³rio:",$),console.error("Detalhes do erro:",(h=$.response)==null?void 0:h.data),alert(`Erro ao carregar relatÃ³rio: ${((E=(_=$.response)==null?void 0:_.data)==null?void 0:E.detail)||$.message}`),t([])}finally{o(!1)}},p=h=>{x(h),h==="personalizado"||N({...f,data_inicio:k(h),data_fim:w()})},i=(h,_)=>{N(E=>({...E,[h]:_}))},u=()=>{const h=["Data","Produto","CÃ³digo","Entrada","SaÃ­da","Estoque","Tipo","Valor","UsuÃ¡rio","NÂº Pedido","LanÃ§amento"],_=l.map(te=>[te.data||"",te.produto_nome||"",te.codigo||"",te.entrada||0,te.saida||0,te.estoque||0,te.tipo||"",Ds(te.valor_total||0),te.usuario||"",te.numero_pedido||"",te.lancamento||""]);let E=h.join(";")+`
`;_.forEach(te=>{E+=te.join(";")+`
`});const $=new Blob([E],{type:"text/csv;charset=utf-8;"}),K=document.createElement("a");K.href=URL.createObjectURL($),K.download=`relatorio_movimentacoes_${new Date().toISOString().split("T")[0]}.csv`,K.click()},n=l.reduce((h,_)=>{const $=new Date(_.data_movimentacao).toLocaleDateString("pt-BR",{month:"short",year:"numeric"});return h[$]||(h[$]=[]),h[$].push(_),h},{}),C=h=>({entrada:"bg-green-100 text-green-800",saida:"bg-red-100 text-red-800",ajuste:"bg-yellow-100 text-yellow-800",transferencia:"bg-blue-100 text-blue-800"})[h]||"bg-gray-100 text-gray-800";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"RelatÃ³rio de MovimentaÃ§Ãµes"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"HistÃ³rico completo de entradas e saÃ­das de estoque"})]}),e.jsx("button",{onClick:()=>s("/produtos"),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Voltar"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"Ãšltimo MÃªs",value:"mes"},{label:"3 Meses",value:"3meses"},{label:"6 Meses",value:"6meses"},{label:"Este Ano",value:"ano"},{label:"Personalizado",value:"personalizado"}].map(h=>e.jsx("button",{onClick:()=>p(h.value),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${d===h.value?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:h.label},h.value))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:f.data_inicio,onChange:h=>i("data_inicio",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:f.data_fim,onChange:h=>i("data_fim",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Produto"}),e.jsxs("select",{value:f.produto_id,onChange:h=>i("produto_id",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os Produtos"}),m.map(h=>e.jsxs("option",{value:h.id,children:[h.codigo||h.sku," - ",h.nome]},h.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:f.tipo_movimentacao,onChange:h=>i("tipo_movimentacao",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os Tipos"}),e.jsx("option",{value:"entrada",children:"Entrada"}),e.jsx("option",{value:"saida",children:"SaÃ­da"}),e.jsx("option",{value:"ajuste",children:"Ajuste"}),e.jsx("option",{value:"transferencia",children:"TransferÃªncia"})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Entradas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:v.totalEntradas.toFixed(2)})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 11l5-5m0 0l5 5m-5-5v12"})})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de SaÃ­das"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:v.totalSaidas.toFixed(2)})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 13l-5 5m0 0l-5-5m5 5V6"})})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Valor Total"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:Ds(v.valorTotal)})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})})]}),e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:u,disabled:l.length===0,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Exportar CSV"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[g?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Carregando relatÃ³rio..."}):l.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Nenhuma movimentaÃ§Ã£o encontrada no perÃ­odo selecionado"}):e.jsx("div",{className:"overflow-x-auto",children:Object.entries(n).map(([h,_])=>e.jsxs("div",{children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 font-semibold text-gray-700 border-b border-gray-200",children:[h.charAt(0).toUpperCase()+h.slice(1)," (",_.length," movimentaÃ§Ãµes)"]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CÃ³digo"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Entrada"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SaÃ­da"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Custo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"UsuÃ¡rio"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"NÂº Pedido"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:_.map((E,$)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 whitespace-nowrap",children:E.data}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:E.produto_nome||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-700 font-mono",children:E.codigo||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-green-600",children:E.entrada>0?E.entrada:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-red-600",children:E.saida>0?E.saida:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:E.estoque||0}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${C(E.tipo)}`,children:E.tipo})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:Ds(E.valor_total||0)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:E.usuario||"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:E.numero_pedido?e.jsxs("button",{className:"text-blue-600 hover:text-blue-800 underline font-mono text-sm",title:"Clique para ver o pedido",children:["#",E.numero_pedido]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]},$))})]})]},h))}),!g&&l.length>0&&e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",l.length," movimentaÃ§Ãµes no perÃ­odo"]})})]})]})}const kn=()=>F.get("/estoque/alertas/pendentes"),Sn=(s={})=>F.get("/estoque/alertas/todos",{params:s}),En=()=>F.get("/estoque/alertas/dashboard"),Fn=(s,l,t=null)=>F.put(`/estoque/alertas/${s}/resolver`,{status:l,observacao:t}),$n=s=>F.post("/estoque/alertas/verificar-estoque-negativo",{itens:s});function Pn(){const s=fa(),[l,t]=a.useState([]),[m,r]=a.useState([]),[g,o]=a.useState(null),[v,j]=a.useState(!1),[f,N]=a.useState("pendentes");a.useEffect(()=>{d()},[f]);const d=async()=>{j(!0);try{if(f==="pendentes"){const c=await kn();t(c.data)}else if(f==="historico"){const c=await Sn();r(c.data)}else if(f==="dashboard"){const c=await En();o(c.data)}}catch(c){console.error("Erro ao carregar alertas:",c),Se.error("Erro ao carregar alertas de estoque")}finally{j(!1)}},x=async(c,b,p=null)=>{if(b==="resolvido"&&p){s(`/produtos?produto_id=${p}`),Se.info("Redirecionando para ajustar o estoque do produto...");return}try{await Fn(c,b),Se.success("Alerta ignorado com sucesso"),d()}catch(i){console.error("Erro ao ignorar alerta:",i),Se.error("Erro ao processar alerta")}},k=c=>{const b={CRITICO:"bg-red-100 text-red-800 border-red-300",ALTO:"bg-orange-100 text-orange-800 border-orange-300",MEDIO:"bg-yellow-100 text-yellow-800 border-yellow-300",BAIXO:"bg-blue-100 text-blue-800 border-blue-300"};return b[c]||b.MEDIO},w=c=>new Date(c).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Ra,{className:"text-red-500"}),"Alertas de Estoque Negativo"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Monitoramento em tempo real de produtos com estoque crÃ­tico"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[e.jsx("button",{onClick:()=>N("pendentes"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${f==="pendentes"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ra,{size:18}),"Pendentes",l.length>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:l.length})]})}),e.jsx("button",{onClick:()=>N("dashboard"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${f==="dashboard"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Va,{size:18}),"Dashboard"]})}),e.jsx("button",{onClick:()=>N("historico"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${f==="historico"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Za,{size:18}),"HistÃ³rico"]})})]})})}),e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:d,disabled:v,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors",children:[e.jsx(Fa,{size:18,className:v?"animate-spin":""}),"Atualizar"]})}),v?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(Fa,{className:"animate-spin mx-auto text-gray-400",size:48}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Carregando..."})]}):e.jsxs(e.Fragment,{children:[f==="pendentes"&&e.jsx("div",{className:"space-y-4",children:l.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(ha,{className:"mx-auto text-green-500",size:64}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mt-4",children:"Nenhum alerta pendente!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Todos os produtos estÃ£o com estoque adequado."})]}):l.map(c=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:c.produto_nome}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${k(c.criticidade)}`,children:c.criticidade})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Estoque Anterior"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.estoque_anterior})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Estoque Resultante"}),e.jsx("p",{className:"text-lg font-semibold text-red-600",children:c.estoque_resultante})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Quantidade Vendida"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.quantidade_vendida})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Venda"}),e.jsx("p",{className:"text-lg font-semibold text-blue-600",children:c.venda_codigo?`#${c.venda_codigo}`:c.venda_id?`ID: ${c.venda_id}`:"N/A"})]})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Data:"})," ",w(c.data_alerta)]}),c.observacao&&e.jsxs("p",{className:"mt-1",children:[e.jsx("strong",{children:"ObservaÃ§Ã£o:"})," ",c.observacao]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[e.jsxs("button",{onClick:()=>x(c.id,"resolvido",c.produto_id),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",title:"Ir para o produto e fazer ajuste de estoque",children:[e.jsx(Za,{size:16}),"Ajustar Estoque"]}),e.jsxs("button",{onClick:()=>x(c.id,"ignorado"),className:"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm",title:"Ignorar este alerta (aceitar estoque negativo)",children:[e.jsx(ds,{size:16}),"Ignorar"]})]})]})},c.id))}),f==="dashboard"&&g&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total de Alertas"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:g.total_alertas})]}),e.jsx(Ra,{className:"text-gray-400",size:40})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pendentes"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 mt-2",children:g.alertas_pendentes})]}),e.jsx(Ra,{className:"text-red-400",size:40})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"CrÃ­ticos"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600 mt-2",children:g.alertas_criticos})]}),e.jsx(Va,{className:"text-orange-400",size:40})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Resolvidos"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 mt-2",children:g.alertas_resolvidos})]}),e.jsx(ha,{className:"text-green-400",size:40})]})})]}),g.produtos_estoque_negativo&&g.produtos_estoque_negativo.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Za,{className:"text-red-500"}),"Produtos com Estoque Negativo Atual"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque Atual"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Alertas Pendentes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.produtos_estoque_negativo.map((c,b)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:c.nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-bold text-red-600",children:c.estoque_atual}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900",children:c.alertas_pendentes})]},b))})]})})]})]}),f==="historico"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Criticidade"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque Ant."}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque Res."}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Venda"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-12 text-center text-gray-500",children:"Nenhum alerta registrado"})}):m.map(c=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:w(c.data_alerta)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:c.produto_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${k(c.criticidade)}`,children:c.criticidade})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900",children:c.estoque_anterior}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-semibold text-red-600",children:c.estoque_resultante}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${c.resolvido?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:c.resolvido?"Resolvido":"Pendente"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm text-blue-600 font-medium",children:c.venda_codigo?`#${c.venda_codigo}`:c.venda_id?`ID: ${c.venda_id}`:"N/A"})]},c.id))})]})})})]})]})}function Rn(){const[s,l]=a.useState([]),[t,m]=a.useState(!1),[r,g]=a.useState("pendente");a.useEffect(()=>{o();const x=setInterval(o,6e4);return()=>clearInterval(x)},[]);const o=async()=>{m(!0);try{const x=await F.get("/api/lembretes/pendentes");l(x.data.lembretes||[])}catch(x){console.error("Erro ao carregar lembretes:",x),Se.error("Erro ao carregar lembretes")}finally{m(!1)}},v=async x=>{try{await F.post(`/api/lembretes/${x}/completar`,{}),Se.success("Lembrete marcado como completado"),o()}catch{Se.error("Erro ao completar lembrete")}},j=async x=>{try{await F.post(`/api/lembretes/${x}/renovar`,{}),Se.success("Lembrete renovado com sucesso"),o()}catch{Se.error("Erro ao renovar lembrete")}},f=async x=>{if(window.confirm("Tem certeza que deseja cancelar este lembrete?"))try{await F.delete(`/api/lembretes/${x}`),Se.success("Lembrete cancelado"),o()}catch{Se.error("Erro ao cancelar lembrete")}},N=s.filter(x=>x.dias_restantes<=7),d=s.filter(x=>x.dias_restantes<0);return e.jsxs("div",{className:"lembretes-container",children:[e.jsxs("div",{className:"lembretes-header",children:[e.jsx("h1",{children:"ðŸ“Œ Lembretes de RecorrÃªncia"}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-number",children:s.length}),e.jsx("span",{className:"stat-label",children:"Total de Lembretes"})]}),e.jsxs("div",{className:"stat-card warning",children:[e.jsx("span",{className:"stat-number",children:N.length}),e.jsx("span",{className:"stat-label",children:"PrÃ³ximos em 7 dias"})]}),e.jsxs("div",{className:"stat-card danger",children:[e.jsx("span",{className:"stat-number",children:d.length}),e.jsx("span",{className:"stat-label",children:"Vencidos"})]})]})]}),t&&e.jsx("div",{className:"loading",children:"Carregando lembretes..."}),s.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(Co,{size:48}),e.jsx("h2",{children:"Nenhum lembrete pendente"}),e.jsx("p",{children:"Lembretes serÃ£o criados automaticamente para produtos recorrentes."})]}):e.jsxs("div",{className:"lembretes-list",children:[d.length>0&&e.jsxs("div",{className:"section",children:[e.jsx("h3",{className:"section-title danger",children:"âš ï¸ Vencidos"}),d.map(x=>e.jsx(xr,{lembrete:x,onCompletar:v,onRenovar:j,onCancelar:f},x.id))]}),N.length>0&&e.jsxs("div",{className:"section",children:[e.jsx("h3",{className:"section-title warning",children:"ðŸ”” PrÃ³ximos em atÃ© 7 dias"}),N.map(x=>e.jsx(xr,{lembrete:x,onCompletar:v,onRenovar:j,onCancelar:f},x.id))]}),s.filter(x=>x.dias_restantes>7).length>0&&e.jsxs("div",{className:"section",children:[e.jsx("h3",{className:"section-title",children:"ðŸ“… PrÃ³ximos (mais de 7 dias)"}),s.filter(x=>x.dias_restantes>7).map(x=>e.jsx(xr,{lembrete:x,onCompletar:v,onRenovar:j,onCancelar:f},x.id))]})]})]})}function xr({lembrete:s,onCompletar:l,onRenovar:t,onCancelar:m}){const r=s.dias_restantes,g=new Date(s.data_proxima_dose),o=r<0?"vencido":r<=7?"proximo":"futuro",v=s.dose_total&&s.dose_total>0,j=v?s.dose_atual/s.dose_total*100:0;return e.jsxs("div",{className:`lembrete-card ${o}`,children:[e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h4",{children:s.produto_nome}),e.jsxs("div",{className:"badges",children:[v&&e.jsxs("span",{className:"dose-badge",children:["Dose ",s.dose_atual,"/",s.dose_total]}),e.jsx("span",{className:`status-badge ${o}`,children:r<0?"VENCIDO":`${Math.abs(r)}d`})]})]}),v&&e.jsx("div",{className:"progress-bar-container",children:e.jsx("div",{className:"progress-bar",style:{width:`${j}%`}})}),e.jsxs("div",{className:"card-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"Pet:"}),e.jsx("span",{className:"value",children:s.pet_nome})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"Data:"}),e.jsx("span",{className:"value",children:g.toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"Quantidade:"}),e.jsx("span",{className:"value",children:s.quantidade})]}),s.preco_estimado&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"PreÃ§o Est.:"}),e.jsxs("span",{className:"value",children:["R$ ",s.preco_estimado.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"card-actions",children:[e.jsxs("button",{className:"btn btn-success",onClick:()=>l(s.id),title:"Marcar como completado",children:[e.jsx(ws,{})," Comprado"]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>t(s.id),title:"Renovar lembrete",children:[e.jsx(vt,{})," Renovar"]}),e.jsx("button",{className:"btn btn-danger",onClick:()=>m(s.id),title:"Cancelar lembrete",children:e.jsx(ps,{})})]})]})}function An(){const[s,l]=a.useState([]),[t,m]=a.useState([]),[r,g]=a.useState(!1),[o,v]=a.useState({pet_id:"",pet_nome:"",produto_id:"",produto_nome:"",categoria_racao:"",peso_pet_kg:"",idade_meses:"",nivel_atividade:"normal",classificacao:"",especies:"dog",produto_comparar_id:"",produto_comparar_nome:""}),[j,f]=a.useState(null),[N,d]=a.useState([]);a.useEffect(()=>{x(),k()},[]);const x=async()=>{var p,i,u;try{console.log("ðŸ” Iniciando carregamento de produtos...");const n=await F.get("/produtos/");console.log("ðŸ“¡ Resposta da API:",{status:n.status,dataType:typeof n.data,isArray:Array.isArray(n.data),dataPreview:typeof n.data=="string"?n.data.substring(0,200):"object"});let C=n.data;if(typeof C=="string"){console.warn("âš ï¸ API retornou string, tentando parsear JSON...");try{C=JSON.parse(C)}catch(E){console.error("âŒ Erro ao parsear JSON:",E),console.error("âŒ ConteÃºdo recebido:",C.substring(0,500)),Se.error("Erro: resposta da API invÃ¡lida");return}}const h=Array.isArray(C)?C:C.items||C.produtos||[];console.log("ðŸ“¦ Total de produtos recebidos:",h.length),console.log("ðŸ“¦ Estrutura da resposta:",Array.isArray(C)?"Array direto":`Objeto com keys: ${Object.keys(C).join(", ")}`),h.length>0&&console.log("ðŸ“¦ Estrutura do primeiro produto:",h[0]);const _=h.filter(E=>E.peso_embalagem&&E.peso_embalagem>0);console.log("ðŸ¥« RaÃ§Ãµes encontradas:",_.length),console.log("ðŸ“Š Total de produtos:",h.length),_.length>0?console.log("ðŸ¥« IDs das raÃ§Ãµes:",_.map(E=>`${E.id}-${E.nome}`)):console.log("âš ï¸ Produtos sem peso_embalagem:",h.slice(0,5).map(E=>({id:E.id,nome:E.nome,peso_embalagem:E.peso_embalagem,categoria_racao:E.categoria_racao,classificacao_racao:E.classificacao_racao}))),l(_),_.length===0&&h.length>0?(console.warn("âš ï¸ Produtos encontrados, mas nenhum tem peso de embalagem configurado"),Se.error(`${h.length} produtos encontrados, mas nenhum tem PESO DE EMBALAGEM configurado. Edite os produtos de raÃ§Ã£o e preencha o campo "Peso da Embalagem (kg)".`,{duration:6e3})):_.length===0&&(console.log("â„¹ï¸ Nenhum produto encontrado"),Se.error("Nenhum produto encontrado. Cadastre produtos primeiro."))}catch(n){console.error("âŒ Erro ao carregar produtos:",n),console.error("âŒ Detalhes:",((p=n.response)==null?void 0:p.data)||n.message),Se.error(`Erro ao carregar produtos: ${((u=(i=n.response)==null?void 0:i.data)==null?void 0:u.detail)||n.message}`)}},k=async()=>{try{const p=await F.get("/clientes/pets/todos"),i=Array.isArray(p.data)?p.data:[];m(i),console.log("ðŸ¾ Pets carregados:",i.length)}catch(p){console.error("âŒ Erro ao carregar pets:",p)}},w=p=>{const i=t.find(u=>u.id===parseInt(p));if(i){let u="";if(i.data_nascimento){const C=new Date(i.data_nascimento),_=Math.abs(new Date-C);u=Math.floor(_/(1e3*60*60*24*30.44)).toString()}const n=i.especie==="Cachorro"?"dog":i.especie==="Gato"?"cat":o.especies;v({...o,pet_id:p,pet_nome:`${i.nome} - ${i.especie} ${i.peso?`(${i.peso}kg)`:""}`,peso_pet_kg:i.peso||"",idade_meses:u,especies:n}),Se.success(`Pet ${i.nome} selecionado!`)}else v({...o,pet_id:"",peso_pet_kg:"",idade_meses:""})},c=async()=>{var p,i;if(!o.peso_pet_kg){Se.error("Informe o peso do pet");return}if(o.categoria_racao==="filhote"&&!o.idade_meses){Se.error("âš ï¸ Idade Ã© obrigatÃ³ria para raÃ§Ãµes de filhote!");return}try{g(!0);const u=await F.post("/api/produtos/calculadora-racao",{produto_id:o.produto_id?parseInt(o.produto_id):null,peso_pet_kg:parseFloat(o.peso_pet_kg),idade_meses:o.idade_meses?parseInt(o.idade_meses):null,nivel_atividade:o.nivel_atividade});f(u.data),d([]),Se.success("CÃ¡lculo realizado!")}catch(u){console.error("Erro:",u),Se.error(((i=(p=u.response)==null?void 0:p.data)==null?void 0:i.detail)||"Erro ao calcular")}finally{g(!1)}},b=async()=>{var p,i;if(!o.peso_pet_kg){Se.error("Informe o peso do pet");return}try{if(g(!0),o.produto_comparar_id){const n=(await F.post("/api/produtos/calculadora-racao",{produto_id:parseInt(o.produto_comparar_id),peso_pet_kg:parseFloat(o.peso_pet_kg),idade_meses:o.idade_meses?parseInt(o.idade_meses):null,nivel_atividade:o.nivel_atividade})).data;if(o.produto_id){const C=await F.post("/api/produtos/calculadora-racao",{produto_id:parseInt(o.produto_id),peso_pet_kg:parseFloat(o.peso_pet_kg),idade_meses:o.idade_meses?parseInt(o.idade_meses):null,nivel_atividade:o.nivel_atividade});if(C.data.produto_id===n.produto_id)d([C.data]),Se.success("Mostrando cÃ¡lculo da raÃ§Ã£o selecionada");else{const h=[C.data,n];d(h),Se.success("Comparando 2 raÃ§Ãµes selecionadas!")}}else d([n]),Se.success("Mostrando cÃ¡lculo da raÃ§Ã£o selecionada")}else{const u={peso_pet_kg:parseFloat(o.peso_pet_kg),nivel_atividade:o.nivel_atividade};o.idade_meses&&(u.idade_meses=parseInt(o.idade_meses)),o.classificacao&&(u.classificacao=o.classificacao),o.especies&&(u.especies=o.especies);let C=(await F.post("/api/produtos/comparar-racoes",null,{params:u})).data.racoes||[];if(o.produto_id){C=C.filter(K=>K.produto_id!==parseInt(o.produto_id));const $=(await F.post("/api/produtos/calculadora-racao",{produto_id:parseInt(o.produto_id),peso_pet_kg:parseFloat(o.peso_pet_kg),idade_meses:o.idade_meses?parseInt(o.idade_meses):null,nivel_atividade:o.nivel_atividade})).data;C.sort((K,te)=>K.custo_por_dia-te.custo_por_dia),C=[$,...C]}const h=C.slice(0,10);d(h),C.length===0&&Se.error("Nenhuma raÃ§Ã£o encontrada com esses filtros. Tente outros critÃ©rios.")}}catch(u){console.error("Erro:",u),Se.error(((i=(p=u.response)==null?void 0:p.data)==null?void 0:i.detail)||"Erro ao comparar")}finally{g(!1)}};return e.jsxs("div",{className:"calculadora-racao-container",children:[e.jsxs("div",{className:"header",children:[e.jsx("h1",{children:"ðŸ¥« Calculadora de RaÃ§Ã£o"}),e.jsx("p",{children:"Calcule duraÃ§Ã£o, custo/dia e compare produtos"})]}),e.jsxs("div",{className:"calculadora-grid",children:[e.jsxs("div",{className:"form-card",children:[e.jsx("h2",{children:"ðŸ“ Dados do Pet"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ðŸ¾ Buscar Pet Cadastrado"}),e.jsx("input",{type:"text",list:"pets-list",value:o.pet_nome||"",onChange:p=>{const i=p.target.value;v({...o,pet_nome:i});const u=t.find(n=>`${n.nome} - ${n.especie} ${n.peso?`(${n.peso}kg)`:""}`===i);u&&w(u.id)},placeholder:"Digite ou selecione um pet",className:"pet-select"}),e.jsx("datalist",{id:"pets-list",children:t.map(p=>e.jsx("option",{value:`${p.nome} - ${p.especie} ${p.peso?`(${p.peso}kg)`:""}`},p.id))}),e.jsx("small",{className:"form-hint",children:"ðŸ’¡ Digite ou selecione um pet para preencher automaticamente peso e idade"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Peso do Pet (kg) *"}),e.jsx("input",{type:"number",step:"0.1",value:o.peso_pet_kg,onChange:p=>v({...o,peso_pet_kg:p.target.value}),placeholder:"Ex: 8.5"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Idade (meses)",o.categoria_racao==="filhote"&&e.jsx("span",{style:{color:"#ff6b6b"},children:" *"})]}),e.jsx("input",{type:"number",value:o.idade_meses,onChange:p=>v({...o,idade_meses:p.target.value}),placeholder:o.categoria_racao==="filhote"?"ObrigatÃ³rio para filhotes!":"Ex: 24 (opcional)",required:o.categoria_racao==="filhote",style:o.categoria_racao==="filhote"?{borderColor:"#ff6b6b",borderWidth:"2px"}:{}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"NÃ­vel de Atividade"}),e.jsxs("select",{value:o.nivel_atividade,onChange:p=>v({...o,nivel_atividade:p.target.value}),children:[e.jsx("option",{value:"baixo",children:"Baixo"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"alto",children:"Alto"})]})]}),e.jsx("hr",{}),e.jsx("h3",{children:"ðŸ¥« RaÃ§Ã£o"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Selecionar RaÃ§Ã£o"}),e.jsx("input",{type:"text",list:"racoes-list",value:o.produto_nome||"",onChange:p=>{const i=p.target.value;v({...o,produto_nome:i});const u=s.find(n=>`${n.nome} - ${n.peso_embalagem}kg - R$ ${n.preco_venda}`===i);u&&v({...o,produto_id:u.id,produto_nome:i,categoria_racao:u.categoria_racao||""})},placeholder:"Digite ou selecione uma raÃ§Ã£o"}),e.jsx("datalist",{id:"racoes-list",children:s.map(p=>e.jsx("option",{value:`${p.nome} - ${p.peso_embalagem}kg - R$ ${p.preco_venda}`},p.id))}),o.categoria_racao==="filhote"&&e.jsx("small",{className:"form-hint",style:{color:"#ff6b6b",fontWeight:"bold"},children:"âš ï¸ RaÃ§Ã£o de filhote - idade Ã© obrigatÃ³ria!"})]}),e.jsx("div",{className:"button-group",children:e.jsx("button",{onClick:c,disabled:r,className:"btn-primary",children:r?"Calculando...":"ðŸ“Š Calcular"})}),e.jsx("hr",{}),e.jsx("h3",{children:"ðŸ” Comparar RaÃ§Ãµes"}),e.jsxs("div",{className:"info-box",children:[e.jsx("strong",{children:"ðŸ’¡ Dica:"})," Escolha UMA das opÃ§Ãµes abaixo:",e.jsx("br",{}),"â€¢ Selecione uma raÃ§Ã£o especÃ­fica para ver como ela se compara",e.jsx("br",{}),"â€¢ OU use os filtros gerais para ver todas de uma categoria"]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"â­ Comparar RaÃ§Ã£o EspecÃ­fica"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("input",{type:"text",list:"racoes-comparar-list",value:o.produto_comparar_nome||"",onChange:p=>{const i=p.target.value;if(i===""){v({...o,produto_comparar_id:"",produto_comparar_nome:""});return}v({...o,produto_comparar_nome:i,classificacao:""});const u=s.find(n=>`${n.nome} - ${n.classificacao_racao} - R$ ${n.preco_venda}`===i);u&&v({...o,produto_comparar_id:u.id,produto_comparar_nome:i,classificacao:""})},placeholder:"Digite ou selecione uma raÃ§Ã£o",disabled:o.classificacao!=="",style:{flex:1}}),o.produto_comparar_nome&&e.jsx("button",{type:"button",onClick:()=>v({...o,produto_comparar_id:"",produto_comparar_nome:""}),className:"btn-clear",title:"Limpar seleÃ§Ã£o",children:"âœ•"})]}),e.jsx("datalist",{id:"racoes-comparar-list",children:s.map(p=>e.jsx("option",{value:`${p.nome} - ${p.classificacao_racao} - R$ ${p.preco_venda}`},p.id))}),o.classificacao&&e.jsx("small",{className:"form-warning",children:"âš ï¸ Limpe o filtro de classificaÃ§Ã£o para usar esta opÃ§Ã£o"}),!o.produto_comparar_id&&!o.classificacao&&e.jsx("small",{className:"form-hint",children:"ðŸ’¡ Deixe vazio para comparar por classificaÃ§Ã£o abaixo"})]}),e.jsx("div",{className:"divider-text",children:"OU"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ðŸ“‹ Filtro por ClassificaÃ§Ã£o"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("select",{value:o.classificacao,onChange:p=>v({...o,classificacao:p.target.value,produto_comparar_id:"",produto_comparar_nome:""}),disabled:o.produto_comparar_id!=="",style:{flex:1},children:[e.jsx("option",{value:"",children:"Todas as classificaÃ§Ãµes"}),e.jsx("option",{value:"super_premium",children:"Super Premium"}),e.jsx("option",{value:"premium",children:"Premium"}),e.jsx("option",{value:"especial",children:"Especial"}),e.jsx("option",{value:"standard",children:"Standard"})]}),o.classificacao&&e.jsx("button",{type:"button",onClick:()=>v({...o,classificacao:""}),className:"btn-clear",title:"Limpar filtro",children:"âœ•"})]}),o.produto_comparar_id&&e.jsx("small",{className:"form-warning",children:"âš ï¸ Limpe a raÃ§Ã£o especÃ­fica acima para usar este filtro"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"EspÃ©cie"}),e.jsxs("select",{value:o.especies,onChange:p=>v({...o,especies:p.target.value}),children:[e.jsx("option",{value:"dog",children:"ðŸ¶ CÃ£es"}),e.jsx("option",{value:"cat",children:"ðŸ± Gatos"}),e.jsx("option",{value:"both",children:"Ambos"})]})]}),e.jsx("div",{className:"button-group",children:e.jsx("button",{onClick:b,disabled:r,className:"btn-secondary",children:r?"Comparando...":"ðŸ” Comparar Todas"})})]}),e.jsxs("div",{children:[j&&e.jsxs("div",{className:"result-card",children:[e.jsx("h2",{children:"ðŸ“Š Resultado do CÃ¡lculo"}),e.jsxs("div",{className:"result-header",children:[e.jsx("h3",{children:j.produto_nome}),j.classificacao&&e.jsx("span",{className:`badge badge-${j.classificacao}`,children:j.classificacao.replace("_"," ")})]}),e.jsxs("div",{className:"result-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"label",children:"Peso Embalagem"}),e.jsxs("span",{className:"value",children:[j.peso_embalagem_kg," kg"]})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"label",children:"PreÃ§o"}),e.jsxs("span",{className:"value",children:["R$ ",j.preco.toFixed(2)]})]})]}),e.jsxs("div",{className:"result-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"â±ï¸"}),e.jsxs("div",{children:[e.jsx("strong",{children:"DuraÃ§Ã£o"}),e.jsxs("p",{children:[j.duracao_dias," dias (",j.duracao_meses," meses)"]})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"ðŸ¥«"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Consumo diÃ¡rio"}),e.jsxs("p",{children:[j.quantidade_diaria_g,"g"]})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"ðŸ’°"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Custo/kg"}),e.jsxs("p",{children:["R$ ",j.custo_por_kg.toFixed(2)]})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"ðŸ“…"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Custo/dia"}),e.jsxs("p",{children:["R$ ",j.custo_por_dia.toFixed(2)]})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"ðŸ“†"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Custo mensal"}),e.jsxs("p",{children:["R$ ",j.custo_mensal.toFixed(2)]})]})]})]})]}),N.length>0&&e.jsxs("div",{className:"comparativo-card",children:[e.jsxs("h2",{children:["ðŸ† Comparativo de RaÃ§Ãµes (",N.length,")"]}),e.jsx("p",{className:"subtitle",children:"Ordenado por melhor custo-benefÃ­cio (menor custo diÃ¡rio)"}),e.jsx("div",{className:"comparativo-list",children:(()=>{const p=Math.min(...N.map(i=>i.custo_por_dia));return N.map((i,u)=>{const n=o.produto_id&&i.produto_id===parseInt(o.produto_id),C=i.custo_por_dia===p;return e.jsxs("div",{className:`comparativo-item ${C?"melhor":""} ${n?"selecionada":""}`,style:{position:"relative"},children:[n&&e.jsx("span",{className:"badge-selecionada",style:{position:"absolute",left:"10px",top:"10px",zIndex:10,fontSize:"11px",padding:"4px 8px",whiteSpace:"nowrap"},children:"â­ Selecionada"}),C&&e.jsx("span",{className:"badge-melhor",children:"ðŸ† Melhor Custo-BenefÃ­cio"}),e.jsxs("div",{className:"item-header",children:[e.jsxs("div",{children:[e.jsx("h4",{children:i.produto_nome}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginTop:"4px"},children:[i.classificacao&&e.jsx("span",{className:`badge badge-${i.classificacao}`,children:i.classificacao.replace("_"," ")}),e.jsxs("span",{style:{fontSize:"13px",color:"#64748b",backgroundColor:"#f1f5f9",padding:"2px 8px",borderRadius:"4px"},children:["ðŸ½ï¸ ",i.quantidade_diaria_g,"g/dia"]})]})]}),e.jsxs("div",{className:"item-price",children:["R$ ",i.preco.toFixed(2)]})]}),e.jsxs("div",{className:"item-stats",children:[e.jsxs("div",{className:"stat-small",children:[e.jsx("span",{className:"label",children:"Peso"}),e.jsxs("span",{children:[i.peso_embalagem_kg,"kg"]})]}),e.jsxs("div",{className:"stat-small",children:[e.jsx("span",{className:"label",children:"DuraÃ§Ã£o"}),e.jsxs("span",{children:[i.duracao_dias,"d"]})]}),e.jsxs("div",{className:"stat-small highlight",children:[e.jsx("span",{className:"label",children:"Custo/dia"}),e.jsxs("span",{children:["R$ ",i.custo_por_dia.toFixed(2)]})]}),e.jsxs("div",{className:"stat-small",children:[e.jsx("span",{className:"label",children:"Custo/mÃªs"}),e.jsxs("span",{children:["R$ ",i.custo_mensal.toFixed(2)]})]})]}),C&&N.length>1&&e.jsxs("div",{style:{marginTop:"12px",padding:"12px",backgroundColor:"#ecfdf5",borderLeft:"3px solid #10b981",borderRadius:"4px"},children:[e.jsx("p",{style:{margin:"0 0 6px 0",fontSize:"13px",fontWeight:"600",color:"#065f46"},children:"âœ¨ Por que esta Ã© a melhor opÃ§Ã£o?"}),e.jsxs("p",{style:{margin:"0",fontSize:"13px",color:"#047857",lineHeight:"1.5"},children:["Apesar de ",i.classificacao==="premium"||i.classificacao==="super_premium"?`ter um preÃ§o mais alto (R$ ${i.preco.toFixed(2)})`:`custar R$ ${i.preco.toFixed(2)}`,", esta raÃ§Ã£o ",i.classificacao==="super_premium"?"super premium Ã© muito concentrada em nutrientes":i.classificacao==="premium"?"premium tem melhor densidade nutricional":"tem excelente eficiÃªncia alimentar",", entÃ£o seu pet consome apenas ",e.jsxs("strong",{children:[i.quantidade_diaria_g,"g por dia"]}),".",N[1]&&e.jsxs(e.Fragment,{children:[" Em comparaÃ§Ã£o, a segunda opÃ§Ã£o requer ",e.jsxs("strong",{children:[N[1].quantidade_diaria_g,"g/dia"]}),", resultando em um custo diÃ¡rio ",e.jsxs("strong",{children:["R$ ",(N[1].custo_por_dia-i.custo_por_dia).toFixed(2)," maior"]}),"(R$ ",i.custo_por_dia.toFixed(2)," vs R$ ",N[1].custo_por_dia.toFixed(2),")."]})]})]})]},i.produto_id)})})()})]})]})]})]})}const Dn=()=>{var te;const s=fa(),[l]=lr(),t=l.get("cliente_id"),[m,r]=a.useState([]),[g,o]=a.useState([]),[v,j]=a.useState(!0),[f,N]=a.useState(""),[d,x]=a.useState(""),[k,w]=a.useState(t||""),[c,b]=a.useState(""),[p,i]=a.useState(""),[u,n]=a.useState(!1);a.useEffect(()=>{C(),h()},[k,c,p]);const C=async()=>{try{j(!0);const M=new URLSearchParams;d&&M.append("busca",d),k&&M.append("cliente_id",k),c&&M.append("especie",c),p&&M.append("ativo",p==="ativo"?"true":"false");const A=await F.get(`/pets?${M.toString()}`);r(A.data),N("")}catch(M){console.error("Erro ao carregar pets:",M),N("Erro ao carregar pets")}finally{j(!1)}},h=async()=>{try{const M=await F.get("/clientes/");o(M.data)}catch(M){console.error("Erro ao carregar clientes:",M)}},_=M=>{M.preventDefault(),C()},E=()=>{x(""),w(""),b(""),i("")},$=M=>{if(!M)return null;const A=new Date,Q=new Date(M),re=A.getFullYear()-Q.getFullYear(),q=A.getMonth()-Q.getMonth();return re===0?`${q} ${q===1?"mÃªs":"meses"}`:`${re} ${re===1?"ano":"anos"}`},K=async M=>{try{M.ativo?await F.delete(`/pets/${M.id}?soft_delete=true`):await F.post(`/pets/${M.id}/ativar`),C()}catch(A){console.error("Erro ao alterar status do pet:",A),alert("Erro ao alterar status do pet")}};return v?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando pets..."})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(Ea,{className:"text-blue-600",size:36}),"Gerenciamento de Pets"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:k?`Pets do cliente: ${((te=g.find(M=>M.id===parseInt(k)))==null?void 0:te.nome)||""}`:"GestÃ£o completa dos animais de estimaÃ§Ã£o"})]}),e.jsxs("button",{onClick:()=>s("/pets/novo"),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(Qa,{size:20}),"Adicionar Pet"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Fo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por nome, raÃ§a, microchip ou cÃ³digo...",value:d,onChange:M=>x(M.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:"Buscar"}),e.jsxs("button",{type:"button",onClick:()=>n(!u),className:"px-4 py-2 border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(kr,{}),"Filtros"]})]}),u&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cliente (Tutor)"}),e.jsxs("select",{value:k,onChange:M=>w(M.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Todos os clientes"}),g.map(M=>e.jsx("option",{value:M.id,children:M.nome},M.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EspÃ©cie"}),e.jsxs("select",{value:c,onChange:M=>b(M.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Todas as espÃ©cies"}),e.jsx("option",{value:"CÃ£o",children:"CÃ£o"}),e.jsx("option",{value:"Gato",children:"Gato"}),e.jsx("option",{value:"Ave",children:"Ave"}),e.jsx("option",{value:"Roedor",children:"Roedor"}),e.jsx("option",{value:"RÃ©ptil",children:"RÃ©ptil"}),e.jsx("option",{value:"Outro",children:"Outro"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:p,onChange:M=>i(M.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"ativo",children:"Ativos"}),e.jsx("option",{value:"inativo",children:"Inativos"})]})]}),e.jsx("div",{className:"col-span-3 flex justify-end",children:e.jsxs("button",{type:"button",onClick:E,className:"px-4 py-2 text-gray-600 hover:text-gray-900 flex items-center gap-2",children:[e.jsx(us,{}),"Limpar filtros"]})})]})]})}),f&&e.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(Na,{}),f]}),m.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(Ea,{className:"mx-auto text-gray-300 mb-4",size:64}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Nenhum pet encontrado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:d||k||c||p?"Tente ajustar os filtros ou fazer uma nova busca":"Comece adicionando o primeiro pet"}),e.jsxs("button",{onClick:()=>s("/pets/novo"),className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(Qa,{}),"Adicionar Primeiro Pet"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(M=>e.jsx("div",{className:`bg-white rounded-lg shadow-sm border-2 transition-all hover:shadow-md ${M.ativo?"border-gray-200":"border-red-200 bg-gray-50"}`,children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:M.nome}),M.ativo?e.jsx(ws,{className:"text-green-500",size:16}):e.jsx(br,{className:"text-red-500",size:16})]}),e.jsx("p",{className:"text-sm text-gray-500",children:M.codigo})]}),M.foto_url&&e.jsx("img",{src:M.foto_url,alt:M.nome,className:"w-16 h-16 rounded-full object-cover border-2 border-gray-200"})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"EspÃ©cie:"}),e.jsx("span",{className:"text-gray-900",children:M.especie})]}),M.raca&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"RaÃ§a:"}),e.jsx("span",{className:"text-gray-900",children:M.raca})]}),M.sexo&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Sexo:"}),e.jsx("span",{className:"text-gray-900",children:M.sexo})]}),M.data_nascimento&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Idade:"}),e.jsx("span",{className:"text-gray-900",children:$(M.data_nascimento)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm pt-2 border-t border-gray-100",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Tutor:"}),e.jsx("span",{className:"text-blue-600",children:M.cliente_nome})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>s(`/pets/${M.id}`),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium",children:[e.jsx(Xt,{size:16}),"Ver Detalhes"]}),e.jsx("button",{onClick:()=>s(`/pets/${M.id}/editar`),className:"px-3 py-2 border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors",title:"Editar",children:e.jsx(_s,{size:16,className:"text-gray-600"})}),e.jsx("button",{onClick:()=>K(M),className:`px-3 py-2 border rounded-lg transition-colors ${M.ativo?"border-red-300 hover:bg-red-50 text-red-600":"border-green-300 hover:bg-green-50 text-green-600"}`,title:M.ativo?"Desativar":"Reativar",children:M.ativo?e.jsx(br,{size:16}):e.jsx(ws,{size:16})})]})]})},M.id))}),m.length>0&&e.jsxs("div",{className:"mt-6 text-center text-sm text-gray-600",children:["Total: ",e.jsx("strong",{children:m.length})," pet(s) encontrado(s)",p===""&&e.jsxs(e.Fragment,{children:[" â€¢ ",e.jsx("strong",{className:"text-green-600",children:m.filter(M=>M.ativo).length})," ativo(s)"," â€¢ ",e.jsx("strong",{className:"text-red-600",children:m.filter(M=>!M.ativo).length})," inativo(s)"]})]})]})};function Mn(s){if(!s)return null;const l=typeof s=="string"?new Date(s):s,t=new Date,m=t.getFullYear()-l.getFullYear(),r=t.getMonth()-l.getMonth();return m*12+r}function jt(s){if(!s)return"-";const l=Math.floor(s/12),t=s%12;return l===0?`${s} ${s===1?"mÃªs":"meses"}`:t===0?`${l} ${l===1?"ano":"anos"}`:`${l} ${l===1?"ano":"anos"} e ${t} ${t===1?"mÃªs":"meses"}`}function Ln(s){if(!s)return null;const l=s.toString().toLowerCase().trim();if(/^\d+$/.test(l))return parseInt(l);const t=/(\d+(?:[.,]\d+)?)\s*anos?\s*(?:e\s*)?(\d+)?\s*meses?/i,m=l.match(t);if(m){const j=parseFloat(m[1].replace(",",".")),f=m[2]?parseInt(m[2]):0;return Math.round(j*12)+f}const r=/(\d+(?:[.,]\d+)?)\s*anos?/i,g=l.match(r);if(g){const j=parseFloat(g[1].replace(",","."));return Math.round(j*12)}const o=/(\d+)\s*meses?/i,v=l.match(o);return v?parseInt(v[1]):null}const qn=()=>{const{petId:s}=Bs(),l=fa(),[t,m]=a.useState(null),[r,g]=a.useState(!0),[o,v]=a.useState(""),[j,f]=a.useState("geral");a.useEffect(()=>{N()},[s]);const N=async()=>{try{g(!0);const c=await F.get(`/pets/${s}`);m(c.data),v("")}catch(c){console.error("Erro ao carregar pet:",c),v("Erro ao carregar informaÃ§Ãµes do pet")}finally{g(!1)}},d=c=>{if(!c)return null;const b=new Date,p=new Date(c),i=b.getFullYear()-p.getFullYear(),u=b.getMonth()-p.getMonth();return i===0?`${u} ${u===1?"mÃªs":"meses"}`:u<0?`${i-1} anos e ${12+u} meses`:u===0?`${i} ${i===1?"ano":"anos"}`:`${i} anos e ${u} ${u===1?"mÃªs":"meses"}`},x=c=>c?new Date(c).toLocaleDateString("pt-BR"):"-",k=async()=>{try{t.ativo?await F.delete(`/pets/${t.id}?soft_delete=true`):await F.post(`/pets/${t.id}/ativar`),N()}catch(c){console.error("Erro ao alterar status do pet:",c),alert("Erro ao alterar status do pet")}};if(r)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando..."})]})});if(o||!t)return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(Na,{}),o||"Pet nÃ£o encontrado"]}),e.jsxs("button",{onClick:()=>l("/pets"),className:"mt-4 flex items-center gap-2 text-blue-600 hover:text-blue-700",children:[e.jsx(rt,{}),"Voltar para lista de pets"]})]});const w=[{id:"geral",label:"Dados Gerais",icon:gl},{id:"saude",label:"SaÃºde",icon:Cr},{id:"vacinas",label:"Vacinas",icon:eo},{id:"consultas",label:"Consultas",icon:os},{id:"servicos",label:"ServiÃ§os",icon:Ea}];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>l("/pets"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(rt,{}),"Voltar para Gerenciamento de Pets"]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[t.foto_url?e.jsx("img",{src:t.foto_url,alt:t.nome,className:"w-24 h-24 rounded-full object-cover border-4 border-gray-200"}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-blue-100 flex items-center justify-center border-4 border-gray-200",children:e.jsx(Ea,{className:"text-blue-600",size:48})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:t.nome}),t.ativo?e.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium flex items-center gap-1",children:[e.jsx(ws,{size:14}),"Ativo"]}):e.jsxs("span",{className:"px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-medium flex items-center gap-1",children:[e.jsx(br,{size:14}),"Inativo"]})]}),e.jsxs("p",{className:"text-gray-500 mb-1",children:[t.especie," ",t.raca&&`â€¢ ${t.raca}`," ",t.sexo&&`â€¢ ${t.sexo}`]}),e.jsx("p",{className:"text-sm text-gray-400",children:t.codigo}),e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(is,{size:16}),e.jsx("span",{className:"font-medium",children:"Tutor:"}),e.jsx("span",{className:"text-blue-600",children:t.cliente_nome})]}),t.cliente_celular&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx($o,{size:16}),e.jsx("span",{children:t.cliente_celular})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>l(`/pets/${t.id}/editar`),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(_s,{}),"Editar"]}),e.jsx("button",{onClick:k,className:`px-4 py-2 border-2 rounded-lg transition-colors font-medium ${t.ativo?"border-red-300 text-red-600 hover:bg-red-50":"border-green-300 text-green-600 hover:bg-green-50"}`,children:t.ativo?"Desativar":"Reativar"})]})]})})]}),e.jsx("div",{className:"mb-6 border-b border-gray-200",children:e.jsx("div",{className:"flex gap-4",children:w.map(c=>{const b=c.icon;return e.jsxs("button",{onClick:()=>f(c.id),className:`flex items-center gap-2 px-4 py-3 font-medium border-b-2 transition-colors ${j===c.id?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[e.jsx(b,{size:18}),c.label]},c.id)})})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[j==="geral"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"InformaÃ§Ãµes Gerais"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("p",{className:"text-gray-900 font-medium",children:t.nome})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CÃ³digo"}),e.jsx("p",{className:"text-gray-900 font-mono text-sm",children:t.codigo})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EspÃ©cie"}),e.jsx("p",{className:"text-gray-900",children:t.especie})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"RaÃ§a"}),e.jsx("p",{className:"text-gray-900",children:t.raca||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sexo"}),e.jsx("p",{className:"text-gray-900",children:t.sexo||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Castrado"}),e.jsx("p",{className:"text-gray-900",children:t.castrado?"Sim":"NÃ£o"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Nascimento"}),e.jsx("p",{className:"text-gray-900",children:x(t.data_nascimento)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Idade"}),e.jsx("p",{className:"text-gray-900",children:t.idade_meses?jt(t.idade_meses):t.idade_aproximada?jt(t.idade_aproximada):t.data_nascimento?d(t.data_nascimento):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Peso"}),e.jsx("p",{className:"text-gray-900",children:t.peso?`${t.peso} kg`:"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Porte"}),e.jsx("p",{className:"text-gray-900",children:t.porte||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor/Pelagem"}),e.jsx("p",{className:"text-gray-900",children:t.cor||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Microchip"}),e.jsx("p",{className:"text-gray-900 font-mono text-sm",children:t.microchip||"-"})]})]}),t.observacoes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ObservaÃ§Ãµes"}),e.jsx("p",{className:"text-gray-900 bg-gray-50 p-3 rounded-lg",children:t.observacoes})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 text-sm text-gray-500",children:[e.jsxs("p",{children:["Cadastrado em: ",x(t.created_at)]}),e.jsxs("p",{children:["Ãšltima atualizaÃ§Ã£o: ",x(t.updated_at)]})]})]}),j==="saude"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"InformaÃ§Ãµes de SaÃºde"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Alergias"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-900",children:t.alergias||"Nenhuma alergia registrada"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"DoenÃ§as CrÃ´nicas"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-900",children:t.doencas_cronicas||"Nenhuma doenÃ§a crÃ´nica registrada"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Medicamentos ContÃ­nuos"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-900",children:t.medicamentos_continuos||"Nenhum medicamento contÃ­nuo registrado"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"HistÃ³rico ClÃ­nico"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-900 whitespace-pre-line",children:t.historico_clinico||"Nenhum histÃ³rico clÃ­nico registrado"})})]})]})]}),j==="vacinas"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Carteira de VacinaÃ§Ã£o"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium",children:"+ Registrar Vacina"})]}),e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(eo,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"MÃ³dulo em desenvolvimento"}),e.jsx("p",{className:"text-sm",children:"Em breve vocÃª poderÃ¡ gerenciar o histÃ³rico de vacinas do pet"})]})]}),j==="consultas"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"HistÃ³rico de Consultas"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium",children:"+ Nova Consulta"})]}),e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(os,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"MÃ³dulo em desenvolvimento"}),e.jsx("p",{className:"text-sm",children:"Em breve vocÃª poderÃ¡ gerenciar consultas veterinÃ¡rias"})]})]}),j==="servicos"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"HistÃ³rico de ServiÃ§os"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium",children:"+ Registrar ServiÃ§o"})]}),e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Ea,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"MÃ³dulo em desenvolvimento"}),e.jsx("p",{className:"text-sm",children:"Em breve vocÃª poderÃ¡ gerenciar banho, tosa e outros serviÃ§os"})]})]})]})]})};function zn({value:s,onChange:l,name:t="idade",label:m="Idade",className:r="",mostrarDataNascimento:g=!0,required:o=!1}){const[v,j]=a.useState("texto"),[f,N]=a.useState(""),[d,x]=a.useState(""),[k,w]=a.useState("");a.useEffect(()=>{s&&typeof s=="number"&&N(jt(s))},[s]);const c=u=>{const n=u.target.value;N(n),n||(w(""),l(null))},b=()=>{if(!f){w(""),l(null);return}const u=Ln(f);if(u!==null){const n=jt(u);N(n),w(`âœ“ ${n}`),l(u)}else w("âš ï¸ Formato invÃ¡lido. Ex: 12 meses, 2 anos, 1.5 anos"),l(null)},p=u=>{const n=u.target.value;if(x(n),!n){w(""),l(null);return}const C=Mn(n);C!==null?(w(`âœ“ ${jt(C)}`),l(C)):(w("âš ï¸ Data invÃ¡lida"),l(null))},i=()=>{j(v==="texto"?"data":"texto"),N(""),x(""),w(""),l(null)};return e.jsxs("div",{className:r,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[m,o&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),g&&e.jsx("button",{type:"button",onClick:i,className:"text-xs text-blue-600 hover:text-blue-800 underline",children:v==="texto"?"ðŸ“… Usar data de nascimento":"âŒ¨ï¸ Digitar idade"})]}),v==="texto"?e.jsxs("div",{children:[e.jsx("input",{type:"text",name:t,value:f,onChange:c,onBlur:b,placeholder:"Ex: 12 meses, 2 anos, 1.5 anos, 2anos6meses",className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:o}),k&&e.jsx("p",{className:`text-xs mt-1 ${k.startsWith("âœ“")?"text-green-600":"text-orange-600"}`,children:k}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Digite a idade e pressione Tab ou clique fora do campo"})]}):e.jsxs("div",{children:[e.jsx("input",{type:"date",name:t,value:d,onChange:p,max:new Date().toISOString().split("T")[0],className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:o}),k&&e.jsx("p",{className:`text-xs mt-1 ${k.startsWith("âœ“")?"text-green-600":"text-orange-600"}`,children:k}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Data de nascimento do pet"})]})]})}const In=({tipo:s,especieId:l,especieNome:t,onSuccess:m,onClose:r})=>{const[g,o]=a.useState(""),[v,j]=a.useState(!1),[f,N]=a.useState(""),d=async x=>{var k,w;if(x.preventDefault(),N(""),!g||g.trim()===""){N(`O nome ${s==="especie"?"da espÃ©cie":"da raÃ§a"} Ã© obrigatÃ³rio`);return}try{j(!0);let c;if(s==="especie")c=await F.post("/cadastros/especies",{nome:g.trim(),ativo:!0});else{if(!l){N("Selecione uma espÃ©cie primeiro");return}c=await F.post("/cadastros/racas",{nome:g.trim(),especie_id:l,ativo:!0})}m&&m(c.data),r()}catch(c){console.error("Erro ao salvar:",c),N(((w=(k=c.response)==null?void 0:k.data)==null?void 0:w.detail)||"Erro ao salvar")}finally{j(!1)}};return e.jsx("div",{className:"quick-modal-overlay",onClick:r,children:e.jsxs("div",{className:"quick-modal-content",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"quick-modal-header",children:[e.jsxs("h3",{children:[s==="especie"?"ðŸ¾ Nova EspÃ©cie":"âœ¨ Nova RaÃ§a",s==="raca"&&t&&e.jsxs("span",{className:"quick-subtitle",children:[" - ",t]})]}),e.jsx("button",{className:"quick-btn-close",onClick:r,children:e.jsx(us,{})})]}),e.jsxs("form",{onSubmit:d,children:[e.jsxs("div",{className:"quick-modal-body",children:[f&&e.jsxs("div",{className:"quick-alert quick-alert-danger",children:[e.jsx(Na,{})," ",f]}),e.jsxs("div",{className:"quick-form-group",children:[e.jsxs("label",{children:["Nome ",s==="especie"?"da EspÃ©cie":"da RaÃ§a"," *"]}),e.jsx("input",{type:"text",value:g,onChange:x=>o(x.target.value),placeholder:s==="especie"?"Ex: CÃ£o, Gato, Ave...":"Ex: Labrador, SRD, SiamÃªs...",required:!0,autoFocus:!0,disabled:v})]}),e.jsx("div",{className:"quick-info",children:e.jsxs("p",{children:["ðŸ’¡ ",s==="especie"?"Esta espÃ©cie ficarÃ¡ disponÃ­vel para todos os pets":`Esta raÃ§a serÃ¡ adicionada Ã  espÃ©cie "${t}"`]})})]}),e.jsxs("div",{className:"quick-modal-footer",children:[e.jsx("button",{type:"button",className:"quick-btn quick-btn-secondary",onClick:r,disabled:v,children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"quick-btn quick-btn-primary",disabled:v,children:[e.jsx(Is,{})," ",v?"Salvando...":"Salvar"]})]})]})]})})},uo=()=>{var J,S;const{petId:s}=Bs(),l=fa(),t=_r(),m=!!s,r=(J=t.state)==null?void 0:J.clienteId,[g,o]=a.useState(!1),[v,j]=a.useState(!1),[f,N]=a.useState(""),[d,x]=a.useState(""),[k,w]=a.useState([]),[c,b]=a.useState([]),[p,i]=a.useState([]),[u,n]=a.useState(!1),[C,h]=a.useState(null),[_,E]=a.useState({cliente_id:r||"",nome:"",especie:"",raca:"",sexo:"",castrado:!1,data_nascimento:"",idade_aproximada:"",peso:"",cor:"",porte:"",microchip:"",alergias:"",doencas_cronicas:"",medicamentos_continuos:"",historico_clinico:"",observacoes:"",foto_url:"",ativo:!0});a.useEffect(()=>{(async()=>{await $(),await K(),m&&await M()})()},[s]),a.useEffect(()=>{_.especie?te(_.especie):i([])},[_.especie]);const $=async()=>{try{const P=await F.get("/clientes/");w(P.data)}catch(P){console.error("Erro ao carregar clientes:",P)}},K=async()=>{try{const P=await F.get("/cadastros/especies",{params:{ativo:!0}});b(P.data)}catch(P){console.error("Erro ao carregar espÃ©cies:",P)}},te=async P=>{try{const G=await F.get("/cadastros/racas",{params:{ativo:!0,especie_id:P}});i(G.data)}catch(G){console.error("Erro ao carregar raÃ§as:",G),i([])}},M=async()=>{try{o(!0);const G=(await F.get(`/pets/${s}`)).data,B=c.find(y=>y.nome===G.especie);E({cliente_id:G.cliente_id||"",nome:G.nome||"",especie:B?B.id.toString():"",raca:G.raca||"",sexo:G.sexo||"",castrado:G.castrado||!1,data_nascimento:"",idade_aproximada:G.idade_meses||G.idade_aproximada||"",peso:G.peso||"",cor:G.cor||"",porte:G.porte||"",microchip:G.microchip||"",alergias:G.alergias||"",doencas_cronicas:G.doencas_cronicas||"",medicamentos_continuos:G.medicamentos_continuos||"",historico_clinico:G.historico_clinico||"",observacoes:G.observacoes||"",foto_url:G.foto_url||"",ativo:G.ativo!==void 0?G.ativo:!0})}catch(P){console.error("Erro ao carregar pet:",P),N("Erro ao carregar informaÃ§Ãµes do pet")}finally{o(!1)}},A=P=>{const{name:G,value:B,type:y,checked:O}=P.target;E(z=>({...z,[G]:y==="checkbox"?O:B}))},Q=P=>{h(P),n(!0)},re=()=>{n(!1),h(null)},q=P=>{C==="especie"?K().then(()=>{E(G=>({...G,especie:P.id.toString()}))}):C==="raca"&&_.especie&&te(_.especie).then(()=>{E(G=>({...G,raca:P.nome}))})},Z=()=>_.nome.trim()?_.especie?_.cliente_id?!0:(N("Cliente (tutor) Ã© obrigatÃ³rio"),!1):(N("EspÃ©cie Ã© obrigatÃ³ria"),!1):(N("Nome do pet Ã© obrigatÃ³rio"),!1),R=async P=>{var G,B;if(P.preventDefault(),N(""),x(""),!!Z())try{j(!0);const y=c.find(z=>z.id===parseInt(_.especie)),O={..._,especie:(y==null?void 0:y.nome)||_.especie,cliente_id:parseInt(_.cliente_id),peso:_.peso?parseFloat(_.peso):null,idade_aproximada:_.idade_aproximada?parseInt(_.idade_aproximada):null,data_nascimento:_.data_nascimento||null};if(m)await F.put(`/pets/${s}`,O),x("Pet atualizado com sucesso!"),setTimeout(()=>l(`/pets/${s}`),1500);else{const z=await F.post("/pets",O);x("Pet cadastrado com sucesso!"),setTimeout(()=>l(`/pets/${z.data.id}`),1500)}}catch(y){console.error("Erro ao salvar pet:",y),N(((B=(G=y.response)==null?void 0:G.data)==null?void 0:B.detail)||"Erro ao salvar pet")}finally{j(!1)}};return g?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando..."})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>l(m?`/pets/${s}`:"/pets"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(rt,{}),m?"Voltar para detalhes do pet":"Voltar para lista de pets"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Ea,{className:"text-blue-600",size:36}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:m?"Editar Pet":"Cadastrar Novo Pet"})]}),e.jsx("p",{className:"text-gray-600",children:m?"Atualize as informaÃ§Ãµes do pet":"Preencha os dados do animal de estimaÃ§Ã£o"})]}),f&&e.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(Na,{}),f]}),d&&e.jsxs("div",{className:"mb-6 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(ws,{}),d]}),r&&e.jsxs("div",{className:"mb-6 bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(ws,{}),e.jsx("span",{children:"âœ… Tutor prÃ©-selecionado automaticamente! VocÃª pode alterar se necessÃ¡rio."})]}),e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Dados BÃ¡sicos"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cliente (Tutor) *"}),e.jsxs("select",{name:"cliente_id",value:_.cliente_id,onChange:A,required:!0,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none ${r?"border-blue-400 bg-blue-50":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione o tutor..."}),k.map(P=>e.jsxs("option",{value:P.id,children:[P.nome," ",P.cpf&&`- CPF: ${P.cpf}`]},P.id))]}),r&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"ðŸŽ¯ Tutor selecionado automaticamente"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Pet *"}),e.jsx("input",{type:"text",name:"nome",value:_.nome,onChange:A,required:!0,placeholder:"Ex: Rex, Miau, TotÃ³",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EspÃ©cie *"}),e.jsxs("div",{className:"field-with-action",children:[e.jsxs("select",{name:"especie",value:_.especie,onChange:A,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Selecione..."}),c.map(P=>e.jsx("option",{value:P.id,children:P.nome},P.id))]}),e.jsxs("button",{type:"button",className:"btn-add-quick",onClick:()=>Q("especie"),title:"Adicionar nova espÃ©cie",children:[e.jsx(Qa,{})," Nova"]})]}),c.length===0&&e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"Nenhuma espÃ©cie cadastrada. Cadastre em Cadastros â†’ EspÃ©cies e RaÃ§as."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"RaÃ§a"}),e.jsxs("div",{className:"field-with-action",children:[e.jsxs("select",{name:"raca",value:_.raca,onChange:A,disabled:!_.especie,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:_.especie?"Selecione uma raÃ§a...":"Selecione uma espÃ©cie primeiro"}),p.map(P=>e.jsx("option",{value:P.nome,children:P.nome},P.id))]}),e.jsxs("button",{type:"button",className:"btn-add-quick",onClick:()=>Q("raca"),title:"Adicionar nova raÃ§a",disabled:!_.especie,children:[e.jsx(Qa,{})," Nova"]})]}),_.especie&&p.length===0&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["Nenhuma raÃ§a cadastrada para ",_.especie,". Cadastre em Cadastros â†’ EspÃ©cies e RaÃ§as."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sexo"}),e.jsxs("select",{name:"sexo",value:_.sexo,onChange:A,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Macho",children:"Macho"}),e.jsx("option",{value:"FÃªmea",children:"FÃªmea"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",name:"castrado",id:"castrado",checked:_.castrado,onChange:A,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"castrado",className:"text-sm font-medium text-gray-700",children:"Pet castrado"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"CaracterÃ­sticas FÃ­sicas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(zn,{value:_.idade_aproximada,onChange:P=>E(G=>({...G,idade_aproximada:P,data_nascimento:""})),name:"idade_aproximada",label:"Idade do Pet",mostrarDataNascimento:!0,className:"col-span-2"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Peso (kg)"}),e.jsx("input",{type:"number",name:"peso",value:_.peso,onChange:A,step:"0.1",min:"0",placeholder:"Ex: 5.5",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Porte"}),e.jsxs("select",{name:"porte",value:_.porte,onChange:A,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Mini",children:"Mini"}),e.jsx("option",{value:"Pequeno",children:"Pequeno"}),e.jsx("option",{value:"MÃ©dio",children:"MÃ©dio"}),e.jsx("option",{value:"Grande",children:"Grande"}),e.jsx("option",{value:"Gigante",children:"Gigante"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor/Pelagem"}),e.jsx("input",{type:"text",name:"cor",value:_.cor,onChange:A,placeholder:"Ex: Preto, Branco, Caramelo",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Microchip"}),e.jsx("input",{type:"text",name:"microchip",value:_.microchip,onChange:A,placeholder:"NÃºmero do microchip",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none font-mono text-sm"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL da Foto"}),e.jsx("input",{type:"url",name:"foto_url",value:_.foto_url,onChange:A,placeholder:"https://exemplo.com/foto-do-pet.jpg",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"InformaÃ§Ãµes de SaÃºde"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alergias"}),e.jsx("textarea",{name:"alergias",value:_.alergias,onChange:A,rows:"3",placeholder:"Descreva alergias conhecidas (alimentares, medicamentos, etc)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DoenÃ§as CrÃ´nicas"}),e.jsx("textarea",{name:"doencas_cronicas",value:_.doencas_cronicas,onChange:A,rows:"3",placeholder:"Descreva doenÃ§as crÃ´nicas diagnosticadas",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Medicamentos ContÃ­nuos"}),e.jsx("textarea",{name:"medicamentos_continuos",value:_.medicamentos_continuos,onChange:A,rows:"3",placeholder:"Liste medicamentos de uso contÃ­nuo com dosagem",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"HistÃ³rico ClÃ­nico"}),e.jsx("textarea",{name:"historico_clinico",value:_.historico_clinico,onChange:A,rows:"4",placeholder:"Descreva o histÃ³rico clÃ­nico do pet (cirurgias, tratamentos anteriores, etc)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"ObservaÃ§Ãµes Adicionais"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ObservaÃ§Ãµes Gerais"}),e.jsx("textarea",{name:"observacoes",value:_.observacoes,onChange:A,rows:"4",placeholder:"InformaÃ§Ãµes adicionais, comportamento, preferÃªncias, etc",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),m&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",name:"ativo",id:"ativo",checked:_.ativo,onChange:A,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"ativo",className:"text-sm font-medium text-gray-700",children:"Pet ativo no sistema"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{type:"submit",disabled:v,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Is,{}),m?"Salvar AlteraÃ§Ãµes":"Cadastrar Pet"]})}),e.jsx("button",{type:"button",onClick:()=>l(m?`/pets/${s}`:"/pets"),disabled:v,className:"px-6 py-3 border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors font-medium disabled:opacity-50",children:"Cancelar"})]})]}),u&&e.jsx(In,{tipo:C,especieId:C==="raca"?parseInt(_.especie):null,especieNome:C==="raca"?(S=c.find(P=>P.id===parseInt(_.especie)))==null?void 0:S.nome:null,onSuccess:q,onClose:re})]})},po=async(s={})=>(await F.get("/vendas",{params:s})).data,Kt=async s=>(await F.get(`/vendas/${s}`)).data,Jo=async s=>(await F.post("/vendas",s)).data,Tn=async(s,l)=>(await F.post(`/vendas/${s}/finalizar`,{pagamentos:l})).data,Vn=async(s={})=>{const l=await F.get("/clientes/",{params:s});return l.data.items||l.data.clientes||l.data||[]},ht=async s=>(await F.get(`/clientes/${s}`)).data,On=({status:s,className:l=""})=>{if(!s)return null;const t={verde:{cor:"bg-green-500",borda:"border-green-500",texto:"text-green-700",fundo:"bg-green-50",icone:"âœ…",mensagem:"Margem SaudÃ¡vel",descricao:"Venda em condiÃ§Ãµes ideais"},amarelo:{cor:"bg-yellow-500",borda:"border-yellow-500",texto:"text-yellow-700",fundo:"bg-yellow-50",icone:"âš ï¸",mensagem:"Margem em Alerta",descricao:"AtenÃ§Ã£o com parcelamento e descontos"},vermelho:{cor:"bg-red-500",borda:"border-red-500",texto:"text-red-700",fundo:"bg-red-50",icone:"ðŸ”´",mensagem:"Margem CrÃ­tica",descricao:"Evite mais descontos ou parcelamentos longos"}},m=t[s]||t.verde;return e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg border ${m.borda} ${m.fundo} ${l}`,children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${m.cor} animate-pulse`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`text-sm font-semibold ${m.texto}`,children:[m.icone," ",m.mensagem]}),e.jsx("div",{className:"text-xs text-gray-600",children:m.descricao})]})]})},Bn=["Visa","Mastercard","Elo","American Express","Hipercard","Outros"];function Un({venda:s,onClose:l,onConfirmar:t,onVendaAtualizada:m,onAnalisarVenda:r}){var na;const[g,o]=a.useState([]),[v,j]=a.useState([]),[f,N]=a.useState([]),[d,x]=a.useState([]),[k,w]=a.useState(null),[c,b]=a.useState(null),[p,i]=a.useState(""),[u,n]=a.useState(""),[C,h]=a.useState(1),[_,E]=a.useState(""),[$,K]=a.useState(!1),[te,M]=a.useState(!1),[A,Q]=a.useState(""),[re,q]=a.useState(0),[Z,R]=a.useState(!1),[J,S]=a.useState(null),[P,G]=a.useState(null),[B,y]=a.useState(!1),[O,z]=a.useState(""),[ae,W]=a.useState(""),[ne,H]=a.useState({}),[ee,de]=a.useState(!1),[ue,Re]=a.useState(null),se=a.useRef(null);a.useEffect(()=>{(async()=>{try{const ye=await F.get("/financeiro/formas-pagamento");N(ye.data)}catch(ye){console.error("Erro ao carregar formas:",ye)}})()},[]),a.useEffect(()=>{(async()=>{try{const ye=await F.get("/operadoras-cartao?apenas_ativas=true");x(ye.data);const Ce=ye.data.find(Be=>Be.padrao);Ce&&w(Ce)}catch(ye){console.error("Erro ao carregar operadoras:",ye)}})()},[]),a.useEffect(()=>{(async()=>{var ye;if(s.id){M(!0);try{const Ce=await F.get(`/vendas/${s.id}/pagamentos`);j(Ce.data.pagamentos||[]),q(Ce.data.total_pago||0)}catch(Ce){console.error("Erro ao buscar pagamentos:",Ce),((ye=Ce.response)==null?void 0:ye.status)!==404&&Q("Erro ao carregar pagamentos existentes")}finally{M(!1)}}})()},[s.id,s.status]),a.useEffect(()=>{c!=null&&c.permite_parcelamento&&se.current&&setTimeout(()=>{var oe;(oe=se.current)==null||oe.scrollIntoView({behavior:"smooth",block:"nearest"})},100)},[c==null?void 0:c.permite_parcelamento]);const _e=s.total,ke=g.reduce((oe,ye)=>oe+ye.valor,0)+re,Ze=_e-ke,ze=_?parseFloat(_)-Ze:0,Xe=async()=>{var oe,ye,Ce;y(!0);try{const Be=[{forma_pagamento_id:1,valor:s.total,parcelas:1}],Ie=(s.itens||[]).map(je=>({produto_id:je.produto_id,quantidade:je.quantidade,preco_venda:je.preco_unitario||je.preco_venda||0,custo:je.custo||null})),Y=await F.post("/formas-pagamento/analisar-venda",{items:Ie,formas_pagamento:Be,desconto:s.desconto_valor||0,taxa_entrega:((oe=s.entrega)==null?void 0:oe.taxa_entrega_total)||0});(Ce=(ye=Y.data)==null?void 0:ye.resultado)!=null&&Ce.cor_indicador&&(G(Y.data.resultado.cor_indicador),console.log("âœ… Status inicial calculado:",Y.data.resultado.cor_indicador))}catch(Be){console.error("âŒ Erro ao calcular status inicial:",Be),G(null)}finally{y(!1)}},be=async()=>{var oe,ye,Ce;if(!(g.length===0&&v.length===0)){y(!0);try{const Be=[...v,...g],Ie=(s.itens||[]).map(je=>({produto_id:je.produto_id,quantidade:je.quantidade,preco_venda:je.preco_unitario||je.preco_venda||0,custo:je.custo||null})),Y=await F.post("/formas-pagamento/analisar-venda",{items:Ie,formas_pagamento:Be,desconto:s.desconto_valor||0,taxa_entrega:((oe=s.entrega)==null?void 0:oe.taxa_entrega_total)||0});(Ce=(ye=Y.data)==null?void 0:ye.resultado)!=null&&Ce.cor_indicador&&G(Y.data.resultado.cor_indicador)}catch(Be){console.error("Erro ao calcular status de margem:",Be),G(null)}finally{y(!1)}}};a.useEffect(()=>{const oe=setTimeout(()=>{be()},500);return()=>clearTimeout(oe)},[g,C]),a.useEffect(()=>{console.log("ðŸŽ¬ Modal de pagamento aberto - Calculando status inicial..."),Xe()},[]),a.useEffect(()=>{if(f&&f.length>0){const oe=f.filter(ye=>ye.permite_parcelamento);oe.length>0&&Object.keys(ne).length===0&&(console.log("ðŸ“Š Simulando parcelamentos ao carregar formas..."),Ee(oe[0]))}},[f]);const Ee=async oe=>{var Be,Ie,Y;if(!oe||!oe.permite_parcelamento){console.log("â­ï¸ Forma de pagamento invÃ¡lida ou nÃ£o permite parcelamento");return}const ye=(oe==null?void 0:oe.parcelas_maximas)??12,Ce=oe.id;console.log(`ðŸŽ² Simulando parcelamentos para ${oe.nome} (atÃ© ${ye}x)...`),de(!0);try{const je={},Me=(s.itens||[]).map(X=>({produto_id:X.produto_id,quantidade:X.quantidade,preco_venda:X.preco_unitario||X.preco_venda||0,custo:X.custo||null}));for(let X=1;X<=ye;X++){const fe=[{forma_pagamento_id:Ce,valor:s.total,parcelas:X}];try{const U=await F.post("/formas-pagamento/analisar-venda",{items:Me,formas_pagamento:fe,desconto:s.desconto_valor||0,taxa_entrega:((Be=s.entrega)==null?void 0:Be.taxa_entrega_total)||0});(Y=(Ie=U.data)==null?void 0:Ie.resultado)!=null&&Y.cor_indicador&&(je[X]={cor:U.data.resultado.cor_indicador,classificacao:U.data.resultado.cor_indicador})}catch(U){console.error(`Erro ao simular ${X}x:`,U),je[X]={cor:null,classificacao:"verde"}}}H(X=>({...X,[Ce]:je}));const I=he(je,ye);Re(I),console.log("âœ… SimulaÃ§Ãµes concluÃ­das:",je),console.log("ðŸ“Š Faixas calculadas:",I)}catch(je){console.error("âŒ Erro ao simular parcelamentos:",je)}finally{de(!1)}},he=(oe,ye)=>{const Ce={saudavel:{min:1,max:0},alerta:{min:0,max:0},proibido:{min:0,max:ye}};let Be=0,Ie=ye+1;for(let Y=1;Y<=ye;Y++){const je=oe[Y];je&&(je.cor==="verde"?Be=Y:je.cor==="vermelho"&&Y<Ie&&(Ie=Y))}return Ce.saudavel.max=Be,Ce.alerta.min=Be+1,Ce.alerta.max=Ie-1,Ce.proibido.min=Ie,Ce};a.useEffect(()=>{if(c!=null&&c.permite_parcelamento)if(!ne[c.id])Ee(c);else{const oe=ne[c.id],ye=he(oe,(c==null?void 0:c.parcelas_maximas)??12);Re(ye),console.log("â™»ï¸ Reutilizando simulaÃ§Ã£o existente")}else if(!c){const oe=Object.keys(ne)[0];if(oe&&f.length>0){const ye=f.find(Ce=>Ce.id===parseInt(oe));if(ye){const Ce=he(ne[oe],(ye==null?void 0:ye.parcelas_maximas)??12);Re(Ce)}}}},[c==null?void 0:c.id]);const Qe=()=>{var Ie;if(!c){Q("Selecione uma forma de pagamento");return}const oe=parseFloat(_)||0;if(oe<=0){Q("Informe o valor recebido");return}if(c.id==="credito_cliente"&&oe>c.credito_disponivel){Q(`Valor excede o crÃ©dito disponÃ­vel (R$ ${c.credito_disponivel.toFixed(2)})`);return}if(["cartao_credito","cartao_debito"].includes(c.tipo)&&!p){Q("Selecione a bandeira do cartÃ£o");return}if(["cartao_credito","cartao_debito"].includes(c.tipo)&&!k){Q("Selecione a operadora do cartÃ£o");return}if(k&&C>k.max_parcelas){Q(`A operadora ${k.nome} permite no mÃ¡ximo ${k.max_parcelas}x`);return}console.log("ðŸ” DEBUG formaPagamentoSelecionada:",c);const ye={forma_pagamento:c.nome,forma_id:c.id,forma_pagamento_id:c.id,nome:c.nome,valor:Math.min(oe,Ze),bandeira:["cartao_credito","cartao_debito"].includes(c.tipo)?p:null,nsu_cartao:["cartao_credito","cartao_debito"].includes(c.tipo)&&u?u:null,operadora_id:(k==null?void 0:k.id)||null,numero_parcelas:c.permite_parcelamento?C:1,parcelas:c.permite_parcelamento?C:1,valor_recebido:oe,troco:c.tipo==="dinheiro"&&ze>0?ze:null,is_credito_cliente:c.nome==="CrÃ©dito Cliente"||c.tipo==="credito_cliente"};console.log("ðŸ“¤ DEBUG novoPagamento:",ye);let Ce="verde";if(c!=null&&c.permite_parcelamento&&ne[c.id]){const Y=(Ie=ne[c.id])==null?void 0:Ie[C];Ce=(Y==null?void 0:Y.cor)??"verde",console.log(`â™»ï¸ Reutilizando simulaÃ§Ã£o do backend: ${C}x = cor ${Ce}`)}if(P==="vermelho"||Ce==="vermelho"){if(!O||O.trim().length<10){W("âš ï¸ Justificativa obrigatÃ³ria para margem crÃ­tica (mÃ­nimo 10 caracteres)"),Q("Por favor, preencha a justificativa abaixo");return}const Y=s.observacoes?`${s.observacoes}

âš ï¸ JUSTIFICATIVA (Margem CrÃ­tica): ${O}`:`âš ï¸ JUSTIFICATIVA (Margem CrÃ­tica): ${O}`;s.observacoes=Y}o([...g,ye]),b(null),E(""),i(""),w(d.find(Y=>Y.padrao)||null),n(""),h(1),Q(""),W("")},Ye=oe=>{o(g.filter((ye,Ce)=>Ce!==oe))},ca=async oe=>{var ye,Ce;if(confirm("Deseja realmente excluir este pagamento?")){K(!0),Q("");try{console.log(`ðŸ—‘ï¸ Excluindo pagamento ID ${oe}...`),await F.delete(`/vendas/pagamentos/${oe}`),console.log("âœ… Pagamento excluÃ­do com sucesso!");const Be=await F.get(`/vendas/${s.id}/pagamentos`);j(Be.data.pagamentos||[]),q(Be.data.total_pago||0),Be.data.pagamentos.length===0&&m&&await m(),Q("")}catch(Be){console.error("âŒ Erro ao excluir pagamento:",Be),console.error("   Response:",Be.response),console.error("   Message:",Be.message),Be.message&&Be.message.includes("CORS")?Q("âš ï¸ Erro de CORS: O backend precisa ser reiniciado. Feche e abra novamente o servidor backend."):Q(((Ce=(ye=Be.response)==null?void 0:ye.data)==null?void 0:Ce.detail)||Be.message||"Erro ao excluir pagamento")}finally{K(!1)}}},ra=async()=>{var oe,ye,Ce,Be,Ie,Y,je,Me;if(g.length===0){Q("Adicione pelo menos uma forma de pagamento");return}K(!0),Q("");try{const I=s.itens.filter(U=>U.tipo==="produto"&&U.produto_id).map(U=>({produto_id:U.produto_id,quantidade:U.quantidade}));if(I.length>0){const ie=(await $n(I)).data||[];if(ie.length>0){const Ne=ie.map(L=>`â€¢ ${L.produto_nome}: estoque atual ${L.estoque_atual}, apÃ³s venda ficarÃ¡ ${L.estoque_resultante}`).join(`
`);if(!window.confirm(`âš ï¸ ATENÃ‡ÃƒO: Os seguintes produtos ficarÃ£o com ESTOQUE NEGATIVO:

${Ne}

Deseja continuar mesmo assim?`)){K(!1);return}}}let X=s.id;if(!X){const U=((oe=s.entrega)==null?void 0:oe.taxa_entrega_total)||0,ie=((ye=s.entrega)==null?void 0:ye.taxa_loja)||0,Ne=((Ce=s.entrega)==null?void 0:Ce.taxa_entregador)||0,Pe=U>0?(ie/U*100).toFixed(2):100,L=U>0?(Ne/U*100).toFixed(2):0;X=(await Jo({cliente_id:(Be=s.cliente)==null?void 0:Be.id,funcionario_id:s.funcionario_id,itens:s.itens,desconto_valor:s.desconto_valor,desconto_percentual:s.desconto_percentual,observacoes:s.observacoes,tem_entrega:s.tem_entrega,taxa_entrega:U,percentual_taxa_loja:parseFloat(Pe),percentual_taxa_entregador:parseFloat(L),entregador_id:s.entregador_id,endereco_entrega:(Ie=s.entrega)==null?void 0:Ie.endereco_completo,observacoes_entrega:(Y=s.entrega)==null?void 0:Y.observacoes_entrega})).id}const fe=await Tn(X,g);S(X),(fe==null?void 0:fe.status)==="finalizada"||(fe==null?void 0:fe.status)==="pago_nf"?R(!0):t()}catch(I){console.error("Erro ao finalizar venda:",I),Q(((Me=(je=I.response)==null?void 0:je.data)==null?void 0:Me.detail)||"Erro ao finalizar venda")}finally{K(!1)}},pa=async oe=>{var ye,Ce;K(!0),Q("");try{await F.post("/nfe/emitir",{venda_id:J,tipo_nota:oe}),alert(`${oe==="nfe"?"NF-e":"NFC-e"} emitida com sucesso!`),t()}catch(Be){console.error("Erro ao emitir nota:",Be),alert(((Ce=(ye=Be.response)==null?void 0:ye.data)==null?void 0:Ce.detail)||"Erro ao emitir nota fiscal. VocÃª pode emiti-la depois na tela de vendas."),t()}finally{K(!1)}};return Z?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(ha,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Venda Finalizada!"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Deseja emitir nota fiscal?"})]})]}),e.jsxs("div",{className:"space-y-3",children:[(na=s.cliente)!=null&&na.cnpj?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>pa("nfe"),disabled:$,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(Xa,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NF-e (Empresa)"})]}),e.jsxs("button",{onClick:()=>pa("nfce"),disabled:$,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(Xa,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NFC-e (Cupom)"})]})]}):e.jsxs("button",{onClick:()=>pa("nfce"),disabled:$,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(Xa,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NFC-e"})]}),e.jsx("button",{onClick:t,disabled:$,className:"w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"NÃ£o emitir agora"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-4",children:"VocÃª pode emitir a nota fiscal depois na tela de vendas"})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(ot,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Registrar Recebimento"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Selecione as formas de pagamento"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!1,e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ma,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Selecione a forma de pagamento"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.cliente&&s.cliente.credito>0&&e.jsxs("button",{onClick:()=>{b({id:"credito_cliente",nome:"CrÃ©dito Cliente",tipo:"credito_cliente",icone:"ðŸŽ",credito_disponivel:parseFloat(s.cliente.credito)}),h(1),i(""),n(""),E(Math.min(parseFloat(s.cliente.credito),Ze).toFixed(2))},className:`p-4 rounded-lg border-2 transition-all ${(c==null?void 0:c.id)==="credito_cliente"?"border-purple-500 bg-purple-50":"border-purple-200 bg-purple-50/50 hover:border-purple-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸŽ"}),e.jsx("div",{className:`text-sm font-medium ${(c==null?void 0:c.id)==="credito_cliente"?"text-purple-900":"text-purple-700"}`,children:"CrÃ©dito Cliente"}),e.jsxs("div",{className:"text-xs text-purple-600 mt-1 font-semibold",children:["R$ ",parseFloat(s.cliente.credito).toFixed(2).replace(".",",")]})]}),f.map(oe=>{const ye=(c==null?void 0:c.id)===oe.id;return e.jsxs("button",{onClick:()=>{b(oe),h(1),i(""),n("")},className:`p-4 rounded-lg border-2 transition-all ${ye?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:oe.icone||"ðŸ’³"}),e.jsx("div",{className:`text-sm font-medium ${ye?"text-blue-900":"text-gray-700"}`,children:oe.nome}),oe.taxa_percentual>0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Taxa: ",oe.taxa_percentual,"%"]})]},oe.id)})]})]}),c&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[c.id==="credito_cliente"&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-800 mb-2",children:[e.jsx(lt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"CrÃ©dito DisponÃ­vel"})]}),e.jsxs("div",{className:"text-lg font-bold text-purple-600",children:["R$ ",c.credito_disponivel.toFixed(2).replace(".",",")]}),e.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"ðŸ’¡ NÃ£o gera movimentaÃ§Ã£o de caixa"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c.id==="credito_cliente"?"Valor a Utilizar":"Valor Recebido"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:_,onChange:oe=>{E(oe.target.value)},onBlur:oe=>{const ye=parseFloat(oe.target.value)||0;if(c.id==="credito_cliente"){const Ce=Math.min(c.credito_disponivel,Ze);ye>Ce&&(E(Ce.toFixed(2)),Q(`Valor ajustado para o crÃ©dito disponÃ­vel: R$ ${Ce.toFixed(2)}`),setTimeout(()=>Q(""),3e3))}},placeholder:Ze.toFixed(2),max:c.id==="credito_cliente"?Math.min(c.credito_disponivel,Ze):void 0,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]}),c.id==="credito_cliente"&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["MÃ¡ximo: R$ ",Math.min(c.credito_disponivel,Ze).toFixed(2)]})]}),c.tipo==="dinheiro"&&_&&e.jsx("div",{className:`rounded-lg p-3 ${ze>0?"bg-yellow-50 border border-yellow-200":"bg-gray-100"}`,children:e.jsx("div",{className:"text-sm font-medium",children:e.jsxs("span",{className:ze>0?"text-yellow-800":"text-gray-600",children:["Troco: R$ ",ze.toFixed(2)]})})}),(c==null?void 0:c.tipo)&&["cartao_credito","cartao_debito"].includes(c.tipo)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Operadora *"}),e.jsxs("select",{value:(k==null?void 0:k.id)||"",onChange:oe=>{const ye=d.find(Ce=>Ce.id===parseInt(oe.target.value));w(ye),ye&&C>ye.max_parcelas&&h(ye.max_parcelas)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione a operadora..."}),d.map(oe=>e.jsxs("option",{value:oe.id,children:[oe.nome," (",oe.max_parcelas,"x mÃ¡x)"]},oe.id))]}),k&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["MÃ¡ximo de ",k.max_parcelas," parcelas"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bandeira"}),e.jsxs("select",{value:p,onChange:oe=>i(oe.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),Bn.map(oe=>e.jsx("option",{value:oe,children:oe},oe))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["NSU (NÃºmero Sequencial Ãšnico)",e.jsx("span",{className:"text-gray-500 text-xs ml-1",children:"(Opcional - para conciliaÃ§Ã£o)"})]}),e.jsx("input",{type:"text",value:u,onChange:oe=>n(oe.target.value),placeholder:"Ex: 123456789",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),(c==null?void 0:c.permite_parcelamento)&&e.jsxs("div",{ref:se,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"NÃºmero de Parcelas"}),e.jsx("select",{value:C,onChange:oe=>h(parseInt(oe.target.value)),className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${(()=>{var Ce;const oe=(Ce=ne[c.id])==null?void 0:Ce[C],ye=(oe==null?void 0:oe.cor)||P||"verde";return ye==="verde"?"border-gray-300 bg-white":ye==="amarelo"?"border-yellow-400 bg-yellow-50 text-yellow-900":"border-red-400 bg-red-50 text-red-900"})()}`,children:Array.from({length:(k==null?void 0:k.max_parcelas)||c.parcelas_maximas||12},(oe,ye)=>ye+1).map(oe=>{var Y;const ye=parseFloat(_)||Ze,Ce=ye/oe,Be=(Y=ne[c.id])==null?void 0:Y[oe],Ie=(Be==null?void 0:Be.cor)||"verde";return e.jsxs("option",{value:oe,className:Ie==="verde"?"":Ie==="amarelo"?"bg-yellow-100 text-yellow-900":"bg-red-100 text-red-900",children:[Ie==="vermelho"?"ðŸš« ":Ie==="amarelo"?"âš ï¸ ":"",oe,"x de R$ ",Ce.toFixed(2)," ",_?`(Total: R$ ${ye.toFixed(2)})`:""]},oe)})}),_&&C>1&&e.jsxs("div",{className:`mt-2 p-3 border rounded-lg ${(()=>{var Ce;const oe=(Ce=ne[c.id])==null?void 0:Ce[C],ye=(oe==null?void 0:oe.cor)||P||"verde";return ye==="verde"?"bg-blue-50 border-blue-200":ye==="amarelo"?"bg-yellow-50 border-yellow-300":"bg-red-50 border-red-300"})()}`,children:[e.jsx("p",{className:`text-sm font-medium ${(()=>{var Ce;const oe=(Ce=ne[c.id])==null?void 0:Ce[C],ye=(oe==null?void 0:oe.cor)||P||"verde";return ye==="verde"?"text-blue-800":ye==="amarelo"?"text-yellow-800":"text-red-800"})()}`,children:(()=>{var Ce;const oe=(Ce=ne[c.id])==null?void 0:Ce[C],ye=(oe==null?void 0:oe.cor)||P||"verde";return e.jsxs(e.Fragment,{children:[ye==="vermelho"&&"ðŸš« ",ye==="amarelo"&&"âš ï¸ ","ðŸ’³ ",C,"x de R$ ",(parseFloat(_)/C).toFixed(2)]})})()}),e.jsxs("p",{className:`text-xs mt-1 ${(()=>{var Ce;const oe=(Ce=ne[c.id])==null?void 0:Ce[C],ye=(oe==null?void 0:oe.cor)||P||"verde";return ye==="verde"?"text-blue-600":ye==="amarelo"?"text-yellow-700":"text-red-700"})()}`,children:["Valor total parcelado: R$ ",parseFloat(_).toFixed(2),(()=>{var Ce;const oe=(Ce=ne[c.id])==null?void 0:Ce[C],ye=(oe==null?void 0:oe.cor)||P||"verde";return ye==="amarelo"?" - Requer atenÃ§Ã£o":ye==="vermelho"?" - Requer justificativa":""})()]})]})]}),e.jsx("button",{onClick:Qe,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Adicionar Pagamento"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Resumo da Venda"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total da Venda:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",_e.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Valor Pago:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",ke.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-blue-600 text-lg font-semibold border-t pt-3",children:[e.jsx("span",{children:"Restante:"}),e.jsxs("span",{children:["R$ ",Ze.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Formas de Pagamento"}),v.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-600 mb-2",children:["ðŸ’° Pagamentos Registrados (",v.length,")"]}),e.jsx("div",{className:"space-y-2",children:v.map((oe,ye)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:oe.forma_pagamento==="dinheiro"?"ðŸ’µ Dinheiro":oe.forma_pagamento==="pix"?"ðŸ“± PIX":oe.forma_pagamento==="credito"?"ðŸ’³ CartÃ£o de CrÃ©dito":oe.forma_pagamento==="debito"?"ðŸ’³ CartÃ£o de DÃ©bito":oe.forma_pagamento==="boleto"?"ðŸ“„ Boleto":oe.forma_pagamento}),e.jsxs("span",{className:"px-2 py-0.5 bg-green-200 text-green-800 text-xs rounded-full font-medium",children:["Pagamento ",ye+1]})]}),oe.bandeira&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Bandeira: ",oe.bandeira]}),oe.nsu_cartao&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1 font-mono",children:["ðŸ”¢ NSU: ",oe.nsu_cartao]}),oe.numero_parcelas&&oe.numero_parcelas>1&&e.jsxs("div",{className:"text-sm text-blue-600 mt-1 font-medium",children:["ðŸ”¢ Parcelado em ",oe.numero_parcelas,"x de R$ ",(parseFloat(oe.valor)/oe.numero_parcelas).toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["ðŸ“… ",new Date(oe.data_pagamento).toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-green-700 text-lg",children:["R$ ",parseFloat(oe.valor).toFixed(2)]}),oe.troco&&parseFloat(oe.troco)>0&&e.jsxs("div",{className:"text-xs text-yellow-600",children:["Troco: R$ ",parseFloat(oe.troco).toFixed(2)]})]}),e.jsx("button",{onClick:()=>ca(oe.id),disabled:$,className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors disabled:opacity-50",title:"Excluir pagamento",children:e.jsx(gs,{className:"w-4 h-4"})})]})]},oe.id))})]}),g.length===0&&v.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400 bg-gray-50 rounded-lg border-2 border-dashed",children:[e.jsx(lt,{className:"w-12 h-12 mx-auto mb-2 opacity-40"}),e.jsx("p",{className:"text-sm font-medium",children:"Nenhuma forma de pagamento adicionada"}),e.jsx("p",{className:"text-xs mt-1",children:"Selecione uma forma acima para comeÃ§ar"})]}):g.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 mb-2",children:"â³ Novos Pagamentos (a confirmar)"}),e.jsx("div",{className:"space-y-3",children:g.map((oe,ye)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:oe.nome}),e.jsx("span",{className:"px-2 py-0.5 bg-blue-200 text-blue-800 text-xs rounded-full font-medium",children:"Novo"})]}),oe.bandeira&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Bandeira: ",oe.bandeira]}),oe.nsu_cartao&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1 font-mono",children:["ðŸ”¢ NSU: ",oe.nsu_cartao]}),oe.numero_parcelas>1&&e.jsxs("div",{className:"text-sm text-blue-600 mt-1 font-medium",children:["ðŸ”¢ ",oe.numero_parcelas,"x de R$ ",(oe.valor/oe.numero_parcelas).toFixed(2)]}),oe.troco&&oe.troco>0&&e.jsxs("div",{className:"text-sm text-yellow-600 mt-1",children:["ðŸ’µ Troco: R$ ",oe.troco.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"font-semibold text-blue-700 text-lg",children:["R$ ",oe.valor.toFixed(2)]}),e.jsx("button",{onClick:()=>Ye(ye),className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors",title:"Remover",children:e.jsx(ma,{className:"w-5 h-5"})})]})]},ye))})]}):null]}),P&&e.jsx(On,{status:P,loading:B}),ue&&Object.keys(ne).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center space-x-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ“Š"}),e.jsx("span",{children:"Parcelamento Recomendado"})]}),ee?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin inline-block w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full"}),e.jsx("p",{className:"text-sm text-blue-700 mt-2",children:"Analisando opÃ§Ãµes..."})]}):e.jsxs("div",{className:"space-y-2",children:[ue.saudavel.max>0&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-green-100 border border-green-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"ðŸŸ¢"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-green-900",children:[ue.saudavel.min===ue.saudavel.max?`${ue.saudavel.max}x`:`${ue.saudavel.min}x a ${ue.saudavel.max}x`,e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- SaudÃ¡vel"})]}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"Margem adequada, sem restriÃ§Ãµes"})]})]}),ue.alerta.max>=ue.alerta.min&&ue.alerta.min>0&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-yellow-100 border border-yellow-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"ðŸŸ¡"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-yellow-900",children:[ue.alerta.min===ue.alerta.max?`${ue.alerta.max}x`:`${ue.alerta.min}x a ${ue.alerta.max}x`,e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- AtenÃ§Ã£o"})]}),e.jsx("div",{className:"text-xs text-yellow-700 mt-1",children:"Margem prÃ³xima ao mÃ­nimo, evite se possÃ­vel"})]})]}),ue.proibido.min<=((c==null?void 0:c.parcelas_maximas)??12)&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-red-100 border border-red-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ”´"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-red-900",children:[ue.proibido.min,"x ou mais",e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- Exige justificativa"})]}),e.jsx("div",{className:"text-xs text-red-700 mt-1",children:"Margem crÃ­tica, justificativa obrigatÃ³ria"})]})]})]})]}),(()=>{var Be,Ie;let oe="verde";return c!=null&&c.permite_parcelamento&&((Be=ne[c.id])!=null&&Be[C])&&(oe=((Ie=ne[c.id][C])==null?void 0:Ie.cor)??"verde"),P==="vermelho"||oe==="vermelho"||O&&O.trim().length>0?e.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-3",children:[e.jsx(da,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-red-900",children:"âš ï¸ Justificativa ObrigatÃ³ria"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Esta venda tem margem crÃ­tica. Informe o motivo para prosseguir."})]})]}),e.jsx("textarea",{value:O,onChange:Y=>{z(Y.target.value),Y.target.value.trim().length>=10&&W("")},placeholder:"Ex: Cliente especial, promoÃ§Ã£o de lanÃ§amento, acordo comercial...",className:`w-full px-3 py-2 border-2 rounded-lg focus:ring-2 focus:ring-red-500 resize-none ${ae?"border-red-500":"border-red-300"}`,rows:3}),ae&&e.jsx("p",{className:"text-xs text-red-700 font-medium mt-2",children:ae}),e.jsx("p",{className:"text-xs text-red-600 mt-2",children:"ðŸ’¡ MÃ­nimo 10 caracteres"})]}):null})()]})]})}),e.jsxs("div",{className:"border-t p-6 bg-gray-50",children:[A&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(da,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:A})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:l,disabled:$,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:ra,disabled:$||g.length===0,className:"flex items-center space-x-2 px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:$?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ha,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"})]})})]})]})]})})}const Wn=async s=>(await F.post("/caixas/abrir",s)).data,Kn=async()=>(await F.get("/caixas/aberto")).data,Hn=async(s={})=>(await F.get("/caixas",{params:s})).data,Pr=async(s,l)=>(await F.post(`/caixas/${s}/movimentacao`,l)).data,Gn=async(s,l)=>(await F.post(`/caixas/${s}/fechar`,l)).data,Qn=async s=>(await F.post(`/caixas/${s}/reabrir`)).data,Yo=async s=>(await F.get(`/caixas/${s}/resumo`)).data;function Xn({onClose:s,onSucesso:l}){const[t,m]=a.useState(""),[r,g]=a.useState(""),[o,v]=a.useState(""),[j,f]=a.useState({n2:0,n5:0,n10:0,n20:0,n50:0,n100:0,n200:0,moedas:0}),[N,d]=a.useState(!1),[x,k]=a.useState(!1),[w,c]=a.useState(""),b=()=>j.n200*200+j.n100*100+j.n50*50+j.n20*20+j.n10*10+j.n5*5+j.n2*2+parseFloat(j.moedas||0),p=()=>{const n=b();m(n.toFixed(2)),d(!1)},i=()=>{f({n2:0,n5:0,n10:0,n20:0,n50:0,n100:0,n200:0,moedas:0})},u=async()=>{var C,h;const n=parseFloat(t);if(!n||n<0){c("Informe um valor vÃ¡lido para abertura");return}k(!0),c("");try{await Wn({valor_abertura:n,conta_origem_nome:r||"Dinheiro em mÃ£os",observacoes_abertura:o}),l()}catch(_){console.error("Erro ao abrir caixa:",_),c(((h=(C=_.response)==null?void 0:C.data)==null?void 0:h.detail)||"Erro ao abrir caixa")}finally{k(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(La,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Abrir Caixa"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Informe o valor inicial do caixa"})]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ma,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor de Abertura *"}),e.jsxs("button",{type:"button",onClick:()=>d(!N),className:"flex items-center space-x-1 px-3 py-1.5 text-sm bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 rounded-lg transition-colors",children:[e.jsx(Rs,{className:"w-4 h-4"}),e.jsx("span",{children:"Auxiliar Contagem"})]})]}),N&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-xl p-5 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center",children:[e.jsx(Rs,{className:"w-5 h-5 mr-2 text-blue-600"}),"Auxiliar de Contagem"]}),e.jsx("button",{onClick:()=>d(!1),className:"p-1 hover:bg-blue-100 rounded-lg transition-colors",type:"button",children:e.jsx(ma,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-gray-200 hover:border-gray-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-gray-500 to-gray-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 2"}),e.jsx("input",{type:"number",min:"0",value:j.n2,onChange:n=>f({...j,n2:parseInt(n.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-gray-500 focus:ring-2 focus:ring-gray-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-gray-600",children:["R$ ",(j.n2*2).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-purple-200 hover:border-purple-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 5"}),e.jsx("input",{type:"number",min:"0",value:j.n5,onChange:n=>f({...j,n5:parseInt(n.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-purple-600",children:["R$ ",(j.n5*5).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-red-200 hover:border-red-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-red-500 to-red-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 10"}),e.jsx("input",{type:"number",min:"0",value:j.n10,onChange:n=>f({...j,n10:parseInt(n.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-red-500 focus:ring-2 focus:ring-red-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-red-600",children:["R$ ",(j.n10*10).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-yellow-200 hover:border-yellow-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-yellow-500 to-yellow-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 20"}),e.jsx("input",{type:"number",min:"0",value:j.n20,onChange:n=>f({...j,n20:parseInt(n.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-yellow-600",children:["R$ ",(j.n20*20).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-blue-200 hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 50"}),e.jsx("input",{type:"number",min:"0",value:j.n50,onChange:n=>f({...j,n50:parseInt(n.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:["R$ ",(j.n50*50).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-green-200 hover:border-green-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-green-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 100"}),e.jsx("input",{type:"number",min:"0",value:j.n100,onChange:n=>f({...j,n100:parseInt(n.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-green-500 focus:ring-2 focus:ring-green-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",(j.n100*100).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-orange-200 hover:border-orange-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 200"}),e.jsx("input",{type:"number",min:"0",value:j.n200,onChange:n=>f({...j,n200:parseInt(n.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["R$ ",(j.n200*200).toFixed(2)]})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t-2 border-blue-300",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-amber-200 hover:border-amber-400 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-amber-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"ðŸ’° Moedas"})}),e.jsxs("span",{className:"text-lg font-bold text-amber-600",children:["R$ ",parseFloat(j.moedas||0).toFixed(2)]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:j.moedas,onChange:n=>f({...j,moedas:parseFloat(n.target.value)||0}),className:"w-full px-4 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200",placeholder:"0.00"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl p-4 mb-4 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-semibold text-sm",children:"TOTAL CONTADO"}),e.jsxs("span",{className:"text-3xl font-bold text-white",children:["R$ ",b().toFixed(2)]})]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:i,className:"flex-1 px-4 py-3 border-2 border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-semibold transition-colors",children:"ðŸ—‘ï¸ Limpar"}),e.jsx("button",{type:"button",onClick:p,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg font-semibold shadow-md transition-colors",children:"âœ“ Aplicar"})]})]}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:t,onChange:n=>m(n.target.value),placeholder:"0,00",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-lg font-semibold",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conta de Origem"}),e.jsxs("select",{value:r,onChange:n=>g(n.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Dinheiro em mÃ£os",children:"Dinheiro em mÃ£os"}),e.jsx("option",{value:"Caixa geral",children:"Caixa geral"}),e.jsx("option",{value:"Banco",children:"Banco"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ObservaÃ§Ãµes (opcional)"}),e.jsx("textarea",{value:o,onChange:n=>v(n.target.value),rows:3,placeholder:"Ex: Troco do dia anterior...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"border-t p-6 bg-gray-50",children:[w&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(da,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:w})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:s,disabled:x,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:u,disabled:x||!t,className:"px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Abrindo...":"Abrir Caixa"})]})]})]})})}function Jn({caixaId:s,onClose:l,onSucesso:t}){const[m,r]=a.useState(""),[g,o]=a.useState(""),[v,j]=a.useState(""),[f,N]=a.useState(!1),[d,x]=a.useState(""),k=async()=>{var c,b;const w=parseFloat(m);if(!w||w<=0){x("Informe um valor vÃ¡lido");return}N(!0);try{await Pr(s,{tipo:"suprimento",valor:w,forma_pagamento:"Dinheiro",conta_origem_nome:g||"NÃ£o informado",descricao:v}),t()}catch(p){x(((b=(c=p.response)==null?void 0:c.data)==null?void 0:b.detail)||"Erro ao adicionar suprimento")}finally{N(!1)}};return e.jsx(Rr,{titulo:"Suprimento para o caixa",icone:Aa,corIcone:"green",onClose:l,erro:d,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conta de origem*"}),e.jsxs("select",{value:g,onChange:w=>o(w.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Dinheiro em mÃ£os",children:"Dinheiro em mÃ£os"}),e.jsx("option",{value:"Caixa geral",children:"Caixa geral"}),e.jsx("option",{value:"Banco",children:"Banco"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:m,onChange:w=>r(w.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"DescriÃ§Ã£o*"}),e.jsx("textarea",{value:v,onChange:w=>j(w.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Motivo do suprimento..."})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:l,disabled:f,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:k,disabled:f,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors",children:f?"Salvando...":"Salvar"})]})]})})}function Yn({caixaId:s,saldoAtual:l,onClose:t,onSucesso:m}){const[r,g]=a.useState(""),[o,v]=a.useState(""),[j,f]=a.useState(""),[N,d]=a.useState(!1),[x,k]=a.useState(""),w=async()=>{var b,p;const c=parseFloat(r);if(!c||c<=0){k("Informe um valor vÃ¡lido");return}d(!0);try{await Pr(s,{tipo:"sangria",valor:c,forma_pagamento:"Dinheiro",conta_destino_nome:o||"NÃ£o informado",descricao:j}),m()}catch(i){k(((p=(b=i.response)==null?void 0:b.data)==null?void 0:p.detail)||"Erro ao adicionar sangria")}finally{d(!1)}};return e.jsx(Rr,{titulo:"Sangria no caixa",icone:Va,corIcone:"orange",onClose:t,erro:x,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Em caixa:"})," R$ ",l.toFixed(2)]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor da Sangria*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:r,onChange:c=>g(c.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecione a conta de destino*"}),e.jsxs("select",{value:o,onChange:c=>v(c.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Cofre",children:"Cofre"}),e.jsx("option",{value:"Banco",children:"Banco"}),e.jsx("option",{value:"Outro caixa",children:"Outro caixa"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:j,onChange:c=>f(c.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Motivo da sangria..."})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:t,disabled:N,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:w,disabled:N,className:"flex-1 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors",children:N?"Salvando...":"Salvar"})]})]})})}function Zn({caixaId:s,onClose:l,onSucesso:t}){const[m,r]=a.useState(""),[g,o]=a.useState(""),[v,j]=a.useState(""),[f,N]=a.useState("Dinheiro"),[d,x]=a.useState(""),[k,w]=a.useState(""),[c,b]=a.useState(!1),[p,i]=a.useState(""),u=["Ãgua e Luz","Aluguel","Telefone/Internet","Material de Limpeza","Material de EscritÃ³rio","ManutenÃ§Ã£o","Outros"],n=async()=>{var h,_;const C=parseFloat(v);if(!C||C<=0){i("Informe um valor vÃ¡lido");return}if(!m){i("Selecione uma categoria");return}b(!0);try{await Pr(s,{tipo:"despesa",valor:C,categoria:m,descricao:g,forma_pagamento:f,fornecedor_nome:d,documento:k}),t()}catch(E){i(((_=(h=E.response)==null?void 0:h.data)==null?void 0:_.detail)||"Erro ao adicionar despesa")}finally{b(!1)}};return e.jsx(Rr,{titulo:"Despesa no caixa",icone:Ys,corIcone:"red",onClose:l,erro:p,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categoria*"}),e.jsxs("select",{value:m,onChange:C=>r(C.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),u.map(C=>e.jsx("option",{value:C,children:C},C))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"DescriÃ§Ã£o*"}),e.jsx("input",{type:"text",value:g,onChange:C=>o(C.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Ex: Conta de luz - Janeiro"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de pagamento*"}),e.jsxs("select",{value:f,onChange:C=>N(C.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Dinheiro",children:"Dinheiro"}),e.jsx("option",{value:"PIX",children:"PIX"}),e.jsx("option",{value:"CartÃ£o de CrÃ©dito",children:"CartÃ£o de CrÃ©dito"}),e.jsx("option",{value:"CartÃ£o de DÃ©bito",children:"CartÃ£o de DÃ©bito"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:v,onChange:C=>j(C.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fornecedor"}),e.jsx("input",{type:"text",value:d,onChange:C=>x(C.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Documento / NF"}),e.jsx("input",{type:"text",value:k,onChange:C=>w(C.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:l,disabled:c,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:n,disabled:c,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:c?"Salvando...":"Salvar"})]})]})})}function Rr({titulo:s,icone:l,corIcone:t,children:m,onClose:r,erro:g}){const o={green:"bg-green-100 text-green-600",orange:"bg-orange-100 text-orange-600",red:"bg-red-100 text-red-600",blue:"bg-blue-100 text-blue-600",purple:"bg-purple-100 text-purple-600"};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-12 h-12 ${o[t]} rounded-full flex items-center justify-center`,children:e.jsx(l,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ma,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[g&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(da,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:g})]}),m]})]})})}function ei({caixaId:s,onClose:l,onSuccess:t}){const[m,r]=a.useState(null),[g,o]=a.useState(""),[v,j]=a.useState(""),[f,N]=a.useState(!0),[d,x]=a.useState(!1),[k,w]=a.useState(!1),[c,b]=a.useState({n100:0,n50:0,n20:0,n10:0,n5:0,n2:0,moedas:0});a.useEffect(()=>{p()},[s]);const p=async()=>{try{const E=await Yo(s);console.log("ðŸ“Š Resumo do caixa recebido:",E),console.log("ðŸ“Š vendas_por_forma_pagamento:",E.vendas_por_forma_pagamento),r(E),o(E.totais.saldo_atual.toFixed(2))}catch(E){console.error("Erro ao carregar resumo:",E),alert("Erro ao carregar dados do caixa")}finally{N(!1)}},i=()=>!m||!g?0:parseFloat(g)-m.totais.saldo_atual,u=()=>c.n100*100+c.n50*50+c.n20*20+c.n10*10+c.n5*5+c.n2*2+parseFloat(c.moedas||0),n=()=>{const E=u();o(E.toFixed(2)),w(!1)},C=()=>{b({n100:0,n50:0,n20:0,n10:0,n5:0,n2:0,moedas:0})},h=async()=>{var $,K;if(!g){alert("Informe o valor contado no caixa");return}const E=i();if(!(Math.abs(E)>.01&&!window.confirm(`DiferenÃ§a de R$ ${Math.abs(E).toFixed(2)} ${E>0?"a mais":"a menos"}

Deseja continuar com o fechamento?`))){x(!0);try{await Gn(s,{valor_informado:parseFloat(g),observacoes_fechamento:v||null}),alert("Caixa fechado com sucesso!"),t(),l()}catch(te){console.error("Erro ao fechar caixa:",te),alert(((K=($=te.response)==null?void 0:$.data)==null?void 0:K.detail)||"Erro ao fechar caixa")}finally{x(!1)}}};if(f)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})});if(!m)return null;const _=i();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-red-600 to-orange-600 text-white p-6 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center",children:[e.jsx(Ys,{className:"w-7 h-7 mr-3"}),"Fechar Caixa"]}),e.jsxs("p",{className:"text-red-100 mt-1",children:["Caixa #",m.caixa.numero_caixa," - ",m.caixa.usuario_nome]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(ma,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-6 border-2 border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center",children:[e.jsx(Rs,{className:"w-5 h-5 mr-2 text-gray-700"}),"Resumo do Movimento"]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Valor de Abertura"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",m.caixa.valor_abertura.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(m.caixa.data_abertura).toLocaleString("pt-BR")})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-green-700 mb-1",children:[e.jsx(Ys,{className:"w-4 h-4 mr-1"}),"Entradas"]}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["+ R$ ",m.totais.vendas.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Movimento de entrada"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-blue-700 mb-1",children:[e.jsx(Aa,{className:"w-4 h-4 mr-1"}),"Suprimentos"]}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["+ R$ ",m.totais.suprimentos.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-orange-700 mb-1",children:[e.jsx(Va,{className:"w-4 h-4 mr-1"}),"Sangrias"]}),e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["- R$ ",m.totais.sangrias.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-red-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-red-700 mb-1",children:[e.jsx(La,{className:"w-4 h-4 mr-1"}),"Despesas"]}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["- R$ ",m.totais.despesas.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900",children:"Valor Contado no Caixa *"}),e.jsxs("button",{type:"button",onClick:()=>w(!k),className:"flex items-center space-x-1 px-3 py-1.5 text-sm bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors border border-blue-200",title:"Auxiliar na contagem de notas",children:[e.jsx(Rs,{className:"w-4 h-4"}),e.jsx("span",{children:"Auxiliar Contagem"})]})]}),k&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-xl p-5 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center",children:[e.jsx(Rs,{className:"w-5 h-5 mr-2 text-blue-600"}),"Auxiliar de Contagem"]}),e.jsx("button",{onClick:()=>w(!1),className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx(ma,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-gray-200 hover:border-gray-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-gray-500 to-gray-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 2"}),e.jsx("input",{type:"number",min:"0",value:c.n2,onChange:E=>b({...c,n2:parseInt(E.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-gray-500 focus:ring-2 focus:ring-gray-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-gray-600",children:["R$ ",(c.n2*2).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-purple-200 hover:border-purple-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 5"}),e.jsx("input",{type:"number",min:"0",value:c.n5,onChange:E=>b({...c,n5:parseInt(E.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-purple-600",children:["R$ ",(c.n5*5).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-red-200 hover:border-red-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-red-500 to-red-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 10"}),e.jsx("input",{type:"number",min:"0",value:c.n10,onChange:E=>b({...c,n10:parseInt(E.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-red-500 focus:ring-2 focus:ring-red-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-red-600",children:["R$ ",(c.n10*10).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-yellow-200 hover:border-yellow-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-yellow-500 to-yellow-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 20"}),e.jsx("input",{type:"number",min:"0",value:c.n20,onChange:E=>b({...c,n20:parseInt(E.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-yellow-600",children:["R$ ",(c.n20*20).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-blue-200 hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 50"}),e.jsx("input",{type:"number",min:"0",value:c.n50,onChange:E=>b({...c,n50:parseInt(E.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:["R$ ",(c.n50*50).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-green-200 hover:border-green-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-green-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 100"}),e.jsx("input",{type:"number",min:"0",value:c.n100,onChange:E=>b({...c,n100:parseInt(E.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-green-500 focus:ring-2 focus:ring-green-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",(c.n100*100).toFixed(2)]})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t-2 border-blue-300",children:e.jsx("div",{className:"bg-white rounded-lg p-4 border-2 border-amber-200 hover:border-amber-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-amber-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"ðŸ’° Moedas"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:c.moedas,onChange:E=>b({...c,moedas:parseFloat(E.target.value)||0}),className:"w-32 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200",placeholder:"0.00"})]}),e.jsxs("span",{className:"text-lg font-bold text-amber-600",children:["R$ ",(c.moedas||0).toFixed(2)]})]})})}),e.jsxs("div",{className:"mt-5 pt-5 border-t-2 border-blue-300",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl p-4 mb-4 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-semibold text-sm",children:"TOTAL CONTADO"}),e.jsxs("span",{className:"text-3xl font-bold text-white",children:["R$ ",u().toFixed(2)]})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:C,className:"flex-1 px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-semibold transition-colors",children:"ðŸ—‘ï¸ Limpar"}),e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 font-bold shadow-md transition-all",children:"âœ“ Aplicar"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(La,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:g,onChange:E=>o(E.target.value),className:"w-full pl-10 pr-4 py-3 text-lg font-semibold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",autoFocus:!0})]}),g&&Math.abs(_)>.01&&e.jsx("div",{className:`mt-3 p-4 rounded-lg border-2 ${_>0?"bg-blue-50 border-blue-300":"bg-yellow-50 border-yellow-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-semibold text-gray-900",children:[_>0?"Sobra":"Falta",":"]}),e.jsxs("span",{className:`text-xl font-bold ${_>0?"text-blue-600":"text-yellow-700"}`,children:["R$ ",Math.abs(_).toFixed(2)]})]})}),g&&Math.abs(_)<=.01&&e.jsx("div",{className:"mt-3 p-4 rounded-lg border-2 bg-green-50 border-green-300",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-green-700 font-semibold",children:[e.jsx("span",{className:"text-2xl",children:"âœ“"}),e.jsx("span",{children:"Caixa conferido - Valores corretos!"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"ObservaÃ§Ãµes (opcional)"}),e.jsx("textarea",{value:v,onChange:E=>j(E.target.value),placeholder:"Adicione observaÃ§Ãµes sobre o fechamento...",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),m.vendas_por_forma_pagamento&&Object.keys(m.vendas_por_forma_pagamento).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center",children:[e.jsx(Ys,{className:"w-4 h-4 mr-1.5 text-blue-600"}),"Vendas por Forma de Pagamento (Informativo)"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(m.vendas_por_forma_pagamento).map(([E,$])=>{const K=E==="Dinheiro";return e.jsx("div",{className:`bg-white rounded-lg p-3 border ${K?"border-green-300 bg-green-50":"border-gray-200"} hover:shadow-sm transition-shadow cursor-pointer`,title:"Clique para ver detalhes das vendas",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${E==="Dinheiro"?"bg-green-500":E==="PIX"?"bg-purple-500":E.includes("DÃ©bito")?"bg-blue-500":E.includes("CrÃ©dito")?"bg-orange-500":"bg-gray-400"}`}),e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:E}),K&&e.jsx("span",{className:"text-xs bg-green-600 text-white px-1.5 py-0.5 rounded",children:"CAIXA"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[$.quantidade," venda",$.quantidade!==1?"s":""]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:["R$ ",$.total.toFixed(2)]})})]})},E)})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200 text-xs text-gray-600",children:["ðŸ’¡ ",e.jsx("strong",{children:"Dica:"})," Apenas ",e.jsx("strong",{children:"Dinheiro"})," afeta o saldo fÃ­sico do caixa. Demais formas vÃ£o para banco/financeiro."]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:l,disabled:d,className:"px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),e.jsx("button",{onClick:h,disabled:d||!g,className:"px-8 py-3 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white rounded-lg font-bold transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Fechando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ys,{className:"w-5 h-5"}),e.jsx("span",{children:"Fechar Caixa"})]})})]})]})]})})}function ai({caixaId:s,onClose:l,onSucesso:t}){var B;const[m,r]=a.useState(1),[g,o]=a.useState([]),[v,j]=a.useState(null),[f,N]=a.useState({}),[d,x]=a.useState({}),[k,w]=a.useState(""),[c,b]=a.useState(!1),[p,i]=a.useState(!1),[u,n]=a.useState(""),[C,h]=a.useState({}),[_,E]=a.useState({}),[$,K]=a.useState({}),[te,M]=a.useState({busca:"",data_inicio:"",data_fim:"",status:"finalizada"});a.useEffect(()=>{A()},[te]);const A=async()=>{i(!0),n("");try{const y={per_page:50,...te},O=await F.get("/vendas",{params:y});o(O.data.vendas||[])}catch(y){console.error("Erro ao buscar vendas:",y),n("Erro ao carregar vendas")}finally{i(!1)}},Q=async y=>{var O,z;i(!0),n("");try{const ae=await F.get(`/vendas/${y.id}`);j(ae.data);const W={};ae.data.itens.forEach(ne=>{W[ne.id]=ne.quantidade}),x(W),r(2)}catch(ae){console.error("Erro ao buscar venda:",ae),n(((z=(O=ae.response)==null?void 0:O.data)==null?void 0:z.detail)||"Erro ao carregar detalhes da venda")}finally{i(!1)}},re=y=>{const O=f[y];N(z=>({...z,[y]:!z[y]})),O&&(h(z=>{const ae={...z};return delete ae[y],ae}),E(z=>{const ae={...z};return delete ae[y],ae}),K(z=>{const ae={...z};return delete ae[y],ae}))},q=(y,O)=>{const ae=v.itens.find(ne=>ne.id===y).quantidade,W=Math.min(Math.max(0,parseFloat(O)||0),ae);x(ne=>({...ne,[y]:W}))},Z=y=>y.tipo_produto==="KIT"&&y.composicao_kit&&y.composicao_kit.length>0,R=(y,O)=>{if(h(z=>({...z,[y]:O})),O==="componentes"){const z=v.itens.find(ae=>ae.id===y);if(z&&z.composicao_kit){const ae={},W={};z.composicao_kit.forEach((ne,H)=>{ae[H]=!1,W[H]=ne.quantidade*z.quantidade}),E(ne=>({...ne,[y]:ae})),K(ne=>({...ne,[y]:W}))}}},J=(y,O)=>{E(z=>{var ae;return{...z,[y]:{...z[y]||{},[O]:!((ae=z[y])!=null&&ae[O])}}})},S=(y,O,z)=>{const ae=v.itens.find(ee=>ee.id===y),ne=ae.composicao_kit[O].quantidade*ae.quantidade,H=Math.min(Math.max(0,parseFloat(z)||0),ne);K(ee=>({...ee,[y]:{...ee[y]||{},[O]:H}}))},P=async()=>{var ae,W;if(Object.keys(f).filter(ne=>f[ne]).filter(ne=>{const H=v.itens.find(ee=>ee.id===parseInt(ne));return Z(H)&&!C[ne]}).length>0){n("Para itens KIT, vocÃª deve escolher entre devolver o KIT inteiro ou selecionar componentes");return}const O=[];if(Object.keys(f).filter(ne=>f[ne]).forEach(ne=>{const H=parseInt(ne),ee=v.itens.find(de=>de.id===H);if(Z(ee)){const de=C[ne];if(de==="kit_inteiro")O.push({item_id:H,quantidade:d[ne]});else if(de==="componentes"){const ue=_[ne]||{},Re=$[ne]||{},se=Object.keys(ue).filter(_e=>ue[_e]).map(_e=>parseInt(_e));if(se.length===0){n(`VocÃª deve selecionar pelo menos um componente do KIT "${ee.produto_nome}"`);return}se.forEach(_e=>{const ke=ee.composicao_kit[_e],Ze=Re[_e]||0;if(Ze<=0){n(`Quantidade do componente "${ke.produto_nome}" deve ser maior que zero`);return}O.push({produto_id:ke.produto_id,quantidade:Ze,preco_unitario:ee.preco_unitario/ee.composicao_kit.reduce((ze,Xe)=>ze+Xe.quantidade,0)*ke.quantidade,is_componente_kit:!0,kit_item_id:H})})}}else O.push({item_id:H,quantidade:d[ne]})}),O.length===0){n("Selecione pelo menos um item para devoluÃ§Ã£o");return}if(O.some(ne=>ne.quantidade<=0)){n("Todas as quantidades devem ser maiores que zero");return}if(!k.trim()){n("Informe o motivo da devoluÃ§Ã£o");return}i(!0),n("");try{await F.post(`/vendas/${v.id}/devolucao`,{caixa_id:s,itens:O,motivo:k,gerar_credito:c}),alert("DevoluÃ§Ã£o registrada com sucesso!"),t()}catch(ne){console.error("Erro ao registrar devoluÃ§Ã£o:",ne),n(((W=(ae=ne.response)==null?void 0:ae.data)==null?void 0:W.detail)||"Erro ao registrar devoluÃ§Ã£o")}finally{i(!1)}},G=()=>{if(!v)return 0;let y=0;return Object.keys(f).filter(O=>f[O]).forEach(O=>{const z=v.itens.find(ae=>ae.id===parseInt(O));if(Z(z)){const ae=C[O];if(ae==="kit_inteiro"){const W=d[O]||0;y+=z.preco_unitario*W}else if(ae==="componentes"){const W=_[O]||{},ne=$[O]||{},H=z.composicao_kit.reduce((ee,de)=>ee+de.quantidade,0);Object.keys(W).filter(ee=>W[ee]).forEach(ee=>{const de=z.composicao_kit[ee],ue=ne[ee]||0,Re=z.preco_unitario/H*de.quantidade,se=ue/de.quantidade;y+=Re*se})}}else{const ae=d[O]||0;y+=z.preco_unitario*ae}}),y};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(Po,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"DevoluÃ§Ã£o"}),e.jsx("p",{className:"text-sm text-gray-500",children:m===1?"Selecione a venda":"Selecionar itens para devoluÃ§Ã£o"})]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ma,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[m===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar"}),e.jsx("input",{type:"text",value:te.busca,onChange:y=>M({...te,busca:y.target.value}),placeholder:"NÃºmero da venda, cliente...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:te.data_inicio,onChange:y=>M({...te,data_inicio:y.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Fim"}),e.jsx("input",{type:"date",value:te.data_fim,onChange:y=>M({...te,data_fim:y.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})}),p?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando vendas..."})]}):g.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(da,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Nenhuma venda encontrada"})]}):e.jsx("div",{className:"space-y-2",children:g.map(y=>{var O;return e.jsx("button",{onClick:()=>Q(y),className:"w-full text-left p-4 border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:["Venda #",y.numero_venda||y.id]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Cliente: ",((O=y.cliente)==null?void 0:O.nome)||"Consumidor Final"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:y.data_criacao?new Date(y.data_criacao).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Data nÃ£o disponÃ­vel"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold text-green-600",children:["R$ ",y.total.toFixed(2)]}),e.jsx("div",{className:`text-xs mt-1 px-2 py-1 rounded ${y.status==="finalizada"?"bg-green-100 text-green-800":y.status==="baixa_parcial"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:y.status==="finalizada"?"Finalizada":y.status==="baixa_parcial"?"Parcial":"Aberta"})]})]})},y.id)})}),u&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(da,{className:"w-5 h-5"}),e.jsx("span",{children:u})]})]}),m===2&&v&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-2",children:["Venda #",v.numero_venda||v.id]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{className:"ml-2 font-medium",children:v.data_criacao?new Date(v.data_criacao).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Data nÃ£o disponÃ­vel"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Cliente:"}),e.jsx("span",{className:"ml-2 font-medium",children:((B=v.cliente)==null?void 0:B.nome)||"Consumidor Final"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"ml-2 font-medium text-green-600",children:["R$ ",v.total.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Itens da Venda"}),e.jsx("div",{className:"space-y-2",children:v.itens.map(y=>{const O=Z(y),z=C[y.id];return e.jsx("div",{className:`border rounded-lg p-4 transition-colors ${f[y.id]?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("input",{type:"checkbox",checked:f[y.id]||!1,onChange:()=>re(y.id),className:"mt-1 w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:y.produto_nome}),O&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded",children:[e.jsx(Ro,{className:"w-3 h-3"}),"KIT"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["PreÃ§o unitÃ¡rio: R$ ",y.preco_unitario.toFixed(2)," | Qtd vendida: ",y.quantidade]}),f[y.id]&&O&&e.jsxs("div",{className:"mt-4 bg-white border-2 border-purple-300 rounded-lg p-4",children:[e.jsxs("div",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(Za,{className:"w-5 h-5 text-purple-600"}),"Como deseja devolver este KIT?"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:`modo-kit-${y.id}`,checked:z==="kit_inteiro",onChange:()=>R(y.id,"kit_inteiro"),className:"mt-1 w-4 h-4 text-blue-600 focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800 group-hover:text-blue-700 transition-colors",children:"ðŸ“¦ Devolver KIT Inteiro"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Devolve o KIT completo como uma unidade"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:`modo-kit-${y.id}`,checked:z==="componentes",onChange:()=>R(y.id,"componentes"),className:"mt-1 w-4 h-4 text-purple-600 focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800 group-hover:text-purple-700 transition-colors",children:"ðŸ§© Selecionar Componentes"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Escolha quais componentes do KIT devolver"})]})]})]})]}),f[y.id]&&!O&&e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantidade a devolver:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:y.quantidade,value:d[y.id],onChange:ae=>q(y.id,ae.target.value),className:"w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Subtotal: R$ ",(y.preco_unitario*(d[y.id]||0)).toFixed(2)]})]}),f[y.id]&&O&&z==="kit_inteiro"&&e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantidade de KITs a devolver:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:y.quantidade,value:d[y.id],onChange:ae=>q(y.id,ae.target.value),className:"w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Subtotal: R$ ",(y.preco_unitario*(d[y.id]||0)).toFixed(2)]})]}),f[y.id]&&O&&z==="componentes"&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-purple-50 to-blue-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold text-gray-800 mb-3",children:"Selecione os componentes a devolver:"}),e.jsx("div",{className:"space-y-3",children:y.composicao_kit.map((ae,W)=>{var ee,de;const ne=(ee=_[y.id])==null?void 0:ee[W],H=ae.quantidade*y.quantidade;return e.jsx("div",{className:`border rounded-lg p-3 transition-colors ${ne?"border-purple-500 bg-white":"border-gray-200 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:ne||!1,onChange:()=>J(y.id,W),className:"mt-1 w-4 h-4 text-purple-600 rounded focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Za,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-800",children:ae.produto_nome})]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["Qtd no KIT: ",ae.quantidade," | Qtd total disponÃ­vel: ",H]}),ne&&e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Quantidade:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:H,value:((de=$[y.id])==null?void 0:de[W])||0,onChange:ue=>S(y.id,W,ue.target.value),className:"w-24 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500"})]})]})]})},W)})})]})]})]})},y.id)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Motivo da DevoluÃ§Ã£o *"}),e.jsx("textarea",{value:k,onChange:y=>w(y.target.value),placeholder:"Descreva o motivo da devoluÃ§Ã£o...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 border-2 border-purple-200 rounded-lg p-5",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-3",children:"ðŸ’³ Tipo de DevoluÃ§Ã£o"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",checked:!c,onChange:()=>b(!1),className:"mt-1 w-5 h-5 text-green-600 focus:ring-2 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800 group-hover:text-green-700 transition-colors",children:"ðŸ’µ Devolver em Dinheiro"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"O valor serÃ¡ devolvido em dinheiro e registrado como saÃ­da de caixa"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",checked:c,onChange:()=>b(!0),className:"mt-1 w-5 h-5 text-purple-600 focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800 group-hover:text-purple-700 transition-colors",children:"ðŸŽ Gerar CrÃ©dito para o Cliente"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"O valor serÃ¡ convertido em crÃ©dito para uso em futuras compras (sem movimentaÃ§Ã£o de caixa)"})]})]})]}),c&&!(v!=null&&v.cliente_id)&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-300 rounded-lg",children:e.jsxs("p",{className:"text-xs text-yellow-800 flex items-center gap-2",children:[e.jsx(da,{className:"w-4 h-4"}),e.jsxs("span",{children:[e.jsx("strong",{children:"AtenÃ§Ã£o:"})," Esta venda nÃ£o possui cliente vinculado. Para gerar crÃ©dito, Ã© necessÃ¡rio ter um cliente cadastrado."]})]})})]}),e.jsx("div",{className:`border-2 rounded-lg p-4 ${c?"bg-purple-50 border-purple-300":"bg-orange-50 border-orange-200"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:c?"CrÃ©dito a Gerar:":"Total da DevoluÃ§Ã£o:"}),c&&(v==null?void 0:v.cliente)&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Cliente: ",e.jsx("strong",{children:v.cliente.nome})]})]}),e.jsxs("span",{className:`text-2xl font-bold ${c?"text-purple-600":"text-orange-600"}`,children:["R$ ",G().toFixed(2)]})]})}),u&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(da,{className:"w-5 h-5"}),e.jsx("span",{children:u})]})]})]}),e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:m===1?l:()=>{r(1),j(null),N({}),x({}),w(""),n("")},disabled:p,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:m===1?"Cancelar":"Voltar"}),m===2&&e.jsx("button",{onClick:P,disabled:p||Object.values(f).filter(Boolean).length===0,className:"flex items-center gap-2 px-8 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ao,{className:"w-5 h-5"}),e.jsx("span",{children:"Confirmar DevoluÃ§Ã£o"})]})})]})})]})})}function si({caixaId:s,onClose:l}){const[t,m]=a.useState([]),[r,g]=a.useState(null),[o,v]=a.useState(!0);a.useEffect(()=>{j()},[s]);const j=async()=>{try{v(!0);const d=await F.get(`/caixas/${s}/movimentacoes`);m(d.data.movimentacoes),g(d.data.caixa)}catch(d){console.error("Erro ao carregar movimentaÃ§Ãµes:",d),Se.error("Erro ao carregar movimentaÃ§Ãµes do caixa")}finally{v(!1)}},f=d=>{const x=new Date(d);return new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}).format(x)},N=d=>({venda:"Venda",suprimento:"Suprimento",sangria:"Sangria",despesa:"Despesa",devolucao:"DevoluÃ§Ã£o",transferencia:"TransferÃªncia"})[d]||d;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-blue-50 to-purple-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:"ðŸ“‹ Extrato do Caixa"}),r&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Caixa #",r.id," - ",r.nome," | Status: ",r.status]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:j,className:"p-2 hover:bg-white rounded-lg transition-colors",title:"Atualizar",children:e.jsx(Fa,{className:`w-5 h-5 text-gray-600 ${o?"animate-spin":""}`})}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(ma,{className:"w-5 h-5 text-gray-600"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“­"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhuma movimentaÃ§Ã£o registrada"})]}):e.jsx("div",{className:"space-y-3",children:t.map(d=>e.jsx("div",{className:`p-4 rounded-lg border-2 ${d.natureza==="entrada"?"bg-green-50 border-green-200":d.natureza==="saida"?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"text-3xl",children:d.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:N(d.tipo)}),d.forma_pagamento&&e.jsx("span",{className:"text-xs bg-white px-2 py-1 rounded border",children:d.forma_pagamento})]}),d.descricao&&e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:d.descricao}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-2 text-xs text-gray-600",children:[e.jsxs("span",{children:["ðŸ• ",f(d.data_movimento)]}),e.jsxs("span",{children:["ðŸ‘¤ ",d.usuario_nome]}),d.venda_id&&e.jsxs("span",{children:["ðŸ§¾ Venda #",d.venda_numero||d.venda_id]}),d.documento&&e.jsxs("span",{children:["ðŸ“„ ",d.documento]})]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("div",{className:`text-2xl font-bold ${d.natureza==="entrada"?"text-green-600":d.natureza==="saida"?"text-red-600":"text-gray-600"}`,children:[d.natureza==="entrada"&&"+",d.natureza==="saida"&&"-","R$ ",d.valor.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:d.natureza==="entrada"?e.jsxs("span",{className:"flex items-center gap-1 justify-end",children:[e.jsx(Aa,{className:"w-3 h-3"})," Entrada"]}):d.natureza==="saida"?e.jsxs("span",{className:"flex items-center gap-1 justify-end",children:[e.jsx(Va,{className:"w-3 h-3"})," SaÃ­da"]}):"Neutro"})]})]})},d.id))})}),e.jsx("div",{className:"border-t p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[t.length," movimentaÃ§Ã£o(Ãµes) encontrada(s)"]}),e.jsx("button",{onClick:l,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Fechar"})]})})]})})}function ti({onAbrirCaixa:s}){var u,n,C;const[l,t]=a.useState(null),[m,r]=a.useState(null),[g,o]=a.useState(!1),[v,j]=a.useState(null),[f,N]=a.useState(!0),[d,x]=a.useState(!1),[k,w]=a.useState(!1);a.useEffect(()=>{b();const h=setInterval(b,3e4);return()=>clearInterval(h)},[]),a.useEffect(()=>{const h=()=>{x(!1)};if(d)return document.addEventListener("mouseup",h),()=>document.removeEventListener("mouseup",h)},[d]);const c=()=>{o(!1),w(!1),x(!1)},b=async()=>{try{const h=await Kn();if(t(h),h){const _=await Yo(h.id);r(_)}}catch(h){console.error("Erro ao carregar caixa:",h)}finally{N(!1)}},p=()=>{j(null),b()},i=async()=>{await s(),setTimeout(b,500)};return f?e.jsx("div",{className:"px-4 py-2 bg-gray-100 rounded-lg",children:e.jsx("div",{className:"animate-pulse h-10 bg-gray-200 rounded"})}):l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>o(!g),className:"flex items-center space-x-3 px-4 py-2 bg-white border-2 border-green-500 rounded-lg hover:bg-green-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["Caixa #",l.numero_caixa]})]}),e.jsx(Ms,{className:`w-5 h-5 text-gray-400 transition-transform ${g?"rotate-180":""}`})]}),g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:c}),e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 z-50",children:[e.jsxs("div",{className:"p-4 border-b bg-gradient-to-r from-green-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Caixa #",l.numero_caixa]}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:l.usuario_nome})]}),e.jsx("button",{onClick:c,className:"p-1 hover:bg-white rounded-lg transition-colors",children:e.jsx(ma,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(Ts,{className:"w-4 h-4 mr-1"}),"Aberto em ",new Date(l.data_abertura).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Saldo Atual"}),e.jsx("div",{className:`text-sm font-bold ${d?"text-green-600":"text-gray-400"}`,children:d?`R$ ${((n=(u=m==null?void 0:m.totais)==null?void 0:u.saldo_atual)==null?void 0:n.toFixed(2))||"0,00"}`:"â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsx("button",{onMouseDown:()=>x(!0),className:"p-1 hover:bg-blue-100 rounded transition-colors",children:d?e.jsx(Nt,{className:"w-4 h-4 text-blue-600"}):e.jsx(Zt,{className:"w-4 h-4 text-gray-400"})})]})]})]}),m&&e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900",children:"Resumo do Movimento"}),e.jsx("button",{onClick:()=>w(!k),className:"p-1 hover:bg-gray-200 rounded transition-colors",children:k?e.jsx(Nt,{className:"w-4 h-4 text-blue-600"}):e.jsx(Zt,{className:"w-4 h-4 text-gray-400"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Abertura"}),e.jsx("div",{className:`font-semibold ${k?"text-gray-900":"text-gray-300"}`,children:k?`R$ ${l.valor_abertura.toFixed(2)}`:"â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Entradas"}),e.jsx("div",{className:`font-semibold ${k?"text-green-600":"text-green-300"}`,children:k?`+ R$ ${m.totais.vendas.toFixed(2)}`:"â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Suprimentos"}),e.jsx("div",{className:`font-semibold ${k?"text-green-600":"text-green-300"}`,children:k?`+ R$ ${m.totais.suprimentos.toFixed(2)}`:"â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Sangrias"}),e.jsx("div",{className:`font-semibold ${k?"text-orange-600":"text-orange-300"}`,children:k?`- R$ ${m.totais.sangrias.toFixed(2)}`:"â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Despesas"}),e.jsx("div",{className:`font-semibold ${k?"text-red-600":"text-red-300"}`,children:k?`- R$ ${m.totais.despesas.toFixed(2)}`:"â€¢â€¢â€¢â€¢â€¢â€¢"})]})]})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{onClick:()=>{j("suprimento"),o(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-green-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(Aa,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Suprimento"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Adicionar dinheiro ao caixa"})]})]}),e.jsxs("button",{onClick:()=>{j("sangria"),o(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-orange-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(Va,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Sangria"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Retirar dinheiro do caixa"})]})]}),e.jsxs("button",{onClick:()=>{j("despesa"),o(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-red-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(Ys,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Despesa"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Registrar pagamento de despesa"})]})]}),e.jsxs("button",{onClick:()=>{j("devolucao"),o(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-purple-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(Po,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"DevoluÃ§Ã£o"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Estornar venda e devolver ao estoque"})]})]}),e.jsxs("button",{onClick:()=>{j("movimentacoes"),o(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-blue-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(hl,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Extrato do Caixa"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Ver todas as movimentaÃ§Ãµes"})]})]})]}),e.jsx("div",{className:"p-4 border-t",children:e.jsx("button",{onClick:()=>{j("fechar"),o(!1)},className:"w-full px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Fechar Caixa"})})]})]})]}),v==="suprimento"&&e.jsx(Jn,{caixaId:l.id,onClose:()=>j(null),onSucesso:p}),v==="sangria"&&e.jsx(Yn,{caixaId:l.id,saldoAtual:((C=m==null?void 0:m.totais)==null?void 0:C.saldo_atual)||0,onClose:()=>j(null),onSucesso:p}),v==="despesa"&&e.jsx(Zn,{caixaId:l.id,onClose:()=>j(null),onSucesso:p}),v==="fechar"&&e.jsx(ei,{caixaId:l.id,onClose:()=>j(null),onSuccess:()=>{j(null),b()}}),v==="devolucao"&&e.jsx(ai,{caixaId:l.id,onClose:()=>j(null),onSucesso:p}),v==="movimentacoes"&&e.jsx(si,{caixaId:l.id,onClose:()=>j(null)})]}):e.jsxs("button",{onClick:i,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(La,{className:"w-5 h-5"}),e.jsx("span",{children:"Abrir Caixa"})]})}function ri({venda:s,onClose:l}){var m,r;const t=()=>{window.print()};return s?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-800 text-white rounded-lg transition-colors print:hidden",children:[e.jsx(fr,{className:"w-5 h-5"}),e.jsx("span",{children:"Imprimir Cupom"})]}),e.jsx("style",{children:`
        @media print {
          /* Esconder tudo exceto o cupom */
          body * {
            visibility: hidden;
          }
          .cupom-impressao, .cupom-impressao * {
            visibility: visible;
          }
          .cupom-impressao {
            position: absolute;
            left: 0;
            top: 0;
            width: 80mm;
            margin: 0;
            padding: 0;
          }
          
          /* Reset de margens para impressÃ£o */
          @page {
            size: 80mm auto;
            margin: 5mm;
          }
        }
      `}),e.jsxs("div",{className:"cupom-impressao hidden print:block",style:{width:"80mm",fontFamily:"monospace"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"10px"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold"},children:"PET SHOP PRO"}),e.jsx("div",{style:{fontSize:"12px"},children:"Central de Gest\\u00e3o"}),e.jsx("div",{style:{fontSize:"10px",marginTop:"5px"},children:new Date().toLocaleString("pt-BR")})]}),e.jsxs("div",{style:{borderTop:"1px dashed #000",marginBottom:"10px",paddingTop:"10px"},children:[e.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"5px"},children:["VENDA #",s.numero_venda||s.id]}),e.jsxs("div",{style:{fontSize:"11px"},children:[e.jsxs("div",{children:["Data: ",s.data_venda?new Date(s.data_venda).toLocaleString("pt-BR"):new Date().toLocaleString("pt-BR")]}),s.cliente&&e.jsxs("div",{children:["Cliente: ",s.cliente.nome||s.cliente_nome]}),s.pet&&e.jsxs("div",{children:["Pet: ",s.pet.nome]})]})]}),e.jsx("div",{style:{borderTop:"1px dashed #000",marginBottom:"10px",paddingTop:"10px"},children:e.jsxs("table",{style:{width:"100%",fontSize:"10px",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid #000"},children:[e.jsx("th",{style:{textAlign:"left",paddingBottom:"5px"},children:"Item"}),e.jsx("th",{style:{textAlign:"center",paddingBottom:"5px"},children:"Qtd"}),e.jsx("th",{style:{textAlign:"right",paddingBottom:"5px"},children:"Valor"})]})}),e.jsx("tbody",{children:(m=s.itens)==null?void 0:m.map((g,o)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{paddingTop:"5px",paddingBottom:"5px"},children:[g.produto_nome,e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"9px",color:"#666"},children:[g.quantidade," x R$ ",g.preco_unitario.toFixed(2),g.desconto_valor>0&&e.jsxs("span",{style:{color:"#ff8c00"},children:[" ","com R$ ",g.desconto_valor.toFixed(2)," de desconto"]})]})]}),e.jsx("td",{style:{textAlign:"center",paddingTop:"5px",paddingBottom:"5px"},children:g.quantidade}),e.jsxs("td",{style:{textAlign:"right",paddingTop:"5px",paddingBottom:"5px"},children:["R$ ",g.subtotal.toFixed(2)]})]},o))})]})}),e.jsxs("div",{style:{borderTop:"1px dashed #000",paddingTop:"10px",fontSize:"11px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Total bruto:"}),e.jsxs("span",{children:["R$ ",(s.subtotal+s.desconto_valor).toFixed(2)]})]}),s.desconto_valor>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px",color:"#ff8c00"},children:[e.jsxs("span",{children:[(s.desconto_valor/(s.subtotal+s.desconto_valor)*100).toFixed(2),"% de desconto:"]}),e.jsxs("span",{children:["R$ ",s.desconto_valor.toFixed(2)]})]}),s.tem_entrega&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsxs("span",{children:["R$ ",(((r=s.entrega)==null?void 0:r.taxa_entrega_total)||0).toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",paddingTop:"10px",borderTop:"1px solid #000",fontSize:"14px",fontWeight:"bold"},children:[e.jsx("span",{children:"TOTAL:"}),e.jsxs("span",{children:["R$ ",s.total.toFixed(2)]})]})]}),s.pagamentos&&s.pagamentos.length>0&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"PAGAMENTOS:"}),s.pagamentos.map((g,o)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"3px"},children:[e.jsx("span",{children:g.forma_pagamento}),e.jsxs("span",{children:["R$ ",g.valor.toFixed(2)]})]},o))]}),s.tem_entrega&&s.entrega&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"ENTREGA:"}),e.jsx("div",{children:s.entrega.endereco_completo}),s.entrega.observacoes_entrega&&e.jsxs("div",{style:{marginTop:"3px",fontStyle:"italic"},children:["Obs: ",s.entrega.observacoes_entrega]})]}),s.observacoes&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"OBSERVA\\u00c7\\u00d5ES:"}),e.jsx("div",{children:s.observacoes})]}),e.jsxs("div",{style:{textAlign:"center",marginTop:"15px",paddingTop:"10px",borderTop:"1px dashed #000",fontSize:"10px"},children:[e.jsx("div",{children:"Obrigado pela preferencia!"}),e.jsx("div",{style:{marginTop:"5px"},children:"Volte sempre!"})]})]})]}):null}function oi({clienteId:s,clienteNome:l,onClose:t,onSucesso:m}){const[r,g]=a.useState([]),[o,v]=a.useState([]),[j,f]=a.useState(!0),[N,d]=a.useState(!1),[x,k]=a.useState(""),[w,c]=a.useState("dinheiro"),[b,p]=a.useState(""),[i,u]=a.useState(""),[n,C]=a.useState({total_vendas:0,total_em_aberto:0}),[h,_]=a.useState("antiga");a.useEffect(()=>{E()},[s]);const E=async()=>{try{f(!0);const re=await F.get(`/clientes/${s}/vendas-em-aberto`);g(re.data.vendas||[]),C(re.data.resumo||{total_vendas:0,total_em_aberto:0})}catch(re){console.error("Erro ao carregar vendas em aberto:",re),ce.error("Erro ao carregar vendas em aberto")}finally{f(!1)}},$=re=>{v(q=>q.includes(re)?q.filter(Z=>Z!==re):[...q,re])},K=()=>{o.length===r.length?v([]):v(r.map(re=>re.id))},te=re=>{const q=new Date,Z=new Date(re),R=Math.abs(q-Z);return Math.ceil(R/(1e3*60*60*24))},M=[...r].sort((re,q)=>h==="antiga"?new Date(re.data_venda)-new Date(q.data_venda):new Date(q.data_venda)-new Date(re.data_venda)),A=r.filter(re=>o.includes(re.id)).reduce((re,q)=>re+parseFloat(q.saldo_devedor),0),Q=async()=>{var re,q,Z,R;if(o.length===0){ce.error("Selecione ao menos uma venda");return}if(!x||parseFloat(x)<=0){ce.error("Informe um valor vÃ¡lido");return}if(parseFloat(x)>A){ce.error("Valor do pagamento nÃ£o pode ser maior que o total selecionado");return}try{d(!0),console.log("Enviando requisiÃ§Ã£o:",{vendas_ids:o,valor_total:parseFloat(x),forma_pagamento:w,numero_transacao:b||null,observacoes:i||null});const J=await F.post(`/clientes/${s}/baixar-vendas-lote`,{vendas_ids:o,valor_total:parseFloat(x),forma_pagamento:w,numero_transacao:b||null,observacoes:i||null});if(console.log("Resposta completa:",J),console.log("Response.data:",J.data),!J.data)throw new Error("Resposta vazia do servidor");const{vendas_quitadas:S,vendas_parciais:P,total_vendas_afetadas:G,valor_total_baixado:B}=J.data;let y=`ðŸ’° Total baixado: R$ ${B.toFixed(2)}
`;S.length>0&&(y+=`
âœ… ${S.length} venda(s) quitada(s):`,S.forEach(O=>{y+=`
  â€¢ ${O.numero_venda}: R$ ${O.valor_baixado.toFixed(2)}`})),P.length>0&&(y+=`

âš ï¸ ${P.length} venda(s) parcial:`,P.forEach(O=>{y+=`
  â€¢ ${O.numero_venda}:`,y+=`
    Baixado: R$ ${O.valor_baixado.toFixed(2)}`,y+=`
    Falta: R$ ${O.saldo_restante.toFixed(2)}`})),ce.success(y,{duration:6e3}),m&&m(),t()}catch(J){console.error("Erro completo:",J),console.error("Erro response:",J.response),console.error("Erro response data:",(re=J.response)==null?void 0:re.data),console.error("Erro response status:",(q=J.response)==null?void 0:q.status);const S=((R=(Z=J.response)==null?void 0:Z.data)==null?void 0:R.detail)||J.message||"Erro ao baixar vendas";ce.error(S)}finally{d(!1)}};return j?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-8 max-w-4xl w-full mx-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(nt,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando vendas..."})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-red-50 to-orange-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Vendas em Aberto"}),e.jsx("p",{className:"text-gray-600 mt-1",children:l})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(ma,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Vendas"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:n.total_vendas})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total em Aberto"}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["R$ ",n.total_em_aberto.toFixed(2)]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ha,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-medium text-gray-900",children:"Nenhuma venda em aberto!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Este cliente nÃ£o possui dÃ©bitos pendentes."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:K,className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:o.length===r.length?"Desmarcar todas":"Selecionar todas"}),e.jsxs("button",{onClick:()=>_(h==="antiga"?"recente":"antiga"),className:"text-sm text-gray-600 hover:text-gray-700 flex items-center gap-1 font-medium",children:["ðŸ“… ",h==="antiga"?"â†‘ Mais Antigas":"â†“ Mais Recentes"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[o.length," de ",r.length," selecionada(s)"]})]}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden mb-6",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:e.jsx("input",{type:"checkbox",checked:o.length===r.length,onChange:K,className:"rounded border-gray-300"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Venda"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Pago"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Saldo Devedor"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Dias"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:M.map(re=>{const q=te(re.data_venda),Z=q>30;return e.jsxs("tr",{className:`hover:bg-gray-50 ${o.includes(re.id)?"bg-blue-50":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:o.includes(re.id),onChange:()=>$(re.id),className:"rounded border-gray-300"})}),e.jsxs("td",{className:"px-4 py-3 font-medium text-gray-900",children:["#",re.numero_venda]}),e.jsx("td",{className:"px-4 py-3 text-gray-600 text-sm",children:new Date(re.data_venda).toLocaleDateString("pt-BR")}),e.jsxs("td",{className:"px-4 py-3 text-right text-gray-900",children:["R$ ",parseFloat(re.total).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right text-green-600",children:["R$ ",parseFloat(re.total_pago).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-red-600",children:["R$ ",parseFloat(re.saldo_devedor).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${Z?"bg-red-100 text-red-800":q>15?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:[q," ",q===1?"dia":"dias"]})})]},re.id)})})]})}),o.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Registrar Pagamento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor Total Selecionado"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["R$ ",A.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor do Pagamento *"}),e.jsx("input",{type:"number",step:"0.01",value:x,onChange:re=>k(re.target.value),placeholder:"0.00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de Pagamento *"}),e.jsxs("select",{value:w,onChange:re=>c(re.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"dinheiro",children:"Dinheiro"}),e.jsx("option",{value:"pix",children:"PIX"}),e.jsx("option",{value:"debito",children:"CartÃ£o de DÃ©bito"}),e.jsx("option",{value:"credito",children:"CartÃ£o de CrÃ©dito"}),e.jsx("option",{value:"transferencia",children:"TransferÃªncia"})]})]}),(w==="pix"||w==="transferencia")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"NÃºmero da TransaÃ§Ã£o"}),e.jsx("input",{type:"text",value:b,onChange:re=>p(re.target.value),placeholder:"CÃ³digo/ID da transaÃ§Ã£o",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ObservaÃ§Ãµes"}),e.jsx("textarea",{value:i,onChange:re=>u(re.target.value),rows:"2",placeholder:"InformaÃ§Ãµes adicionais sobre o pagamento...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-start space-x-2 mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(da,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"AtenÃ§Ã£o:"})," O valor serÃ¡ aplicado automaticamente da venda mais antiga para a mais recente. Se o valor for insuficiente para quitar todas as vendas selecionadas, a Ãºltima venda ficarÃ¡ parcialmente paga."]})]}),e.jsx("button",{onClick:Q,disabled:N||!x||parseFloat(x)<=0,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:N?e.jsxs(e.Fragment,{children:[e.jsx(nt,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(La,{className:"w-5 h-5"}),e.jsx("span",{children:"Baixar Vendas Selecionadas"})]})})]})]})})]})})}function li({clienteId:s,clienteNome:l,onClose:t}){var x,k,w;const[m,r]=a.useState(null),[g,o]=a.useState(!0),[v,j]=a.useState("todos");a.useEffect(()=>{f()},[s]);const f=async()=>{try{o(!0);const c=await F.get(`/clientes/${s}/historico-compras`);r(c.data)}catch(c){console.error("Erro ao carregar histÃ³rico:",c),ce.error("Erro ao carregar histÃ³rico do cliente")}finally{o(!1)}},N=c=>{const b={finalizada:"bg-green-100 text-green-800",baixa_parcial:"bg-yellow-100 text-yellow-800",pendente:"bg-blue-100 text-blue-800",cancelada:"bg-red-100 text-red-800",finalizada_devolucao_parcial:"bg-orange-100 text-orange-800",finalizada_devolucao_total:"bg-gray-100 text-gray-800"},p={finalizada:"Finalizada",baixa_parcial:"Baixa Parcial",pendente:"Pendente",cancelada:"Cancelada",finalizada_devolucao_parcial:"Dev. Parcial",finalizada_devolucao_total:"Dev. Total"};return e.jsx("span",{className:`inline-flex px-2 py-1 rounded-full text-xs font-medium ${b[c]||"bg-gray-100 text-gray-800"}`,children:p[c]||c})},d=((x=m==null?void 0:m.vendas)==null?void 0:x.filter(c=>v==="todos"?!0:c.status===v))||[];return g?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-8 max-w-4xl w-full mx-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(nt,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando histÃ³rico..."})]})})}):m?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"HistÃ³rico de Compras"}),e.jsx("p",{className:"text-gray-600 mt-1",children:l})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(ma,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ao,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Compras"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:m.total_compras})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(La,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Gasto"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",m.valor_total_gasto.toFixed(2)]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Aa,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Ticket MÃ©dio"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",m.ticket_medio.toFixed(2)]})]})]})})]}),m.ultima_compra&&e.jsxs("div",{className:"mt-4 bg-white rounded-lg p-3 shadow-sm flex items-center space-x-2 text-sm",children:[e.jsx(Cs,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-gray-600",children:["Ãšltima compra: ",new Date(m.ultima_compra).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"})]})]})]}),e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtrar por status:"}),e.jsxs("select",{value:v,onChange:c=>j(c.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500",children:[e.jsxs("option",{value:"todos",children:["Todos (",((k=m.vendas)==null?void 0:k.length)||0,")"]}),e.jsx("option",{value:"finalizada",children:"Finalizadas"}),e.jsx("option",{value:"baixa_parcial",children:"Baixa Parcial"}),e.jsx("option",{value:"pendente",children:"Pendentes"}),e.jsx("option",{value:"cancelada",children:"Canceladas"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ao,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:"Nenhuma venda encontrada"}),e.jsx("p",{className:"text-gray-600 mt-2",children:v==="todos"?"Este cliente ainda nÃ£o realizou compras.":"NÃ£o hÃ¡ vendas com este status."})]}):e.jsx("div",{className:"space-y-3",children:d.map(c=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Venda #",c.numero_venda]}),N(c.status)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Data:"}),e.jsx("div",{className:"font-medium text-gray-900",children:new Date(c.data_venda).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal:"}),e.jsxs("div",{className:"font-medium text-gray-900",children:["R$ ",c.subtotal.toFixed(2)]})]}),c.desconto_valor>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Desconto:"}),e.jsxs("div",{className:"font-medium text-red-600",children:["- R$ ",c.desconto_valor.toFixed(2)]})]}),c.taxa_entrega>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Taxa Entrega:"}),e.jsxs("div",{className:"font-medium text-gray-900",children:["R$ ",c.taxa_entrega.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total:"}),e.jsxs("div",{className:"font-bold text-gray-900 text-lg",children:["R$ ",c.total.toFixed(2)]})]}),c.saldo_devedor>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Saldo Devedor:"}),e.jsxs("div",{className:"font-bold text-red-600",children:["R$ ",c.saldo_devedor.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Itens:"}),e.jsx("div",{className:"font-medium text-gray-900",children:c.total_itens})]}),c.vendedor_nome&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Vendedor:"}),e.jsx("div",{className:"font-medium text-gray-900",children:c.vendedor_nome})]})]})]})})},c.id))})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[e.jsxs("span",{children:["Mostrando ",d.length," de ",((w=m.vendas)==null?void 0:w.length)||0," vendas"]}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:"Fechar"})]})})]})}):null}function ni({clienteId:s}){const[l,t]=a.useState(!1),[m,r]=a.useState(null),[g,o]=a.useState(null),[v,j]=a.useState(""),[f,N]=a.useState([]),[d,x]=a.useState(!1),k=a.useRef(null),[w,c]=a.useState({resumo:!1,pets:!1,compras:!1,oportunidades:!1,sugestoes:!1,relacionados:!1,sazonalidade:!1,chat:!1});a.useEffect(()=>{s&&b()},[s]);const b=async()=>{var M,A;try{t(!0),o(null);const Q=await F.get(`/clientes/${s}/info-pdv`);r(Q.data)}catch(Q){console.error("Erro ao carregar informaÃ§Ãµes do cliente:",Q),o(((A=(M=Q.response)==null?void 0:M.data)==null?void 0:A.detail)||"Erro ao carregar dados")}finally{t(!1)}},p=M=>{c(A=>({...A,[M]:!A[M]}))},i=async()=>{if(!v.trim())return;const M=v;j(""),N(A=>[...A,{tipo:"user",texto:M}]);try{x(!0);const A=await F.post(`/clientes/${s}/chat-pdv`,{mensagem:M});N(Q=>[...Q,{tipo:"ia",texto:A.data.resposta,ia_disponivel:A.data.ia_disponivel}]),setTimeout(()=>{var Q;return(Q=k.current)==null?void 0:Q.scrollIntoView({behavior:"smooth"})},100)}catch(A){console.error("Erro no chat:",A),N(Q=>[...Q,{tipo:"erro",texto:"Erro ao processar mensagem. Tente novamente."}])}finally{x(!1)}},u=M=>{M.key==="Enter"&&!M.shiftKey&&(M.preventDefault(),i())};if(!s)return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 text-center text-gray-500",children:[e.jsx(is,{className:"mx-auto text-4xl mb-2"}),e.jsx("p",{children:"Selecione um cliente para ver informaÃ§Ãµes"})]});if(l)return e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})});if(g)return e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:[e.jsx(Na,{className:"inline mr-2"}),g]});if(!m)return null;const{cliente:n,resumo_financeiro:C,pets:h,ultimas_compras:_,oportunidades:E,sugestoes:$,produtos_relacionados:K,padroes_sazonais:te}=m;return e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden max-h-[85vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-100 to-purple-100 p-4 border-b",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 mb-1",children:n.nome}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[n.cpf_cnpj&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(is,{className:"text-xs"}),n.cpf_cnpj]}),n.telefone&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx($o,{className:"text-xs"}),n.telefone]}),n.email&&e.jsxs("p",{className:"flex items-center gap-1 truncate",children:[e.jsx(wr,{className:"text-xs"}),n.email]}),n.endereco&&e.jsxs("p",{className:"flex items-center gap-1 text-xs",children:[e.jsx(bl,{className:"text-xs"}),n.endereco,", ",n.bairro," - ",n.cidade,"/",n.estado]})]})]})})}),e.jsxs(ys,{titulo:"Resumo Financeiro",icone:e.jsx(Ga,{}),expandido:w.resumo,onToggle:()=>p("resumo"),badge:C.numero_compras,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:"Total Gasto"}),e.jsxs("p",{className:"text-lg font-bold text-green-700",children:["R$ ",C.total_gasto.toFixed(2)]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"Ticket MÃ©dio"}),e.jsxs("p",{className:"text-lg font-bold text-blue-700",children:["R$ ",C.ticket_medio.toFixed(2)]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-purple-600 font-medium mb-1",children:"NÂº Compras"}),e.jsx("p",{className:"text-lg font-bold text-purple-700",children:C.numero_compras})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-orange-600 font-medium mb-1",children:"Maior Compra"}),e.jsxs("p",{className:"text-lg font-bold text-orange-700",children:["R$ ",C.maior_compra.valor.toFixed(2)]}),C.maior_compra.data&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:C.maior_compra.data})]})]}),C.ultima_compra.data&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(qs,{className:"text-xs"}),"Ãšltima compra: ",C.ultima_compra.data," - R$ ",C.ultima_compra.valor.toFixed(2)]})})]}),h&&h.length>0&&e.jsx(ys,{titulo:"Pets Registrados",icone:e.jsx(is,{}),expandido:w.pets,onToggle:()=>p("pets"),badge:h.length,children:e.jsx("div",{className:"space-y-2",children:h.map(M=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold",children:M.nome[0].toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800",children:M.nome}),e.jsxs("p",{className:"text-xs text-gray-500",children:[M.especie," ",M.raca&&`â€¢ ${M.raca}`,M.peso&&` â€¢ ${M.peso}kg`,M.idade_anos!==null&&` â€¢ ${M.idade_anos} anos`]})]})]},M.id))})}),E&&E.length>0&&e.jsx(ys,{titulo:"Oportunidades de Venda",icone:e.jsx(Na,{}),expandido:w.oportunidades,onToggle:()=>p("oportunidades"),badge:E.length,badgeColor:"bg-orange-500",children:e.jsx("div",{className:"space-y-2",children:E.map((M,A)=>e.jsxs("div",{className:`p-3 rounded-lg border-l-4 ${M.urgencia==="alta"?"bg-red-50 border-red-400":"bg-yellow-50 border-yellow-400"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:M.produto_nome}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:M.mensagem})]}),M.urgencia==="alta"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-red-500 text-white text-xs rounded-full",children:"Urgente"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Atrasado ",M.dias_atraso," dias"]})]},A))})}),$&&$.length>0&&e.jsx(ys,{titulo:"Produtos Favoritos",icone:e.jsx(Vs,{}),expandido:w.sugestoes,onToggle:()=>p("sugestoes"),badge:$.length,children:e.jsx("div",{className:"space-y-2",children:$.map((M,A)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:M.nome}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Comprado ",M.vezes_comprado,"x",M.ultima_compra&&` â€¢ Ãšltima: ${M.ultima_compra}`]})]}),e.jsxs("p",{className:"font-bold text-indigo-600 ml-2",children:["R$ ",M.preco.toFixed(2)]})]},A))})}),_&&_.length>0&&e.jsx(ys,{titulo:"Ãšltimas Compras",icone:e.jsx(st,{}),expandido:w.compras,onToggle:()=>p("compras"),badge:_.length,children:e.jsx("div",{className:"space-y-3",children:_.map((M,A)=>e.jsxs("div",{className:"border-l-4 border-indigo-300 pl-3 py-2 bg-gray-50 rounded-r-lg",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500",children:[M.data," â€¢ Venda #",M.numero_venda]}),e.jsxs("p",{className:"font-bold text-indigo-600",children:["R$ ",M.valor_total.toFixed(2)]})]})}),M.produtos&&M.produtos.length>0&&e.jsx("div",{className:"space-y-1 mt-2",children:M.produtos.map((Q,re)=>e.jsxs("p",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(Et,{className:"text-xs"}),Q.quantidade,"x ",Q.nome," - R$ ",Q.valor.toFixed(2)]},re))})]},A))})}),K&&K.length>0&&e.jsx(ys,{titulo:"Produtos Comprados Juntos",icone:e.jsx(fl,{}),expandido:w.relacionados,onToggle:()=>p("relacionados"),badge:K.length,badgeColor:"bg-purple-500",children:e.jsx("div",{className:"space-y-2",children:K.map((M,A)=>e.jsxs("div",{className:"p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"text-xs font-semibold text-purple-600",children:[M.vezes_juntos,"x comprados juntos"]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-800",children:M.produto1.nome}),e.jsxs("span",{className:"text-purple-600 font-bold",children:["R$ ",M.produto1.preco.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-800",children:M.produto2.nome}),e.jsxs("span",{className:"text-purple-600 font-bold",children:["R$ ",M.produto2.preco.toFixed(2)]})]})]}),e.jsx("p",{className:"text-xs text-purple-600 mt-2 italic",children:"ðŸ’¡ SugestÃ£o: Oferecer combo!"})]},A))})}),te&&te.length>0&&e.jsx(ys,{titulo:"PadrÃµes de Compra",icone:e.jsx(Qt,{}),expandido:w.sazonalidade,onToggle:()=>p("sazonalidade"),badge:te.length,badgeColor:"bg-green-500",children:e.jsx("div",{className:"space-y-2",children:te.map((M,A)=>e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-green-700",children:M.mes_ano}),e.jsxs("span",{className:"text-sm text-green-600",children:[M.numero_compras," compras"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"font-bold text-green-700 ml-1",children:["R$ ",M.total_gasto.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Ticket mÃ©dio:"}),e.jsxs("span",{className:"font-bold text-green-700 ml-1",children:["R$ ",M.ticket_medio.toFixed(2)]})]})]})]},A))})}),e.jsx(ys,{titulo:"Chat IA - Assistente de Vendas",icone:e.jsx(Ns,{}),expandido:w.chat,onToggle:()=>p("chat"),badgeColor:"bg-blue-500",children:e.jsxs("div",{className:"space-y-3",children:[f.length===0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Perguntas sugeridas:"}),["Quais os produtos favoritos?","Quando foi a Ãºltima compra?","Quais pets ele tem?","Quanto jÃ¡ gastou total?"].map((M,A)=>e.jsx("button",{onClick:()=>{j(M),setTimeout(()=>i(),100)},className:"w-full text-left px-3 py-2 text-xs bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition-colors",children:M},A))]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto space-y-2",children:[f.map((M,A)=>e.jsx("div",{className:`flex ${M.tipo==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] px-3 py-2 rounded-lg text-sm ${M.tipo==="user"?"bg-blue-600 text-white":M.tipo==="erro"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-800"}`,children:[M.texto,M.tipo==="ia"&&!M.ia_disponivel&&e.jsx("p",{className:"text-xs mt-1 opacity-70",children:"ðŸ’¡ Modo bÃ¡sico (IA nÃ£o configurada)"})]})},A)),e.jsx("div",{ref:k})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:v,onChange:M=>j(M.target.value),onKeyPress:u,placeholder:"Digite sua pergunta...",disabled:d,className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"}),e.jsx("button",{onClick:i,disabled:d||!v.trim(),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(jl,{className:"w-4 h-4"})})]})]})})]})}function ys({titulo:s,icone:l,expandido:t,onToggle:m,badge:r,badgeColor:g="bg-indigo-500",children:o}){return e.jsxs("div",{className:"border-b border-gray-200",children:[e.jsxs("button",{onClick:m,className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-indigo-600",children:l}),e.jsx("h4",{className:"font-semibold text-gray-800",children:s}),r!==void 0&&e.jsx("span",{className:`${g} text-white text-xs px-2 py-1 rounded-full`,children:r})]}),t?e.jsx(Do,{className:"text-gray-400"}):e.jsx(Os,{className:"text-gray-400"})]}),t&&e.jsx("div",{className:"px-4 pb-4",children:o})]})}const ii=({mostrar:s,onFechar:l,dados:t,carregando:m})=>{if(a.useEffect(()=>{const v=j=>{j.key==="Escape"&&s&&l()};if(s)return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[s,l]),!s)return null;const r=v=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(v||0),g=v=>{switch(v){case"verde":return"bg-green-100 border-green-500 text-green-800";case"amarelo":return"bg-yellow-100 border-yellow-500 text-yellow-800";case"vermelho":return"bg-red-100 border-red-500 text-red-800";default:return"bg-gray-100 border-gray-500 text-gray-800"}},o=v=>{switch(v){case"success":return e.jsx(ws,{className:"text-green-500"});case"error":return e.jsx(Na,{className:"text-red-500"});case"warning":return e.jsx(Na,{className:"text-yellow-500"});case"info":return e.jsx(zs,{className:"text-blue-500"});default:return e.jsx(zs,{className:"text-gray-500"})}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:l}),e.jsxs("div",{className:"fixed right-0 top-0 h-full w-96 bg-white shadow-2xl z-50 flex flex-col animate-slide-in-right",children:[e.jsxs("div",{className:"p-4 border-b bg-gradient-to-r from-blue-600 to-blue-700 text-white flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qt,{className:"w-5 h-5"}),e.jsx("h3",{className:"text-lg font-bold",children:"AnÃ¡lise da Venda"})]}),e.jsx("button",{onClick:l,className:"hover:bg-white hover:bg-opacity-20 p-1 rounded transition-colors",children:e.jsx(us,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:m?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ga,{className:"text-blue-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"ComposiÃ§Ã£o Financeira"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Total dos Produtos"}),e.jsx("span",{className:"font-semibold",children:r(t.composicao.total_produtos)})]}),t.composicao.desconto>0&&e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"(-) Descontos Aplicados"}),e.jsxs("span",{className:"font-semibold",children:[r(t.composicao.desconto),e.jsxs("span",{className:"text-xs ml-1",children:["(",(t.composicao.desconto/t.composicao.total_produtos*100).toFixed(1),"%)"]})]})]}),t.composicao.taxa_entrega>0&&e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"(-) Taxa de Entrega"}),e.jsx("span",{className:"font-semibold",children:r(t.composicao.taxa_entrega)})]}),e.jsx("div",{className:"border-t-2 border-blue-600 pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-blue-700",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:r(t.composicao.subtotal)})]})})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(or,{className:"text-orange-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"DeduÃ§Ãµes"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[t.deducoes.comissao.valor>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["ComissÃ£o do Vendedor (",t.deducoes.comissao.percentual,"%)"]}),e.jsx("span",{className:"font-semibold text-red-600",children:r(t.deducoes.comissao.valor)})]}),t.detalhamento_taxas&&t.detalhamento_taxas.length>0&&e.jsx(e.Fragment,{children:t.detalhamento_taxas.map((v,j)=>e.jsxs(ts.Fragment,{children:[v.taxa_percentual>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-600",children:["Taxa ",v.forma," (",v.taxa_percentual,"%)"]}),e.jsx("span",{className:"text-xs text-gray-500",children:r(v.valor_pagamento)})]}),e.jsx("span",{className:"font-semibold text-red-600",children:r(v.valor_taxa_percentual)})]}),v.taxa_fixa>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-600",children:["Taxa Fixa ",v.forma]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["R$ ",v.taxa_fixa.toFixed(2)]})]}),e.jsx("span",{className:"font-semibold text-red-600",children:r(v.valor_taxa_fixa)})]})]},j))}),(!t.detalhamento_taxas||t.detalhamento_taxas.length===0)&&t.deducoes.taxa_percentual>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Taxa Percentual"}),e.jsx("span",{className:"font-semibold text-red-600",children:r(t.deducoes.taxa_percentual)})]}),(!t.detalhamento_taxas||t.detalhamento_taxas.length===0)&&t.deducoes.taxa_fixa>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Taxa Fixa"}),e.jsx("span",{className:"font-semibold text-red-600",children:r(t.deducoes.taxa_fixa)})]}),t.deducoes.impostos.valor>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Impostos Estimados (",t.deducoes.impostos.percentual,"%)"]}),e.jsx("span",{className:"font-semibold text-red-600",children:r(t.deducoes.impostos.valor)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Custo dos Produtos"}),e.jsx("span",{className:"font-semibold text-red-600",children:r(t.deducoes.custos)})]}),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-semibold text-gray-700",children:[e.jsx("span",{children:"Total de DeduÃ§Ãµes"}),e.jsx("span",{className:"text-red-600",children:r(t.deducoes.total_deducoes)})]})})]})]}),e.jsxs("div",{className:`rounded-lg p-4 border-2 ${g(t.resultado.cor_indicador)}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Qt,{className:"w-5 h-5"}),e.jsx("h4",{className:"font-bold",children:"Resultado Final"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold",children:"Lucro LÃ­quido Estimado"}),e.jsx("span",{className:"text-2xl font-bold",children:r(t.resultado.lucro_liquido)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Margem LÃ­quida"}),e.jsxs("span",{className:"text-xl font-bold",children:[t.resultado.margem_liquida.toFixed(2),"%"]})]})]})]}),t.alertas&&t.alertas.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Na,{className:"text-purple-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"Alertas e SugestÃµes"})]}),e.jsx("div",{className:"space-y-2",children:t.alertas.map((v,j)=>e.jsxs("div",{className:`flex items-start gap-2 p-2 rounded text-sm ${v.tipo==="success"?"bg-green-50":v.tipo==="error"?"bg-red-50":v.tipo==="warning"?"bg-yellow-50":"bg-blue-50"}`,children:[e.jsx("span",{className:"flex-shrink-0 mt-0.5",children:o(v.tipo)}),e.jsxs("span",{className:"flex-1",children:[e.jsx("span",{className:"mr-1",children:v.icone}),v.mensagem]})]},j))})]}),t.detalhamento_comissoes&&t.detalhamento_comissoes.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-3",children:"Detalhamento de ComissÃµes"}),e.jsx("div",{className:"space-y-2 text-sm",children:t.detalhamento_comissoes.map((v,j)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-700",children:v.produto}),e.jsxs("div",{className:"text-xs text-gray-500",children:[v.percentual,"% de comissÃ£o"]})]}),e.jsx("span",{className:"font-semibold text-blue-600",children:r(v.valor)})]},j))})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Na,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"Erro ao carregar anÃ¡lise"})]})})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("button",{onClick:l,className:"w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Fechar"}),e.jsx("span",{className:"text-xs text-gray-300",children:"(ESC)"})]})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes slide-in-right {
          from {
            transform: translateX(100%);
          }
          to {
            transform: translateX(0);
          }
        }
        
        .animate-slide-in-right {
          animation: slide-in-right 0.3s ease-out;
        }
      `})]})};function di({itensCarrinho:s=[],onClose:l=()=>{},isOpen:t=!1,racaoIdFechada:m=null}){const[r,g]=a.useState(null),[o,v]=a.useState(!1),[j,f]=a.useState(null),[N,d]=a.useState(null),[x,k]=a.useState(!1),w=s.filter(p=>Ho(p));a.useEffect(()=>{t&&(console.log("ðŸ¥« Modal: RaÃ§Ãµes encontradas:",w.length),w.forEach((p,i)=>{console.log(`  ${i+1}. ${p.produto_nome} - peso_embalagem: ${p.peso_embalagem}`)}))},[t,w.length]),a.useEffect(()=>{if(t&&w.length>0){const p=w[w.length-1];m!==p.produto_id&&(g(p.produto_id),f(null),d(null),v(!1))}},[t,w.length,m]);const c=w.find(p=>p.produto_id===r),b=async()=>{if(!c){d("RaÃ§Ã£o nÃ£o selecionada");return}if(!(c.peso_embalagem||c.peso_pacote_kg)||!c.preco_unitario){console.error("âŒ Modal: Dados da raÃ§Ã£o incompletos",{peso_embalagem:c.peso_embalagem,peso_pacote_kg:c.peso_pacote_kg,preco_unitario:c.preco_unitario}),d("Dados da raÃ§Ã£o incompletos");return}try{v(!0),d(null),f(null);const i=c.peso_embalagem||c.peso_pacote_kg||1,u={especie:"cao",peso_kg:15,fase:"adulto",porte:"medio",tipo_racao:"premium",peso_pacote_kg:parseFloat(i),preco_pacote:parseFloat(c.preco_unitario)||0};console.log("ðŸ§‘ Modal: Enviando payload:",u);const n=await F.post("/internal/racao/calcular",u);n.data?f(n.data):d("Sem resposta do servidor")}catch(i){console.error("Erro ao calcular:",i),d(null)}finally{v(!1)}};return!t||w.length===0?(t&&w.length===0&&console.warn("âš ï¸ Modal: isOpen=true mas racoes.length=0"),null):(console.log("âœ… Modal: Renderizando com",w.length,"raÃ§Ãµes"),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-4 flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ¥«"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Calculadora de RaÃ§Ã£o"}),e.jsx("p",{className:"text-sm text-blue-100",children:"InformaÃ§Ãµes rÃ¡pidas"})]})]}),e.jsx("button",{onClick:()=>{l()},className:"p-1 hover:bg-blue-400 rounded-lg transition-colors",title:"Fechar",children:e.jsx(ma,{size:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[w.length>1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Selecionar RaÃ§Ã£o"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>k(!x),className:"w-full px-4 py-2 bg-white border border-gray-300 rounded-lg text-left flex items-center justify-between hover:border-blue-500 transition-colors",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:(c==null?void 0:c.produto_nome)||"Selecione uma raÃ§Ã£o"}),e.jsx(Ms,{size:20,className:`text-gray-500 transition-transform ${x?"rotate-180":""}`})]}),x&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg z-10 max-h-48 overflow-y-auto",children:w.map((p,i)=>e.jsxs("button",{onClick:()=>{g(p.produto_id),k(!1),f(null)},className:`w-full px-4 py-3 text-left border-b last:border-b-0 hover:bg-blue-50 transition-colors ${p.produto_id===r?"bg-blue-100 border-l-4 border-l-blue-600":""}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:p.produto_nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:[p.peso_embalagem||p.peso_pacote_kg?`${p.peso_embalagem||p.peso_pacote_kg}kg`:""," â€¢ R$ ",(p.preco_unitario||0).toFixed(2)]})]},i))})]})]}),c&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 space-y-2",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:c.produto_nome}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Pacote:"}),e.jsx("span",{className:"font-medium",children:c.peso_pacote_kg?`${c.peso_pacote_kg}kg`:"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"PreÃ§o:"}),e.jsxs("span",{className:"font-medium text-blue-600",children:["R$ ",(c.preco_unitario||0).toFixed(2)]})]})]})]}),e.jsx("button",{onClick:b,disabled:o||!c,className:`w-full py-3 rounded-lg font-semibold transition-colors ${o||!c?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white cursor-pointer"}`,children:o?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(pr,{size:18,className:"animate-spin"}),"Calculando..."]}):"ðŸ“Š Calcular Consumo"}),j&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 space-y-3 border border-green-200",children:[e.jsx("h3",{className:"font-bold text-green-900 text-center",children:"âœ… CÃ¡lculo Realizado"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Consumo DiÃ¡rio"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:[(j.consumo_diario_gramas||0).toFixed(0),"g"]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"DuraÃ§Ã£o"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:[(j.duracao_pacote_dias||0).toFixed(1),"d"]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/Dia"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(j.custo_diario||0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/MÃªs"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(j.custo_mensal||0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100 col-span-2",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/kg"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(j.custo_por_kg||0).toFixed(2)]})]})]})]}),N&&e.jsx("div",{className:"bg-yellow-50 rounded-lg p-3 text-sm text-yellow-700 border border-yellow-200",children:"âš ï¸ NÃ£o foi possÃ­vel calcular. Tente novamente."}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 text-xs text-gray-600 border border-gray-200 italic",children:"ðŸ’¡ Valores calculados com base em dados padrÃ£o. Para anÃ¡lises personalizadas, utilize a calculadora completa."})]}),e.jsx("div",{className:"bg-gray-50 border-t px-6 py-3 flex justify-end gap-3 flex-shrink-0",children:e.jsx("button",{onClick:l,className:"px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-medium transition-colors",children:"Fechar"})})]})}))}function ci({isOpen:s,onClose:l,clienteId:t,produtoId:m=null,onPendenciaAdicionada:r=()=>{}}){const[g,o]=a.useState("listar"),[v,j]=a.useState([]),[f,N]=a.useState([]),[d,x]=a.useState(!1),[k,w]=a.useState(""),[c,b]=a.useState([]),[p,i]=a.useState(!1),[u,n]=a.useState(null),C=a.useRef(null),[h,_]=a.useState({produto_id:m||"",quantidade_desejada:1,prioridade:"media",observacoes:""});a.useEffect(()=>{s&&t&&(E(),m||$())},[s,t]),a.useEffect(()=>{if(k.trim()==="")b(f);else{const R=f.filter(J=>{var S;return J.nome.toLowerCase().includes(k.toLowerCase())||((S=J.codigo)==null?void 0:S.toLowerCase().includes(k.toLowerCase()))});b(R)}},[k,f]),a.useEffect(()=>{const R=J=>{C.current&&!C.current.contains(J.target)&&i(!1)};return document.addEventListener("mousedown",R),()=>{document.removeEventListener("mousedown",R)}},[]);const E=async()=>{try{x(!0);const J=(await F.get(`/pendencias-estoque/cliente/${t}`)).data;j(Array.isArray(J==null?void 0:J.pendencias)?J.pendencias:[])}catch(R){console.error("Erro ao carregar pendÃªncias:",R),Se.error("Erro ao carregar lista de espera"),j([])}finally{x(!1)}},$=async()=>{var R;try{const J=await F.get("/produtos/",{params:{page:1,page_size:1e3,ativo:!0}}),S=Array.isArray((R=J.data)==null?void 0:R.items)?J.data.items:[];console.log("Produtos carregados:",S.length,S),N(S),b(S)}catch(J){console.error("Erro ao carregar produtos:",J),Se.error("Erro ao carregar produtos"),N([]),b([])}},K=R=>{n(R),w(R.nome),_({...h,produto_id:R.id}),i(!1)},te=()=>{n(null),w(""),_({...h,produto_id:""}),b(f)},M=async()=>{var J,S;if(!h.produto_id){Se.error("Selecione um produto");return}const R={baixa:0,media:1,alta:2};try{x(!0),await F.post("/pendencias-estoque/",{cliente_id:t,produto_id:parseInt(h.produto_id),quantidade_desejada:parseFloat(h.quantidade_desejada),prioridade:R[h.prioridade]||1,observacoes:h.observacoes||null}),Se.success("Cliente adicionado Ã  lista de espera!"),_({produto_id:"",quantidade_desejada:1,prioridade:"media",observacoes:""}),te(),o("listar"),E(),r()}catch(P){console.error("Erro ao adicionar pendÃªncia:",P),Se.error(((S=(J=P.response)==null?void 0:J.data)==null?void 0:S.detail)||"Erro ao adicionar Ã  lista de espera")}finally{x(!1)}},A=async R=>{if(confirm("Deseja realmente cancelar esta pendÃªncia?"))try{await F.delete(`/pendencias-estoque/${R}`),Se.success("PendÃªncia cancelada"),E()}catch(J){console.error("Erro ao cancelar pendÃªncia:",J),Se.error("Erro ao cancelar pendÃªncia")}},Q=async(R,J)=>{try{await F.put(`/pendencias-estoque/${R}`,{prioridade:parseInt(J)}),Se.success("Prioridade atualizada"),E()}catch(S){console.error("Erro ao alterar prioridade:",S),Se.error("Erro ao alterar prioridade")}};if(!s)return null;const re=R=>{switch(R){case 2:return"text-red-600 bg-red-50";case 1:return"text-yellow-600 bg-yellow-50";case 0:return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},q=R=>{switch(R){case 2:return"ALTA";case 1:return"MÃ‰DIA";case 0:return"BAIXA";default:return"N/A"}},Z=R=>{switch(R){case"pendente":return e.jsx(Ts,{className:"w-4 h-4 text-yellow-500"});case"notificado":return e.jsx(Mo,{className:"w-4 h-4 text-blue-500"});case"finalizado":return e.jsx(ha,{className:"w-4 h-4 text-green-500"});default:return e.jsx(da,{className:"w-4 h-4 text-gray-500"})}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-blue-50 to-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(da,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Lista de Espera - Produtos Sem Estoque"})]}),e.jsx("button",{onClick:l,className:"text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-200 transition-colors",children:e.jsx(ma,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{onClick:()=>o("listar"),className:`flex-1 px-4 py-3 font-medium transition-colors ${g==="listar"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:bg-gray-50"}`,children:["Lista de Espera (",v.length,")"]}),e.jsx("button",{onClick:()=>o("adicionar"),className:`flex-1 px-4 py-3 font-medium transition-colors ${g==="adicionar"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:bg-gray-50"}`,children:"Adicionar PendÃªncia"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:g==="listar"?e.jsx("div",{className:"space-y-3",children:d?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Carregando..."}):v.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(da,{className:"w-16 h-16 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Nenhuma pendÃªncia registrada"}),e.jsx("button",{onClick:()=>o("adicionar"),className:"mt-4 text-blue-600 hover:text-blue-700 font-medium",children:"Adicionar primeira pendÃªncia"})]}):v.map(R=>e.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Z(R.status),e.jsx("h3",{className:"font-semibold text-gray-900",children:R.produto_nome||"Produto nÃ£o encontrado"}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${re(R.prioridade)}`,children:q(R.prioridade)})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[R.produto_codigo&&e.jsxs("p",{children:["CÃ³digo: ",e.jsx("span",{className:"font-medium",children:R.produto_codigo})]}),e.jsxs("p",{children:["Quantidade: ",R.quantidade_desejada," un."]}),R.valor_referencia&&e.jsxs("p",{children:["Valor ref.: R$ ",parseFloat(R.valor_referencia).toFixed(2)]}),e.jsxs("p",{children:["Status: ",e.jsx("span",{className:"font-medium",children:R.status})]}),e.jsxs("p",{children:["Registrado em: ",new Date(R.data_registro).toLocaleDateString("pt-BR")]}),R.data_notificacao&&e.jsxs("p",{children:["Notificado em: ",new Date(R.data_notificacao).toLocaleDateString("pt-BR")]}),R.observacoes&&e.jsxs("p",{className:"italic",children:["Obs: ",R.observacoes]})]})]}),e.jsx("div",{className:"flex flex-col gap-2 ml-4",children:R.status==="pendente"&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:R.prioridade,onChange:J=>Q(R.id,J.target.value),className:"text-xs border rounded px-2 py-1",children:[e.jsx("option",{value:"0",children:"Baixa"}),e.jsx("option",{value:"1",children:"MÃ©dia"}),e.jsx("option",{value:"2",children:"Alta"})]}),e.jsx("button",{onClick:()=>A(R.id),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Cancelar pendÃªncia",children:e.jsx(gs,{className:"w-4 h-4"})})]})})]})},R.id))}):e.jsxs("div",{className:"space-y-4 max-w-lg mx-auto",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Produto *"}),m?e.jsx("input",{type:"text",value:"Produto selecionado",disabled:!0,className:"w-full px-3 py-2 border rounded-lg bg-gray-50"}):e.jsxs("div",{ref:C,className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(As,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",value:k,onChange:R=>w(R.target.value),onFocus:()=>i(!0),placeholder:"Digite para buscar o produto...",className:"w-full pl-10 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),k&&e.jsx("button",{type:"button",onClick:te,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(ma,{className:"w-4 h-4"})})]}),p&&c.length>0&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[c.slice(0,50).map(R=>e.jsxs("button",{type:"button",onClick:()=>K(R),className:"w-full px-4 py-3 text-left hover:bg-blue-50 border-b last:border-b-0 transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900",children:R.nome}),e.jsxs("div",{className:"text-sm text-gray-500",children:[R.codigo&&`CÃ³digo: ${R.codigo} â€¢ `,"Estoque: ",R.estoque_atual||0,R.preco_venda&&` â€¢ R$ ${parseFloat(R.preco_venda).toFixed(2)}`]})]},R.id)),c.length>50&&e.jsxs("div",{className:"px-4 py-2 text-sm text-gray-500 text-center bg-gray-50",children:["Mostrando 50 de ",c.length," produtos. Continue digitando para refinar."]})]}),p&&k&&c.length===0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg p-4",children:e.jsx("p",{className:"text-gray-500 text-center",children:"Nenhum produto encontrado"})}),u&&e.jsx("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"âœ“ Produto selecionado"}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:u.nome})]})})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantidade Desejada *"}),e.jsx("input",{type:"number",min:"1",value:h.quantidade_desejada,onChange:R=>_({...h,quantidade_desejada:parseInt(R.target.value)||1}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prioridade"}),e.jsxs("select",{value:h.prioridade,onChange:R=>_({...h,prioridade:R.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"baixa",children:"Baixa - NÃ£o tem pressa"}),e.jsx("option",{value:"media",children:"MÃ©dia - Normal"}),e.jsx("option",{value:"alta",children:"Alta - Urgente"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ObservaÃ§Ãµes"}),e.jsx("textarea",{value:h.observacoes,onChange:R=>_({...h,observacoes:R.target.value}),rows:"3",placeholder:"Ex: Cliente pediu para avisar assim que chegar...",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"ðŸ“² O cliente serÃ¡ notificado automaticamente via WhatsApp"})," quando o produto entrar no estoque."]})}),e.jsx("button",{onClick:M,disabled:d,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition-colors",children:d?"Adicionando...":"Adicionar Ã  Lista de Espera"})]})})]})})}function go(s){return s?s.variation_attributes&&typeof s.variation_attributes=="object"?Object.entries(s.variation_attributes).map(([t,m])=>`${t.charAt(0).toUpperCase()+t.slice(1)}: ${m}`).join(" | "):s.variation_signature?s.variation_signature.split("|").map(t=>{const[m,r]=t.split(":");return m&&r?`${m.charAt(0).toUpperCase()+m.slice(1)}: ${r}`:t}).join(" | "):"":""}function xi(){var Ar,Dr,Mr,Lr,qr,zr,Ir,Tr,Vr;const s=fa(),[l]=lr(),{user:t}=ct(),m=(t==null?void 0:t.is_admin)===!0,[r,g]=a.useState({cliente:null,pet:null,itens:[],subtotal:0,desconto_valor:0,desconto_percentual:0,total:0,observacoes:"",funcionario_id:null,entregador_id:null,tem_entrega:!1,entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}}),[o,v]=a.useState(""),[j,f]=a.useState(""),[N,d]=a.useState([]),[x,k]=a.useState([]),[w,c]=a.useState(!1),[b,p]=a.useState(!1),[i,u]=a.useState(!1),[n,C]=a.useState(!1),[h,_]=a.useState(!1),[E,$]=a.useState(!1),[K,te]=a.useState(0),[M,A]=a.useState(null),[Q,re]=a.useState([]),[q,Z]=a.useState("24h"),[R,J]=a.useState("todas"),[S,P]=a.useState(!1),[G,B]=a.useState(""),[y,O]=a.useState(!1),[z,ae]=a.useState(!1),[W,ne]=a.useState(""),[H,ee]=a.useState(0),[de,ue]=a.useState(!1),[Re,se]=a.useState(!1),[_e,ke]=a.useState(null),[Ze,ze]=a.useState(!1),[Xe,be]=a.useState(!1),[Ee,he]=a.useState(null),[Qe,Ye]=a.useState(!1),[ca,ra]=a.useState("valor"),[pa,na]=a.useState(0),[oe,ye]=a.useState(!1),[Ce,Be]=a.useState(null),[Ie,Y]=a.useState([]),[je,Me]=a.useState(""),[I,X]=a.useState(null),[fe,U]=a.useState([]),[ie,Ne]=a.useState(null),[Pe,L]=a.useState(0);a.useEffect(()=>{g(T=>({...T,funcionario_id:(Ce==null?void 0:Ce.id)||null}))},[Ce]),a.useEffect(()=>{console.log("ðŸ”„ Sincronizando entregador_id:",(ie==null?void 0:ie.id)||null),g(T=>({...T,entregador_id:(ie==null?void 0:ie.id)||null}))},[ie]);const[le,pe]=a.useState(!1),[Fe,Oe]=a.useState(null),[Ke,He]=a.useState(!1),[ea,oa]=a.useState({}),[ia,Ue]=a.useState(()=>{const T=localStorage.getItem("pdv_painel_vendas_aberto");return T?JSON.parse(T):!1}),[wa,V]=a.useState(()=>{const T=localStorage.getItem("pdv_painel_cliente_aberto");return T?JSON.parse(T):!1}),[$e,Te]=a.useState(!1),[We,ua]=a.useState([]),[xe,Ae]=a.useState({}),[qe,sa]=a.useState(0),[qa,ja]=a.useState(!1),[Sa,ya]=a.useState(null),Ja=a.useRef(null);a.useEffect(()=>{localStorage.setItem("pdv_painel_vendas_aberto",JSON.stringify(ia))},[ia]),a.useEffect(()=>{r.cliente&&mt()},[r.cliente]),a.useEffect(()=>{var T;r.itens&&r.itens.length>0?sessionStorage.setItem("pdv_calculadora_data",JSON.stringify({itens:r.itens,clienteId:((T=r.cliente)==null?void 0:T.id)||null})):sessionStorage.removeItem("pdv_calculadora_data")},[r.itens,r.cliente]),a.useEffect(()=>{localStorage.setItem("pdv_painel_cliente_aberto",JSON.stringify(wa))},[wa]),a.useEffect(()=>{$t();const T=setInterval(()=>{$t()},3e4);return()=>clearInterval(T)},[H]);const $t=async()=>{try{const T=await F.get("/caixas/aberto");ue(!!T.data)}catch{ue(!1)}};a.useEffect(()=>{xt()},[]);const xt=async()=>{try{const T=await F.get("/clientes/",{params:{is_entregador:!0,incluir_inativos:!1,limit:100}});let me=T.data.items||T.data.clientes||T.data||[];Array.isArray(me)||(console.error("âŒ Resposta da API nÃ£o Ã© um array:",me),me=[]),U(me);const we=me.find(ve=>ve.entregador_padrao===!0);we&&(Ne(we),g(ve=>({...ve,entregador_id:we.id})),ks(we))}catch(T){console.error("Erro ao carregar entregadores:",T),Se.error("Erro ao carregar lista de entregadores")}},ks=async T=>{if(!T){L(0);return}let me=0;if(T.modelo_custo_entrega==="taxa_fixa"&&T.taxa_fixa_entrega)me=Number(T.taxa_fixa_entrega);else if(T.modelo_custo_entrega==="por_km"&&T.valor_por_km_entrega)me=0;else if(T.modelo_custo_entrega==="rateio_rh"&&T.controla_rh)try{me=(await F.get(`/entregadores/${T.id}/custo-operacional`)).data.custo_por_entrega||0}catch(we){console.error("Erro ao buscar custo RH:",we),me=T.custo_rh_ajustado||0}else try{me=(await F.get("/configuracoes/entregas")).data.taxa_fixa||0}catch(we){console.error("Erro ao buscar configuraÃ§Ã£o de entrega:",we),me=10}L(me)};a.useEffect(()=>{r.tem_entrega&&ie?ks(ie):L(0)},[ie,r.tem_entrega]);const mt=async()=>{if(!r.cliente){te(0);return}try{const me=(await F.get(`/pendencias-estoque/cliente/${r.cliente.id}`)).data.filter(we=>we.status==="pendente"||we.status==="notificado");te(me.length)}catch{te(0)}},Pt=async T=>{if(!T||!r.cliente){ua([]);return}try{const we=(await F.get(`/internal/pdv/oportunidades/${T}`)).data;we&&Array.isArray(we.oportunidades)?ua(we.oportunidades):ua([])}catch{ua([])}},Us=async(T,me)=>{try{const we={opportunity_id:me.id,event_type:T,user_id:t==null?void 0:t.id,contexto:"PDV",extra_data:{produto_origem_id:me.produto_origem_id||null,produto_sugerido_id:me.produto_sugerido_id||null,tipo_oportunidade:me.tipo||null,venda_id:r.id||null}};F.post("/internal/pdv/eventos-oportunidade",we).catch(()=>{})}catch{}};async function Rt(T){try{const me={produto_id:T.produto_id,preco_unitario:T.preco_unitario,quantidade:T.quantidade},{data:we}=await F.post("/pdv/fiscal/calcular",me);return we}catch(me){return console.error("Erro ao calcular fiscal:",me),null}}a.useEffect(()=>{async function T(){let me=0;const we={};for(const ve of r.itens){const Le=await Rt(ve);Le&&(we[ve.produto_id]=Le,me+=Number(Le.total_impostos))}Ae(we),sa(me.toFixed(2))}r.itens&&r.itens.length>0?T():(Ae({}),sa(0))},[r.itens]),a.useEffect(()=>{hs()},[q,R,S,G]),a.useEffect(()=>{const T=l.get("venda");T&&Ss(parseInt(T))},[l]),a.useEffect(()=>{const T=sessionStorage.getItem("abrirVenda"),me=sessionStorage.getItem("abrirModalPagamento");T&&me==="true"&&(sessionStorage.removeItem("abrirVenda"),sessionStorage.removeItem("abrirModalPagamento"),Ss(parseInt(T),!0))},[]);const At=()=>{ke({tipo:"entrega",apelido:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",estado:""}),se(!0)},Ws=()=>{se(!1),ke(null)},Dt=async T=>{if(!(!T||T.length!==9)){ze(!0);try{const we=await(await fetch(`https://viacep.com.br/ws/${T.replace("-","")}/json/`)).json();if(we.erro){alert("CEP nÃ£o encontrado");return}ke(ve=>({...ve,endereco:we.logradouro||"",bairro:we.bairro||"",cidade:we.localidade||"",estado:we.uf||""}))}catch(me){console.error("Erro ao buscar CEP:",me),alert("Erro ao buscar CEP")}finally{ze(!1)}}},Mt=async()=>{if(!_e.cep||!_e.endereco||!_e.cidade){alert("Preencha pelo menos CEP, EndereÃ§o e Cidade");return}if(!r.cliente||!r.cliente.id){alert("Selecione um cliente primeiro");return}try{const T=await ht(r.cliente.id),me=T.enderecos_adicionais||[];me.push({..._e}),await F.put(`/clientes/${r.cliente.id}`,{...T,enderecos_adicionais:me});const we=await ht(r.cliente.id);g({...r,cliente:we}),alert("EndereÃ§o adicionado com sucesso!"),Ws()}catch(T){console.error("Erro ao salvar endereÃ§o:",T),alert("Erro ao salvar endereÃ§o. Tente novamente.")}},Lt=T=>{he({...T,preco:T.preco_unitario,descontoValor:T.desconto_valor||0,descontoPercentual:T.desconto_percentual||0,tipoDesconto:"valor"}),be(!0)},qt=()=>{const T=r.itens.map(me=>{if(me.produto_id===Ee.produto_id){const we=Ee.preco,ve=me.quantidade,Le=we*ve;let aa=0,ta=0;Ee.tipoDesconto==="valor"?(aa=parseFloat(Ee.descontoValor)||0,ta=Le>0?aa/Le*100:0):(ta=parseFloat(Ee.descontoPercentual)||0,aa=Le*ta/100);const ga=we-aa/ve,ka=Le-aa;return{...me,desconto_valor:aa,desconto_percentual:ta,tipo_desconto_aplicado:Ee.tipoDesconto,preco_com_desconto:ga,subtotal:ka}}return me});Ua(T),be(!1),he(null)},zt=()=>{Ye(!0)},It=(T,me)=>{var ga;const we=r.subtotal;let ve=0,Le=0;T==="valor"?(ve=parseFloat(me)||0,Le=we>0?ve/we*100:0):(Le=parseFloat(me)||0,ve=we*Le/100);const aa=r.tem_entrega&&((ga=r.entrega)==null?void 0:ga.taxa_entrega_total)||0,ta=we-ve+aa;g({...r,desconto_valor:ve,desconto_percentual:Le,total:ta}),Ye(!1)},hs=async()=>{try{const T=new Date;let me;q==="24h"?me=new Date(T.getTime()-24*60*60*1e3):q==="7d"?me=new Date(T.getTime()-7*24*60*60*1e3):me=new Date(T.getTime()-30*24*60*60*1e3);const we={data_inicio:me.toISOString().split("T")[0],data_fim:T.toISOString().split("T")[0],per_page:50};G.trim()?(we.busca=G.trim(),delete we.data_inicio,delete we.data_fim):(R==="pago"?we.status="finalizada":R==="aberta"&&(we.status="aberta"),S===!0&&(we.tem_entrega=!0)),console.log("ðŸ“Š ParÃ¢metros de busca de vendas:",we);const ve=await po(we);re(ve.vendas||[])}catch(T){console.error("Erro ao carregar vendas:",T)}},Ss=async(T,me=!1)=>{var we;try{O(!0);const ve=await Kt(T);if(!ve){alert("Venda nÃ£o encontrada");return}let Le=null;if(ve.cliente_id)try{Le=await ht(ve.cliente_id)}catch(xa){console.error("Erro ao buscar cliente:",xa)}let aa=[],ta=0;try{const xa=await F.get(`/vendas/${T}/pagamentos`);aa=xa.data.pagamentos||[],ta=xa.data.total_pago||0}catch(xa){console.error("Erro ao buscar pagamentos:",xa)}console.log("ðŸ” Venda carregada - funcionario_id:",ve.funcionario_id);let ga=null;if(ve.funcionario_id)try{const Da=((we=(await F.get("/comissoes/configuracoes/funcionarios")).data)==null?void 0:we.data)||[];console.log("ðŸ“‹ FuncionÃ¡rios disponÃ­veis:",Da),ga=Da.find(Ya=>Ya.id===ve.funcionario_id),ga?(ye(!0),Be(ga),console.log("âœ… FuncionÃ¡rio comissÃ£o carregado:",ga)):console.warn("âš ï¸ FuncionÃ¡rio ID",ve.funcionario_id,"nÃ£o encontrado na lista")}catch(xa){console.error("Erro ao carregar funcionÃ¡rio de comissÃ£o:",xa)}else console.log("â„¹ï¸ Venda sem funcionario_id - limpando estados de comissÃ£o"),ye(!1),Be(null),Me("");const ka={id:ve.id,numero_venda:ve.numero_venda,status:ve.status,data_venda:ve.data_venda,cliente:Le,pet:null,itens:ve.itens||[],subtotal:ve.subtotal||0,desconto_valor:ve.desconto_valor||0,desconto_percentual:ve.desconto_percentual||0,total:ve.total||0,observacoes:ve.observacoes||"",funcionario_id:ve.funcionario_id||null,entregador_id:ve.entregador_id||null,tem_entrega:ve.tem_entrega||!1,entrega:ve.entrega||{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""},pagamentos:aa,total_pago:ta};if(g(ka),ae(!0),ve.entregador_id){console.log("ðŸ” Venda tem entregador_id:",ve.entregador_id);try{const Da=(await F.get(`/clientes/${ve.entregador_id}`)).data;Da&&Da.is_entregador?(console.log("âœ… Entregador carregado:",Da.nome),Ne(Da),ks(Da)):console.warn("âš ï¸ Cliente ID",ve.entregador_id,"nÃ£o Ã© um entregador vÃ¡lido")}catch(xa){console.error("âŒ Erro ao carregar entregador:",xa);const Da=fe.find(Ya=>Ya.id===ve.entregador_id);Da&&(console.log("âœ… Entregador encontrado no array (fallback):",Da.nome),Ne(Da),ks(Da))}}else console.log("â„¹ï¸ Venda sem entregador_id - limpando entregadorSelecionado"),Ne(null);me&&setTimeout(()=>{c(!0)},500)}catch(ve){console.error("Erro ao carregar venda:",ve),alert("Erro ao carregar venda: "+(ve.message||"Erro desconhecido"))}finally{O(!1)}},ut=async()=>{var T;if(W.trim())try{O(!0);const me=W.replace(/\D/g,"");if(!me){alert("Digite um nÃºmero de venda vÃ¡lido"),O(!1);return}console.log("ðŸ” Buscando venda com nÃºmero:",me);const we=await po({busca:me,per_page:50});if(console.log("ðŸ“Š Vendas encontradas:",(T=we.vendas)==null?void 0:T.length),!we.vendas||we.vendas.length===0){alert(`Nenhuma venda encontrada com "${me}"`),O(!1);return}if(we.vendas.length===1){await Ss(we.vendas[0].id),ne("");return}const ve=we.vendas.slice(0,10).map((ta,ga)=>`${ga+1}. ${ta.numero_venda} - ${ta.cliente_nome||"Sem cliente"} - ${ta.status}`).join(`
`),Le=prompt(`Encontradas ${we.vendas.length} vendas. Digite o nÃºmero da opÃ§Ã£o:

${ve}`),aa=parseInt(Le)-1;aa>=0&&aa<we.vendas.length&&(await Ss(we.vendas[aa].id),ne(""))}catch(me){console.error("Erro ao buscar venda:",me),alert("Erro ao buscar venda: "+(me.message||"Erro desconhecido"))}finally{O(!1)}};a.useEffect(()=>{if(o.length>=2){const T=setTimeout(async()=>{try{const me=await Vn({search:o});d(me||[])}catch(me){console.error("Erro ao buscar clientes:",me),d([])}},300);return()=>clearTimeout(T)}else d([])},[o]),a.useEffect(()=>{if(j.length>=2){const T=setTimeout(async()=>{try{const we=(await nn({busca:j})).data.items||[];k(we)}catch(me){console.error("Erro ao buscar produtos:",me),k([])}},300);return()=>clearTimeout(T)}else k([])},[j]);const D=async T=>{g({...r,cliente:T,pet:null}),v(""),d([]);try{const me=await F.get(`/clientes/${T.id}/vendas-em-aberto`);me.data.resumo.total_vendas>0?A(me.data.resumo):A(null)}catch(me){console.error("Erro ao verificar vendas em aberto:",me),A(null)}},ge=T=>{g({...r,pet:T})},De=T=>{var ve,Le;if(!de){alert("âŒ NÃ£o Ã© possÃ­vel adicionar produtos sem caixa aberto. Abra um caixa primeiro.");return}console.log("ðŸ›’ Produto sendo adicionado:",{nome:T.nome,categoria_id:T.categoria_id,categoria_nome:T.categoria_nome,peso_embalagem:T.peso_embalagem,classificacao_racao:T.classificacao_racao});const me=r.itens.find(aa=>aa.produto_id===T.id);let we;me?we=r.itens.map(aa=>aa.produto_id===T.id?{...aa,quantidade:aa.quantidade+1,subtotal:(aa.quantidade+1)*aa.preco_unitario}:aa):we=[...r.itens,{tipo:"produto",produto_id:T.id,produto_nome:T.nome,quantidade:1,preco_unitario:parseFloat(T.preco_venda),desconto_item:0,subtotal:parseFloat(T.preco_venda),pet_id:((ve=r.pet)==null?void 0:ve.id)||null,tipo_produto:T.tipo_produto,tipo_kit:T.tipo_kit,composicao_kit:T.composicao_kit||[],categoria_id:T.categoria_id,categoria_nome:T.categoria_nome,peso_pacote_kg:T.peso_liquido||T.peso_bruto,peso_embalagem:T.peso_embalagem,classificacao_racao:T.classificacao_racao}],Ua(we),f(""),k([]),(Le=Ja.current)==null||Le.focus()},Je=(T,me)=>{const we=r.itens.map((ve,Le)=>{if(Le===T){const aa=Math.max(1,ve.quantidade+me),ta=aa*ve.preco_unitario;let ga=ve.desconto_valor||0;ve.tipo_desconto_aplicado==="percentual"&&ve.desconto_percentual>0&&(ga=ta*ve.desconto_percentual/100);const ka=ta-ga;return{...ve,quantidade:aa,desconto_valor:ga,subtotal:ka}}return ve});Ua(we)},Ve=T=>{const me=r.itens.filter((we,ve)=>ve!==T);Ua(me)},va=T=>{oa(me=>({...me,[T]:!me[T]}))},Ua=T=>{var ga;const me=T.reduce((ka,xa)=>ka+xa.subtotal,0),we=T.reduce((ka,xa)=>ka+(xa.desconto_valor||0),0),ve=me+we,Le=ve>0?we/ve*100:0,aa=r.tem_entrega&&((ga=r.entrega)==null?void 0:ga.taxa_entrega_total)||0,ta=me+aa;g({...r,itens:T,subtotal:me,desconto_valor:we,desconto_percentual:Le,total:ta})},Ca=async()=>{var T,me,we,ve,Le,aa,ta,ga,ka,xa,Da,Ya,Es,Hs,Vt,Or,Br,Ur,Wr,Kr,Hr,Gr,Qr,Xr;if(r.itens.length===0){alert("Adicione pelo menos um produto ou serviÃ§o");return}if(!de){alert("âŒ NÃ£o Ã© possÃ­vel salvar venda sem caixa aberto. Abra um caixa primeiro.");return}if(!y){O(!0);try{if(r.id){await F.put(`/vendas/${r.id}`,{cliente_id:(T=r.cliente)==null?void 0:T.id,funcionario_id:r.funcionario_id,itens:r.itens.map(Ha=>{var pt;return{tipo:Ha.tipo,produto_id:Ha.produto_id,servico_descricao:Ha.servico_descricao,quantidade:Ha.quantidade,preco_unitario:Ha.preco_unitario||Ha.preco_venda,desconto_item:0,subtotal:Ha.subtotal,lote_id:Ha.lote_id,pet_id:Ha.pet_id||((pt=r.pet)==null?void 0:pt.id)}}),desconto_valor:0,desconto_percentual:0,observacoes:r.observacoes,tem_entrega:r.tem_entrega,taxa_entrega:((me=r.entrega)==null?void 0:me.taxa_entrega_total)||0,endereco_entrega:(we=r.entrega)==null?void 0:we.endereco_completo,observacoes_entrega:(ve=r.entrega)==null?void 0:ve.observacoes_entrega,distancia_km:(Le=r.entrega)==null?void 0:Le.distancia_km,valor_por_km:(aa=r.entrega)==null?void 0:aa.valor_por_km,loja_origem:(ta=r.entrega)==null?void 0:ta.loja_origem,entregador_id:r.entregador_id}),console.log("ðŸš¨ DEBUG - Payload sendo enviado:",{tem_entrega:r.tem_entrega,entregador_id:r.entregador_id,vendaAtual_completo:r});let Wa=0;try{Wa=(await F.get(`/vendas/${r.id}/pagamentos`)).data.total_pago||0}catch(Ha){console.error("Erro ao buscar pagamentos:",Ha)}const Fs=r.total;let fs="aberta";Wa>=Fs-.01?fs="finalizada":Wa>0&&(fs="baixa_parcial"),r.status!==fs&&(await F.patch(`/vendas/${r.id}/status`,{status:fs}),console.log(`âœ… Status atualizado: ${r.status} â†’ ${fs}`)),alert("Venda atualizada com sucesso!"),es()}else{console.log("ðŸš€ CRIANDO VENDA - VersÃ£o 2.0 - DESCONTOS ZERADOS"),console.log("Desconto valor:",0),console.log("Desconto percentual:",0),console.log("âœ… Checkbox Venda Comissionada:",oe),console.log("ðŸ’¼ FuncionÃ¡rio ComissÃ£o:",Ce),console.log("ðŸ“‹ FuncionÃ¡rio ID enviado:",(Ce==null?void 0:Ce.id)||null),oe&&!Ce&&console.error("âš ï¸ ERRO: Checkbox marcado mas funcionÃ¡rio nÃ£o selecionado!");const Wa=((ga=r.entrega)==null?void 0:ga.taxa_entrega_total)||0,Fs=((ka=r.entrega)==null?void 0:ka.taxa_loja)||0,fs=((xa=r.entrega)==null?void 0:xa.taxa_entregador)||0,Ha=Wa>0?Fs/Wa*100:100,pt=Wa>0?fs/Wa*100:0,Jr={cliente_id:(Da=r.cliente)==null?void 0:Da.id,funcionario_id:r.funcionario_id,itens:r.itens.map(cs=>{var Yr;return{tipo:cs.tipo,produto_id:cs.produto_id,servico_descricao:cs.servico_descricao,quantidade:cs.quantidade,preco_unitario:cs.preco_unitario||cs.preco_venda,desconto_item:0,subtotal:cs.subtotal,lote_id:cs.lote_id,pet_id:cs.pet_id||((Yr=r.pet)==null?void 0:Yr.id)}}),desconto_valor:0,desconto_percentual:0,observacoes:r.observacoes,tem_entrega:r.tem_entrega,taxa_entrega:((Ya=r.entrega)==null?void 0:Ya.taxa_entrega_total)||0,percentual_taxa_loja:Ha,percentual_taxa_entregador:pt,endereco_entrega:(Es=r.entrega)==null?void 0:Es.endereco_completo,observacoes_entrega:(Hs=r.entrega)==null?void 0:Hs.observacoes_entrega,distancia_km:(Vt=r.entrega)==null?void 0:Vt.distancia_km,valor_por_km:(Or=r.entrega)==null?void 0:Or.valor_por_km,loja_origem:(Br=r.entrega)==null?void 0:Br.loja_origem,entregador_id:r.entregador_id};console.log("ðŸ“¦ PAYLOAD COMPLETO antes de enviar:",JSON.stringify(Jr,null,2)),console.log("ðŸšš Dados de entrega:",{tem_entrega:r.tem_entrega,entregador_id:r.entregador_id,entregadorSelecionado:ie==null?void 0:ie.id,vendaAtual_completo:r}),console.log("ðŸ’° Percentuais calculados:",{taxaTotal:Wa,taxaLoja:Fs,taxaEntregador:fs,percentualLoja:`${Ha.toFixed(2)}%`,percentualEntregador:`${pt.toFixed(2)}%`}),await Jo(Jr),alert("Venda salva com sucesso!"),es()}hs()}catch(Wa){console.error("âŒ Erro ao salvar venda:",Wa),console.error("âŒ Resposta do servidor:",(Ur=Wa.response)==null?void 0:Ur.data),console.error("âŒ Status:",(Wr=Wa.response)==null?void 0:Wr.status),console.error("âŒ Headers:",(Kr=Wa.response)==null?void 0:Kr.headers);const Fs=((Gr=(Hr=Wa.response)==null?void 0:Hr.data)==null?void 0:Gr.detail)||((Xr=(Qr=Wa.response)==null?void 0:Qr.data)==null?void 0:Xr.message)||"Erro ao salvar venda";console.error("âŒ Detalhes do erro:",Fs),alert(`Erro ao salvar venda: ${Fs}`)}finally{O(!1)}}},za=async T=>{var me;console.log("ðŸ” DEBUG formasPagamento recebidas:",T),He(!0),pe(!0);try{console.log("ðŸ’° Enviando anÃ¡lise com mÃºltiplas formas:",T);const we=await F.post("/formas-pagamento/analisar-venda",{items:r.itens.map(ve=>({produto_id:ve.produto_id,quantidade:ve.quantidade,preco_venda:ve.preco_unitario||ve.preco_venda,custo:ve.custo})),desconto:r.desconto_valor||0,taxa_entrega:((me=r.entrega)==null?void 0:me.taxa_entrega_total)||0,formas_pagamento:T,vendedor_id:r.funcionario_id});console.log("âœ… Resposta da anÃ¡lise:",we.data),Oe(we.data)}catch(we){console.error("Erro ao buscar anÃ¡lise:",we),alert("Erro ao carregar anÃ¡lise da venda"),pe(!1)}finally{He(!1)}},bs=()=>{if(r.itens.length===0){alert("Adicione pelo menos um produto ou serviÃ§o");return}if(r.status==="finalizada"||r.status==="pago_nf"){alert('Esta venda estÃ¡ finalizada. Clique em "Reabrir Venda" para modificar.');return}c(!0)},es=()=>{g({cliente:null,pet:null,itens:[],subtotal:0,desconto_valor:0,desconto_percentual:0,total:0,observacoes:"",funcionario_id:null,entregador_id:(ie==null?void 0:ie.id)||null,tem_entrega:!1,entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}}),ye(!1),Be(null),Me(""),ae(!1)},Tt=async T=>{var me,we,ve;try{const Le=await Kt(T.id);let aa=null;Le.cliente_id&&(aa=await ht(Le.cliente_id));let ta=[],ga=0;try{const xa=await F.get(`/vendas/${T.id}/pagamentos`);ta=xa.data.pagamentos||[],ga=xa.data.total_pago||0}catch(xa){console.error("Erro ao buscar pagamentos:",xa)}if(console.log("ðŸ” Venda carregada - funcionario_id:",Le.funcionario_id),Le.funcionario_id)try{const Ya=(((me=(await F.get("/comissoes/configuracoes/funcionarios")).data)==null?void 0:me.data)||[]).find(Es=>Es.id===Le.funcionario_id);Ya?(ye(!0),Be(Ya),console.log("âœ… FuncionÃ¡rio comissÃ£o carregado:",Ya)):console.warn("âš ï¸ FuncionÃ¡rio ID",Le.funcionario_id,"nÃ£o encontrado na lista")}catch(xa){console.error("Erro ao carregar funcionÃ¡rio de comissÃ£o:",xa)}else console.log("â„¹ï¸ Venda sem funcionario_id - limpando estados de comissÃ£o"),ye(!1),Be(null),Me("");const ka={id:Le.id,numero_venda:Le.numero_venda,data_venda:Le.data_venda,cliente:aa,pet:null,itens:Le.itens||[],subtotal:parseFloat(Le.subtotal||Le.total),desconto_valor:parseFloat(Le.desconto_valor||0),desconto_percentual:parseFloat(Le.desconto_percentual||0),total:parseFloat(Le.total),observacoes:Le.observacoes||"",status:Le.status,tem_entrega:Le.tem_entrega||!1,entregador_id:Le.entregador_id||null,entrega:{endereco_completo:Le.endereco_entrega||"",endereco_id:Le.endereco_id||null,taxa_entrega_total:parseFloat(parseFloat(Le.taxa_entrega||0).toFixed(2)),taxa_loja:parseFloat(parseFloat(((we=Le.entrega)==null?void 0:we.taxa_loja)||0).toFixed(2)),taxa_entregador:parseFloat(parseFloat(((ve=Le.entrega)==null?void 0:ve.taxa_entregador)||0).toFixed(2)),observacoes_entrega:Le.observacoes_entrega||"",distancia_km:Le.distancia_km||0,valor_por_km:Le.valor_por_km||0,loja_origem:Le.loja_origem||"",status_entrega:Le.status_entrega||"pendente"},pagamentos:ta,total_pago:ga};g(ka),ae(!0),window.scrollTo({top:0,behavior:"smooth"})}catch(Le){console.error("Erro ao reabrir venda:",Le),alert("Erro ao carregar os dados da venda")}},Ks=()=>{ae(!1)},al=async()=>{if(!r.id){es();return}if(I&&r.status!==I)try{O(!0),await F.patch(`/vendas/${r.id}/status`,{status:I}),console.log(`âœ… Status restaurado para: ${I} (alteraÃ§Ãµes descartadas)`)}catch(T){console.error("Erro ao restaurar status:",T)}finally{O(!1)}X(null),es()},sl=async()=>{var me,we;if(!(!r.id||!window.confirm(`Deseja realmente excluir esta venda?

Esta aÃ§Ã£o nÃ£o pode ser desfeita e o estoque serÃ¡ devolvido.`)))try{O(!0),await F.delete(`/vendas/${r.id}`),es(),hs(),alert("Venda excluÃ­da com sucesso!")}catch(ve){console.error("Erro ao excluir venda:",ve);const Le=(we=(me=ve.response)==null?void 0:me.data)==null?void 0:we.detail;if(Le&&typeof Le=="object"){let aa=`âŒ ${Le.erro||"Erro ao excluir venda"}

`;aa+=`${Le.mensagem||""}

`,Le.solucao&&(aa+=`ðŸ’¡ SoluÃ§Ã£o:
${Le.solucao}

`),Le.passos&&Array.isArray(Le.passos)&&(aa+=`ðŸ“‹ Passos para resolver:
`,Le.passos.forEach(ta=>{aa+=`${ta}
`})),Le.rota_id&&(aa+=`
ðŸšš Rota ID: ${Le.rota_id}`,Le.rota_status&&(aa+=` (${Le.rota_status})`)),alert(aa)}else alert(typeof Le=="string"?Le:"Erro ao excluir venda. Verifique se nÃ£o hÃ¡ vÃ­nculos pendentes.")}finally{O(!1)}},tl=async()=>{var me,we;if(!(!r.id||!window.confirm(`Deseja reabrir esta venda?

Os pagamentos serÃ£o mantidos e o status mudarÃ¡ para "aberta".`))){X(r.status);try{O(!0),await F.post(`/vendas/${r.id}/reabrir`);const ve=await Kt(r.id);let Le=null;ve.cliente_id&&(Le=await ht(ve.cliente_id)),g({id:ve.id,numero_venda:ve.numero_venda,data_venda:ve.data_venda,cliente:Le,pet:null,itens:ve.itens||[],subtotal:parseFloat(ve.subtotal||ve.total),desconto_valor:parseFloat(ve.desconto_valor||0),desconto_percentual:parseFloat(ve.desconto_percentual||0),total:parseFloat(ve.total),observacoes:ve.observacoes||"",status:"aberta",tem_entrega:ve.tem_entrega||!1,entrega:{endereco_completo:ve.endereco_entrega||"",endereco_id:ve.endereco_id||null,taxa_entrega_total:parseFloat(parseFloat(ve.taxa_entrega||0).toFixed(2)),taxa_loja:parseFloat(parseFloat(ve.taxa_loja||0).toFixed(2)),taxa_entregador:parseFloat(parseFloat(ve.taxa_entregador||0).toFixed(2)),observacoes_entrega:ve.observacoes_entrega||"",distancia_km:ve.distancia_km||0,valor_por_km:ve.valor_por_km||0,loja_origem:ve.loja_origem||"",status_entrega:ve.status_entrega||"pendente"}}),ae(!1),alert(`Venda reaberta com sucesso! Agora vocÃª pode editÃ¡-la.

ATENÃ‡ÃƒO: Se vocÃª nÃ£o fizer alteraÃ§Ãµes e sair, a venda voltarÃ¡ ao status anterior.`)}catch(ve){console.error("Erro ao reabrir venda:",ve),alert(((we=(me=ve.response)==null?void 0:me.data)==null?void 0:we.detail)||"Erro ao reabrir venda")}finally{O(!1)}}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"bg-white border-b px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(er,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Ponto de Venda"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Buscar venda (Ex: 0011)",value:W,onChange:T=>ne(T.target.value),onKeyPress:T=>{T.key==="Enter"&&W.trim()&&ut()},className:"pl-10 pr-4 py-2 w-64 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"}),e.jsx(As,{className:"w-5 h-5 text-gray-400 absolute left-3 top-2.5"})]}),e.jsx("button",{onClick:ut,disabled:!W.trim()||y,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Buscar"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[r.cliente&&e.jsxs("button",{onClick:()=>$(!0),className:"flex items-center space-x-2 px-4 py-2 bg-white hover:bg-orange-50 border-2 border-orange-400 rounded-lg transition-colors relative",title:"Lista de espera - Produtos sem estoque",children:[e.jsx(Mo,{className:"w-5 h-5 text-orange-500"}),K>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center",children:K})]}),r.cliente&&e.jsxs("button",{onClick:()=>{Te(!0),r.id&&Pt(r.id)},className:"flex items-center space-x-2 px-4 py-2 bg-white hover:bg-yellow-50 border-2 border-yellow-400 rounded-lg transition-colors",title:"Ver oportunidades de venda",children:[e.jsx(so,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"}),We.length>0&&e.jsx("span",{className:"font-semibold text-yellow-600",children:Math.min(We.length,6)})]}),e.jsx(ti,{onAbrirCaixa:()=>u(!0)},H),e.jsxs("button",{onClick:()=>s("/meus-caixas"),className:"flex items-center space-x-2 px-4 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-colors",title:"Ver histÃ³rico de caixas",children:[e.jsx(lt,{className:"w-5 h-5"}),e.jsx("span",{children:"Meus Caixas"})]}),!z&&r.id&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:al,disabled:y,className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ma,{className:"w-5 h-5"}),e.jsx("span",{children:"Cancelar EdiÃ§Ã£o"})]}),e.jsxs("button",{onClick:sl,disabled:y,className:"flex items-center space-x-2 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(gs,{className:"w-5 h-5"}),e.jsx("span",{children:"Excluir"})]})]}),e.jsxs("button",{onClick:Ca,disabled:y||z||!de,className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:de?"Salvar venda atual":"ðŸ”’ Caixa fechado - Abra o caixa para salvar vendas",children:[e.jsx(_t,{className:"w-5 h-5"}),e.jsx("span",{children:"Salvar"}),!de&&e.jsx("span",{className:"text-xs",children:"ðŸ”’"})]}),e.jsxs("button",{onClick:bs,disabled:y||r.status==="finalizada"||r.status==="pago_nf"||!de,className:"flex items-center space-x-2 px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:de?"Registrar pagamento da venda":"ðŸ”’ Caixa fechado - Abra o caixa para registrar recebimentos",children:[e.jsx(ot,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"}),!de&&e.jsx("span",{className:"text-xs",children:"ðŸ”’"})]})]})]})}),!de&&!z&&e.jsx("div",{className:"bg-red-50 border-b border-red-200 px-6 py-3",children:e.jsx("div",{className:"flex items-center justify-center max-w-5xl mx-auto",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-800",children:[e.jsx(da,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold text-lg",children:"ðŸ”’ CAIXA FECHADO"}),e.jsx("span",{className:"text-sm",children:"- Ã‰ necessÃ¡rio abrir o caixa para registrar vendas e recebimentos"})]})})}),r.id&&r.numero_venda&&e.jsx("div",{className:"bg-blue-50 border-b border-blue-200 px-4 py-1.5",children:e.jsxs("div",{className:"flex items-center justify-between max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-blue-800",children:"Venda:"}),e.jsxs("div",{className:"flex items-center gap-1.5 bg-white px-2 py-0.5 rounded border border-blue-300",children:[e.jsxs("span",{className:"font-bold text-blue-700 text-sm",children:["#",r.numero_venda]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(r.numero_venda);const T=event.target.closest("button"),me=T.innerHTML;T.innerHTML="âœ“",T.classList.add("text-green-600"),setTimeout(()=>{T.innerHTML=me,T.classList.remove("text-green-600")},1500)},className:"text-blue-600 hover:text-blue-800 transition-colors text-xs",title:"Copiar nÃºmero da venda",children:"ðŸ“‹"})]})]}),r.data_venda&&e.jsx("span",{className:"text-xs text-blue-600",children:(()=>{const T=r.data_venda;if(typeof T=="string"&&T.includes("T")){const[me]=T.split("T"),[we,ve,Le]=me.split("-");return`${Le}/${ve}/${we}`}return new Date(T).toLocaleDateString("pt-BR")})()})]})}),z&&e.jsx("div",{className:"bg-yellow-50 border-b border-yellow-200 px-6 py-3",children:e.jsxs("div",{className:"flex items-center justify-between max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-800",children:[e.jsx(da,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Modo VisualizaÃ§Ã£o - Venda ",r.status==="finalizada"?"Finalizada":r.status==="baixa_parcial"?"com Baixa Parcial":"Aberta"]}),e.jsx("span",{className:"text-sm",children:"(Clique em Editar para modificar)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ri,{venda:r}),e.jsxs("button",{onClick:()=>{ae(!1),es()},className:"flex items-center gap-2 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(ma,{className:"w-4 h-4"}),"Voltar"]}),(r.status==="finalizada"||r.status==="baixa_parcial")&&e.jsxs("button",{onClick:tl,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(da,{className:"w-4 h-4"}),"Reabrir Venda"]}),r.status==="aberta"&&e.jsx("button",{onClick:Ks,className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg font-medium transition-colors",children:"Editar"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"max-w-5xl mx-auto space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(ar,{className:"w-5 h-5 mr-2 text-blue-600"}),"Cliente"]}),r.cliente&&!z&&e.jsx("button",{onClick:()=>g({...r,cliente:null,pet:null}),className:"text-sm text-red-600 hover:text-red-700",children:"Remover"})]}),r.cliente?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-blue-900",children:r.cliente.nome}),e.jsxs("div",{className:"text-sm text-blue-700 mt-1",children:[r.cliente.cpf&&`CPF: ${r.cliente.cpf}`,r.cliente.telefone&&` â€¢ Tel: ${r.cliente.telefone}`]})]})}),r.cliente.credito>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"CrÃ©dito DisponÃ­vel:"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",parseFloat(r.cliente.credito||0).toFixed(2).replace(".",",")]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"ðŸ’¡ Este crÃ©dito pode ser usado como forma de pagamento"})]}),M&&M.total_vendas>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-blue-300",children:e.jsxs("div",{className:"flex items-center justify-between p-2 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ra,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-yellow-900",children:[M.total_vendas," venda(s) em aberto"]}),e.jsxs("div",{className:"text-xs text-yellow-700",children:["Total: R$ ",M.total_em_aberto.toFixed(2)]})]})]}),e.jsx("button",{onClick:()=>C(!0),className:"px-3 py-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs font-medium rounded transition-colors",children:"Ver Vendas"})]})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-300 flex gap-2",children:[e.jsxs("button",{onClick:()=>_(!0),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(vl,{className:"w-4 h-4"}),"HistÃ³rico"]}),!z&&e.jsx("button",{onClick:()=>{g({...r,cliente:null,pet:null}),A(null)},className:"px-4 py-2 text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Trocar"})]})]}),r.cliente.pets&&r.cliente.pets.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pet (opcional)"}),e.jsxs("select",{value:((Ar=r.pet)==null?void 0:Ar.id)||"",onChange:T=>{const me=r.cliente.pets.find(we=>we.id===parseInt(T.target.value));ge(me||null)},disabled:z,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Sem pet especÃ­fico"}),r.cliente.pets.map(T=>e.jsxs("option",{value:T.id,children:[T.codigo," - ",T.nome," (",T.especie,T.raca&&` - ${T.raca}`,")"]},T.id))]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:o,onChange:T=>v(T.target.value),placeholder:"Digite nome, CPF ou telefone do cliente...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:z}),e.jsx(As,{className:"w-5 h-5 text-gray-400 absolute right-3 top-1/2 -translate-y-1/2"})]}),e.jsxs("button",{onClick:()=>p(!0),disabled:z,className:"flex items-center space-x-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(rs,{className:"w-5 h-5"}),e.jsx("span",{children:"Novo"})]})]}),N.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:N.map(T=>e.jsxs("button",{onClick:()=>D(T),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:T.nome}),e.jsxs("div",{className:"text-sm text-gray-500",children:[T.cpf&&`CPF: ${T.cpf}`,T.telefone&&` â€¢ ${T.telefone}`]}),T.pets&&T.pets.length>0&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:[T.pets.length," pet(s)"]})]},T.id))})]}),o.length>=2&&N.length===0&&e.jsx("div",{className:"text-sm text-gray-500 text-center py-2",children:"Nenhum cliente encontrado"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(Za,{className:"w-5 h-5 mr-2 text-blue-600"}),"Produtos e ServiÃ§os"]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{ref:Ja,type:"text",value:j,onChange:T=>f(T.target.value),placeholder:"Digite o nome do produto, cÃ³digo de barras ou serviÃ§o...",disabled:z,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",autoFocus:!z}),e.jsx(As,{className:"w-5 h-5 text-gray-400 absolute right-3"})]}),x.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:x.map(T=>e.jsx("button",{onClick:()=>De(T),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b last:border-b-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:T.nome}),T.tipo_produto==="VARIACAO"&&go(T)&&e.jsxs("div",{className:"text-xs text-blue-600 font-medium mt-0.5",children:["ðŸ”¹ ",go(T)]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[T.codigo&&`CÃ³d: ${T.codigo}`,T.tipo_produto==="KIT"&&T.tipo_kit==="VIRTUAL"?T.estoque_virtual!==void 0&&` â€¢ Estoque: ${T.estoque_virtual}`:T.estoque_atual!==void 0&&` â€¢ Estoque: ${T.estoque_atual}`]})]}),e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:["R$ ",parseFloat(T.preco_venda).toFixed(2)]})]})},T.id))})]}),r.itens.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(Za,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhum item adicionado"}),e.jsx("p",{className:"text-sm mt-1",children:"Busque e adicione produtos ou serviÃ§os"})]}):e.jsx("div",{className:"space-y-3",children:r.itens.map((T,me)=>{var aa;const we=T.tipo_produto==="KIT",ve=ea[me],Le=we&&T.composicao_kit&&T.composicao_kit.length>0;return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200 hover:border-blue-400 space-y-3 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>!z&&Lt(T),children:[e.jsxs("div",{className:"flex-1 flex items-start gap-2",children:[Le&&e.jsx("button",{onClick:ta=>{ta.stopPropagation(),va(me)},className:"mt-1 text-gray-500 hover:text-blue-600 transition-colors",children:ve?e.jsx(Ms,{className:"w-5 h-5"}):e.jsx(et,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:T.produto_nome}),we&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-700",children:[e.jsx(Ro,{className:"w-3 h-3"}),"KIT"]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[T.quantidade," Unidade",T.quantidade!==1?"s":""," x R$ ",T.preco_unitario.toFixed(2),T.desconto_valor>0&&e.jsxs("span",{className:"text-orange-600 ml-1",children:["com R$ ",T.desconto_valor.toFixed(2)," de desconto"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",onClick:ta=>ta.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center space-x-2 bg-white border border-gray-300 rounded-lg",children:[e.jsx("button",{onClick:()=>Je(me,-1),disabled:z,className:"p-2 hover:bg-gray-100 rounded-l-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(nr,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:T.quantidade,onChange:ta=>{const ga=parseFloat(ta.target.value)||0,ka=r.itens.map((xa,Da)=>{if(Da===me){const Ya=Math.max(.001,ga),Es=Ya*xa.preco_unitario;let Hs=xa.desconto_valor||0;xa.tipo_desconto_aplicado==="percentual"&&xa.desconto_percentual>0&&(Hs=Es*xa.desconto_percentual/100);const Vt=Es-Hs;return{...xa,quantidade:Ya,desconto_valor:Hs,subtotal:Vt}}return xa});Ua(ka)},disabled:z,step:"0.001",min:"0.001",className:"w-20 px-2 py-1 text-center font-medium border-none focus:ring-0 disabled:bg-gray-50"}),e.jsx("button",{onClick:()=>Je(me,1),disabled:z,className:"p-2 hover:bg-gray-100 rounded-r-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(rs,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900 w-24 text-right",children:["R$ ",T.subtotal.toFixed(2)]}),e.jsx("button",{onClick:()=>Ve(me),disabled:z,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(gs,{className:"w-5 h-5"})})]})]}),Le&&ve&&e.jsxs("div",{className:"ml-7 mt-3 p-3 bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-600 uppercase mb-2",children:"ComposiÃ§Ã£o do KIT"}),e.jsx("div",{className:"space-y-1.5",children:T.composicao_kit.map((ta,ga)=>e.jsxs("div",{className:"flex items-center justify-between text-sm py-1.5 px-2 rounded hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Za,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:ta.produto_nome})]}),e.jsxs("span",{className:"text-gray-500 font-medium",children:[ta.quantidade,"x"]})]},ga))}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 italic",children:"Componentes apenas informativos (nÃ£o editÃ¡veis)"})]}),((aa=r.cliente)==null?void 0:aa.pets)&&r.cliente.pets.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",onClick:ta=>ta.stopPropagation(),children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 w-16",children:"Pet:"}),e.jsxs("select",{value:T.pet_id||"",onChange:ta=>{const ga=r.itens.map((ka,xa)=>xa===me?{...ka,pet_id:ta.target.value?parseInt(ta.target.value):null}:ka);g({...r,itens:ga})},disabled:z,className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"NÃ£o especificado"}),r.cliente.pets.map(ta=>e.jsxs("option",{value:ta.id,children:[ta.codigo," - ",ta.nome]},ta.id))]})]})]},me)})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ObservaÃ§Ãµes"}),e.jsx("textarea",{value:r.observacoes||"",onChange:T=>g({...r,observacoes:T.target.value}),placeholder:"ObservaÃ§Ãµes da venda (opcional)...",disabled:z,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:3})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Entrega"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.tem_entrega,onChange:T=>{var Le;const me=T.target.checked,we=me&&((Le=r.entrega)==null?void 0:Le.taxa_entrega_total)||0,ve=r.subtotal+we;g({...r,tem_entrega:me,total:ve,entrega:me?r.entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}})},disabled:z,className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Tem entrega?"})]})]}),r.tem_entrega&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"EndereÃ§o Completo *"}),r.cliente&&e.jsxs("div",{className:"mb-2 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"EndereÃ§os cadastrados:"}),e.jsxs("button",{type:"button",onClick:T=>{T.preventDefault(),T.stopPropagation(),At()},disabled:z,className:"flex items-center gap-1 px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(rs,{size:14}),"Adicionar EndereÃ§o"]})]}),e.jsxs("div",{className:"space-y-2",children:[(r.cliente.endereco||r.cliente.cidade)&&e.jsxs("button",{type:"button",onClick:T=>{T.preventDefault(),T.stopPropagation();const me=`${r.cliente.endereco}${r.cliente.numero?", "+r.cliente.numero:""}${r.cliente.complemento?" - "+r.cliente.complemento:""}, ${r.cliente.bairro}, ${r.cliente.cidade}/${r.cliente.estado}`;g({...r,entrega:{...r.entrega,endereco_completo:me}})},disabled:z,className:"w-full text-left px-3 py-2 bg-white hover:bg-blue-100 border border-blue-300 rounded text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"font-medium text-blue-700",children:"ðŸ  Cadastro Principal:"})," ",e.jsxs("span",{className:"text-gray-700",children:[r.cliente.endereco,", ",r.cliente.numero," - ",r.cliente.bairro]})]}),r.cliente.enderecos_adicionais&&r.cliente.enderecos_adicionais.map((T,me)=>e.jsxs("button",{type:"button",onClick:we=>{we.preventDefault(),we.stopPropagation();const ve=`${T.endereco}, ${T.numero}${T.complemento?" - "+T.complemento:""}, ${T.bairro}, ${T.cidade}/${T.estado}`;g({...r,entrega:{...r.entrega,endereco_completo:ve}})},disabled:z,className:"w-full text-left px-3 py-2 bg-white hover:bg-blue-100 border border-blue-300 rounded text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsxs("span",{className:`inline-block px-2 py-0.5 text-xs font-medium rounded mr-2 ${T.tipo==="entrega"?"bg-blue-100 text-blue-800":T.tipo==="cobranca"?"bg-green-100 text-green-800":T.tipo==="comercial"?"bg-purple-100 text-purple-800":T.tipo==="residencial"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:[T.tipo==="entrega"?"ðŸ“¦":T.tipo==="cobranca"?"ðŸ’°":T.tipo==="comercial"?"ðŸ¢":T.tipo==="residencial"?"ðŸ ":"ðŸ“"," ",T.apelido||T.tipo]}),e.jsxs("span",{className:"text-gray-700",children:[T.endereco,", ",T.numero," - ",T.bairro]})]},me)),!r.cliente.endereco&&(!r.cliente.enderecos_adicionais||r.cliente.enderecos_adicionais.length===0)&&e.jsx("p",{className:"text-sm text-gray-600 italic",children:'Nenhum endereÃ§o cadastrado. Clique em "+ Adicionar EndereÃ§o"'})]})]}),e.jsx("textarea",{value:((Dr=r.entrega)==null?void 0:Dr.endereco_completo)??"",onChange:T=>g({...r,entrega:{...r.entrega,endereco_completo:T.target.value}}),placeholder:"Rua, nÃºmero, complemento, bairro, cidade...",disabled:z,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Entregador"}),e.jsxs("select",{value:(ie==null?void 0:ie.id)||"",onChange:T=>{const me=fe.find(we=>we.id===parseInt(T.target.value));Ne(me),g({...r,entregador_id:(me==null?void 0:me.id)||null}),me&&ks(me)},disabled:z,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Selecione um entregador"}),fe.map(T=>e.jsxs("option",{value:T.id,children:[T.nome_fantasia||T.nome,T.entregador_padrao&&" (PadrÃ£o)"]},T.id))]}),ie&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Modelo: ",ie.modelo_custo_entrega==="taxa_fixa"?"ðŸ’µ Taxa Fixa":ie.modelo_custo_entrega==="por_km"?"ðŸš— Por KM":ie.modelo_custo_entrega==="rateio_rh"?"ðŸ‘” Rateio RH":"âš™ï¸ ConfiguraÃ§Ã£o Global"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa de Entrega Total"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((Mr=r.entrega)==null?void 0:Mr.taxa_entrega_total)??0,onChange:T=>{var ka;const me=parseFloat(T.target.value)||0,we=parseFloat(me.toFixed(2)),ve=((ka=r.entrega)==null?void 0:ka.taxa_loja)||0,Le=parseFloat((me-ve).toFixed(2)),aa={...r,entrega:{...r.entrega,taxa_entrega_total:we,taxa_loja:parseFloat(ve.toFixed(2)),taxa_entregador:Le}},ta=aa.tem_entrega?we:0,ga=parseFloat((aa.subtotal+ta).toFixed(2));g({...aa,total:ga})},disabled:z,className:"w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa Loja"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:((Lr=r.entrega)==null?void 0:Lr.taxa_entrega_total)??0,value:parseFloat((((qr=r.entrega)==null?void 0:qr.taxa_loja)??0).toFixed(2)),onChange:T=>{var aa;const me=parseFloat(T.target.value)||0,we=((aa=r.entrega)==null?void 0:aa.taxa_entrega_total)||0,ve=parseFloat(me.toFixed(2)),Le=parseFloat((we-me).toFixed(2));g({...r,entrega:{...r.entrega,taxa_loja:ve,taxa_entregador:Le}})},disabled:z,className:"w-full pl-12 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa Entregador"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:((zr=r.entrega)==null?void 0:zr.taxa_entrega_total)??0,value:parseFloat((((Ir=r.entrega)==null?void 0:Ir.taxa_entregador)??0).toFixed(2)),onChange:T=>{var aa;const me=parseFloat(T.target.value)||0,we=((aa=r.entrega)==null?void 0:aa.taxa_entrega_total)||0,ve=parseFloat(me.toFixed(2)),Le=parseFloat((we-me).toFixed(2));g({...r,entrega:{...r.entrega,taxa_entregador:ve,taxa_loja:Le}})},disabled:z,className:"w-full pl-12 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Preencha a taxa total e depois divida entre loja e entregador. Ao alterar uma, a outra Ã© calculada automaticamente."}),ie&&Pe>0&&e.jsxs("div",{className:"mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-amber-600",children:"ðŸ’¼"}),e.jsx("span",{className:"text-sm font-medium text-amber-900",children:"Custo Operacional"})]}),e.jsxs("span",{className:"text-sm font-semibold text-amber-700",children:["R$ ",Pe.toFixed(2)]})]}),e.jsxs("p",{className:"text-xs text-amber-600 mt-1 italic",children:[ie.nome_fantasia||ie.nome," -",ie.modelo_custo_entrega==="taxa_fixa"&&" Taxa Fixa",ie.modelo_custo_entrega==="por_km"&&" Valor por KM",ie.modelo_custo_entrega==="rateio_rh"&&" Rateio de RH"," ","(nÃ£o aparece no cupom)"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ObservaÃ§Ãµes da Entrega"}),e.jsx("textarea",{value:((Tr=r.entrega)==null?void 0:Tr.observacoes_entrega)??"",onChange:T=>g({...r,entrega:{...r.entrega,observacoes_entrega:T.target.value}}),placeholder:"HorÃ¡rio preferencial, ponto de referÃªncia...",disabled:z,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:2})]})]})]}),r.itens.length>0&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total bruto:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",(r.subtotal+r.desconto_valor).toFixed(2)]})]}),r.desconto_valor>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-orange-600",children:[(r.desconto_valor/(r.subtotal+r.desconto_valor)*100).toFixed(2),"% de desconto:"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium text-orange-600",children:["R$ ",r.desconto_valor.toFixed(2)]}),e.jsx("button",{onClick:zt,disabled:z,className:"p-1 text-blue-600 hover:bg-blue-50 rounded disabled:opacity-50",title:"Aplicar desconto",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",r.subtotal.toFixed(2)]})]}),r.tem_entrega&&e.jsxs("div",{className:"flex justify-between text-blue-600",children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsxs("span",{className:"font-medium",children:["+ R$ ",(((Vr=r.entrega)==null?void 0:Vr.taxa_entrega_total)||0).toFixed(2)]})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold text-gray-900",children:[e.jsx("span",{children:"Total da Venda:"}),e.jsxs("span",{children:["R$ ",r.total.toFixed(2)]})]})}),qe>0&&e.jsxs("div",{className:"flex justify-between text-sm text-blue-600 bg-blue-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium",children:"Total de Impostos:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",qe]})]}),r.total_pago>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-green-600 border-t pt-3",children:[e.jsx("span",{className:"font-medium",children:"(-) Valor Pago:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",r.total_pago.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-2xl font-bold border-t-2 pt-3",children:[e.jsx("span",{className:r.total-r.total_pago>0?"text-orange-600":"text-green-600",children:r.total-r.total_pago>0?"Saldo Restante:":"Totalmente Pago:"}),e.jsxs("span",{className:r.total-r.total_pago>0?"text-orange-600":"text-green-600",children:["R$ ",Math.max(0,r.total-r.total_pago).toFixed(2)]})]})]}),!r.total_pago&&e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"flex justify-between text-2xl font-bold text-gray-900",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["R$ ",r.total.toFixed(2)]})]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"ComissÃ£o"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:oe,onChange:T=>{ye(T.target.checked),T.target.checked||Be(null)},disabled:z,className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Venda comissionada?"})]})]}),oe&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["FuncionÃ¡rio/VeterinÃ¡rio * ",e.jsx("span",{className:"text-xs text-gray-500",children:"(apenas com comissÃ£o configurada)"})]}),Ce?e.jsxs("div",{className:"p-4 bg-green-50 border-2 border-green-300 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white font-bold",children:Ce.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-green-900",children:Ce.nome}),e.jsx("div",{className:"text-sm text-green-700 capitalize",children:Ce.cargo})]})]}),e.jsx("button",{onClick:()=>{Be(null),Me("")},disabled:z,className:"p-2 text-green-600 hover:bg-green-100 rounded-lg transition-colors disabled:cursor-not-allowed",title:"Remover seleÃ§Ã£o",children:e.jsx(ma,{size:20})})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:je,placeholder:"Buscar funcionÃ¡rio ou veterinÃ¡rio...",disabled:z,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",onFocus:async()=>{if(!z)try{const T=await F.get("/comissoes/configuracoes/funcionarios");Y(T.data.data||[])}catch(T){console.error("Erro ao buscar funcionÃ¡rios:",T)}},onChange:async T=>{const me=T.target.value;Me(me);try{const ve=(await F.get("/comissoes/configuracoes/funcionarios")).data.data||[],Le=me?ve.filter(aa=>aa.nome.toLowerCase().includes(me.toLowerCase())):ve;Y(Le)}catch(we){console.error("Erro ao buscar funcionÃ¡rios:",we)}}}),Ie.length>0&&e.jsx("div",{className:"mt-2 border border-gray-200 rounded-lg max-h-48 overflow-y-auto",children:Ie.map(T=>e.jsxs("button",{onClick:()=>{Be(T),Y([]),Me("")},className:"w-full px-4 py-2 text-left hover:bg-gray-50 border-b last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:T.nome}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:T.cargo})]},T.id))})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"â„¹ï¸ A comissÃ£o serÃ¡ calculada automaticamente conforme configurado no mÃ³dulo de comissÃµes"})]})]})]}),r.itens.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[!de&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-700",children:[e.jsx(da,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:'ðŸ”’ Caixa fechado - Use o botÃ£o "Abrir Caixa" no topo da pÃ¡gina para continuar'})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[r.itens.length>0&&!r.id&&e.jsxs("button",{onClick:()=>{window.confirm("Descartar venda atual sem salvar?")&&es()},disabled:y||z,className:"flex items-center space-x-2 px-4 py-3 bg-red-50 hover:bg-red-100 text-red-600 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed border border-red-200",title:"Descartar venda atual e comeÃ§ar uma nova",children:[e.jsx(ma,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Nova Venda"})]}),e.jsxs("button",{onClick:Ca,disabled:y||z||!de,className:"flex items-center space-x-2 px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:de?"Salvar venda atual":"ðŸ”’ Caixa fechado - Abra o caixa para salvar vendas",children:[e.jsx(_t,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Salvar Venda"}),!de&&e.jsx("span",{className:"text-xs",children:"ðŸ”’"})]}),e.jsxs("button",{onClick:bs,disabled:y||r.status==="finalizada"||r.status==="pago_nf"||!de,className:"flex items-center space-x-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors shadow-md disabled:opacity-50 disabled:cursor-not-allowed",title:de?"Registrar pagamento da venda":"ðŸ”’ Caixa fechado - Abra o caixa para registrar recebimentos",children:[e.jsx(ot,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"}),!de&&e.jsx("span",{className:"text-xs",children:"ðŸ”’"})]})]})]})]})]}),r.cliente&&wa&&e.jsx("div",{className:"w-80 bg-gray-50 border-l flex flex-col overflow-hidden",children:e.jsx(ni,{clienteId:r.cliente.id})}),r.cliente&&e.jsx("button",{onClick:()=>V(!wa),className:"fixed right-0 top-1/2 -translate-y-1/2 bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-l-lg shadow-lg transition-all z-10",style:{right:wa?"320px":"0"},title:wa?"Recolher informaÃ§Ãµes do cliente":"Expandir informaÃ§Ãµes do cliente",children:wa?e.jsx(et,{className:"w-5 h-5"}):e.jsx(ar,{className:"w-5 h-5"})}),ia&&e.jsxs("div",{className:"w-52 bg-white border-l flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 flex items-center",children:[e.jsx(Ts,{className:"w-4 h-4 mr-2 text-blue-600"}),"Vendas Recentes"]}),e.jsx("button",{onClick:()=>Ue(!1),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Fechar painel",children:e.jsx(ma,{className:"w-4 h-4 text-gray-500"})})]}),e.jsx("div",{className:"flex space-x-1 mb-3",children:["24h","7d","30d"].map(T=>e.jsxs("button",{onClick:()=>Z(T),className:`flex-1 px-2 py-1.5 rounded-lg text-xs font-medium transition-colors ${q===T?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[T==="24h"&&"Ãšltimas 24h",T==="7d"&&"7 dias",T==="30d"&&"30 dias"]},T))}),e.jsx("div",{className:"flex space-x-1 mb-2",children:[{id:"todas",label:"Todas"},{id:"pago",label:"Pago"},{id:"aberta",label:"Aberta"}].map(T=>e.jsx("button",{onClick:()=>J(T.id),className:`flex-1 px-2 py-1.5 rounded-lg text-xs font-medium transition-colors ${R===T.id?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:T.label},T.id))}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 hover:bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:T=>P(T.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Apenas com entrega"})]}),e.jsx("div",{className:"px-2 pb-2",children:e.jsx("input",{type:"text",value:G,onChange:T=>B(T.target.value),placeholder:"Buscar por nÃºmero...",className:"w-full px-3 py-2 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:Q.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(da,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-xs",children:"Nenhuma venda encontrada"})]}):Q.map(T=>e.jsxs("div",{onClick:()=>Tt(T),className:"bg-gray-50 rounded-lg p-2.5 border border-gray-200 hover:border-blue-300 cursor-pointer transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1.5",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:T.cliente_nome||"Cliente nÃ£o informado"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["#",T.numero_venda]})]}),e.jsxs("div",{className:"text-right ml-2 flex-shrink-0",children:[T.status==="baixa_parcial"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[10px] text-gray-500",children:"Pago"}),e.jsxs("div",{className:"text-xs font-semibold text-green-600",children:["R$ ",(T.valor_pago||0).toFixed(2)]}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-0.5",children:["de R$ ",(T.total||0).toFixed(2)]})]}):e.jsxs("div",{className:"text-sm font-semibold text-green-600",children:["R$ ",(T.total||0).toFixed(2)]}),e.jsxs("div",{className:`text-[10px] font-medium px-1.5 py-0.5 rounded-full mt-1 inline-block ${T.status==="pago_nf"?"bg-emerald-100 text-emerald-700":T.status==="finalizada"?"bg-green-100 text-green-700":T.status==="baixa_parcial"?"bg-blue-100 text-blue-700":T.status==="aberta"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[T.status==="pago_nf"&&"Pago NF",T.status==="finalizada"&&"Pago",T.status==="baixa_parcial"&&"Parcial",T.status==="aberta"&&"Aberta",T.status==="cancelada"&&"Cancelada"]})]})]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:(()=>{const me=T.data_venda;if(typeof me=="string"&&me.includes("T")){const[we,ve]=me.split("T"),Le=ve.split("-")[0].split("+")[0],[aa,ta,ga]=we.split("-"),[ka,xa]=Le.split(":");return`${ga}/${ta} ${ka}:${xa}`}return new Date(me).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})()})]},T.id))})]}),$e&&r.cliente&&e.jsx("div",{className:"fixed inset-0 z-40",children:e.jsxs("div",{className:"absolute top-0 right-0 w-80 h-full bg-gray-50 border-l border-gray-300 shadow-lg flex flex-col animate-in slide-in-from-right duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-300 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(so,{className:"w-4 h-4 text-gray-600"}),e.jsx("h2",{className:"text-sm font-medium text-gray-700",children:"Oportunidades"})]}),e.jsx("button",{onClick:()=>Te(!1),className:"p-1 hover:bg-gray-100 rounded transition-colors",children:e.jsx(ma,{className:"w-4 h-4 text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:[We.slice(0,5).map(T=>e.jsxs("div",{className:"p-3 bg-white border border-gray-200 rounded hover:bg-gray-50 transition-colors",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:T.titulo}),e.jsx("p",{className:"text-xs text-gray-700 mb-2 leading-relaxed",children:T.descricao_curta}),e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs mt-2",children:[e.jsxs("button",{onClick:()=>{Us("oportunidade_convertida",T),console.log("Adicionar ao carrinho:",T.id)},className:"flex items-center gap-1 text-green-500 hover:text-green-600 transition-colors whitespace-nowrap font-medium",title:"Adicionar ao carrinho",children:[e.jsx(rs,{className:"w-3 h-3"}),e.jsx("span",{children:"Adicionar"})]}),e.jsx("button",{onClick:()=>{Us("oportunidade_refinada",T),console.log("Buscar alternativa:",T.id)},className:"text-orange-600 hover:text-orange-700 transition-colors whitespace-nowrap flex-1 text-center font-medium",title:"Ver alternativa",children:"Alternativa"}),e.jsxs("button",{onClick:()=>{Us("oportunidade_rejeitada",T),ua(me=>me.filter(we=>we.id!==T.id))},className:"flex items-center gap-1 text-red-500 hover:text-red-600 transition-colors whitespace-nowrap font-medium",title:"Ignorar sugestÃ£o",children:[e.jsx("span",{children:"Ignorar"}),e.jsx(ma,{className:"w-3 h-3"})]})]})]},T.id)),We.length===0&&e.jsx("div",{className:"flex items-center justify-center py-8 text-gray-400",children:e.jsx("p",{className:"text-xs",children:"Nenhuma oportunidade disponÃ­vel"})})]}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-200 bg-white",children:e.jsx("p",{className:"text-[10px] text-gray-400 text-center",children:We.length>0?`${Math.min(We.length,6)} oportunidades`:""})})]})}),e.jsx("button",{onClick:()=>Ue(!ia),className:"fixed right-0 bottom-20 bg-blue-600 hover:bg-blue-700 text-white rounded-l-lg shadow-lg transition-all z-10 flex items-center gap-1",style:{right:ia?"208px":"0",padding:ia?"6px":"6px 8px"},title:ia?"Recolher vendas recentes":"Expandir vendas recentes",children:ia?e.jsx(et,{className:"w-4 h-4"}):e.jsxs(e.Fragment,{children:[e.jsx(yl,{className:"w-4 h-4"}),e.jsx("span",{className:"text-[10px] font-medium whitespace-nowrap",children:"Vendas"})]})}),w&&e.jsx(Un,{venda:r,onClose:()=>c(!1),onAnalisarVenda:m?za:null,onConfirmar:async()=>{if(c(!1),z&&r.id)try{const me=(await F.get(`/vendas/${r.id}`)).data;let we=[],ve=0;try{const Le=await F.get(`/vendas/${r.id}/pagamentos`);we=Le.data.pagamentos||[],ve=Le.data.total_pago||0}catch(Le){console.error("Erro ao buscar pagamentos:",Le)}g({...me,pagamentos:we,total_pago:ve}),console.log("âœ… Venda recarregada:",me)}catch(T){console.error("Erro ao recarregar venda:",T)}else es();hs(),ee(T=>T+1)},onVendaAtualizada:async()=>{if(r.id){const T=await Kt(r.id);let me=[],we=0;try{const ve=await F.get(`/vendas/${r.id}/pagamentos`);me=ve.data.pagamentos||[],we=ve.data.total_pago||0}catch(ve){console.error("Erro ao buscar pagamentos:",ve)}g({...T,pagamentos:me,total_pago:we}),ae(T.status==="finalizada"||T.status==="baixa_parcial"),hs()}}}),i&&e.jsx(Xn,{onClose:()=>u(!1),onSucesso:()=>{u(!1),ee(T=>T+1),ue(!0)}}),qa&&e.jsx(di,{isOpen:qa,itensCarrinho:r.itens,racaoIdFechada:Sa,onClose:()=>{const T=r.itens.filter(me=>{const we=(me.categoria_nome||"").toLowerCase();return we.includes("raÃ§Ã£o")||we.includes("racao")});T.length>0&&ya(T[T.length-1].produto_id),ja(!1)}}),E&&r.cliente&&e.jsx(ci,{isOpen:E,onClose:()=>$(!1),clienteId:r.cliente.id,onPendenciaAdicionada:()=>mt()}),b&&e.jsx(mi,{onClose:()=>p(!1),onClienteCriado:T=>{D(T),p(!1)}}),Re&&_e&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between z-10",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Adicionar Novo EndereÃ§o ao Cliente"}),e.jsx("button",{onClick:Ws,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ma,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de EndereÃ§o *"}),e.jsxs("select",{value:_e.tipo,onChange:T=>ke({..._e,tipo:T.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"entrega",children:"ðŸ“¦ Entrega"}),e.jsx("option",{value:"cobranca",children:"ðŸ’° CobranÃ§a"}),e.jsx("option",{value:"comercial",children:"ðŸ¢ Comercial"}),e.jsx("option",{value:"residencial",children:"ðŸ  Residencial"}),e.jsx("option",{value:"trabalho",children:"ðŸ“ Trabalho"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apelido (opcional)"}),e.jsx("input",{type:"text",value:_e.apelido,onChange:T=>ke({..._e,apelido:T.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Ex: Casa da mÃ£e, EscritÃ³rio, Loja"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:_e.cep,onChange:T=>{const me=T.target.value.replace(/\D/g,""),we=me.length>5?`${me.slice(0,5)}-${me.slice(5,8)}`:me;ke({..._e,cep:we})},onBlur:T=>Dt(T.target.value),maxLength:"9",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"00000-000"}),Ze&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EndereÃ§o *"}),e.jsx("input",{type:"text",value:_e.endereco,onChange:T=>ke({..._e,endereco:T.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Rua, Avenida, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NÃºmero"}),e.jsx("input",{type:"text",value:_e.numero,onChange:T=>ke({..._e,numero:T.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"123"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complemento"}),e.jsx("input",{type:"text",value:_e.complemento,onChange:T=>ke({..._e,complemento:T.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Apto, Bloco, Sala..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bairro"}),e.jsx("input",{type:"text",value:_e.bairro,onChange:T=>ke({..._e,bairro:T.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Centro, Jardim..."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cidade *"}),e.jsx("input",{type:"text",value:_e.cidade,onChange:T=>ke({..._e,cidade:T.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"SÃ£o Paulo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsx("input",{type:"text",value:_e.estado,onChange:T=>ke({..._e,estado:T.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",maxLength:"2",placeholder:"SP"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"* Campos obrigatÃ³rios"})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:Ws,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:Mt,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Salvar EndereÃ§o"})]})]})}),Xe&&Ee&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Alterar item da venda"}),e.jsx("button",{onClick:()=>be(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ma,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:Ee.produto_nome}),e.jsxs("p",{className:"text-sm text-gray-600",children:["CÃ³digo: ",Ee.produto_codigo]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["PreÃ§o ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:Ee.preco,onChange:T=>he({...Ee,preco:parseFloat(T.target.value)||0}),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade"}),e.jsx("input",{type:"number",step:"0.001",value:Ee.quantidade,readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subtotal"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:"R$"}),e.jsx("input",{type:"text",value:(Ee.preco*Ee.quantidade).toFixed(2),readOnly:!0,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-100"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de desconto"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>he({...Ee,tipoDesconto:"valor",descontoPercentual:0}),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${Ee.tipoDesconto==="valor"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"R$"}),e.jsx("button",{onClick:()=>he({...Ee,tipoDesconto:"percentual",descontoValor:0}),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${Ee.tipoDesconto==="percentual"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor do desconto"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:Ee.tipoDesconto==="valor"?"R$":"%"}),e.jsx("input",{type:"number",step:"0.01",value:Ee.tipoDesconto==="valor"?Ee.descontoValor:Ee.descontoPercentual,onChange:T=>{const me=parseFloat(T.target.value)||0;Ee.tipoDesconto==="valor"?he({...Ee,descontoValor:me}):he({...Ee,descontoPercentual:me})},className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Total bruto"}),e.jsxs("span",{className:"font-medium",children:["R$ ",(Ee.preco*Ee.quantidade).toFixed(2)]})]}),(Ee.descontoValor>0||Ee.descontoPercentual>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm text-red-600 mt-1",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{className:"font-medium",children:["- R$ ",Ee.tipoDesconto==="valor"?Ee.descontoValor.toFixed(2):(Ee.preco*Ee.quantidade*Ee.descontoPercentual/100).toFixed(2)]})]}),e.jsx("div",{className:"flex justify-between text-sm text-orange-600 mt-1",children:e.jsxs("span",{children:[Ee.tipoDesconto==="percentual"&&`${Ee.descontoPercentual.toFixed(2)}% de desconto`,Ee.tipoDesconto==="valor"&&`${(Ee.descontoValor/(Ee.preco*Ee.quantidade)*100).toFixed(2)}% de desconto`]})})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg mt-2 pt-2 border-t border-blue-200",children:[e.jsx("span",{children:"Total lÃ­quido"}),e.jsxs("span",{className:"text-green-600",children:["R$ ",(Ee.preco*Ee.quantidade-(Ee.tipoDesconto==="valor"?Ee.descontoValor:Ee.preco*Ee.quantidade*Ee.descontoPercentual/100)).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-between gap-3",children:[e.jsx("button",{onClick:()=>be(!1),className:"flex-1 px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Fechar"}),e.jsx("button",{onClick:()=>{r.itens.map(T=>(T.produto_id===Ee.produto_id&&Ve(r.itens.indexOf(T)),T)).filter(Boolean),be(!1)},className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Remover"}),e.jsx("button",{onClick:qt,className:"flex-1 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Salvar"})]})]})}),Qe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"ðŸ’° Aplicar desconto"}),e.jsx("button",{onClick:()=>Ye(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ma,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total bruto"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",r.subtotal.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de desconto"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ra("valor"),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${ca==="valor"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"R$"}),e.jsx("button",{onClick:()=>ra("percentual"),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${ca==="percentual"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-3 text-gray-500",children:ca==="valor"?"R$":"%"}),e.jsx("input",{type:"number",step:"0.01",value:pa,onChange:T=>na(parseFloat(T.target.value)||0),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-700",children:"Desconto"}),e.jsxs("span",{className:"text-red-600 font-medium",children:["- R$ ",ca==="valor"?pa.toFixed(2):(r.subtotal*pa/100).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-baseline border-t border-blue-200 pt-2 mt-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Total lÃ­quido"}),e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:["R$ ",(ca==="valor"?r.subtotal-pa:r.subtotal-r.subtotal*pa/100).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>Ye(!1),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Fechar"}),e.jsx("button",{onClick:()=>It(ca,pa),className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Aplicar"})]})]})}),n&&r.cliente&&e.jsx(oi,{clienteId:r.cliente.id,clienteNome:r.cliente.nome,onClose:()=>C(!1),onSucesso:()=>{F.get(`/clientes/${r.cliente.id}/vendas-em-aberto`).then(T=>{T.data.resumo.total_vendas>0?A(T.data.resumo):A(null)}).catch(()=>A(null))}}),h&&r.cliente&&e.jsx(li,{clienteId:r.cliente.id,clienteNome:r.cliente.nome,onClose:()=>_(!1)}),m&&e.jsx(ii,{mostrar:le,onFechar:()=>pe(!1),dados:Fe,carregando:Ke})]})})}function mi({onClose:s,onClienteCriado:l}){const[t,m]=a.useState({nome:"",telefone:"",cpf:"",email:""}),[r,g]=a.useState(!1),[o,v]=a.useState(""),j=async f=>{if(f.preventDefault(),!t.nome||!t.telefone){v("Nome e telefone sÃ£o obrigatÃ³rios");return}g(!0),v("");try{const N=await F.post("/clientes",{...t,tipo_cadastro:"cliente",tipo_pessoa:"PF"});l(N.data)}catch(N){console.error("Erro:",N),v("Erro ao cadastrar cliente")}finally{g(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Cadastro RÃ¡pido"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ma,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-4",children:[o&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:o}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome *"}),e.jsx("input",{type:"text",value:t.nome,onChange:f=>m({...t,nome:f.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefone *"}),e.jsx("input",{type:"tel",value:t.telefone,onChange:f=>m({...t,telefone:f.target.value}),placeholder:"(00) 00000-0000",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CPF"}),e.jsx("input",{type:"text",value:t.cpf,onChange:f=>m({...t,cpf:f.target.value}),placeholder:"000.000.000-00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail"}),e.jsx("input",{type:"email",value:t.email,onChange:f=>m({...t,email:f.target.value}),placeholder:"cliente@email.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:s,disabled:r,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:r,className:"flex items-center space-x-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Cadastrando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ha,{className:"w-5 h-5"}),e.jsx("span",{children:"Cadastrar"})]})})]})]})]})})}function ui(){const s=fa(),[l,t]=a.useState([]),[m,r]=a.useState(!0),[g,o]=a.useState({data_inicio:"",data_fim:"",status:""});a.useEffect(()=>{v()},[g]);const v=async()=>{try{r(!0);const x={};g.data_inicio&&(x.data_inicio=g.data_inicio),g.data_fim&&(x.data_fim=g.data_fim),g.status&&(x.status_filter=g.status);const k=await Hn(x);t(k)}catch(x){console.error("Erro ao carregar caixas:",x),alert("Erro ao carregar histÃƒÂ³rico de caixas")}finally{r(!1)}},j=async x=>{var k,w;if(confirm("Deseja realmente reabrir este caixa?"))try{await Qn(x),alert("Caixa reaberto com sucesso!"),s("/pdv")}catch(c){console.error("Erro ao reabrir caixa:",c),alert(((w=(k=c.response)==null?void 0:k.data)==null?void 0:w.detail)||"Erro ao reabrir caixa")}},f=async(x,k)=>{try{const w="/api",c=localStorage.getItem("access_token")||localStorage.getItem("token"),b=await fetch(`${w}/caixas/${x}/pdf`,{headers:{Authorization:`Bearer ${c}`}});if(!b.ok)throw new Error("Erro ao gerar PDF");const p=await b.blob(),i=window.URL.createObjectURL(p),u=document.createElement("a");u.href=i,u.download=`Caixa_${k}_${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(i),document.body.removeChild(u),alert("PDF baixado com sucesso!")}catch(w){console.error("Erro ao baixar PDF:",w),alert("Erro ao gerar PDF do caixa")}},N=x=>{const k={aberto:{cor:"bg-green-100 text-green-800",icone:ha,texto:"Aberto"},fechado:{cor:"bg-gray-100 text-gray-800",icone:ds,texto:"Fechado"}},w=k[x]||k.fechado,c=w.icone;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium ${w.cor}`,children:[e.jsx(c,{className:"w-4 h-4"}),w.texto]})},d=(x,k)=>{const w=k-x;return{valor:Math.abs(w),tipo:w>0?"sobra":w<0?"falta":"ok"}};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Meus Caixas"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"HistÃƒÂ³rico e gestÃƒÂ£o dos seus caixas"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data InÃƒÂ­cio"}),e.jsx("input",{type:"date",value:g.data_inicio,onChange:x=>o({...g,data_inicio:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Fim"}),e.jsx("input",{type:"date",value:g.data_fim,onChange:x=>o({...g,data_fim:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:g.status,onChange:x=>o({...g,status:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"aberto",children:"Aberto"}),e.jsx("option",{value:"fechado",children:"Fechado"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>o({data_inicio:"",data_fim:"",status:""}),className:"w-full px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:"Limpar Filtros"})})]})}),m?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando caixas..."})]}):l.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg shadow-sm",children:[e.jsx(da,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Nenhum caixa encontrado"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:l.map(x=>{const k=x.status==="fechado"&&x.valor_esperado?d(x.valor_esperado,x.valor_informado):null;return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(La,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["Caixa #",x.numero_caixa]}),e.jsx("p",{className:"text-sm text-gray-600",children:x.usuario_nome})]})]}),N(x.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Cs,{className:"w-4 h-4"}),e.jsxs("span",{children:["Abertura: ",new Date(x.data_abertura).toLocaleString("pt-BR")]})]}),x.data_fechamento&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ts,{className:"w-4 h-4"}),e.jsxs("span",{children:["Fechamento: ",new Date(x.data_fechamento).toLocaleString("pt-BR")]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Abertura"}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["R$ ",x.valor_abertura.toFixed(2)]})]}),x.status==="fechado"&&x.valor_esperado&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Esperado"}),e.jsxs("div",{className:"text-lg font-semibold text-blue-900",children:["R$ ",x.valor_esperado.toFixed(2)]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Informado"}),e.jsxs("div",{className:"text-lg font-semibold text-green-900",children:["R$ ",x.valor_informado.toFixed(2)]})]}),e.jsxs("div",{className:`rounded-lg p-3 ${k.tipo==="ok"?"bg-gray-50":k.tipo==="sobra"?"bg-green-50":"bg-red-50"}`,children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"DiferenÃƒÂ§a"}),e.jsxs("div",{className:`text-lg font-semibold ${k.tipo==="ok"?"text-gray-900":k.tipo==="sobra"?"text-green-900":"text-red-900"}`,children:[k.tipo==="sobra"&&"+",k.tipo==="falta"&&"-","R$ ",k.valor.toFixed(2)]})]})]})]}),(x.observacoes_abertura||x.observacoes_fechamento)&&e.jsxs("div",{className:"border-t pt-4 mb-4",children:[x.observacoes_abertura&&e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Obs. Abertura:"})," ",x.observacoes_abertura]}),x.observacoes_fechamento&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Obs. Fechamento:"})," ",x.observacoes_fechamento]})]}),x.status==="fechado"&&e.jsxs("div",{className:"border-t pt-4 flex gap-3",children:[e.jsxs("button",{onClick:()=>j(x.id),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(Fa,{className:"w-4 h-4"}),"Reabrir Caixa"]}),e.jsxs("button",{onClick:()=>f(x.id,x.numero_caixa),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[e.jsx(wt,{className:"w-4 h-4"}),"Baixar PDF"]})]})]})},x.id)})})]})}function pi(){var re,q,Z;const[s,l]=a.useState([]),[t,m]=a.useState(!0),[r,g]=a.useState(""),[o,v]=a.useState(""),[j,f]=a.useState(""),[N,d]=a.useState(""),[x,k]=a.useState(""),[w,c]=a.useState(null),[b,p]=a.useState(null),[i,u]=a.useState(""),[n,C]=a.useState(!1),h=[{value:"",label:"Todas"},{value:"Autorizada",label:"Autorizada"},{value:"Emitida DANFE",label:"Emitida DANFE"},{value:"Cancelada",label:"Cancelada"},{value:"Pendente",label:"Pendente"}];a.useEffect(()=>{_()},[r,o,j]);const _=async()=>{try{m(!0),k("");const R=new URLSearchParams;r&&R.append("situacao",r),o&&R.append("data_inicial",o),j&&R.append("data_final",j);const J=await F.get(`/nfe/?${R.toString()}`);l(J.data.notas||[])}catch(R){console.error("Erro ao carregar notas:",R),k("Erro ao carregar notas fiscais")}finally{m(!1)}},E=async(R,J)=>{try{const S=await F.get(`/nfe/${R}/danfe`,{responseType:"blob"}),P=window.URL.createObjectURL(new Blob([S.data])),G=document.createElement("a");G.href=P,G.setAttribute("download",`danfe_${J}.pdf`),document.body.appendChild(G),G.click(),G.remove()}catch(S){console.error("Erro ao baixar DANFE:",S),alert("Erro ao baixar DANFE")}},$=async(R,J)=>{try{const S=await F.get(`/nfe/${R}/xml`),P=new Blob([S.data.xml],{type:"application/xml"}),G=window.URL.createObjectURL(P),B=document.createElement("a");B.href=G,B.setAttribute("download",`nfe_${J}.xml`),document.body.appendChild(B),B.click(),B.remove()}catch(S){console.error("Erro ao baixar XML:",S),alert("Erro ao baixar XML")}},K=async()=>{var R,J;if(!i||i.length<15){alert("A justificativa deve ter no mÃ­nimo 15 caracteres");return}try{C(!0),await F.post(`/nfe/${b.id}/cancelar`,{justificativa:i}),alert("Nota fiscal cancelada com sucesso!"),p(null),u(""),_()}catch(S){console.error("Erro ao cancelar nota:",S),alert(((J=(R=S.response)==null?void 0:R.data)==null?void 0:J.detail)||"Erro ao cancelar nota fiscal")}finally{C(!1)}},te=async(R,J)=>{var S,P;if(confirm(`Deseja realmente excluir a nota ${J}?

Isso apenas remove os dados da nota do sistema, nÃ£o cancela no Bling/SEFAZ.`))try{await F.delete(`/nfe/${R}`),alert("Nota fiscal excluÃ­da com sucesso!"),_()}catch(G){console.error("Erro ao excluir nota:",G),alert(((P=(S=G.response)==null?void 0:S.data)==null?void 0:P.detail)||"Erro ao excluir nota fiscal")}},M=R=>{switch(R==null?void 0:R.toLowerCase()){case"autorizada":case"emitida danfe":return"bg-green-100 text-green-800";case"cancelada":return"bg-red-100 text-red-800";case"pendente":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},A=R=>{switch(R==null?void 0:R.toLowerCase()){case"autorizada":case"emitida danfe":return e.jsx(ha,{className:"w-4 h-4"});case"cancelada":return e.jsx(ma,{className:"w-4 h-4"});case"pendente":return e.jsx(da,{className:"w-4 h-4"});default:return e.jsx(Xa,{className:"w-4 h-4"})}},Q=s.filter(R=>{var S,P,G,B,y,O;if(!N)return!0;const J=N.toLowerCase();return((S=R.numero)==null?void 0:S.toLowerCase().includes(J))||((P=R.serie)==null?void 0:P.toLowerCase().includes(J))||((B=(G=R.cliente)==null?void 0:G.nome)==null?void 0:B.toLowerCase().includes(J))||((O=(y=R.cliente)==null?void 0:y.cpf_cnpj)==null?void 0:O.toLowerCase().includes(J))});return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Xa,{className:"w-8 h-8 text-blue-600"}),"Notas Fiscais de SaÃ­da"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie suas NF-e e NFC-e emitidas"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ct,{className:"w-5 h-5 text-gray-600"}),e.jsx("h2",{className:"font-semibold text-gray-800",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(As,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por nÃºmero, cliente...",value:N,onChange:R=>d(R.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("div",{children:e.jsx("input",{type:"date",value:o,onChange:R=>v(R.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),e.jsx("div",{children:e.jsx("input",{type:"date",value:j,onChange:R=>f(R.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),e.jsx("select",{value:r,onChange:R=>g(R.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:h.map(R=>e.jsx("option",{value:R.value,children:R.label},R.value))})]})]}),x&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 rounded-lg p-4 mb-6 flex items-center gap-2",children:[e.jsx(da,{className:"w-5 h-5"}),x]}),t?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Carregando notas fiscais..."})]}):Q.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(Xa,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Nenhuma nota encontrada"}),e.jsx("p",{className:"text-gray-600",children:N||r||o||j?"Tente ajustar os filtros":"Emita sua primeira nota fiscal em uma venda"})]}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"NÃºmero"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data EmissÃ£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SituaÃ§Ã£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Q.map(R=>{var J,S,P,G;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:R.numero}),e.jsxs("div",{className:"text-sm text-gray-500",children:["SÃ©rie ",R.serie]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:R.data_emissao?new Date(R.data_emissao).toLocaleDateString("pt-BR"):"-"})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((J=R.cliente)==null?void 0:J.nome)||"Cliente nÃ£o informado"}),e.jsx("div",{className:"text-sm text-gray-500",children:((S=R.cliente)==null?void 0:S.cpf_cnpj)||""})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium ${M(R.status)}`,children:[A(R.status),R.status||"Pendente"]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["R$ ",R.valor.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[(((P=R.status)==null?void 0:P.toLowerCase())==="autorizada"||((G=R.status)==null?void 0:G.toLowerCase())==="emitida danfe")&&e.jsx("button",{onClick:()=>p(R),className:"text-red-600 hover:text-red-900 p-1 hover:bg-red-50 rounded",title:"Cancelar NF-e",children:e.jsx(ds,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>te(R.venda_id,R.numero),className:"text-gray-600 hover:text-gray-900 p-1 hover:bg-gray-50 rounded",title:"Excluir nota do sistema",children:e.jsx(gs,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>E(R.id,R.numero),className:"text-blue-600 hover:text-blue-900 p-1 hover:bg-blue-50 rounded",title:"Baixar DANFE",children:e.jsx(fr,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>$(R.id,R.numero),className:"text-green-600 hover:text-green-900 p-1 hover:bg-green-50 rounded",title:"Baixar XML",children:e.jsx(wt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>c(R),className:"text-gray-600 hover:text-gray-900 p-1 hover:bg-gray-50 rounded",title:"Ver Detalhes",children:e.jsx(Nt,{className:"w-5 h-5"})})]})})]},R.id)})})]})}),!t&&Q.length>0&&e.jsxs("div",{className:"mt-4 text-sm text-gray-600 text-center",children:[Q.length," ",Q.length===1?"nota encontrada":"notas encontradas"]}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto m-4",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800",children:["Detalhes da Nota Fiscal #",w.numero]}),e.jsx("button",{onClick:()=>c(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(ma,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"NÃºmero"}),e.jsx("p",{className:"text-gray-900",children:w.numero})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"SÃ©rie"}),e.jsx("p",{className:"text-gray-900",children:w.serie})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Modelo"}),e.jsx("p",{className:"text-gray-900",children:w.modelo})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Tipo"}),e.jsx("p",{className:"text-gray-900",children:w.tipo==="nfe"?"NF-e":"NFC-e"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Chave de Acesso"}),e.jsx("p",{className:"text-gray-900 text-xs break-all",children:w.chave||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Cliente"}),e.jsx("p",{className:"text-gray-900",children:(re=w.cliente)==null?void 0:re.nome})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"CPF/CNPJ"}),e.jsx("p",{className:"text-gray-900",children:(q=w.cliente)==null?void 0:q.cpf_cnpj})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Valor Total"}),e.jsxs("p",{className:"text-gray-900 text-lg font-bold",children:["R$ ",w.valor.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"SituaÃ§Ã£o"}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium ${M(w.status)}`,children:[A(w.status),w.status]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{onClick:()=>E(w.id,w.numero),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(fr,{className:"w-5 h-5"}),"Baixar DANFE"]}),e.jsxs("button",{onClick:()=>$(w.id,w.numero),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[e.jsx(wt,{className:"w-5 h-5"}),"Baixar XML"]})]})]})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full m-4",children:[e.jsxs("div",{className:"bg-red-50 border-b px-6 py-4 flex items-center gap-3",children:[e.jsx(ds,{className:"w-6 h-6 text-red-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Cancelar Nota Fiscal"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"AtenÃ§Ã£o:"})," O cancelamento de uma nota fiscal Ã© irreversÃ­vel e serÃ¡ enviado para a SEFAZ."]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Nota:"})," #",b.numero," - SÃ©rie ",b.serie]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Cliente:"})," ",(Z=b.cliente)==null?void 0:Z.nome]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Justificativa do Cancelamento *"}),e.jsx("textarea",{value:i,onChange:R=>u(R.target.value),placeholder:"Digite o motivo do cancelamento (mÃ­nimo 15 caracteres)",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[i.length,"/15 caracteres"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{p(null),u("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",disabled:n,children:"Voltar"}),e.jsx("button",{onClick:K,disabled:n||i.length<15,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Cancelando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ds,{className:"w-5 h-5"}),"Confirmar Cancelamento"]})})]})]})]})})]})}const gi=()=>{const{clienteId:s}=Bs(),l=fa(),[t,m]=a.useState(null),[r,g]=a.useState([]),[o,v]=a.useState(!0),[j,f]=a.useState({tipo_evento:"",pet_id:""}),[N,d]=a.useState(!1);a.useEffect(()=>{x(),k()},[s]);const x=async()=>{try{const c=await F.get(`/clientes/${s}`);m(c.data)}catch(c){console.error("Erro ao carregar cliente:",c)}finally{v(!1)}},k=async()=>{try{const c=await F.get(`/pets/cliente/${s}`);g(c.data)}catch(c){console.error("Erro ao carregar pets:",c)}},w=()=>{f({tipo_evento:"",pet_id:""})};return o?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando..."})]})}):t?e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>l("/clientes"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(rt,{}),"Voltar para clientes"]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Timeline de ",t.nome]}),e.jsx("p",{className:"text-gray-600",children:"HistÃ³rico completo de eventos e interaÃ§Ãµes"})]}),e.jsxs("button",{onClick:()=>d(!N),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(kr,{}),"Filtros"]})]}),N&&e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Evento"}),e.jsxs("select",{value:j.tipo_evento,onChange:c=>f({...j,tipo_evento:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Todos os tipos"}),e.jsx("option",{value:"venda",children:"ðŸ›’ Vendas"}),e.jsx("option",{value:"conta_receber",children:"ðŸ’° Contas a Receber"}),e.jsx("option",{value:"pet_cadastro",children:"ðŸ¾ Cadastro de Pet"}),e.jsx("option",{value:"pet_atualizacao",children:"âœï¸ AtualizaÃ§Ã£o de Pet"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pet"}),e.jsxs("select",{value:j.pet_id,onChange:c=>f({...j,pet_id:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",disabled:r.length===0,children:[e.jsx("option",{value:"",children:"Todos os pets"}),r.map(c=>e.jsxs("option",{value:c.id,children:[c.nome," - ",c.especie]},c.id))]})]}),e.jsx("div",{className:"col-span-2 flex justify-end gap-2",children:e.jsxs("button",{onClick:w,className:"px-4 py-2 text-gray-600 hover:text-gray-900 flex items-center gap-2",children:[e.jsx(us,{}),"Limpar filtros"]})})]})})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsx($r,{clienteId:parseInt(s),limit:100,showHeader:!1})})]}):e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:"Cliente nÃ£o encontrado"})})};function hi(){const{id:s}=Bs(),l=fa(),[t,m]=a.useState(null),[r,g]=a.useState([]),[o,v]=a.useState(!0),[j,f]=a.useState(!1),[N,d]=a.useState([]),[x,k]=a.useState(null),[w,c]=a.useState("entrada"),[b,p]=a.useState({quantidade:"",custo_unitario:"",observacao:"",lote:"",data_validade:"",data_fabricacao:""});a.useEffect(()=>{i()},[s]);const i=async()=>{var q,Z,R;try{v(!0),console.log("Carregando produto ID:",s);const J=await F.get(`/produtos/${s}`);console.log("Produto carregado:",J.data),m(J.data);const S=await F.get(`/estoque/movimentacoes/produto/${s}`);console.log("MovimentaÃ§Ãµes carregadas:",S.data),g(S.data)}catch(J){console.error("Erro ao carregar dados:",J),console.error("Detalhes do erro:",(q=J.response)==null?void 0:q.data),Se.error(((R=(Z=J.response)==null?void 0:Z.data)==null?void 0:R.detail)||"Erro ao carregar dados do produto")}finally{v(!1)}},u=(q,Z=null)=>{var R,J;if((t==null?void 0:t.tipo_produto)==="KIT"&&(t==null?void 0:t.tipo_kit)==="VIRTUAL"&&!Z){Se.error(`âŒ KIT VIRTUAL nÃ£o permite movimentaÃ§Ã£o manual de estoque.

O estoque deste kit Ã© calculado automaticamente com base nos componentes.

Para alterar o estoque, movimente os produtos componentes individualmente.`,{duration:6e3});return}c(q),k(Z),p(Z?{quantidade:((R=Z.quantidade)==null?void 0:R.toString())||"",custo_unitario:((J=Z.custo_unitario)==null?void 0:J.toString())||"",observacao:Z.observacao||"",lote:Z.lote_id||"",data_validade:"",data_fabricacao:""}:{quantidade:"",custo_unitario:q==="entrada"&&(t==null?void 0:t.preco_custo)||"",observacao:"",lote:"",data_validade:"",data_fabricacao:"",retornar_componentes:!1}),f(!0)},n=()=>{N.length===r.length?d([]):d(r.map(q=>q.id))},C=q=>{N.includes(q)?d(N.filter(Z=>Z!==q)):d([...N,q])},h=async()=>{var q,Z;if(N.length===0){Se.error("Selecione pelo menos um lanÃ§amento");return}if(confirm(`Deseja realmente excluir ${N.length} lanÃ§amento(s)?`))try{const J=(await Promise.all(N.map(S=>F.delete(`/estoque/movimentacoes/${S}`)))).flatMap(S=>S.data.componentes_estornados||[]);J.length>0?Se.success(`${N.length} lanÃ§amento(s) excluÃ­do(s)!
âœ… ${J.length} componente(s) estornado(s)`,{duration:5e3}):Se.success(`${N.length} lanÃ§amento(s) excluÃ­do(s)`),d([]),i()}catch(R){console.error("Erro ao excluir:",R),Se.error(((Z=(q=R.response)==null?void 0:q.data)==null?void 0:Z.detail)||"Erro ao excluir lanÃ§amentos")}},_=async q=>{var Z,R,J;q.preventDefault();try{if(x){const B={quantidade:parseFloat(b.quantidade),custo_unitario:b.custo_unitario?parseFloat(b.custo_unitario):null,observacao:b.observacao||null};await F.patch(`/estoque/movimentacoes/${x.id}`,B),Se.success("LanÃ§amento atualizado com sucesso!"),f(!1),k(null),i();return}let S="/estoque/",P={produto_id:parseInt(s),quantidade:parseFloat(b.quantidade),custo_unitario:b.custo_unitario?parseFloat(b.custo_unitario):null,observacao:b.observacao||null};if(w==="entrada")S+="entrada",P.tipo="entrada",P.motivo="compra",P.numero_lote=b.lote||null,P.data_validade=b.data_validade||null,P.data_fabricacao=b.data_fabricacao||null;else if(w==="saida")S+="saida",P.tipo="saida",P.motivo="saida_manual",P.numero_lote=b.lote||null,P.data_validade=b.data_validade||null,(t==null?void 0:t.tipo_produto)==="KIT"&&(t==null?void 0:t.tipo_kit)==="FISICO"&&(P.retornar_componentes=b.retornar_componentes===!0);else if(w==="balanco"){const B=parseFloat(b.quantidade),y=(t==null?void 0:t.estoque_atual)||0,O=B-y;S+=O>=0?"entrada":"saida",P.tipo=O>=0?"entrada":"saida",P.quantidade=Math.abs(O),P.motivo="balanco"}const G=await F.post(S,P);if(console.log("Response da entrada:",G.data),w==="entrada"&&G.data){const{custo_anterior:B,custo_unitario:y,variacao_preco:O}=G.data;if(O&&B!==null&&B!==void 0){let z="LanÃ§amento registrado!";O==="aumento"?(z+=` â¬†ï¸ Custo aumentou de R$ ${B==null?void 0:B.toFixed(2)} para R$ ${y==null?void 0:y.toFixed(2)}`,Se.error(z,{duration:5e3})):O==="reducao"?(z+=` â¬‡ï¸ Custo reduziu de R$ ${B==null?void 0:B.toFixed(2)} para R$ ${y==null?void 0:y.toFixed(2)}`,Se.success(z,{duration:5e3})):O==="estavel"&&(z+=` Custo mantido em R$ ${y==null?void 0:y.toFixed(2)}`,Se(z,{icon:"âž–",duration:3e3}))}else y?Se.success(`LanÃ§amento registrado! Custo: R$ ${y==null?void 0:y.toFixed(2)}`,{duration:3e3}):Se.success("LanÃ§amento registrado com sucesso!")}else if((Z=G.data)!=null&&Z.componentes_sensibilizados&&G.data.componentes_sensibilizados.length>0){const B=G.data.componentes_sensibilizados.length;Se.success(`LanÃ§amento registrado com sucesso!
âœ… ${B} componente(s) sensibilizado(s)`,{duration:4e3})}else Se.success("LanÃ§amento registrado com sucesso!");f(!1),i()}catch(S){console.error("Erro ao registrar lanÃ§amento:",S),Se.error(((J=(R=S.response)==null?void 0:R.data)==null?void 0:J.detail)||"Erro ao registrar lanÃ§amento")}},E=q=>{if(!q)return"-";const Z=new Date(q);return new Date(Z.getTime()-3*60*60*1e3).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"America/Sao_Paulo"})},$=q=>({compra:"Compra",venda:"Venda",venda_online:"Venda Online",ajuste:"Ajuste",saida_manual:"SaÃ­da Manual",devolucao:"DevoluÃ§Ã£o",perda:"Perda",transferencia:"TransferÃªncia",balanco:"BalanÃ§o"})[q]||q,K=q=>q.referencia_tipo==="venda"?q.documento&&(q.documento.length===44||q.documento.startsWith("NF"))?{texto:`NF ${q.documento}`,icone:"nf-venda",cor:"text-red-600",link:null}:{texto:`Pedido #${q.referencia_id}`,icone:"pedido",cor:"text-orange-600",link:`/pdv?vendaId=${q.referencia_id}`}:q.motivo==="balanco"?{texto:"BalanÃ§o",icone:"balanco",cor:"text-blue-600",link:null}:q.tipo==="saida"?{texto:"SaÃ­da Manual",icone:"manual",cor:"text-red-600",link:null}:q.tipo==="entrada"&&q.documento&&q.documento.length===44?{texto:`NF ${q.documento.substring(25,34)}`,icone:"nf-entrada",cor:"text-green-600",link:null}:q.tipo==="entrada"&&q.documento?{texto:q.documento,icone:"documento",cor:"text-blue-600",link:`/pdv?vendaId=${q.documento}`}:q.tipo==="entrada"?{texto:"Entrada Manual",icone:"manual",cor:"text-green-600",link:null}:{texto:"Manual",icone:"manual",cor:"text-gray-500",link:null},te=r.filter(q=>q.tipo==="entrada").reduce((q,Z)=>q+parseFloat(Z.quantidade||0),0),M=r.filter(q=>q.tipo==="saida").reduce((q,Z)=>q+parseFloat(Z.quantidade||0),0);if(o)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-gray-500",children:"Carregando..."})});if(!t)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-red-500",children:"Produto nÃ£o encontrado"})});const A=t.estoque_atual||0,Q=t.estoque_minimo||0,re=A>Q?"text-green-600":A===0?"text-red-600":"text-yellow-600";return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[(t==null?void 0:t.tipo_produto)==="KIT"&&(t==null?void 0:t.tipo_kit)==="VIRTUAL"&&e.jsx("div",{className:"mb-6 bg-indigo-50 border border-indigo-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-indigo-600 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-indigo-900 mb-1",children:"ðŸ§© KIT VIRTUAL - Estoque Calculado Automaticamente"}),e.jsxs("p",{className:"text-sm text-indigo-800",children:["Este Ã© um produto do tipo ",e.jsx("strong",{children:"KIT VIRTUAL"}),". O estoque Ã© calculado automaticamente com base nos componentes que o compÃµem.",e.jsx("br",{}),e.jsx("strong",{children:"NÃ£o Ã© possÃ­vel movimentar o estoque do kit diretamente."})," Para alterar o estoque, movimente os produtos componentes individualmente."]})]})]})}),(t==null?void 0:t.tipo_produto)==="KIT"&&(t==null?void 0:t.tipo_kit)==="FISICO"&&e.jsx("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-green-600 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-1",children:"ðŸ“¦ KIT FÃSICO - Estoque PrÃ³prio com SensibilizaÃ§Ã£o"}),e.jsxs("p",{className:"text-sm text-green-800",children:["Este Ã© um produto do tipo ",e.jsx("strong",{children:"KIT FÃSICO"}),". Possui estoque prÃ³prio e independente.",e.jsx("br",{}),e.jsx("strong",{children:"Importante:"})," Ao movimentar o estoque do kit, os estoques dos componentes tambÃ©m serÃ£o automaticamente sensibilizados na mesma proporÃ§Ã£o."]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${A>Q?"bg-green-100":A===0?"bg-red-100":"bg-yellow-100"}`,children:e.jsx("svg",{className:`w-6 h-6 ${re}`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>l("/produtos"),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.nome})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{children:["CÃ³digo: ",e.jsx("span",{className:"font-mono",children:t.codigo||t.sku})]}),t.codigo_barras&&e.jsxs("div",{children:["EAN: ",e.jsx("span",{className:"font-mono",children:t.codigo_barras})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-green-600 font-medium mb-1",children:"Total Entradas"}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:te.toFixed(2)})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-red-600 font-medium mb-1",children:"Total SaÃ­das"}),e.jsx("div",{className:"text-2xl font-bold text-red-700",children:M.toFixed(2)})]}),e.jsxs("div",{className:`rounded-lg p-3 ${A>Q?"bg-blue-50":A===0?"bg-red-50":"bg-yellow-50"}`,children:[e.jsx("div",{className:`text-xs font-medium mb-1 ${A>Q?"text-blue-600":A===0?"text-red-600":"text-yellow-600"}`,children:"Saldo Atual"}),e.jsxs("div",{className:`text-2xl font-bold ${A>Q?"text-blue-700":A===0?"text-red-700":"text-yellow-700"}`,children:[A.toFixed(2)," ",t.unidade||"UN"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 font-medium mb-1",children:"Estoque MÃ­n/MÃ¡x"}),e.jsxs("div",{className:"text-lg font-bold text-gray-700",children:[Q.toFixed(0)," / ",(t.estoque_maximo||0).toFixed(0)]})]})]}),e.jsx("div",{className:"relative group",children:e.jsxs("button",{onClick:()=>{(t==null?void 0:t.tipo_produto)==="KIT"&&(t==null?void 0:t.tipo_kit)==="VIRTUAL"?Se.error(`KIT VIRTUAL nÃ£o permite movimentaÃ§Ã£o manual.

Movimente os componentes individualmente.`,{duration:4e3}):f(!0)},disabled:(t==null?void 0:t.tipo_produto)==="KIT"&&(t==null?void 0:t.tipo_kit)==="VIRTUAL",className:`px-6 py-2 rounded-lg transition-colors flex items-center gap-2 ${(t==null?void 0:t.tipo_produto)==="KIT"&&(t==null?void 0:t.tipo_kit)==="VIRTUAL"?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Incluir lanÃ§amento"]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"LanÃ§amentos"}),N.length>0&&e.jsxs("button",{onClick:h,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Excluir (",N.length,")"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 w-12",children:e.jsx("input",{type:"checkbox",checked:N.length===r.length&&r.length>0,onChange:n,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data e Hora"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Entrada"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SaÃ­da"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PreÃ§o Venda"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PreÃ§o Compra"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Lote"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Origem"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ObservaÃ§Ã£o"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"px-6 py-8 text-center text-gray-500",children:"Nenhuma movimentaÃ§Ã£o registrada"})}):r.map((q,Z)=>{const R=K(q),J=Z>0?r[Z-1]:null,S=J&&q.referencia_tipo==="venda"&&J.referencia_tipo==="venda"&&q.referencia_id===J.referencia_id;return e.jsxs("tr",{className:`hover:bg-gray-50 cursor-pointer ${S?"border-l-4 border-l-blue-500 bg-blue-50":""}`,onClick:()=>u(q.tipo,q),children:[e.jsx("td",{className:"px-4 py-3 w-12",onClick:P=>P.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:N.includes(q.id),onChange:()=>C(q.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:E(q.created_at)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-center",children:q.tipo==="entrada"?e.jsx("span",{className:"text-green-600 font-semibold",children:parseFloat(q.quantidade).toFixed(2)}):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-center",children:q.tipo==="saida"?e.jsx("span",{className:"text-red-600 font-semibold",children:parseFloat(q.quantidade).toFixed(2)}):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-right text-gray-900",children:t.preco_venda?`R$ ${t.preco_venda.toFixed(2)}`:"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-right",children:q.custo_unitario?q.variacao_custo?e.jsxs("div",{className:"relative group inline-block",title:`Custo anterior: R$ ${q.variacao_custo.custo_anterior.toFixed(2)}
Custo atual: R$ ${q.variacao_custo.custo_atual.toFixed(2)}
DiferenÃ§a: R$ ${q.variacao_custo.diferenca_valor.toFixed(2)} (${q.variacao_custo.diferenca_percentual>0?"+":""}${q.variacao_custo.diferenca_percentual.toFixed(1)}%)`,children:[e.jsxs("span",{className:`font-semibold ${q.variacao_custo.tipo==="aumento"?"text-red-600":q.variacao_custo.tipo==="reducao"?"text-green-600":"text-gray-900"}`,children:["R$ ",q.custo_unitario.toFixed(2)]}),e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block z-50",children:e.jsxs("div",{className:"bg-gray-900 text-white text-xs rounded-lg py-2 px-3 whitespace-nowrap shadow-lg",children:[e.jsx("div",{className:"font-semibold mb-1",children:"VariaÃ§Ã£o de Custo"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Anterior: R$ ",q.variacao_custo.custo_anterior.toFixed(2)]}),e.jsxs("div",{children:["Atual: R$ ",q.variacao_custo.custo_atual.toFixed(2)]}),e.jsxs("div",{className:q.variacao_custo.tipo==="aumento"?"text-red-400":"text-green-400",children:[q.variacao_custo.tipo==="aumento"?"â–²":"â–¼"," R$ ",Math.abs(q.variacao_custo.diferenca_valor).toFixed(2)," (",q.variacao_custo.diferenca_percentual>0?"+":"",q.variacao_custo.diferenca_percentual.toFixed(1),"%)"]})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2",children:e.jsx("div",{className:"border-4 border-transparent border-t-gray-900"})})]})})]}):e.jsxs("span",{className:"text-gray-900",children:["R$ ",q.custo_unitario.toFixed(2)]}):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-600",children:q.lote_info?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:q.lote_info.nome}),q.lote_info.consumido_acumulado!==void 0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",q.lote_info.consumido_acumulado.toFixed(0),"/",q.lote_info.total_lote.toFixed(0),")"]})]}):q.lote_nome?q.lote_nome:"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",onClick:P=>P.stopPropagation(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[S&&e.jsx("span",{className:"text-blue-600",title:"Mesmo pedido/venda",children:"â†ª"}),R.link?e.jsx("a",{href:R.link,onClick:P=>{P.preventDefault(),P.stopPropagation(),l(R.link)},className:`${R.cor} font-medium hover:underline cursor-pointer`,children:R.texto}):e.jsx("span",{className:`${R.cor} font-medium`,children:R.texto})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jsxs("div",{className:"flex items-center gap-2",children:[q.motivo&&q.motivo!=="compra"&&q.motivo!=="venda"&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs",children:$(q.motivo)}),q.observacao]})})]},q.id)})})]})})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:x?"Editar LanÃ§amento":"Novo LanÃ§amento"}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:_,className:"p-6 space-y-4",children:[!x&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo *"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>c("entrada"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${w==="entrada"?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Entrada"}),e.jsx("button",{type:"button",onClick:()=>c("saida"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${w==="saida"?"bg-red-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"SaÃ­da"}),e.jsx("button",{type:"button",onClick:()=>c("balanco"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${w==="balanco"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"BalanÃ§o"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:w==="balanco"?"Saldo Total *":"Quantidade *"}),e.jsx("input",{type:"number",step:"0.01",value:b.quantidade,onChange:q=>p({...b,quantidade:q.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0}),w==="balanco"&&e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Estoque atual: ",A,". Digite o novo saldo total."]})]}),w==="entrada"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PreÃ§o de Compra"}),e.jsx("input",{type:"number",step:"0.01",value:b.custo_unitario,onChange:q=>p({...b,custo_unitario:q.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["NÃºmero do Lote ",e.jsx("span",{className:"text-gray-400",children:"(opcional)"})]}),e.jsx("input",{type:"text",value:b.lote,onChange:q=>p({...b,lote:q.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: LOTE-001"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Data de Validade ",e.jsx("span",{className:"text-gray-400",children:"(opcional)"})]}),e.jsx("input",{type:"date",value:b.data_validade,onChange:q=>p({...b,data_validade:q.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Data de FabricaÃ§Ã£o ",e.jsx("span",{className:"text-gray-400",children:"(opcional)"})]}),e.jsx("input",{type:"date",value:b.data_fabricacao,onChange:q=>p({...b,data_fabricacao:q.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),w==="saida"&&e.jsxs(e.Fragment,{children:[(t==null?void 0:t.tipo_produto)==="KIT"&&(t==null?void 0:t.tipo_kit)==="FISICO"&&e.jsx("div",{className:"p-4 bg-yellow-50 border-2 border-yellow-300 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",id:"retornar_componentes",checked:b.retornar_componentes===!0,onChange:q=>p({...b,retornar_componentes:q.target.checked}),className:"mt-1 h-5 w-5 text-green-600 focus:ring-green-500 border-gray-300 rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"retornar_componentes",className:"block text-sm font-semibold text-gray-900 cursor-pointer",children:"ðŸ”„ Desmontar kit e retornar componentes ao estoque"}),e.jsxs("p",{className:"text-xs text-gray-700 mt-1",children:[e.jsx("strong",{children:"Marque esta opÃ§Ã£o"})," se vocÃª desmontou o kit e quer devolver os produtos unitÃ¡rios ao estoque."]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[e.jsx("strong",{children:"Deixe desmarcado"})," se houve perda, roubo ou venda do kit montado."]})]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["NÃºmero do Lote ",e.jsx("span",{className:"text-gray-400",children:"(opcional)"})]}),e.jsx("input",{type:"text",value:b.lote,onChange:q=>p({...b,lote:q.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: LOTE-001"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Deixe vazio para usar FIFO automÃ¡tico"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Data de Validade ",e.jsx("span",{className:"text-gray-400",children:"(opcional)"})]}),e.jsx("input",{type:"date",value:b.data_validade,onChange:q=>p({...b,data_validade:q.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ObservaÃ§Ã£o"}),e.jsx("textarea",{value:b.observacao,onChange:q=>p({...b,observacao:q.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"ObservaÃ§Ãµes sobre este lanÃ§amento..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Incluir"})]})]})]})})]})}const bi=()=>{const[s,l]=a.useState([]),[t,m]=a.useState([]),[r,g]=a.useState(!1),[o,v]=a.useState(!1),[j,f]=a.useState("todos"),[N,d]=a.useState("");a.useEffect(()=>{x()},[]);const x=async()=>{g(!0);try{const n=await F.get("/produtos/");l(n.data.items||[])}catch(n){console.error("Erro ao carregar produtos:",n),ce.error("Erro ao carregar produtos"),l([])}finally{g(!1)}},k=async()=>{var n,C;g(!0);try{const h=N?{descricao:N}:{},_=await F.get("/bling-sync/produtos",{params:h});m(_.data||[]),ce.success(`âœ… ${(_.data||[]).length} produtos encontrados no Bling`)}catch(h){console.error("Erro ao buscar no Bling:",h),ce.error(((C=(n=h.response)==null?void 0:n.data)==null?void 0:C.detail)||"Erro ao buscar produtos no Bling"),m([])}finally{g(!1)}},w=async(n,C)=>{var h,_;try{await F.post("/bling-sync/vincular",{produto_id:n,bling_id:C}),ce.success("âœ… Produto vinculado ao Bling com sucesso!"),x()}catch(E){ce.error(((_=(h=E.response)==null?void 0:h.data)==null?void 0:_.detail)||"Erro ao vincular produto")}},c=async n=>{var C,h;v(!0);try{const _=await F.post(`/bling-sync/sincronizar-estoque/${n}`,{});ce.success(`âœ… Estoque sincronizado!
Sistema: ${_.data.estoque_local} â†’ Bling: ${_.data.estoque_bling}`,{duration:4e3}),x()}catch(_){ce.error(((h=(C=_.response)==null?void 0:C.data)==null?void 0:h.detail)||"Erro ao sincronizar estoque")}finally{v(!1)}},b=async()=>{v(!0);const n=s.filter(_=>_.bling_id);if(n.length===0){ce.error("Nenhum produto vinculado ao Bling"),v(!1);return}let C=0,h=0;for(const _ of n)try{await F.post(`/bling-sync/sincronizar-estoque/${_.id}`,{}),C++}catch(E){h++,console.error(`Erro ao sincronizar produto ${_.id}:`,E)}ce.success(`âœ… SincronizaÃ§Ã£o concluÃ­da!
${C} produtos atualizados${h>0?`, ${h} erros`:""}`,{duration:5e3}),carregarDados(),v(!1)},p=async()=>{var n,C;g(!0);try{const h=await F.post("/bling-sync/reconciliar",{});ce.success(`âœ… ReconciliaÃ§Ã£o concluÃ­da!
${h.data.total_processados} produtos processados
${h.data.diferencas_encontradas} diferenÃ§as encontradas`,{duration:5e3}),x()}catch(h){ce.error(((C=(n=h.response)==null?void 0:n.data)==null?void 0:C.detail)||"Erro ao reconciliar estoques")}finally{g(!1)}},i=s.filter(n=>j==="sincronizados"?n.bling_id:j==="nao_sincronizados"?!n.bling_id:!0),u={total:s.length,sincronizados:s.filter(n=>n.bling_id).length,naoSincronizados:s.filter(n=>!n.bling_id).length};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"ðŸ”„ SincronizaÃ§Ã£o Bling"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie a integraÃ§Ã£o dos produtos com o Bling ERP"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u.total}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Produtos"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.sincronizados}),e.jsx("div",{className:"text-sm text-gray-600",children:"Vinculados ao Bling"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:u.naoSincronizados}),e.jsx("div",{className:"text-sm text-gray-600",children:"NÃ£o Vinculados"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[u.total>0?(u.sincronizados/u.total*100).toFixed(1):0,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Taxa de SincronizaÃ§Ã£o"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"âš¡ AÃ§Ãµes RÃ¡pidas"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:b,disabled:o||u.sincronizados===0,className:"flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:o?"â³ Sincronizando...":`ðŸ”„ Sincronizar Todos (${u.sincronizados})`}),e.jsx("button",{onClick:p,disabled:r||u.sincronizados===0,className:"flex-1 bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:r?"â³ Reconciliando...":"ðŸ” Reconciliar Estoques"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-3",children:[e.jsx("strong",{children:"Sincronizar:"})," Atualiza o estoque do Bling com os valores do sistema.",e.jsx("strong",{className:"ml-4",children:"Reconciliar:"})," Compara e identifica diferenÃ§as entre os estoques."]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"ðŸ” Buscar Produtos no Bling"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:N,onChange:n=>d(n.target.value),placeholder:"Digite o nome do produto (deixe vazio para buscar todos)",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",onKeyPress:n=>n.key==="Enter"&&k()}),e.jsx("button",{onClick:k,disabled:r,className:"bg-green-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-green-700 disabled:bg-gray-400",children:r?"â³ Buscando...":"ðŸ” Buscar"})]}),t.length>0&&e.jsxs("div",{className:"mt-4 border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-2 font-semibold border-b",children:[t.length," produtos encontrados no Bling"]}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:t.map(n=>e.jsxs("div",{className:"px-4 py-3 border-b hover:bg-gray-50 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:n.descricao}),e.jsxs("div",{className:"text-sm text-gray-600",children:["ID Bling: ",n.id," | CÃ³digo: ",n.codigo," | Estoque: ",n.estoque]})]}),e.jsxs("select",{onChange:C=>C.target.value&&w(parseInt(C.target.value),n.id),className:"px-3 py-2 border border-gray-300 rounded text-sm",children:[e.jsx("option",{value:"",children:"Vincular ao produto..."}),s.filter(C=>!C.bling_id).map(C=>e.jsxs("option",{value:C.id,children:[C.codigo," - ",C.nome]},C.id))]})]},n.id))})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>f("todos"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${j==="todos"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Todos (",u.total,")"]}),e.jsxs("button",{onClick:()=>f("sincronizados"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${j==="sincronizados"?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["âœ… Sincronizados (",u.sincronizados,")"]}),e.jsxs("button",{onClick:()=>f("nao_sincronizados"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${j==="nao_sincronizados"?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["âš ï¸ NÃ£o Sincronizados (",u.naoSincronizados,")"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"CÃ³digo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Estoque Local"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"ID Bling"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{children:r&&i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:"â³ Carregando produtos..."})}):i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:"Nenhum produto encontrado com os filtros selecionados"})}):i.map(n=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-mono text-sm",children:n.codigo})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold",children:n.nome}),n.categoria&&e.jsx("div",{className:"text-xs text-gray-500",children:n.categoria})]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`font-semibold ${(n.estoque_atual||0)<=(n.estoque_minimo||0)?"text-red-600":"text-green-600"}`,children:n.estoque_atual||0})}),e.jsx("td",{className:"px-4 py-3 text-center",children:n.bling_id?e.jsx("span",{className:"inline-block bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-semibold",children:n.bling_id}):e.jsx("span",{className:"text-gray-400 text-sm",children:"â€”"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:n.bling_id?e.jsx("span",{className:"inline-block bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-semibold",children:"âœ… VINCULADO"}):e.jsx("span",{className:"inline-block bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs font-semibold",children:"âš ï¸ NÃƒO VINCULADO"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:n.bling_id?e.jsx("button",{onClick:()=>c(n.id),disabled:o,className:"text-blue-600 hover:text-blue-800 font-semibold text-sm disabled:text-gray-400",title:"Sincronizar estoque com Bling",children:"ðŸ”„ Sync"}):e.jsx("span",{className:"text-gray-400 text-sm",children:"â€”"})})]},n.id))})]})})]})},fi=()=>{const[s,l]=a.useState([]),[t,m]=a.useState([]),[r,g]=a.useState([]),[o,v]=a.useState(!1),[j,f]=a.useState(!1),[N,d]=a.useState(!1),[x,k]=a.useState(null),[w,c]=a.useState(null),[b,p]=a.useState(!1),[i,u]=a.useState(!1),[n,C]=a.useState(null),[h,_]=a.useState({email:"",whatsapp:"",formatos:{pdf:!0,excel:!1}}),[E,$]=a.useState(!1),[K,te]=a.useState([]),[M,A]=a.useState(!1),[Q,re]=a.useState(90),[q,Z]=a.useState(30),[R,J]=a.useState(!1),[S,P]=a.useState(!0),[G,B]=a.useState([]),[y,O]=a.useState({}),[z,ae]=a.useState({fornecedor_id:"",data_prevista_entrega:"",valor_frete:"0",valor_desconto:"0",observacoes:"",itens:[]}),[W,ne]=a.useState({produto_id:"",quantidade_pedida:"",preco_unitario:""}),[H,ee]=a.useState(""),[de,ue]=a.useState("");a.useEffect(()=>{Re()},[]);const Re=async()=>{try{const[U,ie]=await Promise.all([F.get("/pedidos-compra/"),F.get("/clientes/?tipo_cadastro=fornecedor&apenas_ativos=true")]),Ne=Array.isArray(U.data)?U.data:U.data.items||U.data.pedidos||[],Pe=Array.isArray(ie.data)?ie.data:ie.data.items||ie.data.clientes||[];l(Ne),m(Pe)}catch(U){console.error("Erro ao carregar dados:",U),ce.error("Erro ao carregar dados")}},se=async U=>{if(!U){g([]);return}try{const ie=await F.get(`/produtos/?fornecedor_id=${U}`);let Ne;Array.isArray(ie.data)?Ne=ie.data:ie.data.items?Ne=ie.data.items:ie.data.produtos?Ne=ie.data.produtos:Ne=[],Ne.length===0&&ce.warning("âš ï¸ Este fornecedor nÃ£o possui produtos vinculados. Edite os produtos para vincular ao fornecedor."),g(Ne)}catch(ie){console.error("Erro ao carregar produtos:",ie),ce.error("Erro ao carregar produtos do fornecedor")}},_e=U=>{const ie=r.find(Ne=>Ne.id===parseInt(U));ie&&(ue(ie.nome),ie.preco_custo?ne({...W,produto_id:U,preco_unitario:ie.preco_custo.toFixed(2)}):ne({...W,produto_id:U}))},ke=()=>{if(!W.produto_id||!W.quantidade_pedida||!W.preco_unitario){ce.error("Preencha todos os campos do item");return}const U=r.find(le=>le.id===parseInt(W.produto_id)),ie=parseFloat(W.quantidade_pedida),Ne=parseFloat(W.preco_unitario),Pe=parseInt(W.produto_id),L=z.itens.findIndex(le=>le.produto_id===Pe);if(L!==-1){const le=z.itens[L];if(window.confirm(`âš ï¸ O produto "${U.nome}" jÃ¡ estÃ¡ no pedido!

Quantidade atual: ${le.quantidade_pedida}
PreÃ§o atual: R$ ${le.preco_unitario.toFixed(2)}

Nova quantidade: ${ie}
Novo preÃ§o: R$ ${Ne.toFixed(2)}

Deseja SOMAR a quantidade ao item existente?

âœ… OK = Somar quantidade (${le.quantidade_pedida} + ${ie} = ${le.quantidade_pedida+ie})
âŒ CANCELAR = NÃ£o adicionar`)){const Fe=[...z.itens];Fe[L]={...le,quantidade_pedida:le.quantidade_pedida+ie,preco_unitario:Ne,total:(le.quantidade_pedida+ie)*Ne},ae({...z,itens:Fe}),ce.success(`âœ… Quantidade somada! Total: ${le.quantidade_pedida+ie}`)}else ce.info("AdiÃ§Ã£o cancelada");ue(""),ne({produto_id:"",quantidade_pedida:"",preco_unitario:""});return}ae({...z,itens:[...z.itens,{produto_id:Pe,produto_nome:U.nome,quantidade_pedida:ie,preco_unitario:Ne,desconto_item:0,total:ie*Ne}]}),ue(""),ne({produto_id:"",quantidade_pedida:"",preco_unitario:""})},Ze=U=>{ae({...z,itens:z.itens.filter((ie,Ne)=>Ne!==U)})},ze=()=>{const U=z.itens.reduce((Pe,L)=>Pe+L.total,0),ie=parseFloat(z.valor_frete||0),Ne=parseFloat(z.valor_desconto||0);return U+ie-Ne},Xe=async()=>{if(!z.fornecedor_id){ce.error("Selecione um fornecedor primeiro");return}A(!0);try{const U=await F.get(`/pedidos-compra/sugestao/${z.fornecedor_id}`,{params:{periodo_dias:Q,dias_cobertura:q,apenas_criticos:R,incluir_alerta:S}});te(U.data.sugestoes||[]),B([]),O({}),U.data.sugestoes.length===0?ce.info("Nenhuma sugestÃ£o encontrada com os filtros aplicados"):ce.success(`${U.data.sugestoes.length} produtos analisados`)}catch(U){console.error("Erro ao buscar sugestÃµes:",U),ce.error("Erro ao gerar sugestÃµes")}finally{A(!1)}},be=U=>{B(ie=>ie.includes(U)?ie.filter(Ne=>Ne!==U):[...ie,U])},Ee=(U,ie)=>{O(Ne=>({...Ne,[U]:parseFloat(ie)||0}))},he=U=>y[U.produto_id]!==void 0?y[U.produto_id]:U.quantidade_sugerida,Qe=()=>{$(!1),B([]),O({})},Ye=()=>{const U=K.filter(ie=>ie.prioridade==="CRÃTICO"&&ie.quantidade_sugerida>0).map(ie=>ie.produto_id);B(U)},ca=()=>{if(G.length===0){ce.error("Selecione pelo menos um produto");return}const ie=K.filter(Ne=>G.includes(Ne.produto_id)).map(Ne=>{const Pe=he(Ne);return{produto_id:Ne.produto_id,produto_nome:Ne.produto_nome,quantidade_pedida:Math.ceil(Pe),preco_unitario:Ne.preco_unitario,desconto_item:0,total:Math.ceil(Pe)*Ne.preco_unitario}});ae({...z,itens:[...z.itens,...ie]}),ce.success(`${ie.length} produtos adicionados ao pedido`),Qe()},ra=async U=>{var ie,Ne;if(U.preventDefault(),z.itens.length===0){ce.error("Adicione pelo menos 1 item ao pedido");return}v(!0);try{const Pe={...z,data_prevista_entrega:z.data_prevista_entrega?`${z.data_prevista_entrega}T12:00:00`:null};await F.post("/pedidos-compra/",Pe),ce.success("âœ… Pedido criado com sucesso!"),f(!1),ae({fornecedor_id:"",data_prevista_entrega:"",valor_frete:"0",valor_desconto:"0",observacoes:"",itens:[]}),Re()}catch(Pe){ce.error(((Ne=(ie=Pe.response)==null?void 0:ie.data)==null?void 0:Ne.detail)||"Erro ao criar pedido")}finally{v(!1)}},pa=async U=>{C(U),_({email:"",whatsapp:"",formatos:{pdf:!0,excel:!1}}),u(!0)},na=async()=>{var U,ie;if(!h.email&&!h.whatsapp){ce.error("Informe um e-mail ou WhatsApp");return}if(!h.formatos.pdf&&!h.formatos.excel){ce.error("Selecione pelo menos um formato (PDF ou Excel)");return}try{await F.post(`/pedidos-compra/${n}/enviar`,{email:h.email,whatsapp:h.whatsapp,formatos:h.formatos}),ce.success("âœ… Pedido marcado como enviado!"),u(!1),Re()}catch(Ne){ce.error(((ie=(U=Ne.response)==null?void 0:U.data)==null?void 0:ie.detail)||"Erro ao enviar pedido")}},oe=async()=>{var U,ie;try{await F.post(`/pedidos-compra/${n}/enviar`,{envio_manual:!0}),ce.success("âœ… Pedido marcado como enviado manualmente!"),u(!1),Re()}catch(Ne){ce.error(((ie=(U=Ne.response)==null?void 0:U.data)==null?void 0:ie.detail)||"Erro ao marcar pedido")}},ye=async U=>{var ie,Ne;try{await F.post(`/pedidos-compra/${U}/confirmar`,{}),ce.success("âœ… Pedido confirmado!"),Re()}catch(Pe){ce.error(((Ne=(ie=Pe.response)==null?void 0:ie.data)==null?void 0:Ne.detail)||"Erro ao confirmar pedido")}},Ce=async U=>{try{const ie=await F.get(`/pedidos-compra/${U}/export/pdf`,{responseType:"blob"}),Ne=window.URL.createObjectURL(new Blob([ie.data])),Pe=document.createElement("a");Pe.href=Ne,Pe.setAttribute("download",`pedido_${U}.pdf`),document.body.appendChild(Pe),Pe.click(),Pe.remove(),ce.success("ðŸ“„ PDF exportado com sucesso!")}catch{ce.error("Erro ao exportar PDF")}},Be=async U=>{try{const ie=await F.get(`/pedidos-compra/${U}/export/excel`,{responseType:"blob"}),Ne=window.URL.createObjectURL(new Blob([ie.data])),Pe=document.createElement("a");Pe.href=Ne,Pe.setAttribute("download",`pedido_${U}.xlsx`),document.body.appendChild(Pe),Pe.click(),Pe.remove(),ce.success("ðŸ“Š Excel exportado com sucesso!")}catch{ce.error("Erro ao exportar Excel")}},Ie=async U=>{try{const ie=await F.get(`/pedidos-compra/${U.id}`);c(ie.data),p(!0)}catch{ce.error("Erro ao carregar detalhes do pedido")}},Y=async U=>{var ie,Ne;if(confirm("âš ï¸ Deseja reverter o status deste pedido para a etapa anterior?"))try{const Pe=await F.post(`/pedidos-compra/${U}/reverter`,{});ce.success(`âª Status revertido: ${Pe.data.status_anterior} â†’ ${Pe.data.status_atual}`),Re()}catch(Pe){ce.error(((Ne=(ie=Pe.response)==null?void 0:ie.data)==null?void 0:Ne.detail)||"Erro ao reverter status")}},je=async U=>{var ie,Ne,Pe;if(U.status!=="rascunho"){ce.error("âš ï¸ Apenas pedidos em rascunho podem ser editados");return}try{const le=(await F.get(`/pedidos-compra/${U.id}`)).data;d(!0),k(le),ae({fornecedor_id:((ie=le.fornecedor_id)==null?void 0:ie.toString())||"",data_prevista_entrega:le.data_prevista_entrega?new Date(le.data_prevista_entrega).toISOString().split("T")[0]:"",valor_frete:((Ne=le.valor_frete)==null?void 0:Ne.toString())||"0",valor_desconto:((Pe=le.valor_desconto)==null?void 0:Pe.toString())||"0",observacoes:le.observacoes||"",itens:le.itens.map(pe=>({produto_id:pe.produto_id,produto_nome:pe.produto_nome||`Produto ${pe.produto_id}`,quantidade_pedida:pe.quantidade_pedida,preco_unitario:pe.preco_unitario,desconto_item:pe.desconto_item||0,total:pe.quantidade_pedida*pe.preco_unitario-(pe.desconto_item||0)}))}),le.fornecedor_id&&se(le.fornecedor_id),f(!0),ce.success("ðŸ“ Modo de ediÃ§Ã£o ativado")}catch{ce.error("Erro ao carregar pedido para ediÃ§Ã£o")}},Me=async U=>{var ie,Ne;if(U.preventDefault(),z.itens.length===0){ce.error("âš ï¸ Adicione pelo menos um item ao pedido");return}try{v(!0);const Pe={...z,fornecedor_id:parseInt(z.fornecedor_id),valor_frete:parseFloat(z.valor_frete),valor_desconto:parseFloat(z.valor_desconto),data_prevista_entrega:z.data_prevista_entrega?`${z.data_prevista_entrega}T12:00:00`:null,itens:z.itens.map(L=>({produto_id:L.produto_id,quantidade_pedida:parseFloat(L.quantidade_pedida),preco_unitario:parseFloat(L.preco_unitario),desconto_item:parseFloat(L.desconto_item||0)}))};await F.put(`/pedidos-compra/${x.id}`,Pe),ce.success("âœï¸ Pedido atualizado com sucesso!"),f(!1),d(!1),k(null),ae({fornecedor_id:"",data_prevista_entrega:"",valor_frete:"0",valor_desconto:"0",observacoes:"",itens:[]}),Re()}catch(Pe){ce.error(((Ne=(ie=Pe.response)==null?void 0:ie.data)==null?void 0:Ne.detail)||"Erro ao atualizar pedido")}finally{v(!1)}},I=async U=>{try{const ie=await F.get(`/pedidos-compra/${U.id}`);c(ie.data),p(!0)}catch{ce.error("Erro ao carregar detalhes do pedido")}},X=async U=>{var ie,Ne;try{await F.post(`/pedidos-compra/${w.id}/receber`,{itens:U}),ce.success("âœ… Recebimento processado com sucesso!"),p(!1),c(null),Re()}catch(Pe){ce.error(((Ne=(ie=Pe.response)==null?void 0:ie.data)==null?void 0:Ne.detail)||"Erro ao processar recebimento")}},fe=U=>{const ie={rascunho:"bg-gray-200 text-gray-800",enviado:"bg-blue-200 text-blue-800",confirmado:"bg-green-200 text-green-800",recebido_parcial:"bg-yellow-200 text-yellow-800",recebido_total:"bg-green-500 text-white",cancelado:"bg-red-200 text-red-800"};return e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${ie[U]||"bg-gray-200"}`,children:U.replace("_"," ").toUpperCase()})};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"ðŸ›’ Pedidos de Compra"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie seus pedidos aos fornecedores"})]}),e.jsx("button",{onClick:()=>f(!j),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors",children:j?"âŒ Cancelar":"âž• Novo Pedido"})]}),j&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:N?"âœï¸ Editar Pedido":"Novo Pedido de Compra"}),e.jsx("button",{type:"button",onClick:()=>{f(!1),d(!1),k(null)},className:"text-gray-500 hover:text-gray-700",children:"âœ–ï¸"})]}),e.jsxs("form",{onSubmit:N?Me:ra,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fornecedor *"}),e.jsx("input",{list:"fornecedores-list",value:H,onChange:U=>{const ie=U.target.value;ee(ie);const Ne=t.find(Pe=>Pe.nome===ie);Ne?(ae({...z,fornecedor_id:Ne.id.toString(),itens:[]}),ne({produto_id:"",quantidade_pedida:"",preco_unitario:""}),se(Ne.id)):(ae({...z,fornecedor_id:"",itens:[]}),g([]))},placeholder:"Digite ou selecione o fornecedor",required:!!z.fornecedor_id,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsx("datalist",{id:"fornecedores-list",children:t.map(U=>e.jsx("option",{value:U.nome,children:U.cpf_cnpj?`- ${U.cpf_cnpj}`:""},U.id))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Digite ou selecione um fornecedor para carregar seus produtos"}),z.fornecedor_id&&e.jsx("button",{type:"button",onClick:()=>{$(!0),Xe()},className:"mt-2 w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition-all flex items-center justify-center gap-2",children:"ðŸ’¡ SugestÃ£o Inteligente de Pedido"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Prevista Entrega"}),e.jsx("input",{type:"date",value:z.data_prevista_entrega,onChange:U=>ae({...z,data_prevista_entrega:U.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Itens do Pedido"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-4",children:[e.jsx("input",{list:"produtos-list",value:de,onChange:U=>{const ie=U.target.value;ue(ie);const Ne=r.find(Pe=>Pe.nome===ie);Ne?_e(Ne.id.toString()):ne({...W,produto_id:""})},placeholder:z.fornecedor_id?"Digite ou selecione o produto":"Selecione um fornecedor primeiro",disabled:!z.fornecedor_id,className:"col-span-2 px-4 py-2 border border-gray-300 rounded-lg disabled:bg-gray-100 focus:ring-2 focus:ring-blue-500"}),e.jsx("datalist",{id:"produtos-list",children:r.map(U=>e.jsx("option",{value:U.nome,children:`SKU: ${U.sku||U.codigo||"N/A"} | Barras: ${U.codigo_barras||"N/A"} | Estoque: ${U.estoque_atual||0}`},U.id))}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantidade",value:W.quantidade_pedida,onChange:U=>ne({...W,quantidade_pedida:U.target.value}),className:"px-4 py-2 border border-gray-300 rounded-lg"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"PreÃ§o",value:W.preco_unitario,onChange:U=>ne({...W,preco_unitario:U.target.value}),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg"}),e.jsx("button",{type:"button",onClick:ke,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:"âž•"})]})]}),z.itens.length>0&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-sm font-semibold",children:"Produto"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold",children:"PreÃ§o"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold",children:"Total"}),e.jsx("th",{className:"px-4 py-2"})]})}),e.jsx("tbody",{children:z.itens.map((U,ie)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:U.produto_nome}),e.jsx("td",{className:"px-4 py-2 text-right",children:U.quantidade_pedida}),e.jsxs("td",{className:"px-4 py-2 text-right",children:["R$ ",U.preco_unitario.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-2 text-right font-semibold",children:["R$ ",U.total.toFixed(2)]}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx("button",{type:"button",onClick:()=>Ze(ie),className:"text-red-600 hover:text-red-800",children:"ðŸ—‘ï¸"})})]},ie))})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Frete (R$)"}),e.jsx("input",{type:"number",step:"0.01",value:z.valor_frete,onChange:U=>ae({...z,valor_frete:U.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Desconto (R$)"}),e.jsx("input",{type:"number",step:"0.01",value:z.valor_desconto,onChange:U=>ae({...z,valor_desconto:U.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Total"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["R$ ",ze().toFixed(2)]})]})]}),e.jsx("button",{type:"submit",disabled:o,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-400",children:o?"â³ Processando...":N?"âœï¸ Salvar AlteraÃ§Ãµes":"âœ… Criar Pedido"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"NÃºmero"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Fornecedor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{children:s.map(U=>e.jsxs("tr",{className:`border-t hover:bg-gray-50 ${U.status==="rascunho"?"cursor-pointer":""}`,onClick:()=>U.status==="rascunho"&&je(U),title:U.status==="rascunho"?"Clique para editar":"",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[U.numero_pedido,U.foi_alterado_apos_envio&&e.jsx("span",{className:"px-2 py-1 text-xs bg-orange-100 text-orange-700 rounded font-semibold",title:"Este pedido foi alterado apÃ³s o envio",children:"âš ï¸ Alterado"})]})}),e.jsx("td",{className:"px-4 py-3",children:U.fornecedor_id}),e.jsx("td",{className:"px-4 py-3",children:new Date(U.data_pedido).toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold",children:["R$ ",U.valor_final.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-center",children:fe(U.status)}),e.jsx("td",{className:"px-4 py-3 text-center",onClick:ie=>ie.stopPropagation(),children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>Ie(U),className:"px-2 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 text-xs font-semibold",title:"Ver detalhes completos do pedido",children:"ðŸ” Ver"}),e.jsx("button",{onClick:()=>Ce(U.id),className:"px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 text-xs font-semibold",title:"Exportar PDF",children:"ðŸ“„ PDF"}),e.jsx("button",{onClick:()=>Be(U.id),className:"px-2 py-1 bg-green-100 text-green-700 rounded hover:bg-green-200 text-xs font-semibold",title:"Exportar Excel",children:"ðŸ“Š Excel"}),U.status==="rascunho"&&e.jsx("button",{onClick:()=>pa(U.id),className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs font-semibold",title:"Enviar pedido ao fornecedor",children:"ðŸ“¤ Enviar"}),U.status==="enviado"&&e.jsx("button",{onClick:()=>ye(U.id),className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-xs font-semibold",title:"Confirmar recebimento do pedido pelo fornecedor",children:"âœ… Confirmar"}),(U.status==="confirmado"||U.status==="recebido_parcial")&&e.jsx("button",{onClick:()=>I(U),className:"px-3 py-1 bg-purple-600 text-white rounded hover:bg-purple-700 text-xs font-semibold",title:"Registrar entrada de produtos no estoque",children:"ðŸ“¦ Receber"}),U.status!=="rascunho"&&U.status!=="recebido_total"&&e.jsx("button",{onClick:()=>Y(U.id),className:"px-2 py-1 bg-orange-100 text-orange-700 rounded hover:bg-orange-200 text-xs font-semibold",title:"Reverter para status anterior",children:"âª Reverter"})]})})]},U.id))})]})}),b&&w&&e.jsx(ji,{pedido:w,onClose:()=>{p(!1),c(null)},onReceber:X}),i&&e.jsx(vi,{pedidoId:n,onClose:()=>u(!1),onEnviar:na,onEnvioManual:oe,dadosEnvio:h,setDadosEnvio:_}),E&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-7xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"ðŸ’¡ SugestÃ£o Inteligente de Pedido"}),e.jsx("p",{className:"text-purple-100",children:"AnÃ¡lise baseada em vendas e estoque atual"})]}),e.jsx("button",{onClick:Qe,className:"text-white hover:bg-white hover:bg-opacity-20 rounded-lg p-2",children:"âœ–ï¸"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-purple-100 mb-1",children:"PerÃ­odo de AnÃ¡lise"}),e.jsxs("select",{value:Q,onChange:U=>re(parseInt(U.target.value)),className:"w-full px-3 py-2 rounded-lg text-gray-800 focus:ring-2 focus:ring-purple-300",children:[e.jsx("option",{value:30,children:"Ãšltimos 30 dias"}),e.jsx("option",{value:60,children:"Ãšltimos 60 dias"}),e.jsx("option",{value:90,children:"Ãšltimos 90 dias"}),e.jsx("option",{value:180,children:"Ãšltimos 180 dias"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-purple-100 mb-1",children:"Cobertura de Estoque"}),e.jsxs("select",{value:q,onChange:U=>Z(parseInt(U.target.value)),className:"w-full px-3 py-2 rounded-lg text-gray-800 focus:ring-2 focus:ring-purple-300",children:[e.jsx("option",{value:15,children:"15 dias"}),e.jsx("option",{value:30,children:"30 dias"}),e.jsx("option",{value:45,children:"45 dias"}),e.jsx("option",{value:60,children:"60 dias"}),e.jsx("option",{value:90,children:"90 dias"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2 text-white cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:U=>J(U.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{children:"Apenas CrÃ­ticos"})]})}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2 text-white cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:U=>P(U.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{children:"Incluir Alertas"})]})}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:Xe,disabled:M,className:"w-full bg-white text-purple-600 px-4 py-2 rounded-lg font-semibold hover:bg-purple-50 disabled:opacity-50",children:M?"ðŸ”„ Analisando...":"ðŸ” Atualizar"})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:M?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Analisando produtos e calculando sugestÃµes..."})]})}):K.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhuma sugestÃ£o encontrada com os filtros aplicados"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Tente ajustar os filtros acima"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex gap-3",children:[e.jsx("button",{onClick:Ye,className:"bg-red-100 text-red-700 px-4 py-2 rounded-lg font-semibold hover:bg-red-200",children:"ðŸ”´ Selecionar Todos CrÃ­ticos"}),e.jsx("div",{className:"flex-1"}),e.jsxs("span",{className:"text-gray-600",children:[G.length," de ",K.length," produtos selecionados"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:e.jsx("input",{type:"checkbox",onChange:U=>{U.target.checked?B(K.map(ie=>ie.produto_id)):B([])},checked:G.length===K.length,className:"w-4 h-4 rounded"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Prioridade"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Consumo/dia"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Dias Restantes"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Qtd Sugerida"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"PreÃ§o Unit."}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"TendÃªncia"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:K.map(U=>e.jsxs("tr",{className:`hover:bg-gray-50 ${G.includes(U.produto_id)?"bg-purple-50":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:G.includes(U.produto_id),onChange:()=>be(U.produto_id),className:"w-4 h-4 rounded"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${U.prioridade==="CRÃTICO"?"bg-red-100 text-red-700":U.prioridade==="ALERTA"?"bg-yellow-100 text-yellow-700":U.prioridade==="ATENÃ‡ÃƒO"?"bg-orange-100 text-orange-700":"bg-green-100 text-green-700"}`,children:U.prioridade})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:U.produto_nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:["SKU: ",U.produto_sku||"N/A"," | Barras: ",U.produto_codigo_barras||"N/A"]}),U.observacao&&e.jsx("div",{className:"text-xs text-gray-600 mt-1 italic",children:U.observacao})]})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("div",{className:"font-medium",children:U.estoque_atual}),e.jsxs("div",{className:"text-xs text-gray-500",children:["MÃ­n: ",U.estoque_minimo]})]}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:U.consumo_diario.toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:`font-semibold ${U.dias_estoque&&U.dias_estoque<7?"text-red-600":U.dias_estoque&&U.dias_estoque<14?"text-yellow-600":"text-green-600"}`,children:U.dias_estoque?`${U.dias_estoque} dias`:"âˆž"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"number",min:"0",step:"1",value:Math.ceil(he(U)),onChange:ie=>Ee(U.produto_id,ie.target.value),className:"w-20 px-2 py-1 text-right font-bold text-purple-600 border rounded focus:ring-2 focus:ring-purple-300"})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["R$ ",U.preco_unitario.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold",children:["R$ ",(he(U)*U.preco_unitario).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`text-xs ${U.tendencia==="CRESCIMENTO"?"text-green-600":U.tendencia==="QUEDA"?"text-red-600":"text-gray-600"}`,children:[U.tendencia==="CRESCIMENTO"?"ðŸ“ˆ":U.tendencia==="QUEDA"?"ðŸ“‰":U.tendencia==="ESTÃVEL"?"âž¡ï¸":"â€”",U.tendencia]})})]},U.produto_id))})]})})]})}),!M&&K.length>0&&e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Resumo da SugestÃ£o:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:["ðŸ”´ ",e.jsx("strong",{children:K.filter(U=>U.prioridade==="CRÃTICO").length})," crÃ­ticos"]}),e.jsxs("div",{children:["âš ï¸ ",e.jsx("strong",{children:K.filter(U=>U.prioridade==="ALERTA").length})," em alerta"]}),e.jsxs("div",{children:["ðŸ’° Total: ",e.jsxs("strong",{children:["R$ ",K.filter(U=>G.includes(U.produto_id)).reduce((U,ie)=>U+he(ie)*ie.preco_unitario,0).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:Qe,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-100",children:"Cancelar"}),e.jsxs("button",{onClick:ca,disabled:G.length===0,className:"px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:["âœ… Adicionar ",G.length," Produtos ao Pedido"]})]})]})})]})})]})},ji=({pedido:s,onClose:l,onReceber:t})=>{const[m,r]=a.useState(s.itens.map(o=>({item_id:o.id,quantidade_recebida:o.quantidade_pedida-o.quantidade_recebida,max:o.quantidade_pedida-o.quantidade_recebida}))),g=()=>{const o=m.filter(v=>v.quantidade_recebida>0).map(v=>({item_id:v.item_id,quantidade_recebida:parseFloat(v.quantidade_recebida)}));if(o.length===0){ce.error("Informe a quantidade recebida de pelo menos 1 item");return}t(o)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["ðŸ“¦ Receber Pedido ",s.numero_pedido]}),e.jsx("div",{className:"space-y-4",children:s.itens.map((o,v)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold mb-2",children:o.produto_nome}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Pedido:"}),e.jsx("span",{className:"ml-2 font-semibold",children:o.quantidade_pedida})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"JÃ¡ Recebido:"}),e.jsx("span",{className:"ml-2 font-semibold",children:o.quantidade_recebida})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Pendente:"}),e.jsx("span",{className:"ml-2 font-semibold text-orange-600",children:o.quantidade_pedida-o.quantidade_recebida})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade a Receber"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:m[v].max,value:m[v].quantidade_recebida,onChange:j=>{const f=parseFloat(j.target.value)||0,N=[...m];N[v].quantidade_recebida=Math.min(f,N[v].max),r(N)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]},o.id))}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{onClick:g,className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700",children:"âœ… Confirmar Recebimento"}),e.jsx("button",{onClick:l,className:"px-6 py-3 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50",children:"âŒ Cancelar"})]})]})})},vi=({pedidoId:s,onClose:l,onEnviar:t,onEnvioManual:m,dadosEnvio:r,setDadosEnvio:g})=>e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"ðŸ“¤ Enviar Pedido ao Fornecedor"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail do Fornecedor"}),e.jsx("input",{type:"email",value:r.email,onChange:o=>g({...r,email:o.target.value}),placeholder:"fornecedor@exemplo.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["WhatsApp (futuro)",e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Em breve)"})]}),e.jsx("input",{type:"tel",value:r.whatsapp,onChange:o=>g({...r,whatsapp:o.target.value}),placeholder:"(00) 00000-0000",className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Formatos para Envio"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.formatos.pdf,onChange:o=>g({...r,formatos:{...r.formatos,pdf:o.target.checked}}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm",children:"ðŸ“„ PDF"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.formatos.excel,onChange:o=>g({...r,formatos:{...r.formatos,excel:o.target.checked}}),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),e.jsx("span",{className:"ml-2 text-sm",children:"ðŸ“Š Excel"})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 pt-4",children:[e.jsx("button",{onClick:t,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors",children:"ðŸ“§ Enviar por E-mail"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"ou"})})]}),e.jsx("button",{onClick:m,className:"w-full bg-gray-600 text-white py-3 rounded-lg font-semibold hover:bg-gray-700 transition-colors",children:"âœ… JÃ¡ enviei manualmente"}),e.jsx("button",{onClick:l,className:"w-full border border-gray-300 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-50",children:"âŒ Cancelar"})]})]})]})}),yi=()=>{var Ne,Pe;const s=fa(),[l,t]=a.useState([]),[m,r]=a.useState([]),[g,o]=a.useState(!1),[v,j]=a.useState(!1),[f,N]=a.useState(null),[d,x]=a.useState(!1),[k,w]=a.useState(!1),[c,b]=a.useState(!1),[p,i]=a.useState(!1),[u,n]=a.useState(null),[C,h]=a.useState(!1),[_,E]=a.useState([]),[$,K]=a.useState(null),[te,M]=a.useState(!1),[A,Q]=a.useState(!1),[re,q]=a.useState(null),[Z,R]=a.useState({}),[J,S]=a.useState("todos"),[P,G]=a.useState("loja"),[B,y]=a.useState({}),[O,z]=a.useState(!1),[ae,W]=a.useState(null),[ne,H]=a.useState(null),[ee,de]=a.useState(!1),[ue,Re]=a.useState({sku:"",nome:"",descricao:"",preco_custo:"",preco_venda:"",margem_lucro:"",estoque_minimo:10,estoque_maximo:100}),[se,_e]=a.useState({});a.useEffect(()=>{console.log("Ã°Å¸â€â€ž [EntradaXML] Componente montado, iniciando carregamento..."),ke()},[]);const ke=async()=>{var L,le,pe,Fe,Oe,Ke,He,ea,oa;console.log("Ã°Å¸â€œÅ  [EntradaXML] Carregando dados...");try{const ia=localStorage.getItem("access_token")||localStorage.getItem("token");console.log("Ã°Å¸â€â€˜ [EntradaXML] Token obtido:",ia?"SIM":"NÃƒÆ’O");const Ue={Authorization:`Bearer ${ia}`};console.log("Ã°Å¸Å’Â [EntradaXML] Fazendo requisiÃƒÂ§ÃƒÂµes para:",{notasEntrada:"/notas-entrada/",produtos:"/produtos/"});const[wa,V]=await Promise.all([F.get("/notas-entrada/",{headers:Ue}),F.get("/produtos/",{headers:Ue,params:{ativo:null}})]);console.log("Ã¢Å“â€¦ [EntradaXML] Dados carregados:",{notasEntrada:((L=wa.data)==null?void 0:L.length)||0,produtos:((pe=(le=V.data)==null?void 0:le.items)==null?void 0:pe.length)||((Fe=V.data)==null?void 0:Fe.length)||0});const $e=((Oe=V.data)==null?void 0:Oe.items)||V.data,Te=$e.filter(ua=>ua.ativo===!0).length,We=$e.filter(ua=>ua.ativo===!1).length;console.log("Ã°Å¸â€œÅ  [EntradaXML] Produtos por status:",{ativos:Te,inativos:We,total:$e.length}),t(wa.data),r($e)}catch(ia){console.error("Ã¢ÂÅ’ [EntradaXML] ERRO ao carregar dados:"),console.error("  - Mensagem:",ia.message),console.error("  - Response:",(Ke=ia.response)==null?void 0:Ke.data),console.error("  - Status:",(He=ia.response)==null?void 0:He.status),console.error("  - Stack:",ia.stack),ce.error(`Erro ao carregar dados: ${((oa=(ea=ia.response)==null?void 0:ea.data)==null?void 0:oa.detail)||ia.message}`)}},Ze=async L=>{var Fe,Oe,Ke,He,ea;const le=L.target.files[0];if(console.log("Ã°Å¸â€œÂ¤ [EntradaXML] Upload iniciado"),console.log("  - Arquivo selecionado:",le==null?void 0:le.name),console.log("  - Tamanho:",le==null?void 0:le.size,"bytes"),console.log("  - Tipo:",le==null?void 0:le.type),!le){console.warn("Ã¢Å¡Â Ã¯Â¸Â [EntradaXML] Nenhum arquivo selecionado");return}if(!le.name.toLowerCase().endsWith(".xml")){console.error("Ã¢ÂÅ’ [EntradaXML] Arquivo nÃƒÂ£o ÃƒÂ© XML:",le.name),ce.error("Ã¢ÂÅ’ Por favor, selecione um arquivo XML");return}j(!0);const pe=new FormData;pe.append("file",le),console.log("Ã°Å¸Å¡â‚¬ [EntradaXML] Enviando arquivo para:","/notas-entrada/upload"),console.log("Ã°Å¸â€œÂ¦ [EntradaXML] FormData preparado:",le.name,le.size,"bytes");try{const oa=await F.post("/notas-entrada/upload",pe,{headers:{"Content-Type":"multipart/form-data"}});console.log("Ã¢Å“â€¦ [EntradaXML] Upload bem-sucedido!"),console.log("  - Response data:",oa.data);const ia=oa.data.produtos_vinculados||0,Ue=oa.data.itens_total||0;console.log(`Ã°Å¸â€œÅ  [EntradaXML] Produtos vinculados: ${ia}/${Ue}`),oa.data.fornecedor_criado_automaticamente&&ce.success(`Ã°Å¸ÂÂ¢ Novo fornecedor cadastrado: ${oa.data.fornecedor}`,{duration:4e3}),oa.data.produtos_reativados>0&&ce.success(`Ã¢â„¢Â»Ã¯Â¸Â ${oa.data.produtos_reativados} produto(s) inativo(s) reativado(s) automaticamente`,{duration:4e3}),ce.success(`Ã¢Å“â€¦ NF-e ${oa.data.numero_nota} processada! ${ia}/${Ue} produtos vinculados automaticamente`,{duration:5e3}),ke(),L.target.value=""}catch(oa){console.error("Ã¢ÂÅ’ [EntradaXML] ERRO no upload:"),console.error("  - Mensagem:",oa.message),console.error("  - Response data:",(Fe=oa.response)==null?void 0:Fe.data),console.error("  - Status:",(Oe=oa.response)==null?void 0:Oe.status),console.error("  - Headers:",(Ke=oa.response)==null?void 0:Ke.headers),console.error("  - Stack completo:",oa.stack);const ia=((ea=(He=oa.response)==null?void 0:He.data)==null?void 0:ea.detail)||oa.message||"Erro ao processar XML da NF-e";console.error("  - Mensagem para usuÃƒÂ¡rio:",ia),ce.error(`Ã¢ÂÅ’ ${ia}`)}finally{j(!1),console.log("Ã°Å¸ÂÂ [EntradaXML] Upload finalizado")}},ze=async L=>{var Oe,Ke;const le=Array.from(L.target.files);if(console.log("Ã°Å¸â€œÂ¦ [EntradaXML] Upload em lote iniciado -",le.length,"arquivos"),le.length===0){console.warn("Ã¢Å¡Â Ã¯Â¸Â [EntradaXML] Nenhum arquivo selecionado");return}const pe=le.filter(He=>!He.name.toLowerCase().endsWith(".xml"));if(pe.length>0){ce.error(`Ã¢ÂÅ’ ${pe.length} arquivo(s) nÃƒÂ£o sÃƒÂ£o XML: ${pe.map(He=>He.name).join(", ")}`);return}b(!0),i(!0),n(null);const Fe=new FormData;le.forEach(He=>{Fe.append("files",He)}),console.log("Ã°Å¸Å¡â‚¬ [EntradaXML] Enviando",le.length,"arquivos para:","/notas-entrada/upload-lote");try{const He=await F.post("/notas-entrada/upload-lote",Fe);console.log("Ã¢Å“â€¦ [EntradaXML] Upload em lote bem-sucedido!"),console.log("  - Response:",He.data),n(He.data),He.data.sucessos>0&&ce.success(`Ã¢Å“â€¦ ${He.data.sucessos}/${He.data.total_arquivos} nota(s) processada(s) com sucesso!`,{duration:5e3}),He.data.erros>0&&ce.error(`Ã¢Å¡Â Ã¯Â¸Â ${He.data.erros}/${He.data.total_arquivos} nota(s) com erro`,{duration:5e3}),ke(),L.target.value=""}catch(He){console.error("Ã¢ÂÅ’ [EntradaXML] ERRO no upload em lote:",He),ce.error(`Ã¢ÂÅ’ Erro ao processar lote: ${((Ke=(Oe=He.response)==null?void 0:Oe.data)==null?void 0:Ke.detail)||He.message}`),i(!1)}finally{b(!1)}},Xe=async L=>{try{const le=await F.get(`/notas-entrada/${L}`);le.data.itens&&le.data.itens.sort((pe,Fe)=>pe.id-Fe.id),N(le.data),x(!0),G(le.data.tipo_rateio||"loja")}catch{ce.error("Erro ao carregar detalhes da nota")}},be=async L=>{try{const le=await F.get(`/notas-entrada/${L}`);N(le.data),w(!0)}catch{ce.error("Erro ao carregar nota")}},Ee=async(L,le,pe)=>{var Fe,Oe;try{await F.post(`/notas-entrada/${L}/itens/${le}/vincular?produto_id=${parseInt(pe)}`),ce.success("Ã¢Å“â€¦ Produto vinculado com sucesso!");const Ke=await F.get(`/notas-entrada/${L}`);Ke.data.itens&&Ke.data.itens.sort((He,ea)=>He.id-ea.id),N(Ke.data)}catch(Ke){console.error("Ã¢ÂÅ’ Erro ao vincular produto:",Ke),ce.error(((Oe=(Fe=Ke.response)==null?void 0:Fe.data)==null?void 0:Oe.detail)||"Erro ao vincular produto")}},he=async(L,le)=>{var pe,Fe;try{await F.post(`/notas-entrada/${L}/rateio`,{tipo_rateio:le}),ce.success(`Ã¢Å“â€¦ Nota configurada: ${le==="online"?"100% Online":le==="loja"?"100% Loja FÃƒÂ­sica":"Rateio Parcial"}`);const Oe=await F.get(`/notas-entrada/${L}`);N(Oe.data),G(le)}catch(Oe){console.error("Ã¢ÂÅ’ Erro ao salvar tipo de rateio:",Oe),ce.error(((Fe=(pe=Oe.response)==null?void 0:pe.data)==null?void 0:Fe.detail)||"Erro ao salvar tipo de rateio")}},Qe=async(L,le,pe)=>{var Fe,Oe;try{const Ke=await F.post(`/notas-entrada/${L}/itens/${le}/rateio`,{quantidade_online:parseFloat(pe)||0});ce.success("Ã°Å¸â€œÅ  Quantidade online configurada!");const He=Ke.data.nota_totais;ce.success(`Nota: ${He.percentual_online.toFixed(1)}% Online (R$ ${He.valor_online.toFixed(2)}) | ${He.percentual_loja.toFixed(1)}% Loja (R$ ${He.valor_loja.toFixed(2)})`),N(ea=>({...ea,percentual_online:He.percentual_online,percentual_loja:He.percentual_loja,valor_online:He.valor_online,valor_loja:He.valor_loja,itens:ea.itens.map(oa=>oa.id===le?{...oa,quantidade_online:parseFloat(pe)||0}:oa)})),y(ea=>({...ea,[le]:parseFloat(pe)||0}))}catch(Ke){console.error("Ã¢ÂÅ’ Erro ao salvar quantidade online:",Ke),ce.error(((Oe=(Fe=Ke.response)==null?void 0:Fe.data)==null?void 0:Oe.detail)||"Erro ao salvar")}},Ye=async L=>{var le,pe;try{const Fe=await F.get(`/notas-entrada/${L}/preview-processamento`);q(Fe.data),Q(!0),x(!1);const Oe={};Fe.data.itens.forEach(Ke=>{Ke.produto_vinculado&&(Oe[Ke.produto_vinculado.produto_id]={preco_venda:Ke.produto_vinculado.preco_venda_atual,margem:Ke.produto_vinculado.margem_atual})}),R(Oe)}catch(Fe){ce.error(((pe=(le=Fe.response)==null?void 0:le.data)==null?void 0:pe.detail)||"Erro ao carregar preview")}},ca=Ye,ra=async()=>{var L,le;o(!0);try{const pe=[];Object.entries(Z).forEach(([Oe,Ke])=>{const He=re.itens.find(ea=>ea.produto_vinculado&&ea.produto_vinculado.produto_id==Oe);He&&He.produto_vinculado&&Ke.preco_venda!==He.produto_vinculado.preco_venda_atual&&pe.push({produto_id:parseInt(Oe),preco_venda:Ke.preco_venda})}),pe.length>0&&await F.post(`/notas-entrada/${re.nota_id}/atualizar-precos`,pe);const Fe=await F.post(`/notas-entrada/${re.nota_id}/processar`,{});ce.success(`Ã¢Å“â€¦ Nota processada! ${Fe.data.itens_processados} itens lanÃƒÂ§ados no estoque`,{duration:5e3}),x(!1),N(null),Q(!1),q(null),ke()}catch(pe){ce.error(((le=(L=pe.response)==null?void 0:L.data)==null?void 0:le.detail)||"Erro ao processar nota")}finally{o(!1)}},pa=(L,le)=>le>=100?L*2:L/(1-le/100),na=(L,le)=>L<=0?0:(L-le)/L*100,oe=(L,le,pe)=>{const Fe=na(le,pe);R(Oe=>({...Oe,[L]:{preco_venda:le,margem:Fe}}))},ye=(L,le,pe)=>{const Fe=pa(pe,le);R(Oe=>({...Oe,[L]:{preco_venda:Fe,margem:le}}))},Ce=async(L,le)=>{var pe,Fe;if(confirm(`Tem certeza que deseja excluir a nota ${le}?`)){o(!0);try{await F.delete(`/notas-entrada/${L}`),ce.success("Ã°Å¸â€”â€˜Ã¯Â¸Â Nota excluÃƒÂ­da com sucesso!"),d&&(x(!1),N(null)),ke()}catch(Oe){ce.error(((Fe=(pe=Oe.response)==null?void 0:pe.data)==null?void 0:Fe.detail)||"Erro ao excluir nota")}finally{o(!1)}}},Be=async(L,le)=>{M(!0),K({id:L,nome:le}),h(!0);try{const pe=await F.get(`/produtos/${L}/historico-precos`);E(pe.data)}catch{ce.error("Erro ao carregar histÃƒÂ³rico de preÃƒÂ§os"),h(!1)}finally{M(!1)}},Ie=async(L,le)=>{var pe,Fe;if(confirm(`Ã¢Å¡Â Ã¯Â¸Â Tem certeza que deseja REVERTER a entrada da nota ${le}?

Isso irÃƒÂ¡:
Ã¢â‚¬Â¢ Remover as quantidades do estoque
Ã¢â‚¬Â¢ Excluir os lotes criados
Ã¢â‚¬Â¢ Estornar as contas a pagar lanÃƒÂ§adas
Ã¢â‚¬Â¢ Restaurar o status da nota para pendente`)){o(!0);try{const Oe=await F.post(`/notas-entrada/${L}/reverter`,{});ce.success(`Ã¢Å“â€¦ Entrada revertida! ${Oe.data.itens_revertidos} produtos ajustados`,{duration:5e3}),d&&(x(!1),N(null)),ke()}catch(Oe){ce.error(((Fe=(pe=Oe.response)==null?void 0:pe.data)==null?void 0:Fe.detail)||"Erro ao reverter entrada")}finally{o(!1)}}},Y=async(L,le)=>{var pe,Fe;try{await F.post(`/notas-entrada/${L}/itens/${le}/desvincular`),ce.success("Ã¢Å“â€¦ Produto desvinculado!");const Oe=await F.get(`/notas-entrada/${L}`);Oe.data.itens&&Oe.data.itens.sort((Ke,He)=>Ke.id-He.id),N(Oe.data)}catch(Oe){ce.error(((Fe=(pe=Oe.response)==null?void 0:pe.data)==null?void 0:Fe.detail)||"Erro ao desvincular produto")}},je=L=>{var ua;const le=((ua=L.produto_vinculado)==null?void 0:ua.produto_nome)||L.produto_nome;if(!le)return[];const pe=[],Fe=L.descricao_nf||L.descricao||"",Oe=le||"";if(!Fe||!Oe)return[];const Ke=Fe.toLowerCase(),He=Oe.toLowerCase(),ea=/(\d+(?:[.,]\d+)?)\s*(kg|g|ml|l|un|und|unid)/gi,oa=[...Ke.matchAll(ea)],ia=[...He.matchAll(ea)];if(oa.length>0&&ia.length>0){const xe=oa[0][0],Ae=ia[0][0];xe!==Ae&&pe.push(`Peso/Tamanho diferente: NF="${xe}" vs Produto="${Ae}"`)}const Ue=["preto","branco","vermelho","azul","verde","amarelo","rosa","roxo","laranja","marrom","cinza"],wa=Ue.find(xe=>Ke.includes(xe)),V=Ue.find(xe=>He.includes(xe));wa&&V&&wa!==V&&pe.push(`Cor diferente: NF="${wa}" vs Produto="${V}"`);const $e=["frango","carne","peixe","cordeiro","salmao","salmÃƒÂ£o","atum","vegetais"],Te=$e.find(xe=>Ke.includes(xe)),We=$e.find(xe=>He.includes(xe));return Te&&We&&Te!==We&&pe.push(`Sabor diferente: NF="${Te}" vs Produto="${We}"`),(Ke.includes("cao")||Ke.includes("cachorro")||Ke.includes("dog"))&&(He.includes("gato")||He.includes("cat"))&&pe.push("Ã¢Å¡Â Ã¯Â¸Â Animal diferente: NF para CACHORRO mas produto ÃƒÂ© para GATO"),(Ke.includes("gato")||Ke.includes("cat"))&&(He.includes("cao")||He.includes("cachorro")||He.includes("dog"))&&pe.push("Ã¢Å¡Â Ã¯Â¸Â Animal diferente: NF para GATO mas produto ÃƒÂ© para CACHORRO"),pe},Me=async L=>{W(L),z(!0),de(!0),Re({sku:"",nome:"",descricao:"",preco_custo:"",preco_venda:"",margem_lucro:"",estoque_minimo:10,estoque_maximo:100});try{const le=await F.get(`/notas-entrada/${f.id}/itens/${L.id}/sugerir-sku`);H(le.data);let pe=le.data.sku_proposto||L.codigo_produto||"PROD-"+L.id;le.data.ja_existe&&le.data.sugestoes&&le.data.sugestoes.length>0&&(pe=(le.data.sugestoes.find(Oe=>Oe.padrao)||le.data.sugestoes[0]).sku),Re({sku:pe,nome:L.descricao||L.descricao_produto||"Produto sem nome",descricao:L.descricao||L.descricao_produto||"",preco_custo:L.valor_unitario.toString(),preco_venda:(L.valor_unitario*1.5).toFixed(2),margem_lucro:"50",estoque_minimo:10,estoque_maximo:100}),console.log("Ã¢Å“â€¦ FormulÃƒÂ¡rio preenchido:",{sku:pe,nome:L.descricao,preco_custo:L.valor_unitario})}catch(le){ce.error("Erro ao buscar sugestÃƒÂµes de SKU"),console.error("Erro ao buscar SKU:",le),Re({sku:L.codigo_produto||"PROD-"+L.id,nome:L.descricao||"Produto sem nome",descricao:L.descricao||"",preco_custo:L.valor_unitario.toString(),preco_venda:(L.valor_unitario*1.5).toFixed(2),margem_lucro:"50",estoque_minimo:10,estoque_maximo:100})}finally{de(!1)}},I=async()=>{var L,le;try{o(!0);const pe={...ue,preco_custo:parseFloat(ue.preco_custo)||0,preco_venda:parseFloat(ue.preco_venda)||0,margem_lucro:parseFloat(ue.margem_lucro)||0,estoque_minimo:parseInt(ue.estoque_minimo)||10,estoque_maximo:parseInt(ue.estoque_maximo)||100},Fe=await F.post(`/notas-entrada/${f.id}/itens/${ae.id}/criar-produto`,pe);ce.success(`Ã¢Å“â€¦ Produto ${Fe.data.produto.codigo} criado e vinculado!`),z(!1),W(null),H(null),await ke();const Oe=await F.get(`/notas-entrada/${f.id}`);N(Oe.data)}catch(pe){ce.error(((le=(L=pe.response)==null?void 0:L.data)==null?void 0:le.detail)||"Erro ao criar produto"),console.error(pe)}finally{o(!1)}},X=async()=>{var pe;const L=f.itens.filter(Fe=>!Fe.produto_id);if(L.length===0){ce.success("Todos os produtos jÃƒÂ¡ estÃƒÂ£o vinculados!");return}if(window.confirm(`Criar ${L.length} produto(s) automaticamente?

PadrÃƒÂµes aplicados:
Ã¢â‚¬Â¢ Estoque mÃƒÂ­nimo: 10
Ã¢â‚¬Â¢ Estoque mÃƒÂ¡ximo: 100
Ã¢â‚¬Â¢ Margem de lucro: 50%

VocÃƒÂª poderÃƒÂ¡ editar os produtos depois no cadastro.`))try{o(!0);let Fe=0,Oe=0;const Ke=ce.loading(`Ã°Å¸â€œÂ¦ Criando ${L.length} produtos...`);for(const ea of L)try{const oa=await F.get(`/notas-entrada/${f.id}/itens/${ea.id}/sugerir-sku`);let ia=oa.data.sku_proposto||ea.codigo_produto||`PROD-${ea.id}`;oa.data.ja_existe&&((pe=oa.data.sugestoes)==null?void 0:pe.length)>0&&(ia=(oa.data.sugestoes.find(V=>V.padrao)||oa.data.sugestoes[0]).sku);const Ue={sku:ia,nome:ea.descricao||"Produto sem nome",descricao:ea.descricao||"",preco_custo:parseFloat(ea.valor_unitario)||0,preco_venda:parseFloat((ea.valor_unitario*1.5).toFixed(2)),margem_lucro:50,estoque_minimo:10,estoque_maximo:100};await F.post(`/notas-entrada/${f.id}/itens/${ea.id}/criar-produto`,Ue),Fe++}catch(oa){console.error(`Erro ao criar produto do item ${ea.id}:`,oa),Oe++}ce.dismiss(Ke),Fe>0&&ce.success(`Ã¢Å“â€¦ ${Fe} produto(s) criado(s) com sucesso!`),Oe>0&&ce.error(`Ã¢ÂÅ’ ${Oe} erro(s) ao criar produtos`),await ke();const He=await F.get(`/notas-entrada/${f.id}`);N(He.data)}catch(Fe){ce.error("Erro ao criar produtos em lote"),console.error(Fe)}finally{o(!1)}},fe=(L,le)=>L===0?0:((le-L)/L*100).toFixed(2),U=L=>{const le={pendente:"bg-yellow-200 text-yellow-800",processada:"bg-green-200 text-green-800",cancelada:"bg-red-200 text-red-800",erro:"bg-red-300 text-red-900"};return e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${le[L]||"bg-gray-200"}`,children:L.toUpperCase()})},ie=L=>{if(!L)return e.jsx("span",{className:"text-gray-400 text-sm",children:"NÃƒÂ£o vinculado"});const le=L>=90?"alta":L>=70?"media":"baixa",pe={alta:"bg-green-100 text-green-800",media:"bg-yellow-100 text-yellow-800",baixa:"bg-orange-100 text-orange-800"};return e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-semibold ${pe[le]}`,children:[L.toFixed(1),"% ",le==="alta"?"Ã¢Å“â€¦":le==="media"?"Ã¢Å¡Â Ã¯Â¸Â":"Ã¢Å¡Â¡"]})};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Ã°Å¸â€œâ€ž Entrada por NF-e (XML)"}),e.jsx("p",{className:"text-gray-600",children:"Importe notas fiscais eletrÃƒÂ´nicas e vincule produtos automaticamente"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-8 mb-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx("svg",{className:"mx-auto h-16 w-16 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:v?"Ã¢ÂÂ³ Processando XML...":"Selecione o arquivo XML da NF-e"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"O sistema irÃƒÂ¡ processar automaticamente os dados da nota fiscal"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("label",{className:"inline-block",children:[e.jsx("input",{type:"file",accept:".xml",onChange:Ze,disabled:v||c,className:"hidden"}),e.jsx("span",{className:`
                px-6 py-3 rounded-lg font-semibold cursor-pointer inline-block
                ${v||c?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}
              `,children:v?"Ã¢ÂÂ³ Processando...":"Ã°Å¸â€œÂ Upload ÃƒÅ¡nico"})]}),e.jsxs("label",{className:"inline-block",children:[e.jsx("input",{type:"file",accept:".xml",multiple:!0,onChange:ze,disabled:v||c,className:"hidden"}),e.jsx("span",{className:`
                px-6 py-3 rounded-lg font-semibold cursor-pointer inline-block
                ${v||c?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"}
              `,children:c?"Ã¢ÂÂ³ Processando Lote...":"Ã°Å¸â€œÂ¦ Upload MÃƒÂºltiplo"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"Formatos aceitos: XML de NF-e (padrÃƒÂ£o SEFAZ)"})]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:l.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Notas"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:l.filter(L=>L.status==="pendente").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pendentes"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:l.filter(L=>L.status==="processada").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Processadas"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:["R$ ",l.filter(L=>L.status==="processada").reduce((L,le)=>L+(le.valor_total||0),0).toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Valor Processado"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b bg-gray-50",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Notas Fiscais Importadas"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Chave NF-e"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Fornecedor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Data EmissÃƒÂ£o"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Itens"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"AÃƒÂ§ÃƒÂµes"})]})}),e.jsx("tbody",{children:l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500",children:"Nenhuma nota fiscal importada ainda. FaÃƒÂ§a o upload de um XML acima."})}):l.map(L=>e.jsxs("tr",{onClick:()=>be(L.id),className:"border-t hover:bg-blue-50 cursor-pointer transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"font-mono text-xs",children:[L.chave_acesso.substring(0,20),"..."]})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold",children:L.fornecedor_nome}),e.jsx("div",{className:"text-xs text-gray-500",children:L.fornecedor_cnpj})]}),e.jsx("td",{className:"px-4 py-3",children:new Date(L.data_emissao).toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold",children:["R$ ",(L.valor_total||0).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-semibold",children:[L.produtos_vinculados+L.produtos_nao_vinculados," itens"]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:U(L.status)}),e.jsx("td",{className:"px-4 py-3 text-center",onClick:le=>le.stopPropagation(),children:e.jsxs("div",{className:"flex gap-2 justify-center",children:[L.status==="pendente"&&e.jsx("button",{onClick:()=>Xe(L.id),className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded font-semibold text-sm",title:"Vincular produtos",children:"Ã°Å¸â€â€” Vincular"}),L.entrada_estoque_realizada?e.jsx("button",{onClick:()=>Ie(L.id,L.numero_nota),className:"text-orange-600 hover:text-orange-800 font-semibold text-sm",title:"Reverter entrada no estoque",children:"Ã¢â€ Â©Ã¯Â¸Â Reverter"}):e.jsx("button",{onClick:()=>Ce(L.id,L.numero_nota),className:"text-red-600 hover:text-red-800 font-semibold text-sm",title:"Excluir nota",children:"Ã°Å¸â€”â€˜Ã¯Â¸Â Excluir"})]})})]},L.id))})]})})]}),d&&f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Ã°Å¸â€œâ€ž Detalhes da NF-e"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Chave: ",f.chave_acesso]})]}),e.jsx("button",{onClick:()=>{x(!1),N(null)},className:"text-gray-500 hover:text-gray-700 text-2xl",children:"Ãƒâ€”"})]}),e.jsx("div",{className:"px-6 py-4 border-b bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Fornecedor:"}),e.jsx("div",{className:"font-semibold",children:f.fornecedor_nome}),e.jsx("div",{className:"text-xs text-gray-500",children:f.fornecedor_cnpj}),f.fornecedor_id&&e.jsx("div",{className:"text-xs text-green-600 mt-1",children:"Ã¢Å“â€¦ Cadastrado"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Data EmissÃƒÂ£o:"}),e.jsx("div",{className:"font-semibold",children:new Date(f.data_emissao).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Valor Total:"}),e.jsxs("div",{className:"font-bold text-lg text-green-600",children:["R$ ",(f.valor_total||0).toFixed(2)]})]})]})}),f.fornecedor_id&&f.fornecedor_criado_automaticamente&&e.jsx("div",{className:"px-6 py-2 bg-blue-50 border-b border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:f.fornecedor_nome})," foi cadastrado automaticamente."]}),e.jsx("button",{onClick:()=>s(`/clientes/${f.fornecedor_id}`),className:"px-3 py-1 bg-blue-600 text-white rounded font-medium hover:bg-blue-700 text-xs",children:"Ã°Å¸â€œÂ Completar Cadastro"})]})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-bold text-xl text-gray-800",children:["Ã°Å¸â€œÂ¦ Produtos da Nota (",f.itens.length,")"]}),f.status==="pendente"&&f.itens.some(L=>!L.produto_id)&&e.jsxs("button",{onClick:X,disabled:g,className:"px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400 flex items-center gap-2 text-sm",title:"Cria automaticamente todos os produtos nÃƒÂ£o vinculados com os padrÃƒÂµes: Estoque mÃƒÂ­n: 10, mÃƒÂ¡x: 100, Margem: 50%",children:[e.jsx("span",{children:"Ã¢Å“Â¨ Criar Todos NÃƒÂ£o Vinculados"}),e.jsx("span",{className:"text-xs bg-purple-800 px-2 py-0.5 rounded",children:f.itens.filter(L=>!L.produto_id).length})]})]}),e.jsx("div",{className:"space-y-3",children:f.itens.map(L=>{const le=je(L),pe=le.length>0;return e.jsxs("div",{className:"border-2 border-gray-400 rounded-lg overflow-hidden bg-white shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] gap-0",children:[e.jsxs("div",{className:"bg-blue-50 border-r-2 border-gray-300 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs font-bold",children:"NF-e"}),ie(L.confianca_vinculo)]}),e.jsx("div",{className:"font-semibold text-base mb-2 text-blue-900",children:L.descricao}),e.jsxs("div",{className:"space-y-1.5 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"CÃƒÂ³digo:"}),e.jsx("span",{className:"font-mono font-semibold",children:L.codigo_produto})]}),L.ean&&L.ean!=="SEM GTIN"&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"EAN:"}),e.jsx("span",{className:"font-mono font-semibold",children:L.ean})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"NCM:"}),e.jsx("span",{className:"font-mono font-semibold",children:L.ncm})]}),e.jsxs("div",{className:"flex justify-between border-t pt-1.5 mt-1.5",children:[e.jsx("span",{className:"text-gray-600",children:"Qtd:"}),e.jsx("span",{className:"font-semibold",children:L.quantidade})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Unit.:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",L.valor_unitario.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["R$ ",L.valor_total.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"CFOP:"}),e.jsx("span",{className:"font-semibold",children:L.cfop})]})]}),(L.lote||L.data_validade)&&e.jsxs("div",{className:"mt-3 pt-3 border-t space-y-2",children:[L.lote&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Ã°Å¸â€œÂ¦ Lote:"}),e.jsx("div",{className:"font-semibold text-purple-800",children:L.lote})]}),L.data_validade&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Ã°Å¸â€œâ€¦ Validade:"}),e.jsx("div",{className:"font-semibold text-orange-800",children:new Date(L.data_validade).toLocaleDateString("pt-BR")})]})]})]}),e.jsx("div",{className:"flex flex-col items-center justify-center bg-gray-100 px-2 py-4",children:L.produto_id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Y(f.id,L.id),className:"text-3xl text-green-600 hover:text-red-600 transition-colors mb-2",title:"Ã¢Å“â€¦ Vinculado - Clique para desvincular",children:"Ã¢Å“â€œ"}),pe&&e.jsx("div",{className:"bg-red-100 border-2 border-red-500 rounded-lg p-2 max-w-[200px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:"Ã¢Å¡Â Ã¯Â¸Â"}),e.jsx("div",{className:"font-bold text-red-700 text-xs mb-1",children:"DIVERGÃƒÅ NCIA!"}),e.jsx("div",{className:"text-[10px] text-red-600 space-y-0.5",children:le.map((Fe,Oe)=>e.jsxs("div",{children:["Ã¢â‚¬Â¢ ",Fe]},Oe))})]})})]}):e.jsx("div",{className:"text-3xl text-gray-400",title:"Ã¢ÂÅ’ NÃƒÂ£o vinculado",children:"Ã¢Å“â€¢"})}),e.jsx("div",{className:`p-4 ${L.produto_id?"bg-green-50":"bg-gray-50"}`,children:e.jsx("div",{className:`p-4 ${L.produto_id?"bg-green-50":"bg-gray-50"}`,children:f.status==="pendente"?e.jsx(e.Fragment,{children:L.produto_id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsx("div",{className:"bg-green-600 text-white px-2 py-1 rounded text-xs font-bold",children:"Ã¢Å“â€¦ PRODUTO SISTEMA"})}),e.jsx("div",{className:"font-semibold text-base mb-3 text-green-900",children:L.produto_nome}),e.jsx("div",{className:"text-xs text-green-700 mb-3 italic",children:"Ã°Å¸â€™Â¡ Para alterar o vÃƒÂ­nculo, selecione outro produto ou clique no Ã¢Å“â€œ para desvincular"}),e.jsxs("select",{value:L.produto_id,onChange:Fe=>{Fe.target.value&&Fe.target.value!=L.produto_id&&Ee(f.id,L.id,Fe.target.value)},className:"w-full px-3 py-2 border-2 border-green-400 rounded text-sm focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:L.produto_id,children:L.produto_nome}),Array.isArray(m)&&m.filter(Fe=>Fe.id!==L.produto_id).map(Fe=>e.jsxs("option",{value:Fe.id,children:[Fe.codigo," - ",Fe.nome," ",Fe.descricao?`| ${Fe.descricao.substring(0,50)}...`:""," (Est: ",Fe.estoque_atual||0,")"]},Fe.id))]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsx("div",{className:"bg-orange-600 text-white px-2 py-1 rounded text-xs font-bold",children:"Ã¢Å¡Â Ã¯Â¸Â NÃƒÆ’O VINCULADO"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1",children:"Ã°Å¸â€Â Pesquisar produto existente:"}),e.jsx("input",{type:"text",placeholder:"Digite nome ou SKU...",value:se[L.id]||"",onChange:Fe=>_e({...se,[L.id]:Fe.target.value}),className:"w-full px-3 py-2 border-2 border-gray-400 rounded focus:ring-2 focus:ring-blue-500 text-sm"})]}),se[L.id]&&se[L.id].length>=2&&e.jsxs("div",{className:"border-2 border-gray-300 rounded max-h-48 overflow-y-auto bg-white",children:[Array.isArray(m)&&m.filter(Fe=>{var Ke,He,ea;const Oe=se[L.id].toLowerCase();return((Ke=Fe.nome)==null?void 0:Ke.toLowerCase().includes(Oe))||((He=Fe.codigo)==null?void 0:He.toLowerCase().includes(Oe))||((ea=Fe.descricao)==null?void 0:ea.toLowerCase().includes(Oe))}).sort((Fe,Oe)=>Fe.ativo===Oe.ativo?0:Fe.ativo?-1:1).slice(0,15).map(Fe=>e.jsxs("button",{type:"button",onClick:()=>{Ee(f.id,L.id,Fe.id),_e({...se,[L.id]:""})},className:`w-full text-left px-3 py-2 hover:bg-blue-50 border-b border-gray-200 last:border-b-0 text-xs ${Fe.ativo?"":"text-red-600 font-bold"}`,children:[!Fe.ativo&&"Ã°Å¸â€Â´ ",Fe.codigo," - ",Fe.nome,!Fe.ativo&&" [INATIVO]",e.jsxs("span",{className:"text-gray-500 ml-1",children:["(Est: ",Fe.estoque_atual||0,")"]})]},`produto-${L.id}-${Fe.id}`)),m.filter(Fe=>{var Ke,He,ea;const Oe=se[L.id].toLowerCase();return((Ke=Fe.nome)==null?void 0:Ke.toLowerCase().includes(Oe))||((He=Fe.codigo)==null?void 0:He.toLowerCase().includes(Oe))||((ea=Fe.descricao)==null?void 0:ea.toLowerCase().includes(Oe))}).length===0&&e.jsx("div",{className:"px-3 py-4 text-center text-gray-500 text-xs",children:"Ã¢ÂÅ’ Nenhum produto encontrado"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 border-t border-gray-300"}),e.jsx("span",{className:"text-xs text-gray-500",children:"ou"}),e.jsx("div",{className:"flex-1 border-t border-gray-300"})]}),e.jsx("button",{onClick:()=>Me(L),className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 text-sm",children:"Ã¢Å¾â€¢ Criar Novo Produto"})]})]})}):e.jsx("div",{children:L.produto_id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-green-600 text-white px-2 py-1 rounded text-xs font-bold inline-block mb-2",children:"Ã¢Å“â€¦ VINCULADO"}),e.jsx("div",{className:"font-semibold text-base text-green-900",children:L.produto_nome})]}):e.jsx("div",{className:"bg-gray-600 text-white px-2 py-1 rounded text-xs font-bold inline-block",children:"Ã¢Å¡Â Ã¯Â¸Â NÃƒÆ’O VINCULADO"})})})}),f.status==="pendente"&&P==="parcial"&&L.produto_id&&e.jsxs("div",{className:"col-span-3 p-4 border-t-2 border-gray-300 bg-gradient-to-r from-blue-50 via-gray-50 to-green-50",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-3 flex items-center text-sm",children:"Ã°Å¸â€œÂ¦ Quantidade destinada ao estoque online"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Ã°Å¸â€œâ€¹ Total NF"}),e.jsx("input",{type:"number",value:L.quantidade,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded bg-gray-100 text-base font-semibold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Ã°Å¸Å’Â Online"}),e.jsx("input",{type:"number",min:"0",max:L.quantidade,step:"0.01",value:B[L.id]??L.quantidade_online??0,onChange:Fe=>{const Oe=parseFloat(Fe.target.value)||0;y({...B,[L.id]:Math.min(Oe,L.quantidade)})},className:"w-full px-3 py-2 border-2 border-blue-400 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base font-semibold",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Ã°Å¸ÂÂª Loja"}),e.jsx("input",{type:"number",value:(L.quantidade-(B[L.id]??L.quantidade_online??0)).toFixed(2),disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded bg-gray-100 text-base font-semibold"})]})]}),e.jsxs("div",{className:"mt-3 text-sm text-gray-700 bg-white rounded-lg p-3 border border-gray-300 font-medium",children:["Ã°Å¸â€™Âµ Valor online: R$ ",((B[L.id]??L.quantidade_online??0)*L.valor_unitario).toFixed(2)]}),B[L.id]!==void 0&&B[L.id]!==L.quantidade_online?e.jsx("button",{onClick:()=>Qe(f.id,L.id,B[L.id]),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 mt-3 text-sm",children:"Ã°Å¸â€™Â¾ Salvar DistribuiÃƒÂ§ÃƒÂ£o"}):L.quantidade_online!==null&&L.quantidade_online!==void 0&&e.jsxs("div",{className:"mt-3 text-sm text-green-700 bg-green-50 rounded-lg p-3 border border-green-200 flex items-center justify-center font-medium",children:["Ã¢Å“â€¦ Salvo: ",L.quantidade_online," online / ",(L.quantidade-L.quantidade_online).toFixed(2)," loja"]})]})]}),f.status==="processada"&&L.produto_id&&e.jsxs("div",{className:"mt-3 pt-3 border-t bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("span",{className:"text-blue-800 font-semibold",children:"Ã¢Å“â€¦ LanÃƒÂ§ado no estoque:"}),e.jsx("span",{className:"ml-2",children:L.produto_nome})]})]},L.id)})})]}),f.status==="pendente"&&e.jsxs("div",{className:"sticky bottom-0 bg-white border-t px-6 py-4 space-y-3",children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Ã°Å¸â€œÅ  DistribuiÃƒÂ§ÃƒÂ£o (informativo para relatÃƒÂ³rios)"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Estoque unificado Ã¢â‚¬Â¢ ClassificaÃƒÂ§ÃƒÂ£o apenas para anÃƒÂ¡lises"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>he(f.id,"loja"),disabled:g,className:`px-3 py-1 rounded text-xs font-medium transition-colors ${P==="loja"?"bg-gray-800 text-white":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-100"} ${g?"opacity-50 cursor-not-allowed":""}`,children:"Ã°Å¸ÂÂª Loja"}),e.jsx("button",{onClick:()=>he(f.id,"online"),disabled:g,className:`px-3 py-1 rounded text-xs font-medium transition-colors ${P==="online"?"bg-gray-800 text-white":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-100"} ${g?"opacity-50 cursor-not-allowed":""}`,children:"Ã°Å¸Å’Â Online"}),e.jsx("button",{onClick:()=>he(f.id,"parcial"),disabled:g,className:`px-3 py-1 rounded text-xs font-medium transition-colors ${P==="parcial"?"bg-gray-800 text-white":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-100"} ${g?"opacity-50 cursor-not-allowed":""}`,children:"Ã°Å¸â€œÅ  Parcial"}),(f.percentual_online>0||f.tipo_rateio)&&e.jsxs("div",{className:"ml-auto flex gap-3 text-xs text-gray-600",children:[e.jsxs("span",{children:["Online: ",(f.percentual_online||0).toFixed(0),"%"]}),e.jsxs("span",{children:["Loja: ",(f.percentual_loja||100).toFixed(0),"%"]})]})]}),P==="parcial"&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-gray-100 rounded p-2",children:["Ã°Å¸â€™Â¡ Defina a quantidade destinada ao ",e.jsx("strong",{children:"estoque online"})," em cada produto acima. O sistema calcula automaticamente a % baseado nos valores."]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[f.itens.filter(L=>L.produto_id).length," de ",f.itens.length," produtos vinculados"]}),e.jsxs("div",{className:"flex gap-3",children:[f.entrada_estoque_realizada?e.jsx("button",{onClick:()=>Ie(f.id,f.numero_nota),disabled:g,className:"px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 disabled:bg-gray-400",children:g?"Ã¢ÂÂ³ Revertendo...":"Ã¢â€ Â©Ã¯Â¸Â Reverter Entrada"}):e.jsxs(e.Fragment,{children:[!f.entrada_estoque_realizada&&e.jsx("button",{onClick:()=>Ce(f.id,f.numero_nota),disabled:g,className:"px-6 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 disabled:bg-gray-400",children:"Ã°Å¸â€”â€˜Ã¯Â¸Â Excluir Nota"}),f.itens.some(L=>L.produto_id)&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ca(f.id),disabled:g,className:"px-6 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400",children:"Ã°Å¸â€™Â° Revisar PreÃƒÂ§os"}),e.jsx("button",{onClick:()=>Ye(f.id),disabled:g,className:"px-6 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 disabled:bg-gray-400",children:g?"Ã¢ÂÂ³ Processando...":"Ã¢Å“â€¦ Processar Nota"})]})]}),e.jsx("button",{onClick:()=>{x(!1),N(null)},className:"px-6 py-2 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50",children:"Fechar"})]})]})]})]})}),O&&ae&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Ã¢Å¾â€¢ Criar Novo Produto"}),e.jsx("p",{className:"text-sm text-gray-600",children:"A partir do item da NF-e"})]}),e.jsx("button",{onClick:()=>{z(!1),W(null),H(null)},className:"text-gray-500 hover:text-gray-700 text-2xl",children:"Ãƒâ€”"})]}),e.jsx("div",{className:"px-6 py-4",children:ee?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Gerando sugestÃƒÂµes de SKU..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold text-blue-900 mb-2",children:"Ã°Å¸â€œâ€ž Dados da NF-e:"}),e.jsxs("div",{className:"text-sm space-y-1 text-blue-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"DescriÃƒÂ§ÃƒÂ£o:"})," ",ae.descricao]}),e.jsxs("div",{children:[e.jsx("strong",{children:"CÃƒÂ³digo Fornecedor:"})," ",ae.codigo_produto]}),e.jsxs("div",{children:[e.jsx("strong",{children:"NCM:"})," ",ae.ncm]}),ae.ean&&e.jsxs("div",{children:[e.jsx("strong",{children:"EAN:"})," ",ae.ean]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Valor UnitÃƒÂ¡rio:"})," R$ ",ae.valor_unitario.toFixed(2)]})]})]}),(ne==null?void 0:ne.ja_existe)&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-300 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"Ã¢Å¡Â Ã¯Â¸Â"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-semibold text-yellow-900 mb-2",children:['CÃƒÂ³digo do fornecedor "',ne.sku_proposto,'" jÃƒÂ¡ estÃƒÂ¡ em uso!']}),e.jsxs("div",{className:"text-sm text-yellow-800 mb-3",children:["Produto existente: ",e.jsx("strong",{children:ne.produto_existente.nome}),e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Um SKU alternativo foi sugerido automaticamente. VocÃƒÂª pode alterar se preferir."})]}),e.jsx("div",{className:"text-sm text-yellow-800 mb-2 font-semibold",children:"Outras opÃƒÂ§ÃƒÂµes de SKU disponÃƒÂ­veis:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ne.sugestoes.map(L=>e.jsxs("button",{onClick:()=>Re({...ue,sku:L.sku}),className:`px-3 py-1 rounded-lg text-sm font-semibold transition-all ${ue.sku===L.sku?"bg-blue-600 text-white shadow-md":"bg-white border border-blue-300 text-blue-700 hover:bg-blue-50"} ${L.padrao?"ring-2 ring-yellow-400":""}`,children:[L.sku," ",L.padrao&&"Ã¢Â­Â"]},L.sku))})]})]})}),ne&&!ne.ja_existe&&e.jsx("div",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"Ã¢Å“â€¦"}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("strong",{children:"SKU disponÃƒÂ­vel!"})," O cÃƒÂ³digo do fornecedor pode ser usado diretamente."]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["SKU / CÃƒÂ³digo do Produto *",e.jsx("span",{className:"text-xs text-gray-500 font-normal ml-2",children:"(Baseado no cÃƒÂ³digo do fornecedor)"})]}),e.jsx("input",{type:"text",value:ue.sku,onChange:L=>Re({...ue,sku:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 font-mono",placeholder:"Ex: MGZ-12345"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ã°Å¸â€™Â¡ VocÃƒÂª pode editar o SKU se preferir"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Nome do Produto *"}),e.jsx("input",{type:"text",value:ue.nome,onChange:L=>Re({...ue,nome:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Nome completo do produto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"DescriÃƒÂ§ÃƒÂ£o"}),e.jsx("textarea",{value:ue.descricao,onChange:L=>Re({...ue,descricao:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:"2",placeholder:"DescriÃƒÂ§ÃƒÂ£o detalhada (opcional)"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"PreÃƒÂ§o de Custo *"}),e.jsx("input",{type:"number",step:"0.01",value:ue.preco_custo,onChange:L=>{const le=L.target.value,pe=parseFloat(ue.margem_lucro)||0;Re({...ue,preco_custo:le,preco_venda:le?pa(parseFloat(le),pe):""})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Margem (%) *"}),e.jsx("input",{type:"number",step:"0.01",value:ue.margem_lucro,onChange:L=>{const le=L.target.value,pe=parseFloat(ue.preco_custo)||0;Re({...ue,margem_lucro:le,preco_venda:pe&&le?pa(pe,parseFloat(le)):""})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"PreÃƒÂ§o de Venda *"}),e.jsx("input",{type:"number",step:"0.01",value:ue.preco_venda,onChange:L=>{const le=L.target.value,pe=parseFloat(ue.preco_custo)||0;Re({...ue,preco_venda:le,margem_lucro:pe&&le?fe(pe,parseFloat(le)):""})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Estoque MÃƒÂ­nimo"}),e.jsx("input",{type:"number",value:ue.estoque_minimo,onChange:L=>Re({...ue,estoque_minimo:parseInt(L.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Estoque MÃƒÂ¡ximo"}),e.jsx("input",{type:"number",value:ue.estoque_maximo,onChange:L=>Re({...ue,estoque_maximo:parseInt(L.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]})]})}),e.jsxs("div",{className:"sticky bottom-0 bg-white border-t px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{z(!1),W(null),H(null)},className:"px-6 py-2 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{onClick:I,disabled:g||!ue.sku||!ue.nome||!ue.preco_custo||parseFloat(ue.preco_custo)<=0||!ue.preco_venda||parseFloat(ue.preco_venda)<=0,className:"px-6 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:g?"Ã¢ÂÂ³ Criando...":"Ã¢Å“â€¦ Criar e Vincular Produto"})]})]})}),k&&f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["Ã°Å¸â€œâ€ž NF-e ",f.numero_nota]}),e.jsxs("p",{className:"text-blue-100 mt-1",children:["SÃƒÂ©rie: ",f.serie]})]}),e.jsx("button",{onClick:()=>{w(!1),N(null)},className:"text-white hover:bg-white/20 rounded-full p-2 transition-colors",children:"Ã¢Å“â€¢"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-3",children:"Ã°Å¸â€œâ€¹ Dados da Nota"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Data EmissÃƒÂ£o:"}),e.jsx("span",{className:"font-semibold",children:new Date(f.data_emissao).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{children:U(f.status)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Total:"}),e.jsxs("span",{className:"font-bold text-green-600",children:["R$ ",f.valor_total.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-3",children:"Ã°Å¸ÂÂ¢ Fornecedor"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Nome:"}),e.jsx("div",{className:"font-semibold",children:f.fornecedor_nome})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"CNPJ:"}),e.jsx("div",{className:"font-mono text-xs",children:f.fornecedor_cnpj})]})]})]})]}),e.jsxs("div",{className:"mb-6 p-3 bg-gray-50 rounded",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Ã°Å¸â€â€˜ Chave de Acesso"}),e.jsx("div",{className:"font-mono text-xs break-all",children:f.chave_acesso})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((Ne=f.itens)==null?void 0:Ne.length)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Itens"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:f.produtos_vinculados}),e.jsx("div",{className:"text-sm text-gray-600",children:"Vinculados"})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:f.produtos_nao_vinculados}),e.jsx("div",{className:"text-sm text-gray-600",children:"NÃƒÂ£o Vinculados"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-3",children:"Ã°Å¸â€œÂ¦ Itens da Nota"}),e.jsx("div",{className:"space-y-3",children:(Pe=f.itens)==null?void 0:Pe.map((L,le)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:L.descricao}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["CÃƒÂ³digo: ",L.codigo_produto," | NCM: ",L.ncm]})]}),L.vinculado?e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded",children:"Ã¢Å“â€œ Vinculado"}):e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs font-semibold rounded",children:"Ã¢Å¡Â  NÃƒÂ£o Vinculado"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 text-sm mt-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Qtd:"}),e.jsx("div",{className:"font-semibold",children:L.quantidade})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Unit:"}),e.jsxs("div",{className:"font-semibold",children:["R$ ",L.valor_unitario.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("div",{className:"font-semibold text-green-600",children:["R$ ",L.valor_total.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"CFOP:"}),e.jsx("div",{className:"font-semibold",children:L.cfop})]})]}),(L.lote||L.data_validade)&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3 text-sm",children:[L.lote&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsx("span",{className:"text-gray-600",children:"Ã°Å¸â€œÂ¦ Lote:"}),e.jsx("div",{className:"font-semibold text-purple-800",children:L.lote})]}),L.data_validade&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded p-2",children:[e.jsx("span",{className:"text-gray-600",children:"Ã°Å¸â€œâ€¦ Validade:"}),e.jsx("div",{className:"font-semibold text-orange-800",children:new Date(L.data_validade).toLocaleDateString("pt-BR")})]})]}),L.vinculado&&L.produto_nome&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Ã¢â€ â€™ Produto vinculado: "}),e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:L.produto_nome})]})]},L.id))})]})]}),e.jsxs("div",{className:"border-t p-6 bg-gray-50 flex justify-between items-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:f.entrada_estoque_realizada?e.jsx("span",{className:"text-green-600 font-semibold",children:"Ã¢Å“â€¦ Entrada realizada no estoque"}):e.jsx("span",{className:"text-orange-600 font-semibold",children:"Ã¢Å¡Â Ã¯Â¸Â Entrada ainda nÃƒÂ£o processada"})}),e.jsxs("div",{className:"flex gap-3",children:[f.status==="pendente"&&f.produtos_vinculados>0&&!f.entrada_estoque_realizada&&e.jsx(e.Fragment,{children:e.jsx("button",{onClick:()=>{w(!1),Ye(f.id)},className:"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold",children:"Ã°Å¸â€™Â° Revisar PreÃƒÂ§os e Processar"})}),f.status==="pendente"&&e.jsx("button",{onClick:()=>{w(!1),Xe(f.id)},className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold",children:"Ã°Å¸â€â€” Vincular Produtos"}),e.jsx("button",{onClick:()=>{w(!1),N(null)},className:"px-6 py-2 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50",children:"Fechar"})]})]})]})}),A&&re&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white p-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Ã°Å¸â€™Â° RevisÃƒÂ£o de PreÃƒÂ§os e Custos"}),e.jsxs("p",{className:"text-purple-100 mt-1",children:["NF-e ",re.numero_nota," - ",re.fornecedor_nome]})]}),e.jsx("div",{className:"px-6 py-3 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Filtrar:"}),(()=>{const L=re.itens.filter(Ke=>Ke.produto_vinculado!==null||Ke.produto_id!==null),le=L.filter(Ke=>{var ea;return(((ea=Ke.produto_vinculado)==null?void 0:ea.variacao_custo_percentual)||Ke.variacao_custo_percentual||0)>0}).length,pe=L.filter(Ke=>{var ea;return(((ea=Ke.produto_vinculado)==null?void 0:ea.variacao_custo_percentual)||Ke.variacao_custo_percentual||0)<0}).length,Fe=L.filter(Ke=>{var ea;return(((ea=Ke.produto_vinculado)==null?void 0:ea.variacao_custo_percentual)||Ke.variacao_custo_percentual||0)===0}).length,Oe=L.length;return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>S("todos"),className:`px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1 transition-all ${J==="todos"?"bg-blue-600 text-white shadow-md":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx("span",{className:"text-base",children:"Ã°Å¸â€œâ€¹"}),"Todos (",Oe,")"]}),le>0&&e.jsxs("button",{onClick:()=>S("aumentou"),className:`px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1 transition-all ${J==="aumentou"?"bg-red-600 text-white shadow-md":"bg-red-100 text-red-700 hover:bg-red-200"}`,children:[e.jsx("span",{className:"text-base",children:"Ã°Å¸â€œË†"}),le," custo",le>1?"s":""," maior",le>1?"es":""]}),pe>0&&e.jsxs("button",{onClick:()=>S("diminuiu"),className:`px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1 transition-all ${J==="diminuiu"?"bg-green-600 text-white shadow-md":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:[e.jsx("span",{className:"text-base",children:"Ã°Å¸â€œâ€°"}),pe," custo",pe>1?"s":""," menor",pe>1?"es":""]}),Fe>0&&e.jsxs("button",{onClick:()=>S("igual"),className:`px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1 transition-all ${J==="igual"?"bg-gray-600 text-white shadow-md":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx("span",{className:"text-base",children:"Ã¢Å¾Â¡Ã¯Â¸Â"}),Fe," sem alteraÃƒÂ§ÃƒÂ£o"]})]})})()]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"space-y-6",children:re.itens.filter(L=>{var Fe;if(!(L.produto_vinculado!==null||L.produto_id!==null))return!1;const pe=((Fe=L.produto_vinculado)==null?void 0:Fe.variacao_custo_percentual)||L.variacao_custo_percentual||0;return J==="todos"?!0:J==="aumentou"?pe>0:J==="diminuiu"?pe<0:J==="igual"?pe===0:!0}).map(L=>{const le=L.produto_vinculado||{produto_id:L.produto_id,produto_nome:L.produto_nome,produto_codigo:L.produto_codigo,produto_ean:L.produto_ean,custo_anterior:L.custo_anterior,custo_novo:L.custo_novo,variacao_custo_percentual:L.variacao_custo_percentual,preco_venda_atual:L.preco_venda_atual,margem_atual:L.margem_atual,estoque_atual:L.estoque_atual};if(!le.produto_id||!le.produto_id)return null;const pe=le.variacao_custo_percentual||0,Fe=pe>0,Oe=Z[le.produto_id]||{preco_venda:le.preco_venda_atual||0,margem:le.margem_atual||0};return e.jsxs("div",{className:"border-2 border-gray-300 rounded-xl overflow-hidden shadow-md hover:shadow-xl transition-all",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-500 text-white p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-xl mb-1",children:le.produto_nome}),e.jsxs("p",{className:"text-sm text-blue-100",children:["SKU: ",le.produto_codigo]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("button",{onClick:()=>Be(le.produto_id,le.produto_nome),className:"px-3 py-1 bg-white/20 hover:bg-white/30 rounded text-sm font-medium transition-colors",children:"Ã°Å¸â€œÅ  HistÃƒÂ³rico"}),e.jsxs("div",{className:"mt-1 text-sm",children:["Quantidade ",e.jsx("strong",{children:L.quantidade||L.quantidade_nf||0})]})]})]})}),e.jsxs("div",{className:"p-5 bg-white space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Ã°Å¸â€™Âµ Custo Anterior"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-700",children:["R$ ",(le.custo_anterior||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Ã°Å¸â€ â€¢ Custo Novo"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["R$ ",(le.custo_novo||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Ã°Å¸â€œÅ  VariaÃƒÂ§ÃƒÂ£o"}),e.jsxs("div",{className:`text-2xl font-bold ${Fe?"text-red-600":pe<0?"text-green-600":"text-gray-600"}`,children:[pe>0?"Ã¢â€ â€”":pe<0?"Ã¢â€ Ëœ":"Ã¢Å¾Â¡"," ",Math.abs(pe).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Ã°Å¸â€™Â° PreÃƒÂ§o de Venda"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:Oe.preco_venda,onChange:Ke=>oe(le.produto_id,parseFloat(Ke.target.value)||0,le.custo_novo),className:"w-full pl-10 pr-3 py-3 border-2 border-gray-300 rounded-lg text-xl font-bold focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Anterior: R$ ",le.preco_venda_atual.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Ã°Å¸â€œË† Margem de Lucro"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.1",value:Oe.margem,onChange:Ke=>ye(le.produto_id,parseFloat(Ke.target.value)||0,le.custo_novo),className:"w-full pr-10 pl-3 py-3 border-2 border-gray-300 rounded-lg text-xl font-bold focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:"%"})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"Com o novo custo"})]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-purple-800 mb-3",children:"Ã°Å¸â€œÅ  AnÃƒÂ¡lise Comparativa (Valores Anteriores)"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Ã°Å¸â€™Âµ Custo Anterior"}),e.jsxs("div",{className:"text-lg font-bold text-gray-700",children:["R$ ",(le.custo_anterior||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Ã°Å¸â€™Â° PreÃƒÂ§o Anterior"}),e.jsxs("div",{className:"text-lg font-bold text-blue-700",children:["R$ ",(le.preco_venda_atual||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Ã°Å¸â€œË† Margem Anterior"}),e.jsxs("div",{className:"text-lg font-bold text-purple-700",children:[(le.margem_atual||0).toFixed(1),"%"]})]})]})]})]})]},L.item_id)}).filter(Boolean)})}),e.jsxs("div",{className:"border-t border-gray-200 p-6 bg-gray-50 flex justify-between items-center",children:[e.jsx("button",{onClick:()=>{Q(!1),q(null)},className:"px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors",children:"Ã¢ÂÅ’ Cancelar"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Valor Total da Nota"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["R$ ",re.valor_total.toFixed(2)]})]}),e.jsx("button",{onClick:ra,disabled:g,className:"px-8 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-lg font-bold text-lg shadow-lg disabled:opacity-50 transition-all",children:g?"Ã¢ÂÂ³ Processando...":"Ã¢Å“â€¦ Confirmar e Processar Nota"})]})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Ã°Å¸â€œÅ  HistÃƒÂ³rico de AlteraÃƒÂ§ÃƒÂµes de PreÃƒÂ§os"}),$&&e.jsx("p",{className:"mt-2 text-purple-100",children:$.nome})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:te?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-purple-600"})}):_.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhuma alteraÃƒÂ§ÃƒÂ£o de preÃƒÂ§o registrada"})}):e.jsx("div",{className:"space-y-4",children:_.map(L=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:L.motivo==="nfe_entrada"?"Ã°Å¸â€œÂ¦":L.motivo==="nfe_revisao_precos"?"Ã°Å¸â€™Â°":L.motivo==="manual"?"Ã¢Å“ÂÃ¯Â¸Â":"Ã°Å¸â€œÂ"}),e.jsx("span",{className:"font-semibold text-gray-800",children:L.motivo==="nfe_entrada"?"Entrada NF-e":L.motivo==="nfe_revisao_precos"?"RevisÃƒÂ£o de PreÃƒÂ§os":L.motivo==="manual"?"Ajuste Manual":L.motivo})]}),L.referencia&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:L.referencia}),L.nota_numero&&e.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["Nota: ",L.nota_numero]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-500",children:[new Date(L.data).toLocaleString("pt-BR"),L.usuario&&e.jsx("div",{className:"text-xs mt-1",children:L.usuario})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[L.preco_custo_anterior!==null&&L.preco_custo_novo!==null&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 font-semibold mb-2",children:"Ã°Å¸â€™Âµ CUSTO"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Anterior"}),e.jsxs("div",{className:"text-lg font-bold",children:["R$ ",L.preco_custo_anterior.toFixed(2)]})]}),e.jsx("div",{className:"text-2xl",children:"Ã¢â€ â€™"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Novo"}),e.jsxs("div",{className:"text-lg font-bold text-blue-700",children:["R$ ",L.preco_custo_novo.toFixed(2)]})]})]}),L.variacao_custo_percentual!==null&&L.variacao_custo_percentual!==0&&e.jsxs("div",{className:`mt-2 text-sm font-semibold text-center ${L.variacao_custo_percentual>0?"text-red-600":"text-green-600"}`,children:[L.variacao_custo_percentual>0?"Ã¢â€ â€˜":"Ã¢â€ â€œ"," ",Math.abs(L.variacao_custo_percentual).toFixed(2),"%"]})]}),L.preco_venda_anterior!==null&&L.preco_venda_novo!==null&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 font-semibold mb-2",children:"Ã°Å¸â€™Â² PREÃƒâ€¡O DE VENDA"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Anterior"}),e.jsxs("div",{className:"text-lg font-bold",children:["R$ ",L.preco_venda_anterior.toFixed(2)]})]}),e.jsx("div",{className:"text-2xl",children:"Ã¢â€ â€™"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Novo"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",L.preco_venda_novo.toFixed(2)]})]})]}),L.variacao_venda_percentual!==null&&L.variacao_venda_percentual!==0&&e.jsxs("div",{className:`mt-2 text-sm font-semibold text-center ${L.variacao_venda_percentual>0?"text-green-600":"text-red-600"}`,children:[L.variacao_venda_percentual>0?"Ã¢â€ â€˜":"Ã¢â€ â€œ"," ",Math.abs(L.variacao_venda_percentual).toFixed(2),"%"]})]})]}),L.margem_anterior!==null&&L.margem_nova!==null&&e.jsxs("div",{className:"mt-3 bg-purple-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 font-semibold mb-2",children:"Ã°Å¸â€œË† MARGEM DE LUCRO"}),e.jsxs("div",{className:"flex items-center justify-around",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Anterior"}),e.jsxs("div",{className:"text-xl font-bold",children:[L.margem_anterior.toFixed(1),"%"]})]}),e.jsx("div",{className:"text-2xl",children:"Ã¢â€ â€™"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Nova"}),e.jsxs("div",{className:"text-xl font-bold text-purple-700",children:[L.margem_nova.toFixed(1),"%"]})]})]})]}),L.observacoes&&e.jsx("div",{className:"mt-3 text-sm text-gray-600 italic bg-gray-50 rounded p-2",children:L.observacoes})]},L.id))})}),e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsx("button",{onClick:()=>{h(!1),E([]),K(null)},className:"w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors",children:"Fechar"})})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white p-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Ã°Å¸â€œÂ¦ Resultado do Processamento em Lote"}),u&&e.jsxs("p",{className:"mt-2",children:[u.sucessos," sucesso(s) | ",u.erros," erro(s) | Total: ",u.total_arquivos]})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1",children:[c&&!u&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-green-600 mb-4"}),e.jsx("p",{className:"text-lg text-gray-600",children:"Processando arquivos..."})]}),u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-100 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:u.total_arquivos}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:u.sucessos}),e.jsx("div",{className:"text-sm text-gray-600",children:"Sucessos"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:u.erros}),e.jsx("div",{className:"text-sm text-gray-600",children:"Erros"})]})]}),e.jsx("div",{className:"space-y-3",children:u.resultados.map((L,le)=>{var pe;return e.jsx("div",{className:`border rounded-lg p-4 ${L.sucesso?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:L.sucesso?"Ã¢Å“â€¦":"Ã¢ÂÅ’"}),e.jsx("span",{className:"font-semibold text-gray-800",children:L.arquivo})]}),L.sucesso?e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Nota:"})," ",L.numero_nota]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Fornecedor:"})," ",L.fornecedor]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Valor:"})," R$ ",(pe=L.valor_total)==null?void 0:pe.toFixed(2)]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Produtos:"})," ",L.produtos_vinculados," vinculados, ",L.produtos_nao_vinculados," nÃƒÂ£o vinculados"]})]}):e.jsx("p",{className:"text-sm text-red-700",children:L.mensagem})]}),e.jsxs("span",{className:"text-sm text-gray-500 ml-4",children:["#",L.ordem]})]})},le)})})]})]}),e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsx("button",{onClick:()=>{i(!1),n(null)},disabled:c,className:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold disabled:opacity-50 transition-colors",children:c?"Ã¢ÂÂ³ Processando...":"Fechar"})})]})})]})},Ni=({isOpen:s,onClose:l,onSuccess:t})=>{const[m,r]=a.useState(!1),[g,o]=a.useState(!1),[v,j]=a.useState({contas_pagar:[],contas_receber:[]}),[f,N]=a.useState({}),[d,x]=a.useState(new Set),[k,w]=a.useState("todos"),[c,b]=a.useState(!1),[p,i]=a.useState([]),[u,n]=a.useState({});a.useEffect(()=>{s&&(h(),C())},[s]);const C=async()=>{try{const R=await F.get("/dre/subcategorias");i(R.data)}catch(R){console.error("Erro ao carregar categorias DRE:",R)}},h=async()=>{r(!0);try{const R=await F.get("/dre/classificar/pendentes",{params:{limit:100}});j(R.data),await _(R.data),ce.success(`${R.data.total_pendentes} lanÃ§amentos pendentes encontrados`)}catch(R){console.error("Erro ao carregar pendentes:",R),ce.error("Erro ao carregar lanÃ§amentos pendentes")}finally{r(!1)}},_=async R=>{const J={};for(const S of R.contas_pagar)try{const P=await F.post("/dre/classificar/sugerir",{tipo:"pagar",lancamento_id:S.id});J[`pagar_${S.id}`]=P.data}catch(P){console.error(`Erro ao buscar sugestÃµes para pagar #${S.id}:`,P),J[`pagar_${S.id}`]=[]}for(const S of R.contas_receber)try{const P=await F.post("/dre/classificar/sugerir",{tipo:"receber",lancamento_id:S.id});J[`receber_${S.id}`]=P.data}catch(P){console.error(`Erro ao buscar sugestÃµes para receber #${S.id}:`,P),J[`receber_${S.id}`]=[]}N(J)},E=async(R,J,S)=>{o(!0);try{await F.post("/dre/classificar/aplicar",{tipo:R,lancamento_id:J,dre_subcategoria_id:S.dre_subcategoria_id,canal:null,regra_id:S.regra_id,forma_classificacao:"sugestao_aceita"}),x(P=>new Set([...P,`${R}_${J}`])),ce.success(`âœ… Classificado: ${S.subcategoria_nome}`)}catch(P){console.error("Erro ao aplicar classificaÃ§Ã£o:",P),ce.error("Erro ao aplicar classificaÃ§Ã£o")}finally{o(!1)}},$=async()=>{b(!0);try{const R=await F.post("/dre/classificar/auto-classificar-pendentes",null,{params:{apenas_alta_confianca:!0}});ce.success(`ðŸ¤– Auto-classificaÃ§Ã£o concluÃ­da!
${R.data.total_classificado} de ${R.data.total_processado} lanÃ§amentos classificados`,{duration:5e3}),await h(),t&&t()}catch(R){console.error("Erro ao auto-classificar:",R),ce.error("Erro ao executar auto-classificaÃ§Ã£o")}finally{b(!1)}},K=async(R,J,S)=>{if(!S){ce.error("Selecione uma categoria DRE");return}o(!0);try{const P=p.find(G=>G.id===parseInt(S));await F.post("/dre/classificar/aplicar",{tipo:R,lancamento_id:J,dre_subcategoria_id:parseInt(S),canal:null,regra_id:null,forma_classificacao:"manual"}),x(G=>new Set([...G,`${R}_${J}`])),n(G=>{const B={...G};return delete B[`${R}_${J}`],B}),ce.success(`âœ… Classificado manualmente: ${(P==null?void 0:P.nome)||"Categoria"}`)}catch(P){console.error("Erro ao aplicar classificaÃ§Ã£o manual:",P),ce.error("Erro ao aplicar classificaÃ§Ã£o manual")}finally{o(!1)}},te=async(R,J)=>{o(!0);try{x(S=>new Set([...S,`${R}_${J}`])),ce.success('ðŸ“¦ Marcado como "NÃ£o Controla DRE" (Estoque/Produtos)')}catch(S){console.error("Erro ao marcar como nÃ£o-DRE:",S),ce.error("Erro ao processar")}finally{o(!1)}},M=async(R,J,S,P,G)=>{if(!S){ce.error("LanÃ§amento sem fornecedor/cliente vinculado");return}const B=P||G;if(!B){ce.error("ID do fornecedor/cliente nÃ£o encontrado");return}if(window.confirm(`Deseja marcar "${S}" como fornecedor de produtos (NÃ£o Controla DRE)?

Todos os lanÃ§amentos deste fornecedor serÃ£o automaticamente ignorados no DRE.`)){o(!0);try{await F.patch(`/clientes/${B}/controla-dre?controla_dre=false`),x(y=>new Set([...y,`${R}_${J}`])),ce.success(`âœ… Fornecedor "${S}" marcado como "NÃ£o Controla DRE"

Todos os lanÃ§amentos futuros serÃ£o ignorados automaticamente.`,{duration:6e3}),setTimeout(()=>h(),1e3)}catch(y){console.error("Erro ao marcar fornecedor:",y),ce.error("Erro ao marcar fornecedor como NÃ£o DRE")}finally{o(!1)}}},A=R=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(R||0),Q=R=>R?new Date(R).toLocaleDateString("pt-BR"):"-",re=R=>R>=90?"text-green-600 bg-green-100":R>=70?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100",Z=(k==="pagar"?v.contas_pagar.map(R=>({...R,tipo:"pagar"})):k==="receber"?v.contas_receber.map(R=>({...R,tipo:"receber"})):[...v.contas_pagar.map(R=>({...R,tipo:"pagar"})),...v.contas_receber.map(R=>({...R,tipo:"receber"}))]).filter(R=>!d.has(`${R.tipo}_${R.id}`));return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-t-lg",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold flex items-center gap-2",children:"ðŸ·ï¸ Classificar LanÃ§amentos Pendentes"}),e.jsxs("p",{className:"text-sm text-purple-100 mt-1",children:[Z.length," lanÃ§amentos aguardando classificaÃ§Ã£o DRE"]})]}),e.jsx("button",{onClick:l,className:"text-white hover:bg-white hover:bg-opacity-20 p-2 rounded-lg transition-colors",children:e.jsx(us,{size:24})})]}),e.jsxs("div",{className:"p-4 border-b bg-gray-50 flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>w("todos"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${k==="todos"?"bg-purple-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:["ðŸ“Š Todos (",v.contas_pagar.length+v.contas_receber.length,")"]}),e.jsxs("button",{onClick:()=>w("pagar"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${k==="pagar"?"bg-red-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:["ðŸ’¸ A Pagar (",v.contas_pagar.length,")"]}),e.jsxs("button",{onClick:()=>w("receber"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${k==="receber"?"bg-green-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:["ðŸ’° A Receber (",v.contas_receber.length,")"]})]}),e.jsx("button",{onClick:$,disabled:c||Z.length===0,className:"flex items-center gap-2 bg-gradient-to-r from-green-600 to-emerald-600 text-white px-6 py-2 rounded-lg font-medium hover:from-green-700 hover:to-emerald-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:c?e.jsxs(e.Fragment,{children:[e.jsx(to,{className:"animate-spin",size:20}),"Auto-Classificando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ft,{size:20}),"Auto-Classificar (Alta ConfianÃ§a)"]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:m?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(to,{className:"animate-spin text-purple-600",size:48})}):Z.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(ws,{size:64,className:"text-green-500 mb-4"}),e.jsx("p",{className:"text-xl font-semibold",children:"Nenhum lanÃ§amento pendente!"}),e.jsx("p",{className:"text-sm mt-2",children:"Todos os lanÃ§amentos foram classificados."})]}):e.jsx("div",{className:"space-y-4",children:Z.map(R=>{const J=`${R.tipo}_${R.id}`,S=f[J]||[];return S[0],e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white shadow-sm hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${R.tipo==="pagar"?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:R.tipo==="pagar"?"ðŸ’¸ A Pagar":"ðŸ’° A Receber"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["#",R.id]})]}),e.jsx("h3",{className:"font-semibold text-gray-800 text-lg mb-1",children:R.descricao}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[R.beneficiario&&e.jsxs("span",{className:"flex items-center gap-1",children:["ðŸ‘¤ ",R.beneficiario]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ga,{size:14}),A(R.valor)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(os,{size:14}),Q(R.data_vencimento)]}),R.tipo_documento&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs",children:R.tipo_documento})]})]})}),S.length===0?e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Na,{className:"text-yellow-600",size:20}),e.jsx("span",{className:"text-sm text-yellow-700 font-semibold",children:"Nenhuma sugestÃ£o automÃ¡tica. Classifique manualmente."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:u[J]||"",onChange:P=>n(G=>({...G,[J]:P.target.value})),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"",children:"Selecione uma categoria DRE..."}),p.map(P=>e.jsxs("option",{value:P.id,children:[P.categoria_nome," â†’ ",P.nome]},P.id))]}),e.jsxs("button",{onClick:()=>K(R.tipo,R.id,u[J]),disabled:g||!u[J],className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",children:[e.jsx(yt,{size:18}),"Classificar"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>te(R.tipo,R.id),disabled:g,className:"flex-1 flex items-center justify-center gap-2 bg-gray-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Marca apenas ESTE lanÃ§amento como NÃ£o DRE",children:"ðŸ“¦ Este LanÃ§amento"}),R.beneficiario&&e.jsxs("button",{onClick:()=>M(R.tipo,R.id,R.beneficiario,R.fornecedor_id,R.cliente_id),disabled:g,className:"flex-1 flex items-center justify-center gap-2 bg-orange-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:`Marca TODOS os lanÃ§amentos de ${R.beneficiario} como NÃ£o DRE`,children:['ðŸª Todo Fornecedor "',R.beneficiario,'"']})]})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase mb-2",children:"ðŸ¤– SugestÃµes de ClassificaÃ§Ã£o:"}),S.slice(0,3).map((P,G)=>e.jsxs("div",{className:`flex justify-between items-center p-3 rounded-lg border-2 ${G===0?"border-purple-300 bg-purple-50":"border-gray-200 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:P.subcategoria_nome}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${re(P.confianca)}`,children:[P.confianca,"% confianÃ§a"]}),G===0&&e.jsx("span",{className:"px-2 py-1 bg-purple-600 text-white rounded-full text-xs font-bold",children:"â­ Melhor"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:P.motivo}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Regra: ",P.regra_nome]})]}),e.jsxs("button",{onClick:()=>E(R.tipo,R.id,P),disabled:g,className:"ml-4 flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(yt,{size:18}),"Aceitar"]})]},G))]})]},J)})})}),e.jsxs("div",{className:"p-4 border-t bg-gray-50 flex justify-between items-center rounded-b-lg",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:d.size})," classificados nesta sessÃ£o"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{d.size>0&&t&&t(),l()},className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors",children:"Fechar"}),d.size>0&&e.jsx("button",{onClick:h,className:"px-6 py-2 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition-colors",children:"Atualizar Lista"})]})]})]})}):null},ho=()=>{const s=fa(),[l,t]=a.useState(!0),[m,r]=a.useState(30),[g,o]=a.useState(!1),[v,j]=a.useState({saldo_atual:0,contas_receber:{total:0,vencidas:0},contas_pagar:{total:0,vencidas:0},vendas_periodo:{quantidade:0,valor_total:0,finalizadas:0,ticket_medio:0},fluxo_periodo:{entradas:0,saidas:0,lucro:0}}),[f,N]=a.useState([]),[d,x]=a.useState({contas_receber:[],contas_pagar:[]}),k=i=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i||0),w=i=>new Date(i).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}),c=async()=>{t(!0);try{const i=await F.get(`/dashboard/resumo?periodo_dias=${m}`);j(i.data)}catch(i){console.error("Erro ao carregar resumo:",i)}try{const i=await F.get(`/dashboard/entradas-saidas?periodo_dias=${m}`);N(i.data)}catch(i){console.error("Erro ao carregar entradas/saÃ­das:",i)}try{const i=await F.get("/dashboard/contas-vencidas?limite=5");x(i.data)}catch(i){console.error("Erro ao carregar contas vencidas:",i)}t(!1)};if(a.useEffect(()=>{c()},[m]),l)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500"})});const b=[{nome:"Loja FÃ­sica",valor:v.vendas_periodo.valor_total||0,margem:35.5,lucro:(v.vendas_periodo.valor_total||0)*.355,icon:Nl,color:"blue",isMock:!1,onClick:()=>s("/financeiro/relatorio-vendas")},{nome:"Mercado Livre",valor:8450,margem:18.2,lucro:1537.9,icon:Za,color:"yellow",isMock:!0,onClick:()=>ce("IntegraÃ§Ã£o com Mercado Livre em breve",{icon:"ðŸ“¦"})},{nome:"Shopee",valor:5230,margem:22.5,lucro:1176.75,icon:er,color:"orange",isMock:!0,onClick:()=>ce("IntegraÃ§Ã£o com Shopee em breve",{icon:"ðŸ›’"})},{nome:"Amazon",valor:12890,margem:15.8,lucro:2036.62,icon:Za,color:"purple",isMock:!0,onClick:()=>ce("IntegraÃ§Ã£o com Amazon em breve",{icon:"ðŸ“¦"})}],p=i=>{const u={blue:"from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700",green:"from-green-500 to-green-600 hover:from-green-600 hover:to-green-700",red:"from-red-500 to-red-600 hover:from-red-600 hover:to-red-700",purple:"from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700",yellow:"from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700",orange:"from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700"};return u[i]||u.blue};return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Dashboard Gerencial"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"VisÃ£o consolidada do seu negÃ³cio"})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white px-5 py-2.5 rounded-lg font-medium hover:from-purple-700 hover:to-blue-700 transition-all shadow-lg hover:shadow-xl transform hover:scale-105",children:[e.jsx("span",{className:"text-xl",children:"ðŸ·ï¸"}),"Classificar DRE"]}),e.jsx("div",{className:"flex gap-2",children:[7,15,30,60,90].map(i=>e.jsxs("button",{onClick:()=>r(i),className:`px-4 py-2 rounded-lg font-medium transition-colors ${m===i?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:[i," dias"]},i))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs("div",{onClick:()=>s("/financeiro/fluxo-caixa"),className:`bg-gradient-to-br ${p("blue")} rounded-xl p-6 text-white shadow-lg cursor-pointer transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-lg",children:e.jsx(La,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-xs font-medium bg-white/20 px-2 py-1 rounded",children:"Atual"})]}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"Saldo Atual"}),e.jsx("p",{className:"text-2xl font-bold",children:k(v.saldo_atual)}),e.jsx("p",{className:"text-xs mt-2 opacity-75",children:"Clique para ver fluxo de caixa"})]}),e.jsxs("div",{onClick:()=>s("/financeiro/contas-receber"),className:`bg-gradient-to-br ${p("green")} rounded-xl p-6 text-white shadow-lg cursor-pointer transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-lg",children:e.jsx(Aa,{className:"w-6 h-6"})}),v.contas_receber.vencidas>0&&e.jsx(da,{className:"w-5 h-5 text-yellow-300"})]}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"A Receber"}),e.jsx("p",{className:"text-2xl font-bold",children:k(v.contas_receber.total)}),v.contas_receber.vencidas>0?e.jsxs("p",{className:"text-xs mt-2 opacity-90",children:["âš ï¸ Vencidas: ",k(v.contas_receber.vencidas)]}):e.jsx("p",{className:"text-xs mt-2 opacity-75",children:"Clique para gerenciar"})]}),e.jsxs("div",{onClick:()=>s("/financeiro/contas-pagar"),className:`bg-gradient-to-br ${p("red")} rounded-xl p-6 text-white shadow-lg cursor-pointer transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-lg",children:e.jsx(Va,{className:"w-6 h-6"})}),v.contas_pagar.vencidas>0&&e.jsx(da,{className:"w-5 h-5 text-yellow-300"})]}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"A Pagar"}),e.jsx("p",{className:"text-2xl font-bold",children:k(v.contas_pagar.total)}),v.contas_pagar.vencidas>0?e.jsxs("p",{className:"text-xs mt-2 opacity-90",children:["âš ï¸ Vencidas: ",k(v.contas_pagar.vencidas)]}):e.jsx("p",{className:"text-xs mt-2 opacity-75",children:"Clique para gerenciar"})]}),e.jsxs("div",{onClick:()=>s("/financeiro/dre"),className:`bg-gradient-to-br ${v.fluxo_periodo.lucro>=0?p("purple"):p("orange")} rounded-xl p-6 text-white shadow-lg cursor-pointer transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-lg",children:e.jsx(Xa,{className:"w-6 h-6"})}),e.jsxs("span",{className:"text-xs font-medium bg-white/20 px-2 py-1 rounded",children:[m," dias"]})]}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:v.fluxo_periodo.lucro>=0?"Lucro":"PrejuÃ­zo"}),e.jsx("p",{className:"text-2xl font-bold",children:k(Math.abs(v.fluxo_periodo.lucro))}),e.jsx("p",{className:"text-xs mt-2 opacity-75",children:"Clique para ver DRE completo"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Vendas por Canal"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Performance de cada canal de vendas"})]}),e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full font-medium",children:"Marketplaces em preparaÃ§Ã£o"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:b.map((i,u)=>e.jsxs("div",{onClick:i.onClick,className:"bg-gray-50 rounded-lg p-5 border border-gray-200 hover:shadow-md transition-all cursor-pointer transform hover:scale-105 relative",children:[i.isMock&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:"text-xs bg-gray-200 text-gray-600 px-2 py-0.5 rounded",children:"Mock"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`bg-gradient-to-br ${p(i.color)} p-3 rounded-lg`,children:e.jsx(i.icon,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"font-semibold text-gray-800",children:i.nome})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Valor Vendido"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:k(i.valor)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Margem"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-800",children:[i.margem,"%"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Lucro Est."}),e.jsx("p",{className:"text-sm font-semibold text-green-600",children:k(i.lucro)})]})]})]})]},u))}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Total consolidado:"})," ",k(b.reduce((i,u)=>i+u.valor,0))," "," | ",e.jsx("strong",{children:"Lucro total:"})," ",k(b.reduce((i,u)=>i+u.lucro,0))]})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl shadow-lg p-6 mb-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-lg",children:e.jsx(ms,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Insights Inteligentes"}),e.jsx("p",{className:"text-sm opacity-90",children:"Alertas e sugestÃµes automÃ¡ticas"})]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-6 text-center",children:[e.jsx(ms,{className:"w-12 h-12 mx-auto mb-3 opacity-75"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Em breve a IA mostrarÃ¡ aqui:"}),e.jsxs("div",{className:"mt-3 space-y-2 text-sm opacity-90",children:[e.jsx("p",{children:"â€¢ Problemas urgentes detectados"}),e.jsx("p",{children:"â€¢ Oportunidades de lucro identificadas"}),e.jsx("p",{children:"â€¢ AÃ§Ãµes recomendadas para hoje"})]}),e.jsx("p",{className:"text-xs mt-4 opacity-75",children:"Sem mÃ¡gica. Apenas anÃ¡lise inteligente dos seus dados reais."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>s("/pdv"),className:"bg-gradient-to-br from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all transform hover:scale-105 flex items-center justify-center gap-3",children:[e.jsx(er,{className:"w-5 h-5"}),"Nova Venda"]}),e.jsxs("button",{onClick:()=>s("/financeiro/contas-receber"),className:"bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all transform hover:scale-105 flex items-center justify-center gap-3",children:[e.jsx(Aa,{className:"w-5 h-5"}),"Registrar Recebimento"]}),e.jsxs("button",{onClick:()=>s("/financeiro/contas-pagar"),className:"bg-gradient-to-br from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all transform hover:scale-105 flex items-center justify-center gap-3",children:[e.jsx(Va,{className:"w-5 h-5"}),"Registrar Despesa"]}),e.jsxs("button",{onClick:()=>s("/ia/fluxo-caixa"),className:"bg-gradient-to-br from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all transform hover:scale-105 flex items-center justify-center gap-3",children:[e.jsx(ms,{className:"w-5 h-5"}),"RevisÃµes IA"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg mb-6",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-4",children:["Fluxo Financeiro (",m," dias)"]}),e.jsx(Ma,{width:"100%",height:300,children:e.jsxs(it,{data:f,children:[e.jsx(Oa,{strokeDasharray:"3 3"}),e.jsx(Ba,{dataKey:"data",tickFormatter:w,style:{fontSize:"12px"}}),e.jsx(Ia,{tickFormatter:i=>`R$ ${(i/1e3).toFixed(0)}k`,style:{fontSize:"12px"}}),e.jsx(Pa,{formatter:i=>k(i),labelFormatter:w}),e.jsx(Ta,{}),e.jsx(ls,{type:"monotone",dataKey:"entradas",stroke:"#10B981",strokeWidth:2,name:"Entradas"}),e.jsx(ls,{type:"monotone",dataKey:"saidas",stroke:"#EF4444",strokeWidth:2,name:"SaÃ­das"})]})})]}),(d.contas_receber.length>0||d.contas_pagar.length>0)&&e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(da,{className:"w-5 h-5 text-red-500"}),"AtenÃ§Ã£o: Contas Vencidas"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[d.contas_receber.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:["A Receber (",d.contas_receber.length,")"]}),e.jsx("div",{className:"space-y-2",children:d.contas_receber.slice(0,3).map(i=>e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:i.cliente||"Sem cliente"}),e.jsx("p",{className:"font-bold text-red-600 text-sm",children:k(i.saldo)})]}),e.jsxs("p",{className:"text-xs text-red-600",children:["Venceu hÃ¡ ",i.dias_vencido," dias"]})]},i.id))})]}),d.contas_pagar.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:["A Pagar (",d.contas_pagar.length,")"]}),e.jsx("div",{className:"space-y-2",children:d.contas_pagar.slice(0,3).map(i=>e.jsxs("div",{className:"p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:i.fornecedor||"Sem fornecedor"}),e.jsx("p",{className:"font-bold text-orange-600 text-sm",children:k(i.saldo)})]}),e.jsxs("p",{className:"text-xs text-orange-600",children:["Venceu hÃ¡ ",i.dias_vencido," dias"]})]},i.id))})]})]})]}),e.jsx(Ni,{isOpen:g,onClose:()=>o(!1)})]})},Qs=[{value:"banco",label:"Banco",icon:Lo,cor_padrao:"#dc2626"},{value:"caixa",label:"Caixa FÃ­sico",icon:lt,cor_padrao:"#16a34a"},{value:"digital",label:"Carteira Digital",icon:ot,cor_padrao:"#2563eb"}],_i=["ðŸ¦","ðŸ’°","ðŸ’³","ðŸ’µ","ðŸ’¸","ðŸ§","ðŸª™","ðŸ’´","ðŸ’¶","ðŸ’·","ðŸ¤‘","ðŸ’²","ðŸ”’","ðŸ¦","ðŸª","ðŸ¢","ðŸ­","ðŸŽ¯","ðŸ“Š","ðŸ“ˆ","ðŸ’¼","ðŸ‘›","ðŸŽ","âš¡"];function wi(){const[s,l]=a.useState([]),[t,m]=a.useState(!0),[r,g]=a.useState(!1),[o,v]=a.useState(null),[j,f]=a.useState(""),[N,d]=a.useState({nome:"",tipo:"banco",banco:"",saldo_inicial:0,cor:"#dc2626",icone:"ðŸ¦",instituicao_bancaria:!1,ativa:!0});a.useEffect(()=>{x()},[]);const x=async()=>{try{m(!0);const b=await F.get("/contas-bancarias");l(b.data)}catch(b){console.error("Erro:",b),f("Erro ao carregar contas bancÃ¡rias")}finally{m(!1)}},k=(b=null)=>{if(b)d({nome:b.nome,tipo:b.tipo,banco:b.banco||"",saldo_inicial:b.saldo_inicial,cor:b.cor||"#dc2626",icone:b.icone||"ðŸ¦",instituicao_bancaria:b.instituicao_bancaria||!1,ativa:b.ativa}),v(b);else{const p=Qs[0];d({nome:"",tipo:"banco",banco:"",saldo_inicial:0,cor:p.cor_padrao,icone:"ðŸ¦",instituicao_bancaria:!1,ativa:!0}),v(null)}g(!0),f("")},w=async b=>{var p,i,u;b.preventDefault();try{const n={nome:N.nome.trim(),tipo:N.tipo,banco:((p=N.banco)==null?void 0:p.trim())||null,saldo_inicial:Number(N.saldo_inicial)||0,cor:N.cor,icone:N.icone||"ðŸ¦",instituicao_bancaria:!!N.instituicao_bancaria,ativa:!!N.ativa};console.log("Enviando dados:",n),o?await F.put(`/contas-bancarias/${o.id}`,n):await F.post("/contas-bancarias",n),await x(),g(!1),f("")}catch(n){console.error("Erro completo:",n),console.error("Response:",n.response),f(((u=(i=n.response)==null?void 0:i.data)==null?void 0:u.detail)||n.message||"Erro ao salvar conta")}},c=async b=>{var p,i;if(confirm("Deseja realmente excluir esta conta?"))try{await F.delete(`/contas-bancarias/${b}`),await x()}catch(u){console.error("Erro:",u),f(((i=(p=u.response)==null?void 0:p.data)==null?void 0:i.detail)||"Erro ao excluir conta")}};return t?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Cadastro de Bancos"}),e.jsx("p",{className:"text-gray-600",children:"Configure as contas bancÃ¡rias, caixas e carteiras digitais do sistema"})]}),e.jsxs("button",{onClick:()=>k(),className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",children:[e.jsx(rs,{className:"w-5 h-5"}),"Nova Conta"]})]})}),j&&e.jsxs("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-2",children:[e.jsx(da,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-red-800",children:j})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(b=>{var i,u,n;const p=((i=Qs.find(C=>C.value===b.tipo))==null?void 0:i.icon)||Lo;return e.jsxs("div",{className:`bg-white rounded-xl border-2 p-4 transition ${b.ativa?"border-gray-200 hover:border-blue-300":"border-gray-100 opacity-60"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-2xl",style:{backgroundColor:`${b.cor}20`},children:b.icone}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800",children:b.nome}),e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(p,{className:"w-3 h-3"}),(u=Qs.find(C=>C.value===b.tipo))==null?void 0:u.label]})]})]}),!b.ativa&&e.jsx("span",{className:"text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded",children:"Inativa"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Tipo de Conta"}),e.jsx("p",{className:"text-lg font-semibold text-gray-800",children:(n=Qs.find(C=>C.value===b.tipo))==null?void 0:n.label}),b.banco&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:b.banco})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k(b),className:"flex items-center justify-center bg-gray-100 text-gray-700 p-2 rounded-lg hover:bg-gray-200 transition",children:e.jsx(Sr,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>c(b.id),className:"flex items-center justify-center bg-red-50 text-red-600 p-2 rounded-lg hover:bg-red-100 transition",children:e.jsx(gs,{className:"w-4 h-4"})})]})]},b.id)})}),s.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(lt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"Nenhuma conta cadastrada"}),e.jsx("button",{onClick:()=>k(),className:"text-blue-600 hover:text-blue-700 font-medium",children:"Cadastrar primeira conta"})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:o?"Editar Conta":"Nova Conta"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(ma,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[j&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-red-800 text-sm",children:j}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{type:"text",value:N.nome,onChange:b=>d({...N,nome:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsx("select",{value:N.tipo,onChange:b=>{const p=Qs.find(i=>i.value===b.target.value);d({...N,tipo:b.target.value,cor:(p==null?void 0:p.cor_padrao)||N.cor})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:Qs.map(b=>e.jsx("option",{value:b.value,children:b.label},b.value))})]}),N.tipo==="banco"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Banco"}),e.jsx("input",{type:"text",value:N.banco,onChange:b=>d({...N,banco:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: Santander, Bradesco..."})]}),!o&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Saldo Inicial"}),e.jsx("input",{type:"number",step:"0.01",value:N.saldo_inicial,onChange:b=>d({...N,saldo_inicial:parseFloat(b.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor"}),e.jsx("input",{type:"color",value:N.cor,onChange:b=>d({...N,cor:b.target.value}),className:"w-full h-10 rounded-lg cursor-pointer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ãcone Atual"}),e.jsx("div",{className:"w-full h-10 border border-gray-300 rounded-lg flex items-center justify-center text-2xl bg-white",style:{backgroundColor:`${N.cor}10`},children:N.icone})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Escolher Ãcone"}),e.jsx("div",{className:"grid grid-cols-8 gap-2 p-3 bg-gray-50 rounded-lg border border-gray-200 max-h-32 overflow-y-auto",children:_i.map((b,p)=>e.jsx("button",{type:"button",onClick:()=>d({...N,icone:b}),className:`w-10 h-10 rounded-lg flex items-center justify-center text-xl transition hover:scale-110 ${N.icone===b?"bg-blue-100 border-2 border-blue-500 ring-2 ring-blue-200":"bg-white border border-gray-200 hover:border-blue-300"}`,children:b},p))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"instituicao_bancaria",checked:N.instituicao_bancaria,onChange:b=>d({...N,instituicao_bancaria:b.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"instituicao_bancaria",className:"text-sm text-gray-700",children:"ðŸ¦ InstituiÃ§Ã£o BancÃ¡ria (para conciliaÃ§Ã£o OFX)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"ativa",checked:N.ativa,onChange:b=>d({...N,ativa:b.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"ativa",className:"text-sm text-gray-700",children:"Conta ativa"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>g(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"flex-1 flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",children:[e.jsx(_t,{className:"w-4 h-4"}),"Salvar"]})]})]})]})})]})}const Ci=({isOpen:s,onClose:l,onSave:t})=>{const[m,r]=a.useState(!1),[g,o]=a.useState([]),[v,j]=a.useState([]),[f,N]=a.useState([]),[d,x]=a.useState([]),[k,w]=a.useState(30),[c,b]=a.useState(!1),[p,i]=a.useState({nome:"",tipo:"despesa",cor:"#ef4444",icone:"ðŸ’¸",descricao:"",ativo:!0,novasSubcategorias:[]}),[u,n]=a.useState({descricao:"",fornecedor_id:null,categoria_id:null,dre_subcategoria_id:null,valor_original:"",data_emissao:new Date().toISOString().split("T")[0],data_vencimento:new Date().toISOString().split("T")[0],documento:"",observacoes:"",eh_parcelado:!1,total_parcelas:1,eh_recorrente:!1,tipo_recorrencia:"mensal",intervalo_dias:null,data_inicio_recorrencia:null,data_fim_recorrencia:null,numero_repeticoes:null});a.useEffect(()=>{s&&C()},[s]);const C=async()=>{var q;try{const[Z,R,J]=await Promise.all([F.get("/clientes/?tipo_cadastro=fornecedor"),F.get("/categorias-financeiras/"),F.get("/dre/subcategorias")]);console.log("ðŸ“¦ Categorias recebidas:",R.data),o(Z.data);const S=R.data.filter(P=>{const G=P.tipo?P.tipo.toLowerCase():"",B=P.nome?P.nome.toLowerCase():"",y=G==="receita"||G==="entrada",O=B.includes("receita")||B.includes("venda");return!y&&!O});j(S),N(J.data||[]),console.log("âœ… Categorias de DESPESA setadas:",S.length),console.log("ðŸ“‹ Lista completa:",S),console.log("ðŸ“Š Subcategorias DRE carregadas:",(q=J.data)==null?void 0:q.length)}catch(Z){console.error("âŒ Erro ao carregar dados:",Z),ce.error("Erro ao carregar formulÃ¡rio")}},h=()=>{if(!u.eh_parcelado||!u.total_parcelas||!u.data_vencimento||!u.valor_original){x([]);return}const q=parseFloat(u.valor_original),Z=parseInt(u.total_parcelas),R=q/Z,J=[];let S=new Date(u.data_vencimento);for(let B=0;B<Z;B++){const y=new Date(S);y.setDate(S.getDate()+B*k),J.push({numero:B+1,valor:B===Z-1?q-R*(Z-1):R,data_vencimento:y.toISOString().split("T")[0]})}const P=J.reduce((B,y)=>B+y.valor,0),G=q-P;Math.abs(G)>.01&&(J[J.length-1].valor+=G),x(J)},_=()=>{i({...p,novasSubcategorias:[...p.novasSubcategorias,{nome:"",descricao:"",ativo:!0}]})},E=(q,Z,R)=>{const J=[...p.novasSubcategorias];J[q][Z]=R,i({...p,novasSubcategorias:J})},$=q=>{const Z=p.novasSubcategorias.filter((R,J)=>J!==q);i({...p,novasSubcategorias:Z})},K=(q,Z)=>{q.key==="Tab"&&!q.shiftKey&&Z===p.novasSubcategorias.length-1&&(q.preventDefault(),_())},te=async q=>{var Z,R;if(q.preventDefault(),!p.nome){ce.error("Preencha o nome da categoria");return}try{const S=(await F.post("/categorias-financeiras/",{nome:p.nome,tipo:p.tipo,cor:p.cor,icone:p.icone,descricao:p.descricao,ativo:p.ativo})).data.id;if(ce.success("Categoria criada com sucesso!"),p.novasSubcategorias.length>0){const P=p.novasSubcategorias.filter(G=>G.nome.trim());for(const G of P)try{await F.post("/subcategorias/",{categoria_id:S,nome:G.nome,descricao:G.descricao,ativo:G.ativo})}catch(B){console.error("Erro ao criar subcategoria:",B)}P.length>0&&ce.success(`${P.length} subcategoria(s) criada(s)!`)}await C(),n({...u,categoria_id:S}),b(!1),i({nome:"",tipo:"despesa",cor:"#ef4444",icone:"ðŸ’¸",descricao:"",ativo:!0,novasSubcategorias:[]})}catch(J){console.error("Erro ao salvar categoria:",J),ce.error(((R=(Z=J.response)==null?void 0:Z.data)==null?void 0:R.detail)||"Erro ao salvar categoria")}},M=(q,Z)=>{const R=[...d];R[q].data_vencimento=Z,x(R)},A=(q,Z)=>{const R=[...d];R[q].valor=parseFloat(Z)||0,x(R)},Q=async q=>{var Z,R;if(q.preventDefault(),!u.descricao||!u.valor_original||!u.data_vencimento){ce.error("Preencha todos os campos obrigatÃ³rios");return}r(!0);try{await F.post("/contas-pagar/",{...u,valor_original:parseFloat(u.valor_original),total_parcelas:u.eh_parcelado?parseInt(u.total_parcelas):1,intervalo_dias:u.tipo_recorrencia==="personalizado"?parseInt(u.intervalo_dias):null,numero_repeticoes:u.numero_repeticoes?parseInt(u.numero_repeticoes):null}),ce.success(u.eh_recorrente?"Conta recorrente criada com sucesso!":"Conta criada com sucesso!"),t(),l(),re()}catch(J){console.error("Erro ao criar conta:",J),ce.error(((R=(Z=J.response)==null?void 0:Z.data)==null?void 0:R.detail)||"Erro ao criar conta a pagar")}finally{r(!1)}},re=()=>{n({descricao:"",fornecedor_id:null,categoria_id:null,valor_original:"",data_emissao:new Date().toISOString().split("T")[0],data_vencimento:new Date().toISOString().split("T")[0],documento:"",observacoes:"",eh_parcelado:!1,total_parcelas:1,eh_recorrente:!1,tipo_recorrencia:"mensal",intervalo_dias:null,data_inicio_recorrencia:null,data_fim_recorrencia:null,numero_repeticoes:null})};return s?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full m-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b sticky top-0 bg-white",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(rs,{className:"text-red-600"}),"Nova Conta a Pagar"]}),e.jsx("button",{onClick:l,className:"text-gray-500 hover:text-gray-700",children:e.jsx(ma,{size:24})})]}),e.jsxs("form",{onSubmit:Q,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(Xa,{size:20,className:"text-blue-600"}),"InformaÃ§Ãµes BÃ¡sicas"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o *"}),e.jsx("input",{type:"text",value:u.descricao,onChange:q=>n({...u,descricao:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",placeholder:"Ex: Aluguel, Conta de luz, Fornecedor XYZ...",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(ar,{size:16,className:"inline mr-1"}),"Fornecedor"]}),e.jsxs("select",{value:u.fornecedor_id||"",onChange:q=>n({...u,fornecedor_id:q.target.value?parseInt(q.target.value):null}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),g.map(q=>e.jsx("option",{value:q.id,children:q.nome},q.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(_l,{size:16,className:"inline mr-1"}),"Categoria"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:u.categoria_id||"",onChange:q=>n({...u,categoria_id:q.target.value?parseInt(q.target.value):null}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),v.map(q=>e.jsx("option",{value:q.id,children:q.nome},q.id))]}),e.jsxs("button",{type:"button",onClick:()=>b(!0),className:"px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center gap-1 whitespace-nowrap",title:"Adicionar nova categoria",children:[e.jsx(rs,{size:16})," Adicionar"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ·ï¸ Subcategoria DRE (Demonstrativo de Resultado)"}),e.jsxs("select",{value:u.dre_subcategoria_id||"",onChange:q=>n({...u,dre_subcategoria_id:q.target.value?parseInt(q.target.value):null}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Sem classificaÃ§Ã£o DRE"}),f.map(q=>e.jsx("option",{value:q.id,children:q.nome},q.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Classifique para melhor anÃ¡lise gerencial"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(La,{size:16,className:"inline mr-1"}),"Valor *"]}),e.jsx("input",{type:"number",step:"0.01",value:u.valor_original,onChange:q=>n({...u,valor_original:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Cs,{size:16,className:"inline mr-1"}),"Data Vencimento *"]}),e.jsx("input",{type:"date",value:u.data_vencimento,onChange:q=>n({...u,data_vencimento:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Documento/NF"}),e.jsx("input",{type:"text",value:u.documento,onChange:q=>n({...u,documento:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",placeholder:"NÃºmero do documento"})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"eh_recorrente",checked:u.eh_recorrente,onChange:q=>n({...u,eh_recorrente:q.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsxs("label",{htmlFor:"eh_recorrente",className:"text-lg font-semibold text-gray-700 flex items-center gap-2 cursor-pointer",children:[e.jsx(wl,{size:20,className:"text-purple-600"}),"Despesa Recorrente"]})]}),u.eh_recorrente&&e.jsxs("div",{className:"ml-6 space-y-4 p-4 bg-purple-50 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de RecorrÃªncia *"}),e.jsxs("select",{value:u.tipo_recorrencia,onChange:q=>n({...u,tipo_recorrencia:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"semanal",children:"ðŸ“… Semanal (7 em 7 dias)"}),e.jsx("option",{value:"quinzenal",children:"ðŸ“† Quinzenal (15 em 15 dias)"}),e.jsx("option",{value:"mensal",children:"ðŸ—“ï¸ Mensal"}),e.jsx("option",{value:"personalizado",children:"âš™ï¸ Personalizado"})]})]}),u.tipo_recorrencia==="personalizado"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Intervalo (em dias) *"}),e.jsx("input",{type:"number",min:"1",value:u.intervalo_dias||"",onChange:q=>n({...u,intervalo_dias:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500",placeholder:"Ex: 10, 20, 45...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NÃºmero de RepetiÃ§Ãµes"}),e.jsx("input",{type:"number",min:"1",value:u.numero_repeticoes||"",onChange:q=>n({...u,numero_repeticoes:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500",placeholder:"Ex: 12 (deixe vazio para infinito)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Quantas vezes deve se repetir (opcional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de TÃ©rmino (alternativa)"}),e.jsx("input",{type:"date",value:u.data_fim_recorrencia||"",onChange:q=>n({...u,data_fim_recorrencia:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"AtÃ© quando deve repetir (opcional)"})]})]}),e.jsx("div",{className:"bg-blue-100 border border-blue-300 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"ðŸ’¡ Como funciona:"})," Esta conta serÃ¡ criada agora e o sistema irÃ¡ gerar automaticamente novas contas nos prÃ³ximos perÃ­odos conforme a recorrÃªncia configurada."]})})]})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"eh_parcelado",checked:u.eh_parcelado,onChange:q=>{n({...u,eh_parcelado:q.target.checked}),q.target.checked||x([])},disabled:u.eh_recorrente,className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 disabled:opacity-50"}),e.jsx("label",{htmlFor:"eh_parcelado",className:"text-lg font-semibold text-gray-700 cursor-pointer",children:"ðŸ’³ Parcelar esta conta"})]}),u.eh_parcelado&&!u.eh_recorrente&&e.jsxs("div",{className:"ml-6 space-y-4 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NÃºmero de Parcelas *"}),e.jsx("input",{type:"number",min:"2",max:"120",value:u.total_parcelas,onChange:q=>n({...u,total_parcelas:q.target.value}),onBlur:h,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Intervalo (dias)"}),e.jsxs("select",{value:k,onChange:q=>{w(parseInt(q.target.value)),setTimeout(h,100)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"7",children:"7 dias (semanal)"}),e.jsx("option",{value:"14",children:"14 dias (quinzenal)"}),e.jsx("option",{value:"15",children:"15 dias"}),e.jsx("option",{value:"21",children:"21 dias"}),e.jsx("option",{value:"30",children:"30 dias (mensal)"}),e.jsx("option",{value:"60",children:"60 dias (bimestral)"}),e.jsx("option",{value:"90",children:"90 dias (trimestral)"})]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:h,className:"mt-6 w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"ðŸ“‹ Gerar Preview"})})]}),d.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-3",children:"ðŸ“… Preview das Parcelas"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:d.map((q,Z)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white rounded border",children:[e.jsxs("span",{className:"font-semibold text-gray-600 min-w-[80px]",children:["Parcela ",q.numero,"/",d.length]}),e.jsx("input",{type:"number",step:"0.01",value:q.valor,onChange:R=>A(Z,R.target.value),className:"w-32 px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Valor"}),e.jsx("input",{type:"date",value:q.data_vencimento,onChange:R=>M(Z,R.target.value),className:"flex-1 px-2 py-1 border border-gray-300 rounded text-sm"})]},Z))}),e.jsx("div",{className:"mt-3 p-2 bg-gray-100 rounded",children:e.jsxs("strong",{children:["Total: R$ ",d.reduce((q,Z)=>q+Z.valor,0).toFixed(2)]})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ObservaÃ§Ãµes"}),e.jsx("textarea",{value:u.observacoes,onChange:q=>n({...u,observacoes:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"InformaÃ§Ãµes adicionais..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{l(),re()},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:m,className:"px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50",children:m?"Salvando...":"Salvar Conta"})]})]})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Nova Categoria Financeira"}),e.jsx("button",{type:"button",onClick:()=>b(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(ma,{size:24})})]}),e.jsxs("form",{onSubmit:te,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Categoria *"}),e.jsx("input",{type:"text",value:p.nome,onChange:q=>i({...p,nome:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0,placeholder:"Ex: Fornecedores, Aluguel, SalÃ¡rios..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ãcone"}),e.jsx("select",{value:p.icone,onChange:q=>i({...p,icone:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:["ðŸ’¸","ðŸ ","âš¡","ðŸ’§","ðŸ‘¥","ðŸ“¦","ðŸ”§","ðŸš—","ðŸ½ï¸","ðŸ“","ðŸ›¡ï¸","ðŸ›’"].map(q=>e.jsx("option",{value:q,children:q},q))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor"}),e.jsx("input",{type:"color",value:p.cor,onChange:q=>i({...p,cor:q.target.value}),className:"w-full h-10 border border-gray-300 rounded-md"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:p.descricao,onChange:q=>i({...p,descricao:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",rows:"2"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subcategorias DRE (opcional)"}),e.jsxs("button",{type:"button",onClick:_,className:"text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[e.jsx(rs,{size:14})," Adicionar"]})]}),p.novasSubcategorias.length>0&&e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:p.novasSubcategorias.map((q,Z)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-md",children:[e.jsx("input",{type:"text",value:q.nome,onChange:R=>E(Z,"nome",R.target.value),onKeyDown:R=>K(R,Z),placeholder:"Nome (Tab para adicionar mais)",className:"flex-1 px-2 py-1 border border-gray-300 rounded-md text-sm"}),e.jsx("button",{type:"button",onClick:()=>$(Z),className:"text-red-600 hover:text-red-800 p-1",children:e.jsx(ma,{size:16})})]},Z))}),p.novasSubcategorias.length===0&&e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Aperte Tab no Ãºltimo campo para adicionar mais subcategorias"})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Criar Categoria"})]})]})]})})]}):null},_a=s=>Array.isArray(s)?s:[],ki=()=>{var B;const s=fa(),[l,t]=a.useState([]),[m,r]=a.useState(!0),[g,o]=a.useState({status:"todos",fornecedor_id:null,data_inicio:"",data_fim:"",apenas_vencidas:!1,apenas_vencer:!1,numero_nf:""}),[v,j]=a.useState([]),[f,N]=a.useState(null),[d,x]=a.useState(!1),[k,w]=a.useState(!1),[c,b]=a.useState(!1),[p,i]=a.useState([]),[u,n]=a.useState([]),[C,h]=a.useState(!1),[_,E]=a.useState({nome:"",tipo:"dinheiro",conta_bancaria_destino_id:null}),[$,K]=a.useState({valor_pago:0,data_pagamento:new Date().toISOString().split("T")[0],forma_pagamento_id:"",conta_bancaria_id:"",valor_juros:0,valor_multa:0,valor_desconto:0,observacoes:""});a.useEffect(()=>{te()},[]);const te=async()=>{try{const[y,O,z,ae]=await Promise.all([F.get(`/contas-pagar/?_t=${Date.now()}`),F.get("/clientes/?tipo_cadastro=fornecedor"),F.get("/financeiro/formas-pagamento/"),F.get("/contas-bancarias?apenas_ativas=true")]);t(_a(y.data)),j(_a(O.data)),i(_a(z.data)),n(_a(ae.data))}catch(y){console.error("Erro ao carregar dados:",y),ce.error("Erro ao carregar contas a pagar")}finally{r(!1)}},M=async()=>{try{r(!0);const y=new URLSearchParams;g.status!=="todos"&&y.append("status",g.status),g.fornecedor_id&&y.append("fornecedor_id",g.fornecedor_id),g.data_inicio&&y.append("data_inicio",g.data_inicio),g.data_fim&&y.append("data_fim",g.data_fim),g.apenas_vencidas&&y.append("apenas_vencidas","true"),g.apenas_vencer&&y.append("apenas_vencer","true"),g.numero_nf&&y.append("numero_nf",g.numero_nf);const O=await F.get(`/contas-pagar/?${y}`);t(O.data)}catch(y){console.error("Erro ao filtrar:",y),ce.error("Erro ao aplicar filtros")}finally{r(!1)}},A=y=>{N(y);const O=p.find(z=>z.id===y.forma_pagamento_id);K({valor_pago:y.valor_final-y.valor_pago,forma_pagamento_id:y.forma_pagamento_id||"",conta_bancaria_id:(O==null?void 0:O.conta_bancaria_destino_id)||"",valor_juros:0,valor_multa:0,valor_desconto:0,observacoes:""}),x(!0)},Q=y=>{N(y),b(!0)},re=y=>{y.nota_entrada_id?s(`/compras?nota_id=${y.nota_entrada_id}`):y.nfe_numero?s(`/compras?numero=${y.nfe_numero}`):ce.error("Nota fiscal nÃ£o encontrada")},q=y=>{const O=new URLSearchParams;y.fornecedor_nome&&O.append("busca",y.fornecedor_nome),y.documento&&O.append("documento",y.documento),s(`/financeiro/fluxo-caixa?${O.toString()}`),ce.success("Redirecionando para o Fluxo de Caixa...")},Z=y=>{const O=p.find(z=>z.id===parseInt(y));K({...$,forma_pagamento_id:parseInt(y)||"",conta_bancaria_id:(O==null?void 0:O.conta_bancaria_destino_id)||$.conta_bancaria_id||""})},R=async()=>{try{await F.post("/financeiro/formas-pagamento",{..._,taxa_percentual:0,taxa_fixa:0,prazo_dias:0,ativo:!0,permite_parcelamento:!1,parcelas_maximas:1}),ce.success("Forma de pagamento criada!"),h(!1),E({nome:"",tipo:"dinheiro",conta_bancaria_destino_id:null}),te()}catch(y){console.error("Erro:",y),ce.error("Erro ao criar forma de pagamento")}},J=async()=>{var y,O;try{await F.post(`/contas-pagar/${f.id}/pagar`,$),ce.success("Pagamento registrado com sucesso!"),x(!1),te()}catch(z){console.error("Erro ao registrar pagamento:",z),ce.error(((O=(y=z.response)==null?void 0:y.data)==null?void 0:O.detail)||"Erro ao registrar pagamento")}},S=y=>{if(!y)return"-";const O=y.split("T")[0].split("-");return new Date(parseInt(O[0]),parseInt(O[1])-1,parseInt(O[2])).toLocaleDateString("pt-BR")},P=y=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(y),G=y=>{const O=new Date,z=new Date(y.data_vencimento);return y.status==="pago"?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-green-100 text-green-800",children:"âœ“ Pago"}):z<O?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-red-100 text-red-800",children:"âš  Vencida"}):y.status==="parcial"?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-yellow-100 text-yellow-800",children:"âš¡ Parcial"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-blue-100 text-blue-800",children:"â± Pendente"})};return m?e.jsx("div",{className:"text-center p-8",children:"Carregando contas a pagar..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"ðŸ’° Contas a Pagar"}),e.jsx("button",{onClick:()=>w(!0),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg",children:"âž• Nova Conta"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:[e.jsx("h5",{className:"text-lg font-semibold mb-4",children:"ðŸ” Filtros"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:g.status,onChange:y=>o({...g,status:y.target.value}),children:[e.jsx("option",{value:"todos",children:"Todos"}),e.jsx("option",{value:"pendente",children:"Pendente"}),e.jsx("option",{value:"parcial",children:"Parcial"}),e.jsx("option",{value:"pago",children:"Pago"}),e.jsx("option",{value:"vencido",children:"Vencido"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fornecedor"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:g.fornecedor_id||"",onChange:y=>o({...g,fornecedor_id:y.target.value||null}),children:[e.jsx("option",{value:"",children:"Todos"}),_a(v).map(y=>e.jsx("option",{value:y.id,children:y.nome},y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"NÃºmero NF"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",placeholder:"Ex: 12345",value:g.numero_nf,onChange:y=>o({...g,numero_nf:y.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:g.data_inicio,onChange:y=>o({...g,data_inicio:y.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:g.data_fim,onChange:y=>o({...g,data_fim:y.target.value})})]}),e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:g.apenas_vencidas,onChange:y=>o({...g,apenas_vencidas:y.target.checked,apenas_vencer:!1})}),e.jsx("span",{className:"text-sm",children:"SÃ³ Vencidas"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:g.apenas_vencer,onChange:y=>o({...g,apenas_vencer:y.target.checked,apenas_vencidas:!1})}),e.jsx("span",{className:"text-sm",children:"A Vencer"})]}),e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm",onClick:M,children:"Filtrar"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"DescriÃ§Ã£o"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Fornecedor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Vencimento"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Valor Original"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Valor Pago"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Saldo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"px-4 py-8 text-center text-gray-500",children:"Nenhuma conta encontrada"})}):_a(l).map(y=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:y.id}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[y.descricao,y.eh_parcelado&&e.jsxs("span",{className:"ml-2 px-2 py-1 text-xs rounded bg-gray-100 text-gray-700",children:[y.numero_parcela,"/",y.total_parcelas]})]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:y.fornecedor_nome||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:S(y.data_vencimento)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:P(y.valor_original)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:P(y.valor_pago)}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold",children:P(y.valor_final-y.valor_pago)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:G(y)}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[y.status!=="pago"&&e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>A(y),title:"Registrar Pagamento",children:"ðŸ’° Pagar"}),e.jsx("button",{className:"bg-blue-50 hover:bg-blue-100 text-blue-600 px-3 py-1 rounded text-xs",onClick:()=>Q(y),title:"Ver Detalhes",children:"ðŸ‘ï¸"})]})]},y.id))})]})}),l.length>0&&e.jsxs("div",{className:"bg-green-50 border-t border-green-200 px-4 py-3",children:[e.jsx("strong",{children:"Total:"})," ",l.length," conta(s) |",e.jsx("strong",{className:"ml-3",children:"Saldo a Pagar:"})," ",P(l.reduce((y,O)=>y+(O.valor_final-O.valor_pago),0))]})]}),d&&f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b p-4",children:[e.jsx("h5",{className:"text-xl font-bold",children:"ðŸ’° Registrar Pagamento"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 text-2xl",onClick:()=>x(!1),children:"Ã—"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mb-4 text-sm",children:[e.jsx("strong",{children:"Conta:"})," ",f.descricao,e.jsx("br",{}),e.jsx("strong",{children:"Valor Total:"})," ",P(f.valor_final),e.jsx("br",{}),e.jsx("strong",{children:"JÃ¡ Pago:"})," ",P(f.valor_pago),e.jsx("br",{}),e.jsx("strong",{children:"Saldo Restante:"})," ",P(f.valor_final-f.valor_pago)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Valor a Pagar *"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:$.valor_pago,onChange:y=>K({...$,valor_pago:parseFloat(y.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data do Pagamento *"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:$.data_pagamento,onChange:y=>K({...$,data_pagamento:y.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Forma de Pagamento"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"flex-1 border border-gray-300 rounded px-3 py-2",value:$.forma_pagamento_id||"",onChange:y=>Z(y.target.value),children:[e.jsx("option",{value:"",children:"Selecione..."}),_a(p).map(y=>e.jsxs("option",{value:y.id,children:[y.icone||"ðŸ’³"," ",y.nome]},y.id))]}),e.jsx("button",{type:"button",className:"px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:()=>h(!0),title:"Adicionar nova forma de pagamento",children:"+"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Conta BancÃ¡ria *",$.forma_pagamento_id&&((B=p.find(y=>y.id===$.forma_pagamento_id))==null?void 0:B.conta_bancaria_destino_id)&&e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(PadrÃ£o da forma selecionada)"})]}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:$.conta_bancaria_id||"",onChange:y=>K({...$,conta_bancaria_id:parseInt(y.target.value)||null}),children:[e.jsx("option",{value:"",children:"Selecione a conta..."}),_a(u).map(y=>e.jsxs("option",{value:y.id,children:[y.nome," - ",P(y.saldo_atual||0)]},y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Juros"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:$.valor_juros,onChange:y=>K({...$,valor_juros:parseFloat(y.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Multa"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:$.valor_multa,onChange:y=>K({...$,valor_multa:parseFloat(y.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Desconto"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:$.valor_desconto,onChange:y=>K({...$,valor_desconto:parseFloat(y.target.value)||0})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"ObservaÃ§Ãµes"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded px-3 py-2",rows:"3",value:$.observacoes,onChange:y=>K({...$,observacoes:y.target.value})})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded p-3 mt-4",children:[e.jsx("strong",{children:"Valor Final do Pagamento:"})," ",P(($.valor_pago||0)+($.valor_juros||0)+($.valor_multa||0)-($.valor_desconto||0))]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t p-4",children:[e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",onClick:()=>x(!1),children:"Cancelar"}),e.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:J,children:"âœ“ Confirmar Pagamento"})]})]})}),c&&f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-6 py-4 flex justify-between items-center sticky top-0",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Detalhes da Conta"}),e.jsx("button",{onClick:()=>b(!1),className:"text-white hover:bg-blue-700 px-3 py-1 rounded",children:"âœ•"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Parcela"}),e.jsx("p",{className:"mt-1 text-lg",children:f.numero_parcela&&f.total_parcelas?`${f.numero_parcela}/${f.total_parcelas}`:f.documento||"Ãšnica"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Fornecedor"}),e.jsx("p",{className:"mt-1 text-lg",children:f.fornecedor_nome||"N/A"})]})]}),f.nfe_numero&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nota Fiscal"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>re(f),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg border border-blue-200 transition-colors",children:[e.jsx("span",{className:"text-xl",children:"ðŸ“„"}),e.jsx("span",{className:"font-medium",children:f.nfe_numero})]}),e.jsxs("button",{onClick:()=>q(f),className:"flex items-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg border border-green-200 transition-colors",title:"Ver no Fluxo de Caixa",children:[e.jsx("span",{className:"text-xl",children:"ðŸ“ˆ"}),e.jsx("span",{className:"text-sm",children:"Fluxo"})]})]})]}),!f.nfe_numero&&e.jsx("div",{children:e.jsxs("button",{onClick:()=>q(f),className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg border border-green-200 transition-colors",children:[e.jsx("span",{className:"text-xl",children:"ðŸ“ˆ"}),e.jsx("span",{className:"font-medium",children:"Ver no Fluxo de Caixa"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Data de EmissÃ£o"}),e.jsx("p",{className:"mt-1",children:S(f.data_emissao)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Data de Vencimento"}),e.jsx("p",{className:"mt-1",children:S(f.data_vencimento)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor Original"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-blue-600",children:P(f.valor_final||f.valor_total||0)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor Pago"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-green-600",children:P(f.valor_pago||0)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Saldo Restante"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-red-600",children:P((f.valor_final||f.valor_total||0)-(f.valor_pago||0))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsx("p",{className:"mt-1",children:e.jsx("span",{className:`px-2 py-1 rounded text-sm ${f.status==="pago"?"bg-green-100 text-green-800":f.status==="parcial"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:f.status==="pago"?"Pago":f.status==="parcial"?"Parcial":"Pendente"})})]})]}),f.observacoes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"ObservaÃ§Ãµes"}),e.jsx("p",{className:"mt-1 text-gray-600",children:f.observacoes})]})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"bg-green-600 text-white px-6 py-4 flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Nova Forma de Pagamento"}),e.jsx("button",{onClick:()=>h(!1),className:"text-white hover:bg-green-700 px-3 py-1 rounded",children:"âœ•"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nome *"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",value:_.nome,onChange:y=>E({..._,nome:y.target.value}),placeholder:"Ex: PIX Santander, Dinheiro..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipo"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:_.tipo,onChange:y=>E({..._,tipo:y.target.value}),children:[e.jsx("option",{value:"dinheiro",children:"ðŸ’µ Dinheiro"}),e.jsx("option",{value:"pix",children:"ðŸ“± PIX"}),e.jsx("option",{value:"cartao_debito",children:"ðŸ’³ CartÃ£o DÃ©bito"}),e.jsx("option",{value:"cartao_credito",children:"ðŸ’³ CartÃ£o CrÃ©dito"}),e.jsx("option",{value:"transferencia",children:"ðŸ¦ TransferÃªncia"}),e.jsx("option",{value:"boleto",children:"ðŸ“„ Boleto"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Conta BancÃ¡ria PadrÃ£o"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:_.conta_bancaria_destino_id||"",onChange:y=>E({..._,conta_bancaria_destino_id:parseInt(y.target.value)||null}),children:[e.jsx("option",{value:"",children:"Nenhuma (selecionar manualmente)"}),_a(u).map(y=>e.jsx("option",{value:y.id,children:y.nome},y.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Esta conta serÃ¡ prÃ©-selecionada automaticamente ao usar esta forma"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t p-4",children:[e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",onClick:()=>h(!1),children:"Cancelar"}),e.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:R,children:"âœ“ Criar"})]})]})}),e.jsx(Ci,{isOpen:k,onClose:()=>w(!1),onSave:te})]})},Si=()=>{var B;const s=fa(),[l,t]=a.useState([]),[m,r]=a.useState(!0),[g,o]=a.useState({status:"todos",cliente_id:null,data_inicio:"",data_fim:"",apenas_vencidas:!1,apenas_vencer:!1}),[v,j]=a.useState(""),[f,N]=a.useState("desc"),[d,x]=a.useState([]),[k,w]=a.useState(null),[c,b]=a.useState(null),[p,i]=a.useState(!1),[u,n]=a.useState(!1),[C,h]=a.useState([]),[_,E]=a.useState([]),[$,K]=a.useState({valor_recebido:0,data_recebimento:new Date().toISOString().split("T")[0],forma_pagamento_id:null,conta_bancaria_id:null,valor_juros:0,valor_multa:0,valor_desconto:0,observacoes:""});a.useEffect(()=>{te()},[]),a.useEffect(()=>{if(v.trim().length>0){const y=setTimeout(()=>{M()},500);return()=>clearTimeout(y)}else v===""&&te()},[v]);const te=async()=>{try{const O={Authorization:`Bearer ${localStorage.getItem("access_token")||localStorage.getItem("token")}`},[z,ae,W,ne]=await Promise.all([F.get("/contas-receber/",{headers:O}),F.get("/clientes/",{headers:O}),F.get("/financeiro/formas-pagamento/",{headers:O}),F.get("/contas-bancarias?apenas_ativas=true",{headers:O})]);console.log("Ã°Å¸â€œÅ  Contas carregadas:",z.data.length,"contas"),console.log("Ã°Å¸â€œâ€¹ Status das contas:",_a(z.data).map(ee=>({id:ee.id,status:ee.status,descricao:ee.descricao}))),console.log("Ã°Å¸â€Â¢ Todas as vendas nos contas:",_a(z.data).map(ee=>ee.numero_venda).filter(ee=>ee)),console.log("Ã°Å¸Å½Â¯ Procurando venda 202601100007:",z.data.find(ee=>{var de;return ee.numero_venda==="202601100007"||((de=ee.descricao)==null?void 0:de.includes("202601100007"))})),console.log("Ã°Å¸â€œÂ¦ Antes de setContas:",z.data);const H=[..._a(z.data)].sort((ee,de)=>de.id-ee.id);t(H),console.log("Ã¢Å“â€¦ Contas setadas no estado"),x(_a(ae.data)),x(_a(ae.data)),h(_a(W.data)),E(_a(ne.data))}catch(y){console.error("Erro ao carregar dados:",y),ce.error("Erro ao carregar contas a receber")}finally{r(!1)}},M=async()=>{try{r(!0);const y=new URLSearchParams;g.status!=="todos"&&y.append("status",g.status),g.cliente_id&&y.append("cliente_id",g.cliente_id),g.data_inicio&&y.append("data_inicio",g.data_inicio),g.data_fim&&y.append("data_fim",g.data_fim),g.apenas_vencidas&&y.append("apenas_vencidas","true"),g.apenas_vencer&&y.append("apenas_vencer","true"),v&&y.append("numero_venda",v);const O=await F.get(`/contas-receber/?${y}`);t(O.data)}catch(y){console.error("Erro ao filtrar:",y),ce.error("Erro ao aplicar filtros")}finally{r(!1)}},A=y=>{sessionStorage.setItem("abrirVenda",y),sessionStorage.setItem("abrirModalPagamento","true"),ce.success("Redirecionando para o PDV..."),s("/pdv")},Q=y=>{const O=new URLSearchParams;y.cliente_nome&&O.append("busca",y.cliente_nome),y.documento&&O.append("documento",y.documento),s(`/financeiro/fluxo-caixa?${O.toString()}`),ce.success("Redirecionando para o Fluxo de Caixa...")},re=()=>{const y=f==="desc"?"asc":"desc";N(y);const O=[...l].sort((z,ae)=>y==="desc"?ae.id-z.id:z.id-ae.id);t(O),ce.success(y==="desc"?"Ã°Å¸â€œâ€¦ Ordenado: Mais recentes primeiro":"Ã°Å¸â€œâ€¦ Ordenado: Mais antigas primeiro")},q=y=>{w(y),K({valor_recebido:parseFloat((y.valor_final-y.valor_recebido).toFixed(2)),data_recebimento:new Date().toISOString().split("T")[0],forma_pagamento_id:y.forma_pagamento_id||null,conta_bancaria_id:null,valor_juros:0,valor_multa:0,valor_desconto:0,observacoes:""}),i(!0)},Z=async y=>{try{const O=await F.get(`/contas-receber/${y.id}`);w(y),b(O.data),n(!0)}catch(O){console.error("Erro ao carregar detalhes:",O),ce.error("Erro ao carregar detalhes da conta")}},R=y=>{s(`/pdv?venda=${y}`)},J=async()=>{var y,O;try{await F.post(`/contas-receber/${k.id}/receber`,$),ce.success("Recebimento registrado com sucesso!"),i(!1),te()}catch(z){console.error("Erro ao registrar recebimento:",z),ce.error(((O=(y=z.response)==null?void 0:y.data)==null?void 0:O.detail)||"Erro ao registrar recebimento")}},S=y=>{if(!y)return"-";const O=y.split("T")[0].split("-");return new Date(parseInt(O[0]),parseInt(O[1])-1,parseInt(O[2])).toLocaleDateString("pt-BR")},P=y=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(y),G=y=>{const O=new Date,z=new Date(y.data_vencimento);return y.status==="recebido"?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-green-100 text-green-800",children:"Ã¢Å“â€œ Recebido"}):z<O?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-red-100 text-red-800",children:"Ã¢Å¡Â  Vencida"}):y.status==="parcial"?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-yellow-100 text-yellow-800",children:"Ã¢Å¡Â¡ Parcial"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-blue-100 text-blue-800",children:"Ã¢ÂÂ± Pendente"})};return m?e.jsx("div",{className:"text-center p-8",children:"Carregando contas a receber..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Ã°Å¸â€™Âµ Contas a Receber"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:re,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2",title:f==="desc"?"Clique para ver mais antigas primeiro":"Clique para ver mais recentes primeiro",children:f==="desc"?"Ã°Å¸â€Â½ Mais Recentes":"Ã°Å¸â€Â¼ Mais Antigas"}),e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg",children:"Ã¢Å¾â€¢ Nova Conta"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:[e.jsx("h5",{className:"text-lg font-semibold mb-4",children:"Ã°Å¸â€Â Filtros"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ã°Å¸â€Â¢ Buscar por NÃƒÂºmero da Venda"}),e.jsx("input",{type:"text",placeholder:"Digite o nÃƒÂºmero da venda (ex: 202601100003) e pressione Enter",className:"w-full border border-gray-300 rounded px-3 py-2",value:v,onChange:y=>{const O=y.target.value.replace("#","");j(O)},onKeyPress:y=>{y.key==="Enter"&&M()}})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:g.status,onChange:y=>o({...g,status:y.target.value}),children:[e.jsx("option",{value:"todos",children:"Todos"}),e.jsx("option",{value:"pendente",children:"Pendente"}),e.jsx("option",{value:"parcial",children:"Parcial"}),e.jsx("option",{value:"recebido",children:"Recebido"}),e.jsx("option",{value:"vencido",children:"Vencido"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Cliente"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:g.cliente_id||"",onChange:y=>o({...g,cliente_id:y.target.value||null}),children:[e.jsx("option",{value:"",children:"Todos"}),_a(d).map(y=>e.jsx("option",{value:y.id,children:y.nome},y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data InÃƒÂ­cio"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:g.data_inicio,onChange:y=>o({...g,data_inicio:y.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:g.data_fim,onChange:y=>o({...g,data_fim:y.target.value})})]}),e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:g.apenas_vencidas,onChange:y=>o({...g,apenas_vencidas:y.target.checked,apenas_vencer:!1})}),e.jsx("span",{className:"text-sm",children:"SÃƒÂ³ Vencidas"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:g.apenas_vencer,onChange:y=>o({...g,apenas_vencer:y.target.checked,apenas_vencidas:!1})}),e.jsx("span",{className:"text-sm",children:"A Vencer"})]}),e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm",onClick:M,children:"Filtrar"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"DescriÃƒÂ§ÃƒÂ£o"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Vencimento"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Valor Original"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Valor Recebido"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Saldo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"AÃƒÂ§ÃƒÂµes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:_a(l).length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"px-4 py-8 text-center text-gray-500",children:"Nenhuma conta encontrada"})}):_a(l).filter(y=>{if(!v)return!0;const O=String(y.numero_venda||""),z=String(y.descricao||""),ae=v.toLowerCase();return O.toLowerCase().includes(ae)||z.toLowerCase().includes(ae)}).map(y=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:y.id}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[y.descricao,y.eh_parcelado&&e.jsxs("span",{className:"ml-2 px-2 py-1 text-xs rounded bg-gray-100 text-gray-700",children:[y.numero_parcela,"/",y.total_parcelas]})]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:y.cliente_nome||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:S(y.data_vencimento)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:P(y.valor_original)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:P(y.valor_recebido)}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold",children:P(y.valor_final-y.valor_recebido)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:G(y)}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[y.status!=="recebido"&&e.jsx(e.Fragment,{children:y.nsu&&!y.conciliado?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>s(`/conciliacao-cartao?nsu=${y.nsu}`),title:`Conciliar NSU ${y.nsu} com extrato da operadora`,children:"Ã°Å¸â€â€ž Conciliar"}),e.jsx("button",{className:"bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>q(y),title:"Receber manual (caso nÃƒÂ£o consiga conciliar)",children:"Ã°Å¸â€™Â³ Manual"})]}):y.venda_id&&!y.nsu?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>{console.log("Conta:",y),y.venda_id?A(y.venda_id):q(y)},title:"Receber no PDV (movimenta caixa)",children:"Ã°Å¸â€™Âµ PDV"}),e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>q(y),title:"Receber manual (sem PDV)",children:"Ã°Å¸â€™Â° Manual"})]}):e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>q(y),title:"Registrar recebimento manual",children:"Ã°Å¸â€™Â° Receber Manual"})}),y.conciliado&&e.jsx("span",{className:"text-xs text-green-600 font-semibold mr-2",title:`Conciliado em ${y.data_conciliacao}`,children:"Ã¢Å“â€œ Conciliado"}),e.jsx("button",{className:"bg-blue-50 hover:bg-blue-100 text-blue-600 px-3 py-1 rounded text-xs",title:"Ver Detalhes",onClick:()=>Z(y),children:"Ã°Å¸â€˜ÂÃ¯Â¸Â"})]})]},y.id))})]})}),l.length>0&&e.jsxs("div",{className:"bg-green-50 border-t border-green-200 px-4 py-3",children:[e.jsx("strong",{children:"Total:"})," ",l.length," conta(s) |",e.jsx("strong",{className:"ml-3",children:"Saldo a Receber:"})," ",P(l.reduce((y,O)=>y+(O.valor_final-O.valor_recebido),0))]})]}),p&&k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b p-4",children:[e.jsx("h5",{className:"text-xl font-bold",children:"Ã°Å¸â€™Â° Registrar Recebimento"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 text-2xl",onClick:()=>i(!1),children:"Ãƒâ€”"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mb-4 text-sm",children:[e.jsx("strong",{children:"Conta:"})," ",k.descricao,e.jsx("br",{}),e.jsx("strong",{children:"Valor Total:"})," ",P(k.valor_final),e.jsx("br",{}),e.jsx("strong",{children:"JÃƒÂ¡ Recebido:"})," ",P(k.valor_recebido),e.jsx("br",{}),e.jsx("strong",{children:"Saldo Restante:"})," ",P(k.valor_final-k.valor_recebido)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Valor a Receber *"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:$.valor_recebido,onChange:y=>K({...$,valor_recebido:parseFloat(y.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data do Recebimento *"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:$.data_recebimento,onChange:y=>K({...$,data_recebimento:y.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Forma de Pagamento"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:$.forma_pagamento_id||"",onChange:y=>K({...$,forma_pagamento_id:parseInt(y.target.value)||null}),children:[e.jsx("option",{value:"",children:"Selecione..."}),_a(C).map(y=>e.jsx("option",{value:y.id,children:y.nome},y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Conta BancÃƒÂ¡ria *"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:$.conta_bancaria_id||"",onChange:y=>K({...$,conta_bancaria_id:parseInt(y.target.value)||null}),children:[e.jsx("option",{value:"",children:"Selecione a conta..."}),_a(_).map(y=>e.jsxs("option",{value:y.id,children:[y.nome," - ",P(y.saldo_atual||0)]},y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Juros"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:$.valor_juros,onChange:y=>K({...$,valor_juros:parseFloat(y.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Multa"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:$.valor_multa,onChange:y=>K({...$,valor_multa:parseFloat(y.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Desconto"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:$.valor_desconto,onChange:y=>K({...$,valor_desconto:parseFloat(y.target.value)||0})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"ObservaÃƒÂ§ÃƒÂµes"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded px-3 py-2",rows:"3",value:$.observacoes,onChange:y=>K({...$,observacoes:y.target.value})})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded p-3 mt-4",children:[e.jsx("strong",{children:"Valor Final do Recebimento:"})," ",P(($.valor_recebido||0)+($.valor_juros||0)+($.valor_multa||0)-($.valor_desconto||0))]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t p-4",children:[e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",onClick:()=>i(!1),children:"Cancelar"}),e.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:J,children:"Ã¢Å“â€œ Confirmar Recebimento"})]})]})}),u&&k&&c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-6 py-4 flex justify-between items-center sticky top-0",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Detalhes da Conta"}),e.jsx("button",{onClick:()=>n(!1),className:"text-white hover:bg-blue-700 px-3 py-1 rounded",children:"Ã¢Å“â€¢"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"NÃƒÂºmero da Conta"}),e.jsx("p",{className:"mt-1 text-lg",children:k.numero_documento||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Cliente"}),e.jsx("p",{className:"mt-1 text-lg",children:((B=c.cliente)==null?void 0:B.nome)||"N/A"})]})]}),c.venda&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pedido/Venda"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>R(c.venda.id),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg border border-blue-200 transition-colors",children:[e.jsx("span",{className:"text-xl",children:"Ã°Å¸â€ºâ€™"}),e.jsx("span",{className:"font-semibold",children:c.venda.numero_venda})]}),e.jsxs("button",{onClick:()=>Q(k),className:"flex items-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg border border-green-200 transition-colors",title:"Ver no Fluxo de Caixa",children:[e.jsx("span",{className:"text-xl",children:"Ã°Å¸â€œË†"}),e.jsx("span",{className:"text-sm",children:"Fluxo"})]})]})]}),!c.venda&&e.jsx("div",{children:e.jsxs("button",{onClick:()=>Q(k),className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg border border-green-200 transition-colors",children:[e.jsx("span",{className:"text-xl",children:"Ã°Å¸â€œË†"}),e.jsx("span",{className:"font-medium",children:"Ver no Fluxo de Caixa"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Data de EmissÃƒÂ£o"}),e.jsx("p",{className:"mt-1",children:S(c.datas.emissao)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Data de Vencimento"}),e.jsx("p",{className:"mt-1",children:S(c.datas.vencimento)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor Original"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-blue-600",children:P(c.valores.final)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor Recebido"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-green-600",children:P(c.valores.recebido)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Saldo Restante"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-red-600",children:P(c.valores.saldo)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsx("p",{className:"mt-1",children:e.jsx("span",{className:`px-2 py-1 rounded text-sm ${c.status==="recebido"?"bg-green-100 text-green-800":c.status==="parcial"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:c.status==="recebido"?"Ã¢Å“â€œ Recebido":c.status==="parcial"?"Ã¢Å¡Â¡ Parcial":"Ã¢ÂÂ± Pendente"})})]})]}),c.recebimentos&&c.recebimentos.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ã°Å¸â€™Â° HistÃƒÂ³rico de Recebimentos"}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700",children:"Data"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700",children:"Valor"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700",children:"Conta BancÃƒÂ¡ria"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:_a(c==null?void 0:c.recebimentos).map((y,O)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2 text-sm",children:S(y.data)}),e.jsx("td",{className:"px-3 py-2 text-sm font-semibold text-green-600",children:P(y.valor)}),e.jsx("td",{className:"px-3 py-2 text-sm",children:y.conta_bancaria_nome?e.jsxs("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs",children:["Ã°Å¸ÂÂ¦ ",y.conta_bancaria_nome]}):e.jsx("span",{className:"text-gray-400 text-xs",children:"NÃƒÂ£o informada"})})]},O))})]})})]}),c.observacoes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"ObservaÃƒÂ§ÃƒÂµes"}),e.jsx("p",{className:"mt-1 text-gray-600",children:c.observacoes})]})]})]})})]})};function Ei({onConcluida:s,status:l}){const t=fa(),[m,r]=a.useState([]),[g,o]=a.useState([]),[v,j]=a.useState(!1),[f,N]=a.useState(null),[d,x]=a.useState(!1),[k,w]=a.useState(null),[c,b]=a.useState(!1),[p,i]=a.useState([]),[u,n]=a.useState([]),[C,h]=a.useState(!1),[_,E]=a.useState(!1),[$,K]=a.useState("pendentes"),[te,M]=a.useState([]),[A,Q]=a.useState(null),[re,q]=a.useState(!0),[Z,R]=a.useState(1),[J,S]=a.useState(1);a.useEffect(()=>{(async()=>{try{if(!localStorage.getItem("access_token")){N("VocÃª precisa estar logado."),setTimeout(()=>t("/login"),2e3);return}const de=await F.get("/operadoras-cartao?apenas_ativas=true");M(de.data);const ue=de.data.find(Re=>Re.padrao);ue&&Q(ue)}catch(ee){console.error("Erro ao carregar operadoras:",ee),N("Erro ao carregar operadoras")}finally{q(!1)}})()},[t]),a.useEffect(()=>{A&&(P(),B())},[Z,A,$]),a.useEffect(()=>{if($==="conciliadas"&&m.length>0&&g.length>0){const H=[];m.forEach(ee=>{var _e;const de=ee.pagamento||((_e=ee.pagamentos)==null?void 0:_e.find(ke=>ke.nsu||ke.nsu_cartao)),ue=(de==null?void 0:de.nsu)||(de==null?void 0:de.nsu_cartao)||ee.nsu;if(!ue)return;const Re=g.find(ke=>ke.nsu===ue);if(!Re)return;const se={...ee,numero:ee.numero||ee.numero_venda,nsu:ue,bandeira:de==null?void 0:de.bandeira,parcelas:de==null?void 0:de.parcelas,valor:(de==null?void 0:de.valor)??ee.total};H.push({venda_id:ee.id,status:"ok",venda_pdv:se,venda_stone:Re})}),n(H)}else n([])},[$,m,g]),a.useEffect(()=>{const H=ee=>{ee.key==="Escape"&&_&&(E(!1),i([]),h(!1))};return window.addEventListener("keydown",H),()=>window.removeEventListener("keydown",H)},[_]),a.useEffect(()=>{A&&(B(),P())},[A]);const P=async()=>{try{if(j(!0),!localStorage.getItem("access_token")){N("VocÃª precisa estar logado."),setTimeout(()=>t("/login"),2e3);return}const ee=await F.get("/conciliacao/aba1/vendas-pdv",{params:{status:$,operadora_id:(A==null?void 0:A.id)==="legacy"?"legacy":A==null?void 0:A.id,page:Z,limit:50}});ee.data.success&&(r(ee.data.vendas),S(ee.data.total_pages))}catch(H){console.error("Erro ao carregar vendas PDV:",H),N("Erro ao carregar vendas do PDV")}finally{j(!1)}},G=async H=>{var Re,se;const ee=H.target.files[0];if(!ee)return;if(!A){alert(`âš ï¸ Selecione uma operadora primeiro!

As vendas da planilha serÃ£o importadas com a tag da operadora selecionada.
Isso Ã© importante para o processo de conciliaÃ§Ã£o.`),H.target.value="";return}if(A.id==="legacy"){alert(`âš ï¸ Vendas Legacy nÃ£o tÃªm planilha!

Vendas sem operadora devem ter a operadora preenchida manualmente usando o botÃ£o "Preencher Operadora".`),H.target.value="";return}if(!window.confirm(`ðŸŽ¯ Confirmar Upload

Operadora selecionada: ${A.nome}

Todas as vendas da planilha "${ee.name}" serÃ£o marcadas com esta operadora.

Deseja continuar?`)){H.target.value="";return}w(ee),b(!0),N(null);const ue=new FormData;ue.append("arquivo",ee),ue.append("operadora_id",A.id);try{const _e=await F.post("/conciliacao/aba1/upload-stone",ue,{headers:{"Content-Type":"multipart/form-data"}});_e.data.success&&(await B(),await P(),alert(`âœ… Planilha importada com sucesso!

ðŸ“Š ${_e.data.total_nsus||0} NSUs carregados
Operadora: ${A.nome}

Clique em "Processar Matches" para conciliar automaticamente.`),H.target.value="")}catch(_e){console.error("Erro no upload:",_e),N(((se=(Re=_e.response)==null?void 0:Re.data)==null?void 0:se.detail)||"Erro ao importar planilha"),H.target.value=""}finally{b(!1)}},B=async()=>{if(A){if(A.id==="legacy"){o([]);return}try{const H=await F.get("/conciliacao/aba1/stone-nao-conciliadas",{params:{operadora_id:A.id,status:$}});H.data.success&&o(H.data.nsus)}catch(H){console.error("Erro ao carregar NSUs:",H)}}},y=async()=>{var H,ee;if(!A){alert("Selecione uma operadora primeiro!");return}b(!0),N(null);try{const de=await F.post("/conciliacao/aba1/processar-matches");de.data.success&&(i(de.data.matches||[]),E(!0),alert(`ðŸ” Matches encontrados!

ðŸ“Š Resumo:
â€¢ ${de.data.conferidas||0} vendas OK
â€¢ ${de.data.corrigidas||0} com divergÃªncias
â€¢ ${de.data.sem_nsu||0} sem NSU
â€¢ ${de.data.orfaos||0} NSUs Ã³rfÃ£os

ðŸ‘€ Visualize os matches abaixo e confirme para conciliar.`))}catch(de){console.error("Erro ao processar matches:",de),N(((ee=(H=de.response)==null?void 0:H.data)==null?void 0:ee.detail)||"Erro ao processar matches automÃ¡ticos")}finally{b(!1)}},O=async()=>{var ee,de;if(p.length===0)return;const H=p.filter(ue=>ue.status==="ok");if(H.length===0){alert(`âš ï¸ Nenhum match OK para confirmar!

Apenas matches perfeitos (sem divergÃªncias) podem ser conciliados.`);return}b(!0);try{const Re=(await F.get("/conciliacao/aba1/stone-nao-conciliadas",{params:{operadora_id:A==null?void 0:A.id}})).data.importacao_id,se=await F.post("/conciliacao/aba1/confirmar-matches",{importacao_id:Re,matches_confirmados:H});se.data.success&&(alert("âœ… "+se.data.message),i([]),E(!1),await P(),await B())}catch(ue){console.error("Erro ao confirmar matches:",ue),N(((de=(ee=ue.response)==null?void 0:ee.data)==null?void 0:de.detail)||"Erro ao confirmar matches")}finally{b(!1)}},z=async(H,ee)=>{var de,ue;try{const Re=await F.put("/conciliacao/aba1/atualizar-operadora",{pagamento_id:H,operadora_id:ee});if(Re.data.success)return await P(),alert(`Operadora atualizada para ${Re.data.operadora_nome}`),!0}catch(Re){return console.error("Erro ao atualizar operadora:",Re),alert(((ue=(de=Re.response)==null?void 0:de.data)==null?void 0:ue.detail)||"Erro ao atualizar operadora"),!1}},ae=({venda:H,expandir:ee})=>{var Qe;const[de,ue]=a.useState(d),[Re,se]=a.useState(!1),[_e,ke]=a.useState(""),[Ze,ze]=a.useState(!1),[Xe,be]=a.useState(""),Ee=async()=>{var Ye,ca;if(!_e||_e.trim()===""){alert("Digite um NSU vÃ¡lido");return}try{(await F.patch(`/vendas/${H.id}/pagamento/${H.pagamento.id}/nsu`,{nsu_cartao:_e.trim()})).data&&(se(!1),ke(""),await P(),alert("NSU atualizado com sucesso!"))}catch(ra){console.error("Erro ao salvar NSU:",ra),alert(((ca=(Ye=ra.response)==null?void 0:Ye.data)==null?void 0:ca.detail)||"Erro ao salvar NSU")}},he=async()=>{if(!Xe||Xe===""){alert("Selecione uma operadora");return}await z(H.pagamento.id,parseInt(Xe))&&(ze(!1),be(""))};return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 mb-2 hover:bg-gray-50 cursor-pointer",onClick:Ye=>{Ye.target.tagName==="INPUT"||Ye.target.tagName==="BUTTON"||d||ue(!de)},children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"font-medium text-gray-900",children:["Venda ",H.numero_venda]}),H.pagamento.operadora_id&&!Ze?e.jsx("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded-full",children:((Qe=te.find(Ye=>Ye.id===H.pagamento.operadora_id))==null?void 0:Qe.nome)||"N/A"}):Ze?e.jsxs("div",{className:"flex items-center gap-1",onClick:Ye=>Ye.stopPropagation(),children:[e.jsxs("select",{value:Xe,onChange:Ye=>be(Ye.target.value),className:"border border-purple-300 rounded px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-purple-500",autoFocus:!0,children:[e.jsx("option",{value:"",children:"Selecione..."}),te.map(Ye=>e.jsx("option",{value:Ye.id,children:Ye.nome},Ye.id))]}),e.jsx("button",{onClick:he,className:"bg-green-500 text-white px-2 py-1 rounded text-xs hover:bg-green-600",children:"âœ“"}),e.jsx("button",{onClick:()=>{ze(!1),be("")},className:"bg-gray-400 text-white px-2 py-1 rounded text-xs hover:bg-gray-500",children:"âœ—"})]}):e.jsx("button",{onClick:Ye=>{Ye.stopPropagation(),ze(!0)},className:"text-xs text-purple-600 hover:text-purple-700 underline font-medium px-2 py-1 bg-purple-50 rounded",children:"ðŸ¢ Sem Operadora - Clique aqui"}),H.pagamento.nsu?e.jsxs("span",{className:"text-sm text-green-600",children:["NSU: ",H.pagamento.nsu]}):Re?e.jsxs("div",{className:"flex items-center gap-1",onClick:Ye=>Ye.stopPropagation(),children:[e.jsx("input",{type:"text",value:_e,onChange:Ye=>ke(Ye.target.value),placeholder:"Digite o NSU",className:"border border-orange-300 rounded px-2 py-1 text-xs w-32 focus:outline-none focus:ring-1 focus:ring-orange-500",autoFocus:!0}),e.jsx("button",{onClick:Ee,className:"bg-green-500 text-white px-2 py-1 rounded text-xs hover:bg-green-600",children:"âœ“"}),e.jsx("button",{onClick:()=>{se(!1),ke("")},className:"bg-gray-400 text-white px-2 py-1 rounded text-xs hover:bg-gray-500",children:"âœ—"})]}):e.jsx("button",{onClick:Ye=>{Ye.stopPropagation(),se(!0)},className:"text-sm text-orange-600 hover:text-orange-700 underline font-medium",children:"SEM NSU - Clique para preencher"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["R$ ",H.total.toFixed(2)]}),!d&&e.jsx("svg",{className:`h-4 w-4 text-gray-400 transition-transform ${de?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),(de||d)&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{children:new Date(H.data_venda).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tipo:"}),e.jsx("span",{className:"capitalize",children:H.pagamento.forma})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Operadora:"}),e.jsx("span",{className:"font-medium text-blue-600",children:(A==null?void 0:A.nome)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Bandeira:"}),e.jsx("span",{children:H.pagamento.bandeira||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Parcelas:"}),e.jsxs("span",{children:[H.pagamento.parcelas,"x"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",H.pagamento.valor.toFixed(2)]})]})]})]})},W=({nsu:H,expandir:ee})=>{var Re,se,_e;const[de,ue]=a.useState(d);return e.jsxs("div",{className:"border border-blue-200 rounded-lg p-3 mb-2 hover:bg-blue-50 cursor-pointer",onClick:()=>!d&&ue(!de),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("span",{className:"font-medium text-blue-900",children:["NSU: ",H.nsu]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["R$ ",(Re=H.valor_liquido)==null?void 0:Re.toFixed(2)]}),!d&&e.jsx("svg",{className:`h-4 w-4 text-gray-400 transition-transform ${de?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),(de||d)&&H.data_venda&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200 text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{children:new Date(H.data_venda).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Bandeira:"}),e.jsx("span",{children:H.bandeira})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Parcelas:"}),e.jsxs("span",{children:[H.parcelas,"x"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Bruto:"}),e.jsxs("span",{children:["R$ ",(se=H.valor_bruto)==null?void 0:se.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor LÃ­quido:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["R$ ",(_e=H.valor_liquido)==null?void 0:_e.toFixed(2)]})]})]})]})},ne=({match:H,isConciliado:ee=!1})=>{var ue,Re,se;const de={ok:"bg-green-50 border-green-300",divergencia:"bg-yellow-50 border-yellow-300",orfao:"bg-red-50 border-red-300",sem_nsu:"bg-orange-50 border-orange-300"};return e.jsxs("div",{className:`border-2 rounded-lg p-4 mb-3 ${de[H.status]} relative`,children:[ee&&e.jsx("div",{className:"absolute top-2 right-2 px-3 py-1 bg-green-600 text-white text-xs font-bold rounded-full",children:"âœ… CONCILIADO"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[e.jsx("div",{className:"bg-white p-3 rounded border",children:H.venda_pdv?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-800",children:["Venda #",H.venda_pdv.numero]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["NSU: ",H.venda_pdv.nsu||e.jsx("span",{className:"text-orange-600",children:"SEM NSU"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[H.venda_pdv.bandeira," - ",H.venda_pdv.parcelas,"x"]}),e.jsxs("div",{className:"text-xs font-semibold text-gray-800 mt-1",children:["R$ ",(ue=H.venda_pdv.valor)==null?void 0:ue.toFixed(2)]})]}):e.jsx("div",{className:"text-sm text-gray-400 italic",children:"Sem venda no PDV"})}),e.jsxs("div",{className:"flex items-center justify-center",children:[H.status==="ok"&&e.jsx("div",{className:"text-green-600 text-2xl",children:"âœ…"}),H.status==="divergencia"&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-yellow-600 text-xl",children:"âš ï¸"}),e.jsx("div",{className:"text-xs text-yellow-700 font-semibold mt-1",children:(Re=H.divergencia)==null?void 0:Re.tipo})]}),H.status==="orfao"&&e.jsx("div",{className:"text-red-600 text-2xl",children:"âŒ"}),H.status==="sem_nsu"&&e.jsx("div",{className:"text-orange-600 text-2xl",children:"âž¡ï¸"})]}),e.jsx("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:H.venda_stone?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-semibold text-blue-800",children:"Planilha Operadora"}),e.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:["NSU: ",H.venda_stone.nsu]}),e.jsxs("div",{className:"text-xs text-blue-600",children:[H.venda_stone.bandeira," - ",H.venda_stone.parcelas,"x"]}),e.jsxs("div",{className:"text-xs font-semibold text-blue-800 mt-1",children:["R$ ",(se=H.venda_stone.valor_bruto)==null?void 0:se.toFixed(2)]})]}):e.jsx("div",{className:"text-sm text-blue-300 italic",children:"Sem NSU na planilha"})})]}),H.divergencia&&e.jsx("div",{className:"mt-3 pt-3 border-t border-yellow-300",children:e.jsxs("div",{className:"text-xs text-yellow-800",children:[e.jsx("span",{className:"font-semibold",children:"PDV:"})," ",H.divergencia.pdv," â†’"," ",e.jsx("span",{className:"font-semibold",children:"Stone:"})," ",H.divergencia.stone]})})]})};return e.jsxs("div",{className:"flex flex-col h-full p-6 bg-gray-50",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"ConciliaÃ§Ã£o de Vendas - Stone"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Compare vendas do PDV com a planilha da operadora"})]}),e.jsxs("div",{className:"flex gap-4 mb-4 items-center bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1",children:"Exibir:"}),e.jsxs("select",{value:$,onChange:H=>K(H.target.value),className:"border border-gray-300 rounded px-3 py-2 text-sm min-w-[180px] focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"pendentes",children:"â³ Pendentes (NÃ£o Conciliadas)"}),e.jsx("option",{value:"todas",children:"ðŸ“‹ Todas as Vendas"}),e.jsx("option",{value:"conciliadas",children:"âœ… Conciliadas"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1",children:"Operadora de CartÃ£o:"}),e.jsxs("select",{value:(A==null?void 0:A.id)||"",onChange:H=>{const ee=H.target.value;if(ee==="legacy")Q({id:"legacy",nome:"Legacy (Sem Operadora)"});else{const de=te.find(ue=>ue.id===parseInt(ee));Q(de)}},disabled:re,className:"border border-gray-300 rounded px-3 py-2 text-sm min-w-[200px] focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"legacy",className:"text-orange-600 font-semibold",children:"ðŸ“¦ Legacy (Sem Operadora)"}),te.map(H=>e.jsxs("option",{value:H.id,children:[H.nome," ",H.padrao?"(PadrÃ£o)":""]},H.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`px-4 py-2 rounded-md ${A&&A.id!=="legacy"?"bg-blue-600 text-white hover:bg-blue-700 cursor-pointer":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:["ðŸ“¤ Upload Planilha",e.jsx("input",{type:"file",accept:".csv",onChange:G,className:"hidden",disabled:!A||A.id==="legacy"})]}),(A==null?void 0:A.id)==="legacy"&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:'Vendas Legacy nÃ£o tÃªm planilha. Use o campo "Preencher Operadora".'})]}),g.length>0&&!_&&(A==null?void 0:A.id)!=="legacy"&&e.jsx("button",{onClick:y,disabled:c,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400",children:"ðŸ” Processar Matches"}),_&&p.length>0&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:O,disabled:c,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 animate-pulse",children:"âœ… Confirmar Matches OK"}),e.jsx("button",{onClick:()=>{E(!1),i([]),h(!1)},className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"âŒ Cancelar"})]}),e.jsxs("label",{className:"flex items-center gap-2 ml-auto",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:()=>x(!d),className:"rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Mostrar Expandido"})]})]}),f&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg",children:f}),_&&p.length>0||$==="conciliadas"&&u.length>0?e.jsxs("div",{className:"flex-1 overflow-hidden bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"px-6 py-4 bg-gradient-to-r from-blue-100 to-green-100 border-b",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:$==="conciliadas"?"âœ… Vendas Conciliadas":"ðŸ” Matches Encontrados - Revise e Confirme"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:$==="conciliadas"?"Vendas PDV conciliadas com NSUs da planilha":"Matches OK no topo â†’ DivergÃªncias â†’ Sem match"})]}),e.jsx("div",{className:"overflow-y-auto p-6",style:{maxHeight:"calc(100vh - 300px)"},children:$==="conciliadas"?u.length>0?u.map((H,ee)=>e.jsx(ne,{match:H,isConciliado:!0},ee)):e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Nenhuma venda conciliada ainda"}):p.sort((H,ee)=>{const de={ok:1,divergencia:2,orfao:3,sem_nsu:4};return de[H.status]-de[ee.status]}).map((H,ee)=>e.jsx(ne,{match:H},ee))})]}):e.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-4 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-100 border-b border-gray-200",children:[e.jsxs("h3",{className:"font-semibold text-gray-800",children:["â¬…ï¸ Vendas PDV (",m.length,")"]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Vendas com cartÃ£o pendentes"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:v?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Carregando..."}):m.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Nenhuma venda pendente"}):m.map(H=>e.jsx(ae,{venda:H},H.id))}),J>1&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex justify-between items-center",children:[e.jsx("button",{onClick:()=>R(H=>Math.max(1,H-1)),disabled:Z===1,className:"px-3 py-1 text-sm bg-white border rounded disabled:opacity-50",children:"â† Anterior"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["PÃ¡gina ",Z," de ",J]}),e.jsx("button",{onClick:()=>R(H=>Math.min(J,H+1)),disabled:Z===J,className:"px-3 py-1 text-sm bg-white border rounded disabled:opacity-50",children:"PrÃ³xima â†’"})]})]}),e.jsxs("div",{className:"flex flex-col bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-blue-100 border-b border-blue-200",children:[e.jsxs("h3",{className:"font-semibold text-blue-900",children:[A?`${A.nome} Planilha`:"Planilha"," âž¡ï¸ (",g.length,")"]}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"NSUs nÃ£o conciliados"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:(A==null?void 0:A.id)==="legacy"?e.jsxs("div",{className:"text-center text-orange-600 py-8 bg-orange-50 rounded-lg border-2 border-orange-200",children:[e.jsx("div",{className:"text-5xl mb-4",children:"ðŸ“¦"}),e.jsx("h4",{className:"font-bold text-lg mb-2",children:"Vendas Legacy"}),e.jsx("p",{className:"text-sm max-w-md mx-auto",children:"Vendas sem operadora nÃ£o possuem planilha para conciliaÃ§Ã£o automÃ¡tica."}),e.jsxs("p",{className:"text-sm max-w-md mx-auto mt-2",children:["Use o botÃ£o ",e.jsx("strong",{children:'"ðŸ¢ Preencher Operadora"'})," nas vendas do lado esquerdo para associÃ¡-las a uma operadora."]})]}):g.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:k?"Processando...":`FaÃ§a upload da planilha ${(A==null?void 0:A.nome)||""}`}):g.map((H,ee)=>e.jsx(W,{nsu:H},ee))})]})]})]})}function Fi({onConcluida:s,status:l}){var S,P,G;const[t,m]=a.useState(!1),[r,g]=a.useState({recebimentos:null,recibo:null,ofx:null}),[o,v]=a.useState(!1),[j,f]=a.useState(null),[N,d]=a.useState(null),[x,k]=a.useState([]),[w,c]=a.useState(null),[b,p]=a.useState(!0),[i,u]=a.useState(!1),[n,C]=a.useState(!1),[h,_]=a.useState(null),[E,$]=a.useState(0),[K,te]=a.useState(!1),M=()=>{console.log("ðŸŽ¯ Tentando avanÃ§ar para Aba 3..."),console.log("onConcluida existe?",typeof s),typeof s=="function"?(console.log("âœ… Chamando onConcluida()"),s(),console.log("âœ… onConcluida() foi chamado com sucesso")):(console.error("âŒ onConcluida nÃ£o Ã© uma funÃ§Ã£o!",s),alert("Erro: FunÃ§Ã£o de callback nÃ£o encontrada. Recarregue a pÃ¡gina."))},A=()=>{g({recebimentos:null,recibo:null,ofx:null}),f(null),d(null),v(!1),te(!1),_(null),$(0),u(!1),C(!1),console.log("ðŸ”„ Estado resetado")};a.useEffect(()=>{(async()=>{try{const y=await F.get("/operadoras-cartao?apenas_ativas=true");k(y.data);const O=y.data.find(z=>z.padrao);O&&c(O)}catch(y){console.error("Erro ao carregar operadoras:",y),d("Erro ao carregar operadoras")}finally{p(!1)}})()},[]),a.useEffect(()=>{const B=localStorage.getItem("conciliacao_aba2_aviso_ate");if(!B)return;const y=Number(B);Number.isFinite(y)&&Date.now()<y&&m(!0)},[]);const Q=B=>{const y=Date.now()+B*24*60*60*1e3;localStorage.setItem("conciliacao_aba2_aviso_ate",String(y)),m(!0)},re=(B,y)=>{var z;const O=(z=y.target.files)==null?void 0:z[0];if(!O){console.warn(`Nenhum arquivo selecionado para ${B}`);return}console.log(`ðŸ“Ž Arquivo selecionado para ${B}:`,{name:O.name,size:O.size,type:O.type,lastModified:new Date(O.lastModified).toISOString()}),g(ae=>({...ae,[B]:O})),d(null),f(null)},q=()=>{if(!w){d("Por favor, selecione uma operadora antes de validar.");return}if(!r.recebimentos||!r.recibo||!r.ofx){d("Por favor, faÃ§a upload dos 3 arquivos antes de validar.");return}u(!0)},Z=async()=>{var B,y,O,z,ae,W,ne,H,ee,de,ue,Re;if(u(!1),console.log("ðŸš€ Iniciando validaÃ§Ã£o...",{arquivos_estado:{recebimentos:!!r.recebimentos,recibo:!!r.recibo,ofx:!!r.ofx}}),!r.recebimentos||!r.recibo||!r.ofx){d("VocÃª precisa enviar os 3 arquivos para continuar");return}if(console.log("ðŸ” Validando tipos de arquivo...",{recebimentos_isFile:r.recebimentos instanceof File,recibo_isFile:r.recibo instanceof File,ofx_isFile:r.ofx instanceof File}),!(r.recebimentos instanceof File)){console.error("âŒ Arquivo de recebimentos nÃ£o Ã© um File vÃ¡lido:",r.recebimentos),d("Arquivo de recebimentos invÃ¡lido. Por favor, selecione novamente."),g(se=>({...se,recebimentos:null}));return}if(!(r.recibo instanceof File)){console.error("âŒ Arquivo de recibo nÃ£o Ã© um File vÃ¡lido:",r.recibo),d("Arquivo de recibo invÃ¡lido. Por favor, selecione novamente."),g(se=>({...se,recibo:null}));return}if(!(r.ofx instanceof File)){console.error("âŒ Arquivo OFX nÃ£o Ã© um File vÃ¡lido:",r.ofx),d("Arquivo OFX invÃ¡lido. Por favor, selecione novamente."),g(se=>({...se,ofx:null}));return}v(!0),d(null);try{let se,_e,ke;console.log("ðŸ“‚ Lendo arquivos:",{recebimentos:r.recebimentos.name,recibo:r.recibo.name,ofx:r.ofx.name});try{if(se=await r.recebimentos.text(),!se||se.trim().length===0)throw new Error("Arquivo de recebimentos estÃ¡ vazio")}catch(oe){throw console.error("Erro ao ler recebimentos:",oe),new Error(`Erro ao ler arquivo de recebimentos: ${oe.message}`)}try{if(_e=await r.recibo.text(),!_e||_e.trim().length===0)throw new Error("Arquivo de recibo estÃ¡ vazio")}catch(oe){throw console.error("Erro ao ler recibo:",oe),new Error(`Erro ao ler arquivo de recibo: ${oe.message}`)}try{if(ke=await r.ofx.text(),!ke||ke.trim().length===0)throw new Error("Arquivo OFX estÃ¡ vazio")}catch(oe){throw console.error("Erro ao ler OFX:",oe),new Error(`Erro ao ler arquivo OFX: ${oe.message}`)}console.log("ðŸ“„ Arquivos carregados:",{recebimentos_length:se.length,recibo_length:_e.length,ofx_length:ke.length});const Ze=se.split(`
`);console.log("ðŸ” Primeiras 3 linhas do arquivo de recebimentos:"),console.log("Linha 0 (header):",Ze[0]),console.log("Linha 1:",Ze[1]),console.log("Linha 2:",Ze[2]);const ze=_e.split(`
`);console.log("ðŸ” Primeiras 3 linhas do arquivo de recibo:"),console.log("Linha 0 (header):",ze[0]),console.log("Linha 1:",ze[1]),console.log("Linha 2:",ze[2]);const Xe=(B=Ze[0])!=null&&B.includes(";")?";":",";console.log("ðŸ“‹ Separador detectado:",Xe);let be,Ee,he;try{be=se.split(`
`).slice(1).filter(oe=>oe.trim()).map((oe,ye)=>{var Ce,Be,Ie,Y,je,Me;try{const I=oe.split(Xe);ye===0&&(console.log("ðŸ” DEBUG - Primeira linha parseada:"),console.log("Total de campos:",I.length),console.log("Campos relevantes:"),console.log("  Campo 8 (STONE ID/NSU):",I[8]),console.log("  Campo 4 (DATA DE VENCIMENTO):",I[4]),console.log("  Campo 12 (VALOR LÃQUIDO):",I[12]),console.log("  Campo 10 (NÂº DA PARCELA):",I[10]),console.log("  Campo 9 (QTD DE PARCELAS):",I[9]),console.log("  Campo 16 (ÃšLTIMO STATUS):",I[16]));const X=(Ce=I[8])==null?void 0:Ce.trim(),fe=(Be=I[4])==null?void 0:Be.trim(),U=(Ie=I[12])==null?void 0:Ie.trim(),ie=(Y=I[10])==null?void 0:Y.trim(),Ne=(je=I[9])==null?void 0:je.trim(),Pe=(Me=I[16])==null?void 0:Me.trim(),L=U==null?void 0:U.replace(",","."),le=parseFloat(L||0);return ye===0&&(console.log("ðŸ’° ConversÃ£o de valor:"),console.log("  Original:",U),console.log("  Limpo:",L),console.log("  Final:",le),console.log("  Is NaN?",isNaN(le))),{nsu:X,data_recebimento:fe,valor:le,parcela_numero:parseInt(ie||1),total_parcelas:parseInt(Ne||1),tipo_recebimento:Pe||"Pago",lote_id:null}}catch(I){throw console.error(`Erro ao parsear linha ${ye+1} de recebimentos:`,oe,I),new Error(`Erro na linha ${ye+1} do arquivo de recebimentos detalhados`)}})}catch(oe){d(`âŒ Erro ao processar arquivo de recebimentos: ${oe.message}`);return}try{const oe=(y=ze[0])!=null&&y.includes(";")?";":",";console.log("ðŸ“„ Primeira linha do recibo:",ze[0]),console.log("ðŸ“„ Segunda linha do recibo:",ze[1]),Ee=_e.split(`
`).slice(1).filter(ye=>ye.trim()).map((ye,Ce)=>{var Be,Ie,Y;try{const je=ye.split(oe);Ce===0&&(console.log("ðŸ” DEBUG - Recibo primeira linha parseada:"),console.log("Total de campos:",je.length),console.log("  Campo 0 (Valor):",je[0]),console.log("  Campo 13 (ID RastreÃ¡vel):",je[13]),console.log("  Campo 18 (Status):",je[18]));const Me=(Be=je[0])==null?void 0:Be.trim(),I=(Ie=je[13])==null?void 0:Ie.trim(),X=(Y=je[18])==null?void 0:Y.trim(),fe=Me==null?void 0:Me.replace(",","."),U=parseFloat(fe||0);return Ce===0&&(console.log("ðŸ’° ConversÃ£o recibo:"),console.log("  Original:",Me),console.log("  Limpo:",fe),console.log("  Final:",U)),{lote_id:I,valor:U,status:X}}catch(je){throw console.error(`Erro ao parsear linha ${Ce+1} de recibo:`,ye,je),new Error(`Erro na linha ${Ce+1} do arquivo de recibo de lote`)}})}catch(oe){d(`âŒ Erro ao processar arquivo de recibo: ${oe.message}`);return}try{console.log("ðŸ“„ Primeiras linhas do OFX:",ke.split(`
`).slice(0,30).join(`
`));const oe=[],ye=ke.split(`
`);let Ce=null;for(let Be=0;Be<ye.length;Be++){const Ie=ye[Be].trim();if(Ie==="<STMTTRN>")Ce={};else if(Ie==="</STMTTRN>"&&Ce)(Ce.type==="CREDIT"||Ce.valor&&Ce.valor>0)&&oe.push(Ce),Ce=null;else if(Ce)if(Ie.startsWith("<TRNTYPE>"))Ce.type=Ie.replace("<TRNTYPE>","").replace("</TRNTYPE>","");else if(Ie.startsWith("<DTPOSTED>"))Ce.data=Ie.replace("<DTPOSTED>","").replace("</DTPOSTED>","");else if(Ie.startsWith("<TRNAMT>")){const Y=Ie.replace("<TRNAMT>","").replace("</TRNAMT>","");Ce.valor=parseFloat(Y)}else Ie.startsWith("<FITID>")?Ce.id=Ie.replace("<FITID>","").replace("</FITID>",""):Ie.startsWith("<MEMO>")&&(Ce.memo=Ie.replace("<MEMO>","").replace("</MEMO>",""))}he=oe,console.log("ðŸ’³ OFX parseado:",he.length,"transaÃ§Ãµes encontradas"),he.length>0&&console.log("Primeira transaÃ§Ã£o:",he[0])}catch(oe){console.error("Erro ao parsear OFX:",oe),d(`âŒ Erro ao processar arquivo OFX: ${oe.message}`);return}if(be.length===0){d("âŒ Arquivo de recebimentos detalhados estÃ¡ vazio ou mal formatado. Verifique o formato CSV.");return}if(Ee.length===0){d("âŒ Arquivo de recibo de lote estÃ¡ vazio ou mal formatado. Verifique o formato CSV.");return}if(he.length===0){d("âŒ Arquivo OFX estÃ¡ vazio ou mal formatado. Verifique o formato.");return}const Qe=be.filter(oe=>isNaN(oe.valor)||oe.valor===null);if(Qe.length>0){console.error("âŒ Recebimentos com valores invÃ¡lidos:",Qe),console.error("ðŸ“‹ Primeiras 5 linhas RAW do arquivo:"),Ze.slice(0,6).forEach((oe,ye)=>{console.error(`Linha ${ye}:`,oe)}),d(`âŒ ${Qe.length} recebimentos tÃªm valores invÃ¡lidos. Verifique o formato dos valores no CSV (use vÃ­rgula ou ponto decimal). Veja o console para mais detalhes.`);return}const Ye=Ee.filter(oe=>isNaN(oe.valor)||oe.valor===null);if(Ye.length>0){console.error("âŒ Lotes com valores invÃ¡lidos:",Ye),d(`âŒ ${Ye.length} lotes tÃªm valores invÃ¡lidos. Verifique o formato dos valores no CSV.`);return}console.log("âœ… Todos os valores validados! Enviando para API..."),console.log("ðŸ“¤ Enviando dados para API:",{recebimentos_count:be.length,recibo_count:Ee.length,ofx_count:he.length,sample_recebimento:be[0],sample_recebimento_2:be[1],sample_recibo:Ee[0],sample_ofx:he[0]}),console.log("ðŸ’° Valores parseados (primeiros 3):"),console.log("Recebimento 1:",(O=be[0])==null?void 0:O.valor),console.log("Recebimento 2:",(z=be[1])==null?void 0:z.valor),console.log("Recibo 1:",(ae=Ee[0])==null?void 0:ae.valor),console.log("OFX 1:",(W=he[0])==null?void 0:W.valor);const ra=(oe=>{var Be;const ye={};return oe.forEach(Ie=>{const Y=["data","data_recebimento","data_pagamento","Data de Pagamento","Data do Pagamento"];for(const je of Y)if(Ie[je]){let Me=Ie[je];if(Me.match(/^\d{2}\/\d{2}\/\d{4}$/)){const[I,X,fe]=Me.split("/");Me=`${fe}-${X}-${I}`}ye[Me]=(ye[Me]||0)+1;break}}),((Be=Object.entries(ye).sort((Ie,Y)=>Y[1]-Ie[1])[0])==null?void 0:Be[0])||null})(be);console.log("ðŸ“… Data de referÃªncia detectada:",ra);const pa=[{nome:r.recebimentos.name,tamanho:r.recebimentos.size,tipo:"recebimentos_detalhados"},{nome:r.recibo.name,tamanho:r.recibo.size,tipo:"recibo_lote"},{nome:r.ofx.name,tamanho:r.ofx.size,tipo:"extrato_ofx"}],na=await F.post("/conciliacao/aba2/validar-recebimentos",{recebimentos_detalhados:be,recibo_lote:Ee,ofx_creditos:he,data_referencia:ra,arquivos_info:pa,operadora:w==null?void 0:w.nome});if(!K){const oe=w.nome,ye=na.data.operadora_detectada,Ce=na.data.confianca_deteccao||0;if(console.log("ðŸ” ComparaÃ§Ã£o de operadoras:",{selecionada:oe,detectada:ye,confianca:Ce,ignorar:K}),ye&&oe!==ye&&Ce>=.7){_(ye),$(Ce),f(na.data),C(!0),v(!1);return}}f(na.data),console.log("ðŸ“Š Resultado da validaÃ§Ã£o:",{success:na.data.success,tem_divergencias:na.data.tem_divergencias,validado:na.data.validado,historico_id:na.data.historico_id,operadora_detectada:na.data.operadora_detectada,ja_conciliado:na.data.ja_conciliado}),na.data.ja_conciliado&&na.data.aviso_reprocessamento&&console.warn("âš ï¸ Reprocessamento detectado:",na.data.aviso_reprocessamento),na.data.success&&(na.data.tem_divergencias?console.log("âš ï¸ Tem divergÃªncias, aguardando decisÃ£o do usuÃ¡rio..."):(console.log("âœ… ValidaÃ§Ã£o perfeita, avanÃ§ando automaticamente em 1.5s..."),setTimeout(()=>{M()},1500)))}catch(se){console.error("Erro ao validar:",se),console.error("Detalhes do erro:",(ne=se.response)==null?void 0:ne.data);const _e=((ee=(H=se.response)==null?void 0:H.data)==null?void 0:ee.detail)||((ue=(de=se.response)==null?void 0:de.data)==null?void 0:ue.message)||JSON.stringify((Re=se.response)==null?void 0:Re.data)||"Erro ao validar recebimentos";d(_e)}finally{v(!1)}},R=r.recebimentos&&r.recibo&&r.ofx,J=fa();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Aba 2: ConciliaÃ§Ã£o de Recebimentos"}),e.jsx("p",{className:"text-gray-600",children:"Valide que dinheiro entrou na conta (3 arquivos: detalhados, recibo, OFX)"})]}),e.jsxs("button",{onClick:()=>J("/financeiro/historico-conciliacoes"),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-lg hover:from-purple-600 hover:to-indigo-700 transition-all shadow-md hover:shadow-lg",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-semibold",children:"ðŸ“œ Ver HistÃ³rico"})]})]}),t?e.jsx("button",{onClick:()=>m(!1),className:"text-xs text-blue-700 hover:text-blue-900",children:"Mostrar aviso de sequencia"}):e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Ordem recomendada:"})," Aba 1 prepara os NSUs; esta Aba 2 valida os recebimentos; a Aba 3 baixa as parcelas com seguranca."]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Q(30),className:"text-xs text-blue-700 hover:text-blue-900",children:"Ocultar 30 dias"}),e.jsx("button",{onClick:()=>Q(365),className:"text-xs text-blue-700 hover:text-blue-900",children:"Ocultar 1 ano"})]})]})}),e.jsx("div",{className:"bg-purple-50 border-l-4 border-purple-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-purple-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("p",{className:"text-sm text-purple-700 mb-2",children:[e.jsx("strong",{children:"Esta aba NÃƒO conhece vendas."})," Apenas valida que o dinheiro entrou na conta. ValidaÃ§Ã£o em cascata: Recebimentos â†’ Recibo â†’ OFX (todos precisam bater)."]}),e.jsxs("details",{className:"text-xs text-purple-600 mt-2",children:[e.jsx("summary",{className:"cursor-pointer font-semibold hover:text-purple-800",children:"ðŸ“‹ Formato esperado dos arquivos"}),e.jsxs("div",{className:"mt-2 space-y-2 pl-4",children:[e.jsx("p",{children:e.jsx("strong",{children:"Recebimentos Detalhados CSV da Stone:"})}),e.jsx("p",{className:"text-xs font-mono",children:"DOCUMENTO;STONECODE;CATEGORIA;DATA DA VENDA;DATA DE VENCIMENTO;DATA DE VENCIMENTO ORIGINAL;BANDEIRA;PRODUTO;STONE ID;QTD DE PARCELAS;NÂº DA PARCELA;VALOR BRUTO;VALOR LÃQUIDO;DESCONTO DE MDR;DESCONTO DE ANTECIPAÃ‡ÃƒO;DESCONTO UNIFICADO;ÃšLTIMO STATUS;DATA DO ÃšLTIMO STATUS"}),e.jsx("p",{className:"text-xs text-purple-500",children:"Separador: ponto-e-vÃ­rgula (;) | Valores com vÃ­rgula decimal (21,012265)"}),e.jsx("p",{className:"mt-2",children:e.jsx("strong",{children:"Comprovante de Pagamentos CSV da Stone:"})}),e.jsx("p",{className:"text-xs font-mono",children:"Valor;Bandeira;Modalidade;...;Identificador RastreÃ¡vel do Pagamento;...;Status do Pagamento (19 colunas)"}),e.jsx("p",{className:"text-xs text-purple-500",children:"Separador: ponto-e-vÃ­rgula (;) | Valores com vÃ­rgula decimal (202,11)"}),e.jsx("p",{className:"mt-2",children:e.jsx("strong",{children:"OFX:"})}),e.jsx("p",{className:"text-xs",children:"Arquivo bancÃ¡rio padrÃ£o OFX com tags <STMTTRN>, <TRNAMT>, <TRNTYPE>"})]})]})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-2 border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-8 w-8 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-semibold text-blue-900 mb-2",children:"ðŸ› Operadora de CartÃ£o:"}),e.jsxs("select",{value:(w==null?void 0:w.id)||"",onChange:B=>{const y=x.find(O=>O.id===parseInt(B.target.value));c(y),f(null),d(null),te(!1),_(null)},disabled:b||o,className:"w-full border-2 border-blue-300 rounded-lg px-4 py-3 text-base font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Selecione a operadora..."}),x.map(B=>e.jsxs("option",{value:B.id,children:[B.nome," ",B.padrao?"ðŸŽ¯ (PadrÃ£o)":""]},B.id))]}),w&&e.jsxs("p",{className:"mt-2 text-xs text-blue-700",children:["âœ… Operadora selecionada: ",e.jsx("strong",{children:w.nome})]}),!w&&e.jsx("p",{className:"mt-2 text-xs text-orange-600 font-medium",children:"âš ï¸ Selecione a operadora antes de fazer upload dos arquivos"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-blue-400 flex items-center justify-center",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-full w-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{htmlFor:"file-recebimentos",className:"cursor-pointer",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-900 mb-1",children:"1ï¸âƒ£ Recebimentos Detalhados"}),e.jsx("span",{className:"block text-xs text-gray-500 mb-3",children:"Arquivo CSV da Stone (18 colunas)"}),e.jsx("input",{id:"file-recebimentos",type:"file",accept:".csv",onChange:B=>re("recebimentos",B),className:"sr-only"}),e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"Selecionar CSV"})]}),r.recebimentos&&e.jsxs("p",{className:"mt-2 text-xs text-green-600 font-medium truncate",children:["âœ“ ",r.recebimentos.name]})]})]})}),e.jsx("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-green-400 flex items-center justify-center",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-full w-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{htmlFor:"file-recibo",className:"cursor-pointer",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-900 mb-1",children:"2ï¸âƒ£ Recibo de Lote"}),e.jsx("span",{className:"block text-xs text-gray-500 mb-3",children:'CSV "Comprovante de Pagamentos" (19 colunas)'}),e.jsx("input",{id:"file-recibo",type:"file",accept:".csv",onChange:B=>re("recibo",B),className:"sr-only"}),e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"Selecionar CSV"})]}),r.recibo&&e.jsxs("p",{className:"mt-2 text-xs text-green-600 font-medium truncate",children:["âœ“ ",r.recibo.name]})]})]})}),e.jsx("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-purple-400 flex items-center justify-center",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-full w-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{htmlFor:"file-ofx",className:"cursor-pointer",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-900 mb-1",children:"3ï¸âƒ£ Extrato OFX"}),e.jsx("span",{className:"block text-xs text-gray-500 mb-3",children:"Extrato bancÃ¡rio"}),e.jsx("input",{id:"file-ofx",type:"file",accept:".ofx,.xml",onChange:B=>re("ofx",B),className:"sr-only"}),e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"Selecionar OFX"})]}),r.ofx&&e.jsxs("p",{className:"mt-2 text-xs text-green-600 font-medium truncate",children:["âœ“ ",r.ofx.name]})]})]})})]}),R&&!j&&e.jsx("button",{onClick:q,disabled:o||!w,className:`
            w-full flex justify-center items-center gap-2 py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white
            ${o?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}
          `,children:o?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Validando recebimentos..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),e.jsx("span",{children:"Validar Cascata (3 arquivos)"})]})}),N&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:N})})]}),e.jsx("button",{onClick:A,className:"ml-4 px-3 py-1 bg-red-100 hover:bg-red-200 text-red-700 text-xs font-medium rounded",children:"Limpar e Tentar Novamente"})]})}),j&&j.success&&e.jsxs("div",{className:"space-y-4",children:[j.ja_conciliado&&j.aviso_reprocessamento&&e.jsx("div",{className:"bg-orange-50 border-l-4 border-orange-400 p-4 rounded-lg",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6 text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-orange-800",children:"âš ï¸ REPROCESSAMENTO DETECTADO"}),e.jsxs("div",{className:"mt-2 text-sm text-orange-700",children:[e.jsx("p",{children:j.aviso_reprocessamento.mensagem}),j.aviso_reprocessamento.usuario_anterior&&e.jsxs("p",{className:"mt-1",children:[e.jsx("span",{className:"font-medium",children:"Processado anteriormente por:"})," ",j.aviso_reprocessamento.usuario_anterior]})]}),e.jsx("div",{className:"mt-3",children:e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:["Data: ",j.data_referencia," | Operadora: ",j.operadora_detectada]})})]})]})}),(j.operadora_detectada||j.data_referencia)&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"InformaÃ§Ãµes da ConciliaÃ§Ã£o"}),e.jsxs("div",{className:"mt-2 text-sm text-blue-700 space-y-1",children:[j.operadora_detectada&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Operadora:"})," ",j.operadora_detectada,j.confianca_deteccao&&e.jsxs("span",{className:"ml-2 text-xs",children:["(ConfianÃ§a: ",(j.confianca_deteccao*100).toFixed(0),"%)"]})]}),j.data_referencia&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Data de ReferÃªncia:"})," ",new Date(j.data_referencia+"T00:00:00").toLocaleDateString("pt-BR")]}),j.historico_id&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"ID do HistÃ³rico:"})," #",j.historico_id]})]})]})]})}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"h-6 w-6 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Resumo da ValidaÃ§Ã£o em Cascata"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"1ï¸âƒ£ Recebimentos Detalhados"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:["R$ ",(S=j.valor_total_recebimentos)==null?void 0:S.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[j.recebimentos_salvos," transaÃ§Ãµes"]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:"2ï¸âƒ£ Comprovante (Lotes)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-900",children:["R$ ",(P=j.valor_total_lotes)==null?void 0:P.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[j.lotes_count," lotes"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-purple-600 font-medium mb-1",children:"3ï¸âƒ£ Extrato BancÃ¡rio (OFX)"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900",children:["R$ ",(G=j.valor_total_ofx)==null?void 0:G.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:[j.ofx_count," crÃ©ditos"]})]})]})]}),!j.tem_divergencias&&e.jsx("div",{className:"bg-green-50 border-l-4 border-green-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:"âœ… ValidaÃ§Ã£o Perfeita! Nenhuma divergÃªncia encontrada."}),e.jsxs("p",{className:"mt-1 text-sm text-green-700",children:["Todas as 3 somas estÃ£o idÃªnticas. As ",j.recebimentos_salvos," vendas foram confirmadas na conta."]})]})]})}),j.tem_divergencias&&j.divergencias&&j.divergencias.length>0&&e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"âš ï¸ DivergÃªncias Detectadas"}),e.jsx("p",{className:"mt-1 text-sm text-yellow-700",children:"Foram encontradas diferenÃ§as entre os arquivos. Analise abaixo e decida se aceita ou nÃ£o."}),e.jsx("div",{className:"mt-4 space-y-3",children:j.divergencias.map((B,y)=>{var ne,H,ee;const O=B.nivel==="arredondamento",z=O?"bg-blue-50 border-blue-200":"bg-orange-50 border-orange-200",ae=O?"text-blue-900":"text-orange-900",W=O?"bg-blue-100 text-blue-800":"bg-orange-100 text-orange-800";return e.jsxs("div",{className:`border rounded-lg p-4 ${z}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-semibold px-2 py-1 rounded ${W}`,children:O?"ðŸ”µ Arredondamento":"ðŸŸ  AtenÃ§Ã£o"}),e.jsx("p",{className:`text-sm font-medium ${ae}`,children:B.tipo==="recebimentos_vs_lotes"?"Recebimentos Ã— Lotes":"Lotes Ã— OFX"})]}),e.jsxs("div",{className:`text-right ${ae}`,children:[e.jsxs("p",{className:"text-lg font-bold",children:["R$ ",Math.abs(B.diferenca).toFixed(2)]}),e.jsxs("p",{className:"text-xs",children:[(ne=B.percentual)==null?void 0:ne.toFixed(3),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:B.tipo==="recebimentos_vs_lotes"?"Recebimentos:":"Lotes:"}),e.jsxs("p",{className:`font-semibold ${ae}`,children:["R$ ",(H=B.tipo==="recebimentos_vs_lotes"?B.soma_recebimentos:B.soma_lotes)==null?void 0:H.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:B.tipo==="recebimentos_vs_lotes"?"Lotes:":"OFX:"}),e.jsxs("p",{className:`font-semibold ${ae}`,children:["R$ ",(ee=B.tipo==="recebimentos_vs_lotes"?B.soma_lotes:B.soma_ofx)==null?void 0:ee.toFixed(2)]})]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-2 italic",children:B.mensagem})]},y)})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsx("div",{className:"text-sm text-gray-600",children:j.tem_divergencias?e.jsx("p",{children:"âš ï¸ Analise as divergÃªncias e decida se aceita a validaÃ§Ã£o"}):e.jsx("p",{children:"âœ… ValidaÃ§Ã£o perfeita! Pode avanÃ§ar para a Aba 3."})}),e.jsxs("div",{className:"flex gap-3",children:[j.tem_divergencias&&e.jsx("button",{onClick:A,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 font-medium",children:"âœ• Cancelar e RecomeÃ§ar"}),e.jsx("button",{onClick:()=>{console.log("ðŸ–±ï¸ BotÃ£o Aceitar e AvanÃ§ar clicado"),M()},className:`px-6 py-2 rounded-md font-medium transition-colors ${j.tem_divergencias?"bg-yellow-600 hover:bg-yellow-700 text-white":"bg-green-600 hover:bg-green-700 text-white"}`,children:j.tem_divergencias?"âœ“ Aceitar e AvanÃ§ar â†’":"AvanÃ§ar para Aba 3 â†’"})]})]})]}),i&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>u(!1)}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Confirmar Operadora"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"VocÃª estÃ¡ prestes a validar recebimentos para a operadora:"}),e.jsx("div",{className:"mt-3 p-3 bg-blue-50 rounded border border-blue-200",children:e.jsxs("p",{className:"text-lg font-bold text-blue-900",children:["ðŸ¦ ",w==null?void 0:w.nome]})}),e.jsxs("p",{className:"text-sm text-gray-500 mt-3",children:["âš ï¸ ",e.jsx("strong",{children:"Todos os lanÃ§amentos serÃ£o vinculados a esta operadora."})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"O sistema detectarÃ¡ automaticamente se os arquivos correspondem a esta operadora e alertarÃ¡ se houver divergÃªncia."})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"button",onClick:Z,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm",children:"âœ“ Confirmar e Validar"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Cancelar"})]})]})]})}),n&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-orange-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{className:"h-6 w-6 text-orange-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left flex-1",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-orange-900",children:"âš ï¸ DivergÃªncia de Operadora Detectada"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-4",children:e.jsx("strong",{children:"Os arquivos enviados parecem ser de uma operadora diferente da selecionada."})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-red-50 border-2 border-red-300 rounded-lg",children:[e.jsx("p",{className:"text-xs text-red-600 font-medium mb-1",children:"Operadora Selecionada:"}),e.jsx("p",{className:"text-lg font-bold text-red-900",children:w==null?void 0:w.nome})]}),e.jsxs("div",{className:"p-3 bg-green-50 border-2 border-green-300 rounded-lg",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:"Operadora Detectada nos Arquivos:"}),e.jsx("p",{className:"text-lg font-bold text-green-900",children:h}),e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["ConfianÃ§a da detecÃ§Ã£o: ",(E*100).toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded",children:[e.jsx("p",{className:"text-sm text-yellow-800",children:e.jsx("strong",{children:"O que vocÃª deseja fazer?"})}),e.jsxs("ul",{className:"text-xs text-yellow-700 mt-2 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsxs("strong",{children:["Mudar para ",h,":"]})," Recomendado se os arquivos estÃ£o corretos"]}),e.jsxs("li",{children:[e.jsxs("strong",{children:["Manter ",w==null?void 0:w.nome,":"]})," Use se vocÃª tem certeza da operadora"]})]})]})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{const B=x.find(y=>y.nome===h);B&&c(B),C(!1),setTimeout(()=>{Z()},100)},className:"inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none sm:text-sm",children:["âœ“ Mudar para ",h]}),e.jsxs("button",{type:"button",onClick:()=>{te(!0),C(!1),setTimeout(()=>{Z()},100)},className:"inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:text-sm",children:["Manter ",w==null?void 0:w.nome]}),e.jsx("button",{type:"button",onClick:()=>{C(!1),v(!1),A()},className:"inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:text-sm",children:"âœ• Cancelar Tudo"})]})]})]})})]})}function $i({onConcluida:s,status:l}){var $,K,te,M;const t=fa(),[m,r]=a.useState(!1),[g,o]=a.useState(""),[v,j]=a.useState(null),[f,N]=a.useState(!1),[d,x]=a.useState(null),[k,w]=a.useState(null),[c,b]=a.useState([]),[p,i]=a.useState(null),[u,n]=a.useState(!0);a.useEffect(()=>{(async()=>{try{const Q=await F.get("/operadoras-cartao?apenas_ativas=true");b(Q.data);const re=Q.data.find(q=>q.padrao);re&&i(re)}catch(Q){console.error("Erro ao carregar operadoras:",Q),w("Erro ao carregar operadoras")}finally{n(!1)}})()},[]),a.useEffect(()=>{const A=localStorage.getItem("conciliacao_aba3_aviso_ate");if(!A)return;const Q=Number(A);Number.isFinite(Q)&&Date.now()<Q&&r(!0)},[]);const C=A=>{const Q=Date.now()+A*24*60*60*1e3;localStorage.setItem("conciliacao_aba3_aviso_ate",String(Q)),r(!0)};a.useEffect(()=>{g&&p?h():j(null)},[g,p]);const h=async()=>{try{const A=await F.get("/conciliacao/aba3/preview-amarracao",{params:{data_recebimento:g,operadora:p==null?void 0:p.nome}});j(A.data)}catch(A){console.error("Erro ao buscar preview:",A),j(null)}},_=async()=>{var A,Q;if(!p||!g){w("Selecione a operadora e a data primeiro");return}N(!0),w(null);try{const re=await F.post("/conciliacao/aba3/amarrar-automatico",{data_recebimento:g,operadora:p==null?void 0:p.nome});x(re.data)}catch(re){console.error("Erro ao processar:",re),w(((Q=(A=re.response)==null?void 0:A.data)==null?void 0:Q.detail)||"Erro ao processar amarraÃ§Ã£o")}finally{N(!1)}},E=()=>{var A,Q;if(d){const re=`âœ… ConciliaÃ§Ã£o finalizada com sucesso!

ðŸ“Š Resumo:
â€¢ ${d.parcelas_liquidadas} parcelas baixadas
â€¢ Valor total: R$ ${(A=d.valor_total_liquidado)==null?void 0:A.toFixed(2)}
â€¢ Taxa de amarraÃ§Ã£o: ${(Q=d.taxa_amarracao_automatica)==null?void 0:Q.toFixed(1)}%`;alert(re)}s&&s(),t("/financeiro/historico-conciliacoes")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Aba 3: AmarraÃ§Ã£o AutomÃ¡tica"}),e.jsx("p",{className:"text-gray-600",children:"AmarraÃ§Ã£o 98% automÃ¡tica: recebimentos â†’ vendas â†’ baixa de parcelas"})]}),m?e.jsx("button",{onClick:()=>r(!1),className:"text-xs text-blue-700 hover:text-blue-900",children:"Mostrar aviso de sequencia"}):e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Ordem recomendada:"})," Execute a Aba 1 e Aba 2 antes para garantir que a amarracao encontre todos os recebimentos."]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>C(30),className:"text-xs text-blue-700 hover:text-blue-900",children:"Ocultar 30 dias"}),e.jsx("button",{onClick:()=>C(365),className:"text-xs text-blue-700 hover:text-blue-900",children:"Ocultar 1 ano"})]})]})}),e.jsx("div",{className:"bg-green-50 border-l-4 border-green-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"98% automÃ¡tico!"})," Se as Abas 1 e 2 foram bem feitas, esta etapa Ã© quase instantÃ¢nea. Sistema vincula recebimentos Ã s vendas pelo NSU e baixa as parcelas automaticamente."]})})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Operadora:"}),e.jsxs("select",{value:(p==null?void 0:p.id)||"",onChange:A=>{const Q=c.find(re=>String(re.id)===A.target.value);i(Q||null)},disabled:u,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Selecione a operadora"}),c.map(A=>e.jsx("option",{value:A.id,children:A.nome},A.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data dos recebimentos:"}),e.jsx("input",{type:"date",value:g,onChange:A=>o(A.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Selecione a operadora e a data dos recebimentos validados na Aba 2"})]}),v&&v.recebimentos_validados>0&&e.jsx("div",{className:"bg-blue-50 border-2 border-blue-300 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:"ðŸ“Š Preview da AmarraÃ§Ã£o"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white rounded",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Recebimentos validados:"}),e.jsx("span",{className:"text-lg font-bold text-gray-900",children:v.recebimentos_validados})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-100 rounded border-2 border-blue-400",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-900",children:"âœ… Parcelas que serÃ£o baixadas:"}),e.jsx("span",{className:"text-xl font-bold text-blue-900",children:v.parcelas_a_baixar})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-100 rounded border-2 border-green-400",children:[e.jsx("span",{className:"text-sm font-semibold text-green-900",children:"ðŸ’° Valor total a liquidar:"}),e.jsxs("span",{className:"text-xl font-bold text-green-900",children:["R$ ",($=v.valor_total)==null?void 0:$.toFixed(2)]})]})]})]})]})}),v&&v.recebimentos_validados===0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"âš ï¸ Nenhum recebimento validado encontrado para esta data. Verifique se a Aba 2 foi processada corretamente."})}),v&&v.parcelas_a_baixar>0&&!d&&e.jsx("button",{onClick:_,disabled:f,className:`
            w-full flex justify-center items-center gap-3 py-4 px-6 border-2 border-transparent rounded-lg shadow-lg text-base font-bold
            ${f?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white"}
          `,children:f?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-6 w-6 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Processando amarraÃ§Ã£o..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsxs("span",{children:["âœ… Processar â†’ baixar ",v.parcelas_a_baixar," parcelas"]})]})}),k&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:k})})]})}),d&&d.success&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:`border-l-4 p-6 rounded-lg ${d.alerta_saude==="OK"?"bg-green-50 border-green-400":"bg-red-50 border-red-400"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:d.alerta_saude==="OK"?e.jsx("svg",{className:"h-8 w-8 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):e.jsx("svg",{className:"h-8 w-8 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:`text-xl font-bold mb-2 ${d.alerta_saude==="OK"?"text-green-900":"text-red-900"}`,children:d.alerta_saude==="OK"?"âœ… AmarraÃ§Ã£o ConcluÃ­da com Sucesso!":"âš ï¸ AmarraÃ§Ã£o ConcluÃ­da com Alertas"}),e.jsxs("p",{className:"text-sm text-gray-700 font-medium mb-4 bg-green-100 border border-green-300 rounded px-3 py-2",children:["ðŸ’° ",d.parcelas_liquidadas," conta(s) a receber foi(ram) baixada(s) com sucesso! Valor total: R$ ",(K=d.valor_total_liquidado)==null?void 0:K.toFixed(2)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white rounded p-4 shadow",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Amarrados"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:d.amarrados})]}),e.jsxs("div",{className:"bg-white rounded p-4 shadow",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Ã“rfÃ£os"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:d.orfaos})]}),e.jsxs("div",{className:"bg-white rounded p-4 shadow",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Parcelas Liquidadas"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:d.parcelas_liquidadas})]}),e.jsxs("div",{className:"bg-white rounded p-4 shadow",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Valor Liquidado"}),e.jsxs("p",{className:"text-xl font-bold text-purple-600",children:["R$ ",(te=d.valor_total_liquidado)==null?void 0:te.toFixed(2)]})]})]}),e.jsxs("div",{className:`p-4 rounded-lg border-2 ${d.alerta_saude==="OK"?"bg-green-100 border-green-400":"bg-red-100 border-red-400"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"ðŸ“Š SaÃºde do Sistema"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Taxa de amarraÃ§Ã£o automÃ¡tica"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-4xl font-bold ${d.alerta_saude==="OK"?"text-green-700":"text-red-700"}`,children:[(M=d.taxa_amarracao_automatica)==null?void 0:M.toFixed(1),"%"]}),e.jsx("p",{className:`text-sm font-medium mt-1 ${d.alerta_saude==="OK"?"text-green-700":"text-red-700"}`,children:d.alerta_saude==="OK"?"âœ… SAUDÃVEL":"ðŸš¨ CRÃTICO"})]})]}),d.alerta_saude!=="OK"&&e.jsx("p",{className:"mt-3 text-xs text-red-700 font-medium",children:"âš ï¸ Taxa abaixo de 90% indica problema na operaÃ§Ã£o. Revise a Aba 1 (conferÃªncia de vendas)."})]})]})]})}),d.orfaos>0&&d.lista_orfaos&&e.jsxs("div",{className:"bg-white border-2 border-red-300 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-red-50 border-b border-red-200",children:[e.jsxs("h4",{className:"text-lg font-semibold text-red-900",children:["âš ï¸ Recebimentos Ã“rfÃ£os (",d.orfaos,")"]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Estes recebimentos nÃ£o tÃªm venda correspondente. Precisa resolver na Aba 1."})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-3",children:d.lista_orfaos.map((A,Q)=>{var re;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-red-900",children:["NSU: ",A.nsu]}),e.jsxs("p",{className:"text-xs text-red-700",children:["Data: ",A.data," â€¢ Valor: R$ ",(re=A.valor)==null?void 0:re.toFixed(2)]})]}),e.jsx("button",{className:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded hover:bg-red-700",children:"Resolver na Aba 1"})]},Q)})})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsx("div",{className:"text-sm text-gray-600",children:e.jsx("p",{children:"ðŸŽ‰ ConciliaÃ§Ã£o completa! Todas as 3 abas foram processadas."})}),e.jsxs("button",{onClick:E,className:"px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 font-semibold flex items-center gap-2 shadow-lg",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{children:"Concluir e Ver HistÃ³rico"})]})]})]})]})}function Pi(){const[s,l]=a.useState(1),[t,m]=a.useState(!1),[r,g]=a.useState(null),[o,v]=a.useState(!1),[j,f]=a.useState("pendente"),[N,d]=a.useState("pendente"),[x,k]=a.useState("pendente");a.useEffect(()=>{const C=localStorage.getItem("conciliacao_tabs_skip_aviso");v(C==="true")},[]),a.useEffect(()=>{console.log("ðŸ”„ abaAtiva MUDOU PARA:",s)},[s]);const w=()=>{console.log("âœ… Aba 1 concluÃ­da, marcando como processado"),f("processado")},c=()=>{console.log("âœ… Aba 2 concluÃ­da, marcando como processado e avanÃ§ando para Aba 3"),d("processado"),console.log("ðŸš€ Mudando para Aba 3 imediatamente..."),console.log("ðŸ” abaAtiva ANTES de setAbaAtiva:",s),l(C=>(console.log("ðŸ” abaAtiva ANTERIOR (dentro do setState):",C),console.log("ðŸ” Retornando novo valor:",3),3)),console.log("âœ… setAbaAtiva(3) executado")},b=()=>{console.log("âœ… Aba 3 concluÃ­da, marcando como processado"),k("processado")},p=C=>{if(o||C===1){l(C);return}g(C),m(!0)},i=()=>{r&&l(r),m(!1)},u=()=>{localStorage.setItem("conciliacao_tabs_skip_aviso","true"),v(!0),r&&l(r),m(!1)},n=C=>{switch(C){case"processado":return e.jsx("span",{className:"text-green-600 text-xl",children:"âœ…"});case"pendente":return e.jsx("span",{className:"text-yellow-600 text-xl",children:"â³"});case"bloqueado":return e.jsx("span",{className:"text-gray-400 text-xl",children:"ðŸ”’"});case"erro":return e.jsx("span",{className:"text-red-600 text-xl",children:"âŒ"});default:return null}};return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"ConciliaÃ§Ã£o de CartÃµes - 3 Etapas"}),e.jsx("p",{className:"text-gray-600",children:"Processo completo: Vendas â†’ Recebimentos â†’ AmarraÃ§Ã£o (baixa automÃ¡tica)"})]}),e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-yellow-700 font-medium",children:["Ordem recomendada: ",e.jsx("strong",{children:"Aba 1"})," â†’ ",e.jsx("strong",{children:"Aba 2"})," â†’ ",e.jsx("strong",{children:"Aba 3"}),". As abas ficam abertas, mas a sequencia evita divergencias."]})})]})}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsxs("nav",{className:"flex -mb-px space-x-8",children:[e.jsxs("button",{onClick:()=>p(1),disabled:!1,className:`
              flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${s===1?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx("span",{className:"text-lg",children:"1ï¸âƒ£"}),e.jsx("span",{children:"ConciliaÃ§Ã£o de Vendas"}),n(j),j==="pendente"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"ObrigatÃ³ria"})]}),e.jsxs("button",{onClick:()=>p(2),disabled:!1,className:`
              flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${s===2?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx("span",{className:"text-lg",children:"2ï¸âƒ£"}),e.jsx("span",{children:"ConciliaÃ§Ã£o de Recebimentos"}),n(N),N==="pendente"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Recomendada apos Aba 1"})]}),e.jsxs("button",{onClick:()=>p(3),disabled:!1,className:`
              flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${s===3?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx("span",{className:"text-lg",children:"3ï¸âƒ£"}),e.jsx("span",{children:"AmarraÃ§Ã£o AutomÃ¡tica"}),n(x),x==="pendente"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Recomendada apos Aba 2"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[s===1&&e.jsx(Ei,{onConcluida:w,status:j}),s===2&&e.jsx(Fi,{onConcluida:c,status:N}),s===3&&e.jsx($i,{onConcluida:b,status:x})]}),t&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Ordem recomendada das etapas"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["A sequencia ",e.jsx("strong",{children:"Aba 1 â†’ Aba 2 â†’ Aba 3"})," reduz divergencias e garante que a amarracao automatica encontre todos os recebimentos."]}),e.jsxs("div",{className:"bg-gray-50 rounded-md p-3 text-sm text-gray-700 mb-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Aba 1:"})," prepara vendas e NSUs."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Aba 2:"})," valida que o dinheiro entrou."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Aba 3:"})," baixa parcelas automaticamente."]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-800",children:"Cancelar"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:u,className:"px-3 py-2 text-sm text-blue-700 hover:text-blue-900",children:"Nao mostrar novamente"}),e.jsx("button",{onClick:i,className:"px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded hover:bg-blue-700",children:"Continuar"})]})]})]})}),e.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-2",children:"â„¹ï¸ Como funciona:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Aba 1:"})," Confere NSU, bandeira, parcelas, taxa (prepara dados)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Aba 2:"})," Valida que dinheiro entrou na conta (3 arquivos: detalhados, recibo, OFX)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Aba 3:"})," Vincula recebimentos Ã s vendas e baixa parcelas automaticamente (98%!)"]})]})]})]})}function Ri(){const s=fa(),[l,t]=a.useState([]),[m,r]=a.useState(!1),[g,o]=a.useState({operadora:"",status:"",data_inicio:"",data_fim:""});a.useEffect(()=>{v()},[]);const v=async()=>{r(!0);try{const d=new URLSearchParams;g.operadora&&d.append("operadora",g.operadora),g.status&&d.append("status",g.status),g.data_inicio&&d.append("data_inicio",g.data_inicio),g.data_fim&&d.append("data_fim",g.data_fim);const x=await F.get(`/conciliacao/historico?${d.toString()}`);x.data&&x.data.items&&t(x.data.items)}catch(d){console.error("Erro ao carregar histÃ³rico:",d)}finally{r(!1)}},j=d=>{if(!d)return"-";const[x,k,w]=d.split("T")[0].split("-");return`${w}/${k}/${x}`},f=(d,x)=>{var c,b;if((b=(c=x==null?void 0:x.abas)==null?void 0:c.aba2)!=null&&b.concluida&&d==="em_andamento")return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:"âœ“ Aba 2 ConcluÃ­da"});const w={concluida:{cor:"bg-green-100 text-green-800",texto:"âœ“ ConcluÃ­da"},em_andamento:{cor:"bg-yellow-100 text-yellow-800",texto:"â³ Em Andamento"},reprocessada:{cor:"bg-blue-100 text-blue-800",texto:"â†» Reprocessada"},cancelada:{cor:"bg-gray-100 text-gray-800",texto:"âœ• Cancelada"}}[d]||{cor:"bg-gray-100 text-gray-800",texto:d};return e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${w.cor}`,children:w.texto})},N=d=>d?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(d):"-";return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"ðŸ“‹ HistÃ³rico de ConciliaÃ§Ãµes"}),e.jsx("p",{className:"text-gray-600",children:"Consulte todas as conciliaÃ§Ãµes jÃ¡ realizadas"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>s("/financeiro/conciliacao-3abas"),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium transition-colors flex items-center gap-2",title:"Voltar para ConciliaÃ§Ã£o",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),e.jsx("span",{children:"Voltar para ConciliaÃ§Ã£o"})]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Filtros"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Operadora"}),e.jsxs("select",{value:g.operadora,onChange:d=>o({...g,operadora:d.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"Stone",children:"Stone"}),e.jsx("option",{value:"PagSeguro",children:"PagSeguro"}),e.jsx("option",{value:"Rede",children:"Rede"}),e.jsx("option",{value:"Cielo",children:"Cielo"}),e.jsx("option",{value:"Getnet",children:"Getnet"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:g.status,onChange:d=>o({...g,status:d.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"concluida",children:"ConcluÃ­da"}),e.jsx("option",{value:"em_andamento",children:"Em Andamento"}),e.jsx("option",{value:"reprocessada",children:"Reprocessada"}),e.jsx("option",{value:"cancelada",children:"Cancelada"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:g.data_inicio,onChange:d=>o({...g,data_inicio:d.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:g.data_fim,onChange:d=>o({...g,data_fim:d.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:v,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium",children:"ðŸ” Filtrar"}),e.jsx("button",{onClick:()=>{o({operadora:"",status:"",data_inicio:"",data_fim:""}),v()},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 font-medium",children:"âœ• Limpar Filtros"})]})]}),m&&e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),!m&&l.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",style:{display:"grid",gridTemplateColumns:"minmax(48px, 0.6fr) minmax(90px, 1fr) minmax(100px, 1.1fr) minmax(140px, 1.6fr) minmax(120px, 1.4fr) minmax(130px, 1.5fr) minmax(180px, 2.4fr)",columnGap:"8px",background:"#f9fafb",borderBottom:"2px solid #e5e7eb"},children:[e.jsx("span",{style:{padding:"8px 10px"},children:"ID"}),e.jsx("span",{style:{padding:"8px 10px"},children:"Data"}),e.jsx("span",{style:{padding:"8px 10px"},children:"Operadora"}),e.jsx("span",{style:{padding:"8px 10px"},children:"Status"}),e.jsx("span",{style:{padding:"8px 10px",textAlign:"right"},children:"Valor"}),e.jsx("span",{style:{padding:"8px 10px"},children:"Processado"}),e.jsx("span",{style:{padding:"8px 10px"},children:"UsuÃ¡rio"})]}),l.map((d,x)=>{var k,w,c,b,p;return e.jsxs("div",{className:"hover:bg-blue-50 transition-colors",style:{display:"grid",gridTemplateColumns:"minmax(48px, 0.6fr) minmax(90px, 1fr) minmax(100px, 1.1fr) minmax(140px, 1.6fr) minmax(120px, 1.4fr) minmax(130px, 1.5fr) minmax(180px, 2.4fr)",columnGap:"8px",alignItems:"center",borderBottom:"1px solid #f0f0f0",background:x%2===0?"#fff":"#fafbfc"},children:[e.jsxs("span",{style:{padding:"8px 10px"},className:"text-sm font-mono text-gray-400",children:["#",d.id]}),e.jsx("span",{style:{padding:"8px 10px"},className:"text-sm font-medium text-gray-900",children:j(d.data_referencia)}),e.jsx("span",{style:{padding:"8px 10px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},className:"text-sm text-gray-700",title:d.operadora,children:d.operadora}),e.jsx("span",{style:{padding:"8px 10px"},children:f(d.status,d)}),e.jsxs("span",{style:{padding:"8px 10px",textAlign:"right"},children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:N((w=(k=d.totais)==null?void 0:k.recebimentos)==null?void 0:w.valor_total)}),((b=(c=d.totais)==null?void 0:c.recebimentos)==null?void 0:b.quantidade)&&e.jsxs("div",{className:"text-xs text-gray-400",children:[d.totais.recebimentos.quantidade," trans."]})]}),e.jsxs("span",{style:{padding:"8px 10px"},children:[e.jsx("div",{className:"text-sm text-gray-700",children:j((p=d.created_at)==null?void 0:p.split("T")[0])}),e.jsx("div",{className:"text-xs text-gray-400",children:d.created_at?new Date(d.created_at).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}):"-"})]}),e.jsx("span",{style:{padding:"8px 10px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},className:"text-sm text-gray-700",title:d.usuario_responsavel,children:d.usuario_responsavel||"-"})]},d.id)})]}),!m&&l.length===0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhuma conciliaÃ§Ã£o encontrada"}),e.jsx("p",{className:"text-gray-500",children:"NÃ£o hÃ¡ conciliaÃ§Ãµes registradas com os filtros selecionados."})]})]})}const Ai="/api",Di=Ai,la=Bo.create({baseURL:Di});la.interceptors.request.use(s=>{const l=localStorage.getItem("access_token")||localStorage.getItem("token");return l&&(s.headers.Authorization=`Bearer ${l}`),s},s=>Promise.reject(s));la.interceptors.response.use(s=>s,s=>{var t;const l=(t=s.response)==null?void 0:t.status;return l===401&&(console.warn("Sessao invalida ou tenant nao selecionado"),localStorage.removeItem("access_token"),localStorage.removeItem("token"),localStorage.removeItem("tenants"),window.location.href="/login"),l===403&&console.warn("Acesso negado para este tenant"),Promise.reject(s)});function Mi(){var S;const[s,l]=a.useState([]),[t,m]=a.useState(null),[r,g]=a.useState([]),[o,v]=a.useState([]),[j,f]=a.useState(!1),[N,d]=a.useState(!1),[x,k]=a.useState(null),[w,c]=a.useState("todos"),[b,p]=a.useState(!0),[i,u]=a.useState(""),[n,C]=a.useState(""),[h,_]=a.useState(null),[E,$]=a.useState(!1);a.useEffect(()=>{K(),A()},[]),a.useEffect(()=>{o.length>0&&x&&(te(),M())},[x,w,b,i,n]);const K=async()=>{var P;try{const G=await la.get("/contas-bancarias",{params:{apenas_ativas:!0}});console.log("ðŸ“Š Contas bancÃ¡rias carregadas:",G.data);const B=G.data.filter(y=>y.instituicao_bancaria);v(B)}catch(G){console.error("âŒ Erro ao carregar contas bancÃ¡rias:",G),console.error("Detalhes:",(P=G.response)==null?void 0:P.data)}},te=async()=>{try{f(!0);const P={};x&&(P.conta_bancaria_id=x),w!=="todos"&&(P.status=w),P.ocultar_conciliadas=b,i&&(P.data_inicio=i),n&&(P.data_fim=n),P.limit=200;const G=await la.get("/conciliacao/movimentacoes",{params:P});l(G.data)}catch(P){console.error("Erro ao carregar movimentaÃ§Ãµes:",P)}finally{f(!1)}},M=async()=>{try{const P={};x&&(P.conta_bancaria_id=x);const G=await la.get("/conciliacao/estatisticas",{params:P});m(G.data)}catch(P){console.error("Erro ao carregar estatÃ­sticas:",P)}},A=async()=>{try{const P=await la.get("/conciliacao/regras");g(P.data)}catch(P){console.error("Erro ao carregar regras:",P)}},Q=async P=>{var B,y;const G=P.target.files[0];if(console.log("ðŸ“¤ Upload OFX iniciado:",{file:G,contaSelecionada:x}),!!G){if(!x){alert("Selecione uma conta bancÃ¡ria primeiro");return}try{d(!0);const O=new FormData;O.append("arquivo",G),console.log("ðŸ“¤ Enviando arquivo para API...");const z=await la.post(`/api/conciliacao/upload-ofx?conta_bancaria_id=${x}`,O,{headers:{"Content-Type":"multipart/form-data"}});console.log("âœ… Upload concluÃ­do:",z.data),alert(`âœ… OFX importado com sucesso!

ðŸ“Š Total de transaÃ§Ãµes: ${z.data.total_transacoes}
â³ Pendentes: ${z.data.pendentes}
ðŸ“… PerÃ­odo: ${z.data.periodo_inicio||"N/A"} a ${z.data.periodo_fim||"N/A"}`),te(),M()}catch(O){console.error("âŒ Erro ao fazer upload:",O),alert("âŒ Erro ao processar OFX: "+(((y=(B=O.response)==null?void 0:B.data)==null?void 0:y.detail)||O.message))}finally{d(!1),P.target.value=""}}},re=async(P,G)=>{try{await la.post(`/api/conciliacao/movimentacoes/${P.id}/classificar`,G),te(),M(),A(),_(null)}catch(B){console.error("Erro ao classificar:",B),alert("âŒ Erro ao classificar movimentaÃ§Ã£o")}},q=(P,G)=>{const B={conciliado:e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-800 flex items-center gap-1",children:[e.jsx(ha,{size:12})," Conciliado"]}),sugerido:e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800 flex items-center gap-1",children:[e.jsx(da,{size:12})," Sugerido (",G,"%)"]}),pendente:e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-red-100 text-red-800 flex items-center gap-1",children:[e.jsx(Ts,{size:12})," Pendente"]}),manual:e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800 flex items-center gap-1",children:[e.jsx(sr,{size:12})," Manual"]})};return B[P]||B.pendente},Z=P=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(P),R=P=>P?new Date(P).toLocaleDateString("pt-BR"):"-",J=()=>{k(null)};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ConciliaÃ§Ã£o BancÃ¡ria"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Sistema inteligente de classificaÃ§Ã£o automÃ¡tica"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>$(!0),className:"px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(sr,{size:18}),"Regras (",r.length,")"]}),e.jsxs("label",{className:`px-4 py-2 rounded-lg flex items-center gap-2 ${N||!x?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 cursor-pointer"} text-white`,children:[N?e.jsxs(e.Fragment,{children:[e.jsx(Fa,{size:18,className:"animate-spin"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(tr,{size:18}),"Upload OFX"]}),e.jsx("input",{type:"file",accept:".ofx,.OFX",onChange:Q,className:"hidden",disabled:N||!x})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(ha,{size:20,className:"text-blue-600"}),"Selecione a Conta BancÃ¡ria"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Escolha a conta para visualizar movimentaÃ§Ãµes e fazer upload de extrato OFX"})]}),x&&e.jsx("button",{onClick:J,className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"Limpar SeleÃ§Ã£o"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:o.map(P=>{const G=x===P.id,B=P.cor||"#3B82F6",y=G?{backgroundColor:B,borderColor:B,color:"#ffffff"}:{backgroundColor:`${B}15`,borderColor:`${B}40`,color:B};return e.jsxs("button",{onClick:()=>k(P.id),style:y,className:`border-2 rounded-lg p-4 transition-all duration-200 transform font-medium ${G?"scale-105 shadow-lg":"hover:scale-102 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[P.icone&&e.jsx("span",{className:"text-xl",children:P.icone}),e.jsx("span",{className:"font-semibold text-sm",children:P.nome})]}),G&&e.jsx(ha,{size:20,className:"flex-shrink-0"})]}),P.banco&&e.jsx("div",{className:`text-xs mt-1 ${G?"opacity-90":"opacity-70"}`,children:P.banco})]},P.id)})}),o.length===0&&e.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(da,{size:20,className:"text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-red-800",children:[e.jsx("span",{className:"font-semibold",children:"Nenhuma instituiÃ§Ã£o bancÃ¡ria cadastrada."})," ",'VÃ¡ em Financeiro â†’ Contas BancÃ¡rias e marque o checkbox "ðŸ¦ InstituiÃ§Ã£o BancÃ¡ria" nas contas que sÃ£o bancos reais (nÃ£o caixa fÃ­sico).']})]})}),!x&&o.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(da,{size:18,className:"text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("span",{className:"font-semibold",children:"Nenhuma conta selecionada."})," ","Clique em uma conta acima para visualizar movimentaÃ§Ãµes e fazer upload de extrato OFX."]})]})}),x&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ha,{size:18,className:"text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("span",{className:"font-semibold",children:[(S=o.find(P=>P.id===x))==null?void 0:S.nome," selecionada."]})," ","Visualizando movimentaÃ§Ãµes desta conta. Pronto para upload de extrato OFX."]})]})})]}),t&&x&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.total_movimentacoes})]}),e.jsx(Xa,{className:"text-gray-400",size:24})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Conciliadas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:t.conciliadas})]}),e.jsx(ha,{className:"text-green-400",size:24})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-yellow-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Sugeridas"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:t.sugeridas})]}),e.jsx(da,{className:"text-yellow-400",size:24})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pendentes"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:t.pendentes})]}),e.jsx(Ts,{className:"text-red-400",size:24})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"AutomaÃ§Ã£o"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[t.taxa_automacao,"%"]})]}),e.jsx(Aa,{className:"text-blue-400",size:24})]})})]}),x&&e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ct,{size:18,className:"text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtros:"})]}),e.jsxs("select",{value:w,onChange:P=>c(P.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"todos",children:"Todos os status"}),e.jsx("option",{value:"pendente",children:"Pendente"}),e.jsx("option",{value:"sugerido",children:"Sugerido"}),e.jsx("option",{value:"conciliado",children:"Conciliado"}),e.jsx("option",{value:"manual",children:"Manual"})]}),e.jsx("input",{type:"date",value:i,onChange:P=>u(P.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"Data inÃ­cio"}),e.jsx("input",{type:"date",value:n,onChange:P=>C(P.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"Data fim"}),e.jsxs("button",{onClick:()=>p(!b),className:`px-3 py-2 rounded-lg text-sm flex items-center gap-2 ${b?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:[b?e.jsx(Zt,{size:16}):e.jsx(Nt,{size:16}),b?"Ocultar":"Mostrar"," Conciliadas"]}),e.jsxs("button",{onClick:te,className:"ml-auto px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm flex items-center gap-2",children:[e.jsx(Fa,{size:16}),"Atualizar"]})]})}),x&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"DescriÃ§Ã£o"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Vinculado"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:j?e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500",children:[e.jsx(Fa,{className:"animate-spin mx-auto mb-2",size:24}),"Carregando..."]})}):s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500",children:"Nenhuma movimentaÃ§Ã£o encontrada. FaÃ§a upload de um arquivo OFX."})}):s.map(P=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:R(P.data_movimento)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 max-w-xs truncate",children:P.memo||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded ${P.tipo==="CREDIT"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:P.tipo==="CREDIT"?"CrÃ©dito":"DÃ©bito"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-medium",children:e.jsxs("span",{className:P.tipo==="CREDIT"?"text-green-600":"text-red-600",children:[P.tipo==="CREDIT"?"+":"-"," ",Z(Math.abs(P.valor))]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:q(P.status_conciliacao,P.confianca_sugestao)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 max-w-xs truncate",children:P.fornecedor_nome||P.tipo_vinculo||"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:P.status_conciliacao!=="conciliado"&&e.jsx("button",{onClick:()=>_(P),className:"px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700",children:"Classificar"})})]},P.id))})]})})}),h&&e.jsx(Li,{movimentacao:h,onClose:()=>_(null),onClassificar:re}),E&&e.jsx(qi,{regras:r,onClose:()=>$(!1),onAtualizar:A})]})})}function Li({movimentacao:s,onClose:l,onClassificar:t}){const[m,r]=a.useState(s.tipo_vinculo||"fornecedor"),[g,o]=a.useState(!0),[v,j]=a.useState(!1),[f,N]=a.useState("mensal"),d=x=>{x.preventDefault(),t(s,{tipo_vinculo:m,criar_regra:g,recorrente:v,periodicidade:v?f:null})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Classificar MovimentaÃ§Ã£o"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Data:"}),e.jsx("span",{className:"text-sm font-medium",children:new Date(s.data_movimento).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Valor:"}),e.jsx("span",{className:"text-sm font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.valor)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"DescriÃ§Ã£o:"}),e.jsx("span",{className:"text-sm font-medium truncate ml-4",children:s.memo})]})]}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de VÃ­nculo"}),e.jsxs("select",{value:m,onChange:x=>r(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"fornecedor",children:"Pagamento a Fornecedor"}),e.jsx("option",{value:"taxa",children:"Taxa BancÃ¡ria"}),e.jsx("option",{value:"transferencia",children:"TransferÃªncia Entre Contas"}),e.jsx("option",{value:"recebimento",children:"Recebimento de Cliente"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"criar_regra",checked:g,onChange:x=>o(x.target.checked),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("label",{htmlFor:"criar_regra",className:"text-sm text-gray-700",children:"Criar regra automÃ¡tica para movimentaÃ§Ãµes similares"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"recorrente",checked:v,onChange:x=>j(x.target.checked),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("label",{htmlFor:"recorrente",className:"text-sm text-gray-700",children:"MovimentaÃ§Ã£o recorrente (criar provisÃµes futuras)"})]}),v&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Periodicidade"}),e.jsxs("select",{value:f,onChange:x=>N(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"mensal",children:"Mensal"}),e.jsx("option",{value:"anual",children:"Anual"}),e.jsx("option",{value:"trimestral",children:"Trimestral"}),e.jsx("option",{value:"semestral",children:"Semestral"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Classificar"})]})]})]})]})})}function qi({regras:s,onClose:l,onAtualizar:t}){const[m,r]=a.useState(s),g=async o=>{if(confirm("Deseja realmente desativar esta regra?"))try{await la.delete(`/conciliacao/regras/${o}`),t();const v=m.filter(j=>j.id!==o);r(v)}catch(v){console.error("Erro ao excluir regra:",v)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Regras de Aprendizado"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Sistema aprende com suas classificaÃ§Ãµes"})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),e.jsx("div",{className:"p-6",children:m.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(sr,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Nenhuma regra criada ainda."}),e.jsx("p",{className:"text-sm mt-2",children:"Classifique movimentaÃ§Ãµes para criar regras automÃ¡ticas."})]}):e.jsx("div",{className:"space-y-3",children:m.map(o=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded",children:o.padrao_memo}),o.tipo_operacao&&e.jsx("span",{className:"text-xs text-gray-600",children:o.tipo_operacao})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"ConfianÃ§a:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${o.confianca>=80?"bg-green-500":o.confianca>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${o.confianca}%`}})}),e.jsxs("span",{className:"font-medium",children:[o.confianca,"%"]})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Aplicada:"}),e.jsxs("p",{className:"font-medium mt-1",children:[o.vezes_aplicada,"x"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Confirmada:"}),e.jsxs("p",{className:"font-medium mt-1",children:[o.vezes_confirmada,"x"]})]})]}),o.fornecedor_nome&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["â†’ ",o.fornecedor_nome]})]}),e.jsx("button",{onClick:()=>g(o.id),className:"ml-4 px-3 py-1 text-xs text-red-600 hover:bg-red-50 rounded",children:"Desativar"})]})},o.id))})})]})})}const zi=()=>{var u,n,C;const[s,l]=a.useState([]),[t,m]=a.useState([]),[r,g]=a.useState([]),[o,v]=a.useState(!0),[j,f]=a.useState(!1),[N,d]=a.useState(null),[x,k]=a.useState({nome:"",tipo:"dinheiro",taxa_percentual:0,taxa_fixa:0,prazo_dias:0,operadora:"",operadora_id:null,gera_contas_receber:!1,split_parcelas:!1,conta_bancaria_destino_id:null,requer_nsu:!1,tipo_cartao:"",bandeira:"",ativo:!0,permite_parcelamento:!1,parcelas_maximas:1,taxas_por_parcela:{},permite_antecipacao:!1,dias_recebimento_antecipado:null,taxa_antecipacao_percentual:null,icone:"ðŸ’³",cor:"#3B82F6"});a.useEffect(()=>{w()},[]);const w=async()=>{try{const[h,_,E]=await Promise.all([F.get("/financeiro/formas-pagamento?apenas_ativas=false"),F.get("/contas-bancarias?apenas_ativas=true"),F.get("/operadoras-cartao?apenas_ativas=true")]);l(h.data),m(_.data),g(E.data)}catch(h){console.error("Erro ao carregar dados:",h),ce.error("Erro ao carregar formas de pagamento")}finally{v(!1)}},c=(h=null)=>{if(h){d(h.id);let _={};if(h.taxas_por_parcela)try{_=typeof h.taxas_por_parcela=="string"?JSON.parse(h.taxas_por_parcela):h.taxas_por_parcela}catch(E){console.error("Erro ao parsear taxas_por_parcela:",E)}k({nome:h.nome,tipo:h.tipo,taxa_percentual:h.taxa_percentual,taxa_fixa:h.taxa_fixa,prazo_dias:h.prazo_dias,operadora:h.operadora||"",operadora_id:h.operadora_id||null,gera_contas_receber:h.gera_contas_receber,split_parcelas:h.split_parcelas,conta_bancaria_destino_id:h.conta_bancaria_destino_id,requer_nsu:h.requer_nsu,tipo_cartao:h.tipo_cartao||"",bandeira:h.bandeira||"",ativo:h.ativo,permite_parcelamento:h.permite_parcelamento,parcelas_maximas:h.parcelas_maximas,taxas_por_parcela:_,permite_antecipacao:h.permite_antecipacao||!1,dias_recebimento_antecipado:h.dias_recebimento_antecipado||null,taxa_antecipacao_percentual:h.taxa_antecipacao_percentual||null,icone:h.icone||"ðŸ’³",cor:h.cor||"#3B82F6"})}else d(null),k({nome:"",tipo:"dinheiro",taxa_percentual:0,taxa_fixa:0,prazo_dias:0,operadora:"",operadora_id:null,gera_contas_receber:!1,split_parcelas:!1,conta_bancaria_destino_id:null,requer_nsu:!1,tipo_cartao:"",bandeira:"",ativo:!0,permite_parcelamento:!1,parcelas_maximas:1,taxas_por_parcela:{},permite_antecipacao:!1,dias_recebimento_antecipado:null,taxa_antecipacao_percentual:null,icone:"ðŸ’³",cor:"#3B82F6"});f(!0)},b=async()=>{try{const h={...x,taxas_por_parcela:Object.keys(x.taxas_por_parcela).length>0?JSON.stringify(x.taxas_por_parcela):null};N?(await F.put(`/financeiro/formas-pagamento/${N}`,h),ce.success("Forma de pagamento atualizada!")):(await F.post("/financeiro/formas-pagamento",h),ce.success("Forma de pagamento criada!")),f(!1),w()}catch(h){console.error("Erro ao salvar:",h),ce.error("Erro ao salvar forma de pagamento")}},p=async h=>{if(confirm("Deseja realmente excluir esta forma de pagamento?"))try{await F.delete(`/financeiro/formas-pagamento/${h}`),ce.success("Forma de pagamento excluÃ­da!"),w()}catch(_){console.error("Erro ao excluir:",_),ce.error("Erro ao excluir forma de pagamento")}},i=[{value:"dinheiro",label:"Dinheiro",icone:"ðŸ’µ"},{value:"cartao_credito",label:"CartÃ£o de CrÃ©dito",icone:"ðŸ’³"},{value:"cartao_debito",label:"CartÃ£o de DÃ©bito",icone:"ðŸ’³"},{value:"pix",label:"PIX",icone:"ðŸ“±"},{value:"boleto",label:"Boleto",icone:"ðŸ“„"},{value:"transferencia",label:"TransferÃªncia",icone:"ðŸ¦"}];return o?e.jsx("div",{className:"flex justify-center items-center h-64",children:"Carregando..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Formas de Pagamento/Recebimento"}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:()=>c(),children:"+ Nova Forma"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nome"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Taxa %"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Taxa Fixa"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Prazo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Conta Destino"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"px-6 py-4 text-center text-gray-500",children:"Nenhuma forma de pagamento cadastrada"})}):s.map(h=>{var _,E,$,K;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:h.icone}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:h.nome}),h.operadora_id&&e.jsx("div",{className:"text-xs text-gray-500",children:((_=r.find(te=>te.id===h.operadora_id))==null?void 0:_.nome)||h.operadora||"Operadora nÃ£o encontrada"})]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:((E=i.find(te=>te.value===h.tipo))==null?void 0:E.label)||h.tipo}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[h.taxa_percentual,"%"]}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:["R$ ",(($=h.taxa_fixa)==null?void 0:$.toFixed(2))||"0.00"]}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[h.prazo_dias," dias"]}),e.jsx("td",{className:"px-6 py-4 text-sm",children:h.conta_bancaria_destino_id?((K=t.find(te=>te.id===h.conta_bancaria_destino_id))==null?void 0:K.nome)||"N/A":e.jsx("span",{className:"text-gray-400",children:"Nenhuma"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${h.ativo?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:h.ativo?"Ativo":"Inativo"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"text-blue-600 hover:text-blue-800",onClick:()=>c(h),children:"âœï¸"}),e.jsx("button",{className:"text-red-600 hover:text-red-800",onClick:()=>p(h.id),children:"ðŸ—‘ï¸"})]})})]},h.id)})})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-6 py-4 flex justify-between items-center sticky top-0",children:[e.jsxs("h3",{className:"text-xl font-semibold",children:[N?"Editar":"Nova"," Forma de Pagamento"]}),e.jsx("button",{onClick:()=>f(!1),className:"text-white hover:bg-blue-700 px-3 py-1 rounded",children:"âœ•"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nome *"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",value:x.nome,onChange:h=>k({...x,nome:h.target.value}),placeholder:"Ex: Dinheiro, PIX, Stone CrÃ©dito..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipo *"}),e.jsx("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:x.tipo,onChange:h=>k({...x,tipo:h.target.value}),children:i.map(h=>e.jsxs("option",{value:h.value,children:[h.icone," ",h.label]},h.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ãcone"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",value:x.icone,onChange:h=>k({...x,icone:h.target.value}),placeholder:"ðŸ’µ",maxLength:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa % (Ex: 2.5%)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:x.taxa_percentual,onChange:h=>k({...x,taxa_percentual:parseFloat(h.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa Fixa (R$)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:x.taxa_fixa,onChange:h=>k({...x,taxa_fixa:parseFloat(h.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Prazo (dias)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",value:x.prazo_dias,onChange:h=>k({...x,prazo_dias:parseInt(h.target.value)||0})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Conta BancÃ¡ria Destino"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:x.conta_bancaria_destino_id||"",onChange:h=>k({...x,conta_bancaria_destino_id:parseInt(h.target.value)||null}),children:[e.jsx("option",{value:"",children:"Selecione..."}),t.map(h=>e.jsx("option",{value:h.id,children:h.nome},h.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Esta conta serÃ¡ usada automaticamente quando esta forma for selecionada em pagamentos/recebimentos"})]}),(x.tipo==="cartao_credito"||x.tipo==="cartao_debito")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Operadora *"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:x.operadora_id||"",onChange:h=>{const _=parseInt(h.target.value)||null,E=r.find(K=>K.id===_);let $=(E==null?void 0:E.max_parcelas)||x.parcelas_maximas;k({...x,operadora_id:_,operadora:(E==null?void 0:E.nome)||"",parcelas_maximas:$})},children:[e.jsx("option",{value:"",children:"Selecione a operadora..."}),r.map(h=>e.jsxs("option",{value:h.id,children:[h.icone," ",h.nome," (atÃ© ",h.max_parcelas,"x)"]},h.id))]}),x.operadora_id&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Limite de parcelas desta operadora: ",(u=r.find(h=>h.id===x.operadora_id))==null?void 0:u.max_parcelas,"x"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Bandeira"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:x.bandeira,onChange:h=>k({...x,bandeira:h.target.value}),children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"visa",children:"Visa"}),e.jsx("option",{value:"master",children:"Mastercard"}),e.jsx("option",{value:"elo",children:"Elo"}),e.jsx("option",{value:"amex",children:"American Express"}),e.jsx("option",{value:"hipercard",children:"Hipercard"})]})]})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.ativo,onChange:h=>k({...x,ativo:h.target.checked})}),e.jsx("span",{className:"text-sm",children:"Ativo"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.gera_contas_receber,onChange:h=>k({...x,gera_contas_receber:h.target.checked})}),e.jsx("span",{className:"text-sm",children:"Gera Contas a Receber (para cartÃµes com prazo)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.requer_nsu,onChange:h=>k({...x,requer_nsu:h.target.checked})}),e.jsx("span",{className:"text-sm",children:"Requer NSU (nÃºmero de transaÃ§Ã£o)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.permite_parcelamento,onChange:h=>k({...x,permite_parcelamento:h.target.checked})}),e.jsx("span",{className:"text-sm",children:"Permite Parcelamento"})]}),x.permite_parcelamento&&e.jsxs("div",{className:"ml-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"MÃ¡ximo de Parcelas"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",min:"1",max:x.operadora_id&&((n=r.find(h=>h.id===x.operadora_id))==null?void 0:n.max_parcelas)||24,value:x.parcelas_maximas,onChange:h=>{const _=parseInt(h.target.value)||1,E=r.find(K=>K.id===x.operadora_id),$=(E==null?void 0:E.max_parcelas)||24;if(_>$){ce.error(`âŒ Esta operadora permite no mÃ¡ximo ${$}x`);return}k({...x,parcelas_maximas:_})}}),x.operadora_id&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["âš ï¸ Limitado a ",(C=r.find(h=>h.id===x.operadora_id))==null?void 0:C.max_parcelas,"x pela operadora selecionada"]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"ðŸ“Š Taxas EspecÃ­ficas por NÃºmero de Parcelas"}),e.jsxs("p",{className:"text-xs text-blue-700 mb-3",children:["Configure taxas diferentes para cada quantidade de parcelas. Se nÃ£o informado, usa a taxa base (",x.taxa_percentual,"%)."]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-48 overflow-y-auto",children:Array.from({length:x.parcelas_maximas},(h,_)=>_+1).map(h=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"text-xs font-medium text-gray-700 w-10",children:[h,"x:"]}),e.jsx("input",{type:"number",step:"0.01",className:"flex-1 border border-gray-300 rounded px-2 py-1 text-sm",placeholder:x.taxa_percentual,value:x.taxas_por_parcela[h]||"",onChange:_=>{const E={...x.taxas_por_parcela};_.target.value?E[h]=parseFloat(_.target.value):delete E[h],k({...x,taxas_por_parcela:E})}}),e.jsx("span",{className:"text-xs text-gray-500",children:"%"})]},h))})]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.permite_antecipacao,onChange:h=>k({...x,permite_antecipacao:h.target.checked})}),e.jsx("span",{className:"text-sm",children:"Permite AntecipaÃ§Ã£o de RecebÃ­veis"})]}),x.permite_antecipacao&&e.jsxs("div",{className:"ml-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Dias para Recebimento Antecipado"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",min:"0",max:"30",value:x.dias_recebimento_antecipado||"",onChange:h=>k({...x,dias_recebimento_antecipado:parseInt(h.target.value)||null}),placeholder:"Ex: 1 (cai em D+1)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Quantos dias apÃ³s a venda o dinheiro cai na conta com antecipaÃ§Ã£o (geralmente D+1)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa de AntecipaÃ§Ã£o (%) - OPCIONAL"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full border border-gray-300 rounded px-3 py-2",value:x.taxa_antecipacao_percentual||"",onChange:h=>k({...x,taxa_antecipacao_percentual:parseFloat(h.target.value)||null}),placeholder:"Ex: 0.50"}),e.jsxs("div",{className:"mt-2 p-3 bg-amber-50 border border-amber-200 rounded",children:[e.jsx("p",{className:"text-xs text-amber-800 font-semibold mb-1",children:"ðŸ’¡ Duas formas de configurar:"}),e.jsxs("p",{className:"text-xs text-amber-700 mb-1",children:[e.jsx("strong",{children:"1. Com taxa de antecipaÃ§Ã£o:"})," Preencha este campo e a taxa serÃ¡ somada automaticamente Ã s taxas por parcela configuradas acima"]}),e.jsxs("p",{className:"text-xs text-amber-700",children:[e.jsx("strong",{children:"2. Sem taxa de antecipaÃ§Ã£o:"})," Deixe vazio e configure nos campos 1x a 12x acima jÃ¡ com o valor final (taxa normal + antecipaÃ§Ã£o somadas)"]})]})]})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 border-t p-4",children:[e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",onClick:()=>f(!1),children:"Cancelar"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:b,children:"âœ“ Salvar"})]})]})})]})},Ii=["ðŸ’³","ðŸ¦","ðŸ’°","ðŸ’µ","ðŸ’¸","ðŸ§","ðŸ’¼","ðŸŽ¯","âš¡","ðŸ”’","âœ¨","ðŸŒŸ","ðŸ“Š","ðŸ’Ž","ðŸŽ","ðŸ”‘","â­","ðŸš€"];function Ti(){const[s,l]=a.useState([]),[t,m]=a.useState(!0),[r,g]=a.useState(!1),[o,v]=a.useState(null),[j,f]=a.useState(""),[N,d]=a.useState(!1),[x,k]=a.useState({nome:"",codigo:"",max_parcelas:12,padrao:!1,ativo:!0,api_enabled:!1,api_endpoint:"",api_token_encrypted:"",cor:"#00A868",icone:"ðŸ’³"});a.useEffect(()=>{w()},[]);const w=async()=>{try{m(!0);const u=await F.get("/operadoras-cartao");l(u.data)}catch(u){console.error("Erro ao carregar operadoras:",u),ce.error("Erro ao carregar operadoras de cartÃ£o")}finally{m(!1)}},c=(u=null)=>{u?(k({nome:u.nome,codigo:u.codigo||"",max_parcelas:u.max_parcelas,padrao:u.padrao,ativo:u.ativo,api_enabled:u.api_enabled,api_endpoint:u.api_endpoint||"",api_token_encrypted:u.api_token_encrypted||"",cor:u.cor||"#00A868",icone:u.icone||"ðŸ’³"}),v(u)):(k({nome:"",codigo:"",max_parcelas:12,padrao:!1,ativo:!0,api_enabled:!1,api_endpoint:"",api_token_encrypted:"",cor:"#00A868",icone:"ðŸ’³"}),v(null)),g(!0),f(""),d(!1)},b=async u=>{var n,C,h,_,E,$;if(u.preventDefault(),!x.nome.trim()){ce.error("Nome da operadora Ã© obrigatÃ³rio");return}if(x.max_parcelas<1||x.max_parcelas>24){ce.error("Parcelas devem estar entre 1 e 24");return}try{const K={...x,nome:x.nome.trim(),codigo:((C=(n=x.codigo)==null?void 0:n.trim())==null?void 0:C.toUpperCase())||null,api_endpoint:((h=x.api_endpoint)==null?void 0:h.trim())||null,api_token_encrypted:((_=x.api_token_encrypted)==null?void 0:_.trim())||null};o?(await F.put(`/operadoras-cartao/${o.id}`,K),ce.success("Operadora atualizada com sucesso!")):(await F.post("/operadoras-cartao",K),ce.success("Operadora criada com sucesso!")),g(!1),w()}catch(K){console.error("Erro ao salvar:",K);const te=(($=(E=K.response)==null?void 0:E.data)==null?void 0:$.detail)||"Erro ao salvar operadora";ce.error(te),f(te)}},p=async u=>{var n,C;if(window.confirm("Deseja realmente excluir esta operadora? Ela serÃ¡ desativada se houver vendas vinculadas."))try{await F.delete(`/operadoras-cartao/${u}`),ce.success("Operadora removida com sucesso!"),w()}catch(h){console.error("Erro ao excluir:",h);const _=((C=(n=h.response)==null?void 0:n.data)==null?void 0:C.detail)||"Erro ao excluir operadora";ce.error(_)}},i=()=>{const u=s.find(n=>n.padrao&&n.ativo);return u?e.jsx("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:e.jsx(Ao,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-emerald-900",children:"Operadora PadrÃ£o"}),e.jsxs("p",{className:"text-sm text-emerald-700",children:[e.jsx("span",{className:"font-medium",children:u.nome})," serÃ¡ prÃ©-selecionada no PDV"]})]})]})}):null};return t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Operadoras de CartÃ£o"}),e.jsx("p",{className:"text-gray-600",children:"Configure as operadoras de cartÃ£o disponÃ­veis (Stone, Cielo, Rede, Getnet, etc)"})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ra,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-amber-900 mb-1",children:"Importante"}),e.jsxs("ul",{className:"text-sm text-amber-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Pelo menos uma operadora deve estar marcada como padrÃ£o e ativa"}),e.jsx("li",{children:"â€¢ O PDV usarÃ¡ a operadora padrÃ£o automaticamente para vendas com cartÃ£o"}),e.jsx("li",{children:"â€¢ Operadoras com vendas vinculadas nÃ£o podem ser excluÃ­das (apenas desativadas)"})]})]})]})}),i(),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>c(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 transition-colors",children:[e.jsx(rs,{className:"w-4 h-4"}),"Nova Operadora"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(u=>{const n=u.icone&&!u.icone.startsWith("Fi")&&!u.icone.startsWith("Bi")?u.icone:"ðŸ’³";return e.jsxs("div",{className:`border rounded-lg p-4 hover:shadow-md transition-shadow ${u.ativo?"bg-white border-gray-200":"bg-gray-50 border-gray-300"} ${u.padrao?"ring-2 ring-emerald-500":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-2xl",style:{backgroundColor:`${u.cor}20`},children:n}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[u.nome,u.padrao&&e.jsx("span",{className:"text-xs bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full",children:"PadrÃ£o"})]}),u.codigo&&e.jsx("p",{className:"text-xs text-gray-500 font-mono",children:u.codigo})]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${u.ativo?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"}`,children:u.ativo?"Ativo":"Inativo"})]}),e.jsxs("div",{className:"space-y-2 mb-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Parcelas mÃ¡ximas:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[u.max_parcelas,"x"]})]}),u.api_enabled&&e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-200",children:e.jsxs("span",{className:"text-xs text-blue-600 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-600 rounded-full"}),"API Integrada"]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>c(u),className:"flex-1 bg-blue-50 text-blue-600 px-3 py-2 rounded hover:bg-blue-100 flex items-center justify-center gap-2 transition-colors text-sm",children:[e.jsx(Sr,{className:"w-4 h-4"}),"Editar"]}),e.jsxs("button",{onClick:()=>p(u.id),className:"flex-1 bg-red-50 text-red-600 px-3 py-2 rounded hover:bg-red-100 flex items-center justify-center gap-2 transition-colors text-sm",children:[e.jsx(gs,{className:"w-4 h-4"}),"Excluir"]})]})]},u.id)})}),s.length===0&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx(ot,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Nenhuma operadora cadastrada"}),e.jsx("p",{className:"text-sm text-gray-500",children:'Clique em "Nova Operadora" para comeÃ§ar'})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between sticky top-0 bg-white z-10",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:o?"Editar Operadora":"Nova Operadora"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(ma,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6",children:[j&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2",children:[e.jsx(da,{className:"w-4 h-4 text-red-600 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-red-700",children:j})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"InformaÃ§Ãµes BÃ¡sicas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Operadora *"}),e.jsx("input",{type:"text",value:x.nome,onChange:u=>k({...x,nome:u.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ex: Stone, Cielo, Rede",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CÃ³digo (sigla)"}),e.jsx("input",{type:"text",value:x.codigo,onChange:u=>k({...x,codigo:u.target.value.toUpperCase()}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono",placeholder:"Ex: STONE, CIELO",maxLength:50})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"MÃ¡ximo de Parcelas *"}),e.jsx("input",{type:"number",value:x.max_parcelas,onChange:u=>k({...x,max_parcelas:parseInt(u.target.value)||1}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1",max:"24",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Entre 1 e 24 parcelas"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.padrao,onChange:u=>k({...x,padrao:u.target.checked}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Operadora PadrÃ£o"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.ativo,onChange:u=>k({...x,ativo:u.target.checked}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Ativo"})]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Interface"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cor"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:x.cor,onChange:u=>k({...x,cor:u.target.value}),className:"w-16 h-10 border border-gray-300 rounded cursor-pointer"}),e.jsx("input",{type:"text",value:x.cor,onChange:u=>k({...x,cor:u.target.value}),className:"flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono",placeholder:"#00A868"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ãcone"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ii.map(u=>e.jsx("button",{type:"button",onClick:()=>k({...x,icone:u}),className:`w-10 h-10 rounded flex items-center justify-center text-xl transition-colors ${x.icone===u?"bg-blue-100 ring-2 ring-blue-500":"bg-gray-100 hover:bg-gray-200"}`,children:u},u))})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"IntegraÃ§Ã£o API (Opcional)"}),e.jsxs("label",{className:"flex items-center gap-2 mb-4 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.api_enabled,onChange:u=>k({...x,api_enabled:u.target.checked}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Habilitar integraÃ§Ã£o via API"})]}),x.api_enabled&&e.jsxs("div",{className:"space-y-4 pl-6 border-l-2 border-blue-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Endpoint da API"}),e.jsx("input",{type:"url",value:x.api_endpoint,onChange:u=>k({...x,api_endpoint:u.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm",placeholder:"https://api.operadora.com/v1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Token de Acesso"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:N?"text":"password",value:x.api_token_encrypted,onChange:u=>k({...x,api_token_encrypted:u.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm",placeholder:"Token serÃ¡ criptografado ao salvar"}),e.jsx("button",{type:"button",onClick:()=>d(!N),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:N?e.jsx(Zt,{className:"w-4 h-4"}):e.jsx(Nt,{className:"w-4 h-4"})})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>g(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 transition-colors",children:[e.jsx(_t,{className:"w-4 h-4"}),o?"Salvar AlteraÃ§Ãµes":"Criar Operadora"]})]})]})]})})]})}const Vi=({isOpen:s,onClose:l,contexto:t})=>{const[m,r]=a.useState([]),[g,o]=a.useState(""),[v,j]=a.useState(!1),f=a.useRef(null);a.useEffect(()=>{s&&m.length===0&&r([{tipo:"ia",conteudo:`OlÃ¡! Sou seu especialista financeiro com IA. Analisando seu ${(t==null?void 0:t.tipo)||"relatÃ³rio"}...

Posso ajudar com:
â€¢ AnÃ¡lise de resultados
â€¢ SugestÃµes de melhoria
â€¢ ComparaÃ§Ãµes de perÃ­odos
â€¢ ProjeÃ§Ãµes financeiras

O que deseja saber?`,timestamp:new Date}])},[s,m.length,t]),a.useEffect(()=>{N()},[m]);const N=()=>{var c;(c=f.current)==null||c.scrollIntoView({behavior:"smooth"})},d=async()=>{if(!g.trim())return;const c={tipo:"usuario",conteudo:g,timestamp:new Date};r(b=>[...b,c]),o(""),j(!0);try{const p={tipo:"ia",conteudo:(await F.post("/ia/chat",{mensagem:g,contexto:t})).data.resposta,timestamp:new Date};r(i=>[...i,p])}catch(b){console.error("Erro ao enviar mensagem:",b);const p={tipo:"ia",conteudo:"Desculpe, houve um erro ao processar sua mensagem. Tente novamente.",timestamp:new Date};r(i=>[...i,p])}finally{j(!1)}},x=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),d())},k=["Como melhorar minha margem de lucro?","Quais sÃ£o os principais gastos?","Compare com o mÃªs anterior","HÃ¡ despesas atÃ­picas?"],w=c=>{o(c)};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl h-[600px] flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-4 rounded-t-2xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white bg-opacity-20 p-2 rounded-lg",children:e.jsx(ms,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Especialista Financeiro IA"}),e.jsx("p",{className:"text-sm text-purple-100",children:"AnÃ¡lise inteligente dos seus dados"})]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(ma,{size:24})})]}),t&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-indigo-200 p-3",children:e.jsxs("div",{className:"text-sm text-indigo-800",children:["ðŸ“Š Analisando: ",e.jsx("span",{className:"font-semibold",children:t.tipo}),t.periodo&&e.jsxs("span",{className:"ml-2",children:["â€¢ ",t.periodo]}),t.valor&&e.jsxs("span",{className:"ml-2",children:["â€¢ Valor: R$ ",t.valor.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[m.map((c,b)=>e.jsx("div",{className:`flex ${c.tipo==="usuario"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-2xl p-4 ${c.tipo==="usuario"?"bg-gradient-to-r from-purple-600 to-indigo-600 text-white":"bg-gray-100 text-gray-800"}`,children:[c.tipo==="ia"&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(qo,{size:16,className:"text-purple-600"}),e.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"IA Especialista"})]}),e.jsx("p",{className:"whitespace-pre-wrap",children:c.conteudo}),e.jsx("span",{className:"text-xs opacity-70 mt-2 block",children:c.timestamp.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})})]})},b)),v&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-100 rounded-2xl p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(nt,{className:"animate-spin text-purple-600",size:20}),e.jsx("span",{className:"text-gray-600",children:"Analisando..."})]})})}),e.jsx("div",{ref:f})]}),m.length<=1&&e.jsxs("div",{className:"border-t border-gray-200 p-3 bg-gray-50",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2 font-medium",children:"ðŸ’¡ SugestÃµes de perguntas:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.map((c,b)=>e.jsx("button",{onClick:()=>w(c),className:"text-xs px-3 py-1.5 bg-white border border-purple-200 text-purple-700 rounded-full hover:bg-purple-50 transition-colors",children:c},b))})]}),e.jsx("div",{className:"border-t border-gray-200 p-4 bg-white rounded-b-2xl",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:g,onChange:c=>o(c.target.value),onKeyPress:x,placeholder:"Digite sua pergunta...",disabled:v,className:"flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent disabled:bg-gray-100"}),e.jsx("button",{onClick:d,disabled:!g.trim()||v,className:"px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl hover:from-purple-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2",children:e.jsx(zo,{size:20})})]})})]})}):null},Oi=()=>{const[s,l]=a.useState([]),[t,m]=a.useState(!0),[r,g]=a.useState(30),[o,v]=a.useState({media:0,desvio:0});a.useEffect(()=>{j()},[r]);const j=async()=>{m(!0);try{const c=await f();l(c)}catch(c){console.error("Erro ao carregar projeÃ§Ãµes:",c)}finally{m(!1)}},f=async()=>{const c=new Date,b=new Date;b.setDate(b.getDate()-90);try{const i=(await F.get("/financeiro/movimentacoes",{params:{data_inicio:b.toISOString().split("T")[0],data_fim:c.toISOString().split("T")[0]}})).data,u=N(i,"entrada"),n=N(i,"saida"),C=await d(),h=[];let _=C;for(let E=1;E<=r;E++){const $=new Date;$.setDate($.getDate()+E);const K=u*(.8+Math.random()*.4),te=n*(.8+Math.random()*.4),M=K,A=te;_=_+M-A;const Q=Math.max(95-E*1.5,50);h.push({data:$.toISOString().split("T")[0],dataFormatada:$.toLocaleDateString("pt-BR"),entradasProjetadas:M,saidasProjetadas:A,saldoProjetado:_,nivelConfianca:Q,diaSemana:$.toLocaleDateString("pt-BR",{weekday:"short"}),alerta:_<1e3?"crÃ­tico":_<5e3?"atenÃ§Ã£o":null})}return h}catch(p){return console.error("Erro ao gerar projeÃ§Ãµes:",p),[]}},N=(c,b)=>{const p=c.filter(u=>u.tipo===b);return p.length===0?0:p.reduce((u,n)=>u+n.valor,0)/90},d=async()=>{try{return(await F.get("/financeiro/saldo-atual")).data.saldo||1e4}catch(c){return console.error("Erro ao buscar saldo:",c),1e4}},x=c=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c),k=c=>c==="crÃ­tico"?"bg-red-100 border-red-300 text-red-800":c==="atenÃ§Ã£o"?"bg-yellow-100 border-yellow-300 text-yellow-800":"bg-green-50 border-green-200",w=()=>{var b,p,i;const c=[];for(let u=0;u<s.length;u+=7){const n=s.slice(u,u+7),C=n.reduce((E,$)=>E+$.entradasProjetadas,0),h=n.reduce((E,$)=>E+$.saidasProjetadas,0),_=((b=n[n.length-1])==null?void 0:b.saldoProjetado)||0;c.push({numero:Math.floor(u/7)+1,dataInicio:(p=n[0])==null?void 0:p.dataFormatada,dataFim:(i=n[n.length-1])==null?void 0:i.dataFormatada,entradas:C,saidas:h,saldo:h-C,saldoFinal:_})}return c};return t?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ms,{className:"w-6 h-6 text-purple-600 animate-spin"}),e.jsx("span",{className:"text-gray-600",children:"Calculando projeÃ§Ãµes..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 rounded-lg p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Aa,{className:"w-6 h-6"}),"ProjeÃ§Ãµes de Fluxo de Caixa"]}),e.jsx("p",{className:"text-purple-100 mt-1",children:"PrevisÃµes baseadas em padrÃµes histÃ³ricos e tendÃªncias"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g(15),className:`px-4 py-2 rounded-lg font-medium transition-colors ${r===15?"bg-white text-purple-600":"bg-purple-500 text-white hover:bg-purple-400"}`,children:"15 dias"}),e.jsx("button",{onClick:()=>g(30),className:`px-4 py-2 rounded-lg font-medium transition-colors ${r===30?"bg-white text-purple-600":"bg-purple-500 text-white hover:bg-purple-400"}`,children:"30 dias"}),e.jsx("button",{onClick:()=>g(60),className:`px-4 py-2 rounded-lg font-medium transition-colors ${r===60?"bg-white text-purple-600":"bg-purple-500 text-white hover:bg-purple-400"}`,children:"60 dias"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Cs,{className:"w-5 h-5 text-indigo-600"}),"Resumo Semanal"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:w().map(c=>e.jsxs("div",{className:`border rounded-lg p-4 ${c.saldoFinal<5e3?"border-yellow-300 bg-yellow-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"text-sm font-medium text-gray-600 mb-2",children:["Semana ",c.numero]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-3",children:[c.dataInicio," - ",c.dataFim]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-600",children:"Entradas:"}),e.jsx("span",{className:"font-medium",children:x(c.entradas)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-red-600",children:"SaÃ­das:"}),e.jsx("span",{className:"font-medium",children:x(c.saidas)})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-semibold",children:[e.jsx("span",{children:"Saldo Final:"}),e.jsx("span",{className:c.saldoFinal<5e3?"text-yellow-600":"text-gray-800",children:x(c.saldoFinal)})]})]})]},c.numero))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(La,{className:"w-5 h-5 text-green-600"}),"ProjeÃ§Ãµes DiÃ¡rias Detalhadas"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:"Data"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:"Dia"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-gray-700",children:"Entradas"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-gray-700",children:"SaÃ­das"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-gray-700",children:"Saldo Projetado"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-gray-700",children:"ConfianÃ§a"})]})}),e.jsx("tbody",{children:s.map((c,b)=>e.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 ${c.alerta?k(c.alerta):""}`,children:[e.jsx("td",{className:"py-3 px-4 text-sm",children:c.dataFormatada}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:c.diaSemana}),e.jsx("td",{className:"py-3 px-4 text-sm text-right text-green-600 font-medium",children:x(c.entradasProjetadas)}),e.jsx("td",{className:"py-3 px-4 text-sm text-right text-red-600 font-medium",children:x(c.saidasProjetadas)}),e.jsx("td",{className:"py-3 px-4 text-sm text-right font-semibold",children:x(c.saldoProjetado)}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${c.nivelConfianca>=80?"bg-green-100 text-green-800":c.nivelConfianca>=65?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800"}`,children:[c.nivelConfianca.toFixed(0),"%"]})})]},b))})]})})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(da,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Sobre as ProjeÃ§Ãµes"}),e.jsx("p",{children:"As projeÃ§Ãµes sÃ£o calculadas com base em padrÃµes histÃ³ricos dos Ãºltimos 90 dias. O nÃ­vel de confianÃ§a diminui com o tempo, pois eventos futuros podem alterar as tendÃªncias."})]})]})]})},Bi=()=>{const[s,l]=a.useState([]),[t,m]=a.useState(!0),[r,g]=a.useState("todos");a.useEffect(()=>{o()},[]);const o=async()=>{m(!0);try{const i=await v();l(i)}catch(i){console.error("Erro ao carregar alertas:",i)}finally{m(!1)}},v=async()=>{const i=[],u=new Date;try{const n=await j();n<1e3?i.push({id:"saldo-critico",tipo:"saldo",severidade:"crÃ­tico",titulo:"Saldo CrÃ­tico",mensagem:`Seu saldo estÃ¡ abaixo de R$ 1.000,00. Saldo atual: ${w(n)}`,recomendacao:"Considere adiar pagamentos nÃ£o essenciais ou antecipar recebimentos.",icone:Ra,data:u.toISOString()}):n<5e3&&i.push({id:"saldo-atencao",tipo:"saldo",severidade:"atenÃ§Ã£o",titulo:"Saldo Baixo",mensagem:`Seu saldo estÃ¡ em nÃ­vel de atenÃ§Ã£o: ${w(n)}`,recomendacao:"Monitore suas despesas e prepare-se para possÃ­veis necessidades de caixa.",icone:da,data:u.toISOString()});const C=await f(7);if(C.length>0){const K=C.reduce((te,M)=>te+M.valor,0);i.push({id:"vencimentos-proximos",tipo:"vencimento",severidade:"atenÃ§Ã£o",titulo:`${C.length} Pagamentos Vencendo`,mensagem:`VocÃª tem ${C.length} pagamentos vencendo nos prÃ³ximos 7 dias, totalizando ${w(K)}`,recomendacao:"Verifique se hÃ¡ saldo suficiente para cobrir estes pagamentos.",icone:Cs,data:u.toISOString(),detalhes:C})}const h=await N();if(h.length>0){const K=h.reduce((te,M)=>te+M.valor,0);i.push({id:"vencimentos-atrasados",tipo:"atraso",severidade:"crÃ­tico",titulo:`${h.length} Pagamentos Atrasados`,mensagem:`VocÃª tem ${h.length} pagamentos em atraso, totalizando ${w(K)}`,recomendacao:"Priorize a quitaÃ§Ã£o destes dÃ©bitos para evitar juros e multas.",icone:Ra,data:u.toISOString(),detalhes:h})}const _=await d();_.variacao>30&&i.push({id:"gastos-anormais",tipo:"anomalia",severidade:"atenÃ§Ã£o",titulo:"Gastos Acima do Normal",mensagem:`Suas despesas aumentaram ${_.variacao.toFixed(0)}% em relaÃ§Ã£o Ã  mÃ©dia histÃ³rica`,recomendacao:"Revise seus gastos recentes e identifique possÃ­veis despesas extraordinÃ¡rias.",icone:Aa,data:u.toISOString(),detalhes:_});const E=await x();E.length>0&&i.push({id:"recorrencias-pendentes",tipo:"recorrencia",severidade:"info",titulo:"Despesas Recorrentes PrÃ³ximas",mensagem:`${E.length} despesas recorrentes vencerÃ£o em breve`,recomendacao:"Certifique-se de que hÃ¡ saldo para cobrir estas despesas automÃ¡ticas.",icone:Ts,data:u.toISOString(),detalhes:E});const $=await k(15);return $.diasAteNegativo>0&&i.push({id:"projecao-negativa",tipo:"projecao",severidade:"crÃ­tico",titulo:"Risco de Saldo Negativo",mensagem:`Com o padrÃ£o atual, seu saldo pode ficar negativo em ${$.diasAteNegativo} dias`,recomendacao:"Tome medidas urgentes para aumentar receitas ou reduzir despesas.",icone:Va,data:u.toISOString(),detalhes:$}),i.sort((K,te)=>{const M={crÃ­tico:0,atenÃ§Ã£o:1,info:2};return M[K.severidade]-M[te.severidade]})}catch(n){return console.error("Erro ao gerar alertas:",n),[]}},j=async()=>{try{return(await F.get("/financeiro/saldo-atual")).data.saldo||1e4}catch{return 1e4}},f=async i=>{try{const u=new Date,n=new Date;return n.setDate(n.getDate()+i),(await F.get("/financeiro/contas-pagar",{params:{data_inicio:u.toISOString().split("T")[0],data_fim:n.toISOString().split("T")[0],status:"pendente"}})).data||[]}catch{return[]}},N=async()=>{try{return(await F.get("/financeiro/contas-pagar",{params:{atrasadas:!0}})).data||[]}catch{return[]}},d=async()=>{try{const i=new Date,u=new Date;return u.setDate(u.getDate()-30),(await F.get("/financeiro/analise-gastos",{params:{data_inicio:u.toISOString().split("T")[0],data_fim:i.toISOString().split("T")[0]}})).data||{variacao:0}}catch{return{variacao:0}}},x=async()=>{try{return(await F.get("/financeiro/recorrencias-proximas")).data||[]}catch{return[]}},k=async i=>{try{return(await F.get("/ia/fluxo/projecao-saldo",{params:{dias:i}})).data||{diasAteNegativo:0}}catch{return{diasAteNegativo:0}}},w=i=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i),c=i=>{l(s.filter(u=>u.id!==i))},b=i=>{switch(i){case"crÃ­tico":return{bg:"bg-red-50",border:"border-red-300",text:"text-red-800",badge:"bg-red-100 text-red-800"};case"atenÃ§Ã£o":return{bg:"bg-yellow-50",border:"border-yellow-300",text:"text-yellow-800",badge:"bg-yellow-100 text-yellow-800"};case"info":return{bg:"bg-blue-50",border:"border-blue-300",text:"text-blue-800",badge:"bg-blue-100 text-blue-800"};default:return{bg:"bg-gray-50",border:"border-gray-300",text:"text-gray-800",badge:"bg-gray-100 text-gray-800"}}},p=s.filter(i=>r==="todos"?!0:i.severidade===r);return t?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ms,{className:"w-6 h-6 text-purple-600 animate-spin"}),e.jsx("span",{className:"text-gray-600",children:"Analisando alertas..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-red-600 rounded-lg p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Ra,{className:"w-6 h-6"}),"Alertas Inteligentes"]}),e.jsx("p",{className:"text-orange-100 mt-1",children:"Avisos automÃ¡ticos sobre situaÃ§Ãµes que requerem atenÃ§Ã£o"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>g("todos"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${r==="todos"?"bg-white text-orange-600":"bg-orange-500 text-white hover:bg-orange-400"}`,children:["Todos (",s.length,")"]}),e.jsxs("button",{onClick:()=>g("crÃ­tico"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${r==="crÃ­tico"?"bg-white text-orange-600":"bg-orange-500 text-white hover:bg-orange-400"}`,children:["CrÃ­ticos (",s.filter(i=>i.severidade==="crÃ­tico").length,")"]})]})]})}),p.length===0?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-8 text-center",children:[e.jsx(ha,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),e.jsx("h4",{className:"text-lg font-semibold text-green-800 mb-2",children:"Tudo em ordem!"}),e.jsx("p",{className:"text-green-700",children:"NÃ£o hÃ¡ alertas no momento. Seu fluxo de caixa estÃ¡ saudÃ¡vel."})]}):e.jsx("div",{className:"space-y-4",children:p.map(i=>{const u=b(i.severidade),n=i.icone;return e.jsx("div",{className:`${u.bg} border ${u.border} rounded-lg p-5 transition-all hover:shadow-md`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`${u.text} mt-1`,children:e.jsx(n,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:`font-semibold ${u.text}`,children:i.titulo}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${u.badge}`,children:i.severidade})]}),e.jsx("p",{className:`text-sm mb-3 ${u.text}`,children:i.mensagem}),e.jsxs("div",{className:"bg-white bg-opacity-50 rounded-lg p-3 mb-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"ðŸ’¡ RecomendaÃ§Ã£o:"}),e.jsx("p",{className:"text-sm text-gray-600",children:i.recomendacao})]}),i.detalhes&&e.jsxs("details",{className:"text-sm",children:[e.jsx("summary",{className:"cursor-pointer font-medium text-gray-700 hover:text-gray-900",children:"Ver detalhes"}),e.jsx("div",{className:"mt-2 pl-4 border-l-2 border-gray-300",children:e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap",children:JSON.stringify(i.detalhes,null,2)})})]})]})]}),e.jsx("button",{onClick:()=>c(i.id),className:"ml-4 text-gray-400 hover:text-gray-600 transition-colors",title:"Marcar como resolvido",children:e.jsx(ma,{className:"w-5 h-5"})})]})},i.id)})})]})},Ui=()=>{fa();const[s,l]=a.useState(!1),[t,m]=a.useState(null),[r,g]=a.useState("movimentacoes"),[o,v]=a.useState(!1),j=()=>{const A=new Date,Q=A.getFullYear(),re=String(A.getMonth()+1).padStart(2,"0"),q=String(A.getDate()).padStart(2,"0");return`${Q}-${re}-${q}`},f=()=>{const A=new Date,Q=A.getFullYear(),re=String(A.getMonth()+1).padStart(2,"0");return`${Q}-${re}-01`},[N,d]=a.useState({data_inicio:f(),data_fim:j(),conta_bancaria_id:null,agrupamento:"dia"}),[x,k]=a.useState("todos"),[w,c]=a.useState("todos"),[b,p]=a.useState([]),[i,u]=a.useState(null),[n,C]=a.useState(!1),[h,_]=a.useState("");a.useEffect(()=>{E(),$()},[]);const E=async()=>{try{const A=await F.get("/contas-bancarias");p(A.data)}catch(A){console.error("Erro ao carregar contas bancÃ¡rias:",A)}},$=async()=>{var A,Q;l(!0);try{const re=new URLSearchParams({data_inicio:N.data_inicio,data_fim:N.data_fim,agrupamento:N.agrupamento});N.conta_bancaria_id&&re.append("conta_bancaria_id",N.conta_bancaria_id),h&&re.append("numero_venda",h);const q=await F.get(`/financeiro/fluxo-caixa?${re}`);m(q.data)}catch(re){console.error("Erro ao carregar fluxo de caixa:",re),alert("Erro ao carregar fluxo de caixa: "+(((Q=(A=re.response)==null?void 0:A.data)==null?void 0:Q.detail)||re.message))}finally{l(!1)}},K=A=>{const Q=new Date;let re,q;switch(A){case"7dias":re=new Date(Q.setDate(Q.getDate()-7)),q=new Date;break;case"30dias":re=new Date(Q.setDate(Q.getDate()-30)),q=new Date;break;case"mes_atual":re=new Date(Q.getFullYear(),Q.getMonth(),1),q=new Date(Q.getFullYear(),Q.getMonth()+1,0);break;case"proximo_mes":re=new Date(Q.getFullYear(),Q.getMonth()+1,1),q=new Date(Q.getFullYear(),Q.getMonth()+2,0);break;default:return}const Z={...N,data_inicio:re.toISOString().split("T")[0],data_fim:q.toISOString().split("T")[0]};d(Z),setTimeout(()=>$(),100)},te=A=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(A||0),M=A=>t?t.movimentacoes.filter(Q=>{const re=new Date(Q.data),q=new Date(A.data_inicio),Z=new Date(A.data_fim);if(!(re>=q&&re<=Z)||x==="entradas"&&Q.tipo!=="credito"||x==="saidas"&&Q.tipo!=="debito"||w==="realizado"&&Q.status!=="realizado"||w==="previsto"&&Q.status!=="previsto")return!1;if(h){const J=Q.descricao||"",S=Q.numero_venda||"",P=h.toLowerCase();return S.toLowerCase().includes(P)||J.toLowerCase().includes(P)}return!0}):[];return s&&!t?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Fa,{className:"animate-spin mx-auto mb-4",size:48}),e.jsx("p",{className:"text-gray-600",children:"Carregando fluxo de caixa..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"ðŸ’¹ Fluxo de Caixa"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"VisÃ£o completa: Previsto vs Realizado"}),e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"âœ¨ Os lanÃ§amentos sÃ£o criados automaticamente a partir de Contas a Pagar e Contas a Receber"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ”¢ Buscar por NÃºmero da Venda"}),e.jsx("input",{type:"text",placeholder:"Digite o nÃºmero da venda (ex: 202601100007) e pressione Enter",className:"w-full px-3 py-2 border border-gray-300 rounded-md",value:h,onChange:A=>_(A.target.value),onKeyPress:A=>{A.key==="Enter"&&$()}})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"VisualizaÃ§Ã£o"}),e.jsxs("select",{value:N.agrupamento,onChange:A=>d({...N,agrupamento:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"dia",children:"ðŸ“… DiÃ¡rio"}),e.jsx("option",{value:"semana",children:"ðŸ“Š Semanal"}),e.jsx("option",{value:"mes",children:"ðŸ“ˆ Mensal"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de MovimentaÃ§Ã£o"}),e.jsxs("select",{value:x,onChange:A=>k(A.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"todos",children:"ðŸ“Š Todas"}),e.jsx("option",{value:"entradas",children:"ðŸ’° Apenas Entradas"}),e.jsx("option",{value:"saidas",children:"ðŸ’¸ Apenas SaÃ­das"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:w,onChange:A=>c(A.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"todos",children:"ðŸ“‹ Todos"}),e.jsx("option",{value:"realizado",children:"âœ… Apenas Realizados"}),e.jsx("option",{value:"previsto",children:"ðŸ“… Apenas Previstos"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:N.data_inicio,onChange:A=>d({...N,data_inicio:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:N.data_fim,onChange:A=>d({...N,data_fim:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Conta BancÃ¡ria"}),e.jsxs("select",{value:N.conta_bancaria_id||"",onChange:A=>d({...N,conta_bancaria_id:A.target.value||null}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Todas as Contas"}),_a(b).map(A=>e.jsx("option",{value:A.id,children:A.nome},A.id))]})]}),e.jsx("div",{className:"flex items-end gap-2",children:e.jsxs("button",{onClick:$,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(Fa,{size:18}),"Atualizar"]})})]}),(x!=="todos"||w!=="todos")&&e.jsxs("div",{className:"mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-blue-800 font-medium",children:"ðŸ” Filtros ativos:"}),x!=="todos"&&e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:x==="entradas"?"ðŸ’° Apenas Entradas":"ðŸ’¸ Apenas SaÃ­das"}),w!=="todos"&&e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:w==="realizado"?"âœ… Apenas Realizados":"ðŸ“… Apenas Previstos"})]}),e.jsx("button",{onClick:()=>{k("todos"),c("todos")},className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Limpar filtros"})]}),e.jsxs("div",{className:"flex gap-2 mt-3 flex-wrap items-center",children:[e.jsx("button",{onClick:()=>K("7dias"),className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded",children:"Ãšltimos 7 dias"}),e.jsx("button",{onClick:()=>K("30dias"),className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded",children:"Ãšltimos 30 dias"}),e.jsx("button",{onClick:()=>K("mes_atual"),className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded",children:"MÃªs Atual"}),e.jsx("button",{onClick:()=>K("proximo_mes"),className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded",children:"PrÃ³ximo MÃªs"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 bg-blue-50 px-3 py-2 rounded border border-blue-200",children:[e.jsx("input",{type:"checkbox",id:"apenasComLancamentos",checked:n,onChange:A=>C(A.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"apenasComLancamentos",className:"text-sm font-medium text-blue-700 cursor-pointer",children:"ðŸ“Š Apenas dias com lanÃ§amentos"})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[e.jsxs("button",{onClick:()=>g("movimentacoes"),className:`flex items-center gap-2 px-6 py-4 border-b-2 font-medium transition-colors ${r==="movimentacoes"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(La,{className:"w-5 h-5"}),"MovimentaÃ§Ãµes"]}),e.jsxs("button",{onClick:()=>g("projecoes"),className:`flex items-center gap-2 px-6 py-4 border-b-2 font-medium transition-colors ${r==="projecoes"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(kt,{className:"w-5 h-5"}),"ProjeÃ§Ãµes IA",e.jsx(ms,{className:"w-4 h-4"})]}),e.jsxs("button",{onClick:()=>g("alertas"),className:`flex items-center gap-2 px-6 py-4 border-b-2 font-medium transition-colors ${r==="alertas"?"border-orange-600 text-orange-600":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(Ra,{className:"w-5 h-5"}),"Alertas IA",e.jsx(ms,{className:"w-4 h-4"})]})]})})}),r==="projecoes"&&e.jsx(Oi,{}),r==="alertas"&&e.jsx(Bi,{}),r==="movimentacoes"&&t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Saldo Inicial"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:te(t.saldo_inicial)})]}),e.jsx(La,{className:"text-blue-500",size:32})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-4 border-l-4 border-green-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Total Realizado (Entradas)"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:te(t.total_realizado_entradas)}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["Previsto: ",te(t.total_previsto_entradas)]})]}),e.jsx(Aa,{className:"text-green-500",size:32})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg p-4 border-l-4 border-red-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Total Realizado (SaÃ­das)"}),e.jsx("p",{className:"text-2xl font-bold text-red-700",children:te(t.total_realizado_saidas)}),e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Previsto: ",te(t.total_previsto_saidas)]})]}),e.jsx(Va,{className:"text-red-500",size:32})]})}),e.jsx("div",{className:`rounded-lg p-4 border-l-4 ${t.saldo_final>=0?"bg-blue-50 border-blue-500":"bg-red-50 border-red-500"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:t.saldo_final>=0?"#2563eb":"#dc2626"},children:"Saldo Final Realizado"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:t.saldo_final>=0?"#1d4ed8":"#b91c1c"},children:te(t.saldo_final)}),e.jsxs("p",{className:"text-xs mt-1",style:{color:t.saldo_final>=0?"#2563eb":"#dc2626"},children:["Previsto: ",te(t.saldo_previsto_final)]})]}),e.jsx(La,{className:t.saldo_final>=0?"text-blue-500":"text-red-500",size:32})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsxs("thead",{className:"bg-gray-50",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PerÃ­odo"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider bg-green-50",colSpan:"2",children:"ðŸ’° Entradas"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider bg-red-50",colSpan:"2",children:"ðŸ’¸ SaÃ­das"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider bg-blue-50",children:"ðŸ’µ Saldo Final"}),e.jsx("th",{className:"px-6 py-3"})]}),e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"px-6 py-2"}),e.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 bg-green-50",children:"Previsto"}),e.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 bg-green-100",children:"Realizado"}),e.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 bg-red-50",children:"Previsto"}),e.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 bg-red-100",children:"Realizado"}),e.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 bg-blue-50",children:"Real / Previsto"}),e.jsx("th",{className:"px-4 py-2"})]})]}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:_a(t==null?void 0:t.periodos).length>0?_a(t==null?void 0:t.periodos).filter(A=>n?A.realizado_entradas>0||A.realizado_saidas>0||A.previsto_entradas>0||A.previsto_saidas>0:!0).map((A,Q)=>{const re=M(A),q=A.data,Z=i===q;return e.jsxs(ts.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:A.data}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-600 text-right bg-green-50",children:te(A.previsto_entradas)}),e.jsx("td",{className:"px-4 py-4 text-sm font-bold text-green-700 text-right bg-green-100",children:te(A.realizado_entradas)}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-600 text-right bg-red-50",children:te(A.previsto_saidas)}),e.jsx("td",{className:"px-4 py-4 text-sm font-bold text-red-700 text-right bg-red-100",children:te(A.realizado_saidas)}),e.jsxs("td",{className:"px-4 py-4 text-sm text-center bg-blue-50",children:[e.jsx("div",{className:`font-bold ${A.realizado_saldo>=0?"text-green-700":"text-red-700"}`,children:te(A.realizado_saldo)}),e.jsxs("div",{className:`text-xs ${A.previsto_saldo>=0?"text-green-600":"text-red-600"}`,children:["Prev: ",te(A.previsto_saldo)]})]}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("button",{onClick:()=>u(Z?null:q),className:"text-blue-600 hover:text-blue-800",children:e.jsx(et,{size:20,className:`transform transition-transform ${Z?"rotate-90":""}`})})})]}),Z&&re.length>0&&e.jsx("tr",{className:"bg-gray-50",children:e.jsx("td",{colSpan:"7",className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-3",children:"ðŸ“‹ MovimentaÃ§Ãµes Detalhadas"}),_a(re).map((R,J)=>e.jsxs("div",{className:`flex justify-between items-center p-2 rounded ${R.status==="previsto"?"bg-yellow-50 border-l-2 border-yellow-400":"bg-white border-l-2 border-blue-400"}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:R.descricao}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",R.categoria,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded ${R.status==="previsto"?"bg-yellow-200 text-yellow-800":"bg-blue-200 text-blue-800"}`,children:R.status==="previsto"?"ðŸ“… Previsto":"âœ… Realizado"}),e.jsxs("span",{className:`font-bold ${R.tipo==="entrada"?"text-green-600":"text-red-600"}`,children:[R.tipo==="entrada"?"+":"-"," ",te(R.valor)]})]})]},J))]})})})]},q)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-8 text-center text-gray-500",children:"Nenhuma movimentaÃ§Ã£o encontrada para o perÃ­odo selecionado"})})})]})})})]})]})};function Wi(){const[s,l]=a.useState(!0),[t,m]=a.useState("resumo"),[r,g]=a.useState(new Date().toISOString().split("T")[0]),[o,v]=a.useState(new Date().toISOString().split("T")[0]),[j,f]=a.useState({venda_bruta:0,taxa_entrega:0,desconto:0,venda_liquida:0,em_aberto:0,quantidade_vendas:0}),[N,d]=a.useState([]),[x,k]=a.useState([]),[w,c]=a.useState([]),[b,p]=a.useState([]),[i,u]=a.useState([]),[n,C]=a.useState([]),[h,_]=a.useState([]),E=()=>localStorage.getItem("access_token"),$=M=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(M||0),K=M=>new Date(M).toLocaleDateString("pt-BR"),te=async()=>{var Q,re;l(!0);const A={headers:{Authorization:`Bearer ${E()}`},params:{data_inicio:r,data_fim:o}};try{const Z=(await F.get("/vendas/relatorio",A)).data;f(Z.resumo||{}),d(Z.vendas_por_data||[]),k(Z.formas_recebimento||[]),c(Z.vendas_por_funcionario||[]),p(Z.vendas_por_tipo||[]),u(Z.vendas_por_grupo||[]),C(Z.produtos_detalhados||[]),_(Z.lista_vendas||[]),console.log("âœ… Dados carregados:",{vendasPorData:((Q=Z.vendas_por_data)==null?void 0:Q.length)||0,formasRecebimento:((re=Z.formas_recebimento)==null?void 0:re.length)||0})}catch(q){console.error("Erro ao carregar relatÃ³rio:",q)}finally{l(!1)}};return a.useEffect(()=>{te()},[r,o]),s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsx("div",{style:{backgroundColor:"red",color:"white",padding:"20px",fontSize:"24px",fontWeight:"bold"},children:"ðŸ”´ TESTE: ARQUIVO ESTÃ SENDO CARREGADO CORRETAMENTE"}),e.jsxs("div",{className:"mb-6 bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Consulta de Vendas"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:r,onChange:M=>g(M.target.value),className:"border rounded px-3 py-2"}),e.jsx("span",{className:"self-center",children:"atÃ©"}),e.jsx("input",{type:"date",value:o,onChange:M=>v(M.target.value),className:"border rounded px-3 py-2"})]})]}),e.jsxs("div",{className:"flex gap-2 border-b",children:[e.jsx("button",{onClick:()=>m("resumo"),className:`px-4 py-2 font-medium ${t==="resumo"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Resumo"}),e.jsx("button",{onClick:()=>m("produtos"),className:`px-4 py-2 font-medium ${t==="produtos"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Totais por produto/serviÃ§o"}),e.jsx("button",{onClick:()=>m("lista"),className:`px-4 py-2 font-medium ${t==="lista"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Lista de Vendas"})]})]}),t==="resumo"&&e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:$(j.venda_bruta)}),e.jsx("div",{className:"text-sm",children:"Venda bruta"})]}),e.jsxs("div",{className:"bg-gray-400 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:$(j.taxa_entrega)}),e.jsx("div",{className:"text-sm",children:"Taxa de entrega"})]}),e.jsxs("div",{className:"bg-yellow-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:$(j.desconto)}),e.jsxs("div",{className:"text-sm",children:[j.percentual_desconto,"% de desconto"]})]}),e.jsxs("div",{className:"bg-blue-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:$(j.venda_liquida)}),e.jsx("div",{className:"text-sm",children:"Venda LÃ­quida"})]}),e.jsxs("div",{className:"bg-red-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:$(j.em_aberto)}),e.jsx("div",{className:"text-sm",children:"Em aberto"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Vendas por data"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Data"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Tkt. MÃ©dio"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Taxa entrega"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"(%)"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. lÃ­quido"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. recebido"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo aberto"})]})}),e.jsxs("tbody",{children:[N.map((M,A)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:K(M.data)}),e.jsx("td",{className:"px-4 py-2 text-right",children:M.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.ticket_medio)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.taxa_entrega)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.desconto)}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[M.percentual_desconto,"%"]}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_liquido)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_recebido)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.saldo_aberto)})]},A)),N.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:N.reduce((M,A)=>M+A.quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(N.reduce((M,A)=>M+A.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(N.reduce((M,A)=>M+A.taxa_entrega,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(N.reduce((M,A)=>M+A.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(N.reduce((M,A)=>M+A.valor_liquido,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(N.reduce((M,A)=>M+A.valor_recebido,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(N.reduce((M,A)=>M+A.saldo_aberto,0))})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Formas de recebimento"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Forma"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Valor pago"})]})}),e.jsxs("tbody",{children:[x.map((M,A)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:M.forma_pagamento}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_total)})]},A)),x.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(x.reduce((M,A)=>M+A.valor_total,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"FuncionÃ¡rio"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nome"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. lÃ­quido"})]})}),e.jsxs("tbody",{children:[w.map((M,A)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:M.funcionario}),e.jsx("td",{className:"px-4 py-2 text-right",children:M.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_liquido)})]},A)),w.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:w.reduce((M,A)=>M+A.quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(w.reduce((M,A)=>M+A.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(w.reduce((M,A)=>M+A.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(w.reduce((M,A)=>M+A.valor_liquido,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Tipo"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Tipo"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. lÃ­quido"})]})}),e.jsxs("tbody",{children:[b.map((M,A)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:M.tipo}),e.jsx("td",{className:"px-4 py-2 text-right",children:M.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_liquido)})]},A)),b.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:b.reduce((M,A)=>M+A.quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(b.reduce((M,A)=>M+A.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(b.reduce((M,A)=>M+A.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(b.reduce((M,A)=>M+A.valor_liquido,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Grupo de produto"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nome"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Percentual"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. lÃ­quido"})]})}),e.jsxs("tbody",{children:[i.map((M,A)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:M.grupo}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[M.percentual,"%"]}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_liquido)})]},A)),i.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(i.reduce((M,A)=>M+A.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(i.reduce((M,A)=>M+A.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(i.reduce((M,A)=>M+A.valor_liquido,0))})]})]})]})]})]})]}),t==="produtos"&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Produtos/ServiÃ§os"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Produtos/ServiÃ§os"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Itens"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"LÃ­quido"})]})}),e.jsxs("tbody",{children:[n.map((M,A)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"bg-blue-50 font-semibold border-b-2 border-blue-300",children:[e.jsx("td",{className:"px-4 py-2",children:M.categoria}),e.jsx("td",{className:"px-4 py-2 text-right",children:M.total_quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.total_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.total_desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.total_liquido)})]},`cat-${A}`),M.subcategorias&&M.subcategorias.map((Q,re)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"bg-gray-50 font-medium border-b",children:[e.jsxs("td",{className:"px-4 py-2 pl-8",children:["ðŸ“ ",Q.subcategoria]}),e.jsx("td",{className:"px-4 py-2 text-right",children:Q.total_quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(Q.total_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(Q.total_desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(Q.total_liquido)})]},`subcat-${A}-${re}`),Q.produtos.map((q,Z)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 pl-12 text-gray-700",children:q.produto}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:q.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:$(q.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:$(q.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:$(q.valor_liquido)})]},`prod-${A}-${re}-${Z}`))]})),M.produtos&&M.produtos.map((Q,re)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 pl-8 text-gray-700",children:Q.produto}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:Q.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:$(Q.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:$(Q.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:$(Q.valor_liquido)})]},`prod-${A}-${re}`))]})),n.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL GERAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:n.reduce((M,A)=>M+A.total_quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(n.reduce((M,A)=>M+A.total_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(n.reduce((M,A)=>M+A.total_desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(n.reduce((M,A)=>M+A.total_liquido,0))})]})]})]})})]}),t==="lista"&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Lista de Vendas"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"CÃ³d."}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Data e hora"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Cliente"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Animal"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Valor"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Status"})]})}),e.jsx("tbody",{children:h.map(M=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:M.numero_venda||M.id}),e.jsx("td",{className:"px-4 py-2",children:K(M.data_venda)}),e.jsx("td",{className:"px-4 py-2",children:M.cliente_nome}),e.jsx("td",{className:"px-4 py-2",children:M.pet_nome||"-"}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.total)}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${M.status==="finalizada"?"bg-green-100 text-green-800":M.status==="baixa_parcial"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:M.status==="finalizada"?"Baixada":M.status==="baixa_parcial"?"Parcial":"Em aberto"})})]},M.id))})]})})]})]})}function Ki(){const[s,l]=a.useState(!1),[t,m]=a.useState("resumo"),[r,g]=a.useState(""),[o,v]=a.useState(""),[j,f]=a.useState(""),[N,d]=a.useState(!1),[x,k]=a.useState("mes_anterior"),[w,c]=a.useState(""),[b,p]=a.useState(""),[i,u]=a.useState(""),[n,C]=a.useState(!0),[h,_]=a.useState("financeiro"),[E,$]=a.useState({venda_bruta:0,taxa_entrega:0,desconto:0,venda_liquida:0,em_aberto:0,quantidade_vendas:0}),[K,te]=a.useState({venda_bruta:0,taxa_entrega:0,desconto:0,venda_liquida:0,em_aberto:0,quantidade_vendas:0}),[M,A]=a.useState([]),[Q,re]=a.useState([]),[q,Z]=a.useState([]),[R,J]=a.useState([]),[S,P]=a.useState([]),[G,B]=a.useState([]),[y,O]=a.useState([]),[z,ae]=a.useState(new Set),[W,ne]=a.useState([]),[H,ee]=a.useState([]),[de,ue]=a.useState([]),[Re,se]=a.useState([]),[_e,ke]=a.useState({}),[Ze,ze]=a.useState([]),Xe=I=>{const X=new Set(z);X.has(I)?X.delete(I):X.add(I),ae(X)},be=I=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(I||0),Ee=I=>I==null||isNaN(I)||!isFinite(I)?0:I,he=I=>{if(!I)return"N/A";try{if(I instanceof Date)return I.toLocaleDateString("pt-BR");if(typeof I=="string"&&I.includes("T")){const fe=I.split("T")[0],[U,ie,Ne]=fe.split("-");return`${Ne}/${ie}/${U}`}const X=new Date(I);return isNaN(X.getTime())?"N/A":X.toLocaleDateString("pt-BR")}catch{return"N/A"}},Qe=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#14B8A6","#F97316"],Ye=(I,X)=>{if(!I||I.length===0)return I;let fe=[...I];return w&&X==="funcionario"&&(fe=fe.filter(U=>U.funcionario===w)),b&&X==="formaPagamento"&&(fe=fe.filter(U=>U.forma_pagamento===b)),i&&X==="categoria"&&(fe=fe.filter(U=>U.categoria===i)),fe},ca=Ye(Q,"formaPagamento"),ra=Ye(q,"funcionario"),pa=Ye(G,"categoria"),na=({titulo:I,valor:X,icone:fe,cor:U,valorAnterior:ie})=>{const Ne=Y(X,ie),Pe=Ne.percentual>0,L=Ne.percentual===0;return e.jsxs("div",{className:`${U} text-white p-4 rounded-lg shadow`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm opacity-90",children:I}),e.jsx(fe,{className:"w-5 h-5 opacity-80"})]}),e.jsx("div",{className:"text-3xl font-bold mb-1",children:be(X)}),N&&ie!==void 0&&e.jsxs("div",{className:`flex items-center gap-1 text-sm ${L?"opacity-70":""}`,children:[Pe&&e.jsx(js,{className:"w-4 h-4"}),!Pe&&!L&&e.jsx(vs,{className:"w-4 h-4"}),L&&e.jsx(nr,{className:"w-4 h-4"}),e.jsxs("span",{children:[Math.abs(Ne.percentual),"%"]})]})]})},oe=()=>{switch(x){case"periodo_anterior":return"mesmo perÃ­odo anterior";case"mes_anterior":return"mesmo perÃ­odo do mÃªs anterior";case"ano_anterior":return"mesmo perÃ­odo do ano anterior";default:return"perÃ­odo anterior"}},ye=async()=>{if(!r||!o){Se.error("Selecione um perÃ­odo para gerar o relatÃ³rio");return}try{Se.loading("Gerando PDF...",{id:"pdf"});const I=new URLSearchParams({data_inicio:r,data_fim:o});w&&I.append("funcionario",w),b&&I.append("forma_pagamento",b),i&&I.append("categoria",i);const X=await F.get(`/relatorios/vendas/export/pdf?${I.toString()}`,{responseType:"blob"}),fe=window.URL.createObjectURL(new Blob([X.data])),U=document.createElement("a");U.href=fe,U.setAttribute("download",`relatorio_vendas_${r}_${o}.pdf`),document.body.appendChild(U),U.click(),U.remove(),Se.success("ðŸ“„ PDF exportado com sucesso!",{id:"pdf"})}catch(I){console.error("Erro ao exportar PDF:",I),Se.error("Erro ao exportar PDF",{id:"pdf"})}},Ce=()=>{const I=$s.book_new(),X=[["RELATÃ“RIO DE VENDAS"],["PerÃ­odo:",`${he(r)} atÃ© ${he(o)}`],[""],["MÃ©trica","Valor"],["Venda Bruta",E.venda_bruta],["Taxa de Entrega",E.taxa_entrega],["Desconto",E.desconto],["Venda LÃ­quida",E.venda_liquida],["Em Aberto",E.em_aberto],["Quantidade de Vendas",E.quantidade_vendas]],fe=$s.aoa_to_sheet(X);if($s.book_append_sheet(I,fe,"Resumo"),M.length>0){const L=[["Data","Qtd","Tkt. MÃ©dio","Vl. bruto","Taxa entrega","Desconto","(%)","Vl. lÃ­quido","Vl. recebido","Saldo aberto"],...M.map(pe=>[he(pe.data),pe.quantidade,pe.ticket_medio,pe.valor_bruto,pe.taxa_entrega,pe.desconto,pe.percentual_desconto,pe.valor_liquido,pe.valor_recebido,pe.saldo_aberto])],le=$s.aoa_to_sheet(L);$s.book_append_sheet(I,le,"Vendas por Data")}if(ca.length>0){const L=[["Forma","Valor pago"],...ca.map(pe=>[pe.forma_pagamento,pe.valor_total])],le=$s.aoa_to_sheet(L);$s.book_append_sheet(I,le,"Formas Pagamento")}const U=Tl(I,{bookType:"xlsx",type:"binary"}),ie=new ArrayBuffer(U.length),Ne=new Uint8Array(ie);for(let L=0;L<U.length;L++)Ne[L]=U.charCodeAt(L)&255;const Pe=`relatorio_vendas_${r}_${o}.xlsx`;Vl.saveAs(new Blob([ie],{type:"application/octet-stream"}),Pe)},Be=I=>{const X=new Date,fe=X.getFullYear(),U=String(X.getMonth()+1).padStart(2,"0"),ie=String(X.getDate()).padStart(2,"0"),Ne=`${fe}-${U}-${ie}`;let Pe,L;switch(I){case"hoje":Pe=L=Ne;break;case"ontem":const le=new Date(X);le.setDate(X.getDate()-1);const pe=le.getFullYear(),Fe=String(le.getMonth()+1).padStart(2,"0"),Oe=String(le.getDate()).padStart(2,"0");Pe=L=`${pe}-${Fe}-${Oe}`;break;case"esta_semana":const Ke=X.getDay(),He=Ke===0?6:Ke-1,ea=new Date(X);ea.setDate(X.getDate()-He);const oa=ea.getFullYear(),ia=String(ea.getMonth()+1).padStart(2,"0"),Ue=String(ea.getDate()).padStart(2,"0");Pe=`${oa}-${ia}-${Ue}`,L=Ne;break;case"este_mes":Pe=`${fe}-${U}-01`,L=Ne;break;case"mes_anterior":const wa=new Date(X.getFullYear(),X.getMonth()-1,1),V=new Date(X.getFullYear(),X.getMonth(),0),$e=wa.getFullYear(),Te=String(wa.getMonth()+1).padStart(2,"0"),We=V.getFullYear(),ua=String(V.getMonth()+1).padStart(2,"0"),xe=String(V.getDate()).padStart(2,"0");Pe=`${$e}-${Te}-01`,L=`${We}-${ua}-${xe}`;break;case"ultimos_7_dias":const Ae=new Date(X);Ae.setDate(X.getDate()-7);const qe=Ae.getFullYear(),sa=String(Ae.getMonth()+1).padStart(2,"0"),qa=String(Ae.getDate()).padStart(2,"0");Pe=`${qe}-${sa}-${qa}`,L=Ne;break;case"ultimos_30_dias":const ja=new Date(X);ja.setDate(X.getDate()-30);const Sa=ja.getFullYear(),ya=String(ja.getMonth()+1).padStart(2,"0"),Ja=String(ja.getDate()).padStart(2,"0");Pe=`${Sa}-${ya}-${Ja}`,L=Ne;break;case"este_ano":Pe=`${fe}-01-01`,L=Ne;break;default:return}g(Pe),v(L),f(I)},Ie=()=>{const[I,X,fe]=r.split("-").map(Number),[U,ie,Ne]=o.split("-").map(Number),Pe=new Date(I,X-1,fe),L=new Date(U,ie-1,Ne),le=Math.floor((L-Pe)/(1e3*60*60*24))+1;let pe,Fe;switch(x){case"periodo_anterior":pe=new Date(Pe),pe.setDate(Pe.getDate()-le),Fe=new Date(Pe),Fe.setDate(Pe.getDate()-1);break;case"mes_anterior":pe=new Date(Pe),pe.setMonth(Pe.getMonth()-1),Fe=new Date(L),Fe.setMonth(L.getMonth()-1);break;case"ano_anterior":pe=new Date(Pe),pe.setFullYear(Pe.getFullYear()-1),Fe=new Date(L),Fe.setFullYear(L.getFullYear()-1);break;default:return{data_inicio:"",data_fim:""}}const Oe=pe.getFullYear(),Ke=String(pe.getMonth()+1).padStart(2,"0"),He=String(pe.getDate()).padStart(2,"0"),ea=Fe.getFullYear(),oa=String(Fe.getMonth()+1).padStart(2,"0"),ia=String(Fe.getDate()).padStart(2,"0");return{data_inicio:`${Oe}-${Ke}-${He}`,data_fim:`${ea}-${oa}-${ia}`}},Y=(I,X)=>{if(!X||X===0)return{valor:0,percentual:0};const fe=I-X,U=(fe/X*100).toFixed(1);return{valor:fe,percentual:parseFloat(U)}},je=async()=>{if(!(!r||!o)){l(!0);try{const X=(await F.get("/relatorios/vendas/relatorio",{params:{data_inicio:r,data_fim:o}})).data;if($(X.resumo||{}),A(X.vendas_por_data||[]),re(X.formas_recebimento||[]),Z(X.vendas_por_funcionario||[]),J(X.vendas_por_tipo||[]),P(X.vendas_por_grupo||[]),B(X.produtos_detalhados||[]),ze(X.produtos_analise||[]),O(X.lista_vendas||[]),N||t==="comparacao"){const fe=Ie(),U=await F.get("/relatorios/vendas/relatorio",{params:fe});te(U.data.resumo||{}),ne(U.data.formas_recebimento||[]),ee(U.data.vendas_por_grupo||[]),ue(U.data.vendas_por_funcionario||[])}else te({venda_bruta:0,taxa_entrega:0,desconto:0,venda_liquida:0,em_aberto:0,quantidade_vendas:0})}catch(I){console.error("Erro ao carregar relatÃ³rio:",I)}finally{l(!1)}}},Me=()=>{if(!Ze||Ze.length===0){se([]),ke({});return}const I=Ze.map(U=>{const ie=Ee(U.custo_total),Ne=Ee(U.valor_total),Pe=Ee(U.quantidade)||1,L=Ne-ie,le=ie>0?L/ie*100:0;return{nome:U.nome||U.produto||"Produto sem nome",marca:U.marca||"-",quantidade:Pe,custo:Ee(ie/Pe),preco:Ee(Ne/Pe),lucro_total:Ee(L),margem:Ee(le),categoria:U.categoria||"Sem Categoria"}}),X=I.sort((U,ie)=>ie.lucro_total-U.lucro_total).slice(0,20);se(X);const fe={};I.forEach(U=>{const ie=U.categoria||"Sem Categoria";fe[ie]||(fe[ie]={quantidade:0,total:0,margens:[]}),fe[ie].quantidade+=U.quantidade,fe[ie].total+=U.preco*U.quantidade,fe[ie].margens.push(U.margem)}),Object.keys(fe).forEach(U=>{const ie=fe[U].margens,Ne=ie.reduce((Pe,L)=>Ee(Pe)+Ee(L),0);fe[U].margem_media=Ee(ie.length>0?Ne/ie.length:0),delete fe[U].margens}),ke(fe)};return a.useEffect(()=>{t==="analise"&&Me()},[Ze,t]),a.useEffect(()=>{je()},[r,o,N,x,t]),a.useEffect(()=>{Be("este_mes")},[]),s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"mb-6 bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Consulta de Vendas"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:ye,disabled:!r||!o,title:r&&o?`Exportar PDF de ${he(r)} atÃ© ${he(o)}`:"Selecione um perÃ­odo",className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:[e.jsx(Xa,{className:"w-4 h-4"}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:"Exportar PDF"}),r&&o&&e.jsxs("span",{className:"text-xs opacity-90",children:["(",he(r)," - ",he(o),")"]})]})]}),e.jsxs("button",{onClick:Ce,disabled:!r||!o,title:r&&o?`Exportar dados de ${he(r)} atÃ© ${he(o)}`:"Selecione um perÃ­odo",className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:[e.jsx(wt,{className:"w-4 h-4"}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:"Exportar Excel"}),r&&o&&e.jsxs("span",{className:"text-xs opacity-90",children:["(",he(r)," - ",he(o),")"]})]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:I=>d(I.target.checked),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Comparar com:"})]}),N&&e.jsxs("select",{value:x,onChange:I=>k(I.target.value),className:"border rounded px-3 py-2 text-sm bg-blue-50 font-medium",children:[e.jsx("option",{value:"periodo_anterior",children:"PerÃ­odo imediatamente anterior (mesmo nÂº de dias)"}),e.jsx("option",{value:"mes_anterior",children:"Mesmo perÃ­odo do mÃªs passado"}),e.jsx("option",{value:"ano_anterior",children:"Mesmo perÃ­odo do ano passado"})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:[{id:"hoje",label:"Hoje"},{id:"ontem",label:"Ontem"},{id:"esta_semana",label:"Esta semana"},{id:"este_mes",label:"Este mÃªs"},{id:"mes_anterior",label:"MÃªs anterior"},{id:"ultimos_7_dias",label:"Ãšltimos 7 dias"},{id:"ultimos_30_dias",label:"Ãšltimos 30 dias"},{id:"este_ano",label:"Este ano"},{id:"personalizado",label:"Personalizado"}].map(I=>e.jsx("button",{onClick:()=>{I.id==="personalizado"?f("personalizado"):Be(I.id)},className:`px-3 py-1 rounded text-sm font-medium transition-colors ${j===I.id?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:I.label},I.id))}),j==="personalizado"&&e.jsxs("div",{className:"flex gap-2 items-center mb-4 p-3 bg-gray-50 rounded",children:[e.jsx(Cs,{className:"w-5 h-5 text-gray-500"}),e.jsx("input",{type:"date",value:r,onChange:I=>g(I.target.value),className:"border rounded px-3 py-2"}),e.jsx("span",{className:"text-gray-600",children:"atÃ©"}),e.jsx("input",{type:"date",value:o,onChange:I=>v(I.target.value),className:"border rounded px-3 py-2"})]}),e.jsxs("div",{className:"flex gap-2 items-center mb-4 p-3 bg-blue-50 rounded border border-blue-200",children:[e.jsx(Ct,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtros AvanÃ§ados:"}),e.jsxs("select",{value:w,onChange:I=>c(I.target.value),className:"border rounded px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Todos os funcionÃ¡rios"}),q.map((I,X)=>e.jsx("option",{value:I.funcionario,children:I.funcionario},X))]}),e.jsxs("select",{value:b,onChange:I=>p(I.target.value),className:"border rounded px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Todas as formas"}),Q.map((I,X)=>e.jsx("option",{value:I.forma_pagamento,children:I.forma_pagamento},X))]}),e.jsxs("select",{value:i,onChange:I=>u(I.target.value),className:"border rounded px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Todas as categorias"}),G.map((I,X)=>e.jsx("option",{value:I.categoria,children:I.categoria},X))]}),e.jsx("button",{onClick:()=>{c(""),p(""),u("")},className:"px-3 py-2 bg-gray-200 text-gray-700 rounded text-sm hover:bg-gray-300 transition-colors",children:"Limpar Filtros"}),e.jsxs("button",{onClick:()=>C(!n),className:"ml-auto px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(St,{className:"w-4 h-4"}),n?"Ocultar":"Mostrar"," GrÃ¡ficos"]})]}),e.jsxs("div",{className:"flex gap-2 border-b",children:[e.jsx("button",{onClick:()=>m("resumo"),className:`px-4 py-2 font-medium ${t==="resumo"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Resumo"}),e.jsx("button",{onClick:()=>m("produtos"),className:`px-4 py-2 font-medium ${t==="produtos"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Totais por produto/serviÃ§o"}),e.jsx("button",{onClick:()=>m("lista"),className:`px-4 py-2 font-medium ${t==="lista"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Lista de Vendas"}),e.jsx("button",{onClick:()=>m("comparacao"),className:`px-4 py-2 font-medium ${t==="comparacao"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"ComparaÃ§Ã£o de PerÃ­odos"}),e.jsx("button",{onClick:()=>m("analise"),className:`px-4 py-2 font-medium ${t==="analise"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"AnÃ¡lise Inteligente"})]})]}),t==="resumo"&&e.jsxs("div",{children:[N&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold text-blue-800",children:"Modo ComparaÃ§Ã£o Ativo:"}),e.jsxs("span",{className:"text-blue-700 ml-2",children:["Comparando ",e.jsxs("span",{className:"font-medium",children:[he(r)," atÃ© ",he(o)]})," com ",e.jsx("span",{className:"font-medium",children:oe()})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-5 gap-4 mb-6",children:[e.jsx(na,{titulo:"Venda Bruta",valor:E.venda_bruta,icone:La,cor:"bg-green-500",valorAnterior:K.venda_bruta}),e.jsx(na,{titulo:"Taxa de Entrega",valor:E.taxa_entrega,icone:Za,cor:"bg-gray-400",valorAnterior:K.taxa_entrega}),e.jsx(na,{titulo:"Desconto",valor:E.desconto,icone:Aa,cor:"bg-yellow-500",valorAnterior:K.desconto}),e.jsx(na,{titulo:"Venda LÃ­quida",valor:E.venda_liquida,icone:La,cor:"bg-blue-500",valorAnterior:K.venda_liquida}),e.jsx(na,{titulo:"Em Aberto",valor:E.em_aberto,icone:ot,cor:"bg-red-500",valorAnterior:K.em_aberto})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-orange-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:be(E.custo_total||0)}),e.jsx("div",{className:"text-sm",children:"Custo Total"})]}),e.jsxs("div",{className:"bg-purple-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:be(E.taxa_cartao_total||0)}),e.jsx("div",{className:"text-sm",children:"Taxas de CartÃ£o"})]}),e.jsxs("div",{className:"bg-green-600 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:be(E.lucro_total||0)}),e.jsx("div",{className:"text-sm",children:"Lucro Total"})]}),e.jsxs("div",{className:"bg-teal-500 text-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"text-3xl font-bold",children:[E.margem_media||0,"%"]}),e.jsx("div",{className:"text-sm",children:"Margem MÃ©dia"})]})]}),n&&e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Vendas no PerÃ­odo"}),e.jsx(Ma,{width:"100%",height:300,children:e.jsxs(it,{data:M,children:[e.jsx(Oa,{strokeDasharray:"3 3"}),e.jsx(Ba,{dataKey:"data",tickFormatter:I=>new Date(I).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})}),e.jsx(Ia,{tickFormatter:I=>`R$ ${(I/1e3).toFixed(0)}k`}),e.jsx(Pa,{formatter:I=>be(I),labelFormatter:I=>he(I)}),e.jsx(Ta,{}),e.jsx(ls,{type:"monotone",dataKey:"valor_bruto",stroke:"#3B82F6",strokeWidth:2,name:"Venda Bruta"}),e.jsx(ls,{type:"monotone",dataKey:"valor_liquido",stroke:"#10B981",strokeWidth:2,name:"Venda LÃ­quida"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Formas de Pagamento"}),e.jsx(Ma,{width:"100%",height:350,children:e.jsxs(ns,{data:ca,layout:"vertical",margin:{top:5,right:30,left:120,bottom:5},children:[e.jsx(Oa,{strokeDasharray:"3 3"}),e.jsx(Ba,{type:"number",tickFormatter:I=>be(I)}),e.jsx(Ia,{type:"category",dataKey:"forma_pagamento",width:110,style:{fontSize:"12px"}}),e.jsx(Pa,{formatter:(I,X,fe)=>{const U=ca.reduce((Ne,Pe)=>Ne+Pe.valor_total,0),ie=(I/U*100).toFixed(1);return[`${be(I)} (${ie}%)`,"Valor"]},contentStyle:{backgroundColor:"white",border:"1px solid #ccc",borderRadius:"4px",padding:"8px"}}),e.jsx(Ka,{dataKey:"valor_total",fill:"#3B82F6",radius:[0,8,8,0],label:{position:"right",formatter:I=>{const X=ca.reduce((U,ie)=>U+ie.valor_total,0);return`${(I/X*100).toFixed(1)}%`},style:{fontSize:"11px",fontWeight:"bold"}},children:ca.map((I,X)=>e.jsx(Gt,{fill:Qe[X%Qe.length]},`cell-${X}`))})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 col-span-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Top 10 Categorias de Produtos"}),e.jsx(Ma,{width:"100%",height:300,children:e.jsxs(ns,{data:pa.slice(0,10),children:[e.jsx(Oa,{strokeDasharray:"3 3"}),e.jsx(Ba,{dataKey:"categoria"}),e.jsx(Ia,{tickFormatter:I=>`R$ ${(I/1e3).toFixed(0)}k`}),e.jsx(Pa,{formatter:I=>be(I)}),e.jsx(Ta,{}),e.jsx(Ka,{dataKey:"total_liquido",fill:"#3B82F6",name:"Valor LÃ­quido"})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Vendas por data"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Data"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Tkt. MÃ©dio"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Taxa entrega"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"(%)"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. lÃ­quido"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. recebido"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo aberto"})]})}),e.jsxs("tbody",{children:[M.map((I,X)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:he(I.data)}),e.jsx("td",{className:"px-4 py-2 text-right",children:I.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.ticket_medio)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.taxa_entrega)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.desconto)}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[I.percentual_desconto,"%"]}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_liquido)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_recebido)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.saldo_aberto)})]},X)),M.length>0&&(()=>{const I=M.reduce((Ne,Pe)=>Ne+Pe.quantidade,0),X=M.reduce((Ne,Pe)=>Ne+Pe.valor_bruto,0),fe=M.reduce((Ne,Pe)=>Ne+Pe.desconto,0),U=I>0?X/I:0,ie=X>0?(fe/X*100).toFixed(1):0;return e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:I}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(U)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(X)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(M.reduce((Ne,Pe)=>Ne+Pe.taxa_entrega,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(fe)}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[ie,"%"]}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(M.reduce((Ne,Pe)=>Ne+Pe.valor_liquido,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(M.reduce((Ne,Pe)=>Ne+Pe.valor_recebido,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(M.reduce((Ne,Pe)=>Ne+Pe.saldo_aberto,0))})]})})()]})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Formas de recebimento"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Forma"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Valor pago"})]})}),e.jsxs("tbody",{children:[Q.map((I,X)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:I.forma_pagamento}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_total)})]},X)),Q.length>0&&e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(Q.reduce((I,X)=>I+X.valor_total,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"FuncionÃ¡rio"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nome"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. lÃ­quido"})]})}),e.jsxs("tbody",{children:[ra.map((I,X)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:I.funcionario}),e.jsx("td",{className:"px-4 py-2 text-right",children:I.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_liquido)})]},X)),ra.length>0&&e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:ra.reduce((I,X)=>I+X.quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(ra.reduce((I,X)=>I+X.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(ra.reduce((I,X)=>I+X.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(ra.reduce((I,X)=>I+X.valor_liquido,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Tipo"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Tipo"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. lÃ­quido"})]})}),e.jsxs("tbody",{children:[R.map((I,X)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:I.tipo}),e.jsx("td",{className:"px-4 py-2 text-right",children:I.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_liquido)})]},X)),R.length>0&&e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:R.reduce((I,X)=>I+X.quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(R.reduce((I,X)=>I+X.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(R.reduce((I,X)=>I+X.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(R.reduce((I,X)=>I+X.valor_liquido,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Grupo de produto"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nome"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Percentual"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. lÃ­quido"})]})}),e.jsxs("tbody",{children:[S.map((I,X)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:I.grupo}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[I.percentual,"%"]}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_liquido)})]},X)),S.length>0&&e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(S.reduce((I,X)=>I+X.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(S.reduce((I,X)=>I+X.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(S.reduce((I,X)=>I+X.valor_liquido,0))})]})]})]})]})]})]}),t==="produtos"&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Produtos/ServiÃ§os"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Produtos/ServiÃ§os"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Itens"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"LÃ­quido"})]})}),e.jsxs("tbody",{children:[pa.map((I,X)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"bg-blue-50 font-semibold",children:[e.jsx("td",{className:"px-4 py-2",children:I.categoria}),e.jsx("td",{className:"px-4 py-2 text-right",children:I.total_quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.total_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.total_desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.total_liquido)})]},`cat-${X}`),I.subcategorias&&I.subcategorias.map((fe,U)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"bg-gray-50 font-medium",children:[e.jsx("td",{className:"px-4 py-2 pl-8",children:fe.subcategoria}),e.jsx("td",{className:"px-4 py-2 text-right",children:fe.total_quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(fe.total_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(fe.total_desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(fe.total_liquido)})]},`sub-${X}-${U}`),fe.produtos&&fe.produtos.map((ie,Ne)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 pl-12 text-gray-700",children:ie.produto}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:ie.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(ie.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(ie.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(ie.valor_liquido)})]},`prod-${X}-${U}-${Ne}`))]})),I.produtos&&I.produtos.map((fe,U)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 pl-8 text-gray-700",children:fe.produto}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:fe.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(fe.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(fe.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(fe.valor_liquido)})]},`prod-${X}-${U}`))]})),G.length>0&&e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL GERAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:G.reduce((I,X)=>I+X.total_quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(G.reduce((I,X)=>I+X.total_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(G.reduce((I,X)=>I+X.total_desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(G.reduce((I,X)=>I+X.total_liquido,0))})]})]})]})})]}),t==="lista"&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Lista de Vendas com AnÃ¡lise de Rentabilidade"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left w-8"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Data"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"CÃ³digo"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Cliente"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Venda Bruta"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Taxa Entrega"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Taxa Operac."}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Taxa CartÃ£o"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"ComissÃ£o"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Imposto"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Custo"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"LÃ­quida"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Lucro"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"MG Venda"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"MG Custo"}),e.jsx("th",{className:"px-2 py-2 text-center",children:"Status"})]})}),e.jsx("tbody",{children:y.map(I=>e.jsxs(ts.Fragment,{children:[e.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>Xe(I.id),children:[e.jsx("td",{className:"px-2 py-2",children:z.has(I.id)?e.jsx(Ms,{className:"w-4 h-4 text-gray-600"}):e.jsx(et,{className:"w-4 h-4 text-gray-600"})}),e.jsx("td",{className:"px-2 py-2 whitespace-nowrap",children:he(I.data_venda)}),e.jsx("td",{className:"px-2 py-2",children:I.numero_venda}),e.jsx("td",{className:"px-2 py-2",children:I.cliente_nome}),e.jsx("td",{className:"px-2 py-2 text-right font-medium",children:be(I.venda_bruta)}),e.jsxs("td",{className:"px-2 py-2 text-right text-red-600",children:["-",be(I.desconto)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-blue-600",title:"ComissÃ£o repassada ao entregador",children:["-",be(I.taxa_entrega)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-orange-500",title:"Custo operacional da entrega (empresa)",children:["-",be(I.taxa_operacional||0)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-purple-600",children:["-",be(I.taxa_cartao)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-blue-600",children:["-",be(I.comissao)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-pink-600",title:"Impostos sobre faturamento",children:["-",be(I.imposto||0)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-orange-600",children:["-",be(I.custo_produtos)]}),e.jsx("td",{className:"px-2 py-2 text-right font-medium",children:be(I.venda_liquida)}),e.jsx("td",{className:`px-2 py-2 text-right font-bold ${I.lucro>=0?"text-green-600":"text-red-600"}`,children:be(I.lucro)}),e.jsxs("td",{className:"px-2 py-2 text-right",children:[I.margem_sobre_venda,"%"]}),e.jsxs("td",{className:"px-2 py-2 text-right",children:[I.margem_sobre_custo,"%"]}),e.jsx("td",{className:"px-2 py-2 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${I.status==="finalizada"?"bg-green-100 text-green-800":I.status==="baixa_parcial"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:I.status==="finalizada"?"Baixada":I.status==="baixa_parcial"?"Parcial":"Aberta"})})]}),z.has(I.id)&&I.itens&&I.itens.length>0&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"17",className:"px-4 py-3",children:e.jsxs("div",{className:"pl-8",children:[e.jsx("div",{className:"font-semibold text-gray-700 mb-2",children:"Produtos desta venda:"}),e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-blue-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1 text-left",children:"Produto"}),e.jsx("th",{className:"px-2 py-1 text-center",children:"Qtd"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"PreÃ§o Unit."}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Venda Bruta"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Desconto"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Taxa Entr."}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Taxa Oper."}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Taxa CartÃ£o"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"ComissÃ£o"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Imposto"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Custo Unit."}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Custo Total"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"LÃ­quido"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Lucro"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"MG Venda"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"MG Custo"})]})}),e.jsx("tbody",{children:I.itens.map((X,fe)=>e.jsxs("tr",{className:"border-b border-blue-200 hover:bg-blue-100",children:[e.jsx("td",{className:"px-2 py-1",children:X.produto_nome}),e.jsx("td",{className:"px-2 py-1 text-center",children:X.quantidade}),e.jsx("td",{className:"px-2 py-1 text-right",children:be(X.preco_unitario)}),e.jsx("td",{className:"px-2 py-1 text-right font-medium",children:be(X.venda_bruta)}),e.jsxs("td",{className:"px-2 py-1 text-right text-red-600",children:["-",be(X.desconto)]}),e.jsxs("td",{className:"px-2 py-1 text-right text-blue-600",children:["-",be(X.taxa_entrega)]}),e.jsxs("td",{className:"px-2 py-1 text-right text-orange-500",children:["-",be(X.taxa_operacional||0)]}),e.jsxs("td",{className:"px-2 py-1 text-right text-purple-600",children:["-",be(X.taxa_cartao)]}),e.jsxs("td",{className:"px-2 py-1 text-right text-blue-600",children:["-",be(X.comissao)]}),e.jsxs("td",{className:"px-2 py-1 text-right text-pink-600",children:["-",be(X.imposto||0)]}),e.jsx("td",{className:"px-2 py-1 text-right text-orange-600",children:be(X.custo_unitario)}),e.jsxs("td",{className:"px-2 py-1 text-right text-orange-600 font-medium",children:["-",be(X.custo_total)]}),e.jsx("td",{className:"px-2 py-1 text-right font-medium",children:be(X.valor_liquido)}),e.jsx("td",{className:`px-2 py-1 text-right font-bold ${X.lucro>=0?"text-green-600":"text-red-600"} cursor-help`,title:`Lucro unitÃ¡rio: ${be(X.lucro_unitario)}`,children:be(X.lucro)}),e.jsxs("td",{className:"px-2 py-1 text-right cursor-help",title:`Margem unitÃ¡ria: ${X.margem_sobre_venda}%`,children:[X.margem_sobre_venda,"%"]}),e.jsxs("td",{className:"px-2 py-1 text-right cursor-help",title:`Markup unitÃ¡rio: ${X.margem_sobre_custo}%`,children:[X.margem_sobre_custo,"%"]})]},fe))})]})]})})},`${I.id}-detalhes`)]},I.id))})]})})]}),t==="comparacao"&&e.jsxs("div",{children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Tipo de AnÃ¡lise:"}),e.jsxs("select",{value:h,onChange:I=>_(I.target.value),className:"border rounded px-4 py-2 text-sm bg-blue-50 font-medium min-w-[250px]",children:[e.jsx("option",{value:"financeiro",children:"ðŸ“Š ComparaÃ§Ã£o Financeira"}),e.jsx("option",{value:"formas_pagamento",children:"ðŸ’³ Por Forma de Pagamento"}),e.jsx("option",{value:"produtos",children:"ðŸ“¦ Por Grupo de Produtos"}),e.jsx("option",{value:"funcionarios",children:"ðŸ‘¥ Por FuncionÃ¡rio"})]}),e.jsxs("div",{className:"ml-auto text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"PerÃ­odo Atual:"})," ",he(r)," - ",he(o)]})]})}),h==="financeiro"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border-2 border-gray-300",children:[e.jsxs("div",{className:"bg-gray-500 text-white px-4 py-3 rounded-t-lg",children:[e.jsx("h3",{className:"font-bold text-lg",children:"ðŸ“… PerÃ­odo Anterior"}),e.jsx("p",{className:"text-xs opacity-90 mt-1",children:oe()})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Quantidade de Vendas"}),e.jsx("div",{className:"text-2xl font-bold text-gray-700",children:K.quantidade_vendas||0})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Bruto"}),e.jsx("div",{className:"text-xl font-bold text-gray-700",children:be(K.venda_bruta)})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor LÃ­quido"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:be(K.venda_liquida)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Recebido"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:be(K.venda_liquida-K.em_aberto||0)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border-2 border-blue-500",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-4 py-3 rounded-t-lg",children:[e.jsx("h3",{className:"font-bold text-lg",children:"ðŸ“… PerÃ­odo Atual"}),e.jsxs("p",{className:"text-xs opacity-90 mt-1",children:[he(r)," - ",he(o)]})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Quantidade de Vendas"}),e.jsx("div",{className:"text-2xl font-bold text-gray-700",children:E.quantidade_vendas||0})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Bruto"}),e.jsx("div",{className:"text-xl font-bold text-gray-700",children:be(E.venda_bruta)})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor LÃ­quido"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:be(E.venda_liquida)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Recebido"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:be(E.venda_liquida-E.em_aberto||0)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border-2 border-green-500",children:[e.jsxs("div",{className:"bg-green-600 text-white px-4 py-3 rounded-t-lg",children:[e.jsx("h3",{className:"font-bold text-lg",children:"ðŸ“ˆ DiferenÃ§a"}),e.jsx("p",{className:"text-xs opacity-90 mt-1",children:"VariaÃ§Ã£o vs perÃ­odo anterior"})]}),e.jsx("div",{className:"p-4 space-y-3",children:(()=>{const I=Y(E.quantidade_vendas,K.quantidade_vendas),X=Y(E.venda_bruta,K.venda_bruta),fe=Y(E.venda_liquida,K.venda_liquida),U=E.venda_liquida-E.em_aberto,ie=K.venda_liquida-K.em_aberto,Ne=Y(U,ie);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Qtd de Vendas"}),e.jsxs("div",{className:`text-2xl font-bold flex items-center gap-2 ${I.percentual>=0?"text-green-600":"text-red-600"}`,children:[I.percentual>=0?e.jsx(js,{className:"w-6 h-6"}):e.jsx(vs,{className:"w-6 h-6"}),Math.abs(I.percentual),"%"]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[I.valor>=0?"+":"",I.valor.toFixed(0)," vendas"]})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Bruto"}),e.jsxs("div",{className:`text-xl font-bold flex items-center gap-2 ${X.percentual>=0?"text-green-600":"text-red-600"}`,children:[X.percentual>=0?e.jsx(js,{className:"w-5 h-5"}):e.jsx(vs,{className:"w-5 h-5"}),Math.abs(X.percentual),"%"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:be(X.valor)})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor LÃ­quido"}),e.jsxs("div",{className:`text-xl font-bold flex items-center gap-2 ${fe.percentual>=0?"text-green-600":"text-red-600"}`,children:[fe.percentual>=0?e.jsx(js,{className:"w-5 h-5"}):e.jsx(vs,{className:"w-5 h-5"}),Math.abs(fe.percentual),"%"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:be(fe.valor)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Recebido"}),e.jsxs("div",{className:`text-xl font-bold flex items-center gap-2 ${Ne.percentual>=0?"text-green-600":"text-red-600"}`,children:[Ne.percentual>=0?e.jsx(js,{className:"w-5 h-5"}):e.jsx(vs,{className:"w-5 h-5"}),Math.abs(Ne.percentual),"%"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:be(Ne.valor)})]})]})})()})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ComparaÃ§Ã£o Visual"}),e.jsx(Ma,{width:"100%",height:300,children:e.jsxs(ns,{data:[{nome:"Qtd Vendas",Anterior:K.quantidade_vendas||0,Atual:E.quantidade_vendas||0},{nome:"Vl. Bruto (mil)",Anterior:(K.venda_bruta||0)/1e3,Atual:(E.venda_bruta||0)/1e3},{nome:"Vl. LÃ­quido (mil)",Anterior:(K.venda_liquida||0)/1e3,Atual:(E.venda_liquida||0)/1e3},{nome:"Vl. Recebido (mil)",Anterior:(K.venda_liquida-K.em_aberto||0)/1e3,Atual:(E.venda_liquida-E.em_aberto||0)/1e3}],children:[e.jsx(Oa,{strokeDasharray:"3 3"}),e.jsx(Ba,{dataKey:"nome"}),e.jsx(Ia,{}),e.jsx(Pa,{formatter:(I,X)=>[X.includes("mil")?`R$ ${I.toFixed(1)}k`:I.toFixed(0),X]}),e.jsx(Ta,{}),e.jsx(Ka,{dataKey:"Anterior",fill:"#9CA3AF",name:"PerÃ­odo Anterior"}),e.jsx(Ka,{dataKey:"Atual",fill:"#3B82F6",name:"PerÃ­odo Atual"})]})})]})]}),h==="formas_pagamento"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ComparaÃ§Ã£o por Forma de Pagamento"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Forma de Pagamento"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Anterior"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Atual"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"DiferenÃ§a"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"VariaÃ§Ã£o %"})]})}),e.jsx("tbody",{children:Q.map((I,X)=>{const fe=W.find(ie=>ie.forma_pagamento===I.forma_pagamento)||{valor_total:0},U=Y(I.valor_total,fe.valor_total);return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:I.forma_pagamento}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:be(fe.valor_total)}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:be(I.valor_total)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(U.valor)}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded font-medium ${U.percentual>=0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[U.percentual>=0?e.jsx(js,{className:"w-4 h-4"}):e.jsx(vs,{className:"w-4 h-4"}),Math.abs(U.percentual),"%"]})})]},X)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ComparaÃ§Ã£o Visual"}),e.jsx(Ma,{width:"100%",height:350,children:e.jsxs(ns,{data:Q.map(I=>{var X;return{nome:I.forma_pagamento,Anterior:(((X=W.find(fe=>fe.forma_pagamento===I.forma_pagamento))==null?void 0:X.valor_total)||0)/1e3,Atual:I.valor_total/1e3}}),children:[e.jsx(Oa,{strokeDasharray:"3 3"}),e.jsx(Ba,{dataKey:"nome",angle:-15,textAnchor:"end",height:80}),e.jsx(Ia,{tickFormatter:I=>`R$ ${I.toFixed(0)}k`}),e.jsx(Pa,{formatter:I=>`R$ ${I.toFixed(1)}k`}),e.jsx(Ta,{}),e.jsx(Ka,{dataKey:"Anterior",fill:"#9CA3AF",name:"PerÃ­odo Anterior"}),e.jsx(Ka,{dataKey:"Atual",fill:"#10B981",name:"PerÃ­odo Atual"})]})})]})]}),h==="produtos"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ComparaÃ§Ã£o por Grupo de Produtos"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Grupo"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Anterior"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Atual"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"DiferenÃ§a"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"VariaÃ§Ã£o %"})]})}),e.jsx("tbody",{children:S.map((I,X)=>{const fe=H.find(ie=>ie.grupo===I.grupo)||{valor_liquido:0},U=Y(I.valor_liquido,fe.valor_liquido);return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:I.grupo}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:be(fe.valor_liquido)}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:be(I.valor_liquido)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(U.valor)}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded font-medium ${U.percentual>=0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[U.percentual>=0?e.jsx(js,{className:"w-4 h-4"}):e.jsx(vs,{className:"w-4 h-4"}),Math.abs(U.percentual),"%"]})})]},X)})})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"PerÃ­odo Anterior"}),e.jsx(Ma,{width:"100%",height:300,children:e.jsxs(jr,{children:[e.jsx(vr,{data:H,dataKey:"valor_liquido",nameKey:"grupo",cx:"50%",cy:"50%",outerRadius:80,label:I=>{const X=(I.valor_liquido/H.reduce((fe,U)=>fe+U.valor_liquido,0)*100).toFixed(1);return X>5?`${X}%`:""},children:H.map((I,X)=>e.jsx(Gt,{fill:Qe[X%Qe.length]},`cell-${X}`))}),e.jsx(Pa,{formatter:I=>be(I)}),e.jsx(Ta,{verticalAlign:"bottom",height:36})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"PerÃ­odo Atual"}),e.jsx(Ma,{width:"100%",height:300,children:e.jsxs(jr,{children:[e.jsx(vr,{data:S,dataKey:"valor_liquido",nameKey:"grupo",cx:"50%",cy:"50%",outerRadius:80,label:I=>{const X=(I.valor_liquido/S.reduce((fe,U)=>fe+U.valor_liquido,0)*100).toFixed(1);return X>5?`${X}%`:""},children:S.map((I,X)=>e.jsx(Gt,{fill:Qe[X%Qe.length]},`cell-${X}`))}),e.jsx(Pa,{formatter:I=>be(I)}),e.jsx(Ta,{verticalAlign:"bottom",height:36})]})})]})]})]}),h==="funcionarios"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ComparaÃ§Ã£o por FuncionÃ¡rio"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"FuncionÃ¡rio"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Qtd Ant."}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Qtd Atual"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Vl. Ant."}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Vl. Atual"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"VariaÃ§Ã£o"})]})}),e.jsx("tbody",{children:q.map((I,X)=>{const fe=de.find(ie=>ie.funcionario===I.funcionario)||{quantidade:0,valor_liquido:0},U=Y(I.valor_liquido,fe.valor_liquido);return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:I.funcionario}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:fe.quantidade}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:I.quantidade}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:be(fe.valor_liquido)}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:be(I.valor_liquido)}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded font-medium ${U.percentual>=0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[U.percentual>=0?e.jsx(js,{className:"w-4 h-4"}):e.jsx(vs,{className:"w-4 h-4"}),Math.abs(U.percentual),"%"]})})]},X)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ComparaÃ§Ã£o Visual - Valor LÃ­quido"}),e.jsx(Ma,{width:"100%",height:350,children:e.jsxs(ns,{data:q.map(I=>{var X;return{nome:I.funcionario,Anterior:(((X=de.find(fe=>fe.funcionario===I.funcionario))==null?void 0:X.valor_liquido)||0)/1e3,Atual:I.valor_liquido/1e3}}),children:[e.jsx(Oa,{strokeDasharray:"3 3"}),e.jsx(Ba,{dataKey:"nome",angle:-15,textAnchor:"end",height:80}),e.jsx(Ia,{tickFormatter:I=>`R$ ${I.toFixed(0)}k`}),e.jsx(Pa,{formatter:I=>`R$ ${I.toFixed(1)}k`}),e.jsx(Ta,{}),e.jsx(Ka,{dataKey:"Anterior",fill:"#9CA3AF",name:"PerÃ­odo Anterior"}),e.jsx(Ka,{dataKey:"Atual",fill:"#8B5CF6",name:"PerÃ­odo Atual"})]})})]})]})]}),t==="analise"&&e.jsxs("div",{className:"space-y-6",children:[s&&e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),!s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("h2",{className:"text-2xl font-bold",children:"AnÃ¡lise Inteligente de Produtos"})]}),e.jsx("p",{className:"text-blue-100",children:"Identifique os produtos mais lucrativos e oportunidades de melhoria no seu mix de produtos"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"ðŸ† Top Produtos por Lucro"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"#"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Produto"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Marca"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Qtd"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Custo Unit."}),e.jsx("th",{className:"text-right py-2 px-2",children:"PreÃ§o Venda"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Margem %"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Lucro Total"})]})}),e.jsx("tbody",{children:Re.map((I,X)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-2",children:e.jsx("span",{className:`inline-flex items-center justify-center w-7 h-7 rounded-full text-xs font-bold ${X===0?"bg-yellow-100 text-yellow-800":X===1?"bg-gray-100 text-gray-800":X===2?"bg-orange-100 text-orange-800":"bg-blue-50 text-blue-800"}`,children:X+1})}),e.jsx("td",{className:"py-3 px-2 font-medium",children:I.nome}),e.jsx("td",{className:"py-3 px-2 text-gray-600",children:I.marca||"-"}),e.jsx("td",{className:"py-3 px-2 text-right",children:Ee(I.quantidade)}),e.jsx("td",{className:"py-3 px-2 text-right text-red-600",children:be(Ee(I.custo))}),e.jsx("td",{className:"py-3 px-2 text-right text-green-600",children:be(Ee(I.preco))}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsxs("span",{className:`inline-block px-2 py-1 rounded text-xs font-semibold ${Ee(I.margem)>=50?"bg-green-100 text-green-800":Ee(I.margem)>=30?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[Ee(I.margem).toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 px-2 text-right font-bold text-green-600",children:be(Ee(I.lucro_total))})]},X))})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ðŸ“Š Desempenho por Categoria"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(_e).map(([I,X])=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"font-semibold text-gray-800 mb-2",children:I}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Vendas:"}),e.jsx("span",{className:"font-semibold",children:Ee(X.quantidade)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Faturamento:"}),e.jsx("span",{className:"font-semibold text-green-600",children:be(Ee(X.total))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Margem MÃ©dia:"}),e.jsxs("span",{className:`font-semibold ${Ee(X.margem_media)>=40?"text-green-600":Ee(X.margem_media)>=25?"text-yellow-600":"text-red-600"}`,children:[Ee(X.margem_media).toFixed(1),"%"]})]})]})]},I))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"âš ï¸ AtenÃ§Ã£o: Margens Baixas"})]}),e.jsxs("div",{className:"space-y-2",children:[Re.filter(I=>Ee(I.margem)<25).slice(0,5).map((I,X)=>e.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border-l-4 border-red-500",children:[e.jsx("div",{className:"font-medium text-sm",children:I.nome}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["Margem: ",e.jsxs("span",{className:"font-semibold text-red-600",children:[Ee(I.margem).toFixed(1),"%"]})," - ","Revisar preÃ§o de custo ou venda"]})]},X)),Re.filter(I=>Ee(I.margem)<25).length===0&&e.jsx("div",{className:"text-center text-gray-500 py-4",children:"âœ… Nenhum produto com margem crÃ­tica"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"ðŸ’¡ Oportunidades"})]}),e.jsxs("div",{className:"space-y-3",children:[Re.filter(I=>Ee(I.margem)>=40&&Ee(I.quantidade)<10).slice(0,3).map((I,X)=>e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx("div",{className:"font-medium text-sm",children:I.nome}),e.jsxs("div",{className:"text-xs text-blue-800 mt-1",children:[e.jsxs("strong",{children:["Alta margem (",Ee(I.margem).toFixed(1),"%)"]})," mas poucas vendas (",Ee(I.quantidade)," un.)",e.jsx("br",{}),"ðŸ’¬ Considere promover este produto"]})]},X)),Re.filter(I=>Ee(I.margem)>=40).slice(0,2).map((I,X)=>e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border-l-4 border-green-500",children:[e.jsx("div",{className:"font-medium text-sm",children:I.nome}),e.jsxs("div",{className:"text-xs text-green-800 mt-1",children:[e.jsx("strong",{children:"â­ CampeÃ£o de vendas"})," com excelente margem",e.jsx("br",{}),"ðŸ’¬ Mantenha em destaque"]})]},`camp-${X}`))]})]})]}),n&&Re.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ðŸ“ˆ Margem vs Volume de Vendas"}),e.jsx(Ma,{width:"100%",height:400,children:e.jsxs(ns,{data:Re.slice(0,15).map(I=>({...I,margem:Ee(I.margem),quantidade:Ee(I.quantidade)})),children:[e.jsx(Oa,{strokeDasharray:"3 3"}),e.jsx(Ba,{dataKey:"nome",angle:-45,textAnchor:"end",height:120,interval:0,tick:{fontSize:11}}),e.jsx(Ia,{yAxisId:"left",orientation:"left",stroke:"#10B981",label:{value:"Margem %",angle:-90,position:"insideLeft"}}),e.jsx(Ia,{yAxisId:"right",orientation:"right",stroke:"#3B82F6",label:{value:"Quantidade",angle:90,position:"insideRight"}}),e.jsx(Pa,{}),e.jsx(Ta,{}),e.jsx(Ka,{yAxisId:"left",dataKey:"margem",fill:"#10B981",name:"Margem %"}),e.jsx(Ka,{yAxisId:"right",dataKey:"quantidade",fill:"#3B82F6",name:"Qtd Vendida"})]})})]})]})]}),"    "]})}const Hi=()=>{const[s,l]=a.useState(!0),[t,m]=a.useState(!1),[r,g]=a.useState(null),[o,v]=a.useState([]),[j,f]=a.useState([]),[N,d]=a.useState([]),[x,k]=a.useState([]),[w,c]=a.useState({campo:null,direcao:"asc"}),[b,p]=a.useState({especies:[],linhas:[],portes:[],fases:[],tratamentos:[],sabores:[],pesos:[],marca_ids:[],categoria_ids:[],margem_min:null,margem_max:null,data_inicio:null,data_fim:null}),[i,u]=a.useState({marcas:[],categorias:[],especies:[],linhas:[],portes:[],fases:[],tratamentos:[],sabores:[],pesos:[]}),[n,C]=a.useState("porte"),[h,_]=a.useState(!0),[E,$]=a.useState("comparacao");a.useEffect(()=>{K()},[]);const K=async()=>{var W,ne,H;try{l(!0);const ee=localStorage.getItem("access_token");console.log("ðŸ” [DashboardAnaliseRacoes] Iniciando carregamento de dados",{hasToken:!!ee,tokenPreview:ee?`${ee.substring(0,20)}...`:"NO TOKEN"}),console.log("ðŸ“¡ [DashboardAnaliseRacoes] Chamando: /racoes/analises/opcoes-filtros");const de=await F.get("/racoes/analises/opcoes-filtros");console.log("âœ… [DashboardAnaliseRacoes] OpÃ§Ãµes carregadas:",de.data),u(de.data),await te(),l(!1)}catch(ee){console.error("âŒ [DashboardAnaliseRacoes] Erro ao carregar dados:",{message:ee.message,status:(W=ee.response)==null?void 0:W.status,data:(ne=ee.response)==null?void 0:ne.data,config:ee.config}),((H=ee.response)==null?void 0:H.status)===403?ce.error("Acesso negado. Verifique suas permissÃµes ou faÃ§a login novamente."):ce.error("Erro ao carregar dados do dashboard"),l(!1)}},te=async(W=null,ne=null)=>{try{const H={};W&&(H.data_inicio=W),ne&&(H.data_fim=ne);const ee=await F.get("/racoes/analises/resumo",{params:H});g(ee.data)}catch(H){console.error("Erro ao carregar resumo:",H),ce.error("Erro ao carregar resumo")}},M=async()=>{try{m(!0);const W=await F.post(`/racoes/analises/margem-por-segmento?tipo_segmento=${n}`,b);v(W.data),m(!1)}catch(W){console.error("Erro ao carregar anÃ¡lise:",W),ce.error("Erro ao carregar anÃ¡lise de segmento"),m(!1)}},A=async()=>{try{m(!0);const W=await F.post("/racoes/analises/comparacao-marcas",b);f(W.data),m(!1)}catch(W){console.error("Erro ao carregar comparaÃ§Ã£o:",W),ce.error("Erro ao carregar comparaÃ§Ã£o de marcas"),m(!1)}},Q=async()=>{try{if(!b.data_inicio||!b.data_fim){ce.error("Selecione um perÃ­odo para ver o ranking de vendas");return}m(!0);const W=await F.get("/racoes/analises/ranking-vendas",{params:{data_inicio:b.data_inicio,data_fim:b.data_fim,limite:20}});d(W.data),m(!1)}catch(W){console.error("Erro ao carregar ranking:",W),ce.error("Erro ao carregar ranking de vendas"),m(!1)}},re=async()=>{try{m(!0);const W=await F.post("/racoes/analises/produtos-comparacao",b);k(W.data),c({campo:null,direcao:"asc"}),m(!1)}catch(W){console.error("Erro ao carregar produtos para comparaÃ§Ã£o:",W),ce.error("Erro ao carregar produtos"),m(!1)}},q=W=>{const ne=w.campo===W&&w.direcao==="asc"?"desc":"asc";c({campo:W,direcao:ne});const H=[...x].sort((ee,de)=>{let ue,Re;switch(W){case"nome":ue=ee.nome,Re=de.nome;break;case"custo":ue=ee.preco_custo||0,Re=de.preco_custo||0;break;case"venda":ue=ee.preco_venda||0,Re=de.preco_venda||0;break;case"lucro":ue=(ee.preco_venda||0)-(ee.preco_custo||0),Re=(de.preco_venda||0)-(de.preco_custo||0);break;case"margem":ue=calcularMargem(ee.preco_custo,ee.preco_venda),Re=calcularMargem(de.preco_custo,de.preco_venda);break;case"roi":ue=calcularROI(ee.preco_custo,ee.preco_venda),Re=calcularROI(de.preco_custo,de.preco_venda);break;case"custokg":ue=(ee.preco_custo||0)/(ee.peso_embalagem||1),Re=(de.preco_custo||0)/(de.peso_embalagem||1);break;case"vendakg":ue=(ee.preco_venda||0)/(ee.peso_embalagem||1),Re=(de.preco_venda||0)/(de.peso_embalagem||1);break;default:return 0}return typeof ue=="string"?ne==="asc"?ue.localeCompare(Re):Re.localeCompare(ue):ne==="asc"?ue-Re:Re-ue});k(H)},Z=(W,ne)=>{p(H=>({...H,[W]:ne}))},R=(W,ne)=>{p(H=>{const ee=H[W]||[],de=ee.includes(ne);return{...H,[W]:de?ee.filter(ue=>ue!==ne):[...ee,ne]}})},J=()=>{E==="segmento"?M():E==="marcas"?A():E==="ranking"?Q():E==="comparacao"&&re(),b.data_inicio&&b.data_fim&&te(b.data_inicio,b.data_fim)},S=()=>{p({especies:[],linhas:[],portes:[],fases:[],tratamentos:[],sabores:[],pesos:[],marca_ids:[],categoria_ids:[],margem_min:null,margem_max:null,data_inicio:null,data_fim:null})},P=W=>{$(W),W==="segmento"&&o.length===0?M():W==="marcas"&&j.length===0?A():W==="ranking"&&N.length===0?b.data_inicio&&b.data_fim&&Q():W==="comparacao"&&x.length===0&&re()},G=()=>r?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Za,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"RaÃ§Ãµes Cadastradas"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:r.total_racoes}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[r.total_classificadas," classificadas (",r.percentual_classificadas,"%)"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(To,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Margem MÃ©dia"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[r.margem_media_geral,"%"]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["em ",r.total_racoes," produtos"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(La,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Faturamento PerÃ­odo"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",r.faturamento_periodo.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[r.marcas_cadastradas," marcas ativas"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Cl,{className:"h-5 w-5 text-purple-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Mais Vendido"})]}),r.produto_mais_vendido?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 truncate",children:r.produto_mais_vendido.nome}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[r.produto_mais_vendido.quantidade," unidades"]})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Sem dados de vendas"})]})]}):null,B=()=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ct,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Filtros"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:"Clique para selecionar/desmarcar"})]}),e.jsx("button",{onClick:()=>_(!h),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:h?"Ocultar â–²":"Mostrar â–¼"})]}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Marcas"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.marcas.map(W=>e.jsx("button",{onClick:()=>R("marca_ids",W.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${b.marca_ids.includes(W.id)?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:W.nome},W.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Linha de RaÃ§Ã£o"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.linhas.map(W=>e.jsx("button",{onClick:()=>R("linhas",W.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${b.linhas.includes(W.id)?"bg-purple-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:W.nome},W.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Porte do Animal"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.portes.map(W=>e.jsx("button",{onClick:()=>R("portes",W.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${b.portes.includes(W.id)?"bg-green-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:W.nome},W.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Fase/PÃºblico"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.fases.map(W=>e.jsx("button",{onClick:()=>R("fases",W.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${b.fases.includes(W.id)?"bg-amber-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:W.nome},W.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Sabor/ProteÃ­na"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.sabores.map(W=>e.jsx("button",{onClick:()=>R("sabores",W),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${b.sabores.includes(W)?"bg-pink-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:W},W))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Peso da Embalagem"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.pesos.map(W=>e.jsxs("button",{onClick:()=>R("pesos",W),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${b.pesos.includes(W)?"bg-indigo-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[W," kg"]},W))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Margem MÃ­nima (%)"}),e.jsx("input",{type:"number",step:"0.01",value:b.margem_min||"",onChange:W=>Z("margem_min",parseFloat(W.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"Ex: 25"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Margem MÃ¡xima (%)"}),e.jsx("input",{type:"number",step:"0.01",value:b.margem_max||"",onChange:W=>Z("margem_max",parseFloat(W.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"Ex: 50"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:b.data_inicio||"",onChange:W=>Z("data_inicio",W.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:b.data_fim||"",onChange:W=>Z("data_fim",W.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsxs("button",{onClick:J,className:"px-6 py-2.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2 font-medium",children:[e.jsx(Ct,{className:"h-4 w-4"}),"Aplicar Filtros"]}),e.jsx("button",{onClick:S,className:"px-6 py-2.5 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 font-medium",children:"Limpar Tudo"}),b.marca_ids.length+b.linhas.length+b.portes.length+b.fases.length+b.sabores.length+b.pesos.length>0&&e.jsxs("div",{className:"flex items-center gap-2 ml-auto text-sm text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:b.marca_ids.length+b.linhas.length+b.portes.length+b.fases.length+b.sabores.length+b.pesos.length}),"filtros ativos"]})]})]})]}),y=()=>t?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando anÃ¡lise..."}):o.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(da,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),'Nenhum dado encontrado. Aplique filtros e clique em "Aplicar Filtros"']}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Analisar por:"}),e.jsxs("select",{value:n,onChange:W=>{C(W.target.value),setTimeout(()=>M(),0)},className:"px-3 py-1.5 border border-gray-300 rounded-md text-sm",children:[e.jsx("option",{value:"porte",children:"Porte"}),e.jsx("option",{value:"fase",children:"Fase"}),e.jsx("option",{value:"sabor",children:"Sabor"}),e.jsx("option",{value:"linha",children:"Linha"}),e.jsx("option",{value:"especie",children:"EspÃ©cie"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Segmento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Produtos"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Margem MÃ©dia"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Margem Min/Max"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"PreÃ§o/Kg MÃ©dio"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Faturamento"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:o.map((W,ne)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900",children:W.segmento}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:W.total_produtos}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("span",{className:`font-semibold ${W.margem_media>=30?"text-green-600":W.margem_media>=20?"text-yellow-600":"text-red-600"}`,children:[W.margem_media,"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:[W.margem_minima,"% - ",W.margem_maxima,"%"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:["R$ ",W.preco_medio_kg.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center font-semibold text-gray-900",children:["R$ ",W.faturamento.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]},ne))})]})})]}),O=()=>t?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando comparaÃ§Ã£o..."}):j.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(da,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),'Nenhum dado encontrado. Aplique filtros e clique em "Aplicar Filtros"']}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Marca"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Produtos"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"PreÃ§o/Kg MÃ©dio"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Margem MÃ©dia"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Mais Barato"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Mais Caro"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:j.map(W=>{var ne,H,ee,de,ue,Re;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900",children:W.marca_nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:W.total_produtos}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center font-semibold text-gray-900",children:["R$ ",W.preco_medio_kg.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("span",{className:`font-semibold ${W.margem_media>=30?"text-green-600":W.margem_media>=20?"text-yellow-600":"text-red-600"}`,children:[W.margem_media,"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-xs text-gray-700",children:[((H=(ne=W.produto_mais_barato)==null?void 0:ne.nome)==null?void 0:H.substring(0,30))||"-",((ee=W.produto_mais_barato)==null?void 0:ee.preco_kg)&&e.jsxs("div",{className:"text-green-600 font-semibold",children:["R$ ",W.produto_mais_barato.preco_kg,"/kg"]})]}),e.jsxs("td",{className:"px-4 py-3 text-xs text-gray-700",children:[((ue=(de=W.produto_mais_caro)==null?void 0:de.nome)==null?void 0:ue.substring(0,30))||"-",((Re=W.produto_mais_caro)==null?void 0:Re.preco_kg)&&e.jsxs("div",{className:"text-red-600 font-semibold",children:["R$ ",W.produto_mais_caro.preco_kg,"/kg"]})]})]},W.marca_id)})})]})}),z=()=>t?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando ranking..."}):N.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(da,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),'Selecione um perÃ­odo nos filtros e clique em "Aplicar Filtros"']}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Marca"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Qtd Vendida"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Faturamento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Margem MÃ©dia"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"PreÃ§o MÃ©dio"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:N.map((W,ne)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold ${ne===0?"bg-yellow-100 text-yellow-700":ne===1?"bg-gray-200 text-gray-700":ne===2?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-600"}`,children:ne+1})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:W.nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:W.marca}),e.jsx("td",{className:"px-4 py-3 text-sm text-center font-semibold text-gray-900",children:W.quantidade_vendida}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center font-semibold text-green-600",children:["R$ ",W.faturamento.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("span",{className:`font-semibold ${W.margem_media>=30?"text-green-600":W.margem_media>=20?"text-yellow-600":"text-red-600"}`,children:[W.margem_media,"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center text-gray-900",children:["R$ ",W.preco_medio_venda.toFixed(2)]})]},W.produto_id))})]})}),ae=()=>{if(t)return e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Fa,{className:"h-8 w-8 animate-spin text-blue-500 mr-3"}),e.jsx("span",{className:"text-gray-600",children:"Carregando produtos..."})]});if(x.length===0)return e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(da,{className:"h-16 w-16 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Nenhum produto encontrado"}),e.jsx("p",{className:"text-sm",children:'Selecione filtros acima e clique em "Aplicar Filtros"'})]});const W=(he,Qe)=>!Qe||Qe===0?0:parseFloat(((Qe-he)/Qe*100).toFixed(2)),ne=(he,Qe)=>!he||he===0?0:parseFloat(((Qe-he)/he*100).toFixed(2)),H=(he,Qe)=>parseFloat((Qe-he).toFixed(2)),ee=(he,Qe)=>!he||he===0?0:parseFloat(((Qe-he)/he*100).toFixed(2)),de=x.map(he=>he.preco_custo||0),ue=x.map(he=>W(he.preco_custo,he.preco_venda)),Re=x.map(he=>H(he.preco_custo||0,he.preco_venda||0)),se=x.map(he=>ee(he.preco_custo,he.preco_venda)),_e=Math.min(...de.filter(he=>he>0)),ke=Math.max(...ue),Ze=Math.max(...Re),ze=Math.max(...se),Xe=(he,Qe,Ye,ca=!1)=>{if(Ye===Qe)return"bg-gray-50";const ra=(he-Qe)/(Ye-Qe)*100;return ca?ra<=20?"bg-green-50 text-green-800 font-semibold":ra<=40?"bg-green-50 text-green-700":ra<=60?"bg-yellow-50 text-yellow-700":ra<=80?"bg-orange-50 text-orange-700":"bg-red-50 text-red-700":ra>=80?"bg-green-50 text-green-800 font-semibold":ra>=60?"bg-green-50 text-green-700":ra>=40?"bg-yellow-50 text-yellow-700":ra>=20?"bg-orange-50 text-orange-700":"bg-red-50 text-red-700"},be=he=>he>=40?"text-green-700 bg-green-100 border-green-300":he>=30?"text-green-600 bg-green-50 border-green-200":he>=20?"text-yellow-600 bg-yellow-50 border-yellow-200":he>=10?"text-orange-600 bg-orange-50 border-orange-200":"text-red-600 bg-red-50 border-red-200",Ee=({campo:he,children:Qe,className:Ye=""})=>e.jsx("th",{onClick:()=>q(he),className:`px-3 py-3 text-xs font-bold text-gray-700 uppercase cursor-pointer hover:bg-gray-200 transition-colors ${Ye}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[Qe,w.campo===he&&e.jsx("span",{className:"text-blue-600",children:w.direcao==="asc"?"â–²":"â–¼"})]})});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4 border-2 border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ’°"}),e.jsx("span",{className:"text-xs font-semibold text-green-700 uppercase",children:"Menor Custo"})]}),e.jsxs("p",{className:"text-2xl font-bold text-green-900",children:["R$ ",_e.toFixed(2)]}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Melhor preÃ§o de compra"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border-2 border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:"â­"}),e.jsx("span",{className:"text-xs font-semibold text-blue-700 uppercase",children:"Melhor Margem"})]}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[ke.toFixed(2),"%"]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Maior percentual de lucro"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4 border-2 border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŽ¯"}),e.jsx("span",{className:"text-xs font-semibold text-purple-700 uppercase",children:"Melhor ROI"})]}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900",children:[ze.toFixed(2),"%"]}),e.jsx("p",{className:"text-xs text-purple-600 mt-1",children:"Retorno sobre investimento"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 rounded-lg p-4 border-2 border-amber-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ’µ"}),e.jsx("span",{className:"text-xs font-semibold text-amber-700 uppercase",children:"Maior Lucro"})]}),e.jsxs("p",{className:"text-2xl font-bold text-amber-900",children:["R$ ",Ze.toFixed(2)]}),e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"Lucro absoluto por unidade"})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total de Produtos Encontrados"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:x.length})]}),x.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Margem MÃ©dia"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[(ue.reduce((he,Qe)=>he+Qe,0)/ue.length).toFixed(2),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Custo MÃ©dio/kg"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["R$ ",(x.reduce((he,Qe)=>he+(Qe.preco_custo||0)/(Qe.peso_embalagem||1),0)/x.length).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"PreÃ§o Venda MÃ©dio/kg"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["R$ ",(x.reduce((he,Qe)=>he+(Qe.preco_venda||0)/(Qe.peso_embalagem||1),0)/x.length).toFixed(2)]})]})]})]})}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-start gap-2",children:[e.jsx(da,{className:"h-5 w-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("strong",{children:"ðŸ’¡ Dica:"})," Clique nos cabeÃ§alhos das colunas para ordenar. As cores indicam valores melhores (verde) e piores (vermelho). Produtos destacados com badges sÃ£o os melhores em cada categoria."]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border-2 border-gray-300 shadow-lg",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{className:"bg-gradient-to-r from-gray-100 to-gray-200 border-b-2 border-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase sticky left-0 bg-gray-100 border-r border-gray-300",children:"Produto / Marca"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-gray-700 uppercase border-r border-gray-300",children:"Linha"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-gray-700 uppercase border-r border-gray-300",children:"Peso"}),e.jsx(Ee,{campo:"custo",className:"border-r border-gray-300",children:"ðŸ’° Custo"}),e.jsx(Ee,{campo:"venda",className:"border-r border-gray-300",children:"ðŸ’µ Venda"}),e.jsx(Ee,{campo:"lucro",className:"border-r border-gray-300",children:"Lucro R$"}),e.jsx(Ee,{campo:"margem",className:"border-r border-gray-300",children:"ðŸ“Š Margem %"}),e.jsx(Ee,{campo:"roi",className:"border-r border-gray-300",children:"ðŸŽ¯ ROI %"}),e.jsx(Ee,{campo:"custokg",className:"border-r border-gray-300",children:"Custo/kg"}),e.jsx(Ee,{campo:"vendakg",className:"border-r border-gray-300",children:"Venda/kg"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-gray-700 uppercase",children:"Estoque"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:x.map(he=>{var Ie;const Qe=W(he.preco_custo,he.preco_venda);ne(he.preco_custo,he.preco_venda);const Ye=H(he.preco_custo||0,he.preco_venda||0),ca=ee(he.preco_custo,he.preco_venda),ra=(he.preco_custo||0)/(he.peso_embalagem||1),pa=(he.preco_venda||0)/(he.peso_embalagem||1),na=(he.preco_custo||0)===_e&&_e>0,oe=Qe===ke&&ke>0,ye=Ye===Ze&&Ze>0,Ce=ca===ze&&ze>0,Be=na||oe||ye||Ce;return e.jsxs("tr",{className:`hover:bg-blue-50 transition-colors ${Be?"bg-yellow-50 border-l-4 border-yellow-400":""}`,children:[e.jsx("td",{className:"px-4 py-3 sticky left-0 bg-white border-r border-gray-200",children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm",children:he.nome}),e.jsxs("p",{className:"text-xs text-gray-600 mt-0.5",children:[((Ie=he.marca)==null?void 0:Ie.nome)||"Sem marca"," â€¢ CÃ³d: ",he.codigo]}),e.jsxs("div",{className:"flex gap-1 mt-1.5 flex-wrap",children:[he.porte_animal&&Array.isArray(he.porte_animal)&&he.porte_animal.map(Y=>e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-1.5 py-0.5 rounded",children:Y},Y)),he.fase_publico&&Array.isArray(he.fase_publico)&&he.fase_publico.map(Y=>e.jsx("span",{className:"text-xs bg-amber-100 text-amber-700 px-1.5 py-0.5 rounded",children:Y},Y)),he.sabor_proteina&&e.jsx("span",{className:"text-xs bg-pink-100 text-pink-700 px-1.5 py-0.5 rounded",children:he.sabor_proteina})]}),e.jsxs("div",{className:"flex gap-1 mt-2 flex-wrap",children:[na&&e.jsx("span",{className:"text-xs bg-green-600 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:"ðŸ’° MENOR CUSTO"}),oe&&e.jsx("span",{className:"text-xs bg-blue-600 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:"â­ MELHOR MARGEM"}),Ce&&e.jsx("span",{className:"text-xs bg-purple-600 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:"ðŸŽ¯ MELHOR ROI"}),ye&&e.jsx("span",{className:"text-xs bg-amber-600 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:"ðŸ’µ MAIOR LUCRO"})]})]})}),e.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-700 border-r border-gray-200",children:e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-medium",children:he.classificacao_racao||"-"})}),e.jsx("td",{className:"px-3 py-3 text-sm text-center font-medium text-gray-900 border-r border-gray-200",children:he.peso_embalagem?e.jsxs("span",{className:"px-2 py-1 bg-gray-100 rounded font-bold",children:[he.peso_embalagem," kg"]}):"-"}),e.jsxs("td",{className:`px-3 py-3 text-sm text-center font-bold border-r border-gray-200 ${Xe(he.preco_custo||0,_e,Math.max(...de),!0)}`,children:["R$ ",(he.preco_custo||0).toFixed(2)]}),e.jsxs("td",{className:`px-3 py-3 text-sm text-center font-bold border-r border-gray-200 ${Xe(he.preco_venda||0,Math.min(...x.map(Y=>Y.preco_venda||0)),Math.max(...x.map(Y=>Y.preco_venda||0)))}`,children:["R$ ",(he.preco_venda||0).toFixed(2)]}),e.jsxs("td",{className:`px-3 py-3 text-sm text-center font-bold border-r border-gray-200 ${Xe(Ye,Math.min(...Re),Math.max(...Re))}`,children:["R$ ",Ye.toFixed(2)]}),e.jsx("td",{className:"px-3 py-3 text-center border-r border-gray-200",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsxs("span",{className:`px-3 py-1.5 rounded-lg font-bold text-sm border-2 ${be(Qe)}`,children:[Qe.toFixed(2),"%"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${Qe>=40?"bg-green-500":Qe>=30?"bg-green-400":Qe>=20?"bg-yellow-400":Qe>=10?"bg-orange-400":"bg-red-400"}`,style:{width:`${Math.min(Qe,100)}%`}})})]})}),e.jsxs("td",{className:`px-3 py-3 text-sm text-center font-bold border-r border-gray-200 ${Xe(ca,Math.min(...se),Math.max(...se))}`,children:[ca.toFixed(2),"%"]}),e.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-700 border-r border-gray-200",children:e.jsxs("span",{className:`px-2 py-1 rounded font-semibold ${Xe(ra,Math.min(...x.map(Y=>(Y.preco_custo||0)/(Y.peso_embalagem||1))),Math.max(...x.map(Y=>(Y.preco_custo||0)/(Y.peso_embalagem||1))),!0)}`,children:["R$ ",ra.toFixed(2)]})}),e.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-700 border-r border-gray-200",children:e.jsxs("span",{className:`px-2 py-1 rounded font-semibold ${Xe(pa,Math.min(...x.map(Y=>(Y.preco_venda||0)/(Y.peso_embalagem||1))),Math.max(...x.map(Y=>(Y.preco_venda||0)/(Y.peso_embalagem||1))))}`,children:["R$ ",pa.toFixed(2)]})}),e.jsx("td",{className:"px-3 py-3 text-sm text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${(he.estoque_atual||0)>10?"bg-green-100 text-green-700 border border-green-300":(he.estoque_atual||0)>0?"bg-yellow-100 text-yellow-700 border border-yellow-300":"bg-red-100 text-red-700 border border-red-300"}`,children:he.estoque_atual||0})})]},he.id)})})]})}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg p-4 border-2 border-gray-300",children:[e.jsxs("p",{className:"text-sm font-bold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“–"})," Legenda e Dicas de InterpretaÃ§Ã£o:"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx("span",{className:"font-bold text-green-700",children:"ðŸŸ¢ Verde:"}),e.jsx("span",{className:"text-gray-700",children:"Valores melhores (menor custo, maior margem/lucro)"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx("span",{className:"font-bold text-red-700",children:"ðŸ”´ Vermelho:"}),e.jsx("span",{className:"text-gray-700",children:"Valores piores (maior custo, menor margem/lucro)"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx("span",{className:"font-bold text-yellow-700",children:"ðŸŸ¡ Amarelo:"}),e.jsx("span",{className:"text-gray-700",children:"Destaque na linha = um dos melhores produtos"})]})]}),e.jsxs("div",{className:"space-y-1.5 text-xs text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Margem %:"})," (Venda - Custo) / Venda Ã— 100"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ROI %:"})," (Lucro / Custo) Ã— 100"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Lucro R$:"})," Venda - Custo (valor absoluto)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Custo/Venda por kg:"})," PreÃ§o dividido pelo peso"]})]})]})]})]})};return s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Fa,{className:"h-8 w-8 animate-spin text-blue-500"})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(St,{className:"h-7 w-7 text-blue-600"}),"AnÃ¡lise Inteligente de RaÃ§Ãµes"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Dashboard dinÃ¢mico com anÃ¡lises avanÃ§adas de margem e vendas"})]}),e.jsxs("button",{onClick:()=>K(),className:"px-4 py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(Fa,{className:"h-4 w-4"}),"Atualizar"]})]}),G(),B(),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex space-x-1 p-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>P("comparacao"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${E==="comparacao"?"bg-blue-600 text-white shadow-md":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Io,{className:"h-4 w-4 inline mr-2"}),"ðŸ“Š ComparaÃ§Ã£o Detalhada"]}),e.jsxs("button",{onClick:()=>P("segmento"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${E==="segmento"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Aa,{className:"h-4 w-4 inline mr-2"}),"Margem por Segmento"]}),e.jsxs("button",{onClick:()=>P("marcas"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${E==="marcas"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Za,{className:"h-4 w-4 inline mr-2"}),"ComparaÃ§Ã£o de Marcas"]}),e.jsxs("button",{onClick:()=>P("ranking"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${E==="ranking"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(er,{className:"h-4 w-4 inline mr-2"}),"Ranking de Vendas"]})]})}),e.jsxs("div",{className:"p-4",children:[E==="comparacao"&&ae(),E==="resumo"&&G(),E==="segmento"&&y(),E==="marcas"&&O(),E==="ranking"&&z()]})]})]})},Gi=()=>{var Z,R,J;const[s,l]=a.useState(!0),[t,m]=a.useState(null),[r,g]=a.useState([]),[o,v]=a.useState([]),[j,f]=a.useState([]),[N,d]=a.useState("resumo"),[x,k]=a.useState(.8),[w,c]=a.useState("porte"),[b,p]=a.useState({}),[i,u]=a.useState({});a.useEffect(()=>{n()},[]);const n=async()=>{try{l(!0);const S=await F.get("/racoes/sugestoes/relatorio-completo");m(S.data),l(!1)}catch(S){console.error("Erro ao carregar relatÃ³rio:",S),ce.error("Erro ao carregar relatÃ³rio de sugestÃµes"),l(!1)}},C=async()=>{try{l(!0);const S=await F.get(`/racoes/sugestoes/duplicatas?threshold_similaridade=${x}`);g(S.data),l(!1)}catch(S){console.error("Erro ao carregar duplicatas:",S),ce.error("Erro ao carregar duplicatas"),l(!1)}},h=async()=>{try{l(!0);const S=await F.get("/racoes/sugestoes/padronizar-nomes?limite=50");v(S.data),l(!1)}catch(S){console.error("Erro ao carregar padronizaÃ§Ãµes:",S),ce.error("Erro ao carregar sugestÃµes de padronizaÃ§Ã£o"),l(!1)}},_=async()=>{try{l(!0);const S=await F.get(`/racoes/sugestoes/gaps-estoque?tipo_segmento=${w}`);f(S.data),l(!1)}catch(S){console.error("Erro ao carregar gaps:",S),ce.error("Erro ao carregar gaps de estoque"),l(!1)}},E=S=>{d(S),S==="duplicatas"&&r.length===0?C():S==="padronizacao"&&o.length===0?h():S==="gaps"&&j.length===0&&_()},$=async S=>{try{const P=i[S.produto_id],G=(P==null?void 0:P.nome)||S.nome_sugerido;await F.patch(`/produtos/${S.produto_id}`,{nome:G}),ce.success("Nome atualizado com sucesso!"),v(B=>B.filter(y=>y.produto_id!==S.produto_id)),u(B=>{const y={...B};return delete y[S.produto_id],y}),n()}catch(P){console.error("Erro ao aplicar padronizaÃ§Ã£o:",P),ce.error("Erro ao atualizar nome do produto")}},K=async S=>{try{await F.post("/racoes/sugestoes/duplicatas/ignorar",null,{params:{produto_id_1:S.produto_1.id,produto_id_2:S.produto_2.id}}),ce.success("Duplicata ignorada com sucesso!"),g(P=>P.filter(G=>!(G.produto_1.id===S.produto_1.id&&G.produto_2.id===S.produto_2.id))),n()}catch(P){console.error("Erro ao ignorar duplicata:",P),ce.error("Erro ao ignorar duplicata")}},te=(S,P)=>{p(G=>({...G,[S]:P}))},M=async(S,P)=>{const G=b[P];if(!G){ce.error("Selecione qual produto deseja manter antes de confirmar");return}const B=G==="produto_1"?S.produto_1.id:S.produto_2.id,y=G==="produto_1"?S.produto_2.id:S.produto_1.id;G==="produto_1"?S.produto_1.nome:S.produto_2.nome,G==="produto_1"?S.produto_2.nome:S.produto_1.nome;try{const O=await F.post("/racoes/sugestoes/duplicatas/mesclar",null,{params:{produto_id_manter:B,produto_id_remover:y,transferir_estoque:!0}});ce.success(O.data.mensagem),g(z=>z.filter(ae=>!(ae.produto_1.id===S.produto_1.id&&ae.produto_2.id===S.produto_2.id))),p(z=>{const ae={...z};return delete ae[P],ae}),n()}catch(O){console.error("Erro ao mesclar produtos:",O),ce.error("Erro ao mesclar produtos")}},A=()=>{if(!t)return null;const{score_saude:S,classificacao:P,cor:G,resumo:B,recomendacoes:y}=t;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Score de SaÃºde do Cadastro"}),e.jsx("button",{onClick:n,className:"text-blue-600 hover:text-blue-700",children:e.jsx(Fa,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:`w-32 h-32 rounded-full flex items-center justify-center border-8 ${G==="green"?"border-green-500":G==="blue"?"border-blue-500":G==="yellow"?"border-yellow-500":"border-red-500"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:S}),e.jsx("div",{className:"text-xs text-gray-600",children:"pontos"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`inline-block px-4 py-2 rounded-full text-white font-semibold mb-3 ${G==="green"?"bg-green-500":G==="blue"?"bg-blue-500":G==="yellow"?"bg-yellow-500":"bg-red-500"}`,children:P}),e.jsxs("p",{className:"text-gray-700 mb-4",children:[S>=90&&"ParabÃ©ns! Seu cadastro de raÃ§Ãµes estÃ¡ excelente.",S>=70&&S<90&&"Seu cadastro estÃ¡ em bom estado, mas hÃ¡ algumas melhorias possÃ­veis.",S>=50&&S<70&&"AtenÃ§Ã£o! Existem vÃ¡rios pontos de melhoria no cadastro.",S<50&&"CRÃTICO! Ã‰ necessÃ¡rio realizar melhorias urgentes no cadastro."]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ot,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:B.duplicatas_detectadas})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Duplicatas Detectadas"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ht,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:B.nomes_padronizar})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Nomes para Padronizar"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ro,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:B.gaps_criticos})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Gaps de Estoque CrÃ­ticos"})]})]}),y&&y.filter(Boolean).length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(da,{className:"h-5 w-5"}),"RecomendaÃ§Ãµes PrioritÃ¡rias"]}),e.jsx("ul",{className:"space-y-2",children:y.filter(Boolean).map((O,z)=>e.jsxs("li",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),O]},z))})]})]})},Q=()=>s?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando..."}):r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ha,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-700 font-semibold",children:"Nenhuma duplicata detectada!"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Seu cadastro estÃ¡ livre de produtos duplicados"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mr-2",children:"Threshold de Similaridade:"}),e.jsx("input",{type:"range",min:"0.5",max:"1",step:"0.05",value:x,onChange:S=>k(parseFloat(S.target.value)),className:"w-32"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:[(x*100).toFixed(0),"%"]})]}),e.jsxs("button",{onClick:C,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(As,{className:"h-4 w-4"}),"Buscar Duplicatas"]})]}),r.map((S,P)=>e.jsxs("div",{className:"bg-white border-2 border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ot,{className:"h-5 w-5 text-orange-500"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["Similaridade: ",(S.score_similaridade*100).toFixed(0),"%"]})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${S.score_similaridade>=.9?"bg-red-100 text-red-700":S.score_similaridade>=.8?"bg-orange-100 text-orange-700":"bg-yellow-100 text-yellow-700"}`,children:S.sugestao_acao})]}),e.jsxs("div",{className:"mb-3 text-sm text-gray-700 bg-blue-50 p-2 rounded",children:["ðŸ‘† ",e.jsx("strong",{children:"Clique no produto que deseja MANTER"})," (o outro serÃ¡ inativado e terÃ¡ o estoque transferido)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{onClick:()=>te(P,"produto_1"),className:`rounded p-3 cursor-pointer transition-all border-2 ${b[P]==="produto_1"?"bg-green-50 border-green-500 shadow-lg":b[P]==="produto_2"?"bg-red-50 border-red-300 opacity-60":"bg-gray-50 border-gray-200 hover:border-blue-400 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Produto 1 (ID: ",S.produto_1.id,")"]}),b[P]==="produto_1"&&e.jsx(ha,{className:"h-5 w-5 text-green-600"})]}),e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:S.produto_1.nome}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Marca: ",S.produto_1.marca]}),e.jsxs("div",{children:["PreÃ§o: R$ ",S.produto_1.preco.toFixed(2)]}),e.jsxs("div",{children:["Estoque: ",S.produto_1.estoque]})]}),b[P]==="produto_1"&&e.jsx("div",{className:"mt-2 text-xs font-semibold text-green-700 bg-green-100 px-2 py-1 rounded",children:"âœ“ ESTE PRODUTO SERÃ MANTIDO"}),b[P]==="produto_2"&&e.jsx("div",{className:"mt-2 text-xs text-red-700 bg-red-100 px-2 py-1 rounded",children:"âœ— Este produto serÃ¡ inativado"})]}),e.jsxs("div",{onClick:()=>te(P,"produto_2"),className:`rounded p-3 cursor-pointer transition-all border-2 ${b[P]==="produto_2"?"bg-green-50 border-green-500 shadow-lg":b[P]==="produto_1"?"bg-red-50 border-red-300 opacity-60":"bg-gray-50 border-gray-200 hover:border-blue-400 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Produto 2 (ID: ",S.produto_2.id,")"]}),b[P]==="produto_2"&&e.jsx(ha,{className:"h-5 w-5 text-green-600"})]}),e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:S.produto_2.nome}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Marca: ",S.produto_2.marca]}),e.jsxs("div",{children:["PreÃ§o: R$ ",S.produto_2.preco.toFixed(2)]}),e.jsxs("div",{children:["Estoque: ",S.produto_2.estoque]})]}),b[P]==="produto_2"&&e.jsx("div",{className:"mt-2 text-xs font-semibold text-green-700 bg-green-100 px-2 py-1 rounded",children:"âœ“ ESTE PRODUTO SERÃ MANTIDO"}),b[P]==="produto_1"&&e.jsx("div",{className:"mt-2 text-xs text-red-700 bg-red-100 px-2 py-1 rounded",children:"âœ— Este produto serÃ¡ inativado"})]})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-1",children:S.razoes.map((G,B)=>e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:G},B))}),e.jsxs("div",{className:"mt-4 flex gap-2 justify-end",children:[e.jsxs("button",{onClick:()=>K(S),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 flex items-center gap-2 text-sm",children:[e.jsx(ds,{className:"h-4 w-4"}),"Ignorar (NÃ£o Ã© Duplicata)"]}),b[P]?e.jsxs("button",{onClick:()=>M(S,P),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center gap-2 text-sm font-semibold shadow-md",children:[e.jsx(ha,{className:"h-4 w-4"}),"Confirmar Mesclagem"]}):e.jsxs("button",{disabled:!0,className:"px-4 py-2 bg-gray-300 text-gray-500 rounded-md flex items-center gap-2 text-sm cursor-not-allowed",children:[e.jsx(Ot,{className:"h-4 w-4"}),"Selecione um Produto"]})]})]},P))]}),re=()=>s?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando..."}):o.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ha,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-700 font-semibold",children:"Todos os nomes estÃ£o padronizados!"})]}):e.jsx("div",{className:"space-y-3",children:o.map((S,P)=>{var G,B,y,O,z;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:["ID: ",S.produto_id]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Nome Atual:"}),e.jsx("div",{className:"text-sm text-gray-700 bg-gray-50 p-2 rounded",children:S.nome_atual})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-green-700 mb-1",children:"Nome Sugerido:"}),(G=i[S.produto_id])!=null&&G.editando?e.jsx("input",{type:"text",value:((B=i[S.produto_id])==null?void 0:B.nome)||S.nome_sugerido,onChange:ae=>u(W=>({...W,[S.produto_id]:{editando:!0,nome:ae.target.value}})),className:"w-full text-sm text-green-900 bg-green-50 p-2 rounded font-medium border-2 border-blue-400 focus:outline-none focus:border-blue-600",autoFocus:!0}):e.jsx("div",{className:"text-sm text-green-900 bg-green-50 p-2 rounded font-medium",children:((y=i[S.produto_id])==null?void 0:y.nome)||S.nome_sugerido})]})]}),e.jsx("div",{className:"ml-4 flex items-center gap-2",children:e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:[(S.confianca*100).toFixed(0),"% confianÃ§a"]})})]}),e.jsxs("div",{className:"text-xs text-gray-600 mb-3",children:[e.jsx("strong",{children:"RazÃ£o:"})," ",S.razao]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>$(S),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm flex items-center gap-1",children:[e.jsx(ha,{className:"h-4 w-4"}),"Aplicar ",(O=i[S.produto_id])!=null&&O.nome?"EdiÃ§Ã£o":"SugestÃ£o"]}),(z=i[S.produto_id])!=null&&z.editando?e.jsxs("button",{onClick:()=>u(ae=>{const W={...ae};return delete W[S.produto_id],W}),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 text-sm flex items-center gap-1",children:[e.jsx(ds,{className:"h-4 w-4"}),"Cancelar EdiÃ§Ã£o"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>u(ae=>{var W;return{...ae,[S.produto_id]:{editando:!0,nome:((W=i[S.produto_id])==null?void 0:W.nome)||S.nome_sugerido}}}),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm flex items-center gap-1",children:[e.jsx(Ht,{className:"h-4 w-4"}),"Editar"]}),e.jsxs("button",{className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 text-sm flex items-center gap-1",children:[e.jsx(ds,{className:"h-4 w-4"}),"Ignorar"]})]})]})]},P)})}),q=()=>s?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando..."}):j.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ha,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-700 font-semibold",children:"Nenhum gap crÃ­tico de estoque!"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mr-2",children:"Analisar por:"}),e.jsxs("select",{value:w,onChange:S=>c(S.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-md text-sm",children:[e.jsx("option",{value:"porte",children:"Porte"}),e.jsx("option",{value:"fase",children:"Fase"}),e.jsx("option",{value:"sabor",children:"Sabor"}),e.jsx("option",{value:"linha",children:"Linha"}),e.jsx("option",{value:"especie",children:"EspÃ©cie"})]})]}),e.jsxs("button",{onClick:_,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(As,{className:"h-4 w-4"}),"Analisar"]})]}),j.map((S,P)=>e.jsxs("div",{className:`rounded-lg p-4 border-2 ${S.importancia==="Alta"?"bg-red-50 border-red-300":S.importancia==="MÃ©dia"?"bg-yellow-50 border-yellow-300":"bg-gray-50 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Va,{className:`h-5 w-5 ${S.importancia==="Alta"?"text-red-600":S.importancia==="MÃ©dia"?"text-yellow-600":"text-gray-600"}`}),e.jsx("span",{className:"font-bold text-gray-900 text-lg",children:S.segmento_valor})]}),e.jsxs("div",{className:"text-sm text-gray-700",children:[S.produtos_sem_estoque," de ",S.total_produtos," produtos sem estoque (",S.percentual_sem_estoque,"%)"]})]}),e.jsx("span",{className:`px-3 py-1 rounded text-xs font-semibold ${S.importancia==="Alta"?"bg-red-600 text-white":S.importancia==="MÃ©dia"?"bg-yellow-500 text-white":"bg-gray-500 text-white"}`,children:S.importancia})]}),e.jsx("div",{className:"bg-white bg-opacity-50 rounded p-3 mb-3",children:e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Faturamento HistÃ³rico (90 dias):"})," R$ ",S.faturamento_historico.toLocaleString("pt-BR",{minimumFractionDigits:2})]})}),e.jsxs("div",{className:`text-sm font-medium ${S.importancia==="Alta"?"text-red-800":S.importancia==="MÃ©dia"?"text-yellow-800":"text-gray-800"}`,children:["ðŸ’¡ ",S.sugestao]})]},P))]});return s&&N==="resumo"?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Fa,{className:"h-8 w-8 animate-spin text-blue-500"})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(da,{className:"h-7 w-7 text-blue-600"}),"SugestÃµes Inteligentes"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Otimize seu cadastro de raÃ§Ãµes com sugestÃµes automÃ¡ticas"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex space-x-1 p-2",children:[e.jsxs("button",{onClick:()=>E("resumo"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${N==="resumo"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(ha,{className:"h-4 w-4 inline mr-2"}),"Resumo Geral"]}),e.jsxs("button",{onClick:()=>E("duplicatas"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${N==="duplicatas"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Ot,{className:"h-4 w-4 inline mr-2"}),"Duplicatas",((Z=t==null?void 0:t.resumo)==null?void 0:Z.duplicatas_detectadas)>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-orange-500 text-white text-xs rounded-full",children:t.resumo.duplicatas_detectadas})]}),e.jsxs("button",{onClick:()=>E("padronizacao"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${N==="padronizacao"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Ht,{className:"h-4 w-4 inline mr-2"}),"PadronizaÃ§Ã£o",((R=t==null?void 0:t.resumo)==null?void 0:R.nomes_padronizar)>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-blue-500 text-white text-xs rounded-full",children:t.resumo.nomes_padronizar})]}),e.jsxs("button",{onClick:()=>E("gaps"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${N==="gaps"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(ro,{className:"h-4 w-4 inline mr-2"}),"Gaps de Estoque",((J=t==null?void 0:t.resumo)==null?void 0:J.gaps_criticos)>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-red-500 text-white text-xs rounded-full",children:t.resumo.gaps_criticos})]})]})}),e.jsxs("div",{className:"p-4",children:[N==="resumo"&&A(),N==="duplicatas"&&Q(),N==="padronizacao"&&re(),N==="gaps"&&q()]})]})]})};function Qi(){const s=fa(),[l,t]=a.useState("dashboard"),[m,r]=a.useState([]),[g,o]=a.useState(!1),[v,j]=a.useState(new Set),[f,N]=a.useState({total:0,limite:50,offset:0}),[d,x]=a.useState(""),k=[{value:"",label:"Todas as espÃ©cies"},{value:"dog",label:"CÃ£es"},{value:"cat",label:"Gatos"},{value:"bird",label:"PÃ¡ssaros"},{value:"rodent",label:"Roedores"},{value:"fish",label:"Peixes"}];a.useEffect(()=>{w()},[]),a.useEffect(()=>{l==="alertas"&&c()},[d,l]);const w=async()=>{try{const n=await F.get("/produtos/racao/alertas",{params:{limite:1,offset:0}});N(C=>({...C,total:n.data.total}))}catch(n){console.error("Erro ao carregar contagem de alertas:",n)}},c=async()=>{var n,C,h,_;o(!0);try{const E=localStorage.getItem("access_token");console.log("ðŸ” [AlertasRacao] Iniciando carregamento de alertas",{hasToken:!!E,tokenPreview:E?`${E.substring(0,20)}...`:"NO TOKEN",especieFiltro:d});const $={limite:50,offset:0};d&&($.especie=d),console.log("ðŸ“¡ [AlertasRacao] Chamando: /produtos/racao/alertas",$);const K=await F.get("/produtos/racao/alertas",{params:$});console.log("âœ… [AlertasRacao] Alertas carregados:",{total:K.data.total,items:(n=K.data.items)==null?void 0:n.length}),r(K.data.items||[]),N({total:K.data.total,limite:K.data.limite,offset:K.data.offset})}catch(E){console.error("âŒ [AlertasRacao] Erro ao carregar alertas:",{message:E.message,status:(C=E.response)==null?void 0:C.status,data:(h=E.response)==null?void 0:h.data,config:E.config}),((_=E.response)==null?void 0:_.status)===403?Se.error("Acesso negado. Verifique suas permissÃµes ou faÃ§a login novamente."):Se.error("Erro ao carregar alertas de raÃ§Ãµes")}finally{o(!1)}},b=async n=>{j(C=>new Set(C).add(n));try{const C=await F.post(`/produtos/${n}/classificar-ia`,null,{params:{forcar:!0}});Se.success(`${C.data.campos_atualizados.length} campos classificados! Score: ${C.data.confianca.score}%`,{duration:4e3}),r(h=>h.filter(_=>_.id!==n)),N(h=>({...h,total:h.total-1}))}catch(C){console.error("Erro ao classificar produto:",C),Se.error("Erro ao classificar produto")}finally{j(C=>{const h=new Set(C);return h.delete(n),h})}},p=async()=>{o(!0);try{const n=await F.post("/produtos/classificar-lote",null,{params:{apenas_sem_classificacao:!0}});Se.success(`${n.data.sucessos} produtos classificados com sucesso!`,{duration:5e3}),n.data.erros>0&&Se.error(`${n.data.erros} produtos com erro na classificaÃ§Ã£o`),await c()}catch(n){console.error("Erro ao classificar lote:",n),Se.error("Erro ao classificar produtos em lote")}finally{o(!1)}},i=n=>n>=75?{cor:"text-yellow-600 bg-yellow-50",texto:"Quase completo"}:n>=50?{cor:"text-orange-600 bg-orange-50",texto:"Incompleto"}:{cor:"text-red-600 bg-red-50",texto:"Muito incompleto"},u=n=>({porte_animal:"Porte",fase_publico:"Fase",sabor_proteina:"Sabor/ProteÃ­na",peso_embalagem:"Peso"})[n]||n;return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ra,{className:"w-8 h-8 text-amber-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Sistema Inteligente de RaÃ§Ãµes"})]}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>t("dashboard"),className:`px-6 py-3 font-medium text-sm transition-colors relative ${l==="dashboard"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(St,{className:"w-4 h-4"}),"Dashboard de AnÃ¡lise"]})}),e.jsx("button",{onClick:()=>t("alertas"),className:`px-6 py-3 font-medium text-sm transition-colors relative ${l==="alertas"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ra,{className:"w-4 h-4"}),"Alertas de ClassificaÃ§Ã£o",f.total>0&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-red-500 text-white rounded-full",children:f.total})]})}),e.jsx("button",{onClick:()=>t("sugestoes"),className:`px-6 py-3 font-medium text-sm transition-colors relative ${l==="sugestoes"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Vo,{className:"w-4 h-4"}),"SugestÃµes Inteligentes"]})})]})]}),l==="dashboard"&&e.jsx(Hi,{}),l==="sugestoes"&&e.jsx(Gi,{}),l==="alertas"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-gray-600",children:"Produtos classificados como raÃ§Ã£o mas sem informaÃ§Ãµes completas"}),e.jsxs("button",{onClick:p,disabled:g||m.length===0,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition",children:[e.jsx(Fa,{className:`w-4 h-4 ${g?"animate-spin":""}`}),"Classificar Todos"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Filtrar por:"}),e.jsx("select",{value:d,onChange:n=>x(n.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:k.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))}),d&&e.jsx("button",{onClick:()=>x(""),className:"text-sm text-indigo-600 hover:text-indigo-800",children:"Limpar filtro"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-red-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Alertas"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:f.total})]}),e.jsx(Ra,{className:"w-10 h-10 text-red-500 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-amber-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nesta PÃ¡gina"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:m.length})]}),e.jsx(kl,{className:"w-10 h-10 text-amber-500 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-green-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Completude MÃ©dia"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[m.length>0?Math.round(m.reduce((n,C)=>n+C.completude,0)/m.length):0,"%"]})]}),e.jsx(ha,{className:"w-10 h-10 text-green-500 opacity-20"})]})})]}),g&&m.length===0&&e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Fa,{className:"w-8 h-8 animate-spin text-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando alertas..."})]}),!g&&m.length===0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-8 text-center",children:[e.jsx(ha,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-green-800 mb-2",children:"Nenhum alerta encontrado!"}),e.jsx("p",{className:"text-green-700",children:"Todas as raÃ§Ãµes cadastradas possuem informaÃ§Ãµes completas."})]}),m.length>0&&e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CÃ³digo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Categoria / Marca"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Campos Faltantes"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Completude"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map(n=>{var _;const C=i(n.completude),h=v.has(n.id);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-mono",children:n.codigo}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"max-w-md",children:[e.jsx("p",{className:"font-medium",children:n.nome}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[n.classificacao_racao&&e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:n.classificacao_racao}),n.especies_indicadas&&e.jsx("span",{className:"text-xs text-white bg-indigo-600 px-2 py-1 rounded",children:((_=k.find(E=>E.value===n.especies_indicadas))==null?void 0:_.label)||n.especies_indicadas})]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-700",children:n.categoria||"-"}),e.jsx("div",{className:"text-xs text-gray-500",children:n.marca||"-"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:n.campos_faltantes.map(E=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-red-100 text-red-800 text-xs rounded",children:[e.jsx(ds,{className:"w-3 h-3"}),u(E)]},E))})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${C.cor}`,children:[n.completude,"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-center",children:[e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>b(n.id),disabled:h||!n.auto_classificar_ativo,className:"inline-flex items-center gap-2 px-3 py-1 bg-indigo-600 text-white text-sm rounded hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition",children:h?e.jsxs(e.Fragment,{children:[e.jsx(Fa,{className:"w-4 h-4 animate-spin"}),"Classificando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Fa,{className:"w-4 h-4"}),"Classificar IA"]})}),e.jsxs("button",{onClick:()=>s(`/produtos/${n.id}/editar?aba=7`),className:"inline-flex items-center gap-2 px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition",title:"Editar produto manualmente",children:[e.jsx(Ht,{className:"w-4 h-4"}),"Editar"]})]}),!n.auto_classificar_ativo&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Auto-class. desativada"})]})]},n.id)})})]})})})]})]})}function Xi(){const[s,l]=a.useState("linhas"),[t,m]=a.useState({}),[r,g]=a.useState(!1),[o,v]=a.useState(null),[j,f]=a.useState({nome:"",descricao:"",ordem:0,ativo:!0}),[N,d]=a.useState({peso_kg:0,descricao:"",ordem:0,ativo:!0}),x=[{id:"linhas",nome:"Linhas de RaÃ§Ã£o",endpoint:"/opcoes-racao/linhas",icon:"ðŸ“¦"},{id:"portes",nome:"Portes",endpoint:"/opcoes-racao/portes",icon:"ðŸ•"},{id:"fases",nome:"Fases/PÃºblico",endpoint:"/opcoes-racao/fases",icon:"ðŸ‘¶"},{id:"tratamentos",nome:"Tratamentos",endpoint:"/opcoes-racao/tratamentos",icon:"ðŸ’Š"},{id:"sabores",nome:"Sabores/ProteÃ­nas",endpoint:"/opcoes-racao/sabores",icon:"ðŸ–"},{id:"apresentacoes",nome:"ApresentaÃ§Ãµes (Peso)",endpoint:"/opcoes-racao/apresentacoes",icon:"âš–ï¸"}],k=x.find(n=>n.id===s);a.useEffect(()=>{w()},[s]);const w=async()=>{g(!0);try{const n=await F.get(k.endpoint,{params:{apenas_ativos:!1}});m(C=>({...C,[s]:n.data}))}catch(n){console.error("Erro ao carregar dados:",n),Se.error(`Erro ao carregar ${k.nome.toLowerCase()}`)}finally{g(!1)}},c=()=>{f({nome:"",descricao:"",ordem:0,ativo:!0}),d({peso_kg:0,descricao:"",ordem:0,ativo:!0}),v(null)},b=n=>{v(n.id),s==="apresentacoes"?d({peso_kg:n.peso_kg,descricao:n.descricao||"",ordem:n.ordem||0,ativo:n.ativo}):f({nome:n.nome,descricao:n.descricao||"",ordem:n.ordem||0,ativo:n.ativo})},p=async()=>{var n,C;try{const h=s==="apresentacoes"?N:j;o?(await F.put(`${k.endpoint}/${o}`,h),Se.success("Atualizado com sucesso!")):(await F.post(k.endpoint,h),Se.success("Criado com sucesso!")),c(),w()}catch(h){console.error("Erro ao salvar:",h),Se.error(((C=(n=h.response)==null?void 0:n.data)==null?void 0:C.detail)||"Erro ao salvar")}},i=async n=>{if(confirm("Tem certeza que deseja inativar este item?"))try{await F.delete(`${k.endpoint}/${n}`),Se.success("Inativado com sucesso!"),w()}catch(C){console.error("Erro ao deletar:",C),Se.error("Erro ao inativar")}},u=t[s]||[];return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(sr,{className:"w-8 h-8 text-indigo-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"OpÃ§Ãµes de ClassificaÃ§Ã£o de RaÃ§Ãµes"})]}),e.jsx("p",{className:"text-gray-600",children:"Gerencie os valores disponÃ­veis para classificaÃ§Ã£o de produtos de raÃ§Ã£o"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex overflow-x-auto",children:x.map(n=>e.jsxs("button",{onClick:()=>{l(n.id),c()},className:`
                  flex items-center gap-2 px-6 py-4 text-sm font-medium border-b-2 whitespace-nowrap
                  ${s===n.id?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                `,children:[e.jsx("span",{className:"text-xl",children:n.icon}),n.nome]},n.id))})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:o?"Editar":"Adicionar Novo"}),s==="apresentacoes"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Peso (kg) *"}),e.jsx("input",{type:"number",step:"0.001",value:N.peso_kg,onChange:n=>d({...N,peso_kg:parseFloat(n.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Ex: 15.0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("input",{type:"text",value:N.descricao,onChange:n=>d({...N,descricao:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Ex: 15kg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ordem"}),e.jsx("input",{type:"number",value:N.ordem,onChange:n=>d({...N,ordem:parseInt(n.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"ativo-peso",checked:N.ativo,onChange:n=>d({...N,ativo:n.target.checked}),className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"ativo-peso",className:"text-sm text-gray-700",children:"Ativo"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",value:j.nome,onChange:n=>f({...j,nome:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:`Ex: ${s==="linhas"?"Premium":s==="portes"?"Pequeno":"Filhote"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:j.descricao,onChange:n=>f({...j,descricao:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",rows:"2",placeholder:"DescriÃ§Ã£o opcional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ordem"}),e.jsx("input",{type:"number",value:j.ordem,onChange:n=>f({...j,ordem:parseInt(n.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"ativo",checked:j.ativo,onChange:n=>f({...j,ativo:n.target.checked}),className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"ativo",className:"text-sm text-gray-700",children:"Ativo"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsxs("button",{onClick:p,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition",children:[e.jsx(_t,{className:"w-4 h-4"}),o?"Atualizar":"Adicionar"]}),o&&e.jsx("button",{onClick:c,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:e.jsx(ma,{className:"w-4 h-4"})})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"bg-white rounded-lg shadow",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:[k.nome," Cadastrados (",u.length,")"]}),r?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando..."})]}):u.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:e.jsx(rs,{className:"w-16 h-16 mx-auto"})}),e.jsx("p",{className:"text-gray-600",children:"Nenhum item cadastrado ainda"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Use o formulÃ¡rio ao lado para adicionar"})]}):e.jsx("div",{className:"space-y-2",children:u.map(n=>e.jsxs("div",{className:`
                        flex items-center justify-between p-4 border rounded-lg transition
                        ${o===n.id?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300"}
                        ${!n.ativo&&"opacity-50"}
                      `,children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:k.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s==="apresentacoes"?`${n.peso_kg}kg${n.descricao?` - ${n.descricao}`:""}`:n.nome}),n.descricao&&s!=="apresentacoes"&&e.jsx("p",{className:"text-sm text-gray-500",children:n.descricao})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500 mr-2",children:["Ordem: ",n.ordem]}),!n.ativo&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-red-100 text-red-800 rounded",children:"Inativo"}),e.jsx("button",{onClick:()=>b(n),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition",title:"Editar",children:e.jsx(Sr,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>i(n.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition",title:"Inativar",children:e.jsx(gs,{className:"w-4 h-4"})})]})]},n.id))})]})})})]}),e.jsx("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(et,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-1",children:"Dica"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Os valores cadastrados aqui serÃ£o usados no cadastro de produtos e na classificaÃ§Ã£o automÃ¡tica por IA. Mantenha ativos apenas os valores que vocÃª utiliza no seu negÃ³cio."})]})]})})]})}const Ji=()=>{const[s,l]=a.useState(null),[t,m]=a.useState(!1),[r,g]=a.useState(null),[o,v]=a.useState([]),[j,f]=a.useState(!1),[N,d]=a.useState([]),[x,k]=a.useState(null),[w,c]=a.useState("upload"),b=_=>{var $;const E=($=_.target.files)==null?void 0:$[0];E&&l(E)},p=async()=>{var E,$;if(!s){alert("Selecione um arquivo primeiro");return}const _=new FormData;_.append("arquivo",s),m(!0);try{const K=await F.post("/ia/extrato/upload",_,{headers:{"Content-Type":"multipart/form-data"}});g(K.data),alert(`Upload concluÃ­do! ${K.data.categorias_aplicadas} categorias aplicadas automaticamente.`)}catch(K){console.error("Erro no upload:",K);const te=(($=(E=K.response)==null?void 0:E.data)==null?void 0:$.detail)||K.message;alert("Erro ao processar arquivo: "+te)}finally{m(!1)}},i=async()=>{f(!0);try{const _=await F.get("/ia/extrato/pendentes");v(_.data)}catch(_){console.error("Erro ao carregar pendentes:",_),alert("Erro ao carregar lanÃ§amentos pendentes")}finally{f(!1)}},u=async _=>{try{await F.post("/ia/extrato/validar",{lancamento_id:_,aprovado:!0}),alert("LanÃ§amento aprovado!"),i()}catch(E){console.error("Erro ao aprovar:",E),alert("Erro ao aprovar lanÃ§amento")}},n=async(_,E)=>{try{await F.post("/ia/extrato/validar",{lancamento_id:_,aprovado:!1,categoria_correta_id:E}),alert("LanÃ§amento corrigido e padrÃ£o aprendido!"),i()}catch($){console.error("Erro ao corrigir:",$),alert("Erro ao corrigir lanÃ§amento")}},C=async()=>{try{const _=await F.get("/ia/extrato/padroes");d(_.data)}catch(_){console.error("Erro ao carregar padrÃµes:",_),alert("Erro ao carregar padrÃµes aprendidos")}},h=async()=>{try{const _=await F.get("/ia/extrato/estatisticas");k(_.data)}catch(_){console.error("Erro ao carregar estatÃ­sticas:",_),alert("Erro ao carregar estatÃ­sticas")}};return ts.useEffect(()=>{w==="validacao"?i():w==="padroes"?C():w==="estatisticas"&&h()},[w]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>c("upload"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${w==="upload"?"bg-green-100 text-green-700 font-medium":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(tr,{size:18}),"Upload de Extrato"]}),e.jsxs("button",{onClick:()=>c("validacao"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${w==="validacao"?"bg-orange-100 text-orange-700 font-medium":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(da,{size:18}),"ValidaÃ§Ã£o (",o.length,")"]}),e.jsxs("button",{onClick:()=>c("padroes"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${w==="padroes"?"bg-blue-100 text-blue-700 font-medium":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(kt,{size:18}),"PadrÃµes IA"]}),e.jsxs("button",{onClick:()=>c("estatisticas"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${w==="estatisticas"?"bg-purple-100 text-purple-700 font-medium":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(Aa,{size:18}),"EstatÃ­sticas"]})]})}),w==="upload"&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(tr,{className:"text-green-600"}),"Upload de Extrato BancÃ¡rio"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx(Xa,{className:"mx-auto mb-4 text-gray-400",size:48}),e.jsx("p",{className:"mb-2 text-gray-600",children:"Arraste um arquivo ou clique para selecionar"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"âœ… Formatos: Excel (.xlsx, .xls), CSV (.csv), PDF (.pdf), OFX (.ofx)"}),e.jsx("input",{type:"file",onChange:b,accept:".xlsx,.xls,.csv,.pdf,.ofx",className:"hidden",id:"file-upload"}),e.jsx("label",{htmlFor:"file-upload",className:"inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer",children:"Selecionar Arquivo"}),s&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 rounded-lg",children:[e.jsx("p",{className:"text-green-700 font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-green-600",children:[(s.size/1024).toFixed(2)," KB"]})]})]}),e.jsx("button",{onClick:p,disabled:!s||t,className:"w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium",children:t?"Processando...":"Processar Extrato"}),r&&e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"font-bold text-blue-900 mb-2",children:"âœ… Resultado do Processamento"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:["â€¢ Total de lanÃ§amentos: ",e.jsx("span",{className:"font-bold",children:r.total_lancamentos})]}),e.jsxs("p",{children:["â€¢ Categorizados automaticamente: ",e.jsx("span",{className:"font-bold text-green-700",children:r.categorias_aplicadas})]}),e.jsxs("p",{children:["â€¢ Pendentes de validaÃ§Ã£o: ",e.jsx("span",{className:"font-bold text-orange-700",children:r.pendentes_validacao})]})]})]})]})]}),w==="validacao"&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(da,{className:"text-orange-600"}),"LanÃ§amentos Pendentes de ValidaÃ§Ã£o (",o.length,")"]}),j?e.jsx("p",{className:"text-center text-gray-600 py-8",children:"Carregando..."}):o.length===0?e.jsxs("div",{className:"text-center text-gray-600 py-8",children:[e.jsx(ha,{className:"mx-auto mb-2 text-green-500",size:48}),e.jsx("p",{children:"Nenhum lanÃ§amento pendente! ðŸŽ‰"})]}):e.jsx("div",{className:"space-y-3",children:o.map(_=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800",children:_.descricao}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Data: ",new Date(_.data).toLocaleDateString("pt-BR")," | Valor: R$ ",Math.abs(_.valor).toFixed(2)]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded",children:["SugestÃ£o IA: ",_.categoria_sugerida]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["ConfianÃ§a: ",(_.confianca*100).toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx("button",{onClick:()=>u(_.id),className:"px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm",title:"Aprovar categoria sugerida",children:e.jsx(ha,{size:16})}),e.jsx("button",{onClick:()=>{const E=prompt("Digite a categoria correta:");E&&n(_.id,E)},className:"px-3 py-2 bg-orange-600 text-white rounded hover:bg-orange-700 text-sm",title:"Corrigir categoria",children:e.jsx(ds,{size:16})})]})]})},_.id))})]}),w==="padroes"&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(kt,{className:"text-blue-600"}),"PadrÃµes Aprendidos pela IA"]}),N.length===0?e.jsx("p",{className:"text-center text-gray-600 py-8",children:"Nenhum padrÃ£o aprendido ainda"}):e.jsx("div",{className:"space-y-3",children:N.map((_,E)=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-800",children:["PadrÃ£o: ",_.descricao_padrao]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Categoria: ",_.categoria]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsxs("span",{className:"text-xs px-2 py-1 bg-green-100 text-green-700 rounded",children:["âœ“ ",_.vezes_usado," vezes usado"]}),e.jsxs("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded",children:["ConfianÃ§a: ",(_.confianca*100).toFixed(0),"%"]})]})]})})},E))})]}),w==="estatisticas"&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Aa,{className:"text-purple-600"}),"EstatÃ­sticas do Sistema IA"]}),x?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total de PadrÃµes"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900 mt-1",children:x.total_padroes})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Taxa de Acerto"}),e.jsxs("p",{className:"text-3xl font-bold text-green-900 mt-1",children:[(x.taxa_acerto*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"ConfianÃ§a MÃ©dia"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-900 mt-1",children:[(x.confianca_media*100).toFixed(0),"%"]})]})]}):e.jsx("p",{className:"text-center text-gray-600 py-8",children:"Carregando estatÃ­sticas..."})]})})]})},Yi=({dados:s,periodo:l})=>{const[t,m]=a.useState(null),[r,g]=a.useState(!0),[o,v]=a.useState(null),[j,f]=a.useState(null);a.useEffect(()=>{s&&(d(),N())},[s,l]);const N=async()=>{try{const p=await F.get("/ia/dre/indices-mercado",{params:{setor:"pet_shop"}});f(p.data)}catch(p){console.error("Erro ao carregar Ã­ndices:",p)}},d=async()=>{g(!0);try{await new Promise(i=>setTimeout(i,1e3));const p=w(s);if(m(p),l.mes>1){const i=await x(l);i&&v(k(s,i))}}catch(p){console.error("Erro ao carregar anÃ¡lise:",p)}finally{g(!1)}},x=async p=>{try{const i=p.mes===1?12:p.mes-1,u=p.mes===1?p.ano-1:p.ano;return(await F.get("/financeiro/dre",{params:{ano:u,mes:i}})).data}catch{return null}},k=(p,i)=>{const u=(n,C)=>!C||C===0?null:(n-C)/Math.abs(C)*100;return{receita:{atual:p.receita_bruta||0,anterior:i.receita_bruta||0,variacao:u(p.receita_bruta,i.receita_bruta)},lucro:{atual:p.lucro_liquido||0,anterior:i.lucro_liquido||0,variacao:u(p.lucro_liquido,i.lucro_liquido)},despesas:{atual:p.total_despesas||0,anterior:i.total_despesas||0,variacao:u(p.total_despesas,i.total_despesas)},margem:{atual:p.margem_liquida||0,anterior:i.margem_liquida||0,variacao:u(p.margem_liquida,i.margem_liquida)}}},w=p=>{const i=[],u=[],n=[],C=p.margem_liquida||0;C<5?(n.push({tipo:"critico",titulo:"Margem lÃ­quida crÃ­tica",descricao:`Margem de apenas ${C.toFixed(1)}%. Ideal: acima de 10%`,icon:Ra}),u.push({prioridade:"alta",titulo:"Urgente: Revisar estrutura de custos",descricao:"Margem muito baixa. Considere: aumentar preÃ§os, reduzir custos fixos, ou renegociar com fornecedores."})):C<10?i.push({tipo:"atencao",titulo:"Margem lÃ­quida abaixo do ideal",descricao:`${C.toFixed(1)}% - HÃ¡ espaÃ§o para melhoria`,icon:Va}):i.push({tipo:"positivo",titulo:"Margem lÃ­quida saudÃ¡vel",descricao:`${C.toFixed(1)}% - Acima da mÃ©dia do setor`,icon:ha});const h=p.receita_bruta||0,_=p.total_despesas||0;_>h*.8&&n.push({tipo:"atencao",titulo:"Despesas elevadas",descricao:`Despesas representam ${(_/h*100).toFixed(0)}% da receita`,icon:Ra});const E=p.cmv||0,$=(h-E)/h*100;$<30&&u.push({prioridade:"media",titulo:"Revisar custo dos produtos",descricao:`Margem bruta de ${$.toFixed(1)}%. Considere negociar com fornecedores ou ajustar preÃ§os.`});const K=p.lucro_liquido||0;K>0?i.push({tipo:"positivo",titulo:"Resultado positivo",descricao:`Lucro de R$ ${K.toLocaleString("pt-BR",{minimumFractionDigits:2})}`,icon:Aa}):(n.push({tipo:"critico",titulo:"PrejuÃ­zo no perÃ­odo",descricao:`Resultado negativo de R$ ${Math.abs(K).toLocaleString("pt-BR",{minimumFractionDigits:2})}`,icon:Va}),u.push({prioridade:"alta",titulo:"Plano de recuperaÃ§Ã£o necessÃ¡rio",descricao:"AnÃ¡lise detalhada de custos e revisÃ£o de estratÃ©gia de precificaÃ§Ã£o urgente."}));let te=50;return C>10&&(te+=20),C>5&&C<=10&&(te+=10),K>0&&(te+=15),$>30&&(te+=15),_<h*.7&&(te+=10),{insights:i,recomendacoes:u,alertas:n,score:Math.min(te,100)}},c=p=>{let i="red",u="CrÃ­tico";return p>=80?(i="green",u="Excelente"):p>=60?(i="yellow",u="Bom"):p>=40&&(i="orange",u="Regular"),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Io,{className:"text-purple-600"}),"Score de SaÃºde Financeira"]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative w-32 h-32",children:[e.jsxs("svg",{className:"transform -rotate-90 w-32 h-32",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"#e5e7eb",strokeWidth:"12",fill:"none"}),e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:i==="green"?"#10b981":i==="yellow"?"#fbbf24":i==="orange"?"#f59e0b":"#ef4444",strokeWidth:"12",fill:"none",strokeDasharray:`${p/100*351.86} 351.86`,className:"transition-all duration-1000"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-3xl font-bold text-gray-800",children:p})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800 mb-1",children:u}),e.jsxs("p",{className:"text-sm text-gray-600",children:[p>=80&&"Sua saÃºde financeira estÃ¡ Ã³tima! Continue assim.",p>=60&&p<80&&"Boa saÃºde financeira. Pequenos ajustes podem melhorar.",p>=40&&p<60&&"SituaÃ§Ã£o estÃ¡vel, mas requer atenÃ§Ã£o.",p<40&&"AtenÃ§Ã£o! Medidas corretivas sÃ£o necessÃ¡rias."]})]})]})]})},b=()=>{if(!j||!s)return null;const p=j.benchmarks,i=s.receita_liquida||0,u=i>0?(s.cmv||0)/i*100:0,n=s.margem_bruta||0,C=s.margem_liquida||0,h=i>0?(s.despesas_admin||0)/i*100:0,_=i>0?(s.total_despesas||0)/i*100:0,E=[{nome:"CMV",seu:u,idealMin:p.cmv.min,idealMax:p.cmv.max,inverter:!0,unidade:"%",cor:u<=p.cmv.max?"green":u<=p.cmv.max*1.1?"yellow":"red"},{nome:"Margem Bruta",seu:n,idealMin:p.margem_bruta.min,idealMax:p.margem_bruta.max,inverter:!1,unidade:"%",cor:n>=p.margem_bruta.min?"green":n>=p.margem_bruta.min*.9?"yellow":"red"},{nome:"Margem LÃ­quida",seu:C,idealMin:p.margem_liquida.min,idealMax:p.margem_liquida.max,inverter:!1,unidade:"%",cor:C>=p.margem_liquida.min?"green":C>=p.margem_liquida.min*.8?"yellow":"red"},{nome:"Despesas Admin",seu:h,idealMin:0,idealMax:p.despesas_admin.max,inverter:!0,unidade:"%",cor:h<=p.despesas_admin.max?"green":h<=p.despesas_admin.max*1.2?"yellow":"red"},{nome:"Despesas Totais",seu:_,idealMin:0,idealMax:p.despesas_totais.max,inverter:!0,unidade:"%",cor:_<=p.despesas_totais.max?"green":_<=p.despesas_totais.max*1.2?"yellow":"red"}];return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(St,{className:"text-indigo-600"}),"Seus Indicadores vs Mercado Pet Shop"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Er,{size:16}),e.jsxs("span",{children:["Fonte: ",j.fonte]})]})]}),e.jsx("div",{className:"space-y-4",children:E.map(($,K)=>{const te=$.idealMax-$.idealMin;$.idealMin+te/2;const M=$.seu>=$.idealMin&&$.seu<=$.idealMax;return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:$.nome}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:`text-lg font-bold ${$.cor==="green"?"text-green-600":$.cor==="yellow"?"text-yellow-600":"text-red-600"}`,children:[$.seu.toFixed(1),$.unidade]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Ideal: ",$.idealMin>0?`${$.idealMin.toFixed(0)}-`:"",$.idealMax.toFixed(0),$.unidade]})]})]}),e.jsxs("div",{className:"relative h-8 bg-gray-200 rounded-full overflow-hidden",children:[e.jsx("div",{className:"absolute h-full bg-green-200",style:{left:`${$.idealMin/100*100}%`,width:`${te/100*100}%`}}),e.jsx("div",{className:"absolute h-full w-2 bg-gray-800 shadow-lg z-10",style:{left:`${Math.min(Math.max($.seu/100*100,0),100)}%`,transform:"translateX(-50%)"},children:e.jsx("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap",children:"VocÃª"})})]}),e.jsx("div",{className:"mt-2 flex items-center gap-2 text-sm",children:M?e.jsxs(e.Fragment,{children:[e.jsx(ha,{size:16,className:"text-green-600"}),e.jsx("span",{className:"text-green-600 font-medium",children:"Dentro da faixa ideal!"})]}):$.seu<$.idealMin?e.jsxs(e.Fragment,{children:[e.jsx(Va,{size:16,className:"text-orange-600"}),e.jsxs("span",{className:"text-orange-600",children:["Abaixo do ideal (",($.idealMin-$.seu).toFixed(1),$.unidade," a menos)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ra,{size:16,className:"text-red-600"}),e.jsxs("span",{className:"text-red-600",children:["Acima do ideal (+",($.seu-$.idealMax).toFixed(1),$.unidade,")"]})]})})]},K)})}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"ðŸ’¡ Faixa verde = Ideal para pet shops | Barra preta = Seu valor atual"})})]})};return r?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Gerando anÃ¡lise inteligente..."})]})}):t?e.jsxs("div",{className:"space-y-6",children:[c(t.score),b(),o&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Cs,{className:"text-blue-600"}),"ComparaÃ§Ã£o com PerÃ­odo Anterior"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(o).map(([p,i])=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1 capitalize",children:p}),e.jsxs("p",{className:"text-xl font-bold text-gray-800 mb-2",children:["R$ ",i.atual.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),i.variacao!==null&&e.jsxs("div",{className:`flex items-center gap-1 text-sm ${i.variacao>0?"text-green-600":"text-red-600"}`,children:[i.variacao>0?e.jsx(Sl,{size:16}):e.jsx(El,{size:16}),e.jsxs("span",{className:"font-semibold",children:[Math.abs(i.variacao).toFixed(1),"%"]})]})]},p))})]}),t.alertas.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Ra,{className:"text-orange-600"}),"Pontos de AtenÃ§Ã£o"]}),e.jsx("div",{className:"space-y-3",children:t.alertas.map((p,i)=>e.jsx("div",{className:`p-4 rounded-lg border-l-4 ${p.tipo==="critico"?"bg-red-50 border-red-500":"bg-yellow-50 border-yellow-500"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(p.icon,{size:20,className:p.tipo==="critico"?"text-red-600":"text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:p.titulo}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:p.descricao})]})]})},i))})]}),t.insights.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(St,{className:"text-indigo-600"}),"Insights Inteligentes"]}),e.jsx("div",{className:"space-y-3",children:t.insights.map((p,i)=>e.jsx("div",{className:`p-4 rounded-lg ${p.tipo==="positivo"?"bg-green-50":p.tipo==="atencao"?"bg-yellow-50":"bg-blue-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(p.icon,{size:20,className:p.tipo==="positivo"?"text-green-600":p.tipo==="atencao"?"text-yellow-600":"text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:p.titulo}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:p.descricao})]})]})},i))})]}),t.recomendacoes.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Vo,{className:"text-yellow-600"}),"RecomendaÃ§Ãµes EstratÃ©gicas"]}),e.jsx("div",{className:"space-y-3",children:t.recomendacoes.map((p,i)=>e.jsx("div",{className:"p-4 rounded-lg bg-gradient-to-r from-purple-50 to-indigo-50 border border-purple-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-semibold ${p.prioridade==="alta"?"bg-red-100 text-red-700":p.prioridade==="media"?"bg-yellow-100 text-yellow-700":"bg-blue-100 text-blue-700"}`,children:p.prioridade.toUpperCase()}),e.jsx("p",{className:"font-semibold text-gray-800",children:p.titulo})]}),e.jsx("p",{className:"text-sm text-gray-600",children:p.descricao})]}),e.jsx(La,{className:"text-purple-600 flex-shrink-0 ml-3",size:24})]})},i))})]})]}):e.jsxs("div",{className:"bg-gray-50 rounded-lg p-12 text-center",children:[e.jsx(Brain,{className:"mx-auto mb-4 text-gray-400",size:64}),e.jsx("p",{className:"text-gray-600",children:"NÃ£o hÃ¡ dados suficientes para anÃ¡lise"})]})},Zi=()=>{var _,E,$,K,te,M,A;const[s,l]=a.useState("demonstrativo"),[t,m]=a.useState(!1),[r,g]=a.useState(!1),[o,v]=a.useState(null),[j]=a.useState([{id:"loja_fisica",nome:"Loja FÃ­sica",cor:"blue"},{id:"mercado_livre",nome:"Mercado Livre",cor:"yellow"},{id:"shopee",nome:"Shopee",cor:"orange"},{id:"amazon",nome:"Amazon",cor:"green"}]),[f,N]=a.useState(["loja_fisica"]),d=()=>{const Q=new Date,re=Q.getFullYear(),q=String(Q.getMonth()+1).padStart(2,"0");return`${re}-${q}`},[x,k]=a.useState(d());a.useEffect(()=>{w()},[]);const w=async()=>{var Q,re;g(!0);try{const[q,Z]=x.split("-"),R=f.join(","),J=await F.get("/financeiro/dre/canais",{params:{ano:q,mes:Z,canais:R}});v(J.data)}catch(q){console.error("Erro ao carregar DRE:",q),Se.error("Erro ao carregar DRE: "+(((re=(Q=q.response)==null?void 0:Q.data)==null?void 0:re.detail)||q.message))}finally{g(!1)}},c=Q=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Q||0),b=Q=>`${(Q||0).toFixed(2)}%`,p=(Q,re)=>!re||re===0?0:Q/re*100,i=Q=>{N(re=>re.includes(Q)?re.filter(Z=>Z!==Q):[...re,Q])},u=()=>{N([])};a.useEffect(()=>{o&&w()},[f]);const n=Q=>{const re=new Date;let q;switch(Q){case"mes_atual":q=d();break;case"mes_anterior":const Z=new Date(re.getFullYear(),re.getMonth()-1,1);q=`${Z.getFullYear()}-${String(Z.getMonth()+1).padStart(2,"0")}`;break;case"ano_atual":q=`${re.getFullYear()}-01`;break;default:return}k(q),setTimeout(()=>w(),100)},C=async()=>{try{const[Q,re]=x.split("-");Se.loading("Gerando PDF...",{id:"pdf"});const q=await F.get("/financeiro/dre/export/pdf",{params:{ano:Q,mes:re},responseType:"blob"}),Z=window.URL.createObjectURL(new Blob([q.data])),R=document.createElement("a");R.href=Z,R.setAttribute("download",`dre_${re}_${Q}.pdf`),document.body.appendChild(R),R.click(),R.remove(),Se.success("Ã°Å¸â€œâ€ž PDF exportado com sucesso!",{id:"pdf"})}catch(Q){console.error("Erro ao exportar PDF:",Q),Se.error("Erro ao exportar PDF",{id:"pdf"})}},h=async()=>{try{const[Q,re]=x.split("-");Se.loading("Gerando Excel...",{id:"excel"});const q=await F.get("/financeiro/dre/export/excel",{params:{ano:Q,mes:re},responseType:"blob"}),Z=window.URL.createObjectURL(new Blob([q.data])),R=document.createElement("a");R.href=Z,R.setAttribute("download",`dre_${re}_${Q}.xlsx`),document.body.appendChild(R),R.click(),R.remove(),Se.success("Ã°Å¸â€œÅ  Excel exportado com sucesso!",{id:"excel"})}catch(Q){console.error("Erro ao exportar Excel:",Q),Se.error("Erro ao exportar Excel",{id:"excel"})}};return r&&!o?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Fa,{className:"animate-spin mx-auto mb-4",size:48}),e.jsx("p",{className:"text-gray-600",children:"Carregando DRE..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"ðŸ“Š DRE - DemonstraÃ§Ã£o do Resultado"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"AnÃ¡lise gerencial de receitas, custos e lucro"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all shadow-lg hover:shadow-xl",title:"Consultar Especialista IA",children:[e.jsx(qo,{size:20}),e.jsx("span",{className:"font-medium",children:"Chat IA"}),e.jsx(ms,{size:16,className:"animate-pulse"})]}),e.jsxs("button",{onClick:C,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",title:"Exportar para PDF",children:[e.jsx(Xa,{size:18}),"PDF"]}),e.jsxs("button",{onClick:h,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",title:"Exportar para Excel",children:[e.jsx(wt,{size:18}),"Excel"]})]})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>l("demonstrativo"),className:`${s==="demonstrativo"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors`,children:[e.jsx(Xa,{size:18}),"Demonstrativo"]}),e.jsxs("button",{onClick:()=>l("extrato"),className:`${s==="extrato"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors`,children:[e.jsx(tr,{size:18}),"Extrato BancÃ¡rio",e.jsx("span",{className:"ml-1 px-2 py-0.5 text-xs bg-green-100 text-green-700 rounded-full font-bold",children:"IA"})]}),e.jsxs("button",{onClick:()=>l("analise"),className:`${s==="analise"?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors`,children:[e.jsx(kt,{size:18}),"AnÃ¡lise Inteligente",e.jsx("span",{className:"ml-1 px-2 py-0.5 text-xs bg-purple-100 text-purple-700 rounded-full font-bold",children:"EM BREVE"})]})]})}),s==="demonstrativo"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>n("mes_atual"),className:"px-3 py-2 text-sm bg-blue-50 text-blue-700 rounded-md hover:bg-blue-100",children:"MÃªs Atual"}),e.jsx("button",{onClick:()=>n("mes_anterior"),className:"px-3 py-2 text-sm bg-blue-50 text-blue-700 rounded-md hover:bg-blue-100",children:"MÃªs Anterior"}),e.jsx("button",{onClick:()=>n("ano_atual"),className:"px-3 py-2 text-sm bg-blue-50 text-blue-700 rounded-md hover:bg-blue-100",children:"Ano Atual"})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PerÃ­odo (MÃªs/Ano)"}),e.jsx("input",{type:"month",value:x,onChange:Q=>k(Q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:w,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(Fa,{size:18}),"Atualizar"]})})]})}),o&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-green-500 text-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm opacity-90",children:"Receita Bruta"}),e.jsx(Aa,{className:"w-5 h-5"})]}),e.jsx("div",{className:"text-3xl font-bold",children:c(((_=o.totais)==null?void 0:_.receita_bruta)||0)}),e.jsx("div",{className:"text-xs mt-1 opacity-80",children:"Base de cÃ¡lculo"})]}),e.jsxs("div",{className:"bg-red-500 text-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm opacity-90",children:"CMV"}),e.jsx(Va,{className:"w-5 h-5"})]}),e.jsx("div",{className:"text-3xl font-bold",children:c(((E=o.totais)==null?void 0:E.cmv)||0)}),e.jsxs("div",{className:"text-xs mt-1 opacity-80",children:[b(p(($=o.totais)==null?void 0:$.cmv,(K=o.totais)==null?void 0:K.receita_bruta))," da receita"]})]}),e.jsxs("div",{className:"bg-blue-500 text-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm opacity-90",children:"Lucro Bruto"}),e.jsx(La,{className:"w-5 h-5"})]}),e.jsx("div",{className:"text-3xl font-bold",children:c(((te=o.totais)==null?void 0:te.lucro_bruto)||0)}),e.jsx("div",{className:"text-xs mt-1 opacity-80",children:"ApÃ³s custos"})]}),e.jsxs("div",{className:"bg-purple-500 text-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm opacity-90",children:"Margem Bruta"}),e.jsx(To,{className:"w-5 h-5"})]}),e.jsx("div",{className:"text-3xl font-bold",children:b(((M=o.totais)==null?void 0:M.margem_bruta)||0)}),e.jsx("div",{className:"text-xs mt-1 opacity-80",children:"Rentabilidade"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(ha,{size:20,className:"text-blue-600"}),"AnÃ¡lise por Canal de Vendas"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Selecione os canais para adicionar suas mÃ©tricas na tabela DRE"})]}),f.length>0&&e.jsx("button",{onClick:u,className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"Limpar SeleÃ§Ã£o"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:j.map(Q=>{const re=f.includes(Q.id),q={blue:re?"bg-blue-600 text-white border-blue-600":"bg-blue-50 text-blue-700 border-blue-200 hover:bg-blue-100",yellow:re?"bg-yellow-500 text-white border-yellow-500":"bg-yellow-50 text-yellow-700 border-yellow-200 hover:bg-yellow-100",orange:re?"bg-orange-500 text-white border-orange-500":"bg-orange-50 text-orange-700 border-orange-200 hover:bg-orange-100",green:re?"bg-green-600 text-white border-green-600":"bg-green-50 text-green-700 border-green-200 hover:bg-green-100"};return e.jsxs("button",{onClick:()=>i(Q.id),className:`${q[Q.cor]} border-2 rounded-lg p-4 transition-all duration-200 transform ${re?"scale-105 shadow-lg":"hover:scale-102"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:Q.nome}),re&&e.jsx(ha,{size:20,className:"flex-shrink-0"})]}),re&&e.jsx("div",{className:"text-xs mt-1 opacity-90",children:"Ativo na tabela"})]},Q.id)})}),f.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(kt,{size:18,className:"text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("span",{className:"font-semibold",children:[f.length," canal(is) selecionado(s)."]})," ","As mÃ©tricas de cada canal serÃ£o adicionadas na tabela DRE abaixo com suas respectivas receitas, custos e lucros."]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"DescriÃ§Ã£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"% Receita"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(A=o==null?void 0:o.linhas)==null?void 0:A.map((Q,re)=>{const q=Q.nivel===0,Z=Q.nivel===1,R=Q.cor_bg!=="#ffffff"?{backgroundColor:Q.cor_bg}:{},J={color:Q.cor};return e.jsxs("tr",{style:R,className:q?"font-bold":"",children:[e.jsx("td",{className:`px-6 py-3 ${Z?"pl-12":""} ${q?"font-bold":""}`,style:J,children:Q.descricao}),e.jsx("td",{className:`px-6 py-3 text-right ${q?"font-bold":""}`,style:J,children:c(Q.valor)}),e.jsx("td",{className:`px-6 py-3 text-right ${q?"font-bold":""}`,style:J,children:b(Q.percentual)})]},re)})})]})}),f.length===0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-blue-800",children:"Ã°Å¸â€™Â¡ A DRE agora mostra automaticamente todos os canais com vendas no perÃƒÂ­odo selecionado."})})]}),!o&&!r&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-12 text-center",children:[e.jsx(Xa,{className:"mx-auto mb-4 text-gray-400",size:64}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Selecione um perÃ­odo e clique em Atualizar para visualizar o DRE"})]})]}),s==="extrato"&&e.jsx(Ji,{}),s==="analise"&&e.jsx(Yi,{dados:o,periodo:{mes:x.mes,ano:x.ano}}),e.jsx(Vi,{isOpen:t,onClose:()=>m(!1),contexto:{tipo:"DRE",periodo:`${x.mes}/${x.ano}`,valor:o==null?void 0:o.lucro_liquido,dados:o}})]})},ed=s=>{const l={critico:"bg-red-100 text-red-800 border-red-200",alerta:"bg-yellow-100 text-yellow-800 border-yellow-200",ok:"bg-green-100 text-green-800 border-green-200"};return l[s]||l.ok},ad=s=>s==="critico"?e.jsx(Ra,{className:"w-5 h-5"}):s==="alerta"?e.jsx(Ra,{className:"w-5 h-5"}):e.jsx(ha,{className:"w-5 h-5"}),sd=s=>s==="melhorando"?e.jsx(Aa,{className:"w-5 h-5 text-green-600"}):s==="piorando"?e.jsx(Va,{className:"w-5 h-5 text-red-600"}):e.jsx(nr,{className:"w-5 h-5 text-gray-600"});function td({indices:s}){const[l,t]=a.useState(null);if(!s)return e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Nenhum Ã­ndice disponÃ­vel"});const{saldo_atual:m,dias_de_caixa:r,status:g,tendencia:o,score_saude:v,receita_mensal_estimada:j,despesa_mensal_estimada:f,percentual_variacao_7d:N}=s;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 relative group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(La,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"relative",children:[sd(o),e.jsx("button",{onMouseEnter:()=>t("saldo"),onMouseLeave:()=>t(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:e.jsx(Bt,{className:"w-4 h-4"})}),l==="saldo"&&e.jsxs("div",{className:"absolute -right-40 top-8 bg-gray-900 text-white text-xs rounded p-2 w-48 z-10 whitespace-normal",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Saldo Atual"}),e.jsx("p",{children:"Seu saldo de caixa real neste momento. O nÃºmero verde ao lado mostra a variaÃ§Ã£o dos Ãºltimos 7 dias."})]})]})]}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Saldo Atual"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(m||0)}),N&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[N>0?"+":"",N.toFixed(1),"% em 7 dias"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 relative group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(Cs,{className:"w-6 h-6 text-purple-600"})}),e.jsx("button",{onMouseEnter:()=>t("dias"),onMouseLeave:()=>t(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Bt,{className:"w-4 h-4"})}),l==="dias"&&e.jsxs("div",{className:"absolute -right-40 top-8 bg-gray-900 text-white text-xs rounded p-2 w-48 z-10 whitespace-normal",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Dias de Caixa"}),e.jsx("p",{children:"Quantos dias vocÃª consegue pagar as despesas com seu saldo atual. Se tem R$ 10.000 e gasta R$ 1.000/dia = 10 dias."})]})]}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Dias de Caixa"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[(r==null?void 0:r.toFixed(1))||"0.0"," dias"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:r<7?"CrÃ­tico - menos de 1 semana":r<15?"Alerta - menos de 2 semanas":"SaudÃ¡vel"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 relative group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${ed(g)}`,children:ad(g)}),e.jsx("button",{onMouseEnter:()=>t("status"),onMouseLeave:()=>t(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Bt,{className:"w-4 h-4"})}),l==="status"&&e.jsxs("div",{className:"absolute -right-40 top-8 bg-gray-900 text-white text-xs rounded p-2 w-48 z-10 whitespace-normal",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Status"}),e.jsxs("p",{children:[e.jsx("strong",{children:"CRITICO:"})," <7 dias (risco iminente). ",e.jsx("strong",{children:"ALERTA:"})," 7-15 dias. ",e.jsx("strong",{children:"OK:"})," >15 dias."]})]})]}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Status"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 capitalize",children:g||"N/A"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1 capitalize",children:["TendÃªncia: ",o||"estÃ¡vel"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 relative group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(Fl,{className:"w-6 h-6 text-green-600"})}),e.jsx("button",{onMouseEnter:()=>t("score"),onMouseLeave:()=>t(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Bt,{className:"w-4 h-4"})}),l==="score"&&e.jsxs("div",{className:"absolute -right-40 top-8 bg-gray-900 text-white text-xs rounded p-2 w-48 z-10 whitespace-normal",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Score de SaÃºde"}),e.jsx("p",{children:"Nota de 0-100 que resume a saÃºde financeira. Considera dias de caixa, tendÃªncia e volatilidade."})]})]}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Score de SaÃºde"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[(v==null?void 0:v.toFixed(0))||"0","/100"]}),e.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${v>=70?"bg-green-600":v>=40?"bg-yellow-600":"bg-red-600"}`,style:{width:`${v||0}%`}})})]}),j&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(Aa,{className:"w-6 h-6 text-green-600"})})}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Receita Mensal"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(j)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Estimativa"})]}),f&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:e.jsx(Va,{className:"w-6 h-6 text-red-600"})})}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Despesa Mensal"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(f)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Estimativa"})]})]})}const at=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0}).format(s),Zo=s=>{try{const l=ql(s);return Uo(l,"dd/MMM",{locale:Fr})}catch{return s}},bo=({active:s,payload:l})=>{if(!s||!l||!l.length)return null;const t=l[0].payload;return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-lg border border-gray-200",children:[e.jsx("p",{className:"font-medium text-gray-900 mb-2",children:Zo(t.data_projetada)}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{className:"text-blue-600",children:["Saldo: ",e.jsx("strong",{children:at(t.saldo_estimado)})]}),t.limite_superior&&e.jsxs("p",{className:"text-green-600",children:["Otimista: ",at(t.limite_superior)]}),t.limite_inferior&&e.jsxs("p",{className:"text-red-600",children:["Pessimista: ",at(t.limite_inferior)]}),t.alerta_nivel&&e.jsxs("p",{className:`font-medium ${t.alerta_nivel==="critico"?"text-red-600":t.alerta_nivel==="alerta"?"text-yellow-600":"text-green-600"}`,children:["Status: ",t.alerta_nivel]})]})]})};function rr({projecoes:s,titulo:l="ProjeÃ§Ã£o de Fluxo de Caixa",detalhado:t=!1}){var g,o,v,j,f,N;if(!s||s.length===0)return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:l}),e.jsx("div",{className:"text-center py-8 text-gray-500",children:'Nenhuma projeÃ§Ã£o disponÃ­vel. Clique em "Atualizar ProjeÃ§Ã£o" para gerar.'})]});const m=s.map(d=>({...d,data_formatada:Zo(d.data_projetada),saldo:d.saldo_estimado||0,superior:d.limite_superior||null,inferior:d.limite_inferior||null})),r=m.some(d=>d.superior!==null||d.inferior!==null);return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:l}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Saldo Inicial"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:at(((g=m[0])==null?void 0:g.saldo)||0)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Saldo Final"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:at(((o=m[m.length-1])==null?void 0:o.saldo)||0)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"VariaÃ§Ã£o"}),e.jsx("p",{className:`text-lg font-bold ${((v=m[m.length-1])==null?void 0:v.saldo)-((j=m[0])==null?void 0:j.saldo)>=0?"text-green-600":"text-red-600"}`,children:at((((f=m[m.length-1])==null?void 0:f.saldo)||0)-(((N=m[0])==null?void 0:N.saldo)||0))})]})]}),e.jsx(Ma,{width:"100%",height:t?400:300,children:r?e.jsxs(Il,{data:m,children:[e.jsx(Oa,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Ba,{dataKey:"data_formatada",stroke:"#6b7280",style:{fontSize:"12px"}}),e.jsx(Ia,{stroke:"#6b7280",style:{fontSize:"12px"},tickFormatter:d=>`R$ ${(d/1e3).toFixed(0)}k`}),e.jsx(Pa,{content:e.jsx(bo,{})}),e.jsx(Ta,{}),e.jsx(lo,{type:"monotone",dataKey:"superior",stroke:"#10b981",fill:"#d1fae5",fillOpacity:.3,name:"CenÃ¡rio Otimista"}),e.jsx(lo,{type:"monotone",dataKey:"inferior",stroke:"#ef4444",fill:"#fee2e2",fillOpacity:.3,name:"CenÃ¡rio Pessimista"}),e.jsx(ls,{type:"monotone",dataKey:"saldo",stroke:"#3b82f6",strokeWidth:3,dot:{r:4,fill:"#3b82f6"},name:"Saldo Estimado"})]}):e.jsxs(it,{data:m,children:[e.jsx(Oa,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Ba,{dataKey:"data_formatada",stroke:"#6b7280",style:{fontSize:"12px"}}),e.jsx(Ia,{stroke:"#6b7280",style:{fontSize:"12px"},tickFormatter:d=>`R$ ${(d/1e3).toFixed(0)}k`}),e.jsx(Pa,{content:e.jsx(bo,{})}),e.jsx(Ta,{}),e.jsx(ls,{type:"monotone",dataKey:"saldo",stroke:"#3b82f6",strokeWidth:3,dot:{r:4,fill:"#3b82f6"},name:"Saldo Estimado"})]})}),m.some(d=>d.vai_faltar_caixa)&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800 font-medium",children:"âš ï¸ AtenÃ§Ã£o: ProjeÃ§Ã£o indica que o caixa pode ficar negativo nos prÃ³ximos dias!"})})]})}const rd=s=>{const l={critico:{icon:Ra,bgColor:"bg-red-50",borderColor:"border-red-200",textColor:"text-red-800",iconColor:"text-red-600"},alerta:{icon:da,bgColor:"bg-yellow-50",borderColor:"border-yellow-200",textColor:"text-yellow-800",iconColor:"text-yellow-600"},aviso:{icon:Er,bgColor:"bg-blue-50",borderColor:"border-blue-200",textColor:"text-blue-800",iconColor:"text-blue-600"},info:{icon:ha,bgColor:"bg-green-50",borderColor:"border-green-200",textColor:"text-green-800",iconColor:"text-green-600"}};return l[s]||l.info};function fo({alertas:s}){if(!s||s.length===0)return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Alertas do Caixa"}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ha,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Nenhum alerta no momento"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Seu caixa estÃ¡ saudÃ¡vel! ðŸŽ‰"})]})]});const l={critico:0,alerta:1,aviso:2,info:3},t=[...s].sort((m,r)=>(l[m.tipo]||3)-(l[r.tipo]||3));return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Alertas do Caixa"}),e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-sm rounded-full",children:t.length})]}),e.jsx("div",{className:"space-y-3",children:t.map((m,r)=>{const g=rd(m.tipo),o=g.icon;return e.jsx("div",{className:`p-4 rounded-lg border ${g.bgColor} ${g.borderColor}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{className:`w-5 h-5 flex-shrink-0 mt-0.5 ${g.iconColor}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-medium ${g.textColor} mb-1`,children:m.titulo}),e.jsx("p",{className:`text-sm ${g.textColor} opacity-90`,children:m.mensagem}),m.data&&e.jsx("p",{className:`text-xs ${g.textColor} opacity-70 mt-2`,children:new Date(m.data).toLocaleString("pt-BR")})]})]})},r)})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 grid grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:t.filter(m=>m.tipo==="critico").length}),e.jsx("p",{className:"text-xs text-gray-600",children:"CrÃ­ticos"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:t.filter(m=>m.tipo==="alerta").length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Alertas"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:t.filter(m=>m.tipo==="aviso").length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Avisos"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:t.filter(m=>m.tipo==="info").length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Infos"})]})]})]})}const jo=[{id:"otimista",nome:"Otimista",descricao:"Aumento de 20% nas receitas e reduÃƒÂ§ÃƒÂ£o de 10% nas despesas",icon:Aa,color:"green"},{id:"realista",nome:"Realista",descricao:"MantÃƒÂ©m o padrÃƒÂ£o atual de receitas e despesas",icon:nr,color:"blue"},{id:"pessimista",nome:"Pessimista",descricao:"ReduÃƒÂ§ÃƒÂ£o de 20% nas receitas e aumento de 10% nas despesas",icon:Va,color:"red"}];function od({userId:s,projecoesBase:l=[]}){var N,d,x,k,w,c,b,p,i,u,n,C,h,_,E,$,K,te,M;const[t,m]=a.useState("realista"),[r,g]=a.useState(!1),[o,v]=a.useState(null),j=async()=>{g(!0);try{const Q={Authorization:`Bearer ${localStorage.getItem("access_token")||localStorage.getItem("token")}`},re=await F.post(`/api/ia/fluxo/simular-cenario/${s}`,{cenario:t},{headers:Q});v(re.data),ce.success(`CenÃƒÂ¡rio ${t} simulado com sucesso!`)}catch(A){console.error("Erro ao simular cenÃƒÂ¡rio:",A),ce.error("Erro ao simular cenÃƒÂ¡rio")}finally{g(!1)}},f=jo.find(A=>A.id===t);return f==null||f.icon,e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Simulador de CenÃƒÂ¡rios"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Simule diferentes cenÃƒÂ¡rios para entender o impacto no seu fluxo de caixa"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:jo.map(A=>{const Q=A.icon,re=t===A.id;return e.jsxs("button",{onClick:()=>m(A.id),className:`p-4 rounded-lg border-2 transition-all text-left ${re?`border-${A.color}-500 bg-${A.color}-50`:"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Q,{className:`w-6 h-6 ${re?`text-${A.color}-600`:"text-gray-400"}`}),e.jsx("h4",{className:`font-semibold ${re?`text-${A.color}-900`:"text-gray-900"}`,children:A.nome})]}),e.jsx("p",{className:`text-sm ${re?`text-${A.color}-700`:"text-gray-600"}`,children:A.descricao})]},A.id)})}),e.jsx("button",{onClick:j,disabled:r,className:"w-full md:w-auto px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Simulando..."]}):e.jsxs(e.Fragment,{children:[e.jsx($l,{className:"w-5 h-5"}),"Simular CenÃƒÂ¡rio"]})})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["ComparaÃƒÂ§ÃƒÂ£o: Base vs ",f==null?void 0:f.nome]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-3",children:"CenÃƒÂ¡rio Atual"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Saldo Final"}),e.jsx("span",{className:"font-semibold text-gray-900",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(((N=l==null?void 0:l[(l==null?void 0:l.length)-1])==null?void 0:N.saldo_estimado)||0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"VariaÃƒÂ§ÃƒÂ£o"}),e.jsx("span",{className:"font-semibold text-gray-900",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format((((d=l==null?void 0:l[(l==null?void 0:l.length)-1])==null?void 0:d.saldo_estimado)||0)-(((x=l==null?void 0:l[0])==null?void 0:x.saldo_estimado)||0))})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-700 mb-3",children:["CenÃƒÂ¡rio ",f==null?void 0:f.nome]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Saldo Final"}),e.jsx("span",{className:`font-semibold ${t==="otimista"?"text-green-600":t==="pessimista"?"text-red-600":"text-blue-600"}`,children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(((c=(w=o==null?void 0:o.projecoes_ajustadas)==null?void 0:w[((k=o==null?void 0:o.projecoes_ajustadas)==null?void 0:k.length)-1])==null?void 0:c.saldo_ajustado)||0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"VariaÃƒÂ§ÃƒÂ£o"}),e.jsx("span",{className:`font-semibold ${t==="otimista"?"text-green-600":t==="pessimista"?"text-red-600":"text-blue-600"}`,children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format((((i=(p=o==null?void 0:o.projecoes_ajustadas)==null?void 0:p[((b=o==null?void 0:o.projecoes_ajustadas)==null?void 0:b.length)-1])==null?void 0:i.saldo_ajustado)||0)-(((n=(u=o==null?void 0:o.projecoes_ajustadas)==null?void 0:u[0])==null?void 0:n.saldo_ajustado)||0))})]})]})]})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"DiferenÃƒÂ§a no Saldo Final"}),e.jsx("span",{className:`text-xl font-bold ${(((_=(h=o==null?void 0:o.projecoes_ajustadas)==null?void 0:h[((C=o==null?void 0:o.projecoes_ajustadas)==null?void 0:C.length)-1])==null?void 0:_.saldo_ajustado)||0)>(((E=l==null?void 0:l[(l==null?void 0:l.length)-1])==null?void 0:E.saldo_estimado)||0)?"text-green-600":"text-red-600"}`,children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format((((te=(K=o==null?void 0:o.projecoes_ajustadas)==null?void 0:K[(($=o==null?void 0:o.projecoes_ajustadas)==null?void 0:$.length)-1])==null?void 0:te.saldo_ajustado)||0)-(((M=l==null?void 0:l[(l==null?void 0:l.length)-1])==null?void 0:M.saldo_estimado)||0))})]})})]}),e.jsx(rr,{projecoes:(o==null?void 0:o.projecoes_ajustadas)||[],titulo:`ProjeÃƒÂ§ÃƒÂ£o - CenÃƒÂ¡rio ${f==null?void 0:f.nome}`,detalhado:!0})]}),!o&&l&&l.length>0&&e.jsx(rr,{projecoes:l,titulo:"ProjeÃƒÂ§ÃƒÂ£o Atual (CenÃƒÂ¡rio Base)",detalhado:!0})]})}function ld(){const[s,l]=a.useState(!1),t=[{titulo:"Dias de Caixa",descricao:"Quantos dias seu caixa consegue cobrir as despesas com o saldo atual. Se tem R$ 10.000 e gasta R$ 1.000/dia, terÃ¡ 10 dias de caixa.",formula:"Saldo Atual Ã· Despesa MÃ©dia DiÃ¡ria",referencia:"Ãšltimos 30 dias"},{titulo:"Saldo Estimado (ProjeÃ§Ã£o)",descricao:"PrevisÃ£o do saldo do caixa para os prÃ³ximos 15 dias, calculada usando inteligÃªncia artificial (Prophet) baseada em histÃ³rico de 30+ dias.",formula:"Saldo Atual + Receitas Previstas - Despesas Previstas",referencia:"PrÃ³ximos 15 dias"},{titulo:"Entrada/SaÃ­da Estimada",descricao:"PrevisÃ£o diÃ¡ria de quanto vocÃª deve receber (entradas) e gastar (saÃ­das) nos prÃ³ximos dias.",formula:"MÃ©dia histÃ³rica Ã· 30 dias Ã— fator sazonalidade",referencia:"PrÃ³ximos 15 dias"},{titulo:"Status do Caixa",descricao:"ClassificaÃ§Ã£o da saÃºde financeira: CRITICO (<7 dias), ALERTA (7-15 dias) ou OK (>15 dias)",formula:'Status = IF(dias_caixa < 7) "CRITICO" ELSE IF(dias_caixa < 15) "ALERTA" ELSE "OK"',referencia:"Dados em tempo real"}],m=[{nome:"VisÃ£o Geral",conteudo:"Mostra os Ã­ndices principais de saÃºde do caixa: quanto tempo de saldo vocÃª tem, a tendÃªncia (melhorando/piorando), despesa mÃ©dia diÃ¡ria e score geral de saÃºde.",periodo:"Ãšltimos 30 dias de histÃ³rico"},{nome:"ProjeÃ§Ãµes 15 Dias",conteudo:"GrÃ¡fico e tabela com a previsÃ£o de saldo diÃ¡rio para os prÃ³ximos 15 dias. Usa algoritmo Prophet com inteligÃªncia artificial.",periodo:"PrÃ³ximos 15 dias a partir de hoje"},{nome:"Alertas",conteudo:"Lista automÃ¡tica de avisos: se o caixa estÃ¡ crÃ­tico, se hÃ¡ risco de falta de saldo, ou se a tendÃªncia estÃ¡ piorando.",periodo:"Monitoramento contÃ­nuo"},{nome:"Simulador",conteudo:"Permite simular 3 cenÃ¡rios: OTIMISTA (+20% receita, -10% despesa), REALISTA (sem mudanÃ§as) e PESSIMISTA (-20% receita, +10% despesa).",periodo:"PrÃ³ximos 15 dias com mudanÃ§as aplicadas"}];return e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg p-6",children:[e.jsxs("button",{onClick:()=>l(!s),className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Er,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Entenda os Dados"})]}),e.jsx(Ms,{className:`w-5 h-5 text-blue-600 transition-transform ${s?"rotate-180":""}`})]}),s&&e.jsxs("div",{className:"mt-6 space-y-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-gray-900 mb-4",children:"O que cada aba mostra?"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m.map((r,g)=>e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:r.nome}),e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:r.conteudo}),e.jsxs("p",{className:"text-xs text-blue-600 font-medium",children:["ðŸ“… ",r.periodo]})]},g))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-gray-900 mb-4",children:"MÃ©tricas Explicadas"}),e.jsx("div",{className:"space-y-4",children:t.map((r,g)=>e.jsx("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-blue-600",children:g+1})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:r.titulo}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:r.descricao}),e.jsxs("div",{className:"mt-2 text-xs space-y-1",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("strong",{children:"CÃ¡lculo:"})," ",r.formula]}),e.jsxs("p",{className:"text-blue-600",children:[e.jsx("strong",{children:"PerÃ­odo:"})," ",r.referencia]})]})]})]})},g))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-gray-900 mb-4",children:"Perguntas Frequentes"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:'â“ Qual perÃ­odo a "VisÃ£o Geral" estÃ¡ analisando?'}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Os Ãºltimos ",e.jsx("strong",{children:"30 dias"})," de movimentaÃ§Ãµes realizadas. Ela calcula a despesa mÃ©dia desse perÃ­odo para determinar quantos dias de caixa vocÃª tem."]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:"â“ O grÃ¡fico de ProjeÃ§Ãµes Ã© confiÃ¡vel?"}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Usa algoritmo Prophet (inteligÃªncia artificial) que aprende com os Ãºltimos ",e.jsx("strong",{children:"30+ dias"})," de dados. Quanto mais histÃ³rico, mais preciso. Funciona bem para tendÃªncias, mas nÃ£o prevÃª eventos inesperados."]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:"â“ O Simulador altera meus dados reais?"}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"NÃƒO!"}),' Ã‰ apenas uma simulaÃ§Ã£o. Mostra "E se..." ocorressem essas mudanÃ§as. Seus dados permanecem intactos.']})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:'â“ Como interpretar "Dias de Caixa"?'}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"10 dias"})," = vocÃª pode cobrir ",e.jsx("strong",{children:"10 dias de despesas"})," com saldo atual. Se ",e.jsx("strong",{children:"<7 dias"})," Ã© crÃ­tico (risco iminente). Se ",e.jsx("strong",{children:"7-15"})," Ã© alerta. Se ",e.jsx("strong",{children:">15"})," estÃ¡ ok."]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:'â“ Qual Ã© a diferenÃ§a entre "Saldo Atual" e "Saldo Estimado"?'}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Saldo Atual"})," = saldo real hoje. ",e.jsx("strong",{children:"Saldo Estimado"})," = previsÃ£o do saldo daqui a X dias (levando em conta receitas/despesas esperadas)."]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-300 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-900 mb-2",children:"ðŸ’¡ Dicas Importantes:"}),e.jsxs("ul",{className:"text-sm text-blue-900 space-y-1",children:[e.jsxs("li",{children:["â€¢ Clique em ",e.jsx("strong",{children:'"Atualizar ProjeÃ§Ã£o"'})," para recalcular com dados mais recentes"]}),e.jsx("li",{children:"â€¢ Os Alertas aparecem automaticamente quando hÃ¡ risco (caixa <7 dias ou tendÃªncia negativa)"}),e.jsx("li",{children:'â€¢ Use o Simulador para planejar: "E se aumentar despesas de marketing em 20%?"'}),e.jsx("li",{children:"â€¢ Se tiver menos de 30 dias de histÃ³rico, as projeÃ§Ãµes serÃ£o mais conservadoras"})]})]})]})]})}function nd({userId:s}){const[l,t]=a.useState(!0),[m,r]=a.useState(null),[g,o]=a.useState([]),[v,j]=a.useState([]),[f,N]=a.useState("visao-geral");a.useEffect(()=>{d()},[s]);const d=async()=>{t(!0);try{const w={Authorization:`Bearer ${localStorage.getItem("access_token")||localStorage.getItem("token")}`},[c,b,p]=await Promise.all([F.get(`/ia/fluxo/indices-saude/${s}`,{headers:w}),F.get(`/ia/fluxo/projecoes/${s}?dias=15`,{headers:w}),F.get(`/ia/fluxo/alertas/${s}`,{headers:w})]);r(c.data),o(b.data||[]),j(p.data||[])}catch(k){console.error("Erro ao carregar dados IA:",k),ce.error("Erro ao carregar dados da IA")}finally{t(!1)}},x=async()=>{const k=ce.loading("Gerando projeÃƒÂ§ÃƒÂ£o com Prophet...");try{const c={Authorization:`Bearer ${localStorage.getItem("access_token")||localStorage.getItem("token")}`};await F.post(`/ia/fluxo/projetar-15-dias/${s}`,{},{headers:c}),ce.success("ProjeÃƒÂ§ÃƒÂ£o gerada com sucesso!",{id:k}),d()}catch(w){console.error("Erro ao gerar projeÃƒÂ§ÃƒÂ£o:",w),ce.error("Erro ao gerar projeÃƒÂ§ÃƒÂ£o",{id:k})}};return l?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(ld,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Ã°Å¸Â¤â€“ Fluxo de Caixa Preditivo"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"InteligÃƒÂªncia artificial analisando seu caixa"})]}),e.jsxs("button",{onClick:x,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Fa,{className:"w-4 h-4"}),"Atualizar ProjeÃƒÂ§ÃƒÂ£o"]})]}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>N("visao-geral"),className:`px-4 py-2 font-medium transition-colors ${f==="visao-geral"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"VisÃƒÂ£o Geral"}),e.jsx("button",{onClick:()=>N("projecoes"),className:`px-4 py-2 font-medium transition-colors ${f==="projecoes"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"ProjeÃƒÂ§ÃƒÂµes 15 Dias"}),e.jsxs("button",{onClick:()=>N("alertas"),className:`px-4 py-2 font-medium transition-colors relative ${f==="alertas"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["Alertas",v.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:v.length})]}),e.jsx("button",{onClick:()=>N("simulador"),className:`px-4 py-2 font-medium transition-colors ${f==="simulador"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"Simulador"})]}),e.jsxs("div",{className:"space-y-6",children:[f==="visao-geral"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 border-l-4 border-green-500 p-4 rounded",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Ã°Å¸â€œÅ  VisÃƒÂ£o Geral:"})," AnÃƒÂ¡lise dos ÃƒÂºltimos ",e.jsx("strong",{children:"30 dias"})," para calcular a saÃƒÂºde do caixa. Mostra quanto tempo vocÃƒÂª consegue manter o negÃƒÂ³cio com saldo atual."]})}),e.jsx(td,{indices:m}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(rr,{projecoes:g.slice(0,7),titulo:"PrÃƒÂ³ximos 7 Dias"}),e.jsx(fo,{alertas:v.slice(0,3)})]})]}),f==="projecoes"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 p-4 rounded",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Ã°Å¸â€œË† ProjeÃƒÂ§ÃƒÂ£o 15 Dias:"})," PrevisÃƒÂ£o usando inteligÃƒÂªncia artificial (Prophet). Baseada em ",e.jsx("strong",{children:"30+ dias de histÃƒÂ³rico"})," para prever entradas e saÃƒÂ­das dos prÃƒÂ³ximos ",e.jsx("strong",{children:"15 dias"}),". Quanto mais histÃƒÂ³rico, mais precisa a previsÃƒÂ£o."]})}),e.jsx(rr,{projecoes:g,titulo:"ProjeÃƒÂ§ÃƒÂ£o 15 Dias com Prophet",detalhado:!0})]}),f==="alertas"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border-l-4 border-orange-500 p-4 rounded",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Ã¢Å¡Â Ã¯Â¸Â Alertas:"})," Avisos automÃƒÂ¡ticos gerados em tempo real.",e.jsx("strong",{children:" CrÃƒÂ­tico"})," = menos de 7 dias de caixa (risco iminente).",e.jsx("strong",{children:" Alerta"})," = 7-15 dias (atenÃƒÂ§ÃƒÂ£o necessÃƒÂ¡ria).",e.jsx("strong",{children:" OK"})," = mais de 15 dias (situaÃƒÂ§ÃƒÂ£o confortÃƒÂ¡vel)."]})}),e.jsx(fo,{alertas:v})]}),f==="simulador"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 border-l-4 border-purple-500 p-4 rounded",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Ã°Å¸Å½Â¯ Simulador:"})," Teste 3 cenÃƒÂ¡rios para os ",e.jsx("strong",{children:"prÃƒÂ³ximos 15 dias"}),".",e.jsx("strong",{children:" Otimista:"})," +20% receita, -10% despesa.",e.jsx("strong",{children:" Realista:"})," sem mudanÃƒÂ§as.",e.jsx("strong",{children:" Pessimista:"})," -20% receita, +10% despesa.",e.jsx("strong",{children:"Seus dados reais nÃƒÂ£o sÃƒÂ£o alterados!"})]})}),e.jsx(od,{userId:s,projecoesBase:g})]})]})]})}function id(){const{user:s}=ct();return e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(nd,{userId:(s==null?void 0:s.id)||1})})}function dd(){const[s,l]=a.useState([]),[t,m]=a.useState(null),[r,g]=a.useState([]),[o,v]=a.useState(""),[j,f]=a.useState(!1),[N,d]=a.useState(!1),x=a.useRef(null);a.useEffect(()=>{w()},[]),a.useEffect(()=>{t&&c(t)},[t]),a.useEffect(()=>{k()},[r]);const k=()=>{var u;(u=x.current)==null||u.scrollIntoView({behavior:"smooth"})},w=async()=>{try{const u=await F.get("/chat/conversas");l(u.data)}catch(u){console.error("Erro ao carregar conversas:",u)}},c=async u=>{f(!0);try{const n=await F.get(`/chat/conversa/${u}/mensagens`);g(n.data)}catch(n){console.error("Erro ao carregar mensagens:",n),ce.error("Erro ao carregar mensagens")}finally{f(!1)}},b=async()=>{try{const u=await F.post("/chat/nova-conversa",{});l([u.data,...s]),m(u.data.id),g([]),ce.success("Nova conversa criada!")}catch(u){console.error("Erro ao criar conversa:",u),ce.error("Erro ao criar conversa")}},p=async u=>{if(u.preventDefault(),!o.trim()||!t)return;d(!0);const n=o;v("");try{const C=await F.post("/chat/enviar",{conversa_id:t,mensagem:n});g([...r,{id:C.data.mensagem_usuario.id,tipo:"usuario",conteudo:C.data.mensagem_usuario.conteudo,criado_em:C.data.mensagem_usuario.criado_em},{id:C.data.mensagem_ia.id,tipo:"assistente",conteudo:C.data.mensagem_ia.conteudo,criado_em:C.data.mensagem_ia.criado_em}]),w()}catch(C){console.error("Erro ao enviar mensagem:",C),ce.error("Erro ao enviar mensagem"),v(n)}finally{d(!1)}},i=async u=>{if(confirm("Deseja deletar esta conversa?"))try{await F.delete(`/chat/conversa/${u}`),l(s.filter(n=>n.id!==u)),t===u&&(m(null),g([])),ce.success("Conversa deletada")}catch(n){console.error("Erro ao deletar conversa:",n),ce.error("Erro ao deletar conversa")}};return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(ir,{className:"w-8 h-8 text-blue-600"}),"Chat IA Financeiro"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Pergunte sobre seu fluxo de caixa, projeÃ§Ãµes e saÃºde financeira"})]}),e.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(rs,{className:"w-5 h-5"}),"Nova Conversa"]})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"w-80 bg-white border-r border-gray-200 overflow-y-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Conversas Recentes"}),s.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(oo,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Nenhuma conversa ainda"}),e.jsx("button",{onClick:b,className:"mt-3 text-blue-600 text-sm hover:underline",children:"Criar primeira conversa"})]}):e.jsx("div",{className:"space-y-2",children:s.map(u=>e.jsx("div",{onClick:()=>m(u.id),className:`p-3 rounded-lg cursor-pointer transition-colors group ${t===u.id?"bg-blue-50 border-2 border-blue-200":"bg-gray-50 hover:bg-gray-100"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:u.titulo||"Nova conversa"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[u.total_mensagens," mensagens"]})]}),e.jsx("button",{onClick:n=>{n.stopPropagation(),i(u.id)},className:"opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-700 transition-opacity",children:e.jsx(gs,{className:"w-4 h-4"})})]})},u.id))})]})}),e.jsx("div",{className:"flex-1 flex flex-col bg-gray-50",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[j?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(nt,{className:"w-8 h-8 animate-spin text-blue-600"})}):r.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(oo,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Inicie a conversa fazendo uma pergunta"}),e.jsxs("div",{className:"mt-4 text-sm space-y-1",children:[e.jsx("p",{className:"text-gray-400",children:"Exemplos:"}),e.jsx("p",{className:"text-blue-600",children:'"Qual Ã© meu saldo atual?"'}),e.jsx("p",{className:"text-blue-600",children:'"Como estÃ¡ minha situaÃ§Ã£o financeira?"'}),e.jsx("p",{className:"text-blue-600",children:'"HÃ¡ algum alerta?"'})]})]})}):r.map(u=>e.jsx("div",{className:`flex ${u.tipo==="usuario"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex gap-3 max-w-3xl ${u.tipo==="usuario"?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${u.tipo==="usuario"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"}`,children:u.tipo==="usuario"?e.jsx(ar,{className:"w-5 h-5"}):e.jsx(ir,{className:"w-5 h-5"})}),e.jsx("div",{className:`px-4 py-3 rounded-lg ${u.tipo==="usuario"?"bg-blue-600 text-white":"bg-white text-gray-900 border border-gray-200"}`,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:u.conteudo})})]})},u.id)),e.jsx("div",{ref:x})]}),e.jsx("div",{className:"border-t border-gray-200 bg-white p-4",children:e.jsxs("form",{onSubmit:p,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:u=>v(u.target.value),placeholder:"Digite sua pergunta...",disabled:N,className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"}),e.jsx("button",{type:"submit",disabled:N||!o.trim(),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:N?e.jsx(nt,{className:"w-5 h-5 animate-spin"}):e.jsx(zo,{className:"w-5 h-5"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ir,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"Selecione ou crie uma conversa"}),e.jsx("p",{className:"text-sm mt-2",children:"FaÃ§a perguntas sobre seu fluxo de caixa e receba anÃ¡lises inteligentes"})]})})})]})]})}const $a="/whatsapp",ss={async getConfig(){return(await la.get(`${$a}/config`)).data},async getStats(){return(await la.get(`${$a}/analytics/dashboard`)).data},async getAgents(){return(await la.get(`${$a}/agents`)).data},async createAgent(s){return(await la.post(`${$a}/agents`,s)).data},async getAgent(s){return(await la.get(`${$a}/agents/${s}`)).data},async updateAgent(s,l){return(await la.put(`${$a}/agents/${s}`,l)).data},async deleteAgent(s){await la.delete(`${$a}/agents/${s}`)},async getHandoffs(s){const l=s?{status:s}:{};return(await la.get(`${$a}/handoffs/pending`,{params:l})).data},async createHandoff(s){return(await la.post(`${$a}/handoffs`,s)).data},async getHandoff(s){return(await la.get(`${$a}/handoffs/${s}`)).data},async assignHandoff(s,l){return(await la.post(`${$a}/handoffs/${s}/assign`,{agent_id:l})).data},async resolveHandoff(s,l){await la.post(`${$a}/handoffs/${s}/resolve`,{resolution_notes:l})},async cancelHandoff(s){await la.post(`${$a}/handoffs/${s}/cancel`)},async getNotes(s){return(await la.get(`${$a}/handoffs/${s}/notes`)).data},async addNote(s,l){return(await la.post(`${$a}/handoffs/${s}/notes`,{content:l})).data},async getMessages(s){return(await la.get(`${$a}/sessions/${s}/messages`)).data},async sendMessage(s,l){return(await la.post(`${$a}/messages`,{session_id:s,message:l})).data},async createSession(s){return(await la.post(`${$a}/sessions`,s)).data},async getSession(s){return(await la.get(`${$a}/sessions/${s}`)).data},async testSentiment(s){return(await la.post(`${$a}/sentiment/test`,{text:s})).data}},Ft=Pl()((s,l)=>({stats:null,isLoadingStats:!1,agents:[],currentAgent:null,isLoadingAgents:!1,handoffs:[],activeHandoff:null,isLoadingHandoffs:!1,filterStatus:"all",messages:{},isLoadingMessages:{},isConnected:!1,isSidebarOpen:!0,isBotAssistOpen:!1,notifications:[],fetchStats:async()=>{if(l().isLoadingStats){console.log("â­ï¸ Stats already loading, skipping...");return}console.log("ðŸ“Š Fetching stats..."),s({isLoadingStats:!0});const m=new Promise((r,g)=>setTimeout(()=>g(new Error("Stats timeout")),1e4));try{const r=await Promise.race([ss.getStats(),m]);console.log("âœ… Stats received:",r),s({stats:r,isLoadingStats:!1})}catch(r){console.error("âŒ Error fetching stats:",r),s({isLoadingStats:!1})}},fetchAgents:async()=>{s({isLoadingAgents:!0});try{const t=await ss.getAgents();s({agents:t,isLoadingAgents:!1})}catch(t){console.error("Error fetching agents:",t),s({isLoadingAgents:!1})}},initializeCurrentAgent:async()=>{try{console.log("ðŸ”„ Initializing current agent...");const t=localStorage.getItem("user");if(!t){console.warn("âš ï¸ No user found in localStorage");return}const m=JSON.parse(t);console.log("ðŸ‘¤ User loaded:",m.email);const r=await ss.getAgents();console.log("ðŸ“‹ Agents fetched:",r.length);let g=r.find(o=>o.user_id===m.id);g?(console.log("ðŸ”„ Updating existing agent to online..."),g=await ss.updateAgent(g.id,{status:"online"}),console.log("âœ… Agent set to online:",g.id)):(console.log("âž• Creating new agent..."),g=await ss.createAgent({name:m.name||m.email,email:m.email,status:"online",max_concurrent_chats:5,auto_assign:!0,receive_notifications:!0}),console.log("âœ… Created new agent:",g.id)),s({currentAgent:g}),console.log("âœ… Current agent initialized")}catch(t){console.error("âŒ Error initializing current agent:",t)}},updateAgentStatus:async t=>{const{currentAgent:m}=l();if(m)try{const r=await ss.updateAgent(m.id,{status:t});s({currentAgent:r}),s(g=>({agents:g.agents.map(o=>o.id===r.id?r:o)}))}catch(r){console.error("Error updating agent status:",r)}},fetchHandoffs:async t=>{s({isLoadingHandoffs:!0});try{const m=await ss.getHandoffs(t);s({handoffs:m,isLoadingHandoffs:!1})}catch(m){console.error("Error fetching handoffs:",m),s({isLoadingHandoffs:!1})}},setFilterStatus:t=>{s({filterStatus:t});const m={all:void 0,pending:"pending",active:"active",my:"active"};l().fetchHandoffs(m[t])},takeHandoff:async t=>{const{currentAgent:m}=l();if(m)try{const r=await ss.assignHandoff(t,m.id);s(g=>({handoffs:g.handoffs.map(o=>o.id===r.id?r:o)})),s({activeHandoff:r}),l().addNotification({type:"success",title:"Conversa assumida",message:`VocÃª assumiu a conversa com ${r.customer_name||r.phone_number}`,timestamp:new Date().toISOString()})}catch(r){console.error("Error taking handoff:",r),l().addNotification({type:"error",title:"Erro",message:"NÃ£o foi possÃ­vel assumir a conversa",timestamp:new Date().toISOString()})}},resolveHandoff:async(t,m)=>{try{await ss.resolveHandoff(t,m),s(r=>{var g;return{handoffs:r.handoffs.filter(o=>o.id!==t),activeHandoff:((g=r.activeHandoff)==null?void 0:g.id)===t?null:r.activeHandoff}}),l().addNotification({type:"success",title:"Conversa resolvida",message:"A conversa foi finalizada com sucesso",timestamp:new Date().toISOString()}),l().fetchStats()}catch(r){console.error("Error resolving handoff:",r),l().addNotification({type:"error",title:"Erro",message:"NÃ£o foi possÃ­vel resolver a conversa",timestamp:new Date().toISOString()})}},setActiveHandoff:t=>{s({activeHandoff:t})},fetchMessages:async t=>{s(m=>({isLoadingMessages:{...m.isLoadingMessages,[t]:!0}}));try{const m=await ss.getMessages(t);s(r=>({messages:{...r.messages,[t]:m},isLoadingMessages:{...r.isLoadingMessages,[t]:!1}}))}catch(m){console.error("Error fetching messages:",m),s(r=>({isLoadingMessages:{...r.isLoadingMessages,[t]:!1}}))}},sendMessage:async(t,m)=>{try{const r=await ss.sendMessage(t,m);s(g=>({messages:{...g.messages,[t]:[...g.messages[t]||[],r]}}))}catch(r){console.error("Error sending message:",r),l().addNotification({type:"error",title:"Erro ao enviar",message:"NÃ£o foi possÃ­vel enviar a mensagem",timestamp:new Date().toISOString()})}},addMessage:(t,m)=>{s(r=>({messages:{...r.messages,[t]:[...r.messages[t]||[],m]}}))},setConnected:t=>s({isConnected:t}),toggleSidebar:()=>s(t=>({isSidebarOpen:!t.isSidebarOpen})),toggleBotAssist:()=>s(t=>({isBotAssistOpen:!t.isBotAssistOpen})),addNotification:t=>{const m=Math.random().toString(36).substring(7);s(r=>({notifications:[...r.notifications,{...t,id:m}]})),setTimeout(()=>{l().removeNotification(m)},5e3)},removeNotification:t=>{s(m=>({notifications:m.notifications.filter(r=>r.id!==t)}))}}));class cd{constructor(){this.ws=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.reconnectTimeout=null,this.pingInterval=null,this.agentId=null,this.token=null,this.handlers={},this.onConnectionChange=null,this.onMaxReconnectAttemptsReached=null}resolveWsBaseUrl(){const l="/api";return l.startsWith("/")?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}${l}`:l.replace("http://","ws://").replace("https://","wss://")}connect(l,t){var g;if(((g=this.ws)==null?void 0:g.readyState)===WebSocket.OPEN){console.log("WebSocket already connected");return}this.token=l,this.agentId=t;const r=`${this.resolveWsBaseUrl().replace(/\/+$/,"")}/ws/whatsapp/${t}?token=${l}`;console.log("ðŸ”Œ Connecting to WebSocket:",r);try{this.ws=new WebSocket(r),this.setupEventListeners()}catch(o){console.error("Error creating WebSocket:",o),this.handleReconnect()}}disconnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null),this.ws&&(this.ws.readyState===WebSocket.OPEN&&this.send({event:"leave_agent_room"}),this.ws.close(),this.ws=null),this.reconnectAttempts=0,this.token=null,this.agentId=null}setupEventListeners(){this.ws&&(this.ws.onopen=()=>{console.log("âœ… WebSocket connected"),this.reconnectAttempts=0,this.onConnectionChange&&this.onConnectionChange(!0),this.send({event:"join_agent_room"}),this.pingInterval=window.setInterval(()=>{var l;((l=this.ws)==null?void 0:l.readyState)===WebSocket.OPEN&&this.send({event:"ping"})},3e4)},this.ws.onclose=l=>{console.log("âŒ WebSocket disconnected:",l.code,l.reason),this.onConnectionChange&&this.onConnectionChange(!1),l.code!==1e3&&this.handleReconnect()},this.ws.onerror=l=>{console.error("WebSocket error:",l)},this.ws.onmessage=l=>{try{const t=JSON.parse(l.data);this.handleMessage(t)}catch(t){console.error("Error parsing WebSocket message:",t)}})}handleMessage(l){const{event:t,data:m}=l;switch(console.log("ðŸ“© WebSocket message:",t,m),t){case"connected":console.log("Connection confirmed:",m);break;case"new_handoff":this.handlers.onNewHandoff&&this.handlers.onNewHandoff(m);break;case"handoff_assigned":this.handlers.onHandoffAssigned&&this.handlers.onHandoffAssigned(m);break;case"handoff_resolved":this.handlers.onHandoffResolved&&this.handlers.onHandoffResolved(m.handoff_id);break;case"new_message":this.handlers.onNewMessage&&this.handlers.onNewMessage(m.session_id,m.message);break;case"agent_status_change":this.handlers.onAgentStatusChange&&this.handlers.onAgentStatusChange(m);break;case"typing_indicator":this.handlers.onTypingIndicator&&this.handlers.onTypingIndicator(m.session_id,m.is_typing);break;default:console.warn("Unknown WebSocket event:",t)}}handleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached"),this.onMaxReconnectAttemptsReached&&this.onMaxReconnectAttemptsReached();return}this.reconnectAttempts++;const l=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`Reconnecting in ${l}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})...`),this.reconnectTimeout=setTimeout(()=>{this.token&&this.agentId&&this.connect(this.token,this.agentId)},l)}send(l){var t;((t=this.ws)==null?void 0:t.readyState)===WebSocket.OPEN?this.ws.send(JSON.stringify(l)):console.warn("WebSocket is not open. Cannot send message:",l)}registerHandlers(l){this.handlers=l}joinAgentRoom(l){this.send({event:"join_agent_room",data:{agent_id:l}})}leaveAgentRoom(l){this.send({event:"leave_agent_room",data:{agent_id:l}})}sendTypingIndicator(l,t){this.send({event:"typing",data:{session_id:l,is_typing:t}})}isConnected(){var l;return((l=this.ws)==null?void 0:l.readyState)===WebSocket.OPEN}getSocketId(){return this.agentId}}const xs=new cd,xd=(s,l)=>{const[t,m]=a.useState(!1),{addNotification:r,fetchHandoffs:g,setConnected:o,addMessage:v,fetchStats:j}=Ft();return a.useEffect(()=>{if(!(!s||!l||t))return m(!0),console.log("ðŸ”Œ useSocket: Initializing WebSocket connection..."),xs.onConnectionChange=f=>{o(f),r(f?{type:"success",title:"Conectado",message:"ConexÃ£o com servidor estabelecida",timestamp:new Date().toISOString()}:{type:"warning",title:"Desconectado",message:"Tentando reconectar ao servidor...",timestamp:new Date().toISOString()})},xs.onMaxReconnectAttemptsReached=()=>{r({type:"error",title:"Erro de ConexÃ£o",message:"NÃ£o foi possÃ­vel conectar ao servidor. Recarregue a pÃ¡gina.",timestamp:new Date().toISOString()})},xs.registerHandlers({onNewHandoff:f=>{console.log("ðŸ†• New handoff received:",f),g(),r({type:"info",title:"Nova Conversa",message:`${f.customer_name||f.phone_number} precisa de ajuda`,timestamp:new Date().toISOString()}),el("Nova Conversa - WhatsApp",`${f.customer_name||f.phone_number} - ${f.reason}`,f.priority),(f.priority==="urgent"||f.priority==="high")&&vo()},onHandoffAssigned:f=>{console.log("ðŸ‘¤ Handoff assigned:",f),g(),f.assigned_agent_id===l&&r({type:"success",title:"Conversa AtribuÃ­da",message:`VocÃª foi atribuÃ­do Ã  conversa com ${f.customer_name||f.phone_number}`,timestamp:new Date().toISOString()})},onHandoffResolved:f=>{console.log("âœ… Handoff resolved:",f),g(),j()},onNewMessage:(f,N)=>{console.log("ðŸ’¬ New message:",f,N),v(f,N),N.sender_type==="customer"&&(r({type:"info",title:"Nova Mensagem",message:N.content.substring(0,50)+"...",timestamp:new Date().toISOString()}),vo("message"))},onAgentStatusChange:f=>{console.log("ðŸ“Š Agent status changed:",f),j()},onTypingIndicator:(f,N)=>{console.log("âŒ¨ï¸ Typing indicator:",f,N)}}),xs.connect(s,l),()=>{xs.disconnect()}},[s,l]),{isConnected:xs.isConnected(),socketId:xs.getSocketId(),sendTypingIndicator:xs.sendTypingIndicator.bind(xs)}};function el(s,l,t){if(!("Notification"in window)){console.warn("Browser does not support notifications");return}if(Notification.permission==="granted"){const m=new Notification(s,{body:l,icon:"/logo192.png",badge:"/logo192.png",tag:"whatsapp-notification",requireInteraction:t==="urgent",silent:!1});m.onclick=()=>{window.focus(),m.close()},setTimeout(()=>m.close(),1e4)}else Notification.permission!=="denied"&&Notification.requestPermission().then(m=>{m==="granted"&&el(s,l,t)})}function vo(s="handoff"){try{const l=new Audio(s==="handoff"?"/sounds/notification-handoff.mp3":"/sounds/notification-message.mp3");l.volume=.5,l.play().catch(t=>{console.warn("Could not play notification sound:",t)})}catch(l){console.warn("Error playing sound:",l)}}class md extends a.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null}}static getDerivedStateFromError(l){return{hasError:!0,error:l}}componentDidCatch(l,t){console.error("ErrorBoundary caught an error:",l,t)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900 text-center mb-2",children:"Algo deu errado"}),e.jsx("p",{className:"text-sm text-gray-600 text-center mb-6",children:"Ocorreu um erro inesperado. Por favor, recarregue a pÃ¡gina."}),this.state.error&&e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded border border-gray-200",children:e.jsx("p",{className:"text-xs font-mono text-gray-700 break-words",children:this.state.error.message})}),e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Recarregar PÃ¡gina"})]})}):this.props.children}}const ud=a.memo(({stats:s,isLoading:l})=>{if(l)return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[...Array(6)].map((m,r)=>e.jsxs("div",{className:"bg-gray-100 rounded-lg p-4 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-3/4"})]},r))});if(!s)return null;const t=[{label:"Total",value:s.total_handoffs,icon:"ðŸ’¬",color:"bg-blue-50 text-blue-700"},{label:"Aguardando",value:s.pending_count,icon:"â³",color:"bg-yellow-50 text-yellow-700"},{label:"Ativas",value:s.active_count,icon:"ðŸ’­",color:"bg-green-50 text-green-700"},{label:"Resolvidas",value:s.resolved_count,icon:"âœ…",color:"bg-gray-50 text-gray-700"},{label:"Agentes Online",value:s.available_agents||0,icon:"ðŸ‘¤",color:"bg-purple-50 text-purple-700"},{label:"Tempo MÃ©dio",value:s.avg_response_time_seconds?Math.round(s.avg_response_time_seconds/60)+"min":"0min",icon:"âš¡",color:"bg-orange-50 text-orange-700"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:t.map((m,r)=>e.jsxs("div",{className:`rounded-lg p-4 ${m.color}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-lg",children:m.icon}),e.jsx("p",{className:"text-xs font-medium opacity-75",children:m.label})]}),e.jsx("p",{className:"text-2xl font-bold",children:m.value})]},r))})}),pd=a.memo(({agents:s,isLoading:l})=>{const{currentAgent:t,updateAgentStatus:m}=Ft(),r={online:"bg-green-500",busy:"bg-yellow-500",away:"bg-orange-500",offline:"bg-gray-400"},g={online:"Online",busy:"Ocupado",away:"Ausente",offline:"Offline"};return l?e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((o,v)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg animate-pulse",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3 mb-1"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-1/2"})]})]},v))}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:["Agentes (",s.length,")"]}),s.map(o=>e.jsxs("div",{className:`
            flex items-center gap-3 p-2 rounded-lg transition-colors
            ${(t==null?void 0:t.id)===o.id?"bg-blue-50":"hover:bg-gray-50"}
          `,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${r[o.status]}`}),o.status==="online"&&e.jsx("div",{className:`absolute inset-0 w-2 h-2 rounded-full ${r[o.status]} animate-ping opacity-75`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:o.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:g[o.status]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[o.current_chats,"/",o.max_concurrent_chats]})]})]}),(t==null?void 0:t.id)===o.id&&e.jsxs("select",{value:o.status,onChange:v=>m(v.target.value),className:"text-xs border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"busy",children:"Ocupado"}),e.jsx("option",{value:"away",children:"Ausente"}),e.jsx("option",{value:"offline",children:"Offline"})]})]},o.id)),s.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"Nenhum agente disponÃ­vel"})]})}),gd=a.memo(({handoffs:s,activeHandoff:l,isLoading:t})=>{const{setActiveHandoff:m,takeHandoff:r}=Ft(),g={urgent:"bg-red-100 text-red-700 border-red-200",high:"bg-orange-100 text-orange-700 border-orange-200",medium:"bg-yellow-100 text-yellow-700 border-yellow-200",low:"bg-gray-100 text-gray-700 border-gray-200"},o={urgent:"ðŸš¨ Urgente",high:"âš ï¸ Alta",medium:"ðŸ“Œ MÃ©dia",low:"ðŸ“‹ Baixa"},v={pending:"â³",active:"ðŸ’¬",resolved:"âœ…",cancelled:"âŒ"};return t?e.jsx("div",{className:"p-4 space-y-3",children:[...Array(5)].map((j,f)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 animate-pulse",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})]})},f))}):s.length===0?e.jsx("div",{className:"flex items-center justify-center h-full p-8",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-sm font-medium",children:"Nenhuma conversa"})]})}):e.jsx("div",{className:"p-4 space-y-3",children:s.map(j=>{const f=(l==null?void 0:l.id)===j.id,N=j.status==="pending";return e.jsx("div",{onClick:()=>m(j),className:`
              border rounded-lg p-3 cursor-pointer transition-all
              ${f?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:shadow-sm"}
            `,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`
                w-10 h-10 rounded-full flex items-center justify-center text-lg font-semibold
                ${g[j.priority]}
              `,children:j.customer_name?j.customer_name.charAt(0).toUpperCase():"ðŸ‘¤"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:j.customer_name||"Cliente"}),e.jsx("span",{className:"text-xs text-gray-500 whitespace-nowrap",children:zl(new Date(j.created_at),{addSuffix:!0,locale:Fr})})]}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:j.phone_number}),e.jsx("p",{className:"text-sm text-gray-700 mb-2 line-clamp-2",children:j.reason_details||j.reason}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`
                    text-xs px-2 py-1 rounded border
                    ${g[j.priority]}
                  `,children:o[j.priority]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:v[j.status]}),N&&e.jsx("button",{onClick:d=>{d.stopPropagation(),r(j.id)},className:"text-xs px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Assumir"})]})]})]})]})},j.id)})})}),hd=({handoff:s})=>{const{messages:l,isLoadingMessages:t,fetchMessages:m,sendMessage:r,resolveHandoff:g,toggleBotAssist:o}=Ft(),[v,j]=a.useState(""),[f,N]=a.useState(!1),[d,x]=a.useState(""),k=a.useRef(null),w=l[s.session_id]||[],c=t[s.session_id]||!1;a.useEffect(()=>{s.session_id&&m(s.session_id)},[s.session_id]),a.useEffect(()=>{var n;(n=k.current)==null||n.scrollIntoView({behavior:"smooth"})},[w]);const b=async()=>{v.trim()&&(await r(s.session_id,v),j(""))},p=async()=>{if(!d.trim()){alert("Por favor, adicione notas de resoluÃ§Ã£o");return}await g(s.id,d),N(!1),x("")},i=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),b())},u={urgent:"border-red-500 bg-red-50",high:"border-orange-500 bg-orange-50",medium:"border-yellow-500 bg-yellow-50",low:"border-gray-500 bg-gray-50"};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:`border-b-4 ${u[s.priority]} p-4`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white text-lg font-semibold",children:s.customer_name?s.customer_name.charAt(0).toUpperCase():"ðŸ‘¤"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:s.customer_name||"Cliente"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.phone_number})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:o,className:"p-2 rounded-lg hover:bg-white hover:shadow transition-all",title:"Bot Assist",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),s.status==="active"&&e.jsx("button",{onClick:()=>N(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:"Resolver"})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Motivo:"})," ",s.reason]}),s.reason_details&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.reason_details})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:c?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"Carregando mensagens..."})]})}):w.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("p",{className:"text-sm font-medium",children:"Nenhuma mensagem ainda"})]})}):e.jsxs(e.Fragment,{children:[w.map(n=>{const C=n.sender_type==="agent";return n.sender_type==="system"?e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"bg-gray-100 text-gray-600 text-xs px-3 py-1 rounded-full",children:n.content})},n.id):e.jsx("div",{className:`flex ${C?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[70%] ${C?"order-2":"order-1"}`,children:[e.jsx("div",{className:`
                      rounded-lg px-4 py-2
                      ${C?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}
                    `,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:n.content})}),e.jsx("p",{className:`text-xs text-gray-500 mt-1 ${C?"text-right":"text-left"}`,children:Uo(new Date(n.timestamp),"HH:mm",{locale:Fr})})]})},n.id)}),e.jsx("div",{ref:k})]})}),s.status==="active"&&!f&&e.jsx("div",{className:"border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("textarea",{value:v,onChange:n=>j(n.target.value),onKeyPress:i,placeholder:"Digite sua mensagem...",rows:3,className:"flex-1 border border-gray-300 rounded-lg px-4 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:b,disabled:!v.trim(),className:"px-6 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-medium",children:"Enviar"})]})}),f&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Resolver Conversa"}),e.jsx("textarea",{value:d,onChange:n=>x(n.target.value),placeholder:"Descreva como foi resolvido o atendimento...",rows:4,className:"w-full border border-gray-300 rounded-lg px-4 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{N(!1),x("")},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:p,disabled:!d.trim(),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:"Confirmar ResoluÃ§Ã£o"})]})]})})]})},bd=({handoff:s})=>{const[l,t]=a.useState(""),[m,r]=a.useState(null),[g,o]=a.useState(!1),v=async()=>{if(l.trim()){o(!0);try{const f=await ss.testSentiment(l);r(f)}catch(f){console.error("Error analyzing sentiment:",f)}finally{o(!1)}}},j=["Entendo sua frustraÃ§Ã£o. Vou verificar isso imediatamente.","Obrigado por aguardar. Estou analisando sua solicitaÃ§Ã£o.","Vou encaminhar para o setor responsÃ¡vel e retorno em breve.","Consegui resolver! Precisa de mais alguma coisa?"];return s?e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Bot Assist ðŸ¤–"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"AnÃ¡lise de sentimento e sugestÃµes"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Analisar Sentimento"}),e.jsx("textarea",{value:l,onChange:f=>t(f.target.value),placeholder:"Cole uma mensagem do cliente...",rows:4,className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:v,disabled:!l.trim()||g,className:"mt-2 w-full px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:g?"Analisando...":"Analisar"}),m&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Score:"}),e.jsx("span",{className:`text-sm font-bold ${m.score>0?"text-green-600":m.score<0?"text-red-600":"text-gray-600"}`,children:m.score.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Label:"}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:m.label})]}),m.emotions.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"EmoÃ§Ãµes:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:m.emotions.map((f,N)=>e.jsx("span",{className:"text-xs px-2 py-0.5 bg-purple-100 text-purple-700 rounded",children:f},N))})]}),m.triggers.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Gatilhos:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:m.triggers.map((f,N)=>e.jsx("span",{className:"text-xs px-2 py-0.5 bg-red-100 text-red-700 rounded",children:f},N))})]}),m.should_handoff&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsx("span",{className:"text-xs font-medium text-red-600",children:"âš ï¸ Recomenda handoff humano"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Respostas Sugeridas"}),e.jsx("div",{className:"space-y-2",children:j.map((f,N)=>e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(f)},className:"w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg border border-gray-200 text-sm text-gray-700 transition-colors",children:f},N))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"AÃ§Ãµes RÃ¡pidas"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{className:"w-full px-4 py-2 bg-orange-50 text-orange-700 border border-orange-200 rounded-lg text-sm font-medium hover:bg-orange-100 transition-colors",children:"ðŸ“‹ Ver histÃ³rico completo"}),e.jsx("button",{className:"w-full px-4 py-2 bg-purple-50 text-purple-700 border border-purple-200 rounded-lg text-sm font-medium hover:bg-purple-100 transition-colors",children:"ðŸ“Š AnÃ¡lise de perfil"}),e.jsx("button",{className:"w-full px-4 py-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors",children:"ðŸ”— Criar ticket"})]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full p-8",children:e.jsx("p",{className:"text-sm text-gray-400 text-center",children:"Selecione uma conversa para ver sugestÃµes"})})},fd=({notification:s,onClose:l})=>{const[t,m]=a.useState(!1);a.useEffect(()=>{const o=setTimeout(()=>{m(!0),setTimeout(l,300)},5e3);return()=>clearTimeout(o)},[l]);const r={info:"bg-blue-50 border-blue-200 text-blue-800",success:"bg-green-50 border-green-200 text-green-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800",error:"bg-red-50 border-red-200 text-red-800"},g={info:"â„¹ï¸",success:"âœ…",warning:"âš ï¸",error:"âŒ"};return e.jsx("div",{className:`
        max-w-sm w-full bg-white border-2 rounded-lg shadow-lg p-4
        transform transition-all duration-300 ease-out
        ${t?"translate-x-full opacity-0":"translate-x-0 opacity-100"}
        ${r[s.type]}
      `,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-xl",children:g[s.type]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm mb-1",children:s.title}),e.jsx("p",{className:"text-sm opacity-90",children:s.message})]}),e.jsx("button",{onClick:()=>{m(!0),setTimeout(l,300)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})},jd=a.memo(({isConnected:s,socketId:l})=>e.jsxs("div",{className:`
      flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-medium
      ${s?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}
    `,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`
          w-2 h-2 rounded-full
          ${s?"bg-green-500":"bg-red-500"}
        `}),s&&e.jsx("div",{className:"absolute inset-0 w-2 h-2 bg-green-500 rounded-full animate-ping opacity-75"})]}),e.jsx("span",{children:s?"Online":"Desconectado"}),s&&l&&e.jsxs("span",{className:"text-[10px] opacity-50 font-mono",title:`Socket ID: ${l}`,children:["â€¢ ",l.substring(0,6)]})]})),vd=()=>{const[s,l]=a.useState("default"),[t,m]=a.useState(!1);a.useEffect(()=>{"Notification"in window&&(l(Notification.permission),Notification.permission==="default"&&m(!0))},[]);const r=async()=>{if("Notification"in window){const g=await Notification.requestPermission();l(g),g==="granted"&&(m(!1),new Notification("NotificaÃ§Ãµes Ativadas",{body:"VocÃª receberÃ¡ alertas de novas conversas",icon:"/logo192.png"}))}};return!t||s==="granted"?null:e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-1",children:"Ativar NotificaÃ§Ãµes"}),e.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"Receba alertas instantÃ¢neos quando novas conversas precisarem de atendimento"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors",children:"Ativar NotificaÃ§Ãµes"}),e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 bg-white text-blue-700 text-sm font-medium rounded-lg border border-blue-200 hover:bg-blue-50 transition-colors",children:"Agora NÃ£o"})]})]}),e.jsx("button",{onClick:()=>m(!1),className:"flex-shrink-0 text-blue-400 hover:text-blue-600 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})},yd=()=>{const[s,l]=ts.useState(!0);console.log("ðŸŽ¯ WhatsAppDashboard component rendering...");const{stats:t,agents:m,handoffs:r,activeHandoff:g,filterStatus:o,isLoadingStats:v,isLoadingAgents:j,isLoadingHandoffs:f,isSidebarOpen:N,isBotAssistOpen:d,isConnected:x,notifications:k,currentAgent:w,fetchStats:c,fetchAgents:b,fetchHandoffs:p,initializeCurrentAgent:i,setFilterStatus:u,toggleSidebar:n,removeNotification:C}=Ft(),h=localStorage.getItem("access_token"),{socketId:_}=xd(h,(w==null?void 0:w.id)||null);return a.useEffect(()=>{let E=!0,$=!1,K=null,te=!1;const M=async()=>{if(!(!E||$)){$=!0;try{console.log("ðŸš€ Initializing WhatsApp Dashboard...");const re=new Promise((q,Z)=>setTimeout(()=>Z(new Error("Initialization timeout")),15e3));try{await Promise.race([Promise.all([i(),c(),b(),p()]),re])}catch(q){console.warn("âš ï¸ Initialization timeout, continuing anyway:",q)}console.log("âœ… Dashboard initialized")}catch(re){console.error("âŒ Error initializing dashboard:",re)}finally{E&&l(!1)}}},A=async()=>{if(!(te||!E)){if(document.hidden){console.log("â¸ï¸ Page hidden, skipping refresh");return}te=!0,console.log("ðŸ”„ Refreshing dashboard data...");try{await Promise.all([c(),p(o==="all"?void 0:o)])}catch(re){console.error("Error refreshing data:",re)}finally{te=!1}}};M(),K=setInterval(A,6e4);const Q=()=>{!document.hidden&&E&&(console.log("ðŸ‘ï¸ Page visible again, refreshing data"),A())};return document.addEventListener("visibilitychange",Q),()=>{E=!1,K&&clearInterval(K),document.removeEventListener("visibilitychange",Q)}},[]),s?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando WhatsApp Dashboard..."})]})}):e.jsx(md,{children:e.jsxs("div",{className:"flex h-screen bg-gray-50",role:"main","aria-label":"WhatsApp Dashboard",children:[e.jsx("div",{className:`
        transition-all duration-300 ease-in-out
        ${N?"w-80":"w-0"}
        border-r border-gray-200 bg-white overflow-hidden
      `,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Atendimento WhatsApp"}),e.jsx("div",{className:"mt-2",children:e.jsx(jd,{isConnected:x,socketId:_})})]}),e.jsx("button",{onClick:n,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Recolher painel",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"})})})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","active","my"].map(E=>e.jsxs("button",{onClick:()=>u(E),className:`
                    px-3 py-1.5 rounded-lg text-sm font-medium transition-colors
                    ${o===E?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}
                  `,children:[E==="all"&&"Todas",E==="pending"&&"Aguardando",E==="active"&&"Ativas",E==="my"&&"Minhas"]},E))})]}),e.jsx("div",{className:"px-4 py-3 border-b border-gray-200",children:e.jsx(pd,{agents:m,isLoading:j})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(gd,{handoffs:r,activeHandoff:g,isLoading:f})})]})}),!N&&e.jsx("button",{onClick:n,className:"absolute top-4 left-4 z-10 p-2 bg-white rounded-lg shadow-lg hover:bg-gray-50 transition-colors",title:"Expandir painel",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 bg-white border-b border-gray-200",children:e.jsx(vd,{})}),e.jsx("div",{className:"p-4 bg-white border-b border-gray-200",children:e.jsx(ud,{stats:t,isLoading:v})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"flex-1",children:g?e.jsx(hd,{handoff:g}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("p",{className:"text-lg font-medium",children:"Selecione uma conversa"}),e.jsx("p",{className:"text-sm mt-1",children:"Escolha uma conversa da fila para comeÃ§ar"})]})})}),d&&e.jsx("div",{className:"w-80 border-l border-gray-200 bg-white",children:e.jsx(bd,{handoff:g})})]})]}),e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:k.map(E=>e.jsx(fd,{notification:E,onClose:()=>C(E.id)},E.id))})]})})},Nd=()=>{const[s,l]=a.useState([]),[t,m]=a.useState(!0),[r,g]=a.useState(!1),[o,v]=a.useState(null),[j,f]=a.useState([]),[N,d]=a.useState([]),[x,k]=a.useState(!1),[w,c]=a.useState(null);a.useEffect(()=>{b()},[]);const b=async()=>{try{m(!0);const n=await F.get("/comissoes/configuracoes/funcionarios");n.data.success&&l(n.data.data)}catch(n){console.error("Erro ao carregar funcionÃ¡rios:",n),c("Erro ao carregar funcionÃ¡rios com comissÃµes")}finally{m(!1)}},p=async(n=null)=>{v(n),g(!0),k(!0);try{const C=await F.get("/comissoes/arvore-produtos");if(C.data.success&&d(C.data.data),n){const h=await F.get(`/comissoes/configuracoes/funcionario/${n}`);h.data.success&&f(h.data.data)}}catch(C){console.error("Erro ao carregar dados:",C),c("Erro ao carregar dados de configuraÃ§Ã£o")}finally{k(!1)}},i=()=>{g(!1),v(null),f([]),d([]),b()},u=async n=>{const C=prompt("Digite o ID do funcionÃ¡rio de destino:");if(C)try{const h=await F.post("/comissoes/configuracoes/duplicar",{funcionario_origem_id:parseInt(n),funcionario_destino_id:parseInt(C)});h.data.success&&(alert(h.data.message),b())}catch(h){console.error("Erro ao duplicar configuraÃ§Ã£o:",h),alert("Erro ao duplicar configuraÃ§Ã£o")}};return t?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Cadastro de ComissÃµes"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie as comissÃµes dos funcionÃ¡rios"})]}),e.jsxs("button",{onClick:()=>p(),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2",children:[e.jsx("span",{children:"+"}),"Nova ComissÃ£o"]})]})}),w&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:w}),e.jsx("div",{className:"bg-white rounded-lg shadow",children:s.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"Nenhuma comissÃ£o configurada"}),e.jsx("p",{className:"text-sm",children:'Clique em "Nova ComissÃ£o" para comeÃ§ar'})]}):e.jsx("div",{className:"divide-y",children:s.map(n=>e.jsx("div",{className:"p-4 hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>p(n.id),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:n.nome.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:n.nome}),e.jsx("p",{className:"text-sm text-gray-500",children:n.cargo})]})]}),e.jsxs("div",{className:"mt-2 flex gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:[e.jsx("strong",{children:n.categorias})," categorias"]}),e.jsxs("span",{children:[e.jsx("strong",{children:n.subcategorias})," subcategorias"]}),e.jsxs("span",{children:[e.jsx("strong",{children:n.produtos})," produtos especÃ­ficos"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:C=>{C.stopPropagation(),p(n.id)},className:"px-3 py-1 text-blue-600 hover:bg-blue-50 rounded",children:"Editar"}),e.jsx("button",{onClick:C=>{C.stopPropagation(),u(n.id)},className:"px-3 py-1 text-gray-600 hover:bg-gray-100 rounded",title:"Duplicar configuraÃ§Ã£o para outro funcionÃ¡rio",children:"Duplicar"})]})]})},n.id))})}),r&&e.jsx(_d,{funcionarioId:o,configuracoes:j,arvoreProdutos:N,loading:x,onClose:i,onSave:()=>{b(),i()}})]})},_d=({funcionarioId:s,configuracoes:l,arvoreProdutos:t,loading:m,onClose:r,onSave:g})=>{const[o,v]=a.useState([]),[j,f]=a.useState(s||""),[N,d]=a.useState(""),[x,k]=a.useState({desconta_taxa_cartao:!0,desconta_impostos:!0,desconta_taxa_entrega:!1,comissao_venda_parcial:!0}),[w,c]=a.useState({}),[b,p]=a.useState({}),[i,u]=a.useState(null),[n,C]=a.useState([]),[h,_]=a.useState(!1),[E,$]=a.useState({atual:0,total:0}),[K,te]=a.useState(null);a.useEffect(()=>{M()},[]),a.useEffect(()=>{const B={};if(l.forEach(y=>{const O=`${y.tipo}-${y.referencia_id}`;B[O]=y}),p(B),l.length>0){const y=l[0],O={desconta_taxa_cartao:y.desconta_taxa_cartao??!0,desconta_impostos:y.desconta_impostos??!0,desconta_taxa_entrega:y.desconta_custo_entrega??!1,comissao_venda_parcial:y.comissao_venda_parcial??!0};k(O),te(O)}},[l]);const M=async()=>{try{const B=await F.get("/comissoes/funcionarios");if(B.data.success&&(v(B.data.data),s)){const y=B.data.data.find(O=>O.id===parseInt(s));y&&y.data_fechamento_comissao&&d(String(y.data_fechamento_comissao))}}catch(B){console.error("Erro ao carregar funcionÃ¡rios:",B)}},A=B=>{c(y=>({...y,[B]:!y[B]}))},Q=(B,y,O)=>{const z=`${B}-${y}`,ae=b[z];u({tipo:B,id:y,nome:O,tipo_calculo:(ae==null?void 0:ae.tipo_calculo)||"percentual",percentual:(ae==null?void 0:ae.percentual)||10,percentual_loja:(ae==null?void 0:ae.percentual_loja)||50,permite_edicao_venda:(ae==null?void 0:ae.permite_edicao_venda)||!1,observacoes:(ae==null?void 0:ae.observacoes)||""})},re=()=>{if(!j){alert("Selecione um funcionÃ¡rio");return}if(!i){alert("Selecione um item para configurar");return}if(n.some(O=>O.tipo===i.tipo&&O.referencia_id===i.id)){alert("Este item jÃ¡ foi adicionado Ã  lista!");return}if(i.tipo==="categoria"&&n.some(z=>(z.tipo==="subcategoria"||z.tipo==="produto")&&z.nome.includes(i.nome))&&!confirm(`âš ï¸ ATENÃ‡ÃƒO: VocÃª jÃ¡ configurou produtos/subcategorias desta categoria.

HIERARQUIA: Produto > Subcategoria > Categoria

A configuraÃ§Ã£o mais especÃ­fica tem prioridade.

Deseja adicionar mesmo assim?`))return;const y={tipo:i.tipo,referencia_id:i.id,nome:i.nome,tipo_calculo:i.tipo_calculo,percentual:parseFloat(i.percentual)||0,percentual_loja:i.tipo_calculo==="lucro"?parseFloat(i.percentual_loja)||0:null,permite_edicao_venda:i.permite_edicao_venda||!1,observacoes:i.observacoes||""};C([...n,y]),u(null),alert('ConfiguraÃ§Ã£o adicionada! Configure mais itens ou clique em "Salvar Todas"')},q=B=>{C(n.filter((y,O)=>O!==B))},Z=async()=>{var B,y,O;if(!j){alert("Selecione um funcionÃ¡rio");return}if(n.length===0){alert("Adicione pelo menos uma configuraÃ§Ã£o");return}_(!0);try{N&&await F.put(`/funcionarios/${j}`,{data_fechamento_comissao:parseInt(N)});const z=n.map(W=>({funcionario_id:parseInt(j),tipo:W.tipo,referencia_id:W.referencia_id,tipo_calculo:W.tipo_calculo,percentual:parseFloat(W.percentual)||0,percentual_loja:W.percentual_loja?parseFloat(W.percentual_loja):null,permite_edicao_venda:W.permite_edicao_venda||!1,observacoes:W.observacoes||"",desconta_taxa_cartao:x.desconta_taxa_cartao,desconta_impostos:x.desconta_impostos,desconta_taxa_entrega:x.desconta_taxa_entrega,comissao_venda_parcial:x.comissao_venda_parcial}));console.log("Enviando configuraÃ§Ãµes em batch:",z);const ae=await F.post("/comissoes/configuracoes/batch",{configuracoes:z});if(console.log("Resposta do servidor:",ae.data),ae.data.success){if(alert(`âœ… ${ae.data.total} configuraÃ§Ãµes salvas com sucesso!`),C([]),j)try{const W=await F.get(`/comissoes/configuracoes/funcionario/${j}`);if(W.data.success){const ne={};W.data.data.forEach(H=>{const ee=`${H.tipo}-${H.referencia_id}`;ne[ee]=H}),p(ne)}}catch(W){console.error("Erro ao recarregar configuraÃ§Ãµes:",W)}g()}}catch(z){console.error("Erro ao salvar configuraÃ§Ãµes:",z),console.error("Resposta do servidor:",(B=z.response)==null?void 0:B.data);const ae=((O=(y=z.response)==null?void 0:y.data)==null?void 0:O.detail)||z.message||"Erro desconhecido";alert(`âŒ Erro ao salvar configuraÃ§Ãµes:

${ae}`)}finally{_(!1),$({atual:0,total:0})}},R=async()=>{if(!j){alert("Selecione um funcionÃ¡rio");return}if(!i){if(Object.keys(b).length===0){alert("Nenhuma configuraÃ§Ã£o encontrada para atualizar as regras.");return}if(!(K&&(x.desconta_taxa_cartao!==K.desconta_taxa_cartao||x.desconta_impostos!==K.desconta_impostos||x.desconta_taxa_entrega!==K.desconta_taxa_entrega||x.comissao_venda_parcial!==K.comissao_venda_parcial))){alert("Nenhuma alteraÃ§Ã£o detectada nas regras.");return}if(!confirm("Deseja atualizar as regras de cÃ¡lculo em TODAS as configuraÃ§Ãµes deste funcionÃ¡rio?"))return;try{console.log("ðŸ’¾ SALVANDO REGRAS - Estado atual:",x);for(const[y,O]of Object.entries(b)){const z={funcionario_id:parseInt(j),tipo:O.tipo,referencia_id:O.referencia_id,tipo_calculo:O.tipo_calculo,percentual:parseFloat(O.percentual),percentual_loja:O.percentual_loja?parseFloat(O.percentual_loja):null,desconta_taxa_cartao:x.desconta_taxa_cartao,desconta_impostos:x.desconta_impostos,desconta_custo_entrega:x.desconta_taxa_entrega,comissao_venda_parcial:x.comissao_venda_parcial,permite_edicao_venda:O.permite_edicao_venda,observacoes:O.observacoes||""};console.log("ðŸ’¾ Dados sendo enviados ao backend:",z),await F.post("/comissoes/configuracoes",z)}alert("âœ… Regras atualizadas com sucesso em todas as configuraÃ§Ãµes!"),te(x)}catch(y){console.error("Erro ao atualizar regras:",y),alert("Erro ao atualizar regras")}return}if(!i){alert("Selecione um item para configurar");return}try{const B={funcionario_id:parseInt(j),tipo:i.tipo,referencia_id:i.id,tipo_calculo:i.tipo_calculo,percentual:parseFloat(i.percentual),percentual_loja:i.tipo_calculo==="lucro"?parseFloat(i.percentual_loja):null,desconta_taxa_cartao:x.desconta_taxa_cartao,desconta_impostos:x.desconta_impostos,desconta_custo_entrega:x.desconta_taxa_entrega,comissao_venda_parcial:x.comissao_venda_parcial,permite_edicao_venda:i.permite_edicao_venda,observacoes:i.observacoes},y=await F.post("/comissoes/configuracoes",B);if(y.data.success){alert("ConfiguraÃ§Ã£o salva com sucesso!");const O=`${i.tipo}-${i.id}`;p(z=>({...z,[O]:{...B,id:y.data.config_id,nome_item:i.nome}})),u(null)}}catch(B){console.error("Erro ao salvar configuraÃ§Ã£o:",B),alert("Erro ao salvar configuraÃ§Ã£o")}},J=(B,y)=>{const O=`${B}-${y}`;return b[O]},S=(B,y)=>!!J(B,y),P=(B,y)=>n.some(O=>O.tipo===B&&O.referencia_id===y),G=(B,y=0)=>{const O="  ".repeat(y),z=y===0?"ðŸ“¦":"â†’",ae=B.filhas&&B.filhas.length>0,W=B.produtos&&B.produtos.length>0;return S("categoria",B.id)?w[B.id]?e.jsxs(ts.Fragment,{children:[ae&&B.filhas.map(H=>G(H,y+1)),W&&e.jsx("div",{className:"pl-6",style:{paddingLeft:`${24+y*20}px`},children:B.produtos.map(H=>{const ee=S("produto",H.id),de=P("produto",H.id);return ee?null:e.jsxs("div",{className:`p-2 flex items-center justify-between cursor-pointer hover:bg-gray-50 ${de?"bg-yellow-50":""}`,onClick:()=>Q("produto",H.id,H.nome),children:[e.jsxs("span",{className:"text-sm",children:["ðŸ“Œ ",H.nome]}),de&&e.jsx("span",{className:"text-xs text-yellow-600",children:"â³ Na lista"})]},`prod-${H.id}`)})})]},`cat-${B.id}`):null:e.jsxs("div",{className:"border-b last:border-b-0",children:[e.jsxs("div",{className:`p-3 flex items-center justify-between cursor-pointer hover:bg-gray-50 ${P("categoria",B.id)?"bg-yellow-50":""}`,style:{paddingLeft:`${12+y*20}px`},onClick:()=>Q("categoria",B.id,`${O}${B.nome}`),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[(ae||W)&&e.jsx("button",{onClick:H=>{H.stopPropagation(),A(B.id)},className:"text-gray-500",children:w[B.id]?"â–¼":"â–¶"}),e.jsxs("span",{className:y===0?"font-medium":"text-sm",children:[z," ",B.nome,y>0&&e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(NÃ­vel ",y+1,")"]})]})]}),P("categoria",B.id)&&e.jsx("span",{className:"text-xs text-yellow-600",children:"â³ Na lista"})]}),w[B.id]&&e.jsxs("div",{children:[ae&&e.jsx("div",{children:B.filhas.map(H=>G(H,y+1))}),W&&e.jsx("div",{className:"pl-6",style:{paddingLeft:`${24+y*20}px`},children:B.produtos.map(H=>{const ee=S("produto",H.id),de=P("produto",H.id);return ee?null:e.jsxs("div",{className:`p-2 flex items-center justify-between cursor-pointer hover:bg-gray-50 ${de?"bg-yellow-50":""}`,onClick:()=>Q("produto",H.id,H.nome),children:[e.jsxs("span",{className:"text-sm",children:["ðŸ“Œ ",H.nome]}),de&&e.jsx("span",{className:"text-xs text-yellow-600",children:"â³ Na lista"})]},`prod-${H.id}`)})})]})]},`cat-${B.id}`)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"ConfiguraÃ§Ã£o de ComissÃ£o"}),e.jsx("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"Ã—"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"FuncionÃ¡rio"}),e.jsxs("select",{value:j,onChange:B=>f(B.target.value),className:"w-full border rounded-lg px-3 py-2",disabled:!!s,children:[e.jsx("option",{value:"",children:"Selecione um funcionÃ¡rio"}),o.map(B=>e.jsxs("option",{value:B.id,children:[B.nome," - ",B.cargo]},B.id))]}),e.jsx("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded text-xs",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"â„¹ï¸"}),e.jsxs("div",{className:"text-blue-700",children:[e.jsx("strong",{children:"Apenas parceiros podem receber comissÃµes."}),e.jsx("br",{}),'Se a pessoa nÃ£o aparecer na lista, marque-a como "Parceiro" no cadastro de pessoas primeiro.']})]})})]}),j&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ðŸ“… Dia do mÃªs para fechamento de comissÃ£o"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",min:"1",max:"31",value:N,onChange:B=>d(B.target.value),placeholder:"Ex: 5 (paga dia 5 de cada mÃªs)",className:"flex-1 border rounded-lg px-3 py-2"}),e.jsx("button",{onClick:async()=>{try{await F.put(`/clientes/${j}`,{data_fechamento_comissao:N?parseInt(N):null}),alert("âœ… Data de fechamento salva com sucesso!")}catch(B){console.error("Erro ao salvar data:",B),alert("âŒ Erro ao salvar data de fechamento")}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 whitespace-nowrap",children:"ðŸ’¾ Salvar Data"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Deixe em branco para pagamento 30 dias apÃ³s a venda (padrÃ£o)"})]}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Regras de CÃ¡lculo"}),e.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded text-sm",children:[e.jsx("div",{className:"font-semibold text-blue-800 mb-1",children:"ðŸ“‹ Hierarquia de ConfiguraÃ§Ãµes"}),e.jsxs("div",{className:"text-blue-700 text-xs",children:[e.jsx("strong",{children:"Produto"})," (prioridade mÃ¡xima) â†’ ",e.jsx("strong",{children:"Subcategoria"})," â†’ ",e.jsx("strong",{children:"Categoria"})," (prioridade mÃ­nima)",e.jsx("br",{}),e.jsx("span",{className:"text-blue-600",children:"Ao vender um produto, o sistema busca a configuraÃ§Ã£o mais especÃ­fica."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.desconta_taxa_cartao,onChange:B=>{console.log("âœ… Checkbox TAXA CARTÃƒO alterado para:",B.target.checked),k({...x,desconta_taxa_cartao:B.target.checked})},className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Desconta taxa de cartÃ£o"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.desconta_impostos,onChange:B=>{console.log("âœ… Checkbox IMPOSTOS alterado para:",B.target.checked),k({...x,desconta_impostos:B.target.checked})},className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Desconta impostos"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.desconta_taxa_entrega,onChange:B=>{console.log("âœ… Checkbox TAXA ENTREGA alterado para:",B.target.checked),k({...x,desconta_taxa_entrega:B.target.checked})},className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Desconta taxa de entrega"})]}),e.jsx("div",{className:"border-t pt-2 mt-3",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.comissao_venda_parcial,onChange:B=>{console.log("âœ… Checkbox VENDA PARCIAL alterado para:",B.target.checked),k({...x,comissao_venda_parcial:B.target.checked})},className:"rounded"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium",children:"Gerar comissÃ£o em vendas parciais"}),e.jsx("span",{className:"text-xs text-gray-500",children:x.comissao_venda_parcial?"ComissÃ£o gerada proporcionalmente a cada pagamento recebido":"ComissÃ£o gerada somente quando a venda estiver 100% paga"})]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"SeleÃ§Ã£o de Produtos"}),Object.keys(b).length>0&&e.jsxs("div",{className:"mb-4 border rounded-lg p-3 bg-green-50",children:[e.jsxs("h4",{className:"text-sm font-semibold text-green-800 mb-2",children:["âœ… Itens JÃ¡ Configurados (",Object.keys(b).length,")"]}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:Object.entries(b).map(([B,y])=>e.jsxs("div",{className:"w-full flex items-center justify-between text-xs bg-white p-2 rounded hover:bg-gray-50 transition-colors group",children:[e.jsxs("button",{onClick:()=>Q(y.tipo,y.referencia_id,y.nome_item||"Item"),className:"flex-1 flex items-center gap-2 text-left",children:[y.tipo==="categoria"&&"ðŸ“¦",y.tipo==="subcategoria"&&"ðŸ“‚",y.tipo==="produto"&&"ðŸ“Œ",e.jsx("span",{className:"text-gray-700",children:y.nome_item||"Item"}),e.jsx("span",{className:"text-green-600 font-medium ml-auto",children:y.tipo_calculo==="percentual"?`${y.percentual}%`:`Lucro ${y.percentual}%`})]}),e.jsx("button",{onClick:async()=>{if(confirm(`Deseja remover a configuraÃ§Ã£o de "${y.nome_item||"Item"}"?`))try{await F.delete(`/comissoes/configuracoes/${y.id}`),alert("ConfiguraÃ§Ã£o removida com sucesso!");const O={...b};delete O[B],p(O)}catch(O){console.error("Erro ao remover:",O),alert("Erro ao remover configuraÃ§Ã£o")}},className:"ml-2 text-red-600 hover:text-red-800 opacity-0 group-hover:opacity-100 transition-opacity",children:"ðŸ—‘ï¸"})]},B))}),e.jsx("p",{className:"text-xs text-green-700 mt-2 italic",children:"ðŸ’¡ Clique em um item para editar"})]}),m?e.jsx("div",{className:"text-center py-8",children:"Carregando..."}):e.jsx("div",{className:"border rounded-lg max-h-96 overflow-y-auto",children:t.map(B=>G(B,0))},Object.keys(b).length)]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"ConfiguraÃ§Ã£o"}),i?e.jsxs("div",{className:"border rounded-lg p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-700",children:[i.tipo==="categoria"&&"ðŸ“¦ ",i.tipo==="subcategoria"&&"ðŸ“‚ ",i.tipo==="produto"&&"ðŸ“Œ ",i.nome]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Tipo: ",i.tipo]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Tipo de ComissÃ£o"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"percentual",checked:i.tipo_calculo==="percentual",onChange:B=>u({...i,tipo_calculo:B.target.value})}),e.jsx("span",{className:"text-sm",children:"Percentual fixo sobre venda"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"lucro",checked:i.tipo_calculo==="lucro",onChange:B=>u({...i,tipo_calculo:B.target.value})}),e.jsx("span",{className:"text-sm",children:"DivisÃ£o de lucro"})]})]})]}),i.tipo_calculo==="percentual"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentual"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",value:i.percentual,onChange:B=>u({...i,percentual:B.target.value}),className:"border rounded px-3 py-2 w-24"}),e.jsx("span",{children:"%"})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"DivisÃ£o do Lucro"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"FuncionÃ¡rio"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("input",{type:"number",min:"0",max:"100",value:i.percentual,onChange:B=>{const y=parseFloat(B.target.value);u({...i,percentual:y,percentual_loja:100-y})},className:"border rounded px-2 py-1 w-20"}),e.jsx("span",{className:"text-sm",children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Loja"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("input",{type:"number",value:i.percentual_loja,readOnly:!0,className:"border rounded px-2 py-1 w-20 bg-gray-100"}),e.jsx("span",{className:"text-sm",children:"%"})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"CÃ¡lculo: PreÃ§o Venda - Desconto - Taxas - Impostos - Custo = Lucro"})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:i.permite_edicao_venda,onChange:B=>u({...i,permite_edicao_venda:B.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Permite editar percentual na venda"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"ObservaÃ§Ãµes"}),e.jsx("textarea",{value:i.observacoes,onChange:B=>u({...i,observacoes:B.target.value}),className:"border rounded px-3 py-2 w-full",rows:"3"})]}),e.jsx("button",{onClick:re,className:"w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded mb-2",children:"âž• Adicionar Ã  Lista"}),e.jsx("button",{onClick:R,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded",children:"ðŸ’¾ Salvar Agora"})]}):e.jsx("div",{className:"border rounded-lg p-8 text-center text-gray-500",children:e.jsx("p",{children:"Selecione uma categoria, subcategoria ou produto ao lado para configurar"})}),n.length>0&&e.jsxs("div",{className:"mt-6 border rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold mb-3",children:["ConfiguraÃ§Ãµes a Salvar (",n.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:n.map((B,y)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:B.nome}),e.jsxs("span",{className:"text-gray-500 ml-2",children:["(",B.tipo_calculo==="percentual"?`${B.percentual}%`:`Lucro ${B.percentual}%`,")"]})]}),e.jsx("button",{onClick:()=>q(y),className:"text-red-600 hover:text-red-800",children:"âœ•"})]},y))}),e.jsx("button",{onClick:Z,disabled:h,className:`w-full py-2 rounded mt-4 text-white ${h?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:h?e.jsxs("span",{children:["â³ Salvando ",E.atual,"/",E.total,"..."]}):"ðŸ’¾ Salvar Todas as ConfiguraÃ§Ãµes"})]})]})]})]}),e.jsx("div",{className:"p-6 border-t bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["â„¹ï¸ As configuraÃ§Ãµes se aplicam ",e.jsx("strong",{children:"apenas Ã s comissÃµes futuras"}),". ComissÃµes jÃ¡ geradas nÃ£o sÃ£o alteradas."]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 border rounded hover:bg-gray-50 bg-white",children:"Fechar"}),e.jsxs("button",{onClick:R,disabled:!i&&(!K||x.desconta_taxa_cartao===K.desconta_taxa_cartao&&x.desconta_impostos===K.desconta_impostos&&x.desconta_taxa_entrega===K.desconta_taxa_entrega&&x.comissao_venda_parcial===K.comissao_venda_parcial),className:`px-6 py-2 rounded font-medium ${i||K&&(x.desconta_taxa_cartao!==K.desconta_taxa_cartao||x.desconta_impostos!==K.desconta_impostos||x.desconta_taxa_entrega!==K.desconta_taxa_entrega||x.comissao_venda_parcial!==K.comissao_venda_parcial)?"bg-blue-600 hover:bg-blue-700 text-white cursor-pointer":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:["ðŸ’¾ ",i?"Salvar AlteraÃ§Ãµes":"Atualizar Regras"]})]})]})})]})})},wd=({comissaoId:s,onClose:l})=>{var c,b,p,i,u;const[t,m]=a.useState(null),[r,g]=a.useState(!0),[o,v]=a.useState(null);a.useEffect(()=>{s&&j()},[s]),a.useEffect(()=>{const n=C=>{C.key==="Escape"&&l()};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[l]);const j=async()=>{var n,C;try{g(!0),v(null);const h=await F.get(`/comissoes/comissao/${s}`);h.data.success?m(h.data.comissao):v("Erro ao carregar detalhes da comissÃ£o")}catch(h){console.error("Erro ao carregar detalhe:",h),v(((C=(n=h.response)==null?void 0:n.data)==null?void 0:C.detail)||"Erro ao conectar com o servidor")}finally{g(!1)}},f=n=>n?new Date(n).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",N=n=>n==null?"R$ 0,00":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n),d=n=>n==null?"0%":`${n.toFixed(1)}%`,x=n=>{const h={pendente:"bg-yellow-100 text-yellow-800",pago:"bg-green-100 text-green-800",estornado:"bg-red-100 text-red-800"}[n]||"bg-gray-100 text-gray-800";return e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${h}`,children:n.toUpperCase()})},k=({label:n,valor:C,destaque:h=!1})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:n}),e.jsx("div",{className:`text-sm ${h?"text-lg font-bold text-gray-900":"text-gray-900"}`,children:C})]}),w=({titulo:n,children:C,cor:h="blue"})=>{const _={blue:"border-blue-500 bg-blue-50",green:"border-green-500 bg-green-50",purple:"border-purple-500 bg-purple-50",yellow:"border-yellow-500 bg-yellow-50",red:"border-red-500 bg-red-50"};return e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:`border-l-4 ${_[h]} px-4 py-2 mb-3`,children:e.jsx("h3",{className:"font-semibold text-gray-800",children:n})}),e.jsx("div",{className:"px-4",children:C})]})};return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 transition-opacity",onClick:l}),e.jsxs("div",{className:"fixed inset-y-0 right-0 w-full md:w-2/3 lg:w-1/2 bg-white shadow-xl z-50 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Detalhes da ComissÃ£o"}),e.jsxs("p",{className:"text-sm text-blue-100",children:["Snapshot ImutÃ¡vel #",s]})]}),e.jsx("button",{onClick:l,className:"text-white hover:bg-blue-500 rounded-full p-2 transition",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[r&&e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando detalhes..."})]})}),o&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-red-800 font-semibold mb-2",children:"Erro ao carregar"}),e.jsx("p",{className:"text-red-600",children:o}),e.jsx("button",{onClick:j,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition",children:"Tentar Novamente"})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx(w,{titulo:"ðŸ“‹ IdentificaÃ§Ã£o",cor:"blue",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(k,{label:"ID da ComissÃ£o",valor:`#${t.id}`}),e.jsx(k,{label:"Venda",valor:t.numero_venda||`#${t.venda_id}`}),e.jsx(k,{label:"ID do Produto",valor:`#${t.produto_id}`}),e.jsx(k,{label:"ID do FuncionÃ¡rio",valor:`#${t.funcionario_id}`}),e.jsx(k,{label:"Data da Venda",valor:f(t.data_venda)}),e.jsx(k,{label:"NÃºmero da Parcela",valor:t.parcela_numero}),e.jsx(k,{label:"Quantidade",valor:t.quantidade})]})}),e.jsxs(w,{titulo:"ðŸ’° Valores Financeiros (Snapshot)",cor:"green",children:[e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-300 rounded-lg",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Contexto do Pagamento"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-3 rounded border border-blue-200",children:[e.jsx("span",{className:"text-xs text-gray-600 block mb-1",children:"Valor Total da Venda (Produtos)"}),e.jsx("span",{className:"text-lg font-bold text-blue-700",children:N(t.total_venda||0)})]}),e.jsxs("div",{className:"bg-white p-3 rounded border border-green-200",children:[e.jsxs("span",{className:"text-xs text-gray-600 block mb-1",children:["Valor Pago (Parcela ",t.parcela_numero,")"]}),e.jsx("span",{className:"text-lg font-bold text-green-600",children:N(((c=t.pagamento)==null?void 0:c.valor_pago_referencia)||0)}),((b=t.pagamento)==null?void 0:b.forma_pagamento)&&e.jsxs("span",{className:"text-xs text-gray-500 block mt-1",children:["via ",t.pagamento.forma_pagamento]})]})]}),((p=t.pagamento)==null?void 0:p.percentual_pago)<100&&e.jsxs("div",{className:"mt-2 text-xs text-blue-700",children:["â„¹ï¸ ComissÃ£o calculada proporcionalmente (",d(t.pagamento.percentual_pago)," do total)"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(k,{label:"Valor de Venda",valor:N(t.valores_financeiros.valor_venda)}),e.jsx(k,{label:"Valor de Custo",valor:N(t.valores_financeiros.valor_custo)}),e.jsx(k,{label:"Base Original (Lucro)",valor:N(t.valores_financeiros.valor_base_original)}),e.jsx(k,{label:"Base Comissionada",valor:N(t.valores_financeiros.valor_base_comissionada)})]}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Como chegamos na Base de CÃ¡lculo?"]}),e.jsxs("div",{className:"space-y-2 text-sm font-mono bg-white p-4 rounded border border-blue-200",children:[e.jsxs("div",{className:"flex justify-between pb-2 border-b border-gray-200",children:[e.jsxs("span",{className:"text-gray-700 font-semibold",children:["Valor Pago (Parcela ",t.parcela_numero||1,"):"]}),e.jsx("span",{className:"font-bold text-blue-600",children:N(((i=t.pagamento)==null?void 0:i.valor_pago_referencia)||t.valores_financeiros.valor_venda)})]}),t.deducoes&&t.deducoes.receita_taxa_entrega>0&&e.jsxs("div",{className:"flex justify-between text-green-600 pl-4",children:[e.jsx("span",{children:"(+) Taxa de Entrega (Receita):"}),e.jsxs("span",{className:"font-medium",children:["+ ",N(t.deducoes.receita_taxa_entrega)]})]}),t.deducoes&&e.jsxs(e.Fragment,{children:[t.deducoes.taxa_cartao>0&&e.jsxs("div",{className:"flex justify-between text-red-600 pl-4",children:[e.jsxs("span",{children:["(-) ",(()=>{const n=t.deducoes.forma_pagamento||"CartÃ£o",C=t.deducoes.numero_parcelas||1;let h=t.deducoes.taxa_percentual;if(C>1&&t.deducoes.taxas_por_parcela)try{h=JSON.parse(t.deducoes.taxas_por_parcela)[C.toString()]||h}catch{}let _="Taxa ";return n.includes("CrÃ©dito")?C>1?_+=`CartÃ£o CrÃ©dito ${C}x`:_+="CartÃ£o CrÃ©dito Ã  Vista":n.includes("DÃ©bito")?_+="CartÃ£o DÃ©bito":_+=n,h&&(_+=` (${h}%)`),_+":"})()]}),e.jsxs("span",{className:"font-medium",children:["- ",N(t.deducoes.taxa_cartao)]})]}),t.deducoes.imposto>0&&e.jsxs("div",{className:"flex justify-between text-red-600 pl-4",children:[e.jsxs("span",{children:["(-) Impostos (",t.deducoes.percentual_impostos?t.deducoes.percentual_impostos.toFixed(1)+"%":"","):"]}),e.jsxs("span",{className:"font-medium",children:["- ",N(t.deducoes.imposto)]})]}),t.deducoes.taxa_entregador>0&&e.jsxs("div",{className:"flex justify-between text-red-600 pl-4",children:[e.jsx("span",{children:"(-) Taxa paga ao Entregador:"}),e.jsxs("span",{className:"font-medium",children:["- ",N(t.deducoes.taxa_entregador)]})]}),t.deducoes.custo_operacional>0&&e.jsxs("div",{className:"flex justify-between text-red-600 pl-4",children:[e.jsx("span",{children:"(-) Custo Operacional de Entrega:"}),e.jsxs("span",{className:"font-medium",children:["- ",N(t.deducoes.custo_operacional)]})]}),t.deducoes.desconto>0&&e.jsxs("div",{className:"flex justify-between text-red-600 pl-4",children:[e.jsx("span",{children:"(-) Desconto:"}),e.jsxs("span",{className:"font-medium",children:["- ",N(t.deducoes.desconto)]})]})]}),e.jsxs("div",{className:"border-t-2 border-blue-400 pt-2 mt-2 flex justify-between font-bold",children:[e.jsx("span",{className:"text-blue-900",children:"(=) Base de CÃ¡lculo:"}),e.jsx("span",{className:"text-blue-900 text-lg",children:N(t.calculo.valor_base_calculo)})]})]})]})]}),e.jsxs(w,{titulo:"ðŸ§® CÃ¡lculo da ComissÃ£o",cor:"purple",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(k,{label:"Tipo de CÃ¡lculo",valor:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${t.calculo.tipo_calculo==="percentual"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:t.calculo.tipo_calculo.toUpperCase()})}),e.jsx(k,{label:"Percentual da ComissÃ£o",valor:d(t.calculo.percentual_comissao)}),e.jsx(k,{label:"Percentual Aplicado (Pago)",valor:d(t.calculo.percentual_aplicado)}),e.jsx(k,{label:"Valor Base de CÃ¡lculo",valor:N(t.calculo.valor_base_calculo),destaque:!0}),e.jsx(k,{label:"Valor da ComissÃ£o (Total)",valor:N(t.calculo.valor_comissao)}),e.jsx(k,{label:"Valor Efetivamente Gerado",valor:N(t.calculo.valor_comissao_gerada),destaque:!0})]}),e.jsxs("div",{className:"mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-purple-900 mb-3",children:"ðŸ“ FÃ³rmula Aplicada:"}),e.jsxs("div",{className:"space-y-2 text-sm font-mono",children:[e.jsxs("div",{className:"bg-white p-3 rounded border border-purple-200",children:[e.jsx("div",{className:"text-gray-700 mb-2",children:"Base de CÃ¡lculo Ã— Percentual = ComissÃ£o"}),e.jsxs("div",{className:"text-purple-900 font-bold",children:[N(t.calculo.valor_base_calculo)," Ã— ",d(t.calculo.percentual_comissao)," = ",N(t.calculo.valor_comissao)]})]}),t.calculo.percentual_aplicado<100&&e.jsxs("div",{className:"bg-yellow-50 p-3 rounded border border-yellow-200",children:[e.jsx("div",{className:"text-gray-700 mb-2",children:"âš ï¸ Venda parcial - ComissÃ£o proporcional ao valor pago:"}),e.jsxs("div",{className:"text-yellow-900 font-bold",children:[N(t.calculo.valor_comissao)," Ã— ",d(t.calculo.percentual_aplicado)," = ",N(t.calculo.valor_comissao_gerada)]})]})]})]})]}),e.jsxs(w,{titulo:"ðŸ’³ Controle de Pagamento",cor:"yellow",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(k,{label:"Percentual Pago da Venda",valor:d(t.pagamento.percentual_pago)}),e.jsx(k,{label:"Valor Pago de ReferÃªncia",valor:N(t.pagamento.valor_pago_referencia)}),e.jsx(k,{label:"Valor Pago da ComissÃ£o",valor:N(t.pagamento.valor_pago)}),e.jsx(k,{label:"Saldo Restante",valor:N(t.pagamento.saldo_restante)}),t.pagamento.data_pagamento&&e.jsxs(e.Fragment,{children:[e.jsx(k,{label:"Data do Pagamento",valor:f(t.pagamento.data_pagamento)}),e.jsx(k,{label:"Forma de Pagamento",valor:t.pagamento.forma_pagamento||"NÃ£o informado"})]})]}),t.pagamento.percentual_pago<100&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-yellow-800",children:["âš ï¸ Esta comissÃ£o foi gerada proporcionalmente ao pagamento parcial da venda. Apenas ",d(t.pagamento.percentual_pago)," do valor total foi pago."]})})]}),e.jsxs(w,{titulo:"ðŸ“Š Status e Controle",cor:t.status.status==="estornado"?"red":"blue",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-2",children:"Status Atual"}),x(t.status.status)]}),t.status.status==="estornado"&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-red-800 mb-2",children:"InformaÃ§Ãµes do Estorno"}),e.jsx(k,{label:"Data do Estorno",valor:f(t.status.data_estorno)}),e.jsx(k,{label:"Motivo do Estorno",valor:t.status.motivo_estorno||"NÃ£o informado"})]}),t.status.observacao_pagamento&&e.jsxs("div",{className:"mt-4 bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"ObservaÃ§Ãµes"}),e.jsx("p",{className:"text-sm text-gray-600",children:t.status.observacao_pagamento})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-6 text-white shadow-lg",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center",children:[e.jsx("svg",{className:"w-6 h-6 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Resumo do CÃ¡lculo Completo"]}),e.jsxs("div",{className:"space-y-3 font-mono text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-white/20 pb-2",children:[e.jsxs("span",{className:"text-blue-100",children:["Valor Pago (Parcela ",t.parcela_numero||1,"):"]}),e.jsx("span",{className:"font-bold text-lg",children:N(((u=t.pagamento)==null?void 0:u.valor_pago_referencia)||t.valores_financeiros.valor_venda)})]}),t.deducoes&&e.jsxs(e.Fragment,{children:[t.deducoes.taxa_cartao>0&&e.jsxs("div",{className:"flex justify-between items-center pl-4 text-red-200",children:[e.jsxs("span",{children:["(-) ",(()=>{const n=t.deducoes.forma_pagamento||"CartÃ£o",C=t.deducoes.numero_parcelas||1;let h=t.deducoes.taxa_percentual;if(C>1&&t.deducoes.taxas_por_parcela)try{h=JSON.parse(t.deducoes.taxas_por_parcela)[C.toString()]||h}catch{}let _="Taxa ";return n.includes("CrÃ©dito")?C>1?_+=`CartÃ£o CrÃ©dito ${C}x`:_+="CartÃ£o CrÃ©dito Ã  Vista":n.includes("DÃ©bito")?_+="CartÃ£o DÃ©bito":_+=n,h&&(_+=` (${h}%)`),_+":"})()]}),e.jsxs("span",{className:"font-medium",children:["- ",N(t.deducoes.taxa_cartao)]})]}),t.deducoes.imposto>0&&e.jsxs("div",{className:"flex justify-between items-center pl-4 text-red-200",children:[e.jsx("span",{children:"(-) Impostos:"}),e.jsxs("span",{className:"font-medium",children:["- ",N(t.deducoes.imposto)]})]}),t.deducoes.custo_entrega>0&&e.jsxs("div",{className:"flex justify-between items-center pl-4 text-red-200",children:[e.jsx("span",{children:"(-) Custo de Entrega:"}),e.jsxs("span",{className:"font-medium",children:["- ",N(t.deducoes.custo_entrega)]})]}),t.deducoes.desconto>0&&e.jsxs("div",{className:"flex justify-between items-center pl-4 text-red-200",children:[e.jsx("span",{children:"(-) Desconto:"}),e.jsxs("span",{className:"font-medium",children:["- ",N(t.deducoes.desconto)]})]})]}),e.jsxs("div",{className:"flex justify-between items-center border-t-2 border-white/40 pt-2",children:[e.jsx("span",{className:"text-blue-100 font-semibold",children:"(=) Base de CÃ¡lculo:"}),e.jsx("span",{className:"font-bold text-lg",children:N(t.calculo.valor_base_calculo)})]}),e.jsxs("div",{className:"flex justify-between items-center border-b border-white/20 pb-2",children:[e.jsx("span",{className:"text-blue-100",children:"(Ã—) Percentual:"}),e.jsx("span",{className:"font-bold text-lg",children:d(t.calculo.percentual_comissao)})]}),e.jsxs("div",{className:"flex justify-between items-center bg-white/10 rounded-lg p-3 border-2 border-yellow-300",children:[e.jsx("span",{className:"text-xl font-bold",children:"ComissÃ£o Gerada:"}),e.jsx("span",{className:"font-bold text-3xl text-yellow-300",children:N(t.calculo.valor_comissao_gerada)})]})]})]})]})]}),t&&e.jsx("div",{className:"bg-blue-50 border-t border-blue-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-500 mt-0.5 mr-3 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-blue-800 mb-1",children:"Snapshot Financeiro ImutÃ¡vel"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Este Ã© um snapshot financeiro imutÃ¡vel. Os valores refletem exatamente o momento da venda e nÃ£o podem ser alterados. Qualquer discrepÃ¢ncia deve ser tratada atravÃ©s de ajustes ou estornos, nunca por ediÃ§Ã£o direta."})]})]})})]})]}):null},Cd=()=>{const s=fa(),[l,t]=a.useState([]),[m,r]=a.useState(!0),[g,o]=a.useState(null),[v,j]=a.useState(null),[f,N]=a.useState(!0),[d,x]=a.useState(null),[k,w]=a.useState(null),[c,b]=a.useState({funcionario_id:"",status:"",data_inicio:"",data_fim:"",venda_id:"",produto_id:"",grupo_id:""}),[p,i]=a.useState("ate_hoje"),[u,n]=a.useState([]),[C,h]=a.useState([]),[_,E]=a.useState(null),[$,K]=a.useState(null),[te,M]=a.useState(""),[A,Q]=a.useState(""),[re,q]=a.useState(!1),[Z,R]=a.useState(!1),[J,S]=a.useState([]),[P,G]=a.useState(null),[B,y]=a.useState(!1),[O,z]=a.useState(""),[ae,W]=a.useState(!1),[ne,H]=a.useState([]),[ee,de]=a.useState(!1),[ue,Re]=a.useState(""),[se,_e]=a.useState(""),[ke,Ze]=a.useState(!1),[ze,Xe]=a.useState("sem_pagar"),[be,Ee]=a.useState(""),[he,Qe]=a.useState(""),[Ye,ca]=a.useState(0),[ra,pa]=a.useState([]),[na,oe]=a.useState([]),ye=1;a.useEffect(()=>{console.log("[ComissoesListagem] Iniciando carregamento..."),(async()=>{try{await Ce(),await Be(),await Ie(),await Y(),await je(),await Me(),await I()}catch(qe){console.error("[ComissoesListagem] Erro no carregamento inicial:",qe)}})();const Ae=new Date().toISOString().split("T")[0];b(qe=>({...qe,data_fim:Ae}))},[]),a.useEffect(()=>{const xe=Ae=>{ae&&!Ae.target.closest(".autocomplete-container")&&W(!1)};return document.addEventListener("mousedown",xe),()=>{document.removeEventListener("mousedown",xe)}},[ae]);const Ce=async()=>{var xe,Ae;console.log("[carregarComissoes] Iniciando...");try{r(!0),o(null);const qe=new URLSearchParams;c.funcionario_id&&qe.append("funcionario_id",c.funcionario_id),c.status&&qe.append("status",c.status),c.data_inicio&&qe.append("data_inicio",c.data_inicio),c.data_fim&&qe.append("data_fim",c.data_fim),c.venda_id&&qe.append("venda_id",c.venda_id);const sa=qe.toString(),qa=sa?`/comissoes?${sa}`:"/comissoes",ja=await F.get(qa);ja.data.success?t(ja.data.lista):o("Erro ao carregar comissÃµes")}catch(qe){console.error("Erro ao carregar comissÃµes:",qe),o(((Ae=(xe=qe.response)==null?void 0:xe.data)==null?void 0:Ae.detail)||"Erro ao conectar com o servidor")}finally{r(!1),console.log("[carregarComissoes] Finalizado")}},Be=async()=>{var xe,Ae;try{N(!0),x(null);const qe=await F.get(`/comissoes/resumo?funcionario_id=${ye}`);qe.data.success?j(qe.data.resumo):x("Erro ao carregar resumo")}catch(qe){console.error("Erro ao carregar resumo:",qe),x(((Ae=(xe=qe.response)==null?void 0:xe.data)==null?void 0:Ae.detail)||"Erro ao carregar resumo")}finally{N(!1)}},Ie=async()=>{try{y(!0);const xe=await F.get("/comissoes/funcionarios");if(xe.data.success){const Ae=Array.isArray(xe.data.lista)?xe.data.lista:Array.isArray(xe.data.data)?xe.data.data:[];S(Ae)}}catch(xe){console.error("Erro ao carregar funcionÃ¡rios:",xe),S([])}finally{y(!1)}},Y=async()=>{try{const xe=await F.get("/produtos/");xe.data&&n(Array.isArray(xe.data)?xe.data:[])}catch(xe){console.error("Erro ao carregar produtos:",xe),n([])}},je=async()=>{try{const xe=await F.get("/categorias-financeiras");xe.data&&h(Array.isArray(xe.data)?xe.data:[])}catch(xe){console.error("Erro ao carregar grupos:",xe),h([])}},Me=async()=>{console.log("[carregarFormasPagamento] Iniciando...");try{const xe=await F.get("/comissoes/formas-pagamento");xe.data&&pa(Array.isArray(xe.data)?xe.data:[])}catch(xe){console.error("[carregarFormasPagamento] Erro:",xe)}finally{console.log("[carregarFormasPagamento] Finalizado")}},I=async()=>{try{const xe=await F.get("/contas-bancarias");xe.data&&oe(Array.isArray(xe.data)?xe.data.filter(Ae=>Ae.ativa):[])}catch(xe){console.error("Erro ao carregar contas bancÃ¡rias:",xe)}},X=()=>l.filter(Ae=>Ae.status==="pendente").reduce((Ae,qe)=>Ae+(qe.valor_comissao_gerada||0),0),fe=()=>l.filter(Ae=>ne.includes(Ae.id)).reduce((Ae,qe)=>Ae+(qe.valor_comissao_gerada||0),0),U=xe=>xe?new Date(xe).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",ie=xe=>xe==null?"R$ 0,00":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(xe),Ne=xe=>xe==null?"0%":`${xe.toFixed(1)}%`,Pe=xe=>{const qe={pendente:"bg-yellow-100 text-yellow-800",pago:"bg-green-100 text-green-800",estornado:"bg-red-100 text-red-800"}[xe]||"bg-gray-100 text-gray-800";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${qe}`,children:xe.toUpperCase()})},L=xe=>{const qe={percentual:"bg-blue-100 text-blue-800",lucro:"bg-purple-100 text-purple-800"}[xe]||"bg-gray-100 text-gray-800";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${qe}`,children:xe.toUpperCase()})},le=()=>{if(f)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[1,2,3,4].map(Ae=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24 mb-3"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-32"})]},Ae))});if(d)return e.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"âš ï¸ NÃ£o foi possÃ­vel carregar o resumo financeiro"})});if(!v)return null;const xe=[{titulo:"Total Gerado",valor:v.total_gerado,cor:"blue",bgColor:"bg-blue-50",borderColor:"border-blue-200",textColor:"text-blue-600"},{titulo:"Total Pago",valor:v.total_pago,cor:"green",bgColor:"bg-green-50",borderColor:"border-green-200",textColor:"text-green-600"},{titulo:"Total Pendente",valor:v.total_pendente,cor:"yellow",bgColor:"bg-yellow-50",borderColor:"border-yellow-200",textColor:"text-yellow-600"},{titulo:"Saldo a Pagar",valor:v.saldo_a_pagar,cor:"purple",bgColor:"bg-purple-50",borderColor:"border-purple-200",textColor:"text-purple-600"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:xe.map((Ae,qe)=>e.jsxs("div",{className:`${Ae.bgColor} border ${Ae.borderColor} rounded-lg shadow-sm p-6 transition hover:shadow-md`,children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:Ae.titulo}),e.jsx("p",{className:`text-2xl font-bold ${Ae.textColor}`,children:ie(Ae.valor)})]},qe))})},pe=xe=>{w(xe)},Fe=()=>{w(null)},Oe=(xe,Ae)=>{b(qe=>({...qe,[xe]:Ae}))},Ke=()=>{Ce()},He=()=>{b({funcionario_id:"",status:"",data_inicio:"",data_fim:"",venda_id:"",produto_id:"",grupo_id:""}),G(null),E(null),K(null),z(""),M(""),Q(""),i("ate_hoje");const Ae=new Date().toISOString().split("T")[0];setTimeout(()=>{(async()=>{try{r(!0);const sa=await F.get(`/comissoes?data_fim=${Ae}`);sa.data.success&&t(sa.data.lista)}catch(sa){console.error("Erro:",sa)}finally{r(!1)}})()},100)},ea=xe=>{E(xe),M(xe.nome),q(!1),b(Ae=>({...Ae,produto_id:xe.id}))},oa=xe=>{K(xe),Q(xe.nome),R(!1),b(Ae=>({...Ae,grupo_id:xe.id}))},ia=xe=>{G(xe),z(xe.nome),W(!1),b(Ae=>({...Ae,funcionario_id:xe.id}))},Ue=(J||[]).filter(xe=>{var Ae;return(Ae=xe==null?void 0:xe.nome)==null?void 0:Ae.toLowerCase().includes(O.toLowerCase())}),wa=(xe,Ae)=>{Ae==="pendente"&&H(qe=>qe.includes(xe)?qe.filter(sa=>sa!==xe):[...qe,xe])},V=()=>{const xe=l.filter(Ae=>Ae.status==="pendente");ne.length===xe.length?H([]):H(xe.map(Ae=>Ae.id))},$e=()=>{const xe=new Date().toISOString().split("T")[0];Re(xe),_e(""),Xe("sem_pagar"),Ee(""),Qe("");const Ae=fe();ca(Ae),de(!0)},Te=()=>{de(!1),Re(""),_e("")},We=async()=>{var xe,Ae;if(!ue){alert("Por favor, informe a data de pagamento");return}if(ze==="com_pagamento"&&!he){alert("Por favor, selecione a conta bancÃ¡ria para o pagamento");return}try{Ze(!0);let qe;if(ze==="sem_pagar")qe=await F.post("/comissoes/fechar",{comissoes_ids:ne,data_pagamento:ue,observacao:se||null});else{const sa=new URLSearchParams({valor_pago:Ye.toString(),forma_pagamento:be||"nao_informado",data_pagamento:ue});he&&sa.append("conta_bancaria_id",he),se&&sa.append("observacoes",se),ne.forEach(qa=>{sa.append("comissoes_ids",qa)}),qe=await F.post(`/comissoes/fechar-com-pagamento?${sa.toString()}`)}if(qe.data.success){const sa=ze==="sem_pagar"?qe.data.valor_total_fechamento:qe.data.valor_total_pago;alert(`âœ… ${qe.data.total_processadas} comissÃ£o(Ãµes) fechada(s) com sucesso!

Valor total: ${ie(sa)}
Modo: ${ze==="sem_pagar"?"Sem pagamento (para pagar depois)":"Com pagamento no ato"}`),await Ce(),await Be(),H([]),Te()}}catch(qe){console.error("Erro ao fechar comissÃµes:",qe),alert("âŒ Erro ao fechar comissÃµes: "+(((Ae=(xe=qe.response)==null?void 0:xe.data)==null?void 0:Ae.detail)||qe.message))}finally{Ze(!1)}},ua=()=>{const xe=(u||[]).filter(qe=>{var sa;return(sa=qe==null?void 0:qe.nome)==null?void 0:sa.toLowerCase().includes(te.toLowerCase())}),Ae=(C||[]).filter(qe=>{var sa;return(sa=qe==null?void 0:qe.nome)==null?void 0:sa.toLowerCase().includes(A.toLowerCase())});return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Filtros"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[l.length," registro",l.length!==1?"s":""," encontrado",l.length!==1?"s":""]})]}),e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"ðŸ“… PerÃ­odo"}),e.jsxs("div",{className:"flex gap-4 mb-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"ate_hoje",checked:p==="ate_hoje",onChange:qe=>{i(qe.target.value);const sa=new Date().toISOString().split("T")[0];b(qa=>({...qa,data_inicio:"",data_fim:sa}))},className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"AtÃ© hoje"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"personalizado",checked:p==="personalizado",onChange:qe=>i(qe.target.value),className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"PerÃ­odo personalizado"})]})]}),p==="personalizado"&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:c.data_inicio,onChange:qe=>Oe("data_inicio",qe.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:c.data_fim,onChange:qe=>Oe("data_fim",qe.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"relative autocomplete-container",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"FuncionÃ¡rio"}),e.jsx("input",{type:"text",value:O,onChange:qe=>{z(qe.target.value),W(!0),qe.target.value===""&&(G(null),b(sa=>({...sa,funcionario_id:""})))},onFocus:()=>W(!0),disabled:B,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",placeholder:B?"Carregando...":"Digite o nome"}),ae&&O&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-auto",children:Ue.length>0?Ue.map(qe=>e.jsxs("div",{onClick:()=>ia(qe),className:"px-3 py-2 hover:bg-blue-50 cursor-pointer transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900",children:qe.nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",qe.id]})]},qe.id)):e.jsx("div",{className:"px-3 py-2 text-gray-500 text-sm",children:"Nenhum funcionÃ¡rio encontrado"})})]}),e.jsxs("div",{className:"relative autocomplete-container",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Produto"}),e.jsx("input",{type:"text",value:te,onChange:qe=>{M(qe.target.value),q(!0),qe.target.value===""&&(E(null),b(sa=>({...sa,produto_id:""})))},onFocus:()=>q(!0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Digite o nome do produto"}),re&&te&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-auto",children:xe.length>0?xe.map(qe=>e.jsxs("div",{onClick:()=>ea(qe),className:"px-3 py-2 hover:bg-blue-50 cursor-pointer transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900",children:qe.nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",qe.id]})]},qe.id)):e.jsx("div",{className:"px-3 py-2 text-gray-500 text-sm",children:"Nenhum produto encontrado"})})]}),e.jsxs("div",{className:"relative autocomplete-container",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Grupo/Categoria"}),e.jsx("input",{type:"text",value:A,onChange:qe=>{Q(qe.target.value),R(!0),qe.target.value===""&&(K(null),b(sa=>({...sa,grupo_id:""})))},onFocus:()=>R(!0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Digite o nome do grupo"}),Z&&A&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-auto",children:Ae.length>0?Ae.map(qe=>e.jsxs("div",{onClick:()=>oa(qe),className:"px-3 py-2 hover:bg-blue-50 cursor-pointer transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900",children:qe.nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",qe.id]})]},qe.id)):e.jsx("div",{className:"px-3 py-2 text-gray-500 text-sm",children:"Nenhum grupo encontrado"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:c.status,onChange:qe=>Oe("status",qe.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"pendente",children:"Pendente"}),e.jsx("option",{value:"pago",children:"Pago"}),e.jsx("option",{value:"estornado",children:"Estornado"})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:Ke,disabled:m,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"Filtrar"]}),e.jsxs("button",{onClick:He,disabled:m,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition disabled:opacity-50 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Limpar Filtros"]})]})]})};return m?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando comissÃµes..."})]})}):g?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-red-800 font-semibold mb-2",children:"Erro ao carregar comissÃµes"}),e.jsx("p",{className:"text-red-600",children:g}),e.jsx("button",{onClick:Ce,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition",children:"Tentar Novamente"})]})}):l.length===0?e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Demonstrativo de ComissÃµes"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-blue-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Nenhuma comissÃ£o encontrada"}),e.jsx("p",{className:"text-gray-600",children:"Ainda nÃ£o hÃ¡ registros de comissÃµes no sistema."})]})]}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Demonstrativo de ComissÃµes"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Total de registros: ",l.length]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>s("/comissoes/relatorios"),className:"inline-flex items-center px-4 py-2 border border-purple-300 rounded-md shadow-sm text-sm font-medium text-purple-700 bg-purple-50 hover:bg-purple-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:[e.jsx("svg",{className:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),"ðŸ“Š RelatÃ³rios"]}),e.jsxs("button",{onClick:()=>s("/comissoes/fechamentos"),className:"inline-flex items-center px-4 py-2 border border-purple-300 rounded-md shadow-sm text-sm font-medium text-purple-700 bg-purple-50 hover:bg-purple-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:[e.jsx("svg",{className:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Ver HistÃ³rico"]})]})]}),le(),ua(),ne.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-blue-800 font-medium",children:[ne.length," comissÃ£o(Ãµes) selecionada(s)"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>H([]),className:"px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Limpar SeleÃ§Ã£o"}),e.jsxs("button",{onClick:$e,disabled:ke,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:opacity-50 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Fechar ComissÃµes"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:ne.length>0&&ne.length===l.filter(xe=>xe.status==="pendente").length,onChange:V,disabled:l.filter(xe=>xe.status==="pendente").length===0,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer",title:"Selecionar todas pendentes"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data da Venda"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"NÃºmero da Venda"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Parcela"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo de CÃ¡lculo"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Base de CÃ¡lculo"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"% ComissÃ£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor ComissÃ£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(xe=>e.jsxs("tr",{className:"hover:bg-blue-50 transition",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",onClick:Ae=>Ae.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:ne.includes(xe.id),onChange:()=>wa(xe.id,xe.status),disabled:xe.status!=="pendente",className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer disabled:opacity-30 disabled:cursor-not-allowed",title:xe.status!=="pendente"?`ComissÃ£o ${xe.status}`:"Selecionar para fechamento"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 cursor-pointer",onClick:()=>pe(xe.id),children:U(xe.data_venda)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-blue-600 font-medium cursor-pointer",onClick:()=>pe(xe.id),title:`ID interno: #${xe.venda_id}`,children:xe.numero_venda||`#${xe.venda_id}`}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 cursor-pointer",onClick:()=>pe(xe.id),children:["#",xe.produto_id]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 cursor-pointer",onClick:()=>pe(xe.id),children:xe.parcela_numero}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm cursor-pointer",onClick:()=>pe(xe.id),children:L(xe.tipo_calculo)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium cursor-pointer",onClick:()=>pe(xe.id),children:ie(xe.valor_base_calculo)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right cursor-pointer",onClick:()=>pe(xe.id),children:Ne(xe.percentual_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-bold cursor-pointer",onClick:()=>pe(xe.id),children:ie(xe.valor_comissao_gerada)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm cursor-pointer",onClick:()=>pe(xe.id),children:Pe(xe.status)})]},xe.id))})]})})}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"â„¹ï¸ InformaÃ§Ã£o:"})," Os valores exibidos sÃ£o snapshots imutÃ¡veis do momento da venda. Eles nÃ£o sÃ£o recalculados e refletem exatamente como a comissÃ£o foi gerada.",e.jsx("span",{className:"ml-2 text-blue-600 font-medium",children:"Clique em qualquer linha para ver mais detalhes."})]})}),l.length>0&&e.jsx("div",{className:"fixed bottom-0 left-64 right-0 bg-gradient-to-r from-indigo-600 via-blue-600 to-indigo-600 text-white shadow-lg z-40 border-t border-indigo-300/30",children:e.jsx("div",{className:"max-w-7xl mx-auto px-8 py-3.5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-semibold text-indigo-200 mb-0.5 tracking-wide uppercase",children:"ðŸ“… PerÃ­odo"}),e.jsx("div",{className:"text-sm font-bold text-white",children:p==="ate_hoje"?"AtÃ© hoje":e.jsxs(e.Fragment,{children:[c.data_inicio?new Date(c.data_inicio).toLocaleDateString("pt-BR"):"InÃ­cio"," â†’ ",c.data_fim?new Date(c.data_fim).toLocaleDateString("pt-BR"):"Fim"]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-semibold text-indigo-200 mb-0.5 tracking-wide uppercase",children:"ðŸ” Filtros"}),e.jsxs("div",{className:"text-sm font-bold text-white",children:[P&&e.jsxs("span",{className:"mr-2 bg-white/10 px-2 py-0.5 rounded",children:["ðŸ‘¤ ",P.nome]}),_&&e.jsxs("span",{className:"mr-2 bg-white/10 px-2 py-0.5 rounded",children:["ðŸ“¦ ",_.nome]}),$&&e.jsxs("span",{className:"mr-2 bg-white/10 px-2 py-0.5 rounded",children:["ðŸ“‚ ",$.nome]}),c.status&&e.jsxs("span",{className:"mr-2 bg-white/10 px-2 py-0.5 rounded",children:["âš¡ ",c.status]}),!P&&!_&&!$&&!c.status&&e.jsx("span",{className:"text-indigo-200",children:"Sem filtros"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-[10px] font-semibold text-indigo-200 mb-0.5 tracking-wide uppercase",children:"ðŸ’° Total Pendente (Filtrado)"}),e.jsx("div",{className:"text-3xl font-bold text-white drop-shadow-sm",children:ie(X())}),e.jsxs("div",{className:"text-[11px] text-indigo-100 mt-0.5 font-medium",children:[l.filter(xe=>xe.status==="pendente").length," comissÃ£o(Ãµes) pendente(s)"]})]})]})})}),l.length>0&&e.jsx("div",{className:"h-24"}),k&&e.jsx(wd,{comissaoId:k,onClose:Fe}),ee&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Fechar ComissÃµes Selecionadas"}),e.jsx("button",{onClick:Te,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700 font-medium",children:[ne.length," comissÃ£o(Ãµes) selecionada(s)"]})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Valor Total"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:ie(fe())})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-3",children:"âš™ï¸ Tipo de Fechamento"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("button",{type:"button",onClick:()=>Xe("sem_pagar"),className:`p-4 border-2 rounded-lg transition-all ${ze==="sem_pagar"?"border-blue-500 bg-blue-50 shadow-md":"border-gray-300 hover:border-blue-300"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“‹"}),e.jsx("div",{className:"font-bold text-gray-800",children:"Fechar sem Pagar"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Apenas registrar fechamento"})]})}),e.jsx("button",{type:"button",onClick:()=>Xe("com_pagamento"),className:`p-4 border-2 rounded-lg transition-all ${ze==="com_pagamento"?"border-green-500 bg-green-50 shadow-md":"border-gray-300 hover:border-green-300"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ’°"}),e.jsx("div",{className:"font-bold text-gray-800",children:"Fechar e Pagar"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Com lanÃ§amento financeiro"})]})})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ðŸ“… Data do Fechamento/Pagamento ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:ue,onChange:xe=>Re(xe.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),ze==="com_pagamento"&&e.jsxs("div",{className:"space-y-4 mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-bold text-green-800 mb-3",children:"ðŸ’³ Dados do Pagamento"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ðŸ’µ Valor a Pagar (editÃ¡vel)"}),e.jsx("input",{type:"number",step:"0.01",value:Ye,onChange:xe=>ca(parseFloat(xe.target.value)),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Valor original: ",ie(fe())]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ðŸ’³ Forma de Pagamento ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:be,onChange:xe=>Ee(xe.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),formasPagamento.map(xe=>e.jsx("option",{value:xe.id,children:xe.nome},xe.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ðŸ¦ Conta BancÃ¡ria ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:he,onChange:xe=>Qe(xe.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),na.map(xe=>e.jsxs("option",{value:xe.id,children:[xe.nome," (",xe.banco,") - Saldo: ",ie(xe.saldo||0)]},xe.id))]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ðŸ“ ObservaÃ§Ãµes"}),e.jsx("textarea",{value:se,onChange:xe=>_e(xe.target.value),rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"ObservaÃ§Ãµes sobre o fechamento..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:Te,disabled:ke,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:We,disabled:ke||!ue||ze==="com_pagamento"&&(!be||!he),className:`flex-1 px-4 py-2 rounded-lg transition disabled:opacity-50 flex items-center justify-center gap-2 ${ze==="com_pagamento"?"bg-green-600 hover:bg-green-700":"bg-blue-600 hover:bg-blue-700"} text-white`,children:ke?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),ze==="com_pagamento"?"ðŸ’° Fechar e Pagar":"ðŸ“‹ Fechar sem Pagar"]})})]})]})})]})},kd=()=>{const s=fa(),[l,t]=a.useState([]),[m,r]=a.useState(!0),[g,o]=a.useState(null);a.useEffect(()=>{v()},[]);const v=async()=>{var d,x;try{r(!0),o(null);const k=await F.get("/comissoes/abertas");k.data.success?t(k.data.funcionarios||[]):o("Erro ao carregar comissÃµes em aberto")}catch(k){console.error("Erro ao carregar comissÃµes abertas:",k),o(((x=(d=k.response)==null?void 0:d.data)==null?void 0:x.detail)||"Erro ao carregar comissÃµes em aberto")}finally{r(!1)}},j=d=>{s(`/comissoes/fechamento/${d}`)},f=d=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(d),N=d=>d?new Date(d+"T00:00:00").toLocaleDateString("pt-BR"):"-";return m?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"bg-white shadow-md rounded-lg p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando comissÃµes em aberto..."})]})})}):g?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-6 w-6 text-red-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-medium",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:g})]})]}),e.jsx("button",{onClick:v,className:"mt-4 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-md transition-colors",children:"Tentar Novamente"})]})}):l.length===0?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-6",children:"ComissÃµes em Aberto"}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"h-16 w-16 text-green-500 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-xl font-semibold text-green-800 mb-2",children:"Nenhuma comissÃ£o pendente"}),e.jsx("p",{className:"text-green-600",children:"NÃ£o hÃ¡ funcionÃ¡rios com comissÃµes em aberto no momento."})]})]})}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"ComissÃµes em Aberto"}),e.jsx("p",{className:"text-gray-600",children:"FuncionÃ¡rios com comissÃµes pendentes de pagamento"})]}),e.jsxs("button",{onClick:()=>s("/comissoes/fechamentos"),className:"inline-flex items-center px-4 py-2 border border-purple-300 rounded-md shadow-sm text-sm font-medium text-purple-700 bg-purple-50 hover:bg-purple-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:[e.jsx("svg",{className:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Ver HistÃ³rico"]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total de FuncionÃ¡rios"}),e.jsx("p",{className:"text-2xl font-bold text-blue-800",children:l.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Pendente"}),e.jsx("p",{className:"text-2xl font-bold text-blue-800",children:f(l.reduce((d,x)=>d+x.total_pendente,0))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total de ComissÃµes"}),e.jsx("p",{className:"text-2xl font-bold text-blue-800",children:l.reduce((d,x)=>d+x.quantidade_comissoes,0)})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"FuncionÃ¡rio"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Pendente"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qtde de ComissÃµes"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ãšltima Venda"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ã£o"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(d=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold text-sm",children:d.nome_funcionario.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:d.nome_funcionario}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",d.funcionario_id]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-semibold text-green-600",children:f(d.total_pendente)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:d.quantidade_comissoes})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500",children:N(d.data_ultima_venda)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsxs("button",{onClick:()=>j(d.funcionario_id),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",children:[e.jsx("svg",{className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Conferir"]})})]},d.funcionario_id))})]})}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsx("p",{className:"text-sm text-gray-500 text-center",children:'Clique em "Conferir" para visualizar os detalhes das comissÃµes de cada funcionÃ¡rio'})})]})})},Sd=()=>{const{funcionario_id:s}=Bs(),l=fa(),[t,m]=a.useState(!0),[r,g]=a.useState(null),[o,v]=a.useState(null),[j,f]=a.useState([]),[N,d]=a.useState(null),[x,k]=a.useState(null),[w,c]=a.useState([]),[b,p]=a.useState([]),[i,u]=a.useState([]),[n,C]=a.useState(""),[h,_]=a.useState(""),[E,$]=a.useState(""),[K,te]=a.useState(""),[M,A]=a.useState(!1),[Q,re]=a.useState(new Set),[q,Z]=a.useState(""),[R,J]=a.useState("nao_informado"),[S,P]=a.useState(new Date().toISOString().split("T")[0]),[G,B]=a.useState(""),[y,O]=a.useState(!1),[z,ae]=a.useState(null);a.useEffect(()=>{W()},[s]);const W=async()=>{var ke,Ze;try{m(!0),g(null);const ze=await F.get(`/comissoes/conferencia-avancada/${s}`);ze.data.success&&(v(ze.data.funcionario),f(ze.data.comissoes),d(ze.data.resumo),k(ze.data.periodo_selecionado));const Xe=await F.get("/comissoes/formas-pagamento");Xe.data.success&&u(Xe.data.formas);const be=await F.get("/produtos/categorias");be.data.data&&c(be.data.data)}catch(ze){g(((Ze=(ke=ze.response)==null?void 0:ke.data)==null?void 0:Ze.detail)||"Erro ao carregar dados"),console.error("Erro:",ze)}finally{m(!1)}},ne=async()=>{var ke,Ze;try{m(!0);const ze={grupo_produto:n?parseInt(n):void 0,produto_id:h?parseInt(h):void 0,data_inicio:E||void 0,data_fim:K||void 0},Xe=await F.get(`/comissoes/conferencia-avancada/${s}`,{params:Object.fromEntries(Object.entries(ze).filter(([be,Ee])=>Ee!==void 0))});Xe.data.success&&(f(Xe.data.comissoes),d(Xe.data.resumo),k(Xe.data.periodo_selecionado))}catch(ze){g(((Ze=(ke=ze.response)==null?void 0:ke.data)==null?void 0:Ze.detail)||"Erro ao aplicar filtros")}finally{m(!1)}},H=()=>{C(""),_(""),$(""),te(""),setTimeout(()=>W(),100)},ee=ke=>{const Ze=new Set(Q);Ze.has(ke)?Ze.delete(ke):Ze.add(ke),re(Ze)},de=()=>{Q.size===j.length?re(new Set):re(new Set(j.map(ke=>ke.id)))},ue=()=>{if(Q.size===0){alert("Selecione pelo menos uma comissÃ£o");return}P(new Date().toISOString().split("T")[0]),Z(""),J("nao_informado"),B(""),ae(null),A(!0)},Re=async()=>{var ke,Ze;try{if(!q||parseFloat(q)<=0){ae("Valor a pagar deve ser maior que zero");return}O(!0),ae(null);const ze={comissoes_ids:Array.from(Q),valor_pago:parseFloat(q),forma_pagamento:R,data_pagamento:S,observacoes:G||null},Xe=await F.post("/comissoes/fechar-com-pagamento",ze);Xe.data.success&&(alert(`âœ… Fechamento realizado com sucesso!

Processadas: ${Xe.data.total_processadas}
Valor total: R$ ${Xe.data.valor_total_fechado.toFixed(2)}
Valor pago: R$ ${Xe.data.valor_total_pago.toFixed(2)}
Saldo restante: R$ ${Xe.data.saldo_total_restante.toFixed(2)}
ComissÃµes com saldo: ${Xe.data.comissoes_com_saldo}`),A(!1),re(new Set),W())}catch(ze){ae(((Ze=(ke=ze.response)==null?void 0:ke.data)==null?void 0:Ze.detail)||"Erro ao fechar comissÃµes")}finally{O(!1)}};if(t)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})});const se=Array.from(Q).reduce((ke,Ze)=>{const ze=j.find(Xe=>Xe.id===Ze);return ke+(ze?ze.valor_comissao:0)},0),_e=se-(parseFloat(q)||0);return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"ConferÃªncia de ComissÃµes"}),e.jsx("p",{className:"text-gray-600 mt-1",children:o?`${o.nome} (ID: ${o.id})`:"Carregando..."})]}),e.jsx("button",{onClick:()=>l("/comissoes/abertas"),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"â† Voltar"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Filtros AvanÃ§ados"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Grupo de Produto"}),e.jsxs("select",{value:n,onChange:ke=>C(ke.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"",children:"Todos"}),w.map(ke=>e.jsx("option",{value:ke.id,children:ke.nome},ke.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Produto"}),e.jsx("input",{type:"text",placeholder:"Buscar produto...",value:h,onChange:ke=>_(ke.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:E,onChange:ke=>$(ke.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Fim"}),e.jsx("input",{type:"date",value:K,onChange:ke=>te(ke.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:ne,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Aplicar Filtros"}),e.jsx("button",{onClick:H,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Limpar"})]})]}),x&&N&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 mb-6 border border-blue-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"PerÃ­odo Selecionado"}),e.jsx("p",{className:"text-gray-600",children:x.data_inicio&&x.data_fim?`${new Date(x.data_inicio).toLocaleDateString("pt-BR")} atÃ© ${new Date(x.data_fim).toLocaleDateString("pt-BR")}`:"Sem perÃ­odo especÃ­fico"}),x.grupo_produto_nome&&e.jsxs("p",{className:"text-gray-600 text-sm",children:["Grupo: ",x.grupo_produto_nome]}),x.produto_nome&&e.jsxs("p",{className:"text-gray-600 text-sm",children:["Produto: ",x.produto_nome]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Resumo do PerÃ­odo"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Quantidade"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:N.quantidade_comissoes})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["R$ ",N.valor_total.toFixed(2)]})]}),N.valor_pago_total>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pago"}),e.jsxs("p",{className:"text-lg font-semibold text-blue-600",children:["R$ ",N.valor_pago_total.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Saldo"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["R$ ",N.saldo_restante_total.toFixed(2)]})]})]})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden mb-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:Q.size===j.length&&j.length>0,onChange:de})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Quantidade"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Base"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"%"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Pago"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Saldo"})]})}),e.jsx("tbody",{children:j.map(ke=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:Q.has(ke.id),onChange:()=>ee(ke.id)})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(ke.data_venda).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"px-4 py-3 text-sm",children:ke.nome_produto}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:ke.cliente_nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:ke.quantidade.toFixed(2)}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right",children:["R$ ",ke.valor_base_calculo.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right",children:[ke.percentual_comissao.toFixed(2),"%"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right font-semibold text-green-600",children:["R$ ",ke.valor_comissao.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-blue-600",children:ke.valor_pago?`R$ ${ke.valor_pago.toFixed(2)}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-orange-600",children:ke.saldo_restante?`R$ ${ke.saldo_restante.toFixed(2)}`:"-"})]},ke.id))})]})})}),e.jsx("div",{className:"bg-gray-900 text-white rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-300",children:[Q.size," de ",j.length," comissÃµes selecionadas"]})}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Total Selecionado"}),e.jsxs("p",{className:"text-2xl font-bold text-green-400",children:["R$ ",se.toFixed(2)]})]}),parseFloat(q)>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"SerÃ¡ Pago"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-400",children:["R$ ",parseFloat(q).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Saldo Restante"}),e.jsxs("p",{className:`text-2xl font-bold ${_e>0?"text-orange-400":"text-green-400"}`,children:["R$ ",_e.toFixed(2)]})]})]}),e.jsx("button",{onClick:ue,disabled:Q.size===0,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-500 rounded-lg font-semibold transition",children:"Fechar e Pagar"})]})]})}),M&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-2xl p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Fechamento com Pagamento"}),z&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:z}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded border border-blue-200",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["ComissÃµes a processar: ",Q.size]}),e.jsxs("p",{className:"text-lg font-bold text-gray-800",children:["Valor Total: R$ ",se.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de Pagamento *"}),e.jsx("select",{value:R,onChange:ke=>J(ke.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:i.map(ke=>e.jsx("option",{value:ke.nome,children:ke.descricao},ke.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor a Pagar *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"flex items-center bg-gray-100 px-3 py-2 rounded-lg border border-gray-300",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:se,value:q,onChange:ke=>Z(ke.target.value),placeholder:"0.00",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["MÃ¡ximo: R$ ",se.toFixed(2),parseFloat(q)<se&&parseFloat(q)>0&&e.jsxs("span",{className:"text-orange-600 font-semibold ml-2",children:["(Pagamento Parcial - Saldo: R$ ",(se-parseFloat(q)).toFixed(2),")"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data de Pagamento *"}),e.jsx("input",{type:"date",value:S,onChange:ke=>P(ke.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ObservaÃ§Ãµes"}),e.jsx("textarea",{value:G,onChange:ke=>B(ke.target.value),placeholder:"ObservaÃ§Ãµes opcionais...",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>A(!1),disabled:y,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:Re,disabled:y,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:y?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"â³"}),"Processando..."]}):"Confirmar Fechamento"})]})]})})]})},Ed=()=>{const s=fa(),[l,t]=a.useState([]),[m,r]=a.useState(!0),[g,o]=a.useState(null),[v,j]=a.useState(null),[f,N]=a.useState(""),[d,x]=a.useState(""),[k,w]=a.useState("");a.useEffect(()=>{c()},[]);const c=async()=>{var h,_;try{r(!0),o(null);const E=new URLSearchParams;f&&E.append("data_inicio",f),d&&E.append("data_fim",d),k&&E.append("funcionario_id",k);const $=`/comissoes/fechamentos${E.toString()?"?"+E.toString():""}`,K=await F.get($);K.data.success?(t(K.data.fechamentos||[]),j(K.data.resumo)):o("Erro ao carregar histÃ³rico")}catch(E){console.error("Erro ao carregar histÃ³rico:",E),o(((_=(h=E.response)==null?void 0:h.data)==null?void 0:_.detail)||"Erro ao carregar histÃ³rico de fechamentos")}finally{r(!1)}},b=()=>{c()},p=()=>{N(""),x(""),w(""),setTimeout(()=>c(),100)},i=h=>{s(`/comissoes/fechamentos/detalhe?funcionario_id=${h.funcionario_id}&data_pagamento=${h.data_pagamento}`)},u=h=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(h),n=h=>h?new Date(h+"T00:00:00").toLocaleDateString("pt-BR"):"-",C=h=>h?new Date(h).toLocaleString("pt-BR"):"-";return m?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"bg-white shadow-md rounded-lg p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando histÃ³rico..."})]})})}):g?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-6 w-6 text-red-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-medium",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:g})]})]}),e.jsx("button",{onClick:c,className:"mt-4 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-md transition-colors",children:"Tentar Novamente"})]})}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-8",children:[e.jsxs("div",{className:"mb-6 border-b border-gray-200 pb-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"HistÃ³rico de Fechamentos"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Auditoria de comissÃµes fechadas - somente leitura"})]}),e.jsxs("div",{className:"mb-6 bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Filtros"}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:f,onChange:h=>N(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:d,onChange:h=>x(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ID do FuncionÃ¡rio"}),e.jsx("input",{type:"number",value:k,onChange:h=>w(h.target.value),placeholder:"Deixe vazio para todos",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors",children:"Aplicar"}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md transition-colors",children:"Limpar"})]})]})]}),v&&e.jsx("div",{className:"mb-6 bg-purple-50 border border-purple-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Total de Fechamentos"}),e.jsx("p",{className:"text-2xl font-bold text-purple-800",children:v.total_fechamentos})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Valor Total Pago"}),e.jsx("p",{className:"text-2xl font-bold text-purple-800",children:u(v.valor_total_geral)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Total de ComissÃµes"}),e.jsx("p",{className:"text-2xl font-bold text-purple-800",children:v.quantidade_total_geral})]})]})}),l.length===0?e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"h-16 w-16 text-yellow-500 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-xl font-semibold text-yellow-800 mb-2",children:"Nenhum fechamento encontrado"}),e.jsx("p",{className:"text-yellow-600",children:"NÃ£o hÃ¡ fechamentos registrados no perÃ­odo selecionado."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"FuncionÃ¡rio"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Fechamento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Pagamento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qtde"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor Total"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ã£o"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map((h,_)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>i(h),children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-purple-600 font-semibold text-sm",children:h.nome_funcionario.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:h.nome_funcionario}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",h.funcionario_id]})]})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-600",children:C(h.data_fechamento)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm font-medium text-gray-900",children:n(h.data_pagamento)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800",children:h.quantidade_comissoes})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-semibold text-green-600",children:u(h.valor_total)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("button",{onClick:E=>{E.stopPropagation(),i(h)},className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:"Ver Detalhes"})})]},`${h.funcionario_id}_${h.data_pagamento}_${_}`))})]})}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"ðŸ’¡ Clique em uma linha para ver os detalhes do fechamento"})})]})]})})},Fd=()=>{const s=fa(),[l]=lr(),t=l.get("funcionario_id"),m=l.get("data_pagamento"),[r,g]=a.useState(null),[o,v]=a.useState(!0),[j,f]=a.useState(null);a.useEffect(()=>{if(!t||!m){f("ParÃ¢metros invÃ¡lidos: funcionario_id e data_pagamento sÃ£o obrigatÃ³rios"),v(!1);return}N()},[t,m]);const N=async()=>{var p,i;try{v(!0),f(null);const u=await F.get("/comissoes/fechamentos/detalhe",{params:{funcionario_id:t,data_pagamento:m}});u.data.success?g(u.data):f("Erro ao carregar detalhes do fechamento")}catch(u){console.error("Erro ao carregar detalhes:",u),f(((i=(p=u.response)==null?void 0:p.data)==null?void 0:i.detail)||"Erro ao carregar detalhes do fechamento")}finally{v(!1)}},d=p=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(p),x=p=>p?new Date(p+"T00:00:00").toLocaleDateString("pt-BR"):"-",k=p=>p?new Date(p).toLocaleString("pt-BR"):"-",w=()=>{s("/comissoes/fechamentos")};if(o)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"bg-white shadow-md rounded-lg p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando detalhes..."})]})})});if(j||!r)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-6 w-6 text-red-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-medium",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:j||"Fechamento nÃ£o encontrado"})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-md transition-colors",children:"Tentar Novamente"}),e.jsx("button",{onClick:w,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md transition-colors",children:"Voltar"})]})]})});const{fechamento:c,comissoes:b}=r;return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-8",children:[e.jsxs("div",{className:"mb-6 border-b border-gray-200 pb-4",children:[e.jsxs("button",{onClick:w,className:"mb-4 inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:[e.jsx("svg",{className:"mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Voltar"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Detalhes do Fechamento"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"VisualizaÃ§Ã£o completa das comissÃµes incluÃ­das neste fechamento"}),e.jsxs("div",{className:"mt-3 inline-flex items-center px-3 py-1 rounded-full bg-yellow-100 border border-yellow-300",children:[e.jsx("svg",{className:"h-4 w-4 text-yellow-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Somente Leitura - Registro de Auditoria"})]})]}),e.jsxs("div",{className:"mb-6 bg-purple-50 border border-purple-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-purple-800 mb-4",children:"InformaÃ§Ãµes do Fechamento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"FuncionÃ¡rio"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-purple-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-purple-700 font-semibold text-sm",children:c.nome_funcionario.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:c.nome_funcionario}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",c.funcionario_id]})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Data do Fechamento"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:k(c.data_fechamento)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Data de Pagamento"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:x(c.data_pagamento)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Quantidade de ComissÃµes"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:c.quantidade_comissoes})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Valor Total"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:d(c.valor_total)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"PerÃ­odo das Vendas"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:c.periodo_vendas})]})]}),c.observacao_pagamento&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-purple-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"ObservaÃ§Ãµes"}),e.jsx("p",{className:"text-sm text-gray-800 italic",children:c.observacao_pagamento})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ComissÃµes IncluÃ­das"}),b&&b.length>0?e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Venda"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qtde"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor Venda"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"% ComissÃ£o"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ComissÃ£o"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map((p,i)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:p.nome_cliente||"Cliente nÃ£o identificado"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:p.nome_produto||"Produto nÃ£o identificado"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-600",children:x(p.data_venda)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-600",children:p.quantidade}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-gray-900",children:d(p.valor_venda_snapshot)}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-600",children:[p.percentual_snapshot,"%"]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-semibold text-green-600",children:d(p.valor_comissao)})]},p.id||i))}),e.jsx("tfoot",{className:"bg-gray-50 border-t-2 border-gray-300",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"6",className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"TOTAL:"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-base font-bold text-green-700",children:d(c.valor_total)})]})})]})}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-yellow-800",children:"Nenhuma comissÃ£o encontrada para este fechamento."})})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-500 mt-0.5 mr-3 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800 mb-1",children:"InformaÃ§Ãµes Importantes"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Este Ã© um registro imutÃ¡vel de auditoria"}),e.jsx("li",{children:"NÃ£o Ã© possÃ­vel editar ou reverter fechamentos realizados"}),e.jsx("li",{children:"Os valores foram capturados no momento do fechamento (snapshot)"}),e.jsx("li",{children:"Para questÃµes sobre este fechamento, entre em contato com a administraÃ§Ã£o"})]})]})]})})]})})},$d=()=>{const s=fa(),[l,t]=a.useState("margem-produto"),[m,r]=a.useState(!1),[g,o]=a.useState(""),[v,j]=a.useState(""),[f,N]=a.useState(null),[d,x]=a.useState(null),[k,w]=a.useState(null),[c,b]=a.useState(null),[p,i]=a.useState(null),[u,n]=a.useState(null),C=async S=>{r(!0);try{const P={};g&&(P.data_inicio=g),v&&(P.data_fim=v);let G="",B=null;switch(S){case"margem-produto":G="/relatorios-comissoes/margem-produto",B=N;break;case"produtos-prejudiciais":G="/relatorios-comissoes/produtos-prejudiciais",B=x;break;case"ranking-funcionarios":G="/relatorios-comissoes/ranking-funcionarios",B=w;break;case"ranking-produtos":G="/relatorios-comissoes/ranking-produtos",B=b;break;case"ranking-categorias":G="/relatorios-comissoes/ranking-categorias",B=i;break;case"dre":G="/relatorios-comissoes/visao-dre",P.ano=2026,B=n;break;default:r(!1);return}const y=await F.get(G,{params:P,timeout:1e4});B(y.data)}catch(P){console.error(`Erro ao carregar relatÃ³rio ${S}:`,P),P.code==="ECONNABORTED"||P.message.includes("timeout")?alert("â±ï¸ Tempo de resposta excedido. Verifique se o backend estÃ¡ rodando."):alert("âŒ Erro ao carregar relatÃ³rio. Verifique o console para detalhes.")}finally{r(!1)}};a.useEffect(()=>{C(l)},[l]);const h=()=>{C(l)},_=S=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(S),E=S=>`${S.toFixed(2)}%`,$=async()=>{try{const S={tipo:l,data_inicio:g,data_fim:v},P=await F.get("/relatorios-comissoes/exportar-csv",{params:S,responseType:"blob"}),G=window.URL.createObjectURL(new Blob([P.data])),B=document.createElement("a");B.href=G,B.setAttribute("download",`relatorio_${l}_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(B),B.click(),B.remove()}catch(S){console.error("Erro ao exportar CSV:",S),alert("Erro ao exportar arquivo")}},K=["#8884d8","#82ca9d","#ffc658","#ff7c7c","#a28bd4","#f48fb1"],te=S=>S===3?"text-red-700 bg-red-100 border-red-300":S===2?"text-orange-700 bg-orange-100 border-orange-300":"text-yellow-700 bg-yellow-100 border-yellow-300",M=()=>{const S=[{id:"margem-produto",label:"ðŸ“Š Margem por Produto",icone:"ðŸ’°"},{id:"produtos-prejudiciais",label:"âš ï¸ Produtos Prejudiciais",icone:"ðŸš¨"},{id:"ranking-funcionarios",label:"ðŸ‘¥ Ranking FuncionÃ¡rios",icone:"ðŸ†"},{id:"ranking-produtos",label:"ðŸ“¦ Ranking Produtos",icone:"ðŸ“ˆ"},{id:"ranking-categorias",label:"ðŸ“‚ Ranking Categorias",icone:"ðŸŽ¯"},{id:"dre",label:"ðŸ“‘ VisÃ£o DRE",icone:"ðŸ’¼"}];return e.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:S.map(P=>e.jsxs("button",{onClick:()=>t(P.id),className:`px-4 py-3 rounded-lg font-medium whitespace-nowrap transition-all ${l===P.id?"bg-blue-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx("span",{className:"text-xl mr-2",children:P.icone}),P.label]},P.id))})},A=()=>e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ“… Data InÃ­cio"}),e.jsx("input",{type:"date",value:g,onChange:S=>o(S.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ“… Data Fim"}),e.jsx("input",{type:"date",value:v,onChange:S=>j(S.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition mt-6",children:"ðŸ” Buscar"}),e.jsx("button",{onClick:()=>{o(""),j(""),C(l)},className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition mt-6",children:"ðŸ”„ Limpar"}),["margem-produto","produtos-prejudiciais","ranking-funcionarios","ranking-produtos"].includes(l)&&e.jsx("button",{onClick:$,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition mt-6",children:"ðŸ“¥ Exportar CSV"})]})]})}),Q=()=>{if(!f)return e.jsx("div",{className:"text-center py-12",children:"Carregando..."});const S=f.dados.slice(0,10);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Total de Produtos"}),e.jsx("div",{className:"text-3xl font-bold text-blue-800",children:f.total_produtos})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-red-600 font-medium",children:"Produtos com Margem Negativa"}),e.jsx("div",{className:"text-3xl font-bold text-red-800",children:f.produtos_com_alerta})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Produtos SaudÃ¡veis"}),e.jsx("div",{className:"text-3xl font-bold text-green-800",children:f.total_produtos-f.produtos_com_alerta})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Top 10 Produtos por Margem LÃ­quida"}),e.jsx(Ma,{width:"100%",height:400,children:e.jsxs(ns,{data:S,children:[e.jsx(Oa,{strokeDasharray:"3 3"}),e.jsx(Ba,{dataKey:"produto_nome",angle:-45,textAnchor:"end",height:100}),e.jsx(Ia,{}),e.jsx(Pa,{formatter:P=>_(P)}),e.jsx(Ta,{}),e.jsx(Ka,{dataKey:"margem_liquida",fill:"#82ca9d",name:"Margem LÃ­quida"}),e.jsx(Ka,{dataKey:"valor_comissao",fill:"#ff7c7c",name:"ComissÃ£o"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Produto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Categoria"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Venda"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Custo"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"ComissÃ£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Margem LÃ­quida"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"% Margem"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.dados.map((P,G)=>e.jsxs("tr",{className:P.alerta_margem_negativa?"bg-red-50":"",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:P.produto_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:P.categoria_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:_(P.valor_venda)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:_(P.valor_custo)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-orange-600 font-medium",children:_(P.valor_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold",children:e.jsx("span",{className:P.margem_liquida<0?"text-red-600":"text-green-600",children:_(P.margem_liquida)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:E(P.percentual_margem)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:P.alerta_margem_negativa?e.jsx("span",{className:"px-2 py-1 text-xs font-bold text-red-700 bg-red-100 rounded",children:"âš ï¸ NEGATIVA"}):e.jsx("span",{className:"px-2 py-1 text-xs font-bold text-green-700 bg-green-100 rounded",children:"âœ… OK"})})]},G))})]})})})]})},re=()=>d?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{className:"font-semibold",children:"RelatÃ³rio informativo"})," baseado em vendas jÃ¡ realizadas. Os dados nÃ£o alteram comissÃµes, preÃ§os ou histÃ³ricos e nÃ£o devem ser usados para ajustes retroativos."]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Produtos Analisados"}),e.jsx("div",{className:"text-3xl font-bold text-blue-800",children:d.total_produtos_analisados})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-red-600 font-medium",children:"CrÃ­ticos"}),e.jsx("div",{className:"text-3xl font-bold text-red-800",children:d.produtos_criticos})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-orange-600 font-medium",children:"Total Prejudiciais"}),e.jsx("div",{className:"text-3xl font-bold text-orange-800",children:d.total_produtos_prejudiciais})]})]}),e.jsx("div",{className:"space-y-4",children:d.dados.map((S,P)=>e.jsxs("div",{className:`border-2 rounded-lg p-6 ${te(S.nivel_gravidade)}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:[S.nivel_gravidade===3&&"ðŸš¨",S.nivel_gravidade===2&&"âš ï¸",S.nivel_gravidade===1&&"âš¡"," ",S.produto_nome]}),e.jsx("p",{className:"text-sm opacity-75",children:S.categoria_nome})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-medium",children:"Impacto Financeiro"}),e.jsx("div",{className:"text-2xl font-bold",children:_(S.impacto_financeiro)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium opacity-75",children:"Margem LÃ­quida"}),e.jsx("div",{className:"text-lg font-bold",children:_(S.margem_liquida)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium opacity-75",children:"% Margem"}),e.jsx("div",{className:"text-lg font-bold",children:E(S.percentual_margem)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium opacity-75",children:"ComissÃ£o"}),e.jsx("div",{className:"text-lg font-bold",children:_(S.valor_comissao)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium opacity-75",children:"% ComissÃ£o"}),e.jsx("div",{className:"text-lg font-bold",children:E(S.percentual_comissao)})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold mb-2",children:"âš ï¸ Alertas:"}),e.jsx("ul",{className:"list-disc list-inside text-sm space-y-1",children:S.alertas.map((G,B)=>e.jsx("li",{children:G},B))})]})]},P))})]}):e.jsx("div",{className:"text-center py-12",children:"Carregando..."}),q=()=>k?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{className:"font-semibold",children:"RelatÃ³rio informativo"})," baseado em volume histÃ³rico. NÃ£o representa meta, desempenho ou polÃ­tica de incentivo."]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"FuncionÃ¡rios por Volume de ComissÃµes (10 maiores)"}),e.jsx(Ma,{width:"100%",height:400,children:e.jsxs(ns,{data:k.ranking,children:[e.jsx(Oa,{strokeDasharray:"3 3"}),e.jsx(Ba,{dataKey:"funcionario_nome",angle:-45,textAnchor:"end",height:100}),e.jsx(Ia,{}),e.jsx(Pa,{formatter:S=>_(S)}),e.jsx(Ta,{}),e.jsx(Ka,{dataKey:"total_comissao",fill:"#8884d8",name:"Total de ComissÃµes"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"PosiÃ§Ã£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"FuncionÃ¡rio"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total ComissÃµes"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Quantidade"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"MÃ©dia"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:k.ranking.map(S=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsxs("span",{className:"text-lg font-semibold text-gray-700",children:[S.posicao,"Âº"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:S.funcionario_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-green-600",children:_(S.total_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:S.quantidade_comissoes}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:_(S.media_comissao)})]},S.posicao))})]})})]}):e.jsx("div",{className:"text-center py-12",children:"Carregando..."}),Z=()=>c?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{className:"font-semibold",children:"RelatÃ³rio informativo"})," baseado em volume histÃ³rico. NÃ£o representa meta, desempenho ou polÃ­tica de incentivo."]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Produtos por Volume de ComissÃµes (10 maiores)"}),e.jsx(Ma,{width:"100%",height:400,children:e.jsxs(ns,{data:c.ranking,children:[e.jsx(Oa,{strokeDasharray:"3 3"}),e.jsx(Ba,{dataKey:"produto_nome",angle:-45,textAnchor:"end",height:100}),e.jsx(Ia,{}),e.jsx(Pa,{formatter:S=>_(S)}),e.jsx(Ta,{}),e.jsx(Ka,{dataKey:"total_comissao",fill:"#82ca9d",name:"Total de ComissÃµes"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"PosiÃ§Ã£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Produto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Categoria"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total ComissÃ£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Qtd Vendas"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total Venda"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.ranking.map(S=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-center text-lg font-bold text-gray-700",children:[S.posicao,"Âº"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:S.produto_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:S.categoria_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-green-600",children:_(S.total_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:S.quantidade_vendas}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:_(S.total_venda)})]},S.posicao))})]})})]}):e.jsx("div",{className:"text-center py-12",children:"Carregando..."}),R=()=>p?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{className:"font-semibold",children:"RelatÃ³rio informativo"})," baseado em volume histÃ³rico. NÃ£o representa meta, desempenho ou polÃ­tica de incentivo."]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"DistribuiÃ§Ã£o de ComissÃµes por Categoria"}),e.jsx(Ma,{width:"100%",height:400,children:e.jsxs(jr,{children:[e.jsx(vr,{data:p.ranking,dataKey:"total_comissao",nameKey:"categoria_nome",cx:"50%",cy:"50%",outerRadius:120,label:S=>`${S.categoria_nome}: ${S.percentual_total}%`,children:p.ranking.map((S,P)=>e.jsx(Gt,{fill:K[P%K.length]},`cell-${P}`))}),e.jsx(Pa,{formatter:S=>_(S)})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"PosiÃ§Ã£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Categoria"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total ComissÃ£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"% do Total"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Qtd ComissÃµes"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total Vendas"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.ranking.map(S=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-center text-lg font-bold text-gray-700",children:[S.posicao,"Âº"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:S.categoria_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-green-600",children:_(S.total_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-blue-600 font-medium",children:E(S.percentual_total)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:S.quantidade_comissoes}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:_(S.total_venda)})]},S.posicao))})]})})]}):e.jsx("div",{className:"text-center py-12",children:"Carregando..."}),J=()=>u?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{className:"font-semibold",children:"Regime de competÃªncia:"})," as comissÃµes sÃ£o reconhecidas como despesa na data da venda, independentemente do pagamento. Inclui comissÃµes pendentes e pagas."]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Receita Bruta (Ano)"}),e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:_(u.total_ano.receita_bruta)})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-orange-600 font-medium",children:"Despesa ComissÃ£o (Ano)"}),e.jsx("div",{className:"text-2xl font-bold text-orange-800",children:_(u.total_ano.despesa_comissao)})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Margem LÃ­quida (Ano)"}),e.jsx("div",{className:"text-2xl font-bold text-green-800",children:_(u.total_ano.margem_liquida)})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-purple-600 font-medium",children:"% ComissÃ£o sobre Receita"}),e.jsx("div",{className:"text-2xl font-bold text-purple-800",children:E(u.total_ano.percentual_comissao)})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"EvoluÃ§Ã£o Mensal - DRE"}),e.jsx(Ma,{width:"100%",height:400,children:e.jsxs(it,{data:u.dados_mensais,children:[e.jsx(Oa,{strokeDasharray:"3 3"}),e.jsx(Ba,{dataKey:"mes_nome"}),e.jsx(Ia,{}),e.jsx(Pa,{formatter:S=>_(S)}),e.jsx(Ta,{}),e.jsx(ls,{type:"monotone",dataKey:"receita_bruta",stroke:"#8884d8",name:"Receita Bruta",strokeWidth:2}),e.jsx(ls,{type:"monotone",dataKey:"despesa_comissao",stroke:"#ff7c7c",name:"Despesa ComissÃ£o",strokeWidth:2}),e.jsx(ls,{type:"monotone",dataKey:"margem_liquida",stroke:"#82ca9d",name:"Margem LÃ­quida",strokeWidth:2})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"MÃªs"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Receita Bruta"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Custo"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"ComissÃ£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Margem Bruta"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Margem LÃ­quida"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"% ComissÃ£o"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.dados_mensais.map(S=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:S.mes_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-blue-600 font-medium",children:_(S.receita_bruta)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:_(S.custo_total)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-orange-600 font-medium",children:_(S.despesa_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-700",children:_(S.margem_bruta)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-green-600",children:_(S.margem_liquida)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-purple-600",children:E(S.percentual_comissao_sobre_receita)})]},S.mes))})]})})]}):e.jsx("div",{className:"text-center py-12",children:"Carregando..."});return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>s("/comissoes-listagem"),className:"flex items-center gap-2 text-blue-600 hover:text-blue-800 mb-4",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Voltar para Demonstrativo"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"ðŸ“Š RelatÃ³rios AnalÃ­ticos de ComissÃµes"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"AnÃ¡lise de rentabilidade, margem e tomada de decisÃ£o estratÃ©gica"})]}),M(),A(),m?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600"})}):e.jsxs(e.Fragment,{children:[l==="margem-produto"&&Q(),l==="produtos-prejudiciais"&&re(),l==="ranking-funcionarios"&&q(),l==="ranking-produtos"&&Z(),l==="ranking-categorias"&&R(),l==="dre"&&J()]})]})};function yo(){const[s,l]=a.useState([]),[t,m]=a.useState([]),[r,g]=a.useState(!1),[o,v]=a.useState(!1),[j,f]=a.useState({id:null,categoria_id:"",nome:"",descricao:"",ativo:!0});a.useEffect(()=>{N(),d()},[]);const N=async()=>{try{const p=await F.get("/categorias-financeiras");l(p.data.filter(i=>i.ativo))}catch(p){console.error("Erro ao carregar categorias:",p),alert("Erro ao carregar categorias")}},d=async()=>{g(!0);try{const p=await F.get("/subcategorias");m(p.data)}catch(p){console.error("Erro ao carregar subcategorias:",p),alert("Erro ao carregar subcategorias")}finally{g(!1)}},x=async p=>{if(p.preventDefault(),!j.categoria_id||!j.nome){alert("Preencha categoria e nome");return}try{j.id?await F.put(`/subcategorias/${j.id}`,j):await F.post("/subcategorias",j),v(!1),f({id:null,categoria_id:"",nome:"",descricao:"",ativo:!0}),d()}catch(i){console.error("Erro ao salvar:",i),alert("Erro ao salvar subcategoria")}},k=p=>{f(p),v(!0)},w=async p=>{if(confirm("Deseja realmente excluir esta subcategoria?"))try{await F.delete(`/subcategorias/${p}`),d()}catch(i){console.error("Erro ao excluir:",i),alert("Erro ao excluir subcategoria")}},c=p=>{const i=s.find(u=>u.id===p);return i?i.nome:"-"},b=t.reduce((p,i)=>{const u=i.categoria_id;return p[u]||(p[u]={categoria:c(u),itens:[]}),p[u].itens.push(i),p},{});return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Subcategorias"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Gerencie as subcategorias de produtos"})]}),e.jsxs("button",{onClick:()=>{f({id:null,categoria_id:"",nome:"",descricao:"",ativo:!0}),v(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx("span",{children:"+"}),"Nova Subcategoria"]})]}),r?e.jsx("div",{className:"text-center py-8",children:"Carregando..."}):e.jsxs("div",{className:"space-y-6",children:[Object.entries(b).map(([p,i])=>e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-b",children:e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:i.categoria})}),e.jsx("div",{className:"divide-y",children:i.itens.map(u=>e.jsxs("div",{className:"px-4 py-3 flex justify-between items-center hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:u.nome}),u.descricao&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:u.descricao})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${u.ativo?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:u.ativo?"Ativo":"Inativo"}),e.jsx("button",{onClick:()=>k(u),className:"text-blue-600 hover:text-blue-800 px-3 py-1",children:"Editar"}),e.jsx("button",{onClick:()=>w(u.id),className:"text-red-600 hover:text-red-800 px-3 py-1",children:"Excluir"})]})]},u.id))})]},p)),Object.keys(b).length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Nenhuma subcategoria cadastrada"})]}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:[j.id?"Editar":"Nova"," Subcategoria"]}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria *"}),e.jsxs("select",{value:j.categoria_id,onChange:p=>f({...j,categoria_id:parseInt(p.target.value)}),className:"w-full border rounded-lg px-3 py-2",required:!0,children:[e.jsx("option",{value:"",children:"Selecione..."}),s.map(p=>e.jsx("option",{value:p.id,children:p.nome},p.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",value:j.nome,onChange:p=>f({...j,nome:p.target.value}),className:"w-full border rounded-lg px-3 py-2",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:j.descricao,onChange:p=>f({...j,descricao:p.target.value}),className:"w-full border rounded-lg px-3 py-2",rows:"3"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:j.ativo,onChange:p=>f({...j,ativo:p.target.checked}),className:"mr-2"}),e.jsx("label",{className:"text-sm text-gray-700",children:"Ativo"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>v(!1),className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Salvar"})]})]})]})})]})}const Pd=()=>{const[s,l]=a.useState([]),[t,m]=a.useState(!0),[r,g]=a.useState(!1),[o,v]=a.useState(null),[j,f]=a.useState(new Set),[N,d]=a.useState({nome:"",descricao:"",categoria_pai_id:null,ordem:0}),x=4;a.useEffect(()=>{k()},[]);const k=async()=>{try{m(!0);const _=await F.get("/produtos/categorias");l(_.data)}catch(_){console.error("Erro ao carregar categorias:",_),alert("Erro ao carregar categorias")}finally{m(!1)}},w=_=>{const E=new Set(j);E.has(_)?E.delete(_):E.add(_),f(E)},c=async _=>{var E,$;_.preventDefault();try{o?await F.put(`/produtos/categorias/${o}`,N):await F.post("/produtos/categorias",N),g(!1),v(null),d({nome:"",descricao:"",categoria_pai_id:null,ordem:0}),k()}catch(K){console.error("Erro ao salvar categoria:",K),($=(E=K.response)==null?void 0:E.data)!=null&&$.detail?alert(K.response.data.detail):alert("Erro ao salvar categoria")}},b=_=>{v(_.id),d({nome:_.nome,descricao:_.descricao||"",categoria_pai_id:_.categoria_pai_id,ordem:_.ordem}),g(!0)},p=async _=>{var E,$;if(_.total_filhos>0){alert(`Esta categoria possui ${_.total_filhos} subcategoria(s). Remova-as primeiro.`);return}if(!(_.total_produtos>0&&!confirm(`Esta categoria possui ${_.total_produtos} produto(s). Deseja realmente excluir?`)))try{await F.delete(`/produtos/categorias/${_.id}`),k()}catch(K){console.error("Erro ao excluir categoria:",K),alert((($=(E=K.response)==null?void 0:E.data)==null?void 0:$.detail)||"Erro ao excluir categoria")}},i=_=>{if(_.nivel>=x){alert(`Limite de ${x} nÃ­veis de categorias atingido.`);return}v(null),d({nome:"",descricao:"",categoria_pai_id:_.id,ordem:0}),g(!0)},u=()=>{v(null),d({nome:"",descricao:"",categoria_pai_id:null,ordem:0}),g(!0)},n=(_=null,E=1)=>s.filter($=>$.categoria_pai_id===_).sort(($,K)=>$.ordem-K.ordem||$.nome.localeCompare(K.nome)).map($=>({...$,nivel:E,filhos:n($.id,E+1)})),C=(_,E=1)=>{const $=_.filhos&&_.filhos.length>0,K=j.has(_.id),te=E<x,M=(E-1)*30;return e.jsxs(ts.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white hover:bg-gray-50 border-b",style:{paddingLeft:`${20+M}px`},children:[e.jsx("div",{className:"w-5 flex items-center justify-center",children:$?e.jsx("button",{onClick:()=>w(_.id),className:"text-gray-500 hover:text-gray-700 transition-colors",children:K?e.jsx(Os,{size:18}):e.jsx(Ls,{size:18})}):e.jsx("span",{className:"text-gray-300",children:"â€¢"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-800",children:_.nome}),e.jsxs("span",{className:"text-xs text-gray-500",children:["NÃ­vel ",E]}),_.total_filhos>0&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:[_.total_filhos," sub"]}),_.total_produtos>0&&e.jsxs("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded",children:[_.total_produtos," produtos"]})]}),_.descricao&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:_.descricao})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[te&&e.jsx("button",{onClick:()=>i(_),className:"p-2 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Adicionar subcategoria",children:e.jsx(Qa,{size:18})}),!te&&e.jsx("span",{className:"p-2 text-gray-300 cursor-not-allowed",title:`Limite de ${x} nÃ­veis atingido`,children:e.jsx(Na,{size:18})}),e.jsx("button",{onClick:()=>b(_),className:"p-2 text-yellow-600 hover:bg-yellow-50 rounded transition-colors",title:"Editar",children:e.jsx(_s,{size:18})}),e.jsx("button",{onClick:()=>p(_),className:"p-2 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Excluir",children:e.jsx(ps,{size:18})})]})]}),$&&K&&e.jsx("div",{children:_.filhos.map(A=>C(A,E+1))})]},_.id)},h=n();return t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-600",children:"Carregando categorias..."})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Categorias"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Gerencie suas categorias hierarquicamente (atÃ© ",x," nÃ­veis)"]})]}),e.jsxs("button",{onClick:u,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors",children:[e.jsx(Qa,{size:20}),"Nova Categoria"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:h.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Na,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhuma categoria cadastrada"}),e.jsx("button",{onClick:u,className:"mt-4 text-blue-600 hover:text-blue-700",children:"Criar primeira categoria"})]}):e.jsx("div",{children:h.map(_=>C(_))})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:o?"Editar Categoria":N.categoria_pai_id?"Nova Subcategoria":"Nova Categoria"}),e.jsxs("form",{onSubmit:c,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",value:N.nome,onChange:_=>d({...N,nome:_.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,autoFocus:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:N.descricao,onChange:_=>d({...N,descricao:_.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ordem"}),e.jsx("input",{type:"number",value:N.ordem,onChange:_=>d({...N,ordem:parseInt(_.target.value)||0}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Menor valor aparece primeiro"})]}),N.categoria_pai_id&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx(Na,{className:"inline mr-1"}),"Esta serÃ¡ uma subcategoria"]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{g(!1),v(null),d({nome:"",descricao:"",categoria_pai_id:null,ordem:0})},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded hover:bg-gray-300 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:o?"Salvar":"Criar"})]})]})]})})]})},Rd=()=>{const[s,l]=a.useState([]),[t,m]=a.useState([]),[r,g]=a.useState(!0),[o,v]=a.useState(!1),[j,f]=a.useState(!1),[N,d]=a.useState(null),[x,k]=a.useState(null),[w,c]=a.useState(new Set),[b,p]=a.useState("todos"),[i,u]=a.useState({nome:"",tipo:"despesa",cor:"#6366f1",icone:"ðŸ“‹",descricao:"",ativo:!0,novasSubcategorias:[]}),[n,C]=a.useState({categoria_id:null,nome:"",descricao:"",ativo:!0}),h=["ðŸ’°","ðŸ’¸","ðŸ“‹","ðŸ ","âš¡","ðŸ’§","ðŸ“¡","ðŸ‘¥","ðŸ“¦","ðŸ”§","ðŸš—","ðŸ½ï¸","ðŸ“","ðŸ›¡ï¸","ðŸ›’","âœ¨","ðŸ•","ðŸ©º","ðŸ¨","ðŸŽ“"],_=["#ef4444","#f97316","#f59e0b","#84cc16","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899"];a.useEffect(()=>{E()},[]);const E=async()=>{await Promise.all([$(),K()])},$=async()=>{try{g(!0);const z=await F.get("/categorias-financeiras/");console.log("ðŸ“‚ Categorias carregadas:",z.data.length),console.log("ðŸ” Primeira categoria:",z.data[0]),l(z.data)}catch(z){console.error("Erro ao carregar categorias:",z),ce.error("Erro ao carregar categorias financeiras")}finally{g(!1)}},K=async()=>{var z,ae;try{console.log("ðŸ”„ Iniciando carregamento de subcategorias DRE...");const W=await F.get("/dre/subcategorias");console.log("âœ… Resposta recebida:",W),console.log("ðŸ“‹ Subcategorias DRE carregadas:",W.data.length),console.log("ðŸ” Primeira subcategoria:",W.data[0]),console.log("ðŸ“¦ Todas as subcategorias:",W.data),m(W.data)}catch(W){console.error("âŒ ERRO ao carregar subcategorias DRE:",W),console.error("âŒ Erro completo:",((z=W.response)==null?void 0:z.data)||W.message),console.error("âŒ Status:",(ae=W.response)==null?void 0:ae.status),m([])}},te=z=>{const ae=new Set(w);ae.has(z)?ae.delete(z):ae.add(z),c(ae)},M=z=>{if(!z.dre_subcategoria_id)return[];const ae=t.find(ne=>ne.id===z.dre_subcategoria_id);if(!ae)return console.log(`âš ï¸ Categoria "${z.nome}" tem dre_subcategoria_id=${z.dre_subcategoria_id} mas nÃ£o encontrada`),[];const W=t.filter(ne=>ne.categoria_id===ae.categoria_id);return console.log(`ðŸ“¦ Categoria "${z.nome}" â†’ ${W.length} subcategorias DRE`),W},A=async z=>{var ae,W;if(z.preventDefault(),!i.nome||!i.tipo){ce.error("Preencha nome e tipo");return}try{let ne;if(N)await F.put(`/categorias-financeiras/${N}`,{nome:i.nome,tipo:i.tipo,cor:i.cor,icone:i.icone,descricao:i.descricao,ativo:i.ativo}),ne=N,ce.success("Categoria atualizada com sucesso!");else if(ne=(await F.post("/categorias-financeiras/",{nome:i.nome,tipo:i.tipo,cor:i.cor,icone:i.icone,descricao:i.descricao,ativo:i.ativo})).data.id,ce.success("Categoria criada com sucesso!"),i.novasSubcategorias.length>0){const ee=i.novasSubcategorias.filter(de=>de.nome.trim());for(const de of ee)try{await F.post("/subcategorias/",{categoria_id:ne,nome:de.nome,descricao:de.descricao,ativo:de.ativo})}catch(ue){console.error("Erro ao criar subcategoria:",ue),ce.error(`Erro ao criar subcategoria: ${de.nome}`)}ee.length>0&&ce.success(`${ee.length} subcategoria(s) criada(s)!`)}v(!1),q(),E()}catch(ne){console.error("Erro ao salvar:",ne),ce.error(((W=(ae=ne.response)==null?void 0:ae.data)==null?void 0:W.detail)||"Erro ao salvar categoria")}},Q=async z=>{console.log(`ðŸ”§ Editando categoria "${z.nome}" (ID: ${z.id})`);const ae=M(z);console.log(`ðŸ“¦ Subcategorias DRE encontradas: ${ae.length}`,ae);const W=ae.map(ne=>({id:ne.id,nome:ne.nome,descricao:ne.descricao||"",ativo:ne.ativo,tipo_custo:ne.tipo_custo,escopo_rateio:ne.escopo_rateio}));u({nome:z.nome,tipo:z.tipo,cor:z.cor||"#6366f1",icone:z.icone||"ðŸ“‹",descricao:z.descricao||"",ativo:z.ativo,novasSubcategorias:W}),d(z.id),v(!0)},re=async z=>{var ae,W;if(window.confirm("Deseja realmente excluir esta categoria?"))try{await F.delete(`/categorias-financeiras/${z}`),ce.success("Categoria excluÃ­da com sucesso!"),E()}catch(ne){console.error("Erro ao excluir:",ne),ce.error(((W=(ae=ne.response)==null?void 0:ae.data)==null?void 0:W.detail)||"Erro ao excluir categoria")}},q=()=>{u({nome:"",tipo:"despesa",cor:"#6366f1",icone:"ðŸ“‹",descricao:"",ativo:!0,novasSubcategorias:[]}),d(null)},Z=(z="")=>{u({...i,novasSubcategorias:[...i.novasSubcategorias,{nome:z,descricao:"",ativo:!0}]})},R=(z,ae,W)=>{const ne=[...i.novasSubcategorias];ne[z][ae]=W,u({...i,novasSubcategorias:ne})},J=z=>{const ae=i.novasSubcategorias.filter((W,ne)=>ne!==z);u({...i,novasSubcategorias:ae})},S=(z,ae)=>{z.key==="Tab"&&!z.shiftKey&&ae===i.novasSubcategorias.length-1&&(z.preventDefault(),Z())},P=()=>{C({categoria_id:null,nome:"",descricao:"",ativo:!0}),k(null)},G=async z=>{var ae,W;if(z.preventDefault(),!n.categoria_id||!n.nome){ce.error("Preencha categoria e nome");return}try{x?(await F.put(`/subcategorias/${x}`,n),ce.success("Subcategoria atualizada!")):(await F.post("/subcategorias",n),ce.success("Subcategoria criada!")),f(!1),P(),carregarSubcategorias()}catch(ne){console.error("Erro ao salvar:",ne),ce.error(((W=(ae=ne.response)==null?void 0:ae.data)==null?void 0:W.detail)||"Erro ao salvar subcategoria")}},B=s.filter(z=>b==="todos"?!0:z.tipo===b),y=s.filter(z=>z.tipo==="despesa").length,O=s.filter(z=>z.tipo==="receita").length;return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"ðŸ·ï¸ Categorias Financeiras"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Organize suas receitas e despesas |",e.jsxs("span",{className:"text-red-600 ml-2",children:["ðŸ’¸ ",y," despesas"]}),e.jsxs("span",{className:"text-green-600 ml-2",children:["ðŸ’° ",O," receitas"]})]})]}),e.jsxs("button",{onClick:()=>{q(),v(!0)},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:[e.jsx(Qa,{})," Nova Categoria"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:()=>p("todos"),className:`px-4 py-2 rounded-lg ${b==="todos"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"}`,children:["ðŸ“Š Todas (",s.length,")"]}),e.jsxs("button",{onClick:()=>p("despesa"),className:`px-4 py-2 rounded-lg ${b==="despesa"?"bg-red-600 text-white":"bg-gray-200 text-gray-700"}`,children:["ðŸ’¸ Despesas (",y,")"]}),e.jsxs("button",{onClick:()=>p("receita"),className:`px-4 py-2 rounded-lg ${b==="receita"?"bg-green-600 text-white":"bg-gray-200 text-gray-700"}`,children:["ðŸ’° Receitas (",O,")"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:r?e.jsx("div",{className:"px-6 py-8 text-center text-gray-500",children:"Carregando..."}):B.length===0?e.jsx("div",{className:"px-6 py-8 text-center text-gray-500",children:"Nenhuma categoria encontrada"}):e.jsx("div",{className:"divide-y divide-gray-200",children:B.map(z=>{const ae=M(z),W=w.has(z.id),ne=ae.length>0;return e.jsxs("div",{children:[e.jsxs("div",{className:"px-6 py-4 hover:bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("button",{onClick:()=>te(z.id),className:`flex items-center justify-center w-10 h-10 rounded-lg transition-all duration-200 transform hover:scale-105 ${ne?W?"text-white bg-gradient-to-r from-purple-600 to-purple-700 shadow-lg hover:shadow-xl":"text-purple-600 bg-purple-100 hover:bg-purple-200 hover:text-purple-700 shadow-md hover:shadow-lg":"text-gray-300 cursor-not-allowed bg-gray-50"}`,disabled:!ne,title:ne?W?"Recolher subcategorias":"Expandir subcategorias":"Sem subcategorias DRE",children:ne?W?e.jsx(Os,{size:22,strokeWidth:2.5}):e.jsx(Ls,{size:22,strokeWidth:2.5}):e.jsx(Ls,{size:22})}),e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("span",{style:{backgroundColor:z.cor},className:"w-10 h-10 rounded-full flex items-center justify-center text-white text-lg",children:z.icone||"ðŸ“‹"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800",children:z.nome}),z.descricao&&e.jsx("div",{className:"text-sm text-gray-500",children:z.descricao})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${z.tipo==="receita"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:z.tipo==="receita"?"ðŸ’° Receita":"ðŸ’¸ Despesa"}),ne&&e.jsxs("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-medium flex items-center gap-1",children:[e.jsx("span",{children:"ðŸ“Š DRE"}),e.jsx("span",{className:"bg-purple-200 text-purple-900 px-1.5 rounded-full font-bold",children:ae.length})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>Q(z),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-md",title:"Editar",children:e.jsx(_s,{size:18})}),e.jsx("button",{onClick:()=>re(z.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-md",title:"Excluir",children:e.jsx(ps,{size:18})})]})]}),W&&e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 border-t border-purple-100",children:ne?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-6 py-2 bg-purple-100/50 border-b border-purple-200",children:e.jsxs("span",{className:"text-xs font-semibold text-purple-700 uppercase tracking-wide",children:["ðŸ—ï¸ Subcategorias DRE (",ae.length,")"]})}),ae.map(H=>e.jsxs("div",{className:"px-6 py-3 flex items-center gap-4 ml-9",children:[e.jsx("span",{className:"text-purple-400 text-lg",children:"â””â”€"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:H.nome}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500 bg-white px-2 py-0.5 rounded",children:H.tipo_custo}),H.escopo_rateio&&e.jsx("span",{className:"text-xs text-gray-500 bg-white px-2 py-0.5 rounded",children:H.escopo_rateio})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${H.ativo?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"}`,children:H.ativo?"âœ“ Ativo":"âœ— Inativo"})]},H.id))]}):e.jsx("div",{className:"px-6 py-4 ml-9 text-center",children:e.jsxs("div",{className:"text-gray-400 text-sm",children:[e.jsx("div",{className:"mb-2",children:"ðŸ“­"}),e.jsx("div",{className:"font-medium",children:"Nenhuma subcategoria DRE cadastrada"}),e.jsx("div",{className:"text-xs mt-1",children:"Configure subcategorias no mÃ³dulo DRE"})]})})})]},z.id)})})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full m-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("h3",{className:"text-xl font-bold",children:N?"Editar Categoria":"Nova Categoria"}),e.jsx("button",{onClick:()=>{v(!1),q()},className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),e.jsxs("form",{onSubmit:A,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",value:i.nome,onChange:z=>u({...i,nome:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo *"}),e.jsxs("select",{value:i.tipo,onChange:z=>u({...i,tipo:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"despesa",children:"ðŸ’¸ Despesa"}),e.jsx("option",{value:"receita",children:"ðŸ’° Receita"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ãcone"}),e.jsx("select",{value:i.icone,onChange:z=>u({...i,icone:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:h.map(z=>e.jsx("option",{value:z,children:z},z))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:i.cor,onChange:z=>u({...i,cor:z.target.value}),className:"w-12 h-10 border border-gray-300 rounded-md"}),e.jsx("select",{value:i.cor,onChange:z=>u({...i,cor:z.target.value}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:_.map(z=>e.jsx("option",{value:z,children:z},z))})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:i.descricao,onChange:z=>u({...i,descricao:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",rows:"3"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"ativo",checked:i.ativo,onChange:z=>u({...i,ativo:z.target.checked}),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("label",{htmlFor:"ativo",className:"text-sm text-gray-700",children:"Categoria ativa"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subcategorias DRE (opcional)"}),e.jsxs("button",{type:"button",onClick:()=>Z(),className:"text-sm text-purple-600 hover:text-purple-800 flex items-center gap-1",children:[e.jsx(Qa,{size:14})," Adicionar"]})]}),i.novasSubcategorias.length>0&&e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:i.novasSubcategorias.map((z,ae)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-md",children:[e.jsx("input",{type:"text",value:z.nome,onChange:W=>R(ae,"nome",W.target.value),onKeyDown:W=>S(W,ae),placeholder:"Nome da subcategoria (Tab para adicionar mais)",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>J(ae),className:"text-red-600 hover:text-red-800 p-1",title:"Remover",children:e.jsx(ps,{size:16})})]},ae))}),i.novasSubcategorias.length===0&&e.jsx("p",{className:"text-sm text-gray-500 italic",children:'Clique em "Adicionar" ou crie a categoria primeiro e depois adicione subcategorias'})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{v(!1),q()},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:N?"Atualizar":"Criar"})]})]})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:x?"Editar Subcategoria DRE":"Nova Subcategoria DRE"}),n.categoria_id&&s.find(z=>z.id===n.categoria_id)&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-md border border-blue-200",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Categoria: "}),e.jsx("span",{className:"font-semibold text-gray-800",children:s.find(z=>z.id===n.categoria_id).nome})]}),e.jsxs("form",{onSubmit:G,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Subcategoria *"}),e.jsx("input",{type:"text",value:n.nome,onChange:z=>C({...n,nome:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:n.descricao,onChange:z=>C({...n,descricao:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",rows:"3"})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n.ativo,onChange:z=>C({...n,ativo:z.target.checked}),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Ativo"})]})}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{f(!1),P()},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:x?"Atualizar":"Criar"})]})]})]})})]})},Ad=()=>{const[s,l]=a.useState([]),[t,m]=a.useState(!0),[r,g]=a.useState(new Set),[o,v]=a.useState(!1),[j,f]=a.useState(!1),[N,d]=a.useState(null),[x,k]=a.useState(null),[w,c]=a.useState(null),[b,p]=a.useState(""),[i,u]=a.useState(""),[n,C]=a.useState({nome:"",ativo:!0}),[h,_]=a.useState({nome:"",especie_id:"",ativo:!0});a.useEffect(()=>{E()},[]);const E=async()=>{try{m(!0);const[J,S]=await Promise.all([F.get("/cadastros/especies"),F.get("/cadastros/racas")]),P=J.data.map(B=>({...B,racas:S.data.filter(y=>y.especie_id===B.id)}));l(P);const G=new Set(P.map(B=>B.id));g(G)}catch(J){console.error("Erro ao carregar dados:",J),p("Erro ao carregar dados")}finally{m(!1)}},$=J=>{const S=new Set(r);S.has(J)?S.delete(J):S.add(J),g(S)},K=(J=null)=>{J?(d(J),C({nome:J.nome,ativo:J.ativo})):(d(null),C({nome:"",ativo:!0})),p(""),v(!0)},te=()=>{v(!1),d(null),C({nome:"",ativo:!0}),p("")},M=async J=>{var S,P;if(J.preventDefault(),p(""),!n.nome||n.nome.trim()===""){p("O nome da espÃ©cie Ã© obrigatÃ³rio");return}try{N?await F.put(`/cadastros/especies/${N.id}`,n):await F.post("/cadastros/especies",n),E(),te()}catch(G){console.error("Erro ao salvar espÃ©cie:",G),p(((P=(S=G.response)==null?void 0:S.data)==null?void 0:P.detail)||"Erro ao salvar espÃ©cie")}},A=async J=>{var S,P;if(window.confirm(`Deseja realmente desativar a espÃ©cie "${J.nome}"?

Isso tambÃ©m desativarÃ¡ todas as raÃ§as vinculadas.`))try{await F.delete(`/cadastros/especies/${J.id}`),E()}catch(G){console.error("Erro ao desativar espÃ©cie:",G),alert(((P=(S=G.response)==null?void 0:S.data)==null?void 0:P.detail)||"Erro ao desativar espÃ©cie")}},Q=(J,S=null)=>{c(J),S?(k(S),_({nome:S.nome,especie_id:S.especie_id,ativo:S.ativo})):(k(null),_({nome:"",especie_id:J.id,ativo:!0})),p(""),f(!0)},re=()=>{f(!1),k(null),c(null),_({nome:"",especie_id:"",ativo:!0}),p("")},q=async J=>{var S,P;if(J.preventDefault(),p(""),!h.nome||h.nome.trim()===""){p("O nome da raÃ§a Ã© obrigatÃ³rio");return}try{const G={nome:h.nome,especie_id:parseInt(h.especie_id),ativo:h.ativo};x?await F.put(`/cadastros/racas/${x.id}`,G):await F.post("/cadastros/racas",G),E(),re()}catch(G){console.error("Erro ao salvar raÃ§a:",G),p(((P=(S=G.response)==null?void 0:S.data)==null?void 0:P.detail)||"Erro ao salvar raÃ§a")}},Z=async J=>{var S,P;if(window.confirm(`Deseja realmente desativar a raÃ§a "${J.nome}"?`))try{await F.delete(`/cadastros/racas/${J.id}`),E()}catch(G){console.error("Erro ao desativar raÃ§a:",G),alert(((P=(S=G.response)==null?void 0:S.data)==null?void 0:P.detail)||"Erro ao desativar raÃ§a")}},R=s.filter(J=>J.nome.toLowerCase().includes(i.toLowerCase())||J.racas.some(S=>S.nome.toLowerCase().includes(i.toLowerCase())));return t?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Carregando espÃ©cies e raÃ§as..."})]}):e.jsxs("div",{className:"cadastros-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"EspÃ©cies e RaÃ§as"}),e.jsx("p",{className:"page-subtitle",children:"Gerencie as espÃ©cies de animais e suas raÃ§as"})]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>K(),children:[e.jsx(Qa,{})," Nova EspÃ©cie"]})]}),e.jsxs("div",{className:"filters-bar",children:[e.jsx("input",{type:"text",placeholder:"Buscar espÃ©cie ou raÃ§a...",value:i,onChange:J=>u(J.target.value),className:"search-input"}),e.jsxs("div",{className:"filter-info",children:[R.length," espÃ©cie",R.length!==1?"s":""]})]}),e.jsx("div",{className:"especies-list",children:R.length===0?e.jsx("div",{className:"empty-state",children:i?"Nenhuma espÃ©cie ou raÃ§a encontrada":"Nenhuma espÃ©cie cadastrada"}):R.map(J=>{const S=r.has(J.id),P=J.racas.filter(G=>G.ativo);return e.jsxs("div",{className:`especie-card ${J.ativo?"":"inactive"}`,children:[e.jsxs("div",{className:"especie-header",children:[e.jsxs("div",{className:"especie-info",onClick:()=>$(J.id),children:[e.jsx("button",{className:"expand-btn",children:S?e.jsx(Os,{size:20}):e.jsx(Ls,{size:20})}),e.jsx(Ea,{className:"especie-icon",size:24}),e.jsxs("div",{children:[e.jsx("h3",{className:"especie-nome",children:J.nome}),e.jsxs("span",{className:"racas-count",children:[P.length," raÃ§a",P.length!==1?"s":""," ativa",P.length!==1?"s":""]})]}),!J.ativo&&e.jsx("span",{className:"badge badge-danger",children:"Inativa"})]}),e.jsxs("div",{className:"especie-actions",children:[e.jsx("button",{className:"btn-icon btn-success",onClick:()=>Q(J),title:"Adicionar RaÃ§a",children:e.jsx(Qa,{})}),e.jsx("button",{className:"btn-icon btn-edit",onClick:()=>K(J),title:"Editar EspÃ©cie",children:e.jsx(_s,{})}),J.ativo&&e.jsx("button",{className:"btn-icon btn-delete",onClick:()=>A(J),title:"Desativar EspÃ©cie",children:e.jsx(ps,{})})]})]}),S&&e.jsx("div",{className:"racas-list",children:J.racas.length===0?e.jsxs("div",{className:"empty-racas",children:[e.jsx("p",{children:"Nenhuma raÃ§a cadastrada ainda"}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>Q(J),children:[e.jsx(Qa,{})," Adicionar Primeira RaÃ§a"]})]}):e.jsx(e.Fragment,{children:J.racas.map(G=>e.jsxs("div",{className:`raca-item ${G.ativo?"":"inactive"}`,children:[e.jsxs("div",{className:"raca-info",children:[e.jsx(yt,{className:"raca-icon",size:16}),e.jsx("span",{className:"raca-nome",children:G.nome}),!G.ativo&&e.jsx("span",{className:"badge badge-sm badge-danger",children:"Inativa"})]}),e.jsxs("div",{className:"raca-actions",children:[e.jsx("button",{className:"btn-icon-sm btn-edit",onClick:()=>Q(J,G),title:"Editar RaÃ§a",children:e.jsx(_s,{size:14})}),G.ativo&&e.jsx("button",{className:"btn-icon-sm btn-delete",onClick:()=>Z(G),title:"Desativar RaÃ§a",children:e.jsx(ps,{size:14})})]})]},G.id))})})]},J.id)})}),o&&e.jsx("div",{className:"modal-overlay",onClick:te,children:e.jsxs("div",{className:"modal-content",onClick:J=>J.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:N?"Editar EspÃ©cie":"Nova EspÃ©cie"}),e.jsx("button",{className:"btn-close",onClick:te,children:e.jsx(us,{})})]}),e.jsxs("form",{onSubmit:M,children:[e.jsxs("div",{className:"modal-body",children:[b&&e.jsxs("div",{className:"alert alert-danger",children:[e.jsx(Na,{})," ",b]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nome da EspÃ©cie *"}),e.jsx("input",{type:"text",value:n.nome,onChange:J=>C({...n,nome:J.target.value}),placeholder:"Ex: CÃ£o, Gato, Ave, RÃ©ptil...",required:!0,autoFocus:!0}),e.jsx("small",{children:"Exemplos: CÃ£o, Gato, Ave, RÃ©ptil, Coelho, Peixe, Hamster"})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:n.ativo,onChange:J=>C({...n,ativo:J.target.checked})}),e.jsx("span",{children:"EspÃ©cie ativa"})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:te,children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"btn btn-primary",children:[e.jsx(Is,{})," Salvar"]})]})]})]})}),j&&e.jsx("div",{className:"modal-overlay",onClick:re,children:e.jsxs("div",{className:"modal-content",onClick:J=>J.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[x?"Editar RaÃ§a":"Nova RaÃ§a",w&&e.jsxs("span",{className:"subtitle",children:[" - ",w.nome]})]}),e.jsx("button",{className:"btn-close",onClick:re,children:e.jsx(us,{})})]}),e.jsxs("form",{onSubmit:q,children:[e.jsxs("div",{className:"modal-body",children:[b&&e.jsxs("div",{className:"alert alert-danger",children:[e.jsx(Na,{})," ",b]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nome da RaÃ§a *"}),e.jsx("input",{type:"text",value:h.nome,onChange:J=>_({...h,nome:J.target.value}),placeholder:"Ex: Labrador, SiamÃªs, SRD...",required:!0,autoFocus:!0}),e.jsx("small",{children:"Exemplos: Labrador, Golden Retriever, SRD (Sem RaÃ§a Definida)"})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:h.ativo,onChange:J=>_({...h,ativo:J.target.checked})}),e.jsx("span",{children:"RaÃ§a ativa"})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:re,children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"btn btn-primary",children:[e.jsx(Is,{})," Salvar"]})]})]})]})})]})},Dd=()=>{var q,Z,R,J;const{clienteId:s}=Bs(),l=fa(),[t,m]=a.useState(null),[r,g]=a.useState(null),[o,v]=a.useState([]),[j,f]=a.useState(null),[N,d]=a.useState(!0),[x,k]=a.useState(""),[w,c]=a.useState({}),[b,p]=a.useState({}),[i,u]=a.useState({}),[n,C]=a.useState({page:1,per_page:20,data_inicio:"",data_fim:"",tipo:"",status:""});a.useEffect(()=>{s&&h()},[s,n]);const h=async()=>{var S,P;try{d(!0),k("");const G=new URLSearchParams;G.append("page",n.page),G.append("per_page",n.per_page),n.data_inicio&&G.append("data_inicio",n.data_inicio),n.data_fim&&G.append("data_fim",n.data_fim),n.tipo&&G.append("tipo",n.tipo),n.status&&G.append("status",n.status);const B=await F.get(`/financeiro/cliente/${s}?${G.toString()}`);m(B.data.cliente),g(B.data.resumo),v(B.data.historico),f(B.data.paginacao)}catch(G){console.error("Erro ao carregar histÃ³rico financeiro:",G),k(((P=(S=G.response)==null?void 0:S.data)==null?void 0:P.detail)||"Erro ao carregar histÃ³rico financeiro")}finally{d(!1)}},_=S=>{C({...n,page:S})},E=S=>{C({...n,...S,page:1})},$=()=>{C({page:1,per_page:20,data_inicio:"",data_fim:"",tipo:"",status:""})},K=async(S,P)=>{var B,y;const G=`${S.tipo}-${P}`;if(w[G]){c({...w,[G]:!1});return}c({...w,[G]:!0}),S.tipo==="venda"&&!b[(B=S.detalhes)==null?void 0:B.venda_id]&&await te((y=S.detalhes)==null?void 0:y.venda_id)},te=async S=>{if(S)try{u({...i,[S]:!0});const P=await F.get(`/vendas/${S}`);p({...b,[S]:P.data})}catch(P){console.error("Erro ao carregar detalhes da venda:",P)}finally{u({...i,[S]:!1})}},M=S=>{S&&l(`/pdv?venda=${S}`)},A=S=>{switch(S){case"venda":return"ðŸ›’";case"devolucao":return"â†©ï¸";case"conta_receber":return"ðŸ“„";case"recebimento":return"ðŸ’°";case"credito":return"ðŸ’³";default:return"ðŸ“Š"}},Q=S=>{switch(S){case"venda":return"Venda";case"devolucao":return"DevoluÃ§Ã£o";case"conta_receber":return"Conta a Receber";case"recebimento":return"Recebimento";case"credito":return"CrÃ©dito";default:return S}},re=S=>({finalizada:"bg-green-100 text-green-700",concluida:"bg-green-100 text-green-700",pendente:"bg-yellow-100 text-yellow-700",paga:"bg-blue-100 text-blue-700",cancelada:"bg-red-100 text-red-700",devolvida:"bg-red-100 text-red-700",efetivado:"bg-green-100 text-green-700"})[S]||"bg-gray-100 text-gray-700";return N&&!o.length?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando histÃ³rico financeiro..."})]})}):x?e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-red-50 border border-red-300 rounded-xl p-6 text-center",children:[e.jsx(Na,{className:"text-red-600 text-4xl mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Erro ao Carregar Dados"}),e.jsx("p",{className:"text-red-600 mb-4",children:x}),e.jsx("button",{onClick:()=>l("/clientes"),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Voltar para Clientes"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>l("/clientes"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4 transition-colors",children:[e.jsx(rt,{}),e.jsx("span",{className:"font-medium",children:"Voltar para Clientes"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(Yt,{className:"text-purple-600"}),"HistÃ³rico Financeiro"]}),t&&e.jsxs("p",{className:"text-lg text-gray-600 mt-2 flex items-center gap-2",children:[e.jsx(is,{className:"text-gray-400"}),t.nome,e.jsxs("span",{className:"text-sm text-gray-400",children:["(",t.codigo,")"]})]})]}),r&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 border border-purple-200 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"CrÃ©dito DisponÃ­vel"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["R$ ",((q=t.credito_atual)==null?void 0:q.toFixed(2).replace(".",","))||"0,00"]})]})]})]}),r&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Total Vendas (90d)"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["R$ ",((Z=r.total_vendas_90d)==null?void 0:Z.toFixed(2).replace(".",","))||"0,00"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Total em Aberto"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:["R$ ",((R=r.total_em_aberto)==null?void 0:R.toFixed(2).replace(".",","))||"0,00"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Ãšltima Compra"}),r.ultima_compra?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["R$ ",((J=r.ultima_compra.valor)==null?void 0:J.toFixed(2).replace(".",","))||"0,00"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(r.ultima_compra.data).toLocaleDateString("pt-BR")})]}):e.jsx("p",{className:"text-sm text-gray-400",children:"Nenhuma compra"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Total TransaÃ§Ãµes"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:r.total_transacoes_historico||0})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 mb-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(kr,{}),"Filtros"]}),e.jsx("button",{onClick:$,className:"text-sm text-gray-600 hover:text-gray-900 underline",children:"Limpar filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:[e.jsx(os,{className:"inline mr-1"}),"Data InÃ­cio"]}),e.jsx("input",{type:"date",value:n.data_inicio,onChange:S=>E({data_inicio:S.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:[e.jsx(os,{className:"inline mr-1"}),"Data Fim"]}),e.jsx("input",{type:"date",value:n.data_fim,onChange:S=>E({data_fim:S.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:n.tipo,onChange:S=>E({tipo:S.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todas as transaÃ§Ãµes"}),e.jsx("option",{value:"venda",children:"ðŸ›’ Vendas"}),e.jsx("option",{value:"devolucao",children:"â†©ï¸ DevoluÃ§Ãµes"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:n.status,onChange:S=>E({status:S.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todos os status"}),e.jsx("option",{value:"aberta",children:"ðŸ“‹ Em Aberto"}),e.jsx("option",{value:"finalizada",children:"âœ… Finalizada (Paga)"}),e.jsx("option",{value:"cancelada",children:"âŒ Cancelada"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Por pÃ¡gina"}),e.jsxs("select",{value:n.per_page,onChange:S=>E({per_page:parseInt(S.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]})]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:N?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Atualizando..."})]}):o.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"DescriÃ§Ã£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map((S,P)=>{var z,ae,W,ne,H;const G=`${S.tipo}-${P}`,B=w[G],y=(z=S.detalhes)==null?void 0:z.venda_id,O=y?b[y]:null;return e.jsxs(ts.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("button",{onClick:()=>K(S,P),className:"text-gray-600 hover:text-purple-600 transition-colors",children:B?e.jsx(Do,{size:18}):e.jsx(Os,{size:18})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:S.data?new Date(S.data).toLocaleDateString("pt-BR"):"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"inline-flex items-center gap-1 text-sm font-medium",children:[e.jsx("span",{className:"text-xl",children:A(S.tipo)}),Q(S.tipo)]})}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-md",children:[e.jsx("div",{className:"truncate",children:S.descricao}),((ae=S.detalhes)==null?void 0:ae.numero_venda)&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["#",S.detalhes.numero_venda]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:e.jsxs("span",{className:`font-bold ${S.valor<0?"text-red-600":"text-green-600"}`,children:[S.valor<0?"- ":"+ ","R$ ",Math.abs(S.valor).toFixed(2).replace(".",",")]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${re(S.status)}`,children:S.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:S.tipo==="venda"&&y&&e.jsxs("button",{onClick:()=>M(y),className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded-lg transition-colors flex items-center gap-1 mx-auto",children:[e.jsx(st,{size:14}),"Ver no PDV"]})})]}),B&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-4 bg-gray-50",children:S.tipo==="venda"&&y?i[y]?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Carregando detalhes..."})]}):O?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 pb-3",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(st,{className:"text-blue-600"}),"Detalhes da Venda #",O.numero_venda]}),e.jsx("div",{className:"text-sm text-gray-600",children:new Date(O.data_venda).toLocaleString("pt-BR")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 bg-white rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"ðŸ’° Total da Venda"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["R$ ",(W=O.total)==null?void 0:W.toFixed(2).replace(".",",")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"ðŸ“¦ Total de Itens"}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:((ne=O.itens)==null?void 0:ne.length)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"ðŸŽ¯ Desconto Total"}),e.jsxs("p",{className:"text-xl font-bold text-orange-600",children:["R$ ",(O.desconto||0).toFixed(2).replace(".",",")]})]})]}),O.itens&&O.itens.length>0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-blue-50 px-4 py-2 border-b border-gray-200",children:e.jsxs("h5",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Et,{className:"text-blue-600"}),"Produtos Vendidos"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:"Produto"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-500",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"PreÃ§o Unit."}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Desc. %"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Desc. R$"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Subtotal"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:O.itens.map((ee,de)=>{var ue,Re;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:ee.produto_nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-center font-semibold text-gray-700",children:ee.quantidade}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-gray-700",children:["R$ ",(ue=ee.preco_unitario)==null?void 0:ue.toFixed(2).replace(".",",")]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-orange-600",children:[ee.desconto_percentual||0,"%"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-orange-600",children:["R$ ",(ee.desconto||0).toFixed(2).replace(".",",")]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right font-bold text-green-600",children:["R$ ",(Re=ee.subtotal)==null?void 0:Re.toFixed(2).replace(".",",")]})]},de)})}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Total Geral:"}),e.jsxs("td",{className:"px-4 py-3 text-right text-lg font-bold text-green-600",children:["R$ ",(H=O.total)==null?void 0:H.toFixed(2).replace(".",",")]})]})})]})})]}),O.observacoes&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-yellow-800 mb-1",children:"ðŸ“ ObservaÃ§Ãµes:"}),e.jsx("p",{className:"text-sm text-gray-700",children:O.observacoes})]})]}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"NÃ£o foi possÃ­vel carregar os detalhes da venda"})}):e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("h5",{className:"font-semibold text-gray-800 mb-3",children:"Detalhes da TransaÃ§Ã£o"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 text-sm",children:Object.entries(S.detalhes||{}).map(([ee,de])=>e.jsxs("div",{className:"flex justify-between border-b border-gray-100 pb-2",children:[e.jsxs("span",{className:"text-gray-600 capitalize",children:[ee.replace(/_/g," "),":"]}),e.jsx("span",{className:"font-semibold text-gray-900",children:typeof de=="number"?`R$ ${de.toFixed(2).replace(".",",")}`:(de==null?void 0:de.toString())||"N/A"})]},ee))})]})})})]},G)})})]})}),j&&j.total_paginas>1&&e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",(j.pagina_atual-1)*j.itens_por_pagina+1," a"," ",Math.min(j.pagina_atual*j.itens_por_pagina,j.total_itens)," de"," ",j.total_itens," transaÃ§Ãµes"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>_(j.pagina_atual-1),disabled:!j.tem_anterior,className:`px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${j.tem_anterior?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(Oo,{}),"Anterior"]}),e.jsxs("span",{className:"px-4 py-2 text-sm text-gray-700",children:["PÃ¡gina ",j.pagina_atual," de ",j.total_paginas]}),e.jsxs("button",{onClick:()=>_(j.pagina_atual+1),disabled:!j.tem_proxima,className:`px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${j.tem_proxima?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:["PrÃ³xima",e.jsx(Ls,{})]})]})]})})]}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx(Ga,{className:"text-gray-300 text-6xl mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Nenhuma transaÃ§Ã£o encontrada"}),e.jsx("p",{className:"text-gray-500 mb-6",children:n.tipo||n.status||n.data_inicio||n.data_fim?"Tente ajustar os filtros para ver mais resultados":"Ainda nÃ£o hÃ¡ transaÃ§Ãµes financeiras para este cliente"}),(n.tipo||n.status||n.data_inicio||n.data_fim)&&e.jsx("button",{onClick:$,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Limpar Filtros"})]})})]})})},Md={vips_inativos:{titulo:"VIPs em Risco",descricao:"Clientes VIP sem compra hÃ¡ mais de 20 dias",icone:So,cor:"red",bgGradient:"from-red-500 to-red-600",bgLight:"bg-red-50",borderLight:"border-red-200",textColor:"text-red-700"},clientes_inativos:{titulo:"Clientes Inativos",descricao:"Sem compra hÃ¡ mais de 90 dias",icone:qs,cor:"orange",bgGradient:"from-orange-500 to-orange-600",bgLight:"bg-orange-50",borderLight:"border-orange-200",textColor:"text-orange-700"},clientes_endividados:{titulo:"Alto Endividamento",descricao:"Clientes com saldo devedor significativo",icone:Ga,cor:"yellow",bgGradient:"from-yellow-500 to-yellow-600",bgLight:"bg-yellow-50",borderLight:"border-yellow-200",textColor:"text-yellow-700"},oportunidades_novos:{titulo:"Novos Promissores",descricao:"Clientes novos com ticket alto",icone:Vs,cor:"green",bgGradient:"from-green-500 to-green-600",bgLight:"bg-green-50",borderLight:"border-green-200",textColor:"text-green-700"},pets_sem_eventos:{titulo:"Pets Inativos",descricao:"Sem consulta hÃ¡ mais de 60 dias",icone:Cr,cor:"purple",bgGradient:"from-purple-500 to-purple-600",bgLight:"bg-purple-50",borderLight:"border-purple-200",textColor:"text-purple-700"},whatsapp_inativo:{titulo:"WhatsApp Faltando",descricao:"Clientes sem nÃºmero cadastrado",icone:Ns,cor:"blue",bgGradient:"from-blue-500 to-blue-600",bgLight:"bg-blue-50",borderLight:"border-blue-200",textColor:"text-blue-700"}};function Xs({tipo:s,dados:l,onClick:t}){const m=Md[s],r=(m==null?void 0:m.icone)||zs,g=l||{quantidade:0,impacto:null};return e.jsxs("div",{className:`${m.bgLight} border-2 ${m.borderLight} rounded-xl p-6 hover:shadow-lg transition-all cursor-pointer`,onClick:t,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`p-3 bg-gradient-to-br ${m.bgGradient} rounded-lg`,children:e.jsx(r,{className:"text-white",size:24})}),e.jsx(Jt,{className:m.textColor,size:20})]}),e.jsx("h3",{className:`text-2xl font-bold ${m.textColor} mb-1`,children:(g==null?void 0:g.quantidade)??0}),e.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:m.titulo}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:m.descricao}),(g==null?void 0:g.impacto)&&e.jsx("div",{className:"pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Impacto estimado:"}),e.jsx("span",{className:`font-bold ${m.textColor}`,children:g.impacto})]})}),e.jsxs("button",{className:`mt-3 w-full py-2 text-sm font-medium ${m.textColor} hover:bg-white rounded-lg transition-colors flex items-center justify-center gap-2`,children:["Ver detalhes",e.jsx(Jt,{size:14})]})]})}function Ld(){var d,x,k,w,c;const s=fa(),[l,t]=a.useState(!0),[m,r]=a.useState(null),[g,o]=a.useState(null);a.useEffect(()=>{v()},[]);const v=async()=>{var b;try{t(!0);const[p,i]=await Promise.all([F.get("/clientes/"),F.get("/segmentacao/estatisticas")]),u=p==null?void 0:p.data,n=Array.isArray(u)?u:Array.isArray(u==null?void 0:u.data)?u.data:[],h=(i==null?void 0:i.data)||{};console.log("ðŸ“Š [Dashboard] Clientes carregados:",n.length);const _=j(n,h);r(_),o(new Date)}catch(p){console.error("Erro ao carregar dashboard:",p),r({vips_inativos:{quantidade:0,clientes:[],impacto:"R$ 0"},clientes_inativos:{quantidade:0,clientes:[],diasMedia:0},clientes_novos:{quantidade:0,clientes:[]},oportunidades_upsell:{quantidade:0,clientes:[],potencial:"R$ 0"},clientes_risco_churn:{quantidade:0,clientes:[],diasMedia:0}}),((b=p.response)==null?void 0:b.status)===403?alert("VocÃª nÃ£o tem permissÃ£o para acessar o dashboard gerencial"):alert("Erro ao carregar dashboard gerencial")}finally{t(!1)}},j=(b,p)=>{const i=new Date,n=(Array.isArray(b)?b:[]).filter(Z=>(Z==null?void 0:Z.tipo_cadastro)==="cliente"),C=n.filter(Z=>{const R=(Z==null?void 0:Z.segmento)||"Regular",J=(Z==null?void 0:Z.dias_desde_ultima_compra)??999;return R==="VIP"&&J>20}),h=C.reduce((Z,R)=>Z+((R==null?void 0:R.total_90d)??0),0),_=n.filter(Z=>((Z==null?void 0:Z.dias_desde_ultima_compra)??0)>90),E=_.reduce((Z,R)=>Z+((R==null?void 0:R.total_historico)??0),0),$=n.filter(Z=>((Z==null?void 0:Z.saldo_devedor)??0)>0),K=$.reduce((Z,R)=>Z+((R==null?void 0:R.saldo_devedor)??0),0),te=n.filter(Z=>{const R=(Z==null?void 0:Z.segmento)||"Regular",J=(Z==null?void 0:Z.ticket_medio)??0;return R==="Novo"&&J>200}),M=te.reduce((Z,R)=>Z+((R==null?void 0:R.ticket_medio)??0),0),A=n.filter(Z=>Array.isArray(Z==null?void 0:Z.pets)&&Z.pets.length>0);let Q=0,re=[];A.forEach(Z=>{const R=Array.isArray(Z==null?void 0:Z.pets)?Z.pets:[];if(R.length>0){const J=R.filter(S=>{if(!(S!=null&&S.ultima_consulta))return!0;const P=new Date(S.ultima_consulta);return Math.floor((i-P)/(1e3*60*60*24))>60});J.length>0&&(Q+=J.length,re.push(Z))}});const q=n.filter(Z=>!(Z!=null&&Z.celular)||Z.celular.trim()==="");return{vips_inativos:{quantidade:(C==null?void 0:C.length)??0,impacto:`R$ ${(h??0).toFixed(2)}`,clientes:C},clientes_inativos:{quantidade:(_==null?void 0:_.length)??0,impacto:`R$ ${((E??0)/12).toFixed(2)}/mÃªs`,clientes:_},clientes_endividados:{quantidade:($==null?void 0:$.length)??0,impacto:`R$ ${(K??0).toFixed(2)}`,clientes:$},oportunidades_novos:{quantidade:(te==null?void 0:te.length)??0,impacto:`~R$ ${(M??0).toFixed(0)}/mÃªs`,clientes:te},pets_sem_eventos:{quantidade:Q??0,impacto:`${(re==null?void 0:re.length)??0} donos`,clientes:re},whatsapp_inativo:{quantidade:(q==null?void 0:q.length)??0,impacto:"Canal perdido",clientes:q},total_clientes:(n==null?void 0:n.length)??0,estatisticas:p??{}}},f=b=>{s("/pessoas",{state:{filtro:b}})},N=()=>{v()};return l?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Carregando dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-6",children:[e.jsx("div",{className:"max-w-7xl mx-auto mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:"ðŸ“Š Dashboard Gerencial"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["VisÃ£o executiva do negÃ³cio â€¢ ",(m==null?void 0:m.total_clientes)||0," clientes ativos"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[g&&e.jsxs("div",{className:"text-sm text-gray-500",children:["Atualizado Ã s ",g.toLocaleTimeString("pt-BR")]}),e.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(vt,{size:18}),"Atualizar"]})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(Xs,{tipo:"vips_inativos",dados:(m==null?void 0:m.vips_inativos)||{quantidade:0,impacto:"R$ 0",clientes:[]},onClick:()=>f("vips_inativos")}),e.jsx(Xs,{tipo:"clientes_inativos",dados:(m==null?void 0:m.clientes_inativos)||{quantidade:0,impacto:"R$ 0",clientes:[]},onClick:()=>f("clientes_inativos")}),e.jsx(Xs,{tipo:"clientes_endividados",dados:(m==null?void 0:m.clientes_endividados)||{quantidade:0,impacto:"R$ 0",clientes:[]},onClick:()=>f("clientes_endividados")}),e.jsx(Xs,{tipo:"oportunidades_novos",dados:(m==null?void 0:m.oportunidades_novos)||{quantidade:0,impacto:"R$ 0",clientes:[]},onClick:()=>f("oportunidades_novos")}),e.jsx(Xs,{tipo:"pets_sem_eventos",dados:(m==null?void 0:m.pets_sem_eventos)||{quantidade:0,impacto:"0 donos",clientes:[]},onClick:()=>f("pets_sem_eventos")}),e.jsx(Xs,{tipo:"whatsapp_inativo",dados:(m==null?void 0:m.whatsapp_inativo)||{quantidade:0,impacto:"Canal perdido",clientes:[]},onClick:()=>f("whatsapp_inativo")})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(zs,{className:"text-blue-600",size:24}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Resumo Executivo"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"border-l-4 border-red-500 pl-4",children:[e.jsx("h3",{className:"font-semibold text-red-700 mb-2",children:"ðŸš¨ AÃ§Ã£o Urgente"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("strong",{children:((d=m==null?void 0:m.vips_inativos)==null?void 0:d.quantidade)??0})," clientes VIP em risco de churn"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Contate imediatamente para evitar perda de ",((x=m==null?void 0:m.vips_inativos)==null?void 0:x.impacto)??"R$ 0"," em receita"]})]}),e.jsxs("div",{className:"border-l-4 border-yellow-500 pl-4",children:[e.jsx("h3",{className:"font-semibold text-yellow-700 mb-2",children:"âš ï¸ AtenÃ§Ã£o"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("strong",{children:((k=m==null?void 0:m.clientes_endividados)==null?void 0:k.quantidade)??0})," clientes endividados"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Total de ",((w=m==null?void 0:m.clientes_endividados)==null?void 0:w.impacto)??"R$ 0"," em aberto â€¢ Avaliar condiÃ§Ãµes"]})]}),e.jsxs("div",{className:"border-l-4 border-green-500 pl-4",children:[e.jsx("h3",{className:"font-semibold text-green-700 mb-2",children:"ðŸ’¡ Oportunidade"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("strong",{children:((c=m==null?void 0:m.oportunidades_novos)==null?void 0:c.quantidade)??0})," novos clientes promissores"]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Potencial de fidelizaÃ§Ã£o â€¢ Ticket mÃ©dio alto"})]})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(zs,{size:12}),"Dados calculados em tempo real com base em regras de negÃ³cio prÃ©-definidas"]})})]})]})]})}function qd(){const[s,l]=a.useState([]),[t,m]=a.useState([]),[r,g]=a.useState(!0),[o,v]=a.useState(!1),[j,f]=a.useState(!1),[N,d]=a.useState({email:"",password:"",role_id:null});async function x(){try{g(!0);const b=await F.get("/usuarios");l(b.data)}catch(b){console.error("Erro ao carregar usuÃ¡rios:",b),alert("Erro ao carregar usuÃ¡rios")}finally{g(!1)}}async function k(){try{const b=await F.get("/roles");m(b.data)}catch(b){console.error("Erro ao carregar roles:",b)}}async function w(b,p){try{await F.patch(`/usuarios/${b}/status`,{is_active:!p}),x()}catch(i){console.error("Erro ao alterar status:",i),alert("Erro ao alterar status do usuÃ¡rio")}}async function c(b){var p,i;b.preventDefault();try{await F.post("/usuarios",N),alert("UsuÃ¡rio criado com sucesso!"),v(!1),d({email:"",password:"",role_id:null}),x()}catch(u){console.error("Erro ao criar usuÃ¡rio:",u),alert(((i=(p=u.response)==null?void 0:p.data)==null?void 0:i.detail)||"Erro ao criar usuÃ¡rio")}}return a.useEffect(()=>{x(),k()},[]),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"UsuÃ¡rios"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie os usuÃ¡rios do sistema"})]}),e.jsxs("button",{onClick:()=>{d({email:"",password:"",role_id:null}),f(!1),v(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Novo UsuÃ¡rio"]})]}),r?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Carregando..."})]}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"px-6 py-12 text-center text-gray-500",children:"Nenhum usuÃ¡rio encontrado"})}):s.map(b=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:b.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:b.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${b.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:b.is_active?"Ativo":"Inativo"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:e.jsx("button",{onClick:()=>w(b.user_id,b.is_active),className:`px-3 py-1 rounded text-white transition-colors ${b.is_active?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"}`,children:b.is_active?"Desativar":"Ativar"})})]},b.user_id))})]})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Novo UsuÃ¡rio"}),e.jsx("button",{onClick:()=>{v(!1),d({email:"",password:"",role:"user"})},className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{type:"email",required:!0,value:N.email,onChange:b=>d({...N,email:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"usuario@exemplo.com",autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Senha *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:j?"text":"password",required:!0,value:N.password,onChange:b=>d({...N,password:b.target.value}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"MÃ­nimo 6 caracteres",autoComplete:"new-password"}),e.jsx("button",{type:"button",onClick:()=>f(!j),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:j?e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),e.jsx("select",{value:N.role_id||"",onChange:b=>d({...N,role_id:parseInt(b.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:t.length===0?e.jsx("option",{value:"",children:"Carregando..."}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",children:"Selecione uma role..."}),t.map(b=>e.jsx("option",{value:b.role_id,children:b.nome},b.role_id))]})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{v(!1),d({email:"",password:"",role_id:null})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Criar UsuÃ¡rio"})]})]})]})})})]})}function zd(){const[s,l]=a.useState([]),[t,m]=a.useState([]),[r,g]=a.useState(!0),[o,v]=a.useState(!1),[j,f]=a.useState(null),[N,d]=a.useState({}),[x,k]=a.useState({nome:"",descricao:"",permissions:[]});async function w(){try{g(!0);const[$,K]=await Promise.all([F.get("/roles"),F.get("/permissions")]);l($.data),m(K.data)}catch($){console.error("Erro ao carregar dados:",$),alert("Erro ao carregar dados")}finally{g(!1)}}async function c($){var K,te;$.preventDefault();try{j?(await F.put(`/roles/${j.role_id}`,x),alert("Role atualizada com sucesso!")):(await F.post("/roles",x),alert("Role criada com sucesso!")),v(!1),f(null),k({nome:"",descricao:"",permissions:[]}),w()}catch(M){console.error("Erro ao salvar role:",M),alert(((te=(K=M.response)==null?void 0:K.data)==null?void 0:te.detail)||"Erro ao salvar role")}}function b($){f($),k({nome:$.nome,descricao:$.descricao||"",permissions:$.permissions.map(K=>K.permission_id)}),v(!0)}function p($){k(K=>({...K,permissions:K.permissions.includes($)?K.permissions.filter(te=>te!==$):[...K.permissions,$]}))}function i(){const $={};return t.forEach(K=>{const te=K.nome&&K.nome.includes(".")?K.nome.split(".")[0]:"outras";$[te]||($[te]=[]),$[te].push(K)}),$}function u($){return{financeiro:"Financeiro",comissoes:"ComissÃµes",entregas:"Entregas",compras:"Compras",cadastros:"Cadastros",configuracoes:"ConfiguraÃ§Ãµes",rh:"Recursos Humanos",vendas:"Vendas",usuarios:"UsuÃ¡rios",relatorios:"RelatÃ³rios",ia:"InteligÃªncia Artificial",outras:"Outras"}[$]||$.charAt(0).toUpperCase()+$.slice(1)}function n($){d(K=>({...K,[$]:!K[$]}))}function C($,K){const te=K.map(A=>A.permission_id),M=te.every(A=>x.permissions.includes(A));k(A=>({...A,permissions:M?A.permissions.filter(Q=>!te.includes(Q)):[...new Set([...A.permissions,...te])]}))}function h($){return $.every(K=>x.permissions.includes(K.permission_id))}function _($){const K=$.filter(te=>x.permissions.includes(te.permission_id));return K.length>0&&K.length<$.length}async function E($){if(confirm("Tem certeza que deseja excluir esta role?"))try{await F.delete(`/roles/${$}`),alert("Role excluÃ­da com sucesso!"),w()}catch(K){console.error("Erro ao excluir role:",K),alert("Erro ao excluir role")}}return a.useEffect(()=>{w()},[]),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"PermissÃµes (Roles)"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie roles e suas permissÃµes"})]}),e.jsxs("button",{onClick:()=>{f(null),k({nome:"",descricao:"",permissions:[]}),v(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Nova Role"]})]}),r?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Carregando..."})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:s.length===0?e.jsx("div",{className:"col-span-full text-center py-12 text-gray-500",children:"Nenhuma role encontrada"}):s.map($=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:$.nome}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:$.descricao})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b($),className:"text-blue-600 hover:text-blue-700",title:"Editar",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>E($.role_id),className:"text-red-600 hover:text-red-700",title:"Excluir",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-2",children:"PermissÃµes:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:$.permissions.length===0?e.jsx("span",{className:"text-sm text-gray-400",children:"Nenhuma permissÃ£o"}):$.permissions.map(K=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:K.nome},K.permission_id))})]})]},$.role_id))}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:j?"Editar Role":"Nova Role"}),e.jsx("button",{onClick:()=>{v(!1),f(null)},className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Role *"}),e.jsx("input",{type:"text",required:!0,value:x.nome,onChange:$=>k({...x,nome:$.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: Gerente, Vendedor, etc"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:x.descricao||"",onChange:$=>k({...x,descricao:$.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"2",placeholder:"DescriÃ§Ã£o da role"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PermissÃµes *"}),e.jsx("div",{className:"border border-gray-300 rounded-lg p-4 max-h-96 overflow-y-auto",children:t.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhuma permissÃ£o disponÃ­vel"}):e.jsx("div",{className:"space-y-1",children:Object.entries(i()).map(([$,K])=>{const te=N[$],M=h(K),A=_(K);return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-center p-3 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>n($),className:"text-gray-600 hover:text-gray-900 transition-colors",children:te?e.jsx(Os,{className:"w-5 h-5"}):e.jsx(Ls,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center flex-1 cursor-pointer",onClick:()=>C($,K),children:[e.jsx("input",{type:"checkbox",checked:M,ref:Q=>{Q&&(Q.indeterminate=A)},onChange:()=>{},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-3 font-medium text-gray-900",children:u($)}),e.jsxs("span",{className:"ml-auto text-xs text-gray-500",children:["(",K.filter(Q=>x.permissions.includes(Q.permission_id)).length,"/",K.length,")"]})]})]})}),te&&e.jsx("div",{className:"bg-white p-3 space-y-1 border-t border-gray-200",children:K.map(Q=>e.jsxs("label",{className:"flex items-start cursor-pointer hover:bg-gray-50 p-2 rounded ml-4",children:[e.jsx("input",{type:"checkbox",checked:x.permissions.includes(Q.permission_id),onChange:()=>p(Q.permission_id),className:"mt-1 mr-3 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:Q.nome.split(".")[1]||Q.nome}),Q.descricao&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:Q.descricao})]})]},Q.permission_id))})]},$)})})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{v(!1),f(null)},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[j?"Atualizar":"Criar"," Role"]})]})]})]})})})]})}function Id(){console.log("ðŸ”§ Configuracoes carregou - Total de cards:",7);const s=[{title:"UsuÃ¡rios",description:"Gerenciar usuÃ¡rios do sistema",icon:wo,link:"/admin/usuarios",color:"blue"},{title:"PermissÃµes",description:"Gerenciar roles e permissÃµes",icon:ko,link:"/admin/roles",color:"purple"},{title:"ConfiguraÃ§Ãµes Fiscais",description:"Configurar tributaÃ§Ã£o padrÃ£o da empresa",icon:bt,link:"/configuracoes/fiscal",color:"green"},{title:"Entregas",description:"Configurar entregadores e ponto inicial de rotas",icon:Zs,link:"/configuracoes/entregas",color:"blue"},{title:"Custos da Moto",description:"Configurar custos operacionais da moto de entregas",icon:bt,link:"/configuracoes/custos-moto",color:"orange"},{title:"Estoque",description:"Configurar comportamento do controle de estoque",icon:Et,link:"/configuracoes/estoque",color:"indigo"},{title:"Sistema",description:"ConfiguraÃ§Ãµes gerais do sistema",icon:bt,link:"#",color:"gray",disabled:!0}];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ConfiguraÃ§Ãµes"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gerencie usuÃ¡rios, permissÃµes e configuraÃ§Ãµes do sistema"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(l=>{const t=l.icon,m={blue:"bg-blue-50 text-blue-600 hover:bg-blue-100",purple:"bg-purple-50 text-purple-600 hover:bg-purple-100",green:"bg-green-50 text-green-600 hover:bg-green-100",orange:"bg-orange-50 text-orange-600 hover:bg-orange-100",indigo:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100",gray:"bg-gray-50 text-gray-400"};return l.disabled?e.jsxs("div",{className:`p-6 rounded-lg border-2 border-gray-200 ${m[l.color]} cursor-not-allowed opacity-60`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(t,{className:"text-2xl"}),e.jsx("h3",{className:"text-lg font-semibold",children:l.title})]}),e.jsx("p",{className:"text-sm text-gray-500",children:l.description}),e.jsx("span",{className:"text-xs text-gray-400 mt-2 block",children:"Em breve"})]},l.title):e.jsxs(tt,{to:l.link,className:`p-6 rounded-lg border-2 border-gray-200 ${m[l.color]} transition-all hover:shadow-lg`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(t,{className:"text-2xl"}),e.jsx("h3",{className:"text-lg font-semibold",children:l.title})]}),e.jsx("p",{className:"text-sm opacity-80",children:l.description}),e.jsxs("div",{className:"mt-4 flex items-center text-sm font-medium",children:["Acessar",e.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]},l.title)})})]})}function Td(){const[s,l]=a.useState(!0),[t,m]=a.useState(!1),[r,g]=a.useState(!1),o=C=>{if(console.log("ðŸ”§ normalizeCnaesSecundarios chamado com:",C,"tipo:",typeof C),!C)return[];if(Array.isArray(C))return C;if(typeof C=="string")try{const h=JSON.parse(C);return Array.isArray(h)?h:[]}catch{return[]}return console.warn("âš ï¸ Valor inesperado para CNAEs, retornando array vazio"),[]},[v,j]=a.useState(""),[f,N]=a.useState([]),[d,x]=a.useState({cnpj:"",razao_social:"",nome_fantasia:"",inscricao_estadual:"",inscricao_municipal:"",email:"",telefone:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",uf:""}),[k,w]=a.useState({regime_tributario:"",simples_anexo:"I",aliquota_simples_vigente:0,aliquota_simples_sugerida:0,cnae_principal:"",cnae_descricao:"",cnaes_secundarios:[],uf:""});a.useEffect(()=>{async function C(){try{const h=await la.get("/empresa/fiscal");console.log("ðŸ“Š Dados fiscais carregados:",h.data),console.log("ðŸ” cnaes_secundarios recebido:",h.data.cnaes_secundarios),console.log("ðŸ” Tipo:",typeof h.data.cnaes_secundarios),console.log("ðŸ” Ã‰ array?",Array.isArray(h.data.cnaes_secundarios));const _=o(h.data.cnaes_secundarios);console.log("âœ… ApÃ³s normalizar:",_),console.log("âœ… Ã‰ array agora?",Array.isArray(_)),w({regime_tributario:h.data.regime_tributario||"",simples_anexo:h.data.simples_anexo||"I",aliquota_simples_vigente:h.data.aliquota_simples_vigente??0,aliquota_simples_sugerida:h.data.aliquota_simples_sugerida??0,cnae_principal:h.data.cnae_principal||"",cnae_descricao:h.data.cnae_descricao||"",cnaes_secundarios:_,uf:h.data.uf||""}),h.data.cnae_descricao&&j(h.data.cnae_descricao),N(_);try{const E=await la.get("/empresa/dados-cadastrais");E.data&&x({cnpj:E.data.cnpj||"",razao_social:E.data.razao_social||"",nome_fantasia:E.data.nome_fantasia||"",inscricao_estadual:E.data.inscricao_estadual||"",inscricao_municipal:E.data.inscricao_municipal||"",email:E.data.email||"",telefone:E.data.telefone||"",cep:E.data.cep||"",endereco:E.data.endereco||"",numero:E.data.numero||"",complemento:E.data.complemento||"",bairro:E.data.bairro||"",cidade:E.data.cidade||"",uf:E.data.uf||""})}catch{console.log("Endpoint de dados cadastrais nÃ£o existe ainda")}}catch(h){console.error("âŒ Erro ao carregar configuraÃ§Ãµes:",h),console.error("âŒ Resposta completa:",h.response),Se.error("Erro ao carregar configuraÃ§Ãµes da empresa"),N([]),w(_=>({..._,cnaes_secundarios:[]}))}finally{l(!1)}}C()},[]);function c(C){const{name:h,value:_}=C.target;w(E=>{const $={...E,[h]:_};return h==="regime_tributario"&&_==="Simples Nacional"&&((!$.simples_anexo||$.simples_anexo==="")&&($.simples_anexo="I"),(!$.aliquota_simples_vigente||$.aliquota_simples_vigente===0)&&($.aliquota_simples_vigente=4)),$})}function b(C){const{name:h,value:_}=C.target;x(E=>({...E,[h]:_}))}async function p(){const C=d.cnpj.replace(/[^0-9]/g,"");if(C.length!==14){Se.error("CNPJ deve ter 14 dÃ­gitos");return}g(!0);try{const h=await fetch(`https://brasilapi.com.br/api/cnpj/v1/${C}`);if(!h.ok)throw new Error("CNPJ nÃ£o encontrado");const _=await h.json();console.log("ðŸ” Dados completos da API:",_),console.log("ðŸ“‹ CNAE Fiscal:",_.cnae_fiscal),console.log("ðŸ“‹ CNAE DescriÃ§Ã£o:",_.cnae_fiscal_descricao),console.log("ðŸ“‹ CNAEs SecundÃ¡rios:",_.cnaes_secundarios);const E={...d};_.razao_social&&(E.razao_social=_.razao_social),_.nome_fantasia&&(E.nome_fantasia=_.nome_fantasia),_.email&&(E.email=_.email),_.inscricao_estadual&&(E.inscricao_estadual=_.inscricao_estadual);const $=_.ddd_telefone_1||_.telefone;if($&&(E.telefone=$),_.cep&&(E.cep=_.cep.replace(/[^0-9]/g,"")),_.logradouro&&(E.endereco=_.logradouro),_.numero&&(E.numero=_.numero),_.complemento&&(E.complemento=_.complemento),_.bairro&&(E.bairro=_.bairro),_.municipio&&(E.cidade=_.municipio),_.uf&&(E.uf=_.uf),x(E),_.cnae_fiscal){const K=_.cnae_fiscal.toString();console.log("âœ… CNAE encontrado:",K);const te=o(_.cnaes_secundarios);w(M=>({...M,cnae_principal:K,cnae_descricao:_.cnae_fiscal_descricao||"",cnaes_secundarios:te})),_.cnae_fiscal_descricao&&j(_.cnae_fiscal_descricao),N(te),te.length>0&&console.log(`ðŸ“‹ Encontrados ${te.length} CNAEs secundÃ¡rios`)}Se.success("âœ… Dados preenchidos com sucesso!")}catch(h){console.error("Erro ao buscar CNPJ:",h),Se.error("âŒ Erro ao buscar CNPJ. Verifique o nÃºmero.")}finally{g(!1)}}async function i(){var C,h;m(!0);try{const _={...k,cnaes_secundarios:o(k.cnaes_secundarios)};console.log("ðŸ’¾ Salvando dados fiscais:",_),console.log("ðŸ“‹ CNAE DescriÃ§Ã£o no form:",k.cnae_descricao),console.log("ðŸ“‹ CNAEs SecundÃ¡rios no form:",k.cnaes_secundarios);const E=await la.put("/empresa/fiscal",_);console.log("âœ… Resposta do servidor (fiscal):",E.data);try{console.log("ðŸ’¾ Salvando dados cadastrais:",d),await la.put("/empresa/dados-cadastrais",d)}catch{console.log("Endpoint de dados cadastrais nÃ£o implementado ainda")}Se.success("ConfiguraÃ§Ãµes salvas com sucesso!")}catch(_){console.error("Erro ao salvar:",_),Se.error(((h=(C=_.response)==null?void 0:C.data)==null?void 0:h.detail)||"Erro ao salvar configuraÃ§Ãµes")}finally{m(!1)}}if(s)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando configuraÃ§Ãµes..."})]})});const u=Array.isArray(f)?f:[],n=k.regime_tributario==="Simples Nacional";return e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ConfiguraÃ§Ã£o da Empresa"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure os dados cadastrais, fiscais e tributÃ¡rios da sua empresa"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"bg-blue-50 px-6 py-4 border-b border-blue-100",children:[e.jsx("h2",{className:"text-lg font-semibold text-blue-900",children:"ðŸ“‹ Dados Cadastrais"}),e.jsxs("p",{className:"text-sm text-blue-700 mt-2",children:["ðŸ’¡ ",e.jsx("strong",{children:"Dica:"})," Digite o CNPJ e clique no botÃ£o ðŸ” para preencher automaticamente os dados da empresa (razÃ£o social, endereÃ§o, CNAEs, etc.) consultando a Receita Federal."]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["CNPJ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",name:"cnpj",value:d.cnpj,onChange:b,placeholder:"00.000.000/0000-00",maxLength:"18",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:p,disabled:r||!d.cnpj,title:"Buscar dados da Receita Federal pelo CNPJ",className:"px-3 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed flex items-center justify-center shadow-md hover:shadow-lg transition-all duration-200",children:r?e.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["RazÃ£o Social ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"razao_social",value:d.razao_social,onChange:b,placeholder:"Nome empresarial completo",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome Fantasia"}),e.jsx("input",{type:"text",name:"nome_fantasia",value:d.nome_fantasia,onChange:b,placeholder:"Nome comercial",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"InscriÃ§Ã£o Estadual"}),e.jsx("input",{type:"text",name:"inscricao_estadual",value:d.inscricao_estadual,onChange:b,placeholder:"000.000.000.000",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"InscriÃ§Ã£o Municipal"}),e.jsx("input",{type:"text",name:"inscricao_municipal",value:d.inscricao_municipal,onChange:b,placeholder:"000000",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail"}),e.jsx("input",{type:"email",name:"email",value:d.email,onChange:b,placeholder:"contato@empresa.com.br",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefone"}),e.jsx("input",{type:"text",name:"telefone",value:d.telefone,onChange:b,placeholder:"(00) 0000-0000",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CEP"}),e.jsx("input",{type:"text",name:"cep",value:d.cep,onChange:b,placeholder:"00000-000",maxLength:"9",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"EndereÃ§o"}),e.jsx("input",{type:"text",name:"endereco",value:d.endereco,onChange:b,placeholder:"Rua, Avenida, etc",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"NÃºmero"}),e.jsx("input",{type:"text",name:"numero",value:d.numero,onChange:b,placeholder:"123",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Complemento"}),e.jsx("input",{type:"text",name:"complemento",value:d.complemento,onChange:b,placeholder:"Sala, Apto, etc",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bairro"}),e.jsx("input",{type:"text",name:"bairro",value:d.bairro,onChange:b,placeholder:"Centro",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"UF"}),e.jsxs("select",{name:"uf",value:d.uf,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"-"}),e.jsx("option",{value:"SP",children:"SP"}),e.jsx("option",{value:"RJ",children:"RJ"}),e.jsx("option",{value:"MG",children:"MG"}),e.jsx("option",{value:"RS",children:"RS"}),e.jsx("option",{value:"PR",children:"PR"}),e.jsx("option",{value:"SC",children:"SC"}),e.jsx("option",{value:"BA",children:"BA"}),e.jsx("option",{value:"PE",children:"PE"}),e.jsx("option",{value:"CE",children:"CE"}),e.jsx("option",{value:"GO",children:"GO"}),e.jsx("option",{value:"DF",children:"DF"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cidade"}),e.jsx("input",{type:"text",name:"cidade",value:d.cidade,onChange:b,placeholder:"Nome da cidade",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-green-50 px-6 py-4 border-b border-green-100",children:e.jsx("h2",{className:"text-lg font-semibold text-green-900",children:"ðŸ’° ConfiguraÃ§Ã£o Fiscal e TributÃ¡ria"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CNAE Principal"}),e.jsx("input",{type:"text",name:"cnae_principal",value:k.cnae_principal,onChange:c,placeholder:"0000-0/00",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),v&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-900 font-medium",children:["ðŸ“‹ ",v]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"CÃ³digo da ClassificaÃ§Ã£o Nacional de Atividades EconÃ´micas"})]}),u.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["CNAEs SecundÃ¡rios (",u.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:u.map((C,h)=>e.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-md text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:(C==null?void 0:C.codigo)||"N/A"}),e.jsxs("span",{className:"text-gray-600",children:[" - ",(C==null?void 0:C.descricao)||"Sem descriÃ§Ã£o"]})]},h))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Regime TributÃ¡rio ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"regime_tributario",value:k.regime_tributario,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Simples Nacional",children:"Simples Nacional"}),e.jsx("option",{value:"Lucro Presumido",children:"Lucro Presumido"}),e.jsx("option",{value:"Lucro Real",children:"Lucro Real"})]})]}),n&&e.jsxs("div",{className:"border-l-4 border-blue-500 bg-blue-50 p-4 space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-blue-900",children:"ParÃ¢metros do Simples Nacional"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Anexo"}),e.jsxs("select",{name:"simples_anexo",value:k.simples_anexo||"I",onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"I",children:"Anexo I - ComÃ©rcio"}),e.jsx("option",{value:"II",children:"Anexo II - IndÃºstria"}),e.jsx("option",{value:"III",children:"Anexo III - ServiÃ§os"}),e.jsx("option",{value:"IV",children:"Anexo IV - ServiÃ§os (ConstruÃ§Ã£o)"}),e.jsx("option",{value:"V",children:"Anexo V - ServiÃ§os (Intelectual)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"AlÃ­quota Vigente (%)"}),e.jsx("input",{type:"number",name:"aliquota_simples_vigente",value:k.aliquota_simples_vigente||"",onChange:c,step:"0.01",min:"0",max:"100",placeholder:"Ex: 4.00",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"AlÃ­quota atual utilizada para calcular provisÃµes"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"AlÃ­quota Sugerida (%)"}),e.jsx("input",{type:"number",name:"aliquota_simples_sugerida",value:k.aliquota_simples_sugerida||"",onChange:c,step:"0.01",min:"0",max:"100",placeholder:"Ex: 4.50",className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"SugestÃ£o baseada no histÃ³rico de fechamentos (informativo)"})]})]})]})]}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx("button",{type:"button",onClick:i,disabled:t,className:"px-8 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium",children:t?"Salvando...":"Salvar Todas as ConfiguraÃ§Ãµes"})})]})]})}function Vd(){const[s,l]=a.useState(!0),[t,m]=a.useState(!1),[r,g]=a.useState(!1),[o,v]=a.useState([]),[j,f]=a.useState({entregador_padrao_id:"",ponto_inicial_rota:"",cep:"",logradouro:"",numero:"",complemento:"",bairro:"",cidade:"",estado:""});a.useEffect(()=>{async function x(){var k,w;try{const[c,b]=await Promise.all([la.get("/configuracoes/entregas"),la.get("/clientes/",{params:{is_entregador:!0,entregador_ativo:!0}})]);f({entregador_padrao_id:c.data.entregador_padrao_id??"",ponto_inicial_rota:"",cep:c.data.cep??"",logradouro:c.data.logradouro??"",numero:c.data.numero??"",complemento:c.data.complemento??"",bairro:c.data.bairro??"",cidade:c.data.cidade??"",estado:c.data.estado??""});const p=Array.isArray(b.data)?b.data:((k=b.data)==null?void 0:k.clientes)||((w=b.data)==null?void 0:w.items)||[];console.log("ðŸšš Entregadores carregados:",p),v(p)}catch(c){console.error("âŒ Erro ao carregar configuraÃ§Ãµes:",c),alert("Erro ao carregar configuraÃ§Ãµes de entrega"),v([])}finally{l(!1)}}x()},[]);async function N(){const x=j.cep.replace(/\D/g,"");if(x.length!==8){alert("CEP invÃ¡lido. Digite 8 dÃ­gitos.");return}g(!0);try{const w=await(await fetch(`https://viacep.com.br/ws/${x}/json/`)).json();if(w.erro){alert("CEP nÃ£o encontrado");return}f({...j,logradouro:w.logradouro||"",bairro:w.bairro||"",cidade:w.localidade||"",estado:w.uf||""})}catch(k){console.error(k),alert("Erro ao buscar CEP")}finally{g(!1)}}async function d(x){x.preventDefault(),m(!0);try{await la.put("/configuracoes/entregas",{entregador_padrao_id:j.entregador_padrao_id||null,cep:j.cep||null,logradouro:j.logradouro||null,numero:j.numero||null,complemento:j.complemento||null,bairro:j.bairro||null,cidade:j.cidade||null,estado:j.estado||null}),alert("ConfiguraÃ§Ãµes salvas com sucesso")}catch(k){console.error(k),alert("Erro ao salvar configuraÃ§Ãµes")}finally{m(!1)}}return s?e.jsx("div",{children:"Carregando..."}):e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"ConfiguraÃ§Ãµes de Entregas"}),e.jsxs("form",{onSubmit:d,style:{maxWidth:600},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Entregador padrÃ£o"}),e.jsxs("select",{value:j.entregador_padrao_id,onChange:x=>f({...j,entregador_padrao_id:x.target.value}),children:[e.jsx("option",{value:"",children:"Nenhum (escolher manualmente)"}),Array.isArray(o)&&o.map(x=>e.jsx("option",{value:x.id,children:x.nome},x.id))]}),e.jsx("p",{style:{fontSize:12,color:"#666",marginTop:5},children:"Este entregador serÃ¡ prÃ©-selecionado ao criar novas rotas."})]}),e.jsx("hr",{style:{margin:"30px 0",border:"none",borderTop:"1px solid #ddd"}}),e.jsx("h3",{style:{marginBottom:20},children:"Ponto Inicial PadrÃ£o da Rota"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"CEP *"}),e.jsxs("div",{style:{display:"flex",gap:10},children:[e.jsx("input",{type:"text",value:j.cep.replace(/(\d{5})(\d)/,"$1-$2"),onChange:x=>{const k=x.target.value.replace(/\D/g,"");f({...j,cep:k.slice(0,8)})},placeholder:"00000-000",maxLength:9,style:{flex:1}}),e.jsx("button",{type:"button",onClick:N,disabled:r||j.cep.length<8,style:{padding:"0 20px",display:"flex",alignItems:"center",gap:5},children:r?"Buscando...":e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"ðŸ”"}),"Buscar"]})})]}),e.jsx("p",{style:{fontSize:12,color:"#666",marginTop:5},children:"Digite o CEP e clique em Buscar para preencher automaticamente."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Logradouro (Rua/Avenida) *"}),e.jsx("input",{type:"text",value:j.logradouro,onChange:x=>f({...j,logradouro:x.target.value}),placeholder:"Ex: Rua das Flores"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:15},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"NÃºmero *"}),e.jsx("input",{type:"text",value:j.numero,onChange:x=>f({...j,numero:x.target.value}),placeholder:"123"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Complemento"}),e.jsx("input",{type:"text",value:j.complemento,onChange:x=>f({...j,complemento:x.target.value}),placeholder:"Ex: Loja 1"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Bairro *"}),e.jsx("input",{type:"text",value:j.bairro,onChange:x=>f({...j,bairro:x.target.value}),placeholder:"Ex: Centro"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:15},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cidade *"}),e.jsx("input",{type:"text",value:j.cidade,onChange:x=>f({...j,cidade:x.target.value}),placeholder:"Ex: SÃ£o Paulo"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Estado *"}),e.jsx("input",{type:"text",value:j.estado,onChange:x=>{const k=x.target.value.toUpperCase().slice(0,2);f({...j,estado:k})},placeholder:"SP",maxLength:2})]})]}),e.jsx("p",{style:{fontSize:12,color:"#666",marginTop:15,marginBottom:20},children:"Este endereÃ§o serÃ¡ usado como ponto de partida para calcular as rotas de entrega."}),e.jsx("button",{type:"submit",disabled:t,style:{backgroundColor:"#2563eb",color:"white",padding:"12px 24px",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"500",cursor:t?"not-allowed":"pointer",opacity:t?.6:1,transition:"all 0.2s"},onMouseOver:x=>{t||(x.target.style.backgroundColor="#1d4ed8")},onMouseOut:x=>{t||(x.target.style.backgroundColor="#2563eb")},children:t?"Salvando...":"Salvar ConfiguraÃ§Ãµes"})]})]})}function Od(){const[s,l]=a.useState({preco_combustivel:"",km_por_litro:"",km_troca_oleo:"",custo_troca_oleo:"",km_troca_pneu_dianteiro:"",custo_pneu_dianteiro:"",km_troca_pneu_traseiro:"",custo_pneu_traseiro:"",km_troca_kit_traseiro:"",custo_kit_traseiro:"",km_manutencao_geral:"",custo_manutencao_geral:"",seguro_mensal:"",licenciamento_mensal:"",ipva_mensal:"",outros_custos_mensais:"",km_medio_mensal:""}),[t,m]=a.useState(!1),r=()=>{const c=parseFloat(s.preco_combustivel)||0,b=parseFloat(s.km_por_litro)||1;return b>0?(c/b).toFixed(4):"0.0000"},g=()=>{const c=parseFloat(s.custo_troca_oleo)||0,b=parseFloat(s.km_troca_oleo)||1;return b>0?(c/b).toFixed(4):"0.0000"},o=()=>{const c=parseFloat(s.custo_pneu_dianteiro)||0,b=parseFloat(s.km_troca_pneu_dianteiro)||1;return b>0?(c/b).toFixed(4):"0.0000"},v=()=>{const c=parseFloat(s.custo_pneu_traseiro)||0,b=parseFloat(s.km_troca_pneu_traseiro)||1;return b>0?(c/b).toFixed(4):"0.0000"},j=()=>{const c=parseFloat(s.custo_kit_traseiro)||0,b=parseFloat(s.km_troca_kit_traseiro)||1;return b>0?(c/b).toFixed(4):"0.0000"},f=()=>{const c=parseFloat(s.custo_manutencao_geral)||0,b=parseFloat(s.km_manutencao_geral)||1;return b>0?(c/b).toFixed(4):"0.0000"},N=()=>{const c=parseFloat(s.seguro_mensal)||0,b=parseFloat(s.licenciamento_mensal)||0,p=parseFloat(s.ipva_mensal)||0,i=parseFloat(s.outros_custos_mensais)||0,u=c+b+p+i,n=parseFloat(s.km_medio_mensal)||1;return n>0?(u/n).toFixed(4):"0.0000"};a.useEffect(()=>{d()},[]);async function d(){const b=(await la.get("/configuracoes/custo-moto")).data;Object.keys(b).forEach(p=>{b[p]===null&&(b[p]="")}),l(b)}function x(c){l({...s,[c.target.name]:c.target.value})}function k(){confirm("Preencher com valores sugeridos baseados em uma moto de entrega tÃ­pica (CG 160, Biz 125, Pop 110)? Os valores atuais serÃ£o substituÃ­dos.")&&l({preco_combustivel:"6.30",km_por_litro:"38",km_troca_oleo:"3000",custo_troca_oleo:"95.00",km_troca_pneu_dianteiro:"14000",custo_pneu_dianteiro:"210.00",km_troca_pneu_traseiro:"10000",custo_pneu_traseiro:"240.00",km_troca_kit_traseiro:"18000",custo_kit_traseiro:"420.00",km_manutencao_geral:"5000",custo_manutencao_geral:"180.00",seguro_mensal:"110.00",licenciamento_mensal:"32.00",ipva_mensal:"55.00",outros_custos_mensais:"75.00",km_medio_mensal:"1200"})}async function w(){m(!0),await la.put("/configuracoes/custo-moto",s),m(!1),alert("Custos da moto salvos com sucesso")}return e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"ðŸï¸ Custos da Moto"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure os custos operacionais da moto de entregas"}),e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-800",children:["ðŸ’¡ ",e.jsx("strong",{children:"Dica:"}),' NÃ£o sabe por onde comeÃ§ar? Clique em "Preencher com Valores Sugeridos" para usar custos tÃ­picos de uma moto de entrega (CG 160, Biz 125, Pop 110 na faixa de R$ 15 mil). Depois ajuste conforme sua realidade.']}),e.jsx("div",{className:"mt-4",children:e.jsxs("button",{onClick:k,className:"px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors shadow-sm flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ’¡"})," Preencher com Valores Sugeridos"]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"â›½"})," CombustÃ­vel"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PreÃ§o por Litro (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"preco_combustivel",placeholder:"Ex: 6.50",value:s.preco_combustivel,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Consumo MÃ©dio (KM/Litro)"}),e.jsx("input",{type:"number",step:"0.1",name:"km_por_litro",placeholder:"Ex: 35",value:s.km_por_litro,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ðŸ’° Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-blue-50 border border-blue-200 rounded-md text-blue-900 font-semibold text-lg",children:["R$ ",r()]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ› ï¸"})," ManutenÃ§Ã£o (Custos VariÃ¡veis por KM)"]}),e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Troca de Ã“leo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"KM para Troca"}),e.jsx("input",{type:"number",name:"km_troca_oleo",placeholder:"Ex: 3000",value:s.km_troca_oleo,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Custo por Troca (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"custo_troca_oleo",placeholder:"Ex: 150.00",value:s.custo_troca_oleo,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"ðŸ’° Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-green-50 border border-green-200 rounded-md text-green-900 font-semibold",children:["R$ ",g()]})]})]})]}),e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Pneu Dianteiro"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Vida Ãštil (KM)"}),e.jsx("input",{type:"number",name:"km_troca_pneu_dianteiro",placeholder:"Ex: 15000",value:s.km_troca_pneu_dianteiro,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"PreÃ§o do Pneu (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"custo_pneu_dianteiro",placeholder:"Ex: 250.00",value:s.custo_pneu_dianteiro,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"ðŸ’° Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-green-50 border border-green-200 rounded-md text-green-900 font-semibold",children:["R$ ",o()]})]})]})]}),e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Pneu Traseiro"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Vida Ãštil (KM)"}),e.jsx("input",{type:"number",name:"km_troca_pneu_traseiro",placeholder:"Ex: 12000",value:s.km_troca_pneu_traseiro,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"PreÃ§o do Pneu (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"custo_pneu_traseiro",placeholder:"Ex: 280.00",value:s.custo_pneu_traseiro,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"ðŸ’° Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-green-50 border border-green-200 rounded-md text-green-900 font-semibold",children:["R$ ",v()]})]})]})]}),e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Kit TransmissÃ£o (Corrente, Coroa, PinhÃ£o)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Vida Ãštil do Kit (KM)"}),e.jsx("input",{type:"number",name:"km_troca_kit_traseiro",placeholder:"Ex: 20000",value:s.km_troca_kit_traseiro,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"PreÃ§o do Kit (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"custo_kit_traseiro",placeholder:"Ex: 450.00",value:s.custo_kit_traseiro,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"ðŸ’° Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-green-50 border border-green-200 rounded-md text-green-900 font-semibold",children:["R$ ",j()]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"ManutenÃ§Ã£o Geral"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"FrequÃªncia (KM)"}),e.jsx("input",{type:"number",name:"km_manutencao_geral",placeholder:"Ex: 5000",value:s.km_manutencao_geral,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Custo por ManutenÃ§Ã£o (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"custo_manutencao_geral",placeholder:"Ex: 200.00",value:s.custo_manutencao_geral,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"ðŸ’° Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-green-50 border border-green-200 rounded-md text-green-900 font-semibold",children:["R$ ",f()]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“„"})," Custos Fixos Mensais"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Seguro Mensal (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"seguro_mensal",placeholder:"Ex: 120.00",value:s.seguro_mensal,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Licenciamento Mensal (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"licenciamento_mensal",placeholder:"Ex: 30.00",value:s.licenciamento_mensal,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"IPVA Mensal (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"ipva_mensal",placeholder:"Ex: 50.00",value:s.ipva_mensal,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Outros Custos Mensais (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"outros_custos_mensais",placeholder:"Ex: 100.00",value:s.outros_custos_mensais,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“Š"})," Controle"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"KM MÃ©dio Mensal (para cÃ¡lculo de custos fixos)"}),e.jsx("input",{type:"number",step:"0.01",name:"km_medio_mensal",placeholder:"Ex: 1000",value:s.km_medio_mensal,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Usado para ratear os custos fixos mensais por KM rodado"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ðŸ’° Custo Fixo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-purple-50 border border-purple-200 rounded-md text-purple-900 font-semibold text-lg",children:["R$ ",N()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Total dos custos fixos Ã· KM mÃ©dio mensal"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:w,disabled:t,className:"px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors shadow-sm",children:t?"Salvando...":"ðŸ’¾ Salvar ConfiguraÃ§Ãµes"})})]})}function Bd(){const[s,l]=a.useState(!0),[t,m]=a.useState(!1),[r,g]=a.useState(!1);a.useEffect(()=>{async function v(){try{const j=await la.get("/empresa/config-estoque");g(j.data.permite_estoque_negativo)}catch(j){console.error("Erro ao carregar configuraÃ§Ãµes de estoque",j),Se.error("Erro ao carregar configuraÃ§Ãµes")}finally{l(!1)}}v()},[]);async function o(){m(!0);try{await la.put("/empresa/config-estoque",{permite_estoque_negativo:r}),Se.success("ConfiguraÃ§Ãµes de estoque atualizadas com sucesso!")}catch(v){console.error("Erro ao salvar configuraÃ§Ãµes",v),Se.error("Erro ao salvar configuraÃ§Ãµes")}finally{m(!1)}}return s?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando configuraÃ§Ãµes..."})]})}):e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(tt,{to:"/configuracoes",className:"inline-flex items-center text-blue-600 hover:text-blue-700 mb-4",children:[e.jsx(Oo,{className:"mr-1"}),"Voltar para ConfiguraÃ§Ãµes"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ConfiguraÃ§Ãµes de Estoque"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Configure o comportamento do controle de estoque do sistema"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Controle de Estoque Negativo"}),e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Eo,{className:"text-yellow-600 mt-1 mr-3 flex-shrink-0"}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"AtenÃ§Ã£o:"})," Esta configuraÃ§Ã£o afeta diretamente o controle de vendas e estoque."]})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-start p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"estoque-negativo",checked:!r,onChange:()=>g(!1),className:"mt-1 mr-3 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"ðŸ”’ Bloquear vendas sem estoque (Recomendado)"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"O sistema impedirÃ¡ finalizar vendas quando nÃ£o houver estoque suficiente. Ideal para controle rigoroso de estoque."})]})]}),e.jsxs("label",{className:"flex items-start p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"estoque-negativo",checked:r,onChange:()=>g(!0),className:"mt-1 mr-3 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"âœ… Permitir estoque negativo"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"O sistema permitirÃ¡ vendas mesmo sem estoque disponÃ­vel. Ãštil para negÃ³cios que trabalham com encomendas ou reposiÃ§Ã£o rÃ¡pida."}),e.jsx("div",{className:"text-xs text-red-600 mt-2 font-medium",children:"âš ï¸ Use com cuidado: pode gerar descontinuidade no controle de estoque"})]})]})]})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsxs("button",{onClick:o,disabled:t,className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:[e.jsx(Is,{className:"mr-2"}),t?"Salvando...":"Salvar ConfiguraÃ§Ãµes"]})})]}),e.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ Como funciona?"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Estoque Bloqueado:"})," Ao tentar vender um produto sem estoque, o sistema exibirÃ¡ um erro e impedirÃ¡ a finalizaÃ§Ã£o da venda."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Estoque Negativo:"})," O sistema permite a venda e o estoque ficarÃ¡ com valor negativo atÃ© a prÃ³xima reposiÃ§Ã£o."]}),e.jsx("li",{children:"Esta configuraÃ§Ã£o Ã© global e afeta todas as vendas realizadas no PDV e outros pontos de venda."})]})]})]})}function Ud(){const s=new Date,[l,t]=a.useState(s.getMonth()+1),[m,r]=a.useState(s.getFullYear()),[g,o]=a.useState(!1),[v,j]=a.useState(null);a.useEffect(()=>{f()},[]);const f=async()=>{if(!l||!m){Se.error("Informe mÃªs e ano");return}o(!0);try{const w=await F.get(`/auditoria/provisoes/mensal?mes=${l}&ano=${m}`);j(w.data)}catch(w){console.error("Erro ao buscar auditoria:",w),Se.error("Erro ao buscar auditoria de provisÃµes")}finally{o(!1)}},N=w=>!w&&w!==0?"R$ 0,00":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Math.abs(w)),d=w=>!w&&w!==0?"0,0%":`${w.toFixed(1)}%`,x=(w,c)=>{const b={OK:"bg-green-100 text-green-800 border-green-300",AJUSTE:"bg-yellow-100 text-yellow-800 border-yellow-300",ACUMULANDO:"bg-blue-100 text-blue-800 border-blue-300",SEM_DADOS:"bg-gray-100 text-gray-600 border-gray-300"};return e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium border ${b[w]||b.SEM_DADOS}`,children:[c," ",w.replace("_"," ")]})},k=[{valor:1,nome:"Janeiro"},{valor:2,nome:"Fevereiro"},{valor:3,nome:"MarÃ§o"},{valor:4,nome:"Abril"},{valor:5,nome:"Maio"},{valor:6,nome:"Junho"},{valor:7,nome:"Julho"},{valor:8,nome:"Agosto"},{valor:9,nome:"Setembro"},{valor:10,nome:"Outubro"},{valor:11,nome:"Novembro"},{valor:12,nome:"Dezembro"}];return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx("svg",{className:"w-8 h-8 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),"Auditoria Mensal â€” ProvisÃ£o Ã— Realizado"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Compare valores provisionados com valores pagos para controle fiscal e trabalhista"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"MÃªs"}),e.jsx("select",{value:l,onChange:w=>t(Number(w.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:k.map(w=>e.jsx("option",{value:w.valor,children:w.nome},w.valor))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ano"}),e.jsx("input",{type:"number",value:m,onChange:w=>r(Number(w.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"2026"})]}),e.jsx("div",{children:e.jsx("button",{onClick:f,disabled:g,className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),"Buscando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"Buscar"]})})})]})}),v&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-400 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"InterpretaÃ§Ã£o dos Status:"}),e.jsxs("div",{className:"mt-2 text-sm text-blue-700 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"âœ… OK:"})," ProvisÃ£o igual ao realizado - situaÃ§Ã£o perfeita"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"âš ï¸ AJUSTE:"})," Tem pagamento mas valores divergem - revisar"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ðŸ•’ ACUMULANDO:"})," Provisionado mas nÃ£o pago ainda - normal para fÃ©rias e 13Âº"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"âž– SEM DADOS:"})," Sem provisÃ£o e sem pagamento no perÃ­odo"]})]})]})]})}),v&&e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ProvisÃ£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Realizado"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"DiferenÃ§a"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"% Real."}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v.itens.map((w,c)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:w.item})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm text-gray-900",children:N(w.provisao)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:N(w.realizado)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:`text-sm font-medium ${w.diferenca===0?"text-green-600":w.diferenca>0?"text-blue-600":"text-red-600"}`,children:[w.diferenca>0&&"+",N(w.diferenca)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm text-gray-600",children:d(w.percentual_realizado)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:x(w.status,w.status_emoji)})]},c))}),e.jsx("tfoot",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:"TOTAL"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:N(v.total_provisao)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:N(v.total_realizado)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:`text-sm font-bold ${v.total_diferenca===0?"text-green-600":v.total_diferenca>0?"text-blue-600":"text-red-600"}`,children:[v.total_diferenca>0&&"+",N(v.total_diferenca)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:d(v.total_provisao>0?v.total_realizado/v.total_provisao*100:0)})}),e.jsx("td",{className:"px-6 py-4"})]})})]})})}),!g&&!v&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),e.jsx("p",{className:"text-gray-600",children:'Selecione um mÃªs e ano e clique em "Buscar" para visualizar a auditoria'})]})]})}function Wd(){const[s,l]=a.useState(3),[t,m]=a.useState([]),[r,g]=a.useState(null),[o,v]=a.useState(!1),j=["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];a.useEffect(()=>{f()},[s]);const f=async()=>{v(!0);try{const[k,w]=await Promise.all([F.get(`/projecao-caixa/?meses_a_frente=${s}`),F.get(`/projecao-caixa/resumo?meses_a_frente=${s}`)]);k.data.sucesso&&m(k.data.projecao||[]),w.data.sucesso&&g(w.data.resumo||null)}catch(k){console.error("Erro ao buscar projeÃ§Ã£o:",k),Se.error("Erro ao carregar projeÃ§Ã£o de caixa")}finally{v(!1)}},N=k=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(k),d=k=>{const w={POSITIVO:"bg-green-100 text-green-800",NEGATIVO:"bg-red-100 text-red-800",MISTO:"bg-yellow-100 text-yellow-800",NEUTRO:"bg-gray-100 text-gray-800"},c={POSITIVO:"ðŸ“ˆ Todos os meses positivos",NEGATIVO:"ðŸ“‰ Todos os meses negativos",MISTO:"âš ï¸ Meses positivos e negativos",NEUTRO:"âž– Sem dados"};return e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${w[k]||w.NEUTRO}`,children:c[k]||c.NEUTRO})},x=k=>k>0?e.jsx("span",{className:"text-green-600 font-bold",children:N(k)}):k<0?e.jsx("span",{className:"text-red-600 font-bold",children:N(k)}):e.jsx("span",{className:"text-gray-600 font-bold",children:N(k)});return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"ðŸ’° ProjeÃ§Ã£o de Caixa"}),e.jsx("p",{className:"text-gray-600",children:"ProjeÃ§Ã£o futura baseada em histÃ³rico real + provisÃµes obrigatÃ³rias"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Projetar para:"}),e.jsxs("select",{value:s,onChange:k=>l(Number(k.target.value)),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:3,children:"3 meses"}),e.jsx("option",{value:6,children:"6 meses"}),e.jsx("option",{value:12,children:"12 meses"})]})]})}),r&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"ðŸ“Š Resumo da ProjeÃ§Ã£o"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Receita Total Projetada"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:N(r.receita_total)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Despesas Totais Projetadas"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:N(r.despesas_totais)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Saldo Total Projetado"}),e.jsx("p",{className:`text-2xl font-bold ${r.saldo_total>=0?"text-green-600":"text-red-600"}`,children:N(r.saldo_total)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Meses Positivos / Negativos"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[e.jsx("span",{className:"text-green-600",children:r.meses_positivos})," / ",e.jsx("span",{className:"text-red-600",children:r.meses_negativos})]})]})]}),e.jsx("div",{className:"flex justify-center mt-4",children:d(r.tendencia)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"ðŸ“… ProjeÃ§Ã£o MÃªs a MÃªs"})}),o?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Calculando projeÃ§Ã£o..."})]}):t.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"ðŸ“Š Sem dados suficientes"}),e.jsx("p",{className:"text-sm",children:"Ã‰ necessÃ¡rio ter pelo menos 3 meses de histÃ³rico para gerar projeÃ§Ãµes."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"MÃªs"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Receita Prevista"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Imposto Simples"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Folha + Encargos"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Despesas Totais"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Saldo Previsto"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(k=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[j[k.mes-1],"/",k.ano]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["+",k.mes_futuro," ",k.mes_futuro===1?"mÃªs":"meses"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-green-600 font-semibold",children:N(k.receita_prevista)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-orange-600",children:N(k.imposto_simples_previsto)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-blue-600",children:N(k.folha_encargos_previstos)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-red-600",children:N(k.despesas_previstas)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:x(k.saldo_previsto)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:k.saldo_positivo?e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800",children:"âœ“ Positivo"}):e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800",children:"âš  Negativo"})})]},k.mes_futuro))})]})})]}),e.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-900",children:e.jsx("strong",{children:"ðŸ’¡ Como funciona a projeÃ§Ã£o:"})}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-800 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"MÃ©dia de receitas dos Ãºltimos 3 meses (valores reais)"}),e.jsx("li",{children:"MÃ©dia de despesas fixas (custos + operacionais)"}),e.jsx("li",{children:"AlÃ­quota atual do Simples Nacional aplicada sobre receita projetada"}),e.jsx("li",{children:"Folha de pagamento + encargos (INSS + FGTS ~28%)"}),e.jsxs("li",{children:[e.jsx("strong",{children:"Sem chutes"})," â€“ Apenas dados reais + regras contÃ¡beis"]})]})]})]})}function Kd(){const[s,l]=a.useState({salario_base:"",inss_percentual:"20",fgts_percentual:"8",meses:"6",cargo:""}),[t,m]=a.useState(null),[r,g]=a.useState(!1),[o,v]=a.useState(!0),j=["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],f=w=>{const{name:c,value:b}=w.target;l(p=>({...p,[c]:b}))},N=async w=>{if(w.preventDefault(),!s.salario_base||parseFloat(s.salario_base)<=0){Se.error("Informe um salÃ¡rio vÃ¡lido");return}g(!0);try{const c={salario_base:parseFloat(s.salario_base),inss_percentual:parseFloat(s.inss_percentual),fgts_percentual:parseFloat(s.fgts_percentual),meses:parseInt(s.meses),cargo:s.cargo||null},b=await F.post("/simulacao-contratacao/",c);b.data.sucesso&&(m(b.data.simulacao),Se.success("SimulaÃ§Ã£o realizada com sucesso!"))}catch(c){console.error("Erro ao simular contrataÃ§Ã£o:",c),Se.error("Erro ao realizar simulaÃ§Ã£o")}finally{g(!1)}},d=w=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(w),x=w=>new Intl.NumberFormat("pt-BR",{style:"percent",minimumFractionDigits:2,maximumFractionDigits:2}).format(w/100),k=()=>{m(null),l({salario_base:"",inss_percentual:"20",fgts_percentual:"8",meses:"6",cargo:""})};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"ðŸ§® SimulaÃ§Ã£o de ContrataÃ§Ã£o"}),e.jsx("p",{className:"text-gray-600",children:"Calcule o impacto real de contratar um funcionÃ¡rio no seu negÃ³cio"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ðŸ“ Dados da ContrataÃ§Ã£o"}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cargo (opcional)"}),e.jsx("input",{type:"text",name:"cargo",value:s.cargo,onChange:f,placeholder:"Ex: Atendente, VeterinÃ¡rio...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["SalÃ¡rio Base ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"salario_base",value:s.salario_base,onChange:f,placeholder:"Ex: 2000.00",step:"0.01",min:"0",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"INSS Patronal (%)"}),e.jsx("input",{type:"number",name:"inss_percentual",value:s.inss_percentual,onChange:f,step:"0.01",min:"0",max:"100",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"FGTS (%)"}),e.jsx("input",{type:"number",name:"fgts_percentual",value:s.fgts_percentual,onChange:f,step:"0.01",min:"0",max:"100",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Simular por quantos meses?"}),e.jsxs("select",{name:"meses",value:s.meses,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"3",children:"3 meses"}),e.jsx("option",{value:"6",children:"6 meses"}),e.jsx("option",{value:"12",children:"12 meses (1 ano)"}),e.jsx("option",{value:"24",children:"24 meses (2 anos)"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:r,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed",children:r?"Calculando...":"ðŸ§® Simular ContrataÃ§Ã£o"}),t&&e.jsx("button",{type:"button",onClick:k,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"ðŸ”„ Nova SimulaÃ§Ã£o"})]})]})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"ðŸ“Š Resumo Executivo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Custo Mensal MÃ©dio"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:d(t.totais.media_mensal)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[x(t.analise.custo_total_vs_salario)," do salÃ¡rio base"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:["Custo Total (",t.parametros.meses_simulados," meses)"]}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:d(t.totais.total_geral)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Encargos Totais"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:d(t.totais.total_inss+t.totais.total_fgts)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[x(t.analise.percentual_encargos)," do salÃ¡rio"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"ProvisÃµes Totais"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:d(t.totais.total_provisao_ferias+t.totais.total_provisao_1_3+t.totais.total_provisao_13)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[x(t.analise.percentual_provisoes)," do salÃ¡rio"]})]})]}),e.jsx("div",{className:"mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-900",children:[e.jsx("strong",{children:"âš ï¸ AtenÃ§Ã£o:"})," O custo real mensal Ã©"," ",e.jsx("strong",{children:d(t.totais.media_mensal)}),", nÃ£o apenas"," ",e.jsx("strong",{children:d(t.parametros.salario_base)}),". Isso representa um aumento de"," ",e.jsx("strong",{children:x(t.analise.custo_total_vs_salario-100)})," ","devido a encargos e provisÃµes obrigatÃ³rias."]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"ðŸ“… Detalhamento Mensal"}),e.jsx("button",{onClick:()=>v(!o),className:"text-sm text-blue-600 hover:text-blue-700",children:o?"â–¼ Ocultar detalhes":"â–¶ Mostrar detalhes"})]}),o&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"MÃªs"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SalÃ¡rio"}),e.jsxs("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:["INSS (",t.parametros.inss_percentual,"%)"]}),e.jsxs("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:["FGTS (",t.parametros.fgts_percentual,"%)"]}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"FÃ©rias (1/12)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"1/3 Const."}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"13Âº (1/12)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Custo Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.resultado_mensal.map(w=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[j[w.mes_calendario-1],"/",w.ano]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:d(w.salario)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-orange-600",children:d(w.inss)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-blue-600",children:d(w.fgts)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-green-600",children:d(w.provisao_ferias)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-green-600",children:d(w.provisao_1_3)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-green-600",children:d(w.provisao_13)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-gray-900",children:d(w.custo_total)})]},w.mes))}),e.jsx("tfoot",{className:"bg-gray-100 font-bold",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:"TOTAL"}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-gray-900",children:d(t.totais.total_salarios)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-orange-600",children:d(t.totais.total_inss)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-blue-600",children:d(t.totais.total_fgts)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-green-600",children:d(t.totais.total_provisao_ferias)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-green-600",children:d(t.totais.total_provisao_1_3)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-green-600",children:d(t.totais.total_provisao_13)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-gray-900",children:d(t.totais.total_geral)})]})})]})})]}),e.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-900",children:e.jsx("strong",{children:"ðŸ’¡ Como funciona esta simulaÃ§Ã£o:"})}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-800 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Nada Ã© gravado no banco"})," - Ã© apenas uma projeÃ§Ã£o"]}),e.jsx("li",{children:"Custos diretos: SalÃ¡rio + INSS patronal + FGTS"}),e.jsx("li",{children:"ProvisÃµes obrigatÃ³rias: FÃ©rias (1/12) + 1/3 constitucional + 13Âº (1/12)"}),e.jsx("li",{children:"NÃ£o considera: Vale-transporte, Vale-refeiÃ§Ã£o, Plano de saÃºde"}),e.jsx("li",{children:"Baseado nas mesmas regras do motor de provisÃµes real"})]})]})]})]})}function Hd(){const[s,l]=a.useState([]),[t,m]=a.useState(null),[r,g]=a.useState(!0),o=async()=>{try{g(!0);const d=await F.get("/cargos");l(d.data)}catch(d){console.error("Erro ao carregar cargos:",d),Se.error("Erro ao carregar cargos")}finally{g(!1)}};a.useEffect(()=>{o()},[]);const v=()=>{m({nome:"",descricao:"",salario_base:"",inss_patronal_percentual:20,fgts_percentual:8,gera_ferias:!0,gera_decimo_terceiro:!0,ativo:!0})},j=async()=>{var d,x;if(!t.nome||!t.salario_base){Se.error("Nome e salÃ¡rio sÃ£o obrigatÃ³rios");return}try{t.id?(await F.put(`/cargos/${t.id}`,t),Se.success("Cargo atualizado com sucesso!")):(await F.post("/cargos",t),Se.success("Cargo cadastrado com sucesso!")),m(null),o()}catch(k){console.error("Erro ao salvar cargo:",k),Se.error(((x=(d=k.response)==null?void 0:d.data)==null?void 0:x.detail)||"Erro ao salvar cargo")}},f=async d=>{var x,k;try{await F.patch(`/cargos/${d.id}/status?ativo=${!d.ativo}`),Se.success(`Cargo ${d.ativo?"inativado":"ativado"} com sucesso!`),o()}catch(w){console.error("Erro ao alterar status:",w),Se.error(((k=(x=w.response)==null?void 0:x.data)==null?void 0:k.detail)||"Erro ao alterar status")}},N=d=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(d);return r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Cadastro de Cargos"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie cargos, defina salÃ¡rios e encargos que alimentam provisÃµes, DRE e simulaÃ§Ãµes"})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("button",{className:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors flex items-center gap-2",onClick:v,children:[e.jsx("span",{className:"text-xl",children:"+"})," Novo Cargo"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SalÃ¡rio Base"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"INSS %"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"FGTS %"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"FÃ©rias"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"13Âº"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ativo"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(d=>e.jsxs("tr",{className:d.ativo?"":"bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:d.nome}),d.descricao&&e.jsx("div",{className:"text-sm text-gray-500",children:d.descricao})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium text-green-600",children:N(d.salario_base)}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[Number(d.inss_patronal_percentual).toFixed(2),"%"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[Number(d.fgts_percentual).toFixed(2),"%"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${d.gera_ferias?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:d.gera_ferias?"Sim":"NÃ£o"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${d.gera_decimo_terceiro?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:d.gera_decimo_terceiro?"Sim":"NÃ£o"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${d.ativo?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:d.ativo?"Sim":"NÃ£o"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:[e.jsx("button",{className:"text-indigo-600 hover:text-indigo-900 mr-4",onClick:()=>m(d),children:"Editar"}),e.jsx("button",{className:`${d.ativo?"text-yellow-600 hover:text-yellow-900":"text-green-600 hover:text-green-900"}`,onClick:()=>f(d),children:d.ativo?"Inativar":"Ativar"})]})]},d.id))})]}),s.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"Nenhum cargo cadastrado"})})]}),t&&e.jsxs("div",{className:"mt-6 bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800 mb-4",children:t.id?"Editar Cargo":"Novo Cargo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Cargo *"}),e.jsx("input",{type:"text",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Ex: Vendedor, Tosador, Gerente",value:t.nome,onChange:d=>m({...t,nome:d.target.value})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"DescriÃ§Ã£o das responsabilidades...",rows:2,value:t.descricao,onChange:d=>m({...t,descricao:d.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SalÃ¡rio Base (R$) *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"0.00",value:t.salario_base,onChange:d=>m({...t,salario_base:d.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"INSS Patronal (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",value:t.inss_patronal_percentual,onChange:d=>m({...t,inss_patronal_percentual:d.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"FGTS (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",value:t.fgts_percentual,onChange:d=>m({...t,fgts_percentual:d.target.value})})]}),e.jsxs("div",{className:"md:col-span-2 flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.gera_ferias,onChange:d=>m({...t,gera_ferias:d.target.checked}),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Gera fÃ©rias"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.gera_decimo_terceiro,onChange:d=>m({...t,gera_decimo_terceiro:d.target.checked}),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Gera 13Âº"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.ativo,onChange:d=>m({...t,ativo:d.target.checked}),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Ativo"})]})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx("button",{className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors",onClick:j,children:"Salvar"}),e.jsx("button",{className:"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors",onClick:()=>m(null),children:"Cancelar"})]})]})]})}function Gd({funcionario:s,onClose:l}){const[t,m]=a.useState(null),[r,g]=a.useState(!1),o=async()=>{const f=await la.get(`/funcionarios/${s.id}/provisoes`);m(f.data)};a.useEffect(()=>{o()},[]);const v=async()=>{var f,N;if(window.confirm("Confirmar concessÃ£o de fÃ©rias?")){g(!0);try{const d=new Date,x={mes:d.getMonth()+1,ano:d.getFullYear(),dias_ferias:30,data_pagamento:null};await la.post(`/funcionarios/${s.id}/ferias`,x),await o(),alert("FÃ©rias concedidas com sucesso")}catch(d){console.error("Erro ao conceder fÃ©rias:",d),alert(((N=(f=d.response)==null?void 0:f.data)==null?void 0:N.detail)||"Erro ao conceder fÃ©rias")}finally{g(!1)}}},j=async f=>{var N,d;if(window.confirm(`Confirmar pagamento da ${f}Âª parcela do 13Âº?`)){g(!0);try{const x=new Date,k={mes:x.getMonth()+1,ano:x.getFullYear(),percentual:f===1?50:100,descricao_parcela:f===1?"1Âª Parcela":"2Âª Parcela",data_pagamento:null};await la.post(`/funcionarios/${s.id}/decimo-terceiro`,k),await o(),alert("13Âº registrado com sucesso")}catch(x){console.error("Erro ao pagar 13Âº:",x),alert(((d=(N=x.response)==null?void 0:N.data)==null?void 0:d.detail)||"Erro ao pagar 13Âº")}finally{g(!1)}}};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded p-6 w-[500px]",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Eventos â€” ",s.nome]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"ProvisÃµes"}),e.jsxs("p",{children:["FÃ©rias: R$ ",Number(t.ferias||0).toFixed(2)]}),e.jsxs("p",{children:["13Âº: R$ ",Number(t.decimo_terceiro||0).toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{disabled:r,onClick:v,className:"w-full bg-blue-600 text-white py-2 rounded",children:"Conceder FÃ©rias"}),e.jsx("button",{disabled:r,onClick:()=>j(1),className:"w-full bg-green-600 text-white py-2 rounded",children:"Pagar 1Âª Parcela do 13Âº"}),e.jsx("button",{disabled:r,onClick:()=>j(2),className:"w-full bg-green-700 text-white py-2 rounded",children:"Pagar 2Âª Parcela do 13Âº"})]}),e.jsx("div",{className:"mt-4 text-right",children:e.jsx("button",{onClick:l,className:"text-gray-600 underline",children:"Fechar"})})]})}):null}function Qd(){const[s,l]=a.useState([]),[t,m]=a.useState([]),[r,g]=a.useState(null),[o,v]=a.useState(""),[j,f]=a.useState("todos"),[N,d]=a.useState(null),x=async()=>{const i=await F.get("/funcionarios");l(i.data)},k=async()=>{const i=await F.get("/cargos");m(i.data.filter(u=>u.ativo))};a.useEffect(()=>{x(),k()},[]);const w=()=>{g({nome:"",cpf:"",email:"",telefone:"",cargo_id:"",ativo:!0})},c=async()=>{var u,n,C,h,_;if(!r.nome||!r.cargo_id){alert("Nome e cargo sÃ£o obrigatÃ³rios");return}const i={nome:r.nome,cargo_id:Number(r.cargo_id),ativo:r.ativo,email:((u=r.email)==null?void 0:u.trim())||null,telefone:((n=r.telefone)==null?void 0:n.trim())||null,cpf:((C=r.cpf)==null?void 0:C.trim())||null};try{r.id?await F.put(`/funcionarios/${r.id}`,i):await F.post("/funcionarios",i),g(null),x()}catch(E){console.error("Erro ao salvar funcionÃ¡rio:",E),alert(((_=(h=E.response)==null?void 0:h.data)==null?void 0:_.detail)||"Erro ao salvar funcionÃ¡rio")}},b=async i=>{window.confirm("Deseja inativar este funcionÃ¡rio?")&&(await F.delete(`/funcionarios/${i}`),x())},p=s.filter(i=>{const u=i.nome.toLowerCase().includes(o.toLowerCase())||(i.cpf||"").includes(o),n=j==="todos"||j==="ativos"&&i.ativo||j==="inativos"&&!i.ativo;return u&&n});return e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"FuncionÃ¡rios"}),e.jsxs("div",{className:"flex justify-between items-center mb-4 gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"border p-2 w-64",placeholder:"Buscar por nome ou CPF",value:o,onChange:i=>v(i.target.value)}),e.jsxs("select",{className:"border p-2 bg-white",value:j,onChange:i=>f(i.target.value),children:[e.jsx("option",{value:"todos",children:"Todos"}),e.jsx("option",{value:"ativos",children:"Ativos"}),e.jsx("option",{value:"inativos",children:"Inativos"})]})]}),e.jsx("button",{onClick:w,className:"bg-blue-600 text-white px-4 py-2 rounded",children:"+ Novo FuncionÃ¡rio"})]}),e.jsxs("table",{className:"w-full border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Nome"}),e.jsx("th",{className:"border p-2",children:"Cargo"}),e.jsx("th",{className:"border p-2",children:"SalÃ¡rio"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{children:p.map(i=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2",children:i.nome}),e.jsx("td",{className:"border p-2",children:i.cargo?i.cargo.nome:"-"}),e.jsx("td",{className:"border p-2",children:i.cargo?`R$ ${Number(i.cargo.salario_base).toFixed(2)}`:"-"}),e.jsx("td",{className:"border p-2",children:i.ativo?"Ativo":"Inativo"}),e.jsxs("td",{className:"border p-2 space-x-2",children:[e.jsx("button",{className:"text-purple-600",onClick:()=>d(i),children:"Eventos"}),e.jsx("button",{className:"text-blue-600",onClick:()=>{var u;return g({...i,cargo_id:(u=i.cargo)==null?void 0:u.id})},children:"Editar"}),i.ativo&&e.jsx("button",{className:"text-red-600",onClick:()=>b(i.id),children:"Inativar"})]})]},i.id))})]}),r&&e.jsxs("div",{className:"border rounded p-4 mt-6",children:[e.jsx("h3",{className:"font-semibold mb-3",children:r.id?"Editar FuncionÃ¡rio":"Novo FuncionÃ¡rio"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{className:"border p-2",placeholder:"Nome",value:r.nome,onChange:i=>g({...r,nome:i.target.value})}),e.jsx("input",{className:"border p-2",placeholder:"CPF",value:r.cpf||"",onChange:i=>g({...r,cpf:i.target.value})}),e.jsx("input",{className:"border p-2",placeholder:"Email",value:r.email||"",onChange:i=>g({...r,email:i.target.value})}),e.jsx("input",{className:"border p-2",placeholder:"Telefone",value:r.telefone||"",onChange:i=>g({...r,telefone:i.target.value})}),e.jsxs("select",{className:"border p-2 col-span-2",value:r.cargo_id,onChange:i=>g({...r,cargo_id:i.target.value}),children:[e.jsx("option",{value:"",children:"Selecione o cargo"}),t.map(i=>e.jsx("option",{value:i.id,children:i.nome},i.id))]})]}),e.jsxs("div",{className:"mt-4 space-x-2",children:[e.jsx("button",{onClick:c,className:"bg-green-600 text-white px-4 py-2 rounded",children:"Salvar"}),e.jsx("button",{onClick:()=>g(null),className:"bg-gray-400 text-white px-4 py-2 rounded",children:"Cancelar"})]})]}),N&&e.jsx(Gd,{funcionario:N,onClose:()=>d(null)})]})}function Xd(){const[s,l]=a.useState(!0),[t,m]=a.useState([]),[r,g]=a.useState([]),[o,v]=a.useState(null),[j,f]=a.useState(!1);a.useEffect(()=>{N()},[]);async function N(){l(!0);try{const[w,c]=await Promise.all([la.get("/rotas-entrega/vendas-pendentes/listar"),la.get("/configuracoes/entregas").catch(()=>({data:null}))]);m(Array.isArray(w.data)?w.data:[]),v(c.data)}catch(w){console.error(w),alert("Erro ao carregar vendas pendentes"),m([])}finally{l(!1)}}async function d(){var b,p,i;if(t.length===0){alert("NÃ£o hÃ¡ vendas para otimizar");return}if(!o||!o.logradouro){alert("âš ï¸ Configure o endereÃ§o da loja em ConfiguraÃ§Ãµes > Entregas antes de otimizar rotas");return}if(confirm(`âš ï¸ ATENÃ‡ÃƒO - ESTA OPERAÃ‡ÃƒO TEM CUSTO!

ðŸ’µ Custo estimado: 5 centavos
ðŸ“ Entregas a otimizar: ${t.length}
ðŸ—ºï¸ SerÃ¡ feita 1 chamada ao Google Maps API
ðŸ’¾ A ordem serÃ¡ salva no banco (nÃ£o cobra novamente)

Deseja continuar?`)){f(!0);try{console.log("ðŸ—ºï¸ Chamando endpoint de otimizaÃ§Ã£o...");const u=await la.post("/rotas-entrega/vendas-pendentes/otimizar");console.log("âœ… Resposta da otimizaÃ§Ã£o:",u.data),alert(`âœ… ROTAS OTIMIZADAS COM SUCESSO!

${u.data.message}

Total otimizado: ${u.data.total_otimizado||t.length} entregas`),await N()}catch(u){console.error("âŒ Erro ao otimizar:",u),console.error("Detalhes:",(b=u.response)==null?void 0:b.data);const n=((i=(p=u.response)==null?void 0:p.data)==null?void 0:i.detail)||"Erro ao otimizar rotas. Verifique se o Google Maps estÃ¡ configurado.";alert(`âŒ ERRO AO OTIMIZAR ROTAS

${n}`)}finally{f(!1)}}}function x(w){g(c=>c.includes(w)?c.filter(b=>b!==w):[...c,w])}async function k(){var w,c;if(r.length===0){alert("Selecione pelo menos uma entrega");return}if(confirm(`Deseja criar uma rota com ${r.length} entrega(s)?`))try{l(!0);const b=t.filter(i=>r.includes(i.id)),p=b.filter(i=>!i.entregador_id);if(p.length>0){alert(`âŒ As seguintes vendas nÃ£o tÃªm entregador atribuÃ­do:
${p.map(i=>i.numero_venda).join(", ")}

Atribua um entregador antes de criar a rota.`),l(!1);return}await la.post("/rotas-entrega/",{vendas_ids:r,entregador_id:b[0].entregador_id,moto_da_loja:!1}),alert(`âœ… Rota criada com ${r.length} entrega(s)!

As entregas foram movidas para "Rotas de Entrega"`),g([]),N()}catch(b){console.error(b),alert(((c=(w=b.response)==null?void 0:w.data)==null?void 0:c.detail)||"Erro ao criar rota. Verifique se todas as entregas tÃªm entregador atribuÃ­do.")}finally{l(!1)}}return s?e.jsx("div",{className:"page",children:"Carregando..."}):e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"Entregas em Aberto"}),e.jsx("p",{style:{color:"#666",marginBottom:20},children:"Vendas com entrega que estÃ£o aguardando iniciar a rota"}),!Array.isArray(t)||t.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"âœ… NÃ£o hÃ¡ entregas pendentes"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:20,display:"flex",gap:10,alignItems:"center"},children:[e.jsx("button",{onClick:d,disabled:j||s,className:"btn-secondary",title:"Reorganizar entregas usando Google Maps para menor distÃ¢ncia",children:j?"ðŸ”„ Otimizando...":"ðŸ—ºï¸ Otimizar Rotas"}),e.jsxs("span",{style:{color:"#666",fontSize:"0.9em"},children:["â„¹ï¸ ",t.filter(w=>w.ordem_otimizada).length>0?`${t.filter(w=>w.ordem_otimizada).length} entregas jÃ¡ otimizadas. `:"","Clique para ordenar pela rota mais eficiente"]})]}),e.jsxs("table",{className:"table-entregas",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:40},children:e.jsx("input",{type:"checkbox",checked:r.length===t.length&&t.length>0,onChange:w=>g(w.target.checked?t.map(c=>c.id):[])})}),e.jsx("th",{children:"Ordem"}),e.jsx("th",{children:"Venda"}),e.jsx("th",{children:"Data da Venda"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Entregador"}),e.jsx("th",{children:"EndereÃ§o"}),e.jsx("th",{children:"Taxa Entrega"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:t.map((w,c)=>e.jsxs("tr",{style:{backgroundColor:r.includes(w.id)?"#e3f2fd":w.ordem_otimizada?"#f0f8ff":"white"},children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:r.includes(w.id),onChange:()=>x(w.id)})}),e.jsx("td",{children:e.jsxs("strong",{style:{color:w.ordem_otimizada?"#007bff":"#999",fontSize:"1.1em"},children:[c+1,w.ordem_otimizada&&" ðŸ—ºï¸"]})}),e.jsx("td",{children:w.numero_venda}),e.jsx("td",{style:{fontSize:"0.9em"},children:w.data_venda?new Date(w.data_venda).toLocaleDateString("pt-BR"):"N/A"}),e.jsx("td",{children:w.cliente_nome}),e.jsx("td",{children:e.jsx("span",{style:{color:w.entregador_nome?"#28a745":"#999",fontWeight:w.entregador_nome?"600":"normal"},children:w.entregador_nome||"NÃ£o atribuÃ­do"})}),e.jsx("td",{style:{maxWidth:300,fontSize:"0.9em"},children:w.endereco_entrega||"N/A"}),e.jsxs("td",{children:["R$ ",parseFloat(w.taxa_entrega||0).toFixed(2)]}),e.jsxs("td",{children:["R$ ",parseFloat(w.total||0).toFixed(2)]}),e.jsx("td",{children:e.jsx("span",{style:{padding:"4px 8px",borderRadius:4,fontSize:12,fontWeight:"bold",color:"#fff",backgroundColor:"#ffa500"},children:"AGUARDANDO"})})]},w.id))})]}),e.jsxs("div",{style:{marginTop:20,display:"flex",gap:10},children:[e.jsxs("button",{onClick:k,disabled:r.length===0||s,className:"btn-primary",style:{backgroundColor:r.length>0?"#28a745":"#ccc",cursor:r.length>0?"pointer":"not-allowed"},children:["âœ… Criar Rota (",r.length," selecionada",r.length!==1?"s":"",")"]}),e.jsx("span",{style:{color:"#666",fontSize:"0.9em",alignSelf:"center"},children:"ðŸ’¡ Selecione as entregas e clique para criar uma rota"})]})]})]})}function Jd(){const s=fa(),[l,t]=a.useState([]),[m,r]=a.useState(!0),[g,o]=a.useState(""),[v,j]=a.useState(null);a.useEffect(()=>{f()},[g]);async function f(){try{r(!0);const u=new URLSearchParams;g&&u.append("status",g);const n=await F.get(`/rotas-entrega/?${u.toString()}`);t(n.data)}catch(u){console.error("Erro ao carregar rotas:",u),alert("Erro ao carregar rotas de entrega")}finally{r(!1)}}function N(u){j(v===u?null:u)}async function d(u,n){try{const C=n.map(h=>h.id);await F.put(`/rotas-entrega/${u}/paradas/reordenar`,C),t(h=>h.map(_=>_.id===u?{..._,paradas:n.map((E,$)=>({...E,ordem:$+1}))}:_)),alert("Ordem das paradas atualizada!")}catch(C){console.error("Erro ao reordenar paradas:",C),alert("Erro ao reordenar paradas")}}async function x(u){var C,h;if(!confirm("Deseja iniciar esta rota? Uma mensagem serÃ¡ enviada ao primeiro cliente."))return;const n=prompt(`ðŸï¸ Digite o KM atual da moto (opcional):

Deixe em branco se nÃ£o quiser registrar.`);try{const _={};n&&!isNaN(n)&&parseFloat(n)>0&&(_.km_inicial=parseFloat(n)),await F.post(`/rotas-entrega/${u}/iniciar`,null,{params:_}),alert("âœ… Rota iniciada! Mensagem enviada ao primeiro cliente."),f()}catch(_){console.error("Erro ao iniciar rota:",_);const E=((h=(C=_.response)==null?void 0:C.data)==null?void 0:h.detail)||"Erro ao iniciar rota";alert(`âŒ ${E}`)}}async function k(u){var n,C;if(confirm(`âš ï¸ Tem certeza que deseja excluir esta rota?

As vendas voltarÃ£o para a listagem de entregas pendentes.`))try{const h=await F.delete(`/rotas-entrega/${u}`),{total_vendas:_}=h.data;alert(`âœ… Rota excluÃ­da com sucesso!
${_} venda(s) voltaram para entregas pendentes.`),f()}catch(h){console.error("Erro ao excluir rota:",h);const _=((C=(n=h.response)==null?void 0:n.data)==null?void 0:C.detail)||"Erro ao excluir rota";alert(`âŒ ${_}`)}}async function w(u){var n,C;if(confirm(`â†©ï¸ Reverter inÃ­cio desta rota?

A rota voltarÃ¡ para status pendente e vocÃª poderÃ¡ adicionar mais entregas.`))try{await F.post(`/rotas-entrega/${u}/reverter-inicio`),alert("âœ… Rota revertida para pendente! Agora vocÃª pode adicionar mais entregas."),f()}catch(h){console.error("Erro ao reverter rota:",h);const _=((C=(n=h.response)==null?void 0:n.data)==null?void 0:C.detail)||"Erro ao reverter inÃ­cio da rota";alert(`âŒ ${_}`)}}function c(u){if(!u.paradas||u.paradas.length===0)return null;const n=u.paradas[u.paradas.length-1];return n.tempo_acumulado?n.tempo_acumulado:null}function b(u){if(!u)return"N/A";const n=Math.floor(u/60),C=Math.floor(n/60),h=n%60;return C>0?`${C}h${h}min`:`${h}min`}function p(u){switch(u){case"pendente":return"#FFA500";case"em_andamento":return"#007BFF";case"em_rota":return"#007BFF";case"concluida":return"#28A745";case"cancelada":return"#DC3545";default:return"#6C757D"}}function i(u){switch(u){case"pendente":return"ðŸŸ  Pendente";case"em_andamento":return"ðŸ”µ Em Andamento";case"em_rota":return"ðŸ”µ Em Rota";case"concluida":return"âœ… ConcluÃ­da";case"cancelada":return"âŒ Cancelada";default:return u}}return m?e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"Rotas de Entrega"}),e.jsx("p",{children:"Carregando rotas..."})]}):e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"Rotas de Entrega"}),e.jsx("p",{style:{color:"#666",marginBottom:20},children:"Rotas criadas e em andamento"}),e.jsxs("div",{style:{marginBottom:20,display:"flex",gap:10,alignItems:"center"},children:[e.jsxs("label",{children:["Filtrar por status:",e.jsxs("select",{value:g,onChange:u=>o(u.target.value),style:{marginLeft:10,padding:"5px 10px"},children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"pendente",children:"Pendente"}),e.jsx("option",{value:"em_andamento",children:"Em Andamento"}),e.jsx("option",{value:"concluida",children:"ConcluÃ­da"}),e.jsx("option",{value:"cancelada",children:"Cancelada"})]})]}),e.jsx("button",{onClick:f,className:"btn-secondary",style:{marginLeft:"auto"},children:"ðŸ”„ Atualizar"})]}),!Array.isArray(l)||l.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"Nenhuma rota encontrada"}),e.jsx("button",{onClick:()=>s("/entregas/abertas"),className:"btn-primary",style:{marginTop:10},children:"Criar Nova Rota"})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:15},children:l.map(u=>e.jsx(Yd,{rota:u,expandida:v===u.id,onToggleExpand:()=>N(u.id),onReordenar:d,onIniciarRota:x,onExcluirRota:k,onReverterInicio:w,getStatusColor:p,getStatusLabel:i,calcularTempoEstimado:c,formatarTempo:b},u.id))})]})}function Yd({rota:s,expandida:l,onToggleExpand:t,onReordenar:m,onIniciarRota:r,onExcluirRota:g,onReverterInicio:o,getStatusColor:v,getStatusLabel:j,calcularTempoEstimado:f,formatarTempo:N}){var B,y;const[d,x]=a.useState(s.paradas||[]),[k,w]=a.useState(null),[c,b]=a.useState(null),[p,i]=a.useState(null),[u,n]=a.useState(!1),[C,h]=a.useState(null),[_,E]=a.useState(null),[$,K]=a.useState(!1);a.useEffect(()=>{x(s.paradas||[])},[s.paradas]);const te=f(s),M=d.filter(O=>O.status!=="entregue").length,A=d.length>0&&M===0;async function Q(O,z){var ae,W,ne;try{n(!0),b(O);const H=await F.get(`/vendas/${z}`);console.log("ðŸ“¦ Detalhes da venda carregados:",H.data),console.log("ðŸ“ž Telefones do cliente:",{telefone:(ae=H.data.cliente)==null?void 0:ae.telefone,celular:(W=H.data.cliente)==null?void 0:W.celular,email:(ne=H.data.cliente)==null?void 0:ne.email}),i(H.data)}catch(H){console.error("Erro ao carregar detalhes da venda:",H),alert("Erro ao carregar detalhes da venda"),b(null)}finally{n(!1)}}function re(){b(null),i(null)}async function q(O,z){var W,ne;if(!confirm(`âœ… Confirmar entrega realizada?

Uma mensagem serÃ¡ enviada automaticamente para o prÃ³ximo cliente da rota.`))return;const ae=prompt(`ðŸï¸ Digite o KM atual da moto (opcional):

Deixe em branco se nÃ£o quiser registrar.`);try{h(O);const H={};ae&&!isNaN(ae)&&parseFloat(ae)>0&&(H.km_entrega=parseFloat(ae));const ee=await F.post(`/rotas-entrega/${z}/paradas/${O}/marcar-entregue`,null,{params:H});alert("âœ… "+ee.data.message),x(de=>de.map(ue=>ue.id===O?{...ue,status:"entregue",data_entrega:new Date().toISOString(),km_entrega:ae?parseFloat(ae):null}:ue)),window.location.reload()}catch(H){console.error("Erro ao marcar entrega:",H);const ee=((ne=(W=H.response)==null?void 0:W.data)==null?void 0:ne.detail)||"Erro ao marcar entrega como concluÃ­da";alert("âŒ "+ee)}finally{h(null)}}async function Z(O,z){const ae=prompt(`ðŸ“‹ Digite a observaÃ§Ã£o sobre esta entrega:

(Ex: 'Sempre entregar no vizinho', 'Chamar na casa da frente')`);if(!(!ae||ae.trim()===""))try{await F.put(`/rotas-entrega/${z}/paradas/${O}/observacao`,null,{params:{observacao:ae.trim()}}),alert("âœ… ObservaÃ§Ã£o salva com sucesso!"),x(W=>W.map(ne=>ne.id===O?{...ne,observacoes:ae.trim()}:ne))}catch(W){console.error("Erro ao salvar observaÃ§Ã£o:",W),alert("âŒ Erro ao salvar observaÃ§Ã£o")}}async function R(O,z,ae){const W=prompt(`âš ï¸ Por que a entrega nÃ£o foi realizada?

(Ex: 'Cliente ausente', 'CartÃ£o recusado', 'EndereÃ§o nÃ£o encontrado')`);if(!(!W||W.trim()==="")&&confirm(`âš ï¸ Confirmar que a entrega NÃƒO foi realizada?

A venda voltarÃ¡ para entregas em aberto.`))try{E(O),await F.post(`/rotas-entrega/${z}/paradas/${O}/nao-entregue`,null,{params:{motivo:W.trim()}}),alert("âœ… Entrega marcada como nÃ£o realizada. Venda #"+ae+" voltou para entregas em aberto."),window.location.reload()}catch(ne){console.error("Erro ao marcar como nÃ£o entregue:",ne),alert("âŒ Erro ao processar")}finally{E(null)}}async function J(O,z){var H,ee;const ae=prompt(`ðŸï¸ Digite o KM final da moto (opcional):

Deixe em branco se nÃ£o quiser registrar.`);let W=null;if(z&&ae&&!isNaN(ae)&&parseFloat(ae)>parseFloat(z)){const de=(parseFloat(ae)-parseFloat(z)).toFixed(2);confirm(`ðŸ“ DistÃ¢ncia calculada: ${de} km

KM Inicial: ${z}
KM Final: ${ae}

Deseja usar esta distÃ¢ncia?`)&&(W=parseFloat(de))}if(!W){const de=prompt(`ðŸ“ Digite a distÃ¢ncia percorrida em km (opcional):

Deixe em branco se nÃ£o souber.`);de&&!isNaN(de)&&parseFloat(de)>0&&(W=parseFloat(de))}const ne=prompt("ðŸ“‹ ObservaÃ§Ãµes sobre a rota (opcional):")||"";if(confirm(`âœ… Finalizar esta rota?

Esta aÃ§Ã£o nÃ£o pode ser desfeita.`))try{K(!0);const de={observacoes:ne.trim()};ae&&!isNaN(ae)&&parseFloat(ae)>0&&(de.km_final=parseFloat(ae)),W&&(de.distancia_real=W),await F.post(`/rotas-entrega/${O}/fechar`,de),alert("âœ… Rota finalizada com sucesso!"),window.location.reload()}catch(de){console.error("Erro ao finalizar rota:",de);const ue=((ee=(H=de.response)==null?void 0:H.data)==null?void 0:ee.detail)||"Erro ao finalizar rota";alert("âŒ "+ue)}finally{K(!1)}}const S=(O,z)=>{w(z),O.dataTransfer.effectAllowed="move"},P=(O,z)=>{if(O.preventDefault(),k===null||k===z)return;const ae=[...d],W=ae[k];ae.splice(k,1),ae.splice(z,0,W),x(ae),w(z)},G=()=>{k!==null&&m(s.id,d),w(null)};return e.jsxs("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:15,backgroundColor:"#fff"},children:[e.jsxs("div",{style:{cursor:"pointer",transition:"all 0.2s"},onClick:t,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("h3",{style:{margin:0,marginBottom:10},children:["ðŸšš ",s.numero||`Rota #${s.id}`,l?" ðŸ”½":" â–¶ï¸"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5,color:"#555"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Entregador:"})," ",((B=s.entregador)==null?void 0:B.nome)||"NÃ£o informado"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Paradas:"})," ",((y=s.paradas)==null?void 0:y.length)||0," entrega(s)"]}),s.distancia_prevista&&e.jsxs("div",{children:[e.jsx("strong",{children:"DistÃ¢ncia Prevista:"})," ",s.distancia_prevista," km"]}),te&&e.jsxs("div",{children:[e.jsx("strong",{children:"Tempo Estimado:"})," ",N(te)]}),s.km_inicial&&e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ KM Inicial:"})," ",parseFloat(s.km_inicial).toFixed(1)," km"]}),s.km_final&&e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ KM Final:"})," ",parseFloat(s.km_final).toFixed(1)," km"]}),s.km_inicial&&s.km_final&&e.jsxs("div",{style:{color:"#007BFF",fontWeight:"600"},children:[e.jsx("strong",{children:"ðŸ“ Total Rodado:"})," ",(parseFloat(s.km_final)-parseFloat(s.km_inicial)).toFixed(1)," km",s.distancia_prevista&&(()=>{const O=parseFloat(s.km_final)-parseFloat(s.km_inicial),z=parseFloat(s.distancia_prevista),ae=O-z,W=(ae/z*100).toFixed(1);return e.jsxs("span",{style:{marginLeft:10,color:ae>0?"#DC3545":"#28A745",fontSize:13},children:["(",ae>0?"+":"",ae.toFixed(1)," km / ",W>0?"+":"",W,"% vs projetado)"]})})()]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Criada em:"})," ",new Date(s.created_at).toLocaleString("pt-BR")]}),s.data_conclusao&&e.jsxs("div",{children:[e.jsx("strong",{children:"ConcluÃ­da em:"})," ",new Date(s.data_conclusao).toLocaleString("pt-BR")]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[s.status==="pendente"&&e.jsx("button",{onClick:O=>{O.stopPropagation(),r(s.id)},style:{padding:"8px 16px",backgroundColor:"#28A745",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontWeight:"bold",fontSize:14,display:"flex",alignItems:"center",gap:5},children:"ðŸš€ Iniciar Rota"}),(s.status==="em_rota"||s.status==="em_andamento")&&A&&e.jsx("button",{onClick:O=>{O.stopPropagation(),J(s.id,s.km_inicial)},disabled:$,style:{padding:"8px 16px",backgroundColor:$?"#ccc":"#007BFF",color:"#fff",border:"none",borderRadius:6,cursor:$?"not-allowed":"pointer",fontWeight:"bold",fontSize:14,display:"flex",alignItems:"center",gap:5},children:$?"â³ Processando...":"âœ… Finalizar Rota"}),(s.status==="em_rota"||s.status==="em_andamento")&&M===d.length&&e.jsx("button",{onClick:O=>{O.stopPropagation(),o(s.id)},style:{padding:"8px 16px",backgroundColor:"#FFC107",color:"#000",border:"none",borderRadius:6,cursor:"pointer",fontWeight:"bold",fontSize:14,display:"flex",alignItems:"center",gap:5},children:"â†©ï¸ Reverter InÃ­cio"}),(s.status==="pendente"||s.status==="em_rota"||s.status==="em_andamento")&&e.jsx("button",{onClick:O=>{O.stopPropagation(),g(s.id)},style:{padding:"8px 16px",backgroundColor:"#DC3545",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontWeight:"bold",fontSize:14,display:"flex",alignItems:"center",gap:5},children:"ðŸ—‘ï¸ Excluir"}),e.jsx("div",{style:{padding:"5px 15px",borderRadius:20,backgroundColor:v(s.status),color:"#fff",fontWeight:"bold",fontSize:14,whiteSpace:"nowrap"},children:j(s.status)})]})]}),s.observacoes&&e.jsxs("div",{style:{marginTop:10,padding:10,backgroundColor:"#f8f9fa",borderRadius:5,fontSize:14,color:"#666"},children:[e.jsx("strong",{children:"ObservaÃ§Ãµes:"})," ",s.observacoes]})]}),l&&d.length>0&&e.jsxs("div",{style:{marginTop:20,borderTop:"2px solid #eee",paddingTop:15},children:[e.jsx("h4",{style:{marginBottom:15},children:"ðŸ“ Paradas da Rota (arraste para reordenar)"}),d.map((O,z)=>{var ae,W,ne,H;return e.jsxs("div",{children:[e.jsxs("div",{draggable:!0,onDragStart:ee=>S(ee,z),onDragOver:ee=>P(ee,z),onDragEnd:G,style:{padding:12,marginBottom:10,border:"1px solid #ddd",borderRadius:6,backgroundColor:k===z?"#f0f8ff":"#fafafa",cursor:"move",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:5},children:[e.jsxs("span",{style:{fontWeight:"bold",marginRight:10,fontSize:18,color:"#007BFF"},children:[O.ordem,"Âº"]}),e.jsxs("span",{style:{color:"#666",fontSize:14},children:["Venda #",O.venda_id]}),O.status&&e.jsx("span",{style:{marginLeft:10,padding:"2px 8px",borderRadius:12,fontSize:12,backgroundColor:O.status==="entregue"?"#d4edda":O.status==="tentativa"?"#fff3cd":"#e2e3e5",color:O.status==="entregue"?"#155724":O.status==="tentativa"?"#856404":"#383d41"},children:O.status==="entregue"?"âœ“ Entregue":O.status==="tentativa"?"âš  Tentativa":"Pendente"})]}),e.jsxs("div",{style:{fontSize:13,color:"#333",lineHeight:1.6},children:[O.cliente_nome&&e.jsxs("div",{style:{marginBottom:4},children:[e.jsxs("strong",{style:{color:"#1565C0"},children:["ðŸ‘¤ ",O.cliente_nome]}),O.cliente_telefone&&e.jsxs("span",{style:{marginLeft:12,color:"#555"},children:["ðŸ“ž ",O.cliente_telefone]}),O.cliente_celular&&e.jsxs("span",{style:{marginLeft:12,color:"#555"},children:["ðŸ“± ",O.cliente_celular]})]}),e.jsxs("div",{style:{color:"#555"},children:["ðŸ“ ",O.endereco,O.distancia_acumulada&&e.jsxs("span",{style:{marginLeft:12,color:"#777"},children:["â€¢ Dist: ",O.distancia_acumulada," km"]}),O.tempo_acumulado&&e.jsxs("span",{style:{marginLeft:12,color:"#777"},children:["â€¢ Tempo aprox: ",N(O.tempo_acumulado)]})]})]}),O.data_entrega&&e.jsxs("div",{style:{color:"#28a745",fontSize:12,marginTop:3},children:["âœ“ Entregue em: ",new Date(O.data_entrega).toLocaleString("pt-BR")]}),O.observacoes&&e.jsxs("div",{style:{marginTop:6,padding:6,backgroundColor:"#fff3cd",borderRadius:4,fontSize:12,color:"#856404",border:"1px solid #ffc107"},children:["ðŸ“‹ ",O.observacoes]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,alignItems:"flex-end"},children:[O.status!=="entregue"&&s.status==="em_rota"&&e.jsx("button",{onClick:ee=>{ee.stopPropagation(),q(O.id,s.id)},disabled:C===O.id,style:{padding:"8px 12px",backgroundColor:C===O.id?"#ccc":"#28A745",color:"#fff",border:"none",borderRadius:6,cursor:C===O.id?"not-allowed":"pointer",fontWeight:"600",fontSize:12,whiteSpace:"nowrap",width:"130px",textAlign:"center"},children:C===O.id?"â³...":"âœ… Entregue"}),O.status!=="entregue"&&(s.status==="em_rota"||s.status==="em_andamento")&&e.jsx("button",{onClick:ee=>{ee.stopPropagation(),R(O.id,s.id,O.venda_id)},disabled:_===O.id,style:{padding:"8px 12px",backgroundColor:_===O.id?"#ccc":"#FFC107",color:"#000",border:"none",borderRadius:6,cursor:_===O.id?"not-allowed":"pointer",fontWeight:"600",fontSize:12,whiteSpace:"nowrap",width:"130px",textAlign:"center"},children:_===O.id?"â³...":"âš ï¸ Falta Entregar"}),e.jsx("button",{onClick:ee=>{ee.stopPropagation(),Z(O.id,s.id)},style:{padding:"8px 12px",backgroundColor:"#6C757D",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:"600",whiteSpace:"nowrap",width:"130px",textAlign:"center"},children:"ðŸ“ ObservaÃ§Ã£o"}),e.jsx("button",{onClick:ee=>{ee.stopPropagation(),c===O.id?re():Q(O.id,O.venda_id)},style:{padding:"8px 12px",backgroundColor:"#17A2B8",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:"600",whiteSpace:"nowrap",width:"130px",textAlign:"center"},children:"ðŸ“„ Detalhes"})]})]}),c===O.id&&e.jsx("div",{style:{marginTop:0,marginBottom:15,padding:15,backgroundColor:"#f8f9fa",borderRadius:8,border:"2px solid #007BFF",boxShadow:"0 2px 8px rgba(0,123,255,0.2)"},children:u?e.jsx("div",{style:{textAlign:"center",color:"#666",padding:20},children:"Carregando detalhes da venda..."}):p?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:15,borderBottom:"2px solid #007BFF",paddingBottom:10},children:[e.jsxs("h4",{style:{margin:0,color:"#007BFF"},children:["ðŸ§¾ Detalhes da Venda #",p.id]}),e.jsx("button",{onClick:ee=>{ee.stopPropagation(),re()},style:{background:"#dc3545",color:"#fff",border:"none",borderRadius:4,padding:"6px 12px",cursor:"pointer",fontWeight:"bold",fontSize:13},children:"âœ• Fechar"})]}),e.jsx("div",{style:{backgroundColor:"#e7f3ff",padding:12,borderRadius:6,marginBottom:15,border:"1px solid #007BFF"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,fontSize:14},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ‘¤ Cliente:"})," ",((ae=p.cliente)==null?void 0:ae.nome)||p.nome_cliente||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ“… Data:"})," ",p.data_venda?new Date(p.data_venda).toLocaleString("pt-BR"):"N/A"]}),((W=p.cliente)==null?void 0:W.telefone)&&e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ“ž Telefone:"})," ",p.cliente.telefone]}),((ne=p.cliente)==null?void 0:ne.celular)&&e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ“± Celular:"})," ",p.cliente.celular]}),((H=p.cliente)==null?void 0:H.email)&&e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("strong",{children:"ðŸ“§ Email:"})," ",p.cliente.email]})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,fontSize:14,marginBottom:15},children:[e.jsxs("div",{style:{padding:10,backgroundColor:"#d4edda",borderRadius:4,border:"1px solid #28a745"},children:[e.jsx("div",{style:{fontSize:11,color:"#155724",marginBottom:3},children:"VALOR TOTAL"}),e.jsxs("div",{style:{fontWeight:"bold",fontSize:16,color:"#155724"},children:["R$ ",parseFloat(p.valor_total||p.total||0).toFixed(2)]})]}),e.jsxs("div",{style:{padding:10,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[e.jsx("div",{style:{fontSize:11,color:"#666",marginBottom:3},children:"PAGAMENTO"}),e.jsx("div",{style:{fontWeight:"bold",fontSize:14},children:p.forma_pagamento||"N/A"})]}),e.jsxs("div",{style:{padding:10,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[e.jsx("div",{style:{fontSize:11,color:"#666",marginBottom:3},children:"STATUS"}),e.jsx("div",{style:{fontWeight:"bold",fontSize:14},children:p.status_pagamento||"N/A"})]})]}),p.endereco_entrega&&e.jsxs("div",{style:{padding:12,backgroundColor:"#e3f2fd",borderRadius:6,marginBottom:15,border:"1px solid #2196F3"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:5,color:"#1976D2"},children:"ðŸ“ EndereÃ§o de Entrega"}),e.jsx("div",{style:{color:"#424242",fontSize:14},children:p.endereco_entrega})]}),p.observacoes&&e.jsxs("div",{style:{padding:12,backgroundColor:"#fff3cd",borderRadius:6,marginBottom:15,border:"1px solid #ffc107"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:5,color:"#f57c00"},children:"ðŸ’¬ ObservaÃ§Ãµes"}),e.jsx("div",{style:{color:"#424242",fontSize:14},children:p.observacoes})]}),p.itens&&p.itens.length>0&&e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold",fontSize:15,marginBottom:10,color:"#424242"},children:["ðŸ›’ Itens da Venda (",p.itens.length,")"]}),e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:6,border:"1px solid #ddd",overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[p.itens.map((ee,de)=>{var ue,Re,se,_e;return e.jsxs("div",{style:{padding:12,borderBottom:de<p.itens.length-1?"1px solid #eee":"none",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:de%2===0?"#fafafa":"#fff"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"600",marginBottom:3,color:"#333"},children:((ue=ee.produto)==null?void 0:ue.nome)||((Re=ee.servico)==null?void 0:Re.nome)||ee.produto_nome||ee.servico_descricao||"Item"}),(((se=ee.produto)==null?void 0:se.codigo)||ee.produto_codigo)&&e.jsxs("div",{style:{fontSize:12,color:"#999"},children:["CÃ³d: ",((_e=ee.produto)==null?void 0:_e.codigo)||ee.produto_codigo]})]}),e.jsxs("div",{style:{textAlign:"right",minWidth:120},children:[e.jsxs("div",{style:{color:"#666",fontSize:13,marginBottom:2},children:[ee.quantidade," Ã— R$ ",parseFloat(ee.valor_unitario||ee.preco_unitario||0).toFixed(2)]}),e.jsxs("div",{style:{fontSize:15,color:"#28a745",fontWeight:"bold"},children:["R$ ",parseFloat((ee.quantidade||0)*(ee.valor_unitario||ee.preco_unitario||0)).toFixed(2)]})]})]},de)}),e.jsxs("div",{style:{padding:14,backgroundColor:"#1976D2",display:"flex",justifyContent:"space-between",alignItems:"center",color:"#fff"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:16},children:"TOTAL DA VENDA"}),e.jsxs("span",{style:{fontWeight:"bold",fontSize:18},children:["R$ ",parseFloat(p.valor_total||p.total||0).toFixed(2)]})]})]})]})]}):null})]},O.id)})]})]})}function Zd(){const[s,l]=a.useState([]),[t,m]=a.useState(!0),[r,g]=a.useState(null);a.useEffect(()=>{o()},[]);async function o(){try{m(!0);const j=await F.get("/rotas-entrega/?status=concluida");l(j.data)}catch(j){console.error("Erro ao carregar histÃ³rico:",j),alert("Erro ao carregar histÃ³rico de entregas")}finally{m(!1)}}function v(j){g(r===j?null:j)}return t?e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"ðŸ“œ HistÃ³rico de Entregas"}),e.jsx("p",{children:"Carregando histÃ³rico..."})]}):e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"ðŸ“œ HistÃ³rico de Entregas"}),e.jsx("p",{style:{color:"#666",marginBottom:20},children:"Rotas finalizadas e conferidas"}),e.jsx("div",{style:{marginBottom:20,display:"flex",gap:10,alignItems:"center"},children:e.jsx("button",{onClick:o,className:"btn-secondary",style:{marginLeft:"auto"},children:"ðŸ”„ Atualizar"})}),!Array.isArray(s)||s.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"Nenhuma rota finalizada encontrada"})}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:15},children:s.map(j=>{var f,N;return e.jsxs("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:15,backgroundColor:"#fff"},children:[e.jsx("div",{style:{cursor:"pointer"},onClick:()=>v(j.id),children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("h3",{style:{margin:0,marginBottom:10},children:["ðŸšš ",j.numero||`Rota #${j.id}`,r===j.id?" ðŸ”½":" â–¶ï¸"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:10,color:"#555",fontSize:14},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Entregador:"})," ",((f=j.entregador)==null?void 0:f.nome)||"NÃ£o informado"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Paradas:"})," ",((N=j.paradas)==null?void 0:N.length)||0," entrega(s)"]}),j.distancia_prevista&&e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ“ Previsto:"})," ",parseFloat(j.distancia_prevista).toFixed(1)," km"]}),j.km_inicial&&e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ KM Inicial:"})," ",parseFloat(j.km_inicial).toFixed(1)]}),j.km_final&&e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ KM Final:"})," ",parseFloat(j.km_final).toFixed(1)]}),j.km_inicial&&j.km_final&&e.jsxs("div",{style:{color:"#007BFF",fontWeight:"600"},children:[e.jsx("strong",{children:"ðŸ“ Total:"})," ",(parseFloat(j.km_final)-parseFloat(j.km_inicial)).toFixed(1)," km",j.distancia_prevista&&(()=>{const d=parseFloat(j.km_final)-parseFloat(j.km_inicial),x=parseFloat(j.distancia_prevista),k=d-x,w=(k/x*100).toFixed(1);return e.jsxs("div",{style:{fontSize:12,color:k>0?"#DC3545":"#28A745",marginTop:2},children:[k>0?"â†‘":"â†“"," ",Math.abs(k).toFixed(1)," km (",k>0?"+":"",w,"%)"]})})()]}),j.distancia_real&&!(j.km_inicial&&j.km_final)&&e.jsxs("div",{children:[e.jsx("strong",{children:"DistÃ¢ncia:"})," ",parseFloat(j.distancia_real).toFixed(1)," km"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"ConcluÃ­da em:"})," ",new Date(j.data_conclusao).toLocaleString("pt-BR")]}),j.custo_real&&e.jsxs("div",{children:[e.jsx("strong",{children:"Custo:"})," R$ ",parseFloat(j.custo_real).toFixed(2)]})]}),j.observacoes&&e.jsxs("div",{style:{marginTop:10,padding:10,backgroundColor:"#f8f9fa",borderRadius:5,fontSize:14,color:"#666"},children:[e.jsx("strong",{children:"ObservaÃ§Ãµes:"})," ",j.observacoes]})]}),e.jsx("div",{style:{padding:"5px 15px",borderRadius:20,backgroundColor:"#28A745",color:"#fff",fontWeight:"bold",fontSize:14,whiteSpace:"nowrap"},children:"âœ… ConcluÃ­da"})]})}),r===j.id&&j.paradas&&j.paradas.length>0&&e.jsxs("div",{style:{marginTop:20,borderTop:"2px solid #eee",paddingTop:15},children:[e.jsx("h4",{style:{marginBottom:15},children:"ðŸ“ Entregas da Rota"}),j.paradas.map(d=>e.jsx("div",{style:{padding:12,marginBottom:10,border:"1px solid #ddd",borderRadius:6,backgroundColor:d.status==="entregue"?"#f0fff4":"#fafafa"},children:e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:5},children:[e.jsxs("span",{style:{fontWeight:"bold",marginRight:10,fontSize:18,color:"#007BFF"},children:[d.ordem,"Âº"]}),e.jsxs("span",{style:{color:"#666",fontSize:14},children:["Venda #",d.venda_id]}),e.jsx("span",{style:{marginLeft:10,padding:"2px 8px",borderRadius:12,fontSize:12,backgroundColor:d.status==="entregue"?"#d4edda":"#e2e3e5",color:d.status==="entregue"?"#155724":"#383d41"},children:d.status==="entregue"?"âœ“ Entregue":d.status})]}),e.jsxs("div",{style:{fontSize:13,color:"#333",lineHeight:1.6},children:[d.cliente_nome&&e.jsxs("div",{style:{marginBottom:4},children:[e.jsxs("strong",{style:{color:"#1565C0"},children:["ðŸ‘¤ ",d.cliente_nome]}),d.cliente_telefone&&e.jsxs("span",{style:{marginLeft:12,color:"#555"},children:["ðŸ“ž ",d.cliente_telefone]}),d.cliente_celular&&e.jsxs("span",{style:{marginLeft:12,color:"#555"},children:["ðŸ“± ",d.cliente_celular]})]}),e.jsxs("div",{style:{color:"#555"},children:["ðŸ“ ",d.endereco,d.distancia_acumulada&&e.jsxs("span",{style:{marginLeft:12,color:"#777"},children:["â€¢ Dist: ",d.distancia_acumulada," km"]}),d.km_entrega&&e.jsxs("span",{style:{marginLeft:12,color:"#777"},children:["â€¢ KM: ",d.km_entrega]})]})]}),d.data_entrega&&e.jsxs("div",{style:{color:"#28a745",fontSize:12,marginTop:3},children:["âœ“ Entregue em: ",new Date(d.data_entrega).toLocaleString("pt-BR")]}),d.observacoes&&e.jsxs("div",{style:{marginTop:6,padding:6,backgroundColor:"#fff3cd",borderRadius:4,fontSize:12,color:"#856404",border:"1px solid #ffc107"},children:["ðŸ“‹ ",d.observacoes]})]})})},d.id))]})]},j.id)})})]})}function ec(){const[s,l]=a.useState(""),[t,m]=a.useState(""),[r,g]=a.useState(null),[o,v]=a.useState(null),[j,f]=a.useState(null),[N,d]=a.useState(!1),[x,k]=a.useState(null);async function w(){var b,p;if(!s||!t){k("Selecione o perÃ­odo para consulta");return}d(!0),k(null);try{const[i,u,n]=await Promise.all([F.get("/dashboard/entregas/financeiro",{params:{data_inicio:s,data_fim:t}}),F.get("/dashboard/entregas/financeiro/graficos",{params:{data_inicio:s,data_fim:t}}),F.get("/dashboard/entregas/financeiro/ia",{params:{data_inicio:s,data_fim:t}}).catch(()=>null)]);g(i.data),v(u.data),f((n==null?void 0:n.data)||{alertas:[],sugestoes:[]})}catch(i){console.error("Erro ao carregar dados:",i),k(((p=(b=i.response)==null?void 0:b.data)==null?void 0:p.detail)||"Erro ao carregar dados do dashboard")}finally{d(!1)}}a.useEffect(()=>{const b=new Date,p=new Date(b.getFullYear(),b.getMonth(),1);l(p.toISOString().slice(0,10)),m(b.toISOString().slice(0,10))},[]),a.useEffect(()=>{s&&t&&w()},[s,t]);const c=()=>{if(!r||r.total_entregas===0)return null;const b=r.margem_media,p=b>=0?"text-green-600":"text-red-600",i=b>=0?"âœ…":"âš ï¸";return e.jsxs("div",{className:`p-4 border rounded-lg ${b>=0?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:i}),e.jsx("h3",{className:"font-semibold text-gray-700",children:"AnÃ¡lise de Margem"})]}),e.jsx("p",{className:`text-sm ${p}`,children:b>=0?e.jsxs(e.Fragment,{children:["A taxa de entrega estÃ¡ ",e.jsx("strong",{children:"cobrindo os custos"})," com uma margem mÃ©dia de ",e.jsx("strong",{children:Ps(b)})," por entrega."]}):e.jsxs(e.Fragment,{children:["âš ï¸ A taxa de entrega estÃ¡ ",e.jsx("strong",{children:"abaixo dos custos"}),". DÃ©ficit mÃ©dio de ",e.jsx("strong",{children:Ps(Math.abs(b))})," por entrega."]})})]})};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Zs,{className:"text-blue-600"}),"Dashboard Financeiro de Entregas"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Visualize os custos e receitas das entregas realizadas no perÃ­odo"})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{className:"text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"PerÃ­odo:"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"De:"}),e.jsx("input",{type:"date",value:s,onChange:b=>l(b.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"AtÃ©:"}),e.jsx("input",{type:"date",value:t,onChange:b=>m(b.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("button",{onClick:w,disabled:N,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(vt,{className:N?"animate-spin":""}),N?"Carregando...":"Atualizar"]})]})}),x&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6 flex items-center gap-2",children:[e.jsx(Na,{}),e.jsx("span",{children:x})]}),N&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(No,{}),e.jsx(No,{})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((b,p)=>e.jsx(ac,{},p))}),e.jsx(mr,{}),e.jsx(mr,{}),e.jsx(mr,{})]}),!N&&r&&e.jsxs(e.Fragment,{children:[j&&j.alertas&&j.alertas.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(ft,{className:"text-yellow-600"}),"Alertas AutomÃ¡ticos"]}),e.jsx("div",{className:"space-y-3",children:j.alertas.map((b,p)=>e.jsx("div",{className:"p-4 border border-yellow-200 bg-yellow-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700",children:b})},p))})]}),j&&j.sugestoes&&j.sugestoes.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ’¡"}),"SugestÃµes PrÃ¡ticas"]}),e.jsx("div",{className:"space-y-3",children:j.sugestoes.map((b,p)=>e.jsx("div",{className:"p-4 border border-blue-200 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700",children:b})},p))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[e.jsx(Js,{titulo:"Total de Entregas",valor:r.total_entregas,icon:e.jsx(Zs,{className:"text-blue-600"}),colorClasse:"border-blue-200 bg-blue-50"}),e.jsx(Js,{titulo:"Custo Total",valor:Ps(r.custo_total_entregas),icon:e.jsx(Ga,{className:"text-red-600"}),colorClasse:"border-red-200 bg-red-50",subtitulo:"Entregadores + Moto"}),e.jsx(Js,{titulo:"Custo Entregadores",valor:Ps(r.custo_total_entregadores),icon:e.jsx(is,{className:"text-purple-600"}),colorClasse:"border-purple-200 bg-purple-50"}),e.jsx(Js,{titulo:"Custo da Moto",valor:Ps(r.custo_total_moto),icon:e.jsx(Rl,{className:"text-orange-600"}),colorClasse:"border-orange-200 bg-orange-50"}),e.jsx(Js,{titulo:"Repasse aos Entregadores",valor:Ps(r.total_repasse_taxa),icon:e.jsx(Yt,{className:"text-green-600"}),colorClasse:"border-green-200 bg-green-50"}),e.jsx(Js,{titulo:"Custo MÃ©dio por Entrega",valor:Ps(r.custo_medio_por_entrega),icon:e.jsx(or,{className:"text-indigo-600"}),colorClasse:"border-indigo-200 bg-indigo-50"})]}),c(),o&&e.jsxs("div",{className:"space-y-6 mt-6",children:[o.por_dia&&o.por_dia.length>0&&e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ðŸ“ˆ Custo Total por Dia"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:'Responde: "Estou gastando mais?"'}),e.jsx(Ma,{width:"100%",height:300,children:e.jsxs(it,{data:o.por_dia,children:[e.jsx(Oa,{strokeDasharray:"3 3"}),e.jsx(Ba,{dataKey:"data",tick:{fontSize:12},tickFormatter:b=>{const[p,i,u]=b.split("-");return`${u}/${i}`}}),e.jsx(Ia,{tick:{fontSize:12}}),e.jsx(Pa,{formatter:b=>`R$ ${Number(b).toFixed(2)}`,labelFormatter:b=>{const[p,i,u]=b.split("-");return`${u}/${i}/${p}`}}),e.jsx(Ta,{}),e.jsx(ls,{type:"monotone",dataKey:"custo",stroke:"#ef4444",strokeWidth:2,name:"Custo Total (R$)"})]})})]}),o.custo_medio&&o.custo_medio.length>0&&e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ðŸ“‰ Custo MÃ©dio por Entrega"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:'Responde: "Entregar estÃ¡ ficando caro?"'}),e.jsx(Ma,{width:"100%",height:300,children:e.jsxs(it,{data:o.custo_medio,children:[e.jsx(Oa,{strokeDasharray:"3 3"}),e.jsx(Ba,{dataKey:"data",tick:{fontSize:12},tickFormatter:b=>{const[p,i,u]=b.split("-");return`${u}/${i}`}}),e.jsx(Ia,{tick:{fontSize:12}}),e.jsx(Pa,{formatter:b=>`R$ ${Number(b).toFixed(2)}`,labelFormatter:b=>{const[p,i,u]=b.split("-");return`${u}/${i}/${p}`}}),e.jsx(Ta,{}),e.jsx(ls,{type:"monotone",dataKey:"valor",stroke:"#8b5cf6",strokeWidth:2,name:"Custo MÃ©dio (R$)"})]})})]}),o.taxa_vs_custo&&e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ðŸ“Š Taxa Cobrada Ã— Custo Real"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:'Responde: "A taxa cobre o custo?"'}),e.jsx(Ma,{width:"100%",height:300,children:e.jsxs(ns,{data:[{name:"MÃ©dia","Taxa Cobrada":o.taxa_vs_custo.taxa_media,"Custo Real":o.taxa_vs_custo.custo_medio}],children:[e.jsx(Oa,{strokeDasharray:"3 3"}),e.jsx(Ba,{dataKey:"name"}),e.jsx(Ia,{}),e.jsx(Pa,{formatter:b=>`R$ ${Number(b).toFixed(2)}`}),e.jsx(Ta,{}),e.jsx(Ka,{dataKey:"Taxa Cobrada",fill:"#10b981"}),e.jsx(Ka,{dataKey:"Custo Real",fill:"#ef4444"})]})}),e.jsx("div",{className:"mt-4 text-center",children:o.taxa_vs_custo.taxa_media>=o.taxa_vs_custo.custo_medio?e.jsxs("p",{className:"text-green-600 font-medium",children:["âœ… Taxa mÃ©dia (R$ ",o.taxa_vs_custo.taxa_media.toFixed(2),") cobre o custo mÃ©dio (R$ ",o.taxa_vs_custo.custo_medio.toFixed(2),")"]}):e.jsxs("p",{className:"text-red-600 font-medium",children:["âš ï¸ Taxa mÃ©dia (R$ ",o.taxa_vs_custo.taxa_media.toFixed(2),") estÃ¡ abaixo do custo mÃ©dio (R$ ",o.taxa_vs_custo.custo_medio.toFixed(2),")"]})})]})]}),e.jsxs("div",{className:"mt-6 text-sm text-gray-500 text-center",children:["Dados do perÃ­odo: ",_o(r.periodo.data_inicio)," atÃ© ",_o(r.periodo.data_fim)]})]}),!N&&r&&r.total_entregas===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Zs,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-2",children:"Nenhuma entrega encontrada"}),e.jsx("p",{className:"text-gray-500",children:"NÃ£o hÃ¡ entregas concluÃ­das no perÃ­odo selecionado"})]})]})}function Js({titulo:s,valor:l,icon:t,colorClasse:m,subtitulo:r}){return e.jsxs("div",{className:`p-5 rounded-lg border shadow-sm ${m||"border-gray-200 bg-white"}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsx("div",{className:"text-2xl",children:t})}),e.jsx("h4",{className:"text-sm font-medium text-gray-600 mb-1",children:s}),r&&e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:r}),e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:l})]})}function ac(){return e.jsx("div",{style:{height:110,borderRadius:8,background:"linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"}})}function mr(){return e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{style:{height:20,width:"40%",borderRadius:4,background:"linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite",marginBottom:16}}),e.jsx("div",{style:{height:300,borderRadius:8,background:"linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"}})]})}function No(){return e.jsx("div",{style:{height:80,borderRadius:8,background:"linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"}})}function Ps(s){return s==null?"R$ 0,00":s.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}function _o(s){if(!s)return"";const[l,t,m]=s.split("-");return`${m}/${t}/${l}`}function sc(){return e.jsx(Wl,{children:e.jsxs(Al,{children:[e.jsx(Dl,{position:"top-right"}),e.jsxs(Ml,{children:[e.jsx(Ge,{path:"/login",element:e.jsx(Ql,{})}),e.jsx(Ge,{path:"/register",element:e.jsx(Xl,{})}),e.jsxs(Ge,{path:"/",element:e.jsx(ba,{children:e.jsx(Gl,{})}),children:[e.jsx(Ge,{index:!0,element:e.jsx(ur,{to:"/lembretes",replace:!0})}),e.jsx(Ge,{path:"dashboard",element:e.jsx(ba,{permission:"relatorios.gerencial",children:e.jsx(ho,{})})}),e.jsx(Ge,{path:"dashboard-gerencial",element:e.jsx(ba,{permission:"relatorios.gerencial",children:e.jsx(Ld,{})})}),e.jsx(Ge,{path:"clientes",element:e.jsx(ba,{permission:"clientes.visualizar",children:e.jsx(on,{})})}),e.jsx(Ge,{path:"clientes/:clienteId/financeiro",element:e.jsx(ba,{permission:"clientes.visualizar",children:e.jsx(Dd,{})})}),e.jsx(Ge,{path:"clientes/:clienteId/timeline",element:e.jsx(ba,{permission:"clientes.visualizar",children:e.jsx(gi,{})})}),e.jsx(Ge,{path:"pets",element:e.jsx(Dn,{})}),e.jsx(Ge,{path:"pets/novo",element:e.jsx(uo,{})}),e.jsx(Ge,{path:"pets/:petId",element:e.jsx(qn,{})}),e.jsx(Ge,{path:"pets/:petId/editar",element:e.jsx(uo,{})}),e.jsx(Ge,{path:"produtos",element:e.jsx(ba,{permission:"produtos.visualizar",children:e.jsx(_n,{})})}),e.jsx(Ge,{path:"produtos/novo",element:e.jsx(ba,{permission:"produtos.criar",children:e.jsx(mo,{})})}),e.jsx(Ge,{path:"produtos/:id/editar",element:e.jsx(ba,{permission:"produtos.editar",children:e.jsx(mo,{})})}),e.jsx(Ge,{path:"produtos/:id/movimentacoes",element:e.jsx(hi,{})}),e.jsx(Ge,{path:"produtos/relatorio",element:e.jsx(Cn,{})}),e.jsx(Ge,{path:"estoque/alertas",element:e.jsx(ba,{permission:"produtos.visualizar",children:e.jsx(Pn,{})})}),e.jsx(Ge,{path:"lembretes",element:e.jsx(Rn,{})}),e.jsx(Ge,{path:"calculadora-racao",element:e.jsx(An,{})}),e.jsx(Ge,{path:"pdv",element:e.jsx(ba,{permission:"vendas.criar",children:e.jsx(xi,{})})}),e.jsx(Ge,{path:"meus-caixas",element:e.jsx(ui,{})}),e.jsx(Ge,{path:"notas-fiscais",element:e.jsx(pi,{})}),e.jsx(Ge,{path:"compras/pedidos",element:e.jsx(ba,{permission:"compras.gerenciar",children:e.jsx(fi,{})})}),e.jsx(Ge,{path:"compras/entrada-xml",element:e.jsx(ba,{permission:"compras.gerenciar",children:e.jsx(yi,{})})}),e.jsx(Ge,{path:"compras/bling",element:e.jsx(ba,{permission:"compras.gerenciar",children:e.jsx(bi,{})})}),e.jsx(Ge,{path:"financeiro",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(ho,{})})}),e.jsx(Ge,{path:"financeiro/vendas",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(Ki,{})})}),e.jsx(Ge,{path:"financeiro/relatorio-vendas",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(Wi,{})})}),e.jsx(Ge,{path:"financeiro/contas-pagar",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(ki,{})})}),e.jsx(Ge,{path:"financeiro/contas-receber",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(Si,{})})}),e.jsx(Ge,{path:"financeiro/conciliacao-3abas",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(Pi,{})})}),e.jsx(Ge,{path:"financeiro/historico-conciliacoes",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(Ri,{})})}),e.jsx(Ge,{path:"financeiro/conciliacao-bancaria",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(Mi,{})})}),e.jsx(Ge,{path:"financeiro/fluxo-caixa",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(Ui,{})})}),e.jsx(Ge,{path:"financeiro/dre",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(Zi,{})})}),e.jsx(Ge,{path:"comissoes",element:e.jsx(Nd,{})}),e.jsx(Ge,{path:"comissoes/demonstrativo",element:e.jsx(Cd,{})}),e.jsx(Ge,{path:"comissoes/relatorios",element:e.jsx($d,{})}),e.jsx(Ge,{path:"comissoes/abertas",element:e.jsx(kd,{})}),e.jsx(Ge,{path:"comissoes/fechamento/:funcionario_id",element:e.jsx(Sd,{})}),e.jsx(Ge,{path:"comissoes/fechamentos",element:e.jsx(Ed,{})}),e.jsx(Ge,{path:"comissoes/fechamentos/detalhe",element:e.jsx(Fd,{})}),e.jsx(Ge,{path:"subcategorias",element:e.jsx(yo,{})}),e.jsx(Ge,{path:"cadastros/categorias",element:e.jsx(Pd,{})}),e.jsx(Ge,{path:"cadastros/categorias-financeiras",element:e.jsx(Rd,{})}),e.jsx(Ge,{path:"cadastros/especies-racas",element:e.jsx(Ad,{})}),e.jsx(Ge,{path:"cadastros/cargos",element:e.jsx(Hd,{})}),e.jsx(Ge,{path:"cadastros/financeiro/bancos",element:e.jsx(ba,{permission:"configuracoes.editar",children:e.jsx(wi,{})})}),e.jsx(Ge,{path:"cadastros/financeiro/formas-pagamento",element:e.jsx(ba,{permission:"configuracoes.editar",children:e.jsx(zi,{})})}),e.jsx(Ge,{path:"cadastros/financeiro/operadoras",element:e.jsx(ba,{permission:"configuracoes.editar",children:e.jsx(Ti,{})})}),e.jsx(Ge,{path:"subcategorias",element:e.jsx(yo,{})}),e.jsx(Ge,{path:"admin/usuarios",element:e.jsx(ba,{permission:"usuarios.manage",children:e.jsx(qd,{})})}),e.jsx(Ge,{path:"configuracoes",element:e.jsx(ba,{permission:"configuracoes.editar",children:e.jsx(Id,{})})}),e.jsx(Ge,{path:"configuracoes/fiscal",element:e.jsx(Td,{})}),e.jsx(Ge,{path:"configuracoes/entregas",element:e.jsx(Vd,{})}),e.jsx(Ge,{path:"configuracoes/custos-moto",element:e.jsx(Od,{})}),e.jsx(Ge,{path:"configuracoes/estoque",element:e.jsx(Bd,{})}),e.jsx(Ge,{path:"auditoria/provisoes",element:e.jsx(Ud,{})}),e.jsx(Ge,{path:"projecao-caixa",element:e.jsx(Wd,{})}),e.jsx(Ge,{path:"simulacao-contratacao",element:e.jsx(Kd,{})}),e.jsx(Ge,{path:"rh/funcionarios",element:e.jsx(Qd,{})}),e.jsx(Ge,{path:"admin/roles",element:e.jsx(zd,{})}),e.jsx(Ge,{path:"entregas/abertas",element:e.jsx(Xd,{})}),e.jsx(Ge,{path:"entregas/rotas",element:e.jsx(Jd,{})}),e.jsx(Ge,{path:"entregas/historico",element:e.jsx(Zd,{})}),e.jsx(Ge,{path:"entregas/financeiro",element:e.jsx(ec,{})}),e.jsx(Ge,{path:"ia/fluxo-caixa",element:e.jsx(ba,{permission:"ia.fluxo_caixa",children:e.jsx(id,{})})}),e.jsx(Ge,{path:"ia/chat",element:e.jsx(dd,{})}),e.jsx(Ge,{path:"ia/whatsapp",element:e.jsx(ba,{permission:"ia.whatsapp",children:e.jsx(yd,{})})}),e.jsx(Ge,{path:"ia/alertas-racao",element:e.jsx(ba,{permission:"produtos.editar",children:e.jsx(Qi,{})})}),e.jsx(Ge,{path:"cadastros/opcoes-racao",element:e.jsx(ba,{permission:"produtos.editar",children:e.jsx(Xi,{})})})]}),e.jsx(Ge,{path:"*",element:e.jsx(ur,{to:"/",replace:!0})})]})]})})}Ll.createRoot(document.getElementById("root")).render(e.jsx(ts.StrictMode,{children:e.jsx(sc,{})}));
