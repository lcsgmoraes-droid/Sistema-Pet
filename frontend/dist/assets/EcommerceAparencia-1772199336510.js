import{r as h,j as o}from"./vendor-react-1772199336510.js";import{a as R}from"./api-1772199336510.js";import"./index-1772199336510.js";const S=[{key:"logo",label:"Logo da Loja",desc:"Aparece no cabeÃ§alho da loja virtual (recomendado: 200Ã—80 px)",targetW:400,targetH:160},{key:"banner_1",label:"Banner 1",desc:"Primeiro slide do banner rotativo â€” serÃ¡ redimensionado para atÃ© 1200 px de largura",targetW:1200,targetH:null},{key:"banner_2",label:"Banner 2",desc:"Segundo slide (opcional)",targetW:1200,targetH:null},{key:"banner_3",label:"Banner 3",desc:"Terceiro slide (opcional)",targetW:1200,targetH:null}];function k(f,t,s,x=.9){return new Promise((j,u)=>{const a=new Image,g=URL.createObjectURL(f);a.onload=()=>{URL.revokeObjectURL(g);const i=document.createElement("canvas"),m=i.getContext("2d");if(s===null){const n=a.naturalWidth>t?t/a.naturalWidth:1;i.width=Math.round(a.naturalWidth*n),i.height=Math.round(a.naturalHeight*n),m.drawImage(a,0,0,i.width,i.height)}else{i.width=t,i.height=s,m.fillStyle="#ffffff",m.fillRect(0,0,t,s);const n=Math.min(t/a.naturalWidth,s/a.naturalHeight),p=a.naturalWidth*n,y=a.naturalHeight*n,v=(t-p)/2,e=(s-y)/2;m.drawImage(a,v,e,p,y)}i.toBlob(n=>n?j(n):u(new Error("canvas toBlob falhou")),"image/jpeg",x)},a.onerror=()=>{URL.revokeObjectURL(g),u(new Error("Falha ao carregar imagem"))},a.src=g})}function W({url:f,label:t,cacheBuster:s,isBanner:x}){if(!f)return o.jsx("div",{style:{width:"100%",minHeight:120,background:"#f3f4f6",border:"2px dashed #d1d5db",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",color:"#9ca3af",fontSize:14},children:"Sem imagem"});const j=f.startsWith("/uploads/")?`${f}?t=${s}`:f;return o.jsx("img",{src:j,alt:t,style:{width:"100%",height:x?140:100,objectFit:"contain",background:"#111",borderRadius:8,border:"1px solid #e5e7eb",display:"block"}})}function z(){const[f,t]=h.useState({logo_url:null,banner_1_url:null,banner_2_url:null,banner_3_url:null}),[s,x]=h.useState(!0),[j,u]=h.useState({}),[a,g]=h.useState(null),[i,m]=h.useState(Date.now()),n=h.useRef({});h.useEffect(()=>{R.get("/ecommerce-aparencia").then(e=>t(e.data)).catch(()=>g({tipo:"erro",texto:"NÃ£o foi possÃ­vel carregar as configuraÃ§Ãµes."})).finally(()=>x(!1))},[]);function p(e,r){g({tipo:e,texto:r}),setTimeout(()=>g(null),4e3)}async function y(e,r){u(l=>({...l,[e]:!0}));try{const l=S.find(w=>w.key===e);let b=r;if(l&&r.type.startsWith("image/")){const w=await k(r,l.targetW,l.targetH);b=new File([w],r.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg"})}const d=new FormData;d.append("file",b);const c=await R.post(`/ecommerce-aparencia/upload/${e}`,d,{headers:{"Content-Type":"multipart/form-data"}});t(c.data),m(Date.now()),p("ok","Imagem salva com sucesso!")}catch{p("erro","Erro ao enviar a imagem. Verifique o formato e o tamanho (mÃ¡x. 5 MB).")}finally{u(l=>({...l,[e]:!1}))}}async function v(e){u(r=>({...r,[e]:!0}));try{const r=await R.delete(`/ecommerce-aparencia/${e}`);t(r.data),m(Date.now()),p("ok","Imagem removida.")}catch{p("erro","Erro ao remover a imagem.")}finally{u(r=>({...r,[e]:!1}))}}return s?o.jsx("div",{style:{padding:40,textAlign:"center",color:"#6b7280"},children:"Carregando..."}):o.jsxs("div",{style:{maxWidth:800,margin:"0 auto",padding:"32px 24px"},children:[o.jsx("h1",{style:{fontSize:24,fontWeight:700,color:"#111827",marginBottom:4},children:"ðŸ–¼ï¸ AparÃªncia da Loja"}),o.jsx("p",{style:{color:"#6b7280",marginBottom:32},children:"Configure o logo e os banners que aparecem na sua loja virtual."}),a&&o.jsxs("div",{style:{padding:"12px 16px",borderRadius:8,marginBottom:24,background:a.tipo==="ok"?"#f0fdf4":"#fef2f2",color:a.tipo==="ok"?"#166534":"#991b1b",border:`1px solid ${a.tipo==="ok"?"#bbf7d0":"#fecaca"}`,fontWeight:500},children:[a.tipo==="ok"?"âœ… ":"âŒ ",a.texto]}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:24},children:S.map(({key:e,label:r,desc:l})=>{const b=f[`${e}_url`],d=j[e];return o.jsxs("div",{style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:24,boxShadow:"0 1px 3px rgba(0,0,0,0.06)"},children:[o.jsxs("div",{style:{marginBottom:12},children:[o.jsx("span",{style:{fontWeight:600,fontSize:16,color:"#111827"},children:r}),o.jsx("span",{style:{marginLeft:10,fontSize:13,color:"#9ca3af"},children:l})]}),o.jsx(W,{url:b,label:r,cacheBuster:i,isBanner:e!=="logo"}),o.jsxs("div",{style:{marginTop:14,display:"flex",gap:10,flexWrap:"wrap",alignItems:"center"},children:[o.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",style:{display:"none"},ref:c=>n.current[e]=c,onChange:c=>c.target.files[0]&&y(e,c.target.files[0])}),o.jsx("button",{onClick:()=>{var c;return(c=n.current[e])==null?void 0:c.click()},disabled:d,style:{padding:"8px 18px",background:d?"#d1d5db":"#6366f1",color:"#fff",border:"none",borderRadius:7,fontWeight:600,cursor:d?"not-allowed":"pointer",fontSize:14},children:d?"Enviando...":b?"ðŸ”„ Trocar imagem":"ðŸ“¤ Fazer upload"}),b&&o.jsx("button",{onClick:()=>v(e),disabled:d,style:{padding:"8px 14px",background:"#fff",color:"#dc2626",border:"1px solid #fca5a5",borderRadius:7,fontWeight:500,cursor:d?"not-allowed":"pointer",fontSize:14},children:"ðŸ—‘ Remover"})]})]},e)})}),o.jsxs("div",{style:{marginTop:32,padding:16,background:"#fffbeb",borderRadius:10,border:"1px solid #fde68a",fontSize:13,color:"#92400e"},children:[o.jsx("strong",{children:"ðŸ’¡ Dica:"})," As imagens sÃ£o redimensionadas automaticamente ao fazer upload. Para ver o resultado, acesse a ",o.jsx("a",{href:"/ecommerce",style:{color:"#6366f1"},children:"prÃ©via da loja"}),"."]})]})}export{z as default};
