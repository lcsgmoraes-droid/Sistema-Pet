import{r as n,j as e,B as z,D as B}from"./vendor-react-1772211443480.js";import{a as x}from"./index-1772211443480.js";function W(){const[g,b]=n.useState([]),[p,j]=n.useState([]),[v,f]=n.useState(!0),[N,d]=n.useState(!1),[u,m]=n.useState(null),[y,w]=n.useState({}),[o,l]=n.useState({nome:"",descricao:"",permissions:[]});async function h(){try{f(!0);const[s,r]=await Promise.all([x.get("/roles"),x.get("/permissions")]);b(s.data),j(r.data)}catch(s){console.error("Erro ao carregar dados:",s),alert("Erro ao carregar dados")}finally{f(!1)}}async function k(s){var r,a;s.preventDefault();try{u?(await x.put(`/roles/${u.role_id}`,o),alert("Role atualizada com sucesso!")):(await x.post("/roles",o),alert("Role criada com sucesso!")),d(!1),m(null),l({nome:"",descricao:"",permissions:[]}),h()}catch(c){console.error("Erro ao salvar role:",c),alert(((a=(r=c.response)==null?void 0:r.data)==null?void 0:a.detail)||"Erro ao salvar role")}}function C(s){m(s),l({nome:s.nome,descricao:s.descricao||"",permissions:s.permissions.map(r=>r.permission_id)}),d(!0)}function R(s){l(r=>({...r,permissions:r.permissions.includes(s)?r.permissions.filter(a=>a!==s):[...r.permissions,s]}))}function E(){const s={};return p.forEach(r=>{const a=r.nome&&r.nome.includes(".")?r.nome.split(".")[0]:"outras";s[a]||(s[a]=[]),s[a].push(r)}),s}function M(s){return{financeiro:"Financeiro",comissoes:"Comissões",entregas:"Entregas",compras:"Compras",cadastros:"Cadastros",configuracoes:"Configurações",rh:"Recursos Humanos",vendas:"Vendas",usuarios:"Usuários",relatorios:"Relatórios",ia:"Inteligência Artificial",outras:"Outras"}[s]||s.charAt(0).toUpperCase()+s.slice(1)}function L(s){w(r=>({...r,[s]:!r[s]}))}function _(s,r){const a=r.map(i=>i.permission_id),c=a.every(i=>o.permissions.includes(i));l(i=>({...i,permissions:c?i.permissions.filter(t=>!a.includes(t)):[...new Set([...i.permissions,...a])]}))}function P(s){return s.every(r=>o.permissions.includes(r.permission_id))}function S(s){const r=s.filter(a=>o.permissions.includes(a.permission_id));return r.length>0&&r.length<s.length}async function D(s){if(confirm("Tem certeza que deseja excluir esta role?"))try{await x.delete(`/roles/${s}`),alert("Role excluída com sucesso!"),h()}catch(r){console.error("Erro ao excluir role:",r),alert("Erro ao excluir role")}}return n.useEffect(()=>{h()},[]),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Permissões (Roles)"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie roles e suas permissões"})]}),e.jsxs("button",{onClick:()=>{m(null),l({nome:"",descricao:"",permissions:[]}),d(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Nova Role"]})]}),v?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Carregando..."})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:g.length===0?e.jsx("div",{className:"col-span-full text-center py-12 text-gray-500",children:"Nenhuma role encontrada"}):g.map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.nome}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.descricao})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>C(s),className:"text-blue-600 hover:text-blue-700",title:"Editar",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>D(s.role_id),className:"text-red-600 hover:text-red-700",title:"Excluir",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-2",children:"Permissões:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.permissions.length===0?e.jsx("span",{className:"text-sm text-gray-400",children:"Nenhuma permissão"}):s.permissions.map(r=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:r.nome},r.permission_id))})]})]},s.role_id))}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:u?"Editar Role":"Nova Role"}),e.jsx("button",{onClick:()=>{d(!1),m(null)},className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Role *"}),e.jsx("input",{type:"text",required:!0,value:o.nome,onChange:s=>l({...o,nome:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: Gerente, Vendedor, etc"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrição"}),e.jsx("textarea",{value:o.descricao||"",onChange:s=>l({...o,descricao:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"2",placeholder:"Descrição da role"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Permissões *"}),e.jsx("div",{className:"border border-gray-300 rounded-lg p-4 max-h-96 overflow-y-auto",children:p.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhuma permissão disponível"}):e.jsx("div",{className:"space-y-1",children:Object.entries(E()).map(([s,r])=>{const a=y[s],c=P(r),i=S(r);return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-center p-3 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>L(s),className:"text-gray-600 hover:text-gray-900 transition-colors",children:a?e.jsx(z,{className:"w-5 h-5"}):e.jsx(B,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center flex-1 cursor-pointer",onClick:()=>_(s,r),children:[e.jsx("input",{type:"checkbox",checked:c,ref:t=>{t&&(t.indeterminate=i)},onChange:()=>{},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-3 font-medium text-gray-900",children:M(s)}),e.jsxs("span",{className:"ml-auto text-xs text-gray-500",children:["(",r.filter(t=>o.permissions.includes(t.permission_id)).length,"/",r.length,")"]})]})]})}),a&&e.jsx("div",{className:"bg-white p-3 space-y-1 border-t border-gray-200",children:r.map(t=>e.jsxs("label",{className:"flex items-start cursor-pointer hover:bg-gray-50 p-2 rounded ml-4",children:[e.jsx("input",{type:"checkbox",checked:o.permissions.includes(t.permission_id),onChange:()=>R(t.permission_id),className:"mt-1 mr-3 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:t.nome.split(".")[1]||t.nome}),t.descricao&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:t.descricao})]})]},t.permission_id))})]},s)})})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{d(!1),m(null)},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[u?"Atualizar":"Criar"," Role"]})]})]})]})})})]})}export{W as default};
