import{ah as se,S as ae,r as n,j as e,T as re,af as le,ae as ie,Z as ne,aq as de,av as H,R as ce,aW as oe,B as xe,l as M,h as pe,bH as me,D as ge,p as he}from"./vendor-react-1772199336510.js";import{a as q}from"./index-1772199336510.js";const je=()=>{var S,k,T,V;const{clienteId:u}=se(),b=ae(),[g,O]=n.useState(null),[x,G]=n.useState(null),[j,I]=n.useState([]),[r,Q]=n.useState(null),[v,w]=n.useState(!0),[_,F]=n.useState(""),[h,C]=n.useState({}),[y,W]=n.useState({}),[N,D]=n.useState({}),[s,f]=n.useState({page:1,per_page:20,data_inicio:"",data_fim:"",tipo:"",status:""});n.useEffect(()=>{u&&Z()},[u,s]);const Z=async()=>{var t,l;try{w(!0),F("");const a=new URLSearchParams;a.append("page",s.page),a.append("per_page",s.per_page),s.data_inicio&&a.append("data_inicio",s.data_inicio),s.data_fim&&a.append("data_fim",s.data_fim),s.tipo&&a.append("tipo",s.tipo),s.status&&a.append("status",s.status);const d=await q.get(`/financeiro/cliente/${u}?${a.toString()}`);O(d.data.cliente),G(d.data.resumo),I(d.data.historico),Q(d.data.paginacao)}catch(a){console.error("Erro ao carregar hist√≥rico financeiro:",a),F(((l=(t=a.response)==null?void 0:t.data)==null?void 0:l.detail)||"Erro ao carregar hist√≥rico financeiro")}finally{w(!1)}},R=t=>{f({...s,page:t})},m=t=>{f({...s,...t,page:1})},$=()=>{f({page:1,per_page:20,data_inicio:"",data_fim:"",tipo:"",status:""})},J=async(t,l)=>{var d,c;const a=`${t.tipo}-${l}`;if(h[a]){C({...h,[a]:!1});return}C({...h,[a]:!0}),t.tipo==="venda"&&!y[(d=t.detalhes)==null?void 0:d.venda_id]&&await K((c=t.detalhes)==null?void 0:c.venda_id)},K=async t=>{if(t)try{D({...N,[t]:!0});const l=await q.get(`/vendas/${t}`);W({...y,[t]:l.data})}catch(l){console.error("Erro ao carregar detalhes da venda:",l)}finally{D({...N,[t]:!1})}},X=t=>{t&&b(`/pdv?venda=${t}`)},Y=t=>{switch(t){case"venda":return"üõí";case"devolucao":return"‚Ü©Ô∏è";case"conta_receber":return"üìÑ";case"recebimento":return"üí∞";case"credito":return"üí≥";default:return"üìä"}},ee=t=>{switch(t){case"venda":return"Venda";case"devolucao":return"Devolu√ß√£o";case"conta_receber":return"Conta a Receber";case"recebimento":return"Recebimento";case"credito":return"Cr√©dito";default:return t}},te=t=>({finalizada:"bg-green-100 text-green-700",concluida:"bg-green-100 text-green-700",pendente:"bg-yellow-100 text-yellow-700",paga:"bg-blue-100 text-blue-700",cancelada:"bg-red-100 text-red-700",devolvida:"bg-red-100 text-red-700",efetivado:"bg-green-100 text-green-700"})[t]||"bg-gray-100 text-gray-700";return v&&!j.length?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando hist√≥rico financeiro..."})]})}):_?e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-red-50 border border-red-300 rounded-xl p-6 text-center",children:[e.jsx(re,{className:"text-red-600 text-4xl mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Erro ao Carregar Dados"}),e.jsx("p",{className:"text-red-600 mb-4",children:_}),e.jsx("button",{onClick:()=>b("/clientes"),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Voltar para Clientes"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>b("/clientes"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4 transition-colors",children:[e.jsx(le,{}),e.jsx("span",{className:"font-medium",children:"Voltar para Clientes"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(ie,{className:"text-purple-600"}),"Hist√≥rico Financeiro"]}),g&&e.jsxs("p",{className:"text-lg text-gray-600 mt-2 flex items-center gap-2",children:[e.jsx(ne,{className:"text-gray-400"}),g.nome,e.jsxs("span",{className:"text-sm text-gray-400",children:["(",g.codigo,")"]})]})]}),x&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 border border-purple-200 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Cr√©dito Dispon√≠vel"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["R$ ",((S=g.credito_atual)==null?void 0:S.toFixed(2).replace(".",","))||"0,00"]})]})]})]}),x&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Total Vendas (90d)"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["R$ ",((k=x.total_vendas_90d)==null?void 0:k.toFixed(2).replace(".",","))||"0,00"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Total em Aberto"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:["R$ ",((T=x.total_em_aberto)==null?void 0:T.toFixed(2).replace(".",","))||"0,00"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"√öltima Compra"}),x.ultima_compra?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["R$ ",((V=x.ultima_compra.valor)==null?void 0:V.toFixed(2).replace(".",","))||"0,00"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(x.ultima_compra.data).toLocaleDateString("pt-BR")})]}):e.jsx("p",{className:"text-sm text-gray-400",children:"Nenhuma compra"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Total Transa√ß√µes"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:x.total_transacoes_historico||0})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 mb-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(de,{}),"Filtros"]}),e.jsx("button",{onClick:$,className:"text-sm text-gray-600 hover:text-gray-900 underline",children:"Limpar filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:[e.jsx(H,{className:"inline mr-1"}),"Data In√≠cio"]}),e.jsx("input",{type:"date",value:s.data_inicio,onChange:t=>m({data_inicio:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:[e.jsx(H,{className:"inline mr-1"}),"Data Fim"]}),e.jsx("input",{type:"date",value:s.data_fim,onChange:t=>m({data_fim:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:s.tipo,onChange:t=>m({tipo:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todas as transa√ß√µes"}),e.jsx("option",{value:"venda",children:"üõí Vendas"}),e.jsx("option",{value:"devolucao",children:"‚Ü©Ô∏è Devolu√ß√µes"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:s.status,onChange:t=>m({status:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todos os status"}),e.jsx("option",{value:"aberta",children:"üìã Em Aberto"}),e.jsx("option",{value:"finalizada",children:"‚úÖ Finalizada (Paga)"}),e.jsx("option",{value:"cancelada",children:"‚ùå Cancelada"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Por p√°gina"}),e.jsxs("select",{value:s.per_page,onChange:t=>m({per_page:parseInt(t.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]})]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:v?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Atualizando..."})]}):j.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descri√ß√£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map((t,l)=>{var P,E,L,A,z;const a=`${t.tipo}-${l}`,d=h[a],c=(P=t.detalhes)==null?void 0:P.venda_id,i=c?y[c]:null;return e.jsxs(ce.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("button",{onClick:()=>J(t,l),className:"text-gray-600 hover:text-purple-600 transition-colors",children:d?e.jsx(oe,{size:18}):e.jsx(xe,{size:18})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.data?new Date(t.data).toLocaleDateString("pt-BR"):"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"inline-flex items-center gap-1 text-sm font-medium",children:[e.jsx("span",{className:"text-xl",children:Y(t.tipo)}),ee(t.tipo)]})}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-md",children:[e.jsx("div",{className:"truncate",children:t.descricao}),((E=t.detalhes)==null?void 0:E.numero_venda)&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["#",t.detalhes.numero_venda]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:e.jsxs("span",{className:`font-bold ${t.valor<0?"text-red-600":"text-green-600"}`,children:[t.valor<0?"- ":"+ ","R$ ",Math.abs(t.valor).toFixed(2).replace(".",",")]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${te(t.status)}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.tipo==="venda"&&c&&e.jsxs("button",{onClick:()=>X(c),className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded-lg transition-colors flex items-center gap-1 mx-auto",children:[e.jsx(M,{size:14}),"Ver no PDV"]})})]}),d&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-4 bg-gray-50",children:t.tipo==="venda"&&c?N[c]?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Carregando detalhes..."})]}):i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 pb-3",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(M,{className:"text-blue-600"}),"Detalhes da Venda #",i.numero_venda]}),e.jsx("div",{className:"text-sm text-gray-600",children:new Date(i.data_venda).toLocaleString("pt-BR")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 bg-white rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"üí∞ Total da Venda"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["R$ ",(L=i.total)==null?void 0:L.toFixed(2).replace(".",",")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"üì¶ Total de Itens"}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:((A=i.itens)==null?void 0:A.length)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"üéØ Desconto Total"}),e.jsxs("p",{className:"text-xl font-bold text-orange-600",children:["R$ ",(i.desconto||0).toFixed(2).replace(".",",")]})]})]}),i.itens&&i.itens.length>0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-blue-50 px-4 py-2 border-b border-gray-200",children:e.jsxs("h5",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(pe,{className:"text-blue-600"}),"Produtos Vendidos"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:"Produto"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-500",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Pre√ßo Unit."}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Desc. %"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Desc. R$"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Subtotal"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:i.itens.map((o,p)=>{var B,U;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:o.produto_nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-center font-semibold text-gray-700",children:o.quantidade}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-gray-700",children:["R$ ",(B=o.preco_unitario)==null?void 0:B.toFixed(2).replace(".",",")]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-orange-600",children:[o.desconto_percentual||0,"%"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-orange-600",children:["R$ ",(o.desconto||0).toFixed(2).replace(".",",")]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right font-bold text-green-600",children:["R$ ",(U=o.subtotal)==null?void 0:U.toFixed(2).replace(".",",")]})]},p)})}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Total Geral:"}),e.jsxs("td",{className:"px-4 py-3 text-right text-lg font-bold text-green-600",children:["R$ ",(z=i.total)==null?void 0:z.toFixed(2).replace(".",",")]})]})})]})})]}),i.observacoes&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-yellow-800 mb-1",children:"üìù Observa√ß√µes:"}),e.jsx("p",{className:"text-sm text-gray-700",children:i.observacoes})]})]}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"N√£o foi poss√≠vel carregar os detalhes da venda"})}):e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("h5",{className:"font-semibold text-gray-800 mb-3",children:"Detalhes da Transa√ß√£o"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 text-sm",children:Object.entries(t.detalhes||{}).map(([o,p])=>e.jsxs("div",{className:"flex justify-between border-b border-gray-100 pb-2",children:[e.jsxs("span",{className:"text-gray-600 capitalize",children:[o.replace(/_/g," "),":"]}),e.jsx("span",{className:"font-semibold text-gray-900",children:typeof p=="number"?`R$ ${p.toFixed(2).replace(".",",")}`:(p==null?void 0:p.toString())||"N/A"})]},o))})]})})})]},a)})})]})}),r&&r.total_paginas>1&&e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",(r.pagina_atual-1)*r.itens_por_pagina+1," a"," ",Math.min(r.pagina_atual*r.itens_por_pagina,r.total_itens)," de"," ",r.total_itens," transa√ß√µes"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>R(r.pagina_atual-1),disabled:!r.tem_anterior,className:`px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${r.tem_anterior?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(me,{}),"Anterior"]}),e.jsxs("span",{className:"px-4 py-2 text-sm text-gray-700",children:["P√°gina ",r.pagina_atual," de ",r.total_paginas]}),e.jsxs("button",{onClick:()=>R(r.pagina_atual+1),disabled:!r.tem_proxima,className:`px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${r.tem_proxima?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:["Pr√≥xima",e.jsx(ge,{})]})]})]})})]}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx(he,{className:"text-gray-300 text-6xl mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Nenhuma transa√ß√£o encontrada"}),e.jsx("p",{className:"text-gray-500 mb-6",children:s.tipo||s.status||s.data_inicio||s.data_fim?"Tente ajustar os filtros para ver mais resultados":"Ainda n√£o h√° transa√ß√µes financeiras para este cliente"}),(s.tipo||s.status||s.data_inicio||s.data_fim)&&e.jsx("button",{onClick:$,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Limpar Filtros"})]})})]})})};export{je as default};
