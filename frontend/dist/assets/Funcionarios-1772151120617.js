import{r as i,j as e}from"./vendor-react-1772151120617.js";import{a as h}from"./index-1772151120617.js";import{a as f}from"./api-1772151120617.js";function k({funcionario:m,onClose:g}){const[p,b]=i.useState(null),[s,o]=i.useState(!1),d=async()=>{const n=await f.get(`/funcionarios/${m.id}/provisoes`);b(n.data)};i.useEffect(()=>{d()},[]);const v=async()=>{var n,c;if(window.confirm("Confirmar concessão de férias?")){o(!0);try{const r=new Date,t={mes:r.getMonth()+1,ano:r.getFullYear(),dias_ferias:30,data_pagamento:null};await f.post(`/funcionarios/${m.id}/ferias`,t),await d(),alert("Férias concedidas com sucesso")}catch(r){console.error("Erro ao conceder férias:",r),alert(((c=(n=r.response)==null?void 0:n.data)==null?void 0:c.detail)||"Erro ao conceder férias")}finally{o(!1)}}},u=async n=>{var c,r;if(window.confirm(`Confirmar pagamento da ${n}ª parcela do 13º?`)){o(!0);try{const t=new Date,j={mes:t.getMonth()+1,ano:t.getFullYear(),percentual:n===1?50:100,descricao_parcela:n===1?"1ª Parcela":"2ª Parcela",data_pagamento:null};await f.post(`/funcionarios/${m.id}/decimo-terceiro`,j),await d(),alert("13º registrado com sucesso")}catch(t){console.error("Erro ao pagar 13º:",t),alert(((r=(c=t.response)==null?void 0:c.data)==null?void 0:r.detail)||"Erro ao pagar 13º")}finally{o(!1)}}};return p?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded p-6 w-[500px]",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Eventos — ",m.nome]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Provisões"}),e.jsxs("p",{children:["Férias: R$ ",Number(p.ferias||0).toFixed(2)]}),e.jsxs("p",{children:["13º: R$ ",Number(p.decimo_terceiro||0).toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{disabled:s,onClick:v,className:"w-full bg-blue-600 text-white py-2 rounded",children:"Conceder Férias"}),e.jsx("button",{disabled:s,onClick:()=>u(1),className:"w-full bg-green-600 text-white py-2 rounded",children:"Pagar 1ª Parcela do 13º"}),e.jsx("button",{disabled:s,onClick:()=>u(2),className:"w-full bg-green-700 text-white py-2 rounded",children:"Pagar 2ª Parcela do 13º"})]}),e.jsx("div",{className:"mt-4 text-right",children:e.jsx("button",{onClick:g,className:"text-gray-600 underline",children:"Fechar"})})]})}):null}function R(){const[m,g]=i.useState([]),[p,b]=i.useState([]),[s,o]=i.useState(null),[d,v]=i.useState(""),[u,n]=i.useState("todos"),[c,r]=i.useState(null),t=async()=>{const a=await h.get("/funcionarios");g(a.data)},j=async()=>{const a=await h.get("/cargos");b(a.data.filter(l=>l.ativo))};i.useEffect(()=>{t(),j()},[]);const F=()=>{o({nome:"",cpf:"",email:"",telefone:"",cargo_id:"",ativo:!0})},E=async()=>{var l,x,N,w,y;if(!s.nome||!s.cargo_id){alert("Nome e cargo são obrigatórios");return}const a={nome:s.nome,cargo_id:Number(s.cargo_id),ativo:s.ativo,email:((l=s.email)==null?void 0:l.trim())||null,telefone:((x=s.telefone)==null?void 0:x.trim())||null,cpf:((N=s.cpf)==null?void 0:N.trim())||null};try{s.id?await h.put(`/funcionarios/${s.id}`,a):await h.post("/funcionarios",a),o(null),t()}catch(C){console.error("Erro ao salvar funcionário:",C),alert(((y=(w=C.response)==null?void 0:w.data)==null?void 0:y.detail)||"Erro ao salvar funcionário")}},S=async a=>{window.confirm("Deseja inativar este funcionário?")&&(await h.delete(`/funcionarios/${a}`),t())},_=m.filter(a=>{const l=a.nome.toLowerCase().includes(d.toLowerCase())||(a.cpf||"").includes(d),x=u==="todos"||u==="ativos"&&a.ativo||u==="inativos"&&!a.ativo;return l&&x});return e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Funcionários"}),e.jsxs("div",{className:"flex justify-between items-center mb-4 gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"border p-2 w-64",placeholder:"Buscar por nome ou CPF",value:d,onChange:a=>v(a.target.value)}),e.jsxs("select",{className:"border p-2 bg-white",value:u,onChange:a=>n(a.target.value),children:[e.jsx("option",{value:"todos",children:"Todos"}),e.jsx("option",{value:"ativos",children:"Ativos"}),e.jsx("option",{value:"inativos",children:"Inativos"})]})]}),e.jsx("button",{onClick:F,className:"bg-blue-600 text-white px-4 py-2 rounded",children:"+ Novo Funcionário"})]}),e.jsxs("table",{className:"w-full border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Nome"}),e.jsx("th",{className:"border p-2",children:"Cargo"}),e.jsx("th",{className:"border p-2",children:"Salário"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Ações"})]})}),e.jsx("tbody",{children:_.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2",children:a.nome}),e.jsx("td",{className:"border p-2",children:a.cargo?a.cargo.nome:"-"}),e.jsx("td",{className:"border p-2",children:a.cargo?`R$ ${Number(a.cargo.salario_base).toFixed(2)}`:"-"}),e.jsx("td",{className:"border p-2",children:a.ativo?"Ativo":"Inativo"}),e.jsxs("td",{className:"border p-2 space-x-2",children:[e.jsx("button",{className:"text-purple-600",onClick:()=>r(a),children:"Eventos"}),e.jsx("button",{className:"text-blue-600",onClick:()=>{var l;return o({...a,cargo_id:(l=a.cargo)==null?void 0:l.id})},children:"Editar"}),a.ativo&&e.jsx("button",{className:"text-red-600",onClick:()=>S(a.id),children:"Inativar"})]})]},a.id))})]}),s&&e.jsxs("div",{className:"border rounded p-4 mt-6",children:[e.jsx("h3",{className:"font-semibold mb-3",children:s.id?"Editar Funcionário":"Novo Funcionário"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{className:"border p-2",placeholder:"Nome",value:s.nome,onChange:a=>o({...s,nome:a.target.value})}),e.jsx("input",{className:"border p-2",placeholder:"CPF",value:s.cpf||"",onChange:a=>o({...s,cpf:a.target.value})}),e.jsx("input",{className:"border p-2",placeholder:"Email",value:s.email||"",onChange:a=>o({...s,email:a.target.value})}),e.jsx("input",{className:"border p-2",placeholder:"Telefone",value:s.telefone||"",onChange:a=>o({...s,telefone:a.target.value})}),e.jsxs("select",{className:"border p-2 col-span-2",value:s.cargo_id,onChange:a=>o({...s,cargo_id:a.target.value}),children:[e.jsx("option",{value:"",children:"Selecione o cargo"}),p.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),e.jsxs("div",{className:"mt-4 space-x-2",children:[e.jsx("button",{onClick:E,className:"bg-green-600 text-white px-4 py-2 rounded",children:"Salvar"}),e.jsx("button",{onClick:()=>o(null),className:"bg-gray-400 text-white px-4 py-2 rounded",children:"Cancelar"})]})]}),c&&e.jsx(k,{funcionario:c,onClose:()=>r(null)})]})}export{R as default};
