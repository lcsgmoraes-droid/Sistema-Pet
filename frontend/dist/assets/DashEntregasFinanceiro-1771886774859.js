import{r as l,j as e}from"./vendor-react-1771886774859.js";import{a as p}from"./index-1771886774859.js";import{m as f,ab as L,D as I,w as Y,I as G,l as P,B as W,bi as X,Y as O,E as U}from"./vendor-icons-1771886774859.js";import{R as N,L as S,C as y,X as v,Y as _,T as C,a as w,b as D,B as V,c as E}from"./vendor-recharts-1771886774859.js";import"./vendor-utils-1771886774859.js";function ae(){const[r,m]=l.useState(""),[d,g]=l.useState(""),[t,z]=l.useState(null),[o,M]=l.useState(null),[c,K]=l.useState(null),[u,$]=l.useState(!1),[R,b]=l.useState(null);async function k(){var a,s;if(!r||!d){b("Selecione o per√≠odo para consulta");return}$(!0),b(null);try{const[i,n,j]=await Promise.all([p.get("/dashboard/entregas/financeiro",{params:{data_inicio:r,data_fim:d}}),p.get("/dashboard/entregas/financeiro/graficos",{params:{data_inicio:r,data_fim:d}}),p.get("/dashboard/entregas/financeiro/ia",{params:{data_inicio:r,data_fim:d}}).catch(()=>null)]);z(i.data),M(n.data),K((j==null?void 0:j.data)||{alertas:[],sugestoes:[]})}catch(i){console.error("Erro ao carregar dados:",i),b(((s=(a=i.response)==null?void 0:a.data)==null?void 0:s.detail)||"Erro ao carregar dados do dashboard")}finally{$(!1)}}l.useEffect(()=>{const a=new Date,s=new Date(a.getFullYear(),a.getMonth(),1);m(s.toISOString().slice(0,10)),g(a.toISOString().slice(0,10))},[]),l.useEffect(()=>{r&&d&&k()},[r,d]);const B=()=>{if(!t||t.total_entregas===0)return null;const a=t.margem_media,s=a>=0?"text-green-600":"text-red-600",i=a>=0?"‚úÖ":"‚ö†Ô∏è";return e.jsxs("div",{className:`p-4 border rounded-lg ${a>=0?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:i}),e.jsx("h3",{className:"font-semibold text-gray-700",children:"An√°lise de Margem"})]}),e.jsx("p",{className:`text-sm ${s}`,children:a>=0?e.jsxs(e.Fragment,{children:["A taxa de entrega est√° ",e.jsx("strong",{children:"cobrindo os custos"})," com uma margem m√©dia de ",e.jsx("strong",{children:x(a)})," por entrega."]}):e.jsxs(e.Fragment,{children:["‚ö†Ô∏è A taxa de entrega est√° ",e.jsx("strong",{children:"abaixo dos custos"}),". D√©ficit m√©dio de ",e.jsx("strong",{children:x(Math.abs(a))})," por entrega."]})})]})};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(f,{className:"text-blue-600"}),"Dashboard Financeiro de Entregas"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Visualize os custos e receitas das entregas realizadas no per√≠odo"})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Per√≠odo:"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"De:"}),e.jsx("input",{type:"date",value:r,onChange:a=>m(a.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"At√©:"}),e.jsx("input",{type:"date",value:d,onChange:a=>g(a.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("button",{onClick:k,disabled:u,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(I,{className:u?"animate-spin":""}),u?"Carregando...":"Atualizar"]})]})}),R&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6 flex items-center gap-2",children:[e.jsx(Y,{}),e.jsx("span",{children:R})]}),u&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(T,{}),e.jsx(T,{})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((a,s)=>e.jsx(Z,{},s))}),e.jsx(F,{}),e.jsx(F,{}),e.jsx(F,{})]}),!u&&t&&e.jsxs(e.Fragment,{children:[c&&c.alertas&&c.alertas.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(G,{className:"text-yellow-600"}),"Alertas Autom√°ticos"]}),e.jsx("div",{className:"space-y-3",children:c.alertas.map((a,s)=>e.jsx("div",{className:"p-4 border border-yellow-200 bg-yellow-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700",children:a})},s))})]}),c&&c.sugestoes&&c.sugestoes.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"üí°"}),"Sugest√µes Pr√°ticas"]}),e.jsx("div",{className:"space-y-3",children:c.sugestoes.map((a,s)=>e.jsx("div",{className:"p-4 border border-blue-200 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700",children:a})},s))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[e.jsx(h,{titulo:"Total de Entregas",valor:t.total_entregas,icon:e.jsx(f,{className:"text-blue-600"}),colorClasse:"border-blue-200 bg-blue-50"}),e.jsx(h,{titulo:"Custo Total",valor:x(t.custo_total_entregas),icon:e.jsx(P,{className:"text-red-600"}),colorClasse:"border-red-200 bg-red-50",subtitulo:"Entregadores + Moto"}),e.jsx(h,{titulo:"Custo Entregadores",valor:x(t.custo_total_entregadores),icon:e.jsx(W,{className:"text-purple-600"}),colorClasse:"border-purple-200 bg-purple-50"}),e.jsx(h,{titulo:"Custo da Moto",valor:x(t.custo_total_moto),icon:e.jsx(X,{className:"text-orange-600"}),colorClasse:"border-orange-200 bg-orange-50"}),e.jsx(h,{titulo:"Repasse aos Entregadores",valor:x(t.total_repasse_taxa),icon:e.jsx(O,{className:"text-green-600"}),colorClasse:"border-green-200 bg-green-50"}),e.jsx(h,{titulo:"Custo M√©dio por Entrega",valor:x(t.custo_medio_por_entrega),icon:e.jsx(U,{className:"text-indigo-600"}),colorClasse:"border-indigo-200 bg-indigo-50"})]}),B(),o&&e.jsxs("div",{className:"space-y-6 mt-6",children:[o.por_dia&&o.por_dia.length>0&&e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"üìà Custo Total por Dia"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:'Responde: "Estou gastando mais?"'}),e.jsx(N,{width:"100%",height:300,children:e.jsxs(S,{data:o.por_dia,children:[e.jsx(y,{strokeDasharray:"3 3"}),e.jsx(v,{dataKey:"data",tick:{fontSize:12},tickFormatter:a=>{const[s,i,n]=a.split("-");return`${n}/${i}`}}),e.jsx(_,{tick:{fontSize:12}}),e.jsx(C,{formatter:a=>`R$ ${Number(a).toFixed(2)}`,labelFormatter:a=>{const[s,i,n]=a.split("-");return`${n}/${i}/${s}`}}),e.jsx(w,{}),e.jsx(D,{type:"monotone",dataKey:"custo",stroke:"#ef4444",strokeWidth:2,name:"Custo Total (R$)"})]})})]}),o.custo_medio&&o.custo_medio.length>0&&e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"üìâ Custo M√©dio por Entrega"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:'Responde: "Entregar est√° ficando caro?"'}),e.jsx(N,{width:"100%",height:300,children:e.jsxs(S,{data:o.custo_medio,children:[e.jsx(y,{strokeDasharray:"3 3"}),e.jsx(v,{dataKey:"data",tick:{fontSize:12},tickFormatter:a=>{const[s,i,n]=a.split("-");return`${n}/${i}`}}),e.jsx(_,{tick:{fontSize:12}}),e.jsx(C,{formatter:a=>`R$ ${Number(a).toFixed(2)}`,labelFormatter:a=>{const[s,i,n]=a.split("-");return`${n}/${i}/${s}`}}),e.jsx(w,{}),e.jsx(D,{type:"monotone",dataKey:"valor",stroke:"#8b5cf6",strokeWidth:2,name:"Custo M√©dio (R$)"})]})})]}),o.taxa_vs_custo&&e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"üìä Taxa Cobrada √ó Custo Real"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:'Responde: "A taxa cobre o custo?"'}),e.jsx(N,{width:"100%",height:300,children:e.jsxs(V,{data:[{name:"M√©dia","Taxa Cobrada":o.taxa_vs_custo.taxa_media,"Custo Real":o.taxa_vs_custo.custo_medio}],children:[e.jsx(y,{strokeDasharray:"3 3"}),e.jsx(v,{dataKey:"name"}),e.jsx(_,{}),e.jsx(C,{formatter:a=>`R$ ${Number(a).toFixed(2)}`}),e.jsx(w,{}),e.jsx(E,{dataKey:"Taxa Cobrada",fill:"#10b981"}),e.jsx(E,{dataKey:"Custo Real",fill:"#ef4444"})]})}),e.jsx("div",{className:"mt-4 text-center",children:o.taxa_vs_custo.taxa_media>=o.taxa_vs_custo.custo_medio?e.jsxs("p",{className:"text-green-600 font-medium",children:["‚úÖ Taxa m√©dia (R$ ",o.taxa_vs_custo.taxa_media.toFixed(2),") cobre o custo m√©dio (R$ ",o.taxa_vs_custo.custo_medio.toFixed(2),")"]}):e.jsxs("p",{className:"text-red-600 font-medium",children:["‚ö†Ô∏è Taxa m√©dia (R$ ",o.taxa_vs_custo.taxa_media.toFixed(2),") est√° abaixo do custo m√©dio (R$ ",o.taxa_vs_custo.custo_medio.toFixed(2),")"]})})]})]}),e.jsxs("div",{className:"mt-6 text-sm text-gray-500 text-center",children:["Dados do per√≠odo: ",A(t.periodo.data_inicio)," at√© ",A(t.periodo.data_fim)]})]}),!u&&t&&t.total_entregas===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(f,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-2",children:"Nenhuma entrega encontrada"}),e.jsx("p",{className:"text-gray-500",children:"N√£o h√° entregas conclu√≠das no per√≠odo selecionado"})]})]})}function h({titulo:r,valor:m,icon:d,colorClasse:g,subtitulo:t}){return e.jsxs("div",{className:`p-5 rounded-lg border shadow-sm ${g||"border-gray-200 bg-white"}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsx("div",{className:"text-2xl",children:d})}),e.jsx("h4",{className:"text-sm font-medium text-gray-600 mb-1",children:r}),t&&e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:t}),e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:m})]})}function Z(){return e.jsx("div",{style:{height:110,borderRadius:8,background:"linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"}})}function F(){return e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{style:{height:20,width:"40%",borderRadius:4,background:"linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite",marginBottom:16}}),e.jsx("div",{style:{height:300,borderRadius:8,background:"linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"}})]})}function T(){return e.jsx("div",{style:{height:80,borderRadius:8,background:"linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"}})}function x(r){return r==null?"R$ 0,00":r.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}function A(r){if(!r)return"";const[m,d,g]=r.split("-");return`${g}/${d}/${m}`}export{ae as default};
