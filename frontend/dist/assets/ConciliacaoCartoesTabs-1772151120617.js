import{S as ke,r,j as e}from"./vendor-react-1772151120617.js";import{a as q}from"./index-1772151120617.js";function Me({onConcluida:E,status:de}){const ae=ke(),[R,n]=r.useState([]),[y,U]=r.useState([]),[C,i]=r.useState(!1),[T,k]=r.useState(null),[t,B]=r.useState(!1),[le,x]=r.useState(null),[W,z]=r.useState(!1),[v,X]=r.useState([]),[F,Z]=r.useState([]),[S,se]=r.useState(!1),[H,ne]=r.useState(!1),[D,me]=r.useState("pendentes"),[K,xe]=r.useState([]),[s,p]=r.useState(null),[A,je]=r.useState(!0),[re,ye]=r.useState(1),[pe,we]=r.useState(1);r.useEffect(()=>{(async()=>{try{if(!localStorage.getItem("access_token")){k("Voc√™ precisa estar logado."),setTimeout(()=>ae("/login"),2e3);return}const o=await q.get("/operadoras-cartao?apenas_ativas=true");xe(o.data);const u=o.data.find(b=>b.padrao);u&&p(u)}catch(l){console.error("Erro ao carregar operadoras:",l),k("Erro ao carregar operadoras")}finally{je(!1)}})()},[ae]),r.useEffect(()=>{s&&(te(),c())},[re,s,D]),r.useEffect(()=>{if(D==="conciliadas"&&R.length>0&&y.length>0){const a=[];R.forEach(l=>{var f;const o=l.pagamento||((f=l.pagamentos)==null?void 0:f.find(M=>M.nsu||M.nsu_cartao)),u=(o==null?void 0:o.nsu)||(o==null?void 0:o.nsu_cartao)||l.nsu;if(!u)return;const b=y.find(M=>M.nsu===u);if(!b)return;const m={...l,numero:l.numero||l.numero_venda,nsu:u,bandeira:o==null?void 0:o.bandeira,parcelas:o==null?void 0:o.parcelas,valor:(o==null?void 0:o.valor)??l.total};a.push({venda_id:l.id,status:"ok",venda_pdv:m,venda_stone:b})}),Z(a)}else Z([])},[D,R,y]),r.useEffect(()=>{const a=l=>{l.key==="Escape"&&H&&(ne(!1),X([]),se(!1))};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[H]),r.useEffect(()=>{s&&(c(),te())},[s]);const te=async()=>{try{if(i(!0),!localStorage.getItem("access_token")){k("Voc√™ precisa estar logado."),setTimeout(()=>ae("/login"),2e3);return}const l=await q.get("/conciliacao/aba1/vendas-pdv",{params:{status:D,operadora_id:(s==null?void 0:s.id)==="legacy"?"legacy":s==null?void 0:s.id,page:re,limit:50}});l.data.success&&(n(l.data.vendas),we(l.data.total_pages))}catch(a){console.error("Erro ao carregar vendas PDV:",a),k("Erro ao carregar vendas do PDV")}finally{i(!1)}},Ce=async a=>{var b,m;const l=a.target.files[0];if(!l)return;if(!s){alert(`‚ö†Ô∏è Selecione uma operadora primeiro!

As vendas da planilha ser√£o importadas com a tag da operadora selecionada.
Isso √© importante para o processo de concilia√ß√£o.`),a.target.value="";return}if(s.id==="legacy"){alert(`‚ö†Ô∏è Vendas Legacy n√£o t√™m planilha!

Vendas sem operadora devem ter a operadora preenchida manualmente usando o bot√£o "Preencher Operadora".`),a.target.value="";return}if(!window.confirm(`üéØ Confirmar Upload

Operadora selecionada: ${s.nome}

Todas as vendas da planilha "${l.name}" ser√£o marcadas com esta operadora.

Deseja continuar?`)){a.target.value="";return}x(l),z(!0),k(null);const u=new FormData;u.append("arquivo",l),u.append("operadora_id",s.id);try{const f=await q.post("/conciliacao/aba1/upload-stone",u,{headers:{"Content-Type":"multipart/form-data"}});f.data.success&&(await c(),await te(),alert(`‚úÖ Planilha importada com sucesso!

üìä ${f.data.total_nsus||0} NSUs carregados
Operadora: ${s.nome}

Clique em "Processar Matches" para conciliar automaticamente.`),a.target.value="")}catch(f){console.error("Erro no upload:",f),k(((m=(b=f.response)==null?void 0:b.data)==null?void 0:m.detail)||"Erro ao importar planilha"),a.target.value=""}finally{z(!1)}},c=async()=>{if(s){if(s.id==="legacy"){U([]);return}try{const a=await q.get("/conciliacao/aba1/stone-nao-conciliadas",{params:{operadora_id:s.id,status:D}});a.data.success&&U(a.data.nsus)}catch(a){console.error("Erro ao carregar NSUs:",a)}}},w=async()=>{var a,l;if(!s){alert("Selecione uma operadora primeiro!");return}z(!0),k(null);try{const o=await q.post("/conciliacao/aba1/processar-matches");o.data.success&&(X(o.data.matches||[]),ne(!0),alert(`üîç Matches encontrados!

üìä Resumo:
‚Ä¢ ${o.data.conferidas||0} vendas OK
‚Ä¢ ${o.data.corrigidas||0} com diverg√™ncias
‚Ä¢ ${o.data.sem_nsu||0} sem NSU
‚Ä¢ ${o.data.orfaos||0} NSUs √≥rf√£os

üëÄ Visualize os matches abaixo e confirme para conciliar.`))}catch(o){console.error("Erro ao processar matches:",o),k(((l=(a=o.response)==null?void 0:a.data)==null?void 0:l.detail)||"Erro ao processar matches autom√°ticos")}finally{z(!1)}},_=async()=>{var l,o;if(v.length===0)return;const a=v.filter(u=>u.status==="ok");if(a.length===0){alert(`‚ö†Ô∏è Nenhum match OK para confirmar!

Apenas matches perfeitos (sem diverg√™ncias) podem ser conciliados.`);return}z(!0);try{const b=(await q.get("/conciliacao/aba1/stone-nao-conciliadas",{params:{operadora_id:s==null?void 0:s.id}})).data.importacao_id,m=await q.post("/conciliacao/aba1/confirmar-matches",{importacao_id:b,matches_confirmados:a});m.data.success&&(alert("‚úÖ "+m.data.message),X([]),ne(!1),await te(),await c())}catch(u){console.error("Erro ao confirmar matches:",u),k(((o=(l=u.response)==null?void 0:l.data)==null?void 0:o.detail)||"Erro ao confirmar matches")}finally{z(!1)}},G=async(a,l)=>{var o,u;try{const b=await q.put("/conciliacao/aba1/atualizar-operadora",{pagamento_id:a,operadora_id:l});if(b.data.success)return await te(),alert(`Operadora atualizada para ${b.data.operadora_nome}`),!0}catch(b){return console.error("Erro ao atualizar operadora:",b),alert(((u=(o=b.response)==null?void 0:o.data)==null?void 0:u.detail)||"Erro ao atualizar operadora"),!1}},Q=({venda:a,expandir:l})=>{var ge;const[o,u]=r.useState(t),[b,m]=r.useState(!1),[f,M]=r.useState(""),[ce,ee]=r.useState(!1),[ue,P]=r.useState(""),oe=async()=>{var h,_e;if(!f||f.trim()===""){alert("Digite um NSU v√°lido");return}try{(await q.patch(`/vendas/${a.id}/pagamento/${a.pagamento.id}/nsu`,{nsu_cartao:f.trim()})).data&&(m(!1),M(""),await te(),alert("NSU atualizado com sucesso!"))}catch(fe){console.error("Erro ao salvar NSU:",fe),alert(((_e=(h=fe.response)==null?void 0:h.data)==null?void 0:_e.detail)||"Erro ao salvar NSU")}},Y=async()=>{if(!ue||ue===""){alert("Selecione uma operadora");return}await G(a.pagamento.id,parseInt(ue))&&(ee(!1),P(""))};return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 mb-2 hover:bg-gray-50 cursor-pointer",onClick:h=>{h.target.tagName==="INPUT"||h.target.tagName==="BUTTON"||t||u(!o)},children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"font-medium text-gray-900",children:["Venda ",a.numero_venda]}),a.pagamento.operadora_id&&!ce?e.jsx("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded-full",children:((ge=K.find(h=>h.id===a.pagamento.operadora_id))==null?void 0:ge.nome)||"N/A"}):ce?e.jsxs("div",{className:"flex items-center gap-1",onClick:h=>h.stopPropagation(),children:[e.jsxs("select",{value:ue,onChange:h=>P(h.target.value),className:"border border-purple-300 rounded px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-purple-500",autoFocus:!0,children:[e.jsx("option",{value:"",children:"Selecione..."}),K.map(h=>e.jsx("option",{value:h.id,children:h.nome},h.id))]}),e.jsx("button",{onClick:Y,className:"bg-green-500 text-white px-2 py-1 rounded text-xs hover:bg-green-600",children:"‚úì"}),e.jsx("button",{onClick:()=>{ee(!1),P("")},className:"bg-gray-400 text-white px-2 py-1 rounded text-xs hover:bg-gray-500",children:"‚úó"})]}):e.jsx("button",{onClick:h=>{h.stopPropagation(),ee(!0)},className:"text-xs text-purple-600 hover:text-purple-700 underline font-medium px-2 py-1 bg-purple-50 rounded",children:"üè¢ Sem Operadora - Clique aqui"}),a.pagamento.nsu?e.jsxs("span",{className:"text-sm text-green-600",children:["NSU: ",a.pagamento.nsu]}):b?e.jsxs("div",{className:"flex items-center gap-1",onClick:h=>h.stopPropagation(),children:[e.jsx("input",{type:"text",value:f,onChange:h=>M(h.target.value),placeholder:"Digite o NSU",className:"border border-orange-300 rounded px-2 py-1 text-xs w-32 focus:outline-none focus:ring-1 focus:ring-orange-500",autoFocus:!0}),e.jsx("button",{onClick:oe,className:"bg-green-500 text-white px-2 py-1 rounded text-xs hover:bg-green-600",children:"‚úì"}),e.jsx("button",{onClick:()=>{m(!1),M("")},className:"bg-gray-400 text-white px-2 py-1 rounded text-xs hover:bg-gray-500",children:"‚úó"})]}):e.jsx("button",{onClick:h=>{h.stopPropagation(),m(!0)},className:"text-sm text-orange-600 hover:text-orange-700 underline font-medium",children:"SEM NSU - Clique para preencher"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["R$ ",a.total.toFixed(2)]}),!t&&e.jsx("svg",{className:`h-4 w-4 text-gray-400 transition-transform ${o?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),(o||t)&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{children:new Date(a.data_venda).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tipo:"}),e.jsx("span",{className:"capitalize",children:a.pagamento.forma})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Operadora:"}),e.jsx("span",{className:"font-medium text-blue-600",children:(s==null?void 0:s.nome)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Bandeira:"}),e.jsx("span",{children:a.pagamento.bandeira||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Parcelas:"}),e.jsxs("span",{children:[a.pagamento.parcelas,"x"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",a.pagamento.valor.toFixed(2)]})]})]})]})},be=({nsu:a,expandir:l})=>{var b,m,f;const[o,u]=r.useState(t);return e.jsxs("div",{className:"border border-blue-200 rounded-lg p-3 mb-2 hover:bg-blue-50 cursor-pointer",onClick:()=>!t&&u(!o),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("span",{className:"font-medium text-blue-900",children:["NSU: ",a.nsu]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["R$ ",(b=a.valor_liquido)==null?void 0:b.toFixed(2)]}),!t&&e.jsx("svg",{className:`h-4 w-4 text-gray-400 transition-transform ${o?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),(o||t)&&a.data_venda&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200 text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{children:new Date(a.data_venda).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Bandeira:"}),e.jsx("span",{children:a.bandeira})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Parcelas:"}),e.jsxs("span",{children:[a.parcelas,"x"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Bruto:"}),e.jsxs("span",{children:["R$ ",(m=a.valor_bruto)==null?void 0:m.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor L√≠quido:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["R$ ",(f=a.valor_liquido)==null?void 0:f.toFixed(2)]})]})]})]})},ie=({match:a,isConciliado:l=!1})=>{var u,b,m;const o={ok:"bg-green-50 border-green-300",divergencia:"bg-yellow-50 border-yellow-300",orfao:"bg-red-50 border-red-300",sem_nsu:"bg-orange-50 border-orange-300"};return e.jsxs("div",{className:`border-2 rounded-lg p-4 mb-3 ${o[a.status]} relative`,children:[l&&e.jsx("div",{className:"absolute top-2 right-2 px-3 py-1 bg-green-600 text-white text-xs font-bold rounded-full",children:"‚úÖ CONCILIADO"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[e.jsx("div",{className:"bg-white p-3 rounded border",children:a.venda_pdv?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-800",children:["Venda #",a.venda_pdv.numero]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["NSU: ",a.venda_pdv.nsu||e.jsx("span",{className:"text-orange-600",children:"SEM NSU"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[a.venda_pdv.bandeira," - ",a.venda_pdv.parcelas,"x"]}),e.jsxs("div",{className:"text-xs font-semibold text-gray-800 mt-1",children:["R$ ",(u=a.venda_pdv.valor)==null?void 0:u.toFixed(2)]})]}):e.jsx("div",{className:"text-sm text-gray-400 italic",children:"Sem venda no PDV"})}),e.jsxs("div",{className:"flex items-center justify-center",children:[a.status==="ok"&&e.jsx("div",{className:"text-green-600 text-2xl",children:"‚úÖ"}),a.status==="divergencia"&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-yellow-600 text-xl",children:"‚ö†Ô∏è"}),e.jsx("div",{className:"text-xs text-yellow-700 font-semibold mt-1",children:(b=a.divergencia)==null?void 0:b.tipo})]}),a.status==="orfao"&&e.jsx("div",{className:"text-red-600 text-2xl",children:"‚ùå"}),a.status==="sem_nsu"&&e.jsx("div",{className:"text-orange-600 text-2xl",children:"‚û°Ô∏è"})]}),e.jsx("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:a.venda_stone?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-semibold text-blue-800",children:"Planilha Operadora"}),e.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:["NSU: ",a.venda_stone.nsu]}),e.jsxs("div",{className:"text-xs text-blue-600",children:[a.venda_stone.bandeira," - ",a.venda_stone.parcelas,"x"]}),e.jsxs("div",{className:"text-xs font-semibold text-blue-800 mt-1",children:["R$ ",(m=a.venda_stone.valor_bruto)==null?void 0:m.toFixed(2)]})]}):e.jsx("div",{className:"text-sm text-blue-300 italic",children:"Sem NSU na planilha"})})]}),a.divergencia&&e.jsx("div",{className:"mt-3 pt-3 border-t border-yellow-300",children:e.jsxs("div",{className:"text-xs text-yellow-800",children:[e.jsx("span",{className:"font-semibold",children:"PDV:"})," ",a.divergencia.pdv," ‚Üí"," ",e.jsx("span",{className:"font-semibold",children:"Stone:"})," ",a.divergencia.stone]})})]})};return e.jsxs("div",{className:"flex flex-col h-full p-6 bg-gray-50",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Concilia√ß√£o de Vendas - Stone"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Compare vendas do PDV com a planilha da operadora"})]}),e.jsxs("div",{className:"flex gap-4 mb-4 items-center bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1",children:"Exibir:"}),e.jsxs("select",{value:D,onChange:a=>me(a.target.value),className:"border border-gray-300 rounded px-3 py-2 text-sm min-w-[180px] focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"pendentes",children:"‚è≥ Pendentes (N√£o Conciliadas)"}),e.jsx("option",{value:"todas",children:"üìã Todas as Vendas"}),e.jsx("option",{value:"conciliadas",children:"‚úÖ Conciliadas"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1",children:"Operadora de Cart√£o:"}),e.jsxs("select",{value:(s==null?void 0:s.id)||"",onChange:a=>{const l=a.target.value;if(l==="legacy")p({id:"legacy",nome:"Legacy (Sem Operadora)"});else{const o=K.find(u=>u.id===parseInt(l));p(o)}},disabled:A,className:"border border-gray-300 rounded px-3 py-2 text-sm min-w-[200px] focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"legacy",className:"text-orange-600 font-semibold",children:"üì¶ Legacy (Sem Operadora)"}),K.map(a=>e.jsxs("option",{value:a.id,children:[a.nome," ",a.padrao?"(Padr√£o)":""]},a.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`px-4 py-2 rounded-md ${s&&s.id!=="legacy"?"bg-blue-600 text-white hover:bg-blue-700 cursor-pointer":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:["üì§ Upload Planilha",e.jsx("input",{type:"file",accept:".csv",onChange:Ce,className:"hidden",disabled:!s||s.id==="legacy"})]}),(s==null?void 0:s.id)==="legacy"&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:'Vendas Legacy n√£o t√™m planilha. Use o campo "Preencher Operadora".'})]}),y.length>0&&!H&&(s==null?void 0:s.id)!=="legacy"&&e.jsx("button",{onClick:w,disabled:W,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400",children:"üîç Processar Matches"}),H&&v.length>0&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:_,disabled:W,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 animate-pulse",children:"‚úÖ Confirmar Matches OK"}),e.jsx("button",{onClick:()=>{ne(!1),X([]),se(!1)},className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"‚ùå Cancelar"})]}),e.jsxs("label",{className:"flex items-center gap-2 ml-auto",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:()=>B(!t),className:"rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Mostrar Expandido"})]})]}),T&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg",children:T}),H&&v.length>0||D==="conciliadas"&&F.length>0?e.jsxs("div",{className:"flex-1 overflow-hidden bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"px-6 py-4 bg-gradient-to-r from-blue-100 to-green-100 border-b",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:D==="conciliadas"?"‚úÖ Vendas Conciliadas":"üîç Matches Encontrados - Revise e Confirme"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:D==="conciliadas"?"Vendas PDV conciliadas com NSUs da planilha":"Matches OK no topo ‚Üí Diverg√™ncias ‚Üí Sem match"})]}),e.jsx("div",{className:"overflow-y-auto p-6",style:{maxHeight:"calc(100vh - 300px)"},children:D==="conciliadas"?F.length>0?F.map((a,l)=>e.jsx(ie,{match:a,isConciliado:!0},l)):e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Nenhuma venda conciliada ainda"}):v.sort((a,l)=>{const o={ok:1,divergencia:2,orfao:3,sem_nsu:4};return o[a.status]-o[l.status]}).map((a,l)=>e.jsx(ie,{match:a},l))})]}):e.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-4 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-100 border-b border-gray-200",children:[e.jsxs("h3",{className:"font-semibold text-gray-800",children:["‚¨ÖÔ∏è Vendas PDV (",R.length,")"]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Vendas com cart√£o pendentes"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:C?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Carregando..."}):R.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Nenhuma venda pendente"}):R.map(a=>e.jsx(Q,{venda:a},a.id))}),pe>1&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex justify-between items-center",children:[e.jsx("button",{onClick:()=>ye(a=>Math.max(1,a-1)),disabled:re===1,className:"px-3 py-1 text-sm bg-white border rounded disabled:opacity-50",children:"‚Üê Anterior"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["P√°gina ",re," de ",pe]}),e.jsx("button",{onClick:()=>ye(a=>Math.min(pe,a+1)),disabled:re===pe,className:"px-3 py-1 text-sm bg-white border rounded disabled:opacity-50",children:"Pr√≥xima ‚Üí"})]})]}),e.jsxs("div",{className:"flex flex-col bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-blue-100 border-b border-blue-200",children:[e.jsxs("h3",{className:"font-semibold text-blue-900",children:[s?`${s.nome} Planilha`:"Planilha"," ‚û°Ô∏è (",y.length,")"]}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"NSUs n√£o conciliados"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:(s==null?void 0:s.id)==="legacy"?e.jsxs("div",{className:"text-center text-orange-600 py-8 bg-orange-50 rounded-lg border-2 border-orange-200",children:[e.jsx("div",{className:"text-5xl mb-4",children:"üì¶"}),e.jsx("h4",{className:"font-bold text-lg mb-2",children:"Vendas Legacy"}),e.jsx("p",{className:"text-sm max-w-md mx-auto",children:"Vendas sem operadora n√£o possuem planilha para concilia√ß√£o autom√°tica."}),e.jsxs("p",{className:"text-sm max-w-md mx-auto mt-2",children:["Use o bot√£o ",e.jsx("strong",{children:'"üè¢ Preencher Operadora"'})," nas vendas do lado esquerdo para associ√°-las a uma operadora."]})]}):y.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:le?"Processando...":`Fa√ßa upload da planilha ${(s==null?void 0:s.nome)||""}`}):y.map((a,l)=>e.jsx(be,{nsu:a},l))})]})]})]})}function Ve({onConcluida:E,status:de}){var we,te,Ce;const[ae,R]=r.useState(!1),[n,y]=r.useState({recebimentos:null,recibo:null,ofx:null}),[U,C]=r.useState(!1),[i,T]=r.useState(null),[k,t]=r.useState(null),[B,le]=r.useState([]),[x,W]=r.useState(null),[z,v]=r.useState(!0),[X,F]=r.useState(!1),[Z,S]=r.useState(!1),[se,H]=r.useState(null),[ne,D]=r.useState(0),[me,K]=r.useState(!1),xe=()=>{console.log("üéØ Tentando avan√ßar para Aba 3..."),console.log("onConcluida existe?",typeof E),typeof E=="function"?(console.log("‚úÖ Chamando onConcluida()"),E(),console.log("‚úÖ onConcluida() foi chamado com sucesso")):(console.error("‚ùå onConcluida n√£o √© uma fun√ß√£o!",E),alert("Erro: Fun√ß√£o de callback n√£o encontrada. Recarregue a p√°gina."))},s=()=>{y({recebimentos:null,recibo:null,ofx:null}),T(null),t(null),C(!1),K(!1),H(null),D(0),F(!1),S(!1),console.log("üîÑ Estado resetado")};r.useEffect(()=>{(async()=>{try{const w=await q.get("/operadoras-cartao?apenas_ativas=true");le(w.data);const _=w.data.find(G=>G.padrao);_&&W(_)}catch(w){console.error("Erro ao carregar operadoras:",w),t("Erro ao carregar operadoras")}finally{v(!1)}})()},[]),r.useEffect(()=>{const c=localStorage.getItem("conciliacao_aba2_aviso_ate");if(!c)return;const w=Number(c);Number.isFinite(w)&&Date.now()<w&&R(!0)},[]);const p=c=>{const w=Date.now()+c*24*60*60*1e3;localStorage.setItem("conciliacao_aba2_aviso_ate",String(w)),R(!0)},A=(c,w)=>{var G;const _=(G=w.target.files)==null?void 0:G[0];if(!_){console.warn(`Nenhum arquivo selecionado para ${c}`);return}console.log(`üìé Arquivo selecionado para ${c}:`,{name:_.name,size:_.size,type:_.type,lastModified:new Date(_.lastModified).toISOString()}),y(Q=>({...Q,[c]:_})),t(null),T(null)},je=()=>{if(!x){t("Por favor, selecione uma operadora antes de validar.");return}if(!n.recebimentos||!n.recibo||!n.ofx){t("Por favor, fa√ßa upload dos 3 arquivos antes de validar.");return}F(!0)},re=async()=>{var c,w,_,G,Q,be,ie,a,l,o,u,b;if(F(!1),console.log("üöÄ Iniciando valida√ß√£o...",{arquivos_estado:{recebimentos:!!n.recebimentos,recibo:!!n.recibo,ofx:!!n.ofx}}),!n.recebimentos||!n.recibo||!n.ofx){t("Voc√™ precisa enviar os 3 arquivos para continuar");return}if(console.log("üîç Validando tipos de arquivo...",{recebimentos_isFile:n.recebimentos instanceof File,recibo_isFile:n.recibo instanceof File,ofx_isFile:n.ofx instanceof File}),!(n.recebimentos instanceof File)){console.error("‚ùå Arquivo de recebimentos n√£o √© um File v√°lido:",n.recebimentos),t("Arquivo de recebimentos inv√°lido. Por favor, selecione novamente."),y(m=>({...m,recebimentos:null}));return}if(!(n.recibo instanceof File)){console.error("‚ùå Arquivo de recibo n√£o √© um File v√°lido:",n.recibo),t("Arquivo de recibo inv√°lido. Por favor, selecione novamente."),y(m=>({...m,recibo:null}));return}if(!(n.ofx instanceof File)){console.error("‚ùå Arquivo OFX n√£o √© um File v√°lido:",n.ofx),t("Arquivo OFX inv√°lido. Por favor, selecione novamente."),y(m=>({...m,ofx:null}));return}C(!0),t(null);try{let m,f,M;console.log("üìÇ Lendo arquivos:",{recebimentos:n.recebimentos.name,recibo:n.recibo.name,ofx:n.ofx.name});try{if(m=await n.recebimentos.text(),!m||m.trim().length===0)throw new Error("Arquivo de recebimentos est√° vazio")}catch(d){throw console.error("Erro ao ler recebimentos:",d),new Error(`Erro ao ler arquivo de recebimentos: ${d.message}`)}try{if(f=await n.recibo.text(),!f||f.trim().length===0)throw new Error("Arquivo de recibo est√° vazio")}catch(d){throw console.error("Erro ao ler recibo:",d),new Error(`Erro ao ler arquivo de recibo: ${d.message}`)}try{if(M=await n.ofx.text(),!M||M.trim().length===0)throw new Error("Arquivo OFX est√° vazio")}catch(d){throw console.error("Erro ao ler OFX:",d),new Error(`Erro ao ler arquivo OFX: ${d.message}`)}console.log("üìÑ Arquivos carregados:",{recebimentos_length:m.length,recibo_length:f.length,ofx_length:M.length});const ce=m.split(`
`);console.log("üîç Primeiras 3 linhas do arquivo de recebimentos:"),console.log("Linha 0 (header):",ce[0]),console.log("Linha 1:",ce[1]),console.log("Linha 2:",ce[2]);const ee=f.split(`
`);console.log("üîç Primeiras 3 linhas do arquivo de recibo:"),console.log("Linha 0 (header):",ee[0]),console.log("Linha 1:",ee[1]),console.log("Linha 2:",ee[2]);const ue=(c=ce[0])!=null&&c.includes(";")?";":",";console.log("üìã Separador detectado:",ue);let P,oe,Y;try{P=m.split(`
`).slice(1).filter(d=>d.trim()).map((d,j)=>{var g,I,N,J,L,$;try{const O=d.split(ue);j===0&&(console.log("üîç DEBUG - Primeira linha parseada:"),console.log("Total de campos:",O.length),console.log("Campos relevantes:"),console.log("  Campo 8 (STONE ID/NSU):",O[8]),console.log("  Campo 4 (DATA DE VENCIMENTO):",O[4]),console.log("  Campo 12 (VALOR L√çQUIDO):",O[12]),console.log("  Campo 10 (N¬∫ DA PARCELA):",O[10]),console.log("  Campo 9 (QTD DE PARCELAS):",O[9]),console.log("  Campo 16 (√öLTIMO STATUS):",O[16]));const Ne=(g=O[8])==null?void 0:g.trim(),ve=(I=O[4])==null?void 0:I.trim(),he=(N=O[12])==null?void 0:N.trim(),Ee=(J=O[10])==null?void 0:J.trim(),Re=(L=O[9])==null?void 0:L.trim(),De=($=O[16])==null?void 0:$.trim(),Se=he==null?void 0:he.replace(",","."),Ae=parseFloat(Se||0);return j===0&&(console.log("üí∞ Convers√£o de valor:"),console.log("  Original:",he),console.log("  Limpo:",Se),console.log("  Final:",Ae),console.log("  Is NaN?",isNaN(Ae))),{nsu:Ne,data_recebimento:ve,valor:Ae,parcela_numero:parseInt(Ee||1),total_parcelas:parseInt(Re||1),tipo_recebimento:De||"Pago",lote_id:null}}catch(O){throw console.error(`Erro ao parsear linha ${j+1} de recebimentos:`,d,O),new Error(`Erro na linha ${j+1} do arquivo de recebimentos detalhados`)}})}catch(d){t(`‚ùå Erro ao processar arquivo de recebimentos: ${d.message}`);return}try{const d=(w=ee[0])!=null&&w.includes(";")?";":",";console.log("üìÑ Primeira linha do recibo:",ee[0]),console.log("üìÑ Segunda linha do recibo:",ee[1]),oe=f.split(`
`).slice(1).filter(j=>j.trim()).map((j,g)=>{var I,N,J;try{const L=j.split(d);g===0&&(console.log("üîç DEBUG - Recibo primeira linha parseada:"),console.log("Total de campos:",L.length),console.log("  Campo 0 (Valor):",L[0]),console.log("  Campo 13 (ID Rastre√°vel):",L[13]),console.log("  Campo 18 (Status):",L[18]));const $=(I=L[0])==null?void 0:I.trim(),O=(N=L[13])==null?void 0:N.trim(),Ne=(J=L[18])==null?void 0:J.trim(),ve=$==null?void 0:$.replace(",","."),he=parseFloat(ve||0);return g===0&&(console.log("üí∞ Convers√£o recibo:"),console.log("  Original:",$),console.log("  Limpo:",ve),console.log("  Final:",he)),{lote_id:O,valor:he,status:Ne}}catch(L){throw console.error(`Erro ao parsear linha ${g+1} de recibo:`,j,L),new Error(`Erro na linha ${g+1} do arquivo de recibo de lote`)}})}catch(d){t(`‚ùå Erro ao processar arquivo de recibo: ${d.message}`);return}try{console.log("üìÑ Primeiras linhas do OFX:",M.split(`
`).slice(0,30).join(`
`));const d=[],j=M.split(`
`);let g=null;for(let I=0;I<j.length;I++){const N=j[I].trim();if(N==="<STMTTRN>")g={};else if(N==="</STMTTRN>"&&g)(g.type==="CREDIT"||g.valor&&g.valor>0)&&d.push(g),g=null;else if(g)if(N.startsWith("<TRNTYPE>"))g.type=N.replace("<TRNTYPE>","").replace("</TRNTYPE>","");else if(N.startsWith("<DTPOSTED>"))g.data=N.replace("<DTPOSTED>","").replace("</DTPOSTED>","");else if(N.startsWith("<TRNAMT>")){const J=N.replace("<TRNAMT>","").replace("</TRNAMT>","");g.valor=parseFloat(J)}else N.startsWith("<FITID>")?g.id=N.replace("<FITID>","").replace("</FITID>",""):N.startsWith("<MEMO>")&&(g.memo=N.replace("<MEMO>","").replace("</MEMO>",""))}Y=d,console.log("üí≥ OFX parseado:",Y.length,"transa√ß√µes encontradas"),Y.length>0&&console.log("Primeira transa√ß√£o:",Y[0])}catch(d){console.error("Erro ao parsear OFX:",d),t(`‚ùå Erro ao processar arquivo OFX: ${d.message}`);return}if(P.length===0){t("‚ùå Arquivo de recebimentos detalhados est√° vazio ou mal formatado. Verifique o formato CSV.");return}if(oe.length===0){t("‚ùå Arquivo de recibo de lote est√° vazio ou mal formatado. Verifique o formato CSV.");return}if(Y.length===0){t("‚ùå Arquivo OFX est√° vazio ou mal formatado. Verifique o formato.");return}const ge=P.filter(d=>isNaN(d.valor)||d.valor===null);if(ge.length>0){console.error("‚ùå Recebimentos com valores inv√°lidos:",ge),console.error("üìã Primeiras 5 linhas RAW do arquivo:"),ce.slice(0,6).forEach((d,j)=>{console.error(`Linha ${j}:`,d)}),t(`‚ùå ${ge.length} recebimentos t√™m valores inv√°lidos. Verifique o formato dos valores no CSV (use v√≠rgula ou ponto decimal). Veja o console para mais detalhes.`);return}const h=oe.filter(d=>isNaN(d.valor)||d.valor===null);if(h.length>0){console.error("‚ùå Lotes com valores inv√°lidos:",h),t(`‚ùå ${h.length} lotes t√™m valores inv√°lidos. Verifique o formato dos valores no CSV.`);return}console.log("‚úÖ Todos os valores validados! Enviando para API..."),console.log("üì§ Enviando dados para API:",{recebimentos_count:P.length,recibo_count:oe.length,ofx_count:Y.length,sample_recebimento:P[0],sample_recebimento_2:P[1],sample_recibo:oe[0],sample_ofx:Y[0]}),console.log("üí∞ Valores parseados (primeiros 3):"),console.log("Recebimento 1:",(_=P[0])==null?void 0:_.valor),console.log("Recebimento 2:",(G=P[1])==null?void 0:G.valor),console.log("Recibo 1:",(Q=oe[0])==null?void 0:Q.valor),console.log("OFX 1:",(be=Y[0])==null?void 0:be.valor);const fe=(d=>{var I;const j={};return d.forEach(N=>{const J=["data","data_recebimento","data_pagamento","Data de Pagamento","Data do Pagamento"];for(const L of J)if(N[L]){let $=N[L];if($.match(/^\d{2}\/\d{2}\/\d{4}$/)){const[O,Ne,ve]=$.split("/");$=`${ve}-${Ne}-${O}`}j[$]=(j[$]||0)+1;break}}),((I=Object.entries(j).sort((N,J)=>J[1]-N[1])[0])==null?void 0:I[0])||null})(P);console.log("üìÖ Data de refer√™ncia detectada:",fe);const Oe=[{nome:n.recebimentos.name,tamanho:n.recebimentos.size,tipo:"recebimentos_detalhados"},{nome:n.recibo.name,tamanho:n.recibo.size,tipo:"recibo_lote"},{nome:n.ofx.name,tamanho:n.ofx.size,tipo:"extrato_ofx"}],V=await q.post("/conciliacao/aba2/validar-recebimentos",{recebimentos_detalhados:P,recibo_lote:oe,ofx_creditos:Y,data_referencia:fe,arquivos_info:Oe,operadora:x==null?void 0:x.nome});if(!me){const d=x.nome,j=V.data.operadora_detectada,g=V.data.confianca_deteccao||0;if(console.log("üîç Compara√ß√£o de operadoras:",{selecionada:d,detectada:j,confianca:g,ignorar:me}),j&&d!==j&&g>=.7){H(j),D(g),T(V.data),S(!0),C(!1);return}}T(V.data),console.log("üìä Resultado da valida√ß√£o:",{success:V.data.success,tem_divergencias:V.data.tem_divergencias,validado:V.data.validado,historico_id:V.data.historico_id,operadora_detectada:V.data.operadora_detectada,ja_conciliado:V.data.ja_conciliado}),V.data.ja_conciliado&&V.data.aviso_reprocessamento&&console.warn("‚ö†Ô∏è Reprocessamento detectado:",V.data.aviso_reprocessamento),V.data.success&&(V.data.tem_divergencias?console.log("‚ö†Ô∏è Tem diverg√™ncias, aguardando decis√£o do usu√°rio..."):(console.log("‚úÖ Valida√ß√£o perfeita, avan√ßando automaticamente em 1.5s..."),setTimeout(()=>{xe()},1500)))}catch(m){console.error("Erro ao validar:",m),console.error("Detalhes do erro:",(ie=m.response)==null?void 0:ie.data);const f=((l=(a=m.response)==null?void 0:a.data)==null?void 0:l.detail)||((u=(o=m.response)==null?void 0:o.data)==null?void 0:u.message)||JSON.stringify((b=m.response)==null?void 0:b.data)||"Erro ao validar recebimentos";t(f)}finally{C(!1)}},ye=n.recebimentos&&n.recibo&&n.ofx,pe=ke();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Aba 2: Concilia√ß√£o de Recebimentos"}),e.jsx("p",{className:"text-gray-600",children:"Valide que dinheiro entrou na conta (3 arquivos: detalhados, recibo, OFX)"})]}),e.jsxs("button",{onClick:()=>pe("/financeiro/historico-conciliacoes"),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-lg hover:from-purple-600 hover:to-indigo-700 transition-all shadow-md hover:shadow-lg",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-semibold",children:"üìú Ver Hist√≥rico"})]})]}),ae?e.jsx("button",{onClick:()=>R(!1),className:"text-xs text-blue-700 hover:text-blue-900",children:"Mostrar aviso de sequencia"}):e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Ordem recomendada:"})," Aba 1 prepara os NSUs; esta Aba 2 valida os recebimentos; a Aba 3 baixa as parcelas com seguranca."]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>p(30),className:"text-xs text-blue-700 hover:text-blue-900",children:"Ocultar 30 dias"}),e.jsx("button",{onClick:()=>p(365),className:"text-xs text-blue-700 hover:text-blue-900",children:"Ocultar 1 ano"})]})]})}),e.jsx("div",{className:"bg-purple-50 border-l-4 border-purple-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-purple-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("p",{className:"text-sm text-purple-700 mb-2",children:[e.jsx("strong",{children:"Esta aba N√ÉO conhece vendas."})," Apenas valida que o dinheiro entrou na conta. Valida√ß√£o em cascata: Recebimentos ‚Üí Recibo ‚Üí OFX (todos precisam bater)."]}),e.jsxs("details",{className:"text-xs text-purple-600 mt-2",children:[e.jsx("summary",{className:"cursor-pointer font-semibold hover:text-purple-800",children:"üìã Formato esperado dos arquivos"}),e.jsxs("div",{className:"mt-2 space-y-2 pl-4",children:[e.jsx("p",{children:e.jsx("strong",{children:"Recebimentos Detalhados CSV da Stone:"})}),e.jsx("p",{className:"text-xs font-mono",children:"DOCUMENTO;STONECODE;CATEGORIA;DATA DA VENDA;DATA DE VENCIMENTO;DATA DE VENCIMENTO ORIGINAL;BANDEIRA;PRODUTO;STONE ID;QTD DE PARCELAS;N¬∫ DA PARCELA;VALOR BRUTO;VALOR L√çQUIDO;DESCONTO DE MDR;DESCONTO DE ANTECIPA√á√ÉO;DESCONTO UNIFICADO;√öLTIMO STATUS;DATA DO √öLTIMO STATUS"}),e.jsx("p",{className:"text-xs text-purple-500",children:"Separador: ponto-e-v√≠rgula (;) | Valores com v√≠rgula decimal (21,012265)"}),e.jsx("p",{className:"mt-2",children:e.jsx("strong",{children:"Comprovante de Pagamentos CSV da Stone:"})}),e.jsx("p",{className:"text-xs font-mono",children:"Valor;Bandeira;Modalidade;...;Identificador Rastre√°vel do Pagamento;...;Status do Pagamento (19 colunas)"}),e.jsx("p",{className:"text-xs text-purple-500",children:"Separador: ponto-e-v√≠rgula (;) | Valores com v√≠rgula decimal (202,11)"}),e.jsx("p",{className:"mt-2",children:e.jsx("strong",{children:"OFX:"})}),e.jsx("p",{className:"text-xs",children:"Arquivo banc√°rio padr√£o OFX com tags <STMTTRN>, <TRNAMT>, <TRNTYPE>"})]})]})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-2 border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-8 w-8 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-semibold text-blue-900 mb-2",children:"üèõ Operadora de Cart√£o:"}),e.jsxs("select",{value:(x==null?void 0:x.id)||"",onChange:c=>{const w=B.find(_=>_.id===parseInt(c.target.value));W(w),T(null),t(null),K(!1),H(null)},disabled:z||U,className:"w-full border-2 border-blue-300 rounded-lg px-4 py-3 text-base font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Selecione a operadora..."}),B.map(c=>e.jsxs("option",{value:c.id,children:[c.nome," ",c.padrao?"üéØ (Padr√£o)":""]},c.id))]}),x&&e.jsxs("p",{className:"mt-2 text-xs text-blue-700",children:["‚úÖ Operadora selecionada: ",e.jsx("strong",{children:x.nome})]}),!x&&e.jsx("p",{className:"mt-2 text-xs text-orange-600 font-medium",children:"‚ö†Ô∏è Selecione a operadora antes de fazer upload dos arquivos"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-blue-400 flex items-center justify-center",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-full w-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{htmlFor:"file-recebimentos",className:"cursor-pointer",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-900 mb-1",children:"1Ô∏è‚É£ Recebimentos Detalhados"}),e.jsx("span",{className:"block text-xs text-gray-500 mb-3",children:"Arquivo CSV da Stone (18 colunas)"}),e.jsx("input",{id:"file-recebimentos",type:"file",accept:".csv",onChange:c=>A("recebimentos",c),className:"sr-only"}),e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"Selecionar CSV"})]}),n.recebimentos&&e.jsxs("p",{className:"mt-2 text-xs text-green-600 font-medium truncate",children:["‚úì ",n.recebimentos.name]})]})]})}),e.jsx("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-green-400 flex items-center justify-center",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-full w-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{htmlFor:"file-recibo",className:"cursor-pointer",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-900 mb-1",children:"2Ô∏è‚É£ Recibo de Lote"}),e.jsx("span",{className:"block text-xs text-gray-500 mb-3",children:'CSV "Comprovante de Pagamentos" (19 colunas)'}),e.jsx("input",{id:"file-recibo",type:"file",accept:".csv",onChange:c=>A("recibo",c),className:"sr-only"}),e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"Selecionar CSV"})]}),n.recibo&&e.jsxs("p",{className:"mt-2 text-xs text-green-600 font-medium truncate",children:["‚úì ",n.recibo.name]})]})]})}),e.jsx("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-purple-400 flex items-center justify-center",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-full w-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{htmlFor:"file-ofx",className:"cursor-pointer",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-900 mb-1",children:"3Ô∏è‚É£ Extrato OFX"}),e.jsx("span",{className:"block text-xs text-gray-500 mb-3",children:"Extrato banc√°rio"}),e.jsx("input",{id:"file-ofx",type:"file",accept:".ofx,.xml",onChange:c=>A("ofx",c),className:"sr-only"}),e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"Selecionar OFX"})]}),n.ofx&&e.jsxs("p",{className:"mt-2 text-xs text-green-600 font-medium truncate",children:["‚úì ",n.ofx.name]})]})]})})]}),ye&&!i&&e.jsx("button",{onClick:je,disabled:U||!x,className:`
            w-full flex justify-center items-center gap-2 py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white
            ${U?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}
          `,children:U?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Validando recebimentos..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),e.jsx("span",{children:"Validar Cascata (3 arquivos)"})]})}),k&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:k})})]}),e.jsx("button",{onClick:s,className:"ml-4 px-3 py-1 bg-red-100 hover:bg-red-200 text-red-700 text-xs font-medium rounded",children:"Limpar e Tentar Novamente"})]})}),i&&i.success&&e.jsxs("div",{className:"space-y-4",children:[i.ja_conciliado&&i.aviso_reprocessamento&&e.jsx("div",{className:"bg-orange-50 border-l-4 border-orange-400 p-4 rounded-lg",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6 text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-orange-800",children:"‚ö†Ô∏è REPROCESSAMENTO DETECTADO"}),e.jsxs("div",{className:"mt-2 text-sm text-orange-700",children:[e.jsx("p",{children:i.aviso_reprocessamento.mensagem}),i.aviso_reprocessamento.usuario_anterior&&e.jsxs("p",{className:"mt-1",children:[e.jsx("span",{className:"font-medium",children:"Processado anteriormente por:"})," ",i.aviso_reprocessamento.usuario_anterior]})]}),e.jsx("div",{className:"mt-3",children:e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:["Data: ",i.data_referencia," | Operadora: ",i.operadora_detectada]})})]})]})}),(i.operadora_detectada||i.data_referencia)&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Informa√ß√µes da Concilia√ß√£o"}),e.jsxs("div",{className:"mt-2 text-sm text-blue-700 space-y-1",children:[i.operadora_detectada&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Operadora:"})," ",i.operadora_detectada,i.confianca_deteccao&&e.jsxs("span",{className:"ml-2 text-xs",children:["(Confian√ßa: ",(i.confianca_deteccao*100).toFixed(0),"%)"]})]}),i.data_referencia&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Data de Refer√™ncia:"})," ",new Date(i.data_referencia+"T00:00:00").toLocaleDateString("pt-BR")]}),i.historico_id&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"ID do Hist√≥rico:"})," #",i.historico_id]})]})]})]})}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"h-6 w-6 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Resumo da Valida√ß√£o em Cascata"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"1Ô∏è‚É£ Recebimentos Detalhados"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:["R$ ",(we=i.valor_total_recebimentos)==null?void 0:we.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[i.recebimentos_salvos," transa√ß√µes"]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:"2Ô∏è‚É£ Comprovante (Lotes)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-900",children:["R$ ",(te=i.valor_total_lotes)==null?void 0:te.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[i.lotes_count," lotes"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-purple-600 font-medium mb-1",children:"3Ô∏è‚É£ Extrato Banc√°rio (OFX)"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900",children:["R$ ",(Ce=i.valor_total_ofx)==null?void 0:Ce.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:[i.ofx_count," cr√©ditos"]})]})]})]}),!i.tem_divergencias&&e.jsx("div",{className:"bg-green-50 border-l-4 border-green-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:"‚úÖ Valida√ß√£o Perfeita! Nenhuma diverg√™ncia encontrada."}),e.jsxs("p",{className:"mt-1 text-sm text-green-700",children:["Todas as 3 somas est√£o id√™nticas. As ",i.recebimentos_salvos," vendas foram confirmadas na conta."]})]})]})}),i.tem_divergencias&&i.divergencias&&i.divergencias.length>0&&e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"‚ö†Ô∏è Diverg√™ncias Detectadas"}),e.jsx("p",{className:"mt-1 text-sm text-yellow-700",children:"Foram encontradas diferen√ßas entre os arquivos. Analise abaixo e decida se aceita ou n√£o."}),e.jsx("div",{className:"mt-4 space-y-3",children:i.divergencias.map((c,w)=>{var ie,a,l;const _=c.nivel==="arredondamento",G=_?"bg-blue-50 border-blue-200":"bg-orange-50 border-orange-200",Q=_?"text-blue-900":"text-orange-900",be=_?"bg-blue-100 text-blue-800":"bg-orange-100 text-orange-800";return e.jsxs("div",{className:`border rounded-lg p-4 ${G}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-semibold px-2 py-1 rounded ${be}`,children:_?"üîµ Arredondamento":"üü† Aten√ß√£o"}),e.jsx("p",{className:`text-sm font-medium ${Q}`,children:c.tipo==="recebimentos_vs_lotes"?"Recebimentos √ó Lotes":"Lotes √ó OFX"})]}),e.jsxs("div",{className:`text-right ${Q}`,children:[e.jsxs("p",{className:"text-lg font-bold",children:["R$ ",Math.abs(c.diferenca).toFixed(2)]}),e.jsxs("p",{className:"text-xs",children:[(ie=c.percentual)==null?void 0:ie.toFixed(3),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:c.tipo==="recebimentos_vs_lotes"?"Recebimentos:":"Lotes:"}),e.jsxs("p",{className:`font-semibold ${Q}`,children:["R$ ",(a=c.tipo==="recebimentos_vs_lotes"?c.soma_recebimentos:c.soma_lotes)==null?void 0:a.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:c.tipo==="recebimentos_vs_lotes"?"Lotes:":"OFX:"}),e.jsxs("p",{className:`font-semibold ${Q}`,children:["R$ ",(l=c.tipo==="recebimentos_vs_lotes"?c.soma_lotes:c.soma_ofx)==null?void 0:l.toFixed(2)]})]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-2 italic",children:c.mensagem})]},w)})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsx("div",{className:"text-sm text-gray-600",children:i.tem_divergencias?e.jsx("p",{children:"‚ö†Ô∏è Analise as diverg√™ncias e decida se aceita a valida√ß√£o"}):e.jsx("p",{children:"‚úÖ Valida√ß√£o perfeita! Pode avan√ßar para a Aba 3."})}),e.jsxs("div",{className:"flex gap-3",children:[i.tem_divergencias&&e.jsx("button",{onClick:s,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 font-medium",children:"‚úï Cancelar e Recome√ßar"}),e.jsx("button",{onClick:()=>{console.log("üñ±Ô∏è Bot√£o Aceitar e Avan√ßar clicado"),xe()},className:`px-6 py-2 rounded-md font-medium transition-colors ${i.tem_divergencias?"bg-yellow-600 hover:bg-yellow-700 text-white":"bg-green-600 hover:bg-green-700 text-white"}`,children:i.tem_divergencias?"‚úì Aceitar e Avan√ßar ‚Üí":"Avan√ßar para Aba 3 ‚Üí"})]})]})]}),X&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>F(!1)}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Confirmar Operadora"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Voc√™ est√° prestes a validar recebimentos para a operadora:"}),e.jsx("div",{className:"mt-3 p-3 bg-blue-50 rounded border border-blue-200",children:e.jsxs("p",{className:"text-lg font-bold text-blue-900",children:["üè¶ ",x==null?void 0:x.nome]})}),e.jsxs("p",{className:"text-sm text-gray-500 mt-3",children:["‚ö†Ô∏è ",e.jsx("strong",{children:"Todos os lan√ßamentos ser√£o vinculados a esta operadora."})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"O sistema detectar√° automaticamente se os arquivos correspondem a esta operadora e alertar√° se houver diverg√™ncia."})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"button",onClick:re,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm",children:"‚úì Confirmar e Validar"}),e.jsx("button",{type:"button",onClick:()=>F(!1),className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Cancelar"})]})]})]})}),Z&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-orange-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{className:"h-6 w-6 text-orange-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left flex-1",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-orange-900",children:"‚ö†Ô∏è Diverg√™ncia de Operadora Detectada"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-4",children:e.jsx("strong",{children:"Os arquivos enviados parecem ser de uma operadora diferente da selecionada."})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-red-50 border-2 border-red-300 rounded-lg",children:[e.jsx("p",{className:"text-xs text-red-600 font-medium mb-1",children:"Operadora Selecionada:"}),e.jsx("p",{className:"text-lg font-bold text-red-900",children:x==null?void 0:x.nome})]}),e.jsxs("div",{className:"p-3 bg-green-50 border-2 border-green-300 rounded-lg",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:"Operadora Detectada nos Arquivos:"}),e.jsx("p",{className:"text-lg font-bold text-green-900",children:se}),e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["Confian√ßa da detec√ß√£o: ",(ne*100).toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded",children:[e.jsx("p",{className:"text-sm text-yellow-800",children:e.jsx("strong",{children:"O que voc√™ deseja fazer?"})}),e.jsxs("ul",{className:"text-xs text-yellow-700 mt-2 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsxs("strong",{children:["Mudar para ",se,":"]})," Recomendado se os arquivos est√£o corretos"]}),e.jsxs("li",{children:[e.jsxs("strong",{children:["Manter ",x==null?void 0:x.nome,":"]})," Use se voc√™ tem certeza da operadora"]})]})]})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{const c=B.find(w=>w.nome===se);c&&W(c),S(!1),setTimeout(()=>{re()},100)},className:"inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none sm:text-sm",children:["‚úì Mudar para ",se]}),e.jsxs("button",{type:"button",onClick:()=>{K(!0),S(!1),setTimeout(()=>{re()},100)},className:"inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:text-sm",children:["Manter ",x==null?void 0:x.nome]}),e.jsx("button",{type:"button",onClick:()=>{S(!1),C(!1),s()},className:"inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:text-sm",children:"‚úï Cancelar Tudo"})]})]})]})})]})}function Le({onConcluida:E,status:de}){var D,me,K,xe;const ae=ke(),[R,n]=r.useState(!1),[y,U]=r.useState(""),[C,i]=r.useState(null),[T,k]=r.useState(!1),[t,B]=r.useState(null),[le,x]=r.useState(null),[W,z]=r.useState([]),[v,X]=r.useState(null),[F,Z]=r.useState(!0);r.useEffect(()=>{(async()=>{try{const p=await q.get("/operadoras-cartao?apenas_ativas=true");z(p.data);const A=p.data.find(je=>je.padrao);A&&X(A)}catch(p){console.error("Erro ao carregar operadoras:",p),x("Erro ao carregar operadoras")}finally{Z(!1)}})()},[]),r.useEffect(()=>{const s=localStorage.getItem("conciliacao_aba3_aviso_ate");if(!s)return;const p=Number(s);Number.isFinite(p)&&Date.now()<p&&n(!0)},[]);const S=s=>{const p=Date.now()+s*24*60*60*1e3;localStorage.setItem("conciliacao_aba3_aviso_ate",String(p)),n(!0)};r.useEffect(()=>{y&&v?se():i(null)},[y,v]);const se=async()=>{try{const s=await q.get("/conciliacao/aba3/preview-amarracao",{params:{data_recebimento:y,operadora:v==null?void 0:v.nome}});i(s.data)}catch(s){console.error("Erro ao buscar preview:",s),i(null)}},H=async()=>{var s,p;if(!v||!y){x("Selecione a operadora e a data primeiro");return}k(!0),x(null);try{const A=await q.post("/conciliacao/aba3/amarrar-automatico",{data_recebimento:y,operadora:v==null?void 0:v.nome});B(A.data)}catch(A){console.error("Erro ao processar:",A),x(((p=(s=A.response)==null?void 0:s.data)==null?void 0:p.detail)||"Erro ao processar amarra√ß√£o")}finally{k(!1)}},ne=()=>{var s,p;if(t){const A=`‚úÖ Concilia√ß√£o finalizada com sucesso!

üìä Resumo:
‚Ä¢ ${t.parcelas_liquidadas} parcelas baixadas
‚Ä¢ Valor total: R$ ${(s=t.valor_total_liquidado)==null?void 0:s.toFixed(2)}
‚Ä¢ Taxa de amarra√ß√£o: ${(p=t.taxa_amarracao_automatica)==null?void 0:p.toFixed(1)}%`;alert(A)}E&&E(),ae("/financeiro/historico-conciliacoes")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Aba 3: Amarra√ß√£o Autom√°tica"}),e.jsx("p",{className:"text-gray-600",children:"Amarra√ß√£o 98% autom√°tica: recebimentos ‚Üí vendas ‚Üí baixa de parcelas"})]}),R?e.jsx("button",{onClick:()=>n(!1),className:"text-xs text-blue-700 hover:text-blue-900",children:"Mostrar aviso de sequencia"}):e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Ordem recomendada:"})," Execute a Aba 1 e Aba 2 antes para garantir que a amarracao encontre todos os recebimentos."]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>S(30),className:"text-xs text-blue-700 hover:text-blue-900",children:"Ocultar 30 dias"}),e.jsx("button",{onClick:()=>S(365),className:"text-xs text-blue-700 hover:text-blue-900",children:"Ocultar 1 ano"})]})]})}),e.jsx("div",{className:"bg-green-50 border-l-4 border-green-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"98% autom√°tico!"})," Se as Abas 1 e 2 foram bem feitas, esta etapa √© quase instant√¢nea. Sistema vincula recebimentos √†s vendas pelo NSU e baixa as parcelas automaticamente."]})})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Operadora:"}),e.jsxs("select",{value:(v==null?void 0:v.id)||"",onChange:s=>{const p=W.find(A=>String(A.id)===s.target.value);X(p||null)},disabled:F,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Selecione a operadora"}),W.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data dos recebimentos:"}),e.jsx("input",{type:"date",value:y,onChange:s=>U(s.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Selecione a operadora e a data dos recebimentos validados na Aba 2"})]}),C&&C.recebimentos_validados>0&&e.jsx("div",{className:"bg-blue-50 border-2 border-blue-300 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:"üìä Preview da Amarra√ß√£o"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white rounded",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Recebimentos validados:"}),e.jsx("span",{className:"text-lg font-bold text-gray-900",children:C.recebimentos_validados})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-100 rounded border-2 border-blue-400",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-900",children:"‚úÖ Parcelas que ser√£o baixadas:"}),e.jsx("span",{className:"text-xl font-bold text-blue-900",children:C.parcelas_a_baixar})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-100 rounded border-2 border-green-400",children:[e.jsx("span",{className:"text-sm font-semibold text-green-900",children:"üí∞ Valor total a liquidar:"}),e.jsxs("span",{className:"text-xl font-bold text-green-900",children:["R$ ",(D=C.valor_total)==null?void 0:D.toFixed(2)]})]})]})]})]})}),C&&C.recebimentos_validados===0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"‚ö†Ô∏è Nenhum recebimento validado encontrado para esta data. Verifique se a Aba 2 foi processada corretamente."})}),C&&C.parcelas_a_baixar>0&&!t&&e.jsx("button",{onClick:H,disabled:T,className:`
            w-full flex justify-center items-center gap-3 py-4 px-6 border-2 border-transparent rounded-lg shadow-lg text-base font-bold
            ${T?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white"}
          `,children:T?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-6 w-6 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Processando amarra√ß√£o..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsxs("span",{children:["‚úÖ Processar ‚Üí baixar ",C.parcelas_a_baixar," parcelas"]})]})}),le&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:le})})]})}),t&&t.success&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:`border-l-4 p-6 rounded-lg ${t.alerta_saude==="OK"?"bg-green-50 border-green-400":"bg-red-50 border-red-400"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:t.alerta_saude==="OK"?e.jsx("svg",{className:"h-8 w-8 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):e.jsx("svg",{className:"h-8 w-8 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:`text-xl font-bold mb-2 ${t.alerta_saude==="OK"?"text-green-900":"text-red-900"}`,children:t.alerta_saude==="OK"?"‚úÖ Amarra√ß√£o Conclu√≠da com Sucesso!":"‚ö†Ô∏è Amarra√ß√£o Conclu√≠da com Alertas"}),e.jsxs("p",{className:"text-sm text-gray-700 font-medium mb-4 bg-green-100 border border-green-300 rounded px-3 py-2",children:["üí∞ ",t.parcelas_liquidadas," conta(s) a receber foi(ram) baixada(s) com sucesso! Valor total: R$ ",(me=t.valor_total_liquidado)==null?void 0:me.toFixed(2)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white rounded p-4 shadow",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Amarrados"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:t.amarrados})]}),e.jsxs("div",{className:"bg-white rounded p-4 shadow",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"√ìrf√£os"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:t.orfaos})]}),e.jsxs("div",{className:"bg-white rounded p-4 shadow",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Parcelas Liquidadas"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:t.parcelas_liquidadas})]}),e.jsxs("div",{className:"bg-white rounded p-4 shadow",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Valor Liquidado"}),e.jsxs("p",{className:"text-xl font-bold text-purple-600",children:["R$ ",(K=t.valor_total_liquidado)==null?void 0:K.toFixed(2)]})]})]}),e.jsxs("div",{className:`p-4 rounded-lg border-2 ${t.alerta_saude==="OK"?"bg-green-100 border-green-400":"bg-red-100 border-red-400"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"üìä Sa√∫de do Sistema"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Taxa de amarra√ß√£o autom√°tica"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-4xl font-bold ${t.alerta_saude==="OK"?"text-green-700":"text-red-700"}`,children:[(xe=t.taxa_amarracao_automatica)==null?void 0:xe.toFixed(1),"%"]}),e.jsx("p",{className:`text-sm font-medium mt-1 ${t.alerta_saude==="OK"?"text-green-700":"text-red-700"}`,children:t.alerta_saude==="OK"?"‚úÖ SAUD√ÅVEL":"üö® CR√çTICO"})]})]}),t.alerta_saude!=="OK"&&e.jsx("p",{className:"mt-3 text-xs text-red-700 font-medium",children:"‚ö†Ô∏è Taxa abaixo de 90% indica problema na opera√ß√£o. Revise a Aba 1 (confer√™ncia de vendas)."})]})]})]})}),t.orfaos>0&&t.lista_orfaos&&e.jsxs("div",{className:"bg-white border-2 border-red-300 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-red-50 border-b border-red-200",children:[e.jsxs("h4",{className:"text-lg font-semibold text-red-900",children:["‚ö†Ô∏è Recebimentos √ìrf√£os (",t.orfaos,")"]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Estes recebimentos n√£o t√™m venda correspondente. Precisa resolver na Aba 1."})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-3",children:t.lista_orfaos.map((s,p)=>{var A;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-red-900",children:["NSU: ",s.nsu]}),e.jsxs("p",{className:"text-xs text-red-700",children:["Data: ",s.data," ‚Ä¢ Valor: R$ ",(A=s.valor)==null?void 0:A.toFixed(2)]})]}),e.jsx("button",{className:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded hover:bg-red-700",children:"Resolver na Aba 1"})]},p)})})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsx("div",{className:"text-sm text-gray-600",children:e.jsx("p",{children:"üéâ Concilia√ß√£o completa! Todas as 3 abas foram processadas."})}),e.jsxs("button",{onClick:ne,className:"px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 font-semibold flex items-center gap-2 shadow-lg",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{children:"Concluir e Ver Hist√≥rico"})]})]})]})]})}function qe(){const[E,de]=r.useState(1),[ae,R]=r.useState(!1),[n,y]=r.useState(null),[U,C]=r.useState(!1),[i,T]=r.useState("pendente"),[k,t]=r.useState("pendente"),[B,le]=r.useState("pendente");r.useEffect(()=>{const S=localStorage.getItem("conciliacao_tabs_skip_aviso");C(S==="true")},[]),r.useEffect(()=>{console.log("üîÑ abaAtiva MUDOU PARA:",E)},[E]);const x=()=>{console.log("‚úÖ Aba 1 conclu√≠da, marcando como processado"),T("processado")},W=()=>{console.log("‚úÖ Aba 2 conclu√≠da, marcando como processado e avan√ßando para Aba 3"),t("processado"),console.log("üöÄ Mudando para Aba 3 imediatamente..."),console.log("üîç abaAtiva ANTES de setAbaAtiva:",E),de(S=>(console.log("üîç abaAtiva ANTERIOR (dentro do setState):",S),console.log("üîç Retornando novo valor:",3),3)),console.log("‚úÖ setAbaAtiva(3) executado")},z=()=>{console.log("‚úÖ Aba 3 conclu√≠da, marcando como processado"),le("processado")},v=S=>{if(U||S===1){de(S);return}y(S),R(!0)},X=()=>{n&&de(n),R(!1)},F=()=>{localStorage.setItem("conciliacao_tabs_skip_aviso","true"),C(!0),n&&de(n),R(!1)},Z=S=>{switch(S){case"processado":return e.jsx("span",{className:"text-green-600 text-xl",children:"‚úÖ"});case"pendente":return e.jsx("span",{className:"text-yellow-600 text-xl",children:"‚è≥"});case"bloqueado":return e.jsx("span",{className:"text-gray-400 text-xl",children:"üîí"});case"erro":return e.jsx("span",{className:"text-red-600 text-xl",children:"‚ùå"});default:return null}};return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Concilia√ß√£o de Cart√µes - 3 Etapas"}),e.jsx("p",{className:"text-gray-600",children:"Processo completo: Vendas ‚Üí Recebimentos ‚Üí Amarra√ß√£o (baixa autom√°tica)"})]}),e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-yellow-700 font-medium",children:["Ordem recomendada: ",e.jsx("strong",{children:"Aba 1"})," ‚Üí ",e.jsx("strong",{children:"Aba 2"})," ‚Üí ",e.jsx("strong",{children:"Aba 3"}),". As abas ficam abertas, mas a sequencia evita divergencias."]})})]})}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsxs("nav",{className:"flex -mb-px space-x-8",children:[e.jsxs("button",{onClick:()=>v(1),disabled:!1,className:`
              flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${E===1?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx("span",{className:"text-lg",children:"1Ô∏è‚É£"}),e.jsx("span",{children:"Concilia√ß√£o de Vendas"}),Z(i),i==="pendente"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Obrigat√≥ria"})]}),e.jsxs("button",{onClick:()=>v(2),disabled:!1,className:`
              flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${E===2?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx("span",{className:"text-lg",children:"2Ô∏è‚É£"}),e.jsx("span",{children:"Concilia√ß√£o de Recebimentos"}),Z(k),k==="pendente"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Recomendada apos Aba 1"})]}),e.jsxs("button",{onClick:()=>v(3),disabled:!1,className:`
              flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${E===3?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx("span",{className:"text-lg",children:"3Ô∏è‚É£"}),e.jsx("span",{children:"Amarra√ß√£o Autom√°tica"}),Z(B),B==="pendente"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Recomendada apos Aba 2"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[E===1&&e.jsx(Me,{onConcluida:x,status:i}),E===2&&e.jsx(Ve,{onConcluida:W,status:k}),E===3&&e.jsx(Le,{onConcluida:z,status:B})]}),ae&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Ordem recomendada das etapas"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["A sequencia ",e.jsx("strong",{children:"Aba 1 ‚Üí Aba 2 ‚Üí Aba 3"})," reduz divergencias e garante que a amarracao automatica encontre todos os recebimentos."]}),e.jsxs("div",{className:"bg-gray-50 rounded-md p-3 text-sm text-gray-700 mb-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Aba 1:"})," prepara vendas e NSUs."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Aba 2:"})," valida que o dinheiro entrou."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Aba 3:"})," baixa parcelas automaticamente."]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>R(!1),className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-800",children:"Cancelar"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:F,className:"px-3 py-2 text-sm text-blue-700 hover:text-blue-900",children:"Nao mostrar novamente"}),e.jsx("button",{onClick:X,className:"px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded hover:bg-blue-700",children:"Continuar"})]})]})]})}),e.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-2",children:"‚ÑπÔ∏è Como funciona:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Aba 1:"})," Confere NSU, bandeira, parcelas, taxa (prepara dados)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Aba 2:"})," Valida que dinheiro entrou na conta (3 arquivos: detalhados, recibo, OFX)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Aba 3:"})," Vincula recebimentos √†s vendas e baixa parcelas automaticamente (98%!)"]})]})]})]})}export{qe as default};
