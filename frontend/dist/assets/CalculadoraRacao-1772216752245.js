import{r as h,z as l,j as e}from"./vendor-react-1772216752245.js";import{a as _}from"./index-1772216752245.js";function w(){const[g,N]=h.useState([]),[v,y]=h.useState([]),[j,f]=h.useState(!1),[a,t]=h.useState({pet_id:"",pet_nome:"",produto_id:"",produto_nome:"",categoria_racao:"",peso_pet_kg:"",idade_meses:"",nivel_atividade:"normal",classificacao:"",especies:"dog",produto_comparar_id:"",produto_comparar_nome:""}),[n,$]=h.useState(null),[m,x]=h.useState([]);h.useEffect(()=>{C(),R()},[]);const C=async()=>{var o,s,i;try{console.log("üîç Iniciando carregamento de produtos...");const r=await _.get("/produtos/");console.log("üì° Resposta da API:",{status:r.status,dataType:typeof r.data,isArray:Array.isArray(r.data),dataPreview:typeof r.data=="string"?r.data.substring(0,200):"object"});let c=r.data;if(typeof c=="string"){console.warn("‚ö†Ô∏è API retornou string, tentando parsear JSON...");try{c=JSON.parse(c)}catch(d){console.error("‚ùå Erro ao parsear JSON:",d),console.error("‚ùå Conte√∫do recebido:",c.substring(0,500)),l.error("Erro: resposta da API inv√°lida");return}}const p=Array.isArray(c)?c:c.items||c.produtos||[];console.log("üì¶ Total de produtos recebidos:",p.length),console.log("üì¶ Estrutura da resposta:",Array.isArray(c)?"Array direto":`Objeto com keys: ${Object.keys(c).join(", ")}`),p.length>0&&console.log("üì¶ Estrutura do primeiro produto:",p[0]);const u=p.filter(d=>d.peso_embalagem&&d.peso_embalagem>0);console.log("ü•´ Ra√ß√µes encontradas:",u.length),console.log("üìä Total de produtos:",p.length),u.length>0?console.log("ü•´ IDs das ra√ß√µes:",u.map(d=>`${d.id}-${d.nome}`)):console.log("‚ö†Ô∏è Produtos sem peso_embalagem:",p.slice(0,5).map(d=>({id:d.id,nome:d.nome,peso_embalagem:d.peso_embalagem,categoria_racao:d.categoria_racao,classificacao_racao:d.classificacao_racao}))),N(u),u.length===0&&p.length>0?(console.warn("‚ö†Ô∏è Produtos encontrados, mas nenhum tem peso de embalagem configurado"),l.error(`${p.length} produtos encontrados, mas nenhum tem PESO DE EMBALAGEM configurado. Edite os produtos de ra√ß√£o e preencha o campo "Peso da Embalagem (kg)".`,{duration:6e3})):u.length===0&&(console.log("‚ÑπÔ∏è Nenhum produto encontrado"),l.error("Nenhum produto encontrado. Cadastre produtos primeiro."))}catch(r){console.error("‚ùå Erro ao carregar produtos:",r),console.error("‚ùå Detalhes:",((o=r.response)==null?void 0:o.data)||r.message),l.error(`Erro ao carregar produtos: ${((i=(s=r.response)==null?void 0:s.data)==null?void 0:i.detail)||r.message}`)}},R=async()=>{try{const o=await _.get("/clientes/pets/todos"),s=Array.isArray(o.data)?o.data:[];y(s),console.log("üêæ Pets carregados:",s.length)}catch(o){console.error("‚ùå Erro ao carregar pets:",o)}},k=o=>{const s=v.find(i=>i.id===parseInt(o));if(s){let i="";if(s.data_nascimento){const c=new Date(s.data_nascimento),u=Math.abs(new Date-c);i=Math.floor(u/(1e3*60*60*24*30.44)).toString()}const r=s.especie==="Cachorro"?"dog":s.especie==="Gato"?"cat":a.especies;t({...a,pet_id:o,pet_nome:`${s.nome} - ${s.especie} ${s.peso?`(${s.peso}kg)`:""}`,peso_pet_kg:s.peso||"",idade_meses:i,especies:r}),l.success(`Pet ${s.nome} selecionado!`)}else t({...a,pet_id:"",peso_pet_kg:"",idade_meses:""})},P=async()=>{var o,s;if(!a.peso_pet_kg){l.error("Informe o peso do pet");return}if(a.categoria_racao==="filhote"&&!a.idade_meses){l.error("‚ö†Ô∏è Idade √© obrigat√≥ria para ra√ß√µes de filhote!");return}try{f(!0);const i=await _.post("/api/produtos/calculadora-racao",{produto_id:a.produto_id?parseInt(a.produto_id):null,peso_pet_kg:parseFloat(a.peso_pet_kg),idade_meses:a.idade_meses?parseInt(a.idade_meses):null,nivel_atividade:a.nivel_atividade});$(i.data),x([]),l.success("C√°lculo realizado!")}catch(i){console.error("Erro:",i),l.error(((s=(o=i.response)==null?void 0:o.data)==null?void 0:s.detail)||"Erro ao calcular")}finally{f(!1)}},E=async()=>{var o,s;if(!a.peso_pet_kg){l.error("Informe o peso do pet");return}try{if(f(!0),a.produto_comparar_id){const r=(await _.post("/api/produtos/calculadora-racao",{produto_id:parseInt(a.produto_comparar_id),peso_pet_kg:parseFloat(a.peso_pet_kg),idade_meses:a.idade_meses?parseInt(a.idade_meses):null,nivel_atividade:a.nivel_atividade})).data;if(a.produto_id){const c=await _.post("/api/produtos/calculadora-racao",{produto_id:parseInt(a.produto_id),peso_pet_kg:parseFloat(a.peso_pet_kg),idade_meses:a.idade_meses?parseInt(a.idade_meses):null,nivel_atividade:a.nivel_atividade});if(c.data.produto_id===r.produto_id)x([c.data]),l.success("Mostrando c√°lculo da ra√ß√£o selecionada");else{const p=[c.data,r];x(p),l.success("Comparando 2 ra√ß√µes selecionadas!")}}else x([r]),l.success("Mostrando c√°lculo da ra√ß√£o selecionada")}else{const i={peso_pet_kg:parseFloat(a.peso_pet_kg),nivel_atividade:a.nivel_atividade};a.idade_meses&&(i.idade_meses=parseInt(a.idade_meses)),a.classificacao&&(i.classificacao=a.classificacao),a.especies&&(i.especies=a.especies);let c=(await _.post("/api/produtos/comparar-racoes",null,{params:i})).data.racoes||[];if(a.produto_id){c=c.filter(b=>b.produto_id!==parseInt(a.produto_id));const S=(await _.post("/api/produtos/calculadora-racao",{produto_id:parseInt(a.produto_id),peso_pet_kg:parseFloat(a.peso_pet_kg),idade_meses:a.idade_meses?parseInt(a.idade_meses):null,nivel_atividade:a.nivel_atividade})).data;c.sort((b,I)=>b.custo_por_dia-I.custo_por_dia),c=[S,...c]}const p=c.slice(0,10);x(p),c.length===0&&l.error("Nenhuma ra√ß√£o encontrada com esses filtros. Tente outros crit√©rios.")}}catch(i){console.error("Erro:",i),l.error(((s=(o=i.response)==null?void 0:o.data)==null?void 0:s.detail)||"Erro ao comparar")}finally{f(!1)}};return e.jsxs("div",{className:"calculadora-racao-container",children:[e.jsxs("div",{className:"header",children:[e.jsx("h1",{children:"ü•´ Calculadora de Ra√ß√£o"}),e.jsx("p",{children:"Calcule dura√ß√£o, custo/dia e compare produtos"})]}),e.jsxs("div",{className:"calculadora-grid",children:[e.jsxs("div",{className:"form-card",children:[e.jsx("h2",{children:"üìù Dados do Pet"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"üêæ Buscar Pet Cadastrado"}),e.jsx("input",{type:"text",list:"pets-list",value:a.pet_nome||"",onChange:o=>{const s=o.target.value;t({...a,pet_nome:s});const i=v.find(r=>`${r.nome} - ${r.especie} ${r.peso?`(${r.peso}kg)`:""}`===s);i&&k(i.id)},placeholder:"Digite ou selecione um pet",className:"pet-select"}),e.jsx("datalist",{id:"pets-list",children:v.map(o=>e.jsx("option",{value:`${o.nome} - ${o.especie} ${o.peso?`(${o.peso}kg)`:""}`},o.id))}),e.jsx("small",{className:"form-hint",children:"üí° Digite ou selecione um pet para preencher automaticamente peso e idade"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Peso do Pet (kg) *"}),e.jsx("input",{type:"number",step:"0.1",value:a.peso_pet_kg,onChange:o=>t({...a,peso_pet_kg:o.target.value}),placeholder:"Ex: 8.5"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Idade (meses)",a.categoria_racao==="filhote"&&e.jsx("span",{style:{color:"#ff6b6b"},children:" *"})]}),e.jsx("input",{type:"number",value:a.idade_meses,onChange:o=>t({...a,idade_meses:o.target.value}),placeholder:a.categoria_racao==="filhote"?"Obrigat√≥rio para filhotes!":"Ex: 24 (opcional)",required:a.categoria_racao==="filhote",style:a.categoria_racao==="filhote"?{borderColor:"#ff6b6b",borderWidth:"2px"}:{}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"N√≠vel de Atividade"}),e.jsxs("select",{value:a.nivel_atividade,onChange:o=>t({...a,nivel_atividade:o.target.value}),children:[e.jsx("option",{value:"baixo",children:"Baixo"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"alto",children:"Alto"})]})]}),e.jsx("hr",{}),e.jsx("h3",{children:"ü•´ Ra√ß√£o"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Selecionar Ra√ß√£o"}),e.jsx("input",{type:"text",list:"racoes-list",value:a.produto_nome||"",onChange:o=>{const s=o.target.value;t({...a,produto_nome:s});const i=g.find(r=>`${r.nome} - ${r.peso_embalagem}kg - R$ ${r.preco_venda}`===s);i&&t({...a,produto_id:i.id,produto_nome:s,categoria_racao:i.categoria_racao||""})},placeholder:"Digite ou selecione uma ra√ß√£o"}),e.jsx("datalist",{id:"racoes-list",children:g.map(o=>e.jsx("option",{value:`${o.nome} - ${o.peso_embalagem}kg - R$ ${o.preco_venda}`},o.id))}),a.categoria_racao==="filhote"&&e.jsx("small",{className:"form-hint",style:{color:"#ff6b6b",fontWeight:"bold"},children:"‚ö†Ô∏è Ra√ß√£o de filhote - idade √© obrigat√≥ria!"})]}),e.jsx("div",{className:"button-group",children:e.jsx("button",{onClick:P,disabled:j,className:"btn-primary",children:j?"Calculando...":"üìä Calcular"})}),e.jsx("hr",{}),e.jsx("h3",{children:"üîç Comparar Ra√ß√µes"}),e.jsxs("div",{className:"info-box",children:[e.jsx("strong",{children:"üí° Dica:"})," Escolha UMA das op√ß√µes abaixo:",e.jsx("br",{}),"‚Ä¢ Selecione uma ra√ß√£o espec√≠fica para ver como ela se compara",e.jsx("br",{}),"‚Ä¢ OU use os filtros gerais para ver todas de uma categoria"]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"‚≠ê Comparar Ra√ß√£o Espec√≠fica"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("input",{type:"text",list:"racoes-comparar-list",value:a.produto_comparar_nome||"",onChange:o=>{const s=o.target.value;if(s===""){t({...a,produto_comparar_id:"",produto_comparar_nome:""});return}t({...a,produto_comparar_nome:s,classificacao:""});const i=g.find(r=>`${r.nome} - ${r.classificacao_racao} - R$ ${r.preco_venda}`===s);i&&t({...a,produto_comparar_id:i.id,produto_comparar_nome:s,classificacao:""})},placeholder:"Digite ou selecione uma ra√ß√£o",disabled:a.classificacao!=="",style:{flex:1}}),a.produto_comparar_nome&&e.jsx("button",{type:"button",onClick:()=>t({...a,produto_comparar_id:"",produto_comparar_nome:""}),className:"btn-clear",title:"Limpar sele√ß√£o",children:"‚úï"})]}),e.jsx("datalist",{id:"racoes-comparar-list",children:g.map(o=>e.jsx("option",{value:`${o.nome} - ${o.classificacao_racao} - R$ ${o.preco_venda}`},o.id))}),a.classificacao&&e.jsx("small",{className:"form-warning",children:"‚ö†Ô∏è Limpe o filtro de classifica√ß√£o para usar esta op√ß√£o"}),!a.produto_comparar_id&&!a.classificacao&&e.jsx("small",{className:"form-hint",children:"üí° Deixe vazio para comparar por classifica√ß√£o abaixo"})]}),e.jsx("div",{className:"divider-text",children:"OU"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"üìã Filtro por Classifica√ß√£o"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("select",{value:a.classificacao,onChange:o=>t({...a,classificacao:o.target.value,produto_comparar_id:"",produto_comparar_nome:""}),disabled:a.produto_comparar_id!=="",style:{flex:1},children:[e.jsx("option",{value:"",children:"Todas as classifica√ß√µes"}),e.jsx("option",{value:"super_premium",children:"Super Premium"}),e.jsx("option",{value:"premium",children:"Premium"}),e.jsx("option",{value:"especial",children:"Especial"}),e.jsx("option",{value:"standard",children:"Standard"})]}),a.classificacao&&e.jsx("button",{type:"button",onClick:()=>t({...a,classificacao:""}),className:"btn-clear",title:"Limpar filtro",children:"‚úï"})]}),a.produto_comparar_id&&e.jsx("small",{className:"form-warning",children:"‚ö†Ô∏è Limpe a ra√ß√£o espec√≠fica acima para usar este filtro"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Esp√©cie"}),e.jsxs("select",{value:a.especies,onChange:o=>t({...a,especies:o.target.value}),children:[e.jsx("option",{value:"dog",children:"üê∂ C√£es"}),e.jsx("option",{value:"cat",children:"üê± Gatos"}),e.jsx("option",{value:"both",children:"Ambos"})]})]}),e.jsx("div",{className:"button-group",children:e.jsx("button",{onClick:E,disabled:j,className:"btn-secondary",children:j?"Comparando...":"üîç Comparar Todas"})})]}),e.jsxs("div",{children:[n&&e.jsxs("div",{className:"result-card",children:[e.jsx("h2",{children:"üìä Resultado do C√°lculo"}),e.jsxs("div",{className:"result-header",children:[e.jsx("h3",{children:n.produto_nome}),n.classificacao&&e.jsx("span",{className:`badge badge-${n.classificacao}`,children:n.classificacao.replace("_"," ")})]}),e.jsxs("div",{className:"result-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"label",children:"Peso Embalagem"}),e.jsxs("span",{className:"value",children:[n.peso_embalagem_kg," kg"]})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"label",children:"Pre√ßo"}),e.jsxs("span",{className:"value",children:["R$ ",n.preco.toFixed(2)]})]})]}),e.jsxs("div",{className:"result-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"‚è±Ô∏è"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Dura√ß√£o"}),e.jsxs("p",{children:[n.duracao_dias," dias (",n.duracao_meses," meses)"]})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"ü•´"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Consumo di√°rio"}),e.jsxs("p",{children:[n.quantidade_diaria_g,"g"]})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"üí∞"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Custo/kg"}),e.jsxs("p",{children:["R$ ",n.custo_por_kg.toFixed(2)]})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"üìÖ"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Custo/dia"}),e.jsxs("p",{children:["R$ ",n.custo_por_dia.toFixed(2)]})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"üìÜ"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Custo mensal"}),e.jsxs("p",{children:["R$ ",n.custo_mensal.toFixed(2)]})]})]})]})]}),m.length>0&&e.jsxs("div",{className:"comparativo-card",children:[e.jsxs("h2",{children:["üèÜ Comparativo de Ra√ß√µes (",m.length,")"]}),e.jsx("p",{className:"subtitle",children:"Ordenado por melhor custo-benef√≠cio (menor custo di√°rio)"}),e.jsx("div",{className:"comparativo-list",children:(()=>{const o=Math.min(...m.map(s=>s.custo_por_dia));return m.map((s,i)=>{const r=a.produto_id&&s.produto_id===parseInt(a.produto_id),c=s.custo_por_dia===o;return e.jsxs("div",{className:`comparativo-item ${c?"melhor":""} ${r?"selecionada":""}`,style:{position:"relative"},children:[r&&e.jsx("span",{className:"badge-selecionada",style:{position:"absolute",left:"10px",top:"10px",zIndex:10,fontSize:"11px",padding:"4px 8px",whiteSpace:"nowrap"},children:"‚≠ê Selecionada"}),c&&e.jsx("span",{className:"badge-melhor",children:"üèÜ Melhor Custo-Benef√≠cio"}),e.jsxs("div",{className:"item-header",children:[e.jsxs("div",{children:[e.jsx("h4",{children:s.produto_nome}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginTop:"4px"},children:[s.classificacao&&e.jsx("span",{className:`badge badge-${s.classificacao}`,children:s.classificacao.replace("_"," ")}),e.jsxs("span",{style:{fontSize:"13px",color:"#64748b",backgroundColor:"#f1f5f9",padding:"2px 8px",borderRadius:"4px"},children:["üçΩÔ∏è ",s.quantidade_diaria_g,"g/dia"]})]})]}),e.jsxs("div",{className:"item-price",children:["R$ ",s.preco.toFixed(2)]})]}),e.jsxs("div",{className:"item-stats",children:[e.jsxs("div",{className:"stat-small",children:[e.jsx("span",{className:"label",children:"Peso"}),e.jsxs("span",{children:[s.peso_embalagem_kg,"kg"]})]}),e.jsxs("div",{className:"stat-small",children:[e.jsx("span",{className:"label",children:"Dura√ß√£o"}),e.jsxs("span",{children:[s.duracao_dias,"d"]})]}),e.jsxs("div",{className:"stat-small highlight",children:[e.jsx("span",{className:"label",children:"Custo/dia"}),e.jsxs("span",{children:["R$ ",s.custo_por_dia.toFixed(2)]})]}),e.jsxs("div",{className:"stat-small",children:[e.jsx("span",{className:"label",children:"Custo/m√™s"}),e.jsxs("span",{children:["R$ ",s.custo_mensal.toFixed(2)]})]})]}),c&&m.length>1&&e.jsxs("div",{style:{marginTop:"12px",padding:"12px",backgroundColor:"#ecfdf5",borderLeft:"3px solid #10b981",borderRadius:"4px"},children:[e.jsx("p",{style:{margin:"0 0 6px 0",fontSize:"13px",fontWeight:"600",color:"#065f46"},children:"‚ú® Por que esta √© a melhor op√ß√£o?"}),e.jsxs("p",{style:{margin:"0",fontSize:"13px",color:"#047857",lineHeight:"1.5"},children:["Apesar de ",s.classificacao==="premium"||s.classificacao==="super_premium"?`ter um pre√ßo mais alto (R$ ${s.preco.toFixed(2)})`:`custar R$ ${s.preco.toFixed(2)}`,", esta ra√ß√£o ",s.classificacao==="super_premium"?"super premium √© muito concentrada em nutrientes":s.classificacao==="premium"?"premium tem melhor densidade nutricional":"tem excelente efici√™ncia alimentar",", ent√£o seu pet consome apenas ",e.jsxs("strong",{children:[s.quantidade_diaria_g,"g por dia"]}),".",m[1]&&e.jsxs(e.Fragment,{children:[" Em compara√ß√£o, a segunda op√ß√£o requer ",e.jsxs("strong",{children:[m[1].quantidade_diaria_g,"g/dia"]}),", resultando em um custo di√°rio ",e.jsxs("strong",{children:["R$ ",(m[1].custo_por_dia-s.custo_por_dia).toFixed(2)," maior"]}),"(R$ ",s.custo_por_dia.toFixed(2)," vs R$ ",m[1].custo_por_dia.toFixed(2),")."]})]})]})]},s.produto_id)})})()})]})]})]})]})}export{w as default};
