import{S,r as a,j as e}from"./vendor-react-1772210327850.js";import{a as L}from"./index-1772210327850.js";const R=()=>{const N=S(),[m,y]=a.useState([]),[v,p]=a.useState(!0),[u,i]=a.useState(null),[n,w]=a.useState(null),[l,h]=a.useState(""),[d,g]=a.useState(""),[c,f]=a.useState("");a.useEffect(()=>{o()},[]);const o=async()=>{var t,r;try{p(!0),i(null);const s=new URLSearchParams;l&&s.append("data_inicio",l),d&&s.append("data_fim",d),c&&s.append("funcionario_id",c);const C=`/comissoes/fechamentos${s.toString()?"?"+s.toString():""}`,x=await L.get(C);x.data.success?(y(x.data.fechamentos||[]),w(x.data.resumo)):i("Erro ao carregar histÃ³rico")}catch(s){console.error("Erro ao carregar histÃ³rico:",s),i(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.detail)||"Erro ao carregar histÃ³rico de fechamentos")}finally{p(!1)}},k=()=>{o()},_=()=>{h(""),g(""),f(""),setTimeout(()=>o(),100)},j=t=>{N(`/comissoes/fechamentos/detalhe?funcionario_id=${t.funcionario_id}&data_pagamento=${t.data_pagamento}`)},b=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t),D=t=>t?new Date(t+"T00:00:00").toLocaleDateString("pt-BR"):"-",F=t=>t?new Date(t).toLocaleString("pt-BR"):"-";return v?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"bg-white shadow-md rounded-lg p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando histÃ³rico..."})]})})}):u?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-6 w-6 text-red-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-medium",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u})]})]}),e.jsx("button",{onClick:o,className:"mt-4 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-md transition-colors",children:"Tentar Novamente"})]})}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-8",children:[e.jsxs("div",{className:"mb-6 border-b border-gray-200 pb-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"HistÃ³rico de Fechamentos"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Auditoria de comissÃµes fechadas - somente leitura"})]}),e.jsxs("div",{className:"mb-6 bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Filtros"}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:l,onChange:t=>h(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:d,onChange:t=>g(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ID do FuncionÃ¡rio"}),e.jsx("input",{type:"number",value:c,onChange:t=>f(t.target.value),placeholder:"Deixe vazio para todos",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:k,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors",children:"Aplicar"}),e.jsx("button",{onClick:_,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md transition-colors",children:"Limpar"})]})]})]}),n&&e.jsx("div",{className:"mb-6 bg-purple-50 border border-purple-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Total de Fechamentos"}),e.jsx("p",{className:"text-2xl font-bold text-purple-800",children:n.total_fechamentos})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Valor Total Pago"}),e.jsx("p",{className:"text-2xl font-bold text-purple-800",children:b(n.valor_total_geral)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Total de ComissÃµes"}),e.jsx("p",{className:"text-2xl font-bold text-purple-800",children:n.quantidade_total_geral})]})]})}),m.length===0?e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"h-16 w-16 text-yellow-500 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-xl font-semibold text-yellow-800 mb-2",children:"Nenhum fechamento encontrado"}),e.jsx("p",{className:"text-yellow-600",children:"NÃ£o hÃ¡ fechamentos registrados no perÃ­odo selecionado."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"FuncionÃ¡rio"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Fechamento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Pagamento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qtde"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor Total"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ã£o"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map((t,r)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>j(t),children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-purple-600 font-semibold text-sm",children:t.nome_funcionario.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.nome_funcionario}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",t.funcionario_id]})]})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-600",children:F(t.data_fechamento)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm font-medium text-gray-900",children:D(t.data_pagamento)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800",children:t.quantidade_comissoes})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-semibold text-green-600",children:b(t.valor_total)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("button",{onClick:s=>{s.stopPropagation(),j(t)},className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:"Ver Detalhes"})})]},`${t.funcionario_id}_${t.data_pagamento}_${r}`))})]})}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"ðŸ’¡ Clique em uma linha para ver os detalhes do fechamento"})})]})]})})};export{R as default};
