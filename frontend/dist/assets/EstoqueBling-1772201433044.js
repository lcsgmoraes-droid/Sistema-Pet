import{r as i,aP as n,j as e}from"./vendor-react-1772201433044.js";import{a as c}from"./index-1772201433044.js";const P=()=>{const[l,N]=i.useState([]),[h,v]=i.useState([]),[x,d]=i.useState(!1),[b,g]=i.useState(!1),[m,p]=i.useState("todos"),[y,B]=i.useState(""),z=s=>{const o=s==null?void 0:s.categoria;return o?typeof o=="string"?o:typeof o=="object"?o.nome||o.descricao||`Categoria #${o.id??""}`.trim():String(o):null};i.useEffect(()=>{u()},[]);const u=async()=>{d(!0);try{const s=await c.get("/produtos/");N(s.data.items||[])}catch(s){console.error("Erro ao carregar produtos:",s),n.error("Erro ao carregar produtos"),N([])}finally{d(!1)}},w=async()=>{var s,o;d(!0);try{const t=y?{descricao:y}:{},a=await c.get("/bling-sync/produtos",{params:t});v(a.data||[]),n.success(`âœ… ${(a.data||[]).length} produtos encontrados no Bling`)}catch(t){console.error("Erro ao buscar no Bling:",t),n.error(((o=(s=t.response)==null?void 0:s.data)==null?void 0:o.detail)||"Erro ao buscar produtos no Bling"),v([])}finally{d(!1)}},S=async(s,o)=>{var t,a;try{await c.post("/bling-sync/vincular",{produto_id:s,bling_id:o}),n.success("âœ… Produto vinculado ao Bling com sucesso!"),u()}catch(j){n.error(((a=(t=j.response)==null?void 0:t.data)==null?void 0:a.detail)||"Erro ao vincular produto")}},_=async s=>{var o,t;g(!0);try{const a=await c.post(`/bling-sync/sincronizar-estoque/${s}`,{});n.success(`âœ… Estoque sincronizado!
Sistema: ${a.data.estoque_local} â†’ Bling: ${a.data.estoque_bling}`,{duration:4e3}),u()}catch(a){n.error(((t=(o=a.response)==null?void 0:o.data)==null?void 0:t.detail)||"Erro ao sincronizar estoque")}finally{g(!1)}},q=async()=>{g(!0);const s=l.filter(a=>a.bling_id);if(s.length===0){n.error("Nenhum produto vinculado ao Bling"),g(!1);return}let o=0,t=0;for(const a of s)try{await c.post(`/bling-sync/sincronizar-estoque/${a.id}`,{}),o++}catch(j){t++,console.error(`Erro ao sincronizar produto ${a.id}:`,j)}n.success(`âœ… SincronizaÃ§Ã£o concluÃ­da!
${o} produtos atualizados${t>0?`, ${t} erros`:""}`,{duration:5e3}),u(),g(!1)},E=async()=>{var s,o;d(!0);try{const t=await c.post("/bling-sync/reconciliar",{});n.success(`âœ… ReconciliaÃ§Ã£o concluÃ­da!
${t.data.total_processados} produtos processados
${t.data.diferencas_encontradas} diferenÃ§as encontradas`,{duration:5e3}),u()}catch(t){n.error(((o=(s=t.response)==null?void 0:s.data)==null?void 0:o.detail)||"Erro ao reconciliar estoques")}finally{d(!1)}},f=l.filter(s=>m==="sincronizados"?s.bling_id:m==="nao_sincronizados"?!s.bling_id:!0),r={total:l.length,sincronizados:l.filter(s=>s.bling_id).length,naoSincronizados:l.filter(s=>!s.bling_id).length};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"ðŸ”„ SincronizaÃ§Ã£o Bling"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie a integraÃ§Ã£o dos produtos com o Bling ERP"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.total}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Produtos"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.sincronizados}),e.jsx("div",{className:"text-sm text-gray-600",children:"Vinculados ao Bling"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:r.naoSincronizados}),e.jsx("div",{className:"text-sm text-gray-600",children:"NÃ£o Vinculados"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[r.total>0?(r.sincronizados/r.total*100).toFixed(1):0,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Taxa de SincronizaÃ§Ã£o"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"âš¡ AÃ§Ãµes RÃ¡pidas"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:q,disabled:b||r.sincronizados===0,className:"flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:b?"â³ Sincronizando...":`ðŸ”„ Sincronizar Todos (${r.sincronizados})`}),e.jsx("button",{onClick:E,disabled:x||r.sincronizados===0,className:"flex-1 bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:x?"â³ Reconciliando...":"ðŸ” Reconciliar Estoques"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-3",children:[e.jsx("strong",{children:"Sincronizar:"})," Atualiza o estoque do Bling com os valores do sistema.",e.jsx("strong",{className:"ml-4",children:"Reconciliar:"})," Compara e identifica diferenÃ§as entre os estoques."]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"ðŸ” Buscar Produtos no Bling"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:y,onChange:s=>B(s.target.value),placeholder:"Digite o nome do produto (deixe vazio para buscar todos)",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",onKeyPress:s=>s.key==="Enter"&&w()}),e.jsx("button",{onClick:w,disabled:x,className:"bg-green-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-green-700 disabled:bg-gray-400",children:x?"â³ Buscando...":"ðŸ” Buscar"})]}),h.length>0&&e.jsxs("div",{className:"mt-4 border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-2 font-semibold border-b",children:[h.length," produtos encontrados no Bling"]}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:h.map(s=>e.jsxs("div",{className:"px-4 py-3 border-b hover:bg-gray-50 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.descricao}),e.jsxs("div",{className:"text-sm text-gray-600",children:["ID Bling: ",s.id," | CÃ³digo: ",s.codigo," | Estoque: ",s.estoque]})]}),e.jsxs("select",{onChange:o=>o.target.value&&S(parseInt(o.target.value),s.id),className:"px-3 py-2 border border-gray-300 rounded text-sm",children:[e.jsx("option",{value:"",children:"Vincular ao produto..."}),l.filter(o=>!o.bling_id).map(o=>e.jsxs("option",{value:o.id,children:[o.codigo," - ",o.nome]},o.id))]})]},s.id))})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>p("todos"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${m==="todos"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Todos (",r.total,")"]}),e.jsxs("button",{onClick:()=>p("sincronizados"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${m==="sincronizados"?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["âœ… Sincronizados (",r.sincronizados,")"]}),e.jsxs("button",{onClick:()=>p("nao_sincronizados"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${m==="nao_sincronizados"?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["âš ï¸ NÃ£o Sincronizados (",r.naoSincronizados,")"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"CÃ³digo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Estoque Local"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"ID Bling"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{children:x&&f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:"â³ Carregando produtos..."})}):f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:"Nenhum produto encontrado com os filtros selecionados"})}):f.map(s=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-mono text-sm",children:s.codigo})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold",children:s.nome}),z(s)&&e.jsx("div",{className:"text-xs text-gray-500",children:z(s)})]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`font-semibold ${(s.estoque_atual||0)<=(s.estoque_minimo||0)?"text-red-600":"text-green-600"}`,children:s.estoque_atual||0})}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.bling_id?e.jsx("span",{className:"inline-block bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-semibold",children:s.bling_id}):e.jsx("span",{className:"text-gray-400 text-sm",children:"â€”"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.bling_id?e.jsx("span",{className:"inline-block bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-semibold",children:"âœ… VINCULADO"}):e.jsx("span",{className:"inline-block bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs font-semibold",children:"âš ï¸ NÃƒO VINCULADO"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.bling_id?e.jsx("button",{onClick:()=>_(s.id),disabled:b,className:"text-blue-600 hover:text-blue-800 font-semibold text-sm disabled:text-gray-400",title:"Sincronizar estoque com Bling",children:"ðŸ”„ Sync"}):e.jsx("span",{className:"text-gray-400 text-sm",children:"â€”"})})]},s.id))})]})})]})};export{P as default};
