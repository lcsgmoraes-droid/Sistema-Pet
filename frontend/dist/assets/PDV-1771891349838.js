import{j as e,r,R as mt,a as ut}from"./vendor-react-1771891349838.js";import{a as P,e as gt,b as pt,u as bt}from"./index-1771891349838.js";import{A as ht}from"./produtos-17718913498382.js";import{v as ft}from"./alertasEstoque-17718913498382.js";import{a3 as ua,ac as $a,ad as Da,X as ue,ae as Na,af as wa,ag as Ne,ah as sa,C as xa,ai as ga,a0 as _a,aj as ea,ak as Rs,al as Ds,a1 as ma,am as jt,a2 as vt,b as Pa,an as Va,ao as Ns,ap as ws,aq as yt,ar as Nt,as as Aa,at as _s,au as wt,B as Ea,w as aa,a8 as _t,x as Ct,av as Ft,G as St,l as As,k as kt,e as $t,h as Et,aw as Rt,c as Ta,ax as Dt,N as At,ay as Tt,t as Pt,s as Vt,E as Mt,J as Cs,a5 as It,L as qt,az as ya,aA as Ts,aB as zt,aC as Fs,aD as Ss,aE as ks,aF as ja,$ as Lt,aG as Ot,aH as Ra,aI as Bt,aJ as Kt}from"./vendor-icons-1771891349838.js";import{a as Qt,b as Ma,o as Ps,f as Ut,c as Ht}from"./caixa-1771891349838.js";import{z as Ae,n as Xe}from"./vendor-utils-1771891349838.js";const $s=async(n={})=>(await P.get("/vendas",{params:n})).data,va=async n=>(await P.get(`/vendas/${n}`)).data,Vs=async n=>(await P.post("/vendas",n)).data,Jt=async(n,C)=>(await P.post(`/vendas/${n}/finalizar`,{pagamentos:C})).data,Gt=async(n={})=>{const C=await P.get("/clientes/",{params:n});return C.data.items||C.data.clientes||C.data||[]},ca=async n=>(await P.get(`/clientes/${n}`)).data,Xt=({status:n,className:C=""})=>{if(!n)return null;const c={verde:{cor:"bg-green-500",borda:"border-green-500",texto:"text-green-700",fundo:"bg-green-50",icone:"‚úÖ",mensagem:"Margem Saud√°vel",descricao:"Venda em condi√ß√µes ideais"},amarelo:{cor:"bg-yellow-500",borda:"border-yellow-500",texto:"text-yellow-700",fundo:"bg-yellow-50",icone:"‚ö†Ô∏è",mensagem:"Margem em Alerta",descricao:"Aten√ß√£o com parcelamento e descontos"},vermelho:{cor:"bg-red-500",borda:"border-red-500",texto:"text-red-700",fundo:"bg-red-50",icone:"üî¥",mensagem:"Margem Cr√≠tica",descricao:"Evite mais descontos ou parcelamentos longos"}},u=c[n]||c.verde;return e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg border ${u.borda} ${u.fundo} ${C}`,children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${u.cor} animate-pulse`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`text-sm font-semibold ${u.texto}`,children:[u.icone," ",u.mensagem]}),e.jsx("div",{className:"text-xs text-gray-600",children:u.descricao})]})]})},Wt=["Visa","Mastercard","Elo","American Express","Hipercard","Outros"];function Yt({venda:n,onClose:C,onConfirmar:c,onVendaAtualizada:u,onAnalisarVenda:s}){var ba;const[g,F]=r.useState([]),[m,b]=r.useState([]),[N,U]=r.useState([]),[h,M]=r.useState([]),[$,E]=r.useState(null),[t,q]=r.useState(null),[R,Q]=r.useState(""),[ae,w]=r.useState(""),[S,I]=r.useState(1),[K,D]=r.useState(""),[re,le]=r.useState(!1),[ce,v]=r.useState(!1),[H,J]=r.useState(""),[z,oe]=r.useState(0),[je,y]=r.useState(!1),[G,me]=r.useState(null),[be,ke]=r.useState(null),[ze,x]=r.useState(!1),[k,_]=r.useState(""),[V,se]=r.useState(""),[A,he]=r.useState({}),[xe,te]=r.useState(!1),[ne,Ve]=r.useState(null),Ee=r.useRef(null);r.useEffect(()=>{(async()=>{try{const f=await P.get("/financeiro/formas-pagamento");U(f.data)}catch(f){console.error("Erro ao carregar formas:",f)}})()},[]),r.useEffect(()=>{(async()=>{try{const f=await P.get("/operadoras-cartao?apenas_ativas=true");M(f.data);const j=f.data.find(O=>O.padrao);j&&E(j)}catch(f){console.error("Erro ao carregar operadoras:",f)}})()},[]),r.useEffect(()=>{(async()=>{var f;if(n.id){v(!0);try{const j=await P.get(`/vendas/${n.id}/pagamentos`);b(j.data.pagamentos||[]),oe(j.data.total_pago||0)}catch(j){console.error("Erro ao buscar pagamentos:",j),((f=j.response)==null?void 0:f.status)!==404&&J("Erro ao carregar pagamentos existentes")}finally{v(!1)}}})()},[n.id,n.status]),r.useEffect(()=>{t!=null&&t.permite_parcelamento&&Ee.current&&setTimeout(()=>{var l;(l=Ee.current)==null||l.scrollIntoView({behavior:"smooth",block:"nearest"})},100)},[t==null?void 0:t.permite_parcelamento]);const ee=n.total,ve=g.reduce((l,f)=>l+f.valor,0)+z,Ce=ee-ve,Te=K?parseFloat(K)-Ce:0,ta=async()=>{var l,f,j;x(!0);try{const O=[{forma_pagamento_id:1,valor:n.total,parcelas:1}],ie=(n.itens||[]).map(de=>({produto_id:de.produto_id,quantidade:de.quantidade,preco_venda:de.preco_unitario||de.preco_venda||0,custo:de.custo||null})),W=await P.post("/formas-pagamento/analisar-venda",{items:ie,formas_pagamento:O,desconto:n.desconto_valor||0,taxa_entrega:((l=n.entrega)==null?void 0:l.taxa_entrega_total)||0});(j=(f=W.data)==null?void 0:f.resultado)!=null&&j.cor_indicador&&(ke(W.data.resultado.cor_indicador),console.log("‚úÖ Status inicial calculado:",W.data.resultado.cor_indicador))}catch(O){console.error("‚ùå Erro ao calcular status inicial:",O),ke(null)}finally{x(!1)}},Ue=async()=>{var l,f,j;if(!(g.length===0&&m.length===0)){x(!0);try{const O=[...m,...g],ie=(n.itens||[]).map(de=>({produto_id:de.produto_id,quantidade:de.quantidade,preco_venda:de.preco_unitario||de.preco_venda||0,custo:de.custo||null})),W=await P.post("/formas-pagamento/analisar-venda",{items:ie,formas_pagamento:O,desconto:n.desconto_valor||0,taxa_entrega:((l=n.entrega)==null?void 0:l.taxa_entrega_total)||0});(j=(f=W.data)==null?void 0:f.resultado)!=null&&j.cor_indicador&&ke(W.data.resultado.cor_indicador)}catch(O){console.error("Erro ao calcular status de margem:",O),ke(null)}finally{x(!1)}}};r.useEffect(()=>{const l=setTimeout(()=>{Ue()},500);return()=>clearTimeout(l)},[g,S]),r.useEffect(()=>{console.log("üé¨ Modal de pagamento aberto - Calculando status inicial..."),ta()},[]),r.useEffect(()=>{if(N&&N.length>0){const l=N.filter(f=>f.permite_parcelamento);l.length>0&&Object.keys(A).length===0&&(console.log("üìä Simulando parcelamentos ao carregar formas..."),L(l[0]))}},[N]);const L=async l=>{var O,ie,W;if(!l||!l.permite_parcelamento){console.log("‚è≠Ô∏è Forma de pagamento inv√°lida ou n√£o permite parcelamento");return}const f=(l==null?void 0:l.parcelas_maximas)??12,j=l.id;console.log(`üé≤ Simulando parcelamentos para ${l.nome} (at√© ${f}x)...`),te(!0);try{const de={},De=(n.itens||[]).map(pe=>({produto_id:pe.produto_id,quantidade:pe.quantidade,preco_venda:pe.preco_unitario||pe.preco_venda||0,custo:pe.custo||null}));for(let pe=1;pe<=f;pe++){const $e=[{forma_pagamento_id:j,valor:n.total,parcelas:pe}];try{const fe=await P.post("/formas-pagamento/analisar-venda",{items:De,formas_pagamento:$e,desconto:n.desconto_valor||0,taxa_entrega:((O=n.entrega)==null?void 0:O.taxa_entrega_total)||0});(W=(ie=fe.data)==null?void 0:ie.resultado)!=null&&W.cor_indicador&&(de[pe]={cor:fe.data.resultado.cor_indicador,classificacao:fe.data.resultado.cor_indicador})}catch(fe){console.error(`Erro ao simular ${pe}x:`,fe),de[pe]={cor:null,classificacao:"verde"}}}he(pe=>({...pe,[j]:de}));const Fe=Re(de,f);Ve(Fe),console.log("‚úÖ Simula√ß√µes conclu√≠das:",de),console.log("üìä Faixas calculadas:",Fe)}catch(de){console.error("‚ùå Erro ao simular parcelamentos:",de)}finally{te(!1)}},Re=(l,f)=>{const j={saudavel:{min:1,max:0},alerta:{min:0,max:0},proibido:{min:0,max:f}};let O=0,ie=f+1;for(let W=1;W<=f;W++){const de=l[W];de&&(de.cor==="verde"?O=W:de.cor==="vermelho"&&W<ie&&(ie=W))}return j.saudavel.max=O,j.alerta.min=O+1,j.alerta.max=ie-1,j.proibido.min=ie,j};r.useEffect(()=>{if(t!=null&&t.permite_parcelamento)if(!A[t.id])L(t);else{const l=A[t.id],f=Re(l,(t==null?void 0:t.parcelas_maximas)??12);Ve(f),console.log("‚ôªÔ∏è Reutilizando simula√ß√£o existente")}else if(!t){const l=Object.keys(A)[0];if(l&&N.length>0){const f=N.find(j=>j.id===parseInt(l));if(f){const j=Re(A[l],(f==null?void 0:f.parcelas_maximas)??12);Ve(j)}}}},[t==null?void 0:t.id]);const Ca=()=>{var ie;if(!t){J("Selecione uma forma de pagamento");return}const l=parseFloat(K)||0;if(l<=0){J("Informe o valor recebido");return}if(t.id==="credito_cliente"&&l>t.credito_disponivel){J(`Valor excede o cr√©dito dispon√≠vel (R$ ${t.credito_disponivel.toFixed(2)})`);return}if(["cartao_credito","cartao_debito"].includes(t.tipo)&&!R){J("Selecione a bandeira do cart√£o");return}if(["cartao_credito","cartao_debito"].includes(t.tipo)&&!$){J("Selecione a operadora do cart√£o");return}if($&&S>$.max_parcelas){J(`A operadora ${$.nome} permite no m√°ximo ${$.max_parcelas}x`);return}console.log("üîç DEBUG formaPagamentoSelecionada:",t);const f={forma_pagamento:t.nome,forma_id:t.id,forma_pagamento_id:t.id,nome:t.nome,valor:Math.min(l,Ce),bandeira:["cartao_credito","cartao_debito"].includes(t.tipo)?R:null,nsu_cartao:["cartao_credito","cartao_debito"].includes(t.tipo)&&ae?ae:null,operadora_id:($==null?void 0:$.id)||null,numero_parcelas:t.permite_parcelamento?S:1,parcelas:t.permite_parcelamento?S:1,valor_recebido:l,troco:t.tipo==="dinheiro"&&Te>0?Te:null,is_credito_cliente:t.nome==="Cr√©dito Cliente"||t.tipo==="credito_cliente"};console.log("üì§ DEBUG novoPagamento:",f);let j="verde";if(t!=null&&t.permite_parcelamento&&A[t.id]){const W=(ie=A[t.id])==null?void 0:ie[S];j=(W==null?void 0:W.cor)??"verde",console.log(`‚ôªÔ∏è Reutilizando simula√ß√£o do backend: ${S}x = cor ${j}`)}if(be==="vermelho"||j==="vermelho"){if(!k||k.trim().length<10){se("‚ö†Ô∏è Justificativa obrigat√≥ria para margem cr√≠tica (m√≠nimo 10 caracteres)"),J("Por favor, preencha a justificativa abaixo");return}const W=n.observacoes?`${n.observacoes}

‚ö†Ô∏è JUSTIFICATIVA (Margem Cr√≠tica): ${k}`:`‚ö†Ô∏è JUSTIFICATIVA (Margem Cr√≠tica): ${k}`;n.observacoes=W}F([...g,f]),q(null),D(""),Q(""),E(h.find(W=>W.padrao)||null),w(""),I(1),J(""),se("")},We=l=>{F(g.filter((f,j)=>j!==l))},Le=async l=>{var f,j;if(confirm("Deseja realmente excluir este pagamento?")){le(!0),J("");try{console.log(`üóëÔ∏è Excluindo pagamento ID ${l}...`),await P.delete(`/vendas/pagamentos/${l}`),console.log("‚úÖ Pagamento exclu√≠do com sucesso!");const O=await P.get(`/vendas/${n.id}/pagamentos`);b(O.data.pagamentos||[]),oe(O.data.total_pago||0),O.data.pagamentos.length===0&&u&&await u(),J("")}catch(O){console.error("‚ùå Erro ao excluir pagamento:",O),console.error("   Response:",O.response),console.error("   Message:",O.message),O.message&&O.message.includes("CORS")?J("‚ö†Ô∏è Erro de CORS: O backend precisa ser reiniciado. Feche e abra novamente o servidor backend."):J(((j=(f=O.response)==null?void 0:f.data)==null?void 0:j.detail)||O.message||"Erro ao excluir pagamento")}finally{le(!1)}}},pa=async()=>{var l,f,j,O,ie,W,de,De;if(g.length===0){J("Adicione pelo menos uma forma de pagamento");return}le(!0),J("");try{const Fe=n.itens.filter(fe=>fe.tipo==="produto"&&fe.produto_id).map(fe=>({produto_id:fe.produto_id,quantidade:fe.quantidade}));if(Fe.length>0){const Y=(await ft(Fe)).data||[];if(Y.length>0){const Me=Y.map(Ie=>`‚Ä¢ ${Ie.produto_nome}: estoque atual ${Ie.estoque_atual}, ap√≥s venda ficar√° ${Ie.estoque_resultante}`).join(`
`);if(!window.confirm(`‚ö†Ô∏è ATEN√á√ÉO: Os seguintes produtos ficar√£o com ESTOQUE NEGATIVO:

${Me}

Deseja continuar mesmo assim?`)){le(!1);return}}}let pe=n.id;if(!pe){const fe=((l=n.entrega)==null?void 0:l.taxa_entrega_total)||0,Y=((f=n.entrega)==null?void 0:f.taxa_loja)||0,Me=((j=n.entrega)==null?void 0:j.taxa_entregador)||0,ra=fe>0?(Y/fe*100).toFixed(2):100,Ie=fe>0?(Me/fe*100).toFixed(2):0;pe=(await Vs({cliente_id:(O=n.cliente)==null?void 0:O.id,funcionario_id:n.funcionario_id,itens:n.itens,desconto_valor:n.desconto_valor,desconto_percentual:n.desconto_percentual,observacoes:n.observacoes,tem_entrega:n.tem_entrega,taxa_entrega:fe,percentual_taxa_loja:parseFloat(ra),percentual_taxa_entregador:parseFloat(Ie),entregador_id:n.entregador_id,endereco_entrega:(ie=n.entrega)==null?void 0:ie.endereco_completo,observacoes_entrega:(W=n.entrega)==null?void 0:W.observacoes_entrega})).id}const $e=await Jt(pe,g);me(pe),($e==null?void 0:$e.status)==="finalizada"||($e==null?void 0:$e.status)==="pago_nf"?y(!0):c()}catch(Fe){console.error("Erro ao finalizar venda:",Fe),J(((De=(de=Fe.response)==null?void 0:de.data)==null?void 0:De.detail)||"Erro ao finalizar venda")}finally{le(!1)}},Pe=async l=>{var f,j;le(!0),J("");try{await P.post("/nfe/emitir",{venda_id:G,tipo_nota:l}),alert(`${l==="nfe"?"NF-e":"NFC-e"} emitida com sucesso!`),c()}catch(O){console.error("Erro ao emitir nota:",O),alert(((j=(f=O.response)==null?void 0:f.data)==null?void 0:j.detail)||"Erro ao emitir nota fiscal. Voc√™ pode emiti-la depois na tela de vendas."),c()}finally{le(!1)}};return je?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(ua,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Venda Finalizada!"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Deseja emitir nota fiscal?"})]})]}),e.jsxs("div",{className:"space-y-3",children:[(ba=n.cliente)!=null&&ba.cnpj?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>Pe("nfe"),disabled:re,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx($a,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NF-e (Empresa)"})]}),e.jsxs("button",{onClick:()=>Pe("nfce"),disabled:re,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx($a,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NFC-e (Cupom)"})]})]}):e.jsxs("button",{onClick:()=>Pe("nfce"),disabled:re,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx($a,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NFC-e"})]}),e.jsx("button",{onClick:c,disabled:re,className:"w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"N√£o emitir agora"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-4",children:"Voc√™ pode emitir a nota fiscal depois na tela de vendas"})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Da,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Registrar Recebimento"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Selecione as formas de pagamento"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!1,e.jsx("button",{onClick:C,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Selecione a forma de pagamento"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.cliente&&n.cliente.credito>0&&e.jsxs("button",{onClick:()=>{q({id:"credito_cliente",nome:"Cr√©dito Cliente",tipo:"credito_cliente",icone:"üéÅ",credito_disponivel:parseFloat(n.cliente.credito)}),I(1),Q(""),w(""),D(Math.min(parseFloat(n.cliente.credito),Ce).toFixed(2))},className:`p-4 rounded-lg border-2 transition-all ${(t==null?void 0:t.id)==="credito_cliente"?"border-purple-500 bg-purple-50":"border-purple-200 bg-purple-50/50 hover:border-purple-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:"üéÅ"}),e.jsx("div",{className:`text-sm font-medium ${(t==null?void 0:t.id)==="credito_cliente"?"text-purple-900":"text-purple-700"}`,children:"Cr√©dito Cliente"}),e.jsxs("div",{className:"text-xs text-purple-600 mt-1 font-semibold",children:["R$ ",parseFloat(n.cliente.credito).toFixed(2).replace(".",",")]})]}),N.map(l=>{const f=(t==null?void 0:t.id)===l.id;return e.jsxs("button",{onClick:()=>{q(l),I(1),Q(""),w("")},className:`p-4 rounded-lg border-2 transition-all ${f?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:l.icone||"üí≥"}),e.jsx("div",{className:`text-sm font-medium ${f?"text-blue-900":"text-gray-700"}`,children:l.nome}),l.taxa_percentual>0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Taxa: ",l.taxa_percentual,"%"]})]},l.id)})]})]}),t&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[t.id==="credito_cliente"&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-800 mb-2",children:[e.jsx(Na,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"Cr√©dito Dispon√≠vel"})]}),e.jsxs("div",{className:"text-lg font-bold text-purple-600",children:["R$ ",t.credito_disponivel.toFixed(2).replace(".",",")]}),e.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"üí° N√£o gera movimenta√ß√£o de caixa"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t.id==="credito_cliente"?"Valor a Utilizar":"Valor Recebido"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:K,onChange:l=>{D(l.target.value)},onBlur:l=>{const f=parseFloat(l.target.value)||0;if(t.id==="credito_cliente"){const j=Math.min(t.credito_disponivel,Ce);f>j&&(D(j.toFixed(2)),J(`Valor ajustado para o cr√©dito dispon√≠vel: R$ ${j.toFixed(2)}`),setTimeout(()=>J(""),3e3))}},placeholder:Ce.toFixed(2),max:t.id==="credito_cliente"?Math.min(t.credito_disponivel,Ce):void 0,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]}),t.id==="credito_cliente"&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["M√°ximo: R$ ",Math.min(t.credito_disponivel,Ce).toFixed(2)]})]}),t.tipo==="dinheiro"&&K&&e.jsx("div",{className:`rounded-lg p-3 ${Te>0?"bg-yellow-50 border border-yellow-200":"bg-gray-100"}`,children:e.jsx("div",{className:"text-sm font-medium",children:e.jsxs("span",{className:Te>0?"text-yellow-800":"text-gray-600",children:["Troco: R$ ",Te.toFixed(2)]})})}),(t==null?void 0:t.tipo)&&["cartao_credito","cartao_debito"].includes(t.tipo)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Operadora *"}),e.jsxs("select",{value:($==null?void 0:$.id)||"",onChange:l=>{const f=h.find(j=>j.id===parseInt(l.target.value));E(f),f&&S>f.max_parcelas&&I(f.max_parcelas)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione a operadora..."}),h.map(l=>e.jsxs("option",{value:l.id,children:[l.nome," (",l.max_parcelas,"x m√°x)"]},l.id))]}),$&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["M√°ximo de ",$.max_parcelas," parcelas"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bandeira"}),e.jsxs("select",{value:R,onChange:l=>Q(l.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),Wt.map(l=>e.jsx("option",{value:l,children:l},l))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["NSU (N√∫mero Sequencial √önico)",e.jsx("span",{className:"text-gray-500 text-xs ml-1",children:"(Opcional - para concilia√ß√£o)"})]}),e.jsx("input",{type:"text",value:ae,onChange:l=>w(l.target.value),placeholder:"Ex: 123456789",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),(t==null?void 0:t.permite_parcelamento)&&e.jsxs("div",{ref:Ee,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"N√∫mero de Parcelas"}),e.jsx("select",{value:S,onChange:l=>I(parseInt(l.target.value)),className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${(()=>{var j;const l=(j=A[t.id])==null?void 0:j[S],f=(l==null?void 0:l.cor)||be||"verde";return f==="verde"?"border-gray-300 bg-white":f==="amarelo"?"border-yellow-400 bg-yellow-50 text-yellow-900":"border-red-400 bg-red-50 text-red-900"})()}`,children:Array.from({length:($==null?void 0:$.max_parcelas)||t.parcelas_maximas||12},(l,f)=>f+1).map(l=>{var W;const f=parseFloat(K)||Ce,j=f/l,O=(W=A[t.id])==null?void 0:W[l],ie=(O==null?void 0:O.cor)||"verde";return e.jsxs("option",{value:l,className:ie==="verde"?"":ie==="amarelo"?"bg-yellow-100 text-yellow-900":"bg-red-100 text-red-900",children:[ie==="vermelho"?"üö´ ":ie==="amarelo"?"‚ö†Ô∏è ":"",l,"x de R$ ",j.toFixed(2)," ",K?`(Total: R$ ${f.toFixed(2)})`:""]},l)})}),K&&S>1&&e.jsxs("div",{className:`mt-2 p-3 border rounded-lg ${(()=>{var j;const l=(j=A[t.id])==null?void 0:j[S],f=(l==null?void 0:l.cor)||be||"verde";return f==="verde"?"bg-blue-50 border-blue-200":f==="amarelo"?"bg-yellow-50 border-yellow-300":"bg-red-50 border-red-300"})()}`,children:[e.jsx("p",{className:`text-sm font-medium ${(()=>{var j;const l=(j=A[t.id])==null?void 0:j[S],f=(l==null?void 0:l.cor)||be||"verde";return f==="verde"?"text-blue-800":f==="amarelo"?"text-yellow-800":"text-red-800"})()}`,children:(()=>{var j;const l=(j=A[t.id])==null?void 0:j[S],f=(l==null?void 0:l.cor)||be||"verde";return e.jsxs(e.Fragment,{children:[f==="vermelho"&&"üö´ ",f==="amarelo"&&"‚ö†Ô∏è ","üí≥ ",S,"x de R$ ",(parseFloat(K)/S).toFixed(2)]})})()}),e.jsxs("p",{className:`text-xs mt-1 ${(()=>{var j;const l=(j=A[t.id])==null?void 0:j[S],f=(l==null?void 0:l.cor)||be||"verde";return f==="verde"?"text-blue-600":f==="amarelo"?"text-yellow-700":"text-red-700"})()}`,children:["Valor total parcelado: R$ ",parseFloat(K).toFixed(2),(()=>{var j;const l=(j=A[t.id])==null?void 0:j[S],f=(l==null?void 0:l.cor)||be||"verde";return f==="amarelo"?" - Requer aten√ß√£o":f==="vermelho"?" - Requer justificativa":""})()]})]})]}),e.jsx("button",{onClick:Ca,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Adicionar Pagamento"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Resumo da Venda"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total da Venda:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",ee.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Valor Pago:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",ve.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-blue-600 text-lg font-semibold border-t pt-3",children:[e.jsx("span",{children:"Restante:"}),e.jsxs("span",{children:["R$ ",Ce.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Formas de Pagamento"}),m.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-600 mb-2",children:["üí∞ Pagamentos Registrados (",m.length,")"]}),e.jsx("div",{className:"space-y-2",children:m.map((l,f)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:l.forma_pagamento==="dinheiro"?"üíµ Dinheiro":l.forma_pagamento==="pix"?"üì± PIX":l.forma_pagamento==="credito"?"üí≥ Cart√£o de Cr√©dito":l.forma_pagamento==="debito"?"üí≥ Cart√£o de D√©bito":l.forma_pagamento==="boleto"?"üìÑ Boleto":l.forma_pagamento}),e.jsxs("span",{className:"px-2 py-0.5 bg-green-200 text-green-800 text-xs rounded-full font-medium",children:["Pagamento ",f+1]})]}),l.bandeira&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Bandeira: ",l.bandeira]}),l.nsu_cartao&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1 font-mono",children:["üî¢ NSU: ",l.nsu_cartao]}),l.numero_parcelas&&l.numero_parcelas>1&&e.jsxs("div",{className:"text-sm text-blue-600 mt-1 font-medium",children:["üî¢ Parcelado em ",l.numero_parcelas,"x de R$ ",(parseFloat(l.valor)/l.numero_parcelas).toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["üìÖ ",new Date(l.data_pagamento).toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-green-700 text-lg",children:["R$ ",parseFloat(l.valor).toFixed(2)]}),l.troco&&parseFloat(l.troco)>0&&e.jsxs("div",{className:"text-xs text-yellow-600",children:["Troco: R$ ",parseFloat(l.troco).toFixed(2)]})]}),e.jsx("button",{onClick:()=>Le(l.id),disabled:re,className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors disabled:opacity-50",title:"Excluir pagamento",children:e.jsx(wa,{className:"w-4 h-4"})})]})]},l.id))})]}),g.length===0&&m.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400 bg-gray-50 rounded-lg border-2 border-dashed",children:[e.jsx(Na,{className:"w-12 h-12 mx-auto mb-2 opacity-40"}),e.jsx("p",{className:"text-sm font-medium",children:"Nenhuma forma de pagamento adicionada"}),e.jsx("p",{className:"text-xs mt-1",children:"Selecione uma forma acima para come√ßar"})]}):g.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 mb-2",children:"‚è≥ Novos Pagamentos (a confirmar)"}),e.jsx("div",{className:"space-y-3",children:g.map((l,f)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:l.nome}),e.jsx("span",{className:"px-2 py-0.5 bg-blue-200 text-blue-800 text-xs rounded-full font-medium",children:"Novo"})]}),l.bandeira&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Bandeira: ",l.bandeira]}),l.nsu_cartao&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1 font-mono",children:["üî¢ NSU: ",l.nsu_cartao]}),l.numero_parcelas>1&&e.jsxs("div",{className:"text-sm text-blue-600 mt-1 font-medium",children:["üî¢ ",l.numero_parcelas,"x de R$ ",(l.valor/l.numero_parcelas).toFixed(2)]}),l.troco&&l.troco>0&&e.jsxs("div",{className:"text-sm text-yellow-600 mt-1",children:["üíµ Troco: R$ ",l.troco.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"font-semibold text-blue-700 text-lg",children:["R$ ",l.valor.toFixed(2)]}),e.jsx("button",{onClick:()=>We(f),className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors",title:"Remover",children:e.jsx(ue,{className:"w-5 h-5"})})]})]},f))})]}):null]}),be&&e.jsx(Xt,{status:be,loading:ze}),ne&&Object.keys(A).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center space-x-2",children:[e.jsx("span",{className:"text-xl",children:"üìä"}),e.jsx("span",{children:"Parcelamento Recomendado"})]}),xe?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin inline-block w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full"}),e.jsx("p",{className:"text-sm text-blue-700 mt-2",children:"Analisando op√ß√µes..."})]}):e.jsxs("div",{className:"space-y-2",children:[ne.saudavel.max>0&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-green-100 border border-green-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"üü¢"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-green-900",children:[ne.saudavel.min===ne.saudavel.max?`${ne.saudavel.max}x`:`${ne.saudavel.min}x a ${ne.saudavel.max}x`,e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- Saud√°vel"})]}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"Margem adequada, sem restri√ß√µes"})]})]}),ne.alerta.max>=ne.alerta.min&&ne.alerta.min>0&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-yellow-100 border border-yellow-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"üü°"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-yellow-900",children:[ne.alerta.min===ne.alerta.max?`${ne.alerta.max}x`:`${ne.alerta.min}x a ${ne.alerta.max}x`,e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- Aten√ß√£o"})]}),e.jsx("div",{className:"text-xs text-yellow-700 mt-1",children:"Margem pr√≥xima ao m√≠nimo, evite se poss√≠vel"})]})]}),ne.proibido.min<=((t==null?void 0:t.parcelas_maximas)??12)&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-red-100 border border-red-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"üî¥"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-red-900",children:[ne.proibido.min,"x ou mais",e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- Exige justificativa"})]}),e.jsx("div",{className:"text-xs text-red-700 mt-1",children:"Margem cr√≠tica, justificativa obrigat√≥ria"})]})]})]})]}),(()=>{var O,ie;let l="verde";return t!=null&&t.permite_parcelamento&&((O=A[t.id])!=null&&O[S])&&(l=((ie=A[t.id][S])==null?void 0:ie.cor)??"verde"),be==="vermelho"||l==="vermelho"||k&&k.trim().length>0?e.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-3",children:[e.jsx(Ne,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-red-900",children:"‚ö†Ô∏è Justificativa Obrigat√≥ria"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Esta venda tem margem cr√≠tica. Informe o motivo para prosseguir."})]})]}),e.jsx("textarea",{value:k,onChange:W=>{_(W.target.value),W.target.value.trim().length>=10&&se("")},placeholder:"Ex: Cliente especial, promo√ß√£o de lan√ßamento, acordo comercial...",className:`w-full px-3 py-2 border-2 rounded-lg focus:ring-2 focus:ring-red-500 resize-none ${V?"border-red-500":"border-red-300"}`,rows:3}),V&&e.jsx("p",{className:"text-xs text-red-700 font-medium mt-2",children:V}),e.jsx("p",{className:"text-xs text-red-600 mt-2",children:"üí° M√≠nimo 10 caracteres"})]}):null})()]})]})}),e.jsxs("div",{className:"border-t p-6 bg-gray-50",children:[H&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(Ne,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:H})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:C,disabled:re,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:pa,disabled:re||g.length===0,className:"flex items-center space-x-2 px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:re?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ua,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"})]})})]})]})]})})}function Zt({onClose:n,onSucesso:C}){const[c,u]=r.useState(""),[s,g]=r.useState(""),[F,m]=r.useState(""),[b,N]=r.useState({n2:0,n5:0,n10:0,n20:0,n50:0,n100:0,n200:0,moedas:0}),[U,h]=r.useState(!1),[M,$]=r.useState(!1),[E,t]=r.useState(""),q=()=>b.n200*200+b.n100*100+b.n50*50+b.n20*20+b.n10*10+b.n5*5+b.n2*2+parseFloat(b.moedas||0),R=()=>{const w=q();u(w.toFixed(2)),h(!1)},Q=()=>{N({n2:0,n5:0,n10:0,n20:0,n50:0,n100:0,n200:0,moedas:0})},ae=async()=>{var S,I;const w=parseFloat(c);if(!w||w<0){t("Informe um valor v√°lido para abertura");return}$(!0),t("");try{await Qt({valor_abertura:w,conta_origem_nome:s||"Dinheiro em m√£os",observacoes_abertura:F}),C()}catch(K){console.error("Erro ao abrir caixa:",K),t(((I=(S=K.response)==null?void 0:S.data)==null?void 0:I.detail)||"Erro ao abrir caixa")}finally{$(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(sa,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Abrir Caixa"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Informe o valor inicial do caixa"})]})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor de Abertura *"}),e.jsxs("button",{type:"button",onClick:()=>h(!U),className:"flex items-center space-x-1 px-3 py-1.5 text-sm bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 rounded-lg transition-colors",children:[e.jsx(xa,{className:"w-4 h-4"}),e.jsx("span",{children:"Auxiliar Contagem"})]})]}),U&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-xl p-5 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center",children:[e.jsx(xa,{className:"w-5 h-5 mr-2 text-blue-600"}),"Auxiliar de Contagem"]}),e.jsx("button",{onClick:()=>h(!1),className:"p-1 hover:bg-blue-100 rounded-lg transition-colors",type:"button",children:e.jsx(ue,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-gray-200 hover:border-gray-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-gray-500 to-gray-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 2"}),e.jsx("input",{type:"number",min:"0",value:b.n2,onChange:w=>N({...b,n2:parseInt(w.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-gray-500 focus:ring-2 focus:ring-gray-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-gray-600",children:["R$ ",(b.n2*2).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-purple-200 hover:border-purple-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 5"}),e.jsx("input",{type:"number",min:"0",value:b.n5,onChange:w=>N({...b,n5:parseInt(w.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-purple-600",children:["R$ ",(b.n5*5).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-red-200 hover:border-red-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-red-500 to-red-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 10"}),e.jsx("input",{type:"number",min:"0",value:b.n10,onChange:w=>N({...b,n10:parseInt(w.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-red-500 focus:ring-2 focus:ring-red-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-red-600",children:["R$ ",(b.n10*10).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-yellow-200 hover:border-yellow-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-yellow-500 to-yellow-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 20"}),e.jsx("input",{type:"number",min:"0",value:b.n20,onChange:w=>N({...b,n20:parseInt(w.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-yellow-600",children:["R$ ",(b.n20*20).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-blue-200 hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 50"}),e.jsx("input",{type:"number",min:"0",value:b.n50,onChange:w=>N({...b,n50:parseInt(w.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:["R$ ",(b.n50*50).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-green-200 hover:border-green-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-green-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 100"}),e.jsx("input",{type:"number",min:"0",value:b.n100,onChange:w=>N({...b,n100:parseInt(w.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-green-500 focus:ring-2 focus:ring-green-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",(b.n100*100).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-orange-200 hover:border-orange-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 200"}),e.jsx("input",{type:"number",min:"0",value:b.n200,onChange:w=>N({...b,n200:parseInt(w.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["R$ ",(b.n200*200).toFixed(2)]})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t-2 border-blue-300",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-amber-200 hover:border-amber-400 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-amber-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"üí∞ Moedas"})}),e.jsxs("span",{className:"text-lg font-bold text-amber-600",children:["R$ ",parseFloat(b.moedas||0).toFixed(2)]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:b.moedas,onChange:w=>N({...b,moedas:parseFloat(w.target.value)||0}),className:"w-full px-4 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200",placeholder:"0.00"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl p-4 mb-4 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-semibold text-sm",children:"TOTAL CONTADO"}),e.jsxs("span",{className:"text-3xl font-bold text-white",children:["R$ ",q().toFixed(2)]})]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:Q,className:"flex-1 px-4 py-3 border-2 border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-semibold transition-colors",children:"üóëÔ∏è Limpar"}),e.jsx("button",{type:"button",onClick:R,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg font-semibold shadow-md transition-colors",children:"‚úì Aplicar"})]})]}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:c,onChange:w=>u(w.target.value),placeholder:"0,00",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-lg font-semibold",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conta de Origem"}),e.jsxs("select",{value:s,onChange:w=>g(w.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Dinheiro em m√£os",children:"Dinheiro em m√£os"}),e.jsx("option",{value:"Caixa geral",children:"Caixa geral"}),e.jsx("option",{value:"Banco",children:"Banco"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes (opcional)"}),e.jsx("textarea",{value:F,onChange:w=>m(w.target.value),rows:3,placeholder:"Ex: Troco do dia anterior...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"border-t p-6 bg-gray-50",children:[E&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(Ne,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:E})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:n,disabled:M,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:ae,disabled:M||!c,className:"px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:M?"Abrindo...":"Abrir Caixa"})]})]})]})})}function er({caixaId:n,onClose:C,onSucesso:c}){const[u,s]=r.useState(""),[g,F]=r.useState(""),[m,b]=r.useState(""),[N,U]=r.useState(!1),[h,M]=r.useState(""),$=async()=>{var t,q;const E=parseFloat(u);if(!E||E<=0){M("Informe um valor v√°lido");return}U(!0);try{await Ma(n,{tipo:"suprimento",valor:E,forma_pagamento:"Dinheiro",conta_origem_nome:g||"N√£o informado",descricao:m}),c()}catch(R){M(((q=(t=R.response)==null?void 0:t.data)==null?void 0:q.detail)||"Erro ao adicionar suprimento")}finally{U(!1)}};return e.jsx(Ia,{titulo:"Suprimento para o caixa",icone:ga,corIcone:"green",onClose:C,erro:h,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conta de origem*"}),e.jsxs("select",{value:g,onChange:E=>F(E.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Dinheiro em m√£os",children:"Dinheiro em m√£os"}),e.jsx("option",{value:"Caixa geral",children:"Caixa geral"}),e.jsx("option",{value:"Banco",children:"Banco"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:u,onChange:E=>s(E.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descri√ß√£o*"}),e.jsx("textarea",{value:m,onChange:E=>b(E.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Motivo do suprimento..."})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:C,disabled:N,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:$,disabled:N,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors",children:N?"Salvando...":"Salvar"})]})]})})}function ar({caixaId:n,saldoAtual:C,onClose:c,onSucesso:u}){const[s,g]=r.useState(""),[F,m]=r.useState(""),[b,N]=r.useState(""),[U,h]=r.useState(!1),[M,$]=r.useState(""),E=async()=>{var q,R;const t=parseFloat(s);if(!t||t<=0){$("Informe um valor v√°lido");return}h(!0);try{await Ma(n,{tipo:"sangria",valor:t,forma_pagamento:"Dinheiro",conta_destino_nome:F||"N√£o informado",descricao:b}),u()}catch(Q){$(((R=(q=Q.response)==null?void 0:q.data)==null?void 0:R.detail)||"Erro ao adicionar sangria")}finally{h(!1)}};return e.jsx(Ia,{titulo:"Sangria no caixa",icone:_a,corIcone:"orange",onClose:c,erro:M,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Em caixa:"})," R$ ",C.toFixed(2)]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor da Sangria*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:s,onChange:t=>g(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecione a conta de destino*"}),e.jsxs("select",{value:F,onChange:t=>m(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Cofre",children:"Cofre"}),e.jsx("option",{value:"Banco",children:"Banco"}),e.jsx("option",{value:"Outro caixa",children:"Outro caixa"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descri√ß√£o"}),e.jsx("textarea",{value:b,onChange:t=>N(t.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Motivo da sangria..."})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:c,disabled:U,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:E,disabled:U,className:"flex-1 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors",children:U?"Salvando...":"Salvar"})]})]})})}function sr({caixaId:n,onClose:C,onSucesso:c}){const[u,s]=r.useState(""),[g,F]=r.useState(""),[m,b]=r.useState(""),[N,U]=r.useState("Dinheiro"),[h,M]=r.useState(""),[$,E]=r.useState(""),[t,q]=r.useState(!1),[R,Q]=r.useState(""),ae=["√Ågua e Luz","Aluguel","Telefone/Internet","Material de Limpeza","Material de Escrit√≥rio","Manuten√ß√£o","Outros"],w=async()=>{var I,K;const S=parseFloat(m);if(!S||S<=0){Q("Informe um valor v√°lido");return}if(!u){Q("Selecione uma categoria");return}q(!0);try{await Ma(n,{tipo:"despesa",valor:S,categoria:u,descricao:g,forma_pagamento:N,fornecedor_nome:h,documento:$}),c()}catch(D){Q(((K=(I=D.response)==null?void 0:I.data)==null?void 0:K.detail)||"Erro ao adicionar despesa")}finally{q(!1)}};return e.jsx(Ia,{titulo:"Despesa no caixa",icone:ea,corIcone:"red",onClose:C,erro:R,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categoria*"}),e.jsxs("select",{value:u,onChange:S=>s(S.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),ae.map(S=>e.jsx("option",{value:S,children:S},S))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descri√ß√£o*"}),e.jsx("input",{type:"text",value:g,onChange:S=>F(S.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Ex: Conta de luz - Janeiro"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de pagamento*"}),e.jsxs("select",{value:N,onChange:S=>U(S.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Dinheiro",children:"Dinheiro"}),e.jsx("option",{value:"PIX",children:"PIX"}),e.jsx("option",{value:"Cart√£o de Cr√©dito",children:"Cart√£o de Cr√©dito"}),e.jsx("option",{value:"Cart√£o de D√©bito",children:"Cart√£o de D√©bito"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:m,onChange:S=>b(S.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fornecedor"}),e.jsx("input",{type:"text",value:h,onChange:S=>M(S.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Documento / NF"}),e.jsx("input",{type:"text",value:$,onChange:S=>E(S.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:C,disabled:t,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:w,disabled:t,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:t?"Salvando...":"Salvar"})]})]})})}function Ia({titulo:n,icone:C,corIcone:c,children:u,onClose:s,erro:g}){const F={green:"bg-green-100 text-green-600",orange:"bg-orange-100 text-orange-600",red:"bg-red-100 text-red-600",blue:"bg-blue-100 text-blue-600",purple:"bg-purple-100 text-purple-600"};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-12 h-12 ${F[c]} rounded-full flex items-center justify-center`,children:e.jsx(C,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:n})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[g&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(Ne,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:g})]}),u]})]})})}function tr({caixaId:n,onClose:C,onSuccess:c}){const[u,s]=r.useState(null),[g,F]=r.useState(""),[m,b]=r.useState(""),[N,U]=r.useState(!0),[h,M]=r.useState(!1),[$,E]=r.useState(!1),[t,q]=r.useState({n100:0,n50:0,n20:0,n10:0,n5:0,n2:0,moedas:0});r.useEffect(()=>{R()},[n]);const R=async()=>{try{const D=await Ps(n);console.log("üìä Resumo do caixa recebido:",D),console.log("üìä vendas_por_forma_pagamento:",D.vendas_por_forma_pagamento),s(D),F(D.totais.saldo_atual.toFixed(2))}catch(D){console.error("Erro ao carregar resumo:",D),alert("Erro ao carregar dados do caixa")}finally{U(!1)}},Q=()=>!u||!g?0:parseFloat(g)-u.totais.saldo_atual,ae=()=>t.n100*100+t.n50*50+t.n20*20+t.n10*10+t.n5*5+t.n2*2+parseFloat(t.moedas||0),w=()=>{const D=ae();F(D.toFixed(2)),E(!1)},S=()=>{q({n100:0,n50:0,n20:0,n10:0,n5:0,n2:0,moedas:0})},I=async()=>{var re,le;if(!g){alert("Informe o valor contado no caixa");return}const D=Q();if(!(Math.abs(D)>.01&&!window.confirm(`Diferen√ßa de R$ ${Math.abs(D).toFixed(2)} ${D>0?"a mais":"a menos"}

Deseja continuar com o fechamento?`))){M(!0);try{await Ut(n,{valor_informado:parseFloat(g),observacoes_fechamento:m||null}),alert("Caixa fechado com sucesso!"),c(),C()}catch(ce){console.error("Erro ao fechar caixa:",ce),alert(((le=(re=ce.response)==null?void 0:re.data)==null?void 0:le.detail)||"Erro ao fechar caixa")}finally{M(!1)}}};if(N)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})});if(!u)return null;const K=Q();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-red-600 to-orange-600 text-white p-6 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center",children:[e.jsx(ea,{className:"w-7 h-7 mr-3"}),"Fechar Caixa"]}),e.jsxs("p",{className:"text-red-100 mt-1",children:["Caixa #",u.caixa.numero_caixa," - ",u.caixa.usuario_nome]})]}),e.jsx("button",{onClick:C,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-6 border-2 border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center",children:[e.jsx(xa,{className:"w-5 h-5 mr-2 text-gray-700"}),"Resumo do Movimento"]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Valor de Abertura"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",u.caixa.valor_abertura.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(u.caixa.data_abertura).toLocaleString("pt-BR")})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-green-700 mb-1",children:[e.jsx(ea,{className:"w-4 h-4 mr-1"}),"Entradas"]}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["+ R$ ",u.totais.vendas.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Movimento de entrada"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-blue-700 mb-1",children:[e.jsx(ga,{className:"w-4 h-4 mr-1"}),"Suprimentos"]}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["+ R$ ",u.totais.suprimentos.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-orange-700 mb-1",children:[e.jsx(_a,{className:"w-4 h-4 mr-1"}),"Sangrias"]}),e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["- R$ ",u.totais.sangrias.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-red-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-red-700 mb-1",children:[e.jsx(sa,{className:"w-4 h-4 mr-1"}),"Despesas"]}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["- R$ ",u.totais.despesas.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900",children:"Valor Contado no Caixa *"}),e.jsxs("button",{type:"button",onClick:()=>E(!$),className:"flex items-center space-x-1 px-3 py-1.5 text-sm bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors border border-blue-200",title:"Auxiliar na contagem de notas",children:[e.jsx(xa,{className:"w-4 h-4"}),e.jsx("span",{children:"Auxiliar Contagem"})]})]}),$&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-xl p-5 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center",children:[e.jsx(xa,{className:"w-5 h-5 mr-2 text-blue-600"}),"Auxiliar de Contagem"]}),e.jsx("button",{onClick:()=>E(!1),className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-gray-200 hover:border-gray-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-gray-500 to-gray-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 2"}),e.jsx("input",{type:"number",min:"0",value:t.n2,onChange:D=>q({...t,n2:parseInt(D.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-gray-500 focus:ring-2 focus:ring-gray-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-gray-600",children:["R$ ",(t.n2*2).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-purple-200 hover:border-purple-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 5"}),e.jsx("input",{type:"number",min:"0",value:t.n5,onChange:D=>q({...t,n5:parseInt(D.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-purple-600",children:["R$ ",(t.n5*5).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-red-200 hover:border-red-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-red-500 to-red-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 10"}),e.jsx("input",{type:"number",min:"0",value:t.n10,onChange:D=>q({...t,n10:parseInt(D.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-red-500 focus:ring-2 focus:ring-red-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-red-600",children:["R$ ",(t.n10*10).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-yellow-200 hover:border-yellow-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-yellow-500 to-yellow-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 20"}),e.jsx("input",{type:"number",min:"0",value:t.n20,onChange:D=>q({...t,n20:parseInt(D.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-yellow-600",children:["R$ ",(t.n20*20).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-blue-200 hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 50"}),e.jsx("input",{type:"number",min:"0",value:t.n50,onChange:D=>q({...t,n50:parseInt(D.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:["R$ ",(t.n50*50).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-green-200 hover:border-green-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-green-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 100"}),e.jsx("input",{type:"number",min:"0",value:t.n100,onChange:D=>q({...t,n100:parseInt(D.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-green-500 focus:ring-2 focus:ring-green-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",(t.n100*100).toFixed(2)]})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t-2 border-blue-300",children:e.jsx("div",{className:"bg-white rounded-lg p-4 border-2 border-amber-200 hover:border-amber-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-amber-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"üí∞ Moedas"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:t.moedas,onChange:D=>q({...t,moedas:parseFloat(D.target.value)||0}),className:"w-32 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200",placeholder:"0.00"})]}),e.jsxs("span",{className:"text-lg font-bold text-amber-600",children:["R$ ",(t.moedas||0).toFixed(2)]})]})})}),e.jsxs("div",{className:"mt-5 pt-5 border-t-2 border-blue-300",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl p-4 mb-4 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-semibold text-sm",children:"TOTAL CONTADO"}),e.jsxs("span",{className:"text-3xl font-bold text-white",children:["R$ ",ae().toFixed(2)]})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:S,className:"flex-1 px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-semibold transition-colors",children:"üóëÔ∏è Limpar"}),e.jsx("button",{type:"button",onClick:w,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 font-bold shadow-md transition-all",children:"‚úì Aplicar"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(sa,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:g,onChange:D=>F(D.target.value),className:"w-full pl-10 pr-4 py-3 text-lg font-semibold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",autoFocus:!0})]}),g&&Math.abs(K)>.01&&e.jsx("div",{className:`mt-3 p-4 rounded-lg border-2 ${K>0?"bg-blue-50 border-blue-300":"bg-yellow-50 border-yellow-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-semibold text-gray-900",children:[K>0?"Sobra":"Falta",":"]}),e.jsxs("span",{className:`text-xl font-bold ${K>0?"text-blue-600":"text-yellow-700"}`,children:["R$ ",Math.abs(K).toFixed(2)]})]})}),g&&Math.abs(K)<=.01&&e.jsx("div",{className:"mt-3 p-4 rounded-lg border-2 bg-green-50 border-green-300",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-green-700 font-semibold",children:[e.jsx("span",{className:"text-2xl",children:"‚úì"}),e.jsx("span",{children:"Caixa conferido - Valores corretos!"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Observa√ß√µes (opcional)"}),e.jsx("textarea",{value:m,onChange:D=>b(D.target.value),placeholder:"Adicione observa√ß√µes sobre o fechamento...",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),u.vendas_por_forma_pagamento&&Object.keys(u.vendas_por_forma_pagamento).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center",children:[e.jsx(ea,{className:"w-4 h-4 mr-1.5 text-blue-600"}),"Vendas por Forma de Pagamento (Informativo)"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(u.vendas_por_forma_pagamento).map(([D,re])=>{const le=D==="Dinheiro";return e.jsx("div",{className:`bg-white rounded-lg p-3 border ${le?"border-green-300 bg-green-50":"border-gray-200"} hover:shadow-sm transition-shadow cursor-pointer`,title:"Clique para ver detalhes das vendas",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${D==="Dinheiro"?"bg-green-500":D==="PIX"?"bg-purple-500":D.includes("D√©bito")?"bg-blue-500":D.includes("Cr√©dito")?"bg-orange-500":"bg-gray-400"}`}),e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:D}),le&&e.jsx("span",{className:"text-xs bg-green-600 text-white px-1.5 py-0.5 rounded",children:"CAIXA"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[re.quantidade," venda",re.quantidade!==1?"s":""]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:["R$ ",re.total.toFixed(2)]})})]})},D)})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200 text-xs text-gray-600",children:["üí° ",e.jsx("strong",{children:"Dica:"})," Apenas ",e.jsx("strong",{children:"Dinheiro"})," afeta o saldo f√≠sico do caixa. Demais formas v√£o para banco/financeiro."]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:C,disabled:h,className:"px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),e.jsx("button",{onClick:I,disabled:h||!g,className:"px-8 py-3 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white rounded-lg font-bold transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Fechando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ea,{className:"w-5 h-5"}),e.jsx("span",{children:"Fechar Caixa"})]})})]})]})]})})}function rr({caixaId:n,onClose:C,onSucesso:c}){var ze;const[u,s]=r.useState(1),[g,F]=r.useState([]),[m,b]=r.useState(null),[N,U]=r.useState({}),[h,M]=r.useState({}),[$,E]=r.useState(""),[t,q]=r.useState(!1),[R,Q]=r.useState(!1),[ae,w]=r.useState(""),[S,I]=r.useState({}),[K,D]=r.useState({}),[re,le]=r.useState({}),[ce,v]=r.useState({busca:"",data_inicio:"",data_fim:"",status:"finalizada"});r.useEffect(()=>{H()},[ce]);const H=async()=>{Q(!0),w("");try{const x={per_page:50,...ce},k=await P.get("/vendas",{params:x});F(k.data.vendas||[])}catch(x){console.error("Erro ao buscar vendas:",x),w("Erro ao carregar vendas")}finally{Q(!1)}},J=async x=>{var k,_;Q(!0),w("");try{const V=await P.get(`/vendas/${x.id}`);b(V.data);const se={};V.data.itens.forEach(A=>{se[A.id]=A.quantidade}),M(se),s(2)}catch(V){console.error("Erro ao buscar venda:",V),w(((_=(k=V.response)==null?void 0:k.data)==null?void 0:_.detail)||"Erro ao carregar detalhes da venda")}finally{Q(!1)}},z=x=>{const k=N[x];U(_=>({..._,[x]:!_[x]})),k&&(I(_=>{const V={..._};return delete V[x],V}),D(_=>{const V={..._};return delete V[x],V}),le(_=>{const V={..._};return delete V[x],V}))},oe=(x,k)=>{const V=m.itens.find(A=>A.id===x).quantidade,se=Math.min(Math.max(0,parseFloat(k)||0),V);M(A=>({...A,[x]:se}))},je=x=>x.tipo_produto==="KIT"&&x.composicao_kit&&x.composicao_kit.length>0,y=(x,k)=>{if(I(_=>({..._,[x]:k})),k==="componentes"){const _=m.itens.find(V=>V.id===x);if(_&&_.composicao_kit){const V={},se={};_.composicao_kit.forEach((A,he)=>{V[he]=!1,se[he]=A.quantidade*_.quantidade}),D(A=>({...A,[x]:V})),le(A=>({...A,[x]:se}))}}},G=(x,k)=>{D(_=>{var V;return{..._,[x]:{..._[x]||{},[k]:!((V=_[x])!=null&&V[k])}}})},me=(x,k,_)=>{const V=m.itens.find(xe=>xe.id===x),A=V.composicao_kit[k].quantidade*V.quantidade,he=Math.min(Math.max(0,parseFloat(_)||0),A);le(xe=>({...xe,[x]:{...xe[x]||{},[k]:he}}))},be=async()=>{var V,se;if(Object.keys(N).filter(A=>N[A]).filter(A=>{const he=m.itens.find(xe=>xe.id===parseInt(A));return je(he)&&!S[A]}).length>0){w("Para itens KIT, voc√™ deve escolher entre devolver o KIT inteiro ou selecionar componentes");return}const k=[];if(Object.keys(N).filter(A=>N[A]).forEach(A=>{const he=parseInt(A),xe=m.itens.find(te=>te.id===he);if(je(xe)){const te=S[A];if(te==="kit_inteiro")k.push({item_id:he,quantidade:h[A]});else if(te==="componentes"){const ne=K[A]||{},Ve=re[A]||{},Ee=Object.keys(ne).filter(ee=>ne[ee]).map(ee=>parseInt(ee));if(Ee.length===0){w(`Voc√™ deve selecionar pelo menos um componente do KIT "${xe.produto_nome}"`);return}Ee.forEach(ee=>{const ve=xe.composicao_kit[ee],Ce=Ve[ee]||0;if(Ce<=0){w(`Quantidade do componente "${ve.produto_nome}" deve ser maior que zero`);return}k.push({produto_id:ve.produto_id,quantidade:Ce,preco_unitario:xe.preco_unitario/xe.composicao_kit.reduce((Te,ta)=>Te+ta.quantidade,0)*ve.quantidade,is_componente_kit:!0,kit_item_id:he})})}}else k.push({item_id:he,quantidade:h[A]})}),k.length===0){w("Selecione pelo menos um item para devolu√ß√£o");return}if(k.some(A=>A.quantidade<=0)){w("Todas as quantidades devem ser maiores que zero");return}if(!$.trim()){w("Informe o motivo da devolu√ß√£o");return}Q(!0),w("");try{await P.post(`/vendas/${m.id}/devolucao`,{caixa_id:n,itens:k,motivo:$,gerar_credito:t}),alert("Devolu√ß√£o registrada com sucesso!"),c()}catch(A){console.error("Erro ao registrar devolu√ß√£o:",A),w(((se=(V=A.response)==null?void 0:V.data)==null?void 0:se.detail)||"Erro ao registrar devolu√ß√£o")}finally{Q(!1)}},ke=()=>{if(!m)return 0;let x=0;return Object.keys(N).filter(k=>N[k]).forEach(k=>{const _=m.itens.find(V=>V.id===parseInt(k));if(je(_)){const V=S[k];if(V==="kit_inteiro"){const se=h[k]||0;x+=_.preco_unitario*se}else if(V==="componentes"){const se=K[k]||{},A=re[k]||{},he=_.composicao_kit.reduce((xe,te)=>xe+te.quantidade,0);Object.keys(se).filter(xe=>se[xe]).forEach(xe=>{const te=_.composicao_kit[xe],ne=A[xe]||0,Ve=_.preco_unitario/he*te.quantidade,Ee=ne/te.quantidade;x+=Ve*Ee})}}else{const V=h[k]||0;x+=_.preco_unitario*V}}),x};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(Rs,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Devolu√ß√£o"}),e.jsx("p",{className:"text-sm text-gray-500",children:u===1?"Selecione a venda":"Selecionar itens para devolu√ß√£o"})]})]}),e.jsx("button",{onClick:C,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[u===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar"}),e.jsx("input",{type:"text",value:ce.busca,onChange:x=>v({...ce,busca:x.target.value}),placeholder:"N√∫mero da venda, cliente...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data In√≠cio"}),e.jsx("input",{type:"date",value:ce.data_inicio,onChange:x=>v({...ce,data_inicio:x.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Fim"}),e.jsx("input",{type:"date",value:ce.data_fim,onChange:x=>v({...ce,data_fim:x.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})}),R?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando vendas..."})]}):g.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(Ne,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Nenhuma venda encontrada"})]}):e.jsx("div",{className:"space-y-2",children:g.map(x=>{var k;return e.jsx("button",{onClick:()=>J(x),className:"w-full text-left p-4 border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:["Venda #",x.numero_venda||x.id]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Cliente: ",((k=x.cliente)==null?void 0:k.nome)||"Consumidor Final"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:x.data_criacao?new Date(x.data_criacao).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Data n√£o dispon√≠vel"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold text-green-600",children:["R$ ",x.total.toFixed(2)]}),e.jsx("div",{className:`text-xs mt-1 px-2 py-1 rounded ${x.status==="finalizada"?"bg-green-100 text-green-800":x.status==="baixa_parcial"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:x.status==="finalizada"?"Finalizada":x.status==="baixa_parcial"?"Parcial":"Aberta"})]})]})},x.id)})}),ae&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(Ne,{className:"w-5 h-5"}),e.jsx("span",{children:ae})]})]}),u===2&&m&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-2",children:["Venda #",m.numero_venda||m.id]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{className:"ml-2 font-medium",children:m.data_criacao?new Date(m.data_criacao).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Data n√£o dispon√≠vel"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Cliente:"}),e.jsx("span",{className:"ml-2 font-medium",children:((ze=m.cliente)==null?void 0:ze.nome)||"Consumidor Final"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"ml-2 font-medium text-green-600",children:["R$ ",m.total.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Itens da Venda"}),e.jsx("div",{className:"space-y-2",children:m.itens.map(x=>{const k=je(x),_=S[x.id];return e.jsx("div",{className:`border rounded-lg p-4 transition-colors ${N[x.id]?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("input",{type:"checkbox",checked:N[x.id]||!1,onChange:()=>z(x.id),className:"mt-1 w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:x.produto_nome}),k&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded",children:[e.jsx(Ds,{className:"w-3 h-3"}),"KIT"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Pre√ßo unit√°rio: R$ ",x.preco_unitario.toFixed(2)," | Qtd vendida: ",x.quantidade]}),N[x.id]&&k&&e.jsxs("div",{className:"mt-4 bg-white border-2 border-purple-300 rounded-lg p-4",children:[e.jsxs("div",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(ma,{className:"w-5 h-5 text-purple-600"}),"Como deseja devolver este KIT?"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:`modo-kit-${x.id}`,checked:_==="kit_inteiro",onChange:()=>y(x.id,"kit_inteiro"),className:"mt-1 w-4 h-4 text-blue-600 focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800 group-hover:text-blue-700 transition-colors",children:"üì¶ Devolver KIT Inteiro"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Devolve o KIT completo como uma unidade"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:`modo-kit-${x.id}`,checked:_==="componentes",onChange:()=>y(x.id,"componentes"),className:"mt-1 w-4 h-4 text-purple-600 focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800 group-hover:text-purple-700 transition-colors",children:"üß© Selecionar Componentes"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Escolha quais componentes do KIT devolver"})]})]})]})]}),N[x.id]&&!k&&e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantidade a devolver:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:x.quantidade,value:h[x.id],onChange:V=>oe(x.id,V.target.value),className:"w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Subtotal: R$ ",(x.preco_unitario*(h[x.id]||0)).toFixed(2)]})]}),N[x.id]&&k&&_==="kit_inteiro"&&e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantidade de KITs a devolver:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:x.quantidade,value:h[x.id],onChange:V=>oe(x.id,V.target.value),className:"w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Subtotal: R$ ",(x.preco_unitario*(h[x.id]||0)).toFixed(2)]})]}),N[x.id]&&k&&_==="componentes"&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-purple-50 to-blue-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold text-gray-800 mb-3",children:"Selecione os componentes a devolver:"}),e.jsx("div",{className:"space-y-3",children:x.composicao_kit.map((V,se)=>{var xe,te;const A=(xe=K[x.id])==null?void 0:xe[se],he=V.quantidade*x.quantidade;return e.jsx("div",{className:`border rounded-lg p-3 transition-colors ${A?"border-purple-500 bg-white":"border-gray-200 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:A||!1,onChange:()=>G(x.id,se),className:"mt-1 w-4 h-4 text-purple-600 rounded focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ma,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-800",children:V.produto_nome})]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["Qtd no KIT: ",V.quantidade," | Qtd total dispon√≠vel: ",he]}),A&&e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Quantidade:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:he,value:((te=re[x.id])==null?void 0:te[se])||0,onChange:ne=>me(x.id,se,ne.target.value),className:"w-24 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500"})]})]})]})},se)})})]})]})]})},x.id)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Motivo da Devolu√ß√£o *"}),e.jsx("textarea",{value:$,onChange:x=>E(x.target.value),placeholder:"Descreva o motivo da devolu√ß√£o...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 border-2 border-purple-200 rounded-lg p-5",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-3",children:"üí≥ Tipo de Devolu√ß√£o"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",checked:!t,onChange:()=>q(!1),className:"mt-1 w-5 h-5 text-green-600 focus:ring-2 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800 group-hover:text-green-700 transition-colors",children:"üíµ Devolver em Dinheiro"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"O valor ser√° devolvido em dinheiro e registrado como sa√≠da de caixa"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",checked:t,onChange:()=>q(!0),className:"mt-1 w-5 h-5 text-purple-600 focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800 group-hover:text-purple-700 transition-colors",children:"üéÅ Gerar Cr√©dito para o Cliente"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"O valor ser√° convertido em cr√©dito para uso em futuras compras (sem movimenta√ß√£o de caixa)"})]})]})]}),t&&!(m!=null&&m.cliente_id)&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-300 rounded-lg",children:e.jsxs("p",{className:"text-xs text-yellow-800 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Aten√ß√£o:"})," Esta venda n√£o possui cliente vinculado. Para gerar cr√©dito, √© necess√°rio ter um cliente cadastrado."]})]})})]}),e.jsx("div",{className:`border-2 rounded-lg p-4 ${t?"bg-purple-50 border-purple-300":"bg-orange-50 border-orange-200"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:t?"Cr√©dito a Gerar:":"Total da Devolu√ß√£o:"}),t&&(m==null?void 0:m.cliente)&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Cliente: ",e.jsx("strong",{children:m.cliente.nome})]})]}),e.jsxs("span",{className:`text-2xl font-bold ${t?"text-purple-600":"text-orange-600"}`,children:["R$ ",ke().toFixed(2)]})]})}),ae&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(Ne,{className:"w-5 h-5"}),e.jsx("span",{children:ae})]})]})]}),e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:u===1?C:()=>{s(1),b(null),U({}),M({}),E(""),w("")},disabled:R,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:u===1?"Cancelar":"Voltar"}),u===2&&e.jsx("button",{onClick:be,disabled:R||Object.values(N).filter(Boolean).length===0,className:"flex items-center gap-2 px-8 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:R?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(jt,{className:"w-5 h-5"}),e.jsx("span",{children:"Confirmar Devolu√ß√£o"})]})})]})})]})})}function or({caixaId:n,onClose:C}){const[c,u]=r.useState([]),[s,g]=r.useState(null),[F,m]=r.useState(!0);r.useEffect(()=>{b()},[n]);const b=async()=>{try{m(!0);const h=await P.get(`/caixas/${n}/movimentacoes`);u(h.data.movimentacoes),g(h.data.caixa)}catch(h){console.error("Erro ao carregar movimenta√ß√µes:",h),Ae.error("Erro ao carregar movimenta√ß√µes do caixa")}finally{m(!1)}},N=h=>{const M=new Date(h);return new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}).format(M)},U=h=>({venda:"Venda",suprimento:"Suprimento",sangria:"Sangria",despesa:"Despesa",devolucao:"Devolu√ß√£o",transferencia:"Transfer√™ncia"})[h]||h;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-blue-50 to-purple-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:"üìã Extrato do Caixa"}),s&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Caixa #",s.id," - ",s.nome," | Status: ",s.status]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,className:"p-2 hover:bg-white rounded-lg transition-colors",title:"Atualizar",children:e.jsx(vt,{className:`w-5 h-5 text-gray-600 ${F?"animate-spin":""}`})}),e.jsx("button",{onClick:C,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(ue,{className:"w-5 h-5 text-gray-600"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:F?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üì≠"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhuma movimenta√ß√£o registrada"})]}):e.jsx("div",{className:"space-y-3",children:c.map(h=>e.jsx("div",{className:`p-4 rounded-lg border-2 ${h.natureza==="entrada"?"bg-green-50 border-green-200":h.natureza==="saida"?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"text-3xl",children:h.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:U(h.tipo)}),h.forma_pagamento&&e.jsx("span",{className:"text-xs bg-white px-2 py-1 rounded border",children:h.forma_pagamento})]}),h.descricao&&e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:h.descricao}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-2 text-xs text-gray-600",children:[e.jsxs("span",{children:["üïê ",N(h.data_movimento)]}),e.jsxs("span",{children:["üë§ ",h.usuario_nome]}),h.venda_id&&e.jsxs("span",{children:["üßæ Venda #",h.venda_numero||h.venda_id]}),h.documento&&e.jsxs("span",{children:["üìÑ ",h.documento]})]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("div",{className:`text-2xl font-bold ${h.natureza==="entrada"?"text-green-600":h.natureza==="saida"?"text-red-600":"text-gray-600"}`,children:[h.natureza==="entrada"&&"+",h.natureza==="saida"&&"-","R$ ",h.valor.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:h.natureza==="entrada"?e.jsxs("span",{className:"flex items-center gap-1 justify-end",children:[e.jsx(ga,{className:"w-3 h-3"})," Entrada"]}):h.natureza==="saida"?e.jsxs("span",{className:"flex items-center gap-1 justify-end",children:[e.jsx(_a,{className:"w-3 h-3"})," Sa√≠da"]}):"Neutro"})]})]})},h.id))})}),e.jsx("div",{className:"border-t p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[c.length," movimenta√ß√£o(√µes) encontrada(s)"]}),e.jsx("button",{onClick:C,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Fechar"})]})})]})})}function lr({onAbrirCaixa:n}){var ae,w,S;const[C,c]=r.useState(null),[u,s]=r.useState(null),[g,F]=r.useState(!1),[m,b]=r.useState(null),[N,U]=r.useState(!0),[h,M]=r.useState(!1),[$,E]=r.useState(!1);r.useEffect(()=>{q();const I=setInterval(q,3e4);return()=>clearInterval(I)},[]),r.useEffect(()=>{const I=()=>{M(!1)};if(h)return document.addEventListener("mouseup",I),()=>document.removeEventListener("mouseup",I)},[h]);const t=()=>{F(!1),E(!1),M(!1)},q=async()=>{try{const I=await Ht();if(c(I),I){const K=await Ps(I.id);s(K)}}catch(I){console.error("Erro ao carregar caixa:",I)}finally{U(!1)}},R=()=>{b(null),q()},Q=async()=>{await n(),setTimeout(q,500)};return N?e.jsx("div",{className:"px-4 py-2 bg-gray-100 rounded-lg",children:e.jsx("div",{className:"animate-pulse h-10 bg-gray-200 rounded"})}):C?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>F(!g),className:"flex items-center space-x-3 px-4 py-2 bg-white border-2 border-green-500 rounded-lg hover:bg-green-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["Caixa #",C.numero_caixa]})]}),e.jsx(Pa,{className:`w-5 h-5 text-gray-400 transition-transform ${g?"rotate-180":""}`})]}),g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:t}),e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 z-50",children:[e.jsxs("div",{className:"p-4 border-b bg-gradient-to-r from-green-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Caixa #",C.numero_caixa]}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:C.usuario_nome})]}),e.jsx("button",{onClick:t,className:"p-1 hover:bg-white rounded-lg transition-colors",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(Va,{className:"w-4 h-4 mr-1"}),"Aberto em ",new Date(C.data_abertura).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Saldo Atual"}),e.jsx("div",{className:`text-sm font-bold ${h?"text-green-600":"text-gray-400"}`,children:h?`R$ ${((w=(ae=u==null?void 0:u.totais)==null?void 0:ae.saldo_atual)==null?void 0:w.toFixed(2))||"0,00"}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsx("button",{onMouseDown:()=>M(!0),className:"p-1 hover:bg-blue-100 rounded transition-colors",children:h?e.jsx(Ns,{className:"w-4 h-4 text-blue-600"}):e.jsx(ws,{className:"w-4 h-4 text-gray-400"})})]})]})]}),u&&e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900",children:"Resumo do Movimento"}),e.jsx("button",{onClick:()=>E(!$),className:"p-1 hover:bg-gray-200 rounded transition-colors",children:$?e.jsx(Ns,{className:"w-4 h-4 text-blue-600"}):e.jsx(ws,{className:"w-4 h-4 text-gray-400"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Abertura"}),e.jsx("div",{className:`font-semibold ${$?"text-gray-900":"text-gray-300"}`,children:$?`R$ ${C.valor_abertura.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Entradas"}),e.jsx("div",{className:`font-semibold ${$?"text-green-600":"text-green-300"}`,children:$?`+ R$ ${u.totais.vendas.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Suprimentos"}),e.jsx("div",{className:`font-semibold ${$?"text-green-600":"text-green-300"}`,children:$?`+ R$ ${u.totais.suprimentos.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Sangrias"}),e.jsx("div",{className:`font-semibold ${$?"text-orange-600":"text-orange-300"}`,children:$?`- R$ ${u.totais.sangrias.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Despesas"}),e.jsx("div",{className:`font-semibold ${$?"text-red-600":"text-red-300"}`,children:$?`- R$ ${u.totais.despesas.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]})]})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{onClick:()=>{b("suprimento"),F(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-green-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(ga,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Suprimento"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Adicionar dinheiro ao caixa"})]})]}),e.jsxs("button",{onClick:()=>{b("sangria"),F(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-orange-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(_a,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Sangria"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Retirar dinheiro do caixa"})]})]}),e.jsxs("button",{onClick:()=>{b("despesa"),F(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-red-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(ea,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Despesa"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Registrar pagamento de despesa"})]})]}),e.jsxs("button",{onClick:()=>{b("devolucao"),F(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-purple-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(Rs,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Devolu√ß√£o"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Estornar venda e devolver ao estoque"})]})]}),e.jsxs("button",{onClick:()=>{b("movimentacoes"),F(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-blue-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(yt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Extrato do Caixa"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Ver todas as movimenta√ß√µes"})]})]})]}),e.jsx("div",{className:"p-4 border-t",children:e.jsx("button",{onClick:()=>{b("fechar"),F(!1)},className:"w-full px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Fechar Caixa"})})]})]})]}),m==="suprimento"&&e.jsx(er,{caixaId:C.id,onClose:()=>b(null),onSucesso:R}),m==="sangria"&&e.jsx(ar,{caixaId:C.id,saldoAtual:((S=u==null?void 0:u.totais)==null?void 0:S.saldo_atual)||0,onClose:()=>b(null),onSucesso:R}),m==="despesa"&&e.jsx(sr,{caixaId:C.id,onClose:()=>b(null),onSucesso:R}),m==="fechar"&&e.jsx(tr,{caixaId:C.id,onClose:()=>b(null),onSuccess:()=>{b(null),q()}}),m==="devolucao"&&e.jsx(rr,{caixaId:C.id,onClose:()=>b(null),onSucesso:R}),m==="movimentacoes"&&e.jsx(or,{caixaId:C.id,onClose:()=>b(null)})]}):e.jsxs("button",{onClick:Q,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(sa,{className:"w-5 h-5"}),e.jsx("span",{children:"Abrir Caixa"})]})}function nr({venda:n,onClose:C}){var u,s;const c=()=>{window.print()};return n?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:c,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-800 text-white rounded-lg transition-colors print:hidden",children:[e.jsx(Nt,{className:"w-5 h-5"}),e.jsx("span",{children:"Imprimir Cupom"})]}),e.jsx("style",{children:`
        @media print {
          /* Esconder tudo exceto o cupom */
          body * {
            visibility: hidden;
          }
          .cupom-impressao, .cupom-impressao * {
            visibility: visible;
          }
          .cupom-impressao {
            position: absolute;
            left: 0;
            top: 0;
            width: 80mm;
            margin: 0;
            padding: 0;
          }
          
          /* Reset de margens para impress√£o */
          @page {
            size: 80mm auto;
            margin: 5mm;
          }
        }
      `}),e.jsxs("div",{className:"cupom-impressao hidden print:block",style:{width:"80mm",fontFamily:"monospace"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"10px"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold"},children:"PET SHOP PRO"}),e.jsx("div",{style:{fontSize:"12px"},children:"Central de Gest\\u00e3o"}),e.jsx("div",{style:{fontSize:"10px",marginTop:"5px"},children:new Date().toLocaleString("pt-BR")})]}),e.jsxs("div",{style:{borderTop:"1px dashed #000",marginBottom:"10px",paddingTop:"10px"},children:[e.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"5px"},children:["VENDA #",n.numero_venda||n.id]}),e.jsxs("div",{style:{fontSize:"11px"},children:[e.jsxs("div",{children:["Data: ",n.data_venda?new Date(n.data_venda).toLocaleString("pt-BR"):new Date().toLocaleString("pt-BR")]}),n.cliente&&e.jsxs("div",{children:["Cliente: ",n.cliente.nome||n.cliente_nome]}),n.pet&&e.jsxs("div",{children:["Pet: ",n.pet.nome]})]})]}),e.jsx("div",{style:{borderTop:"1px dashed #000",marginBottom:"10px",paddingTop:"10px"},children:e.jsxs("table",{style:{width:"100%",fontSize:"10px",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid #000"},children:[e.jsx("th",{style:{textAlign:"left",paddingBottom:"5px"},children:"Item"}),e.jsx("th",{style:{textAlign:"center",paddingBottom:"5px"},children:"Qtd"}),e.jsx("th",{style:{textAlign:"right",paddingBottom:"5px"},children:"Valor"})]})}),e.jsx("tbody",{children:(u=n.itens)==null?void 0:u.map((g,F)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{paddingTop:"5px",paddingBottom:"5px"},children:[g.produto_nome,e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"9px",color:"#666"},children:[g.quantidade," x R$ ",g.preco_unitario.toFixed(2),g.desconto_valor>0&&e.jsxs("span",{style:{color:"#ff8c00"},children:[" ","com R$ ",g.desconto_valor.toFixed(2)," de desconto"]})]})]}),e.jsx("td",{style:{textAlign:"center",paddingTop:"5px",paddingBottom:"5px"},children:g.quantidade}),e.jsxs("td",{style:{textAlign:"right",paddingTop:"5px",paddingBottom:"5px"},children:["R$ ",g.subtotal.toFixed(2)]})]},F))})]})}),e.jsxs("div",{style:{borderTop:"1px dashed #000",paddingTop:"10px",fontSize:"11px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Total bruto:"}),e.jsxs("span",{children:["R$ ",(n.subtotal+n.desconto_valor).toFixed(2)]})]}),n.desconto_valor>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px",color:"#ff8c00"},children:[e.jsxs("span",{children:[(n.desconto_valor/(n.subtotal+n.desconto_valor)*100).toFixed(2),"% de desconto:"]}),e.jsxs("span",{children:["R$ ",n.desconto_valor.toFixed(2)]})]}),n.tem_entrega&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsxs("span",{children:["R$ ",(((s=n.entrega)==null?void 0:s.taxa_entrega_total)||0).toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",paddingTop:"10px",borderTop:"1px solid #000",fontSize:"14px",fontWeight:"bold"},children:[e.jsx("span",{children:"TOTAL:"}),e.jsxs("span",{children:["R$ ",n.total.toFixed(2)]})]})]}),n.pagamentos&&n.pagamentos.length>0&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"PAGAMENTOS:"}),n.pagamentos.map((g,F)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"3px"},children:[e.jsx("span",{children:g.forma_pagamento}),e.jsxs("span",{children:["R$ ",g.valor.toFixed(2)]})]},F))]}),n.tem_entrega&&n.entrega&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"ENTREGA:"}),e.jsx("div",{children:n.entrega.endereco_completo}),n.entrega.observacoes_entrega&&e.jsxs("div",{style:{marginTop:"3px",fontStyle:"italic"},children:["Obs: ",n.entrega.observacoes_entrega]})]}),n.observacoes&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"OBSERVA\\u00c7\\u00d5ES:"}),e.jsx("div",{children:n.observacoes})]}),e.jsxs("div",{style:{textAlign:"center",marginTop:"15px",paddingTop:"10px",borderTop:"1px dashed #000",fontSize:"10px"},children:[e.jsx("div",{children:"Obrigado pela preferencia!"}),e.jsx("div",{style:{marginTop:"5px"},children:"Volte sempre!"})]})]})]}):null}function ir({clienteId:n,clienteNome:C,onClose:c,onSucesso:u}){const[s,g]=r.useState([]),[F,m]=r.useState([]),[b,N]=r.useState(!0),[U,h]=r.useState(!1),[M,$]=r.useState(""),[E,t]=r.useState("dinheiro"),[q,R]=r.useState(""),[Q,ae]=r.useState(""),[w,S]=r.useState({total_vendas:0,total_em_aberto:0}),[I,K]=r.useState("antiga");r.useEffect(()=>{D()},[n]);const D=async()=>{try{N(!0);const z=await P.get(`/clientes/${n}/vendas-em-aberto`);g(z.data.vendas||[]),S(z.data.resumo||{total_vendas:0,total_em_aberto:0})}catch(z){console.error("Erro ao carregar vendas em aberto:",z),Xe.error("Erro ao carregar vendas em aberto")}finally{N(!1)}},re=z=>{m(oe=>oe.includes(z)?oe.filter(je=>je!==z):[...oe,z])},le=()=>{F.length===s.length?m([]):m(s.map(z=>z.id))},ce=z=>{const oe=new Date,je=new Date(z),y=Math.abs(oe-je);return Math.ceil(y/(1e3*60*60*24))},v=[...s].sort((z,oe)=>I==="antiga"?new Date(z.data_venda)-new Date(oe.data_venda):new Date(oe.data_venda)-new Date(z.data_venda)),H=s.filter(z=>F.includes(z.id)).reduce((z,oe)=>z+parseFloat(oe.saldo_devedor),0),J=async()=>{var z,oe,je,y;if(F.length===0){Xe.error("Selecione ao menos uma venda");return}if(!M||parseFloat(M)<=0){Xe.error("Informe um valor v√°lido");return}if(parseFloat(M)>H){Xe.error("Valor do pagamento n√£o pode ser maior que o total selecionado");return}try{h(!0),console.log("Enviando requisi√ß√£o:",{vendas_ids:F,valor_total:parseFloat(M),forma_pagamento:E,numero_transacao:q||null,observacoes:Q||null});const G=await P.post(`/clientes/${n}/baixar-vendas-lote`,{vendas_ids:F,valor_total:parseFloat(M),forma_pagamento:E,numero_transacao:q||null,observacoes:Q||null});if(console.log("Resposta completa:",G),console.log("Response.data:",G.data),!G.data)throw new Error("Resposta vazia do servidor");const{vendas_quitadas:me,vendas_parciais:be,total_vendas_afetadas:ke,valor_total_baixado:ze}=G.data;let x=`üí∞ Total baixado: R$ ${ze.toFixed(2)}
`;me.length>0&&(x+=`
‚úÖ ${me.length} venda(s) quitada(s):`,me.forEach(k=>{x+=`
  ‚Ä¢ ${k.numero_venda}: R$ ${k.valor_baixado.toFixed(2)}`})),be.length>0&&(x+=`

‚ö†Ô∏è ${be.length} venda(s) parcial:`,be.forEach(k=>{x+=`
  ‚Ä¢ ${k.numero_venda}:`,x+=`
    Baixado: R$ ${k.valor_baixado.toFixed(2)}`,x+=`
    Falta: R$ ${k.saldo_restante.toFixed(2)}`})),Xe.success(x,{duration:6e3}),u&&u(),c()}catch(G){console.error("Erro completo:",G),console.error("Erro response:",G.response),console.error("Erro response data:",(z=G.response)==null?void 0:z.data),console.error("Erro response status:",(oe=G.response)==null?void 0:oe.status);const me=((y=(je=G.response)==null?void 0:je.data)==null?void 0:y.detail)||G.message||"Erro ao baixar vendas";Xe.error(me)}finally{h(!1)}};return b?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-8 max-w-4xl w-full mx-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Aa,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando vendas..."})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-red-50 to-orange-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Vendas em Aberto"}),e.jsx("p",{className:"text-gray-600 mt-1",children:C})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Vendas"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:w.total_vendas})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total em Aberto"}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["R$ ",w.total_em_aberto.toFixed(2)]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ua,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-medium text-gray-900",children:"Nenhuma venda em aberto!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Este cliente n√£o possui d√©bitos pendentes."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:le,className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:F.length===s.length?"Desmarcar todas":"Selecionar todas"}),e.jsxs("button",{onClick:()=>K(I==="antiga"?"recente":"antiga"),className:"text-sm text-gray-600 hover:text-gray-700 flex items-center gap-1 font-medium",children:["üìÖ ",I==="antiga"?"‚Üë Mais Antigas":"‚Üì Mais Recentes"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[F.length," de ",s.length," selecionada(s)"]})]}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden mb-6",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:e.jsx("input",{type:"checkbox",checked:F.length===s.length,onChange:le,className:"rounded border-gray-300"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Venda"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Pago"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Saldo Devedor"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Dias"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v.map(z=>{const oe=ce(z.data_venda),je=oe>30;return e.jsxs("tr",{className:`hover:bg-gray-50 ${F.includes(z.id)?"bg-blue-50":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:F.includes(z.id),onChange:()=>re(z.id),className:"rounded border-gray-300"})}),e.jsxs("td",{className:"px-4 py-3 font-medium text-gray-900",children:["#",z.numero_venda]}),e.jsx("td",{className:"px-4 py-3 text-gray-600 text-sm",children:new Date(z.data_venda).toLocaleDateString("pt-BR")}),e.jsxs("td",{className:"px-4 py-3 text-right text-gray-900",children:["R$ ",parseFloat(z.total).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right text-green-600",children:["R$ ",parseFloat(z.total_pago).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-red-600",children:["R$ ",parseFloat(z.saldo_devedor).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${je?"bg-red-100 text-red-800":oe>15?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:[oe," ",oe===1?"dia":"dias"]})})]},z.id)})})]})}),F.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Registrar Pagamento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor Total Selecionado"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["R$ ",H.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor do Pagamento *"}),e.jsx("input",{type:"number",step:"0.01",value:M,onChange:z=>$(z.target.value),placeholder:"0.00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de Pagamento *"}),e.jsxs("select",{value:E,onChange:z=>t(z.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"dinheiro",children:"Dinheiro"}),e.jsx("option",{value:"pix",children:"PIX"}),e.jsx("option",{value:"debito",children:"Cart√£o de D√©bito"}),e.jsx("option",{value:"credito",children:"Cart√£o de Cr√©dito"}),e.jsx("option",{value:"transferencia",children:"Transfer√™ncia"})]})]}),(E==="pix"||E==="transferencia")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"N√∫mero da Transa√ß√£o"}),e.jsx("input",{type:"text",value:q,onChange:z=>R(z.target.value),placeholder:"C√≥digo/ID da transa√ß√£o",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes"}),e.jsx("textarea",{value:Q,onChange:z=>ae(z.target.value),rows:"2",placeholder:"Informa√ß√µes adicionais sobre o pagamento...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-start space-x-2 mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(Ne,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Aten√ß√£o:"})," O valor ser√° aplicado automaticamente da venda mais antiga para a mais recente. Se o valor for insuficiente para quitar todas as vendas selecionadas, a √∫ltima venda ficar√° parcialmente paga."]})]}),e.jsx("button",{onClick:J,disabled:U||!M||parseFloat(M)<=0,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:U?e.jsxs(e.Fragment,{children:[e.jsx(Aa,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(sa,{className:"w-5 h-5"}),e.jsx("span",{children:"Baixar Vendas Selecionadas"})]})})]})]})})]})})}function dr({clienteId:n,clienteNome:C,onClose:c}){var M,$,E;const[u,s]=r.useState(null),[g,F]=r.useState(!0),[m,b]=r.useState("todos");r.useEffect(()=>{N()},[n]);const N=async()=>{try{F(!0);const t=await P.get(`/clientes/${n}/historico-compras`);s(t.data)}catch(t){console.error("Erro ao carregar hist√≥rico:",t),Xe.error("Erro ao carregar hist√≥rico do cliente")}finally{F(!1)}},U=t=>{const q={finalizada:"bg-green-100 text-green-800",baixa_parcial:"bg-yellow-100 text-yellow-800",pendente:"bg-blue-100 text-blue-800",cancelada:"bg-red-100 text-red-800",finalizada_devolucao_parcial:"bg-orange-100 text-orange-800",finalizada_devolucao_total:"bg-gray-100 text-gray-800"},R={finalizada:"Finalizada",baixa_parcial:"Baixa Parcial",pendente:"Pendente",cancelada:"Cancelada",finalizada_devolucao_parcial:"Dev. Parcial",finalizada_devolucao_total:"Dev. Total"};return e.jsx("span",{className:`inline-flex px-2 py-1 rounded-full text-xs font-medium ${q[t]||"bg-gray-100 text-gray-800"}`,children:R[t]||t})},h=((M=u==null?void 0:u.vendas)==null?void 0:M.filter(t=>m==="todos"?!0:t.status===m))||[];return g?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-8 max-w-4xl w-full mx-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Aa,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando hist√≥rico..."})]})})}):u?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Hist√≥rico de Compras"}),e.jsx("p",{className:"text-gray-600 mt-1",children:C})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(_s,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Compras"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:u.total_compras})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(sa,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Gasto"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",u.valor_total_gasto.toFixed(2)]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(ga,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Ticket M√©dio"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",u.ticket_medio.toFixed(2)]})]})]})})]}),u.ultima_compra&&e.jsxs("div",{className:"mt-4 bg-white rounded-lg p-3 shadow-sm flex items-center space-x-2 text-sm",children:[e.jsx(wt,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-gray-600",children:["√öltima compra: ",new Date(u.ultima_compra).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"})]})]})]}),e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtrar por status:"}),e.jsxs("select",{value:m,onChange:t=>b(t.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500",children:[e.jsxs("option",{value:"todos",children:["Todos (",(($=u.vendas)==null?void 0:$.length)||0,")"]}),e.jsx("option",{value:"finalizada",children:"Finalizadas"}),e.jsx("option",{value:"baixa_parcial",children:"Baixa Parcial"}),e.jsx("option",{value:"pendente",children:"Pendentes"}),e.jsx("option",{value:"cancelada",children:"Canceladas"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:h.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_s,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:"Nenhuma venda encontrada"}),e.jsx("p",{className:"text-gray-600 mt-2",children:m==="todos"?"Este cliente ainda n√£o realizou compras.":"N√£o h√° vendas com este status."})]}):e.jsx("div",{className:"space-y-3",children:h.map(t=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Venda #",t.numero_venda]}),U(t.status)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Data:"}),e.jsx("div",{className:"font-medium text-gray-900",children:new Date(t.data_venda).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal:"}),e.jsxs("div",{className:"font-medium text-gray-900",children:["R$ ",t.subtotal.toFixed(2)]})]}),t.desconto_valor>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Desconto:"}),e.jsxs("div",{className:"font-medium text-red-600",children:["- R$ ",t.desconto_valor.toFixed(2)]})]}),t.taxa_entrega>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Taxa Entrega:"}),e.jsxs("div",{className:"font-medium text-gray-900",children:["R$ ",t.taxa_entrega.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total:"}),e.jsxs("div",{className:"font-bold text-gray-900 text-lg",children:["R$ ",t.total.toFixed(2)]})]}),t.saldo_devedor>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Saldo Devedor:"}),e.jsxs("div",{className:"font-bold text-red-600",children:["R$ ",t.saldo_devedor.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Itens:"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.total_itens})]}),t.vendedor_nome&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Vendedor:"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.vendedor_nome})]})]})]})})},t.id))})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[e.jsxs("span",{children:["Mostrando ",h.length," de ",((E=u.vendas)==null?void 0:E.length)||0," vendas"]}),e.jsx("button",{onClick:c,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:"Fechar"})]})})]})}):null}function cr({clienteId:n}){const[C,c]=r.useState(!1),[u,s]=r.useState(null),[g,F]=r.useState(null),[m,b]=r.useState(""),[N,U]=r.useState([]),[h,M]=r.useState(!1),$=r.useRef(null),[E,t]=r.useState({resumo:!1,pets:!1,compras:!1,oportunidades:!1,sugestoes:!1,relacionados:!1,sazonalidade:!1,chat:!1});r.useEffect(()=>{n&&q()},[n]);const q=async()=>{var v,H;try{c(!0),F(null);const J=await P.get(`/clientes/${n}/info-pdv`);s(J.data)}catch(J){console.error("Erro ao carregar informa√ß√µes do cliente:",J),F(((H=(v=J.response)==null?void 0:v.data)==null?void 0:H.detail)||"Erro ao carregar dados")}finally{c(!1)}},R=v=>{t(H=>({...H,[v]:!H[v]}))},Q=async()=>{if(!m.trim())return;const v=m;b(""),U(H=>[...H,{tipo:"user",texto:v}]);try{M(!0);const H=await P.post(`/clientes/${n}/chat-pdv`,{mensagem:v});U(J=>[...J,{tipo:"ia",texto:H.data.resposta,ia_disponivel:H.data.ia_disponivel}]),setTimeout(()=>{var J;return(J=$.current)==null?void 0:J.scrollIntoView({behavior:"smooth"})},100)}catch(H){console.error("Erro no chat:",H),U(J=>[...J,{tipo:"erro",texto:"Erro ao processar mensagem. Tente novamente."}])}finally{M(!1)}},ae=v=>{v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),Q())};if(!n)return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 text-center text-gray-500",children:[e.jsx(Ea,{className:"mx-auto text-4xl mb-2"}),e.jsx("p",{children:"Selecione um cliente para ver informa√ß√µes"})]});if(C)return e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})});if(g)return e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:[e.jsx(aa,{className:"inline mr-2"}),g]});if(!u)return null;const{cliente:w,resumo_financeiro:S,pets:I,ultimas_compras:K,oportunidades:D,sugestoes:re,produtos_relacionados:le,padroes_sazonais:ce}=u;return e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden max-h-[85vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-100 to-purple-100 p-4 border-b",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 mb-1",children:w.nome}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[w.cpf_cnpj&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(Ea,{className:"text-xs"}),w.cpf_cnpj]}),w.telefone&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(_t,{className:"text-xs"}),w.telefone]}),w.email&&e.jsxs("p",{className:"flex items-center gap-1 truncate",children:[e.jsx(Ct,{className:"text-xs"}),w.email]}),w.endereco&&e.jsxs("p",{className:"flex items-center gap-1 text-xs",children:[e.jsx(Ft,{className:"text-xs"}),w.endereco,", ",w.bairro," - ",w.cidade,"/",w.estado]})]})]})})}),e.jsxs(Qe,{titulo:"Resumo Financeiro",icone:e.jsx(As,{}),expandido:E.resumo,onToggle:()=>R("resumo"),badge:S.numero_compras,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:"Total Gasto"}),e.jsxs("p",{className:"text-lg font-bold text-green-700",children:["R$ ",S.total_gasto.toFixed(2)]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"Ticket M√©dio"}),e.jsxs("p",{className:"text-lg font-bold text-blue-700",children:["R$ ",S.ticket_medio.toFixed(2)]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-purple-600 font-medium mb-1",children:"N¬∫ Compras"}),e.jsx("p",{className:"text-lg font-bold text-purple-700",children:S.numero_compras})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-orange-600 font-medium mb-1",children:"Maior Compra"}),e.jsxs("p",{className:"text-lg font-bold text-orange-700",children:["R$ ",S.maior_compra.valor.toFixed(2)]}),S.maior_compra.data&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:S.maior_compra.data})]})]}),S.ultima_compra.data&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(St,{className:"text-xs"}),"√öltima compra: ",S.ultima_compra.data," - R$ ",S.ultima_compra.valor.toFixed(2)]})})]}),I&&I.length>0&&e.jsx(Qe,{titulo:"Pets Registrados",icone:e.jsx(Ea,{}),expandido:E.pets,onToggle:()=>R("pets"),badge:I.length,children:e.jsx("div",{className:"space-y-2",children:I.map(v=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold",children:v.nome[0].toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800",children:v.nome}),e.jsxs("p",{className:"text-xs text-gray-500",children:[v.especie," ",v.raca&&`‚Ä¢ ${v.raca}`,v.peso&&` ‚Ä¢ ${v.peso}kg`,v.idade_anos!==null&&` ‚Ä¢ ${v.idade_anos} anos`]})]})]},v.id))})}),D&&D.length>0&&e.jsx(Qe,{titulo:"Oportunidades de Venda",icone:e.jsx(aa,{}),expandido:E.oportunidades,onToggle:()=>R("oportunidades"),badge:D.length,badgeColor:"bg-orange-500",children:e.jsx("div",{className:"space-y-2",children:D.map((v,H)=>e.jsxs("div",{className:`p-3 rounded-lg border-l-4 ${v.urgencia==="alta"?"bg-red-50 border-red-400":"bg-yellow-50 border-yellow-400"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:v.produto_nome}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:v.mensagem})]}),v.urgencia==="alta"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-red-500 text-white text-xs rounded-full",children:"Urgente"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Atrasado ",v.dias_atraso," dias"]})]},H))})}),re&&re.length>0&&e.jsx(Qe,{titulo:"Produtos Favoritos",icone:e.jsx(kt,{}),expandido:E.sugestoes,onToggle:()=>R("sugestoes"),badge:re.length,children:e.jsx("div",{className:"space-y-2",children:re.map((v,H)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:v.nome}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Comprado ",v.vezes_comprado,"x",v.ultima_compra&&` ‚Ä¢ √öltima: ${v.ultima_compra}`]})]}),e.jsxs("p",{className:"font-bold text-indigo-600 ml-2",children:["R$ ",v.preco.toFixed(2)]})]},H))})}),K&&K.length>0&&e.jsx(Qe,{titulo:"√öltimas Compras",icone:e.jsx(Et,{}),expandido:E.compras,onToggle:()=>R("compras"),badge:K.length,children:e.jsx("div",{className:"space-y-3",children:K.map((v,H)=>e.jsxs("div",{className:"border-l-4 border-indigo-300 pl-3 py-2 bg-gray-50 rounded-r-lg",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500",children:[v.data," ‚Ä¢ Venda #",v.numero_venda]}),e.jsxs("p",{className:"font-bold text-indigo-600",children:["R$ ",v.valor_total.toFixed(2)]})]})}),v.produtos&&v.produtos.length>0&&e.jsx("div",{className:"space-y-1 mt-2",children:v.produtos.map((J,z)=>e.jsxs("p",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx($t,{className:"text-xs"}),J.quantidade,"x ",J.nome," - R$ ",J.valor.toFixed(2)]},z))})]},H))})}),le&&le.length>0&&e.jsx(Qe,{titulo:"Produtos Comprados Juntos",icone:e.jsx(Rt,{}),expandido:E.relacionados,onToggle:()=>R("relacionados"),badge:le.length,badgeColor:"bg-purple-500",children:e.jsx("div",{className:"space-y-2",children:le.map((v,H)=>e.jsxs("div",{className:"p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"text-xs font-semibold text-purple-600",children:[v.vezes_juntos,"x comprados juntos"]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-800",children:v.produto1.nome}),e.jsxs("span",{className:"text-purple-600 font-bold",children:["R$ ",v.produto1.preco.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-800",children:v.produto2.nome}),e.jsxs("span",{className:"text-purple-600 font-bold",children:["R$ ",v.produto2.preco.toFixed(2)]})]})]}),e.jsx("p",{className:"text-xs text-purple-600 mt-2 italic",children:"üí° Sugest√£o: Oferecer combo!"})]},H))})}),ce&&ce.length>0&&e.jsx(Qe,{titulo:"Padr√µes de Compra",icone:e.jsx(Ta,{}),expandido:E.sazonalidade,onToggle:()=>R("sazonalidade"),badge:ce.length,badgeColor:"bg-green-500",children:e.jsx("div",{className:"space-y-2",children:ce.map((v,H)=>e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-green-700",children:v.mes_ano}),e.jsxs("span",{className:"text-sm text-green-600",children:[v.numero_compras," compras"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"font-bold text-green-700 ml-1",children:["R$ ",v.total_gasto.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Ticket m√©dio:"}),e.jsxs("span",{className:"font-bold text-green-700 ml-1",children:["R$ ",v.ticket_medio.toFixed(2)]})]})]})]},H))})}),e.jsx(Qe,{titulo:"Chat IA - Assistente de Vendas",icone:e.jsx(At,{}),expandido:E.chat,onToggle:()=>R("chat"),badgeColor:"bg-blue-500",children:e.jsxs("div",{className:"space-y-3",children:[N.length===0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Perguntas sugeridas:"}),["Quais os produtos favoritos?","Quando foi a √∫ltima compra?","Quais pets ele tem?","Quanto j√° gastou total?"].map((v,H)=>e.jsx("button",{onClick:()=>{b(v),setTimeout(()=>Q(),100)},className:"w-full text-left px-3 py-2 text-xs bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition-colors",children:v},H))]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto space-y-2",children:[N.map((v,H)=>e.jsx("div",{className:`flex ${v.tipo==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] px-3 py-2 rounded-lg text-sm ${v.tipo==="user"?"bg-blue-600 text-white":v.tipo==="erro"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-800"}`,children:[v.texto,v.tipo==="ia"&&!v.ia_disponivel&&e.jsx("p",{className:"text-xs mt-1 opacity-70",children:"üí° Modo b√°sico (IA n√£o configurada)"})]})},H)),e.jsx("div",{ref:$})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:m,onChange:v=>b(v.target.value),onKeyPress:ae,placeholder:"Digite sua pergunta...",disabled:h,className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"}),e.jsx("button",{onClick:Q,disabled:h||!m.trim(),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Dt,{className:"w-4 h-4"})})]})]})})]})}function Qe({titulo:n,icone:C,expandido:c,onToggle:u,badge:s,badgeColor:g="bg-indigo-500",children:F}){return e.jsxs("div",{className:"border-b border-gray-200",children:[e.jsxs("button",{onClick:u,className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-indigo-600",children:C}),e.jsx("h4",{className:"font-semibold text-gray-800",children:n}),s!==void 0&&e.jsx("span",{className:`${g} text-white text-xs px-2 py-1 rounded-full`,children:s})]}),c?e.jsx(Tt,{className:"text-gray-400"}):e.jsx(Pt,{className:"text-gray-400"})]}),c&&e.jsx("div",{className:"px-4 pb-4",children:F})]})}const xr=({mostrar:n,onFechar:C,dados:c,carregando:u})=>{if(r.useEffect(()=>{const m=b=>{b.key==="Escape"&&n&&C()};if(n)return window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)},[n,C]),!n)return null;const s=m=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(m||0),g=m=>{switch(m){case"verde":return"bg-green-100 border-green-500 text-green-800";case"amarelo":return"bg-yellow-100 border-yellow-500 text-yellow-800";case"vermelho":return"bg-red-100 border-red-500 text-red-800";default:return"bg-gray-100 border-gray-500 text-gray-800"}},F=m=>{switch(m){case"success":return e.jsx(It,{className:"text-green-500"});case"error":return e.jsx(aa,{className:"text-red-500"});case"warning":return e.jsx(aa,{className:"text-yellow-500"});case"info":return e.jsx(Cs,{className:"text-blue-500"});default:return e.jsx(Cs,{className:"text-gray-500"})}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:C}),e.jsxs("div",{className:"fixed right-0 top-0 h-full w-96 bg-white shadow-2xl z-50 flex flex-col animate-slide-in-right",children:[e.jsxs("div",{className:"p-4 border-b bg-gradient-to-r from-blue-600 to-blue-700 text-white flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ta,{className:"w-5 h-5"}),e.jsx("h3",{className:"text-lg font-bold",children:"An√°lise da Venda"})]}),e.jsx("button",{onClick:C,className:"hover:bg-white hover:bg-opacity-20 p-1 rounded transition-colors",children:e.jsx(Vt,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:u?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(As,{className:"text-blue-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"Composi√ß√£o Financeira"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Total dos Produtos"}),e.jsx("span",{className:"font-semibold",children:s(c.composicao.total_produtos)})]}),c.composicao.desconto>0&&e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"(-) Descontos Aplicados"}),e.jsxs("span",{className:"font-semibold",children:[s(c.composicao.desconto),e.jsxs("span",{className:"text-xs ml-1",children:["(",(c.composicao.desconto/c.composicao.total_produtos*100).toFixed(1),"%)"]})]})]}),c.composicao.taxa_entrega>0&&e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"(-) Taxa de Entrega"}),e.jsx("span",{className:"font-semibold",children:s(c.composicao.taxa_entrega)})]}),e.jsx("div",{className:"border-t-2 border-blue-600 pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-blue-700",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:s(c.composicao.subtotal)})]})})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Mt,{className:"text-orange-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"Dedu√ß√µes"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[c.deducoes.comissao.valor>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Comiss√£o do Vendedor (",c.deducoes.comissao.percentual,"%)"]}),e.jsx("span",{className:"font-semibold text-red-600",children:s(c.deducoes.comissao.valor)})]}),c.detalhamento_taxas&&c.detalhamento_taxas.length>0&&e.jsx(e.Fragment,{children:c.detalhamento_taxas.map((m,b)=>e.jsxs(mt.Fragment,{children:[m.taxa_percentual>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-600",children:["Taxa ",m.forma," (",m.taxa_percentual,"%)"]}),e.jsx("span",{className:"text-xs text-gray-500",children:s(m.valor_pagamento)})]}),e.jsx("span",{className:"font-semibold text-red-600",children:s(m.valor_taxa_percentual)})]}),m.taxa_fixa>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-600",children:["Taxa Fixa ",m.forma]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["R$ ",m.taxa_fixa.toFixed(2)]})]}),e.jsx("span",{className:"font-semibold text-red-600",children:s(m.valor_taxa_fixa)})]})]},b))}),(!c.detalhamento_taxas||c.detalhamento_taxas.length===0)&&c.deducoes.taxa_percentual>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Taxa Percentual"}),e.jsx("span",{className:"font-semibold text-red-600",children:s(c.deducoes.taxa_percentual)})]}),(!c.detalhamento_taxas||c.detalhamento_taxas.length===0)&&c.deducoes.taxa_fixa>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Taxa Fixa"}),e.jsx("span",{className:"font-semibold text-red-600",children:s(c.deducoes.taxa_fixa)})]}),c.deducoes.impostos.valor>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Impostos Estimados (",c.deducoes.impostos.percentual,"%)"]}),e.jsx("span",{className:"font-semibold text-red-600",children:s(c.deducoes.impostos.valor)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Custo dos Produtos"}),e.jsx("span",{className:"font-semibold text-red-600",children:s(c.deducoes.custos)})]}),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-semibold text-gray-700",children:[e.jsx("span",{children:"Total de Dedu√ß√µes"}),e.jsx("span",{className:"text-red-600",children:s(c.deducoes.total_deducoes)})]})})]})]}),e.jsxs("div",{className:`rounded-lg p-4 border-2 ${g(c.resultado.cor_indicador)}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ta,{className:"w-5 h-5"}),e.jsx("h4",{className:"font-bold",children:"Resultado Final"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold",children:"Lucro L√≠quido Estimado"}),e.jsx("span",{className:"text-2xl font-bold",children:s(c.resultado.lucro_liquido)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Margem L√≠quida"}),e.jsxs("span",{className:"text-xl font-bold",children:[c.resultado.margem_liquida.toFixed(2),"%"]})]})]})]}),c.alertas&&c.alertas.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(aa,{className:"text-purple-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"Alertas e Sugest√µes"})]}),e.jsx("div",{className:"space-y-2",children:c.alertas.map((m,b)=>e.jsxs("div",{className:`flex items-start gap-2 p-2 rounded text-sm ${m.tipo==="success"?"bg-green-50":m.tipo==="error"?"bg-red-50":m.tipo==="warning"?"bg-yellow-50":"bg-blue-50"}`,children:[e.jsx("span",{className:"flex-shrink-0 mt-0.5",children:F(m.tipo)}),e.jsxs("span",{className:"flex-1",children:[e.jsx("span",{className:"mr-1",children:m.icone}),m.mensagem]})]},b))})]}),c.detalhamento_comissoes&&c.detalhamento_comissoes.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-3",children:"Detalhamento de Comiss√µes"}),e.jsx("div",{className:"space-y-2 text-sm",children:c.detalhamento_comissoes.map((m,b)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-700",children:m.produto}),e.jsxs("div",{className:"text-xs text-gray-500",children:[m.percentual,"% de comiss√£o"]})]}),e.jsx("span",{className:"font-semibold text-blue-600",children:s(m.valor)})]},b))})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(aa,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"Erro ao carregar an√°lise"})]})})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("button",{onClick:C,className:"w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Fechar"}),e.jsx("span",{className:"text-xs text-gray-300",children:"(ESC)"})]})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes slide-in-right {
          from {
            transform: translateX(100%);
          }
          to {
            transform: translateX(0);
          }
        }
        
        .animate-slide-in-right {
          animation: slide-in-right 0.3s ease-out;
        }
      `})]})};function mr({itensCarrinho:n=[],onClose:C=()=>{},isOpen:c=!1,racaoIdFechada:u=null}){const[s,g]=r.useState(null),[F,m]=r.useState(!1),[b,N]=r.useState(null),[U,h]=r.useState(null),[M,$]=r.useState(!1),E=n.filter(R=>gt(R));r.useEffect(()=>{c&&(console.log("ü•´ Modal: Ra√ß√µes encontradas:",E.length),E.forEach((R,Q)=>{console.log(`  ${Q+1}. ${R.produto_nome} - peso_embalagem: ${R.peso_embalagem}`)}))},[c,E.length]),r.useEffect(()=>{if(c&&E.length>0){const R=E[E.length-1];u!==R.produto_id&&(g(R.produto_id),N(null),h(null),m(!1))}},[c,E.length,u]);const t=E.find(R=>R.produto_id===s),q=async()=>{if(!t){h("Ra√ß√£o n√£o selecionada");return}if(!(t.peso_embalagem||t.peso_pacote_kg)||!t.preco_unitario){console.error("‚ùå Modal: Dados da ra√ß√£o incompletos",{peso_embalagem:t.peso_embalagem,peso_pacote_kg:t.peso_pacote_kg,preco_unitario:t.preco_unitario}),h("Dados da ra√ß√£o incompletos");return}try{m(!0),h(null),N(null);const Q=t.peso_embalagem||t.peso_pacote_kg||1,ae={especie:"cao",peso_kg:15,fase:"adulto",porte:"medio",tipo_racao:"premium",peso_pacote_kg:parseFloat(Q),preco_pacote:parseFloat(t.preco_unitario)||0};console.log("üßë Modal: Enviando payload:",ae);const w=await P.post("/internal/racao/calcular",ae);w.data?N(w.data):h("Sem resposta do servidor")}catch(Q){console.error("Erro ao calcular:",Q),h(null)}finally{m(!1)}};return!c||E.length===0?(c&&E.length===0&&console.warn("‚ö†Ô∏è Modal: isOpen=true mas racoes.length=0"),null):(console.log("‚úÖ Modal: Renderizando com",E.length,"ra√ß√µes"),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-4 flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ü•´"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Calculadora de Ra√ß√£o"}),e.jsx("p",{className:"text-sm text-blue-100",children:"Informa√ß√µes r√°pidas"})]})]}),e.jsx("button",{onClick:()=>{C()},className:"p-1 hover:bg-blue-400 rounded-lg transition-colors",title:"Fechar",children:e.jsx(ue,{size:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[E.length>1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Selecionar Ra√ß√£o"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>$(!M),className:"w-full px-4 py-2 bg-white border border-gray-300 rounded-lg text-left flex items-center justify-between hover:border-blue-500 transition-colors",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:(t==null?void 0:t.produto_nome)||"Selecione uma ra√ß√£o"}),e.jsx(Pa,{size:20,className:`text-gray-500 transition-transform ${M?"rotate-180":""}`})]}),M&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg z-10 max-h-48 overflow-y-auto",children:E.map((R,Q)=>e.jsxs("button",{onClick:()=>{g(R.produto_id),$(!1),N(null)},className:`w-full px-4 py-3 text-left border-b last:border-b-0 hover:bg-blue-50 transition-colors ${R.produto_id===s?"bg-blue-100 border-l-4 border-l-blue-600":""}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:R.produto_nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:[R.peso_embalagem||R.peso_pacote_kg?`${R.peso_embalagem||R.peso_pacote_kg}kg`:""," ‚Ä¢ R$ ",(R.preco_unitario||0).toFixed(2)]})]},Q))})]})]}),t&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 space-y-2",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:t.produto_nome}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Pacote:"}),e.jsx("span",{className:"font-medium",children:t.peso_pacote_kg?`${t.peso_pacote_kg}kg`:"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Pre√ßo:"}),e.jsxs("span",{className:"font-medium text-blue-600",children:["R$ ",(t.preco_unitario||0).toFixed(2)]})]})]})]}),e.jsx("button",{onClick:q,disabled:F||!t,className:`w-full py-3 rounded-lg font-semibold transition-colors ${F||!t?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white cursor-pointer"}`,children:F?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(qt,{size:18,className:"animate-spin"}),"Calculando..."]}):"üìä Calcular Consumo"}),b&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 space-y-3 border border-green-200",children:[e.jsx("h3",{className:"font-bold text-green-900 text-center",children:"‚úÖ C√°lculo Realizado"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Consumo Di√°rio"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:[(b.consumo_diario_gramas||0).toFixed(0),"g"]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Dura√ß√£o"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:[(b.duracao_pacote_dias||0).toFixed(1),"d"]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/Dia"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(b.custo_diario||0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/M√™s"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(b.custo_mensal||0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100 col-span-2",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/kg"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(b.custo_por_kg||0).toFixed(2)]})]})]})]}),U&&e.jsx("div",{className:"bg-yellow-50 rounded-lg p-3 text-sm text-yellow-700 border border-yellow-200",children:"‚ö†Ô∏è N√£o foi poss√≠vel calcular. Tente novamente."}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 text-xs text-gray-600 border border-gray-200 italic",children:"üí° Valores calculados com base em dados padr√£o. Para an√°lises personalizadas, utilize a calculadora completa."})]}),e.jsx("div",{className:"bg-gray-50 border-t px-6 py-3 flex justify-end gap-3 flex-shrink-0",children:e.jsx("button",{onClick:C,className:"px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-medium transition-colors",children:"Fechar"})})]})}))}function ur({isOpen:n,onClose:C,clienteId:c,produtoId:u=null,onPendenciaAdicionada:s=()=>{}}){const[g,F]=r.useState("listar"),[m,b]=r.useState([]),[N,U]=r.useState([]),[h,M]=r.useState(!1),[$,E]=r.useState(""),[t,q]=r.useState([]),[R,Q]=r.useState(!1),[ae,w]=r.useState(null),S=r.useRef(null),[I,K]=r.useState({produto_id:u||"",quantidade_desejada:1,prioridade:"media",observacoes:""});r.useEffect(()=>{n&&c&&(D(),u||re())},[n,c]),r.useEffect(()=>{if($.trim()==="")q(N);else{const y=N.filter(G=>{var me;return G.nome.toLowerCase().includes($.toLowerCase())||((me=G.codigo)==null?void 0:me.toLowerCase().includes($.toLowerCase()))});q(y)}},[$,N]),r.useEffect(()=>{const y=G=>{S.current&&!S.current.contains(G.target)&&Q(!1)};return document.addEventListener("mousedown",y),()=>{document.removeEventListener("mousedown",y)}},[]);const D=async()=>{try{M(!0);const G=(await P.get(`/pendencias-estoque/cliente/${c}`)).data;b(Array.isArray(G==null?void 0:G.pendencias)?G.pendencias:[])}catch(y){console.error("Erro ao carregar pend√™ncias:",y),Ae.error("Erro ao carregar lista de espera"),b([])}finally{M(!1)}},re=async()=>{var y;try{const G=await P.get("/produtos/",{params:{page:1,page_size:1e3,ativo:!0}}),me=Array.isArray((y=G.data)==null?void 0:y.items)?G.data.items:[];console.log("Produtos carregados:",me.length,me),U(me),q(me)}catch(G){console.error("Erro ao carregar produtos:",G),Ae.error("Erro ao carregar produtos"),U([]),q([])}},le=y=>{w(y),E(y.nome),K({...I,produto_id:y.id}),Q(!1)},ce=()=>{w(null),E(""),K({...I,produto_id:""}),q(N)},v=async()=>{var G,me;if(!I.produto_id){Ae.error("Selecione um produto");return}const y={baixa:0,media:1,alta:2};try{M(!0),await P.post("/pendencias-estoque/",{cliente_id:c,produto_id:parseInt(I.produto_id),quantidade_desejada:parseFloat(I.quantidade_desejada),prioridade:y[I.prioridade]||1,observacoes:I.observacoes||null}),Ae.success("Cliente adicionado √† lista de espera!"),K({produto_id:"",quantidade_desejada:1,prioridade:"media",observacoes:""}),ce(),F("listar"),D(),s()}catch(be){console.error("Erro ao adicionar pend√™ncia:",be),Ae.error(((me=(G=be.response)==null?void 0:G.data)==null?void 0:me.detail)||"Erro ao adicionar √† lista de espera")}finally{M(!1)}},H=async y=>{if(confirm("Deseja realmente cancelar esta pend√™ncia?"))try{await P.delete(`/pendencias-estoque/${y}`),Ae.success("Pend√™ncia cancelada"),D()}catch(G){console.error("Erro ao cancelar pend√™ncia:",G),Ae.error("Erro ao cancelar pend√™ncia")}},J=async(y,G)=>{try{await P.put(`/pendencias-estoque/${y}`,{prioridade:parseInt(G)}),Ae.success("Prioridade atualizada"),D()}catch(me){console.error("Erro ao alterar prioridade:",me),Ae.error("Erro ao alterar prioridade")}};if(!n)return null;const z=y=>{switch(y){case 2:return"text-red-600 bg-red-50";case 1:return"text-yellow-600 bg-yellow-50";case 0:return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},oe=y=>{switch(y){case 2:return"ALTA";case 1:return"M√âDIA";case 0:return"BAIXA";default:return"N/A"}},je=y=>{switch(y){case"pendente":return e.jsx(Va,{className:"w-4 h-4 text-yellow-500"});case"notificado":return e.jsx(Ts,{className:"w-4 h-4 text-blue-500"});case"finalizado":return e.jsx(ua,{className:"w-4 h-4 text-green-500"});default:return e.jsx(Ne,{className:"w-4 h-4 text-gray-500"})}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-blue-50 to-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ne,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Lista de Espera - Produtos Sem Estoque"})]}),e.jsx("button",{onClick:C,className:"text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-200 transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{onClick:()=>F("listar"),className:`flex-1 px-4 py-3 font-medium transition-colors ${g==="listar"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:bg-gray-50"}`,children:["Lista de Espera (",m.length,")"]}),e.jsx("button",{onClick:()=>F("adicionar"),className:`flex-1 px-4 py-3 font-medium transition-colors ${g==="adicionar"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:bg-gray-50"}`,children:"Adicionar Pend√™ncia"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:g==="listar"?e.jsx("div",{className:"space-y-3",children:h?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Carregando..."}):m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ne,{className:"w-16 h-16 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Nenhuma pend√™ncia registrada"}),e.jsx("button",{onClick:()=>F("adicionar"),className:"mt-4 text-blue-600 hover:text-blue-700 font-medium",children:"Adicionar primeira pend√™ncia"})]}):m.map(y=>e.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[je(y.status),e.jsx("h3",{className:"font-semibold text-gray-900",children:y.produto_nome||"Produto n√£o encontrado"}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${z(y.prioridade)}`,children:oe(y.prioridade)})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[y.produto_codigo&&e.jsxs("p",{children:["C√≥digo: ",e.jsx("span",{className:"font-medium",children:y.produto_codigo})]}),e.jsxs("p",{children:["Quantidade: ",y.quantidade_desejada," un."]}),y.valor_referencia&&e.jsxs("p",{children:["Valor ref.: R$ ",parseFloat(y.valor_referencia).toFixed(2)]}),e.jsxs("p",{children:["Status: ",e.jsx("span",{className:"font-medium",children:y.status})]}),e.jsxs("p",{children:["Registrado em: ",new Date(y.data_registro).toLocaleDateString("pt-BR")]}),y.data_notificacao&&e.jsxs("p",{children:["Notificado em: ",new Date(y.data_notificacao).toLocaleDateString("pt-BR")]}),y.observacoes&&e.jsxs("p",{className:"italic",children:["Obs: ",y.observacoes]})]})]}),e.jsx("div",{className:"flex flex-col gap-2 ml-4",children:y.status==="pendente"&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:y.prioridade,onChange:G=>J(y.id,G.target.value),className:"text-xs border rounded px-2 py-1",children:[e.jsx("option",{value:"0",children:"Baixa"}),e.jsx("option",{value:"1",children:"M√©dia"}),e.jsx("option",{value:"2",children:"Alta"})]}),e.jsx("button",{onClick:()=>H(y.id),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Cancelar pend√™ncia",children:e.jsx(wa,{className:"w-4 h-4"})})]})})]})},y.id))}):e.jsxs("div",{className:"space-y-4 max-w-lg mx-auto",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Produto *"}),u?e.jsx("input",{type:"text",value:"Produto selecionado",disabled:!0,className:"w-full px-3 py-2 border rounded-lg bg-gray-50"}):e.jsxs("div",{ref:S,className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ya,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",value:$,onChange:y=>E(y.target.value),onFocus:()=>Q(!0),placeholder:"Digite para buscar o produto...",className:"w-full pl-10 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),$&&e.jsx("button",{type:"button",onClick:ce,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(ue,{className:"w-4 h-4"})})]}),R&&t.length>0&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[t.slice(0,50).map(y=>e.jsxs("button",{type:"button",onClick:()=>le(y),className:"w-full px-4 py-3 text-left hover:bg-blue-50 border-b last:border-b-0 transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900",children:y.nome}),e.jsxs("div",{className:"text-sm text-gray-500",children:[y.codigo&&`C√≥digo: ${y.codigo} ‚Ä¢ `,"Estoque: ",y.estoque_atual||0,y.preco_venda&&` ‚Ä¢ R$ ${parseFloat(y.preco_venda).toFixed(2)}`]})]},y.id)),t.length>50&&e.jsxs("div",{className:"px-4 py-2 text-sm text-gray-500 text-center bg-gray-50",children:["Mostrando 50 de ",t.length," produtos. Continue digitando para refinar."]})]}),R&&$&&t.length===0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg p-4",children:e.jsx("p",{className:"text-gray-500 text-center",children:"Nenhum produto encontrado"})}),ae&&e.jsx("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"‚úì Produto selecionado"}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:ae.nome})]})})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantidade Desejada *"}),e.jsx("input",{type:"number",min:"1",value:I.quantidade_desejada,onChange:y=>K({...I,quantidade_desejada:parseInt(y.target.value)||1}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prioridade"}),e.jsxs("select",{value:I.prioridade,onChange:y=>K({...I,prioridade:y.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"baixa",children:"Baixa - N√£o tem pressa"}),e.jsx("option",{value:"media",children:"M√©dia - Normal"}),e.jsx("option",{value:"alta",children:"Alta - Urgente"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes"}),e.jsx("textarea",{value:I.observacoes,onChange:y=>K({...I,observacoes:y.target.value}),rows:"3",placeholder:"Ex: Cliente pediu para avisar assim que chegar...",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"üì≤ O cliente ser√° notificado automaticamente via WhatsApp"})," quando o produto entrar no estoque."]})}),e.jsx("button",{onClick:v,disabled:h,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition-colors",children:h?"Adicionando...":"Adicionar √† Lista de Espera"})]})})]})})}function Es(n){return n?n.variation_attributes&&typeof n.variation_attributes=="object"?Object.entries(n.variation_attributes).map(([c,u])=>`${c.charAt(0).toUpperCase()+c.slice(1)}: ${u}`).join(" | "):n.variation_signature?n.variation_signature.split("|").map(c=>{const[u,s]=c.split(":");return u&&s?`${u.charAt(0).toUpperCase()+u.slice(1)}: ${s}`:c}).join(" | "):"":""}function wr(){var ss,ts,rs,os,ls,ns,is,ds,cs;const n=ut(),[C]=pt(),{user:c}=bt(),u=(c==null?void 0:c.is_admin)===!0,[s,g]=r.useState({cliente:null,pet:null,itens:[],subtotal:0,desconto_valor:0,desconto_percentual:0,total:0,observacoes:"",funcionario_id:null,entregador_id:null,tem_entrega:!1,entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}}),[F,m]=r.useState(""),[b,N]=r.useState(""),[U,h]=r.useState([]),[M,$]=r.useState([]),[E,t]=r.useState(!1),[q,R]=r.useState(!1),[Q,ae]=r.useState(!1),[w,S]=r.useState(!1),[I,K]=r.useState(!1),[D,re]=r.useState(!1),[le,ce]=r.useState(0),[v,H]=r.useState(null),[J,z]=r.useState([]),[oe,je]=r.useState("24h"),[y,G]=r.useState("todas"),[me,be]=r.useState(!1),[ke,ze]=r.useState(""),[x,k]=r.useState(!1),[_,V]=r.useState(!1),[se,A]=r.useState(""),[he,xe]=r.useState(0),[te,ne]=r.useState(!1),[Ve,Ee]=r.useState(!1),[ee,ve]=r.useState(null),[Ce,Te]=r.useState(!1),[ta,Ue]=r.useState(!1),[L,Re]=r.useState(null),[Ca,We]=r.useState(!1),[Le,pa]=r.useState("valor"),[Pe,ba]=r.useState(0),[l,f]=r.useState(!1),[j,O]=r.useState(null),[ie,W]=r.useState([]),[de,De]=r.useState(""),[Fe,pe]=r.useState(null),[$e,fe]=r.useState([]),[Y,Me]=r.useState(null),[ra,Ie]=r.useState(0);r.useEffect(()=>{g(a=>({...a,funcionario_id:(j==null?void 0:j.id)||null}))},[j]),r.useEffect(()=>{console.log("üîÑ Sincronizando entregador_id:",(Y==null?void 0:Y.id)||null),g(a=>({...a,entregador_id:(Y==null?void 0:Y.id)||null}))},[Y]);const[qa,Fa]=r.useState(!1),[Ms,Is]=r.useState(null),[qs,za]=r.useState(!1),[zs,Ls]=r.useState({}),[Oe,La]=r.useState(()=>{const a=localStorage.getItem("pdv_painel_vendas_aberto");return a?JSON.parse(a):!1}),[He,Os]=r.useState(()=>{const a=localStorage.getItem("pdv_painel_cliente_aberto");return a?JSON.parse(a):!1}),[Bs,Oa]=r.useState(!1),[Ye,oa]=r.useState([]),[pr,Ba]=r.useState({}),[Ka,Qa]=r.useState(0),[Ua,Ks]=r.useState(!1),[Qs,Us]=r.useState(null),Ha=r.useRef(null);r.useEffect(()=>{localStorage.setItem("pdv_painel_vendas_aberto",JSON.stringify(Oe))},[Oe]),r.useEffect(()=>{s.cliente&&Ga()},[s.cliente]),r.useEffect(()=>{var a;s.itens&&s.itens.length>0?sessionStorage.setItem("pdv_calculadora_data",JSON.stringify({itens:s.itens,clienteId:((a=s.cliente)==null?void 0:a.id)||null})):sessionStorage.removeItem("pdv_calculadora_data")},[s.itens,s.cliente]),r.useEffect(()=>{localStorage.setItem("pdv_painel_cliente_aberto",JSON.stringify(He))},[He]),r.useEffect(()=>{Ja();const a=setInterval(()=>{Ja()},3e4);return()=>clearInterval(a)},[he]);const Ja=async()=>{try{const a=await P.get("/caixas/aberto");ne(!!a.data)}catch{ne(!1)}};r.useEffect(()=>{Hs()},[]);const Hs=async()=>{try{const a=await P.get("/clientes/",{params:{is_entregador:!0,incluir_inativos:!1,limit:100}});let o=a.data.items||a.data.clientes||a.data||[];Array.isArray(o)||(console.error("‚ùå Resposta da API n√£o √© um array:",o),o=[]),fe(o);const d=o.find(i=>i.entregador_padrao===!0);d&&(Me(d),g(i=>({...i,entregador_id:d.id})),la(d))}catch(a){console.error("Erro ao carregar entregadores:",a),Ae.error("Erro ao carregar lista de entregadores")}},la=async a=>{if(!a){Ie(0);return}let o=0;if(a.modelo_custo_entrega==="taxa_fixa"&&a.taxa_fixa_entrega)o=Number(a.taxa_fixa_entrega);else if(a.modelo_custo_entrega==="por_km"&&a.valor_por_km_entrega)o=0;else if(a.modelo_custo_entrega==="rateio_rh"&&a.controla_rh)try{o=(await P.get(`/entregadores/${a.id}/custo-operacional`)).data.custo_por_entrega||0}catch(d){console.error("Erro ao buscar custo RH:",d),o=a.custo_rh_ajustado||0}else try{o=(await P.get("/configuracoes/entregas")).data.taxa_fixa||0}catch(d){console.error("Erro ao buscar configura√ß√£o de entrega:",d),o=10}Ie(o)};r.useEffect(()=>{s.tem_entrega&&Y?la(Y):Ie(0)},[Y,s.tem_entrega]);const Ga=async()=>{if(!s.cliente){ce(0);return}try{const o=(await P.get(`/pendencias-estoque/cliente/${s.cliente.id}`)).data.filter(d=>d.status==="pendente"||d.status==="notificado");ce(o.length)}catch{ce(0)}},Js=async a=>{if(!a||!s.cliente){oa([]);return}try{const d=(await P.get(`/internal/pdv/oportunidades/${a}`)).data;d&&Array.isArray(d.oportunidades)?oa(d.oportunidades):oa([])}catch{oa([])}},Sa=async(a,o)=>{try{const d={opportunity_id:o.id,event_type:a,user_id:c==null?void 0:c.id,contexto:"PDV",extra_data:{produto_origem_id:o.produto_origem_id||null,produto_sugerido_id:o.produto_sugerido_id||null,tipo_oportunidade:o.tipo||null,venda_id:s.id||null}};P.post("/internal/pdv/eventos-oportunidade",d).catch(()=>{})}catch{}};async function Gs(a){try{const o={produto_id:a.produto_id,preco_unitario:a.preco_unitario,quantidade:a.quantidade},{data:d}=await P.post("/pdv/fiscal/calcular",o);return d}catch(o){return console.error("Erro ao calcular fiscal:",o),null}}r.useEffect(()=>{async function a(){let o=0;const d={};for(const i of s.itens){const p=await Gs(i);p&&(d[i.produto_id]=p,o+=Number(p.total_impostos))}Ba(d),Qa(o.toFixed(2))}s.itens&&s.itens.length>0?a():(Ba({}),Qa(0))},[s.itens]),r.useEffect(()=>{na()},[oe,y,me,ke]),r.useEffect(()=>{const a=C.get("venda");a&&ha(parseInt(a))},[C]),r.useEffect(()=>{const a=sessionStorage.getItem("abrirVenda"),o=sessionStorage.getItem("abrirModalPagamento");a&&o==="true"&&(sessionStorage.removeItem("abrirVenda"),sessionStorage.removeItem("abrirModalPagamento"),ha(parseInt(a),!0))},[]);const Xs=()=>{ve({tipo:"entrega",apelido:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",estado:""}),Ee(!0)},ka=()=>{Ee(!1),ve(null)},Ws=async a=>{if(!(!a||a.length!==9)){Te(!0);try{const d=await(await fetch(`https://viacep.com.br/ws/${a.replace("-","")}/json/`)).json();if(d.erro){alert("CEP n√£o encontrado");return}ve(i=>({...i,endereco:d.logradouro||"",bairro:d.bairro||"",cidade:d.localidade||"",estado:d.uf||""}))}catch(o){console.error("Erro ao buscar CEP:",o),alert("Erro ao buscar CEP")}finally{Te(!1)}}},Ys=async()=>{if(!ee.cep||!ee.endereco||!ee.cidade){alert("Preencha pelo menos CEP, Endere√ßo e Cidade");return}if(!s.cliente||!s.cliente.id){alert("Selecione um cliente primeiro");return}try{const a=await ca(s.cliente.id),o=a.enderecos_adicionais||[];o.push({...ee}),await P.put(`/clientes/${s.cliente.id}`,{...a,enderecos_adicionais:o});const d=await ca(s.cliente.id);g({...s,cliente:d}),alert("Endere√ßo adicionado com sucesso!"),ka()}catch(a){console.error("Erro ao salvar endere√ßo:",a),alert("Erro ao salvar endere√ßo. Tente novamente.")}},Zs=a=>{Re({...a,preco:a.preco_unitario,descontoValor:a.desconto_valor||0,descontoPercentual:a.desconto_percentual||0,tipoDesconto:"valor"}),Ue(!0)},et=()=>{const a=s.itens.map(o=>{if(o.produto_id===L.produto_id){const d=L.preco,i=o.quantidade,p=d*i;let T=0,B=0;L.tipoDesconto==="valor"?(T=parseFloat(L.descontoValor)||0,B=p>0?T/p*100:0):(B=parseFloat(L.descontoPercentual)||0,T=p*B/100);const Z=d-T/i,ge=p-T;return{...o,desconto_valor:T,desconto_percentual:B,tipo_desconto_aplicado:L.tipoDesconto,preco_com_desconto:Z,subtotal:ge}}return o});ia(a),Ue(!1),Re(null)},at=()=>{We(!0)},st=(a,o)=>{var Z;const d=s.subtotal;let i=0,p=0;a==="valor"?(i=parseFloat(o)||0,p=d>0?i/d*100:0):(p=parseFloat(o)||0,i=d*p/100);const T=s.tem_entrega&&((Z=s.entrega)==null?void 0:Z.taxa_entrega_total)||0,B=d-i+T;g({...s,desconto_valor:i,desconto_percentual:p,total:B}),We(!1)},na=async()=>{try{const a=new Date;let o;oe==="24h"?o=new Date(a.getTime()-24*60*60*1e3):oe==="7d"?o=new Date(a.getTime()-7*24*60*60*1e3):o=new Date(a.getTime()-30*24*60*60*1e3);const d={data_inicio:o.toISOString().split("T")[0],data_fim:a.toISOString().split("T")[0],per_page:50};ke.trim()?(d.busca=ke.trim(),delete d.data_inicio,delete d.data_fim):(y==="pago"?d.status="finalizada":y==="aberta"&&(d.status="aberta"),me===!0&&(d.tem_entrega=!0)),console.log("üìä Par√¢metros de busca de vendas:",d);const i=await $s(d);z(i.vendas||[])}catch(a){console.error("Erro ao carregar vendas:",a)}},ha=async(a,o=!1)=>{var d;try{k(!0);const i=await va(a);if(!i){alert("Venda n√£o encontrada");return}let p=null;if(i.cliente_id)try{p=await ca(i.cliente_id)}catch(X){console.error("Erro ao buscar cliente:",X)}let T=[],B=0;try{const X=await P.get(`/vendas/${a}/pagamentos`);T=X.data.pagamentos||[],B=X.data.total_pago||0}catch(X){console.error("Erro ao buscar pagamentos:",X)}console.log("üîç Venda carregada - funcionario_id:",i.funcionario_id);let Z=null;if(i.funcionario_id)try{const ye=((d=(await P.get("/comissoes/configuracoes/funcionarios")).data)==null?void 0:d.data)||[];console.log("üìã Funcion√°rios dispon√≠veis:",ye),Z=ye.find(Se=>Se.id===i.funcionario_id),Z?(f(!0),O(Z),console.log("‚úÖ Funcion√°rio comiss√£o carregado:",Z)):console.warn("‚ö†Ô∏è Funcion√°rio ID",i.funcionario_id,"n√£o encontrado na lista")}catch(X){console.error("Erro ao carregar funcion√°rio de comiss√£o:",X)}else console.log("‚ÑπÔ∏è Venda sem funcionario_id - limpando estados de comiss√£o"),f(!1),O(null),De("");const ge={id:i.id,numero_venda:i.numero_venda,status:i.status,data_venda:i.data_venda,cliente:p,pet:null,itens:i.itens||[],subtotal:i.subtotal||0,desconto_valor:i.desconto_valor||0,desconto_percentual:i.desconto_percentual||0,total:i.total||0,observacoes:i.observacoes||"",funcionario_id:i.funcionario_id||null,entregador_id:i.entregador_id||null,tem_entrega:i.tem_entrega||!1,entrega:i.entrega||{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""},pagamentos:T,total_pago:B};if(g(ge),V(!0),i.entregador_id){console.log("üîç Venda tem entregador_id:",i.entregador_id);try{const ye=(await P.get(`/clientes/${i.entregador_id}`)).data;ye&&ye.is_entregador?(console.log("‚úÖ Entregador carregado:",ye.nome),Me(ye),la(ye)):console.warn("‚ö†Ô∏è Cliente ID",i.entregador_id,"n√£o √© um entregador v√°lido")}catch(X){console.error("‚ùå Erro ao carregar entregador:",X);const ye=$e.find(Se=>Se.id===i.entregador_id);ye&&(console.log("‚úÖ Entregador encontrado no array (fallback):",ye.nome),Me(ye),la(ye))}}else console.log("‚ÑπÔ∏è Venda sem entregador_id - limpando entregadorSelecionado"),Me(null);o&&setTimeout(()=>{t(!0)},500)}catch(i){console.error("Erro ao carregar venda:",i),alert("Erro ao carregar venda: "+(i.message||"Erro desconhecido"))}finally{k(!1)}},Xa=async()=>{var a;if(se.trim())try{k(!0);const o=se.replace(/\D/g,"");if(!o){alert("Digite um n√∫mero de venda v√°lido"),k(!1);return}console.log("üîç Buscando venda com n√∫mero:",o);const d=await $s({busca:o,per_page:50});if(console.log("üìä Vendas encontradas:",(a=d.vendas)==null?void 0:a.length),!d.vendas||d.vendas.length===0){alert(`Nenhuma venda encontrada com "${o}"`),k(!1);return}if(d.vendas.length===1){await ha(d.vendas[0].id),A("");return}const i=d.vendas.slice(0,10).map((B,Z)=>`${Z+1}. ${B.numero_venda} - ${B.cliente_nome||"Sem cliente"} - ${B.status}`).join(`
`),p=prompt(`Encontradas ${d.vendas.length} vendas. Digite o n√∫mero da op√ß√£o:

${i}`),T=parseInt(p)-1;T>=0&&T<d.vendas.length&&(await ha(d.vendas[T].id),A(""))}catch(o){console.error("Erro ao buscar venda:",o),alert("Erro ao buscar venda: "+(o.message||"Erro desconhecido"))}finally{k(!1)}};r.useEffect(()=>{if(F.length>=2){const a=setTimeout(async()=>{try{const o=await Gt({search:F});h(o||[])}catch(o){console.error("Erro ao buscar clientes:",o),h([])}},300);return()=>clearTimeout(a)}else h([])},[F]),r.useEffect(()=>{if(b.length>=2){const a=setTimeout(async()=>{try{const d=(await ht({busca:b})).data.items||[];$(d)}catch(o){console.error("Erro ao buscar produtos:",o),$([])}},300);return()=>clearTimeout(a)}else $([])},[b]);const Wa=async a=>{g({...s,cliente:a,pet:null}),m(""),h([]);try{const o=await P.get(`/clientes/${a.id}/vendas-em-aberto`);o.data.resumo.total_vendas>0?H(o.data.resumo):H(null)}catch(o){console.error("Erro ao verificar vendas em aberto:",o),H(null)}},tt=a=>{g({...s,pet:a})},rt=a=>{var i,p;if(!te){alert("‚ùå N√£o √© poss√≠vel adicionar produtos sem caixa aberto. Abra um caixa primeiro.");return}console.log("üõí Produto sendo adicionado:",{nome:a.nome,categoria_id:a.categoria_id,categoria_nome:a.categoria_nome,peso_embalagem:a.peso_embalagem,classificacao_racao:a.classificacao_racao});const o=s.itens.find(T=>T.produto_id===a.id);let d;o?d=s.itens.map(T=>T.produto_id===a.id?{...T,quantidade:T.quantidade+1,subtotal:(T.quantidade+1)*T.preco_unitario}:T):d=[...s.itens,{tipo:"produto",produto_id:a.id,produto_nome:a.nome,quantidade:1,preco_unitario:parseFloat(a.preco_venda),desconto_item:0,subtotal:parseFloat(a.preco_venda),pet_id:((i=s.pet)==null?void 0:i.id)||null,tipo_produto:a.tipo_produto,tipo_kit:a.tipo_kit,composicao_kit:a.composicao_kit||[],categoria_id:a.categoria_id,categoria_nome:a.categoria_nome,peso_pacote_kg:a.peso_liquido||a.peso_bruto,peso_embalagem:a.peso_embalagem,classificacao_racao:a.classificacao_racao}],ia(d),N(""),$([]),(p=Ha.current)==null||p.focus()},Ya=(a,o)=>{const d=s.itens.map((i,p)=>{if(p===a){const T=Math.max(1,i.quantidade+o),B=T*i.preco_unitario;let Z=i.desconto_valor||0;i.tipo_desconto_aplicado==="percentual"&&i.desconto_percentual>0&&(Z=B*i.desconto_percentual/100);const ge=B-Z;return{...i,quantidade:T,desconto_valor:Z,subtotal:ge}}return i});ia(d)},Za=a=>{const o=s.itens.filter((d,i)=>i!==a);ia(o)},ot=a=>{Ls(o=>({...o,[a]:!o[a]}))},ia=a=>{var Z;const o=a.reduce((ge,X)=>ge+X.subtotal,0),d=a.reduce((ge,X)=>ge+(X.desconto_valor||0),0),i=o+d,p=i>0?d/i*100:0,T=s.tem_entrega&&((Z=s.entrega)==null?void 0:Z.taxa_entrega_total)||0,B=o+T;g({...s,itens:a,subtotal:o,desconto_valor:d,desconto_percentual:p,total:B})},es=async()=>{var a,o,d,i,p,T,B,Z,ge,X,ye,Se,Je,Ze,fa,xs,ms,us,gs,ps,bs,hs,fs,js;if(s.itens.length===0){alert("Adicione pelo menos um produto ou servi√ßo");return}if(!te){alert("‚ùå N√£o √© poss√≠vel salvar venda sem caixa aberto. Abra um caixa primeiro.");return}if(!x){k(!0);try{if(s.id){await P.put(`/vendas/${s.id}`,{cliente_id:(a=s.cliente)==null?void 0:a.id,funcionario_id:s.funcionario_id,itens:s.itens.map(_e=>{var da;return{tipo:_e.tipo,produto_id:_e.produto_id,servico_descricao:_e.servico_descricao,quantidade:_e.quantidade,preco_unitario:_e.preco_unitario||_e.preco_venda,desconto_item:0,subtotal:_e.subtotal,lote_id:_e.lote_id,pet_id:_e.pet_id||((da=s.pet)==null?void 0:da.id)}}),desconto_valor:0,desconto_percentual:0,observacoes:s.observacoes,tem_entrega:s.tem_entrega,taxa_entrega:((o=s.entrega)==null?void 0:o.taxa_entrega_total)||0,endereco_entrega:(d=s.entrega)==null?void 0:d.endereco_completo,observacoes_entrega:(i=s.entrega)==null?void 0:i.observacoes_entrega,distancia_km:(p=s.entrega)==null?void 0:p.distancia_km,valor_por_km:(T=s.entrega)==null?void 0:T.valor_por_km,loja_origem:(B=s.entrega)==null?void 0:B.loja_origem,entregador_id:s.entregador_id}),console.log("üö® DEBUG - Payload sendo enviado:",{tem_entrega:s.tem_entrega,entregador_id:s.entregador_id,vendaAtual_completo:s});let we=0;try{we=(await P.get(`/vendas/${s.id}/pagamentos`)).data.total_pago||0}catch(_e){console.error("Erro ao buscar pagamentos:",_e)}const Ge=s.total;let Ke="aberta";we>=Ge-.01?Ke="finalizada":we>0&&(Ke="baixa_parcial"),s.status!==Ke&&(await P.patch(`/vendas/${s.id}/status`,{status:Ke}),console.log(`‚úÖ Status atualizado: ${s.status} ‚Üí ${Ke}`)),alert("Venda atualizada com sucesso!"),Be()}else{console.log("üöÄ CRIANDO VENDA - Vers√£o 2.0 - DESCONTOS ZERADOS"),console.log("Desconto valor:",0),console.log("Desconto percentual:",0),console.log("‚úÖ Checkbox Venda Comissionada:",l),console.log("üíº Funcion√°rio Comiss√£o:",j),console.log("üìã Funcion√°rio ID enviado:",(j==null?void 0:j.id)||null),l&&!j&&console.error("‚ö†Ô∏è ERRO: Checkbox marcado mas funcion√°rio n√£o selecionado!");const we=((Z=s.entrega)==null?void 0:Z.taxa_entrega_total)||0,Ge=((ge=s.entrega)==null?void 0:ge.taxa_loja)||0,Ke=((X=s.entrega)==null?void 0:X.taxa_entregador)||0,_e=we>0?Ge/we*100:100,da=we>0?Ke/we*100:0,vs={cliente_id:(ye=s.cliente)==null?void 0:ye.id,funcionario_id:s.funcionario_id,itens:s.itens.map(qe=>{var ys;return{tipo:qe.tipo,produto_id:qe.produto_id,servico_descricao:qe.servico_descricao,quantidade:qe.quantidade,preco_unitario:qe.preco_unitario||qe.preco_venda,desconto_item:0,subtotal:qe.subtotal,lote_id:qe.lote_id,pet_id:qe.pet_id||((ys=s.pet)==null?void 0:ys.id)}}),desconto_valor:0,desconto_percentual:0,observacoes:s.observacoes,tem_entrega:s.tem_entrega,taxa_entrega:((Se=s.entrega)==null?void 0:Se.taxa_entrega_total)||0,percentual_taxa_loja:_e,percentual_taxa_entregador:da,endereco_entrega:(Je=s.entrega)==null?void 0:Je.endereco_completo,observacoes_entrega:(Ze=s.entrega)==null?void 0:Ze.observacoes_entrega,distancia_km:(fa=s.entrega)==null?void 0:fa.distancia_km,valor_por_km:(xs=s.entrega)==null?void 0:xs.valor_por_km,loja_origem:(ms=s.entrega)==null?void 0:ms.loja_origem,entregador_id:s.entregador_id};console.log("üì¶ PAYLOAD COMPLETO antes de enviar:",JSON.stringify(vs,null,2)),console.log("üöö Dados de entrega:",{tem_entrega:s.tem_entrega,entregador_id:s.entregador_id,entregadorSelecionado:Y==null?void 0:Y.id,vendaAtual_completo:s}),console.log("üí∞ Percentuais calculados:",{taxaTotal:we,taxaLoja:Ge,taxaEntregador:Ke,percentualLoja:`${_e.toFixed(2)}%`,percentualEntregador:`${da.toFixed(2)}%`}),await Vs(vs),alert("Venda salva com sucesso!"),Be()}na()}catch(we){console.error("‚ùå Erro ao salvar venda:",we),console.error("‚ùå Resposta do servidor:",(us=we.response)==null?void 0:us.data),console.error("‚ùå Status:",(gs=we.response)==null?void 0:gs.status),console.error("‚ùå Headers:",(ps=we.response)==null?void 0:ps.headers);const Ge=((hs=(bs=we.response)==null?void 0:bs.data)==null?void 0:hs.detail)||((js=(fs=we.response)==null?void 0:fs.data)==null?void 0:js.message)||"Erro ao salvar venda";console.error("‚ùå Detalhes do erro:",Ge),alert(`Erro ao salvar venda: ${Ge}`)}finally{k(!1)}}},lt=async a=>{var o;console.log("üîç DEBUG formasPagamento recebidas:",a),za(!0),Fa(!0);try{console.log("üí∞ Enviando an√°lise com m√∫ltiplas formas:",a);const d=await P.post("/formas-pagamento/analisar-venda",{items:s.itens.map(i=>({produto_id:i.produto_id,quantidade:i.quantidade,preco_venda:i.preco_unitario||i.preco_venda,custo:i.custo})),desconto:s.desconto_valor||0,taxa_entrega:((o=s.entrega)==null?void 0:o.taxa_entrega_total)||0,formas_pagamento:a,vendedor_id:s.funcionario_id});console.log("‚úÖ Resposta da an√°lise:",d.data),Is(d.data)}catch(d){console.error("Erro ao buscar an√°lise:",d),alert("Erro ao carregar an√°lise da venda"),Fa(!1)}finally{za(!1)}},as=()=>{if(s.itens.length===0){alert("Adicione pelo menos um produto ou servi√ßo");return}if(s.status==="finalizada"||s.status==="pago_nf"){alert('Esta venda est√° finalizada. Clique em "Reabrir Venda" para modificar.');return}t(!0)},Be=()=>{g({cliente:null,pet:null,itens:[],subtotal:0,desconto_valor:0,desconto_percentual:0,total:0,observacoes:"",funcionario_id:null,entregador_id:(Y==null?void 0:Y.id)||null,tem_entrega:!1,entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}}),f(!1),O(null),De(""),V(!1)},nt=async a=>{var o,d,i;try{const p=await va(a.id);let T=null;p.cliente_id&&(T=await ca(p.cliente_id));let B=[],Z=0;try{const X=await P.get(`/vendas/${a.id}/pagamentos`);B=X.data.pagamentos||[],Z=X.data.total_pago||0}catch(X){console.error("Erro ao buscar pagamentos:",X)}if(console.log("üîç Venda carregada - funcionario_id:",p.funcionario_id),p.funcionario_id)try{const Se=(((o=(await P.get("/comissoes/configuracoes/funcionarios")).data)==null?void 0:o.data)||[]).find(Je=>Je.id===p.funcionario_id);Se?(f(!0),O(Se),console.log("‚úÖ Funcion√°rio comiss√£o carregado:",Se)):console.warn("‚ö†Ô∏è Funcion√°rio ID",p.funcionario_id,"n√£o encontrado na lista")}catch(X){console.error("Erro ao carregar funcion√°rio de comiss√£o:",X)}else console.log("‚ÑπÔ∏è Venda sem funcionario_id - limpando estados de comiss√£o"),f(!1),O(null),De("");const ge={id:p.id,numero_venda:p.numero_venda,data_venda:p.data_venda,cliente:T,pet:null,itens:p.itens||[],subtotal:parseFloat(p.subtotal||p.total),desconto_valor:parseFloat(p.desconto_valor||0),desconto_percentual:parseFloat(p.desconto_percentual||0),total:parseFloat(p.total),observacoes:p.observacoes||"",status:p.status,tem_entrega:p.tem_entrega||!1,entregador_id:p.entregador_id||null,entrega:{endereco_completo:p.endereco_entrega||"",endereco_id:p.endereco_id||null,taxa_entrega_total:parseFloat(parseFloat(p.taxa_entrega||0).toFixed(2)),taxa_loja:parseFloat(parseFloat(((d=p.entrega)==null?void 0:d.taxa_loja)||0).toFixed(2)),taxa_entregador:parseFloat(parseFloat(((i=p.entrega)==null?void 0:i.taxa_entregador)||0).toFixed(2)),observacoes_entrega:p.observacoes_entrega||"",distancia_km:p.distancia_km||0,valor_por_km:p.valor_por_km||0,loja_origem:p.loja_origem||"",status_entrega:p.status_entrega||"pendente"},pagamentos:B,total_pago:Z};g(ge),V(!0),window.scrollTo({top:0,behavior:"smooth"})}catch(p){console.error("Erro ao reabrir venda:",p),alert("Erro ao carregar os dados da venda")}},it=()=>{V(!1)},dt=async()=>{if(!s.id){Be();return}if(Fe&&s.status!==Fe)try{k(!0),await P.patch(`/vendas/${s.id}/status`,{status:Fe}),console.log(`‚úÖ Status restaurado para: ${Fe} (altera√ß√µes descartadas)`)}catch(a){console.error("Erro ao restaurar status:",a)}finally{k(!1)}pe(null),Be()},ct=async()=>{var o,d;if(!(!s.id||!window.confirm(`Deseja realmente excluir esta venda?

Esta a√ß√£o n√£o pode ser desfeita e o estoque ser√° devolvido.`)))try{k(!0),await P.delete(`/vendas/${s.id}`),Be(),na(),alert("Venda exclu√≠da com sucesso!")}catch(i){console.error("Erro ao excluir venda:",i);const p=(d=(o=i.response)==null?void 0:o.data)==null?void 0:d.detail;if(p&&typeof p=="object"){let T=`‚ùå ${p.erro||"Erro ao excluir venda"}

`;T+=`${p.mensagem||""}

`,p.solucao&&(T+=`üí° Solu√ß√£o:
${p.solucao}

`),p.passos&&Array.isArray(p.passos)&&(T+=`üìã Passos para resolver:
`,p.passos.forEach(B=>{T+=`${B}
`})),p.rota_id&&(T+=`
üöö Rota ID: ${p.rota_id}`,p.rota_status&&(T+=` (${p.rota_status})`)),alert(T)}else alert(typeof p=="string"?p:"Erro ao excluir venda. Verifique se n√£o h√° v√≠nculos pendentes.")}finally{k(!1)}},xt=async()=>{var o,d;if(!(!s.id||!window.confirm(`Deseja reabrir esta venda?

Os pagamentos ser√£o mantidos e o status mudar√° para "aberta".`))){pe(s.status);try{k(!0),await P.post(`/vendas/${s.id}/reabrir`);const i=await va(s.id);let p=null;i.cliente_id&&(p=await ca(i.cliente_id)),g({id:i.id,numero_venda:i.numero_venda,data_venda:i.data_venda,cliente:p,pet:null,itens:i.itens||[],subtotal:parseFloat(i.subtotal||i.total),desconto_valor:parseFloat(i.desconto_valor||0),desconto_percentual:parseFloat(i.desconto_percentual||0),total:parseFloat(i.total),observacoes:i.observacoes||"",status:"aberta",tem_entrega:i.tem_entrega||!1,entrega:{endereco_completo:i.endereco_entrega||"",endereco_id:i.endereco_id||null,taxa_entrega_total:parseFloat(parseFloat(i.taxa_entrega||0).toFixed(2)),taxa_loja:parseFloat(parseFloat(i.taxa_loja||0).toFixed(2)),taxa_entregador:parseFloat(parseFloat(i.taxa_entregador||0).toFixed(2)),observacoes_entrega:i.observacoes_entrega||"",distancia_km:i.distancia_km||0,valor_por_km:i.valor_por_km||0,loja_origem:i.loja_origem||"",status_entrega:i.status_entrega||"pendente"}}),V(!1),alert(`Venda reaberta com sucesso! Agora voc√™ pode edit√°-la.

ATEN√á√ÉO: Se voc√™ n√£o fizer altera√ß√µes e sair, a venda voltar√° ao status anterior.`)}catch(i){console.error("Erro ao reabrir venda:",i),alert(((d=(o=i.response)==null?void 0:o.data)==null?void 0:d.detail)||"Erro ao reabrir venda")}finally{k(!1)}}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"bg-white border-b px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(zt,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Ponto de Venda"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Buscar venda (Ex: 0011)",value:se,onChange:a=>A(a.target.value),onKeyPress:a=>{a.key==="Enter"&&se.trim()&&Xa()},className:"pl-10 pr-4 py-2 w-64 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"}),e.jsx(ya,{className:"w-5 h-5 text-gray-400 absolute left-3 top-2.5"})]}),e.jsx("button",{onClick:Xa,disabled:!se.trim()||x,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Buscar"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[s.cliente&&e.jsxs("button",{onClick:()=>re(!0),className:"flex items-center space-x-2 px-4 py-2 bg-white hover:bg-orange-50 border-2 border-orange-400 rounded-lg transition-colors relative",title:"Lista de espera - Produtos sem estoque",children:[e.jsx(Ts,{className:"w-5 h-5 text-orange-500"}),le>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center",children:le})]}),s.cliente&&e.jsxs("button",{onClick:()=>{Oa(!0),s.id&&Js(s.id)},className:"flex items-center space-x-2 px-4 py-2 bg-white hover:bg-yellow-50 border-2 border-yellow-400 rounded-lg transition-colors",title:"Ver oportunidades de venda",children:[e.jsx(Fs,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"}),Ye.length>0&&e.jsx("span",{className:"font-semibold text-yellow-600",children:Math.min(Ye.length,6)})]}),e.jsx(lr,{onAbrirCaixa:()=>ae(!0)},he),e.jsxs("button",{onClick:()=>n("/meus-caixas"),className:"flex items-center space-x-2 px-4 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-colors",title:"Ver hist√≥rico de caixas",children:[e.jsx(Na,{className:"w-5 h-5"}),e.jsx("span",{children:"Meus Caixas"})]}),!_&&s.id&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:dt,disabled:x,className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ue,{className:"w-5 h-5"}),e.jsx("span",{children:"Cancelar Edi√ß√£o"})]}),e.jsxs("button",{onClick:ct,disabled:x,className:"flex items-center space-x-2 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(wa,{className:"w-5 h-5"}),e.jsx("span",{children:"Excluir"})]})]}),e.jsxs("button",{onClick:es,disabled:x||_||!te,className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:te?"Salvar venda atual":"üîí Caixa fechado - Abra o caixa para salvar vendas",children:[e.jsx(Ss,{className:"w-5 h-5"}),e.jsx("span",{children:"Salvar"}),!te&&e.jsx("span",{className:"text-xs",children:"üîí"})]}),e.jsxs("button",{onClick:as,disabled:x||s.status==="finalizada"||s.status==="pago_nf"||!te,className:"flex items-center space-x-2 px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:te?"Registrar pagamento da venda":"üîí Caixa fechado - Abra o caixa para registrar recebimentos",children:[e.jsx(Da,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"}),!te&&e.jsx("span",{className:"text-xs",children:"üîí"})]})]})]})}),!te&&!_&&e.jsx("div",{className:"bg-red-50 border-b border-red-200 px-6 py-3",children:e.jsx("div",{className:"flex items-center justify-center max-w-5xl mx-auto",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-800",children:[e.jsx(Ne,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold text-lg",children:"üîí CAIXA FECHADO"}),e.jsx("span",{className:"text-sm",children:"- √â necess√°rio abrir o caixa para registrar vendas e recebimentos"})]})})}),s.id&&s.numero_venda&&e.jsx("div",{className:"bg-blue-50 border-b border-blue-200 px-4 py-1.5",children:e.jsxs("div",{className:"flex items-center justify-between max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-blue-800",children:"Venda:"}),e.jsxs("div",{className:"flex items-center gap-1.5 bg-white px-2 py-0.5 rounded border border-blue-300",children:[e.jsxs("span",{className:"font-bold text-blue-700 text-sm",children:["#",s.numero_venda]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(s.numero_venda);const a=event.target.closest("button"),o=a.innerHTML;a.innerHTML="‚úì",a.classList.add("text-green-600"),setTimeout(()=>{a.innerHTML=o,a.classList.remove("text-green-600")},1500)},className:"text-blue-600 hover:text-blue-800 transition-colors text-xs",title:"Copiar n√∫mero da venda",children:"üìã"})]})]}),s.data_venda&&e.jsx("span",{className:"text-xs text-blue-600",children:(()=>{const a=s.data_venda;if(typeof a=="string"&&a.includes("T")){const[o]=a.split("T"),[d,i,p]=o.split("-");return`${p}/${i}/${d}`}return new Date(a).toLocaleDateString("pt-BR")})()})]})}),_&&e.jsx("div",{className:"bg-yellow-50 border-b border-yellow-200 px-6 py-3",children:e.jsxs("div",{className:"flex items-center justify-between max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-800",children:[e.jsx(Ne,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Modo Visualiza√ß√£o - Venda ",s.status==="finalizada"?"Finalizada":s.status==="baixa_parcial"?"com Baixa Parcial":"Aberta"]}),e.jsx("span",{className:"text-sm",children:"(Clique em Editar para modificar)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(nr,{venda:s}),e.jsxs("button",{onClick:()=>{V(!1),Be()},className:"flex items-center gap-2 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(ue,{className:"w-4 h-4"}),"Voltar"]}),(s.status==="finalizada"||s.status==="baixa_parcial")&&e.jsxs("button",{onClick:xt,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Reabrir Venda"]}),s.status==="aberta"&&e.jsx("button",{onClick:it,className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg font-medium transition-colors",children:"Editar"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"max-w-5xl mx-auto space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(ks,{className:"w-5 h-5 mr-2 text-blue-600"}),"Cliente"]}),s.cliente&&!_&&e.jsx("button",{onClick:()=>g({...s,cliente:null,pet:null}),className:"text-sm text-red-600 hover:text-red-700",children:"Remover"})]}),s.cliente?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-blue-900",children:s.cliente.nome}),e.jsxs("div",{className:"text-sm text-blue-700 mt-1",children:[s.cliente.cpf&&`CPF: ${s.cliente.cpf}`,s.cliente.telefone&&` ‚Ä¢ Tel: ${s.cliente.telefone}`]})]})}),s.cliente.credito>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Na,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Cr√©dito Dispon√≠vel:"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",parseFloat(s.cliente.credito||0).toFixed(2).replace(".",",")]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"üí° Este cr√©dito pode ser usado como forma de pagamento"})]}),v&&v.total_vendas>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-blue-300",children:e.jsxs("div",{className:"flex items-center justify-between p-2 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lt,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-yellow-900",children:[v.total_vendas," venda(s) em aberto"]}),e.jsxs("div",{className:"text-xs text-yellow-700",children:["Total: R$ ",v.total_em_aberto.toFixed(2)]})]})]}),e.jsx("button",{onClick:()=>S(!0),className:"px-3 py-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs font-medium rounded transition-colors",children:"Ver Vendas"})]})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-300 flex gap-2",children:[e.jsxs("button",{onClick:()=>K(!0),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(Ot,{className:"w-4 h-4"}),"Hist√≥rico"]}),!_&&e.jsx("button",{onClick:()=>{g({...s,cliente:null,pet:null}),H(null)},className:"px-4 py-2 text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Trocar"})]})]}),s.cliente.pets&&s.cliente.pets.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pet (opcional)"}),e.jsxs("select",{value:((ss=s.pet)==null?void 0:ss.id)||"",onChange:a=>{const o=s.cliente.pets.find(d=>d.id===parseInt(a.target.value));tt(o||null)},disabled:_,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Sem pet espec√≠fico"}),s.cliente.pets.map(a=>e.jsxs("option",{value:a.id,children:[a.codigo," - ",a.nome," (",a.especie,a.raca&&` - ${a.raca}`,")"]},a.id))]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:F,onChange:a=>m(a.target.value),placeholder:"Digite nome, CPF ou telefone do cliente...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:_}),e.jsx(ya,{className:"w-5 h-5 text-gray-400 absolute right-3 top-1/2 -translate-y-1/2"})]}),e.jsxs("button",{onClick:()=>R(!0),disabled:_,className:"flex items-center space-x-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ja,{className:"w-5 h-5"}),e.jsx("span",{children:"Novo"})]})]}),U.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:U.map(a=>e.jsxs("button",{onClick:()=>Wa(a),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.nome}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a.cpf&&`CPF: ${a.cpf}`,a.telefone&&` ‚Ä¢ ${a.telefone}`]}),a.pets&&a.pets.length>0&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:[a.pets.length," pet(s)"]})]},a.id))})]}),F.length>=2&&U.length===0&&e.jsx("div",{className:"text-sm text-gray-500 text-center py-2",children:"Nenhum cliente encontrado"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(ma,{className:"w-5 h-5 mr-2 text-blue-600"}),"Produtos e Servi√ßos"]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{ref:Ha,type:"text",value:b,onChange:a=>N(a.target.value),placeholder:"Digite o nome do produto, c√≥digo de barras ou servi√ßo...",disabled:_,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",autoFocus:!_}),e.jsx(ya,{className:"w-5 h-5 text-gray-400 absolute right-3"})]}),M.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:M.map(a=>e.jsx("button",{onClick:()=>rt(a),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b last:border-b-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.nome}),a.tipo_produto==="VARIACAO"&&Es(a)&&e.jsxs("div",{className:"text-xs text-blue-600 font-medium mt-0.5",children:["üîπ ",Es(a)]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a.codigo&&`C√≥d: ${a.codigo}`,a.tipo_produto==="KIT"&&a.tipo_kit==="VIRTUAL"?a.estoque_virtual!==void 0&&` ‚Ä¢ Estoque: ${a.estoque_virtual}`:a.estoque_atual!==void 0&&` ‚Ä¢ Estoque: ${a.estoque_atual}`]})]}),e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:["R$ ",parseFloat(a.preco_venda).toFixed(2)]})]})},a.id))})]}),s.itens.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(ma,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhum item adicionado"}),e.jsx("p",{className:"text-sm mt-1",children:"Busque e adicione produtos ou servi√ßos"})]}):e.jsx("div",{className:"space-y-3",children:s.itens.map((a,o)=>{var T;const d=a.tipo_produto==="KIT",i=zs[o],p=d&&a.composicao_kit&&a.composicao_kit.length>0;return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200 hover:border-blue-400 space-y-3 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>!_&&Zs(a),children:[e.jsxs("div",{className:"flex-1 flex items-start gap-2",children:[p&&e.jsx("button",{onClick:B=>{B.stopPropagation(),ot(o)},className:"mt-1 text-gray-500 hover:text-blue-600 transition-colors",children:i?e.jsx(Pa,{className:"w-5 h-5"}):e.jsx(Ra,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.produto_nome}),d&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-700",children:[e.jsx(Ds,{className:"w-3 h-3"}),"KIT"]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a.quantidade," Unidade",a.quantidade!==1?"s":""," x R$ ",a.preco_unitario.toFixed(2),a.desconto_valor>0&&e.jsxs("span",{className:"text-orange-600 ml-1",children:["com R$ ",a.desconto_valor.toFixed(2)," de desconto"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",onClick:B=>B.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center space-x-2 bg-white border border-gray-300 rounded-lg",children:[e.jsx("button",{onClick:()=>Ya(o,-1),disabled:_,className:"p-2 hover:bg-gray-100 rounded-l-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Bt,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:a.quantidade,onChange:B=>{const Z=parseFloat(B.target.value)||0,ge=s.itens.map((X,ye)=>{if(ye===o){const Se=Math.max(.001,Z),Je=Se*X.preco_unitario;let Ze=X.desconto_valor||0;X.tipo_desconto_aplicado==="percentual"&&X.desconto_percentual>0&&(Ze=Je*X.desconto_percentual/100);const fa=Je-Ze;return{...X,quantidade:Se,desconto_valor:Ze,subtotal:fa}}return X});ia(ge)},disabled:_,step:"0.001",min:"0.001",className:"w-20 px-2 py-1 text-center font-medium border-none focus:ring-0 disabled:bg-gray-50"}),e.jsx("button",{onClick:()=>Ya(o,1),disabled:_,className:"p-2 hover:bg-gray-100 rounded-r-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(ja,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900 w-24 text-right",children:["R$ ",a.subtotal.toFixed(2)]}),e.jsx("button",{onClick:()=>Za(o),disabled:_,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(wa,{className:"w-5 h-5"})})]})]}),p&&i&&e.jsxs("div",{className:"ml-7 mt-3 p-3 bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-600 uppercase mb-2",children:"Composi√ß√£o do KIT"}),e.jsx("div",{className:"space-y-1.5",children:a.composicao_kit.map((B,Z)=>e.jsxs("div",{className:"flex items-center justify-between text-sm py-1.5 px-2 rounded hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ma,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:B.produto_nome})]}),e.jsxs("span",{className:"text-gray-500 font-medium",children:[B.quantidade,"x"]})]},Z))}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 italic",children:"Componentes apenas informativos (n√£o edit√°veis)"})]}),((T=s.cliente)==null?void 0:T.pets)&&s.cliente.pets.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",onClick:B=>B.stopPropagation(),children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 w-16",children:"Pet:"}),e.jsxs("select",{value:a.pet_id||"",onChange:B=>{const Z=s.itens.map((ge,X)=>X===o?{...ge,pet_id:B.target.value?parseInt(B.target.value):null}:ge);g({...s,itens:Z})},disabled:_,className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"N√£o especificado"}),s.cliente.pets.map(B=>e.jsxs("option",{value:B.id,children:[B.codigo," - ",B.nome]},B.id))]})]})]},o)})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Observa√ß√µes"}),e.jsx("textarea",{value:s.observacoes||"",onChange:a=>g({...s,observacoes:a.target.value}),placeholder:"Observa√ß√µes da venda (opcional)...",disabled:_,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:3})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Entrega"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.tem_entrega,onChange:a=>{var p;const o=a.target.checked,d=o&&((p=s.entrega)==null?void 0:p.taxa_entrega_total)||0,i=s.subtotal+d;g({...s,tem_entrega:o,total:i,entrega:o?s.entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}})},disabled:_,className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Tem entrega?"})]})]}),s.tem_entrega&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Endere√ßo Completo *"}),s.cliente&&e.jsxs("div",{className:"mb-2 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Endere√ßos cadastrados:"}),e.jsxs("button",{type:"button",onClick:a=>{a.preventDefault(),a.stopPropagation(),Xs()},disabled:_,className:"flex items-center gap-1 px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ja,{size:14}),"Adicionar Endere√ßo"]})]}),e.jsxs("div",{className:"space-y-2",children:[(s.cliente.endereco||s.cliente.cidade)&&e.jsxs("button",{type:"button",onClick:a=>{a.preventDefault(),a.stopPropagation();const o=`${s.cliente.endereco}${s.cliente.numero?", "+s.cliente.numero:""}${s.cliente.complemento?" - "+s.cliente.complemento:""}, ${s.cliente.bairro}, ${s.cliente.cidade}/${s.cliente.estado}`;g({...s,entrega:{...s.entrega,endereco_completo:o}})},disabled:_,className:"w-full text-left px-3 py-2 bg-white hover:bg-blue-100 border border-blue-300 rounded text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"font-medium text-blue-700",children:"üè† Cadastro Principal:"})," ",e.jsxs("span",{className:"text-gray-700",children:[s.cliente.endereco,", ",s.cliente.numero," - ",s.cliente.bairro]})]}),s.cliente.enderecos_adicionais&&s.cliente.enderecos_adicionais.map((a,o)=>e.jsxs("button",{type:"button",onClick:d=>{d.preventDefault(),d.stopPropagation();const i=`${a.endereco}, ${a.numero}${a.complemento?" - "+a.complemento:""}, ${a.bairro}, ${a.cidade}/${a.estado}`;g({...s,entrega:{...s.entrega,endereco_completo:i}})},disabled:_,className:"w-full text-left px-3 py-2 bg-white hover:bg-blue-100 border border-blue-300 rounded text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsxs("span",{className:`inline-block px-2 py-0.5 text-xs font-medium rounded mr-2 ${a.tipo==="entrega"?"bg-blue-100 text-blue-800":a.tipo==="cobranca"?"bg-green-100 text-green-800":a.tipo==="comercial"?"bg-purple-100 text-purple-800":a.tipo==="residencial"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:[a.tipo==="entrega"?"üì¶":a.tipo==="cobranca"?"üí∞":a.tipo==="comercial"?"üè¢":a.tipo==="residencial"?"üè†":"üìç"," ",a.apelido||a.tipo]}),e.jsxs("span",{className:"text-gray-700",children:[a.endereco,", ",a.numero," - ",a.bairro]})]},o)),!s.cliente.endereco&&(!s.cliente.enderecos_adicionais||s.cliente.enderecos_adicionais.length===0)&&e.jsx("p",{className:"text-sm text-gray-600 italic",children:'Nenhum endere√ßo cadastrado. Clique em "+ Adicionar Endere√ßo"'})]})]}),e.jsx("textarea",{value:((ts=s.entrega)==null?void 0:ts.endereco_completo)??"",onChange:a=>g({...s,entrega:{...s.entrega,endereco_completo:a.target.value}}),placeholder:"Rua, n√∫mero, complemento, bairro, cidade...",disabled:_,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Entregador"}),e.jsxs("select",{value:(Y==null?void 0:Y.id)||"",onChange:a=>{const o=$e.find(d=>d.id===parseInt(a.target.value));Me(o),g({...s,entregador_id:(o==null?void 0:o.id)||null}),o&&la(o)},disabled:_,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Selecione um entregador"}),$e.map(a=>e.jsxs("option",{value:a.id,children:[a.nome_fantasia||a.nome,a.entregador_padrao&&" (Padr√£o)"]},a.id))]}),Y&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Modelo: ",Y.modelo_custo_entrega==="taxa_fixa"?"üíµ Taxa Fixa":Y.modelo_custo_entrega==="por_km"?"üöó Por KM":Y.modelo_custo_entrega==="rateio_rh"?"üëî Rateio RH":"‚öôÔ∏è Configura√ß√£o Global"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa de Entrega Total"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((rs=s.entrega)==null?void 0:rs.taxa_entrega_total)??0,onChange:a=>{var ge;const o=parseFloat(a.target.value)||0,d=parseFloat(o.toFixed(2)),i=((ge=s.entrega)==null?void 0:ge.taxa_loja)||0,p=parseFloat((o-i).toFixed(2)),T={...s,entrega:{...s.entrega,taxa_entrega_total:d,taxa_loja:parseFloat(i.toFixed(2)),taxa_entregador:p}},B=T.tem_entrega?d:0,Z=parseFloat((T.subtotal+B).toFixed(2));g({...T,total:Z})},disabled:_,className:"w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa Loja"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:((os=s.entrega)==null?void 0:os.taxa_entrega_total)??0,value:parseFloat((((ls=s.entrega)==null?void 0:ls.taxa_loja)??0).toFixed(2)),onChange:a=>{var T;const o=parseFloat(a.target.value)||0,d=((T=s.entrega)==null?void 0:T.taxa_entrega_total)||0,i=parseFloat(o.toFixed(2)),p=parseFloat((d-o).toFixed(2));g({...s,entrega:{...s.entrega,taxa_loja:i,taxa_entregador:p}})},disabled:_,className:"w-full pl-12 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa Entregador"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:((ns=s.entrega)==null?void 0:ns.taxa_entrega_total)??0,value:parseFloat((((is=s.entrega)==null?void 0:is.taxa_entregador)??0).toFixed(2)),onChange:a=>{var T;const o=parseFloat(a.target.value)||0,d=((T=s.entrega)==null?void 0:T.taxa_entrega_total)||0,i=parseFloat(o.toFixed(2)),p=parseFloat((d-o).toFixed(2));g({...s,entrega:{...s.entrega,taxa_entregador:i,taxa_loja:p}})},disabled:_,className:"w-full pl-12 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Preencha a taxa total e depois divida entre loja e entregador. Ao alterar uma, a outra √© calculada automaticamente."}),Y&&ra>0&&e.jsxs("div",{className:"mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-amber-600",children:"üíº"}),e.jsx("span",{className:"text-sm font-medium text-amber-900",children:"Custo Operacional"})]}),e.jsxs("span",{className:"text-sm font-semibold text-amber-700",children:["R$ ",ra.toFixed(2)]})]}),e.jsxs("p",{className:"text-xs text-amber-600 mt-1 italic",children:[Y.nome_fantasia||Y.nome," -",Y.modelo_custo_entrega==="taxa_fixa"&&" Taxa Fixa",Y.modelo_custo_entrega==="por_km"&&" Valor por KM",Y.modelo_custo_entrega==="rateio_rh"&&" Rateio de RH"," ","(n√£o aparece no cupom)"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes da Entrega"}),e.jsx("textarea",{value:((ds=s.entrega)==null?void 0:ds.observacoes_entrega)??"",onChange:a=>g({...s,entrega:{...s.entrega,observacoes_entrega:a.target.value}}),placeholder:"Hor√°rio preferencial, ponto de refer√™ncia...",disabled:_,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:2})]})]})]}),s.itens.length>0&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total bruto:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",(s.subtotal+s.desconto_valor).toFixed(2)]})]}),s.desconto_valor>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-orange-600",children:[(s.desconto_valor/(s.subtotal+s.desconto_valor)*100).toFixed(2),"% de desconto:"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium text-orange-600",children:["R$ ",s.desconto_valor.toFixed(2)]}),e.jsx("button",{onClick:at,disabled:_,className:"p-1 text-blue-600 hover:bg-blue-50 rounded disabled:opacity-50",title:"Aplicar desconto",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",s.subtotal.toFixed(2)]})]}),s.tem_entrega&&e.jsxs("div",{className:"flex justify-between text-blue-600",children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsxs("span",{className:"font-medium",children:["+ R$ ",(((cs=s.entrega)==null?void 0:cs.taxa_entrega_total)||0).toFixed(2)]})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold text-gray-900",children:[e.jsx("span",{children:"Total da Venda:"}),e.jsxs("span",{children:["R$ ",s.total.toFixed(2)]})]})}),Ka>0&&e.jsxs("div",{className:"flex justify-between text-sm text-blue-600 bg-blue-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium",children:"Total de Impostos:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",Ka]})]}),s.total_pago>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-green-600 border-t pt-3",children:[e.jsx("span",{className:"font-medium",children:"(-) Valor Pago:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",s.total_pago.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-2xl font-bold border-t-2 pt-3",children:[e.jsx("span",{className:s.total-s.total_pago>0?"text-orange-600":"text-green-600",children:s.total-s.total_pago>0?"Saldo Restante:":"Totalmente Pago:"}),e.jsxs("span",{className:s.total-s.total_pago>0?"text-orange-600":"text-green-600",children:["R$ ",Math.max(0,s.total-s.total_pago).toFixed(2)]})]})]}),!s.total_pago&&e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"flex justify-between text-2xl font-bold text-gray-900",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["R$ ",s.total.toFixed(2)]})]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Comiss√£o"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:a=>{f(a.target.checked),a.target.checked||O(null)},disabled:_,className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Venda comissionada?"})]})]}),l&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Funcion√°rio/Veterin√°rio * ",e.jsx("span",{className:"text-xs text-gray-500",children:"(apenas com comiss√£o configurada)"})]}),j?e.jsxs("div",{className:"p-4 bg-green-50 border-2 border-green-300 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white font-bold",children:j.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-green-900",children:j.nome}),e.jsx("div",{className:"text-sm text-green-700 capitalize",children:j.cargo})]})]}),e.jsx("button",{onClick:()=>{O(null),De("")},disabled:_,className:"p-2 text-green-600 hover:bg-green-100 rounded-lg transition-colors disabled:cursor-not-allowed",title:"Remover sele√ß√£o",children:e.jsx(ue,{size:20})})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:de,placeholder:"Buscar funcion√°rio ou veterin√°rio...",disabled:_,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",onFocus:async()=>{if(!_)try{const a=await P.get("/comissoes/configuracoes/funcionarios");W(a.data.data||[])}catch(a){console.error("Erro ao buscar funcion√°rios:",a)}},onChange:async a=>{const o=a.target.value;De(o);try{const i=(await P.get("/comissoes/configuracoes/funcionarios")).data.data||[],p=o?i.filter(T=>T.nome.toLowerCase().includes(o.toLowerCase())):i;W(p)}catch(d){console.error("Erro ao buscar funcion√°rios:",d)}}}),ie.length>0&&e.jsx("div",{className:"mt-2 border border-gray-200 rounded-lg max-h-48 overflow-y-auto",children:ie.map(a=>e.jsxs("button",{onClick:()=>{O(a),W([]),De("")},className:"w-full px-4 py-2 text-left hover:bg-gray-50 border-b last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:a.nome}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:a.cargo})]},a.id))})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"‚ÑπÔ∏è A comiss√£o ser√° calculada automaticamente conforme configurado no m√≥dulo de comiss√µes"})]})]})]}),s.itens.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[!te&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-700",children:[e.jsx(Ne,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:'üîí Caixa fechado - Use o bot√£o "Abrir Caixa" no topo da p√°gina para continuar'})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[s.itens.length>0&&!s.id&&e.jsxs("button",{onClick:()=>{window.confirm("Descartar venda atual sem salvar?")&&Be()},disabled:x||_,className:"flex items-center space-x-2 px-4 py-3 bg-red-50 hover:bg-red-100 text-red-600 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed border border-red-200",title:"Descartar venda atual e come√ßar uma nova",children:[e.jsx(ue,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Nova Venda"})]}),e.jsxs("button",{onClick:es,disabled:x||_||!te,className:"flex items-center space-x-2 px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:te?"Salvar venda atual":"üîí Caixa fechado - Abra o caixa para salvar vendas",children:[e.jsx(Ss,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Salvar Venda"}),!te&&e.jsx("span",{className:"text-xs",children:"üîí"})]}),e.jsxs("button",{onClick:as,disabled:x||s.status==="finalizada"||s.status==="pago_nf"||!te,className:"flex items-center space-x-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors shadow-md disabled:opacity-50 disabled:cursor-not-allowed",title:te?"Registrar pagamento da venda":"üîí Caixa fechado - Abra o caixa para registrar recebimentos",children:[e.jsx(Da,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"}),!te&&e.jsx("span",{className:"text-xs",children:"üîí"})]})]})]})]})]}),s.cliente&&He&&e.jsx("div",{className:"w-80 bg-gray-50 border-l flex flex-col overflow-hidden",children:e.jsx(cr,{clienteId:s.cliente.id})}),s.cliente&&e.jsx("button",{onClick:()=>Os(!He),className:"fixed right-0 top-1/2 -translate-y-1/2 bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-l-lg shadow-lg transition-all z-10",style:{right:He?"320px":"0"},title:He?"Recolher informa√ß√µes do cliente":"Expandir informa√ß√µes do cliente",children:He?e.jsx(Ra,{className:"w-5 h-5"}):e.jsx(ks,{className:"w-5 h-5"})}),Oe&&e.jsxs("div",{className:"w-52 bg-white border-l flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 flex items-center",children:[e.jsx(Va,{className:"w-4 h-4 mr-2 text-blue-600"}),"Vendas Recentes"]}),e.jsx("button",{onClick:()=>La(!1),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Fechar painel",children:e.jsx(ue,{className:"w-4 h-4 text-gray-500"})})]}),e.jsx("div",{className:"flex space-x-1 mb-3",children:["24h","7d","30d"].map(a=>e.jsxs("button",{onClick:()=>je(a),className:`flex-1 px-2 py-1.5 rounded-lg text-xs font-medium transition-colors ${oe===a?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[a==="24h"&&"√öltimas 24h",a==="7d"&&"7 dias",a==="30d"&&"30 dias"]},a))}),e.jsx("div",{className:"flex space-x-1 mb-2",children:[{id:"todas",label:"Todas"},{id:"pago",label:"Pago"},{id:"aberta",label:"Aberta"}].map(a=>e.jsx("button",{onClick:()=>G(a.id),className:`flex-1 px-2 py-1.5 rounded-lg text-xs font-medium transition-colors ${y===a.id?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:a.label},a.id))}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 hover:bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",checked:me,onChange:a=>be(a.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Apenas com entrega"})]}),e.jsx("div",{className:"px-2 pb-2",children:e.jsx("input",{type:"text",value:ke,onChange:a=>ze(a.target.value),placeholder:"Buscar por n√∫mero...",className:"w-full px-3 py-2 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:J.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(Ne,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-xs",children:"Nenhuma venda encontrada"})]}):J.map(a=>e.jsxs("div",{onClick:()=>nt(a),className:"bg-gray-50 rounded-lg p-2.5 border border-gray-200 hover:border-blue-300 cursor-pointer transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1.5",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:a.cliente_nome||"Cliente n√£o informado"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["#",a.numero_venda]})]}),e.jsxs("div",{className:"text-right ml-2 flex-shrink-0",children:[a.status==="baixa_parcial"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[10px] text-gray-500",children:"Pago"}),e.jsxs("div",{className:"text-xs font-semibold text-green-600",children:["R$ ",(a.valor_pago||0).toFixed(2)]}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-0.5",children:["de R$ ",(a.total||0).toFixed(2)]})]}):e.jsxs("div",{className:"text-sm font-semibold text-green-600",children:["R$ ",(a.total||0).toFixed(2)]}),e.jsxs("div",{className:`text-[10px] font-medium px-1.5 py-0.5 rounded-full mt-1 inline-block ${a.status==="pago_nf"?"bg-emerald-100 text-emerald-700":a.status==="finalizada"?"bg-green-100 text-green-700":a.status==="baixa_parcial"?"bg-blue-100 text-blue-700":a.status==="aberta"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[a.status==="pago_nf"&&"Pago NF",a.status==="finalizada"&&"Pago",a.status==="baixa_parcial"&&"Parcial",a.status==="aberta"&&"Aberta",a.status==="cancelada"&&"Cancelada"]})]})]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:(()=>{const o=a.data_venda;if(typeof o=="string"&&o.includes("T")){const[d,i]=o.split("T"),p=i.split("-")[0].split("+")[0],[T,B,Z]=d.split("-"),[ge,X]=p.split(":");return`${Z}/${B} ${ge}:${X}`}return new Date(o).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})()})]},a.id))})]}),Bs&&s.cliente&&e.jsx("div",{className:"fixed inset-0 z-40",children:e.jsxs("div",{className:"absolute top-0 right-0 w-80 h-full bg-gray-50 border-l border-gray-300 shadow-lg flex flex-col animate-in slide-in-from-right duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-300 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fs,{className:"w-4 h-4 text-gray-600"}),e.jsx("h2",{className:"text-sm font-medium text-gray-700",children:"Oportunidades"})]}),e.jsx("button",{onClick:()=>Oa(!1),className:"p-1 hover:bg-gray-100 rounded transition-colors",children:e.jsx(ue,{className:"w-4 h-4 text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:[Ye.slice(0,5).map(a=>e.jsxs("div",{className:"p-3 bg-white border border-gray-200 rounded hover:bg-gray-50 transition-colors",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:a.titulo}),e.jsx("p",{className:"text-xs text-gray-700 mb-2 leading-relaxed",children:a.descricao_curta}),e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs mt-2",children:[e.jsxs("button",{onClick:()=>{Sa("oportunidade_convertida",a),console.log("Adicionar ao carrinho:",a.id)},className:"flex items-center gap-1 text-green-500 hover:text-green-600 transition-colors whitespace-nowrap font-medium",title:"Adicionar ao carrinho",children:[e.jsx(ja,{className:"w-3 h-3"}),e.jsx("span",{children:"Adicionar"})]}),e.jsx("button",{onClick:()=>{Sa("oportunidade_refinada",a),console.log("Buscar alternativa:",a.id)},className:"text-orange-600 hover:text-orange-700 transition-colors whitespace-nowrap flex-1 text-center font-medium",title:"Ver alternativa",children:"Alternativa"}),e.jsxs("button",{onClick:()=>{Sa("oportunidade_rejeitada",a),oa(o=>o.filter(d=>d.id!==a.id))},className:"flex items-center gap-1 text-red-500 hover:text-red-600 transition-colors whitespace-nowrap font-medium",title:"Ignorar sugest√£o",children:[e.jsx("span",{children:"Ignorar"}),e.jsx(ue,{className:"w-3 h-3"})]})]})]},a.id)),Ye.length===0&&e.jsx("div",{className:"flex items-center justify-center py-8 text-gray-400",children:e.jsx("p",{className:"text-xs",children:"Nenhuma oportunidade dispon√≠vel"})})]}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-200 bg-white",children:e.jsx("p",{className:"text-[10px] text-gray-400 text-center",children:Ye.length>0?`${Math.min(Ye.length,6)} oportunidades`:""})})]})}),e.jsx("button",{onClick:()=>La(!Oe),className:"fixed right-0 bottom-20 bg-blue-600 hover:bg-blue-700 text-white rounded-l-lg shadow-lg transition-all z-10 flex items-center gap-1",style:{right:Oe?"208px":"0",padding:Oe?"6px":"6px 8px"},title:Oe?"Recolher vendas recentes":"Expandir vendas recentes",children:Oe?e.jsx(Ra,{className:"w-4 h-4"}):e.jsxs(e.Fragment,{children:[e.jsx(Kt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-[10px] font-medium whitespace-nowrap",children:"Vendas"})]})}),E&&e.jsx(Yt,{venda:s,onClose:()=>t(!1),onAnalisarVenda:u?lt:null,onConfirmar:async()=>{if(t(!1),_&&s.id)try{const o=(await P.get(`/vendas/${s.id}`)).data;let d=[],i=0;try{const p=await P.get(`/vendas/${s.id}/pagamentos`);d=p.data.pagamentos||[],i=p.data.total_pago||0}catch(p){console.error("Erro ao buscar pagamentos:",p)}g({...o,pagamentos:d,total_pago:i}),console.log("‚úÖ Venda recarregada:",o)}catch(a){console.error("Erro ao recarregar venda:",a)}else Be();na(),xe(a=>a+1)},onVendaAtualizada:async()=>{if(s.id){const a=await va(s.id);let o=[],d=0;try{const i=await P.get(`/vendas/${s.id}/pagamentos`);o=i.data.pagamentos||[],d=i.data.total_pago||0}catch(i){console.error("Erro ao buscar pagamentos:",i)}g({...a,pagamentos:o,total_pago:d}),V(a.status==="finalizada"||a.status==="baixa_parcial"),na()}}}),Q&&e.jsx(Zt,{onClose:()=>ae(!1),onSucesso:()=>{ae(!1),xe(a=>a+1),ne(!0)}}),Ua&&e.jsx(mr,{isOpen:Ua,itensCarrinho:s.itens,racaoIdFechada:Qs,onClose:()=>{const a=s.itens.filter(o=>{const d=(o.categoria_nome||"").toLowerCase();return d.includes("ra√ß√£o")||d.includes("racao")});a.length>0&&Us(a[a.length-1].produto_id),Ks(!1)}}),D&&s.cliente&&e.jsx(ur,{isOpen:D,onClose:()=>re(!1),clienteId:s.cliente.id,onPendenciaAdicionada:()=>Ga()}),q&&e.jsx(gr,{onClose:()=>R(!1),onClienteCriado:a=>{Wa(a),R(!1)}}),Ve&&ee&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between z-10",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Adicionar Novo Endere√ßo ao Cliente"}),e.jsx("button",{onClick:ka,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ue,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Endere√ßo *"}),e.jsxs("select",{value:ee.tipo,onChange:a=>ve({...ee,tipo:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"entrega",children:"üì¶ Entrega"}),e.jsx("option",{value:"cobranca",children:"üí∞ Cobran√ßa"}),e.jsx("option",{value:"comercial",children:"üè¢ Comercial"}),e.jsx("option",{value:"residencial",children:"üè† Residencial"}),e.jsx("option",{value:"trabalho",children:"üìç Trabalho"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apelido (opcional)"}),e.jsx("input",{type:"text",value:ee.apelido,onChange:a=>ve({...ee,apelido:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Ex: Casa da m√£e, Escrit√≥rio, Loja"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:ee.cep,onChange:a=>{const o=a.target.value.replace(/\D/g,""),d=o.length>5?`${o.slice(0,5)}-${o.slice(5,8)}`:o;ve({...ee,cep:d})},onBlur:a=>Ws(a.target.value),maxLength:"9",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"00000-000"}),Ce&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Endere√ßo *"}),e.jsx("input",{type:"text",value:ee.endereco,onChange:a=>ve({...ee,endereco:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Rua, Avenida, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N√∫mero"}),e.jsx("input",{type:"text",value:ee.numero,onChange:a=>ve({...ee,numero:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"123"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complemento"}),e.jsx("input",{type:"text",value:ee.complemento,onChange:a=>ve({...ee,complemento:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Apto, Bloco, Sala..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bairro"}),e.jsx("input",{type:"text",value:ee.bairro,onChange:a=>ve({...ee,bairro:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Centro, Jardim..."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cidade *"}),e.jsx("input",{type:"text",value:ee.cidade,onChange:a=>ve({...ee,cidade:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"S√£o Paulo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsx("input",{type:"text",value:ee.estado,onChange:a=>ve({...ee,estado:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",maxLength:"2",placeholder:"SP"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"* Campos obrigat√≥rios"})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:ka,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:Ys,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Salvar Endere√ßo"})]})]})}),ta&&L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Alterar item da venda"}),e.jsx("button",{onClick:()=>Ue(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ue,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:L.produto_nome}),e.jsxs("p",{className:"text-sm text-gray-600",children:["C√≥digo: ",L.produto_codigo]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Pre√ßo ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:L.preco,onChange:a=>Re({...L,preco:parseFloat(a.target.value)||0}),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade"}),e.jsx("input",{type:"number",step:"0.001",value:L.quantidade,readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subtotal"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:"R$"}),e.jsx("input",{type:"text",value:(L.preco*L.quantidade).toFixed(2),readOnly:!0,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-100"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de desconto"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Re({...L,tipoDesconto:"valor",descontoPercentual:0}),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${L.tipoDesconto==="valor"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"R$"}),e.jsx("button",{onClick:()=>Re({...L,tipoDesconto:"percentual",descontoValor:0}),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${L.tipoDesconto==="percentual"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor do desconto"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:L.tipoDesconto==="valor"?"R$":"%"}),e.jsx("input",{type:"number",step:"0.01",value:L.tipoDesconto==="valor"?L.descontoValor:L.descontoPercentual,onChange:a=>{const o=parseFloat(a.target.value)||0;L.tipoDesconto==="valor"?Re({...L,descontoValor:o}):Re({...L,descontoPercentual:o})},className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Total bruto"}),e.jsxs("span",{className:"font-medium",children:["R$ ",(L.preco*L.quantidade).toFixed(2)]})]}),(L.descontoValor>0||L.descontoPercentual>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm text-red-600 mt-1",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{className:"font-medium",children:["- R$ ",L.tipoDesconto==="valor"?L.descontoValor.toFixed(2):(L.preco*L.quantidade*L.descontoPercentual/100).toFixed(2)]})]}),e.jsx("div",{className:"flex justify-between text-sm text-orange-600 mt-1",children:e.jsxs("span",{children:[L.tipoDesconto==="percentual"&&`${L.descontoPercentual.toFixed(2)}% de desconto`,L.tipoDesconto==="valor"&&`${(L.descontoValor/(L.preco*L.quantidade)*100).toFixed(2)}% de desconto`]})})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg mt-2 pt-2 border-t border-blue-200",children:[e.jsx("span",{children:"Total l√≠quido"}),e.jsxs("span",{className:"text-green-600",children:["R$ ",(L.preco*L.quantidade-(L.tipoDesconto==="valor"?L.descontoValor:L.preco*L.quantidade*L.descontoPercentual/100)).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-between gap-3",children:[e.jsx("button",{onClick:()=>Ue(!1),className:"flex-1 px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Fechar"}),e.jsx("button",{onClick:()=>{s.itens.map(a=>(a.produto_id===L.produto_id&&Za(s.itens.indexOf(a)),a)).filter(Boolean),Ue(!1)},className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Remover"}),e.jsx("button",{onClick:et,className:"flex-1 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Salvar"})]})]})}),Ca&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"üí∞ Aplicar desconto"}),e.jsx("button",{onClick:()=>We(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ue,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total bruto"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",s.subtotal.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de desconto"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>pa("valor"),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${Le==="valor"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"R$"}),e.jsx("button",{onClick:()=>pa("percentual"),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${Le==="percentual"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-3 text-gray-500",children:Le==="valor"?"R$":"%"}),e.jsx("input",{type:"number",step:"0.01",value:Pe,onChange:a=>ba(parseFloat(a.target.value)||0),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-700",children:"Desconto"}),e.jsxs("span",{className:"text-red-600 font-medium",children:["- R$ ",Le==="valor"?Pe.toFixed(2):(s.subtotal*Pe/100).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-baseline border-t border-blue-200 pt-2 mt-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Total l√≠quido"}),e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:["R$ ",(Le==="valor"?s.subtotal-Pe:s.subtotal-s.subtotal*Pe/100).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>We(!1),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Fechar"}),e.jsx("button",{onClick:()=>st(Le,Pe),className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Aplicar"})]})]})}),w&&s.cliente&&e.jsx(ir,{clienteId:s.cliente.id,clienteNome:s.cliente.nome,onClose:()=>S(!1),onSucesso:()=>{P.get(`/clientes/${s.cliente.id}/vendas-em-aberto`).then(a=>{a.data.resumo.total_vendas>0?H(a.data.resumo):H(null)}).catch(()=>H(null))}}),I&&s.cliente&&e.jsx(dr,{clienteId:s.cliente.id,clienteNome:s.cliente.nome,onClose:()=>K(!1)}),u&&e.jsx(xr,{mostrar:qa,onFechar:()=>Fa(!1),dados:Ms,carregando:qs})]})})}function gr({onClose:n,onClienteCriado:C}){const[c,u]=r.useState({nome:"",telefone:"",cpf:"",email:""}),[s,g]=r.useState(!1),[F,m]=r.useState(""),b=async N=>{if(N.preventDefault(),!c.nome||!c.telefone){m("Nome e telefone s√£o obrigat√≥rios");return}g(!0),m("");try{const U=await P.post("/clientes",{...c,tipo_cadastro:"cliente",tipo_pessoa:"PF"});C(U.data)}catch(U){console.error("Erro:",U),m("Erro ao cadastrar cliente")}finally{g(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Cadastro R√°pido"}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-4",children:[F&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:F}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome *"}),e.jsx("input",{type:"text",value:c.nome,onChange:N=>u({...c,nome:N.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefone *"}),e.jsx("input",{type:"tel",value:c.telefone,onChange:N=>u({...c,telefone:N.target.value}),placeholder:"(00) 00000-0000",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CPF"}),e.jsx("input",{type:"text",value:c.cpf,onChange:N=>u({...c,cpf:N.target.value}),placeholder:"000.000.000-00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail"}),e.jsx("input",{type:"email",value:c.email,onChange:N=>u({...c,email:N.target.value}),placeholder:"cliente@email.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:n,disabled:s,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:s,className:"flex items-center space-x-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Cadastrando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ua,{className:"w-5 h-5"}),e.jsx("span",{children:"Cadastrar"})]})})]})]})]})})}export{wr as default};
