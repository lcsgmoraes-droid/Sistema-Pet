import{r as a,j as e,h as fr,u as $r,O as vn,a as fa,f as ts,i as Bs,k as yn,m as Ge,n as Nn}from"./vendor-react-1771779186006.js";import{ap as Ms,aq as Xs,ar as dr,as as _n,at as wn}from"./vendor-misc-1771779186006.js";import{a as qo,z as Se,n as ce,c as Cn,F as kn}from"./vendor-utils-1771779186006.js";import{C as Rs,M as Sn,a as En,X as ma,b as Ls,L as jr,F as Fn,c as Jt,d as zo,P as Fa,e as $t,f as Io,g as $n,h as qs,i as Pn,j as Rn,k as Us,l as Ga,m as at,n as jt,o as An,p as Dn,q as To,r as lo,s as ps,t as Ws,u as zs,v as Mn,w as _a,x as Pr,y as vr,z as yr,A as Yt,B as ds,D as ns,E as Ns,G as Is,H as Nt,I as cr,J as Vo,K as vt,N as Ts,O as Oo,Q as Rr,R as Bo,S as Ln,T as Qa,U as Zt,V as _s,W as gs,Y as _t,Z as er,_ as nt,$ as Vs,a0 as Da,a1 as Oa,a2 as Za,a3 as $a,a4 as ha,a5 as cs,a6 as ws,a7 as Ar,a8 as Nr,a9 as Uo,aa as qn,ab as io,ac as Xa,ad as lt,ae as it,af as hs,ag as da,ah as za,ai as Ma,aj as et,ak as Wo,al as Ko,am as Ho,an as Os,ao as wt,ap as ar,aq as zn,ar as _r,as as dt,at as co,au as Cs,av as In,aw as Tn,ax as Vn,ay as Go,az as As,aA as Qo,aB as sr,aC as xo,aD as Ct,aE as tr,aF as os,aG as On,aH as st,aI as xr,aJ as Bn,aK as kt,aL as St,aM as mo,aN as Un,aO as us,aP as Xo,aQ as Dr,aR as Wn,aS as Kn,aT as rr,aU as or,aV as Jo,aW as Yo,aX as Et,aY as Ft,aZ as js,a_ as vs,a$ as Zo,b0 as en,b1 as Hn,b2 as Ut,b3 as Qt,b4 as uo,b5 as an,b6 as Gn,b7 as Qn,b8 as Xn,b9 as Mr,ba as Wt,bb as Jn,bc as Yn,bd as mr,be as po,bf as sn,bg as Zn}from"./vendor-icons-1771779186006.js";import{R as qa,L as ct,C as Ba,X as Ua,Y as Ta,T as Aa,a as Va,b as ls,B as is,c as Ka,d as Xt,P as wr,e as Cr,A as el,f as go}from"./vendor-recharts-1771779186006.js";import{u as $s,w as al}from"./vendor-xlsx-1771779186006.js";import{p as sl,f as tn,a as Lr,b as tl}from"./vendor-datefns-1771779186006.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))d(o);new MutationObserver(o=>{for(const g of o)if(g.type==="childList")for(const r of g.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&d(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const g={};return o.integrity&&(g.integrity=o.integrity),o.referrerPolicy&&(g.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?g.credentials="include":o.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function d(o){if(o.ep)return;o.ep=!0;const g=t(o);fetch(o.href,g)}})();const rl=1200;let ol=0,nr=0;const nl=new Set,tt=new Map,rt=new Map,kr=new Map,lr=new Map,ho=new WeakSet,rn=()=>{const s=pl();nl.forEach(n=>n(s))},ll=s=>{const n=Date.now(),t=Math.max(s*3,5e3);lr.forEach((d,o)=>{n-d>t&&lr.delete(o)})},qr=s=>(s.method||"get").toLowerCase(),il=s=>{if(s==null)return"";if(typeof s=="string")return s;try{return JSON.stringify(s)}catch{return"[unserializable-data]"}},dl=s=>{if(s==null)return"";try{return JSON.stringify(s)}catch{return"[unserializable-params]"}},cl=(s,n)=>{if(n)return`key:${n}`;const t=qr(s).toUpperCase(),d=s.baseURL||"",o=s.url||"",g=dl(s.params),r=il(s.data);return`${t}|${d}|${o}|${g}|${r}`},xl=(s,n)=>{if(n!=null&&n.key)return n.key;const t=qr(s).toUpperCase(),d=s.url||"";if(d)return`${t} ${d}`},ml=(s,n)=>typeof(n==null?void 0:n.preventDuplicate)=="boolean"?n.preventDuplicate:qr(s)!=="get",bo=(s,n)=>{const t=new Error("Requisi√ß√£o duplicada bloqueada pelo loading-safe.");return t.code="ERR_LOADING_SAFE_DUPLICATE",t.isLoadingSafeDuplicate=!0,t.config=s,t.operationKey=n,t},ul=s=>{const n=s.loadingSafe,t=xl(s,n),d=(n==null?void 0:n.trackGlobal)!==!1,o=ml(s,n),g=(n==null?void 0:n.duplicateWindowMs)??rl;let r;if(o){if(r=cl(s,n==null?void 0:n.key),ll(g),(rt.get(r)||0)>0)return{duplicateError:bo(s,t)};const f=lr.get(r),y=Date.now();if(typeof f=="number"&&y-f<g)return{duplicateError:bo(s,t)};lr.set(r,y)}const v=++ol;if(s.__loadingSafeRequestId=v,kr.set(v,{key:t,signature:r,trackGlobal:d}),d&&(nr+=1),t){const j=tt.get(t)||0;tt.set(t,j+1)}if(r){const j=rt.get(r)||0;rt.set(r,j+1)}return rn(),{duplicateError:null}},fo=s=>{if(!s)return;const n=s.__loadingSafeRequestId;if(!n)return;const t=kr.get(n);if(kr.delete(n),delete s.__loadingSafeRequestId,!!t){if(t.trackGlobal&&(nr=Math.max(0,nr-1)),t.key){const d=tt.get(t.key)||0;d<=1?tt.delete(t.key):tt.set(t.key,d-1)}if(t.signature){const d=rt.get(t.signature)||0;d<=1?rt.delete(t.signature):rt.set(t.signature,d-1)}rn()}},pl=()=>({activeRequests:nr,activeOperationKeys:Array.from(tt.keys())}),jo=s=>({loadingSafe:s}),on=s=>(ho.has(s)||(ho.add(s),s.interceptors.request.use(n=>{const{duplicateError:t}=ul(n);return t?Promise.reject(t):n},n=>Promise.reject(n)),s.interceptors.response.use(n=>(fo(n.config),n),n=>(fo(n==null?void 0:n.config),Promise.reject(n)))),s),gl="/api",Sr=gl;Sr.startsWith("http://")&&(console.warn('‚ö†Ô∏è [API Config] Em produ√ß√£o, prefira URL relativa "/api" para evitar CORS/hosts fixos.'),console.warn("   Valor atual:",Sr));const F=qo.create({baseURL:Sr,timeout:15e3,headers:{"Content-Type":"application/json"}});on(F);F.interceptors.request.use(s=>{const n=localStorage.getItem("access_token"),t=localStorage.getItem("selectedTenant");if(s.headers=s.headers||{},n&&(s.headers.Authorization=`Bearer ${n}`),t)try{const d=JSON.parse(t),o=d==null?void 0:d.id;o&&(s.headers["X-Tenant-ID"]=o)}catch{}return s},s=>Promise.reject(s));F.interceptors.response.use(s=>s,s=>{var t;if((s==null?void 0:s.code)==="ERR_LOADING_SAFE_DUPLICATE")return Promise.reject(s);const n=(t=s.response)==null?void 0:t.status;return n===401&&(console.warn("‚ö†Ô∏è Status 401: Sess√£o inv√°lida ou tenant n√£o selecionado"),localStorage.removeItem("access_token"),localStorage.removeItem("tenants"),window.location.href="/login"),n===403&&console.warn("‚ö†Ô∏è Status 403: Acesso negado para este tenant"),Promise.reject(s)});const nn=a.createContext(),mt=()=>{const s=a.useContext(nn);if(!s)throw new Error("useAuth deve ser usado dentro de AuthProvider");return s},hl=({children:s})=>{const[n,t]=a.useState(null),[d,o]=a.useState(!0);a.useEffect(()=>{(async()=>{try{const c=localStorage.getItem("access_token"),m=localStorage.getItem("user");c&&m?(t(JSON.parse(m)),await g()):o(!1)}catch(c){console.error("Erro ao inicializar auth:",c),o(!1)}})()},[]);const g=async()=>{try{const y=await F.get("/auth/me-multitenant");t(y.data),localStorage.setItem("user",JSON.stringify(y.data)),o(!1)}catch(y){console.error("Erro ao buscar usu√°rio:",y),localStorage.removeItem("access_token"),localStorage.removeItem("tenants"),localStorage.removeItem("user"),t(null),o(!1)}},f={user:n,loading:d,login:async(y,c)=>{var m,k;try{console.log("üîê Iniciando login para:",y);const w=await F.post("/auth/login-multitenant",{email:y,password:c}),{access_token:x,tenants:b}=w.data;if(console.log("‚úÖ Login fase 1 OK - Tenants:",b.length),b&&b.length>0){localStorage.setItem("tempToken",x),console.log("üìç Selecionando tenant:",b[0].name);const i=(await F.post("/auth/select-tenant",{tenant_id:b[0].id},{headers:{Authorization:`Bearer ${x}`}})).data.access_token;localStorage.setItem("access_token",i),localStorage.setItem("selectedTenant",JSON.stringify(b[0])),console.log("‚úÖ Tenant selecionado OK");const p=await F.get("/auth/me-multitenant");return t(p.data),localStorage.setItem("user",JSON.stringify(p.data)),console.log("‚úÖ Login completo! Redirecionando..."),{success:!0}}else return console.error("‚ùå Nenhum tenant dispon√≠vel"),{success:!1,error:"Nenhuma empresa dispon√≠vel para este usu√°rio"}}catch(w){return console.error("Erro no login:",w),{success:!1,error:((k=(m=w.response)==null?void 0:m.data)==null?void 0:k.detail)||"Erro ao fazer login"}}},register:async(y,c,m)=>{var k,w;try{const x=await F.post("/auth/register",{email:y,password:c,nome:m}),{access_token:b}=x.data;localStorage.setItem("access_token",b);const u=await F.get("/auth/me-multitenant");return t(u.data),localStorage.setItem("user",JSON.stringify(u.data)),{success:!0}}catch(x){return console.error("Erro no registro:",x),{success:!1,error:((w=(k=x.response)==null?void 0:k.data)==null?void 0:w.detail)||"Erro ao criar conta"}}},logout:async()=>{try{await F.post("/auth/logout-multitenant")}catch(y){console.error("Erro ao fazer logout:",y)}finally{localStorage.removeItem("access_token"),localStorage.removeItem("tenants"),localStorage.removeItem("user"),localStorage.removeItem("selectedTenant"),localStorage.removeItem("tempToken"),t(null),window.location.href="/login"}},isAuthenticated:!!n};return e.jsx(nn.Provider,{value:f,children:s})},ba=({children:s,permission:n,requiredPermissions:t})=>{var r,v;const{isAuthenticated:d,loading:o,user:g}=mt();if(o)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})});if(!d)return e.jsx(fr,{to:"/login",replace:!0});if(n||t){const j=(g==null?void 0:g.permissions)||[];if(((v=(r=g==null?void 0:g.role)==null?void 0:r.name)==null?void 0:v.toLowerCase())==="admin")return s;if(n&&!j.includes(n))return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üîí"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Acesso Negado"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Voc√™ n√£o tem permiss√£o para acessar esta p√°gina."}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Permiss√£o necess√°ria: ",n]}),e.jsx("button",{onClick:()=>window.history.back(),className:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Voltar"})]})});if(t&&t.length>0&&!t.every(c=>j.includes(c)))return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üîí"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Acesso Negado"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Voc√™ n√£o tem permiss√£o para acessar esta p√°gina."}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Permiss√µes necess√°rias: ",t.join(", ")]}),e.jsx("button",{onClick:()=>window.history.back(),className:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Voltar"})]})})}return s};function bl({onClick:s}){const[n,t]=a.useState(window.innerWidth<768),[d,o]=a.useState(!1),[g,r]=a.useState(!1),[v,j]=a.useState({x:0,y:0}),[f,y]=a.useState({x:0,y:0});a.useEffect(()=>{const C=()=>{t(window.innerWidth<768)};return window.addEventListener("resize",C),()=>window.removeEventListener("resize",C)},[]);const c=(C,h)=>{const _=window.innerWidth-(h?60:200),S=window.innerHeight-(h?60:300);return{x:Math.max(20,Math.min(C.x,_)),y:Math.max(20,Math.min(C.y,S))}},[m,k]=a.useState(()=>{if(window.innerWidth<768)return{x:window.innerWidth-70,y:80};const C=localStorage.getItem("calc_button_pos"),h={x:window.innerWidth-150,y:window.innerHeight-150};if(C)try{const _=JSON.parse(C);return c(_,!0)}catch{return h}return h}),[w,x]=a.useState(()=>localStorage.getItem("calc_button_minimizado")==="true"),b=C=>{if(n)return;if(C.target.closest('button[title="Expandir"], button[title="Minimizar"]')){C.stopPropagation();return}o(!0),r(!1),y({x:C.clientX,y:C.clientY}),j({x:C.clientX-m.x,y:C.clientY-m.y})},u=C=>{if(d){Math.sqrt(Math.pow(C.clientX-f.x,2)+Math.pow(C.clientY-f.y,2))>5&&r(!0);const _=C.clientX-v.x,S=C.clientY-v.y,$=window.innerWidth-(w?60:200),K=window.innerHeight-(w?60:300),re={x:Math.max(20,Math.min(_,$)),y:Math.max(20,Math.min(S,K))};k(re)}},i=()=>{d&&(o(!1),localStorage.setItem("calc_button_pos",JSON.stringify(m)))};a.useEffect(()=>{if(d)return document.addEventListener("mousemove",u),document.addEventListener("mouseup",i),()=>{document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",i)}},[d]);const p=C=>{console.log("üñ±Ô∏è Clique detectado, hasDragged:",g),g?console.log("‚ùå Ignorando clique (foi arraste)"):(console.log("‚úÖ Abrindo calculadora..."),s())},l=C=>{C.stopPropagation();const h=!w;if(!h){const _=c(m,!1);(_.x!==m.x||_.y!==m.y)&&(k(_),localStorage.setItem("calc_button_pos",JSON.stringify(_)))}x(h),localStorage.setItem("calc_button_minimizado",h.toString())};return a.useEffect(()=>{const C=()=>{if(window.innerWidth<768)k({x:window.innerWidth-70,y:80});else{const _=c(m,w);(_.x!==m.x||_.y!==m.y)&&(k(_),localStorage.setItem("calc_button_pos",JSON.stringify(_)))}};return window.addEventListener("resize",C),()=>window.removeEventListener("resize",C)},[m,w]),e.jsx("div",{className:"fixed z-50",style:{left:`${m.x}px`,top:`${m.y}px`},children:w?e.jsxs("div",{className:`relative group ${n?"":"cursor-move"}`,onMouseDown:n?void 0:b,children:[e.jsx("button",{onClick:p,onMouseDown:C=>C.stopPropagation(),className:`calc-button-main\r
              flex items-center justify-center\r
              w-12 h-12 md:w-12 md:h-12\r
              bg-gradient-to-br from-orange-500 to-orange-600\r
              hover:from-orange-600 hover:to-orange-700\r
              text-white\r
              rounded-full\r
              shadow-lg hover:shadow-xl\r
              transition-all duration-200\r
              hover:scale-110\r
              active:scale-95\r
              pointer-events-auto\r
            `,title:"Calculadora de Ra√ß√£o",children:e.jsx(Rs,{size:20})}),!n&&e.jsx("button",{onClick:l,onMouseDown:C=>C.stopPropagation(),className:`\r
                absolute -bottom-1 -right-1\r
                bg-blue-600 hover:bg-blue-700\r
                text-white\r
                w-6 h-6\r
                rounded-full\r
                flex items-center justify-center\r
                opacity-0 group-hover:opacity-100\r
                transition-opacity\r
                shadow-md\r
              `,title:"Expandir",children:e.jsx(Sn,{size:12})})]}):e.jsxs("div",{className:`\r
            flex flex-col gap-2\r
            bg-white\r
            rounded-2xl\r
            shadow-2xl\r
            p-3\r
            border-2 border-orange-500\r
            min-w-[140px]\r
          `,style:{cursor:d?"grabbing":"default"},children:[e.jsxs("div",{className:`flex items-center justify-between gap-2 drag-handle ${n?"":"cursor-move"}`,onMouseDown:n?void 0:b,children:[e.jsxs("div",{className:"flex items-center gap-2 pointer-events-none",children:[e.jsx("div",{className:`\r
                w-10 h-10\r
                bg-gradient-to-br from-orange-500 to-orange-600\r
                rounded-full\r
                flex items-center justify-center\r
                text-white\r
              `,children:e.jsx(Rs,{size:20})}),e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"Calculadora"})]}),e.jsx("button",{onClick:l,className:`\r
                p-1 hover:bg-gray-100 \r
                rounded-lg transition-colors\r
                pointer-events-auto\r
              `,title:"Minimizar",children:e.jsx(En,{size:16,className:"text-gray-500"})})]}),e.jsx("button",{onClick:p,className:`calc-button-main\r
              w-full\r
              px-4 py-2\r
              bg-gradient-to-r from-orange-500 to-orange-600\r
              hover:from-orange-600 hover:to-orange-700\r
              text-white\r
              rounded-lg\r
              font-medium text-sm\r
              transition-all\r
              hover:shadow-lg\r
            `,children:"ü•´ Calcular Ra√ß√£o"}),!n&&e.jsx("div",{className:"text-[10px] text-gray-500 text-center",children:"Arraste para mover"})]})})}function ln(s){var o,g;if(!s)return!1;if(s.peso_embalagem&&s.peso_embalagem>0)return!0;const n=((o=s.classificacao_racao)==null?void 0:o.toLowerCase())||"",t=s.categoria_id||s.category_id,d=((g=s.categoria_nome)==null?void 0:g.toLowerCase())||"";return n&&n!=="n√£o √© ra√ß√£o"||d.includes("ra√ß√£o")||d.includes("racao")||t===5}function fl({isOpen:s=!1,onClose:n=()=>{},itensCarrinho:t=[],clienteId:d=null}){var z,ae,W,ie,ee;const g=$r().pathname==="/pdv",[r,v]=a.useState(window.innerWidth<768);a.useEffect(()=>{const Q=()=>{v(window.innerWidth<768)};return window.addEventListener("resize",Q),()=>window.removeEventListener("resize",Q)},[]);const[j,f]=a.useState(null),[y,c]=a.useState(null),[m,k]=a.useState(null),[w,x]=a.useState(!1),[b,u]=a.useState(null),[i,p]=a.useState(null),[l,C]=a.useState(!1),[h,_]=a.useState(""),[S,$]=a.useState([]),[K,re]=a.useState(!1),[M,R]=a.useState({peso_pet_kg:"",idade_meses:"",nivel_atividade:"normal"}),[J,te]=a.useState(!1),[L,Z]=a.useState({x:0,y:0}),[A,G]=a.useState({x:0,y:0}),E=a.useRef(null),P=g?(()=>{try{const Q=sessionStorage.getItem("pdv_calculadora_data");if(console.log("üîç Calculadora Universal - Dados do PDV:",Q),Q){const{itens:de}=JSON.parse(Q),me=(de||[]).filter(Pe=>ln(Pe));return console.log("ü•´ Ra√ß√µes encontradas:",me),me}}catch(Q){console.error("Erro ao ler dados do PDV:",Q)}return[]})():[];a.useEffect(()=>{if(!g&&h.length>=2){const Q=setTimeout(async()=>{re(!0);try{const de=await F.get("/produtos/",{params:{busca:h}}),Pe=(de.data.items||de.data.produtos||[]).filter(se=>se.peso_embalagem&&se.peso_embalagem>0);$(Pe)}catch(de){console.error("Erro ao buscar ra√ß√µes:",de)}finally{re(!1)}},300);return()=>clearTimeout(Q)}else $([])},[h,g]),a.useEffect(()=>{s||Z({x:0,y:0})},[s]),a.useEffect(()=>{if(!s)return;const Q=de=>{de.key==="Escape"&&n()};return window.addEventListener("keydown",Q),()=>window.removeEventListener("keydown",Q)},[s,n]),a.useEffect(()=>{if(s&&g&&P.length>0){const Q=P[P.length-1];f(Q.produto_id),c(Q),Q.pet_id&&H(Q.pet_id)}},[s,P.length,g]);const H=async Q=>{try{const me=(await F.get(`/pets/${Q}`)).data;k(me),R({...M,peso_pet_kg:me.peso_kg||me.peso||"",idade_meses:me.idade_meses||me.idade_aproximada||""})}catch(de){console.error("Erro ao buscar pet:",de)}},B=async()=>{if(console.log("üîç Iniciando c√°lculo..."),console.log("üì¶ Ra√ß√£o selecionada:",y),console.log("üìù Formul√°rio:",M),!y){console.log("‚ùå Nenhuma ra√ß√£o selecionada"),Se.error("Selecione uma ra√ß√£o");return}if(!M.peso_pet_kg){console.log("‚ùå Peso do pet n√£o informado"),Se.error("Informe o peso do pet");return}try{x(!0),p(null),u(null);const de={produto_id:y.produto_id||y.id,peso_pet_kg:parseFloat(M.peso_pet_kg),idade_meses:M.idade_meses?parseInt(M.idade_meses):null,nivel_atividade:M.nivel_atividade};console.log("üì§ Enviando payload:",de);const me=await F.post("/produtos/calculadora-racao",de);if(console.log("üì• Resposta recebida:",me.data),me.data){const Pe={duracao_pacote_dias:me.data.duracao_dias,duracao_meses:me.data.duracao_meses,consumo_diario_gramas:me.data.quantidade_diaria_g,custo_por_kg:me.data.custo_por_kg,custo_diario:me.data.custo_por_dia,custo_mensal:me.data.custo_mensal};u(Pe),Se.success("C√°lculo realizado!")}}catch(de){console.error("‚ùå Erro ao calcular:",de),Se.error("Erro ao calcular. Tente novamente.")}finally{x(!1)}},N=Q=>{f(Q.id),c(Q),_(`${Q.nome} - ${Q.peso_embalagem}kg`),C(!1)},O=Q=>{r||Q.target.closest("button")||Q.target.closest("input")||Q.target.closest("select")||(te(!0),G({x:Q.clientX-L.x,y:Q.clientY-L.y}))};return a.useEffect(()=>{const Q=me=>{var Pe,se;if(J){const _e=window.innerWidth,ke=window.innerHeight,Ye=((Pe=E.current)==null?void 0:Pe.offsetWidth)||800,ze=((se=E.current)==null?void 0:se.offsetHeight)||600,Qe=(_e+Ye)/2-60,be=-Qe,Ee=(ke+ze)/2-60,he=-Ee,Xe=me.clientX-A.x,Je=me.clientY-A.y;Z({x:Math.min(Qe,Math.max(be,Xe)),y:Math.min(Ee,Math.max(he,Je))})}},de=()=>{te(!1)};if(J)return window.addEventListener("mousemove",Q),window.addEventListener("mouseup",de),()=>{window.removeEventListener("mousemove",Q),window.removeEventListener("mouseup",de)}},[J,A]),s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start md:items-center justify-center z-50 p-0 md:p-4 overflow-y-auto",onClick:n,children:e.jsxs("div",{ref:E,className:`
          bg-white 
          ${r?"w-full min-h-screen rounded-none":"rounded-xl w-full max-w-2xl max-h-[90vh]"} 
          shadow-2xl overflow-hidden flex flex-col
        `,onClick:Q=>Q.stopPropagation(),style:r?{}:{transform:`translate(${L.x}px, ${L.y}px)`,cursor:J?"grabbing":"default"},children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white px-4 md:px-6 py-3 md:py-4 flex items-center justify-between",onMouseDown:r?void 0:O,style:{cursor:r?"default":J?"grabbing":"grab"},children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("span",{className:"text-2xl md:text-3xl",children:"ü•´"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold",children:"Calculadora de Ra√ß√£o"}),e.jsx("p",{className:"text-xs md:text-sm text-orange-100",children:g?"Ra√ß√µes do carrinho":"Buscar ra√ß√£o manualmente"})]})]}),e.jsx("button",{onClick:n,className:"p-1.5 md:p-2 hover:bg-orange-400 rounded-lg transition-colors",children:e.jsx(ma,{size:r?20:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700",children:[g?"Ra√ß√£o do Carrinho":"Buscar Ra√ß√£o"," *"]}),g?P.length>0?e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:(y==null?void 0:y.produto_nome)||"",readOnly:!0,className:"w-full px-4 py-3 pr-10 bg-gray-50 border-2 border-gray-300 rounded-lg text-gray-700 font-medium cursor-pointer",placeholder:"Nenhuma ra√ß√£o no carrinho"}),e.jsx("button",{type:"button",onClick:()=>C(!l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:e.jsx(Ls,{size:20,className:`transition-transform ${l?"rotate-180":""}`})}),l&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-300 rounded-lg shadow-xl z-10 max-h-48 overflow-y-auto",children:P.map((Q,de)=>e.jsxs("button",{type:"button",onClick:()=>{f(Q.produto_id),c(Q),C(!1),Q.pet_id&&H(Q.pet_id)},className:`w-full px-4 py-3 text-left hover:bg-orange-50 transition-colors ${Q.produto_id===j?"bg-orange-100 border-l-4 border-l-orange-600":""}`,children:[e.jsx("div",{className:"font-medium",children:Q.produto_nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:[Q.peso_embalagem,"kg ‚Ä¢ R$ ",Q.preco_unitario.toFixed(2),Q.pet_id&&" ‚Ä¢ üêæ Pet vinculado"]})]},de))})]}):e.jsx("div",{className:"px-4 py-3 bg-yellow-50 border-2 border-yellow-300 rounded-lg text-yellow-700",children:"Adicione ra√ß√µes ao carrinho para calcular"}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:h,onChange:Q=>_(Q.target.value),onFocus:()=>S.length>0&&C(!0),placeholder:"Digite para buscar ra√ß√£o...",className:"w-full px-4 py-3 pr-20 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200"}),K?e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx(jr,{size:20,className:"animate-spin text-orange-500"})}):S.length>0&&e.jsx("button",{type:"button",onClick:()=>C(!l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:e.jsx(Ls,{size:20,className:`transition-transform ${l?"rotate-180":""}`})})]}),l&&S.length>0&&e.jsx("div",{className:"bg-white border-2 border-gray-300 rounded-lg shadow-xl max-h-64 overflow-y-auto",children:S.map(Q=>{var de;return e.jsxs("button",{type:"button",onClick:()=>N(Q),className:`w-full px-4 py-3 text-left hover:bg-orange-50 transition-colors border-b last:border-b-0 ${Q.id===j?"bg-orange-100 border-l-4 border-l-orange-600":""}`,children:[e.jsx("div",{className:"font-medium",children:Q.nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:[Q.peso_embalagem,"kg ‚Ä¢ R$ ",(de=Q.preco_venda)==null?void 0:de.toFixed(2),Q.classificacao_racao&&` ‚Ä¢ ${Q.classificacao_racao}`]})]},Q.id)})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Peso do Pet (kg) *"}),e.jsx("input",{type:"number",step:"0.1",value:M.peso_pet_kg,onChange:Q=>R({...M,peso_pet_kg:Q.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200",placeholder:"Ex: 8.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Idade (meses)"}),e.jsx("input",{type:"number",value:M.idade_meses,onChange:Q=>R({...M,idade_meses:Q.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200",placeholder:"Ex: 24"})]})]}),g&&m&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx("span",{className:"text-xl",children:"üêï"}),e.jsx("span",{className:"font-medium",children:m.nome})]}),e.jsx("div",{className:"text-sm text-blue-600 mt-1",children:"Dados carregados automaticamente do cadastro"})]}),b&&e.jsxs("div",{className:"bg-green-50 border-2 border-green-200 rounded-xl p-6 space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-green-800 flex items-center gap-2",children:[e.jsx("span",{children:"‚úÖ"})," Resultados do C√°lculo"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"‚è±Ô∏è Dura√ß√£o"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[Math.floor(b.duracao_pacote_dias)," dias"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(z=b.duracao_meses)==null?void 0:z.toFixed(1)," meses"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"ü•´ Consumo di√°rio"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[(ae=b.consumo_diario_gramas)==null?void 0:ae.toFixed(0),"g"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"üí∞ Custo/kg"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",(W=b.custo_por_kg)==null?void 0:W.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"üìÖ Custo/dia"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",(ie=b.custo_diario)==null?void 0:ie.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 col-span-1 sm:col-span-2",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"üìÜ Custo mensal"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",(ee=b.custo_mensal)==null?void 0:ee.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border-t px-4 md:px-6 py-3 md:py-4 flex flex-col-reverse sm:flex-row justify-end gap-2 md:gap-3",children:[e.jsx("button",{onClick:n,className:"px-6 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors font-medium",children:"Fechar"}),e.jsx("button",{onClick:B,disabled:w,className:"px-6 py-3 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white rounded-lg font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:w?e.jsxs(e.Fragment,{children:[e.jsx(jr,{size:20,className:"animate-spin"}),"Calculando..."]}):e.jsx(e.Fragment,{children:"üßÆ Calcular Consumo"})})]})]})}):null}const jl=()=>{var i,p,l,C;const s=$r(),{user:n,logout:t}=mt(),[d,o]=a.useState(window.innerWidth<768);a.useEffect(()=>{const h=()=>{o(window.innerWidth<768)};return window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]);const g=h=>{var S,$;return n?((S=n.role)==null?void 0:S.name)==="admin"||(($=n.role)==null?void 0:$.name)==="Admin"?!0:!n.permissions||!Array.isArray(n.permissions)?!1:n.permissions.includes(h):!1},[r,v]=a.useState(()=>{if(window.innerWidth<768)return!1;const h=localStorage.getItem("sidebar_open");return h!==null?JSON.parse(h):s.pathname!=="/pdv"}),[j,f]=a.useState({}),[y,c]=a.useState(()=>{const h=localStorage.getItem("sidebar_visible");return h!==null?JSON.parse(h):!0}),[m,k]=a.useState(!1),w=()=>{d&&v(!1)};a.useEffect(()=>{d||localStorage.setItem("sidebar_open",JSON.stringify(r))},[r,d]),a.useEffect(()=>{d||localStorage.setItem("sidebar_visible",JSON.stringify(y))},[y,d]),a.useEffect(()=>{d&&v(!1)},[s.pathname,d]),a.useEffect(()=>{d&&r&&v(!1)},[d,r]);const b=[{path:"/dashboard",icon:Fn,label:"Dashboard",permission:"relatorios.gerencial"},{path:"/dashboard-gerencial",icon:Jt,label:"üìä Dashboard Gerencial",highlight:!0,permission:"relatorios.gerencial"},{path:"/clientes",icon:zo,label:"Pessoas",permission:"clientes.visualizar"},{path:"/pets",icon:Fa,label:"üêæ Pets",highlight:!0,permission:"clientes.visualizar"},{path:"/produtos",icon:$t,label:"Produtos",permission:"produtos.visualizar",submenu:[{path:"/produtos",label:"Listar Produtos",permission:"produtos.visualizar"},{path:"/produtos/relatorio",label:"Relat√≥rio de Movimenta√ß√µes",permission:"produtos.visualizar"},{path:"/estoque/alertas",label:"Alertas de Estoque",permission:"produtos.visualizar"}]},{path:"/lembretes",icon:Io,label:"Lembretes",badge:!0,permission:null},{path:"/calculadora-racao",icon:$n,label:"Calculadora de Ra√ß√£o",permission:null},{path:"/pdv",icon:qs,label:"PDV (Vendas)",permission:"vendas.criar"},{path:"/ecommerce",icon:qs,label:"E-commerce MVP",permission:"vendas.visualizar"},{path:"/notas-fiscais",icon:Pn,label:"Notas Fiscais",permission:"vendas.visualizar"},{path:"/compras",icon:Rn,label:"Compras",permission:"compras.gerenciar",submenu:[{path:"/compras/pedidos",label:"Pedidos de Compra",permission:"compras.pedidos"},{path:"/compras/entrada-xml",label:"Entrada por XML",permission:"compras.entrada_xml"},{path:"/compras/bling",label:"Sinc. Bling",permission:"compras.sincronizacao_bling"}]},{path:"/financeiro",icon:Us,label:"Financeiro/Cont√°bil",permission:"relatorios.financeiro",submenu:[{path:"/financeiro",label:"Dashboard",permission:"financeiro.dashboard"},{path:"/financeiro/vendas",label:"Vendas",permission:"financeiro.vendas"},{path:"/financeiro/fluxo-caixa",label:"Fluxo de Caixa",permission:"financeiro.fluxo_caixa"},{path:"/financeiro/dre",label:"DRE",permission:"financeiro.dre"},{path:"/financeiro/contas-pagar",label:"Contas a Pagar",permission:"financeiro.contas_pagar"},{path:"/financeiro/contas-receber",label:"Contas a Receber",permission:"financeiro.contas_receber"},{path:"/financeiro/conciliacao-bancaria",label:"Concilia√ß√£o Banc√°ria",permission:"financeiro.conciliacao_bancaria"},{path:"/financeiro/conciliacao-3abas",label:"Concilia√ß√£o 3 Abas",highlight:!0,permission:"financeiro.conciliacao_cartao"}]},{path:"/comissoes",icon:Ga,label:"Comiss√µes",permission:"relatorios.financeiro",submenu:[{path:"/comissoes",label:"Configura√ß√£o",permission:"comissoes.configurar"},{path:"/comissoes/demonstrativo",label:"Demonstrativo",permission:"comissoes.demonstrativo"},{path:"/comissoes/abertas",label:"Comiss√µes em Aberto",permission:"comissoes.abertas"},{path:"/comissoes/fechamentos",label:"Hist√≥rico de Fechamentos",permission:"comissoes.fechamentos"},{path:"/comissoes/relatorios",label:"üìä Relat√≥rios Anal√≠ticos",permission:"comissoes.relatorios"}]},{path:"/entregas",icon:at,label:"Entregas",permission:"vendas.visualizar",submenu:[{path:"/entregas/abertas",label:"Entregas em Aberto",permission:"entregas.abertas"},{path:"/entregas/rotas",label:"Rotas de Entrega",permission:"entregas.rotas"},{path:"/entregas/historico",label:"üìú Hist√≥rico",permission:"entregas.historico"},{path:"/entregas/financeiro",label:"üìä Dashboard Financeiro",permission:"entregas.dashboard"}]},{path:"/cadastros",icon:jt,label:"Cadastros",permission:"configuracoes.editar",submenu:[{path:"/cadastros/cargos",label:"Cargos",permission:"cadastros.cargos"},{path:"/cadastros/categorias",label:"Categorias de Produtos",permission:"cadastros.categorias_produtos"},{path:"/cadastros/categorias-financeiras",label:"Categorias Financeiras",permission:"cadastros.categorias_financeiras"},{path:"/cadastros/especies-racas",label:"Esp√©cies e Ra√ßas",permission:"cadastros.especies_racas"},{path:"/cadastros/opcoes-racao",label:"Op√ß√µes de Ra√ß√£o",permission:"produtos.editar"},{path:"/cadastros/financeiro/bancos",label:"Bancos",permission:"cadastros.bancos"},{path:"/cadastros/financeiro/formas-pagamento",label:"Formas de Pagamento",permission:"cadastros.formas_pagamento"},{path:"/cadastros/financeiro/operadoras",label:"Operadoras de Cart√£o",permission:"cadastros.operadoras"}]},{path:"/rh",icon:An,label:"Recursos Humanos",permission:"usuarios.manage",submenu:[{path:"/rh/funcionarios",label:"Funcion√°rios",permission:"rh.funcionarios"}]},{path:"/ia",icon:Dn,label:"Intelig√™ncia Artificial",permission:null,submenu:[{path:"/ia/chat",label:"Chat IA",permission:null},{path:"/ia/fluxo-caixa",label:"Fluxo de Caixa Preditivo",permission:"ia.fluxo_caixa"},{path:"/ia/whatsapp",label:"Bot WhatsApp",permission:"ia.whatsapp"},{path:"/ia/alertas-racao",label:"‚ö† Alertas Ra√ß√µes",permission:"produtos.editar"}]},{path:"/admin",icon:To,label:"Administra√ß√£o",permission:"usuarios.manage",submenu:[{path:"/admin/usuarios",label:"Usu√°rios",permission:"usuarios.manage"},{path:"/admin/roles",label:"Roles & Permiss√µes",permission:"usuarios.manage"}]},{path:"/configuracoes",icon:jt,label:"Configura√ß√µes",permission:"configuracoes.editar",submenu:[{path:"/configuracoes/fiscal",label:"Configura√ß√£o da Empresa",permission:"configuracoes.empresa"},{path:"/configuracoes/entregas",label:"Entregas",permission:"configuracoes.entregas"},{path:"/configuracoes/custos-moto",label:"Custos da Moto",permission:"configuracoes.custos_moto"},{path:"/configuracoes/estoque",label:"Estoque"},{path:"/configuracoes/simples/fechamento",label:"Fechamento Mensal",permission:"configuracoes.fechamento_mensal"}]}].filter(h=>{if(h.submenu&&Array.isArray(h.submenu)){const _=h.submenu.filter(S=>S.permission?g(S.permission):!0);if(_.length===0)return!1;h.submenu=_}return h.permission?g(h.permission):!0}),u=h=>s.pathname===h;return e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[d&&r&&y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-0 z-40 md:hidden pointer-events-none",onClick:()=>v(!1)}),y&&e.jsxs("aside",{className:`${d?`fixed inset-y-0 left-0 z-50 w-64 transform transition-transform duration-300 ${r?"translate-x-0":"-translate-x-full"}`:`${r?"w-64":"w-20"} transition-all duration-300`} bg-gradient-to-b from-indigo-50 to-purple-50 border-r border-indigo-100 flex flex-col shadow-lg`,children:[e.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-indigo-100 bg-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[!d&&e.jsx("button",{onClick:()=>v(!r),className:"w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-400 to-purple-500 hover:from-indigo-500 hover:to-purple-600 flex items-center justify-center shadow-md transition-all cursor-pointer",title:r?"Recolher menu":"Expandir menu",children:e.jsx(lo,{className:"text-white w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg text-gray-800",children:"Pet Shop Pro"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Central de Gest√£o"})]})]}),e.jsx("button",{onClick:()=>d?v(!1):c(!1),className:"p-2 hover:bg-indigo-100 rounded-lg transition-colors",title:d?"Fechar menu":"Esconder menu completamente",children:d?e.jsx(ps,{className:"w-6 h-6 text-indigo-600"}):e.jsx(Fa,{className:"w-5 h-5 text-indigo-600"})})]}),e.jsx("nav",{className:"flex-1 py-2 md:py-4 overflow-y-auto overflow-x-hidden",children:Array.isArray(b)&&b.map(h=>e.jsx("div",{children:h.submenu?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{f(_=>({..._,[h.path]:!_[h.path]}))},className:`w-full flex items-center justify-between gap-2 md:gap-3 px-3 md:px-4 py-2.5 md:py-3 mx-1 md:mx-2 rounded-lg transition-all text-sm md:text-base ${s.pathname.startsWith(h.path)?"bg-gradient-to-r from-indigo-100 to-purple-100 text-indigo-700 shadow-sm":"text-gray-700 hover:bg-white/60"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx(h.icon,{className:"text-base md:text-lg flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium text-xs md:text-sm",children:h.label})]}),r&&(j[h.path]?e.jsx(Ws,{className:"text-xs md:text-sm text-gray-400"}):e.jsx(zs,{className:"text-xs md:text-sm text-gray-400"}))]}),j[h.path]&&r&&e.jsx("div",{className:"mt-1 mb-2 space-y-0.5 md:space-y-1",children:Array.isArray(h.submenu)&&h.submenu.map(_=>e.jsx(Ms,{to:_.path,onClick:w,className:`flex items-center gap-2 md:gap-3 px-3 md:px-4 py-1.5 md:py-2 mx-1 md:mx-2 ml-8 md:ml-12 rounded-lg transition-all text-xs md:text-sm ${u(_.path)?"bg-white text-indigo-600 shadow-sm font-medium":"text-gray-600 hover:bg-white/50"}`,children:e.jsx("span",{children:_.label})},_.path))})]}):e.jsxs(Ms,{to:h.path,onClick:w,className:`flex items-center gap-2 md:gap-3 px-3 md:px-4 py-2.5 md:py-3 mx-1 md:mx-2 my-0.5 md:my-1 rounded-lg transition-all text-sm md:text-base ${u(h.path)?"bg-gradient-to-r from-indigo-100 to-purple-100 text-indigo-700 shadow-sm":"text-gray-700 hover:bg-white/60"}`,title:r?"":h.label,children:[e.jsx(h.icon,{className:"text-base md:text-lg flex-shrink-0"}),r&&e.jsxs("div",{className:"flex items-center justify-between flex-1",children:[e.jsx("span",{className:"font-medium text-xs md:text-sm",children:h.label}),h.badge&&e.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full animate-pulse"})]})]})},h.path))}),e.jsx("div",{className:"border-t border-indigo-100 bg-white/30",children:e.jsxs("button",{onClick:t,className:"w-full flex items-center gap-3 px-4 py-3 mx-2 my-2 rounded-lg text-gray-700 hover:bg-red-50 hover:text-red-600 transition-all text-left",title:r?"":"Sair",children:[e.jsx(Mn,{className:"text-lg"}),r&&e.jsx("span",{className:"font-medium text-sm",children:"Sair"})]})})]}),!y&&!d&&e.jsx("button",{onClick:()=>c(!0),className:"fixed left-0 top-4 z-50 p-3 bg-gradient-to-br from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white rounded-r-xl shadow-lg transition-all",title:"Mostrar menu",children:e.jsx(Fa,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-3 md:px-6 py-3 md:py-4 flex items-center justify-between",children:[d&&y&&e.jsx("button",{onClick:()=>v(!r),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors md:hidden","aria-label":"Toggle menu",children:e.jsx(lo,{className:"w-6 h-6 text-gray-700"})}),d&&!y&&e.jsx("button",{onClick:()=>c(!0),className:"p-2 rounded-lg hover:bg-indigo-100 transition-colors md:hidden","aria-label":"Mostrar menu",children:e.jsx(Fa,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 ml-auto",children:[e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:(n==null?void 0:n.nome)||(n==null?void 0:n.email)}),e.jsx("p",{className:"text-xs text-gray-500",children:n==null?void 0:n.email})]}),e.jsx("div",{className:"w-9 h-9 md:w-10 md:h-10 rounded-full bg-purple-600 flex items-center justify-center text-white font-bold text-sm md:text-base",children:((p=(i=n==null?void 0:n.nome)==null?void 0:i[0])==null?void 0:p.toUpperCase())||((C=(l=n==null?void 0:n.email)==null?void 0:l[0])==null?void 0:C.toUpperCase())})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-3 md:p-6",children:e.jsx(vn,{})})]}),e.jsx(bl,{onClick:()=>{console.log("üéØ Layout: Abrindo calculadora..."),k(!0)}}),m&&e.jsx(fl,{isOpen:m,onClose:()=>{console.log("üéØ Layout: Fechando calculadora..."),k(!1)}})]})},vl=()=>{const[s,n]=a.useState(""),[t,d]=a.useState(""),[o,g]=a.useState(""),[r,v]=a.useState(!1),[j,f]=a.useState(!1),{login:y}=mt(),c=fa(),m=async k=>{var w,x;k.preventDefault(),g(""),f(!0);try{const b=await y(s,t);if(b.success){const u=localStorage.getItem("user");if(u){const i=JSON.parse(u),p=(x=(w=i.role)==null?void 0:w.name)==null?void 0:x.toLowerCase();console.log("üë§ Role do usu√°rio:",p),console.log("üë§ Permiss√µes:",i.permissions),p==="caixa"?(console.log("üéØ Usu√°rio caixa - Navegando para /pdv"),c("/pdv")):p==="admin"||p==="gerente"?(console.log("üéØ Usu√°rio gerencial - Navegando para /dashboard"),c("/dashboard")):(console.log("üéØ Redirecionando para /lembretes"),c("/lembretes"))}else c("/lembretes")}else console.error("‚ùå Login falhou:",b.error),g(b.error||"Erro desconhecido ao fazer login")}catch(b){console.error("‚ùå Erro inesperado:",b),g("Erro inesperado ao fazer login")}finally{f(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-purple-700 to-purple-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 animate-fade-in",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-purple-100 rounded-full mb-4",children:e.jsx(Fa,{className:"w-8 h-8 text-purple-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Pet Shop Pro"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Sistema de Gest√£o Completo"})]}),o&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(_a,{className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:o})]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pr,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"email",value:s,onChange:k=>n(k.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"seu@email.com",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(vr,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:r?"text":"password",value:t,onChange:k=>d(k.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",required:!0}),"              ",e.jsx("button",{type:"button",onClick:()=>v(!r),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition",children:r?e.jsx(yr,{}):e.jsx(Yt,{})}),"            "]})]}),e.jsx("button",{type:"submit",disabled:j,className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Entrando...":"Entrar"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["N√£o tem uma conta?"," ",e.jsx(Ms,{to:"/register",className:"text-purple-600 hover:text-purple-700 font-semibold",children:"Criar conta"})]})})]})})},yl=()=>{const[s,n]=a.useState(""),[t,d]=a.useState(""),[o,g]=a.useState(""),[r,v]=a.useState(""),[j,f]=a.useState(""),[y,c]=a.useState(!1),[m,k]=a.useState(!1),[w,x]=a.useState(!1),{register:b}=mt(),u=fa(),i=async p=>{if(p.preventDefault(),f(""),o!==r){f("As senhas n√£o coincidem");return}if(o.length<6){f("A senha deve ter no m√≠nimo 6 caracteres");return}x(!0);const l=await b(t,o,s);l.success?u("/dashboard"):f(l.error),x(!1)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-purple-700 to-purple-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 animate-fade-in",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-purple-100 rounded-full mb-4",children:e.jsx(Fa,{className:"w-8 h-8 text-purple-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Criar Conta"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Comece a usar o Pet Shop Pro"})]}),j&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(_a,{className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:j})]}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome"}),e.jsxs("div",{className:"relative",children:[e.jsx(ds,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:s,onChange:p=>n(p.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"Seu nome",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pr,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"email",value:t,onChange:p=>d(p.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"seu@email.com",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(vr,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:y?"text":"password",value:o,onChange:p=>g(p.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",required:!0}),e.jsx("button",{type:"button",onClick:()=>c(!y),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition",children:y?e.jsx(yr,{}):e.jsx(Yt,{})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirmar Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(vr,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:m?"text":"password",value:r,onChange:p=>v(p.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",required:!0}),e.jsx("button",{type:"button",onClick:()=>k(!m),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition",children:m?e.jsx(yr,{}):e.jsx(Yt,{})})]})]}),e.jsx("button",{type:"submit",disabled:w,className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:w?"Criando conta...":"Criar Conta"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["J√° tem uma conta?"," ",e.jsx(Ms,{to:"/login",className:"text-purple-600 hover:text-purple-700 font-semibold",children:"Fazer login"})]})})]})})};function Nl({isOpen:s,onClose:n,onSuccess:t}){var b,u;const[d,o]=a.useState(null),[g,r]=a.useState(!1),[v,j]=a.useState(null),[f,y]=a.useState("upload"),c=i=>{const p=i.target.files[0];p&&(p.name.endsWith(".xlsx")||p.name.endsWith(".xls")?(o(p),j(null)):(Se.error("Arquivo deve ser Excel (.xlsx ou .xls)"),i.target.value=""))},m=async()=>{try{const i=localStorage.getItem("token"),p=await F.get("/pessoas/template-importacao",{headers:{Authorization:`Bearer ${i}`},responseType:"blob"}),l=window.URL.createObjectURL(new Blob([p.data])),C=document.createElement("a");C.href=l,C.setAttribute("download",`template_pessoas_${new Date().toISOString().split("T")[0]}.xlsx`),document.body.appendChild(C),C.click(),C.remove(),window.URL.revokeObjectURL(l),Se.success("Template baixado com sucesso!")}catch(i){console.error("Erro ao baixar template:",i),Se.error("Erro ao baixar template")}},k=async()=>{var i,p,l,C;if(!d){Se.error("Selecione um arquivo para importar");return}r(!0),y("processando");try{const h=new FormData;h.append("file",d);const _=await F.post("/pessoas/importar",h);j(_.data),y("resultado");const S=(((i=_.data.criados)==null?void 0:i.length)||0)+(((p=_.data.atualizados)==null?void 0:p.length)||0);S>0&&(Se.success(`${S} pessoas processadas com sucesso!`),t&&t()),_.data.total_erros>0&&Se.error(`${_.data.total_erros} pessoas com erro`)}catch(h){console.error("Erro ao importar:",h),Se.error(((C=(l=h.response)==null?void 0:l.data)==null?void 0:C.detail)||"Erro ao importar pessoas"),y("upload")}finally{r(!1)}},w=()=>{o(null),j(null),y("upload")},x=()=>{w(),n()};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gradient-to-r from-purple-600 to-purple-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Importa√ß√£o de Pessoas em Lote"})]}),e.jsx("button",{onClick:x,className:"text-white hover:text-gray-200 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[f==="upload"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-purple-900 mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Como funciona"]}),e.jsxs("ul",{className:"text-sm text-purple-800 space-y-1 ml-7",children:[e.jsx("li",{children:"1. Baixe o template Excel clicando no bot√£o abaixo"}),e.jsx("li",{children:"2. Preencha os dados das pessoas (clientes, fornecedores, veterin√°rios)"}),e.jsx("li",{children:"3. Salve o arquivo e fa√ßa o upload aqui"}),e.jsx("li",{children:"4. Pessoas novas ser√£o criadas, existentes ser√£o atualizadas (baseado no CPF/CNPJ)"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:m,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Baixar Template Excel"]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecione a Planilha Preenchida"}),e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx("svg",{className:"w-12 h-12 mb-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:"Clique para selecionar"})," ou arraste o arquivo"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Apenas arquivos Excel (.xlsx, .xls)"}),d&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-purple-600",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"font-medium",children:d.name})]})]}),e.jsx("input",{type:"file",className:"hidden",accept:".xlsx,.xls",onChange:c})]})})]})]}),f==="processando"&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mb-4"}),e.jsx("p",{className:"text-lg text-gray-700",children:"Processando planilha..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Isso pode levar alguns segundos"})]}),f==="resultado"&&v&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:v.total_processados||0}),e.jsx("div",{className:"text-sm text-blue-800 mt-1",children:"Total Processado"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:((b=v.criados)==null?void 0:b.length)||0}),e.jsx("div",{className:"text-sm text-green-800 mt-1",children:"Criados"})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:((u=v.atualizados)==null?void 0:u.length)||0}),e.jsx("div",{className:"text-sm text-yellow-800 mt-1",children:"Atualizados"})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:v.total_erros||0}),e.jsx("div",{className:"text-sm text-red-800 mt-1",children:"Erros"})]})]}),v.criados&&v.criados.length>0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-green-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Pessoas Criadas (",v.criados.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-1",children:v.criados.map((i,p)=>e.jsxs("li",{className:"text-green-800",children:["Linha ",i.linha,": ",e.jsx("span",{className:"font-medium",children:i.nome})," (",i.tipo,")"]},p))})})]}),v.atualizados&&v.atualizados.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-yellow-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Pessoas Atualizadas (",v.atualizados.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-1",children:v.atualizados.map((i,p)=>e.jsxs("li",{className:"text-yellow-800",children:["Linha ",i.linha,": ",e.jsx("span",{className:"font-medium",children:i.nome})," (",i.tipo,")"]},p))})})]}),v.erros&&v.erros.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-red-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Erros (",v.erros.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-2",children:v.erros.map((i,p)=>e.jsxs("li",{className:"text-red-800",children:[e.jsxs("strong",{children:["Linha ",i.linha]})," (",i.nome||"?","): ",i.erro]},p))})})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3 bg-gray-50",children:[f==="upload"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:x,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:k,disabled:!d||g,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Importando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Importar Pessoas"]})})]}),f==="resultado"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:w,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Importar Novamente"}),e.jsx("button",{onClick:x,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Concluir"})]})]})]})}):null}const _l={venda:qs,conta_receber:Ga,pet_cadastro:Fa,pet_atualizacao:Fa,pedido_compra:$t,conta_pagar:Ga,recebimento:at,vacina:ns,consulta:ns,whatsapp:Ns},vo={green:"bg-green-100 text-green-700 border-green-300",yellow:"bg-yellow-100 text-yellow-700 border-yellow-300",red:"bg-red-100 text-red-700 border-red-300",blue:"bg-blue-100 text-blue-700 border-blue-300",purple:"bg-purple-100 text-purple-700 border-purple-300",gray:"bg-gray-100 text-gray-700 border-gray-300"},zr=({clienteId:s,fornecedorId:n,tipo:t="cliente",limit:d=5,showHeader:o=!0,onVerMais:g})=>{const[r,v]=a.useState([]),[j,f]=a.useState(!0),[y,c]=a.useState(""),m=t==="fornecedor"?n:s,k=t==="fornecedor"?`/clientes/fornecedor/${m}/timeline`:`/clientes/${m}/timeline`;a.useEffect(()=>{m&&w()},[m,d,t]);const w=async()=>{var u,i,p;try{f(!0),c("");const l=await F.get(`${k}?limit=${d}`);v(l.data)}catch(l){((u=l.response)==null?void 0:u.status)===500||((i=l.response)==null?void 0:i.status)===404?(console.warn("Timeline n√£o dispon√≠vel:",(p=l.response)==null?void 0:p.status),v([]),c("")):(console.error("Erro ao carregar timeline:",l),c("Erro ao carregar timeline"))}finally{f(!1)}},x=u=>{const i=new Date(u),p=new Date,l=new Date(p);return l.setDate(l.getDate()-1),i.toDateString()===p.toDateString()?`Hoje √†s ${i.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:i.toDateString()===l.toDateString()?`Ontem √†s ${i.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:i.toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})},b=u=>{console.log("Evento clicado:",u)};return j?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Carregando timeline..."})]})}):y?e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(_a,{}),y]}):r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ns,{className:"mx-auto text-gray-300 mb-4",size:48}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nenhum evento registrado"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Eventos do cliente aparecer√£o aqui conforme forem acontecendo"})]}):e.jsxs("div",{className:"space-y-4",children:[o&&e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(ns,{className:"text-blue-600"}),"Linha do Tempo"]}),g&&e.jsx("button",{onClick:g,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Ver completa ‚Üí"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-[19px] top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-6",children:r.map((u,i)=>{const p=_l[u.tipo_evento]||ns,l=vo[u.cor_badge]||vo.gray;return e.jsxs("div",{className:"relative pl-12 group",children:[e.jsx("div",{className:"absolute left-0 top-0 w-10 h-10 rounded-full bg-white border-2 border-gray-200 flex items-center justify-center group-hover:border-blue-400 transition-colors",children:e.jsx(p,{className:"text-gray-600 group-hover:text-blue-600 transition-colors",size:18})}),e.jsxs("div",{onClick:()=>b(u),className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md hover:border-gray-300 transition-all cursor-pointer",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:u.titulo}),e.jsx("p",{className:"text-sm text-gray-600",children:u.descricao})]}),e.jsx("span",{className:`ml-3 px-2 py-1 text-xs font-medium rounded border ${l} whitespace-nowrap`,children:u.status})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-3 pt-3 border-t border-gray-100",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Is,{size:12}),x(u.data_evento)]}),u.pet_id&&e.jsxs("span",{className:"flex items-center gap-1 text-blue-600",children:[e.jsx(Fa,{size:12}),"Pet relacionado"]})]})]})]},`${u.tipo_evento}-${u.evento_id}-${i}`)})})]}),r.length>=d&&g&&e.jsx("div",{className:"text-center pt-4",children:e.jsx("button",{onClick:g,className:"text-sm text-blue-600 hover:text-blue-700 font-medium underline",children:"Ver todos os eventos ‚Üí"})})]})};zr.propTypes={clienteId:Xs.number,fornecedorId:Xs.number,tipo:Xs.oneOf(["cliente","fornecedor"]),limit:Xs.number,showHeader:Xs.bool,onVerMais:Xs.func};const xt={VIP:{color:"purple",bgClass:"bg-purple-100",textClass:"text-purple-800",borderClass:"border-purple-300",icon:Vo,descricao:"Cliente de alto valor",emoji:"üëë"},Recorrente:{color:"blue",bgClass:"bg-blue-100",textClass:"text-blue-800",borderClass:"border-blue-300",icon:Us,descricao:"Compra com frequ√™ncia",emoji:"üîÑ"},Novo:{color:"green",bgClass:"bg-green-100",textClass:"text-green-800",borderClass:"border-green-300",icon:ds,descricao:"Cliente recente",emoji:"üåü"},Inativo:{color:"gray",bgClass:"bg-gray-100",textClass:"text-gray-800",borderClass:"border-gray-300",icon:Is,descricao:"Sem compras recentes",emoji:"‚è∞"},Endividado:{color:"red",bgClass:"bg-red-100",textClass:"text-red-800",borderClass:"border-red-300",icon:_a,descricao:"Alto saldo devedor",emoji:"‚ö†Ô∏è"},Risco:{color:"orange",bgClass:"bg-orange-100",textClass:"text-orange-800",borderClass:"border-orange-300",icon:cr,descricao:"Diminui√ß√£o de frequ√™ncia",emoji:"üìâ"},Regular:{color:"gray",bgClass:"bg-gray-100",textClass:"text-gray-600",borderClass:"border-gray-200",icon:ds,descricao:"Cliente regular",emoji:"üë§"}};function wl({segmento:s,size:n="sm",showIcon:t=!1}){if(!s)return null;const d=xt[s]||xt.Regular,o=d.icon,g={xs:"text-xs px-2 py-0.5",sm:"text-xs px-2 py-1",md:"text-sm px-3 py-1.5",lg:"text-base px-4 py-2"};return e.jsxs("span",{className:`inline-flex items-center gap-1 font-medium rounded-full ${d.bgClass} ${d.textClass} ${g[n]}`,title:d.descricao,children:[t&&e.jsx(o,{size:n==="xs"?10:n==="sm"?12:14}),d.emoji," ",s]})}function Cl({tag:s}){const n=xt[s]||xt.Regular;return e.jsxs("span",{className:`inline-flex items-center gap-1 text-xs font-medium px-2 py-1 rounded-md ${n.bgClass} ${n.textClass}`,title:n.descricao,children:[n.emoji," ",s]})}function Kt(s){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s)}function kl({clienteId:s,compact:n=!1}){const[t,d]=a.useState(null),[o,g]=a.useState(!0),[r,v]=a.useState(null),[j,f]=a.useState(!1);a.useEffect(()=>{s&&y()},[s]);const y=async()=>{var u;try{g(!0),v(null);const i=await F.get(`/segmentacao/clientes/${s}`);d(i.data)}catch(i){((u=i.response)==null?void 0:u.status)===404?v("not_calculated"):(v("Erro ao carregar segmenta√ß√£o"),console.error("Erro ao carregar segmenta√ß√£o:",i))}finally{g(!1)}},c=async()=>{try{f(!0);const u=await F.post(`/segmentacao/clientes/${s}/recalcular`);d(u.data),v(null)}catch(u){console.error("Erro ao recalcular segmento:",u),alert("Erro ao recalcular segmento. Tente novamente.")}finally{f(!1)}};if(o)return e.jsxs("div",{className:"animate-pulse bg-gray-100 rounded-lg p-6",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]});if(r==="not_calculated")return e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_a,{className:"text-yellow-600 mt-1",size:20}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-yellow-900 mb-2",children:"Segmenta√ß√£o n√£o calculada"}),e.jsx("p",{className:"text-sm text-yellow-800 mb-4",children:"Este cliente ainda n√£o foi segmentado. Clique abaixo para calcular."}),e.jsxs("button",{onClick:c,disabled:j,className:"flex items-center gap-2 px-4 py-2 bg-yellow-600 hover:bg-yellow-700 disabled:bg-yellow-400 text-white rounded-lg transition-colors text-sm font-medium",children:[e.jsx(Nt,{className:j?"animate-spin":""}),j?"Calculando...":"Calcular segmento"]})]})]})});if(r&&r!=="not_calculated")return e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-red-800",children:r})});if(!t)return null;const m=xt[t.segmento]||xt.Regular,k=m.icon,w=t.metricas||{},x={purple:"bg-gradient-to-br from-purple-50 to-purple-100 border-2 border-purple-300",blue:"bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-300",green:"bg-gradient-to-br from-green-50 to-green-100 border-2 border-green-300",gray:"bg-gradient-to-br from-gray-50 to-gray-100 border-2 border-gray-300",red:"bg-gradient-to-br from-red-50 to-red-100 border-2 border-red-300",orange:"bg-gradient-to-br from-orange-50 to-orange-100 border-2 border-orange-300"},b=x[m.color]||x.gray;return n?e.jsx(wl,{segmento:t.segmento,size:"sm"}):e.jsxs("div",{className:`${b} rounded-xl p-6 shadow-sm`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-3 ${m.bgClass} rounded-lg`,children:e.jsx(k,{className:m.textClass,size:24})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[m.emoji," Segmenta√ß√£o: ",e.jsx("span",{className:m.textClass,children:t.segmento})]}),e.jsx("p",{className:"text-sm text-gray-600",children:m.descricao})]})]}),e.jsxs("button",{onClick:c,disabled:j,className:"flex items-center gap-2 px-3 py-2 bg-white hover:bg-gray-50 disabled:bg-gray-100 border border-gray-300 text-gray-700 rounded-lg transition-colors text-sm",title:"Recalcular segmento",children:[e.jsx(Nt,{size:14,className:j?"animate-spin":""}),j?"Calculando...":"Atualizar"]})]}),t.tags&&t.tags.length>1&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-2",children:"Tamb√©m se enquadra em:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tags.filter(u=>u!==t.segmento).map(u=>e.jsx(Cl,{tag:u},u))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ga,{className:"text-gray-500",size:16}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Total 90 dias"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:Kt(w.total_compras_90d||0)})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(qs,{className:"text-gray-500",size:16}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Compras 90d"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:w.compras_90d||0})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Us,{className:"text-gray-500",size:16}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Ticket m√©dio"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:Kt(w.ticket_medio||0)})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Is,{className:"text-gray-500",size:16}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"√öltima compra"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:w.ultima_compra_dias===9999?"Nunca":`${w.ultima_compra_dias} dias`})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white/60 rounded-lg p-2",children:[e.jsx("span",{className:"text-gray-600",children:"Total em aberto:"}),e.jsx("span",{className:`font-semibold ${w.total_em_aberto>0?"text-red-600":"text-green-600"}`,children:Kt(w.total_em_aberto||0)})]}),e.jsxs("div",{className:"flex justify-between items-center bg-white/60 rounded-lg p-2",children:[e.jsx("span",{className:"text-gray-600",children:"Cliente h√°:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:w.primeira_compra_dias>0?`${w.primeira_compra_dias} dias`:"Sem compras"})]}),e.jsxs("div",{className:"flex justify-between items-center bg-white/60 rounded-lg p-2",children:[e.jsx("span",{className:"text-gray-600",children:"Total hist√≥rico:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:Kt(w.total_historico||0)})]}),e.jsxs("div",{className:"flex justify-between items-center bg-white/60 rounded-lg p-2",children:[e.jsx("span",{className:"text-gray-600",children:"Total de compras:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:w.total_compras_historico||0})]})]}),t.updated_at&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-300/50",children:e.jsxs("p",{className:"text-xs text-gray-600",children:["Atualizado em: ",new Date(t.updated_at).toLocaleString("pt-BR")]})})]})}const Sl={RISCO:{color:"red",bgClass:"bg-red-50",borderClass:"border-red-200",tagClass:"bg-red-100 text-red-700",label:"‚ö†Ô∏è Risco"},OPORTUNIDADE:{color:"green",bgClass:"bg-green-50",borderClass:"border-green-200",tagClass:"bg-green-100 text-green-700",label:"üí° Oportunidade"},ATENCAO:{color:"yellow",bgClass:"bg-yellow-50",borderClass:"border-yellow-200",tagClass:"bg-yellow-100 text-yellow-700",label:"üëÄ Aten√ß√£o"}};function El(s,n,t,d){const o=[],g=new Date;if((n==null?void 0:n.segmento)==="VIP"&&(n==null?void 0:n.dias_desde_ultima_compra)>20&&o.push({tipo:"RISCO",icone:Oo,titulo:"VIP em risco de churn",descricao:`Sem compras h√° ${n.dias_desde_ultima_compra} dias. Cliente VIP precisa de aten√ß√£o especial.`,prioridade:10}),(n==null?void 0:n.dias_desde_ultima_compra)>90&&o.push({tipo:"RISCO",icone:Is,titulo:"Cliente inativo h√° muito tempo",descricao:`√öltima compra foi h√° ${n.dias_desde_ultima_compra} dias. Considere campanha de reativa√ß√£o.`,prioridade:8}),(n==null?void 0:n.saldo_devedor)>0&&(n==null?void 0:n.total_90d)>0&&(n==null?void 0:n.dias_desde_ultima_compra)<30){const r=n.saldo_devedor/n.total_90d*100;r>50&&o.push({tipo:"ATENCAO",icone:Ga,titulo:"Alto endividamento com atividade recente",descricao:`Saldo devedor de R$ ${n.saldo_devedor.toFixed(2)} (${r.toFixed(0)}% das compras). Avaliar condi√ß√µes.`,prioridade:9})}if((n==null?void 0:n.segmento)==="Novo"&&(n==null?void 0:n.ticket_medio)>200&&o.push({tipo:"OPORTUNIDADE",icone:Us,titulo:"Novo cliente de alto valor",descricao:`Ticket m√©dio de R$ ${n.ticket_medio.toFixed(2)}. Potencial para se tornar VIP.`,prioridade:7}),d||o.push({tipo:"ATENCAO",icone:Ns,titulo:"WhatsApp n√£o registrado",descricao:"Adicione o n√∫mero para facilitar comunica√ß√£o e envio de promo√ß√µes.",prioridade:5}),t&&t.length>0){const r=t.filter(v=>{if(!v.ultima_consulta)return!0;const j=new Date(v.ultima_consulta);return Math.floor((g-j)/(1e3*60*60*24))>60});if(r.length>0){const v=r[0].nome;o.push({tipo:"OPORTUNIDADE",icone:Rr,titulo:`Pet ${v} sem consulta h√° mais de 60 dias`,descricao:`${r.length===1?"Considere":`${r.length} pets precisam de`} check-up ou retorno.`,prioridade:6})}}return(n==null?void 0:n.segmento)==="Recorrente"&&(n==null?void 0:n.dias_desde_ultima_compra)>30&&o.push({tipo:"ATENCAO",icone:Is,titulo:"Cliente recorrente com atraso",descricao:`Costuma comprar regularmente, mas est√° h√° ${n.dias_desde_ultima_compra} dias sem aparecer.`,prioridade:7}),(n==null?void 0:n.saldo_credito)>0&&o.push({tipo:"OPORTUNIDADE",icone:Ga,titulo:"Cliente tem cr√©dito dispon√≠vel",descricao:`R$ ${n.saldo_credito.toFixed(2)} de cr√©dito pode ser usado. Incentive o uso.`,prioridade:4}),o.sort((r,v)=>v.prioridade-r.prioridade).slice(0,3)}function Fl({clienteId:s,cliente:n,metricas:t}){const[d,o]=a.useState([]),[g,r]=a.useState(!1),[v,j]=a.useState([]);a.useEffect(()=>{s&&f()},[s,t]);const f=async()=>{try{r(!0);let y=(n==null?void 0:n.pets)||[];if(y.length===0&&s)try{y=(await F.get(`/clientes/${s}`)).data.pets||[]}catch(k){console.error("Erro ao carregar pets:",k)}j(y);const c=(n==null?void 0:n.celular)&&n.celular.trim()!=="",m=El(n,t,y,c);o(m)}catch(y){console.error("Erro ao calcular insights:",y),o([])}finally{r(!1)}};return g?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(vt,{className:"text-yellow-500",size:24}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"‚ö° Insights & A√ß√µes"})]}),e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm",children:"Analisando cliente..."})]})]}):!d||d.length===0?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(vt,{className:"text-yellow-500",size:24}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"‚ö° Insights & A√ß√µes"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-700",children:[e.jsx(Ts,{size:20}),e.jsx("p",{className:"font-medium",children:"‚úÖ Cliente em dia!"})]}),e.jsx("p",{className:"text-sm text-green-600 mt-1",children:"Nenhuma a√ß√£o priorit√°ria no momento"})]})]}):e.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 border-2 border-yellow-300 rounded-xl p-6 shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(vt,{className:"text-yellow-600",size:24}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"‚ö° Insights & A√ß√µes"}),e.jsxs("span",{className:"ml-auto text-xs text-gray-500 bg-white px-2 py-1 rounded-full",children:[d.length," ",d.length===1?"insight":"insights"]})]}),e.jsx("div",{className:"space-y-3",children:d.map((y,c)=>{const m=Sl[y.tipo],k=y.icone;return e.jsx("div",{className:`${m.bgClass} border ${m.borderClass} rounded-lg p-4 transition-all hover:shadow-md`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx(k,{className:`text-${m.color}-600`,size:20})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:y.titulo}),e.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${m.tagClass}`,children:m.label})]}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:y.descricao})]})]})},c)})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-yellow-200",children:e.jsxs("p",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(Ts,{size:12}),"Insights calculados automaticamente com base no hist√≥rico do cliente"]})})]})}const $l=()=>{var ea,na,ia,Ue,Ca;const s=fa(),[n,t]=a.useState([]),[d,o]=a.useState(!0),[g,r]=a.useState(""),[v,j]=a.useState(!1),[f,y]=a.useState(!1),[c,m]=a.useState(null),[k,w]=a.useState(""),[x,b]=a.useState("todos"),[u,i]=a.useState(1),[p,l]=a.useState(0),[C,h]=a.useState(20),[_,S]=a.useState(!1),[$,K]=a.useState(1),[re,M]=a.useState([]),[R,J]=a.useState(null),[te,L]=a.useState(""),[Z,A]=a.useState(null),[G,E]=a.useState(!1),[P,H]=a.useState(!1),[B,N]=a.useState([]),[O,z]=a.useState({}),[ae,W]=a.useState(null),[ie,ee]=a.useState(null),[Q,de]=a.useState(null),[me,Pe]=a.useState(!1),[se,_e]=a.useState({tipo_cadastro:"cliente",tipo_pessoa:"PF",nome:"",cpf:"",email:"",telefone:"",celular:"",celular_whatsapp:!0,cnpj:"",inscricao_estadual:"",razao_social:"",nome_fantasia:"",responsavel:"",crmv:"",parceiro_ativo:!1,parceiro_desde:"",parceiro_observacoes:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",estado:"",endereco_entrega:"",endereco_entrega_2:"",is_entregador:!1,entregador_ativo:!0,entregador_padrao:!1,tipo_vinculo_entrega:"",controla_rh:!1,gera_conta_pagar_custo_entrega:!1,media_entregas_configurada:"",custo_rh_ajustado:"",modelo_custo_entrega:"",taxa_fixa_entrega:"",valor_por_km_entrega:"",moto_propria:!0,tipo_acerto_entrega:"",dia_semana_acerto:"",dia_mes_acerto:"",is_terceirizado:!1,recebe_repasse:!1,gera_conta_pagar:!1,observacoes:"",tags:""}),[ke,Ye]=a.useState([]),[ze,Qe]=a.useState(null),[be,Ee]=a.useState(!1),[he,Xe]=a.useState({nome:"",especie:"",raca:"",sexo:"",data_nascimento:"",cor:"",peso:"",observacoes:"",castrado:!1,porte:"",microchip:"",alergias:"",doencas_cronicas:"",medicamentos_continuos:"",historico_clinico:"",foto_url:"",idade_aproximada:""}),Je=[{number:1,title:"Informa√ß√µes do cliente"},{number:2,title:"Contatos"},{number:3,title:"Endere√ßo"},{number:4,title:"Informa√ß√µes complementares"},{number:5,title:"Animais"},{number:6,title:"Financeiro"}];a.useEffect(()=>{ra()},[x,u,C]),a.useEffect(()=>{const V=setTimeout(()=>{u!==1?i(1):ra()},500);return()=>clearTimeout(V)},[g]),a.useEffect(()=>{he&&he.especie?ca(he.especie):N([])},[he==null?void 0:he.especie]),a.useEffect(()=>{if(ie&&re.length>0){const V=re.findIndex(Fe=>Fe.id===ie);V!==-1&&(Oe(V),ee(null))}},[re,ie]);const ca=async V=>{try{const Fe=await F.get(`/clientes/racas?especie=${V}`);N(Fe.data)}catch(Fe){console.error("Erro ao carregar ra√ßas:",Fe),N([])}},ra=async()=>{try{o(!0);const V=(u-1)*C,Fe=new URLSearchParams({skip:V.toString(),limit:C.toString()});x!=="todos"&&Fe.append("tipo_cadastro",x),g&&g.trim()&&Fe.append("search",g.trim());const Te=`/clientes/?${Fe.toString()}`,We=await F.get(Te);We.data.items?(t(We.data.items),l(We.data.total)):(t(We.data),l(We.data.length))}catch(V){w("Erro ao carregar pessoas"),console.error(V)}finally{o(!1)}},pa=async V=>{const Fe=V.replace(/\D/g,"");if(Fe.length===8){S(!0),L(""),w("");try{const We=await(await fetch(`https://viacep.com.br/ws/${Fe}/json/`)).json();if(We.erro){L("CEP n√£o encontrado");return}_e(ua=>({...ua,endereco:We.logradouro||"",bairro:We.bairro||"",cidade:We.localidade||"",estado:We.uf||"",cep:V}))}catch(Te){console.error("Erro ao buscar CEP:",Te)}finally{S(!1)}}},la=(V=null)=>{Qe(V!==null?{...ke[V],index:V}:{tipo:"entrega",apelido:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",estado:""}),Ee(!0)},oe=()=>{Ee(!1),Qe(null)},ye=async V=>{if(!(!V||V.length!==9)){S(!0);try{const Te=await(await fetch(`https://viacep.com.br/ws/${V.replace("-","")}/json/`)).json();if(Te.erro){alert("CEP n√£o encontrado");return}Qe(We=>({...We,endereco:Te.logradouro||"",bairro:Te.bairro||"",cidade:Te.localidade||"",estado:Te.uf||""}))}catch(Fe){console.error("Erro ao buscar CEP:",Fe),alert("Erro ao buscar CEP")}finally{S(!1)}}},Ce=()=>{if(!ze.cep||!ze.endereco||!ze.cidade){alert("Preencha pelo menos CEP, Endere√ßo e Cidade");return}const V=[...ke];ze.index!==void 0?(V[ze.index]={...ze},delete V[ze.index].index):V.push({...ze}),Ye(V),oe()},Be=V=>{if(confirm("Deseja realmente remover este endere√ßo?")){const Fe=ke.filter((Te,We)=>We!==V);Ye(Fe)}},Ie=async()=>{var V,Fe,Te,We,ua;w("");try{const xe=[];if((!se.nome||se.nome.trim()==="")&&xe.push("Nome"),se.tipo_pessoa==="PJ"&&((!se.cnpj||se.cnpj.trim()==="")&&xe.push("CNPJ"),(!se.razao_social||se.razao_social.trim()==="")&&xe.push("Raz√£o Social")),se.tipo_pessoa==="PF"&&se.tipo_cadastro==="cliente"&&(!se.cpf||se.cpf.trim()),xe.length>0){const va=`‚ùå Faltam os seguintes campos obrigat√≥rios:

`+xe.map(Ea=>`‚Ä¢ ${Ea}`).join(`
`);alert(va),w(va);return}if(se.is_entregador){if(!se.tipo_acerto_entrega){alert("Informe o tipo de acerto do entregador (semanal, quinzenal ou mensal)");return}if(se.tipo_acerto_entrega==="semanal"&&!se.dia_semana_acerto){alert("Informe o dia da semana para o acerto semanal");return}if(se.tipo_acerto_entrega==="mensal"&&!se.dia_mes_acerto){alert("Informe o dia do m√™s para o acerto mensal");return}if(se.tipo_acerto_entrega==="mensal"){const va=parseInt(se.dia_mes_acerto);if(va<1||va>28){alert("O dia do m√™s deve estar entre 1 e 28");return}}}const{celular_whatsapp:Ae,tags:qe,...sa}=se;sa.is_entregador&&(sa.tipo_cadastro==="funcionario"?(sa.tipo_vinculo_entrega="funcionario",sa.is_terceirizado=!1):sa.tipo_cadastro==="fornecedor"&&(sa.is_terceirizado=!0,sa.tipo_vinculo_entrega="terceirizado")),sa.enderecos_adicionais=ke.length>0?ke:null,Object.keys(sa).forEach(va=>{sa[va]===""&&(sa[va]=null)}),sa.tipo_cadastro==="todos"&&(sa.tipo_cadastro="cliente");let Ia;c?(await F.put(`/clientes/${c.id}`,sa),Ia=c.id):Ia=(await F.post("/clientes/",sa)).data.id;for(const va of re){const Ea=va.id,Na={...va};delete Na.id,delete Na.created_at,delete Na.updated_at,delete Na.cliente_id,delete Na.user_id,delete Na.ativo,delete Na.codigo,Object.keys(Na).forEach(Ja=>{Na[Ja]===""&&(Na[Ja]=null)}),Na.peso!==null&&Na.peso!==void 0&&(Na.peso=parseFloat(Na.peso)||null),Ea?(console.log(`Atualizando pet ${Ea}:`,Na),await F.put(`/clientes/pets/${Ea}`,Na)):(console.log("Criando novo pet:",Na),await F.post(`/clientes/${Ia}/pets`,Na))}ra(),X()}catch(xe){const Ae=(Fe=(V=xe.response)==null?void 0:V.data)==null?void 0:Fe.details;console.error("Erro completo:",(Te=xe.response)==null?void 0:Te.data),console.error("Detalhes de valida√ß√£o:",Ae);const qe={nome:"Nome",cpf:"CPF",cnpj:"CNPJ",razao_social:"Raz√£o Social",nome_fantasia:"Nome Fantasia",inscricao_estadual:"Inscri√ß√£o Estadual",responsavel:"Respons√°vel",telefone:"Telefone",celular:"Celular",email:"E-mail",cep:"CEP",endereco:"Endere√ßo",numero:"N√∫mero",bairro:"Bairro",cidade:"Cidade",estado:"Estado",tipo_pessoa:"Tipo de Pessoa",tipo_cadastro:"Tipo de Cadastro",crmv:"CRMV",tipo_acerto_entrega:"Tipo de Acerto",dia_semana_acerto:"Dia da Semana para Acerto",dia_mes_acerto:"Dia do M√™s para Acerto",tipo_vinculo_entrega:"Tipo de V√≠nculo"};let sa="";if(Ae&&Array.isArray(Ae)){const va=[];Ae.forEach(Ea=>{const Na=Ea.loc[Ea.loc.length-1],Ja=qe[Na]||Na;Ea.type==="missing"||Ea.type==="value_error.missing"?va.push(Ja):Ea.msg&&va.push(`${Ja}: ${Ea.msg}`),console.error(`Campo: ${Ja} | Tipo: ${Ea.type} | Mensagem: ${Ea.msg}`)}),va.length>0&&(sa=`‚ùå Faltam os seguintes campos obrigat√≥rios:

`+va.map(Ea=>`‚Ä¢ ${Ea}`).join(`
`))}const Ia=sa||((ua=(We=xe.response)==null?void 0:We.data)==null?void 0:ua.message)||"Erro ao salvar cliente";w(Ia),sa&&alert(sa)}},Y=async V=>{var Fe,Te;if(confirm("Tem certeza que deseja excluir este cliente?"))try{console.log("Excluindo cliente ID:",V);const We=await F.delete(`/clientes/${V}`);console.log("Cliente exclu√≠do com sucesso:",We),await ra()}catch(We){console.error("Erro ao excluir cliente:",We),console.error("Resposta do erro:",We.response),w(((Te=(Fe=We.response)==null?void 0:Fe.data)==null?void 0:Te.detail)||"Erro ao excluir cliente")}},je=async V=>{var Fe,Te;if(confirm("Tem certeza que deseja excluir este pet?"))try{console.log("Excluindo pet ID:",V),await F.delete(`/clientes/pets/${V}`),console.log("Pet exclu√≠do com sucesso"),z({}),await ra(),console.log("Lista de clientes atualizada")}catch(We){console.error("Erro ao excluir pet:",We),alert(((Te=(Fe=We.response)==null?void 0:Fe.data)==null?void 0:Te.detail)||"Erro ao excluir pet")}},Me=async V=>{var Fe;if(V)try{Pe(!0);const Te=await F.get(`/financeiro/cliente/${V}/resumo`);de(Te.data.resumo)}catch(Te){((Fe=Te.response)==null?void 0:Fe.status)!==404&&console.error("Erro ao carregar resumo financeiro:",Te),de(null)}finally{Pe(!1)}},T=(V=null,Fe=null,Te=null)=>{if(V)m(V),console.log("üêõ Cliente carregado do backend:",{id:V.id,nome:V.nome,is_entregador:V.is_entregador,entregador_padrao:V.entregador_padrao,entregador_padrao_tipo:typeof V.entregador_padrao}),_e({tipo_cadastro:V.tipo_cadastro||"cliente",tipo_pessoa:V.tipo_pessoa||"PF",nome:V.nome,cpf:V.cpf||"",email:V.email||"",telefone:V.telefone||"",celular:V.celular||"",celular_whatsapp:!0,cnpj:V.cnpj||"",inscricao_estadual:V.inscricao_estadual||"",razao_social:V.razao_social||"",nome_fantasia:V.nome_fantasia||"",responsavel:V.responsavel||"",crmv:V.crmv||"",parceiro_ativo:V.parceiro_ativo||!1,parceiro_desde:V.parceiro_desde||"",parceiro_observacoes:V.parceiro_observacoes||"",cep:V.cep||"",endereco:V.endereco||"",numero:V.numero||"",complemento:V.complemento||"",bairro:V.bairro||"",cidade:V.cidade||"",estado:V.estado||"",endereco_entrega:V.endereco_entrega||"",endereco_entrega_2:V.endereco_entrega_2||"",is_entregador:V.is_entregador||!1,entregador_ativo:V.entregador_ativo!==void 0?V.entregador_ativo:!0,entregador_padrao:V.entregador_padrao||!1,tipo_vinculo_entrega:V.tipo_vinculo_entrega||"",controla_rh:V.controla_rh||!1,gera_conta_pagar_custo_entrega:V.gera_conta_pagar_custo_entrega||!1,media_entregas_configurada:V.media_entregas_configurada||"",custo_rh_ajustado:V.custo_rh_ajustado||"",modelo_custo_entrega:V.modelo_custo_entrega||"",taxa_fixa_entrega:V.taxa_fixa_entrega||"",valor_por_km_entrega:V.valor_por_km_entrega||"",moto_propria:V.moto_propria!==void 0?V.moto_propria:!0,tipo_acerto_entrega:V.tipo_acerto_entrega||"",dia_semana_acerto:V.dia_semana_acerto||"",dia_mes_acerto:V.dia_mes_acerto||"",is_terceirizado:V.is_terceirizado||!1,recebe_repasse:V.recebe_repasse||!1,gera_conta_pagar:V.gera_conta_pagar||!1,observacoes:V.observacoes||"",tags:""}),M(V.pets||[]),Ye(V.enderecos_adicionais||[]),Me(V.id),Te?(ee(Te),K(5)):(K(1),ee(null));else{m(null);const We=Fe||(x==="todos"?"cliente":x);_e({tipo_cadastro:We,tipo_pessoa:We==="fornecedor"?"PJ":"PF",nome:"",cpf:"",email:"",telefone:"",celular:"",celular_whatsapp:!0,cnpj:"",inscricao_estadual:"",razao_social:"",nome_fantasia:"",responsavel:"",crmv:"",parceiro_ativo:!1,parceiro_desde:"",parceiro_observacoes:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",estado:"",is_entregador:!1,entregador_ativo:!0,tipo_vinculo_entrega:"",controla_rh:!1,media_entregas_configurada:"",custo_rh_ajustado:"",modelo_custo_entrega:"",taxa_fixa_entrega:"",valor_por_km_entrega:"",moto_propria:!0,is_terceirizado:!1,recebe_repasse:!1,gera_conta_pagar:!1,observacoes:"",tags:""}),M([]),Ye([]),K(1)}j(!0),w("")},X=()=>{j(!1),m(null),K(1),M([]),A(null),E(!1),H(!1),W(null),ee(null),de(null)},fe=async()=>{try{const V=new URLSearchParams;if(se.cpf&&V.append("cpf",se.cpf),se.cnpj&&V.append("cnpj",se.cnpj),se.telefone&&V.append("telefone",se.telefone),se.celular&&V.append("celular",se.celular),se.crmv&&V.append("crmv",se.crmv),c&&V.append("cliente_id",c.id),V.toString()){const Fe=await F.get(`/clientes/verificar-duplicata/campo?${V.toString()}`);if(Fe.data.duplicado)return A(Fe.data),E(!0),!0}return!1}catch(V){return console.error("Erro ao verificar duplicata:",V),!1}},U=async()=>{if($<6){if(w(""),L(""),$===1&&await fe()||$===2&&await fe())return;K($+1)}},le=V=>["cpf","cnpj","crmv"].includes(V),Ne=()=>{H(!0)},Re=async()=>{var V,Fe;try{o(!0);const Te=(c==null?void 0:c.codigo)||(n.length>0?Math.max(...n.map(We=>We.codigo))+1:1);await F.put(`/clientes/${Z.cliente.id}/remover-campo`,null,{params:{campo:Z.campo,novo_cliente_codigo:Te}}),H(!1),E(!1),A(null),K($+1)}catch(Te){w(((Fe=(V=Te.response)==null?void 0:V.data)==null?void 0:Fe.detail)||"Erro ao remover campo duplicado")}finally{o(!1)}},q=()=>{H(!1)},ne=()=>{X();const V=document.getElementById(`cliente-${Z.cliente.id}`);V&&(V.scrollIntoView({behavior:"smooth",block:"center"}),V.classList.add("ring-4","ring-yellow-400"),setTimeout(()=>{V.classList.remove("ring-4","ring-yellow-400")},3e3))},pe=()=>{const V=n.find(Fe=>Fe.id===Z.cliente.id);V&&(E(!1),A(null),H(!1),T(V))},$e=()=>{$>1&&(w(""),L(""),K($-1))},Oe=V=>{const Fe=re[V];Xe({nome:Fe.nome||"",especie:Fe.especie||"",raca:Fe.raca||"",sexo:Fe.sexo||"",data_nascimento:Fe.data_nascimento||"",cor:Fe.cor||"",peso:Fe.peso||"",observacoes:Fe.observacoes||"",castrado:Fe.castrado||!1,porte:Fe.porte||"",microchip:Fe.microchip||"",alergias:Fe.alergias||"",doencas_cronicas:Fe.doencas_cronicas||"",medicamentos_continuos:Fe.medicamentos_continuos||"",historico_clinico:Fe.historico_clinico||"",foto_url:Fe.foto_url||"",idade_aproximada:Fe.idade_aproximada||""}),J(V),Fe!=null&&Fe.id&&W(Fe.id)},Ke=n.filter(V=>{var Fe,Te,We,ua;return((Fe=V.codigo)==null?void 0:Fe.includes(g))||V.nome.toLowerCase().includes(g.toLowerCase())||((Te=V.cpf)==null?void 0:Te.includes(g))||((We=V.email)==null?void 0:We.toLowerCase().includes(g.toLowerCase()))||((ua=V.celular)==null?void 0:ua.includes(g))});function He({clienteId:V}){const[Fe,Te]=a.useState([]),[We,ua]=a.useState(!0);a.useEffect(()=>{V&&xe()},[V]);const xe=async()=>{try{ua(!0);const Ae=await F.get(`/whatsapp/clientes/${V}/whatsapp/ultimas?limit=5`);Te(Ae.data)}catch(Ae){console.error("Erro ao carregar mensagens:",Ae),Te([])}finally{ua(!1)}};return We?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Carregando mensagens..."})]}):Fe.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(Ns,{size:32,className:"mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm",children:"Nenhuma mensagem registrada ainda"}),e.jsx("p",{className:"text-xs mt-1",children:"As mensagens enviadas e recebidas aparecer√£o aqui"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"√öltimas 5 mensagens:"}),Fe.map(Ae=>e.jsxs("div",{className:`p-3 rounded-lg border ${Ae.direcao==="enviada"?"bg-green-50 border-green-200 ml-6":"bg-blue-50 border-blue-200 mr-6"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-semibold ${Ae.direcao==="enviada"?"text-green-700":"text-blue-700"}`,children:Ae.direcao==="enviada"?"‚Üí Enviada":"‚Üê Recebida"}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${Ae.status==="lido"?"bg-green-200 text-green-800":Ae.status==="enviado"?"bg-yellow-200 text-yellow-800":Ae.status==="recebido"?"bg-blue-200 text-blue-800":"bg-red-200 text-red-800"}`,children:Ae.status})]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(Ae.created_at).toLocaleString("pt-BR")})]}),e.jsx("p",{className:"text-sm text-gray-700",children:Ae.preview||Ae.conteudo})]},Ae.id))]})}return d?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando..."})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Cadastros"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerenciamento de clientes, fornecedores, veterin√°rios, funcion√°rios e pets"})]}),e.jsx("div",{className:"mb-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{b("todos"),i(1)},className:`px-4 py-2 font-medium border-b-2 transition-colors ${x==="todos"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Todos"}),e.jsx("button",{onClick:()=>{b("cliente"),i(1)},className:`px-4 py-2 font-medium border-b-2 transition-colors ${x==="cliente"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Clientes"}),e.jsx("button",{onClick:()=>{b("fornecedor"),i(1)},className:`px-4 py-2 font-medium border-b-2 transition-colors ${x==="fornecedor"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Fornecedores"}),e.jsx("button",{onClick:()=>{b("veterinario"),i(1)},className:`px-4 py-2 font-medium border-b-2 transition-colors ${x==="veterinario"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Veterin√°rios"}),e.jsx("button",{onClick:()=>{b("funcionario"),i(1)},className:`px-4 py-2 font-medium border-b-2 transition-colors ${x==="funcionario"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Funcion√°rios"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6 flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Bo,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por c√≥digo, nome, CPF/CNPJ, email ou telefone...",value:g,onChange:V=>r(V.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>y(!0),className:"flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx(Ln,{})," Importar Excel"]}),e.jsxs("button",{onClick:()=>T(null,x),className:"flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx(Qa,{})," Novo ",x==="cliente"?"Cliente":x==="fornecedor"?"Fornecedor":x==="veterinario"?"Veterin√°rio":x==="funcionario"?"Funcion√°rio":"Cadastro"]})]})]}),k&&!v&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(_a,{}),e.jsx("span",{children:k})]}),!d&&p>0&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border border-gray-200 rounded-t-lg flex items-center justify-between mb-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",(u-1)*C+1," a ",Math.min(u*C,p)," de ",p," pessoas"]}),e.jsxs("select",{value:C,onChange:V=>{h(Number(V.target.value)),i(1)},className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10 por p√°gina"}),e.jsx("option",{value:20,children:"20 por p√°gina"}),e.jsx("option",{value:30,children:"30 por p√°gina"}),e.jsx("option",{value:50,children:"50 por p√°gina"}),e.jsx("option",{value:100,children:"100 por p√°gina"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(1),disabled:u===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Primeira"}),e.jsx("button",{onClick:()=>i(V=>Math.max(V-1,1)),disabled:u===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(Math.ceil(p/C),5)},(V,Fe)=>{const Te=Math.ceil(p/C);let We;return Te<=5||u<=3?We=Fe+1:u>=Te-2?We=Te-4+Fe:We=u-2+Fe,e.jsx("button",{onClick:()=>i(We),className:`px-3 py-1 text-sm font-medium rounded-lg transition-colors ${u===We?"bg-purple-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:We},We)})}),e.jsx("button",{onClick:()=>i(V=>Math.min(V+1,Math.ceil(p/C))),disabled:u===Math.ceil(p/C),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Pr√≥xima"}),e.jsx("button",{onClick:()=>i(Math.ceil(p/C)),disabled:u===Math.ceil(p/C),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"√öltima"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[Ke.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CPF/CNPJ"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Celular"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pets"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Segmento"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ke.map(V=>{var Fe;return e.jsxs(a.Fragment,{children:[e.jsxs("tr",{id:`cliente-${V.id}`,onClick:()=>T(V),className:"hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-medium",children:V.codigo}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:V.nome}),V.tipo_pessoa==="PJ"&&V.razao_social&&e.jsx("span",{className:"text-xs text-gray-500",children:V.razao_social}),V.parceiro_ativo&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-green-700 bg-green-100 px-2 py-0.5 rounded-full w-fit",children:[e.jsx(Ga,{size:12}),"Parceiro"]})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700",children:V.tipo_pessoa==="PF"?V.cpf||"-":V.cnpj||"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700",children:V.celular||"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",onClick:Te=>Te.stopPropagation(),children:e.jsxs("button",{onClick:()=>z({...O,[V.id]:!O[V.id]}),className:"flex items-center gap-2 text-sm text-gray-700 hover:text-gray-900 transition-colors",children:[e.jsx(Fa,{size:16,className:"text-gray-400"}),e.jsx("span",{children:((Fe=V.pets)==null?void 0:Fe.length)||0}),V.pets&&V.pets.length>0&&e.jsx(Zt,{size:14,className:`transform transition-transform ${O[V.id]?"rotate-90":""}`})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:"text-xs text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",onClick:Te=>Te.stopPropagation(),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[V.celular&&e.jsx("button",{onClick:()=>{const Te=V.celular.replace(/\D/g,"");window.open(`https://wa.me/55${Te}`,"_blank")},className:"text-green-600 hover:text-green-900 transition-colors",title:"Abrir WhatsApp",children:e.jsx(Ns,{size:16})}),e.jsx("button",{onClick:()=>T(V),className:"text-blue-600 hover:text-blue-900 transition-colors",title:"Editar",children:e.jsx(_s,{size:16})}),e.jsx("button",{onClick:()=>Y(V.id),className:"text-red-600 hover:text-red-900 transition-colors",title:"Excluir",children:e.jsx(gs,{size:16})})]})})]}),O[V.id]&&V.pets&&V.pets.length>0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-3 bg-gray-50",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-xs font-semibold text-gray-700 mb-2",children:["Pets de ",V.nome,":"]}),V.pets.map(Te=>e.jsxs("div",{className:`bg-white rounded-lg p-3 flex justify-between items-start border border-gray-200 ${ae===Te.id?"ring-2 ring-blue-400 shadow-lg bg-blue-50":""}`,children:[e.jsxs("div",{className:"flex-1 grid grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Nome"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:Te.nome})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Esp√©cie/Ra√ßa"}),e.jsxs("p",{className:"text-sm text-gray-700",children:[Te.especie," ",Te.raca&&`- ${Te.raca}`]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Sexo"}),e.jsx("p",{className:"text-sm text-gray-700",children:Te.sexo||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Nascimento"}),e.jsx("p",{className:"text-sm text-gray-700",children:Te.data_nascimento?new Date(Te.data_nascimento).toLocaleDateString("pt-BR"):"-"})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx("button",{onClick:()=>{W(Te.id),T(V,null,Te.id)},className:"text-blue-600 hover:text-blue-900 p-1 transition-colors",title:"Editar pet",children:e.jsx(_s,{size:14})}),e.jsx("button",{onClick:()=>je(Te.id),className:"text-red-600 hover:text-red-900 p-1 transition-colors",title:"Excluir pet",children:e.jsx(gs,{size:14})})]})]},Te.id))]})})})]},V.id)})})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ds,{className:"mx-auto text-gray-400 mb-4",size:48}),e.jsx("p",{className:"text-gray-600",children:"Nenhum cliente encontrado"})]}),!d&&p>0&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",(u-1)*C+1," a ",Math.min(u*C,p)," de ",p," pessoas"]}),e.jsxs("select",{value:C,onChange:V=>{h(Number(V.target.value)),i(1)},className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10 por p√°gina"}),e.jsx("option",{value:20,children:"20 por p√°gina"}),e.jsx("option",{value:30,children:"30 por p√°gina"}),e.jsx("option",{value:50,children:"50 por p√°gina"}),e.jsx("option",{value:100,children:"100 por p√°gina"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(1),disabled:u===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Primeira"}),e.jsx("button",{onClick:()=>i(V=>Math.max(V-1,1)),disabled:u===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(Math.ceil(p/C),5)},(V,Fe)=>{const Te=Math.ceil(p/C);let We;return Te<=5||u<=3?We=Fe+1:u>=Te-2?We=Te-4+Fe:We=u-2+Fe,e.jsx("button",{onClick:()=>i(We),className:`px-3 py-1 text-sm font-medium rounded-lg transition-colors ${u===We?"bg-purple-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:We},We)})}),e.jsx("button",{onClick:()=>i(V=>Math.min(V+1,Math.ceil(p/C))),disabled:u===Math.ceil(p/C),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Pr√≥xima"}),e.jsx("button",{onClick:()=>i(Math.ceil(p/C)),disabled:u===Math.ceil(p/C),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"√öltima"})]})]})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:c?`Editar ${c.tipo_cadastro==="cliente"?"Cliente":c.tipo_cadastro==="fornecedor"?"Fornecedor":"Veterin√°rio"}`:`Adicionar ${se.tipo_cadastro==="cliente"?"Cliente":se.tipo_cadastro==="fornecedor"?"Fornecedor":"Veterin√°rio"}`}),e.jsx("button",{onClick:X,className:"text-gray-400 hover:text-gray-600",children:e.jsx(ps,{size:24})})]}),e.jsx("div",{className:"flex items-center justify-between mb-2",children:Je.map((V,Fe)=>e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("button",{onClick:()=>K(V.number),className:`w-8 h-8 rounded-full flex items-center justify-center font-semibold text-sm transition-all hover:scale-110 cursor-pointer ${$>V.number?"bg-green-500 text-white hover:bg-green-600":$===V.number?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-600 hover:bg-gray-400"}`,type:"button",title:`Ir para: ${V.title}`,children:$>V.number?e.jsx(_t,{}):V.number}),e.jsx("span",{className:"text-xs mt-1 text-center hidden md:block",children:V.title})]}),Fe<Je.length-1&&e.jsx("div",{className:`h-0.5 flex-1 ${$>V.number?"bg-green-500":"bg-gray-300"}`})]},V.number))}),e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[$,"/6"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[k&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(_a,{}),e.jsx("span",{children:k})]}),G&&Z&&e.jsx("div",{className:"mb-4 p-4 bg-yellow-50 border-2 border-yellow-400 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_a,{className:"text-yellow-600 mt-1",size:24}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-yellow-900 mb-2",children:"‚ö†Ô∏è Cliente j√° cadastrado!"}),e.jsxs("p",{className:"text-sm text-yellow-800 mb-3",children:["J√° existe um cliente com o mesmo ",e.jsx("strong",{children:Z.campo})," cadastrado:"]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-yellow-300 mb-3",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:Z.cliente.nome}),e.jsxs("p",{className:"text-sm text-gray-600",children:["C√≥digo: ",Z.cliente.codigo]}),Z.cliente.cpf&&e.jsxs("p",{className:"text-sm text-gray-600",children:["CPF: ",Z.cliente.cpf]}),Z.cliente.celular&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Celular: ",Z.cliente.celular]}),Z.cliente.telefone&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Telefone: ",Z.cliente.telefone]})]}),le(Z.campo)?e.jsxs("div",{children:[e.jsxs("div",{className:"bg-red-50 border border-red-300 rounded-lg p-4 mb-3",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 mb-2",children:"üö´ N√£o √© poss√≠vel criar novo cadastro"}),e.jsxs("p",{className:"text-sm text-red-800 mb-2",children:[Z.campo.toUpperCase()," √© um documento √∫nico e j√° est√° cadastrado."]}),e.jsx("p",{className:"text-sm text-red-700",children:"Voc√™ pode editar o cadastro existente ou visualiz√°-lo."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:pe,className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:"‚úèÔ∏è Editar cadastro existente"}),e.jsx("button",{onClick:ne,className:"flex-1 px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm font-medium transition-colors",children:"üëÅÔ∏è Ver cadastro"})]})]}):P?e.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-lg p-4 mb-3",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 mb-2",children:"‚ö†Ô∏è Aten√ß√£o!"}),e.jsxs("p",{className:"text-sm text-red-800 mb-3",children:["O ",e.jsx("strong",{children:Z.campo})," ser√° removido do cadastro do cliente ",e.jsx("strong",{children:Z.cliente.nome})," (C√≥digo ",Z.cliente.codigo,") e uma observa√ß√£o ser√° adicionada informando a transfer√™ncia."]}),e.jsxs("p",{className:"text-xs text-red-700 mb-3",children:['No cadastro antigo ficar√° registrado: "Sem n√∫mero por cadastro novo do cliente c√≥digo ',(c==null?void 0:c.codigo)||(n.length>0?Math.max(...n.map(V=>V.codigo))+1:1),'"']}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Re,disabled:d,className:"flex-1 px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition-colors disabled:opacity-50",children:d?"Processando...":"Confirmar e continuar"}),e.jsx("button",{onClick:q,disabled:d,className:"flex-1 px-3 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg text-sm font-medium transition-colors disabled:opacity-50",children:"Cancelar"})]})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ne,className:"flex-1 px-3 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg text-sm font-medium transition-colors",children:"Ver cadastro existente"}),e.jsxs("button",{onClick:Ne,className:"flex-1 px-3 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-medium transition-colors",children:["Transferir ",Z.campo]})]})]})]})}),$===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informa√ß√µes do cadastro"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de cadastro *"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"cliente",checked:se.tipo_cadastro==="cliente",onChange:V=>{_e({...se,tipo_cadastro:V.target.value,tipo_pessoa:"PF"})},className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Cliente"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"fornecedor",checked:se.tipo_cadastro==="fornecedor",onChange:V=>{_e({...se,tipo_cadastro:V.target.value,tipo_pessoa:"PJ"})},className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Fornecedor"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"veterinario",checked:se.tipo_cadastro==="veterinario",onChange:V=>_e({...se,tipo_cadastro:V.target.value}),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Veterin√°rio"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"funcionario",checked:se.tipo_cadastro==="funcionario",onChange:V=>_e({...se,tipo_cadastro:V.target.value,tipo_pessoa:"PF"}),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Funcion√°rio"})]})]})]}),(se.tipo_cadastro==="funcionario"||se.tipo_cadastro==="fornecedor")&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0"})}),e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"√â entregador"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-auto",children:[e.jsx("input",{type:"checkbox",checked:se.is_entregador||!1,onChange:V=>_e({...se,is_entregador:V.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"})]})]}),se.is_entregador&&e.jsxs("div",{className:"ml-5 mt-2 space-y-2 border-l-2 border-blue-300 pl-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.entregador_padrao||!1,onChange:V=>_e({...se,entregador_padrao:V.target.checked}),className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Entregador padr√£o"}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"(pr√©-selecionado nas rotas)"})]}),se.tipo_cadastro==="funcionario"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-start gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.controla_rh||!1,onChange:V=>{const Fe=V.target.checked;_e({...se,controla_rh:Fe,modelo_custo_entrega:Fe?"":se.modelo_custo_entrega,taxa_fixa_entrega:Fe?"":se.taxa_fixa_entrega,valor_por_km_entrega:Fe?"":se.valor_por_km_entrega,gera_conta_pagar_custo_entrega:!1})},className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Controla RH"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5",children:"Custo rateado na folha (n√£o gera contas a pagar)"})]})]}),se.controla_rh&&e.jsx("div",{className:"ml-5 pl-3 border-l-2 border-blue-300",children:e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"M√©dia de entregas por m√™s"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5 mb-1",children:"Define o rateio inicial do custo do funcion√°rio por entrega. Ser√° ajustado automaticamente no final do m√™s."}),e.jsx("input",{type:"number",min:"1",step:"1",value:se.media_entregas_configurada||"",onChange:V=>_e({...se,media_entregas_configurada:V.target.value}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"Ex: 100 entregas/m√™s"}),e.jsx("p",{className:"text-[10px] text-blue-600 mt-1",children:"üí° Exemplo: Se o custo mensal √© R$ 3.000 e m√©dia √© 100 entregas, cada entrega custar√° R$ 30,00 inicialmente"})]})}),!se.controla_rh&&e.jsxs("label",{className:"flex items-start gap-2 cursor-pointer ml-5 pl-2 border-l border-gray-300",children:[e.jsx("input",{type:"checkbox",checked:se.gera_conta_pagar_custo_entrega||!1,onChange:V=>_e({...se,gera_conta_pagar_custo_entrega:V.target.checked}),className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Gerar contas a pagar por entrega"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5",children:"Marque se este funcion√°rio recebe por KM ou taxa fixa a cada entrega"})]})]})]}),(se.tipo_cadastro==="fornecedor"||se.tipo_cadastro==="funcionario"&&!se.controla_rh)&&e.jsxs("div",{className:"space-y-2",children:[se.tipo_cadastro==="fornecedor"&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-1.5 text-[10px] text-yellow-800",children:["‚ö†Ô∏è ",e.jsx("strong",{children:"Terceirizado"})," - Sempre gera contas a pagar"]}),se.tipo_cadastro==="funcionario"&&!se.controla_rh&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-1.5 text-[10px] text-blue-800",children:["‚ÑπÔ∏è ",e.jsx("strong",{children:"Funcion√°rio sem RH"})," - ",se.gera_conta_pagar_custo_entrega?"Gera CP por entrega":"N√£o gera CP"]}),e.jsxs("label",{className:"flex items-start gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.modelo_custo_entrega==="taxa_fixa",onChange:V=>_e({...se,modelo_custo_entrega:V.target.checked?"taxa_fixa":"",valor_por_km_entrega:""}),className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Taxa Fixa"}),se.modelo_custo_entrega==="taxa_fixa"&&e.jsx("input",{type:"number",step:"0.01",min:"0",value:se.taxa_fixa_entrega||"",onChange:V=>_e({...se,taxa_fixa_entrega:V.target.value}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded mt-1 focus:ring-1 focus:ring-blue-500",placeholder:"Ex: 15.00"})]})]}),e.jsxs("label",{className:"flex items-start gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.modelo_custo_entrega==="por_km",onChange:V=>_e({...se,modelo_custo_entrega:V.target.checked?"por_km":"",taxa_fixa_entrega:""}),className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Valor por KM"}),se.modelo_custo_entrega==="por_km"&&e.jsx("input",{type:"number",step:"0.01",min:"0",value:se.valor_por_km_entrega||"",onChange:V=>_e({...se,valor_por_km_entrega:V.target.value}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded mt-1 focus:ring-1 focus:ring-blue-500",placeholder:"Ex: 2.50"})]})]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.moto_propria||!1,onChange:V=>_e({...se,moto_propria:V.target.checked}),className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-700",children:se.moto_propria?"‚úÖ Moto pr√≥pria":"üè¢ Moto da loja"})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-blue-200",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700 mb-2",children:"üìÜ Acerto Financeiro"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-gray-600 mb-0.5",children:"Periodicidade"}),e.jsxs("select",{value:se.tipo_acerto_entrega||"",onChange:V=>_e({...se,tipo_acerto_entrega:V.target.value,dia_semana_acerto:"",dia_mes_acerto:""}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione"}),e.jsx("option",{value:"semanal",children:"Semanal"}),e.jsx("option",{value:"quinzenal",children:"Quinzenal (dias 1 e 15)"}),e.jsx("option",{value:"mensal",children:"Mensal"})]})]}),se.tipo_acerto_entrega==="semanal"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-gray-600 mb-0.5",children:"Dia da semana"}),e.jsxs("select",{value:se.dia_semana_acerto||"",onChange:V=>_e({...se,dia_semana_acerto:V.target.value}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione"}),e.jsx("option",{value:"1",children:"Segunda"}),e.jsx("option",{value:"2",children:"Ter√ßa"}),e.jsx("option",{value:"3",children:"Quarta"}),e.jsx("option",{value:"4",children:"Quinta"}),e.jsx("option",{value:"5",children:"Sexta"}),e.jsx("option",{value:"6",children:"S√°bado"}),e.jsx("option",{value:"7",children:"Domingo"})]})]}),se.tipo_acerto_entrega==="mensal"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-gray-600 mb-0.5",children:"Dia do m√™s (1 a 28)"}),e.jsx("input",{type:"number",min:"1",max:"28",value:se.dia_mes_acerto||"",onChange:V=>_e({...se,dia_mes_acerto:V.target.value}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"Ex: 5"})]}),se.tipo_acerto_entrega==="quinzenal"&&e.jsxs("div",{className:"bg-blue-50 p-1.5 rounded text-[10px] text-blue-700",children:["‚ÑπÔ∏è Acerto nos dias ",e.jsx("strong",{children:"1"})," e ",e.jsx("strong",{children:"15"})]})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ga,{className:"text-green-600",size:20}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Ativar como parceiro (comiss√µes)"}),se.parceiro_ativo&&e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 bg-green-600 text-white rounded-full text-xs font-semibold animate-fade-in",children:[e.jsx(_t,{size:14,className:"font-bold"}),e.jsx("span",{children:"Parceiro habilitado para comiss√£o"})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.parceiro_ativo,onChange:V=>_e({...se,parceiro_ativo:V.target.checked,parceiro_desde:V.target.checked&&!se.parceiro_desde?new Date().toISOString().split("T")[0]:se.parceiro_desde||""}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-7",children:"Ao ativar, esta pessoa poder√° receber comiss√µes de vendas, independente do tipo de cadastro"}),se.parceiro_ativo&&e.jsxs("div",{className:"mt-3 ml-7",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Observa√ß√µes do parceiro (opcional)"}),e.jsx("textarea",{value:se.parceiro_observacoes,onChange:V=>_e({...se,parceiro_observacoes:V.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none",placeholder:"Ex: Especialista em produtos de higiene...",rows:"2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:se.tipo_pessoa==="PJ"?"Tipo de pessoa jur√≠dica *":"Tipo de pessoa *"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"PF",checked:se.tipo_pessoa==="PF",onChange:V=>_e({...se,tipo_pessoa:V.target.value}),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Pessoa F√≠sica"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"PJ",checked:se.tipo_pessoa==="PJ",onChange:V=>_e({...se,tipo_pessoa:V.target.value}),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Pessoa Jur√≠dica"})]})]})]}),se.tipo_pessoa==="PF"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome completo *"}),e.jsx("input",{type:"text",value:se.nome,onChange:V=>_e({...se,nome:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Digite o nome completo",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CPF"}),e.jsx("input",{type:"text",value:se.cpf,onChange:V=>{_e({...se,cpf:V.target.value}),E(!1),A(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"000.000.000-00",maxLength:"14"})]}),se.tipo_cadastro==="veterinario"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CRMV"}),e.jsx("input",{type:"text",value:se.crmv,onChange:V=>{_e({...se,crmv:V.target.value}),E(!1),A(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"CRMV XX 1234",maxLength:"20"})]})]}),se.tipo_pessoa==="PJ"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Raz√£o Social *"}),e.jsx("input",{type:"text",value:se.razao_social,onChange:V=>_e({...se,razao_social:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Raz√£o social da empresa"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Fantasia *"}),e.jsx("input",{type:"text",value:se.nome,onChange:V=>_e({...se,nome:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Nome fantasia da empresa",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CNPJ *"}),e.jsx("input",{type:"text",value:se.cnpj,onChange:V=>{_e({...se,cnpj:V.target.value}),E(!1),A(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"00.000.000/0000-00",maxLength:"18"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Inscri√ß√£o Estadual"}),e.jsx("input",{type:"text",value:se.inscricao_estadual,onChange:V=>_e({...se,inscricao_estadual:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"IE"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Respons√°vel / Contato"}),e.jsx("input",{type:"text",value:se.responsavel,onChange:V=>_e({...se,responsavel:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Nome do respons√°vel ou contato"})]})]})]}),$===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Contatos"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Celular *"}),e.jsx("input",{type:"text",value:se.celular,onChange:V=>{_e({...se,celular:V.target.value}),E(!1),A(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"(00) 00000-0000"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Este n√∫mero √© WhatsApp?"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:se.celular_whatsapp===!0,onChange:()=>_e({...se,celular_whatsapp:!0}),className:"text-blue-600"}),e.jsx("span",{className:"text-sm",children:"Sim"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:se.celular_whatsapp===!1,onChange:()=>_e({...se,celular_whatsapp:!1}),className:"text-blue-600"}),e.jsx("span",{className:"text-sm",children:"N√£o"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone fixo"}),e.jsx("input",{type:"text",value:se.telefone,onChange:V=>{_e({...se,telefone:V.target.value}),E(!1),A(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"(00) 0000-0000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-mail"}),e.jsx("input",{type:"email",value:se.email,onChange:V=>_e({...se,email:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"email@exemplo.com"})]})]}),$===3&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Endere√ßo"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:se.cep,onChange:V=>{const Fe=V.target.value;_e({...se,cep:Fe}),Fe.replace(/\D/g,"").length===8&&pa(Fe)},className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"00000-000",maxLength:"9"}),e.jsx("button",{type:"button",onClick:()=>pa(se.cep),disabled:_,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50",children:_?"Buscando...":"Buscar"})]}),te&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:te}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Digite o CEP para preencher o endere√ßo automaticamente"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Endere√ßo"}),e.jsx("input",{type:"text",value:se.endereco,onChange:V=>_e({...se,endereco:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Rua, Avenida..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N√∫mero"}),e.jsx("input",{type:"text",value:se.numero,onChange:V=>_e({...se,numero:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"123"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complemento"}),e.jsx("input",{type:"text",value:se.complemento,onChange:V=>_e({...se,complemento:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Apto, Bloco..."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bairro"}),e.jsx("input",{type:"text",value:se.bairro,onChange:V=>_e({...se,bairro:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cidade"}),e.jsx("input",{type:"text",value:se.cidade,onChange:V=>_e({...se,cidade:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsx("input",{type:"text",value:se.estado,onChange:V=>_e({...se,estado:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",maxLength:"2",placeholder:"SP"})]})]})]}),$===4&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informa√ß√µes complementares"}),e.jsxs("div",{className:"border-b pb-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800",children:"Endere√ßos Adicionais"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Cadastre m√∫ltiplos endere√ßos para entrega, cobran√ßa, etc."})]}),e.jsxs("button",{type:"button",onClick:()=>la(),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Adicionar Endere√ßo"]})]}),ke.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-4",children:ke.map((V,Fe)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 bg-gray-50 hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${V.tipo==="entrega"?"bg-blue-100 text-blue-800":V.tipo==="cobranca"?"bg-green-100 text-green-800":V.tipo==="comercial"?"bg-purple-100 text-purple-800":V.tipo==="residencial"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:V.tipo==="entrega"?"üì¶ Entrega":V.tipo==="cobranca"?"üí∞ Cobran√ßa":V.tipo==="comercial"?"üè¢ Comercial":V.tipo==="residencial"?"üè† Residencial":"üìç Trabalho"}),e.jsxs("span",{className:"text-xs font-medium text-gray-500",children:["+",Fe+1]})]}),V.apelido&&e.jsx("p",{className:"text-sm font-semibold text-gray-900 mb-1",children:V.apelido}),e.jsxs("p",{className:"text-sm text-gray-700",children:[V.endereco,", ",V.numero,V.complemento&&` - ${V.complemento}`]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[V.bairro,", ",V.cidade,"/",V.estado]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["CEP: ",V.cep]})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx("button",{type:"button",onClick:()=>la(Fe),className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Editar",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{type:"button",onClick:()=>Be(Fe),className:"p-1.5 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Excluir",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},Fe))}):e.jsxs("div",{className:"text-center py-8 text-gray-500 text-sm",children:[e.jsxs("svg",{className:"w-12 h-12 mx-auto mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Nenhum endere√ßo adicional cadastrado"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Marca√ß√µes / Tags"}),e.jsx("input",{type:"text",value:se.tags,onChange:V=>_e({...se,tags:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Ex: Bom pagador, Cliente fiel, VIP"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Separe por v√≠rgula para m√∫ltiplas tags"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observa√ß√µes"}),e.jsx("textarea",{value:se.observacoes,onChange:V=>_e({...se,observacoes:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",rows:"4",placeholder:"Informa√ß√µes adicionais sobre o cliente..."})]})]}),$===5&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Fa,{className:"text-blue-600",size:24}),"Pets do Cliente"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Use o m√≥dulo dedicado para gerenciar pets com informa√ß√µes completas"})]})}),e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-lg p-5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Fa,{className:"text-blue-600 flex-shrink-0 mt-1",size:24}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"üéØ Gest√£o Profissional de Pets"}),e.jsxs("p",{className:"text-sm text-blue-800 mb-3",children:["Agora os pets possuem um ",e.jsx("strong",{children:"m√≥dulo dedicado"})," com funcionalidades completas: hist√≥rico m√©dico, vacinas, consultas, servi√ßos e muito mais."]}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 mb-4",children:[e.jsx("li",{children:"‚úÖ Cadastro completo com campos veterin√°rios"}),e.jsx("li",{children:"‚úÖ Hist√≥rico de sa√∫de e medica√ß√µes"}),e.jsx("li",{children:"‚úÖ Controle de vacinas e consultas"}),e.jsx("li",{children:"‚úÖ Timeline de eventos"}),e.jsx("li",{children:"‚úÖ Preparado para uso cl√≠nico real"})]})]})]})}),re.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3",children:["Pets cadastrados (",re.length,")"]}),e.jsx("div",{className:"space-y-2",children:re.map(V=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fa,{className:"text-blue-600",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:V.nome}),e.jsxs("p",{className:"text-sm text-gray-600",children:[V.especie," ",V.raca&&`‚Ä¢ ${V.raca}`]})]})]}),V.id&&e.jsx("button",{onClick:()=>s(`/pets/${V.id}`),className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm font-medium transition-colors",children:"Ver Detalhes"})]},V.id||V.nome))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>{c!=null&&c.id?s(`/pets?cliente_id=${c.id}`):alert("‚ö†Ô∏è Salve o cliente primeiro para gerenciar pets")},className:"flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg transition-all font-semibold shadow-md",children:[e.jsx(Fa,{size:24}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{children:"üêæ Gerenciar Pets"}),e.jsx("div",{className:"text-xs font-normal opacity-90",children:"M√≥dulo completo de gest√£o"})]})]}),e.jsxs("button",{type:"button",onClick:()=>{c!=null&&c.id?s("/pets/novo",{state:{clienteId:c.id}}):alert("‚ö†Ô∏è Salve o cliente primeiro para adicionar pets")},className:"flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-lg transition-all font-semibold shadow-md",children:[e.jsx(Qa,{size:24}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{children:"‚ûï Adicionar Pet"}),e.jsx("div",{className:"text-xs font-normal opacity-90",children:"Cadastro completo"})]})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:["üí° ",e.jsx("strong",{children:"Dica:"})," Pets podem ser adicionados agora ou depois. Todas as informa√ß√µes m√©dicas e hist√≥rico ficam no m√≥dulo dedicado de pets."]})}),!c&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-orange-800",children:["‚ö†Ô∏è ",e.jsx("strong",{children:"Aten√ß√£o:"})," Salve o cliente primeiro (etapa 6) para poder gerenciar seus pets."]})})]}),$===6&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ga,{className:"text-green-600"}),"Informa√ß√µes Financeiras"]}),e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800 mb-1",children:"üí∞ Saldo de Cr√©dito"}),e.jsxs("p",{className:"text-3xl font-bold text-green-600",children:["R$ ",c!=null&&c.credito?parseFloat(c.credito).toFixed(2).replace(".",","):"0,00"]}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"Dispon√≠vel para uso em compras"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50",disabled:!c,onClick:async()=>{var We,ua;if(!c){alert("Salve o cliente primeiro antes de adicionar cr√©dito");return}const V=prompt("Digite o valor a adicionar ao cr√©dito:");if(!V||isNaN(parseFloat(V)))return;const Fe=parseFloat(V);if(Fe<=0){alert("Valor deve ser maior que zero");return}const Te=prompt("Motivo da adi√ß√£o de cr√©dito:","Ajuste manual");if(Te)try{const xe=await F.post(`/clientes/${c.id}/credito/adicionar`,{valor:Fe,motivo:Te});alert(`‚úÖ ${xe.data.message}

Cr√©dito anterior: R$ ${xe.data.credito_anterior.toFixed(2)}
Valor adicionado: R$ ${xe.data.valor_adicionado.toFixed(2)}
Novo saldo: R$ ${xe.data.credito_atual.toFixed(2)}`),m({...c,credito:xe.data.credito_atual}),ra()}catch(xe){console.error("Erro ao adicionar cr√©dito:",xe),alert("‚ùå Erro ao adicionar cr√©dito: "+(((ua=(We=xe.response)==null?void 0:We.data)==null?void 0:ua.detail)||xe.message))}},children:[e.jsx(Us,{})," Adicionar Cr√©dito"]}),e.jsxs("button",{type:"button",className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50",disabled:!c,onClick:async()=>{var ua,xe;if(!c){alert("Salve o cliente primeiro antes de remover cr√©dito");return}const V=parseFloat(c.credito||0);if(V<=0){alert("Cliente n√£o possui cr√©dito para remover");return}const Fe=prompt(`Digite o valor a remover (m√°x: R$ ${V.toFixed(2)}):`);if(!Fe||isNaN(parseFloat(Fe)))return;const Te=parseFloat(Fe);if(Te<=0){alert("Valor deve ser maior que zero");return}if(Te>V){alert(`Valor excede o cr√©dito dispon√≠vel (R$ ${V.toFixed(2)})`);return}const We=prompt("Motivo da remo√ß√£o de cr√©dito:","Ajuste manual");if(We)try{const Ae=await F.post(`/clientes/${c.id}/credito/remover`,{valor:Te,motivo:We});alert(`‚úÖ ${Ae.data.message}

Cr√©dito anterior: R$ ${Ae.data.credito_anterior.toFixed(2)}
Valor removido: R$ ${Ae.data.valor_removido.toFixed(2)}
Novo saldo: R$ ${Ae.data.credito_atual.toFixed(2)}`),m({...c,credito:Ae.data.credito_atual}),ra()}catch(Ae){console.error("Erro ao remover cr√©dito:",Ae),alert("‚ùå Erro ao remover cr√©dito: "+(((xe=(ua=Ae.response)==null?void 0:ua.data)==null?void 0:xe.detail)||Ae.message))}},children:[e.jsx(cr,{})," Remover Cr√©dito"]})]})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("h4",{className:"text-md font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(er,{}),"Resumo Financeiro (√öltimos 90 dias)"]}),c?e.jsx("div",{className:"space-y-4",children:me?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600 text-sm",children:"Carregando resumo..."})]}):e.jsxs(e.Fragment,{children:[Q?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"üí∞ Total Comprado"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["R$ ",((ea=Q.total_vendas)==null?void 0:ea.toFixed(2).replace(".",","))||"0,00"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[Q.quantidade_vendas||0," vendas"]})]}),e.jsxs("div",{className:`rounded-lg p-4 border ${Q.tem_debitos_vencidos?"bg-red-50 border-red-300":Q.tem_debitos?"bg-orange-50 border-orange-200":"bg-green-50 border-green-200"}`,children:[e.jsxs("p",{className:"text-xs text-gray-600 mb-1",children:[Q.tem_debitos_vencidos?"‚ö†Ô∏è":"üìã"," Em Aberto"]}),e.jsxs("p",{className:`text-2xl font-bold ${Q.tem_debitos_vencidos?"text-red-600":Q.tem_debitos?"text-orange-600":"text-green-600"}`,children:["R$ ",((na=Q.total_em_aberto)==null?void 0:na.toFixed(2).replace(".",","))||"0,00"]}),Q.tem_debitos_vencidos&&e.jsxs("p",{className:"text-xs text-red-600 font-semibold mt-1",children:["R$ ",((ia=Q.total_vencido)==null?void 0:ia.toFixed(2).replace(".",","))||"0,00"," vencido"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 border border-purple-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"üìä Ticket M√©dio"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["R$ ",((Ue=Q.ticket_medio)==null?void 0:Ue.toFixed(2).replace(".",","))||"0,00"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"por compra"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"üïê √öltima Compra"}),Q.ultima_compra?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-2xl font-bold text-gray-700",children:["R$ ",((Ca=Q.ultima_compra.valor)==null?void 0:Ca.toFixed(2).replace(".",","))||"0,00"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[new Date(Q.ultima_compra.data).toLocaleDateString("pt-BR")," ","(h√° ",Q.ultima_compra.dias_atras," dias)"]})]}):e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Nenhuma compra"})]})]})}):e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx("p",{className:"mb-2",children:"üìã Nenhuma informa√ß√£o financeira"}),e.jsx("p",{className:"text-sm",children:"Dados aparecer√£o ap√≥s a primeira venda"})]}),e.jsxs("button",{type:"button",onClick:()=>s(`/clientes/${c.id}/financeiro`),className:"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-lg transition-all flex items-center justify-center gap-2 font-semibold shadow-md",children:[e.jsx(er,{}),"üìä Ver Hist√≥rico Financeiro Completo",Q&&e.jsxs("span",{className:"text-xs bg-white bg-opacity-20 px-2 py-1 rounded",children:[Q.total_transacoes_historico||0," transa√ß√µes"]})]})]})}):e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:e.jsx("p",{className:"text-blue-800 text-sm",children:"‚ÑπÔ∏è Salve o cliente primeiro para visualizar o resumo financeiro"})})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:["üí° ",e.jsx("strong",{children:"Dica:"})," O cr√©dito pode ser gerado automaticamente nas devolu√ß√µes de produtos e utilizado como forma de pagamento no PDV."]})}),c&&e.jsx(kl,{clienteId:c.id}),c&&e.jsx(Fl,{clienteId:c.id,cliente:c,metricas:Q}),c&&c.celular&&e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"text-green-600",size:24}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"üí¨ WhatsApp"})]}),e.jsxs("button",{type:"button",onClick:()=>{const V=c.celular.replace(/\D/g,"");window.open(`https://wa.me/55${V}`,"_blank")},className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm font-medium",children:[e.jsx(Ns,{}),"Abrir conversa"]})]}),e.jsx(He,{clienteId:c.id})]}),c&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm",children:e.jsx(zr,{clienteId:c.tipo_cadastro==="cliente"?c.id:null,fornecedorId:c.tipo_cadastro==="fornecedor"?c.id:null,tipo:c.tipo_cadastro==="fornecedor"?"fornecedor":"cliente",limit:5,showHeader:!0,onVerMais:()=>s(`/clientes/${c.id}/timeline`)})})]})]}),e.jsxs("div",{className:"border-t border-gray-200 p-4 bg-gray-50 flex justify-between",children:[e.jsxs("button",{onClick:$e,disabled:$===1,className:"flex items-center gap-2 px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(nt,{})," Voltar"]}),$<6?e.jsxs("button",{onClick:U,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:["Avan√ßar ",e.jsx(Zt,{})]}):e.jsxs("button",{onClick:Ie,className:"flex items-center gap-2 px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[e.jsx(Vs,{})," Salvar Cliente"]})]})]})}),be&&ze&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between z-10",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:ze.index!==void 0?"Editar Endere√ßo":"Adicionar Novo Endere√ßo"}),e.jsx("button",{onClick:oe,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Endere√ßo *"}),e.jsxs("select",{value:ze.tipo,onChange:V=>Qe({...ze,tipo:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"entrega",children:"üì¶ Entrega"}),e.jsx("option",{value:"cobranca",children:"üí∞ Cobran√ßa"}),e.jsx("option",{value:"comercial",children:"üè¢ Comercial"}),e.jsx("option",{value:"residencial",children:"üè† Residencial"}),e.jsx("option",{value:"trabalho",children:"üìç Trabalho"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apelido (opcional)"}),e.jsx("input",{type:"text",value:ze.apelido,onChange:V=>Qe({...ze,apelido:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Ex: Casa da m√£e, Escrit√≥rio, Loja"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:ze.cep,onChange:V=>{const Fe=V.target.value.replace(/\D/g,""),Te=Fe.length>5?`${Fe.slice(0,5)}-${Fe.slice(5,8)}`:Fe;Qe({...ze,cep:Te})},onBlur:V=>ye(V.target.value),maxLength:"9",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"00000-000"}),_&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Endere√ßo *"}),e.jsx("input",{type:"text",value:ze.endereco,onChange:V=>Qe({...ze,endereco:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Rua, Avenida, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N√∫mero"}),e.jsx("input",{type:"text",value:ze.numero,onChange:V=>Qe({...ze,numero:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"123"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complemento"}),e.jsx("input",{type:"text",value:ze.complemento,onChange:V=>Qe({...ze,complemento:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Apto, Bloco, Sala..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bairro"}),e.jsx("input",{type:"text",value:ze.bairro,onChange:V=>Qe({...ze,bairro:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Centro, Jardim..."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cidade *"}),e.jsx("input",{type:"text",value:ze.cidade,onChange:V=>Qe({...ze,cidade:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"S√£o Paulo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsx("input",{type:"text",value:ze.estado,onChange:V=>Qe({...ze,estado:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",maxLength:"2",placeholder:"SP"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"* Campos obrigat√≥rios"})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:oe,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:Ce,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Salvar Endere√ßo"})]})]})}),e.jsx(Nl,{isOpen:f,onClose:()=>{y(!1),fetchClientes()}}),e.jsx("style",{children:`
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: scale(0.95);
          }
          to {
            opacity: 1;
            transform: scale(1);
          }
        }
        
        .animate-fade-in {
          animation: fadeIn 0.3s ease-out;
        }
      `})]})},dn=(s={})=>F.get("/produtos/categorias",{params:s}),cn=(s={})=>F.get("/produtos/marcas",{params:s}),Pl=(s={})=>F.get("/produtos/departamentos",{params:s}),xn=(s={})=>F.get("/produtos/",{params:s}),mn=(s={})=>F.get("/produtos/vendaveis",{params:s}),yo=s=>F.get(`/produtos/${s}`),ur=s=>F.get(`/produtos/${s}/variacoes`),No=s=>F.post("/produtos/",s),Rl=(s,n)=>F.put(`/produtos/${s}`,n),Er=s=>F.delete(`/produtos/${s}`),Al=(s="")=>F.post("/produtos/gerar-sku",{prefixo:s}),Dl=s=>F.post("/produtos/gerar-codigo-barras",{sku:s}),Ht=s=>F.get(`/produtos/${s}/lotes`),Ml=(s,n)=>F.post(`/produtos/${s}/entrada`,n),Ll=(s,n,t)=>F.put(`/produtos/${s}/lotes/${n}`,t),ql=(s,n)=>F.delete(`/produtos/${s}/lotes/${n}`),zl=(s,n)=>F.post(`/produtos/${s}/imagens`,n,{headers:{"Content-Type":"multipart/form-data"}}),Il=s=>F.delete(`/produtos/imagens/${s}`),pr=s=>F.get(`/produtos/${s}/fornecedores`),Tl=(s,n)=>F.post(`/produtos/${s}/fornecedores`,n),Vl=(s,n)=>F.put(`/produtos/fornecedores/${s}`,n),Ol=s=>F.delete(`/produtos/fornecedores/${s}`),Bl=(s={})=>F.get("/produtos/relatorio/movimentacoes",{params:s}),Ul=(s,n)=>s*(1+n/100),_o=(s,n)=>!s||s===0?0:(n-s)/s*100,Ds=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s||0),Fr=s=>s?new Date(s).toLocaleDateString("pt-BR"):"-";function Wl({isOpen:s,onClose:n,onSuccess:t}){const[d,o]=a.useState(null),[g,r]=a.useState(!1),[v,j]=a.useState(null),[f,y]=a.useState("upload"),c=b=>{const u=b.target.files[0];u&&(u.name.endsWith(".xlsx")||u.name.endsWith(".xls")?(o(u),j(null)):(Se.error("Arquivo deve ser Excel (.xlsx ou .xls)"),b.target.value=""))},m=async()=>{try{const b=localStorage.getItem("token"),u=await F.get("/produtos/template-importacao",{headers:{Authorization:`Bearer ${b}`},responseType:"blob"}),i=window.URL.createObjectURL(new Blob([u.data])),p=document.createElement("a");p.href=i,p.setAttribute("download",`template_produtos_${new Date().toISOString().split("T")[0]}.xlsx`),document.body.appendChild(p),p.click(),p.remove(),window.URL.revokeObjectURL(i),Se.success("Template baixado com sucesso!")}catch(b){console.error("Erro ao baixar template:",b),Se.error("Erro ao baixar template")}},k=async()=>{var b,u;if(!d){Se.error("Selecione um arquivo para importar");return}r(!0),y("processando");try{const i=new FormData;i.append("file",d);const p=await F.post("/produtos/importar",i);j(p.data),y("resultado"),p.data.total_sucesso>0&&(Se.success(`${p.data.total_sucesso} produtos processados com sucesso!`),t&&t()),p.data.total_erros>0&&Se.error(`${p.data.total_erros} produtos com erro`)}catch(i){console.error("Erro ao importar:",i),Se.error(((u=(b=i.response)==null?void 0:b.data)==null?void 0:u.detail)||"Erro ao importar produtos"),y("upload")}finally{r(!1)}},w=()=>{o(null),j(null),y("upload")},x=()=>{w(),n()};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gradient-to-r from-blue-600 to-blue-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Importa√ß√£o de Produtos em Lote"})]}),e.jsx("button",{onClick:x,className:"text-white hover:text-gray-200 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[f==="upload"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Como funciona"]}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 ml-7",children:[e.jsx("li",{children:"1. Baixe o template Excel clicando no bot√£o abaixo"}),e.jsx("li",{children:"2. Preencha os dados dos produtos na planilha"}),e.jsx("li",{children:"3. Salve o arquivo e fa√ßa o upload aqui"}),e.jsx("li",{children:"4. Produtos novos ser√£o criados, existentes ser√£o atualizados (baseado no SKU)"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:m,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Baixar Template Excel"]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecione a Planilha Preenchida"}),e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx("svg",{className:"w-12 h-12 mb-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:"Clique para selecionar"})," ou arraste o arquivo"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Apenas arquivos Excel (.xlsx, .xls)"}),d&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-blue-600",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"font-medium",children:d.name})]})]}),e.jsx("input",{type:"file",className:"hidden",accept:".xlsx,.xls",onChange:c})]})})]})]}),f==="processando"&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mb-4"}),e.jsx("p",{className:"text-lg text-gray-700",children:"Processando planilha..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Isso pode levar alguns segundos"})]}),f==="resultado"&&v&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:v.total_processado}),e.jsx("div",{className:"text-sm text-blue-800 mt-1",children:"Total Processado"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:v.total_criados}),e.jsx("div",{className:"text-sm text-green-800 mt-1",children:"Criados"})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:v.total_atualizados}),e.jsx("div",{className:"text-sm text-yellow-800 mt-1",children:"Atualizados"})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:v.total_erros}),e.jsx("div",{className:"text-sm text-red-800 mt-1",children:"Erros"})]})]}),v.detalhes.criados.length>0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-green-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Produtos Criados (",v.detalhes.criados.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-1",children:v.detalhes.criados.map((b,u)=>e.jsxs("li",{className:"text-green-800",children:["Linha ",b.linha,": ",e.jsx("span",{className:"font-medium",children:b.sku})," - ",b.nome]},u))})})]}),v.detalhes.atualizados.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-yellow-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Produtos Atualizados (",v.detalhes.atualizados.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-1",children:v.detalhes.atualizados.map((b,u)=>e.jsxs("li",{className:"text-yellow-800",children:["Linha ",b.linha,": ",e.jsx("span",{className:"font-medium",children:b.sku})," - ",b.nome]},u))})})]}),v.detalhes.erros.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-red-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Erros (",v.detalhes.erros.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-2",children:v.detalhes.erros.map((b,u)=>e.jsxs("li",{className:"text-red-800",children:[e.jsxs("strong",{children:["Linha ",b.linha]})," (",b.sku,"): ",b.erro]},u))})})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3 bg-gray-50",children:[f==="upload"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:x,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:k,disabled:!d||g,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Importando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Importar Produtos"]})})]}),f==="resultado"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:w,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Importar Novamente"}),e.jsx("button",{onClick:x,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Concluir"})]})]})]})}):null}const bt=[{key:"checkbox",label:"",visible:!0,renderHeader:s=>e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:s.produtos.length>0&&s.selecionados.length===s.produtos.length,onChange:s.handleSelecionarTodos,className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"})}),renderCell:(s,n)=>e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:n.selecionados.includes(s.id),onChange:t=>n.handleSelecionar(s.id,t.nativeEvent),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 cursor-pointer"})})},{key:"imagem",label:"Imagem",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Imagem"}),renderCell:(s,n)=>{const t=s.tipo_produto==="VARIACAO";return e.jsx("td",{className:`px-4 py-3 ${t?"pl-12":""}`,children:e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden border border-gray-200 flex-shrink-0",children:s.imagem_principal?e.jsx("img",{src:s.imagem_principal.startsWith("http")?s.imagem_principal:`${window.location.origin}${s.imagem_principal}`,alt:s.nome,className:"w-full h-full object-cover object-center",onError:d=>{console.error("Erro ao carregar imagem:",s.imagem_principal),d.target.style.display="none",d.target.parentElement.innerHTML='<svg class="w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>'}}):e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})})}},{key:"descricao",label:"Descri√ß√£o",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descri√ß√£o"}),renderCell:(s,n)=>{const t=s.tipo_produto==="VARIACAO",d=s.tipo_produto==="PAI",o=s.tipo_produto==="KIT",g=(n.kitsExpandidos||[]).includes(s.id),r=(n.paisExpandidos||[]).includes(s.id);return e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`flex-1 ${t?"pl-6":""}`,children:[e.jsxs("div",{className:"flex items-center",children:[t&&e.jsx("svg",{className:"w-4 h-4 text-blue-400 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),d&&e.jsx("button",{onClick:v=>{v.preventDefault(),v.stopPropagation(),n.togglePaiExpandido(s.id)},className:"flex items-center text-blue-600 hover:text-blue-700 transition-colors mr-1",title:r?"Ocultar varia√ß√µes":"Ver varia√ß√µes",children:e.jsx("svg",{className:`w-4 h-4 transition-transform ${r?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),o&&e.jsx("button",{onClick:v=>{v.preventDefault(),v.stopPropagation(),n.toggleKitExpandido(s.id)},className:`flex items-center transition-colors mr-1 ${s.tipo_kit==="VIRTUAL"?"text-indigo-600 hover:text-indigo-700":"text-green-600 hover:text-green-700"}`,title:g?"Ocultar composi√ß√£o":"Ver composi√ß√£o",children:e.jsx("svg",{className:`w-4 h-4 transition-transform ${g?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[s.nome,d&&e.jsxs("span",{className:"ml-2 text-xs text-blue-600",children:["(Pai ",s.total_variacoes||0,")"]}),o&&s.tipo_kit==="VIRTUAL"&&e.jsx("span",{className:"ml-2 text-xs text-indigo-600",children:"(Kit ‚Ä¢ Virtual)"}),o&&s.tipo_kit==="FISICO"&&e.jsx("span",{className:"ml-2 text-xs text-green-600",children:"(Kit ‚Ä¢ F√≠sico)"}),s.data_descontinuacao&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800",children:"‚ö†Ô∏è Descontinuado"})]})]}),s.descricao&&e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-xs mt-1",children:s.descricao})]}),e.jsx("button",{onClick:v=>{v.stopPropagation(),n.copiarTexto(s.nome,"Nome")},className:"text-gray-400 hover:text-gray-600",title:"Copiar nome",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})})}},{key:"codigo",label:"C√≥digo",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"C√≥digo"}),renderCell:(s,n)=>e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900 font-mono",children:s.codigo||s.sku}),s.codigo_barras&&e.jsx("div",{className:"text-xs text-gray-500 font-mono",children:s.codigo_barras})]}),e.jsx("button",{onClick:t=>{t.stopPropagation(),n.copiarTexto(s.codigo||s.sku,"SKU")},className:"text-gray-400 hover:text-gray-600",title:"Copiar SKU",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})})},{key:"unidade",label:"Unidade",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unidade"}),renderCell:s=>e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-sm text-gray-700",children:s.unidade||"UN"})})},{key:"custo",label:"Custo",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Custo"}),renderCell:(s,n)=>e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:"text-sm text-gray-900",children:Ds(s.preco_custo)})})},{key:"preco_venda",label:"PV",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PV"}),renderCell:(s,n)=>e.jsx("td",{className:"px-4 py-3 text-right",children:n.editandoPreco===s.id?e.jsxs("div",{className:"flex items-center gap-1 justify-end",onClick:t=>t.stopPropagation(),children:[e.jsx("input",{type:"number",step:"0.01",value:n.novoPreco,onChange:t=>n.setNovoPreco(t.target.value),className:"w-24 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",autoFocus:!0}),e.jsx("button",{onClick:()=>n.handleSalvarPreco(s.id),className:"text-green-600 hover:text-green-800",title:"Salvar",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("button",{onClick:n.handleCancelarEdicaoPreco,className:"text-red-600 hover:text-red-800",title:"Cancelar",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("span",{className:"text-sm font-semibold text-green-600",children:Ds(s.preco_venda)}),e.jsx("button",{onClick:t=>{t.stopPropagation(),n.handleEditarPreco(s.id,s.preco_venda)},className:"text-blue-600 hover:text-blue-800",title:"Editar pre√ßo",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})})},{key:"validade",label:"Validade",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Validade"}),renderCell:(s,n)=>e.jsx("td",{className:"px-4 py-3 text-center text-sm",children:n.getValidadeMaisProxima(s)})},{key:"estoque",label:"Estoque",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque"}),renderCell:(s,n)=>{const t=s.tipo_produto==="KIT"&&s.tipo_kit==="VIRTUAL",d=t?s.estoque_virtual??0:s.estoque_atual||0;return e.jsx("td",{className:"px-4 py-3 text-center",children:s.controlar_estoque?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:`text-sm ${n.getCorEstoque(s)}`,children:d}),t&&e.jsx("span",{className:"text-xs text-gray-400 mt-0.5",children:"estoque virtual"})]}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})})}},{key:"acoes",label:"A√ß√µes",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A√ß√µes"}),renderCell:(s,n)=>e.jsx("td",{className:"px-4 py-3 text-center",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),console.log("Produto:",s.nome,"Controla estoque:",s.controlar_estoque,"Estoque atual:",s.estoque_atual),n.navigate(`/produtos/${s.id}/movimentacoes`)},className:`rounded hover:opacity-80 transition-opacity ${s.controlar_estoque===!0&&(s.estoque_atual||0)>0?"text-green-600 hover:text-green-800":s.controlar_estoque===!0&&(s.estoque_atual||0)===0?"text-red-600 hover:text-red-800":"text-gray-400 hover:text-gray-600"}`,title:"Ver movimenta√ß√µes de estoque",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),n.navigate(`/produtos/${s.id}/editar`)},className:"text-blue-600 hover:text-blue-800 transition-colors",title:"Editar",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),n.handleExcluir(s.id)},className:"text-red-600 hover:text-red-800 transition-colors",title:"Excluir",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})}];function Kl(){const s=fa(),[n,t]=a.useState([]),[d,o]=a.useState([]),[g,r]=a.useState([]),[v,j]=a.useState(!0),[f,y]=a.useState([]),[c,m]=a.useState(null),[k,w]=a.useState(null),[x,b]=a.useState(""),[u,i]=a.useState([]),[p,l]=a.useState([]),[C,h]=a.useState(()=>{const Y=localStorage.getItem("produtos_colunas_visiveis");return Y?JSON.parse(Y):null}),[_,S]=a.useState(!1),[$,K]=a.useState([]),[re,M]=a.useState(!1),[R,J]=a.useState({marca_id:"",categoria_id:"",departamento_id:""}),[te,L]=a.useState([]),[Z,A]=a.useState(!1),[G,E]=a.useState({busca:"",categoria_id:"",marca_id:"",estoque_baixo:!1,em_promocao:!1}),[P,H]=a.useState(1),[B,N]=a.useState(20),O=a.useMemo(()=>{if(!n||n.length===0)return[];const Y=[],je=n.filter(X=>X.tipo_produto==="PAI"),Me=n.filter(X=>X.tipo_produto==="VARIACAO"),T=n.filter(X=>X.tipo_produto!=="PAI"&&X.tipo_produto!=="VARIACAO");return Y.push(...T),je.forEach(X=>{if(Y.push(X),p.includes(X.id)){const fe=Me.filter(U=>U.produto_pai_id===X.id);Y.push(...fe)}}),Y},[n,p]),z=a.useMemo(()=>{let Y=[...O];if(G.busca.trim()){const je=G.busca.toLowerCase();Y=Y.filter(Me=>Me.nome&&Me.nome.toLowerCase().includes(je)||Me.codigo&&Me.codigo.toLowerCase().includes(je))}return G.categoria_id&&(Y=Y.filter(je=>je.categoria_id==G.categoria_id)),G.marca_id&&(Y=Y.filter(je=>je.marca_id==G.marca_id)),G.estoque_baixo&&(Y=Y.filter(je=>{const Me=je.tipo_produto==="KIT"&&je.tipo_kit==="VIRTUAL"?je.estoque_virtual??0:je.estoque_atual||0,T=je.estoque_minimo||0;return je.controlar_estoque&&Me<=T})),G.em_promocao&&(Y=Y.filter(je=>je.promocao_ativa===!0)),Y},[O,G]),{produtosPaginados:ae,totalPaginas:W,totalItens:ie}=a.useMemo(()=>{const Y=Math.ceil(z.length/B),je=(P-1)*B,Me=je+B;return{produtosPaginados:z.slice(je,Me),totalPaginas:Y,totalItens:z.length}},[z,P,B]),ee=ae;a.useEffect(()=>{H(1)},[G]),a.useEffect(()=>{Q(),de(),me(),Pe()},[]);const Q=async()=>{try{j(!0);const Y={};Object.keys(G).forEach(T=>{const X=G[T];X!==""&&X!==null&&X!==void 0&&(Y[T]=X)});const je=await xn(Y);let Me;if(Array.isArray(je.data))Me=je.data;else if(je.data.itens)Me=je.data.itens;else if(je.data.produtos)Me=je.data.produtos;else if(je.data.data)Me=je.data.data;else{const T=Object.keys(je.data).filter(X=>Array.isArray(je.data[X]));T.length>0?Me=je.data[T[0]]:Me=[]}t(Me)}catch(Y){console.error("Erro ao carregar produtos:",Y),alert("Erro ao carregar produtos")}finally{j(!1)}},de=async()=>{try{const Y=await dn();o(Y.data)}catch(Y){console.error("Erro ao carregar categorias:",Y)}},me=async()=>{try{const Y=await cn();r(Y.data)}catch(Y){console.error("Erro ao carregar marcas:",Y)}},Pe=async()=>{try{const Y=await F.get("/produtos/departamentos");L(Y.data)}catch(Y){console.error("Erro ao carregar departamentos:",Y)}},se=(Y,je)=>{E(Me=>({...Me,[Y]:je}))},_e=(Y,je)=>{if(!Y){console.error("Erro: ID do produto √© undefined ou null");return}if(je!=null&&je.shiftKey&&c!==null){const Me=ee.findIndex(X=>X.id===c),T=ee.findIndex(X=>X.id===Y);if(Me!==-1&&T!==-1){const X=Math.min(Me,T),fe=Math.max(Me,T),U=ee.slice(X,fe+1).map(le=>le.id);y(le=>{const Ne=new Set(le);return U.forEach(Re=>Ne.add(Re)),Array.from(Ne)}),m(Y);return}}y(Me=>Me.includes(Y)?Me.filter(T=>T!==Y):[...Me,Y]),m(Y)},ke=()=>{f.length===ee.length?y([]):y(ee.map(Y=>Y.id))},Ye=async Y=>{if(confirm("Deseja realmente excluir este produto?"))try{await Er(Y),alert("Produto exclu√≠do com sucesso!"),Q()}catch(je){console.error("Erro ao excluir produto:",je),alert("Erro ao excluir produto")}},ze=async()=>{if(confirm(`Deseja realmente excluir ${f.length} produtos?`))try{await Promise.all(f.map(Y=>Er(Y))),alert("Produtos exclu√≠dos com sucesso!"),y([]),Q()}catch(Y){console.error("Erro ao excluir produtos:",Y),alert("Erro ao excluir produtos")}},Qe=(Y,je)=>{navigator.clipboard.writeText(Y),Se.success(`${je} copiado!`)},be=(Y,je)=>{w(Y),b(je.toString())},Ee=async Y=>{try{await F.patch(`/produtos/${Y}?preco_venda=${x}`,{}),Se.success("Pre√ßo atualizado!"),w(null),Q()}catch(je){console.error("Erro ao atualizar pre√ßo:",je),Se.error("Erro ao atualizar pre√ßo")}},he=()=>{w(null)},Xe=()=>{if(f.length===0){Se.error("Selecione pelo menos um produto");return}J({marca_id:"",categoria_id:"",departamento_id:""}),M(!0)},Je=async()=>{try{if(Object.values(R).filter(Me=>Me!=="").length===0){Se.error("Preencha pelo menos um campo para atualizar");return}const je={};R.marca_id&&(je.marca_id=parseInt(R.marca_id)),R.categoria_id&&(je.categoria_id=parseInt(R.categoria_id)),R.departamento_id&&(je.departamento_id=parseInt(R.departamento_id)),await F.patch("/produtos/atualizar-lote",{produto_ids:f,...je}),Se.success(`${f.length} produto(s) atualizado(s) com sucesso!`),M(!1),y([]),Q()}catch(Y){console.error("Erro ao atualizar produtos:",Y),Se.error("Erro ao atualizar produtos")}},ca=Y=>{if(!Y.controlar_estoque)return"text-gray-500";const je=Y.tipo_produto==="KIT"&&Y.tipo_kit==="VIRTUAL"?Y.estoque_virtual??0:Y.estoque_atual||0,Me=Y.estoque_minimo||0;return je<=0?"text-red-600 font-semibold":je<=Me?"text-yellow-600 font-medium":"text-gray-700"},ra=Y=>{if(!Y.lotes||Y.lotes.length===0)return"-";const je=Y.lotes.filter(fe=>fe.data_validade).sort((fe,U)=>new Date(fe.data_validade)-new Date(U.data_validade));if(je.length===0)return"-";const Me=je[0].data_validade,T=Math.floor((new Date(Me)-new Date)/(1e3*60*60*24));let X="text-gray-700";return T<0?X="text-red-600 font-bold":T<=30?X="text-orange-600 font-semibold":T<=90&&(X="text-yellow-600"),e.jsx("span",{className:X,children:Fr(Me)})},pa=Y=>{i(je=>je.includes(Y)?je.filter(Me=>Me!==Y):[...je,Y])},la=Y=>{l(je=>je.includes(Y)?je.filter(Me=>Me!==Y):[...je,Y])},oe=()=>{const Y=C||bt.map(je=>je.key);K(Y),S(!0)},ye=Y=>{K(je=>je.includes(Y)?je.filter(Me=>Me!==Y):[...je,Y])},Ce=()=>{localStorage.setItem("produtos_colunas_visiveis",JSON.stringify($)),h($),S(!1),Se.success("Prefer√™ncias de colunas salvas!")},Be=()=>{localStorage.removeItem("produtos_colunas_visiveis"),h(null),K(bt.map(Y=>Y.key)),Se.success("Colunas restauradas para o padr√£o!")},Ie=Y=>C?C.includes(Y.key):!0;return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Produtos"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie seu estoque de produtos"})]}),e.jsxs("div",{className:"flex gap-2",children:[f.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Xe,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:["‚úèÔ∏è Editar em Lote (",f.length,")"]}),e.jsxs("button",{onClick:ze,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:["Excluir Selecionados (",f.length,")"]})]}),e.jsxs("button",{onClick:()=>A(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Importar Excel"]}),e.jsxs("button",{onClick:oe,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium flex items-center gap-2",title:"Configurar colunas vis√≠veis",children:[e.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Colunas"]}),e.jsx("button",{onClick:()=>s("/produtos/novo"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"+ Novo Produto"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx("input",{type:"text",placeholder:"Buscar por c√≥digo, nome ou c√≥digo de barras...",value:G.busca,onChange:Y=>se("busca",Y.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),e.jsx("div",{children:e.jsxs("select",{value:G.categoria_id,onChange:Y=>se("categoria_id",Y.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas as Categorias"}),d.map(Y=>e.jsxs("option",{value:Y.id,children:[Y.categoria_pai_id?"  ‚îî‚îÄ ":"",Y.nome]},Y.id))]})}),e.jsx("div",{children:e.jsxs("select",{value:G.marca_id,onChange:Y=>se("marca_id",Y.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas as Marcas"}),g.map(Y=>e.jsx("option",{value:Y.id,children:Y.nome},Y.id))]})}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:G.estoque_baixo,onChange:Y=>se("estoque_baixo",Y.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Estoque Baixo"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:G.em_promocao,onChange:Y=>se("em_promocao",Y.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Em Promo√ß√£o"})]})]})]})}),!v&&ie>0&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border border-gray-200 rounded-t-lg flex items-center justify-between mt-6 mb-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",(P-1)*B+1," a ",Math.min(P*B,ie)," de ",ie," produtos"]}),e.jsxs("select",{value:B,onChange:Y=>{N(Number(Y.target.value)),H(1)},className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10 por p√°gina"}),e.jsx("option",{value:20,children:"20 por p√°gina"}),e.jsx("option",{value:30,children:"30 por p√°gina"}),e.jsx("option",{value:50,children:"50 por p√°gina"}),e.jsx("option",{value:100,children:"100 por p√°gina"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>H(1),disabled:P===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Primeira"}),e.jsx("button",{onClick:()=>H(Y=>Math.max(Y-1,1)),disabled:P===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(W,5)},(Y,je)=>{let Me;return W<=5||P<=3?Me=je+1:P>=W-2?Me=W-4+je:Me=P-2+je,e.jsx("button",{onClick:()=>H(Me),className:`px-3 py-1 text-sm font-medium rounded-lg transition-colors ${P===Me?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:Me},Me)})}),e.jsx("button",{onClick:()=>H(Y=>Math.min(Y+1,W)),disabled:P===W,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Pr√≥xima"}),e.jsx("button",{onClick:()=>H(W),disabled:P===W,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"√öltima"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:bt.filter(Ie).map(Y=>e.jsx(ts.Fragment,{children:Y.renderHeader({produtos:ee,selecionados:f,handleSelecionarTodos:ke})},Y.key))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"px-4 py-8 text-center text-gray-500",children:"Carregando produtos..."})}):ee.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"px-4 py-8 text-center text-gray-500",children:"Nenhum produto encontrado"})}):ee.map((Y,je)=>{if(!Y||!Y.id)return console.error(`Produto inv√°lido no √≠ndice ${je}:`,Y),null;const Me=Y.tipo_produto==="KIT",T=u.includes(Y.id);return e.jsxs(ts.Fragment,{children:[e.jsx("tr",{className:`hover:bg-gray-50 transition-colors cursor-pointer ${Y.tipo_produto==="VARIACAO"?"bg-blue-50/30":""} ${Me?"bg-amber-50/30":""}`,onClick:X=>{X.target.closest("button, input, a, svg")||s(`/produtos/${Y.id}/editar`)},children:bt.filter(Ie).map(X=>e.jsx(ts.Fragment,{children:X.renderCell(Y,{selecionados:f,handleSelecionar:_e,kitsExpandidos:u,toggleKitExpandido:pa,paisExpandidos:p,togglePaiExpandido:la,copiarTexto:Qe,editandoPreco:k,novoPreco:x,setNovoPreco:b,handleSalvarPreco:Ee,handleCancelarEdicaoPreco:he,handleEditarPreco:be,getValidadeMaisProxima:ra,getCorEstoque:ca,navigate:s,handleExcluir:Ye})},X.key))}),Me&&T&&Y.composicao_kit&&Y.composicao_kit.length>0&&e.jsx("tr",{className:"bg-amber-50/50 border-l-4 border-amber-400",children:e.jsx("td",{colSpan:"10",className:"px-4 py-3",children:e.jsxs("div",{className:"ml-12",children:[e.jsxs("div",{className:"text-xs font-semibold text-amber-800 mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"COMPOSI√á√ÉO DO KIT:"]}),e.jsx("div",{className:"grid gap-1",children:Y.composicao_kit.map((X,fe)=>e.jsxs("div",{className:"flex items-center gap-3 text-xs bg-white rounded px-3 py-2 border border-amber-200",children:[e.jsxs("span",{className:"font-mono font-semibold text-amber-700 min-w-[40px]",children:[X.quantidade,"x"]}),e.jsx("span",{className:"flex-1 text-gray-700",children:X.produto_nome||X.nome||`Produto #${X.produto_id||X.produto_componente_id}`}),X.produto_estoque!==void 0&&e.jsxs("span",{className:"text-gray-500",children:["Estoque: ",e.jsx("span",{className:X.produto_estoque>0?"text-green-600 font-semibold":"text-red-600 font-semibold",children:X.produto_estoque})]})]},fe))})]})})},`kit-${Y.id}`)]},Y.id)})})]})}),!v&&ie>0&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",(P-1)*B+1," a ",Math.min(P*B,ie)," de ",ie," produtos"]}),e.jsxs("select",{value:B,onChange:Y=>{N(Number(Y.target.value)),H(1)},className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10 por p√°gina"}),e.jsx("option",{value:20,children:"20 por p√°gina"}),e.jsx("option",{value:30,children:"30 por p√°gina"}),e.jsx("option",{value:50,children:"50 por p√°gina"}),e.jsx("option",{value:100,children:"100 por p√°gina"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>H(1),disabled:P===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Primeira"}),e.jsx("button",{onClick:()=>H(Y=>Math.max(Y-1,1)),disabled:P===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(W,5)},(Y,je)=>{let Me;return W<=5||P<=3?Me=je+1:P>=W-2?Me=W-4+je:Me=P-2+je,e.jsx("button",{onClick:()=>H(Me),className:`px-3 py-1 text-sm font-medium rounded-lg transition-colors ${P===Me?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:Me},Me)})}),e.jsx("button",{onClick:()=>H(Y=>Math.min(Y+1,W)),disabled:P===W,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Pr√≥xima"}),e.jsx("button",{onClick:()=>H(W),disabled:P===W,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"√öltima"})]})]}),!v&&f.length>0&&e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200",children:e.jsx("div",{className:"flex justify-between items-center text-sm text-gray-600",children:e.jsxs("span",{children:[f.length," produto",f.length>1?"s":""," selecionado",f.length>1?"s":""]})})})]}),re&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Editar em Lote"}),e.jsx("button",{onClick:()=>M(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Atualizar ",e.jsx("strong",{children:f.length})," produto(s) selecionado(s)"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Marca"}),e.jsxs("select",{value:R.marca_id,onChange:Y=>J({...R,marca_id:Y.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"N√£o alterar"}),g.map(Y=>e.jsx("option",{value:Y.id,children:Y.nome},Y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria"}),e.jsxs("select",{value:R.categoria_id,onChange:Y=>J({...R,categoria_id:Y.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"N√£o alterar"}),d.map(Y=>e.jsxs("option",{value:Y.id,children:[Y.categoria_pai_id?"  ‚îî‚îÄ ":"",Y.nome]},Y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Departamento"}),e.jsxs("select",{value:R.departamento_id,onChange:Y=>J({...R,departamento_id:Y.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"N√£o alterar"}),te.map(Y=>e.jsx("option",{value:Y.id,children:Y.nome},Y.id))]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>M(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:Je,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Salvar Altera√ß√µes"})]})]})}),_&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Configurar Colunas"}),e.jsx("button",{onClick:()=>S(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"px-6 py-4 max-h-96 overflow-y-auto",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Selecione quais colunas deseja visualizar na tabela:"}),e.jsx("div",{className:"space-y-2",children:bt.map(Y=>e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:$.includes(Y.key),onChange:()=>ye(Y.key),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:Y.label||Y.key})]},Y.key))})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-between gap-3",children:[e.jsx("button",{onClick:Be,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Restaurar Padr√£o"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>S(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:Ce,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors",children:"Salvar"})]})]})]})}),e.jsx(Wl,{isOpen:Z,onClose:()=>A(!1),onSuccess:()=>{Q(),A(!1)}})]})}const Hl=({value:s,onChange:n,pesoEmbalagem:t})=>{const[d,o]=a.useState("filhote_peso_adulto"),[g,r]=a.useState([]),[v,j]=a.useState(!1),f=a.useRef(null),[y]=a.useState([{id:"2m",label:"2 meses"},{id:"3m",label:"3 meses"},{id:"4m",label:"4 meses"},{id:"6m",label:"6 meses"},{id:"8m",label:"8 meses"},{id:"10m",label:"10 meses"},{id:"12m",label:"12 meses"},{id:"15m",label:"15 meses"},{id:"18m",label:"18 meses"},{id:"adulto",label:"Adulto"}]);a.useEffect(()=>{if(s&&!v)try{const l=typeof s=="string"?JSON.parse(s):s;if(console.log("üì• Carregando tabela:",l),l.tipo&&o(l.tipo),l.dados){const C=Object.entries(l.dados).map(([h,_])=>({peso:h,consumos:_}));r(C)}j(!0)}catch(l){console.error("Erro ao carregar tabela:",l),j(!0)}},[s,v]);const c=()=>{switch(d){case"filhote_peso_adulto":return"Peso Adulto Esperado";case"adulto":return"Peso Atual";default:return"Peso"}},m=()=>{switch(d){case"filhote_peso_adulto":return"Ex: 5kg, 10kg, 15kg, 20kg";case"adulto":return"Ex: 5kg, 10kg, 15kg, 20kg";default:return""}},k=()=>{const l={peso:"",consumos:{}},C=[...g,l];r(C)},w=l=>{const C=g.filter((h,_)=>_!==l);r(C),i(C)},x=(l,C)=>{const h=[...g];h[l].peso=C,r(h)},b=(l,C,h)=>{const _=[...g];_[l].consumos||(_[l].consumos={});const S=parseFloat(h)||0;_[l].consumos[C]=S,r(_)},u=l=>{if(!t||!l)return"-";const C=t*1e3;return`${Math.floor(C/l)}d`},i=a.useCallback(l=>{if(!v){console.log("‚è∏Ô∏è Aguardando carregamento inicial...");return}const C=l||g,h={};C.forEach($=>{$.peso&&(h[$.peso]=$.consumos)});const _={tipo:d,dados:h},S=JSON.stringify(_);if(f.current===S){console.log("‚è≠Ô∏è Ignorando - j√° est√° salvo");return}console.log("üíæ Salvando tabela:",_),f.current=S,n(S)},[g,d,n,v]),p=()=>{i(),alert("‚úÖ Tabela de consumo salva com sucesso!")};return e.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2 flex items-center gap-2",children:"üìä Tabela de Consumo da Embalagem"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Preencha a tabela com as informa√ß√µes da embalagem. A IA usar√° esses dados para calcular dura√ß√£o e custo-benef√≠cio."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Tabela da Embalagem:"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"filhote_peso_adulto",checked:d==="filhote_peso_adulto",onChange:l=>o(l.target.value),className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"üê∂ Filhote (Peso Adulto Esperado)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"adulto",checked:d==="adulto",onChange:l=>o(l.target.value),className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"üêï Adulto (Peso Atual)"})]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-semibold text-gray-700 w-32",children:c()}),y.map(l=>e.jsxs("th",{className:"border border-gray-300 px-2 py-2 text-center text-xs font-semibold text-gray-700 min-w-[90px]",children:[l.label,e.jsx("div",{className:"text-[10px] text-gray-500 font-normal",children:"g/dia | dias"})]},l.id)),e.jsx("th",{className:"border border-gray-300 px-2 py-2 text-center text-sm font-semibold text-gray-700 w-16",children:"A√ß√µes"})]})}),e.jsx("tbody",{children:g.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:y.length+2,className:"border border-gray-300 px-4 py-8 text-center text-gray-500",children:[e.jsx(_a,{className:"inline-block mr-2"}),'Nenhuma linha adicionada. Clique em "Adicionar Linha" para come√ßar.']})}):g.map((l,C)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 px-2 py-2",children:e.jsx("input",{type:"text",value:l.peso,onChange:h=>x(C,h.target.value),onBlur:()=>i(),placeholder:m(),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})}),y.map(h=>{var $;const _=(($=l.consumos)==null?void 0:$[h.id])||"",S=u(_);return e.jsxs("td",{className:"border border-gray-300 px-1 py-1",children:[e.jsx("input",{type:"number",value:_,onChange:K=>b(C,h.id,K.target.value),onBlur:()=>i(),placeholder:"0",className:"w-full px-2 py-1 text-sm text-center border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("div",{className:"text-[10px] text-center text-gray-500 mt-0.5",children:S})]},h.id)}),e.jsx("td",{className:"border border-gray-300 px-2 py-2 text-center",children:e.jsx("button",{type:"button",onClick:()=>w(C),className:"text-red-600 hover:text-red-800 p-1",title:"Remover linha",children:e.jsx(gs,{size:16})})})]},C))})]})}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsxs("button",{type:"button",onClick:k,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(Qa,{size:16}),"Adicionar Linha"]}),e.jsxs("button",{type:"button",onClick:p,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:[e.jsx(Vs,{size:16}),"Salvar Tabela"]})]}),t&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:["üí° ",e.jsx("strong",{children:"Peso da embalagem:"})," ",t,"kg (",t*1e3,"g)",e.jsx("br",{}),"A dura√ß√£o (dias) √© calculada automaticamente: ",e.jsx("code",{children:"peso_embalagem √∑ consumo_di√°rio"})]})})]})},as=s=>{if(s===""||s===null||s===void 0)return 0;const t=s.toString().replace(/[^\d.,]/g,"").replace(",","."),d=parseFloat(t);return isNaN(d)?0:d};function wo(){var pt,At,Ks,Dt,Mt,Hs,Lt,qt,zt,It,Tt,Vt,bs,Ss,gt;const s=fa(),{id:n}=Bs(),[t]=dr(),d=!!n,[o,g]=a.useState(1),[r,v]=a.useState({codigo:"",sku:"",nome:"",codigo_barras:"",categoria_id:"",marca_id:"",departamento_id:"",tipo:"produto",unidade:"UN",descricao:"",preco_custo:"",preco_venda:"",preco_promocional:"",data_inicio_promocao:"",data_fim_promocao:"",markup:"",tipo_produto:"SIMPLES",produto_pai_id:null,tipo_kit:null,e_kit_fisico:!1,composicao_kit:[],produto_predecessor_id:null,motivo_descontinuacao:"",controle_lote:!0,estoque_minimo:"",estoque_maximo:"",tributacao:{origem:null,herdado_da_empresa:!1,origem_mercadoria:"0",ncm:"",cest:"",cfop:"",cst_icms:"",icms_aliquota:"",icms_st:!1,pis_aliquota:"",cofins_aliquota:""},origem:"0",ncm:"",cest:"",cfop:"",aliquota_icms:"",aliquota_pis:"",aliquota_cofins:"",tem_recorrencia:!1,tipo_recorrencia:"monthly",intervalo_dias:"",numero_doses:"",observacoes_recorrencia:"",especie_compativel:"both",classificacao_racao:"",peso_embalagem:"",tabela_nutricional:"",tabela_consumo:"",categoria_racao:"",especies_indicadas:"both",linha_racao_id:"",porte_animal_id:"",fase_publico_id:"",tipo_tratamento_id:"",sabor_proteina_id:"",apresentacao_peso_id:""}),[j,f]=a.useState([]),[y,c]=a.useState([]),[m,k]=a.useState([]),[w,x]=a.useState([]),[b,u]=a.useState([]),[i,p]=a.useState([]),[l,C]=a.useState([]),[h,_]=a.useState([]),[S,$]=a.useState([]),[K,re]=a.useState([]),[M,R]=a.useState([]),[J,te]=a.useState([]),[L,Z]=a.useState([]),[A,G]=a.useState([]),[E,P]=a.useState([]),[H,B]=a.useState({sku:"",nome:"",codigo_barras:"",preco_custo:"",preco_venda:"",estoque_minimo:0,e_kit:!1,e_kit_fisico:!1,composicao_kit:[]}),[N,O]=a.useState(!1),[z,ae]=a.useState([]),[W,ie]=a.useState(""),[ee,Q]=a.useState(""),[de,me]=a.useState(0),[Pe,se]=a.useState(!1),[_e,ke]=a.useState([]),[Ye,ze]=a.useState(""),[Qe,be]=a.useState(null),[Ee,he]=a.useState(null),[Xe,Je]=a.useState(null),[ca,ra]=a.useState(!1),[pa,la]=a.useState(!1),[oe,ye]=a.useState(!1),[Ce,Be]=a.useState(!1),[Ie,Y]=a.useState({quantidade:"",nome_lote:"",data_fabricacao:"",data_validade:"",preco_custo:""}),[je,Me]=a.useState(!1),[T,X]=a.useState({preco_custo:!1,markup:!1,preco_venda:!1,preco_promocional:!1}),[fe,U]=a.useState(null),[le,Ne]=a.useState(!1),[Re,q]=a.useState(null),[ne,pe]=a.useState({fornecedor_id:"",codigo_fornecedor:"",preco_custo:"",prazo_entrega:"",estoque_fornecedor:"",e_principal:!1});a.useEffect(()=>{Oe(),d&&ea()},[n]),a.useEffect(()=>{if(!d&&r.nome){const D=r.nome.toLowerCase();(D.includes("racao")||D.includes("ra√ß√£o"))&&r.classificacao_racao!=="sim"&&v(De=>({...De,classificacao_racao:"sim"}))}},[r.nome,d,r.classificacao_racao]),a.useEffect(()=>{if(!ca&&d){const D=t.get("aba");D&&g(parseInt(D))}},[ca,t,d]),a.useEffect(()=>{d&&r.tipo_produto==="VARIACAO"&&o===8&&g(1)},[r.tipo_produto,o,d]),a.useEffect(()=>{d&&o===8&&r.tipo_produto==="PAI"&&$e()},[o,d,r.tipo_produto]);const $e=async()=>{try{const D=await ur(n);P(D.data)}catch(D){console.error("Erro ao carregar varia√ß√µes:",D)}},Oe=async()=>{try{const[D,ge,De,Ze]=await Promise.all([dn(),cn(),Pl(),F.get("/clientes/",{params:{tipo_cadastro:"fornecedor",apenas_ativos:!0}})]);f(D.data);const Ve=He(D.data);c(Ve),k(ge.data),x(De.data),_(Ze.data),Ke()}catch(D){console.error("Erro ao carregar dados auxiliares:",D)}},Ke=async()=>{try{const[D,ge,De,Ze,Ve,ya]=await Promise.allSettled([F.get("/opcoes-racao/linhas",{params:{apenas_ativos:!0}}),F.get("/opcoes-racao/portes",{params:{apenas_ativos:!0}}),F.get("/opcoes-racao/fases",{params:{apenas_ativos:!0}}),F.get("/opcoes-racao/tratamentos",{params:{apenas_ativos:!0}}),F.get("/opcoes-racao/sabores",{params:{apenas_ativos:!0}}),F.get("/opcoes-racao/apresentacoes",{params:{apenas_ativos:!0}})]),Sa=(ja,Pa)=>{var rs;return ja.status==="fulfilled"?Array.isArray((rs=ja.value)==null?void 0:rs.data)?ja.value.data:[]:(console.error(`Erro ao carregar op√ß√£o de ra√ß√£o (${Pa}):`,ja.reason),[])};$(Sa(D,"linhas")),re(Sa(ge,"portes")),R(Sa(De,"fases")),te(Sa(Ze,"tratamentos")),Z(Sa(Ve,"sabores")),G(Sa(ya,"apresentacoes"))}catch(D){console.error("Erro ao carregar op√ß√µes de ra√ß√£o:",D)}},He=(D,ge=null,De=0)=>{let Ze=[];return D.filter(ya=>ya.categoria_pai_id===ge).forEach(ya=>{const Sa="¬†¬†¬†¬†".repeat(De),ja=De>0?"‚Üí ":"";Ze.push({...ya,nomeFormatado:Sa+ja+ya.nome,nivel:De});const Pa=He(D,ya.id,De+1);Ze=Ze.concat(Pa)}),Ze},ea=async()=>{var D,ge,De;try{ra(!0),he(null),Je(null);const Ve=(await yo(n)).data;let ya="";if(Ve.preco_custo&&Ve.preco_venda&&Ve.preco_custo>0&&(ya=_o(Ve.preco_custo,Ve.preco_venda).toFixed(2)),v({...Ve,sku:Ve.codigo||"",codigo:Ve.codigo||"",nome:Ve.nome||"",codigo_barras:Ve.codigo_barras||"",categoria_id:Ve.categoria_id||"",marca_id:Ve.marca_id||"",departamento_id:Ve.departamento_id||"",unidade:Ve.unidade||"UN",descricao:Ve.descricao_curta||"",tipo:Ve.tipo||"produto",preco_custo:Ve.preco_custo||"",preco_venda:Ve.preco_venda||"",preco_promocional:Ve.preco_promocional||"",data_inicio_promocao:Ve.promocao_inicio||"",data_fim_promocao:Ve.promocao_fim||"",estoque_minimo:Ve.estoque_minimo||"",estoque_maximo:Ve.estoque_maximo||"",controle_lote:Ve.controle_lote??!0,markup:ya,tipo_produto:Ve.tipo_produto||"SIMPLES",produto_pai_id:Ve.produto_pai_id||null,tipo_kit:Ve.tipo_kit||null,e_kit_fisico:Ve.e_kit_fisico||!1,composicao_kit:Ve.composicao_kit||[],origem:Ve.origem||"0",ncm:Ve.ncm||"",cest:Ve.cest||"",cfop:Ve.cfop||"",aliquota_icms:Ve.aliquota_icms||"",aliquota_pis:Ve.aliquota_pis||"",aliquota_cofins:Ve.aliquota_cofins||"",tem_recorrencia:Ve.tem_recorrencia||!1,tipo_recorrencia:Ve.tipo_recorrencia||"monthly",intervalo_dias:Ve.intervalo_dias||"",numero_doses:Ve.numero_doses||"",especie_compativel:Ve.especie_compativel||"both",observacoes_recorrencia:Ve.observacoes_recorrencia||"",classificacao_racao:Ve.classificacao_racao||"",peso_embalagem:Ve.peso_embalagem||"",tabela_nutricional:Ve.tabela_nutricional||"",tabela_consumo:Ve.tabela_consumo||"",categoria_racao:Ve.categoria_racao||"",especies_indicadas:Ve.especies_indicadas||"both",linha_racao_id:Ve.linha_racao_id||"",porte_animal_id:Ve.porte_animal_id||"",fase_publico_id:Ve.fase_publico_id||"",tipo_tratamento_id:Ve.tipo_tratamento_id||"",sabor_proteina_id:Ve.sabor_proteina_id||"",apresentacao_peso_id:Ve.apresentacao_peso_id||""}),Ve.produto_predecessor_id)try{const ja=await yo(Ve.produto_predecessor_id);he({id:ja.data.id,codigo:ja.data.codigo,nome:ja.data.nome,motivo_descontinuacao:Ve.motivo_descontinuacao,data_descontinuacao:(D=Ve.predecessor)==null?void 0:D.data_descontinuacao})}catch(ja){console.error("Erro ao carregar predecessor:",ja)}if(Ve.data_descontinuacao)try{const ja=await F.get("/produtos/",{params:{produto_predecessor_id:Ve.id,ativo:null}}),Pa=Array.isArray(ja.data)?ja.data:ja.data.items||[];if(Pa&&Pa.length>0){const rs=Pa[0];Je({id:rs.id,codigo:rs.codigo,nome:rs.nome,motivo_descontinuacao:Ve.motivo_descontinuacao,data_descontinuacao:Ve.data_descontinuacao})}}catch(ja){console.error("‚ùå Erro ao carregar sucessor:",ja)}try{const ja=await F.get(`/produtos/${n}/imagens`);p(ja.data||[])}catch(ja){console.error("Erro ao carregar imagens:",ja),p([])}if(Ve.controle_lote){const ja=await Ht(n);u(ja.data)}const Sa=await pr(n);C(Sa.data),await na(Ve)}catch(Ze){console.error("‚ùå Erro ao carregar produto:",Ze),alert("Erro ao carregar produto: "+(((De=(ge=Ze.response)==null?void 0:ge.data)==null?void 0:De.detail)||Ze.message))}finally{ra(!1)}},na=async D=>{try{const ge=D.tipo_produto==="KIT",{data:De}=ge?await F.get(`/produtos/${D.id}/kit/fiscal`):await F.get(`/produtos/${D.id}/fiscal`);v(Ze=>({...Ze,tributacao:{origem:De.origem,herdado_da_empresa:De.herdado_da_empresa,origem_mercadoria:De.origem_mercadoria??"0",ncm:De.ncm??"",cest:De.cest??"",cfop:De.cfop??"",cst_icms:De.cst_icms??"",icms_aliquota:De.icms_aliquota??"",icms_st:De.icms_st??!1,pis_aliquota:De.pis_aliquota??"",cofins_aliquota:De.cofins_aliquota??""}}))}catch(ge){console.error("Erro ao carregar fiscal:",ge)}},ia=async D=>{const ge={origem_mercadoria:r.tributacao.origem_mercadoria,ncm:r.tributacao.ncm,cest:r.tributacao.cest,cfop:r.tributacao.cfop,cst_icms:r.tributacao.cst_icms,icms_aliquota:r.tributacao.icms_aliquota,icms_st:r.tributacao.icms_st,pis_aliquota:r.tributacao.pis_aliquota,cofins_aliquota:r.tributacao.cofins_aliquota};D.tipo_produto==="KIT"?await F.put(`/produtos/${D.id}/kit/fiscal`,ge):await F.put(`/produtos/${D.id}/fiscal`,ge)},Ue=(D,ge)=>{v(De=>{const Ze={...De,[D]:ge};if(D==="preco_custo"||D==="preco_venda"){const Ve=as(D==="preco_custo"?ge:De.preco_custo),ya=as(D==="preco_venda"?ge:De.preco_venda);if(Ve&&ya&&Ve>0){const Sa=_o(Ve,ya);Ze.markup=Sa.toFixed(2)}}if(D==="markup"){const Ve=as(De.preco_custo),ya=as(ge);if(Ve&&Ve>0&&ya>=0){const Sa=Ul(Ve,ya);Ze.preco_venda=Sa.toFixed(2)}}return Ze})},Ca=async()=>{try{const D=await Al("PROD");v(ge=>({...ge,sku:D.data.sku})),alert("SKU gerado com sucesso!")}catch(D){console.error("Erro ao gerar SKU:",D),alert("Erro ao gerar SKU")}},V=async()=>{if(!r.sku){alert("Gere ou informe um SKU primeiro!");return}try{const D=await Dl(r.sku);v(ge=>({...ge,codigo_barras:D.data.codigo_barras})),alert("C√≥digo de barras gerado com sucesso!")}catch(D){console.error("Erro ao gerar c√É¬≥digo de barras:",D),alert("Erro ao gerar c√É¬≥digo de barras")}},Fe=async()=>{var D,ge;if(!Ie.quantidade||!Ie.preco_custo){alert("Preencha quantidade e pre√É¬ßo de custo!");return}try{const De=Ie.nome_lote||`LOTE-${Date.now()}`,Ze=Ie.data_fabricacao?new Date(Ie.data_fabricacao+"T00:00:00").toISOString():null,Ve=Ie.data_validade?new Date(Ie.data_validade+"T23:59:59").toISOString():null;await Ml(n,{nome_lote:De,quantidade:parseFloat(Ie.quantidade),preco_custo:parseFloat(Ie.preco_custo),data_fabricacao:Ze,data_validade:Ve,observacoes:Ie.observacoes||null}),alert("Entrada de estoque realizada com sucesso!"),Be(!1),Y({quantidade:"",nome_lote:"",data_fabricacao:"",data_validade:"",preco_custo:""});const ya=await Ht(n);u(ya.data)}catch(De){console.error("Erro ao registrar entrada:",De),alert(((ge=(D=De.response)==null?void 0:D.data)==null?void 0:ge.detail)||"Erro ao registrar entrada de estoque")}},Te=D=>{var ge,De;U({id:D.id,nome_lote:D.nome_lote,quantidade_inicial:D.quantidade_inicial,data_fabricacao:((ge=D.data_fabricacao)==null?void 0:ge.split("T")[0])||"",data_validade:((De=D.data_validade)==null?void 0:De.split("T")[0])||"",custo_unitario:D.custo_unitario}),Me(!0)},We=async()=>{var D,ge;try{const De=fe.data_fabricacao?new Date(fe.data_fabricacao+"T00:00:00").toISOString():null,Ze=fe.data_validade?new Date(fe.data_validade+"T23:59:59").toISOString():null,Ve={nome_lote:fe.nome_lote,quantidade_inicial:parseFloat(fe.quantidade_inicial),data_fabricacao:De,data_validade:Ze,custo_unitario:parseFloat(fe.custo_unitario)};await Ll(n,fe.id,Ve),alert("Lote atualizado com sucesso!"),Me(!1),U(null);const ya=await Ht(n);u(ya.data)}catch(De){console.error("Erro ao atualizar lote:",De),alert(((ge=(D=De.response)==null?void 0:D.data)==null?void 0:ge.detail)||"Erro ao atualizar lote")}},ua=async D=>{var ge,De;if(window.confirm(`Deseja realmente excluir o lote ${D.nome_lote}?

Quantidade: ${D.quantidade_disponivel} unidades
Isso remover√° o registro de entrada do estoque.`))try{await ql(n,D.id),alert("Lote exclu√≠do com sucesso!");const Ze=await Ht(n);u(Ze.data)}catch(Ze){console.error("Erro ao excluir lote:",Ze),alert(((De=(ge=Ze.response)==null?void 0:ge.data)==null?void 0:De.detail)||"Erro ao excluir lote")}},xe=async D=>{var Ve,ya,Sa,ja;const ge=Array.from(D.target.files);if(ge.length===0)return;const De=["image/jpeg","image/png","image/webp"],Ze=5*1024*1024;for(const Pa of ge){if(!De.includes(Pa.type)){alert(`${Pa.name}: Apenas JPG, PNG e WebP s√£o permitidos`);return}if(Pa.size>Ze){alert(`${Pa.name}: Imagem deve ter no m√°ximo 5MB`);return}}try{ye(!0);const Pa=[];for(const es of ge){const Ot=new FormData;Ot.append("file",es);try{const Gs=await zl(n,Ot);Pa.push(Gs.data)}catch(Gs){console.error(`Erro ao enviar ${es.name}:`,Gs),alert(`Erro ao enviar ${es.name}: ${((ya=(Ve=Gs.response)==null?void 0:Ve.data)==null?void 0:ya.detail)||"Erro desconhecido"}`)}}const rs=await F.get(`/produtos/${n}/imagens`);p(rs.data||[]),alert(`${Pa.length} imagem(ns) enviada(s) com sucesso!`)}catch(Pa){console.error("Erro ao enviar imagens:",Pa),alert(((ja=(Sa=Pa.response)==null?void 0:Sa.data)==null?void 0:ja.detail)||"Erro ao enviar imagens")}finally{ye(!1),D.target.value=""}},Ae=async D=>{if(confirm("Deseja realmente excluir esta imagem?"))try{await Il(D);const ge=await F.get(`/produtos/${n}/imagens`);p(ge.data||[]),alert("Imagem exclu√≠da com sucesso!")}catch(ge){console.error("Erro ao excluir imagem:",ge),alert("Erro ao excluir imagem")}},qe=async D=>{try{await F.put(`/produtos/imagens/${D}`,{principal:!0});const ge=await F.get(`/produtos/${n}/imagens`);p(ge.data||[]),alert("Imagem principal atualizada!")}catch(ge){console.error("Erro ao definir imagem principal:",ge),alert("Erro ao definir imagem principal")}},sa=()=>{q(null),pe({fornecedor_id:"",codigo_fornecedor:"",preco_custo:"",prazo_entrega:"",estoque_fornecedor:"",e_principal:!1}),Ne(!0)},Ia=D=>{q(D),pe({fornecedor_id:D.fornecedor_id,codigo_fornecedor:D.codigo_fornecedor||"",preco_custo:D.preco_custo||"",prazo_entrega:D.prazo_entrega||"",estoque_fornecedor:D.estoque_fornecedor||"",e_principal:D.e_principal||!1}),Ne(!0)},va=async()=>{var D,ge;if(!ne.fornecedor_id){alert("Selecione um fornecedor");return}try{const De={...ne,preco_custo:ne.preco_custo?parseFloat(ne.preco_custo):null,prazo_entrega:ne.prazo_entrega?parseInt(ne.prazo_entrega):null,estoque_fornecedor:ne.estoque_fornecedor?parseFloat(ne.estoque_fornecedor):null};Re?(await Vl(Re.id,De),alert("Fornecedor atualizado!")):(await Tl(n,De),alert("Fornecedor vinculado!"));const Ze=await pr(n);C(Ze.data),Ne(!1)}catch(De){console.error("Erro ao salvar fornecedor:",De),alert(((ge=(D=De.response)==null?void 0:D.data)==null?void 0:ge.detail)||"Erro ao salvar fornecedor")}},Ea=async D=>{if(confirm("Deseja realmente desvincular este fornecedor?"))try{await Ol(D);const ge=await pr(n);C(ge.data),alert("Fornecedor desvinculado!")}catch(ge){console.error("Erro ao desvincular fornecedor:",ge),alert("Erro ao desvincular fornecedor")}},Na=async()=>{try{const D=await F.get("/produtos/",{params:{apenas_ativos:!0,tipo_produto:"SIMPLES"}});ae(D.data.items||[])}catch(D){console.error("Erro ao carregar produtos:",D),ae([])}},Ja=()=>{if(!W||!ee||ee<=0){alert("Selecione um produto e informe a quantidade!");return}if(r.composicao_kit.find(Ze=>Ze.produto_id===parseInt(W))){alert("Este produto j√° foi adicionado ao kit!");return}const ge=z.find(Ze=>Ze.id===parseInt(W)),De={produto_componente_id:ge.id,produto_id:ge.id,produto_nome:ge.nome,produto_sku:ge.codigo,quantidade:parseFloat(ee),estoque_componente:ge.estoque_atual||0};v(Ze=>({...Ze,composicao_kit:[...Ze.composicao_kit,De]})),ie(""),Q(""),ut([...r.composicao_kit,De])},Rt=D=>{const ge=r.composicao_kit.filter(De=>De.produto_id!==D);v(De=>({...De,composicao_kit:ge})),ut(ge)},ut=D=>{if(!D||D.length===0){me(0);return}const ge=D.map(Ze=>{const Ve=Ze.estoque_componente||0,ya=Ze.quantidade||1;return Math.floor(Ve/ya)}),De=Math.min(...ge);me(De>=0?De:0)};a.useEffect(()=>{const D=r.tipo_produto==="KIT"||r.tipo_produto==="VARIACAO"&&r.tipo_kit;o===9&&D&&(Na(),r.composicao_kit&&r.composicao_kit.length>0&&ut(r.composicao_kit))},[o,r.tipo_produto,r.tipo_kit]);const ks=async D=>{var ge,De;if(D.preventDefault(),!r.nome){alert("Preencha o campo Nome");return}if(r.tipo_produto!=="PAI"&&!r.preco_venda){alert("Preencha o Pre√ßo de Venda");return}if(!r.codigo&&!r.sku){alert("Preencha o campo SKU/C√≥digo");return}try{la(!0);const Ze={codigo:r.codigo||r.sku,nome:r.nome,descricao_curta:r.descricao||null,codigo_barras:r.codigo_barras||null,unidade:r.unidade||"UN",preco_custo:r.preco_custo?parseFloat(r.preco_custo):0,preco_venda:parseFloat(r.preco_venda),preco_promocional:r.preco_promocional?parseFloat(r.preco_promocional):null,promocao_inicio:r.data_inicio_promocao||null,promocao_fim:r.data_fim_promocao||null,controle_lote:r.controle_lote||!1,estoque_minimo:r.estoque_minimo?parseInt(r.estoque_minimo):0,estoque_maximo:r.estoque_maximo?parseInt(r.estoque_maximo):null,categoria_id:r.categoria_id?parseInt(r.categoria_id):null,marca_id:r.marca_id?parseInt(r.marca_id):null,departamento_id:r.departamento_id?parseInt(r.departamento_id):null,tipo_produto:r.tipo_produto||"SIMPLES",produto_pai_id:r.produto_pai_id||null,tipo_kit:r.tipo_produto==="KIT"||r.tipo_produto==="VARIACAO"&&r.tipo_kit?r.e_kit_fisico?"FISICO":"VIRTUAL":null,e_kit_fisico:r.tipo_produto==="KIT"||r.tipo_produto==="VARIACAO"&&r.tipo_kit?r.e_kit_fisico:null,composicao_kit:r.tipo_produto==="KIT"||r.tipo_produto==="VARIACAO"&&r.tipo_kit?r.composicao_kit:null,produto_predecessor_id:r.produto_predecessor_id||null,motivo_descontinuacao:r.motivo_descontinuacao||null,tem_recorrencia:r.tem_recorrencia||!1,tipo_recorrencia:r.tem_recorrencia?r.tipo_recorrencia:null,intervalo_dias:r.tem_recorrencia&&r.intervalo_dias?parseInt(r.intervalo_dias):null,numero_doses:r.tem_recorrencia&&r.numero_doses?parseInt(r.numero_doses):null,especie_compativel:r.tem_recorrencia?r.especie_compativel:null,observacoes_recorrencia:r.tem_recorrencia?r.observacoes_recorrencia:null,classificacao_racao:r.classificacao_racao||null,peso_embalagem:r.peso_embalagem?parseFloat(r.peso_embalagem):null,tabela_nutricional:r.tabela_nutricional||null,tabela_consumo:r.tabela_consumo||null,categoria_racao:r.categoria_racao||null,especies_indicadas:r.especies_indicadas||null,linha_racao_id:r.linha_racao_id?parseInt(r.linha_racao_id):null,porte_animal_id:r.porte_animal_id?parseInt(r.porte_animal_id):null,fase_publico_id:r.fase_publico_id?parseInt(r.fase_publico_id):null,tipo_tratamento_id:r.tipo_tratamento_id?parseInt(r.tipo_tratamento_id):null,sabor_proteina_id:r.sabor_proteina_id?parseInt(r.sabor_proteina_id):null,apresentacao_peso_id:r.apresentacao_peso_id?parseInt(r.apresentacao_peso_id):null};if(console.log("√∞≈∏‚Äú¬§ Enviando dados para API:",Ze),d)await ia({id:n,tipo_produto:r.tipo_produto}),await Rl(n,Ze),alert("Produto atualizado com sucesso!"),s("/produtos");else{const ya=(await No(Ze)).data.id;r.tipo_produto==="PAI"?(alert("Produto PAI criado com sucesso! Agora cadastre as varia√ß√µes."),s(`/produtos/${ya}/editar?aba=variacoes`)):(alert("Produto cadastrado com sucesso!"),s("/produtos"))}}catch(Ze){console.error("Erro ao salvar produto:",Ze),alert(((De=(ge=Ze.response)==null?void 0:ge.data)==null?void 0:De.detail)||"Erro ao salvar produto")}finally{la(!1)}};return ca?e.jsx("div",{className:"p-6 flex justify-center items-center h-96",children:e.jsx("div",{className:"text-gray-600",children:"Carregando produto..."})}):d&&!r.nome?e.jsx("div",{className:"p-6 flex justify-center items-center h-96",children:e.jsx("div",{className:"text-gray-600",children:"Carregando dados..."})}):e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>{r.tipo_produto==="VARIACAO"&&r.produto_pai_id?s(`/produtos/${r.produto_pai_id}/editar?aba=8`):s("/produtos")},className:"text-blue-600 hover:text-blue-800 mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Voltar"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:d?"Editar Produto":"Novo Produto"}),d&&r.codigo&&e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"SKU:"}),e.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-800 rounded-lg font-mono",children:r.codigo})]}),r.nome&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Descri√ß√£o:"}),e.jsx("span",{className:"text-gray-600",children:r.nome})]})]})]}),e.jsxs("a",{href:"/cadastros/categorias",target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 border border-blue-200 flex items-center gap-2 text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Gerenciar Categorias"]})]})}),e.jsx("div",{className:"mb-6 border-b border-gray-200",children:e.jsx("nav",{className:"flex gap-8",children:[{id:1,label:"Caracter√≠sticas"},{id:2,label:"Imagens"},{id:3,label:"Estoque/Lotes"},{id:4,label:"Fornecedores"},{id:5,label:"Tributa√ß√£o"},{id:6,label:"üîÑ Recorr√™ncia"},{id:7,label:"ü•´ Ra√ß√£o"},...r.tipo_produto==="PAI"?[{id:8,label:"üì¶ Varia√ß√µes"}]:[],...r.tipo_produto==="KIT"||r.tipo_produto==="VARIACAO"&&r.tipo_kit?[{id:9,label:"üß© Composi√ß√£o"}]:[]].map(D=>e.jsx("button",{onClick:()=>g(D.id),className:`pb-4 px-1 border-b-2 font-medium text-sm transition-colors ${o===D.id?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:D.label},D.id))})}),d&&Ee&&e.jsx("div",{className:"mb-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 p-5 rounded-lg shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"w-7 h-7 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"üîó Este produto √© continua√ß√£o de outro"})}),e.jsxs("p",{className:"text-sm text-gray-700 mb-3",children:["Este produto substitui:"," ",e.jsxs("button",{type:"button",onClick:()=>s(`/produtos/${Ee.id}/editar`),className:"font-bold text-blue-700 hover:text-blue-900 hover:underline",children:[Ee.codigo," - ",Ee.nome]})]}),Ee.motivo_descontinuacao&&e.jsxs("div",{className:"bg-white/70 rounded-md px-3 py-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Motivo da substitui√ß√£o:"})," ",e.jsx("span",{className:"text-gray-900",children:Ee.motivo_descontinuacao})]})]})]})}),d&&Xe&&e.jsx("div",{className:"mb-6 bg-gradient-to-r from-red-50 to-orange-50 border-l-4 border-red-500 p-5 rounded-lg shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"w-7 h-7 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"‚ö†Ô∏è Este produto foi descontinuado"})}),e.jsxs("p",{className:"text-sm text-gray-700 mb-3",children:["Descontinuado em"," ",e.jsx("span",{className:"font-semibold",children:new Date(Xe.data_descontinuacao).toLocaleDateString("pt-BR")})]}),e.jsxs("p",{className:"text-sm text-gray-700 mb-3",children:["Substitu√≠do por:"," ",e.jsxs("button",{type:"button",onClick:()=>s(`/produtos/${Xe.id}/editar`),className:"font-bold text-red-700 hover:text-red-900 hover:underline",children:[Xe.codigo," - ",Xe.nome]})]}),Xe.motivo_descontinuacao&&e.jsxs("div",{className:"bg-white/70 rounded-md px-3 py-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Motivo:"})," ",e.jsx("span",{className:"text-gray-900",children:Xe.motivo_descontinuacao})]})]})]})}),e.jsxs("form",{onSubmit:ks,children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[o===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:r.sku,onChange:D=>Ue("sku",D.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: PROD0001"}),e.jsx("button",{type:"button",onClick:Ca,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm",children:"Gerar"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C√≥digo de Barras"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:r.codigo_barras,onChange:D=>Ue("codigo_barras",D.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"EAN-13"}),e.jsx("button",{type:"button",onClick:V,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm",children:"Gerar"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Produto *"}),e.jsx("input",{type:"text",value:r.nome,onChange:D=>Ue("nome",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: Ra√ß√£o Golden para C√£es Adultos 15kg",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria"}),e.jsxs("select",{value:r.categoria_id,onChange:D=>Ue("categoria_id",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),y.map(D=>e.jsx("option",{value:D.id,children:D.nomeFormatado},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Marca"}),e.jsxs("select",{value:r.marca_id,onChange:D=>Ue("marca_id",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),m.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Departamento"}),e.jsxs("select",{value:r.departamento_id,onChange:D=>Ue("departamento_id",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),w.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:r.tipo,onChange:D=>Ue("tipo",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"produto",children:"Produto"}),e.jsx("option",{value:"servico",children:"Servi√ßo"}),e.jsx("option",{value:"ambos",children:"Produto e Servi√ßo"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unidade"}),e.jsxs("select",{value:r.unidade,onChange:D=>Ue("unidade",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"UN",children:"UN - Unidade"}),e.jsx("option",{value:"KG",children:"KG - Quilograma"}),e.jsx("option",{value:"G",children:"G - Grama"}),e.jsx("option",{value:"L",children:"L - Litro"}),e.jsx("option",{value:"ML",children:"ML - Mililitro"}),e.jsx("option",{value:"M",children:"M - Metro"}),e.jsx("option",{value:"CX",children:"CX - Caixa"}),e.jsx("option",{value:"PCT",children:"PCT - Pacote"})]})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri√ß√£o"}),e.jsx("textarea",{value:r.descricao,onChange:D=>Ue("descricao",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"2",placeholder:"Descri√ß√£o detalhada do produto..."})]})]}),r.tipo_produto!=="PAI"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pre√ßo de Custo"}),e.jsx("input",{type:"text",value:T.preco_custo?r.preco_custo||"":r.preco_custo?`R$ ${as(r.preco_custo).toFixed(2).replace(".",",")}`:"R$ 0,00",onChange:D=>{const ge=D.target.value.replace(/[^\d.,]/g,"").replace(",",".");Ue("preco_custo",ge)},onFocus:D=>{X(ge=>({...ge,preco_custo:!0})),D.target.select()},onBlur:D=>{X(De=>({...De,preco_custo:!1}));const ge=as(D.target.value);Ue("preco_custo",ge>0?ge.toFixed(2):"")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"R$ 0,00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Markup"}),e.jsx("input",{type:"text",value:T.markup?r.markup||"":r.markup?`${as(r.markup).toFixed(2).replace(".",",")}%`:"0,00%",onChange:D=>{const ge=D.target.value.replace(/[^\d.,]/g,"").replace(",",".");Ue("markup",ge)},onFocus:D=>{X(ge=>({...ge,markup:!0})),D.target.select()},onBlur:D=>{X(De=>({...De,markup:!1}));const ge=as(D.target.value);Ue("markup",ge>=0?ge.toFixed(2):"")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0,00%"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pre√ßo de Venda *"}),e.jsx("input",{type:"text",value:T.preco_venda?r.preco_venda||"":r.preco_venda?`R$ ${as(r.preco_venda).toFixed(2).replace(".",",")}`:"R$ 0,00",onChange:D=>{const ge=D.target.value.replace(/[^\d.,]/g,"").replace(",",".");Ue("preco_venda",ge)},onFocus:D=>{X(ge=>({...ge,preco_venda:!0})),D.target.select()},onBlur:D=>{X(De=>({...De,preco_venda:!1}));const ge=as(D.target.value);Ue("preco_venda",ge>0?ge.toFixed(2):"")},required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"R$ 0,00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pre√ßo Promocional"}),e.jsx("input",{type:"text",value:T.preco_promocional?r.preco_promocional||"":r.preco_promocional?`R$ ${as(r.preco_promocional).toFixed(2).replace(".",",")}`:"R$ 0,00",onChange:D=>{const ge=D.target.value.replace(/[^\d.,]/g,"").replace(",",".");Ue("preco_promocional",ge)},onFocus:D=>{X(ge=>({...ge,preco_promocional:!0})),D.target.select()},onBlur:D=>{X(De=>({...De,preco_promocional:!1}));const ge=as(D.target.value);Ue("preco_promocional",ge>0?ge.toFixed(2):"")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"R$ 0,00"})]})]}),r.preco_promocional&&r.tipo_produto!=="PAI"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"In√≠cio da Promo√ß√£o"}),e.jsx("input",{type:"date",value:r.data_inicio_promocao,onChange:D=>Ue("data_inicio_promocao",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fim da Promo√ß√£o"}),e.jsx("input",{type:"date",value:r.data_fim_promocao,onChange:D=>Ue("data_fim_promocao",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),!d&&e.jsx("div",{className:"border-t pt-6 mt-6",children:e.jsxs("div",{className:"p-6 bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg border border-amber-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Evolu√ß√£o do Produto"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Pe,onChange:D=>{se(D.target.checked),D.target.checked||(be(null),Ue("produto_predecessor_id",null),Ue("motivo_descontinuacao",""))},className:"h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Este produto substitui outro"})]})]}),Pe&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-white rounded-lg border-2 border-amber-300",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"üîç Buscar Produto Anterior"}),e.jsx("input",{type:"text",placeholder:"Digite o nome ou c√≥digo do produto...",value:Ye,onChange:async D=>{if(ze(D.target.value),D.target.value.length>=2)try{const ge=await F.get("/produtos/",{params:{busca:D.target.value,page_size:10}});ke(ge.data.items||[])}catch(ge){console.error("Erro ao buscar produtos:",ge)}else ke([])},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),_e.length>0&&e.jsx("div",{className:"mt-2 max-h-48 overflow-y-auto border border-gray-300 rounded-lg",children:_e.map(D=>{var ge;return e.jsxs("div",{onClick:()=>{be(D),Ue("produto_predecessor_id",D.id),ze(""),ke([])},className:"p-3 hover:bg-amber-50 cursor-pointer border-b border-gray-200 last:border-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:D.nome}),e.jsxs("div",{className:"text-sm text-gray-600",children:["SKU: ",D.codigo," | Pre√ßo: R$ ",(ge=D.preco_venda)==null?void 0:ge.toFixed(2)]})]},D.id)})}),Qe&&e.jsx("div",{className:"mt-3 p-3 bg-green-50 border border-green-300 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-green-800",children:"‚úÖ Produto Selecionado:"}),e.jsx("div",{className:"font-semibold text-gray-900 mt-1",children:Qe.nome}),e.jsxs("div",{className:"text-sm text-gray-600",children:["SKU: ",Qe.codigo]})]}),e.jsx("button",{type:"button",onClick:()=>{be(null),Ue("produto_predecessor_id",null)},className:"text-red-600 hover:text-red-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]}),Qe&&e.jsxs("div",{className:"p-4 bg-white rounded-lg border-2 border-amber-300",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"üìù Motivo da Substitui√ß√£o"}),e.jsxs("select",{value:r.motivo_descontinuacao,onChange:D=>Ue("motivo_descontinuacao",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent mb-2",children:[e.jsx("option",{value:"",children:"Selecione o motivo..."}),e.jsx("option",{value:"Mudan√ßa de embalagem",children:"Mudan√ßa de embalagem"}),e.jsx("option",{value:"Mudan√ßa de peso/gramatura",children:"Mudan√ßa de peso/gramatura"}),e.jsx("option",{value:"Reformula√ß√£o do produto",children:"Reformula√ß√£o do produto"}),e.jsx("option",{value:"Mudan√ßa de fornecedor",children:"Mudan√ßa de fornecedor"}),e.jsx("option",{value:"Upgrade de linha",children:"Upgrade de linha"}),e.jsx("option",{value:"Outro",children:"Outro (descrever abaixo)"})]}),r.motivo_descontinuacao==="Outro"&&e.jsx("textarea",{value:r.motivo_descontinuacao,onChange:D=>Ue("motivo_descontinuacao",D.target.value),placeholder:"Descreva o motivo...",rows:"2",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800",children:[e.jsx("strong",{children:"‚ÑπÔ∏è O que acontecer√°:"}),e.jsxs("ul",{className:"mt-2 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:['O produto "',e.jsx("strong",{children:Qe.nome}),'" ser√° marcado como ',e.jsx("strong",{children:"descontinuado"})]}),e.jsx("li",{children:"Todo o hist√≥rico de vendas ser√° mantido e poder√° ser consultado"}),e.jsx("li",{children:"Voc√™ poder√° gerar relat√≥rios consolidados somando ambos os produtos"})]})]})]})]}),!Pe&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Marque esta op√ß√£o se este produto substitui outro j√° cadastrado (ex: mudan√ßa de embalagem de 350g para 300g). Isso permite manter o hist√≥rico consolidado de vendas."})]})}),!d&&e.jsx("div",{className:"border-t pt-6",children:e.jsxs("div",{className:"p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),"Tipo do Produto"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Escolha o tipo de produto que est√° cadastrando:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-white rounded-lg border-2 hover:border-blue-400 transition-colors",style:{borderColor:r.tipo_produto==="SIMPLES"?"#3b82f6":"#e5e7eb"},children:[e.jsx("input",{type:"radio",id:"tipo_simples",name:"tipo_produto",value:"SIMPLES",checked:r.tipo_produto==="SIMPLES",onChange:D=>{Ue("tipo_produto","SIMPLES"),v(ge=>({...ge,composicao_kit:[],e_kit_fisico:!1}))},className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"tipo_simples",className:"font-medium text-gray-900 cursor-pointer",children:"‚úÖ Produto Simples"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Produto √∫nico, vend√°vel, com controle de estoque pr√≥prio."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-white rounded-lg border-2 hover:border-blue-400 transition-colors",style:{borderColor:r.tipo_produto==="PAI"?"#3b82f6":"#e5e7eb"},children:[e.jsx("input",{type:"radio",id:"tipo_variacoes",name:"tipo_produto",value:"PAI",checked:r.tipo_produto==="PAI",onChange:D=>{Ue("tipo_produto","PAI"),v(ge=>({...ge,preco_custo:"",preco_venda:"",preco_promocional:"",composicao_kit:[],e_kit_fisico:!1}))},className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"tipo_variacoes",className:"font-medium text-gray-900 cursor-pointer",children:"üì¶ Produto com Varia√ß√µes"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Produto agrupador (n√£o vend√°vel). Ter√° varia√ß√µes com SKU, pre√ßo e estoque pr√≥prios.",e.jsx("br",{}),e.jsx("span",{className:"text-xs italic",children:"Exemplo: Camiseta (produto pai) ‚Üí P, M, G (varia√ß√µes)"})]}),r.tipo_produto==="PAI"&&!d&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:["‚ö†Ô∏è ",e.jsx("strong",{children:"Salve o produto primeiro"}),' para depois cadastrar as varia√ß√µes na aba "Varia√ß√µes".']}),r.tipo_produto==="PAI"&&d&&e.jsx("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded text-sm text-green-800",children:'‚úÖ Produto salvo! V√° para a aba "üì¶ Varia√ß√µes" para cadastrar as varia√ß√µes.'})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-white rounded-lg border-2 hover:border-blue-400 transition-colors",style:{borderColor:r.tipo_produto==="KIT"?"#3b82f6":"#e5e7eb"},children:[e.jsx("input",{type:"radio",id:"tipo_kit",name:"tipo_produto",value:"KIT",checked:r.tipo_produto==="KIT",onChange:D=>{Ue("tipo_produto","KIT"),g(9)},className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"tipo_kit",className:"font-medium text-gray-900 cursor-pointer",children:"üß© Produto com Composi√ß√£o (Kit)"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Kit composto por outros produtos existentes.",e.jsx("br",{}),e.jsx("span",{className:"text-xs italic",children:"Exemplo: Kit Banho (shampoo + condicionador + toalha)"})]}),r.tipo_produto==="KIT"&&e.jsxs("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded text-sm text-green-800",children:["‚úÖ ",e.jsx("strong",{children:'Aba "üß© Composi√ß√£o" aberta!'})," V√° para a aba Composi√ß√£o para definir se o kit ter√° estoque virtual ou f√≠sico e adicionar os produtos que o comp√µem."]})]})]})]})]})}),d&&r.tipo_produto==="VARIACAO"&&e.jsx("div",{className:"border-t pt-6",children:e.jsxs("div",{className:"p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),"Composi√ß√£o (Kit)"]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-white rounded-lg border-2 border-gray-300",children:[e.jsx("input",{type:"checkbox",id:"variacao_e_kit",checked:!!r.tipo_kit,onChange:D=>{D.target.checked?(Ue("tipo_kit","VIRTUAL"),Ue("e_kit_fisico",!1),g(9)):(Ue("tipo_kit",null),Ue("composicao_kit",[]),Ue("e_kit_fisico",!1))},className:"mt-1 h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"variacao_e_kit",className:"font-medium text-gray-900 cursor-pointer text-lg",children:"üß© Esta varia√ß√£o √© um KIT (possui composi√ß√£o)"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Marque esta op√ß√£o se esta varia√ß√£o √© composta por outros produtos.",e.jsx("br",{}),e.jsx("span",{className:"text-xs italic",children:"Exemplo: Camiseta P - Kit (camiseta + brinde)"})]}),r.tipo_kit&&e.jsxs("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded text-sm text-green-800",children:["‚úÖ ",e.jsx("strong",{children:"Varia√ß√£o configurada como KIT!"}),' V√° para a aba "üß© Composi√ß√£o" para definir os produtos que comp√µem este kit.']})]})]})]})})]}),o===2&&e.jsx("div",{className:"space-y-6",children:d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Imagens do Produto"}),e.jsxs("label",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer",children:[oe?"Enviando...":"+ Adicionar Imagens",e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/webp",onChange:xe,disabled:oe,className:"hidden",multiple:!0})]})]}),i.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"üì∑ Nenhuma imagem cadastrada"}),e.jsx("p",{className:"text-sm",children:'Clique em "Adicionar Imagem" para enviar fotos do produto'})]}):e.jsx("div",{className:"grid grid-cols-4 gap-4",children:i.map(D=>e.jsxs("div",{className:"relative group border rounded-lg overflow-hidden",children:[e.jsx("img",{src:`http://localhost:8000${D.url}`,alt:"Imagem do produto",className:"w-full h-48 object-cover"}),D.e_principal&&e.jsx("div",{className:"absolute top-2 left-2 px-2 py-1 bg-blue-600 text-white text-xs rounded",children:"Principal"}),e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100",children:[!D.e_principal&&e.jsx("button",{type:"button",onClick:()=>qe(D.id),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",title:"Definir como principal",children:"‚≠ê Principal"}),e.jsx("button",{type:"button",onClick:()=>Ae(D.id),className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700",title:"Excluir",children:"üóëÔ∏è Excluir"})]})]},D.id))}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Dica:"}),' A primeira imagem marcada como "Principal" ser√° exibida na listagem de produtos. Formatos aceitos: JPG, PNG, WebP (m√°x. 5MB).']})})]}):e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Salve o produto primeiro para adicionar imagens"})]})}),o===3&&e.jsx("div",{className:"space-y-6",children:r.tipo_produto==="PAI"?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-blue-300 rounded-lg bg-blue-50",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),e.jsx("p",{className:"mt-4 text-lg font-medium text-blue-900",children:"Produto com Varia√ß√µes"}),e.jsxs("p",{className:"mt-2 text-sm text-blue-700",children:["Produtos PAI n√£o possuem estoque pr√≥prio.",e.jsx("br",{}),"O controle de estoque √© feito individualmente nas varia√ß√µes."]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.controle_lote,onChange:D=>Ue("controle_lote",D.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Controlar Estoque"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estoque M√≠nimo"}),e.jsx("input",{type:"number",step:"0.01",value:r.estoque_minimo,onChange:D=>Ue("estoque_minimo",D.target.value),disabled:!r.controle_lote,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estoque M√°ximo"}),e.jsx("input",{type:"number",step:"0.01",value:r.estoque_maximo,onChange:D=>Ue("estoque_maximo",D.target.value),disabled:!r.controle_lote,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100",placeholder:"0"})]})]}),d&&r.controle_lote&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Lotes (FIFO)"}),e.jsx("button",{type:"button",onClick:()=>Be(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"+ Nova Entrada"})]}),b.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Nenhum lote cadastrado"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Lote"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Qtd Dispon√≠vel"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fabrica√ß√£o"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Validade"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Custo Unit."}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map(D=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:D.nome_lote||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-gray-900",children:D.quantidade_disponivel}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:Fr(D.data_fabricacao)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:Fr(D.data_validade)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:Ds(D.custo_unitario)}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>Te(D),className:"text-blue-600 hover:text-blue-800",title:"Editar lote",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{type:"button",onClick:()=>ua(D),className:"text-red-600 hover:text-red-800",title:"Excluir lote",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},D.id))})]})})]}),!d&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Salve o produto primeiro para gerenciar lotes"})]})}),o===4&&e.jsx("div",{className:"space-y-6",children:d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Fornecedores do Produto"}),e.jsx("button",{type:"button",onClick:sa,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"+ Adicionar Fornecedor"})]}),l.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"üè≠ Nenhum fornecedor vinculado"}),e.jsx("p",{className:"text-sm",children:'Clique em "Adicionar Fornecedor" para vincular fornecedores a este produto'})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fornecedor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"C√≥digo"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Pre√ßo Custo"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Prazo (dias)"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Principal"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(D=>e.jsxs("tr",{className:D.ativo?"":"opacity-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:D.fornecedor_nome}),e.jsx("p",{className:"text-xs text-gray-500",children:D.fornecedor_cpf_cnpj})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:D.codigo_fornecedor||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right",children:D.preco_custo?Ds(D.preco_custo):"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-center",children:D.prazo_entrega||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-center",children:D.estoque_fornecedor||"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:D.e_principal&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:"Principal"})}),e.jsxs("td",{className:"px-4 py-3 text-right space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>Ia(D),className:"text-blue-600 hover:text-blue-800 text-sm",children:"Editar"}),e.jsx("button",{type:"button",onClick:()=>Ea(D.id),className:"text-red-600 hover:text-red-800 text-sm",children:"Excluir"})]})]},D.id))})]})})]}):e.jsx("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg",children:e.jsx("p",{className:"text-gray-600",children:"Salve o produto primeiro para vincular fornecedores"})})}),o===5&&e.jsxs("div",{className:"space-y-6",children:[d&&r.tributacao&&e.jsxs("div",{className:"mb-4 flex gap-2",children:[r.tributacao.origem==="produto_legado"&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-200 text-gray-800",children:"‚ö™ Legado"}),(r.tributacao.origem==="produto_fiscal_v2"||r.tributacao.origem==="kit_fiscal_v2")&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-yellow-200 text-yellow-800",children:"üü° Personalizado"}),r.tributacao.herdado_da_empresa&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-200 text-blue-800",children:"üîµ Herdado da empresa"})]}),d&&((pt=r.tributacao)==null?void 0:pt.herdado_da_empresa)===!0&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Esta configura√ß√£o fiscal est√° sendo herdada da empresa. Para editar, personalize o fiscal deste produto."}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{type:"button",className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500",onClick:()=>v(D=>({...D,tributacao:{...D.tributacao,herdado_da_empresa:!1}})),children:"‚úèÔ∏è Personalizar fiscal deste produto"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Origem",e.jsx("span",{className:"tooltip-icon",title:"Define se o produto √© nacional ou importado. Impacta o c√°lculo do ICMS.",children:"üõà"})]}),e.jsxs("select",{value:((At=r.tributacao)==null?void 0:At.origem_mercadoria)||"0",onChange:D=>v(ge=>({...ge,tributacao:{...ge.tributacao,origem_mercadoria:D.target.value}})),disabled:((Ks=r.tributacao)==null?void 0:Ks.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"0",children:"0 - Nacional"}),e.jsx("option",{value:"1",children:"1 - Estrangeira (Importa√ß√£o direta)"}),e.jsx("option",{value:"2",children:"2 - Estrangeira (Adquirida no mercado interno)"}),e.jsx("option",{value:"3",children:"3 - Nacional (> 40% conte√∫do importado)"}),e.jsx("option",{value:"4",children:"4 - Nacional (Conforme processo produtivo b√°sico)"}),e.jsx("option",{value:"5",children:"5 - Nacional (< 40% conte√∫do importado)"}),e.jsx("option",{value:"6",children:"6 - Estrangeira (Importa√ß√£o direta sem similar)"}),e.jsx("option",{value:"7",children:"7 - Estrangeira (Mercado interno sem similar)"}),e.jsx("option",{value:"8",children:"8 - Nacional (> 70% conte√∫do importado)"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["NCM",e.jsx("span",{className:"tooltip-icon",title:"Nomenclatura Comum do Mercosul. Classifica√ß√£o fiscal do produto, base para impostos.",children:"üõà"})]}),e.jsx("input",{type:"text",value:((Dt=r.tributacao)==null?void 0:Dt.ncm)||"",onChange:D=>v(ge=>({...ge,tributacao:{...ge.tributacao,ncm:D.target.value}})),disabled:((Mt=r.tributacao)==null?void 0:Mt.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"00000000"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["CEST",e.jsx("span",{className:"tooltip-icon",title:"C√≥digo Especificador da Substitui√ß√£o Tribut√°ria. Para produtos sujeitos a ICMS ST.",children:"üõà"})]}),e.jsx("input",{type:"text",value:((Hs=r.tributacao)==null?void 0:Hs.cest)||"",onChange:D=>v(ge=>({...ge,tributacao:{...ge.tributacao,cest:D.target.value}})),disabled:((Lt=r.tributacao)==null?void 0:Lt.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0000000"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["CFOP",e.jsx("span",{className:"tooltip-icon",title:"C√≥digo Fiscal de Opera√ß√µes e Presta√ß√µes. Define a natureza da opera√ß√£o de venda.",children:"üõà"})]}),e.jsx("input",{type:"text",value:((qt=r.tributacao)==null?void 0:qt.cfop)||"",onChange:D=>v(ge=>({...ge,tributacao:{...ge.tributacao,cfop:D.target.value}})),disabled:((zt=r.tributacao)==null?void 0:zt.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0000"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Al√≠quota ICMS (%)",e.jsx("span",{className:"tooltip-icon",title:"Imposto sobre Circula√ß√£o de Mercadorias. Al√≠quota estadual aplicada na venda. Impacta o pre√ßo final.",children:"üõà"})]}),e.jsx("input",{type:"number",step:"0.01",value:((It=r.tributacao)==null?void 0:It.icms_aliquota)||"",onChange:D=>v(ge=>({...ge,tributacao:{...ge.tributacao,icms_aliquota:D.target.value}})),disabled:((Tt=r.tributacao)==null?void 0:Tt.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0,00"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Al√≠quota PIS (%)",e.jsx("span",{className:"tooltip-icon",title:"Programa de Integra√ß√£o Social. Contribui√ß√£o federal sobre a venda. Geralmente 1,65%.",children:"üõà"})]}),e.jsx("input",{type:"number",step:"0.01",value:((Vt=r.tributacao)==null?void 0:Vt.pis_aliquota)||"",onChange:D=>v(ge=>({...ge,tributacao:{...ge.tributacao,pis_aliquota:D.target.value}})),disabled:((bs=r.tributacao)==null?void 0:bs.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0,00"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Al√≠quota COFINS (%)",e.jsx("span",{className:"tooltip-icon",title:"Contribui√ß√£o para Financiamento da Seguridade Social. Contribui√ß√£o federal sobre a venda. Geralmente 7,6%.",children:"üõà"})]}),e.jsx("input",{type:"number",step:"0.01",value:((Ss=r.tributacao)==null?void 0:Ss.cofins_aliquota)||"",onChange:D=>v(ge=>({...ge,tributacao:{...ge.tributacao,cofins_aliquota:D.target.value}})),disabled:((gt=r.tributacao)==null?void 0:gt.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0,00"})]})]})]}),o===6&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-purple-50 border-l-4 border-purple-500 p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-purple-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-purple-800",children:"Sistema de Recorr√™ncia (Fase 1)"}),e.jsxs("div",{className:"mt-2 text-sm text-purple-700",children:[e.jsx("p",{children:"Configure produtos que precisam ser recomprados periodicamente (vacinas, antipulgas, ra√ß√µes)."}),e.jsx("p",{className:"mt-1",children:"O sistema criar√° lembretes autom√°ticos para notificar clientes 7 dias antes."})]})]})]})}),e.jsxs("div",{className:"flex items-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"tem_recorrencia",checked:r.tem_recorrencia,onChange:D=>Ue("tem_recorrencia",D.target.checked),className:"h-5 w-5 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"}),e.jsxs("label",{htmlFor:"tem_recorrencia",className:"ml-3",children:[e.jsx("span",{className:"text-base font-medium text-gray-900",children:"Produto com Recorr√™ncia"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Ativar lembretes autom√°ticos para este produto"})]})]}),r.tem_recorrencia&&e.jsxs("div",{className:"space-y-4 border-t pt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Recorr√™ncia *"}),e.jsxs("select",{value:r.tipo_recorrencia,onChange:D=>{Ue("tipo_recorrencia",D.target.value),D.target.value==="daily"?Ue("intervalo_dias","1"):D.target.value==="weekly"?Ue("intervalo_dias","7"):D.target.value==="monthly"?Ue("intervalo_dias","30"):D.target.value==="yearly"&&Ue("intervalo_dias","365")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"daily",children:"Di√°ria"}),e.jsx("option",{value:"weekly",children:"Semanal (7 dias)"}),e.jsx("option",{value:"monthly",children:"Mensal (30 dias)"}),e.jsx("option",{value:"yearly",children:"Anual (365 dias)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Intervalo (em dias) *"}),e.jsx("input",{type:"number",min:"1",value:r.intervalo_dias,onChange:D=>Ue("intervalo_dias",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Ex: 30 (para Nexgard)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Exemplos: Nexgard = 30, Vacina Anual = 365"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N√∫mero de Doses (opcional)"}),e.jsx("input",{type:"number",min:"1",value:r.numero_doses,onChange:D=>Ue("numero_doses",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Ex: 3 (para vacina com 3 doses)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"üíâ Se vazio, ser√° recorrente indefinidamente. Se preenchido (ex: 3), o sistema finalizar√° ap√≥s a √∫ltima dose."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Compatibilidade por Esp√©cie"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especie_compativel",value:"both",checked:r.especie_compativel==="both",onChange:D=>Ue("especie_compativel",D.target.value),className:"h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"üê∂üê± C√£es e Gatos"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especie_compativel",value:"dog",checked:r.especie_compativel==="dog",onChange:D=>Ue("especie_compativel",D.target.value),className:"h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"üê∂ Apenas C√£es"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especie_compativel",value:"cat",checked:r.especie_compativel==="cat",onChange:D=>Ue("especie_compativel",D.target.value),className:"h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"üê± Apenas Gatos"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observa√ß√µes / Instru√ß√µes"}),e.jsx("textarea",{value:r.observacoes_recorrencia,onChange:D=>Ue("observacoes_recorrencia",D.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Ex: Aplicar mensalmente no mesmo dia. N√£o atrasar mais de 5 dias."})]}),r.intervalo_dias&&e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-purple-900 mb-2",children:"üìå Preview do Lembrete"}),e.jsxs("div",{className:"text-sm text-purple-700 space-y-1",children:[e.jsxs("p",{children:["‚úì Cliente ser√° notificado ",e.jsx("strong",{children:"7 dias antes"})," da pr√≥xima dose"]}),e.jsxs("p",{children:["‚úì Intervalo configurado: ",e.jsxs("strong",{children:[r.intervalo_dias," dias"]})]}),e.jsx("p",{children:"‚úì Ap√≥s a compra, um novo lembrete ser√° criado automaticamente"}),r.especie_compativel!=="both"&&e.jsx("p",{className:"mt-2 text-purple-800",children:"‚ö†Ô∏è Sistema validar√° se o pet √© compat√≠vel na hora da venda"})]})]})]})]}),o===7&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-orange-50 border-l-4 border-orange-500 p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-orange-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-orange-800",children:"Calculadora de Ra√ß√£o (Fase 2)"}),e.jsxs("div",{className:"mt-2 text-sm text-orange-700",children:[e.jsx("p",{children:"Configure informa√ß√µes de ra√ß√£o para usar na calculadora de dura√ß√£o e custo."}),e.jsx("p",{className:"mt-1",children:"A IA usar√° esses dados para recomendar ra√ß√µes aos clientes."})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"√â ra√ß√£o?"}),e.jsxs("select",{value:r.classificacao_racao||"nao",onChange:D=>{const ge=D.target.value;v(De=>({...De,classificacao_racao:ge,linha_racao_id:ge==="sim"?De.linha_racao_id:"",porte_animal_id:ge==="sim"?De.porte_animal_id:"",fase_publico_id:ge==="sim"?De.fase_publico_id:"",tipo_tratamento_id:ge==="sim"?De.tipo_tratamento_id:"",sabor_proteina_id:ge==="sim"?De.sabor_proteina_id:"",apresentacao_peso_id:ge==="sim"?De.apresentacao_peso_id:"",peso_embalagem:ge==="sim"?De.peso_embalagem:"",categoria_racao:ge==="sim"?De.categoria_racao:""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:"nao",children:"N√£o"}),e.jsx("option",{value:"sim",children:"Sim"})]})]})}),r.classificacao_racao==="sim"&&e.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-4",children:"üìã Informa√ß√µes Detalhadas da Ra√ß√£o"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Linha"}),e.jsxs("select",{value:r.linha_racao_id,onChange:D=>Ue("linha_racao_id",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),S.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Porte do Animal"}),e.jsxs("select",{value:r.porte_animal_id,onChange:D=>Ue("porte_animal_id",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),K.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fase/P√∫blico"}),e.jsxs("select",{value:r.fase_publico_id,onChange:D=>{const ge=D.target.value,De=M.find(Ze=>String(Ze.id)===String(ge));v(Ze=>({...Ze,fase_publico_id:ge,categoria_racao:De?De.nome:""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),M.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Tratamento ",e.jsx("span",{className:"text-gray-400",children:"(Opcional)"})]}),e.jsxs("select",{value:r.tipo_tratamento_id,onChange:D=>Ue("tipo_tratamento_id",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Nenhum"}),J.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sabor/Prote√≠na"}),e.jsxs("select",{value:r.sabor_proteina_id,onChange:D=>Ue("sabor_proteina_id",D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),L.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apresenta√ß√£o (Peso)"}),e.jsxs("select",{value:r.apresentacao_peso_id,onChange:D=>{const ge=D.target.value,De=A.find(Ze=>String(Ze.id)===String(ge));v(Ze=>({...Ze,apresentacao_peso_id:ge,peso_embalagem:De?String(De.peso_kg):Ze.peso_embalagem}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),A.map(D=>e.jsxs("option",{value:D.id,children:[D.peso_kg,"kg"]},D.id))]})]})]}),e.jsxs("p",{className:"text-xs text-blue-600 mt-3",children:["üí° ",e.jsx("strong",{children:"Dica:"})," Essas informa√ß√µes ajudam a IA a recomendar a ra√ß√£o ideal para cada pet no PDV. Voc√™ pode gerenciar as op√ß√µes dispon√≠veis em ",e.jsx("strong",{children:"Cadastros > Op√ß√µes de Ra√ß√£o"}),"."]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Esp√©cies Indicadas"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especies_indicadas",value:"both",checked:r.especies_indicadas==="both",onChange:D=>Ue("especies_indicadas",D.target.value),className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"üê∂üê± Ambos"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especies_indicadas",value:"dog",checked:r.especies_indicadas==="dog",onChange:D=>Ue("especies_indicadas",D.target.value),className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"üê∂ C√£es"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especies_indicadas",value:"cat",checked:r.especies_indicadas==="cat",onChange:D=>Ue("especies_indicadas",D.target.value),className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"üê± Gatos"})]})]})]})}),e.jsx("input",{type:"hidden",value:r.tabela_nutricional}),e.jsx("div",{children:e.jsx(Hl,{value:r.tabela_consumo,onChange:D=>Ue("tabela_consumo",D),pesoEmbalagem:parseFloat(r.peso_embalagem)||null})}),r.peso_embalagem&&r.classificacao_racao&&e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-orange-900 mb-2",children:"üìä Preview da Calculadora"}),e.jsxs("div",{className:"text-sm text-orange-700 space-y-1",children:[e.jsxs("p",{children:["‚úì Peso: ",e.jsxs("strong",{children:[r.peso_embalagem,"kg"]})]}),e.jsxs("p",{children:["‚úì Classifica√ß√£o: ",e.jsx("strong",{children:r.classificacao_racao.replace("_"," ")})]}),r.categoria_racao&&e.jsxs("p",{children:["‚úì Categoria: ",e.jsx("strong",{children:r.categoria_racao})]}),r.tabela_consumo&&e.jsx("p",{className:"text-green-600",children:"‚úì Tabela de consumo configurada"}),!r.tabela_consumo&&e.jsx("p",{className:"text-yellow-600",children:"‚ö†Ô∏è Sem tabela de consumo (usar√° c√°lculo gen√©rico)"}),e.jsx("p",{className:"mt-2 text-orange-800",children:"üí° Use a Calculadora de Ra√ß√£o para ver dura√ß√£o e custo/dia"})]})]})]}),o===8&&r.tipo_produto==="PAI"&&e.jsx("div",{className:"space-y-6",children:d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:["Varia√ß√µes do Produto: ",r.nome]}),e.jsx("p",{className:"text-sm text-blue-700",children:"Cadastre as varia√ß√µes deste produto. Cada varia√ß√£o √© um produto vend√°vel independente com seu pr√≥prio SKU, pre√ßo e estoque."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-md font-semibold",children:"Varia√ß√µes Cadastradas"}),e.jsx("button",{type:"button",onClick:()=>O(!N),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:N?"‚ùå Cancelar":"‚ûï Nova Varia√ß√£o"})]}),N&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4",children:[e.jsx("h5",{className:"font-semibold mb-3",children:"Cadastrar Nova Varia√ß√£o"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU *"}),e.jsx("input",{type:"text",value:H.sku,onChange:D=>B({...H,sku:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Ex: PROD001-P"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Complementar *"}),e.jsx("input",{type:"text",value:H.nome,onChange:D=>B({...H,nome:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Ex: Tamanho P"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C√≥digo de Barras"}),e.jsx("input",{type:"text",value:H.codigo_barras,onChange:D=>B({...H,codigo_barras:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"EAN-13"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pre√ßo de Custo"}),e.jsx("input",{type:"number",step:"0.01",value:H.preco_custo,onChange:D=>B({...H,preco_custo:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pre√ßo de Venda *"}),e.jsx("input",{type:"number",step:"0.01",value:H.preco_venda,onChange:D=>B({...H,preco_venda:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estoque M√≠nimo"}),e.jsx("input",{type:"number",value:H.estoque_minimo,onChange:D=>B({...H,estoque_minimo:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"0"})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:H.e_kit,onChange:D=>B({...H,e_kit:D.target.checked}),className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:"üß© Esta varia√ß√£o √© um KIT (possui composi√ß√£o)"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Se marcado, voc√™ poder√° definir a composi√ß√£o do kit ap√≥s salvar a varia√ß√£o."})]})]})}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{O(!1),B({sku:"",nome:"",codigo_barras:"",preco_custo:"",preco_venda:"",estoque_minimo:0,e_kit:!1,e_kit_fisico:!1,composicao_kit:[]})},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:async()=>{var D,ge;if(!H.sku||!H.nome||!H.preco_venda){alert("Preencha SKU, Nome e Pre√ßo de Venda");return}try{const De={codigo:H.sku,nome:`${r.nome} - ${H.nome}`,codigo_barras:H.codigo_barras||null,preco_custo:parseFloat(H.preco_custo)||0,preco_venda:parseFloat(H.preco_venda),estoque_minimo:parseInt(H.estoque_minimo)||0,tipo_produto:"VARIACAO",produto_pai_id:parseInt(n),categoria_id:r.categoria_id||null,marca_id:r.marca_id||null,unidade:r.unidade||"UN"};H.e_kit&&(De.tipo_kit="VIRTUAL",De.e_kit_fisico=!1,De.composicao_kit=[]),await No(De),alert("Varia√ß√£o cadastrada com sucesso!"),O(!1),B({sku:"",nome:"",codigo_barras:"",preco_custo:"",preco_venda:"",estoque_minimo:0,e_kit:!1,e_kit_fisico:!1,composicao_kit:[]});const Ze=await ur(n);P(Ze.data)}catch(De){console.error("Erro ao cadastrar varia√ß√£o:",De),alert(((ge=(D=De.response)==null?void 0:D.data)==null?void 0:ge.detail)||"Erro ao cadastrar varia√ß√£o")}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Salvar Varia√ß√£o"})]})]}),E.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx("p",{className:"text-gray-500",children:"Nenhuma varia√ß√£o cadastrada ainda."}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:'Clique em "Nova Varia√ß√£o" para come√ßar.'})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"SKU"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"C√≥digo de Barras"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Custo"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Venda"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:E.map(D=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:D.codigo}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:D.nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:D.codigo_barras||"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:["R$ ",(D.preco_custo||0).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-gray-900 font-semibold",children:["R$ ",D.preco_venda.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:e.jsx("span",{className:`font-semibold ${D.estoque_atual<=D.estoque_minimo?"text-red-600":"text-green-600"}`,children:D.estoque_atual||0})}),e.jsxs("td",{className:"px-4 py-3 text-center",children:[e.jsx("button",{type:"button",onClick:()=>s(`/produtos/${D.id}/editar`),className:"text-blue-600 hover:text-blue-800 mr-2",title:"Editar",children:"‚úèÔ∏è"}),e.jsx("button",{type:"button",onClick:async()=>{if(confirm(`Deseja excluir a varia√ß√£o ${D.nome}?`))try{await Er(D.id),alert("Varia√ß√£o exclu√≠da com sucesso!");const ge=await ur(n);P(ge.data||[])}catch(ge){console.error("Erro ao excluir varia√ß√£o:",ge),alert("Erro ao excluir varia√ß√£o")}},className:"text-red-600 hover:text-red-800",title:"Excluir",children:"üóëÔ∏è"})]})]},D.id))})]})})]})]}):e.jsxs("div",{className:"text-center py-16 border-2 border-dashed border-yellow-300 rounded-lg bg-yellow-50",children:[e.jsx("svg",{className:"mx-auto h-16 w-16 text-yellow-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),e.jsx("p",{className:"mt-4 text-xl font-semibold text-yellow-900",children:"Aba Bloqueada"}),e.jsx("p",{className:"mt-2 text-sm text-yellow-800",children:"Salve o produto primeiro para habilitar o cadastro de varia√ß√µes."}),e.jsx("p",{className:"mt-4 text-xs text-yellow-700",children:"Ap√≥s salvar, voc√™ ser√° redirecionado automaticamente para cadastrar as varia√ß√µes."})]})}),o===9&&(r.tipo_produto==="KIT"||r.tipo_produto==="VARIACAO"&&r.tipo_kit)&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border-2 border-gray-300 rounded-lg p-5",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Tipo de Estoque do Kit"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{onClick:()=>Ue("e_kit_fisico",!1),className:`cursor-pointer p-4 border-2 rounded-lg transition-all ${r.e_kit_fisico?"border-gray-300 bg-white hover:border-blue-300":"border-blue-500 bg-blue-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"radio",name:"tipo_estoque_kit",checked:!r.e_kit_fisico,onChange:()=>Ue("e_kit_fisico",!1),className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"üìä"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:"Estoque Virtual"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["O estoque √© calculado ",e.jsx("strong",{children:"automaticamente"})," com base nos componentes dispon√≠veis."]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:[e.jsx("div",{children:"‚úì N√£o permite movimenta√ß√£o manual"}),e.jsx("div",{children:"‚úì Estoque = menor disponibilidade dos componentes"}),e.jsx("div",{children:"‚úì Ideal para kits montados sob demanda"})]})]})]})}),e.jsx("div",{onClick:()=>Ue("e_kit_fisico",!0),className:`cursor-pointer p-4 border-2 rounded-lg transition-all ${r.e_kit_fisico?"border-green-500 bg-green-50":"border-gray-300 bg-white hover:border-green-300"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"radio",name:"tipo_estoque_kit",checked:r.e_kit_fisico,onChange:()=>Ue("e_kit_fisico",!0),className:"mt-1 h-4 w-4 text-green-600 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"üì¶"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:"Estoque F√≠sico"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["O kit possui estoque ",e.jsx("strong",{children:"pr√≥prio e independente"})," dos componentes."]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:[e.jsx("div",{children:"‚úì Permite movimenta√ß√£o manual"}),e.jsx("div",{children:"‚úì Entrada: diminui componentes (montou kits)"}),e.jsx("div",{children:"‚úì Ideal para kits pr√©-montados"})]})]})]})})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-purple-600 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Composi√ß√£o do Kit"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Defina quais produtos comp√µem este kit e as quantidades necess√°rias de cada um."}),!r.e_kit_fisico&&e.jsxs("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800",children:[e.jsx("strong",{children:"üìä Estoque Virtual Ativo"}),e.jsx("br",{}),"O estoque deste kit ser√° calculado automaticamente baseado nos componentes.",e.jsx("br",{}),e.jsx("span",{className:"text-xs italic",children:"Estoque do kit = menor disponibilidade entre os componentes (considerando as quantidades necess√°rias)"})]}),r.e_kit_fisico&&e.jsxs("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded text-sm text-green-800",children:[e.jsx("strong",{children:"üì¶ Estoque F√≠sico Ativo"}),e.jsx("br",{}),e.jsx("strong",{children:"Entrada no kit:"})," Os componentes ser√£o automaticamente DIMINU√çDOS (unit√°rios viraram kit).",e.jsx("br",{}),e.jsx("strong",{children:"Sa√≠da manual:"})," Voc√™ poder√° escolher se os componentes voltam ao estoque (desfez o kit) ou n√£o (perda/roubo)."]})]})]})}),!r.e_kit_fisico&&r.composicao_kit.length>0&&e.jsx("div",{className:"bg-white border-2 border-green-300 rounded-lg p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Estoque Virtual do Kit"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Calculado automaticamente"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-4xl font-bold text-green-600",children:de}),e.jsx("p",{className:"text-xs text-gray-500",children:"kits dispon√≠veis"})]})]})}),e.jsxs("div",{className:"border border-gray-300 rounded-lg p-5 bg-gray-50",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Adicionar Produto ao Kit"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Produto"}),e.jsxs("select",{value:W,onChange:D=>ie(D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione um produto..."}),z.map(D=>e.jsxs("option",{value:D.id,children:["[",D.codigo,"] ",D.nome," - Estoque: ",D.estoque_atual||0]},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade"}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",value:ee,onChange:D=>Q(D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"1"})]})]}),e.jsxs("button",{type:"button",onClick:Ja,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Adicionar ao Kit"]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-3",children:["Produtos no Kit (",r.composicao_kit.length,")"]}),r.composicao_kit.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Nenhum produto adicionado ao kit ainda"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"SKU"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Quantidade"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Kits Poss√≠veis"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.composicao_kit.map((D,ge)=>{const De=Math.floor(D.estoque_componente/D.quantidade),Ze=De===de&&de>0;return e.jsxs("tr",{className:`hover:bg-gray-50 ${Ze?"bg-yellow-50":""}`,children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:D.produto_sku||"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-700",children:[D.produto_nome,Ze&&e.jsx("span",{className:"ml-2 text-xs bg-yellow-200 text-yellow-800 px-2 py-1 rounded",children:"‚ö†Ô∏è LIMITADOR"})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-900 font-semibold",children:D.quantidade}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:D.estoque_componente||0}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsx("span",{className:`font-semibold ${De===0?"text-red-600":De<5?"text-yellow-600":"text-green-600"}`,children:De})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{type:"button",onClick:()=>Rt(D.produto_id),className:"text-red-600 hover:text-red-800",title:"Remover do kit",children:"üóëÔ∏è"})})]},D.produto_id)})})]})})]}),r.composicao_kit.length>0&&de===0&&!r.e_kit_fisico&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{className:"text-sm text-red-800",children:[e.jsx("strong",{children:"Kit sem estoque dispon√≠vel!"}),e.jsx("p",{className:"mt-1",children:"Pelo menos um dos componentes est√° sem estoque suficiente para montar o kit."})]})]})})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>s("/produtos"),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:pa,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400",children:pa?"Salvando...":d?"Atualizar":"Cadastrar"})]})]}),Ce&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Nova Entrada de Estoque"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade *"}),e.jsx("input",{type:"number",step:"0.01",value:Ie.quantidade,onChange:D=>Y({...Ie,quantidade:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex justify-between items-center",children:[e.jsx("span",{children:"N√É¬∫mero do Lote"}),e.jsx("button",{type:"button",onClick:()=>{const D=`LOTE-${new Date().toISOString().split("T")[0].replace(/-/g,"")}-${Math.floor(Math.random()*1e3).toString().padStart(3,"0")}`;Y({...Ie,nome_lote:D})},className:"text-xs text-blue-600 hover:text-blue-800",children:"Gerar Sugest√É¬£o"})]}),e.jsx("input",{type:"text",value:Ie.nome_lote,onChange:D=>Y({...Ie,nome_lote:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: LOTE-20260105-001 (deixe vazio para gerar automaticamente)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Fabrica√ß√£o"}),e.jsx("input",{type:"date",value:Ie.data_fabricacao,onChange:D=>Y({...Ie,data_fabricacao:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Validade"}),e.jsx("input",{type:"date",value:Ie.data_validade,onChange:D=>Y({...Ie,data_validade:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pre√ßo de Custo *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:Ie.preco_custo,onChange:D=>Y({...Ie,preco_custo:D.target.value}),className:"w-full pl-12 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0,00"})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>Be(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:Fe,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Registrar Entrada"})]})]})}),je&&fe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Editar Lote"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Lote *"}),e.jsx("input",{type:"text",value:fe.nome_lote,onChange:D=>U({...fe,nome_lote:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nome do lote"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade *"}),e.jsx("input",{type:"number",step:"0.01",value:fe.quantidade_inicial,onChange:D=>U({...fe,quantidade_inicial:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Fabrica√ß√£o"}),e.jsx("input",{type:"date",value:fe.data_fabricacao,onChange:D=>U({...fe,data_fabricacao:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Validade"}),e.jsx("input",{type:"date",value:fe.data_validade,onChange:D=>U({...fe,data_validade:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Custo Unit√°rio *"}),e.jsx("input",{type:"number",step:"0.01",value:fe.custo_unitario,onChange:D=>U({...fe,custo_unitario:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0,00"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{Me(!1),U(null)},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:We,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Salvar Altera√ß√µes"})]})]})}),le&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:Re?"Editar Fornecedor":"Adicionar Fornecedor"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fornecedor *"}),e.jsxs("select",{value:ne.fornecedor_id,onChange:D=>pe({...ne,fornecedor_id:D.target.value}),disabled:!!Re,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",children:[e.jsx("option",{value:"",children:"Selecione..."}),h.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C√≥digo no Fornecedor"}),e.jsx("input",{type:"text",value:ne.codigo_fornecedor,onChange:D=>pe({...ne,codigo_fornecedor:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"SKU-FORNECEDOR-001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pre√ßo de Custo"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:ne.preco_custo,onChange:D=>pe({...ne,preco_custo:D.target.value}),className:"w-full pl-12 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0,00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prazo de Entrega (dias)"}),e.jsx("input",{type:"number",value:ne.prazo_entrega,onChange:D=>pe({...ne,prazo_entrega:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"7"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estoque no Fornecedor"}),e.jsx("input",{type:"number",step:"0.01",value:ne.estoque_fornecedor,onChange:D=>pe({...ne,estoque_fornecedor:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"100"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:ne.e_principal,onChange:D=>pe({...ne,e_principal:D.target.checked}),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Fornecedor Principal"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>Ne(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:va,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Salvar"})]})]})})]})}function Gl(){const s=fa(),[n,t]=a.useState([]),[d,o]=a.useState([]),[g,r]=a.useState(!1),[v,j]=a.useState({totalEntradas:0,totalSaidas:0,valorTotal:0}),[f,y]=a.useState({data_inicio:k("mes"),data_fim:w(),produto_id:"",tipo_movimentacao:""}),[c,m]=a.useState("mes");a.useEffect(()=>{x()},[]),a.useEffect(()=>{b()},[f]);function k(h){const _=new Date,S=new Date(_);switch(h){case"mes":S.setDate(1);break;case"3meses":S.setMonth(_.getMonth()-3);break;case"6meses":S.setMonth(_.getMonth()-6);break;case"ano":S.setMonth(0),S.setDate(1);break;default:return""}return S.toISOString().split("T")[0]}function w(){return new Date().toISOString().split("T")[0]}const x=async()=>{try{const h=await xn();h.data&&Array.isArray(h.data.items)?o(h.data.items):Array.isArray(h.data)?o(h.data):(console.warn("Resposta de produtos n√£o √© um array:",h.data),o([]))}catch(h){console.error("Erro ao carregar produtos:",h),o([])}},b=async()=>{var h,_,S;try{r(!0);const K=(await Bl(f)).data;let re=[];K&&Array.isArray(K.movimentacoes)?re=K.movimentacoes:Array.isArray(K)?re=K:console.warn("Resposta de movimenta√ß√µes n√£o √© um array:",K),t(re);const M=re.reduce((R,J)=>(R.totalEntradas+=J.entrada||0,R.totalSaidas+=J.saida||0,R.valorTotal+=J.valor_total||0,R),{totalEntradas:0,totalSaidas:0,valorTotal:0});j(M)}catch($){console.error("Erro ao carregar relat√≥rio:",$),console.error("Detalhes do erro:",(h=$.response)==null?void 0:h.data),alert(`Erro ao carregar relat√≥rio: ${((S=(_=$.response)==null?void 0:_.data)==null?void 0:S.detail)||$.message}`),t([])}finally{r(!1)}},u=h=>{m(h),h==="personalizado"||y({...f,data_inicio:k(h),data_fim:w()})},i=(h,_)=>{y(S=>({...S,[h]:_}))},p=()=>{const h=["Data","Produto","C√≥digo","Entrada","Sa√≠da","Estoque","Tipo","Valor","Usu√°rio","N¬∫ Pedido","Lan√ßamento"],_=n.map(re=>[re.data||"",re.produto_nome||"",re.codigo||"",re.entrada||0,re.saida||0,re.estoque||0,re.tipo||"",Ds(re.valor_total||0),re.usuario||"",re.numero_pedido||"",re.lancamento||""]);let S=h.join(";")+`
`;_.forEach(re=>{S+=re.join(";")+`
`});const $=new Blob([S],{type:"text/csv;charset=utf-8;"}),K=document.createElement("a");K.href=URL.createObjectURL($),K.download=`relatorio_movimentacoes_${new Date().toISOString().split("T")[0]}.csv`,K.click()},l=n.reduce((h,_)=>{const $=new Date(_.data_movimentacao).toLocaleDateString("pt-BR",{month:"short",year:"numeric"});return h[$]||(h[$]=[]),h[$].push(_),h},{}),C=h=>({entrada:"bg-green-100 text-green-800",saida:"bg-red-100 text-red-800",ajuste:"bg-yellow-100 text-yellow-800",transferencia:"bg-blue-100 text-blue-800"})[h]||"bg-gray-100 text-gray-800";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Relat√≥rio de Movimenta√ß√µes"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Hist√≥rico completo de entradas e sa√≠das de estoque"})]}),e.jsx("button",{onClick:()=>s("/produtos"),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Voltar"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"√öltimo M√™s",value:"mes"},{label:"3 Meses",value:"3meses"},{label:"6 Meses",value:"6meses"},{label:"Este Ano",value:"ano"},{label:"Personalizado",value:"personalizado"}].map(h=>e.jsx("button",{onClick:()=>u(h.value),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c===h.value?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:h.label},h.value))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data In√≠cio"}),e.jsx("input",{type:"date",value:f.data_inicio,onChange:h=>i("data_inicio",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:f.data_fim,onChange:h=>i("data_fim",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Produto"}),e.jsxs("select",{value:f.produto_id,onChange:h=>i("produto_id",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os Produtos"}),d.map(h=>e.jsxs("option",{value:h.id,children:[h.codigo||h.sku," - ",h.nome]},h.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:f.tipo_movimentacao,onChange:h=>i("tipo_movimentacao",h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os Tipos"}),e.jsx("option",{value:"entrada",children:"Entrada"}),e.jsx("option",{value:"saida",children:"Sa√≠da"}),e.jsx("option",{value:"ajuste",children:"Ajuste"}),e.jsx("option",{value:"transferencia",children:"Transfer√™ncia"})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Entradas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:v.totalEntradas.toFixed(2)})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 11l5-5m0 0l5 5m-5-5v12"})})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Sa√≠das"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:v.totalSaidas.toFixed(2)})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 13l-5 5m0 0l-5-5m5 5V6"})})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Valor Total"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:Ds(v.valorTotal)})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})})]}),e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:p,disabled:n.length===0,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Exportar CSV"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[g?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Carregando relat√≥rio..."}):n.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Nenhuma movimenta√ß√£o encontrada no per√≠odo selecionado"}):e.jsx("div",{className:"overflow-x-auto",children:Object.entries(l).map(([h,_])=>e.jsxs("div",{children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 font-semibold text-gray-700 border-b border-gray-200",children:[h.charAt(0).toUpperCase()+h.slice(1)," (",_.length," movimenta√ß√µes)"]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"C√≥digo"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Entrada"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sa√≠da"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Custo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usu√°rio"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"N¬∫ Pedido"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:_.map((S,$)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 whitespace-nowrap",children:S.data}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:S.produto_nome||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-700 font-mono",children:S.codigo||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-green-600",children:S.entrada>0?S.entrada:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-red-600",children:S.saida>0?S.saida:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:S.estoque||0}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${C(S.tipo)}`,children:S.tipo})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:Ds(S.valor_total||0)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:S.usuario||"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:S.numero_pedido?e.jsxs("button",{className:"text-blue-600 hover:text-blue-800 underline font-mono text-sm",title:"Clique para ver o pedido",children:["#",S.numero_pedido]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]},$))})]})]},h))}),!g&&n.length>0&&e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",n.length," movimenta√ß√µes no per√≠odo"]})})]})]})}const Ql=()=>F.get("/estoque/alertas/pendentes"),Xl=(s={})=>F.get("/estoque/alertas/todos",{params:s}),Jl=()=>F.get("/estoque/alertas/dashboard"),Yl=(s,n,t=null)=>F.put(`/estoque/alertas/${s}/resolver`,{status:n,observacao:t}),Zl=s=>F.post("/estoque/alertas/verificar-estoque-negativo",{itens:s});function ei(){const s=fa(),[n,t]=a.useState([]),[d,o]=a.useState([]),[g,r]=a.useState(null),[v,j]=a.useState(!1),[f,y]=a.useState("pendentes");a.useEffect(()=>{c()},[f]);const c=async()=>{j(!0);try{if(f==="pendentes"){const x=await Ql();t(x.data)}else if(f==="historico"){const x=await Xl();o(x.data)}else if(f==="dashboard"){const x=await Jl();r(x.data)}}catch(x){console.error("Erro ao carregar alertas:",x),Se.error("Erro ao carregar alertas de estoque")}finally{j(!1)}},m=async(x,b,u=null)=>{if(b==="resolvido"&&u){s(`/produtos?produto_id=${u}`),Se.info("Redirecionando para ajustar o estoque do produto...");return}try{await Yl(x,b),Se.success("Alerta ignorado com sucesso"),c()}catch(i){console.error("Erro ao ignorar alerta:",i),Se.error("Erro ao processar alerta")}},k=x=>{const b={CRITICO:"bg-red-100 text-red-800 border-red-300",ALTO:"bg-orange-100 text-orange-800 border-orange-300",MEDIO:"bg-yellow-100 text-yellow-800 border-yellow-300",BAIXO:"bg-blue-100 text-blue-800 border-blue-300"};return b[x]||b.MEDIO},w=x=>new Date(x).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Da,{className:"text-red-500"}),"Alertas de Estoque Negativo"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Monitoramento em tempo real de produtos com estoque cr√≠tico"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[e.jsx("button",{onClick:()=>y("pendentes"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${f==="pendentes"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Da,{size:18}),"Pendentes",n.length>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:n.length})]})}),e.jsx("button",{onClick:()=>y("dashboard"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${f==="dashboard"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oa,{size:18}),"Dashboard"]})}),e.jsx("button",{onClick:()=>y("historico"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${f==="historico"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Za,{size:18}),"Hist√≥rico"]})})]})})}),e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:c,disabled:v,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors",children:[e.jsx($a,{size:18,className:v?"animate-spin":""}),"Atualizar"]})}),v?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx($a,{className:"animate-spin mx-auto text-gray-400",size:48}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Carregando..."})]}):e.jsxs(e.Fragment,{children:[f==="pendentes"&&e.jsx("div",{className:"space-y-4",children:n.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(ha,{className:"mx-auto text-green-500",size:64}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mt-4",children:"Nenhum alerta pendente!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Todos os produtos est√£o com estoque adequado."})]}):n.map(x=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:x.produto_nome}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${k(x.criticidade)}`,children:x.criticidade})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Estoque Anterior"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:x.estoque_anterior})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Estoque Resultante"}),e.jsx("p",{className:"text-lg font-semibold text-red-600",children:x.estoque_resultante})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Quantidade Vendida"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:x.quantidade_vendida})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Venda"}),e.jsx("p",{className:"text-lg font-semibold text-blue-600",children:x.venda_codigo?`#${x.venda_codigo}`:x.venda_id?`ID: ${x.venda_id}`:"N/A"})]})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Data:"})," ",w(x.data_alerta)]}),x.observacao&&e.jsxs("p",{className:"mt-1",children:[e.jsx("strong",{children:"Observa√ß√£o:"})," ",x.observacao]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[e.jsxs("button",{onClick:()=>m(x.id,"resolvido",x.produto_id),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",title:"Ir para o produto e fazer ajuste de estoque",children:[e.jsx(Za,{size:16}),"Ajustar Estoque"]}),e.jsxs("button",{onClick:()=>m(x.id,"ignorado"),className:"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm",title:"Ignorar este alerta (aceitar estoque negativo)",children:[e.jsx(cs,{size:16}),"Ignorar"]})]})]})},x.id))}),f==="dashboard"&&g&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total de Alertas"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:g.total_alertas})]}),e.jsx(Da,{className:"text-gray-400",size:40})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pendentes"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 mt-2",children:g.alertas_pendentes})]}),e.jsx(Da,{className:"text-red-400",size:40})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Cr√≠ticos"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600 mt-2",children:g.alertas_criticos})]}),e.jsx(Oa,{className:"text-orange-400",size:40})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Resolvidos"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 mt-2",children:g.alertas_resolvidos})]}),e.jsx(ha,{className:"text-green-400",size:40})]})})]}),g.produtos_estoque_negativo&&g.produtos_estoque_negativo.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Za,{className:"text-red-500"}),"Produtos com Estoque Negativo Atual"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque Atual"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Alertas Pendentes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.produtos_estoque_negativo.map((x,b)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:x.nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-bold text-red-600",children:x.estoque_atual}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900",children:x.alertas_pendentes})]},b))})]})})]})]}),f==="historico"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Criticidade"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque Ant."}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque Res."}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Venda"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-12 text-center text-gray-500",children:"Nenhum alerta registrado"})}):d.map(x=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:w(x.data_alerta)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:x.produto_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${k(x.criticidade)}`,children:x.criticidade})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900",children:x.estoque_anterior}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-semibold text-red-600",children:x.estoque_resultante}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${x.resolvido?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:x.resolvido?"Resolvido":"Pendente"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm text-blue-600 font-medium",children:x.venda_codigo?`#${x.venda_codigo}`:x.venda_id?`ID: ${x.venda_id}`:"N/A"})]},x.id))})]})})})]})]})}function ai(){const[s,n]=a.useState([]),[t,d]=a.useState(!1),[o,g]=a.useState("pendente");a.useEffect(()=>{r();const m=setInterval(r,6e4);return()=>clearInterval(m)},[]);const r=async()=>{d(!0);try{const m=await F.get("/api/lembretes/pendentes");n(m.data.lembretes||[])}catch(m){console.error("Erro ao carregar lembretes:",m),Se.error("Erro ao carregar lembretes")}finally{d(!1)}},v=async m=>{try{await F.post(`/api/lembretes/${m}/completar`,{}),Se.success("Lembrete marcado como completado"),r()}catch{Se.error("Erro ao completar lembrete")}},j=async m=>{try{await F.post(`/api/lembretes/${m}/renovar`,{}),Se.success("Lembrete renovado com sucesso"),r()}catch{Se.error("Erro ao renovar lembrete")}},f=async m=>{if(window.confirm("Tem certeza que deseja cancelar este lembrete?"))try{await F.delete(`/api/lembretes/${m}`),Se.success("Lembrete cancelado"),r()}catch{Se.error("Erro ao cancelar lembrete")}},y=s.filter(m=>m.dias_restantes<=7),c=s.filter(m=>m.dias_restantes<0);return e.jsxs("div",{className:"lembretes-container",children:[e.jsxs("div",{className:"lembretes-header",children:[e.jsx("h1",{children:"üìå Lembretes de Recorr√™ncia"}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-number",children:s.length}),e.jsx("span",{className:"stat-label",children:"Total de Lembretes"})]}),e.jsxs("div",{className:"stat-card warning",children:[e.jsx("span",{className:"stat-number",children:y.length}),e.jsx("span",{className:"stat-label",children:"Pr√≥ximos em 7 dias"})]}),e.jsxs("div",{className:"stat-card danger",children:[e.jsx("span",{className:"stat-number",children:c.length}),e.jsx("span",{className:"stat-label",children:"Vencidos"})]})]})]}),t&&e.jsx("div",{className:"loading",children:"Carregando lembretes..."}),s.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(Io,{size:48}),e.jsx("h2",{children:"Nenhum lembrete pendente"}),e.jsx("p",{children:"Lembretes ser√£o criados automaticamente para produtos recorrentes."})]}):e.jsxs("div",{className:"lembretes-list",children:[c.length>0&&e.jsxs("div",{className:"section",children:[e.jsx("h3",{className:"section-title danger",children:"‚ö†Ô∏è Vencidos"}),c.map(m=>e.jsx(gr,{lembrete:m,onCompletar:v,onRenovar:j,onCancelar:f},m.id))]}),y.length>0&&e.jsxs("div",{className:"section",children:[e.jsx("h3",{className:"section-title warning",children:"üîî Pr√≥ximos em at√© 7 dias"}),y.map(m=>e.jsx(gr,{lembrete:m,onCompletar:v,onRenovar:j,onCancelar:f},m.id))]}),s.filter(m=>m.dias_restantes>7).length>0&&e.jsxs("div",{className:"section",children:[e.jsx("h3",{className:"section-title",children:"üìÖ Pr√≥ximos (mais de 7 dias)"}),s.filter(m=>m.dias_restantes>7).map(m=>e.jsx(gr,{lembrete:m,onCompletar:v,onRenovar:j,onCancelar:f},m.id))]})]})]})}function gr({lembrete:s,onCompletar:n,onRenovar:t,onCancelar:d}){const o=s.dias_restantes,g=new Date(s.data_proxima_dose),r=o<0?"vencido":o<=7?"proximo":"futuro",v=s.dose_total&&s.dose_total>0,j=v?s.dose_atual/s.dose_total*100:0;return e.jsxs("div",{className:`lembrete-card ${r}`,children:[e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h4",{children:s.produto_nome}),e.jsxs("div",{className:"badges",children:[v&&e.jsxs("span",{className:"dose-badge",children:["Dose ",s.dose_atual,"/",s.dose_total]}),e.jsx("span",{className:`status-badge ${r}`,children:o<0?"VENCIDO":`${Math.abs(o)}d`})]})]}),v&&e.jsx("div",{className:"progress-bar-container",children:e.jsx("div",{className:"progress-bar",style:{width:`${j}%`}})}),e.jsxs("div",{className:"card-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"Pet:"}),e.jsx("span",{className:"value",children:s.pet_nome})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"Data:"}),e.jsx("span",{className:"value",children:g.toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"Quantidade:"}),e.jsx("span",{className:"value",children:s.quantidade})]}),s.preco_estimado&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"Pre√ßo Est.:"}),e.jsxs("span",{className:"value",children:["R$ ",s.preco_estimado.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"card-actions",children:[e.jsxs("button",{className:"btn btn-success",onClick:()=>n(s.id),title:"Marcar como completado",children:[e.jsx(ws,{})," Comprado"]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>t(s.id),title:"Renovar lembrete",children:[e.jsx(Nt,{})," Renovar"]}),e.jsx("button",{className:"btn btn-danger",onClick:()=>d(s.id),title:"Cancelar lembrete",children:e.jsx(gs,{})})]})]})}function si(){const[s,n]=a.useState([]),[t,d]=a.useState([]),[o,g]=a.useState(!1),[r,v]=a.useState({pet_id:"",pet_nome:"",produto_id:"",produto_nome:"",categoria_racao:"",peso_pet_kg:"",idade_meses:"",nivel_atividade:"normal",classificacao:"",especies:"dog",produto_comparar_id:"",produto_comparar_nome:""}),[j,f]=a.useState(null),[y,c]=a.useState([]);a.useEffect(()=>{m(),k()},[]);const m=async()=>{var u,i,p;try{console.log("üîç Iniciando carregamento de produtos...");const l=await F.get("/produtos/");console.log("üì° Resposta da API:",{status:l.status,dataType:typeof l.data,isArray:Array.isArray(l.data),dataPreview:typeof l.data=="string"?l.data.substring(0,200):"object"});let C=l.data;if(typeof C=="string"){console.warn("‚ö†Ô∏è API retornou string, tentando parsear JSON...");try{C=JSON.parse(C)}catch(S){console.error("‚ùå Erro ao parsear JSON:",S),console.error("‚ùå Conte√∫do recebido:",C.substring(0,500)),Se.error("Erro: resposta da API inv√°lida");return}}const h=Array.isArray(C)?C:C.items||C.produtos||[];console.log("üì¶ Total de produtos recebidos:",h.length),console.log("üì¶ Estrutura da resposta:",Array.isArray(C)?"Array direto":`Objeto com keys: ${Object.keys(C).join(", ")}`),h.length>0&&console.log("üì¶ Estrutura do primeiro produto:",h[0]);const _=h.filter(S=>S.peso_embalagem&&S.peso_embalagem>0);console.log("ü•´ Ra√ß√µes encontradas:",_.length),console.log("üìä Total de produtos:",h.length),_.length>0?console.log("ü•´ IDs das ra√ß√µes:",_.map(S=>`${S.id}-${S.nome}`)):console.log("‚ö†Ô∏è Produtos sem peso_embalagem:",h.slice(0,5).map(S=>({id:S.id,nome:S.nome,peso_embalagem:S.peso_embalagem,categoria_racao:S.categoria_racao,classificacao_racao:S.classificacao_racao}))),n(_),_.length===0&&h.length>0?(console.warn("‚ö†Ô∏è Produtos encontrados, mas nenhum tem peso de embalagem configurado"),Se.error(`${h.length} produtos encontrados, mas nenhum tem PESO DE EMBALAGEM configurado. Edite os produtos de ra√ß√£o e preencha o campo "Peso da Embalagem (kg)".`,{duration:6e3})):_.length===0&&(console.log("‚ÑπÔ∏è Nenhum produto encontrado"),Se.error("Nenhum produto encontrado. Cadastre produtos primeiro."))}catch(l){console.error("‚ùå Erro ao carregar produtos:",l),console.error("‚ùå Detalhes:",((u=l.response)==null?void 0:u.data)||l.message),Se.error(`Erro ao carregar produtos: ${((p=(i=l.response)==null?void 0:i.data)==null?void 0:p.detail)||l.message}`)}},k=async()=>{try{const u=await F.get("/clientes/pets/todos"),i=Array.isArray(u.data)?u.data:[];d(i),console.log("üêæ Pets carregados:",i.length)}catch(u){console.error("‚ùå Erro ao carregar pets:",u)}},w=u=>{const i=t.find(p=>p.id===parseInt(u));if(i){let p="";if(i.data_nascimento){const C=new Date(i.data_nascimento),_=Math.abs(new Date-C);p=Math.floor(_/(1e3*60*60*24*30.44)).toString()}const l=i.especie==="Cachorro"?"dog":i.especie==="Gato"?"cat":r.especies;v({...r,pet_id:u,pet_nome:`${i.nome} - ${i.especie} ${i.peso?`(${i.peso}kg)`:""}`,peso_pet_kg:i.peso||"",idade_meses:p,especies:l}),Se.success(`Pet ${i.nome} selecionado!`)}else v({...r,pet_id:"",peso_pet_kg:"",idade_meses:""})},x=async()=>{var u,i;if(!r.peso_pet_kg){Se.error("Informe o peso do pet");return}if(r.categoria_racao==="filhote"&&!r.idade_meses){Se.error("‚ö†Ô∏è Idade √© obrigat√≥ria para ra√ß√µes de filhote!");return}try{g(!0);const p=await F.post("/api/produtos/calculadora-racao",{produto_id:r.produto_id?parseInt(r.produto_id):null,peso_pet_kg:parseFloat(r.peso_pet_kg),idade_meses:r.idade_meses?parseInt(r.idade_meses):null,nivel_atividade:r.nivel_atividade});f(p.data),c([]),Se.success("C√°lculo realizado!")}catch(p){console.error("Erro:",p),Se.error(((i=(u=p.response)==null?void 0:u.data)==null?void 0:i.detail)||"Erro ao calcular")}finally{g(!1)}},b=async()=>{var u,i;if(!r.peso_pet_kg){Se.error("Informe o peso do pet");return}try{if(g(!0),r.produto_comparar_id){const l=(await F.post("/api/produtos/calculadora-racao",{produto_id:parseInt(r.produto_comparar_id),peso_pet_kg:parseFloat(r.peso_pet_kg),idade_meses:r.idade_meses?parseInt(r.idade_meses):null,nivel_atividade:r.nivel_atividade})).data;if(r.produto_id){const C=await F.post("/api/produtos/calculadora-racao",{produto_id:parseInt(r.produto_id),peso_pet_kg:parseFloat(r.peso_pet_kg),idade_meses:r.idade_meses?parseInt(r.idade_meses):null,nivel_atividade:r.nivel_atividade});if(C.data.produto_id===l.produto_id)c([C.data]),Se.success("Mostrando c√°lculo da ra√ß√£o selecionada");else{const h=[C.data,l];c(h),Se.success("Comparando 2 ra√ß√µes selecionadas!")}}else c([l]),Se.success("Mostrando c√°lculo da ra√ß√£o selecionada")}else{const p={peso_pet_kg:parseFloat(r.peso_pet_kg),nivel_atividade:r.nivel_atividade};r.idade_meses&&(p.idade_meses=parseInt(r.idade_meses)),r.classificacao&&(p.classificacao=r.classificacao),r.especies&&(p.especies=r.especies);let C=(await F.post("/api/produtos/comparar-racoes",null,{params:p})).data.racoes||[];if(r.produto_id){C=C.filter(K=>K.produto_id!==parseInt(r.produto_id));const $=(await F.post("/api/produtos/calculadora-racao",{produto_id:parseInt(r.produto_id),peso_pet_kg:parseFloat(r.peso_pet_kg),idade_meses:r.idade_meses?parseInt(r.idade_meses):null,nivel_atividade:r.nivel_atividade})).data;C.sort((K,re)=>K.custo_por_dia-re.custo_por_dia),C=[$,...C]}const h=C.slice(0,10);c(h),C.length===0&&Se.error("Nenhuma ra√ß√£o encontrada com esses filtros. Tente outros crit√©rios.")}}catch(p){console.error("Erro:",p),Se.error(((i=(u=p.response)==null?void 0:u.data)==null?void 0:i.detail)||"Erro ao comparar")}finally{g(!1)}};return e.jsxs("div",{className:"calculadora-racao-container",children:[e.jsxs("div",{className:"header",children:[e.jsx("h1",{children:"ü•´ Calculadora de Ra√ß√£o"}),e.jsx("p",{children:"Calcule dura√ß√£o, custo/dia e compare produtos"})]}),e.jsxs("div",{className:"calculadora-grid",children:[e.jsxs("div",{className:"form-card",children:[e.jsx("h2",{children:"üìù Dados do Pet"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"üêæ Buscar Pet Cadastrado"}),e.jsx("input",{type:"text",list:"pets-list",value:r.pet_nome||"",onChange:u=>{const i=u.target.value;v({...r,pet_nome:i});const p=t.find(l=>`${l.nome} - ${l.especie} ${l.peso?`(${l.peso}kg)`:""}`===i);p&&w(p.id)},placeholder:"Digite ou selecione um pet",className:"pet-select"}),e.jsx("datalist",{id:"pets-list",children:t.map(u=>e.jsx("option",{value:`${u.nome} - ${u.especie} ${u.peso?`(${u.peso}kg)`:""}`},u.id))}),e.jsx("small",{className:"form-hint",children:"üí° Digite ou selecione um pet para preencher automaticamente peso e idade"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Peso do Pet (kg) *"}),e.jsx("input",{type:"number",step:"0.1",value:r.peso_pet_kg,onChange:u=>v({...r,peso_pet_kg:u.target.value}),placeholder:"Ex: 8.5"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Idade (meses)",r.categoria_racao==="filhote"&&e.jsx("span",{style:{color:"#ff6b6b"},children:" *"})]}),e.jsx("input",{type:"number",value:r.idade_meses,onChange:u=>v({...r,idade_meses:u.target.value}),placeholder:r.categoria_racao==="filhote"?"Obrigat√≥rio para filhotes!":"Ex: 24 (opcional)",required:r.categoria_racao==="filhote",style:r.categoria_racao==="filhote"?{borderColor:"#ff6b6b",borderWidth:"2px"}:{}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"N√≠vel de Atividade"}),e.jsxs("select",{value:r.nivel_atividade,onChange:u=>v({...r,nivel_atividade:u.target.value}),children:[e.jsx("option",{value:"baixo",children:"Baixo"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"alto",children:"Alto"})]})]}),e.jsx("hr",{}),e.jsx("h3",{children:"ü•´ Ra√ß√£o"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Selecionar Ra√ß√£o"}),e.jsx("input",{type:"text",list:"racoes-list",value:r.produto_nome||"",onChange:u=>{const i=u.target.value;v({...r,produto_nome:i});const p=s.find(l=>`${l.nome} - ${l.peso_embalagem}kg - R$ ${l.preco_venda}`===i);p&&v({...r,produto_id:p.id,produto_nome:i,categoria_racao:p.categoria_racao||""})},placeholder:"Digite ou selecione uma ra√ß√£o"}),e.jsx("datalist",{id:"racoes-list",children:s.map(u=>e.jsx("option",{value:`${u.nome} - ${u.peso_embalagem}kg - R$ ${u.preco_venda}`},u.id))}),r.categoria_racao==="filhote"&&e.jsx("small",{className:"form-hint",style:{color:"#ff6b6b",fontWeight:"bold"},children:"‚ö†Ô∏è Ra√ß√£o de filhote - idade √© obrigat√≥ria!"})]}),e.jsx("div",{className:"button-group",children:e.jsx("button",{onClick:x,disabled:o,className:"btn-primary",children:o?"Calculando...":"üìä Calcular"})}),e.jsx("hr",{}),e.jsx("h3",{children:"üîç Comparar Ra√ß√µes"}),e.jsxs("div",{className:"info-box",children:[e.jsx("strong",{children:"üí° Dica:"})," Escolha UMA das op√ß√µes abaixo:",e.jsx("br",{}),"‚Ä¢ Selecione uma ra√ß√£o espec√≠fica para ver como ela se compara",e.jsx("br",{}),"‚Ä¢ OU use os filtros gerais para ver todas de uma categoria"]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"‚≠ê Comparar Ra√ß√£o Espec√≠fica"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("input",{type:"text",list:"racoes-comparar-list",value:r.produto_comparar_nome||"",onChange:u=>{const i=u.target.value;if(i===""){v({...r,produto_comparar_id:"",produto_comparar_nome:""});return}v({...r,produto_comparar_nome:i,classificacao:""});const p=s.find(l=>`${l.nome} - ${l.classificacao_racao} - R$ ${l.preco_venda}`===i);p&&v({...r,produto_comparar_id:p.id,produto_comparar_nome:i,classificacao:""})},placeholder:"Digite ou selecione uma ra√ß√£o",disabled:r.classificacao!=="",style:{flex:1}}),r.produto_comparar_nome&&e.jsx("button",{type:"button",onClick:()=>v({...r,produto_comparar_id:"",produto_comparar_nome:""}),className:"btn-clear",title:"Limpar sele√ß√£o",children:"‚úï"})]}),e.jsx("datalist",{id:"racoes-comparar-list",children:s.map(u=>e.jsx("option",{value:`${u.nome} - ${u.classificacao_racao} - R$ ${u.preco_venda}`},u.id))}),r.classificacao&&e.jsx("small",{className:"form-warning",children:"‚ö†Ô∏è Limpe o filtro de classifica√ß√£o para usar esta op√ß√£o"}),!r.produto_comparar_id&&!r.classificacao&&e.jsx("small",{className:"form-hint",children:"üí° Deixe vazio para comparar por classifica√ß√£o abaixo"})]}),e.jsx("div",{className:"divider-text",children:"OU"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"üìã Filtro por Classifica√ß√£o"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("select",{value:r.classificacao,onChange:u=>v({...r,classificacao:u.target.value,produto_comparar_id:"",produto_comparar_nome:""}),disabled:r.produto_comparar_id!=="",style:{flex:1},children:[e.jsx("option",{value:"",children:"Todas as classifica√ß√µes"}),e.jsx("option",{value:"super_premium",children:"Super Premium"}),e.jsx("option",{value:"premium",children:"Premium"}),e.jsx("option",{value:"especial",children:"Especial"}),e.jsx("option",{value:"standard",children:"Standard"})]}),r.classificacao&&e.jsx("button",{type:"button",onClick:()=>v({...r,classificacao:""}),className:"btn-clear",title:"Limpar filtro",children:"‚úï"})]}),r.produto_comparar_id&&e.jsx("small",{className:"form-warning",children:"‚ö†Ô∏è Limpe a ra√ß√£o espec√≠fica acima para usar este filtro"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Esp√©cie"}),e.jsxs("select",{value:r.especies,onChange:u=>v({...r,especies:u.target.value}),children:[e.jsx("option",{value:"dog",children:"üê∂ C√£es"}),e.jsx("option",{value:"cat",children:"üê± Gatos"}),e.jsx("option",{value:"both",children:"Ambos"})]})]}),e.jsx("div",{className:"button-group",children:e.jsx("button",{onClick:b,disabled:o,className:"btn-secondary",children:o?"Comparando...":"üîç Comparar Todas"})})]}),e.jsxs("div",{children:[j&&e.jsxs("div",{className:"result-card",children:[e.jsx("h2",{children:"üìä Resultado do C√°lculo"}),e.jsxs("div",{className:"result-header",children:[e.jsx("h3",{children:j.produto_nome}),j.classificacao&&e.jsx("span",{className:`badge badge-${j.classificacao}`,children:j.classificacao.replace("_"," ")})]}),e.jsxs("div",{className:"result-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"label",children:"Peso Embalagem"}),e.jsxs("span",{className:"value",children:[j.peso_embalagem_kg," kg"]})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"label",children:"Pre√ßo"}),e.jsxs("span",{className:"value",children:["R$ ",j.preco.toFixed(2)]})]})]}),e.jsxs("div",{className:"result-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"‚è±Ô∏è"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Dura√ß√£o"}),e.jsxs("p",{children:[j.duracao_dias," dias (",j.duracao_meses," meses)"]})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"ü•´"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Consumo di√°rio"}),e.jsxs("p",{children:[j.quantidade_diaria_g,"g"]})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"üí∞"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Custo/kg"}),e.jsxs("p",{children:["R$ ",j.custo_por_kg.toFixed(2)]})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"üìÖ"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Custo/dia"}),e.jsxs("p",{children:["R$ ",j.custo_por_dia.toFixed(2)]})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"üìÜ"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Custo mensal"}),e.jsxs("p",{children:["R$ ",j.custo_mensal.toFixed(2)]})]})]})]})]}),y.length>0&&e.jsxs("div",{className:"comparativo-card",children:[e.jsxs("h2",{children:["üèÜ Comparativo de Ra√ß√µes (",y.length,")"]}),e.jsx("p",{className:"subtitle",children:"Ordenado por melhor custo-benef√≠cio (menor custo di√°rio)"}),e.jsx("div",{className:"comparativo-list",children:(()=>{const u=Math.min(...y.map(i=>i.custo_por_dia));return y.map((i,p)=>{const l=r.produto_id&&i.produto_id===parseInt(r.produto_id),C=i.custo_por_dia===u;return e.jsxs("div",{className:`comparativo-item ${C?"melhor":""} ${l?"selecionada":""}`,style:{position:"relative"},children:[l&&e.jsx("span",{className:"badge-selecionada",style:{position:"absolute",left:"10px",top:"10px",zIndex:10,fontSize:"11px",padding:"4px 8px",whiteSpace:"nowrap"},children:"‚≠ê Selecionada"}),C&&e.jsx("span",{className:"badge-melhor",children:"üèÜ Melhor Custo-Benef√≠cio"}),e.jsxs("div",{className:"item-header",children:[e.jsxs("div",{children:[e.jsx("h4",{children:i.produto_nome}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginTop:"4px"},children:[i.classificacao&&e.jsx("span",{className:`badge badge-${i.classificacao}`,children:i.classificacao.replace("_"," ")}),e.jsxs("span",{style:{fontSize:"13px",color:"#64748b",backgroundColor:"#f1f5f9",padding:"2px 8px",borderRadius:"4px"},children:["üçΩÔ∏è ",i.quantidade_diaria_g,"g/dia"]})]})]}),e.jsxs("div",{className:"item-price",children:["R$ ",i.preco.toFixed(2)]})]}),e.jsxs("div",{className:"item-stats",children:[e.jsxs("div",{className:"stat-small",children:[e.jsx("span",{className:"label",children:"Peso"}),e.jsxs("span",{children:[i.peso_embalagem_kg,"kg"]})]}),e.jsxs("div",{className:"stat-small",children:[e.jsx("span",{className:"label",children:"Dura√ß√£o"}),e.jsxs("span",{children:[i.duracao_dias,"d"]})]}),e.jsxs("div",{className:"stat-small highlight",children:[e.jsx("span",{className:"label",children:"Custo/dia"}),e.jsxs("span",{children:["R$ ",i.custo_por_dia.toFixed(2)]})]}),e.jsxs("div",{className:"stat-small",children:[e.jsx("span",{className:"label",children:"Custo/m√™s"}),e.jsxs("span",{children:["R$ ",i.custo_mensal.toFixed(2)]})]})]}),C&&y.length>1&&e.jsxs("div",{style:{marginTop:"12px",padding:"12px",backgroundColor:"#ecfdf5",borderLeft:"3px solid #10b981",borderRadius:"4px"},children:[e.jsx("p",{style:{margin:"0 0 6px 0",fontSize:"13px",fontWeight:"600",color:"#065f46"},children:"‚ú® Por que esta √© a melhor op√ß√£o?"}),e.jsxs("p",{style:{margin:"0",fontSize:"13px",color:"#047857",lineHeight:"1.5"},children:["Apesar de ",i.classificacao==="premium"||i.classificacao==="super_premium"?`ter um pre√ßo mais alto (R$ ${i.preco.toFixed(2)})`:`custar R$ ${i.preco.toFixed(2)}`,", esta ra√ß√£o ",i.classificacao==="super_premium"?"super premium √© muito concentrada em nutrientes":i.classificacao==="premium"?"premium tem melhor densidade nutricional":"tem excelente efici√™ncia alimentar",", ent√£o seu pet consome apenas ",e.jsxs("strong",{children:[i.quantidade_diaria_g,"g por dia"]}),".",y[1]&&e.jsxs(e.Fragment,{children:[" Em compara√ß√£o, a segunda op√ß√£o requer ",e.jsxs("strong",{children:[y[1].quantidade_diaria_g,"g/dia"]}),", resultando em um custo di√°rio ",e.jsxs("strong",{children:["R$ ",(y[1].custo_por_dia-i.custo_por_dia).toFixed(2)," maior"]}),"(R$ ",i.custo_por_dia.toFixed(2)," vs R$ ",y[1].custo_por_dia.toFixed(2),")."]})]})]})]},i.produto_id)})})()})]})]})]})]})}const ti=()=>{var re;const s=fa(),[n]=dr(),t=n.get("cliente_id"),[d,o]=a.useState([]),[g,r]=a.useState([]),[v,j]=a.useState(!0),[f,y]=a.useState(""),[c,m]=a.useState(""),[k,w]=a.useState(t||""),[x,b]=a.useState(""),[u,i]=a.useState(""),[p,l]=a.useState(!1);a.useEffect(()=>{C(),h()},[k,x,u]);const C=async()=>{try{j(!0);const M=new URLSearchParams;c&&M.append("busca",c),k&&M.append("cliente_id",k),x&&M.append("especie",x),u&&M.append("ativo",u==="ativo"?"true":"false");const R=await F.get(`/pets?${M.toString()}`);o(R.data),y("")}catch(M){console.error("Erro ao carregar pets:",M),y("Erro ao carregar pets")}finally{j(!1)}},h=async()=>{try{const M=await F.get("/clientes/");r(M.data)}catch(M){console.error("Erro ao carregar clientes:",M)}},_=M=>{M.preventDefault(),C()},S=()=>{m(""),w(""),b(""),i("")},$=M=>{if(!M)return null;const R=new Date,J=new Date(M),te=R.getFullYear()-J.getFullYear(),L=R.getMonth()-J.getMonth();return te===0?`${L} ${L===1?"m√™s":"meses"}`:`${te} ${te===1?"ano":"anos"}`},K=async M=>{try{M.ativo?await F.delete(`/pets/${M.id}?soft_delete=true`):await F.post(`/pets/${M.id}/ativar`),C()}catch(R){console.error("Erro ao alterar status do pet:",R),alert("Erro ao alterar status do pet")}};return v?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando pets..."})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(Fa,{className:"text-blue-600",size:36}),"Gerenciamento de Pets"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:k?`Pets do cliente: ${((re=g.find(M=>M.id===parseInt(k)))==null?void 0:re.nome)||""}`:"Gest√£o completa dos animais de estima√ß√£o"})]}),e.jsxs("button",{onClick:()=>s("/pets/novo"),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(Qa,{size:20}),"Adicionar Pet"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Bo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por nome, ra√ßa, microchip ou c√≥digo...",value:c,onChange:M=>m(M.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:"Buscar"}),e.jsxs("button",{type:"button",onClick:()=>l(!p),className:"px-4 py-2 border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(Ar,{}),"Filtros"]})]}),p&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cliente (Tutor)"}),e.jsxs("select",{value:k,onChange:M=>w(M.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Todos os clientes"}),g.map(M=>e.jsx("option",{value:M.id,children:M.nome},M.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Esp√©cie"}),e.jsxs("select",{value:x,onChange:M=>b(M.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Todas as esp√©cies"}),e.jsx("option",{value:"C√£o",children:"C√£o"}),e.jsx("option",{value:"Gato",children:"Gato"}),e.jsx("option",{value:"Ave",children:"Ave"}),e.jsx("option",{value:"Roedor",children:"Roedor"}),e.jsx("option",{value:"R√©ptil",children:"R√©ptil"}),e.jsx("option",{value:"Outro",children:"Outro"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:u,onChange:M=>i(M.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"ativo",children:"Ativos"}),e.jsx("option",{value:"inativo",children:"Inativos"})]})]}),e.jsx("div",{className:"col-span-3 flex justify-end",children:e.jsxs("button",{type:"button",onClick:S,className:"px-4 py-2 text-gray-600 hover:text-gray-900 flex items-center gap-2",children:[e.jsx(ps,{}),"Limpar filtros"]})})]})]})}),f&&e.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(_a,{}),f]}),d.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(Fa,{className:"mx-auto text-gray-300 mb-4",size:64}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Nenhum pet encontrado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:c||k||x||u?"Tente ajustar os filtros ou fazer uma nova busca":"Comece adicionando o primeiro pet"}),e.jsxs("button",{onClick:()=>s("/pets/novo"),className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(Qa,{}),"Adicionar Primeiro Pet"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(M=>e.jsx("div",{className:`bg-white rounded-lg shadow-sm border-2 transition-all hover:shadow-md ${M.ativo?"border-gray-200":"border-red-200 bg-gray-50"}`,children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:M.nome}),M.ativo?e.jsx(ws,{className:"text-green-500",size:16}):e.jsx(Nr,{className:"text-red-500",size:16})]}),e.jsx("p",{className:"text-sm text-gray-500",children:M.codigo})]}),M.foto_url&&e.jsx("img",{src:M.foto_url,alt:M.nome,className:"w-16 h-16 rounded-full object-cover border-2 border-gray-200"})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Esp√©cie:"}),e.jsx("span",{className:"text-gray-900",children:M.especie})]}),M.raca&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Ra√ßa:"}),e.jsx("span",{className:"text-gray-900",children:M.raca})]}),M.sexo&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Sexo:"}),e.jsx("span",{className:"text-gray-900",children:M.sexo})]}),M.data_nascimento&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Idade:"}),e.jsx("span",{className:"text-gray-900",children:$(M.data_nascimento)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm pt-2 border-t border-gray-100",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Tutor:"}),e.jsx("span",{className:"text-blue-600",children:M.cliente_nome})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>s(`/pets/${M.id}`),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium",children:[e.jsx(Yt,{size:16}),"Ver Detalhes"]}),e.jsx("button",{onClick:()=>s(`/pets/${M.id}/editar`),className:"px-3 py-2 border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors",title:"Editar",children:e.jsx(_s,{size:16,className:"text-gray-600"})}),e.jsx("button",{onClick:()=>K(M),className:`px-3 py-2 border rounded-lg transition-colors ${M.ativo?"border-red-300 hover:bg-red-50 text-red-600":"border-green-300 hover:bg-green-50 text-green-600"}`,title:M.ativo?"Desativar":"Reativar",children:M.ativo?e.jsx(Nr,{size:16}):e.jsx(ws,{size:16})})]})]})},M.id))}),d.length>0&&e.jsxs("div",{className:"mt-6 text-center text-sm text-gray-600",children:["Total: ",e.jsx("strong",{children:d.length})," pet(s) encontrado(s)",u===""&&e.jsxs(e.Fragment,{children:[" ‚Ä¢ ",e.jsx("strong",{className:"text-green-600",children:d.filter(M=>M.ativo).length})," ativo(s)"," ‚Ä¢ ",e.jsx("strong",{className:"text-red-600",children:d.filter(M=>!M.ativo).length})," inativo(s)"]})]})]})};function ri(s){if(!s)return null;const n=typeof s=="string"?new Date(s):s,t=new Date,d=t.getFullYear()-n.getFullYear(),o=t.getMonth()-n.getMonth();return d*12+o}function yt(s){if(!s)return"-";const n=Math.floor(s/12),t=s%12;return n===0?`${s} ${s===1?"m√™s":"meses"}`:t===0?`${n} ${n===1?"ano":"anos"}`:`${n} ${n===1?"ano":"anos"} e ${t} ${t===1?"m√™s":"meses"}`}function oi(s){if(!s)return null;const n=s.toString().toLowerCase().trim();if(/^\d+$/.test(n))return parseInt(n);const t=/(\d+(?:[.,]\d+)?)\s*anos?\s*(?:e\s*)?(\d+)?\s*meses?/i,d=n.match(t);if(d){const j=parseFloat(d[1].replace(",",".")),f=d[2]?parseInt(d[2]):0;return Math.round(j*12)+f}const o=/(\d+(?:[.,]\d+)?)\s*anos?/i,g=n.match(o);if(g){const j=parseFloat(g[1].replace(",","."));return Math.round(j*12)}const r=/(\d+)\s*meses?/i,v=n.match(r);return v?parseInt(v[1]):null}const ni=()=>{const{petId:s}=Bs(),n=fa(),[t,d]=a.useState(null),[o,g]=a.useState(!0),[r,v]=a.useState(""),[j,f]=a.useState("geral");a.useEffect(()=>{y()},[s]);const y=async()=>{try{g(!0);const x=await F.get(`/pets/${s}`);d(x.data),v("")}catch(x){console.error("Erro ao carregar pet:",x),v("Erro ao carregar informa√ß√µes do pet")}finally{g(!1)}},c=x=>{if(!x)return null;const b=new Date,u=new Date(x),i=b.getFullYear()-u.getFullYear(),p=b.getMonth()-u.getMonth();return i===0?`${p} ${p===1?"m√™s":"meses"}`:p<0?`${i-1} anos e ${12+p} meses`:p===0?`${i} ${i===1?"ano":"anos"}`:`${i} anos e ${p} ${p===1?"m√™s":"meses"}`},m=x=>x?new Date(x).toLocaleDateString("pt-BR"):"-",k=async()=>{try{t.ativo?await F.delete(`/pets/${t.id}?soft_delete=true`):await F.post(`/pets/${t.id}/ativar`),y()}catch(x){console.error("Erro ao alterar status do pet:",x),alert("Erro ao alterar status do pet")}};if(o)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando..."})]})});if(r||!t)return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(_a,{}),r||"Pet n√£o encontrado"]}),e.jsxs("button",{onClick:()=>n("/pets"),className:"mt-4 flex items-center gap-2 text-blue-600 hover:text-blue-700",children:[e.jsx(nt,{}),"Voltar para lista de pets"]})]});const w=[{id:"geral",label:"Dados Gerais",icon:qn},{id:"saude",label:"Sa√∫de",icon:Rr},{id:"vacinas",label:"Vacinas",icon:io},{id:"consultas",label:"Consultas",icon:ns},{id:"servicos",label:"Servi√ßos",icon:Fa}];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>n("/pets"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(nt,{}),"Voltar para Gerenciamento de Pets"]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[t.foto_url?e.jsx("img",{src:t.foto_url,alt:t.nome,className:"w-24 h-24 rounded-full object-cover border-4 border-gray-200"}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-blue-100 flex items-center justify-center border-4 border-gray-200",children:e.jsx(Fa,{className:"text-blue-600",size:48})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:t.nome}),t.ativo?e.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium flex items-center gap-1",children:[e.jsx(ws,{size:14}),"Ativo"]}):e.jsxs("span",{className:"px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-medium flex items-center gap-1",children:[e.jsx(Nr,{size:14}),"Inativo"]})]}),e.jsxs("p",{className:"text-gray-500 mb-1",children:[t.especie," ",t.raca&&`‚Ä¢ ${t.raca}`," ",t.sexo&&`‚Ä¢ ${t.sexo}`]}),e.jsx("p",{className:"text-sm text-gray-400",children:t.codigo}),e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(ds,{size:16}),e.jsx("span",{className:"font-medium",children:"Tutor:"}),e.jsx("span",{className:"text-blue-600",children:t.cliente_nome})]}),t.cliente_celular&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(Uo,{size:16}),e.jsx("span",{children:t.cliente_celular})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>n(`/pets/${t.id}/editar`),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(_s,{}),"Editar"]}),e.jsx("button",{onClick:k,className:`px-4 py-2 border-2 rounded-lg transition-colors font-medium ${t.ativo?"border-red-300 text-red-600 hover:bg-red-50":"border-green-300 text-green-600 hover:bg-green-50"}`,children:t.ativo?"Desativar":"Reativar"})]})]})})]}),e.jsx("div",{className:"mb-6 border-b border-gray-200",children:e.jsx("div",{className:"flex gap-4",children:w.map(x=>{const b=x.icon;return e.jsxs("button",{onClick:()=>f(x.id),className:`flex items-center gap-2 px-4 py-3 font-medium border-b-2 transition-colors ${j===x.id?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[e.jsx(b,{size:18}),x.label]},x.id)})})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[j==="geral"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Informa√ß√µes Gerais"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("p",{className:"text-gray-900 font-medium",children:t.nome})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C√≥digo"}),e.jsx("p",{className:"text-gray-900 font-mono text-sm",children:t.codigo})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Esp√©cie"}),e.jsx("p",{className:"text-gray-900",children:t.especie})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ra√ßa"}),e.jsx("p",{className:"text-gray-900",children:t.raca||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sexo"}),e.jsx("p",{className:"text-gray-900",children:t.sexo||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Castrado"}),e.jsx("p",{className:"text-gray-900",children:t.castrado?"Sim":"N√£o"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Nascimento"}),e.jsx("p",{className:"text-gray-900",children:m(t.data_nascimento)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Idade"}),e.jsx("p",{className:"text-gray-900",children:t.idade_meses?yt(t.idade_meses):t.idade_aproximada?yt(t.idade_aproximada):t.data_nascimento?c(t.data_nascimento):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Peso"}),e.jsx("p",{className:"text-gray-900",children:t.peso?`${t.peso} kg`:"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Porte"}),e.jsx("p",{className:"text-gray-900",children:t.porte||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor/Pelagem"}),e.jsx("p",{className:"text-gray-900",children:t.cor||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Microchip"}),e.jsx("p",{className:"text-gray-900 font-mono text-sm",children:t.microchip||"-"})]})]}),t.observacoes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observa√ß√µes"}),e.jsx("p",{className:"text-gray-900 bg-gray-50 p-3 rounded-lg",children:t.observacoes})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 text-sm text-gray-500",children:[e.jsxs("p",{children:["Cadastrado em: ",m(t.created_at)]}),e.jsxs("p",{children:["√öltima atualiza√ß√£o: ",m(t.updated_at)]})]})]}),j==="saude"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Informa√ß√µes de Sa√∫de"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Alergias"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-900",children:t.alergias||"Nenhuma alergia registrada"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Doen√ßas Cr√¥nicas"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-900",children:t.doencas_cronicas||"Nenhuma doen√ßa cr√¥nica registrada"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Medicamentos Cont√≠nuos"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-900",children:t.medicamentos_continuos||"Nenhum medicamento cont√≠nuo registrado"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hist√≥rico Cl√≠nico"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-900 whitespace-pre-line",children:t.historico_clinico||"Nenhum hist√≥rico cl√≠nico registrado"})})]})]})]}),j==="vacinas"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Carteira de Vacina√ß√£o"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium",children:"+ Registrar Vacina"})]}),e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(io,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"M√≥dulo em desenvolvimento"}),e.jsx("p",{className:"text-sm",children:"Em breve voc√™ poder√° gerenciar o hist√≥rico de vacinas do pet"})]})]}),j==="consultas"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Hist√≥rico de Consultas"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium",children:"+ Nova Consulta"})]}),e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(ns,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"M√≥dulo em desenvolvimento"}),e.jsx("p",{className:"text-sm",children:"Em breve voc√™ poder√° gerenciar consultas veterin√°rias"})]})]}),j==="servicos"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Hist√≥rico de Servi√ßos"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium",children:"+ Registrar Servi√ßo"})]}),e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Fa,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"M√≥dulo em desenvolvimento"}),e.jsx("p",{className:"text-sm",children:"Em breve voc√™ poder√° gerenciar banho, tosa e outros servi√ßos"})]})]})]})]})};function li({value:s,onChange:n,name:t="idade",label:d="Idade",className:o="",mostrarDataNascimento:g=!0,required:r=!1}){const[v,j]=a.useState("texto"),[f,y]=a.useState(""),[c,m]=a.useState(""),[k,w]=a.useState("");a.useEffect(()=>{s&&typeof s=="number"&&y(yt(s))},[s]);const x=p=>{const l=p.target.value;y(l),l||(w(""),n(null))},b=()=>{if(!f){w(""),n(null);return}const p=oi(f);if(p!==null){const l=yt(p);y(l),w(`‚úì ${l}`),n(p)}else w("‚ö†Ô∏è Formato inv√°lido. Ex: 12 meses, 2 anos, 1.5 anos"),n(null)},u=p=>{const l=p.target.value;if(m(l),!l){w(""),n(null);return}const C=ri(l);C!==null?(w(`‚úì ${yt(C)}`),n(C)):(w("‚ö†Ô∏è Data inv√°lida"),n(null))},i=()=>{j(v==="texto"?"data":"texto"),y(""),m(""),w(""),n(null)};return e.jsxs("div",{className:o,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[d,r&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),g&&e.jsx("button",{type:"button",onClick:i,className:"text-xs text-blue-600 hover:text-blue-800 underline",children:v==="texto"?"üìÖ Usar data de nascimento":"‚å®Ô∏è Digitar idade"})]}),v==="texto"?e.jsxs("div",{children:[e.jsx("input",{type:"text",name:t,value:f,onChange:x,onBlur:b,placeholder:"Ex: 12 meses, 2 anos, 1.5 anos, 2anos6meses",className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:r}),k&&e.jsx("p",{className:`text-xs mt-1 ${k.startsWith("‚úì")?"text-green-600":"text-orange-600"}`,children:k}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Digite a idade e pressione Tab ou clique fora do campo"})]}):e.jsxs("div",{children:[e.jsx("input",{type:"date",name:t,value:c,onChange:u,max:new Date().toISOString().split("T")[0],className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:r}),k&&e.jsx("p",{className:`text-xs mt-1 ${k.startsWith("‚úì")?"text-green-600":"text-orange-600"}`,children:k}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Data de nascimento do pet"})]})]})}const ii=({tipo:s,especieId:n,especieNome:t,onSuccess:d,onClose:o})=>{const[g,r]=a.useState(""),[v,j]=a.useState(!1),[f,y]=a.useState(""),c=async m=>{var k,w;if(m.preventDefault(),y(""),!g||g.trim()===""){y(`O nome ${s==="especie"?"da esp√©cie":"da ra√ßa"} √© obrigat√≥rio`);return}try{j(!0);let x;if(s==="especie")x=await F.post("/cadastros/especies",{nome:g.trim(),ativo:!0});else{if(!n){y("Selecione uma esp√©cie primeiro");return}x=await F.post("/cadastros/racas",{nome:g.trim(),especie_id:n,ativo:!0})}d&&d(x.data),o()}catch(x){console.error("Erro ao salvar:",x),y(((w=(k=x.response)==null?void 0:k.data)==null?void 0:w.detail)||"Erro ao salvar")}finally{j(!1)}};return e.jsx("div",{className:"quick-modal-overlay",onClick:o,children:e.jsxs("div",{className:"quick-modal-content",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"quick-modal-header",children:[e.jsxs("h3",{children:[s==="especie"?"üêæ Nova Esp√©cie":"‚ú® Nova Ra√ßa",s==="raca"&&t&&e.jsxs("span",{className:"quick-subtitle",children:[" - ",t]})]}),e.jsx("button",{className:"quick-btn-close",onClick:o,children:e.jsx(ps,{})})]}),e.jsxs("form",{onSubmit:c,children:[e.jsxs("div",{className:"quick-modal-body",children:[f&&e.jsxs("div",{className:"quick-alert quick-alert-danger",children:[e.jsx(_a,{})," ",f]}),e.jsxs("div",{className:"quick-form-group",children:[e.jsxs("label",{children:["Nome ",s==="especie"?"da Esp√©cie":"da Ra√ßa"," *"]}),e.jsx("input",{type:"text",value:g,onChange:m=>r(m.target.value),placeholder:s==="especie"?"Ex: C√£o, Gato, Ave...":"Ex: Labrador, SRD, Siam√™s...",required:!0,autoFocus:!0,disabled:v})]}),e.jsx("div",{className:"quick-info",children:e.jsxs("p",{children:["üí° ",s==="especie"?"Esta esp√©cie ficar√° dispon√≠vel para todos os pets":`Esta ra√ßa ser√° adicionada √† esp√©cie "${t}"`]})})]}),e.jsxs("div",{className:"quick-modal-footer",children:[e.jsx("button",{type:"button",className:"quick-btn quick-btn-secondary",onClick:o,disabled:v,children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"quick-btn quick-btn-primary",disabled:v,children:[e.jsx(Vs,{})," ",v?"Salvando...":"Salvar"]})]})]})]})})},Co=()=>{var G,E;const{petId:s}=Bs(),n=fa(),t=$r(),d=!!s,o=(G=t.state)==null?void 0:G.clienteId,[g,r]=a.useState(!1),[v,j]=a.useState(!1),[f,y]=a.useState(""),[c,m]=a.useState(""),[k,w]=a.useState([]),[x,b]=a.useState([]),[u,i]=a.useState([]),[p,l]=a.useState(!1),[C,h]=a.useState(null),[_,S]=a.useState({cliente_id:o||"",nome:"",especie:"",raca:"",sexo:"",castrado:!1,data_nascimento:"",idade_aproximada:"",peso:"",cor:"",porte:"",microchip:"",alergias:"",doencas_cronicas:"",medicamentos_continuos:"",historico_clinico:"",observacoes:"",foto_url:"",ativo:!0});a.useEffect(()=>{(async()=>{await $(),await K(),d&&await M()})()},[s]),a.useEffect(()=>{_.especie?re(_.especie):i([])},[_.especie]);const $=async()=>{try{const P=await F.get("/clientes/");w(P.data)}catch(P){console.error("Erro ao carregar clientes:",P)}},K=async()=>{try{const P=await F.get("/cadastros/especies",{params:{ativo:!0}});b(P.data)}catch(P){console.error("Erro ao carregar esp√©cies:",P)}},re=async P=>{try{const H=await F.get("/cadastros/racas",{params:{ativo:!0,especie_id:P}});i(H.data)}catch(H){console.error("Erro ao carregar ra√ßas:",H),i([])}},M=async()=>{try{r(!0);const H=(await F.get(`/pets/${s}`)).data,B=x.find(N=>N.nome===H.especie);S({cliente_id:H.cliente_id||"",nome:H.nome||"",especie:B?B.id.toString():"",raca:H.raca||"",sexo:H.sexo||"",castrado:H.castrado||!1,data_nascimento:"",idade_aproximada:H.idade_meses||H.idade_aproximada||"",peso:H.peso||"",cor:H.cor||"",porte:H.porte||"",microchip:H.microchip||"",alergias:H.alergias||"",doencas_cronicas:H.doencas_cronicas||"",medicamentos_continuos:H.medicamentos_continuos||"",historico_clinico:H.historico_clinico||"",observacoes:H.observacoes||"",foto_url:H.foto_url||"",ativo:H.ativo!==void 0?H.ativo:!0})}catch(P){console.error("Erro ao carregar pet:",P),y("Erro ao carregar informa√ß√µes do pet")}finally{r(!1)}},R=P=>{const{name:H,value:B,type:N,checked:O}=P.target;S(z=>({...z,[H]:N==="checkbox"?O:B}))},J=P=>{h(P),l(!0)},te=()=>{l(!1),h(null)},L=P=>{C==="especie"?K().then(()=>{S(H=>({...H,especie:P.id.toString()}))}):C==="raca"&&_.especie&&re(_.especie).then(()=>{S(H=>({...H,raca:P.nome}))})},Z=()=>_.nome.trim()?_.especie?_.cliente_id?!0:(y("Cliente (tutor) √© obrigat√≥rio"),!1):(y("Esp√©cie √© obrigat√≥ria"),!1):(y("Nome do pet √© obrigat√≥rio"),!1),A=async P=>{var H,B;if(P.preventDefault(),y(""),m(""),!!Z())try{j(!0);const N=x.find(z=>z.id===parseInt(_.especie)),O={..._,especie:(N==null?void 0:N.nome)||_.especie,cliente_id:parseInt(_.cliente_id),peso:_.peso?parseFloat(_.peso):null,idade_aproximada:_.idade_aproximada?parseInt(_.idade_aproximada):null,data_nascimento:_.data_nascimento||null};if(d)await F.put(`/pets/${s}`,O),m("Pet atualizado com sucesso!"),setTimeout(()=>n(`/pets/${s}`),1500);else{const z=await F.post("/pets",O);m("Pet cadastrado com sucesso!"),setTimeout(()=>n(`/pets/${z.data.id}`),1500)}}catch(N){console.error("Erro ao salvar pet:",N),y(((B=(H=N.response)==null?void 0:H.data)==null?void 0:B.detail)||"Erro ao salvar pet")}finally{j(!1)}};return g?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando..."})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>n(d?`/pets/${s}`:"/pets"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(nt,{}),d?"Voltar para detalhes do pet":"Voltar para lista de pets"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Fa,{className:"text-blue-600",size:36}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:d?"Editar Pet":"Cadastrar Novo Pet"})]}),e.jsx("p",{className:"text-gray-600",children:d?"Atualize as informa√ß√µes do pet":"Preencha os dados do animal de estima√ß√£o"})]}),f&&e.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(_a,{}),f]}),c&&e.jsxs("div",{className:"mb-6 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(ws,{}),c]}),o&&e.jsxs("div",{className:"mb-6 bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(ws,{}),e.jsx("span",{children:"‚úÖ Tutor pr√©-selecionado automaticamente! Voc√™ pode alterar se necess√°rio."})]}),e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Dados B√°sicos"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cliente (Tutor) *"}),e.jsxs("select",{name:"cliente_id",value:_.cliente_id,onChange:R,required:!0,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none ${o?"border-blue-400 bg-blue-50":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione o tutor..."}),k.map(P=>e.jsxs("option",{value:P.id,children:[P.nome," ",P.cpf&&`- CPF: ${P.cpf}`]},P.id))]}),o&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"üéØ Tutor selecionado automaticamente"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Pet *"}),e.jsx("input",{type:"text",name:"nome",value:_.nome,onChange:R,required:!0,placeholder:"Ex: Rex, Miau, Tot√≥",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Esp√©cie *"}),e.jsxs("div",{className:"field-with-action",children:[e.jsxs("select",{name:"especie",value:_.especie,onChange:R,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Selecione..."}),x.map(P=>e.jsx("option",{value:P.id,children:P.nome},P.id))]}),e.jsxs("button",{type:"button",className:"btn-add-quick",onClick:()=>J("especie"),title:"Adicionar nova esp√©cie",children:[e.jsx(Qa,{})," Nova"]})]}),x.length===0&&e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"Nenhuma esp√©cie cadastrada. Cadastre em Cadastros ‚Üí Esp√©cies e Ra√ßas."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ra√ßa"}),e.jsxs("div",{className:"field-with-action",children:[e.jsxs("select",{name:"raca",value:_.raca,onChange:R,disabled:!_.especie,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:_.especie?"Selecione uma ra√ßa...":"Selecione uma esp√©cie primeiro"}),u.map(P=>e.jsx("option",{value:P.nome,children:P.nome},P.id))]}),e.jsxs("button",{type:"button",className:"btn-add-quick",onClick:()=>J("raca"),title:"Adicionar nova ra√ßa",disabled:!_.especie,children:[e.jsx(Qa,{})," Nova"]})]}),_.especie&&u.length===0&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["Nenhuma ra√ßa cadastrada para ",_.especie,". Cadastre em Cadastros ‚Üí Esp√©cies e Ra√ßas."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sexo"}),e.jsxs("select",{name:"sexo",value:_.sexo,onChange:R,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Macho",children:"Macho"}),e.jsx("option",{value:"F√™mea",children:"F√™mea"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",name:"castrado",id:"castrado",checked:_.castrado,onChange:R,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"castrado",className:"text-sm font-medium text-gray-700",children:"Pet castrado"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Caracter√≠sticas F√≠sicas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(li,{value:_.idade_aproximada,onChange:P=>S(H=>({...H,idade_aproximada:P,data_nascimento:""})),name:"idade_aproximada",label:"Idade do Pet",mostrarDataNascimento:!0,className:"col-span-2"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Peso (kg)"}),e.jsx("input",{type:"number",name:"peso",value:_.peso,onChange:R,step:"0.1",min:"0",placeholder:"Ex: 5.5",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Porte"}),e.jsxs("select",{name:"porte",value:_.porte,onChange:R,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Mini",children:"Mini"}),e.jsx("option",{value:"Pequeno",children:"Pequeno"}),e.jsx("option",{value:"M√©dio",children:"M√©dio"}),e.jsx("option",{value:"Grande",children:"Grande"}),e.jsx("option",{value:"Gigante",children:"Gigante"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor/Pelagem"}),e.jsx("input",{type:"text",name:"cor",value:_.cor,onChange:R,placeholder:"Ex: Preto, Branco, Caramelo",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Microchip"}),e.jsx("input",{type:"text",name:"microchip",value:_.microchip,onChange:R,placeholder:"N√∫mero do microchip",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none font-mono text-sm"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL da Foto"}),e.jsx("input",{type:"url",name:"foto_url",value:_.foto_url,onChange:R,placeholder:"https://exemplo.com/foto-do-pet.jpg",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Informa√ß√µes de Sa√∫de"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alergias"}),e.jsx("textarea",{name:"alergias",value:_.alergias,onChange:R,rows:"3",placeholder:"Descreva alergias conhecidas (alimentares, medicamentos, etc)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Doen√ßas Cr√¥nicas"}),e.jsx("textarea",{name:"doencas_cronicas",value:_.doencas_cronicas,onChange:R,rows:"3",placeholder:"Descreva doen√ßas cr√¥nicas diagnosticadas",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Medicamentos Cont√≠nuos"}),e.jsx("textarea",{name:"medicamentos_continuos",value:_.medicamentos_continuos,onChange:R,rows:"3",placeholder:"Liste medicamentos de uso cont√≠nuo com dosagem",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hist√≥rico Cl√≠nico"}),e.jsx("textarea",{name:"historico_clinico",value:_.historico_clinico,onChange:R,rows:"4",placeholder:"Descreva o hist√≥rico cl√≠nico do pet (cirurgias, tratamentos anteriores, etc)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Observa√ß√µes Adicionais"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observa√ß√µes Gerais"}),e.jsx("textarea",{name:"observacoes",value:_.observacoes,onChange:R,rows:"4",placeholder:"Informa√ß√µes adicionais, comportamento, prefer√™ncias, etc",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),d&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",name:"ativo",id:"ativo",checked:_.ativo,onChange:R,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"ativo",className:"text-sm font-medium text-gray-700",children:"Pet ativo no sistema"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{type:"submit",disabled:v,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Vs,{}),d?"Salvar Altera√ß√µes":"Cadastrar Pet"]})}),e.jsx("button",{type:"button",onClick:()=>n(d?`/pets/${s}`:"/pets"),disabled:v,className:"px-6 py-3 border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors font-medium disabled:opacity-50",children:"Cancelar"})]})]}),p&&e.jsx(ii,{tipo:C,especieId:C==="raca"?parseInt(_.especie):null,especieNome:C==="raca"?(E=x.find(P=>P.id===parseInt(_.especie)))==null?void 0:E.nome:null,onSuccess:L,onClose:te})]})},ko=async(s={})=>(await F.get("/vendas",{params:s})).data,Gt=async s=>(await F.get(`/vendas/${s}`)).data,un=async s=>(await F.post("/vendas",s)).data,di=async(s,n)=>(await F.post(`/vendas/${s}/finalizar`,{pagamentos:n})).data,ci=async(s={})=>{const n=await F.get("/clientes/",{params:s});return n.data.items||n.data.clientes||n.data||[]},ft=async s=>(await F.get(`/clientes/${s}`)).data,xi=({status:s,className:n=""})=>{if(!s)return null;const t={verde:{cor:"bg-green-500",borda:"border-green-500",texto:"text-green-700",fundo:"bg-green-50",icone:"‚úÖ",mensagem:"Margem Saud√°vel",descricao:"Venda em condi√ß√µes ideais"},amarelo:{cor:"bg-yellow-500",borda:"border-yellow-500",texto:"text-yellow-700",fundo:"bg-yellow-50",icone:"‚ö†Ô∏è",mensagem:"Margem em Alerta",descricao:"Aten√ß√£o com parcelamento e descontos"},vermelho:{cor:"bg-red-500",borda:"border-red-500",texto:"text-red-700",fundo:"bg-red-50",icone:"üî¥",mensagem:"Margem Cr√≠tica",descricao:"Evite mais descontos ou parcelamentos longos"}},d=t[s]||t.verde;return e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg border ${d.borda} ${d.fundo} ${n}`,children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${d.cor} animate-pulse`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`text-sm font-semibold ${d.texto}`,children:[d.icone," ",d.mensagem]}),e.jsx("div",{className:"text-xs text-gray-600",children:d.descricao})]})]})},mi=["Visa","Mastercard","Elo","American Express","Hipercard","Outros"];function ui({venda:s,onClose:n,onConfirmar:t,onVendaAtualizada:d,onAnalisarVenda:o}){var la;const[g,r]=a.useState([]),[v,j]=a.useState([]),[f,y]=a.useState([]),[c,m]=a.useState([]),[k,w]=a.useState(null),[x,b]=a.useState(null),[u,i]=a.useState(""),[p,l]=a.useState(""),[C,h]=a.useState(1),[_,S]=a.useState(""),[$,K]=a.useState(!1),[re,M]=a.useState(!1),[R,J]=a.useState(""),[te,L]=a.useState(0),[Z,A]=a.useState(!1),[G,E]=a.useState(null),[P,H]=a.useState(null),[B,N]=a.useState(!1),[O,z]=a.useState(""),[ae,W]=a.useState(""),[ie,ee]=a.useState({}),[Q,de]=a.useState(!1),[me,Pe]=a.useState(null),se=a.useRef(null);a.useEffect(()=>{(async()=>{try{const ye=await F.get("/financeiro/formas-pagamento");y(ye.data)}catch(ye){console.error("Erro ao carregar formas:",ye)}})()},[]),a.useEffect(()=>{(async()=>{try{const ye=await F.get("/operadoras-cartao?apenas_ativas=true");m(ye.data);const Ce=ye.data.find(Be=>Be.padrao);Ce&&w(Ce)}catch(ye){console.error("Erro ao carregar operadoras:",ye)}})()},[]),a.useEffect(()=>{(async()=>{var ye;if(s.id){M(!0);try{const Ce=await F.get(`/vendas/${s.id}/pagamentos`);j(Ce.data.pagamentos||[]),L(Ce.data.total_pago||0)}catch(Ce){console.error("Erro ao buscar pagamentos:",Ce),((ye=Ce.response)==null?void 0:ye.status)!==404&&J("Erro ao carregar pagamentos existentes")}finally{M(!1)}}})()},[s.id,s.status]),a.useEffect(()=>{x!=null&&x.permite_parcelamento&&se.current&&setTimeout(()=>{var oe;(oe=se.current)==null||oe.scrollIntoView({behavior:"smooth",block:"nearest"})},100)},[x==null?void 0:x.permite_parcelamento]);const _e=s.total,ke=g.reduce((oe,ye)=>oe+ye.valor,0)+te,Ye=_e-ke,ze=_?parseFloat(_)-Ye:0,Qe=async()=>{var oe,ye,Ce;N(!0);try{const Be=[{forma_pagamento_id:1,valor:s.total,parcelas:1}],Ie=(s.itens||[]).map(je=>({produto_id:je.produto_id,quantidade:je.quantidade,preco_venda:je.preco_unitario||je.preco_venda||0,custo:je.custo||null})),Y=await F.post("/formas-pagamento/analisar-venda",{items:Ie,formas_pagamento:Be,desconto:s.desconto_valor||0,taxa_entrega:((oe=s.entrega)==null?void 0:oe.taxa_entrega_total)||0});(Ce=(ye=Y.data)==null?void 0:ye.resultado)!=null&&Ce.cor_indicador&&(H(Y.data.resultado.cor_indicador),console.log("‚úÖ Status inicial calculado:",Y.data.resultado.cor_indicador))}catch(Be){console.error("‚ùå Erro ao calcular status inicial:",Be),H(null)}finally{N(!1)}},be=async()=>{var oe,ye,Ce;if(!(g.length===0&&v.length===0)){N(!0);try{const Be=[...v,...g],Ie=(s.itens||[]).map(je=>({produto_id:je.produto_id,quantidade:je.quantidade,preco_venda:je.preco_unitario||je.preco_venda||0,custo:je.custo||null})),Y=await F.post("/formas-pagamento/analisar-venda",{items:Ie,formas_pagamento:Be,desconto:s.desconto_valor||0,taxa_entrega:((oe=s.entrega)==null?void 0:oe.taxa_entrega_total)||0});(Ce=(ye=Y.data)==null?void 0:ye.resultado)!=null&&Ce.cor_indicador&&H(Y.data.resultado.cor_indicador)}catch(Be){console.error("Erro ao calcular status de margem:",Be),H(null)}finally{N(!1)}}};a.useEffect(()=>{const oe=setTimeout(()=>{be()},500);return()=>clearTimeout(oe)},[g,C]),a.useEffect(()=>{console.log("üé¨ Modal de pagamento aberto - Calculando status inicial..."),Qe()},[]),a.useEffect(()=>{if(f&&f.length>0){const oe=f.filter(ye=>ye.permite_parcelamento);oe.length>0&&Object.keys(ie).length===0&&(console.log("üìä Simulando parcelamentos ao carregar formas..."),Ee(oe[0]))}},[f]);const Ee=async oe=>{var Be,Ie,Y;if(!oe||!oe.permite_parcelamento){console.log("‚è≠Ô∏è Forma de pagamento inv√°lida ou n√£o permite parcelamento");return}const ye=(oe==null?void 0:oe.parcelas_maximas)??12,Ce=oe.id;console.log(`üé≤ Simulando parcelamentos para ${oe.nome} (at√© ${ye}x)...`),de(!0);try{const je={},Me=(s.itens||[]).map(X=>({produto_id:X.produto_id,quantidade:X.quantidade,preco_venda:X.preco_unitario||X.preco_venda||0,custo:X.custo||null}));for(let X=1;X<=ye;X++){const fe=[{forma_pagamento_id:Ce,valor:s.total,parcelas:X}];try{const U=await F.post("/formas-pagamento/analisar-venda",{items:Me,formas_pagamento:fe,desconto:s.desconto_valor||0,taxa_entrega:((Be=s.entrega)==null?void 0:Be.taxa_entrega_total)||0});(Y=(Ie=U.data)==null?void 0:Ie.resultado)!=null&&Y.cor_indicador&&(je[X]={cor:U.data.resultado.cor_indicador,classificacao:U.data.resultado.cor_indicador})}catch(U){console.error(`Erro ao simular ${X}x:`,U),je[X]={cor:null,classificacao:"verde"}}}ee(X=>({...X,[Ce]:je}));const T=he(je,ye);Pe(T),console.log("‚úÖ Simula√ß√µes conclu√≠das:",je),console.log("üìä Faixas calculadas:",T)}catch(je){console.error("‚ùå Erro ao simular parcelamentos:",je)}finally{de(!1)}},he=(oe,ye)=>{const Ce={saudavel:{min:1,max:0},alerta:{min:0,max:0},proibido:{min:0,max:ye}};let Be=0,Ie=ye+1;for(let Y=1;Y<=ye;Y++){const je=oe[Y];je&&(je.cor==="verde"?Be=Y:je.cor==="vermelho"&&Y<Ie&&(Ie=Y))}return Ce.saudavel.max=Be,Ce.alerta.min=Be+1,Ce.alerta.max=Ie-1,Ce.proibido.min=Ie,Ce};a.useEffect(()=>{if(x!=null&&x.permite_parcelamento)if(!ie[x.id])Ee(x);else{const oe=ie[x.id],ye=he(oe,(x==null?void 0:x.parcelas_maximas)??12);Pe(ye),console.log("‚ôªÔ∏è Reutilizando simula√ß√£o existente")}else if(!x){const oe=Object.keys(ie)[0];if(oe&&f.length>0){const ye=f.find(Ce=>Ce.id===parseInt(oe));if(ye){const Ce=he(ie[oe],(ye==null?void 0:ye.parcelas_maximas)??12);Pe(Ce)}}}},[x==null?void 0:x.id]);const Xe=()=>{var Ie;if(!x){J("Selecione uma forma de pagamento");return}const oe=parseFloat(_)||0;if(oe<=0){J("Informe o valor recebido");return}if(x.id==="credito_cliente"&&oe>x.credito_disponivel){J(`Valor excede o cr√©dito dispon√≠vel (R$ ${x.credito_disponivel.toFixed(2)})`);return}if(["cartao_credito","cartao_debito"].includes(x.tipo)&&!u){J("Selecione a bandeira do cart√£o");return}if(["cartao_credito","cartao_debito"].includes(x.tipo)&&!k){J("Selecione a operadora do cart√£o");return}if(k&&C>k.max_parcelas){J(`A operadora ${k.nome} permite no m√°ximo ${k.max_parcelas}x`);return}console.log("üîç DEBUG formaPagamentoSelecionada:",x);const ye={forma_pagamento:x.nome,forma_id:x.id,forma_pagamento_id:x.id,nome:x.nome,valor:Math.min(oe,Ye),bandeira:["cartao_credito","cartao_debito"].includes(x.tipo)?u:null,nsu_cartao:["cartao_credito","cartao_debito"].includes(x.tipo)&&p?p:null,operadora_id:(k==null?void 0:k.id)||null,numero_parcelas:x.permite_parcelamento?C:1,parcelas:x.permite_parcelamento?C:1,valor_recebido:oe,troco:x.tipo==="dinheiro"&&ze>0?ze:null,is_credito_cliente:x.nome==="Cr√©dito Cliente"||x.tipo==="credito_cliente"};console.log("üì§ DEBUG novoPagamento:",ye);let Ce="verde";if(x!=null&&x.permite_parcelamento&&ie[x.id]){const Y=(Ie=ie[x.id])==null?void 0:Ie[C];Ce=(Y==null?void 0:Y.cor)??"verde",console.log(`‚ôªÔ∏è Reutilizando simula√ß√£o do backend: ${C}x = cor ${Ce}`)}if(P==="vermelho"||Ce==="vermelho"){if(!O||O.trim().length<10){W("‚ö†Ô∏è Justificativa obrigat√≥ria para margem cr√≠tica (m√≠nimo 10 caracteres)"),J("Por favor, preencha a justificativa abaixo");return}const Y=s.observacoes?`${s.observacoes}

‚ö†Ô∏è JUSTIFICATIVA (Margem Cr√≠tica): ${O}`:`‚ö†Ô∏è JUSTIFICATIVA (Margem Cr√≠tica): ${O}`;s.observacoes=Y}r([...g,ye]),b(null),S(""),i(""),w(c.find(Y=>Y.padrao)||null),l(""),h(1),J(""),W("")},Je=oe=>{r(g.filter((ye,Ce)=>Ce!==oe))},ca=async oe=>{var ye,Ce;if(confirm("Deseja realmente excluir este pagamento?")){K(!0),J("");try{console.log(`üóëÔ∏è Excluindo pagamento ID ${oe}...`),await F.delete(`/vendas/pagamentos/${oe}`),console.log("‚úÖ Pagamento exclu√≠do com sucesso!");const Be=await F.get(`/vendas/${s.id}/pagamentos`);j(Be.data.pagamentos||[]),L(Be.data.total_pago||0),Be.data.pagamentos.length===0&&d&&await d(),J("")}catch(Be){console.error("‚ùå Erro ao excluir pagamento:",Be),console.error("   Response:",Be.response),console.error("   Message:",Be.message),Be.message&&Be.message.includes("CORS")?J("‚ö†Ô∏è Erro de CORS: O backend precisa ser reiniciado. Feche e abra novamente o servidor backend."):J(((Ce=(ye=Be.response)==null?void 0:ye.data)==null?void 0:Ce.detail)||Be.message||"Erro ao excluir pagamento")}finally{K(!1)}}},ra=async()=>{var oe,ye,Ce,Be,Ie,Y,je,Me;if(g.length===0){J("Adicione pelo menos uma forma de pagamento");return}K(!0),J("");try{const T=s.itens.filter(U=>U.tipo==="produto"&&U.produto_id).map(U=>({produto_id:U.produto_id,quantidade:U.quantidade}));if(T.length>0){const le=(await Zl(T)).data||[];if(le.length>0){const Ne=le.map(q=>`‚Ä¢ ${q.produto_nome}: estoque atual ${q.estoque_atual}, ap√≥s venda ficar√° ${q.estoque_resultante}`).join(`
`);if(!window.confirm(`‚ö†Ô∏è ATEN√á√ÉO: Os seguintes produtos ficar√£o com ESTOQUE NEGATIVO:

${Ne}

Deseja continuar mesmo assim?`)){K(!1);return}}}let X=s.id;if(!X){const U=((oe=s.entrega)==null?void 0:oe.taxa_entrega_total)||0,le=((ye=s.entrega)==null?void 0:ye.taxa_loja)||0,Ne=((Ce=s.entrega)==null?void 0:Ce.taxa_entregador)||0,Re=U>0?(le/U*100).toFixed(2):100,q=U>0?(Ne/U*100).toFixed(2):0;X=(await un({cliente_id:(Be=s.cliente)==null?void 0:Be.id,funcionario_id:s.funcionario_id,itens:s.itens,desconto_valor:s.desconto_valor,desconto_percentual:s.desconto_percentual,observacoes:s.observacoes,tem_entrega:s.tem_entrega,taxa_entrega:U,percentual_taxa_loja:parseFloat(Re),percentual_taxa_entregador:parseFloat(q),entregador_id:s.entregador_id,endereco_entrega:(Ie=s.entrega)==null?void 0:Ie.endereco_completo,observacoes_entrega:(Y=s.entrega)==null?void 0:Y.observacoes_entrega})).id}const fe=await di(X,g);E(X),(fe==null?void 0:fe.status)==="finalizada"||(fe==null?void 0:fe.status)==="pago_nf"?A(!0):t()}catch(T){console.error("Erro ao finalizar venda:",T),J(((Me=(je=T.response)==null?void 0:je.data)==null?void 0:Me.detail)||"Erro ao finalizar venda")}finally{K(!1)}},pa=async oe=>{var ye,Ce;K(!0),J("");try{await F.post("/nfe/emitir",{venda_id:G,tipo_nota:oe}),alert(`${oe==="nfe"?"NF-e":"NFC-e"} emitida com sucesso!`),t()}catch(Be){console.error("Erro ao emitir nota:",Be),alert(((Ce=(ye=Be.response)==null?void 0:ye.data)==null?void 0:Ce.detail)||"Erro ao emitir nota fiscal. Voc√™ pode emiti-la depois na tela de vendas."),t()}finally{K(!1)}};return Z?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(ha,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Venda Finalizada!"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Deseja emitir nota fiscal?"})]})]}),e.jsxs("div",{className:"space-y-3",children:[(la=s.cliente)!=null&&la.cnpj?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>pa("nfe"),disabled:$,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(Xa,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NF-e (Empresa)"})]}),e.jsxs("button",{onClick:()=>pa("nfce"),disabled:$,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(Xa,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NFC-e (Cupom)"})]})]}):e.jsxs("button",{onClick:()=>pa("nfce"),disabled:$,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(Xa,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NFC-e"})]}),e.jsx("button",{onClick:t,disabled:$,className:"w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"N√£o emitir agora"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-4",children:"Voc√™ pode emitir a nota fiscal depois na tela de vendas"})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(lt,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Registrar Recebimento"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Selecione as formas de pagamento"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!1,e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ma,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Selecione a forma de pagamento"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.cliente&&s.cliente.credito>0&&e.jsxs("button",{onClick:()=>{b({id:"credito_cliente",nome:"Cr√©dito Cliente",tipo:"credito_cliente",icone:"üéÅ",credito_disponivel:parseFloat(s.cliente.credito)}),h(1),i(""),l(""),S(Math.min(parseFloat(s.cliente.credito),Ye).toFixed(2))},className:`p-4 rounded-lg border-2 transition-all ${(x==null?void 0:x.id)==="credito_cliente"?"border-purple-500 bg-purple-50":"border-purple-200 bg-purple-50/50 hover:border-purple-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:"üéÅ"}),e.jsx("div",{className:`text-sm font-medium ${(x==null?void 0:x.id)==="credito_cliente"?"text-purple-900":"text-purple-700"}`,children:"Cr√©dito Cliente"}),e.jsxs("div",{className:"text-xs text-purple-600 mt-1 font-semibold",children:["R$ ",parseFloat(s.cliente.credito).toFixed(2).replace(".",",")]})]}),f.map(oe=>{const ye=(x==null?void 0:x.id)===oe.id;return e.jsxs("button",{onClick:()=>{b(oe),h(1),i(""),l("")},className:`p-4 rounded-lg border-2 transition-all ${ye?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:oe.icone||"üí≥"}),e.jsx("div",{className:`text-sm font-medium ${ye?"text-blue-900":"text-gray-700"}`,children:oe.nome}),oe.taxa_percentual>0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Taxa: ",oe.taxa_percentual,"%"]})]},oe.id)})]})]}),x&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[x.id==="credito_cliente"&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-800 mb-2",children:[e.jsx(it,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"Cr√©dito Dispon√≠vel"})]}),e.jsxs("div",{className:"text-lg font-bold text-purple-600",children:["R$ ",x.credito_disponivel.toFixed(2).replace(".",",")]}),e.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"üí° N√£o gera movimenta√ß√£o de caixa"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:x.id==="credito_cliente"?"Valor a Utilizar":"Valor Recebido"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:_,onChange:oe=>{S(oe.target.value)},onBlur:oe=>{const ye=parseFloat(oe.target.value)||0;if(x.id==="credito_cliente"){const Ce=Math.min(x.credito_disponivel,Ye);ye>Ce&&(S(Ce.toFixed(2)),J(`Valor ajustado para o cr√©dito dispon√≠vel: R$ ${Ce.toFixed(2)}`),setTimeout(()=>J(""),3e3))}},placeholder:Ye.toFixed(2),max:x.id==="credito_cliente"?Math.min(x.credito_disponivel,Ye):void 0,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]}),x.id==="credito_cliente"&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["M√°ximo: R$ ",Math.min(x.credito_disponivel,Ye).toFixed(2)]})]}),x.tipo==="dinheiro"&&_&&e.jsx("div",{className:`rounded-lg p-3 ${ze>0?"bg-yellow-50 border border-yellow-200":"bg-gray-100"}`,children:e.jsx("div",{className:"text-sm font-medium",children:e.jsxs("span",{className:ze>0?"text-yellow-800":"text-gray-600",children:["Troco: R$ ",ze.toFixed(2)]})})}),(x==null?void 0:x.tipo)&&["cartao_credito","cartao_debito"].includes(x.tipo)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Operadora *"}),e.jsxs("select",{value:(k==null?void 0:k.id)||"",onChange:oe=>{const ye=c.find(Ce=>Ce.id===parseInt(oe.target.value));w(ye),ye&&C>ye.max_parcelas&&h(ye.max_parcelas)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione a operadora..."}),c.map(oe=>e.jsxs("option",{value:oe.id,children:[oe.nome," (",oe.max_parcelas,"x m√°x)"]},oe.id))]}),k&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["M√°ximo de ",k.max_parcelas," parcelas"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bandeira"}),e.jsxs("select",{value:u,onChange:oe=>i(oe.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),mi.map(oe=>e.jsx("option",{value:oe,children:oe},oe))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["NSU (N√∫mero Sequencial √önico)",e.jsx("span",{className:"text-gray-500 text-xs ml-1",children:"(Opcional - para concilia√ß√£o)"})]}),e.jsx("input",{type:"text",value:p,onChange:oe=>l(oe.target.value),placeholder:"Ex: 123456789",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),(x==null?void 0:x.permite_parcelamento)&&e.jsxs("div",{ref:se,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"N√∫mero de Parcelas"}),e.jsx("select",{value:C,onChange:oe=>h(parseInt(oe.target.value)),className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${(()=>{var Ce;const oe=(Ce=ie[x.id])==null?void 0:Ce[C],ye=(oe==null?void 0:oe.cor)||P||"verde";return ye==="verde"?"border-gray-300 bg-white":ye==="amarelo"?"border-yellow-400 bg-yellow-50 text-yellow-900":"border-red-400 bg-red-50 text-red-900"})()}`,children:Array.from({length:(k==null?void 0:k.max_parcelas)||x.parcelas_maximas||12},(oe,ye)=>ye+1).map(oe=>{var Y;const ye=parseFloat(_)||Ye,Ce=ye/oe,Be=(Y=ie[x.id])==null?void 0:Y[oe],Ie=(Be==null?void 0:Be.cor)||"verde";return e.jsxs("option",{value:oe,className:Ie==="verde"?"":Ie==="amarelo"?"bg-yellow-100 text-yellow-900":"bg-red-100 text-red-900",children:[Ie==="vermelho"?"üö´ ":Ie==="amarelo"?"‚ö†Ô∏è ":"",oe,"x de R$ ",Ce.toFixed(2)," ",_?`(Total: R$ ${ye.toFixed(2)})`:""]},oe)})}),_&&C>1&&e.jsxs("div",{className:`mt-2 p-3 border rounded-lg ${(()=>{var Ce;const oe=(Ce=ie[x.id])==null?void 0:Ce[C],ye=(oe==null?void 0:oe.cor)||P||"verde";return ye==="verde"?"bg-blue-50 border-blue-200":ye==="amarelo"?"bg-yellow-50 border-yellow-300":"bg-red-50 border-red-300"})()}`,children:[e.jsx("p",{className:`text-sm font-medium ${(()=>{var Ce;const oe=(Ce=ie[x.id])==null?void 0:Ce[C],ye=(oe==null?void 0:oe.cor)||P||"verde";return ye==="verde"?"text-blue-800":ye==="amarelo"?"text-yellow-800":"text-red-800"})()}`,children:(()=>{var Ce;const oe=(Ce=ie[x.id])==null?void 0:Ce[C],ye=(oe==null?void 0:oe.cor)||P||"verde";return e.jsxs(e.Fragment,{children:[ye==="vermelho"&&"üö´ ",ye==="amarelo"&&"‚ö†Ô∏è ","üí≥ ",C,"x de R$ ",(parseFloat(_)/C).toFixed(2)]})})()}),e.jsxs("p",{className:`text-xs mt-1 ${(()=>{var Ce;const oe=(Ce=ie[x.id])==null?void 0:Ce[C],ye=(oe==null?void 0:oe.cor)||P||"verde";return ye==="verde"?"text-blue-600":ye==="amarelo"?"text-yellow-700":"text-red-700"})()}`,children:["Valor total parcelado: R$ ",parseFloat(_).toFixed(2),(()=>{var Ce;const oe=(Ce=ie[x.id])==null?void 0:Ce[C],ye=(oe==null?void 0:oe.cor)||P||"verde";return ye==="amarelo"?" - Requer aten√ß√£o":ye==="vermelho"?" - Requer justificativa":""})()]})]})]}),e.jsx("button",{onClick:Xe,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Adicionar Pagamento"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Resumo da Venda"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total da Venda:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",_e.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Valor Pago:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",ke.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-blue-600 text-lg font-semibold border-t pt-3",children:[e.jsx("span",{children:"Restante:"}),e.jsxs("span",{children:["R$ ",Ye.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Formas de Pagamento"}),v.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-600 mb-2",children:["üí∞ Pagamentos Registrados (",v.length,")"]}),e.jsx("div",{className:"space-y-2",children:v.map((oe,ye)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:oe.forma_pagamento==="dinheiro"?"üíµ Dinheiro":oe.forma_pagamento==="pix"?"üì± PIX":oe.forma_pagamento==="credito"?"üí≥ Cart√£o de Cr√©dito":oe.forma_pagamento==="debito"?"üí≥ Cart√£o de D√©bito":oe.forma_pagamento==="boleto"?"üìÑ Boleto":oe.forma_pagamento}),e.jsxs("span",{className:"px-2 py-0.5 bg-green-200 text-green-800 text-xs rounded-full font-medium",children:["Pagamento ",ye+1]})]}),oe.bandeira&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Bandeira: ",oe.bandeira]}),oe.nsu_cartao&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1 font-mono",children:["üî¢ NSU: ",oe.nsu_cartao]}),oe.numero_parcelas&&oe.numero_parcelas>1&&e.jsxs("div",{className:"text-sm text-blue-600 mt-1 font-medium",children:["üî¢ Parcelado em ",oe.numero_parcelas,"x de R$ ",(parseFloat(oe.valor)/oe.numero_parcelas).toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["üìÖ ",new Date(oe.data_pagamento).toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-green-700 text-lg",children:["R$ ",parseFloat(oe.valor).toFixed(2)]}),oe.troco&&parseFloat(oe.troco)>0&&e.jsxs("div",{className:"text-xs text-yellow-600",children:["Troco: R$ ",parseFloat(oe.troco).toFixed(2)]})]}),e.jsx("button",{onClick:()=>ca(oe.id),disabled:$,className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors disabled:opacity-50",title:"Excluir pagamento",children:e.jsx(hs,{className:"w-4 h-4"})})]})]},oe.id))})]}),g.length===0&&v.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400 bg-gray-50 rounded-lg border-2 border-dashed",children:[e.jsx(it,{className:"w-12 h-12 mx-auto mb-2 opacity-40"}),e.jsx("p",{className:"text-sm font-medium",children:"Nenhuma forma de pagamento adicionada"}),e.jsx("p",{className:"text-xs mt-1",children:"Selecione uma forma acima para come√ßar"})]}):g.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 mb-2",children:"‚è≥ Novos Pagamentos (a confirmar)"}),e.jsx("div",{className:"space-y-3",children:g.map((oe,ye)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:oe.nome}),e.jsx("span",{className:"px-2 py-0.5 bg-blue-200 text-blue-800 text-xs rounded-full font-medium",children:"Novo"})]}),oe.bandeira&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Bandeira: ",oe.bandeira]}),oe.nsu_cartao&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1 font-mono",children:["üî¢ NSU: ",oe.nsu_cartao]}),oe.numero_parcelas>1&&e.jsxs("div",{className:"text-sm text-blue-600 mt-1 font-medium",children:["üî¢ ",oe.numero_parcelas,"x de R$ ",(oe.valor/oe.numero_parcelas).toFixed(2)]}),oe.troco&&oe.troco>0&&e.jsxs("div",{className:"text-sm text-yellow-600 mt-1",children:["üíµ Troco: R$ ",oe.troco.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"font-semibold text-blue-700 text-lg",children:["R$ ",oe.valor.toFixed(2)]}),e.jsx("button",{onClick:()=>Je(ye),className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors",title:"Remover",children:e.jsx(ma,{className:"w-5 h-5"})})]})]},ye))})]}):null]}),P&&e.jsx(xi,{status:P,loading:B}),me&&Object.keys(ie).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center space-x-2",children:[e.jsx("span",{className:"text-xl",children:"üìä"}),e.jsx("span",{children:"Parcelamento Recomendado"})]}),Q?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin inline-block w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full"}),e.jsx("p",{className:"text-sm text-blue-700 mt-2",children:"Analisando op√ß√µes..."})]}):e.jsxs("div",{className:"space-y-2",children:[me.saudavel.max>0&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-green-100 border border-green-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"üü¢"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-green-900",children:[me.saudavel.min===me.saudavel.max?`${me.saudavel.max}x`:`${me.saudavel.min}x a ${me.saudavel.max}x`,e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- Saud√°vel"})]}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"Margem adequada, sem restri√ß√µes"})]})]}),me.alerta.max>=me.alerta.min&&me.alerta.min>0&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-yellow-100 border border-yellow-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"üü°"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-yellow-900",children:[me.alerta.min===me.alerta.max?`${me.alerta.max}x`:`${me.alerta.min}x a ${me.alerta.max}x`,e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- Aten√ß√£o"})]}),e.jsx("div",{className:"text-xs text-yellow-700 mt-1",children:"Margem pr√≥xima ao m√≠nimo, evite se poss√≠vel"})]})]}),me.proibido.min<=((x==null?void 0:x.parcelas_maximas)??12)&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-red-100 border border-red-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"üî¥"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-red-900",children:[me.proibido.min,"x ou mais",e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- Exige justificativa"})]}),e.jsx("div",{className:"text-xs text-red-700 mt-1",children:"Margem cr√≠tica, justificativa obrigat√≥ria"})]})]})]})]}),(()=>{var Be,Ie;let oe="verde";return x!=null&&x.permite_parcelamento&&((Be=ie[x.id])!=null&&Be[C])&&(oe=((Ie=ie[x.id][C])==null?void 0:Ie.cor)??"verde"),P==="vermelho"||oe==="vermelho"||O&&O.trim().length>0?e.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-3",children:[e.jsx(da,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-red-900",children:"‚ö†Ô∏è Justificativa Obrigat√≥ria"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Esta venda tem margem cr√≠tica. Informe o motivo para prosseguir."})]})]}),e.jsx("textarea",{value:O,onChange:Y=>{z(Y.target.value),Y.target.value.trim().length>=10&&W("")},placeholder:"Ex: Cliente especial, promo√ß√£o de lan√ßamento, acordo comercial...",className:`w-full px-3 py-2 border-2 rounded-lg focus:ring-2 focus:ring-red-500 resize-none ${ae?"border-red-500":"border-red-300"}`,rows:3}),ae&&e.jsx("p",{className:"text-xs text-red-700 font-medium mt-2",children:ae}),e.jsx("p",{className:"text-xs text-red-600 mt-2",children:"üí° M√≠nimo 10 caracteres"})]}):null})()]})]})}),e.jsxs("div",{className:"border-t p-6 bg-gray-50",children:[R&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(da,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:R})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:n,disabled:$,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:ra,disabled:$||g.length===0,className:"flex items-center space-x-2 px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:$?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ha,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"})]})})]})]})]})})}const pi=async s=>(await F.post("/caixas/abrir",s)).data,gi=async()=>(await F.get("/caixas/aberto")).data,hi=async(s={})=>(await F.get("/caixas",{params:s})).data,Ir=async(s,n)=>(await F.post(`/caixas/${s}/movimentacao`,n)).data,bi=async(s,n)=>(await F.post(`/caixas/${s}/fechar`,n)).data,fi=async s=>(await F.post(`/caixas/${s}/reabrir`)).data,pn=async s=>(await F.get(`/caixas/${s}/resumo`)).data;function ji({onClose:s,onSucesso:n}){const[t,d]=a.useState(""),[o,g]=a.useState(""),[r,v]=a.useState(""),[j,f]=a.useState({n2:0,n5:0,n10:0,n20:0,n50:0,n100:0,n200:0,moedas:0}),[y,c]=a.useState(!1),[m,k]=a.useState(!1),[w,x]=a.useState(""),b=()=>j.n200*200+j.n100*100+j.n50*50+j.n20*20+j.n10*10+j.n5*5+j.n2*2+parseFloat(j.moedas||0),u=()=>{const l=b();d(l.toFixed(2)),c(!1)},i=()=>{f({n2:0,n5:0,n10:0,n20:0,n50:0,n100:0,n200:0,moedas:0})},p=async()=>{var C,h;const l=parseFloat(t);if(!l||l<0){x("Informe um valor v√°lido para abertura");return}k(!0),x("");try{await pi({valor_abertura:l,conta_origem_nome:o||"Dinheiro em m√£os",observacoes_abertura:r}),n()}catch(_){console.error("Erro ao abrir caixa:",_),x(((h=(C=_.response)==null?void 0:C.data)==null?void 0:h.detail)||"Erro ao abrir caixa")}finally{k(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(za,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Abrir Caixa"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Informe o valor inicial do caixa"})]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ma,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor de Abertura *"}),e.jsxs("button",{type:"button",onClick:()=>c(!y),className:"flex items-center space-x-1 px-3 py-1.5 text-sm bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 rounded-lg transition-colors",children:[e.jsx(Rs,{className:"w-4 h-4"}),e.jsx("span",{children:"Auxiliar Contagem"})]})]}),y&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-xl p-5 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center",children:[e.jsx(Rs,{className:"w-5 h-5 mr-2 text-blue-600"}),"Auxiliar de Contagem"]}),e.jsx("button",{onClick:()=>c(!1),className:"p-1 hover:bg-blue-100 rounded-lg transition-colors",type:"button",children:e.jsx(ma,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-gray-200 hover:border-gray-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-gray-500 to-gray-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 2"}),e.jsx("input",{type:"number",min:"0",value:j.n2,onChange:l=>f({...j,n2:parseInt(l.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-gray-500 focus:ring-2 focus:ring-gray-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-gray-600",children:["R$ ",(j.n2*2).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-purple-200 hover:border-purple-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 5"}),e.jsx("input",{type:"number",min:"0",value:j.n5,onChange:l=>f({...j,n5:parseInt(l.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-purple-600",children:["R$ ",(j.n5*5).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-red-200 hover:border-red-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-red-500 to-red-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 10"}),e.jsx("input",{type:"number",min:"0",value:j.n10,onChange:l=>f({...j,n10:parseInt(l.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-red-500 focus:ring-2 focus:ring-red-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-red-600",children:["R$ ",(j.n10*10).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-yellow-200 hover:border-yellow-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-yellow-500 to-yellow-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 20"}),e.jsx("input",{type:"number",min:"0",value:j.n20,onChange:l=>f({...j,n20:parseInt(l.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-yellow-600",children:["R$ ",(j.n20*20).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-blue-200 hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 50"}),e.jsx("input",{type:"number",min:"0",value:j.n50,onChange:l=>f({...j,n50:parseInt(l.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:["R$ ",(j.n50*50).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-green-200 hover:border-green-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-green-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 100"}),e.jsx("input",{type:"number",min:"0",value:j.n100,onChange:l=>f({...j,n100:parseInt(l.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-green-500 focus:ring-2 focus:ring-green-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",(j.n100*100).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-orange-200 hover:border-orange-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 200"}),e.jsx("input",{type:"number",min:"0",value:j.n200,onChange:l=>f({...j,n200:parseInt(l.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["R$ ",(j.n200*200).toFixed(2)]})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t-2 border-blue-300",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-amber-200 hover:border-amber-400 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-amber-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"üí∞ Moedas"})}),e.jsxs("span",{className:"text-lg font-bold text-amber-600",children:["R$ ",parseFloat(j.moedas||0).toFixed(2)]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:j.moedas,onChange:l=>f({...j,moedas:parseFloat(l.target.value)||0}),className:"w-full px-4 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200",placeholder:"0.00"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl p-4 mb-4 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-semibold text-sm",children:"TOTAL CONTADO"}),e.jsxs("span",{className:"text-3xl font-bold text-white",children:["R$ ",b().toFixed(2)]})]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:i,className:"flex-1 px-4 py-3 border-2 border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-semibold transition-colors",children:"üóëÔ∏è Limpar"}),e.jsx("button",{type:"button",onClick:u,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg font-semibold shadow-md transition-colors",children:"‚úì Aplicar"})]})]}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:t,onChange:l=>d(l.target.value),placeholder:"0,00",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-lg font-semibold",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conta de Origem"}),e.jsxs("select",{value:o,onChange:l=>g(l.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Dinheiro em m√£os",children:"Dinheiro em m√£os"}),e.jsx("option",{value:"Caixa geral",children:"Caixa geral"}),e.jsx("option",{value:"Banco",children:"Banco"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes (opcional)"}),e.jsx("textarea",{value:r,onChange:l=>v(l.target.value),rows:3,placeholder:"Ex: Troco do dia anterior...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"border-t p-6 bg-gray-50",children:[w&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(da,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:w})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:s,disabled:m,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:p,disabled:m||!t,className:"px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Abrindo...":"Abrir Caixa"})]})]})]})})}function vi({caixaId:s,onClose:n,onSucesso:t}){const[d,o]=a.useState(""),[g,r]=a.useState(""),[v,j]=a.useState(""),[f,y]=a.useState(!1),[c,m]=a.useState(""),k=async()=>{var x,b;const w=parseFloat(d);if(!w||w<=0){m("Informe um valor v√°lido");return}y(!0);try{await Ir(s,{tipo:"suprimento",valor:w,forma_pagamento:"Dinheiro",conta_origem_nome:g||"N√£o informado",descricao:v}),t()}catch(u){m(((b=(x=u.response)==null?void 0:x.data)==null?void 0:b.detail)||"Erro ao adicionar suprimento")}finally{y(!1)}};return e.jsx(Tr,{titulo:"Suprimento para o caixa",icone:Ma,corIcone:"green",onClose:n,erro:c,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conta de origem*"}),e.jsxs("select",{value:g,onChange:w=>r(w.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Dinheiro em m√£os",children:"Dinheiro em m√£os"}),e.jsx("option",{value:"Caixa geral",children:"Caixa geral"}),e.jsx("option",{value:"Banco",children:"Banco"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:d,onChange:w=>o(w.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descri√ß√£o*"}),e.jsx("textarea",{value:v,onChange:w=>j(w.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Motivo do suprimento..."})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:n,disabled:f,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:k,disabled:f,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors",children:f?"Salvando...":"Salvar"})]})]})})}function yi({caixaId:s,saldoAtual:n,onClose:t,onSucesso:d}){const[o,g]=a.useState(""),[r,v]=a.useState(""),[j,f]=a.useState(""),[y,c]=a.useState(!1),[m,k]=a.useState(""),w=async()=>{var b,u;const x=parseFloat(o);if(!x||x<=0){k("Informe um valor v√°lido");return}c(!0);try{await Ir(s,{tipo:"sangria",valor:x,forma_pagamento:"Dinheiro",conta_destino_nome:r||"N√£o informado",descricao:j}),d()}catch(i){k(((u=(b=i.response)==null?void 0:b.data)==null?void 0:u.detail)||"Erro ao adicionar sangria")}finally{c(!1)}};return e.jsx(Tr,{titulo:"Sangria no caixa",icone:Oa,corIcone:"orange",onClose:t,erro:m,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Em caixa:"})," R$ ",n.toFixed(2)]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor da Sangria*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:o,onChange:x=>g(x.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecione a conta de destino*"}),e.jsxs("select",{value:r,onChange:x=>v(x.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Cofre",children:"Cofre"}),e.jsx("option",{value:"Banco",children:"Banco"}),e.jsx("option",{value:"Outro caixa",children:"Outro caixa"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descri√ß√£o"}),e.jsx("textarea",{value:j,onChange:x=>f(x.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Motivo da sangria..."})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:t,disabled:y,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:w,disabled:y,className:"flex-1 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors",children:y?"Salvando...":"Salvar"})]})]})})}function Ni({caixaId:s,onClose:n,onSucesso:t}){const[d,o]=a.useState(""),[g,r]=a.useState(""),[v,j]=a.useState(""),[f,y]=a.useState("Dinheiro"),[c,m]=a.useState(""),[k,w]=a.useState(""),[x,b]=a.useState(!1),[u,i]=a.useState(""),p=["√Ågua e Luz","Aluguel","Telefone/Internet","Material de Limpeza","Material de Escrit√≥rio","Manuten√ß√£o","Outros"],l=async()=>{var h,_;const C=parseFloat(v);if(!C||C<=0){i("Informe um valor v√°lido");return}if(!d){i("Selecione uma categoria");return}b(!0);try{await Ir(s,{tipo:"despesa",valor:C,categoria:d,descricao:g,forma_pagamento:f,fornecedor_nome:c,documento:k}),t()}catch(S){i(((_=(h=S.response)==null?void 0:h.data)==null?void 0:_.detail)||"Erro ao adicionar despesa")}finally{b(!1)}};return e.jsx(Tr,{titulo:"Despesa no caixa",icone:et,corIcone:"red",onClose:n,erro:u,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categoria*"}),e.jsxs("select",{value:d,onChange:C=>o(C.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),p.map(C=>e.jsx("option",{value:C,children:C},C))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descri√ß√£o*"}),e.jsx("input",{type:"text",value:g,onChange:C=>r(C.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Ex: Conta de luz - Janeiro"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de pagamento*"}),e.jsxs("select",{value:f,onChange:C=>y(C.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Dinheiro",children:"Dinheiro"}),e.jsx("option",{value:"PIX",children:"PIX"}),e.jsx("option",{value:"Cart√£o de Cr√©dito",children:"Cart√£o de Cr√©dito"}),e.jsx("option",{value:"Cart√£o de D√©bito",children:"Cart√£o de D√©bito"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:v,onChange:C=>j(C.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fornecedor"}),e.jsx("input",{type:"text",value:c,onChange:C=>m(C.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Documento / NF"}),e.jsx("input",{type:"text",value:k,onChange:C=>w(C.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:n,disabled:x,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:l,disabled:x,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:x?"Salvando...":"Salvar"})]})]})})}function Tr({titulo:s,icone:n,corIcone:t,children:d,onClose:o,erro:g}){const r={green:"bg-green-100 text-green-600",orange:"bg-orange-100 text-orange-600",red:"bg-red-100 text-red-600",blue:"bg-blue-100 text-blue-600",purple:"bg-purple-100 text-purple-600"};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-12 h-12 ${r[t]} rounded-full flex items-center justify-center`,children:e.jsx(n,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s})]}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ma,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[g&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(da,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:g})]}),d]})]})})}function _i({caixaId:s,onClose:n,onSuccess:t}){const[d,o]=a.useState(null),[g,r]=a.useState(""),[v,j]=a.useState(""),[f,y]=a.useState(!0),[c,m]=a.useState(!1),[k,w]=a.useState(!1),[x,b]=a.useState({n100:0,n50:0,n20:0,n10:0,n5:0,n2:0,moedas:0});a.useEffect(()=>{u()},[s]);const u=async()=>{try{const S=await pn(s);console.log("üìä Resumo do caixa recebido:",S),console.log("üìä vendas_por_forma_pagamento:",S.vendas_por_forma_pagamento),o(S),r(S.totais.saldo_atual.toFixed(2))}catch(S){console.error("Erro ao carregar resumo:",S),alert("Erro ao carregar dados do caixa")}finally{y(!1)}},i=()=>!d||!g?0:parseFloat(g)-d.totais.saldo_atual,p=()=>x.n100*100+x.n50*50+x.n20*20+x.n10*10+x.n5*5+x.n2*2+parseFloat(x.moedas||0),l=()=>{const S=p();r(S.toFixed(2)),w(!1)},C=()=>{b({n100:0,n50:0,n20:0,n10:0,n5:0,n2:0,moedas:0})},h=async()=>{var $,K;if(!g){alert("Informe o valor contado no caixa");return}const S=i();if(!(Math.abs(S)>.01&&!window.confirm(`Diferen√ßa de R$ ${Math.abs(S).toFixed(2)} ${S>0?"a mais":"a menos"}

Deseja continuar com o fechamento?`))){m(!0);try{await bi(s,{valor_informado:parseFloat(g),observacoes_fechamento:v||null}),alert("Caixa fechado com sucesso!"),t(),n()}catch(re){console.error("Erro ao fechar caixa:",re),alert(((K=($=re.response)==null?void 0:$.data)==null?void 0:K.detail)||"Erro ao fechar caixa")}finally{m(!1)}}};if(f)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})});if(!d)return null;const _=i();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-red-600 to-orange-600 text-white p-6 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center",children:[e.jsx(et,{className:"w-7 h-7 mr-3"}),"Fechar Caixa"]}),e.jsxs("p",{className:"text-red-100 mt-1",children:["Caixa #",d.caixa.numero_caixa," - ",d.caixa.usuario_nome]})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(ma,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-6 border-2 border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center",children:[e.jsx(Rs,{className:"w-5 h-5 mr-2 text-gray-700"}),"Resumo do Movimento"]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Valor de Abertura"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",d.caixa.valor_abertura.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(d.caixa.data_abertura).toLocaleString("pt-BR")})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-green-700 mb-1",children:[e.jsx(et,{className:"w-4 h-4 mr-1"}),"Entradas"]}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["+ R$ ",d.totais.vendas.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Movimento de entrada"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-blue-700 mb-1",children:[e.jsx(Ma,{className:"w-4 h-4 mr-1"}),"Suprimentos"]}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["+ R$ ",d.totais.suprimentos.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-orange-700 mb-1",children:[e.jsx(Oa,{className:"w-4 h-4 mr-1"}),"Sangrias"]}),e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["- R$ ",d.totais.sangrias.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-red-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-red-700 mb-1",children:[e.jsx(za,{className:"w-4 h-4 mr-1"}),"Despesas"]}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["- R$ ",d.totais.despesas.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900",children:"Valor Contado no Caixa *"}),e.jsxs("button",{type:"button",onClick:()=>w(!k),className:"flex items-center space-x-1 px-3 py-1.5 text-sm bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors border border-blue-200",title:"Auxiliar na contagem de notas",children:[e.jsx(Rs,{className:"w-4 h-4"}),e.jsx("span",{children:"Auxiliar Contagem"})]})]}),k&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-xl p-5 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center",children:[e.jsx(Rs,{className:"w-5 h-5 mr-2 text-blue-600"}),"Auxiliar de Contagem"]}),e.jsx("button",{onClick:()=>w(!1),className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx(ma,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-gray-200 hover:border-gray-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-gray-500 to-gray-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 2"}),e.jsx("input",{type:"number",min:"0",value:x.n2,onChange:S=>b({...x,n2:parseInt(S.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-gray-500 focus:ring-2 focus:ring-gray-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-gray-600",children:["R$ ",(x.n2*2).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-purple-200 hover:border-purple-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 5"}),e.jsx("input",{type:"number",min:"0",value:x.n5,onChange:S=>b({...x,n5:parseInt(S.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-purple-600",children:["R$ ",(x.n5*5).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-red-200 hover:border-red-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-red-500 to-red-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 10"}),e.jsx("input",{type:"number",min:"0",value:x.n10,onChange:S=>b({...x,n10:parseInt(S.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-red-500 focus:ring-2 focus:ring-red-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-red-600",children:["R$ ",(x.n10*10).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-yellow-200 hover:border-yellow-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-yellow-500 to-yellow-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 20"}),e.jsx("input",{type:"number",min:"0",value:x.n20,onChange:S=>b({...x,n20:parseInt(S.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-yellow-600",children:["R$ ",(x.n20*20).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-blue-200 hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 50"}),e.jsx("input",{type:"number",min:"0",value:x.n50,onChange:S=>b({...x,n50:parseInt(S.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:["R$ ",(x.n50*50).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-green-200 hover:border-green-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-green-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 100"}),e.jsx("input",{type:"number",min:"0",value:x.n100,onChange:S=>b({...x,n100:parseInt(S.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-green-500 focus:ring-2 focus:ring-green-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",(x.n100*100).toFixed(2)]})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t-2 border-blue-300",children:e.jsx("div",{className:"bg-white rounded-lg p-4 border-2 border-amber-200 hover:border-amber-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-amber-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"üí∞ Moedas"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:x.moedas,onChange:S=>b({...x,moedas:parseFloat(S.target.value)||0}),className:"w-32 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200",placeholder:"0.00"})]}),e.jsxs("span",{className:"text-lg font-bold text-amber-600",children:["R$ ",(x.moedas||0).toFixed(2)]})]})})}),e.jsxs("div",{className:"mt-5 pt-5 border-t-2 border-blue-300",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl p-4 mb-4 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-semibold text-sm",children:"TOTAL CONTADO"}),e.jsxs("span",{className:"text-3xl font-bold text-white",children:["R$ ",p().toFixed(2)]})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:C,className:"flex-1 px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-semibold transition-colors",children:"üóëÔ∏è Limpar"}),e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 font-bold shadow-md transition-all",children:"‚úì Aplicar"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(za,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:g,onChange:S=>r(S.target.value),className:"w-full pl-10 pr-4 py-3 text-lg font-semibold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",autoFocus:!0})]}),g&&Math.abs(_)>.01&&e.jsx("div",{className:`mt-3 p-4 rounded-lg border-2 ${_>0?"bg-blue-50 border-blue-300":"bg-yellow-50 border-yellow-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-semibold text-gray-900",children:[_>0?"Sobra":"Falta",":"]}),e.jsxs("span",{className:`text-xl font-bold ${_>0?"text-blue-600":"text-yellow-700"}`,children:["R$ ",Math.abs(_).toFixed(2)]})]})}),g&&Math.abs(_)<=.01&&e.jsx("div",{className:"mt-3 p-4 rounded-lg border-2 bg-green-50 border-green-300",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-green-700 font-semibold",children:[e.jsx("span",{className:"text-2xl",children:"‚úì"}),e.jsx("span",{children:"Caixa conferido - Valores corretos!"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Observa√ß√µes (opcional)"}),e.jsx("textarea",{value:v,onChange:S=>j(S.target.value),placeholder:"Adicione observa√ß√µes sobre o fechamento...",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),d.vendas_por_forma_pagamento&&Object.keys(d.vendas_por_forma_pagamento).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center",children:[e.jsx(et,{className:"w-4 h-4 mr-1.5 text-blue-600"}),"Vendas por Forma de Pagamento (Informativo)"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(d.vendas_por_forma_pagamento).map(([S,$])=>{const K=S==="Dinheiro";return e.jsx("div",{className:`bg-white rounded-lg p-3 border ${K?"border-green-300 bg-green-50":"border-gray-200"} hover:shadow-sm transition-shadow cursor-pointer`,title:"Clique para ver detalhes das vendas",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${S==="Dinheiro"?"bg-green-500":S==="PIX"?"bg-purple-500":S.includes("D√©bito")?"bg-blue-500":S.includes("Cr√©dito")?"bg-orange-500":"bg-gray-400"}`}),e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:S}),K&&e.jsx("span",{className:"text-xs bg-green-600 text-white px-1.5 py-0.5 rounded",children:"CAIXA"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[$.quantidade," venda",$.quantidade!==1?"s":""]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:["R$ ",$.total.toFixed(2)]})})]})},S)})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200 text-xs text-gray-600",children:["üí° ",e.jsx("strong",{children:"Dica:"})," Apenas ",e.jsx("strong",{children:"Dinheiro"})," afeta o saldo f√≠sico do caixa. Demais formas v√£o para banco/financeiro."]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:n,disabled:c,className:"px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),e.jsx("button",{onClick:h,disabled:c||!g,className:"px-8 py-3 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white rounded-lg font-bold transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Fechando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-5 h-5"}),e.jsx("span",{children:"Fechar Caixa"})]})})]})]})]})})}function wi({caixaId:s,onClose:n,onSucesso:t}){var B;const[d,o]=a.useState(1),[g,r]=a.useState([]),[v,j]=a.useState(null),[f,y]=a.useState({}),[c,m]=a.useState({}),[k,w]=a.useState(""),[x,b]=a.useState(!1),[u,i]=a.useState(!1),[p,l]=a.useState(""),[C,h]=a.useState({}),[_,S]=a.useState({}),[$,K]=a.useState({}),[re,M]=a.useState({busca:"",data_inicio:"",data_fim:"",status:"finalizada"});a.useEffect(()=>{R()},[re]);const R=async()=>{i(!0),l("");try{const N={per_page:50,...re},O=await F.get("/vendas",{params:N});r(O.data.vendas||[])}catch(N){console.error("Erro ao buscar vendas:",N),l("Erro ao carregar vendas")}finally{i(!1)}},J=async N=>{var O,z;i(!0),l("");try{const ae=await F.get(`/vendas/${N.id}`);j(ae.data);const W={};ae.data.itens.forEach(ie=>{W[ie.id]=ie.quantidade}),m(W),o(2)}catch(ae){console.error("Erro ao buscar venda:",ae),l(((z=(O=ae.response)==null?void 0:O.data)==null?void 0:z.detail)||"Erro ao carregar detalhes da venda")}finally{i(!1)}},te=N=>{const O=f[N];y(z=>({...z,[N]:!z[N]})),O&&(h(z=>{const ae={...z};return delete ae[N],ae}),S(z=>{const ae={...z};return delete ae[N],ae}),K(z=>{const ae={...z};return delete ae[N],ae}))},L=(N,O)=>{const ae=v.itens.find(ie=>ie.id===N).quantidade,W=Math.min(Math.max(0,parseFloat(O)||0),ae);m(ie=>({...ie,[N]:W}))},Z=N=>N.tipo_produto==="KIT"&&N.composicao_kit&&N.composicao_kit.length>0,A=(N,O)=>{if(h(z=>({...z,[N]:O})),O==="componentes"){const z=v.itens.find(ae=>ae.id===N);if(z&&z.composicao_kit){const ae={},W={};z.composicao_kit.forEach((ie,ee)=>{ae[ee]=!1,W[ee]=ie.quantidade*z.quantidade}),S(ie=>({...ie,[N]:ae})),K(ie=>({...ie,[N]:W}))}}},G=(N,O)=>{S(z=>{var ae;return{...z,[N]:{...z[N]||{},[O]:!((ae=z[N])!=null&&ae[O])}}})},E=(N,O,z)=>{const ae=v.itens.find(Q=>Q.id===N),ie=ae.composicao_kit[O].quantidade*ae.quantidade,ee=Math.min(Math.max(0,parseFloat(z)||0),ie);K(Q=>({...Q,[N]:{...Q[N]||{},[O]:ee}}))},P=async()=>{var ae,W;if(Object.keys(f).filter(ie=>f[ie]).filter(ie=>{const ee=v.itens.find(Q=>Q.id===parseInt(ie));return Z(ee)&&!C[ie]}).length>0){l("Para itens KIT, voc√™ deve escolher entre devolver o KIT inteiro ou selecionar componentes");return}const O=[];if(Object.keys(f).filter(ie=>f[ie]).forEach(ie=>{const ee=parseInt(ie),Q=v.itens.find(de=>de.id===ee);if(Z(Q)){const de=C[ie];if(de==="kit_inteiro")O.push({item_id:ee,quantidade:c[ie]});else if(de==="componentes"){const me=_[ie]||{},Pe=$[ie]||{},se=Object.keys(me).filter(_e=>me[_e]).map(_e=>parseInt(_e));if(se.length===0){l(`Voc√™ deve selecionar pelo menos um componente do KIT "${Q.produto_nome}"`);return}se.forEach(_e=>{const ke=Q.composicao_kit[_e],Ye=Pe[_e]||0;if(Ye<=0){l(`Quantidade do componente "${ke.produto_nome}" deve ser maior que zero`);return}O.push({produto_id:ke.produto_id,quantidade:Ye,preco_unitario:Q.preco_unitario/Q.composicao_kit.reduce((ze,Qe)=>ze+Qe.quantidade,0)*ke.quantidade,is_componente_kit:!0,kit_item_id:ee})})}}else O.push({item_id:ee,quantidade:c[ie]})}),O.length===0){l("Selecione pelo menos um item para devolu√ß√£o");return}if(O.some(ie=>ie.quantidade<=0)){l("Todas as quantidades devem ser maiores que zero");return}if(!k.trim()){l("Informe o motivo da devolu√ß√£o");return}i(!0),l("");try{await F.post(`/vendas/${v.id}/devolucao`,{caixa_id:s,itens:O,motivo:k,gerar_credito:x}),alert("Devolu√ß√£o registrada com sucesso!"),t()}catch(ie){console.error("Erro ao registrar devolu√ß√£o:",ie),l(((W=(ae=ie.response)==null?void 0:ae.data)==null?void 0:W.detail)||"Erro ao registrar devolu√ß√£o")}finally{i(!1)}},H=()=>{if(!v)return 0;let N=0;return Object.keys(f).filter(O=>f[O]).forEach(O=>{const z=v.itens.find(ae=>ae.id===parseInt(O));if(Z(z)){const ae=C[O];if(ae==="kit_inteiro"){const W=c[O]||0;N+=z.preco_unitario*W}else if(ae==="componentes"){const W=_[O]||{},ie=$[O]||{},ee=z.composicao_kit.reduce((Q,de)=>Q+de.quantidade,0);Object.keys(W).filter(Q=>W[Q]).forEach(Q=>{const de=z.composicao_kit[Q],me=ie[Q]||0,Pe=z.preco_unitario/ee*de.quantidade,se=me/de.quantidade;N+=Pe*se})}}else{const ae=c[O]||0;N+=z.preco_unitario*ae}}),N};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(Wo,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Devolu√ß√£o"}),e.jsx("p",{className:"text-sm text-gray-500",children:d===1?"Selecione a venda":"Selecionar itens para devolu√ß√£o"})]})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ma,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[d===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar"}),e.jsx("input",{type:"text",value:re.busca,onChange:N=>M({...re,busca:N.target.value}),placeholder:"N√∫mero da venda, cliente...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data In√≠cio"}),e.jsx("input",{type:"date",value:re.data_inicio,onChange:N=>M({...re,data_inicio:N.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Fim"}),e.jsx("input",{type:"date",value:re.data_fim,onChange:N=>M({...re,data_fim:N.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})}),u?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando vendas..."})]}):g.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(da,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Nenhuma venda encontrada"})]}):e.jsx("div",{className:"space-y-2",children:g.map(N=>{var O;return e.jsx("button",{onClick:()=>J(N),className:"w-full text-left p-4 border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:["Venda #",N.numero_venda||N.id]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Cliente: ",((O=N.cliente)==null?void 0:O.nome)||"Consumidor Final"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:N.data_criacao?new Date(N.data_criacao).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Data n√£o dispon√≠vel"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold text-green-600",children:["R$ ",N.total.toFixed(2)]}),e.jsx("div",{className:`text-xs mt-1 px-2 py-1 rounded ${N.status==="finalizada"?"bg-green-100 text-green-800":N.status==="baixa_parcial"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:N.status==="finalizada"?"Finalizada":N.status==="baixa_parcial"?"Parcial":"Aberta"})]})]})},N.id)})}),p&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(da,{className:"w-5 h-5"}),e.jsx("span",{children:p})]})]}),d===2&&v&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-2",children:["Venda #",v.numero_venda||v.id]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{className:"ml-2 font-medium",children:v.data_criacao?new Date(v.data_criacao).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Data n√£o dispon√≠vel"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Cliente:"}),e.jsx("span",{className:"ml-2 font-medium",children:((B=v.cliente)==null?void 0:B.nome)||"Consumidor Final"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"ml-2 font-medium text-green-600",children:["R$ ",v.total.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Itens da Venda"}),e.jsx("div",{className:"space-y-2",children:v.itens.map(N=>{const O=Z(N),z=C[N.id];return e.jsx("div",{className:`border rounded-lg p-4 transition-colors ${f[N.id]?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("input",{type:"checkbox",checked:f[N.id]||!1,onChange:()=>te(N.id),className:"mt-1 w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:N.produto_nome}),O&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded",children:[e.jsx(Ko,{className:"w-3 h-3"}),"KIT"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Pre√ßo unit√°rio: R$ ",N.preco_unitario.toFixed(2)," | Qtd vendida: ",N.quantidade]}),f[N.id]&&O&&e.jsxs("div",{className:"mt-4 bg-white border-2 border-purple-300 rounded-lg p-4",children:[e.jsxs("div",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(Za,{className:"w-5 h-5 text-purple-600"}),"Como deseja devolver este KIT?"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:`modo-kit-${N.id}`,checked:z==="kit_inteiro",onChange:()=>A(N.id,"kit_inteiro"),className:"mt-1 w-4 h-4 text-blue-600 focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800 group-hover:text-blue-700 transition-colors",children:"üì¶ Devolver KIT Inteiro"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Devolve o KIT completo como uma unidade"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:`modo-kit-${N.id}`,checked:z==="componentes",onChange:()=>A(N.id,"componentes"),className:"mt-1 w-4 h-4 text-purple-600 focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800 group-hover:text-purple-700 transition-colors",children:"üß© Selecionar Componentes"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Escolha quais componentes do KIT devolver"})]})]})]})]}),f[N.id]&&!O&&e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantidade a devolver:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:N.quantidade,value:c[N.id],onChange:ae=>L(N.id,ae.target.value),className:"w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Subtotal: R$ ",(N.preco_unitario*(c[N.id]||0)).toFixed(2)]})]}),f[N.id]&&O&&z==="kit_inteiro"&&e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantidade de KITs a devolver:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:N.quantidade,value:c[N.id],onChange:ae=>L(N.id,ae.target.value),className:"w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Subtotal: R$ ",(N.preco_unitario*(c[N.id]||0)).toFixed(2)]})]}),f[N.id]&&O&&z==="componentes"&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-purple-50 to-blue-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold text-gray-800 mb-3",children:"Selecione os componentes a devolver:"}),e.jsx("div",{className:"space-y-3",children:N.composicao_kit.map((ae,W)=>{var Q,de;const ie=(Q=_[N.id])==null?void 0:Q[W],ee=ae.quantidade*N.quantidade;return e.jsx("div",{className:`border rounded-lg p-3 transition-colors ${ie?"border-purple-500 bg-white":"border-gray-200 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:ie||!1,onChange:()=>G(N.id,W),className:"mt-1 w-4 h-4 text-purple-600 rounded focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Za,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-800",children:ae.produto_nome})]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["Qtd no KIT: ",ae.quantidade," | Qtd total dispon√≠vel: ",ee]}),ie&&e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Quantidade:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:ee,value:((de=$[N.id])==null?void 0:de[W])||0,onChange:me=>E(N.id,W,me.target.value),className:"w-24 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500"})]})]})]})},W)})})]})]})]})},N.id)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Motivo da Devolu√ß√£o *"}),e.jsx("textarea",{value:k,onChange:N=>w(N.target.value),placeholder:"Descreva o motivo da devolu√ß√£o...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 border-2 border-purple-200 rounded-lg p-5",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-3",children:"üí≥ Tipo de Devolu√ß√£o"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",checked:!x,onChange:()=>b(!1),className:"mt-1 w-5 h-5 text-green-600 focus:ring-2 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800 group-hover:text-green-700 transition-colors",children:"üíµ Devolver em Dinheiro"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"O valor ser√° devolvido em dinheiro e registrado como sa√≠da de caixa"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",checked:x,onChange:()=>b(!0),className:"mt-1 w-5 h-5 text-purple-600 focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800 group-hover:text-purple-700 transition-colors",children:"üéÅ Gerar Cr√©dito para o Cliente"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"O valor ser√° convertido em cr√©dito para uso em futuras compras (sem movimenta√ß√£o de caixa)"})]})]})]}),x&&!(v!=null&&v.cliente_id)&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-300 rounded-lg",children:e.jsxs("p",{className:"text-xs text-yellow-800 flex items-center gap-2",children:[e.jsx(da,{className:"w-4 h-4"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Aten√ß√£o:"})," Esta venda n√£o possui cliente vinculado. Para gerar cr√©dito, √© necess√°rio ter um cliente cadastrado."]})]})})]}),e.jsx("div",{className:`border-2 rounded-lg p-4 ${x?"bg-purple-50 border-purple-300":"bg-orange-50 border-orange-200"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:x?"Cr√©dito a Gerar:":"Total da Devolu√ß√£o:"}),x&&(v==null?void 0:v.cliente)&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Cliente: ",e.jsx("strong",{children:v.cliente.nome})]})]}),e.jsxs("span",{className:`text-2xl font-bold ${x?"text-purple-600":"text-orange-600"}`,children:["R$ ",H().toFixed(2)]})]})}),p&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(da,{className:"w-5 h-5"}),e.jsx("span",{children:p})]})]})]}),e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:d===1?n:()=>{o(1),j(null),y({}),m({}),w(""),l("")},disabled:u,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:d===1?"Cancelar":"Voltar"}),d===2&&e.jsx("button",{onClick:P,disabled:u||Object.values(f).filter(Boolean).length===0,className:"flex items-center gap-2 px-8 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ho,{className:"w-5 h-5"}),e.jsx("span",{children:"Confirmar Devolu√ß√£o"})]})})]})})]})})}function Ci({caixaId:s,onClose:n}){const[t,d]=a.useState([]),[o,g]=a.useState(null),[r,v]=a.useState(!0);a.useEffect(()=>{j()},[s]);const j=async()=>{try{v(!0);const c=await F.get(`/caixas/${s}/movimentacoes`);d(c.data.movimentacoes),g(c.data.caixa)}catch(c){console.error("Erro ao carregar movimenta√ß√µes:",c),Se.error("Erro ao carregar movimenta√ß√µes do caixa")}finally{v(!1)}},f=c=>{const m=new Date(c);return new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}).format(m)},y=c=>({venda:"Venda",suprimento:"Suprimento",sangria:"Sangria",despesa:"Despesa",devolucao:"Devolu√ß√£o",transferencia:"Transfer√™ncia"})[c]||c;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-blue-50 to-purple-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:"üìã Extrato do Caixa"}),o&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Caixa #",o.id," - ",o.nome," | Status: ",o.status]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:j,className:"p-2 hover:bg-white rounded-lg transition-colors",title:"Atualizar",children:e.jsx($a,{className:`w-5 h-5 text-gray-600 ${r?"animate-spin":""}`})}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(ma,{className:"w-5 h-5 text-gray-600"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:r?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üì≠"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhuma movimenta√ß√£o registrada"})]}):e.jsx("div",{className:"space-y-3",children:t.map(c=>e.jsx("div",{className:`p-4 rounded-lg border-2 ${c.natureza==="entrada"?"bg-green-50 border-green-200":c.natureza==="saida"?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"text-3xl",children:c.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:y(c.tipo)}),c.forma_pagamento&&e.jsx("span",{className:"text-xs bg-white px-2 py-1 rounded border",children:c.forma_pagamento})]}),c.descricao&&e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:c.descricao}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-2 text-xs text-gray-600",children:[e.jsxs("span",{children:["üïê ",f(c.data_movimento)]}),e.jsxs("span",{children:["üë§ ",c.usuario_nome]}),c.venda_id&&e.jsxs("span",{children:["üßæ Venda #",c.venda_numero||c.venda_id]}),c.documento&&e.jsxs("span",{children:["üìÑ ",c.documento]})]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("div",{className:`text-2xl font-bold ${c.natureza==="entrada"?"text-green-600":c.natureza==="saida"?"text-red-600":"text-gray-600"}`,children:[c.natureza==="entrada"&&"+",c.natureza==="saida"&&"-","R$ ",c.valor.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:c.natureza==="entrada"?e.jsxs("span",{className:"flex items-center gap-1 justify-end",children:[e.jsx(Ma,{className:"w-3 h-3"})," Entrada"]}):c.natureza==="saida"?e.jsxs("span",{className:"flex items-center gap-1 justify-end",children:[e.jsx(Oa,{className:"w-3 h-3"})," Sa√≠da"]}):"Neutro"})]})]})},c.id))})}),e.jsx("div",{className:"border-t p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[t.length," movimenta√ß√£o(√µes) encontrada(s)"]}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Fechar"})]})})]})})}function ki({onAbrirCaixa:s}){var p,l,C;const[n,t]=a.useState(null),[d,o]=a.useState(null),[g,r]=a.useState(!1),[v,j]=a.useState(null),[f,y]=a.useState(!0),[c,m]=a.useState(!1),[k,w]=a.useState(!1);a.useEffect(()=>{b();const h=setInterval(b,3e4);return()=>clearInterval(h)},[]),a.useEffect(()=>{const h=()=>{m(!1)};if(c)return document.addEventListener("mouseup",h),()=>document.removeEventListener("mouseup",h)},[c]);const x=()=>{r(!1),w(!1),m(!1)},b=async()=>{try{const h=await gi();if(t(h),h){const _=await pn(h.id);o(_)}}catch(h){console.error("Erro ao carregar caixa:",h)}finally{y(!1)}},u=()=>{j(null),b()},i=async()=>{await s(),setTimeout(b,500)};return f?e.jsx("div",{className:"px-4 py-2 bg-gray-100 rounded-lg",children:e.jsx("div",{className:"animate-pulse h-10 bg-gray-200 rounded"})}):n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>r(!g),className:"flex items-center space-x-3 px-4 py-2 bg-white border-2 border-green-500 rounded-lg hover:bg-green-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["Caixa #",n.numero_caixa]})]}),e.jsx(Ls,{className:`w-5 h-5 text-gray-400 transition-transform ${g?"rotate-180":""}`})]}),g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:x}),e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 z-50",children:[e.jsxs("div",{className:"p-4 border-b bg-gradient-to-r from-green-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Caixa #",n.numero_caixa]}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:n.usuario_nome})]}),e.jsx("button",{onClick:x,className:"p-1 hover:bg-white rounded-lg transition-colors",children:e.jsx(ma,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(Os,{className:"w-4 h-4 mr-1"}),"Aberto em ",new Date(n.data_abertura).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Saldo Atual"}),e.jsx("div",{className:`text-sm font-bold ${c?"text-green-600":"text-gray-400"}`,children:c?`R$ ${((l=(p=d==null?void 0:d.totais)==null?void 0:p.saldo_atual)==null?void 0:l.toFixed(2))||"0,00"}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsx("button",{onMouseDown:()=>m(!0),className:"p-1 hover:bg-blue-100 rounded transition-colors",children:c?e.jsx(wt,{className:"w-4 h-4 text-blue-600"}):e.jsx(ar,{className:"w-4 h-4 text-gray-400"})})]})]})]}),d&&e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900",children:"Resumo do Movimento"}),e.jsx("button",{onClick:()=>w(!k),className:"p-1 hover:bg-gray-200 rounded transition-colors",children:k?e.jsx(wt,{className:"w-4 h-4 text-blue-600"}):e.jsx(ar,{className:"w-4 h-4 text-gray-400"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Abertura"}),e.jsx("div",{className:`font-semibold ${k?"text-gray-900":"text-gray-300"}`,children:k?`R$ ${n.valor_abertura.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Entradas"}),e.jsx("div",{className:`font-semibold ${k?"text-green-600":"text-green-300"}`,children:k?`+ R$ ${d.totais.vendas.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Suprimentos"}),e.jsx("div",{className:`font-semibold ${k?"text-green-600":"text-green-300"}`,children:k?`+ R$ ${d.totais.suprimentos.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Sangrias"}),e.jsx("div",{className:`font-semibold ${k?"text-orange-600":"text-orange-300"}`,children:k?`- R$ ${d.totais.sangrias.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Despesas"}),e.jsx("div",{className:`font-semibold ${k?"text-red-600":"text-red-300"}`,children:k?`- R$ ${d.totais.despesas.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]})]})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{onClick:()=>{j("suprimento"),r(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-green-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(Ma,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Suprimento"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Adicionar dinheiro ao caixa"})]})]}),e.jsxs("button",{onClick:()=>{j("sangria"),r(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-orange-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(Oa,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Sangria"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Retirar dinheiro do caixa"})]})]}),e.jsxs("button",{onClick:()=>{j("despesa"),r(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-red-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(et,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Despesa"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Registrar pagamento de despesa"})]})]}),e.jsxs("button",{onClick:()=>{j("devolucao"),r(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-purple-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(Wo,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Devolu√ß√£o"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Estornar venda e devolver ao estoque"})]})]}),e.jsxs("button",{onClick:()=>{j("movimentacoes"),r(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-blue-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(zn,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Extrato do Caixa"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Ver todas as movimenta√ß√µes"})]})]})]}),e.jsx("div",{className:"p-4 border-t",children:e.jsx("button",{onClick:()=>{j("fechar"),r(!1)},className:"w-full px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Fechar Caixa"})})]})]})]}),v==="suprimento"&&e.jsx(vi,{caixaId:n.id,onClose:()=>j(null),onSucesso:u}),v==="sangria"&&e.jsx(yi,{caixaId:n.id,saldoAtual:((C=d==null?void 0:d.totais)==null?void 0:C.saldo_atual)||0,onClose:()=>j(null),onSucesso:u}),v==="despesa"&&e.jsx(Ni,{caixaId:n.id,onClose:()=>j(null),onSucesso:u}),v==="fechar"&&e.jsx(_i,{caixaId:n.id,onClose:()=>j(null),onSuccess:()=>{j(null),b()}}),v==="devolucao"&&e.jsx(wi,{caixaId:n.id,onClose:()=>j(null),onSucesso:u}),v==="movimentacoes"&&e.jsx(Ci,{caixaId:n.id,onClose:()=>j(null)})]}):e.jsxs("button",{onClick:i,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(za,{className:"w-5 h-5"}),e.jsx("span",{children:"Abrir Caixa"})]})}function Si({venda:s,onClose:n}){var d,o;const t=()=>{window.print()};return s?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-800 text-white rounded-lg transition-colors print:hidden",children:[e.jsx(_r,{className:"w-5 h-5"}),e.jsx("span",{children:"Imprimir Cupom"})]}),e.jsx("style",{children:`
        @media print {
          /* Esconder tudo exceto o cupom */
          body * {
            visibility: hidden;
          }
          .cupom-impressao, .cupom-impressao * {
            visibility: visible;
          }
          .cupom-impressao {
            position: absolute;
            left: 0;
            top: 0;
            width: 80mm;
            margin: 0;
            padding: 0;
          }
          
          /* Reset de margens para impress√£o */
          @page {
            size: 80mm auto;
            margin: 5mm;
          }
        }
      `}),e.jsxs("div",{className:"cupom-impressao hidden print:block",style:{width:"80mm",fontFamily:"monospace"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"10px"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold"},children:"PET SHOP PRO"}),e.jsx("div",{style:{fontSize:"12px"},children:"Central de Gest\\u00e3o"}),e.jsx("div",{style:{fontSize:"10px",marginTop:"5px"},children:new Date().toLocaleString("pt-BR")})]}),e.jsxs("div",{style:{borderTop:"1px dashed #000",marginBottom:"10px",paddingTop:"10px"},children:[e.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"5px"},children:["VENDA #",s.numero_venda||s.id]}),e.jsxs("div",{style:{fontSize:"11px"},children:[e.jsxs("div",{children:["Data: ",s.data_venda?new Date(s.data_venda).toLocaleString("pt-BR"):new Date().toLocaleString("pt-BR")]}),s.cliente&&e.jsxs("div",{children:["Cliente: ",s.cliente.nome||s.cliente_nome]}),s.pet&&e.jsxs("div",{children:["Pet: ",s.pet.nome]})]})]}),e.jsx("div",{style:{borderTop:"1px dashed #000",marginBottom:"10px",paddingTop:"10px"},children:e.jsxs("table",{style:{width:"100%",fontSize:"10px",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid #000"},children:[e.jsx("th",{style:{textAlign:"left",paddingBottom:"5px"},children:"Item"}),e.jsx("th",{style:{textAlign:"center",paddingBottom:"5px"},children:"Qtd"}),e.jsx("th",{style:{textAlign:"right",paddingBottom:"5px"},children:"Valor"})]})}),e.jsx("tbody",{children:(d=s.itens)==null?void 0:d.map((g,r)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{paddingTop:"5px",paddingBottom:"5px"},children:[g.produto_nome,e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"9px",color:"#666"},children:[g.quantidade," x R$ ",g.preco_unitario.toFixed(2),g.desconto_valor>0&&e.jsxs("span",{style:{color:"#ff8c00"},children:[" ","com R$ ",g.desconto_valor.toFixed(2)," de desconto"]})]})]}),e.jsx("td",{style:{textAlign:"center",paddingTop:"5px",paddingBottom:"5px"},children:g.quantidade}),e.jsxs("td",{style:{textAlign:"right",paddingTop:"5px",paddingBottom:"5px"},children:["R$ ",g.subtotal.toFixed(2)]})]},r))})]})}),e.jsxs("div",{style:{borderTop:"1px dashed #000",paddingTop:"10px",fontSize:"11px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Total bruto:"}),e.jsxs("span",{children:["R$ ",(s.subtotal+s.desconto_valor).toFixed(2)]})]}),s.desconto_valor>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px",color:"#ff8c00"},children:[e.jsxs("span",{children:[(s.desconto_valor/(s.subtotal+s.desconto_valor)*100).toFixed(2),"% de desconto:"]}),e.jsxs("span",{children:["R$ ",s.desconto_valor.toFixed(2)]})]}),s.tem_entrega&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsxs("span",{children:["R$ ",(((o=s.entrega)==null?void 0:o.taxa_entrega_total)||0).toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",paddingTop:"10px",borderTop:"1px solid #000",fontSize:"14px",fontWeight:"bold"},children:[e.jsx("span",{children:"TOTAL:"}),e.jsxs("span",{children:["R$ ",s.total.toFixed(2)]})]})]}),s.pagamentos&&s.pagamentos.length>0&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"PAGAMENTOS:"}),s.pagamentos.map((g,r)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"3px"},children:[e.jsx("span",{children:g.forma_pagamento}),e.jsxs("span",{children:["R$ ",g.valor.toFixed(2)]})]},r))]}),s.tem_entrega&&s.entrega&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"ENTREGA:"}),e.jsx("div",{children:s.entrega.endereco_completo}),s.entrega.observacoes_entrega&&e.jsxs("div",{style:{marginTop:"3px",fontStyle:"italic"},children:["Obs: ",s.entrega.observacoes_entrega]})]}),s.observacoes&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"OBSERVA\\u00c7\\u00d5ES:"}),e.jsx("div",{children:s.observacoes})]}),e.jsxs("div",{style:{textAlign:"center",marginTop:"15px",paddingTop:"10px",borderTop:"1px dashed #000",fontSize:"10px"},children:[e.jsx("div",{children:"Obrigado pela preferencia!"}),e.jsx("div",{style:{marginTop:"5px"},children:"Volte sempre!"})]})]})]}):null}function Ei({clienteId:s,clienteNome:n,onClose:t,onSucesso:d}){const[o,g]=a.useState([]),[r,v]=a.useState([]),[j,f]=a.useState(!0),[y,c]=a.useState(!1),[m,k]=a.useState(""),[w,x]=a.useState("dinheiro"),[b,u]=a.useState(""),[i,p]=a.useState(""),[l,C]=a.useState({total_vendas:0,total_em_aberto:0}),[h,_]=a.useState("antiga");a.useEffect(()=>{S()},[s]);const S=async()=>{try{f(!0);const te=await F.get(`/clientes/${s}/vendas-em-aberto`);g(te.data.vendas||[]),C(te.data.resumo||{total_vendas:0,total_em_aberto:0})}catch(te){console.error("Erro ao carregar vendas em aberto:",te),ce.error("Erro ao carregar vendas em aberto")}finally{f(!1)}},$=te=>{v(L=>L.includes(te)?L.filter(Z=>Z!==te):[...L,te])},K=()=>{r.length===o.length?v([]):v(o.map(te=>te.id))},re=te=>{const L=new Date,Z=new Date(te),A=Math.abs(L-Z);return Math.ceil(A/(1e3*60*60*24))},M=[...o].sort((te,L)=>h==="antiga"?new Date(te.data_venda)-new Date(L.data_venda):new Date(L.data_venda)-new Date(te.data_venda)),R=o.filter(te=>r.includes(te.id)).reduce((te,L)=>te+parseFloat(L.saldo_devedor),0),J=async()=>{var te,L,Z,A;if(r.length===0){ce.error("Selecione ao menos uma venda");return}if(!m||parseFloat(m)<=0){ce.error("Informe um valor v√°lido");return}if(parseFloat(m)>R){ce.error("Valor do pagamento n√£o pode ser maior que o total selecionado");return}try{c(!0),console.log("Enviando requisi√ß√£o:",{vendas_ids:r,valor_total:parseFloat(m),forma_pagamento:w,numero_transacao:b||null,observacoes:i||null});const G=await F.post(`/clientes/${s}/baixar-vendas-lote`,{vendas_ids:r,valor_total:parseFloat(m),forma_pagamento:w,numero_transacao:b||null,observacoes:i||null});if(console.log("Resposta completa:",G),console.log("Response.data:",G.data),!G.data)throw new Error("Resposta vazia do servidor");const{vendas_quitadas:E,vendas_parciais:P,total_vendas_afetadas:H,valor_total_baixado:B}=G.data;let N=`üí∞ Total baixado: R$ ${B.toFixed(2)}
`;E.length>0&&(N+=`
‚úÖ ${E.length} venda(s) quitada(s):`,E.forEach(O=>{N+=`
  ‚Ä¢ ${O.numero_venda}: R$ ${O.valor_baixado.toFixed(2)}`})),P.length>0&&(N+=`

‚ö†Ô∏è ${P.length} venda(s) parcial:`,P.forEach(O=>{N+=`
  ‚Ä¢ ${O.numero_venda}:`,N+=`
    Baixado: R$ ${O.valor_baixado.toFixed(2)}`,N+=`
    Falta: R$ ${O.saldo_restante.toFixed(2)}`})),ce.success(N,{duration:6e3}),d&&d(),t()}catch(G){console.error("Erro completo:",G),console.error("Erro response:",G.response),console.error("Erro response data:",(te=G.response)==null?void 0:te.data),console.error("Erro response status:",(L=G.response)==null?void 0:L.status);const E=((A=(Z=G.response)==null?void 0:Z.data)==null?void 0:A.detail)||G.message||"Erro ao baixar vendas";ce.error(E)}finally{c(!1)}};return j?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-8 max-w-4xl w-full mx-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(dt,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando vendas..."})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-red-50 to-orange-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Vendas em Aberto"}),e.jsx("p",{className:"text-gray-600 mt-1",children:n})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(ma,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Vendas"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:l.total_vendas})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total em Aberto"}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["R$ ",l.total_em_aberto.toFixed(2)]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ha,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-medium text-gray-900",children:"Nenhuma venda em aberto!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Este cliente n√£o possui d√©bitos pendentes."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:K,className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:r.length===o.length?"Desmarcar todas":"Selecionar todas"}),e.jsxs("button",{onClick:()=>_(h==="antiga"?"recente":"antiga"),className:"text-sm text-gray-600 hover:text-gray-700 flex items-center gap-1 font-medium",children:["üìÖ ",h==="antiga"?"‚Üë Mais Antigas":"‚Üì Mais Recentes"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[r.length," de ",o.length," selecionada(s)"]})]}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden mb-6",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:e.jsx("input",{type:"checkbox",checked:r.length===o.length,onChange:K,className:"rounded border-gray-300"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Venda"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Pago"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Saldo Devedor"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Dias"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:M.map(te=>{const L=re(te.data_venda),Z=L>30;return e.jsxs("tr",{className:`hover:bg-gray-50 ${r.includes(te.id)?"bg-blue-50":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:r.includes(te.id),onChange:()=>$(te.id),className:"rounded border-gray-300"})}),e.jsxs("td",{className:"px-4 py-3 font-medium text-gray-900",children:["#",te.numero_venda]}),e.jsx("td",{className:"px-4 py-3 text-gray-600 text-sm",children:new Date(te.data_venda).toLocaleDateString("pt-BR")}),e.jsxs("td",{className:"px-4 py-3 text-right text-gray-900",children:["R$ ",parseFloat(te.total).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right text-green-600",children:["R$ ",parseFloat(te.total_pago).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-red-600",children:["R$ ",parseFloat(te.saldo_devedor).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${Z?"bg-red-100 text-red-800":L>15?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:[L," ",L===1?"dia":"dias"]})})]},te.id)})})]})}),r.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Registrar Pagamento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor Total Selecionado"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["R$ ",R.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor do Pagamento *"}),e.jsx("input",{type:"number",step:"0.01",value:m,onChange:te=>k(te.target.value),placeholder:"0.00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de Pagamento *"}),e.jsxs("select",{value:w,onChange:te=>x(te.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"dinheiro",children:"Dinheiro"}),e.jsx("option",{value:"pix",children:"PIX"}),e.jsx("option",{value:"debito",children:"Cart√£o de D√©bito"}),e.jsx("option",{value:"credito",children:"Cart√£o de Cr√©dito"}),e.jsx("option",{value:"transferencia",children:"Transfer√™ncia"})]})]}),(w==="pix"||w==="transferencia")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"N√∫mero da Transa√ß√£o"}),e.jsx("input",{type:"text",value:b,onChange:te=>u(te.target.value),placeholder:"C√≥digo/ID da transa√ß√£o",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes"}),e.jsx("textarea",{value:i,onChange:te=>p(te.target.value),rows:"2",placeholder:"Informa√ß√µes adicionais sobre o pagamento...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-start space-x-2 mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(da,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Aten√ß√£o:"})," O valor ser√° aplicado automaticamente da venda mais antiga para a mais recente. Se o valor for insuficiente para quitar todas as vendas selecionadas, a √∫ltima venda ficar√° parcialmente paga."]})]}),e.jsx("button",{onClick:J,disabled:y||!m||parseFloat(m)<=0,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:y?e.jsxs(e.Fragment,{children:[e.jsx(dt,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(za,{className:"w-5 h-5"}),e.jsx("span",{children:"Baixar Vendas Selecionadas"})]})})]})]})})]})})}function Fi({clienteId:s,clienteNome:n,onClose:t}){var m,k,w;const[d,o]=a.useState(null),[g,r]=a.useState(!0),[v,j]=a.useState("todos");a.useEffect(()=>{f()},[s]);const f=async()=>{try{r(!0);const x=await F.get(`/clientes/${s}/historico-compras`);o(x.data)}catch(x){console.error("Erro ao carregar hist√≥rico:",x),ce.error("Erro ao carregar hist√≥rico do cliente")}finally{r(!1)}},y=x=>{const b={finalizada:"bg-green-100 text-green-800",baixa_parcial:"bg-yellow-100 text-yellow-800",pendente:"bg-blue-100 text-blue-800",cancelada:"bg-red-100 text-red-800",finalizada_devolucao_parcial:"bg-orange-100 text-orange-800",finalizada_devolucao_total:"bg-gray-100 text-gray-800"},u={finalizada:"Finalizada",baixa_parcial:"Baixa Parcial",pendente:"Pendente",cancelada:"Cancelada",finalizada_devolucao_parcial:"Dev. Parcial",finalizada_devolucao_total:"Dev. Total"};return e.jsx("span",{className:`inline-flex px-2 py-1 rounded-full text-xs font-medium ${b[x]||"bg-gray-100 text-gray-800"}`,children:u[x]||x})},c=((m=d==null?void 0:d.vendas)==null?void 0:m.filter(x=>v==="todos"?!0:x.status===v))||[];return g?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-8 max-w-4xl w-full mx-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(dt,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando hist√≥rico..."})]})})}):d?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Hist√≥rico de Compras"}),e.jsx("p",{className:"text-gray-600 mt-1",children:n})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(ma,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(co,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Compras"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:d.total_compras})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(za,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Gasto"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",d.valor_total_gasto.toFixed(2)]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Ma,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Ticket M√©dio"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",d.ticket_medio.toFixed(2)]})]})]})})]}),d.ultima_compra&&e.jsxs("div",{className:"mt-4 bg-white rounded-lg p-3 shadow-sm flex items-center space-x-2 text-sm",children:[e.jsx(Cs,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-gray-600",children:["√öltima compra: ",new Date(d.ultima_compra).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"})]})]})]}),e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtrar por status:"}),e.jsxs("select",{value:v,onChange:x=>j(x.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500",children:[e.jsxs("option",{value:"todos",children:["Todos (",((k=d.vendas)==null?void 0:k.length)||0,")"]}),e.jsx("option",{value:"finalizada",children:"Finalizadas"}),e.jsx("option",{value:"baixa_parcial",children:"Baixa Parcial"}),e.jsx("option",{value:"pendente",children:"Pendentes"}),e.jsx("option",{value:"cancelada",children:"Canceladas"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(co,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:"Nenhuma venda encontrada"}),e.jsx("p",{className:"text-gray-600 mt-2",children:v==="todos"?"Este cliente ainda n√£o realizou compras.":"N√£o h√° vendas com este status."})]}):e.jsx("div",{className:"space-y-3",children:c.map(x=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Venda #",x.numero_venda]}),y(x.status)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Data:"}),e.jsx("div",{className:"font-medium text-gray-900",children:new Date(x.data_venda).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal:"}),e.jsxs("div",{className:"font-medium text-gray-900",children:["R$ ",x.subtotal.toFixed(2)]})]}),x.desconto_valor>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Desconto:"}),e.jsxs("div",{className:"font-medium text-red-600",children:["- R$ ",x.desconto_valor.toFixed(2)]})]}),x.taxa_entrega>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Taxa Entrega:"}),e.jsxs("div",{className:"font-medium text-gray-900",children:["R$ ",x.taxa_entrega.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total:"}),e.jsxs("div",{className:"font-bold text-gray-900 text-lg",children:["R$ ",x.total.toFixed(2)]})]}),x.saldo_devedor>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Saldo Devedor:"}),e.jsxs("div",{className:"font-bold text-red-600",children:["R$ ",x.saldo_devedor.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Itens:"}),e.jsx("div",{className:"font-medium text-gray-900",children:x.total_itens})]}),x.vendedor_nome&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Vendedor:"}),e.jsx("div",{className:"font-medium text-gray-900",children:x.vendedor_nome})]})]})]})})},x.id))})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[e.jsxs("span",{children:["Mostrando ",c.length," de ",((w=d.vendas)==null?void 0:w.length)||0," vendas"]}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:"Fechar"})]})})]})}):null}function $i({clienteId:s}){const[n,t]=a.useState(!1),[d,o]=a.useState(null),[g,r]=a.useState(null),[v,j]=a.useState(""),[f,y]=a.useState([]),[c,m]=a.useState(!1),k=a.useRef(null),[w,x]=a.useState({resumo:!1,pets:!1,compras:!1,oportunidades:!1,sugestoes:!1,relacionados:!1,sazonalidade:!1,chat:!1});a.useEffect(()=>{s&&b()},[s]);const b=async()=>{var M,R;try{t(!0),r(null);const J=await F.get(`/clientes/${s}/info-pdv`);o(J.data)}catch(J){console.error("Erro ao carregar informa√ß√µes do cliente:",J),r(((R=(M=J.response)==null?void 0:M.data)==null?void 0:R.detail)||"Erro ao carregar dados")}finally{t(!1)}},u=M=>{x(R=>({...R,[M]:!R[M]}))},i=async()=>{if(!v.trim())return;const M=v;j(""),y(R=>[...R,{tipo:"user",texto:M}]);try{m(!0);const R=await F.post(`/clientes/${s}/chat-pdv`,{mensagem:M});y(J=>[...J,{tipo:"ia",texto:R.data.resposta,ia_disponivel:R.data.ia_disponivel}]),setTimeout(()=>{var J;return(J=k.current)==null?void 0:J.scrollIntoView({behavior:"smooth"})},100)}catch(R){console.error("Erro no chat:",R),y(J=>[...J,{tipo:"erro",texto:"Erro ao processar mensagem. Tente novamente."}])}finally{m(!1)}},p=M=>{M.key==="Enter"&&!M.shiftKey&&(M.preventDefault(),i())};if(!s)return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 text-center text-gray-500",children:[e.jsx(ds,{className:"mx-auto text-4xl mb-2"}),e.jsx("p",{children:"Selecione um cliente para ver informa√ß√µes"})]});if(n)return e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})});if(g)return e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:[e.jsx(_a,{className:"inline mr-2"}),g]});if(!d)return null;const{cliente:l,resumo_financeiro:C,pets:h,ultimas_compras:_,oportunidades:S,sugestoes:$,produtos_relacionados:K,padroes_sazonais:re}=d;return e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden max-h-[85vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-100 to-purple-100 p-4 border-b",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 mb-1",children:l.nome}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[l.cpf_cnpj&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ds,{className:"text-xs"}),l.cpf_cnpj]}),l.telefone&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(Uo,{className:"text-xs"}),l.telefone]}),l.email&&e.jsxs("p",{className:"flex items-center gap-1 truncate",children:[e.jsx(Pr,{className:"text-xs"}),l.email]}),l.endereco&&e.jsxs("p",{className:"flex items-center gap-1 text-xs",children:[e.jsx(In,{className:"text-xs"}),l.endereco,", ",l.bairro," - ",l.cidade,"/",l.estado]})]})]})})}),e.jsxs(ys,{titulo:"Resumo Financeiro",icone:e.jsx(Ga,{}),expandido:w.resumo,onToggle:()=>u("resumo"),badge:C.numero_compras,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:"Total Gasto"}),e.jsxs("p",{className:"text-lg font-bold text-green-700",children:["R$ ",C.total_gasto.toFixed(2)]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"Ticket M√©dio"}),e.jsxs("p",{className:"text-lg font-bold text-blue-700",children:["R$ ",C.ticket_medio.toFixed(2)]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-purple-600 font-medium mb-1",children:"N¬∫ Compras"}),e.jsx("p",{className:"text-lg font-bold text-purple-700",children:C.numero_compras})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-orange-600 font-medium mb-1",children:"Maior Compra"}),e.jsxs("p",{className:"text-lg font-bold text-orange-700",children:["R$ ",C.maior_compra.valor.toFixed(2)]}),C.maior_compra.data&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:C.maior_compra.data})]})]}),C.ultima_compra.data&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(Is,{className:"text-xs"}),"√öltima compra: ",C.ultima_compra.data," - R$ ",C.ultima_compra.valor.toFixed(2)]})})]}),h&&h.length>0&&e.jsx(ys,{titulo:"Pets Registrados",icone:e.jsx(ds,{}),expandido:w.pets,onToggle:()=>u("pets"),badge:h.length,children:e.jsx("div",{className:"space-y-2",children:h.map(M=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold",children:M.nome[0].toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800",children:M.nome}),e.jsxs("p",{className:"text-xs text-gray-500",children:[M.especie," ",M.raca&&`‚Ä¢ ${M.raca}`,M.peso&&` ‚Ä¢ ${M.peso}kg`,M.idade_anos!==null&&` ‚Ä¢ ${M.idade_anos} anos`]})]})]},M.id))})}),S&&S.length>0&&e.jsx(ys,{titulo:"Oportunidades de Venda",icone:e.jsx(_a,{}),expandido:w.oportunidades,onToggle:()=>u("oportunidades"),badge:S.length,badgeColor:"bg-orange-500",children:e.jsx("div",{className:"space-y-2",children:S.map((M,R)=>e.jsxs("div",{className:`p-3 rounded-lg border-l-4 ${M.urgencia==="alta"?"bg-red-50 border-red-400":"bg-yellow-50 border-yellow-400"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:M.produto_nome}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:M.mensagem})]}),M.urgencia==="alta"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-red-500 text-white text-xs rounded-full",children:"Urgente"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Atrasado ",M.dias_atraso," dias"]})]},R))})}),$&&$.length>0&&e.jsx(ys,{titulo:"Produtos Favoritos",icone:e.jsx(Us,{}),expandido:w.sugestoes,onToggle:()=>u("sugestoes"),badge:$.length,children:e.jsx("div",{className:"space-y-2",children:$.map((M,R)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:M.nome}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Comprado ",M.vezes_comprado,"x",M.ultima_compra&&` ‚Ä¢ √öltima: ${M.ultima_compra}`]})]}),e.jsxs("p",{className:"font-bold text-indigo-600 ml-2",children:["R$ ",M.preco.toFixed(2)]})]},R))})}),_&&_.length>0&&e.jsx(ys,{titulo:"√öltimas Compras",icone:e.jsx(qs,{}),expandido:w.compras,onToggle:()=>u("compras"),badge:_.length,children:e.jsx("div",{className:"space-y-3",children:_.map((M,R)=>e.jsxs("div",{className:"border-l-4 border-indigo-300 pl-3 py-2 bg-gray-50 rounded-r-lg",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500",children:[M.data," ‚Ä¢ Venda #",M.numero_venda]}),e.jsxs("p",{className:"font-bold text-indigo-600",children:["R$ ",M.valor_total.toFixed(2)]})]})}),M.produtos&&M.produtos.length>0&&e.jsx("div",{className:"space-y-1 mt-2",children:M.produtos.map((J,te)=>e.jsxs("p",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx($t,{className:"text-xs"}),J.quantidade,"x ",J.nome," - R$ ",J.valor.toFixed(2)]},te))})]},R))})}),K&&K.length>0&&e.jsx(ys,{titulo:"Produtos Comprados Juntos",icone:e.jsx(Tn,{}),expandido:w.relacionados,onToggle:()=>u("relacionados"),badge:K.length,badgeColor:"bg-purple-500",children:e.jsx("div",{className:"space-y-2",children:K.map((M,R)=>e.jsxs("div",{className:"p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"text-xs font-semibold text-purple-600",children:[M.vezes_juntos,"x comprados juntos"]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-800",children:M.produto1.nome}),e.jsxs("span",{className:"text-purple-600 font-bold",children:["R$ ",M.produto1.preco.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-800",children:M.produto2.nome}),e.jsxs("span",{className:"text-purple-600 font-bold",children:["R$ ",M.produto2.preco.toFixed(2)]})]})]}),e.jsx("p",{className:"text-xs text-purple-600 mt-2 italic",children:"üí° Sugest√£o: Oferecer combo!"})]},R))})}),re&&re.length>0&&e.jsx(ys,{titulo:"Padr√µes de Compra",icone:e.jsx(Jt,{}),expandido:w.sazonalidade,onToggle:()=>u("sazonalidade"),badge:re.length,badgeColor:"bg-green-500",children:e.jsx("div",{className:"space-y-2",children:re.map((M,R)=>e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-green-700",children:M.mes_ano}),e.jsxs("span",{className:"text-sm text-green-600",children:[M.numero_compras," compras"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"font-bold text-green-700 ml-1",children:["R$ ",M.total_gasto.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Ticket m√©dio:"}),e.jsxs("span",{className:"font-bold text-green-700 ml-1",children:["R$ ",M.ticket_medio.toFixed(2)]})]})]})]},R))})}),e.jsx(ys,{titulo:"Chat IA - Assistente de Vendas",icone:e.jsx(Ns,{}),expandido:w.chat,onToggle:()=>u("chat"),badgeColor:"bg-blue-500",children:e.jsxs("div",{className:"space-y-3",children:[f.length===0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Perguntas sugeridas:"}),["Quais os produtos favoritos?","Quando foi a √∫ltima compra?","Quais pets ele tem?","Quanto j√° gastou total?"].map((M,R)=>e.jsx("button",{onClick:()=>{j(M),setTimeout(()=>i(),100)},className:"w-full text-left px-3 py-2 text-xs bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition-colors",children:M},R))]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto space-y-2",children:[f.map((M,R)=>e.jsx("div",{className:`flex ${M.tipo==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] px-3 py-2 rounded-lg text-sm ${M.tipo==="user"?"bg-blue-600 text-white":M.tipo==="erro"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-800"}`,children:[M.texto,M.tipo==="ia"&&!M.ia_disponivel&&e.jsx("p",{className:"text-xs mt-1 opacity-70",children:"üí° Modo b√°sico (IA n√£o configurada)"})]})},R)),e.jsx("div",{ref:k})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:v,onChange:M=>j(M.target.value),onKeyPress:p,placeholder:"Digite sua pergunta...",disabled:c,className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"}),e.jsx("button",{onClick:i,disabled:c||!v.trim(),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Vn,{className:"w-4 h-4"})})]})]})})]})}function ys({titulo:s,icone:n,expandido:t,onToggle:d,badge:o,badgeColor:g="bg-indigo-500",children:r}){return e.jsxs("div",{className:"border-b border-gray-200",children:[e.jsxs("button",{onClick:d,className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-indigo-600",children:n}),e.jsx("h4",{className:"font-semibold text-gray-800",children:s}),o!==void 0&&e.jsx("span",{className:`${g} text-white text-xs px-2 py-1 rounded-full`,children:o})]}),t?e.jsx(Go,{className:"text-gray-400"}):e.jsx(Ws,{className:"text-gray-400"})]}),t&&e.jsx("div",{className:"px-4 pb-4",children:r})]})}const Pi=({mostrar:s,onFechar:n,dados:t,carregando:d})=>{if(a.useEffect(()=>{const v=j=>{j.key==="Escape"&&s&&n()};if(s)return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[s,n]),!s)return null;const o=v=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(v||0),g=v=>{switch(v){case"verde":return"bg-green-100 border-green-500 text-green-800";case"amarelo":return"bg-yellow-100 border-yellow-500 text-yellow-800";case"vermelho":return"bg-red-100 border-red-500 text-red-800";default:return"bg-gray-100 border-gray-500 text-gray-800"}},r=v=>{switch(v){case"success":return e.jsx(ws,{className:"text-green-500"});case"error":return e.jsx(_a,{className:"text-red-500"});case"warning":return e.jsx(_a,{className:"text-yellow-500"});case"info":return e.jsx(Ts,{className:"text-blue-500"});default:return e.jsx(Ts,{className:"text-gray-500"})}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:n}),e.jsxs("div",{className:"fixed right-0 top-0 h-full w-96 bg-white shadow-2xl z-50 flex flex-col animate-slide-in-right",children:[e.jsxs("div",{className:"p-4 border-b bg-gradient-to-r from-blue-600 to-blue-700 text-white flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Jt,{className:"w-5 h-5"}),e.jsx("h3",{className:"text-lg font-bold",children:"An√°lise da Venda"})]}),e.jsx("button",{onClick:n,className:"hover:bg-white hover:bg-opacity-20 p-1 rounded transition-colors",children:e.jsx(ps,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:d?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ga,{className:"text-blue-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"Composi√ß√£o Financeira"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Total dos Produtos"}),e.jsx("span",{className:"font-semibold",children:o(t.composicao.total_produtos)})]}),t.composicao.desconto>0&&e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"(-) Descontos Aplicados"}),e.jsxs("span",{className:"font-semibold",children:[o(t.composicao.desconto),e.jsxs("span",{className:"text-xs ml-1",children:["(",(t.composicao.desconto/t.composicao.total_produtos*100).toFixed(1),"%)"]})]})]}),t.composicao.taxa_entrega>0&&e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"(-) Taxa de Entrega"}),e.jsx("span",{className:"font-semibold",children:o(t.composicao.taxa_entrega)})]}),e.jsx("div",{className:"border-t-2 border-blue-600 pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-blue-700",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:o(t.composicao.subtotal)})]})})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(cr,{className:"text-orange-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"Dedu√ß√µes"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[t.deducoes.comissao.valor>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Comiss√£o do Vendedor (",t.deducoes.comissao.percentual,"%)"]}),e.jsx("span",{className:"font-semibold text-red-600",children:o(t.deducoes.comissao.valor)})]}),t.detalhamento_taxas&&t.detalhamento_taxas.length>0&&e.jsx(e.Fragment,{children:t.detalhamento_taxas.map((v,j)=>e.jsxs(ts.Fragment,{children:[v.taxa_percentual>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-600",children:["Taxa ",v.forma," (",v.taxa_percentual,"%)"]}),e.jsx("span",{className:"text-xs text-gray-500",children:o(v.valor_pagamento)})]}),e.jsx("span",{className:"font-semibold text-red-600",children:o(v.valor_taxa_percentual)})]}),v.taxa_fixa>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-600",children:["Taxa Fixa ",v.forma]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["R$ ",v.taxa_fixa.toFixed(2)]})]}),e.jsx("span",{className:"font-semibold text-red-600",children:o(v.valor_taxa_fixa)})]})]},j))}),(!t.detalhamento_taxas||t.detalhamento_taxas.length===0)&&t.deducoes.taxa_percentual>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Taxa Percentual"}),e.jsx("span",{className:"font-semibold text-red-600",children:o(t.deducoes.taxa_percentual)})]}),(!t.detalhamento_taxas||t.detalhamento_taxas.length===0)&&t.deducoes.taxa_fixa>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Taxa Fixa"}),e.jsx("span",{className:"font-semibold text-red-600",children:o(t.deducoes.taxa_fixa)})]}),t.deducoes.impostos.valor>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Impostos Estimados (",t.deducoes.impostos.percentual,"%)"]}),e.jsx("span",{className:"font-semibold text-red-600",children:o(t.deducoes.impostos.valor)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Custo dos Produtos"}),e.jsx("span",{className:"font-semibold text-red-600",children:o(t.deducoes.custos)})]}),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-semibold text-gray-700",children:[e.jsx("span",{children:"Total de Dedu√ß√µes"}),e.jsx("span",{className:"text-red-600",children:o(t.deducoes.total_deducoes)})]})})]})]}),e.jsxs("div",{className:`rounded-lg p-4 border-2 ${g(t.resultado.cor_indicador)}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Jt,{className:"w-5 h-5"}),e.jsx("h4",{className:"font-bold",children:"Resultado Final"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold",children:"Lucro L√≠quido Estimado"}),e.jsx("span",{className:"text-2xl font-bold",children:o(t.resultado.lucro_liquido)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Margem L√≠quida"}),e.jsxs("span",{className:"text-xl font-bold",children:[t.resultado.margem_liquida.toFixed(2),"%"]})]})]})]}),t.alertas&&t.alertas.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(_a,{className:"text-purple-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"Alertas e Sugest√µes"})]}),e.jsx("div",{className:"space-y-2",children:t.alertas.map((v,j)=>e.jsxs("div",{className:`flex items-start gap-2 p-2 rounded text-sm ${v.tipo==="success"?"bg-green-50":v.tipo==="error"?"bg-red-50":v.tipo==="warning"?"bg-yellow-50":"bg-blue-50"}`,children:[e.jsx("span",{className:"flex-shrink-0 mt-0.5",children:r(v.tipo)}),e.jsxs("span",{className:"flex-1",children:[e.jsx("span",{className:"mr-1",children:v.icone}),v.mensagem]})]},j))})]}),t.detalhamento_comissoes&&t.detalhamento_comissoes.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-3",children:"Detalhamento de Comiss√µes"}),e.jsx("div",{className:"space-y-2 text-sm",children:t.detalhamento_comissoes.map((v,j)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-700",children:v.produto}),e.jsxs("div",{className:"text-xs text-gray-500",children:[v.percentual,"% de comiss√£o"]})]}),e.jsx("span",{className:"font-semibold text-blue-600",children:o(v.valor)})]},j))})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_a,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"Erro ao carregar an√°lise"})]})})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("button",{onClick:n,className:"w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Fechar"}),e.jsx("span",{className:"text-xs text-gray-300",children:"(ESC)"})]})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes slide-in-right {
          from {
            transform: translateX(100%);
          }
          to {
            transform: translateX(0);
          }
        }
        
        .animate-slide-in-right {
          animation: slide-in-right 0.3s ease-out;
        }
      `})]})};function Ri({itensCarrinho:s=[],onClose:n=()=>{},isOpen:t=!1,racaoIdFechada:d=null}){const[o,g]=a.useState(null),[r,v]=a.useState(!1),[j,f]=a.useState(null),[y,c]=a.useState(null),[m,k]=a.useState(!1),w=s.filter(u=>ln(u));a.useEffect(()=>{t&&(console.log("ü•´ Modal: Ra√ß√µes encontradas:",w.length),w.forEach((u,i)=>{console.log(`  ${i+1}. ${u.produto_nome} - peso_embalagem: ${u.peso_embalagem}`)}))},[t,w.length]),a.useEffect(()=>{if(t&&w.length>0){const u=w[w.length-1];d!==u.produto_id&&(g(u.produto_id),f(null),c(null),v(!1))}},[t,w.length,d]);const x=w.find(u=>u.produto_id===o),b=async()=>{if(!x){c("Ra√ß√£o n√£o selecionada");return}if(!(x.peso_embalagem||x.peso_pacote_kg)||!x.preco_unitario){console.error("‚ùå Modal: Dados da ra√ß√£o incompletos",{peso_embalagem:x.peso_embalagem,peso_pacote_kg:x.peso_pacote_kg,preco_unitario:x.preco_unitario}),c("Dados da ra√ß√£o incompletos");return}try{v(!0),c(null),f(null);const i=x.peso_embalagem||x.peso_pacote_kg||1,p={especie:"cao",peso_kg:15,fase:"adulto",porte:"medio",tipo_racao:"premium",peso_pacote_kg:parseFloat(i),preco_pacote:parseFloat(x.preco_unitario)||0};console.log("üßë Modal: Enviando payload:",p);const l=await F.post("/internal/racao/calcular",p);l.data?f(l.data):c("Sem resposta do servidor")}catch(i){console.error("Erro ao calcular:",i),c(null)}finally{v(!1)}};return!t||w.length===0?(t&&w.length===0&&console.warn("‚ö†Ô∏è Modal: isOpen=true mas racoes.length=0"),null):(console.log("‚úÖ Modal: Renderizando com",w.length,"ra√ß√µes"),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-4 flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ü•´"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Calculadora de Ra√ß√£o"}),e.jsx("p",{className:"text-sm text-blue-100",children:"Informa√ß√µes r√°pidas"})]})]}),e.jsx("button",{onClick:()=>{n()},className:"p-1 hover:bg-blue-400 rounded-lg transition-colors",title:"Fechar",children:e.jsx(ma,{size:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[w.length>1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Selecionar Ra√ß√£o"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>k(!m),className:"w-full px-4 py-2 bg-white border border-gray-300 rounded-lg text-left flex items-center justify-between hover:border-blue-500 transition-colors",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:(x==null?void 0:x.produto_nome)||"Selecione uma ra√ß√£o"}),e.jsx(Ls,{size:20,className:`text-gray-500 transition-transform ${m?"rotate-180":""}`})]}),m&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg z-10 max-h-48 overflow-y-auto",children:w.map((u,i)=>e.jsxs("button",{onClick:()=>{g(u.produto_id),k(!1),f(null)},className:`w-full px-4 py-3 text-left border-b last:border-b-0 hover:bg-blue-50 transition-colors ${u.produto_id===o?"bg-blue-100 border-l-4 border-l-blue-600":""}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:u.produto_nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:[u.peso_embalagem||u.peso_pacote_kg?`${u.peso_embalagem||u.peso_pacote_kg}kg`:""," ‚Ä¢ R$ ",(u.preco_unitario||0).toFixed(2)]})]},i))})]})]}),x&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 space-y-2",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:x.produto_nome}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Pacote:"}),e.jsx("span",{className:"font-medium",children:x.peso_pacote_kg?`${x.peso_pacote_kg}kg`:"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Pre√ßo:"}),e.jsxs("span",{className:"font-medium text-blue-600",children:["R$ ",(x.preco_unitario||0).toFixed(2)]})]})]})]}),e.jsx("button",{onClick:b,disabled:r||!x,className:`w-full py-3 rounded-lg font-semibold transition-colors ${r||!x?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white cursor-pointer"}`,children:r?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(jr,{size:18,className:"animate-spin"}),"Calculando..."]}):"üìä Calcular Consumo"}),j&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 space-y-3 border border-green-200",children:[e.jsx("h3",{className:"font-bold text-green-900 text-center",children:"‚úÖ C√°lculo Realizado"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Consumo Di√°rio"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:[(j.consumo_diario_gramas||0).toFixed(0),"g"]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Dura√ß√£o"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:[(j.duracao_pacote_dias||0).toFixed(1),"d"]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/Dia"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(j.custo_diario||0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/M√™s"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(j.custo_mensal||0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100 col-span-2",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/kg"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(j.custo_por_kg||0).toFixed(2)]})]})]})]}),y&&e.jsx("div",{className:"bg-yellow-50 rounded-lg p-3 text-sm text-yellow-700 border border-yellow-200",children:"‚ö†Ô∏è N√£o foi poss√≠vel calcular. Tente novamente."}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 text-xs text-gray-600 border border-gray-200 italic",children:"üí° Valores calculados com base em dados padr√£o. Para an√°lises personalizadas, utilize a calculadora completa."})]}),e.jsx("div",{className:"bg-gray-50 border-t px-6 py-3 flex justify-end gap-3 flex-shrink-0",children:e.jsx("button",{onClick:n,className:"px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-medium transition-colors",children:"Fechar"})})]})}))}function Ai({isOpen:s,onClose:n,clienteId:t,produtoId:d=null,onPendenciaAdicionada:o=()=>{}}){const[g,r]=a.useState("listar"),[v,j]=a.useState([]),[f,y]=a.useState([]),[c,m]=a.useState(!1),[k,w]=a.useState(""),[x,b]=a.useState([]),[u,i]=a.useState(!1),[p,l]=a.useState(null),C=a.useRef(null),[h,_]=a.useState({produto_id:d||"",quantidade_desejada:1,prioridade:"media",observacoes:""});a.useEffect(()=>{s&&t&&(S(),d||$())},[s,t]),a.useEffect(()=>{if(k.trim()==="")b(f);else{const A=f.filter(G=>{var E;return G.nome.toLowerCase().includes(k.toLowerCase())||((E=G.codigo)==null?void 0:E.toLowerCase().includes(k.toLowerCase()))});b(A)}},[k,f]),a.useEffect(()=>{const A=G=>{C.current&&!C.current.contains(G.target)&&i(!1)};return document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)}},[]);const S=async()=>{try{m(!0);const G=(await F.get(`/pendencias-estoque/cliente/${t}`)).data;j(Array.isArray(G==null?void 0:G.pendencias)?G.pendencias:[])}catch(A){console.error("Erro ao carregar pend√™ncias:",A),Se.error("Erro ao carregar lista de espera"),j([])}finally{m(!1)}},$=async()=>{var A;try{const G=await F.get("/produtos/",{params:{page:1,page_size:1e3,ativo:!0}}),E=Array.isArray((A=G.data)==null?void 0:A.items)?G.data.items:[];console.log("Produtos carregados:",E.length,E),y(E),b(E)}catch(G){console.error("Erro ao carregar produtos:",G),Se.error("Erro ao carregar produtos"),y([]),b([])}},K=A=>{l(A),w(A.nome),_({...h,produto_id:A.id}),i(!1)},re=()=>{l(null),w(""),_({...h,produto_id:""}),b(f)},M=async()=>{var G,E;if(!h.produto_id){Se.error("Selecione um produto");return}const A={baixa:0,media:1,alta:2};try{m(!0),await F.post("/pendencias-estoque/",{cliente_id:t,produto_id:parseInt(h.produto_id),quantidade_desejada:parseFloat(h.quantidade_desejada),prioridade:A[h.prioridade]||1,observacoes:h.observacoes||null}),Se.success("Cliente adicionado √† lista de espera!"),_({produto_id:"",quantidade_desejada:1,prioridade:"media",observacoes:""}),re(),r("listar"),S(),o()}catch(P){console.error("Erro ao adicionar pend√™ncia:",P),Se.error(((E=(G=P.response)==null?void 0:G.data)==null?void 0:E.detail)||"Erro ao adicionar √† lista de espera")}finally{m(!1)}},R=async A=>{if(confirm("Deseja realmente cancelar esta pend√™ncia?"))try{await F.delete(`/pendencias-estoque/${A}`),Se.success("Pend√™ncia cancelada"),S()}catch(G){console.error("Erro ao cancelar pend√™ncia:",G),Se.error("Erro ao cancelar pend√™ncia")}},J=async(A,G)=>{try{await F.put(`/pendencias-estoque/${A}`,{prioridade:parseInt(G)}),Se.success("Prioridade atualizada"),S()}catch(E){console.error("Erro ao alterar prioridade:",E),Se.error("Erro ao alterar prioridade")}};if(!s)return null;const te=A=>{switch(A){case 2:return"text-red-600 bg-red-50";case 1:return"text-yellow-600 bg-yellow-50";case 0:return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},L=A=>{switch(A){case 2:return"ALTA";case 1:return"M√âDIA";case 0:return"BAIXA";default:return"N/A"}},Z=A=>{switch(A){case"pendente":return e.jsx(Os,{className:"w-4 h-4 text-yellow-500"});case"notificado":return e.jsx(Qo,{className:"w-4 h-4 text-blue-500"});case"finalizado":return e.jsx(ha,{className:"w-4 h-4 text-green-500"});default:return e.jsx(da,{className:"w-4 h-4 text-gray-500"})}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-blue-50 to-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(da,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Lista de Espera - Produtos Sem Estoque"})]}),e.jsx("button",{onClick:n,className:"text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-200 transition-colors",children:e.jsx(ma,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{onClick:()=>r("listar"),className:`flex-1 px-4 py-3 font-medium transition-colors ${g==="listar"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:bg-gray-50"}`,children:["Lista de Espera (",v.length,")"]}),e.jsx("button",{onClick:()=>r("adicionar"),className:`flex-1 px-4 py-3 font-medium transition-colors ${g==="adicionar"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:bg-gray-50"}`,children:"Adicionar Pend√™ncia"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:g==="listar"?e.jsx("div",{className:"space-y-3",children:c?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Carregando..."}):v.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(da,{className:"w-16 h-16 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Nenhuma pend√™ncia registrada"}),e.jsx("button",{onClick:()=>r("adicionar"),className:"mt-4 text-blue-600 hover:text-blue-700 font-medium",children:"Adicionar primeira pend√™ncia"})]}):v.map(A=>e.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Z(A.status),e.jsx("h3",{className:"font-semibold text-gray-900",children:A.produto_nome||"Produto n√£o encontrado"}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${te(A.prioridade)}`,children:L(A.prioridade)})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[A.produto_codigo&&e.jsxs("p",{children:["C√≥digo: ",e.jsx("span",{className:"font-medium",children:A.produto_codigo})]}),e.jsxs("p",{children:["Quantidade: ",A.quantidade_desejada," un."]}),A.valor_referencia&&e.jsxs("p",{children:["Valor ref.: R$ ",parseFloat(A.valor_referencia).toFixed(2)]}),e.jsxs("p",{children:["Status: ",e.jsx("span",{className:"font-medium",children:A.status})]}),e.jsxs("p",{children:["Registrado em: ",new Date(A.data_registro).toLocaleDateString("pt-BR")]}),A.data_notificacao&&e.jsxs("p",{children:["Notificado em: ",new Date(A.data_notificacao).toLocaleDateString("pt-BR")]}),A.observacoes&&e.jsxs("p",{className:"italic",children:["Obs: ",A.observacoes]})]})]}),e.jsx("div",{className:"flex flex-col gap-2 ml-4",children:A.status==="pendente"&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:A.prioridade,onChange:G=>J(A.id,G.target.value),className:"text-xs border rounded px-2 py-1",children:[e.jsx("option",{value:"0",children:"Baixa"}),e.jsx("option",{value:"1",children:"M√©dia"}),e.jsx("option",{value:"2",children:"Alta"})]}),e.jsx("button",{onClick:()=>R(A.id),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Cancelar pend√™ncia",children:e.jsx(hs,{className:"w-4 h-4"})})]})})]})},A.id))}):e.jsxs("div",{className:"space-y-4 max-w-lg mx-auto",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Produto *"}),d?e.jsx("input",{type:"text",value:"Produto selecionado",disabled:!0,className:"w-full px-3 py-2 border rounded-lg bg-gray-50"}):e.jsxs("div",{ref:C,className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(As,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",value:k,onChange:A=>w(A.target.value),onFocus:()=>i(!0),placeholder:"Digite para buscar o produto...",className:"w-full pl-10 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),k&&e.jsx("button",{type:"button",onClick:re,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(ma,{className:"w-4 h-4"})})]}),u&&x.length>0&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[x.slice(0,50).map(A=>e.jsxs("button",{type:"button",onClick:()=>K(A),className:"w-full px-4 py-3 text-left hover:bg-blue-50 border-b last:border-b-0 transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900",children:A.nome}),e.jsxs("div",{className:"text-sm text-gray-500",children:[A.codigo&&`C√≥digo: ${A.codigo} ‚Ä¢ `,"Estoque: ",A.estoque_atual||0,A.preco_venda&&` ‚Ä¢ R$ ${parseFloat(A.preco_venda).toFixed(2)}`]})]},A.id)),x.length>50&&e.jsxs("div",{className:"px-4 py-2 text-sm text-gray-500 text-center bg-gray-50",children:["Mostrando 50 de ",x.length," produtos. Continue digitando para refinar."]})]}),u&&k&&x.length===0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg p-4",children:e.jsx("p",{className:"text-gray-500 text-center",children:"Nenhum produto encontrado"})}),p&&e.jsx("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"‚úì Produto selecionado"}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:p.nome})]})})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantidade Desejada *"}),e.jsx("input",{type:"number",min:"1",value:h.quantidade_desejada,onChange:A=>_({...h,quantidade_desejada:parseInt(A.target.value)||1}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prioridade"}),e.jsxs("select",{value:h.prioridade,onChange:A=>_({...h,prioridade:A.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"baixa",children:"Baixa - N√£o tem pressa"}),e.jsx("option",{value:"media",children:"M√©dia - Normal"}),e.jsx("option",{value:"alta",children:"Alta - Urgente"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes"}),e.jsx("textarea",{value:h.observacoes,onChange:A=>_({...h,observacoes:A.target.value}),rows:"3",placeholder:"Ex: Cliente pediu para avisar assim que chegar...",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"üì≤ O cliente ser√° notificado automaticamente via WhatsApp"})," quando o produto entrar no estoque."]})}),e.jsx("button",{onClick:M,disabled:c,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition-colors",children:c?"Adicionando...":"Adicionar √† Lista de Espera"})]})})]})})}function So(s){return s?s.variation_attributes&&typeof s.variation_attributes=="object"?Object.entries(s.variation_attributes).map(([t,d])=>`${t.charAt(0).toUpperCase()+t.slice(1)}: ${d}`).join(" | "):s.variation_signature?s.variation_signature.split("|").map(t=>{const[d,o]=t.split(":");return d&&o?`${d.charAt(0).toUpperCase()+d.slice(1)}: ${o}`:t}).join(" | "):"":""}function Di(){var Vr,Or,Br,Ur,Wr,Kr,Hr,Gr,Qr;const s=fa(),[n]=dr(),{user:t}=mt(),d=(t==null?void 0:t.is_admin)===!0,[o,g]=a.useState({cliente:null,pet:null,itens:[],subtotal:0,desconto_valor:0,desconto_percentual:0,total:0,observacoes:"",funcionario_id:null,entregador_id:null,tem_entrega:!1,entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}}),[r,v]=a.useState(""),[j,f]=a.useState(""),[y,c]=a.useState([]),[m,k]=a.useState([]),[w,x]=a.useState(!1),[b,u]=a.useState(!1),[i,p]=a.useState(!1),[l,C]=a.useState(!1),[h,_]=a.useState(!1),[S,$]=a.useState(!1),[K,re]=a.useState(0),[M,R]=a.useState(null),[J,te]=a.useState([]),[L,Z]=a.useState("24h"),[A,G]=a.useState("todas"),[E,P]=a.useState(!1),[H,B]=a.useState(""),[N,O]=a.useState(!1),[z,ae]=a.useState(!1),[W,ie]=a.useState(""),[ee,Q]=a.useState(0),[de,me]=a.useState(!1),[Pe,se]=a.useState(!1),[_e,ke]=a.useState(null),[Ye,ze]=a.useState(!1),[Qe,be]=a.useState(!1),[Ee,he]=a.useState(null),[Xe,Je]=a.useState(!1),[ca,ra]=a.useState("valor"),[pa,la]=a.useState(0),[oe,ye]=a.useState(!1),[Ce,Be]=a.useState(null),[Ie,Y]=a.useState([]),[je,Me]=a.useState(""),[T,X]=a.useState(null),[fe,U]=a.useState([]),[le,Ne]=a.useState(null),[Re,q]=a.useState(0);a.useEffect(()=>{g(I=>({...I,funcionario_id:(Ce==null?void 0:Ce.id)||null}))},[Ce]),a.useEffect(()=>{console.log("üîÑ Sincronizando entregador_id:",(le==null?void 0:le.id)||null),g(I=>({...I,entregador_id:(le==null?void 0:le.id)||null}))},[le]);const[ne,pe]=a.useState(!1),[$e,Oe]=a.useState(null),[Ke,He]=a.useState(!1),[ea,na]=a.useState({}),[ia,Ue]=a.useState(()=>{const I=localStorage.getItem("pdv_painel_vendas_aberto");return I?JSON.parse(I):!1}),[Ca,V]=a.useState(()=>{const I=localStorage.getItem("pdv_painel_cliente_aberto");return I?JSON.parse(I):!1}),[Fe,Te]=a.useState(!1),[We,ua]=a.useState([]),[xe,Ae]=a.useState({}),[qe,sa]=a.useState(0),[Ia,va]=a.useState(!1),[Ea,Na]=a.useState(null),Ja=a.useRef(null);a.useEffect(()=>{localStorage.setItem("pdv_painel_vendas_aberto",JSON.stringify(ia))},[ia]),a.useEffect(()=>{o.cliente&&pt()},[o.cliente]),a.useEffect(()=>{var I;o.itens&&o.itens.length>0?sessionStorage.setItem("pdv_calculadora_data",JSON.stringify({itens:o.itens,clienteId:((I=o.cliente)==null?void 0:I.id)||null})):sessionStorage.removeItem("pdv_calculadora_data")},[o.itens,o.cliente]),a.useEffect(()=>{localStorage.setItem("pdv_painel_cliente_aberto",JSON.stringify(Ca))},[Ca]),a.useEffect(()=>{Rt();const I=setInterval(()=>{Rt()},3e4);return()=>clearInterval(I)},[ee]);const Rt=async()=>{try{const I=await F.get("/caixas/aberto");me(!!I.data)}catch{me(!1)}};a.useEffect(()=>{ut()},[]);const ut=async()=>{try{const I=await F.get("/clientes/",{params:{is_entregador:!0,incluir_inativos:!1,limit:100}});let ue=I.data.items||I.data.clientes||I.data||[];Array.isArray(ue)||(console.error("‚ùå Resposta da API n√£o √© um array:",ue),ue=[]),U(ue);const we=ue.find(ve=>ve.entregador_padrao===!0);we&&(Ne(we),g(ve=>({...ve,entregador_id:we.id})),ks(we))}catch(I){console.error("Erro ao carregar entregadores:",I),Se.error("Erro ao carregar lista de entregadores")}},ks=async I=>{if(!I){q(0);return}let ue=0;if(I.modelo_custo_entrega==="taxa_fixa"&&I.taxa_fixa_entrega)ue=Number(I.taxa_fixa_entrega);else if(I.modelo_custo_entrega==="por_km"&&I.valor_por_km_entrega)ue=0;else if(I.modelo_custo_entrega==="rateio_rh"&&I.controla_rh)try{ue=(await F.get(`/entregadores/${I.id}/custo-operacional`)).data.custo_por_entrega||0}catch(we){console.error("Erro ao buscar custo RH:",we),ue=I.custo_rh_ajustado||0}else try{ue=(await F.get("/configuracoes/entregas")).data.taxa_fixa||0}catch(we){console.error("Erro ao buscar configura√ß√£o de entrega:",we),ue=10}q(ue)};a.useEffect(()=>{o.tem_entrega&&le?ks(le):q(0)},[le,o.tem_entrega]);const pt=async()=>{if(!o.cliente){re(0);return}try{const ue=(await F.get(`/pendencias-estoque/cliente/${o.cliente.id}`)).data.filter(we=>we.status==="pendente"||we.status==="notificado");re(ue.length)}catch{re(0)}},At=async I=>{if(!I||!o.cliente){ua([]);return}try{const we=(await F.get(`/internal/pdv/oportunidades/${I}`)).data;we&&Array.isArray(we.oportunidades)?ua(we.oportunidades):ua([])}catch{ua([])}},Ks=async(I,ue)=>{try{const we={opportunity_id:ue.id,event_type:I,user_id:t==null?void 0:t.id,contexto:"PDV",extra_data:{produto_origem_id:ue.produto_origem_id||null,produto_sugerido_id:ue.produto_sugerido_id||null,tipo_oportunidade:ue.tipo||null,venda_id:o.id||null}};F.post("/internal/pdv/eventos-oportunidade",we).catch(()=>{})}catch{}};async function Dt(I){try{const ue={produto_id:I.produto_id,preco_unitario:I.preco_unitario,quantidade:I.quantidade},{data:we}=await F.post("/pdv/fiscal/calcular",ue);return we}catch(ue){return console.error("Erro ao calcular fiscal:",ue),null}}a.useEffect(()=>{async function I(){let ue=0;const we={};for(const ve of o.itens){const Le=await Dt(ve);Le&&(we[ve.produto_id]=Le,ue+=Number(Le.total_impostos))}Ae(we),sa(ue.toFixed(2))}o.itens&&o.itens.length>0?I():(Ae({}),sa(0))},[o.itens]),a.useEffect(()=>{bs()},[L,A,E,H]),a.useEffect(()=>{const I=n.get("venda");I&&Ss(parseInt(I))},[n]),a.useEffect(()=>{const I=sessionStorage.getItem("abrirVenda"),ue=sessionStorage.getItem("abrirModalPagamento");I&&ue==="true"&&(sessionStorage.removeItem("abrirVenda"),sessionStorage.removeItem("abrirModalPagamento"),Ss(parseInt(I),!0))},[]);const Mt=()=>{ke({tipo:"entrega",apelido:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",estado:""}),se(!0)},Hs=()=>{se(!1),ke(null)},Lt=async I=>{if(!(!I||I.length!==9)){ze(!0);try{const we=await(await fetch(`https://viacep.com.br/ws/${I.replace("-","")}/json/`)).json();if(we.erro){alert("CEP n√£o encontrado");return}ke(ve=>({...ve,endereco:we.logradouro||"",bairro:we.bairro||"",cidade:we.localidade||"",estado:we.uf||""}))}catch(ue){console.error("Erro ao buscar CEP:",ue),alert("Erro ao buscar CEP")}finally{ze(!1)}}},qt=async()=>{if(!_e.cep||!_e.endereco||!_e.cidade){alert("Preencha pelo menos CEP, Endere√ßo e Cidade");return}if(!o.cliente||!o.cliente.id){alert("Selecione um cliente primeiro");return}try{const I=await ft(o.cliente.id),ue=I.enderecos_adicionais||[];ue.push({..._e}),await F.put(`/clientes/${o.cliente.id}`,{...I,enderecos_adicionais:ue});const we=await ft(o.cliente.id);g({...o,cliente:we}),alert("Endere√ßo adicionado com sucesso!"),Hs()}catch(I){console.error("Erro ao salvar endere√ßo:",I),alert("Erro ao salvar endere√ßo. Tente novamente.")}},zt=I=>{he({...I,preco:I.preco_unitario,descontoValor:I.desconto_valor||0,descontoPercentual:I.desconto_percentual||0,tipoDesconto:"valor"}),be(!0)},It=()=>{const I=o.itens.map(ue=>{if(ue.produto_id===Ee.produto_id){const we=Ee.preco,ve=ue.quantidade,Le=we*ve;let aa=0,ta=0;Ee.tipoDesconto==="valor"?(aa=parseFloat(Ee.descontoValor)||0,ta=Le>0?aa/Le*100:0):(ta=parseFloat(Ee.descontoPercentual)||0,aa=Le*ta/100);const ga=we-aa/ve,ka=Le-aa;return{...ue,desconto_valor:aa,desconto_percentual:ta,tipo_desconto_aplicado:Ee.tipoDesconto,preco_com_desconto:ga,subtotal:ka}}return ue});Sa(I),be(!1),he(null)},Tt=()=>{Je(!0)},Vt=(I,ue)=>{var ga;const we=o.subtotal;let ve=0,Le=0;I==="valor"?(ve=parseFloat(ue)||0,Le=we>0?ve/we*100:0):(Le=parseFloat(ue)||0,ve=we*Le/100);const aa=o.tem_entrega&&((ga=o.entrega)==null?void 0:ga.taxa_entrega_total)||0,ta=we-ve+aa;g({...o,desconto_valor:ve,desconto_percentual:Le,total:ta}),Je(!1)},bs=async()=>{try{const I=new Date;let ue;L==="24h"?ue=new Date(I.getTime()-24*60*60*1e3):L==="7d"?ue=new Date(I.getTime()-7*24*60*60*1e3):ue=new Date(I.getTime()-30*24*60*60*1e3);const we={data_inicio:ue.toISOString().split("T")[0],data_fim:I.toISOString().split("T")[0],per_page:50};H.trim()?(we.busca=H.trim(),delete we.data_inicio,delete we.data_fim):(A==="pago"?we.status="finalizada":A==="aberta"&&(we.status="aberta"),E===!0&&(we.tem_entrega=!0)),console.log("üìä Par√¢metros de busca de vendas:",we);const ve=await ko(we);te(ve.vendas||[])}catch(I){console.error("Erro ao carregar vendas:",I)}},Ss=async(I,ue=!1)=>{var we;try{O(!0);const ve=await Gt(I);if(!ve){alert("Venda n√£o encontrada");return}let Le=null;if(ve.cliente_id)try{Le=await ft(ve.cliente_id)}catch(xa){console.error("Erro ao buscar cliente:",xa)}let aa=[],ta=0;try{const xa=await F.get(`/vendas/${I}/pagamentos`);aa=xa.data.pagamentos||[],ta=xa.data.total_pago||0}catch(xa){console.error("Erro ao buscar pagamentos:",xa)}console.log("üîç Venda carregada - funcionario_id:",ve.funcionario_id);let ga=null;if(ve.funcionario_id)try{const La=((we=(await F.get("/comissoes/configuracoes/funcionarios")).data)==null?void 0:we.data)||[];console.log("üìã Funcion√°rios dispon√≠veis:",La),ga=La.find(Ya=>Ya.id===ve.funcionario_id),ga?(ye(!0),Be(ga),console.log("‚úÖ Funcion√°rio comiss√£o carregado:",ga)):console.warn("‚ö†Ô∏è Funcion√°rio ID",ve.funcionario_id,"n√£o encontrado na lista")}catch(xa){console.error("Erro ao carregar funcion√°rio de comiss√£o:",xa)}else console.log("‚ÑπÔ∏è Venda sem funcionario_id - limpando estados de comiss√£o"),ye(!1),Be(null),Me("");const ka={id:ve.id,numero_venda:ve.numero_venda,status:ve.status,data_venda:ve.data_venda,cliente:Le,pet:null,itens:ve.itens||[],subtotal:ve.subtotal||0,desconto_valor:ve.desconto_valor||0,desconto_percentual:ve.desconto_percentual||0,total:ve.total||0,observacoes:ve.observacoes||"",funcionario_id:ve.funcionario_id||null,entregador_id:ve.entregador_id||null,tem_entrega:ve.tem_entrega||!1,entrega:ve.entrega||{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""},pagamentos:aa,total_pago:ta};if(g(ka),ae(!0),ve.entregador_id){console.log("üîç Venda tem entregador_id:",ve.entregador_id);try{const La=(await F.get(`/clientes/${ve.entregador_id}`)).data;La&&La.is_entregador?(console.log("‚úÖ Entregador carregado:",La.nome),Ne(La),ks(La)):console.warn("‚ö†Ô∏è Cliente ID",ve.entregador_id,"n√£o √© um entregador v√°lido")}catch(xa){console.error("‚ùå Erro ao carregar entregador:",xa);const La=fe.find(Ya=>Ya.id===ve.entregador_id);La&&(console.log("‚úÖ Entregador encontrado no array (fallback):",La.nome),Ne(La),ks(La))}}else console.log("‚ÑπÔ∏è Venda sem entregador_id - limpando entregadorSelecionado"),Ne(null);ue&&setTimeout(()=>{x(!0)},500)}catch(ve){console.error("Erro ao carregar venda:",ve),alert("Erro ao carregar venda: "+(ve.message||"Erro desconhecido"))}finally{O(!1)}},gt=async()=>{var I;if(W.trim())try{O(!0);const ue=W.replace(/\D/g,"");if(!ue){alert("Digite um n√∫mero de venda v√°lido"),O(!1);return}console.log("üîç Buscando venda com n√∫mero:",ue);const we=await ko({busca:ue,per_page:50});if(console.log("üìä Vendas encontradas:",(I=we.vendas)==null?void 0:I.length),!we.vendas||we.vendas.length===0){alert(`Nenhuma venda encontrada com "${ue}"`),O(!1);return}if(we.vendas.length===1){await Ss(we.vendas[0].id),ie("");return}const ve=we.vendas.slice(0,10).map((ta,ga)=>`${ga+1}. ${ta.numero_venda} - ${ta.cliente_nome||"Sem cliente"} - ${ta.status}`).join(`
`),Le=prompt(`Encontradas ${we.vendas.length} vendas. Digite o n√∫mero da op√ß√£o:

${ve}`),aa=parseInt(Le)-1;aa>=0&&aa<we.vendas.length&&(await Ss(we.vendas[aa].id),ie(""))}catch(ue){console.error("Erro ao buscar venda:",ue),alert("Erro ao buscar venda: "+(ue.message||"Erro desconhecido"))}finally{O(!1)}};a.useEffect(()=>{if(r.length>=2){const I=setTimeout(async()=>{try{const ue=await ci({search:r});c(ue||[])}catch(ue){console.error("Erro ao buscar clientes:",ue),c([])}},300);return()=>clearTimeout(I)}else c([])},[r]),a.useEffect(()=>{if(j.length>=2){const I=setTimeout(async()=>{try{const we=(await mn({busca:j})).data.items||[];k(we)}catch(ue){console.error("Erro ao buscar produtos:",ue),k([])}},300);return()=>clearTimeout(I)}else k([])},[j]);const D=async I=>{g({...o,cliente:I,pet:null}),v(""),c([]);try{const ue=await F.get(`/clientes/${I.id}/vendas-em-aberto`);ue.data.resumo.total_vendas>0?R(ue.data.resumo):R(null)}catch(ue){console.error("Erro ao verificar vendas em aberto:",ue),R(null)}},ge=I=>{g({...o,pet:I})},De=I=>{var ve,Le;if(!de){alert("‚ùå N√£o √© poss√≠vel adicionar produtos sem caixa aberto. Abra um caixa primeiro.");return}console.log("üõí Produto sendo adicionado:",{nome:I.nome,categoria_id:I.categoria_id,categoria_nome:I.categoria_nome,peso_embalagem:I.peso_embalagem,classificacao_racao:I.classificacao_racao});const ue=o.itens.find(aa=>aa.produto_id===I.id);let we;ue?we=o.itens.map(aa=>aa.produto_id===I.id?{...aa,quantidade:aa.quantidade+1,subtotal:(aa.quantidade+1)*aa.preco_unitario}:aa):we=[...o.itens,{tipo:"produto",produto_id:I.id,produto_nome:I.nome,quantidade:1,preco_unitario:parseFloat(I.preco_venda),desconto_item:0,subtotal:parseFloat(I.preco_venda),pet_id:((ve=o.pet)==null?void 0:ve.id)||null,tipo_produto:I.tipo_produto,tipo_kit:I.tipo_kit,composicao_kit:I.composicao_kit||[],categoria_id:I.categoria_id,categoria_nome:I.categoria_nome,peso_pacote_kg:I.peso_liquido||I.peso_bruto,peso_embalagem:I.peso_embalagem,classificacao_racao:I.classificacao_racao}],Sa(we),f(""),k([]),(Le=Ja.current)==null||Le.focus()},Ze=(I,ue)=>{const we=o.itens.map((ve,Le)=>{if(Le===I){const aa=Math.max(1,ve.quantidade+ue),ta=aa*ve.preco_unitario;let ga=ve.desconto_valor||0;ve.tipo_desconto_aplicado==="percentual"&&ve.desconto_percentual>0&&(ga=ta*ve.desconto_percentual/100);const ka=ta-ga;return{...ve,quantidade:aa,desconto_valor:ga,subtotal:ka}}return ve});Sa(we)},Ve=I=>{const ue=o.itens.filter((we,ve)=>ve!==I);Sa(ue)},ya=I=>{na(ue=>({...ue,[I]:!ue[I]}))},Sa=I=>{var ga;const ue=I.reduce((ka,xa)=>ka+xa.subtotal,0),we=I.reduce((ka,xa)=>ka+(xa.desconto_valor||0),0),ve=ue+we,Le=ve>0?we/ve*100:0,aa=o.tem_entrega&&((ga=o.entrega)==null?void 0:ga.taxa_entrega_total)||0,ta=ue+aa;g({...o,itens:I,subtotal:ue,desconto_valor:we,desconto_percentual:Le,total:ta})},ja=async()=>{var I,ue,we,ve,Le,aa,ta,ga,ka,xa,La,Ya,Es,Qs,Bt,Xr,Jr,Yr,Zr,eo,ao,so,to,ro;if(o.itens.length===0){alert("Adicione pelo menos um produto ou servi√ßo");return}if(!de){alert("‚ùå N√£o √© poss√≠vel salvar venda sem caixa aberto. Abra um caixa primeiro.");return}if(!N){O(!0);try{if(o.id){await F.put(`/vendas/${o.id}`,{cliente_id:(I=o.cliente)==null?void 0:I.id,funcionario_id:o.funcionario_id,itens:o.itens.map(Ha=>{var ht;return{tipo:Ha.tipo,produto_id:Ha.produto_id,servico_descricao:Ha.servico_descricao,quantidade:Ha.quantidade,preco_unitario:Ha.preco_unitario||Ha.preco_venda,desconto_item:0,subtotal:Ha.subtotal,lote_id:Ha.lote_id,pet_id:Ha.pet_id||((ht=o.pet)==null?void 0:ht.id)}}),desconto_valor:0,desconto_percentual:0,observacoes:o.observacoes,tem_entrega:o.tem_entrega,taxa_entrega:((ue=o.entrega)==null?void 0:ue.taxa_entrega_total)||0,endereco_entrega:(we=o.entrega)==null?void 0:we.endereco_completo,observacoes_entrega:(ve=o.entrega)==null?void 0:ve.observacoes_entrega,distancia_km:(Le=o.entrega)==null?void 0:Le.distancia_km,valor_por_km:(aa=o.entrega)==null?void 0:aa.valor_por_km,loja_origem:(ta=o.entrega)==null?void 0:ta.loja_origem,entregador_id:o.entregador_id}),console.log("üö® DEBUG - Payload sendo enviado:",{tem_entrega:o.tem_entrega,entregador_id:o.entregador_id,vendaAtual_completo:o});let Wa=0;try{Wa=(await F.get(`/vendas/${o.id}/pagamentos`)).data.total_pago||0}catch(Ha){console.error("Erro ao buscar pagamentos:",Ha)}const Fs=o.total;let fs="aberta";Wa>=Fs-.01?fs="finalizada":Wa>0&&(fs="baixa_parcial"),o.status!==fs&&(await F.patch(`/vendas/${o.id}/status`,{status:fs}),console.log(`‚úÖ Status atualizado: ${o.status} ‚Üí ${fs}`)),alert("Venda atualizada com sucesso!"),es()}else{console.log("üöÄ CRIANDO VENDA - Vers√£o 2.0 - DESCONTOS ZERADOS"),console.log("Desconto valor:",0),console.log("Desconto percentual:",0),console.log("‚úÖ Checkbox Venda Comissionada:",oe),console.log("üíº Funcion√°rio Comiss√£o:",Ce),console.log("üìã Funcion√°rio ID enviado:",(Ce==null?void 0:Ce.id)||null),oe&&!Ce&&console.error("‚ö†Ô∏è ERRO: Checkbox marcado mas funcion√°rio n√£o selecionado!");const Wa=((ga=o.entrega)==null?void 0:ga.taxa_entrega_total)||0,Fs=((ka=o.entrega)==null?void 0:ka.taxa_loja)||0,fs=((xa=o.entrega)==null?void 0:xa.taxa_entregador)||0,Ha=Wa>0?Fs/Wa*100:100,ht=Wa>0?fs/Wa*100:0,oo={cliente_id:(La=o.cliente)==null?void 0:La.id,funcionario_id:o.funcionario_id,itens:o.itens.map(xs=>{var no;return{tipo:xs.tipo,produto_id:xs.produto_id,servico_descricao:xs.servico_descricao,quantidade:xs.quantidade,preco_unitario:xs.preco_unitario||xs.preco_venda,desconto_item:0,subtotal:xs.subtotal,lote_id:xs.lote_id,pet_id:xs.pet_id||((no=o.pet)==null?void 0:no.id)}}),desconto_valor:0,desconto_percentual:0,observacoes:o.observacoes,tem_entrega:o.tem_entrega,taxa_entrega:((Ya=o.entrega)==null?void 0:Ya.taxa_entrega_total)||0,percentual_taxa_loja:Ha,percentual_taxa_entregador:ht,endereco_entrega:(Es=o.entrega)==null?void 0:Es.endereco_completo,observacoes_entrega:(Qs=o.entrega)==null?void 0:Qs.observacoes_entrega,distancia_km:(Bt=o.entrega)==null?void 0:Bt.distancia_km,valor_por_km:(Xr=o.entrega)==null?void 0:Xr.valor_por_km,loja_origem:(Jr=o.entrega)==null?void 0:Jr.loja_origem,entregador_id:o.entregador_id};console.log("üì¶ PAYLOAD COMPLETO antes de enviar:",JSON.stringify(oo,null,2)),console.log("üöö Dados de entrega:",{tem_entrega:o.tem_entrega,entregador_id:o.entregador_id,entregadorSelecionado:le==null?void 0:le.id,vendaAtual_completo:o}),console.log("üí∞ Percentuais calculados:",{taxaTotal:Wa,taxaLoja:Fs,taxaEntregador:fs,percentualLoja:`${Ha.toFixed(2)}%`,percentualEntregador:`${ht.toFixed(2)}%`}),await un(oo),alert("Venda salva com sucesso!"),es()}bs()}catch(Wa){console.error("‚ùå Erro ao salvar venda:",Wa),console.error("‚ùå Resposta do servidor:",(Yr=Wa.response)==null?void 0:Yr.data),console.error("‚ùå Status:",(Zr=Wa.response)==null?void 0:Zr.status),console.error("‚ùå Headers:",(eo=Wa.response)==null?void 0:eo.headers);const Fs=((so=(ao=Wa.response)==null?void 0:ao.data)==null?void 0:so.detail)||((ro=(to=Wa.response)==null?void 0:to.data)==null?void 0:ro.message)||"Erro ao salvar venda";console.error("‚ùå Detalhes do erro:",Fs),alert(`Erro ao salvar venda: ${Fs}`)}finally{O(!1)}}},Pa=async I=>{var ue;console.log("üîç DEBUG formasPagamento recebidas:",I),He(!0),pe(!0);try{console.log("üí∞ Enviando an√°lise com m√∫ltiplas formas:",I);const we=await F.post("/formas-pagamento/analisar-venda",{items:o.itens.map(ve=>({produto_id:ve.produto_id,quantidade:ve.quantidade,preco_venda:ve.preco_unitario||ve.preco_venda,custo:ve.custo})),desconto:o.desconto_valor||0,taxa_entrega:((ue=o.entrega)==null?void 0:ue.taxa_entrega_total)||0,formas_pagamento:I,vendedor_id:o.funcionario_id});console.log("‚úÖ Resposta da an√°lise:",we.data),Oe(we.data)}catch(we){console.error("Erro ao buscar an√°lise:",we),alert("Erro ao carregar an√°lise da venda"),pe(!1)}finally{He(!1)}},rs=()=>{if(o.itens.length===0){alert("Adicione pelo menos um produto ou servi√ßo");return}if(o.status==="finalizada"||o.status==="pago_nf"){alert('Esta venda est√° finalizada. Clique em "Reabrir Venda" para modificar.');return}x(!0)},es=()=>{g({cliente:null,pet:null,itens:[],subtotal:0,desconto_valor:0,desconto_percentual:0,total:0,observacoes:"",funcionario_id:null,entregador_id:(le==null?void 0:le.id)||null,tem_entrega:!1,entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}}),ye(!1),Be(null),Me(""),ae(!1)},Ot=async I=>{var ue,we,ve;try{const Le=await Gt(I.id);let aa=null;Le.cliente_id&&(aa=await ft(Le.cliente_id));let ta=[],ga=0;try{const xa=await F.get(`/vendas/${I.id}/pagamentos`);ta=xa.data.pagamentos||[],ga=xa.data.total_pago||0}catch(xa){console.error("Erro ao buscar pagamentos:",xa)}if(console.log("üîç Venda carregada - funcionario_id:",Le.funcionario_id),Le.funcionario_id)try{const Ya=(((ue=(await F.get("/comissoes/configuracoes/funcionarios")).data)==null?void 0:ue.data)||[]).find(Es=>Es.id===Le.funcionario_id);Ya?(ye(!0),Be(Ya),console.log("‚úÖ Funcion√°rio comiss√£o carregado:",Ya)):console.warn("‚ö†Ô∏è Funcion√°rio ID",Le.funcionario_id,"n√£o encontrado na lista")}catch(xa){console.error("Erro ao carregar funcion√°rio de comiss√£o:",xa)}else console.log("‚ÑπÔ∏è Venda sem funcionario_id - limpando estados de comiss√£o"),ye(!1),Be(null),Me("");const ka={id:Le.id,numero_venda:Le.numero_venda,data_venda:Le.data_venda,cliente:aa,pet:null,itens:Le.itens||[],subtotal:parseFloat(Le.subtotal||Le.total),desconto_valor:parseFloat(Le.desconto_valor||0),desconto_percentual:parseFloat(Le.desconto_percentual||0),total:parseFloat(Le.total),observacoes:Le.observacoes||"",status:Le.status,tem_entrega:Le.tem_entrega||!1,entregador_id:Le.entregador_id||null,entrega:{endereco_completo:Le.endereco_entrega||"",endereco_id:Le.endereco_id||null,taxa_entrega_total:parseFloat(parseFloat(Le.taxa_entrega||0).toFixed(2)),taxa_loja:parseFloat(parseFloat(((we=Le.entrega)==null?void 0:we.taxa_loja)||0).toFixed(2)),taxa_entregador:parseFloat(parseFloat(((ve=Le.entrega)==null?void 0:ve.taxa_entregador)||0).toFixed(2)),observacoes_entrega:Le.observacoes_entrega||"",distancia_km:Le.distancia_km||0,valor_por_km:Le.valor_por_km||0,loja_origem:Le.loja_origem||"",status_entrega:Le.status_entrega||"pendente"},pagamentos:ta,total_pago:ga};g(ka),ae(!0),window.scrollTo({top:0,behavior:"smooth"})}catch(Le){console.error("Erro ao reabrir venda:",Le),alert("Erro ao carregar os dados da venda")}},Gs=()=>{ae(!1)},bn=async()=>{if(!o.id){es();return}if(T&&o.status!==T)try{O(!0),await F.patch(`/vendas/${o.id}/status`,{status:T}),console.log(`‚úÖ Status restaurado para: ${T} (altera√ß√µes descartadas)`)}catch(I){console.error("Erro ao restaurar status:",I)}finally{O(!1)}X(null),es()},fn=async()=>{var ue,we;if(!(!o.id||!window.confirm(`Deseja realmente excluir esta venda?

Esta a√ß√£o n√£o pode ser desfeita e o estoque ser√° devolvido.`)))try{O(!0),await F.delete(`/vendas/${o.id}`),es(),bs(),alert("Venda exclu√≠da com sucesso!")}catch(ve){console.error("Erro ao excluir venda:",ve);const Le=(we=(ue=ve.response)==null?void 0:ue.data)==null?void 0:we.detail;if(Le&&typeof Le=="object"){let aa=`‚ùå ${Le.erro||"Erro ao excluir venda"}

`;aa+=`${Le.mensagem||""}

`,Le.solucao&&(aa+=`üí° Solu√ß√£o:
${Le.solucao}

`),Le.passos&&Array.isArray(Le.passos)&&(aa+=`üìã Passos para resolver:
`,Le.passos.forEach(ta=>{aa+=`${ta}
`})),Le.rota_id&&(aa+=`
üöö Rota ID: ${Le.rota_id}`,Le.rota_status&&(aa+=` (${Le.rota_status})`)),alert(aa)}else alert(typeof Le=="string"?Le:"Erro ao excluir venda. Verifique se n√£o h√° v√≠nculos pendentes.")}finally{O(!1)}},jn=async()=>{var ue,we;if(!(!o.id||!window.confirm(`Deseja reabrir esta venda?

Os pagamentos ser√£o mantidos e o status mudar√° para "aberta".`))){X(o.status);try{O(!0),await F.post(`/vendas/${o.id}/reabrir`);const ve=await Gt(o.id);let Le=null;ve.cliente_id&&(Le=await ft(ve.cliente_id)),g({id:ve.id,numero_venda:ve.numero_venda,data_venda:ve.data_venda,cliente:Le,pet:null,itens:ve.itens||[],subtotal:parseFloat(ve.subtotal||ve.total),desconto_valor:parseFloat(ve.desconto_valor||0),desconto_percentual:parseFloat(ve.desconto_percentual||0),total:parseFloat(ve.total),observacoes:ve.observacoes||"",status:"aberta",tem_entrega:ve.tem_entrega||!1,entrega:{endereco_completo:ve.endereco_entrega||"",endereco_id:ve.endereco_id||null,taxa_entrega_total:parseFloat(parseFloat(ve.taxa_entrega||0).toFixed(2)),taxa_loja:parseFloat(parseFloat(ve.taxa_loja||0).toFixed(2)),taxa_entregador:parseFloat(parseFloat(ve.taxa_entregador||0).toFixed(2)),observacoes_entrega:ve.observacoes_entrega||"",distancia_km:ve.distancia_km||0,valor_por_km:ve.valor_por_km||0,loja_origem:ve.loja_origem||"",status_entrega:ve.status_entrega||"pendente"}}),ae(!1),alert(`Venda reaberta com sucesso! Agora voc√™ pode edit√°-la.

ATEN√á√ÉO: Se voc√™ n√£o fizer altera√ß√µes e sair, a venda voltar√° ao status anterior.`)}catch(ve){console.error("Erro ao reabrir venda:",ve),alert(((we=(ue=ve.response)==null?void 0:ue.data)==null?void 0:we.detail)||"Erro ao reabrir venda")}finally{O(!1)}}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"bg-white border-b px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(sr,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Ponto de Venda"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Buscar venda (Ex: 0011)",value:W,onChange:I=>ie(I.target.value),onKeyPress:I=>{I.key==="Enter"&&W.trim()&&gt()},className:"pl-10 pr-4 py-2 w-64 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"}),e.jsx(As,{className:"w-5 h-5 text-gray-400 absolute left-3 top-2.5"})]}),e.jsx("button",{onClick:gt,disabled:!W.trim()||N,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Buscar"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[o.cliente&&e.jsxs("button",{onClick:()=>$(!0),className:"flex items-center space-x-2 px-4 py-2 bg-white hover:bg-orange-50 border-2 border-orange-400 rounded-lg transition-colors relative",title:"Lista de espera - Produtos sem estoque",children:[e.jsx(Qo,{className:"w-5 h-5 text-orange-500"}),K>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center",children:K})]}),o.cliente&&e.jsxs("button",{onClick:()=>{Te(!0),o.id&&At(o.id)},className:"flex items-center space-x-2 px-4 py-2 bg-white hover:bg-yellow-50 border-2 border-yellow-400 rounded-lg transition-colors",title:"Ver oportunidades de venda",children:[e.jsx(xo,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"}),We.length>0&&e.jsx("span",{className:"font-semibold text-yellow-600",children:Math.min(We.length,6)})]}),e.jsx(ki,{onAbrirCaixa:()=>p(!0)},ee),e.jsxs("button",{onClick:()=>s("/meus-caixas"),className:"flex items-center space-x-2 px-4 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-colors",title:"Ver hist√≥rico de caixas",children:[e.jsx(it,{className:"w-5 h-5"}),e.jsx("span",{children:"Meus Caixas"})]}),!z&&o.id&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:bn,disabled:N,className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ma,{className:"w-5 h-5"}),e.jsx("span",{children:"Cancelar Edi√ß√£o"})]}),e.jsxs("button",{onClick:fn,disabled:N,className:"flex items-center space-x-2 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(hs,{className:"w-5 h-5"}),e.jsx("span",{children:"Excluir"})]})]}),e.jsxs("button",{onClick:ja,disabled:N||z||!de,className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:de?"Salvar venda atual":"üîí Caixa fechado - Abra o caixa para salvar vendas",children:[e.jsx(Ct,{className:"w-5 h-5"}),e.jsx("span",{children:"Salvar"}),!de&&e.jsx("span",{className:"text-xs",children:"üîí"})]}),e.jsxs("button",{onClick:rs,disabled:N||o.status==="finalizada"||o.status==="pago_nf"||!de,className:"flex items-center space-x-2 px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:de?"Registrar pagamento da venda":"üîí Caixa fechado - Abra o caixa para registrar recebimentos",children:[e.jsx(lt,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"}),!de&&e.jsx("span",{className:"text-xs",children:"üîí"})]})]})]})}),!de&&!z&&e.jsx("div",{className:"bg-red-50 border-b border-red-200 px-6 py-3",children:e.jsx("div",{className:"flex items-center justify-center max-w-5xl mx-auto",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-800",children:[e.jsx(da,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold text-lg",children:"üîí CAIXA FECHADO"}),e.jsx("span",{className:"text-sm",children:"- √â necess√°rio abrir o caixa para registrar vendas e recebimentos"})]})})}),o.id&&o.numero_venda&&e.jsx("div",{className:"bg-blue-50 border-b border-blue-200 px-4 py-1.5",children:e.jsxs("div",{className:"flex items-center justify-between max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-blue-800",children:"Venda:"}),e.jsxs("div",{className:"flex items-center gap-1.5 bg-white px-2 py-0.5 rounded border border-blue-300",children:[e.jsxs("span",{className:"font-bold text-blue-700 text-sm",children:["#",o.numero_venda]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(o.numero_venda);const I=event.target.closest("button"),ue=I.innerHTML;I.innerHTML="‚úì",I.classList.add("text-green-600"),setTimeout(()=>{I.innerHTML=ue,I.classList.remove("text-green-600")},1500)},className:"text-blue-600 hover:text-blue-800 transition-colors text-xs",title:"Copiar n√∫mero da venda",children:"üìã"})]})]}),o.data_venda&&e.jsx("span",{className:"text-xs text-blue-600",children:(()=>{const I=o.data_venda;if(typeof I=="string"&&I.includes("T")){const[ue]=I.split("T"),[we,ve,Le]=ue.split("-");return`${Le}/${ve}/${we}`}return new Date(I).toLocaleDateString("pt-BR")})()})]})}),z&&e.jsx("div",{className:"bg-yellow-50 border-b border-yellow-200 px-6 py-3",children:e.jsxs("div",{className:"flex items-center justify-between max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-800",children:[e.jsx(da,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Modo Visualiza√ß√£o - Venda ",o.status==="finalizada"?"Finalizada":o.status==="baixa_parcial"?"com Baixa Parcial":"Aberta"]}),e.jsx("span",{className:"text-sm",children:"(Clique em Editar para modificar)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Si,{venda:o}),e.jsxs("button",{onClick:()=>{ae(!1),es()},className:"flex items-center gap-2 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(ma,{className:"w-4 h-4"}),"Voltar"]}),(o.status==="finalizada"||o.status==="baixa_parcial")&&e.jsxs("button",{onClick:jn,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(da,{className:"w-4 h-4"}),"Reabrir Venda"]}),o.status==="aberta"&&e.jsx("button",{onClick:Gs,className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg font-medium transition-colors",children:"Editar"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"max-w-5xl mx-auto space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(tr,{className:"w-5 h-5 mr-2 text-blue-600"}),"Cliente"]}),o.cliente&&!z&&e.jsx("button",{onClick:()=>g({...o,cliente:null,pet:null}),className:"text-sm text-red-600 hover:text-red-700",children:"Remover"})]}),o.cliente?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-blue-900",children:o.cliente.nome}),e.jsxs("div",{className:"text-sm text-blue-700 mt-1",children:[o.cliente.cpf&&`CPF: ${o.cliente.cpf}`,o.cliente.telefone&&` ‚Ä¢ Tel: ${o.cliente.telefone}`]})]})}),o.cliente.credito>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(it,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Cr√©dito Dispon√≠vel:"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",parseFloat(o.cliente.credito||0).toFixed(2).replace(".",",")]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"üí° Este cr√©dito pode ser usado como forma de pagamento"})]}),M&&M.total_vendas>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-blue-300",children:e.jsxs("div",{className:"flex items-center justify-between p-2 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Da,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-yellow-900",children:[M.total_vendas," venda(s) em aberto"]}),e.jsxs("div",{className:"text-xs text-yellow-700",children:["Total: R$ ",M.total_em_aberto.toFixed(2)]})]})]}),e.jsx("button",{onClick:()=>C(!0),className:"px-3 py-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs font-medium rounded transition-colors",children:"Ver Vendas"})]})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-300 flex gap-2",children:[e.jsxs("button",{onClick:()=>_(!0),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(On,{className:"w-4 h-4"}),"Hist√≥rico"]}),!z&&e.jsx("button",{onClick:()=>{g({...o,cliente:null,pet:null}),R(null)},className:"px-4 py-2 text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Trocar"})]})]}),o.cliente.pets&&o.cliente.pets.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pet (opcional)"}),e.jsxs("select",{value:((Vr=o.pet)==null?void 0:Vr.id)||"",onChange:I=>{const ue=o.cliente.pets.find(we=>we.id===parseInt(I.target.value));ge(ue||null)},disabled:z,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Sem pet espec√≠fico"}),o.cliente.pets.map(I=>e.jsxs("option",{value:I.id,children:[I.codigo," - ",I.nome," (",I.especie,I.raca&&` - ${I.raca}`,")"]},I.id))]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:r,onChange:I=>v(I.target.value),placeholder:"Digite nome, CPF ou telefone do cliente...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:z}),e.jsx(As,{className:"w-5 h-5 text-gray-400 absolute right-3 top-1/2 -translate-y-1/2"})]}),e.jsxs("button",{onClick:()=>u(!0),disabled:z,className:"flex items-center space-x-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(os,{className:"w-5 h-5"}),e.jsx("span",{children:"Novo"})]})]}),y.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:y.map(I=>e.jsxs("button",{onClick:()=>D(I),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:I.nome}),e.jsxs("div",{className:"text-sm text-gray-500",children:[I.cpf&&`CPF: ${I.cpf}`,I.telefone&&` ‚Ä¢ ${I.telefone}`]}),I.pets&&I.pets.length>0&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:[I.pets.length," pet(s)"]})]},I.id))})]}),r.length>=2&&y.length===0&&e.jsx("div",{className:"text-sm text-gray-500 text-center py-2",children:"Nenhum cliente encontrado"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(Za,{className:"w-5 h-5 mr-2 text-blue-600"}),"Produtos e Servi√ßos"]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{ref:Ja,type:"text",value:j,onChange:I=>f(I.target.value),placeholder:"Digite o nome do produto, c√≥digo de barras ou servi√ßo...",disabled:z,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",autoFocus:!z}),e.jsx(As,{className:"w-5 h-5 text-gray-400 absolute right-3"})]}),m.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:m.map(I=>e.jsx("button",{onClick:()=>De(I),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b last:border-b-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:I.nome}),I.tipo_produto==="VARIACAO"&&So(I)&&e.jsxs("div",{className:"text-xs text-blue-600 font-medium mt-0.5",children:["üîπ ",So(I)]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[I.codigo&&`C√≥d: ${I.codigo}`,I.tipo_produto==="KIT"&&I.tipo_kit==="VIRTUAL"?I.estoque_virtual!==void 0&&` ‚Ä¢ Estoque: ${I.estoque_virtual}`:I.estoque_atual!==void 0&&` ‚Ä¢ Estoque: ${I.estoque_atual}`]})]}),e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:["R$ ",parseFloat(I.preco_venda).toFixed(2)]})]})},I.id))})]}),o.itens.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(Za,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhum item adicionado"}),e.jsx("p",{className:"text-sm mt-1",children:"Busque e adicione produtos ou servi√ßos"})]}):e.jsx("div",{className:"space-y-3",children:o.itens.map((I,ue)=>{var aa;const we=I.tipo_produto==="KIT",ve=ea[ue],Le=we&&I.composicao_kit&&I.composicao_kit.length>0;return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200 hover:border-blue-400 space-y-3 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>!z&&zt(I),children:[e.jsxs("div",{className:"flex-1 flex items-start gap-2",children:[Le&&e.jsx("button",{onClick:ta=>{ta.stopPropagation(),ya(ue)},className:"mt-1 text-gray-500 hover:text-blue-600 transition-colors",children:ve?e.jsx(Ls,{className:"w-5 h-5"}):e.jsx(st,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:I.produto_nome}),we&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-700",children:[e.jsx(Ko,{className:"w-3 h-3"}),"KIT"]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[I.quantidade," Unidade",I.quantidade!==1?"s":""," x R$ ",I.preco_unitario.toFixed(2),I.desconto_valor>0&&e.jsxs("span",{className:"text-orange-600 ml-1",children:["com R$ ",I.desconto_valor.toFixed(2)," de desconto"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",onClick:ta=>ta.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center space-x-2 bg-white border border-gray-300 rounded-lg",children:[e.jsx("button",{onClick:()=>Ze(ue,-1),disabled:z,className:"p-2 hover:bg-gray-100 rounded-l-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(xr,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:I.quantidade,onChange:ta=>{const ga=parseFloat(ta.target.value)||0,ka=o.itens.map((xa,La)=>{if(La===ue){const Ya=Math.max(.001,ga),Es=Ya*xa.preco_unitario;let Qs=xa.desconto_valor||0;xa.tipo_desconto_aplicado==="percentual"&&xa.desconto_percentual>0&&(Qs=Es*xa.desconto_percentual/100);const Bt=Es-Qs;return{...xa,quantidade:Ya,desconto_valor:Qs,subtotal:Bt}}return xa});Sa(ka)},disabled:z,step:"0.001",min:"0.001",className:"w-20 px-2 py-1 text-center font-medium border-none focus:ring-0 disabled:bg-gray-50"}),e.jsx("button",{onClick:()=>Ze(ue,1),disabled:z,className:"p-2 hover:bg-gray-100 rounded-r-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(os,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900 w-24 text-right",children:["R$ ",I.subtotal.toFixed(2)]}),e.jsx("button",{onClick:()=>Ve(ue),disabled:z,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(hs,{className:"w-5 h-5"})})]})]}),Le&&ve&&e.jsxs("div",{className:"ml-7 mt-3 p-3 bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-600 uppercase mb-2",children:"Composi√ß√£o do KIT"}),e.jsx("div",{className:"space-y-1.5",children:I.composicao_kit.map((ta,ga)=>e.jsxs("div",{className:"flex items-center justify-between text-sm py-1.5 px-2 rounded hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Za,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:ta.produto_nome})]}),e.jsxs("span",{className:"text-gray-500 font-medium",children:[ta.quantidade,"x"]})]},ga))}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 italic",children:"Componentes apenas informativos (n√£o edit√°veis)"})]}),((aa=o.cliente)==null?void 0:aa.pets)&&o.cliente.pets.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",onClick:ta=>ta.stopPropagation(),children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 w-16",children:"Pet:"}),e.jsxs("select",{value:I.pet_id||"",onChange:ta=>{const ga=o.itens.map((ka,xa)=>xa===ue?{...ka,pet_id:ta.target.value?parseInt(ta.target.value):null}:ka);g({...o,itens:ga})},disabled:z,className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"N√£o especificado"}),o.cliente.pets.map(ta=>e.jsxs("option",{value:ta.id,children:[ta.codigo," - ",ta.nome]},ta.id))]})]})]},ue)})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Observa√ß√µes"}),e.jsx("textarea",{value:o.observacoes||"",onChange:I=>g({...o,observacoes:I.target.value}),placeholder:"Observa√ß√µes da venda (opcional)...",disabled:z,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:3})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Entrega"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.tem_entrega,onChange:I=>{var Le;const ue=I.target.checked,we=ue&&((Le=o.entrega)==null?void 0:Le.taxa_entrega_total)||0,ve=o.subtotal+we;g({...o,tem_entrega:ue,total:ve,entrega:ue?o.entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}})},disabled:z,className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Tem entrega?"})]})]}),o.tem_entrega&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Endere√ßo Completo *"}),o.cliente&&e.jsxs("div",{className:"mb-2 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Endere√ßos cadastrados:"}),e.jsxs("button",{type:"button",onClick:I=>{I.preventDefault(),I.stopPropagation(),Mt()},disabled:z,className:"flex items-center gap-1 px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(os,{size:14}),"Adicionar Endere√ßo"]})]}),e.jsxs("div",{className:"space-y-2",children:[(o.cliente.endereco||o.cliente.cidade)&&e.jsxs("button",{type:"button",onClick:I=>{I.preventDefault(),I.stopPropagation();const ue=`${o.cliente.endereco}${o.cliente.numero?", "+o.cliente.numero:""}${o.cliente.complemento?" - "+o.cliente.complemento:""}, ${o.cliente.bairro}, ${o.cliente.cidade}/${o.cliente.estado}`;g({...o,entrega:{...o.entrega,endereco_completo:ue}})},disabled:z,className:"w-full text-left px-3 py-2 bg-white hover:bg-blue-100 border border-blue-300 rounded text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"font-medium text-blue-700",children:"üè† Cadastro Principal:"})," ",e.jsxs("span",{className:"text-gray-700",children:[o.cliente.endereco,", ",o.cliente.numero," - ",o.cliente.bairro]})]}),o.cliente.enderecos_adicionais&&o.cliente.enderecos_adicionais.map((I,ue)=>e.jsxs("button",{type:"button",onClick:we=>{we.preventDefault(),we.stopPropagation();const ve=`${I.endereco}, ${I.numero}${I.complemento?" - "+I.complemento:""}, ${I.bairro}, ${I.cidade}/${I.estado}`;g({...o,entrega:{...o.entrega,endereco_completo:ve}})},disabled:z,className:"w-full text-left px-3 py-2 bg-white hover:bg-blue-100 border border-blue-300 rounded text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsxs("span",{className:`inline-block px-2 py-0.5 text-xs font-medium rounded mr-2 ${I.tipo==="entrega"?"bg-blue-100 text-blue-800":I.tipo==="cobranca"?"bg-green-100 text-green-800":I.tipo==="comercial"?"bg-purple-100 text-purple-800":I.tipo==="residencial"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:[I.tipo==="entrega"?"üì¶":I.tipo==="cobranca"?"üí∞":I.tipo==="comercial"?"üè¢":I.tipo==="residencial"?"üè†":"üìç"," ",I.apelido||I.tipo]}),e.jsxs("span",{className:"text-gray-700",children:[I.endereco,", ",I.numero," - ",I.bairro]})]},ue)),!o.cliente.endereco&&(!o.cliente.enderecos_adicionais||o.cliente.enderecos_adicionais.length===0)&&e.jsx("p",{className:"text-sm text-gray-600 italic",children:'Nenhum endere√ßo cadastrado. Clique em "+ Adicionar Endere√ßo"'})]})]}),e.jsx("textarea",{value:((Or=o.entrega)==null?void 0:Or.endereco_completo)??"",onChange:I=>g({...o,entrega:{...o.entrega,endereco_completo:I.target.value}}),placeholder:"Rua, n√∫mero, complemento, bairro, cidade...",disabled:z,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Entregador"}),e.jsxs("select",{value:(le==null?void 0:le.id)||"",onChange:I=>{const ue=fe.find(we=>we.id===parseInt(I.target.value));Ne(ue),g({...o,entregador_id:(ue==null?void 0:ue.id)||null}),ue&&ks(ue)},disabled:z,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Selecione um entregador"}),fe.map(I=>e.jsxs("option",{value:I.id,children:[I.nome_fantasia||I.nome,I.entregador_padrao&&" (Padr√£o)"]},I.id))]}),le&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Modelo: ",le.modelo_custo_entrega==="taxa_fixa"?"üíµ Taxa Fixa":le.modelo_custo_entrega==="por_km"?"üöó Por KM":le.modelo_custo_entrega==="rateio_rh"?"üëî Rateio RH":"‚öôÔ∏è Configura√ß√£o Global"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa de Entrega Total"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((Br=o.entrega)==null?void 0:Br.taxa_entrega_total)??0,onChange:I=>{var ka;const ue=parseFloat(I.target.value)||0,we=parseFloat(ue.toFixed(2)),ve=((ka=o.entrega)==null?void 0:ka.taxa_loja)||0,Le=parseFloat((ue-ve).toFixed(2)),aa={...o,entrega:{...o.entrega,taxa_entrega_total:we,taxa_loja:parseFloat(ve.toFixed(2)),taxa_entregador:Le}},ta=aa.tem_entrega?we:0,ga=parseFloat((aa.subtotal+ta).toFixed(2));g({...aa,total:ga})},disabled:z,className:"w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa Loja"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:((Ur=o.entrega)==null?void 0:Ur.taxa_entrega_total)??0,value:parseFloat((((Wr=o.entrega)==null?void 0:Wr.taxa_loja)??0).toFixed(2)),onChange:I=>{var aa;const ue=parseFloat(I.target.value)||0,we=((aa=o.entrega)==null?void 0:aa.taxa_entrega_total)||0,ve=parseFloat(ue.toFixed(2)),Le=parseFloat((we-ue).toFixed(2));g({...o,entrega:{...o.entrega,taxa_loja:ve,taxa_entregador:Le}})},disabled:z,className:"w-full pl-12 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa Entregador"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:((Kr=o.entrega)==null?void 0:Kr.taxa_entrega_total)??0,value:parseFloat((((Hr=o.entrega)==null?void 0:Hr.taxa_entregador)??0).toFixed(2)),onChange:I=>{var aa;const ue=parseFloat(I.target.value)||0,we=((aa=o.entrega)==null?void 0:aa.taxa_entrega_total)||0,ve=parseFloat(ue.toFixed(2)),Le=parseFloat((we-ue).toFixed(2));g({...o,entrega:{...o.entrega,taxa_entregador:ve,taxa_loja:Le}})},disabled:z,className:"w-full pl-12 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Preencha a taxa total e depois divida entre loja e entregador. Ao alterar uma, a outra √© calculada automaticamente."}),le&&Re>0&&e.jsxs("div",{className:"mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-amber-600",children:"üíº"}),e.jsx("span",{className:"text-sm font-medium text-amber-900",children:"Custo Operacional"})]}),e.jsxs("span",{className:"text-sm font-semibold text-amber-700",children:["R$ ",Re.toFixed(2)]})]}),e.jsxs("p",{className:"text-xs text-amber-600 mt-1 italic",children:[le.nome_fantasia||le.nome," -",le.modelo_custo_entrega==="taxa_fixa"&&" Taxa Fixa",le.modelo_custo_entrega==="por_km"&&" Valor por KM",le.modelo_custo_entrega==="rateio_rh"&&" Rateio de RH"," ","(n√£o aparece no cupom)"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes da Entrega"}),e.jsx("textarea",{value:((Gr=o.entrega)==null?void 0:Gr.observacoes_entrega)??"",onChange:I=>g({...o,entrega:{...o.entrega,observacoes_entrega:I.target.value}}),placeholder:"Hor√°rio preferencial, ponto de refer√™ncia...",disabled:z,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:2})]})]})]}),o.itens.length>0&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total bruto:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",(o.subtotal+o.desconto_valor).toFixed(2)]})]}),o.desconto_valor>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-orange-600",children:[(o.desconto_valor/(o.subtotal+o.desconto_valor)*100).toFixed(2),"% de desconto:"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium text-orange-600",children:["R$ ",o.desconto_valor.toFixed(2)]}),e.jsx("button",{onClick:Tt,disabled:z,className:"p-1 text-blue-600 hover:bg-blue-50 rounded disabled:opacity-50",title:"Aplicar desconto",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",o.subtotal.toFixed(2)]})]}),o.tem_entrega&&e.jsxs("div",{className:"flex justify-between text-blue-600",children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsxs("span",{className:"font-medium",children:["+ R$ ",(((Qr=o.entrega)==null?void 0:Qr.taxa_entrega_total)||0).toFixed(2)]})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold text-gray-900",children:[e.jsx("span",{children:"Total da Venda:"}),e.jsxs("span",{children:["R$ ",o.total.toFixed(2)]})]})}),qe>0&&e.jsxs("div",{className:"flex justify-between text-sm text-blue-600 bg-blue-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium",children:"Total de Impostos:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",qe]})]}),o.total_pago>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-green-600 border-t pt-3",children:[e.jsx("span",{className:"font-medium",children:"(-) Valor Pago:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",o.total_pago.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-2xl font-bold border-t-2 pt-3",children:[e.jsx("span",{className:o.total-o.total_pago>0?"text-orange-600":"text-green-600",children:o.total-o.total_pago>0?"Saldo Restante:":"Totalmente Pago:"}),e.jsxs("span",{className:o.total-o.total_pago>0?"text-orange-600":"text-green-600",children:["R$ ",Math.max(0,o.total-o.total_pago).toFixed(2)]})]})]}),!o.total_pago&&e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"flex justify-between text-2xl font-bold text-gray-900",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["R$ ",o.total.toFixed(2)]})]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Comiss√£o"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:oe,onChange:I=>{ye(I.target.checked),I.target.checked||Be(null)},disabled:z,className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Venda comissionada?"})]})]}),oe&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Funcion√°rio/Veterin√°rio * ",e.jsx("span",{className:"text-xs text-gray-500",children:"(apenas com comiss√£o configurada)"})]}),Ce?e.jsxs("div",{className:"p-4 bg-green-50 border-2 border-green-300 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white font-bold",children:Ce.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-green-900",children:Ce.nome}),e.jsx("div",{className:"text-sm text-green-700 capitalize",children:Ce.cargo})]})]}),e.jsx("button",{onClick:()=>{Be(null),Me("")},disabled:z,className:"p-2 text-green-600 hover:bg-green-100 rounded-lg transition-colors disabled:cursor-not-allowed",title:"Remover sele√ß√£o",children:e.jsx(ma,{size:20})})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:je,placeholder:"Buscar funcion√°rio ou veterin√°rio...",disabled:z,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",onFocus:async()=>{if(!z)try{const I=await F.get("/comissoes/configuracoes/funcionarios");Y(I.data.data||[])}catch(I){console.error("Erro ao buscar funcion√°rios:",I)}},onChange:async I=>{const ue=I.target.value;Me(ue);try{const ve=(await F.get("/comissoes/configuracoes/funcionarios")).data.data||[],Le=ue?ve.filter(aa=>aa.nome.toLowerCase().includes(ue.toLowerCase())):ve;Y(Le)}catch(we){console.error("Erro ao buscar funcion√°rios:",we)}}}),Ie.length>0&&e.jsx("div",{className:"mt-2 border border-gray-200 rounded-lg max-h-48 overflow-y-auto",children:Ie.map(I=>e.jsxs("button",{onClick:()=>{Be(I),Y([]),Me("")},className:"w-full px-4 py-2 text-left hover:bg-gray-50 border-b last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:I.nome}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:I.cargo})]},I.id))})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"‚ÑπÔ∏è A comiss√£o ser√° calculada automaticamente conforme configurado no m√≥dulo de comiss√µes"})]})]})]}),o.itens.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[!de&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-700",children:[e.jsx(da,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:'üîí Caixa fechado - Use o bot√£o "Abrir Caixa" no topo da p√°gina para continuar'})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[o.itens.length>0&&!o.id&&e.jsxs("button",{onClick:()=>{window.confirm("Descartar venda atual sem salvar?")&&es()},disabled:N||z,className:"flex items-center space-x-2 px-4 py-3 bg-red-50 hover:bg-red-100 text-red-600 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed border border-red-200",title:"Descartar venda atual e come√ßar uma nova",children:[e.jsx(ma,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Nova Venda"})]}),e.jsxs("button",{onClick:ja,disabled:N||z||!de,className:"flex items-center space-x-2 px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:de?"Salvar venda atual":"üîí Caixa fechado - Abra o caixa para salvar vendas",children:[e.jsx(Ct,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Salvar Venda"}),!de&&e.jsx("span",{className:"text-xs",children:"üîí"})]}),e.jsxs("button",{onClick:rs,disabled:N||o.status==="finalizada"||o.status==="pago_nf"||!de,className:"flex items-center space-x-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors shadow-md disabled:opacity-50 disabled:cursor-not-allowed",title:de?"Registrar pagamento da venda":"üîí Caixa fechado - Abra o caixa para registrar recebimentos",children:[e.jsx(lt,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"}),!de&&e.jsx("span",{className:"text-xs",children:"üîí"})]})]})]})]})]}),o.cliente&&Ca&&e.jsx("div",{className:"w-80 bg-gray-50 border-l flex flex-col overflow-hidden",children:e.jsx($i,{clienteId:o.cliente.id})}),o.cliente&&e.jsx("button",{onClick:()=>V(!Ca),className:"fixed right-0 top-1/2 -translate-y-1/2 bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-l-lg shadow-lg transition-all z-10",style:{right:Ca?"320px":"0"},title:Ca?"Recolher informa√ß√µes do cliente":"Expandir informa√ß√µes do cliente",children:Ca?e.jsx(st,{className:"w-5 h-5"}):e.jsx(tr,{className:"w-5 h-5"})}),ia&&e.jsxs("div",{className:"w-52 bg-white border-l flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 flex items-center",children:[e.jsx(Os,{className:"w-4 h-4 mr-2 text-blue-600"}),"Vendas Recentes"]}),e.jsx("button",{onClick:()=>Ue(!1),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Fechar painel",children:e.jsx(ma,{className:"w-4 h-4 text-gray-500"})})]}),e.jsx("div",{className:"flex space-x-1 mb-3",children:["24h","7d","30d"].map(I=>e.jsxs("button",{onClick:()=>Z(I),className:`flex-1 px-2 py-1.5 rounded-lg text-xs font-medium transition-colors ${L===I?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[I==="24h"&&"√öltimas 24h",I==="7d"&&"7 dias",I==="30d"&&"30 dias"]},I))}),e.jsx("div",{className:"flex space-x-1 mb-2",children:[{id:"todas",label:"Todas"},{id:"pago",label:"Pago"},{id:"aberta",label:"Aberta"}].map(I=>e.jsx("button",{onClick:()=>G(I.id),className:`flex-1 px-2 py-1.5 rounded-lg text-xs font-medium transition-colors ${A===I.id?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:I.label},I.id))}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 hover:bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",checked:E,onChange:I=>P(I.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Apenas com entrega"})]}),e.jsx("div",{className:"px-2 pb-2",children:e.jsx("input",{type:"text",value:H,onChange:I=>B(I.target.value),placeholder:"Buscar por n√∫mero...",className:"w-full px-3 py-2 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:J.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(da,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-xs",children:"Nenhuma venda encontrada"})]}):J.map(I=>e.jsxs("div",{onClick:()=>Ot(I),className:"bg-gray-50 rounded-lg p-2.5 border border-gray-200 hover:border-blue-300 cursor-pointer transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1.5",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:I.cliente_nome||"Cliente n√£o informado"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["#",I.numero_venda]})]}),e.jsxs("div",{className:"text-right ml-2 flex-shrink-0",children:[I.status==="baixa_parcial"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[10px] text-gray-500",children:"Pago"}),e.jsxs("div",{className:"text-xs font-semibold text-green-600",children:["R$ ",(I.valor_pago||0).toFixed(2)]}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-0.5",children:["de R$ ",(I.total||0).toFixed(2)]})]}):e.jsxs("div",{className:"text-sm font-semibold text-green-600",children:["R$ ",(I.total||0).toFixed(2)]}),e.jsxs("div",{className:`text-[10px] font-medium px-1.5 py-0.5 rounded-full mt-1 inline-block ${I.status==="pago_nf"?"bg-emerald-100 text-emerald-700":I.status==="finalizada"?"bg-green-100 text-green-700":I.status==="baixa_parcial"?"bg-blue-100 text-blue-700":I.status==="aberta"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[I.status==="pago_nf"&&"Pago NF",I.status==="finalizada"&&"Pago",I.status==="baixa_parcial"&&"Parcial",I.status==="aberta"&&"Aberta",I.status==="cancelada"&&"Cancelada"]})]})]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:(()=>{const ue=I.data_venda;if(typeof ue=="string"&&ue.includes("T")){const[we,ve]=ue.split("T"),Le=ve.split("-")[0].split("+")[0],[aa,ta,ga]=we.split("-"),[ka,xa]=Le.split(":");return`${ga}/${ta} ${ka}:${xa}`}return new Date(ue).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})()})]},I.id))})]}),Fe&&o.cliente&&e.jsx("div",{className:"fixed inset-0 z-40",children:e.jsxs("div",{className:"absolute top-0 right-0 w-80 h-full bg-gray-50 border-l border-gray-300 shadow-lg flex flex-col animate-in slide-in-from-right duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-300 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xo,{className:"w-4 h-4 text-gray-600"}),e.jsx("h2",{className:"text-sm font-medium text-gray-700",children:"Oportunidades"})]}),e.jsx("button",{onClick:()=>Te(!1),className:"p-1 hover:bg-gray-100 rounded transition-colors",children:e.jsx(ma,{className:"w-4 h-4 text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:[We.slice(0,5).map(I=>e.jsxs("div",{className:"p-3 bg-white border border-gray-200 rounded hover:bg-gray-50 transition-colors",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:I.titulo}),e.jsx("p",{className:"text-xs text-gray-700 mb-2 leading-relaxed",children:I.descricao_curta}),e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs mt-2",children:[e.jsxs("button",{onClick:()=>{Ks("oportunidade_convertida",I),console.log("Adicionar ao carrinho:",I.id)},className:"flex items-center gap-1 text-green-500 hover:text-green-600 transition-colors whitespace-nowrap font-medium",title:"Adicionar ao carrinho",children:[e.jsx(os,{className:"w-3 h-3"}),e.jsx("span",{children:"Adicionar"})]}),e.jsx("button",{onClick:()=>{Ks("oportunidade_refinada",I),console.log("Buscar alternativa:",I.id)},className:"text-orange-600 hover:text-orange-700 transition-colors whitespace-nowrap flex-1 text-center font-medium",title:"Ver alternativa",children:"Alternativa"}),e.jsxs("button",{onClick:()=>{Ks("oportunidade_rejeitada",I),ua(ue=>ue.filter(we=>we.id!==I.id))},className:"flex items-center gap-1 text-red-500 hover:text-red-600 transition-colors whitespace-nowrap font-medium",title:"Ignorar sugest√£o",children:[e.jsx("span",{children:"Ignorar"}),e.jsx(ma,{className:"w-3 h-3"})]})]})]},I.id)),We.length===0&&e.jsx("div",{className:"flex items-center justify-center py-8 text-gray-400",children:e.jsx("p",{className:"text-xs",children:"Nenhuma oportunidade dispon√≠vel"})})]}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-200 bg-white",children:e.jsx("p",{className:"text-[10px] text-gray-400 text-center",children:We.length>0?`${Math.min(We.length,6)} oportunidades`:""})})]})}),e.jsx("button",{onClick:()=>Ue(!ia),className:"fixed right-0 bottom-20 bg-blue-600 hover:bg-blue-700 text-white rounded-l-lg shadow-lg transition-all z-10 flex items-center gap-1",style:{right:ia?"208px":"0",padding:ia?"6px":"6px 8px"},title:ia?"Recolher vendas recentes":"Expandir vendas recentes",children:ia?e.jsx(st,{className:"w-4 h-4"}):e.jsxs(e.Fragment,{children:[e.jsx(Bn,{className:"w-4 h-4"}),e.jsx("span",{className:"text-[10px] font-medium whitespace-nowrap",children:"Vendas"})]})}),w&&e.jsx(ui,{venda:o,onClose:()=>x(!1),onAnalisarVenda:d?Pa:null,onConfirmar:async()=>{if(x(!1),z&&o.id)try{const ue=(await F.get(`/vendas/${o.id}`)).data;let we=[],ve=0;try{const Le=await F.get(`/vendas/${o.id}/pagamentos`);we=Le.data.pagamentos||[],ve=Le.data.total_pago||0}catch(Le){console.error("Erro ao buscar pagamentos:",Le)}g({...ue,pagamentos:we,total_pago:ve}),console.log("‚úÖ Venda recarregada:",ue)}catch(I){console.error("Erro ao recarregar venda:",I)}else es();bs(),Q(I=>I+1)},onVendaAtualizada:async()=>{if(o.id){const I=await Gt(o.id);let ue=[],we=0;try{const ve=await F.get(`/vendas/${o.id}/pagamentos`);ue=ve.data.pagamentos||[],we=ve.data.total_pago||0}catch(ve){console.error("Erro ao buscar pagamentos:",ve)}g({...I,pagamentos:ue,total_pago:we}),ae(I.status==="finalizada"||I.status==="baixa_parcial"),bs()}}}),i&&e.jsx(ji,{onClose:()=>p(!1),onSucesso:()=>{p(!1),Q(I=>I+1),me(!0)}}),Ia&&e.jsx(Ri,{isOpen:Ia,itensCarrinho:o.itens,racaoIdFechada:Ea,onClose:()=>{const I=o.itens.filter(ue=>{const we=(ue.categoria_nome||"").toLowerCase();return we.includes("ra√ß√£o")||we.includes("racao")});I.length>0&&Na(I[I.length-1].produto_id),va(!1)}}),S&&o.cliente&&e.jsx(Ai,{isOpen:S,onClose:()=>$(!1),clienteId:o.cliente.id,onPendenciaAdicionada:()=>pt()}),b&&e.jsx(Mi,{onClose:()=>u(!1),onClienteCriado:I=>{D(I),u(!1)}}),Pe&&_e&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between z-10",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Adicionar Novo Endere√ßo ao Cliente"}),e.jsx("button",{onClick:Hs,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ma,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Endere√ßo *"}),e.jsxs("select",{value:_e.tipo,onChange:I=>ke({..._e,tipo:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"entrega",children:"üì¶ Entrega"}),e.jsx("option",{value:"cobranca",children:"üí∞ Cobran√ßa"}),e.jsx("option",{value:"comercial",children:"üè¢ Comercial"}),e.jsx("option",{value:"residencial",children:"üè† Residencial"}),e.jsx("option",{value:"trabalho",children:"üìç Trabalho"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apelido (opcional)"}),e.jsx("input",{type:"text",value:_e.apelido,onChange:I=>ke({..._e,apelido:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Ex: Casa da m√£e, Escrit√≥rio, Loja"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:_e.cep,onChange:I=>{const ue=I.target.value.replace(/\D/g,""),we=ue.length>5?`${ue.slice(0,5)}-${ue.slice(5,8)}`:ue;ke({..._e,cep:we})},onBlur:I=>Lt(I.target.value),maxLength:"9",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"00000-000"}),Ye&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Endere√ßo *"}),e.jsx("input",{type:"text",value:_e.endereco,onChange:I=>ke({..._e,endereco:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Rua, Avenida, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N√∫mero"}),e.jsx("input",{type:"text",value:_e.numero,onChange:I=>ke({..._e,numero:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"123"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complemento"}),e.jsx("input",{type:"text",value:_e.complemento,onChange:I=>ke({..._e,complemento:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Apto, Bloco, Sala..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bairro"}),e.jsx("input",{type:"text",value:_e.bairro,onChange:I=>ke({..._e,bairro:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Centro, Jardim..."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cidade *"}),e.jsx("input",{type:"text",value:_e.cidade,onChange:I=>ke({..._e,cidade:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"S√£o Paulo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsx("input",{type:"text",value:_e.estado,onChange:I=>ke({..._e,estado:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",maxLength:"2",placeholder:"SP"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"* Campos obrigat√≥rios"})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:Hs,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:qt,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Salvar Endere√ßo"})]})]})}),Qe&&Ee&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Alterar item da venda"}),e.jsx("button",{onClick:()=>be(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ma,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:Ee.produto_nome}),e.jsxs("p",{className:"text-sm text-gray-600",children:["C√≥digo: ",Ee.produto_codigo]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Pre√ßo ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:Ee.preco,onChange:I=>he({...Ee,preco:parseFloat(I.target.value)||0}),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade"}),e.jsx("input",{type:"number",step:"0.001",value:Ee.quantidade,readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subtotal"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:"R$"}),e.jsx("input",{type:"text",value:(Ee.preco*Ee.quantidade).toFixed(2),readOnly:!0,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-100"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de desconto"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>he({...Ee,tipoDesconto:"valor",descontoPercentual:0}),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${Ee.tipoDesconto==="valor"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"R$"}),e.jsx("button",{onClick:()=>he({...Ee,tipoDesconto:"percentual",descontoValor:0}),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${Ee.tipoDesconto==="percentual"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor do desconto"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:Ee.tipoDesconto==="valor"?"R$":"%"}),e.jsx("input",{type:"number",step:"0.01",value:Ee.tipoDesconto==="valor"?Ee.descontoValor:Ee.descontoPercentual,onChange:I=>{const ue=parseFloat(I.target.value)||0;Ee.tipoDesconto==="valor"?he({...Ee,descontoValor:ue}):he({...Ee,descontoPercentual:ue})},className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Total bruto"}),e.jsxs("span",{className:"font-medium",children:["R$ ",(Ee.preco*Ee.quantidade).toFixed(2)]})]}),(Ee.descontoValor>0||Ee.descontoPercentual>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm text-red-600 mt-1",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{className:"font-medium",children:["- R$ ",Ee.tipoDesconto==="valor"?Ee.descontoValor.toFixed(2):(Ee.preco*Ee.quantidade*Ee.descontoPercentual/100).toFixed(2)]})]}),e.jsx("div",{className:"flex justify-between text-sm text-orange-600 mt-1",children:e.jsxs("span",{children:[Ee.tipoDesconto==="percentual"&&`${Ee.descontoPercentual.toFixed(2)}% de desconto`,Ee.tipoDesconto==="valor"&&`${(Ee.descontoValor/(Ee.preco*Ee.quantidade)*100).toFixed(2)}% de desconto`]})})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg mt-2 pt-2 border-t border-blue-200",children:[e.jsx("span",{children:"Total l√≠quido"}),e.jsxs("span",{className:"text-green-600",children:["R$ ",(Ee.preco*Ee.quantidade-(Ee.tipoDesconto==="valor"?Ee.descontoValor:Ee.preco*Ee.quantidade*Ee.descontoPercentual/100)).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-between gap-3",children:[e.jsx("button",{onClick:()=>be(!1),className:"flex-1 px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Fechar"}),e.jsx("button",{onClick:()=>{o.itens.map(I=>(I.produto_id===Ee.produto_id&&Ve(o.itens.indexOf(I)),I)).filter(Boolean),be(!1)},className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Remover"}),e.jsx("button",{onClick:It,className:"flex-1 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Salvar"})]})]})}),Xe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"üí∞ Aplicar desconto"}),e.jsx("button",{onClick:()=>Je(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ma,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total bruto"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",o.subtotal.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de desconto"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ra("valor"),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${ca==="valor"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"R$"}),e.jsx("button",{onClick:()=>ra("percentual"),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${ca==="percentual"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-3 text-gray-500",children:ca==="valor"?"R$":"%"}),e.jsx("input",{type:"number",step:"0.01",value:pa,onChange:I=>la(parseFloat(I.target.value)||0),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-700",children:"Desconto"}),e.jsxs("span",{className:"text-red-600 font-medium",children:["- R$ ",ca==="valor"?pa.toFixed(2):(o.subtotal*pa/100).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-baseline border-t border-blue-200 pt-2 mt-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Total l√≠quido"}),e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:["R$ ",(ca==="valor"?o.subtotal-pa:o.subtotal-o.subtotal*pa/100).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>Je(!1),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Fechar"}),e.jsx("button",{onClick:()=>Vt(ca,pa),className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Aplicar"})]})]})}),l&&o.cliente&&e.jsx(Ei,{clienteId:o.cliente.id,clienteNome:o.cliente.nome,onClose:()=>C(!1),onSucesso:()=>{F.get(`/clientes/${o.cliente.id}/vendas-em-aberto`).then(I=>{I.data.resumo.total_vendas>0?R(I.data.resumo):R(null)}).catch(()=>R(null))}}),h&&o.cliente&&e.jsx(Fi,{clienteId:o.cliente.id,clienteNome:o.cliente.nome,onClose:()=>_(!1)}),d&&e.jsx(Pi,{mostrar:ne,onFechar:()=>pe(!1),dados:$e,carregando:Ke})]})})}function Mi({onClose:s,onClienteCriado:n}){const[t,d]=a.useState({nome:"",telefone:"",cpf:"",email:""}),[o,g]=a.useState(!1),[r,v]=a.useState(""),j=async f=>{if(f.preventDefault(),!t.nome||!t.telefone){v("Nome e telefone s√£o obrigat√≥rios");return}g(!0),v("");try{const y=await F.post("/clientes",{...t,tipo_cadastro:"cliente",tipo_pessoa:"PF"});n(y.data)}catch(y){console.error("Erro:",y),v("Erro ao cadastrar cliente")}finally{g(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Cadastro R√°pido"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ma,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-4",children:[r&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:r}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome *"}),e.jsx("input",{type:"text",value:t.nome,onChange:f=>d({...t,nome:f.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefone *"}),e.jsx("input",{type:"tel",value:t.telefone,onChange:f=>d({...t,telefone:f.target.value}),placeholder:"(00) 00000-0000",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CPF"}),e.jsx("input",{type:"text",value:t.cpf,onChange:f=>d({...t,cpf:f.target.value}),placeholder:"000.000.000-00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail"}),e.jsx("input",{type:"email",value:t.email,onChange:f=>d({...t,email:f.target.value}),placeholder:"cliente@email.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:s,disabled:o,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:o,className:"flex items-center space-x-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Cadastrando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ha,{className:"w-5 h-5"}),e.jsx("span",{children:"Cadastrar"})]})})]})]})]})})}function Li(){const s=fa(),[n,t]=a.useState([]),[d,o]=a.useState(!0),[g,r]=a.useState({data_inicio:"",data_fim:"",status:""});a.useEffect(()=>{v()},[g]);const v=async()=>{try{o(!0);const m={};g.data_inicio&&(m.data_inicio=g.data_inicio),g.data_fim&&(m.data_fim=g.data_fim),g.status&&(m.status_filter=g.status);const k=await hi(m);t(k)}catch(m){console.error("Erro ao carregar caixas:",m),alert("Erro ao carregar hist√≥rico de caixas")}finally{o(!1)}},j=async m=>{var k,w;if(confirm("Deseja realmente reabrir este caixa?"))try{await fi(m),alert("Caixa reaberto com sucesso!"),s("/pdv")}catch(x){console.error("Erro ao reabrir caixa:",x),alert(((w=(k=x.response)==null?void 0:k.data)==null?void 0:w.detail)||"Erro ao reabrir caixa")}},f=async(m,k)=>{try{const w=localStorage.getItem("token"),x=await fetch(`http://localhost:8000/caixas/${m}/pdf`,{headers:{Authorization:`Bearer ${w}`}});if(!x.ok)throw new Error("Erro ao gerar PDF");const b=await x.blob(),u=window.URL.createObjectURL(b),i=document.createElement("a");i.href=u,i.download=`Caixa_${k}_${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(u),document.body.removeChild(i),alert("PDF baixado com sucesso!")}catch(w){console.error("Erro ao baixar PDF:",w),alert("Erro ao gerar PDF do caixa")}},y=m=>{const k={aberto:{cor:"bg-green-100 text-green-800",icone:ha,texto:"Aberto"},fechado:{cor:"bg-gray-100 text-gray-800",icone:cs,texto:"Fechado"}},w=k[m]||k.fechado,x=w.icone;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium ${w.cor}`,children:[e.jsx(x,{className:"w-4 h-4"}),w.texto]})},c=(m,k)=>{const w=k-m;return{valor:Math.abs(w),tipo:w>0?"sobra":w<0?"falta":"ok"}};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Meus Caixas"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Hist√≥rico e gest√£o dos seus caixas"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data In√≠cio"}),e.jsx("input",{type:"date",value:g.data_inicio,onChange:m=>r({...g,data_inicio:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Fim"}),e.jsx("input",{type:"date",value:g.data_fim,onChange:m=>r({...g,data_fim:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:g.status,onChange:m=>r({...g,status:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"aberto",children:"Aberto"}),e.jsx("option",{value:"fechado",children:"Fechado"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>r({data_inicio:"",data_fim:"",status:""}),className:"w-full px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:"Limpar Filtros"})})]})}),d?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando caixas..."})]}):n.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg shadow-sm",children:[e.jsx(da,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Nenhum caixa encontrado"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:n.map(m=>{const k=m.status==="fechado"&&m.valor_esperado?c(m.valor_esperado,m.valor_informado):null;return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(za,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["Caixa #",m.numero_caixa]}),e.jsx("p",{className:"text-sm text-gray-600",children:m.usuario_nome})]})]}),y(m.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Cs,{className:"w-4 h-4"}),e.jsxs("span",{children:["Abertura: ",new Date(m.data_abertura).toLocaleString("pt-BR")]})]}),m.data_fechamento&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Os,{className:"w-4 h-4"}),e.jsxs("span",{children:["Fechamento: ",new Date(m.data_fechamento).toLocaleString("pt-BR")]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Abertura"}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["R$ ",m.valor_abertura.toFixed(2)]})]}),m.status==="fechado"&&m.valor_esperado&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Esperado"}),e.jsxs("div",{className:"text-lg font-semibold text-blue-900",children:["R$ ",m.valor_esperado.toFixed(2)]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Informado"}),e.jsxs("div",{className:"text-lg font-semibold text-green-900",children:["R$ ",m.valor_informado.toFixed(2)]})]}),e.jsxs("div",{className:`rounded-lg p-3 ${k.tipo==="ok"?"bg-gray-50":k.tipo==="sobra"?"bg-green-50":"bg-red-50"}`,children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Diferen√ßa"}),e.jsxs("div",{className:`text-lg font-semibold ${k.tipo==="ok"?"text-gray-900":k.tipo==="sobra"?"text-green-900":"text-red-900"}`,children:[k.tipo==="sobra"&&"+",k.tipo==="falta"&&"-","R$ ",k.valor.toFixed(2)]})]})]})]}),(m.observacoes_abertura||m.observacoes_fechamento)&&e.jsxs("div",{className:"border-t pt-4 mb-4",children:[m.observacoes_abertura&&e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Obs. Abertura:"})," ",m.observacoes_abertura]}),m.observacoes_fechamento&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Obs. Fechamento:"})," ",m.observacoes_fechamento]})]}),m.status==="fechado"&&e.jsxs("div",{className:"border-t pt-4 flex gap-3",children:[e.jsxs("button",{onClick:()=>j(m.id),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx($a,{className:"w-4 h-4"}),"Reabrir Caixa"]}),e.jsxs("button",{onClick:()=>f(m.id,m.numero_caixa),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[e.jsx(kt,{className:"w-4 h-4"}),"Baixar PDF"]})]})]})},m.id)})})]})}function qi(){var te,L,Z;const[s,n]=a.useState([]),[t,d]=a.useState(!0),[o,g]=a.useState(""),[r,v]=a.useState(""),[j,f]=a.useState(""),[y,c]=a.useState(""),[m,k]=a.useState(""),[w,x]=a.useState(null),[b,u]=a.useState(null),[i,p]=a.useState(""),[l,C]=a.useState(!1),h=[{value:"",label:"Todas"},{value:"Autorizada",label:"Autorizada"},{value:"Emitida DANFE",label:"Emitida DANFE"},{value:"Cancelada",label:"Cancelada"},{value:"Pendente",label:"Pendente"}];a.useEffect(()=>{_()},[o,r,j]);const _=async()=>{try{d(!0),k("");const A=new URLSearchParams;o&&A.append("situacao",o),r&&A.append("data_inicial",r),j&&A.append("data_final",j);const G=await F.get(`/nfe/?${A.toString()}`);n(G.data.notas||[])}catch(A){console.error("Erro ao carregar notas:",A),k("Erro ao carregar notas fiscais")}finally{d(!1)}},S=async(A,G)=>{try{const E=await F.get(`/nfe/${A}/danfe`,{responseType:"blob"}),P=window.URL.createObjectURL(new Blob([E.data])),H=document.createElement("a");H.href=P,H.setAttribute("download",`danfe_${G}.pdf`),document.body.appendChild(H),H.click(),H.remove()}catch(E){console.error("Erro ao baixar DANFE:",E),alert("Erro ao baixar DANFE")}},$=async(A,G)=>{try{const E=await F.get(`/nfe/${A}/xml`),P=new Blob([E.data.xml],{type:"application/xml"}),H=window.URL.createObjectURL(P),B=document.createElement("a");B.href=H,B.setAttribute("download",`nfe_${G}.xml`),document.body.appendChild(B),B.click(),B.remove()}catch(E){console.error("Erro ao baixar XML:",E),alert("Erro ao baixar XML")}},K=async()=>{var A,G;if(!i||i.length<15){alert("A justificativa deve ter no m√≠nimo 15 caracteres");return}try{C(!0),await F.post(`/nfe/${b.id}/cancelar`,{justificativa:i}),alert("Nota fiscal cancelada com sucesso!"),u(null),p(""),_()}catch(E){console.error("Erro ao cancelar nota:",E),alert(((G=(A=E.response)==null?void 0:A.data)==null?void 0:G.detail)||"Erro ao cancelar nota fiscal")}finally{C(!1)}},re=async(A,G)=>{var E,P;if(confirm(`Deseja realmente excluir a nota ${G}?

Isso apenas remove os dados da nota do sistema, n√£o cancela no Bling/SEFAZ.`))try{await F.delete(`/nfe/${A}`),alert("Nota fiscal exclu√≠da com sucesso!"),_()}catch(H){console.error("Erro ao excluir nota:",H),alert(((P=(E=H.response)==null?void 0:E.data)==null?void 0:P.detail)||"Erro ao excluir nota fiscal")}},M=A=>{switch(A==null?void 0:A.toLowerCase()){case"autorizada":case"emitida danfe":return"bg-green-100 text-green-800";case"cancelada":return"bg-red-100 text-red-800";case"pendente":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},R=A=>{switch(A==null?void 0:A.toLowerCase()){case"autorizada":case"emitida danfe":return e.jsx(ha,{className:"w-4 h-4"});case"cancelada":return e.jsx(ma,{className:"w-4 h-4"});case"pendente":return e.jsx(da,{className:"w-4 h-4"});default:return e.jsx(Xa,{className:"w-4 h-4"})}},J=s.filter(A=>{var E,P,H,B,N,O;if(!y)return!0;const G=y.toLowerCase();return((E=A.numero)==null?void 0:E.toLowerCase().includes(G))||((P=A.serie)==null?void 0:P.toLowerCase().includes(G))||((B=(H=A.cliente)==null?void 0:H.nome)==null?void 0:B.toLowerCase().includes(G))||((O=(N=A.cliente)==null?void 0:N.cpf_cnpj)==null?void 0:O.toLowerCase().includes(G))});return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Xa,{className:"w-8 h-8 text-blue-600"}),"Notas Fiscais de Sa√≠da"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie suas NF-e e NFC-e emitidas"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(St,{className:"w-5 h-5 text-gray-600"}),e.jsx("h2",{className:"font-semibold text-gray-800",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(As,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por n√∫mero, cliente...",value:y,onChange:A=>c(A.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("div",{children:e.jsx("input",{type:"date",value:r,onChange:A=>v(A.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),e.jsx("div",{children:e.jsx("input",{type:"date",value:j,onChange:A=>f(A.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),e.jsx("select",{value:o,onChange:A=>g(A.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:h.map(A=>e.jsx("option",{value:A.value,children:A.label},A.value))})]})]}),m&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 rounded-lg p-4 mb-6 flex items-center gap-2",children:[e.jsx(da,{className:"w-5 h-5"}),m]}),t?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Carregando notas fiscais..."})]}):J.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(Xa,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Nenhuma nota encontrada"}),e.jsx("p",{className:"text-gray-600",children:y||o||r||j?"Tente ajustar os filtros":"Emita sua primeira nota fiscal em uma venda"})]}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"N√∫mero"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Emiss√£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Situa√ß√£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:J.map(A=>{var G,E,P,H;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:A.numero}),e.jsxs("div",{className:"text-sm text-gray-500",children:["S√©rie ",A.serie]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:A.data_emissao?new Date(A.data_emissao).toLocaleDateString("pt-BR"):"-"})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((G=A.cliente)==null?void 0:G.nome)||"Cliente n√£o informado"}),e.jsx("div",{className:"text-sm text-gray-500",children:((E=A.cliente)==null?void 0:E.cpf_cnpj)||""})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium ${M(A.status)}`,children:[R(A.status),A.status||"Pendente"]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["R$ ",A.valor.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[(((P=A.status)==null?void 0:P.toLowerCase())==="autorizada"||((H=A.status)==null?void 0:H.toLowerCase())==="emitida danfe")&&e.jsx("button",{onClick:()=>u(A),className:"text-red-600 hover:text-red-900 p-1 hover:bg-red-50 rounded",title:"Cancelar NF-e",children:e.jsx(cs,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>re(A.venda_id,A.numero),className:"text-gray-600 hover:text-gray-900 p-1 hover:bg-gray-50 rounded",title:"Excluir nota do sistema",children:e.jsx(hs,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>S(A.id,A.numero),className:"text-blue-600 hover:text-blue-900 p-1 hover:bg-blue-50 rounded",title:"Baixar DANFE",children:e.jsx(_r,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>$(A.id,A.numero),className:"text-green-600 hover:text-green-900 p-1 hover:bg-green-50 rounded",title:"Baixar XML",children:e.jsx(kt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>x(A),className:"text-gray-600 hover:text-gray-900 p-1 hover:bg-gray-50 rounded",title:"Ver Detalhes",children:e.jsx(wt,{className:"w-5 h-5"})})]})})]},A.id)})})]})}),!t&&J.length>0&&e.jsxs("div",{className:"mt-4 text-sm text-gray-600 text-center",children:[J.length," ",J.length===1?"nota encontrada":"notas encontradas"]}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto m-4",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800",children:["Detalhes da Nota Fiscal #",w.numero]}),e.jsx("button",{onClick:()=>x(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(ma,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"N√∫mero"}),e.jsx("p",{className:"text-gray-900",children:w.numero})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"S√©rie"}),e.jsx("p",{className:"text-gray-900",children:w.serie})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Modelo"}),e.jsx("p",{className:"text-gray-900",children:w.modelo})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Tipo"}),e.jsx("p",{className:"text-gray-900",children:w.tipo==="nfe"?"NF-e":"NFC-e"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Chave de Acesso"}),e.jsx("p",{className:"text-gray-900 text-xs break-all",children:w.chave||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Cliente"}),e.jsx("p",{className:"text-gray-900",children:(te=w.cliente)==null?void 0:te.nome})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"CPF/CNPJ"}),e.jsx("p",{className:"text-gray-900",children:(L=w.cliente)==null?void 0:L.cpf_cnpj})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Valor Total"}),e.jsxs("p",{className:"text-gray-900 text-lg font-bold",children:["R$ ",w.valor.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Situa√ß√£o"}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium ${M(w.status)}`,children:[R(w.status),w.status]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{onClick:()=>S(w.id,w.numero),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(_r,{className:"w-5 h-5"}),"Baixar DANFE"]}),e.jsxs("button",{onClick:()=>$(w.id,w.numero),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[e.jsx(kt,{className:"w-5 h-5"}),"Baixar XML"]})]})]})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full m-4",children:[e.jsxs("div",{className:"bg-red-50 border-b px-6 py-4 flex items-center gap-3",children:[e.jsx(cs,{className:"w-6 h-6 text-red-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Cancelar Nota Fiscal"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Aten√ß√£o:"})," O cancelamento de uma nota fiscal √© irrevers√≠vel e ser√° enviado para a SEFAZ."]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Nota:"})," #",b.numero," - S√©rie ",b.serie]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Cliente:"})," ",(Z=b.cliente)==null?void 0:Z.nome]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Justificativa do Cancelamento *"}),e.jsx("textarea",{value:i,onChange:A=>p(A.target.value),placeholder:"Digite o motivo do cancelamento (m√≠nimo 15 caracteres)",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[i.length,"/15 caracteres"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{u(null),p("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",disabled:l,children:"Voltar"}),e.jsx("button",{onClick:K,disabled:l||i.length<15,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Cancelando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"w-5 h-5"}),"Confirmar Cancelamento"]})})]})]})]})})]})}const zi=()=>{const{clienteId:s}=Bs(),n=fa(),[t,d]=a.useState(null),[o,g]=a.useState([]),[r,v]=a.useState(!0),[j,f]=a.useState({tipo_evento:"",pet_id:""}),[y,c]=a.useState(!1);a.useEffect(()=>{m(),k()},[s]);const m=async()=>{try{const x=await F.get(`/clientes/${s}`);d(x.data)}catch(x){console.error("Erro ao carregar cliente:",x)}finally{v(!1)}},k=async()=>{try{const x=await F.get(`/pets/cliente/${s}`);g(x.data)}catch(x){console.error("Erro ao carregar pets:",x)}},w=()=>{f({tipo_evento:"",pet_id:""})};return r?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando..."})]})}):t?e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>n("/clientes"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(nt,{}),"Voltar para clientes"]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Timeline de ",t.nome]}),e.jsx("p",{className:"text-gray-600",children:"Hist√≥rico completo de eventos e intera√ß√µes"})]}),e.jsxs("button",{onClick:()=>c(!y),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(Ar,{}),"Filtros"]})]}),y&&e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Evento"}),e.jsxs("select",{value:j.tipo_evento,onChange:x=>f({...j,tipo_evento:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Todos os tipos"}),e.jsx("option",{value:"venda",children:"üõí Vendas"}),e.jsx("option",{value:"conta_receber",children:"üí∞ Contas a Receber"}),e.jsx("option",{value:"pet_cadastro",children:"üêæ Cadastro de Pet"}),e.jsx("option",{value:"pet_atualizacao",children:"‚úèÔ∏è Atualiza√ß√£o de Pet"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pet"}),e.jsxs("select",{value:j.pet_id,onChange:x=>f({...j,pet_id:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",disabled:o.length===0,children:[e.jsx("option",{value:"",children:"Todos os pets"}),o.map(x=>e.jsxs("option",{value:x.id,children:[x.nome," - ",x.especie]},x.id))]})]}),e.jsx("div",{className:"col-span-2 flex justify-end gap-2",children:e.jsxs("button",{onClick:w,className:"px-4 py-2 text-gray-600 hover:text-gray-900 flex items-center gap-2",children:[e.jsx(ps,{}),"Limpar filtros"]})})]})})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsx(zr,{clienteId:parseInt(s),limit:100,showHeader:!1})})]}):e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:"Cliente n√£o encontrado"})})};function Ii(){const{id:s}=Bs(),n=fa(),[t,d]=a.useState(null),[o,g]=a.useState([]),[r,v]=a.useState(!0),[j,f]=a.useState(!1),[y,c]=a.useState([]),[m,k]=a.useState(null),[w,x]=a.useState("entrada"),[b,u]=a.useState({quantidade:"",custo_unitario:"",observacao:"",lote:"",data_validade:"",data_fabricacao:""});a.useEffect(()=>{i()},[s]);const i=async()=>{var L,Z,A;try{v(!0),console.log("Carregando produto ID:",s);const G=await F.get(`/produtos/${s}`);console.log("Produto carregado:",G.data),d(G.data);const E=await F.get(`/estoque/movimentacoes/produto/${s}`);console.log("Movimenta√ß√µes carregadas:",E.data),g(E.data)}catch(G){console.error("Erro ao carregar dados:",G),console.error("Detalhes do erro:",(L=G.response)==null?void 0:L.data),Se.error(((A=(Z=G.response)==null?void 0:Z.data)==null?void 0:A.detail)||"Erro ao carregar dados do produto")}finally{v(!1)}},p=(L,Z=null)=>{var A,G;if((t==null?void 0:t.tipo_produto)==="KIT"&&(t==null?void 0:t.tipo_kit)==="VIRTUAL"&&!Z){Se.error(`‚ùå KIT VIRTUAL n√£o permite movimenta√ß√£o manual de estoque.

O estoque deste kit √© calculado automaticamente com base nos componentes.

Para alterar o estoque, movimente os produtos componentes individualmente.`,{duration:6e3});return}x(L),k(Z),u(Z?{quantidade:((A=Z.quantidade)==null?void 0:A.toString())||"",custo_unitario:((G=Z.custo_unitario)==null?void 0:G.toString())||"",observacao:Z.observacao||"",lote:Z.lote_id||"",data_validade:"",data_fabricacao:""}:{quantidade:"",custo_unitario:L==="entrada"&&(t==null?void 0:t.preco_custo)||"",observacao:"",lote:"",data_validade:"",data_fabricacao:"",retornar_componentes:!1}),f(!0)},l=()=>{y.length===o.length?c([]):c(o.map(L=>L.id))},C=L=>{y.includes(L)?c(y.filter(Z=>Z!==L)):c([...y,L])},h=async()=>{var L,Z;if(y.length===0){Se.error("Selecione pelo menos um lan√ßamento");return}if(confirm(`Deseja realmente excluir ${y.length} lan√ßamento(s)?`))try{const G=(await Promise.all(y.map(E=>F.delete(`/estoque/movimentacoes/${E}`)))).flatMap(E=>E.data.componentes_estornados||[]);G.length>0?Se.success(`${y.length} lan√ßamento(s) exclu√≠do(s)!
‚úÖ ${G.length} componente(s) estornado(s)`,{duration:5e3}):Se.success(`${y.length} lan√ßamento(s) exclu√≠do(s)`),c([]),i()}catch(A){console.error("Erro ao excluir:",A),Se.error(((Z=(L=A.response)==null?void 0:L.data)==null?void 0:Z.detail)||"Erro ao excluir lan√ßamentos")}},_=async L=>{var Z,A,G;L.preventDefault();try{if(m){const B={quantidade:parseFloat(b.quantidade),custo_unitario:b.custo_unitario?parseFloat(b.custo_unitario):null,observacao:b.observacao||null};await F.patch(`/estoque/movimentacoes/${m.id}`,B),Se.success("Lan√ßamento atualizado com sucesso!"),f(!1),k(null),i();return}let E="/estoque/",P={produto_id:parseInt(s),quantidade:parseFloat(b.quantidade),custo_unitario:b.custo_unitario?parseFloat(b.custo_unitario):null,observacao:b.observacao||null};if(w==="entrada")E+="entrada",P.tipo="entrada",P.motivo="compra",P.numero_lote=b.lote||null,P.data_validade=b.data_validade||null,P.data_fabricacao=b.data_fabricacao||null;else if(w==="saida")E+="saida",P.tipo="saida",P.motivo="saida_manual",P.numero_lote=b.lote||null,P.data_validade=b.data_validade||null,(t==null?void 0:t.tipo_produto)==="KIT"&&(t==null?void 0:t.tipo_kit)==="FISICO"&&(P.retornar_componentes=b.retornar_componentes===!0);else if(w==="balanco"){const B=parseFloat(b.quantidade),N=(t==null?void 0:t.estoque_atual)||0,O=B-N;E+=O>=0?"entrada":"saida",P.tipo=O>=0?"entrada":"saida",P.quantidade=Math.abs(O),P.motivo="balanco"}const H=await F.post(E,P);if(console.log("Response da entrada:",H.data),w==="entrada"&&H.data){const{custo_anterior:B,custo_unitario:N,variacao_preco:O}=H.data;if(O&&B!==null&&B!==void 0){let z="Lan√ßamento registrado!";O==="aumento"?(z+=` ‚¨ÜÔ∏è Custo aumentou de R$ ${B==null?void 0:B.toFixed(2)} para R$ ${N==null?void 0:N.toFixed(2)}`,Se.error(z,{duration:5e3})):O==="reducao"?(z+=` ‚¨áÔ∏è Custo reduziu de R$ ${B==null?void 0:B.toFixed(2)} para R$ ${N==null?void 0:N.toFixed(2)}`,Se.success(z,{duration:5e3})):O==="estavel"&&(z+=` Custo mantido em R$ ${N==null?void 0:N.toFixed(2)}`,Se(z,{icon:"‚ûñ",duration:3e3}))}else N?Se.success(`Lan√ßamento registrado! Custo: R$ ${N==null?void 0:N.toFixed(2)}`,{duration:3e3}):Se.success("Lan√ßamento registrado com sucesso!")}else if((Z=H.data)!=null&&Z.componentes_sensibilizados&&H.data.componentes_sensibilizados.length>0){const B=H.data.componentes_sensibilizados.length;Se.success(`Lan√ßamento registrado com sucesso!
‚úÖ ${B} componente(s) sensibilizado(s)`,{duration:4e3})}else Se.success("Lan√ßamento registrado com sucesso!");f(!1),i()}catch(E){console.error("Erro ao registrar lan√ßamento:",E),Se.error(((G=(A=E.response)==null?void 0:A.data)==null?void 0:G.detail)||"Erro ao registrar lan√ßamento")}},S=L=>{if(!L)return"-";const Z=new Date(L);return new Date(Z.getTime()-3*60*60*1e3).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"America/Sao_Paulo"})},$=L=>({compra:"Compra",venda:"Venda",venda_online:"Venda Online",ajuste:"Ajuste",saida_manual:"Sa√≠da Manual",devolucao:"Devolu√ß√£o",perda:"Perda",transferencia:"Transfer√™ncia",balanco:"Balan√ßo"})[L]||L,K=L=>L.referencia_tipo==="venda"?L.documento&&(L.documento.length===44||L.documento.startsWith("NF"))?{texto:`NF ${L.documento}`,icone:"nf-venda",cor:"text-red-600",link:null}:{texto:`Pedido #${L.referencia_id}`,icone:"pedido",cor:"text-orange-600",link:`/pdv?vendaId=${L.referencia_id}`}:L.motivo==="balanco"?{texto:"Balan√ßo",icone:"balanco",cor:"text-blue-600",link:null}:L.tipo==="saida"?{texto:"Sa√≠da Manual",icone:"manual",cor:"text-red-600",link:null}:L.tipo==="entrada"&&L.documento&&L.documento.length===44?{texto:`NF ${L.documento.substring(25,34)}`,icone:"nf-entrada",cor:"text-green-600",link:null}:L.tipo==="entrada"&&L.documento?{texto:L.documento,icone:"documento",cor:"text-blue-600",link:`/pdv?vendaId=${L.documento}`}:L.tipo==="entrada"?{texto:"Entrada Manual",icone:"manual",cor:"text-green-600",link:null}:{texto:"Manual",icone:"manual",cor:"text-gray-500",link:null},re=o.filter(L=>L.tipo==="entrada").reduce((L,Z)=>L+parseFloat(Z.quantidade||0),0),M=o.filter(L=>L.tipo==="saida").reduce((L,Z)=>L+parseFloat(Z.quantidade||0),0);if(r)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-gray-500",children:"Carregando..."})});if(!t)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-red-500",children:"Produto n√£o encontrado"})});const R=t.estoque_atual||0,J=t.estoque_minimo||0,te=R>J?"text-green-600":R===0?"text-red-600":"text-yellow-600";return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[(t==null?void 0:t.tipo_produto)==="KIT"&&(t==null?void 0:t.tipo_kit)==="VIRTUAL"&&e.jsx("div",{className:"mb-6 bg-indigo-50 border border-indigo-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-indigo-600 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-indigo-900 mb-1",children:"üß© KIT VIRTUAL - Estoque Calculado Automaticamente"}),e.jsxs("p",{className:"text-sm text-indigo-800",children:["Este √© um produto do tipo ",e.jsx("strong",{children:"KIT VIRTUAL"}),". O estoque √© calculado automaticamente com base nos componentes que o comp√µem.",e.jsx("br",{}),e.jsx("strong",{children:"N√£o √© poss√≠vel movimentar o estoque do kit diretamente."})," Para alterar o estoque, movimente os produtos componentes individualmente."]})]})]})}),(t==null?void 0:t.tipo_produto)==="KIT"&&(t==null?void 0:t.tipo_kit)==="FISICO"&&e.jsx("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-green-600 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-1",children:"üì¶ KIT F√çSICO - Estoque Pr√≥prio com Sensibiliza√ß√£o"}),e.jsxs("p",{className:"text-sm text-green-800",children:["Este √© um produto do tipo ",e.jsx("strong",{children:"KIT F√çSICO"}),". Possui estoque pr√≥prio e independente.",e.jsx("br",{}),e.jsx("strong",{children:"Importante:"})," Ao movimentar o estoque do kit, os estoques dos componentes tamb√©m ser√£o automaticamente sensibilizados na mesma propor√ß√£o."]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${R>J?"bg-green-100":R===0?"bg-red-100":"bg-yellow-100"}`,children:e.jsx("svg",{className:`w-6 h-6 ${te}`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n("/produtos"),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.nome})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{children:["C√≥digo: ",e.jsx("span",{className:"font-mono",children:t.codigo||t.sku})]}),t.codigo_barras&&e.jsxs("div",{children:["EAN: ",e.jsx("span",{className:"font-mono",children:t.codigo_barras})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-green-600 font-medium mb-1",children:"Total Entradas"}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:re.toFixed(2)})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-red-600 font-medium mb-1",children:"Total Sa√≠das"}),e.jsx("div",{className:"text-2xl font-bold text-red-700",children:M.toFixed(2)})]}),e.jsxs("div",{className:`rounded-lg p-3 ${R>J?"bg-blue-50":R===0?"bg-red-50":"bg-yellow-50"}`,children:[e.jsx("div",{className:`text-xs font-medium mb-1 ${R>J?"text-blue-600":R===0?"text-red-600":"text-yellow-600"}`,children:"Saldo Atual"}),e.jsxs("div",{className:`text-2xl font-bold ${R>J?"text-blue-700":R===0?"text-red-700":"text-yellow-700"}`,children:[R.toFixed(2)," ",t.unidade||"UN"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 font-medium mb-1",children:"Estoque M√≠n/M√°x"}),e.jsxs("div",{className:"text-lg font-bold text-gray-700",children:[J.toFixed(0)," / ",(t.estoque_maximo||0).toFixed(0)]})]})]}),e.jsx("div",{className:"relative group",children:e.jsxs("button",{onClick:()=>{(t==null?void 0:t.tipo_produto)==="KIT"&&(t==null?void 0:t.tipo_kit)==="VIRTUAL"?Se.error(`KIT VIRTUAL n√£o permite movimenta√ß√£o manual.

Movimente os componentes individualmente.`,{duration:4e3}):f(!0)},disabled:(t==null?void 0:t.tipo_produto)==="KIT"&&(t==null?void 0:t.tipo_kit)==="VIRTUAL",className:`px-6 py-2 rounded-lg transition-colors flex items-center gap-2 ${(t==null?void 0:t.tipo_produto)==="KIT"&&(t==null?void 0:t.tipo_kit)==="VIRTUAL"?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Incluir lan√ßamento"]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Lan√ßamentos"}),y.length>0&&e.jsxs("button",{onClick:h,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Excluir (",y.length,")"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 w-12",children:e.jsx("input",{type:"checkbox",checked:y.length===o.length&&o.length>0,onChange:l,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data e Hora"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Entrada"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sa√≠da"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pre√ßo Venda"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pre√ßo Compra"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Lote"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Origem"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Observa√ß√£o"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"px-6 py-8 text-center text-gray-500",children:"Nenhuma movimenta√ß√£o registrada"})}):o.map((L,Z)=>{const A=K(L),G=Z>0?o[Z-1]:null,E=G&&L.referencia_tipo==="venda"&&G.referencia_tipo==="venda"&&L.referencia_id===G.referencia_id;return e.jsxs("tr",{className:`hover:bg-gray-50 cursor-pointer ${E?"border-l-4 border-l-blue-500 bg-blue-50":""}`,onClick:()=>p(L.tipo,L),children:[e.jsx("td",{className:"px-4 py-3 w-12",onClick:P=>P.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:y.includes(L.id),onChange:()=>C(L.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:S(L.created_at)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-center",children:L.tipo==="entrada"?e.jsx("span",{className:"text-green-600 font-semibold",children:parseFloat(L.quantidade).toFixed(2)}):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-center",children:L.tipo==="saida"?e.jsx("span",{className:"text-red-600 font-semibold",children:parseFloat(L.quantidade).toFixed(2)}):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-right text-gray-900",children:t.preco_venda?`R$ ${t.preco_venda.toFixed(2)}`:"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-right",children:L.custo_unitario?L.variacao_custo?e.jsxs("div",{className:"relative group inline-block",title:`Custo anterior: R$ ${L.variacao_custo.custo_anterior.toFixed(2)}
Custo atual: R$ ${L.variacao_custo.custo_atual.toFixed(2)}
Diferen√ßa: R$ ${L.variacao_custo.diferenca_valor.toFixed(2)} (${L.variacao_custo.diferenca_percentual>0?"+":""}${L.variacao_custo.diferenca_percentual.toFixed(1)}%)`,children:[e.jsxs("span",{className:`font-semibold ${L.variacao_custo.tipo==="aumento"?"text-red-600":L.variacao_custo.tipo==="reducao"?"text-green-600":"text-gray-900"}`,children:["R$ ",L.custo_unitario.toFixed(2)]}),e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block z-50",children:e.jsxs("div",{className:"bg-gray-900 text-white text-xs rounded-lg py-2 px-3 whitespace-nowrap shadow-lg",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Varia√ß√£o de Custo"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Anterior: R$ ",L.variacao_custo.custo_anterior.toFixed(2)]}),e.jsxs("div",{children:["Atual: R$ ",L.variacao_custo.custo_atual.toFixed(2)]}),e.jsxs("div",{className:L.variacao_custo.tipo==="aumento"?"text-red-400":"text-green-400",children:[L.variacao_custo.tipo==="aumento"?"‚ñ≤":"‚ñº"," R$ ",Math.abs(L.variacao_custo.diferenca_valor).toFixed(2)," (",L.variacao_custo.diferenca_percentual>0?"+":"",L.variacao_custo.diferenca_percentual.toFixed(1),"%)"]})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2",children:e.jsx("div",{className:"border-4 border-transparent border-t-gray-900"})})]})})]}):e.jsxs("span",{className:"text-gray-900",children:["R$ ",L.custo_unitario.toFixed(2)]}):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-600",children:L.lote_info?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:L.lote_info.nome}),L.lote_info.consumido_acumulado!==void 0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",L.lote_info.consumido_acumulado.toFixed(0),"/",L.lote_info.total_lote.toFixed(0),")"]})]}):L.lote_nome?L.lote_nome:"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",onClick:P=>P.stopPropagation(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[E&&e.jsx("span",{className:"text-blue-600",title:"Mesmo pedido/venda",children:"‚Ü™"}),A.link?e.jsx("a",{href:A.link,onClick:P=>{P.preventDefault(),P.stopPropagation(),n(A.link)},className:`${A.cor} font-medium hover:underline cursor-pointer`,children:A.texto}):e.jsx("span",{className:`${A.cor} font-medium`,children:A.texto})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jsxs("div",{className:"flex items-center gap-2",children:[L.motivo&&L.motivo!=="compra"&&L.motivo!=="venda"&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs",children:$(L.motivo)}),L.observacao]})})]},L.id)})})]})})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:m?"Editar Lan√ßamento":"Novo Lan√ßamento"}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:_,className:"p-6 space-y-4",children:[!m&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo *"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>x("entrada"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${w==="entrada"?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Entrada"}),e.jsx("button",{type:"button",onClick:()=>x("saida"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${w==="saida"?"bg-red-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Sa√≠da"}),e.jsx("button",{type:"button",onClick:()=>x("balanco"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${w==="balanco"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Balan√ßo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:w==="balanco"?"Saldo Total *":"Quantidade *"}),e.jsx("input",{type:"number",step:"0.01",value:b.quantidade,onChange:L=>u({...b,quantidade:L.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0}),w==="balanco"&&e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Estoque atual: ",R,". Digite o novo saldo total."]})]}),w==="entrada"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pre√ßo de Compra"}),e.jsx("input",{type:"number",step:"0.01",value:b.custo_unitario,onChange:L=>u({...b,custo_unitario:L.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["N√∫mero do Lote ",e.jsx("span",{className:"text-gray-400",children:"(opcional)"})]}),e.jsx("input",{type:"text",value:b.lote,onChange:L=>u({...b,lote:L.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: LOTE-001"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Data de Validade ",e.jsx("span",{className:"text-gray-400",children:"(opcional)"})]}),e.jsx("input",{type:"date",value:b.data_validade,onChange:L=>u({...b,data_validade:L.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Data de Fabrica√ß√£o ",e.jsx("span",{className:"text-gray-400",children:"(opcional)"})]}),e.jsx("input",{type:"date",value:b.data_fabricacao,onChange:L=>u({...b,data_fabricacao:L.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),w==="saida"&&e.jsxs(e.Fragment,{children:[(t==null?void 0:t.tipo_produto)==="KIT"&&(t==null?void 0:t.tipo_kit)==="FISICO"&&e.jsx("div",{className:"p-4 bg-yellow-50 border-2 border-yellow-300 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",id:"retornar_componentes",checked:b.retornar_componentes===!0,onChange:L=>u({...b,retornar_componentes:L.target.checked}),className:"mt-1 h-5 w-5 text-green-600 focus:ring-green-500 border-gray-300 rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"retornar_componentes",className:"block text-sm font-semibold text-gray-900 cursor-pointer",children:"üîÑ Desmontar kit e retornar componentes ao estoque"}),e.jsxs("p",{className:"text-xs text-gray-700 mt-1",children:[e.jsx("strong",{children:"Marque esta op√ß√£o"})," se voc√™ desmontou o kit e quer devolver os produtos unit√°rios ao estoque."]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[e.jsx("strong",{children:"Deixe desmarcado"})," se houve perda, roubo ou venda do kit montado."]})]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["N√∫mero do Lote ",e.jsx("span",{className:"text-gray-400",children:"(opcional)"})]}),e.jsx("input",{type:"text",value:b.lote,onChange:L=>u({...b,lote:L.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: LOTE-001"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Deixe vazio para usar FIFO autom√°tico"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Data de Validade ",e.jsx("span",{className:"text-gray-400",children:"(opcional)"})]}),e.jsx("input",{type:"date",value:b.data_validade,onChange:L=>u({...b,data_validade:L.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observa√ß√£o"}),e.jsx("textarea",{value:b.observacao,onChange:L=>u({...b,observacao:L.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Observa√ß√µes sobre este lan√ßamento..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Incluir"})]})]})]})})]})}const Ti=()=>{const[s,n]=a.useState([]),[t,d]=a.useState([]),[o,g]=a.useState(!1),[r,v]=a.useState(!1),[j,f]=a.useState("todos"),[y,c]=a.useState("");a.useEffect(()=>{m()},[]);const m=async()=>{g(!0);try{const l=await F.get("/produtos/");n(l.data.items||[])}catch(l){console.error("Erro ao carregar produtos:",l),ce.error("Erro ao carregar produtos"),n([])}finally{g(!1)}},k=async()=>{var l,C;g(!0);try{const h=y?{descricao:y}:{},_=await F.get("/bling-sync/produtos",{params:h});d(_.data||[]),ce.success(`‚úÖ ${(_.data||[]).length} produtos encontrados no Bling`)}catch(h){console.error("Erro ao buscar no Bling:",h),ce.error(((C=(l=h.response)==null?void 0:l.data)==null?void 0:C.detail)||"Erro ao buscar produtos no Bling"),d([])}finally{g(!1)}},w=async(l,C)=>{var h,_;try{await F.post("/bling-sync/vincular",{produto_id:l,bling_id:C}),ce.success("‚úÖ Produto vinculado ao Bling com sucesso!"),m()}catch(S){ce.error(((_=(h=S.response)==null?void 0:h.data)==null?void 0:_.detail)||"Erro ao vincular produto")}},x=async l=>{var C,h;v(!0);try{const _=await F.post(`/bling-sync/sincronizar-estoque/${l}`,{});ce.success(`‚úÖ Estoque sincronizado!
Sistema: ${_.data.estoque_local} ‚Üí Bling: ${_.data.estoque_bling}`,{duration:4e3}),m()}catch(_){ce.error(((h=(C=_.response)==null?void 0:C.data)==null?void 0:h.detail)||"Erro ao sincronizar estoque")}finally{v(!1)}},b=async()=>{v(!0);const l=s.filter(_=>_.bling_id);if(l.length===0){ce.error("Nenhum produto vinculado ao Bling"),v(!1);return}let C=0,h=0;for(const _ of l)try{await F.post(`/bling-sync/sincronizar-estoque/${_.id}`,{}),C++}catch(S){h++,console.error(`Erro ao sincronizar produto ${_.id}:`,S)}ce.success(`‚úÖ Sincroniza√ß√£o conclu√≠da!
${C} produtos atualizados${h>0?`, ${h} erros`:""}`,{duration:5e3}),carregarDados(),v(!1)},u=async()=>{var l,C;g(!0);try{const h=await F.post("/bling-sync/reconciliar",{});ce.success(`‚úÖ Reconcilia√ß√£o conclu√≠da!
${h.data.total_processados} produtos processados
${h.data.diferencas_encontradas} diferen√ßas encontradas`,{duration:5e3}),m()}catch(h){ce.error(((C=(l=h.response)==null?void 0:l.data)==null?void 0:C.detail)||"Erro ao reconciliar estoques")}finally{g(!1)}},i=s.filter(l=>j==="sincronizados"?l.bling_id:j==="nao_sincronizados"?!l.bling_id:!0),p={total:s.length,sincronizados:s.filter(l=>l.bling_id).length,naoSincronizados:s.filter(l=>!l.bling_id).length};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"üîÑ Sincroniza√ß√£o Bling"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie a integra√ß√£o dos produtos com o Bling ERP"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:p.total}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Produtos"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:p.sincronizados}),e.jsx("div",{className:"text-sm text-gray-600",children:"Vinculados ao Bling"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:p.naoSincronizados}),e.jsx("div",{className:"text-sm text-gray-600",children:"N√£o Vinculados"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[p.total>0?(p.sincronizados/p.total*100).toFixed(1):0,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Taxa de Sincroniza√ß√£o"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"‚ö° A√ß√µes R√°pidas"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:b,disabled:r||p.sincronizados===0,className:"flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:r?"‚è≥ Sincronizando...":`üîÑ Sincronizar Todos (${p.sincronizados})`}),e.jsx("button",{onClick:u,disabled:o||p.sincronizados===0,className:"flex-1 bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:o?"‚è≥ Reconciliando...":"üîç Reconciliar Estoques"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-3",children:[e.jsx("strong",{children:"Sincronizar:"})," Atualiza o estoque do Bling com os valores do sistema.",e.jsx("strong",{className:"ml-4",children:"Reconciliar:"})," Compara e identifica diferen√ßas entre os estoques."]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"üîç Buscar Produtos no Bling"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:y,onChange:l=>c(l.target.value),placeholder:"Digite o nome do produto (deixe vazio para buscar todos)",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",onKeyPress:l=>l.key==="Enter"&&k()}),e.jsx("button",{onClick:k,disabled:o,className:"bg-green-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-green-700 disabled:bg-gray-400",children:o?"‚è≥ Buscando...":"üîç Buscar"})]}),t.length>0&&e.jsxs("div",{className:"mt-4 border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-2 font-semibold border-b",children:[t.length," produtos encontrados no Bling"]}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:t.map(l=>e.jsxs("div",{className:"px-4 py-3 border-b hover:bg-gray-50 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:l.descricao}),e.jsxs("div",{className:"text-sm text-gray-600",children:["ID Bling: ",l.id," | C√≥digo: ",l.codigo," | Estoque: ",l.estoque]})]}),e.jsxs("select",{onChange:C=>C.target.value&&w(parseInt(C.target.value),l.id),className:"px-3 py-2 border border-gray-300 rounded text-sm",children:[e.jsx("option",{value:"",children:"Vincular ao produto..."}),s.filter(C=>!C.bling_id).map(C=>e.jsxs("option",{value:C.id,children:[C.codigo," - ",C.nome]},C.id))]})]},l.id))})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>f("todos"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${j==="todos"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Todos (",p.total,")"]}),e.jsxs("button",{onClick:()=>f("sincronizados"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${j==="sincronizados"?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["‚úÖ Sincronizados (",p.sincronizados,")"]}),e.jsxs("button",{onClick:()=>f("nao_sincronizados"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${j==="nao_sincronizados"?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["‚ö†Ô∏è N√£o Sincronizados (",p.naoSincronizados,")"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"C√≥digo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Estoque Local"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"ID Bling"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"A√ß√µes"})]})}),e.jsx("tbody",{children:o&&i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:"‚è≥ Carregando produtos..."})}):i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:"Nenhum produto encontrado com os filtros selecionados"})}):i.map(l=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-mono text-sm",children:l.codigo})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold",children:l.nome}),l.categoria&&e.jsx("div",{className:"text-xs text-gray-500",children:l.categoria})]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`font-semibold ${(l.estoque_atual||0)<=(l.estoque_minimo||0)?"text-red-600":"text-green-600"}`,children:l.estoque_atual||0})}),e.jsx("td",{className:"px-4 py-3 text-center",children:l.bling_id?e.jsx("span",{className:"inline-block bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-semibold",children:l.bling_id}):e.jsx("span",{className:"text-gray-400 text-sm",children:"‚Äî"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:l.bling_id?e.jsx("span",{className:"inline-block bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-semibold",children:"‚úÖ VINCULADO"}):e.jsx("span",{className:"inline-block bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs font-semibold",children:"‚ö†Ô∏è N√ÉO VINCULADO"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:l.bling_id?e.jsx("button",{onClick:()=>x(l.id),disabled:r,className:"text-blue-600 hover:text-blue-800 font-semibold text-sm disabled:text-gray-400",title:"Sincronizar estoque com Bling",children:"üîÑ Sync"}):e.jsx("span",{className:"text-gray-400 text-sm",children:"‚Äî"})})]},l.id))})]})})]})},Vi=()=>{const[s,n]=a.useState([]),[t,d]=a.useState([]),[o,g]=a.useState([]),[r,v]=a.useState(!1),[j,f]=a.useState(!1),[y,c]=a.useState(!1),[m,k]=a.useState(null),[w,x]=a.useState(null),[b,u]=a.useState(!1),[i,p]=a.useState(!1),[l,C]=a.useState(null),[h,_]=a.useState({email:"",whatsapp:"",formatos:{pdf:!0,excel:!1}}),[S,$]=a.useState(!1),[K,re]=a.useState([]),[M,R]=a.useState(!1),[J,te]=a.useState(90),[L,Z]=a.useState(30),[A,G]=a.useState(!1),[E,P]=a.useState(!0),[H,B]=a.useState([]),[N,O]=a.useState({}),[z,ae]=a.useState({fornecedor_id:"",data_prevista_entrega:"",valor_frete:"0",valor_desconto:"0",observacoes:"",itens:[]}),[W,ie]=a.useState({produto_id:"",quantidade_pedida:"",preco_unitario:""}),[ee,Q]=a.useState(""),[de,me]=a.useState("");a.useEffect(()=>{Pe()},[]);const Pe=async()=>{try{const[U,le]=await Promise.all([F.get("/pedidos-compra/"),F.get("/clientes/?tipo_cadastro=fornecedor&apenas_ativos=true")]),Ne=Array.isArray(U.data)?U.data:U.data.items||U.data.pedidos||[],Re=Array.isArray(le.data)?le.data:le.data.items||le.data.clientes||[];n(Ne),d(Re)}catch(U){console.error("Erro ao carregar dados:",U),ce.error("Erro ao carregar dados")}},se=async U=>{if(!U){g([]);return}try{const le=await F.get(`/produtos/?fornecedor_id=${U}`);let Ne;Array.isArray(le.data)?Ne=le.data:le.data.items?Ne=le.data.items:le.data.produtos?Ne=le.data.produtos:Ne=[],Ne.length===0&&ce.warning("‚ö†Ô∏è Este fornecedor n√£o possui produtos vinculados. Edite os produtos para vincular ao fornecedor."),g(Ne)}catch(le){console.error("Erro ao carregar produtos:",le),ce.error("Erro ao carregar produtos do fornecedor")}},_e=U=>{const le=o.find(Ne=>Ne.id===parseInt(U));le&&(me(le.nome),le.preco_custo?ie({...W,produto_id:U,preco_unitario:le.preco_custo.toFixed(2)}):ie({...W,produto_id:U}))},ke=()=>{if(!W.produto_id||!W.quantidade_pedida||!W.preco_unitario){ce.error("Preencha todos os campos do item");return}const U=o.find(ne=>ne.id===parseInt(W.produto_id)),le=parseFloat(W.quantidade_pedida),Ne=parseFloat(W.preco_unitario),Re=parseInt(W.produto_id),q=z.itens.findIndex(ne=>ne.produto_id===Re);if(q!==-1){const ne=z.itens[q];if(window.confirm(`‚ö†Ô∏è O produto "${U.nome}" j√° est√° no pedido!

Quantidade atual: ${ne.quantidade_pedida}
Pre√ßo atual: R$ ${ne.preco_unitario.toFixed(2)}

Nova quantidade: ${le}
Novo pre√ßo: R$ ${Ne.toFixed(2)}

Deseja SOMAR a quantidade ao item existente?

‚úÖ OK = Somar quantidade (${ne.quantidade_pedida} + ${le} = ${ne.quantidade_pedida+le})
‚ùå CANCELAR = N√£o adicionar`)){const $e=[...z.itens];$e[q]={...ne,quantidade_pedida:ne.quantidade_pedida+le,preco_unitario:Ne,total:(ne.quantidade_pedida+le)*Ne},ae({...z,itens:$e}),ce.success(`‚úÖ Quantidade somada! Total: ${ne.quantidade_pedida+le}`)}else ce.info("Adi√ß√£o cancelada");me(""),ie({produto_id:"",quantidade_pedida:"",preco_unitario:""});return}ae({...z,itens:[...z.itens,{produto_id:Re,produto_nome:U.nome,quantidade_pedida:le,preco_unitario:Ne,desconto_item:0,total:le*Ne}]}),me(""),ie({produto_id:"",quantidade_pedida:"",preco_unitario:""})},Ye=U=>{ae({...z,itens:z.itens.filter((le,Ne)=>Ne!==U)})},ze=()=>{const U=z.itens.reduce((Re,q)=>Re+q.total,0),le=parseFloat(z.valor_frete||0),Ne=parseFloat(z.valor_desconto||0);return U+le-Ne},Qe=async()=>{if(!z.fornecedor_id){ce.error("Selecione um fornecedor primeiro");return}R(!0);try{const U=await F.get(`/pedidos-compra/sugestao/${z.fornecedor_id}`,{params:{periodo_dias:J,dias_cobertura:L,apenas_criticos:A,incluir_alerta:E}});re(U.data.sugestoes||[]),B([]),O({}),U.data.sugestoes.length===0?ce.info("Nenhuma sugest√£o encontrada com os filtros aplicados"):ce.success(`${U.data.sugestoes.length} produtos analisados`)}catch(U){console.error("Erro ao buscar sugest√µes:",U),ce.error("Erro ao gerar sugest√µes")}finally{R(!1)}},be=U=>{B(le=>le.includes(U)?le.filter(Ne=>Ne!==U):[...le,U])},Ee=(U,le)=>{O(Ne=>({...Ne,[U]:parseFloat(le)||0}))},he=U=>N[U.produto_id]!==void 0?N[U.produto_id]:U.quantidade_sugerida,Xe=()=>{$(!1),B([]),O({})},Je=()=>{const U=K.filter(le=>le.prioridade==="CR√çTICO"&&le.quantidade_sugerida>0).map(le=>le.produto_id);B(U)},ca=()=>{if(H.length===0){ce.error("Selecione pelo menos um produto");return}const le=K.filter(Ne=>H.includes(Ne.produto_id)).map(Ne=>{const Re=he(Ne);return{produto_id:Ne.produto_id,produto_nome:Ne.produto_nome,quantidade_pedida:Math.ceil(Re),preco_unitario:Ne.preco_unitario,desconto_item:0,total:Math.ceil(Re)*Ne.preco_unitario}});ae({...z,itens:[...z.itens,...le]}),ce.success(`${le.length} produtos adicionados ao pedido`),Xe()},ra=async U=>{var le,Ne;if(U.preventDefault(),z.itens.length===0){ce.error("Adicione pelo menos 1 item ao pedido");return}v(!0);try{const Re={...z,data_prevista_entrega:z.data_prevista_entrega?`${z.data_prevista_entrega}T12:00:00`:null};await F.post("/pedidos-compra/",Re),ce.success("‚úÖ Pedido criado com sucesso!"),f(!1),ae({fornecedor_id:"",data_prevista_entrega:"",valor_frete:"0",valor_desconto:"0",observacoes:"",itens:[]}),Pe()}catch(Re){ce.error(((Ne=(le=Re.response)==null?void 0:le.data)==null?void 0:Ne.detail)||"Erro ao criar pedido")}finally{v(!1)}},pa=async U=>{C(U),_({email:"",whatsapp:"",formatos:{pdf:!0,excel:!1}}),p(!0)},la=async()=>{var U,le;if(!h.email&&!h.whatsapp){ce.error("Informe um e-mail ou WhatsApp");return}if(!h.formatos.pdf&&!h.formatos.excel){ce.error("Selecione pelo menos um formato (PDF ou Excel)");return}try{await F.post(`/pedidos-compra/${l}/enviar`,{email:h.email,whatsapp:h.whatsapp,formatos:h.formatos}),ce.success("‚úÖ Pedido marcado como enviado!"),p(!1),Pe()}catch(Ne){ce.error(((le=(U=Ne.response)==null?void 0:U.data)==null?void 0:le.detail)||"Erro ao enviar pedido")}},oe=async()=>{var U,le;try{await F.post(`/pedidos-compra/${l}/enviar`,{envio_manual:!0}),ce.success("‚úÖ Pedido marcado como enviado manualmente!"),p(!1),Pe()}catch(Ne){ce.error(((le=(U=Ne.response)==null?void 0:U.data)==null?void 0:le.detail)||"Erro ao marcar pedido")}},ye=async U=>{var le,Ne;try{await F.post(`/pedidos-compra/${U}/confirmar`,{}),ce.success("‚úÖ Pedido confirmado!"),Pe()}catch(Re){ce.error(((Ne=(le=Re.response)==null?void 0:le.data)==null?void 0:Ne.detail)||"Erro ao confirmar pedido")}},Ce=async U=>{try{const le=await F.get(`/pedidos-compra/${U}/export/pdf`,{responseType:"blob"}),Ne=window.URL.createObjectURL(new Blob([le.data])),Re=document.createElement("a");Re.href=Ne,Re.setAttribute("download",`pedido_${U}.pdf`),document.body.appendChild(Re),Re.click(),Re.remove(),ce.success("üìÑ PDF exportado com sucesso!")}catch{ce.error("Erro ao exportar PDF")}},Be=async U=>{try{const le=await F.get(`/pedidos-compra/${U}/export/excel`,{responseType:"blob"}),Ne=window.URL.createObjectURL(new Blob([le.data])),Re=document.createElement("a");Re.href=Ne,Re.setAttribute("download",`pedido_${U}.xlsx`),document.body.appendChild(Re),Re.click(),Re.remove(),ce.success("üìä Excel exportado com sucesso!")}catch{ce.error("Erro ao exportar Excel")}},Ie=async U=>{try{const le=await F.get(`/pedidos-compra/${U.id}`);x(le.data),u(!0)}catch{ce.error("Erro ao carregar detalhes do pedido")}},Y=async U=>{var le,Ne;if(confirm("‚ö†Ô∏è Deseja reverter o status deste pedido para a etapa anterior?"))try{const Re=await F.post(`/pedidos-compra/${U}/reverter`,{});ce.success(`‚è™ Status revertido: ${Re.data.status_anterior} ‚Üí ${Re.data.status_atual}`),Pe()}catch(Re){ce.error(((Ne=(le=Re.response)==null?void 0:le.data)==null?void 0:Ne.detail)||"Erro ao reverter status")}},je=async U=>{var le,Ne,Re;if(U.status!=="rascunho"){ce.error("‚ö†Ô∏è Apenas pedidos em rascunho podem ser editados");return}try{const ne=(await F.get(`/pedidos-compra/${U.id}`)).data;c(!0),k(ne),ae({fornecedor_id:((le=ne.fornecedor_id)==null?void 0:le.toString())||"",data_prevista_entrega:ne.data_prevista_entrega?new Date(ne.data_prevista_entrega).toISOString().split("T")[0]:"",valor_frete:((Ne=ne.valor_frete)==null?void 0:Ne.toString())||"0",valor_desconto:((Re=ne.valor_desconto)==null?void 0:Re.toString())||"0",observacoes:ne.observacoes||"",itens:ne.itens.map(pe=>({produto_id:pe.produto_id,produto_nome:pe.produto_nome||`Produto ${pe.produto_id}`,quantidade_pedida:pe.quantidade_pedida,preco_unitario:pe.preco_unitario,desconto_item:pe.desconto_item||0,total:pe.quantidade_pedida*pe.preco_unitario-(pe.desconto_item||0)}))}),ne.fornecedor_id&&se(ne.fornecedor_id),f(!0),ce.success("üìù Modo de edi√ß√£o ativado")}catch{ce.error("Erro ao carregar pedido para edi√ß√£o")}},Me=async U=>{var le,Ne;if(U.preventDefault(),z.itens.length===0){ce.error("‚ö†Ô∏è Adicione pelo menos um item ao pedido");return}try{v(!0);const Re={...z,fornecedor_id:parseInt(z.fornecedor_id),valor_frete:parseFloat(z.valor_frete),valor_desconto:parseFloat(z.valor_desconto),data_prevista_entrega:z.data_prevista_entrega?`${z.data_prevista_entrega}T12:00:00`:null,itens:z.itens.map(q=>({produto_id:q.produto_id,quantidade_pedida:parseFloat(q.quantidade_pedida),preco_unitario:parseFloat(q.preco_unitario),desconto_item:parseFloat(q.desconto_item||0)}))};await F.put(`/pedidos-compra/${m.id}`,Re),ce.success("‚úèÔ∏è Pedido atualizado com sucesso!"),f(!1),c(!1),k(null),ae({fornecedor_id:"",data_prevista_entrega:"",valor_frete:"0",valor_desconto:"0",observacoes:"",itens:[]}),Pe()}catch(Re){ce.error(((Ne=(le=Re.response)==null?void 0:le.data)==null?void 0:Ne.detail)||"Erro ao atualizar pedido")}finally{v(!1)}},T=async U=>{try{const le=await F.get(`/pedidos-compra/${U.id}`);x(le.data),u(!0)}catch{ce.error("Erro ao carregar detalhes do pedido")}},X=async U=>{var le,Ne;try{await F.post(`/pedidos-compra/${w.id}/receber`,{itens:U}),ce.success("‚úÖ Recebimento processado com sucesso!"),u(!1),x(null),Pe()}catch(Re){ce.error(((Ne=(le=Re.response)==null?void 0:le.data)==null?void 0:Ne.detail)||"Erro ao processar recebimento")}},fe=U=>{const le={rascunho:"bg-gray-200 text-gray-800",enviado:"bg-blue-200 text-blue-800",confirmado:"bg-green-200 text-green-800",recebido_parcial:"bg-yellow-200 text-yellow-800",recebido_total:"bg-green-500 text-white",cancelado:"bg-red-200 text-red-800"};return e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${le[U]||"bg-gray-200"}`,children:U.replace("_"," ").toUpperCase()})};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"üõí Pedidos de Compra"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie seus pedidos aos fornecedores"})]}),e.jsx("button",{onClick:()=>f(!j),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors",children:j?"‚ùå Cancelar":"‚ûï Novo Pedido"})]}),j&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:y?"‚úèÔ∏è Editar Pedido":"Novo Pedido de Compra"}),e.jsx("button",{type:"button",onClick:()=>{f(!1),c(!1),k(null)},className:"text-gray-500 hover:text-gray-700",children:"‚úñÔ∏è"})]}),e.jsxs("form",{onSubmit:y?Me:ra,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fornecedor *"}),e.jsx("input",{list:"fornecedores-list",value:ee,onChange:U=>{const le=U.target.value;Q(le);const Ne=t.find(Re=>Re.nome===le);Ne?(ae({...z,fornecedor_id:Ne.id.toString(),itens:[]}),ie({produto_id:"",quantidade_pedida:"",preco_unitario:""}),se(Ne.id)):(ae({...z,fornecedor_id:"",itens:[]}),g([]))},placeholder:"Digite ou selecione o fornecedor",required:!!z.fornecedor_id,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsx("datalist",{id:"fornecedores-list",children:t.map(U=>e.jsx("option",{value:U.nome,children:U.cpf_cnpj?`- ${U.cpf_cnpj}`:""},U.id))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Digite ou selecione um fornecedor para carregar seus produtos"}),z.fornecedor_id&&e.jsx("button",{type:"button",onClick:()=>{$(!0),Qe()},className:"mt-2 w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition-all flex items-center justify-center gap-2",children:"üí° Sugest√£o Inteligente de Pedido"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Prevista Entrega"}),e.jsx("input",{type:"date",value:z.data_prevista_entrega,onChange:U=>ae({...z,data_prevista_entrega:U.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Itens do Pedido"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-4",children:[e.jsx("input",{list:"produtos-list",value:de,onChange:U=>{const le=U.target.value;me(le);const Ne=o.find(Re=>Re.nome===le);Ne?_e(Ne.id.toString()):ie({...W,produto_id:""})},placeholder:z.fornecedor_id?"Digite ou selecione o produto":"Selecione um fornecedor primeiro",disabled:!z.fornecedor_id,className:"col-span-2 px-4 py-2 border border-gray-300 rounded-lg disabled:bg-gray-100 focus:ring-2 focus:ring-blue-500"}),e.jsx("datalist",{id:"produtos-list",children:o.map(U=>e.jsx("option",{value:U.nome,children:`SKU: ${U.sku||U.codigo||"N/A"} | Barras: ${U.codigo_barras||"N/A"} | Estoque: ${U.estoque_atual||0}`},U.id))}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantidade",value:W.quantidade_pedida,onChange:U=>ie({...W,quantidade_pedida:U.target.value}),className:"px-4 py-2 border border-gray-300 rounded-lg"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Pre√ßo",value:W.preco_unitario,onChange:U=>ie({...W,preco_unitario:U.target.value}),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg"}),e.jsx("button",{type:"button",onClick:ke,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:"‚ûï"})]})]}),z.itens.length>0&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-sm font-semibold",children:"Produto"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold",children:"Pre√ßo"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold",children:"Total"}),e.jsx("th",{className:"px-4 py-2"})]})}),e.jsx("tbody",{children:z.itens.map((U,le)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:U.produto_nome}),e.jsx("td",{className:"px-4 py-2 text-right",children:U.quantidade_pedida}),e.jsxs("td",{className:"px-4 py-2 text-right",children:["R$ ",U.preco_unitario.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-2 text-right font-semibold",children:["R$ ",U.total.toFixed(2)]}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx("button",{type:"button",onClick:()=>Ye(le),className:"text-red-600 hover:text-red-800",children:"üóëÔ∏è"})})]},le))})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Frete (R$)"}),e.jsx("input",{type:"number",step:"0.01",value:z.valor_frete,onChange:U=>ae({...z,valor_frete:U.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Desconto (R$)"}),e.jsx("input",{type:"number",step:"0.01",value:z.valor_desconto,onChange:U=>ae({...z,valor_desconto:U.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Total"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["R$ ",ze().toFixed(2)]})]})]}),e.jsx("button",{type:"submit",disabled:r,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-400",children:r?"‚è≥ Processando...":y?"‚úèÔ∏è Salvar Altera√ß√µes":"‚úÖ Criar Pedido"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"N√∫mero"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Fornecedor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"A√ß√µes"})]})}),e.jsx("tbody",{children:s.map(U=>e.jsxs("tr",{className:`border-t hover:bg-gray-50 ${U.status==="rascunho"?"cursor-pointer":""}`,onClick:()=>U.status==="rascunho"&&je(U),title:U.status==="rascunho"?"Clique para editar":"",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[U.numero_pedido,U.foi_alterado_apos_envio&&e.jsx("span",{className:"px-2 py-1 text-xs bg-orange-100 text-orange-700 rounded font-semibold",title:"Este pedido foi alterado ap√≥s o envio",children:"‚ö†Ô∏è Alterado"})]})}),e.jsx("td",{className:"px-4 py-3",children:U.fornecedor_id}),e.jsx("td",{className:"px-4 py-3",children:new Date(U.data_pedido).toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold",children:["R$ ",U.valor_final.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-center",children:fe(U.status)}),e.jsx("td",{className:"px-4 py-3 text-center",onClick:le=>le.stopPropagation(),children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>Ie(U),className:"px-2 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 text-xs font-semibold",title:"Ver detalhes completos do pedido",children:"üîç Ver"}),e.jsx("button",{onClick:()=>Ce(U.id),className:"px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 text-xs font-semibold",title:"Exportar PDF",children:"üìÑ PDF"}),e.jsx("button",{onClick:()=>Be(U.id),className:"px-2 py-1 bg-green-100 text-green-700 rounded hover:bg-green-200 text-xs font-semibold",title:"Exportar Excel",children:"üìä Excel"}),U.status==="rascunho"&&e.jsx("button",{onClick:()=>pa(U.id),className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs font-semibold",title:"Enviar pedido ao fornecedor",children:"üì§ Enviar"}),U.status==="enviado"&&e.jsx("button",{onClick:()=>ye(U.id),className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-xs font-semibold",title:"Confirmar recebimento do pedido pelo fornecedor",children:"‚úÖ Confirmar"}),(U.status==="confirmado"||U.status==="recebido_parcial")&&e.jsx("button",{onClick:()=>T(U),className:"px-3 py-1 bg-purple-600 text-white rounded hover:bg-purple-700 text-xs font-semibold",title:"Registrar entrada de produtos no estoque",children:"üì¶ Receber"}),U.status!=="rascunho"&&U.status!=="recebido_total"&&e.jsx("button",{onClick:()=>Y(U.id),className:"px-2 py-1 bg-orange-100 text-orange-700 rounded hover:bg-orange-200 text-xs font-semibold",title:"Reverter para status anterior",children:"‚è™ Reverter"})]})})]},U.id))})]})}),b&&w&&e.jsx(Oi,{pedido:w,onClose:()=>{u(!1),x(null)},onReceber:X}),i&&e.jsx(Bi,{pedidoId:l,onClose:()=>p(!1),onEnviar:la,onEnvioManual:oe,dadosEnvio:h,setDadosEnvio:_}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-7xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"üí° Sugest√£o Inteligente de Pedido"}),e.jsx("p",{className:"text-purple-100",children:"An√°lise baseada em vendas e estoque atual"})]}),e.jsx("button",{onClick:Xe,className:"text-white hover:bg-white hover:bg-opacity-20 rounded-lg p-2",children:"‚úñÔ∏è"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-purple-100 mb-1",children:"Per√≠odo de An√°lise"}),e.jsxs("select",{value:J,onChange:U=>te(parseInt(U.target.value)),className:"w-full px-3 py-2 rounded-lg text-gray-800 focus:ring-2 focus:ring-purple-300",children:[e.jsx("option",{value:30,children:"√öltimos 30 dias"}),e.jsx("option",{value:60,children:"√öltimos 60 dias"}),e.jsx("option",{value:90,children:"√öltimos 90 dias"}),e.jsx("option",{value:180,children:"√öltimos 180 dias"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-purple-100 mb-1",children:"Cobertura de Estoque"}),e.jsxs("select",{value:L,onChange:U=>Z(parseInt(U.target.value)),className:"w-full px-3 py-2 rounded-lg text-gray-800 focus:ring-2 focus:ring-purple-300",children:[e.jsx("option",{value:15,children:"15 dias"}),e.jsx("option",{value:30,children:"30 dias"}),e.jsx("option",{value:45,children:"45 dias"}),e.jsx("option",{value:60,children:"60 dias"}),e.jsx("option",{value:90,children:"90 dias"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2 text-white cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:A,onChange:U=>G(U.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{children:"Apenas Cr√≠ticos"})]})}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2 text-white cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:E,onChange:U=>P(U.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{children:"Incluir Alertas"})]})}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:Qe,disabled:M,className:"w-full bg-white text-purple-600 px-4 py-2 rounded-lg font-semibold hover:bg-purple-50 disabled:opacity-50",children:M?"üîÑ Analisando...":"üîç Atualizar"})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:M?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Analisando produtos e calculando sugest√µes..."})]})}):K.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhuma sugest√£o encontrada com os filtros aplicados"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Tente ajustar os filtros acima"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex gap-3",children:[e.jsx("button",{onClick:Je,className:"bg-red-100 text-red-700 px-4 py-2 rounded-lg font-semibold hover:bg-red-200",children:"üî¥ Selecionar Todos Cr√≠ticos"}),e.jsx("div",{className:"flex-1"}),e.jsxs("span",{className:"text-gray-600",children:[H.length," de ",K.length," produtos selecionados"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:e.jsx("input",{type:"checkbox",onChange:U=>{U.target.checked?B(K.map(le=>le.produto_id)):B([])},checked:H.length===K.length,className:"w-4 h-4 rounded"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Prioridade"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Consumo/dia"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Dias Restantes"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Qtd Sugerida"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Pre√ßo Unit."}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Tend√™ncia"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:K.map(U=>e.jsxs("tr",{className:`hover:bg-gray-50 ${H.includes(U.produto_id)?"bg-purple-50":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:H.includes(U.produto_id),onChange:()=>be(U.produto_id),className:"w-4 h-4 rounded"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${U.prioridade==="CR√çTICO"?"bg-red-100 text-red-700":U.prioridade==="ALERTA"?"bg-yellow-100 text-yellow-700":U.prioridade==="ATEN√á√ÉO"?"bg-orange-100 text-orange-700":"bg-green-100 text-green-700"}`,children:U.prioridade})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:U.produto_nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:["SKU: ",U.produto_sku||"N/A"," | Barras: ",U.produto_codigo_barras||"N/A"]}),U.observacao&&e.jsx("div",{className:"text-xs text-gray-600 mt-1 italic",children:U.observacao})]})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("div",{className:"font-medium",children:U.estoque_atual}),e.jsxs("div",{className:"text-xs text-gray-500",children:["M√≠n: ",U.estoque_minimo]})]}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:U.consumo_diario.toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:`font-semibold ${U.dias_estoque&&U.dias_estoque<7?"text-red-600":U.dias_estoque&&U.dias_estoque<14?"text-yellow-600":"text-green-600"}`,children:U.dias_estoque?`${U.dias_estoque} dias`:"‚àû"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"number",min:"0",step:"1",value:Math.ceil(he(U)),onChange:le=>Ee(U.produto_id,le.target.value),className:"w-20 px-2 py-1 text-right font-bold text-purple-600 border rounded focus:ring-2 focus:ring-purple-300"})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["R$ ",U.preco_unitario.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold",children:["R$ ",(he(U)*U.preco_unitario).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`text-xs ${U.tendencia==="CRESCIMENTO"?"text-green-600":U.tendencia==="QUEDA"?"text-red-600":"text-gray-600"}`,children:[U.tendencia==="CRESCIMENTO"?"üìà":U.tendencia==="QUEDA"?"üìâ":U.tendencia==="EST√ÅVEL"?"‚û°Ô∏è":"‚Äî",U.tendencia]})})]},U.produto_id))})]})})]})}),!M&&K.length>0&&e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Resumo da Sugest√£o:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:["üî¥ ",e.jsx("strong",{children:K.filter(U=>U.prioridade==="CR√çTICO").length})," cr√≠ticos"]}),e.jsxs("div",{children:["‚ö†Ô∏è ",e.jsx("strong",{children:K.filter(U=>U.prioridade==="ALERTA").length})," em alerta"]}),e.jsxs("div",{children:["üí∞ Total: ",e.jsxs("strong",{children:["R$ ",K.filter(U=>H.includes(U.produto_id)).reduce((U,le)=>U+he(le)*le.preco_unitario,0).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:Xe,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-100",children:"Cancelar"}),e.jsxs("button",{onClick:ca,disabled:H.length===0,className:"px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:["‚úÖ Adicionar ",H.length," Produtos ao Pedido"]})]})]})})]})})]})},Oi=({pedido:s,onClose:n,onReceber:t})=>{const[d,o]=a.useState(s.itens.map(r=>({item_id:r.id,quantidade_recebida:r.quantidade_pedida-r.quantidade_recebida,max:r.quantidade_pedida-r.quantidade_recebida}))),g=()=>{const r=d.filter(v=>v.quantidade_recebida>0).map(v=>({item_id:v.item_id,quantidade_recebida:parseFloat(v.quantidade_recebida)}));if(r.length===0){ce.error("Informe a quantidade recebida de pelo menos 1 item");return}t(r)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["üì¶ Receber Pedido ",s.numero_pedido]}),e.jsx("div",{className:"space-y-4",children:s.itens.map((r,v)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold mb-2",children:r.produto_nome}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Pedido:"}),e.jsx("span",{className:"ml-2 font-semibold",children:r.quantidade_pedida})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"J√° Recebido:"}),e.jsx("span",{className:"ml-2 font-semibold",children:r.quantidade_recebida})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Pendente:"}),e.jsx("span",{className:"ml-2 font-semibold text-orange-600",children:r.quantidade_pedida-r.quantidade_recebida})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade a Receber"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:d[v].max,value:d[v].quantidade_recebida,onChange:j=>{const f=parseFloat(j.target.value)||0,y=[...d];y[v].quantidade_recebida=Math.min(f,y[v].max),o(y)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]},r.id))}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{onClick:g,className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700",children:"‚úÖ Confirmar Recebimento"}),e.jsx("button",{onClick:n,className:"px-6 py-3 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50",children:"‚ùå Cancelar"})]})]})})},Bi=({pedidoId:s,onClose:n,onEnviar:t,onEnvioManual:d,dadosEnvio:o,setDadosEnvio:g})=>e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"üì§ Enviar Pedido ao Fornecedor"}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail do Fornecedor"}),e.jsx("input",{type:"email",value:o.email,onChange:r=>g({...o,email:r.target.value}),placeholder:"fornecedor@exemplo.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["WhatsApp (futuro)",e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Em breve)"})]}),e.jsx("input",{type:"tel",value:o.whatsapp,onChange:r=>g({...o,whatsapp:r.target.value}),placeholder:"(00) 00000-0000",className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Formatos para Envio"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.formatos.pdf,onChange:r=>g({...o,formatos:{...o.formatos,pdf:r.target.checked}}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm",children:"üìÑ PDF"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.formatos.excel,onChange:r=>g({...o,formatos:{...o.formatos,excel:r.target.checked}}),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),e.jsx("span",{className:"ml-2 text-sm",children:"üìä Excel"})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 pt-4",children:[e.jsx("button",{onClick:t,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors",children:"üìß Enviar por E-mail"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"ou"})})]}),e.jsx("button",{onClick:d,className:"w-full bg-gray-600 text-white py-3 rounded-lg font-semibold hover:bg-gray-700 transition-colors",children:"‚úÖ J√° enviei manualmente"}),e.jsx("button",{onClick:n,className:"w-full border border-gray-300 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-50",children:"‚ùå Cancelar"})]})]})]})}),Ui=()=>{var Ne,Re;const s=fa(),[n,t]=a.useState([]),[d,o]=a.useState([]),[g,r]=a.useState(!1),[v,j]=a.useState(!1),[f,y]=a.useState(null),[c,m]=a.useState(!1),[k,w]=a.useState(!1),[x,b]=a.useState(!1),[u,i]=a.useState(!1),[p,l]=a.useState(null),[C,h]=a.useState(!1),[_,S]=a.useState([]),[$,K]=a.useState(null),[re,M]=a.useState(!1),[R,J]=a.useState(!1),[te,L]=a.useState(null),[Z,A]=a.useState({}),[G,E]=a.useState("todos"),[P,H]=a.useState("loja"),[B,N]=a.useState({}),[O,z]=a.useState(!1),[ae,W]=a.useState(null),[ie,ee]=a.useState(null),[Q,de]=a.useState(!1),[me,Pe]=a.useState({sku:"",nome:"",descricao:"",preco_custo:"",preco_venda:"",margem_lucro:"",estoque_minimo:10,estoque_maximo:100}),[se,_e]=a.useState({});a.useEffect(()=>{console.log("üîÑ [EntradaXML] Componente montado, iniciando carregamento..."),ke()},[]);const ke=async()=>{var q,ne,pe,$e,Oe,Ke,He,ea,na;console.log("üìä [EntradaXML] Carregando dados...");try{const ia=localStorage.getItem("token");console.log("üîë [EntradaXML] Token obtido:",ia?"SIM":"N√ÉO");const Ue={Authorization:`Bearer ${ia}`};console.log("üåê [EntradaXML] Fazendo requisi√ß√µes para:",{notasEntrada:"/notas-entrada/",produtos:"/produtos/"});const[Ca,V]=await Promise.all([F.get("/notas-entrada/",{headers:Ue}),F.get("/produtos/",{headers:Ue,params:{ativo:null}})]);console.log("‚úÖ [EntradaXML] Dados carregados:",{notasEntrada:((q=Ca.data)==null?void 0:q.length)||0,produtos:((pe=(ne=V.data)==null?void 0:ne.items)==null?void 0:pe.length)||(($e=V.data)==null?void 0:$e.length)||0});const Fe=((Oe=V.data)==null?void 0:Oe.items)||V.data,Te=Fe.filter(ua=>ua.ativo===!0).length,We=Fe.filter(ua=>ua.ativo===!1).length;console.log("üìä [EntradaXML] Produtos por status:",{ativos:Te,inativos:We,total:Fe.length}),t(Ca.data),o(Fe)}catch(ia){console.error("‚ùå [EntradaXML] ERRO ao carregar dados:"),console.error("  - Mensagem:",ia.message),console.error("  - Response:",(Ke=ia.response)==null?void 0:Ke.data),console.error("  - Status:",(He=ia.response)==null?void 0:He.status),console.error("  - Stack:",ia.stack),ce.error(`Erro ao carregar dados: ${((na=(ea=ia.response)==null?void 0:ea.data)==null?void 0:na.detail)||ia.message}`)}},Ye=async q=>{var $e,Oe,Ke,He,ea;const ne=q.target.files[0];if(console.log("üì§ [EntradaXML] Upload iniciado"),console.log("  - Arquivo selecionado:",ne==null?void 0:ne.name),console.log("  - Tamanho:",ne==null?void 0:ne.size,"bytes"),console.log("  - Tipo:",ne==null?void 0:ne.type),!ne){console.warn("‚ö†Ô∏è [EntradaXML] Nenhum arquivo selecionado");return}if(!ne.name.toLowerCase().endsWith(".xml")){console.error("‚ùå [EntradaXML] Arquivo n√£o √© XML:",ne.name),ce.error("‚ùå Por favor, selecione um arquivo XML");return}j(!0);const pe=new FormData;pe.append("file",ne),console.log("üöÄ [EntradaXML] Enviando arquivo para:","/notas-entrada/upload"),console.log("üì¶ [EntradaXML] FormData preparado:",ne.name,ne.size,"bytes");try{const na=await F.post("/notas-entrada/upload",pe,{headers:{"Content-Type":"multipart/form-data"}});console.log("‚úÖ [EntradaXML] Upload bem-sucedido!"),console.log("  - Response data:",na.data);const ia=na.data.produtos_vinculados||0,Ue=na.data.itens_total||0;console.log(`üìä [EntradaXML] Produtos vinculados: ${ia}/${Ue}`),na.data.fornecedor_criado_automaticamente&&ce.success(`üè¢ Novo fornecedor cadastrado: ${na.data.fornecedor}`,{duration:4e3}),na.data.produtos_reativados>0&&ce.success(`‚ôªÔ∏è ${na.data.produtos_reativados} produto(s) inativo(s) reativado(s) automaticamente`,{duration:4e3}),ce.success(`‚úÖ NF-e ${na.data.numero_nota} processada! ${ia}/${Ue} produtos vinculados automaticamente`,{duration:5e3}),ke(),q.target.value=""}catch(na){console.error("‚ùå [EntradaXML] ERRO no upload:"),console.error("  - Mensagem:",na.message),console.error("  - Response data:",($e=na.response)==null?void 0:$e.data),console.error("  - Status:",(Oe=na.response)==null?void 0:Oe.status),console.error("  - Headers:",(Ke=na.response)==null?void 0:Ke.headers),console.error("  - Stack completo:",na.stack);const ia=((ea=(He=na.response)==null?void 0:He.data)==null?void 0:ea.detail)||na.message||"Erro ao processar XML da NF-e";console.error("  - Mensagem para usu√°rio:",ia),ce.error(`‚ùå ${ia}`)}finally{j(!1),console.log("üèÅ [EntradaXML] Upload finalizado")}},ze=async q=>{var Oe,Ke;const ne=Array.from(q.target.files);if(console.log("üì¶ [EntradaXML] Upload em lote iniciado -",ne.length,"arquivos"),ne.length===0){console.warn("‚ö†Ô∏è [EntradaXML] Nenhum arquivo selecionado");return}const pe=ne.filter(He=>!He.name.toLowerCase().endsWith(".xml"));if(pe.length>0){ce.error(`‚ùå ${pe.length} arquivo(s) n√£o s√£o XML: ${pe.map(He=>He.name).join(", ")}`);return}b(!0),i(!0),l(null);const $e=new FormData;ne.forEach(He=>{$e.append("files",He)}),console.log("üöÄ [EntradaXML] Enviando",ne.length,"arquivos para:","/notas-entrada/upload-lote");try{const He=await F.post("/notas-entrada/upload-lote",$e);console.log("‚úÖ [EntradaXML] Upload em lote bem-sucedido!"),console.log("  - Response:",He.data),l(He.data),He.data.sucessos>0&&ce.success(`‚úÖ ${He.data.sucessos}/${He.data.total_arquivos} nota(s) processada(s) com sucesso!`,{duration:5e3}),He.data.erros>0&&ce.error(`‚ö†Ô∏è ${He.data.erros}/${He.data.total_arquivos} nota(s) com erro`,{duration:5e3}),ke(),q.target.value=""}catch(He){console.error("‚ùå [EntradaXML] ERRO no upload em lote:",He),ce.error(`‚ùå Erro ao processar lote: ${((Ke=(Oe=He.response)==null?void 0:Oe.data)==null?void 0:Ke.detail)||He.message}`),i(!1)}finally{b(!1)}},Qe=async q=>{try{const ne=await F.get(`/notas-entrada/${q}`);ne.data.itens&&ne.data.itens.sort((pe,$e)=>pe.id-$e.id),y(ne.data),m(!0),H(ne.data.tipo_rateio||"loja")}catch{ce.error("Erro ao carregar detalhes da nota")}},be=async q=>{try{const ne=await F.get(`/notas-entrada/${q}`);y(ne.data),w(!0)}catch{ce.error("Erro ao carregar nota")}},Ee=async(q,ne,pe)=>{var $e,Oe;try{await F.post(`/notas-entrada/${q}/itens/${ne}/vincular?produto_id=${parseInt(pe)}`),ce.success("‚úÖ Produto vinculado com sucesso!");const Ke=await F.get(`/notas-entrada/${q}`);Ke.data.itens&&Ke.data.itens.sort((He,ea)=>He.id-ea.id),y(Ke.data)}catch(Ke){console.error("‚ùå Erro ao vincular produto:",Ke),ce.error(((Oe=($e=Ke.response)==null?void 0:$e.data)==null?void 0:Oe.detail)||"Erro ao vincular produto")}},he=async(q,ne)=>{var pe,$e;try{await F.post(`/notas-entrada/${q}/rateio`,{tipo_rateio:ne}),ce.success(`‚úÖ Nota configurada: ${ne==="online"?"100% Online":ne==="loja"?"100% Loja F√≠sica":"Rateio Parcial"}`);const Oe=await F.get(`/notas-entrada/${q}`);y(Oe.data),H(ne)}catch(Oe){console.error("‚ùå Erro ao salvar tipo de rateio:",Oe),ce.error((($e=(pe=Oe.response)==null?void 0:pe.data)==null?void 0:$e.detail)||"Erro ao salvar tipo de rateio")}},Xe=async(q,ne,pe)=>{var $e,Oe;try{const Ke=await F.post(`/notas-entrada/${q}/itens/${ne}/rateio`,{quantidade_online:parseFloat(pe)||0});ce.success("üìä Quantidade online configurada!");const He=Ke.data.nota_totais;ce.success(`Nota: ${He.percentual_online.toFixed(1)}% Online (R$ ${He.valor_online.toFixed(2)}) | ${He.percentual_loja.toFixed(1)}% Loja (R$ ${He.valor_loja.toFixed(2)})`),y(ea=>({...ea,percentual_online:He.percentual_online,percentual_loja:He.percentual_loja,valor_online:He.valor_online,valor_loja:He.valor_loja,itens:ea.itens.map(na=>na.id===ne?{...na,quantidade_online:parseFloat(pe)||0}:na)})),N(ea=>({...ea,[ne]:parseFloat(pe)||0}))}catch(Ke){console.error("‚ùå Erro ao salvar quantidade online:",Ke),ce.error(((Oe=($e=Ke.response)==null?void 0:$e.data)==null?void 0:Oe.detail)||"Erro ao salvar")}},Je=async q=>{var ne,pe;try{const $e=await F.get(`/notas-entrada/${q}/preview-processamento`);L($e.data),J(!0),m(!1);const Oe={};$e.data.itens.forEach(Ke=>{Ke.produto_vinculado&&(Oe[Ke.produto_vinculado.produto_id]={preco_venda:Ke.produto_vinculado.preco_venda_atual,margem:Ke.produto_vinculado.margem_atual})}),A(Oe)}catch($e){ce.error(((pe=(ne=$e.response)==null?void 0:ne.data)==null?void 0:pe.detail)||"Erro ao carregar preview")}},ca=Je,ra=async()=>{var q,ne;r(!0);try{const pe=[];Object.entries(Z).forEach(([Oe,Ke])=>{const He=te.itens.find(ea=>ea.produto_vinculado&&ea.produto_vinculado.produto_id==Oe);He&&He.produto_vinculado&&Ke.preco_venda!==He.produto_vinculado.preco_venda_atual&&pe.push({produto_id:parseInt(Oe),preco_venda:Ke.preco_venda})}),pe.length>0&&await F.post(`/notas-entrada/${te.nota_id}/atualizar-precos`,pe);const $e=await F.post(`/notas-entrada/${te.nota_id}/processar`,{});ce.success(`‚úÖ Nota processada! ${$e.data.itens_processados} itens lan√ßados no estoque`,{duration:5e3}),m(!1),y(null),J(!1),L(null),ke()}catch(pe){ce.error(((ne=(q=pe.response)==null?void 0:q.data)==null?void 0:ne.detail)||"Erro ao processar nota")}finally{r(!1)}},pa=(q,ne)=>ne>=100?q*2:q/(1-ne/100),la=(q,ne)=>q<=0?0:(q-ne)/q*100,oe=(q,ne,pe)=>{const $e=la(ne,pe);A(Oe=>({...Oe,[q]:{preco_venda:ne,margem:$e}}))},ye=(q,ne,pe)=>{const $e=pa(pe,ne);A(Oe=>({...Oe,[q]:{preco_venda:$e,margem:ne}}))},Ce=async(q,ne)=>{var pe,$e;if(confirm(`Tem certeza que deseja excluir a nota ${ne}?`)){r(!0);try{await F.delete(`/notas-entrada/${q}`),ce.success("üóëÔ∏è Nota exclu√≠da com sucesso!"),c&&(m(!1),y(null)),ke()}catch(Oe){ce.error((($e=(pe=Oe.response)==null?void 0:pe.data)==null?void 0:$e.detail)||"Erro ao excluir nota")}finally{r(!1)}}},Be=async(q,ne)=>{M(!0),K({id:q,nome:ne}),h(!0);try{const pe=await F.get(`/produtos/${q}/historico-precos`);S(pe.data)}catch{ce.error("Erro ao carregar hist√≥rico de pre√ßos"),h(!1)}finally{M(!1)}},Ie=async(q,ne)=>{var pe,$e;if(confirm(`‚ö†Ô∏è Tem certeza que deseja REVERTER a entrada da nota ${ne}?

Isso ir√°:
‚Ä¢ Remover as quantidades do estoque
‚Ä¢ Excluir os lotes criados
‚Ä¢ Estornar as contas a pagar lan√ßadas
‚Ä¢ Restaurar o status da nota para pendente`)){r(!0);try{const Oe=await F.post(`/notas-entrada/${q}/reverter`,{});ce.success(`‚úÖ Entrada revertida! ${Oe.data.itens_revertidos} produtos ajustados`,{duration:5e3}),c&&(m(!1),y(null)),ke()}catch(Oe){ce.error((($e=(pe=Oe.response)==null?void 0:pe.data)==null?void 0:$e.detail)||"Erro ao reverter entrada")}finally{r(!1)}}},Y=async(q,ne)=>{var pe,$e;try{await F.post(`/notas-entrada/${q}/itens/${ne}/desvincular`),ce.success("‚úÖ Produto desvinculado!");const Oe=await F.get(`/notas-entrada/${q}`);Oe.data.itens&&Oe.data.itens.sort((Ke,He)=>Ke.id-He.id),y(Oe.data)}catch(Oe){ce.error((($e=(pe=Oe.response)==null?void 0:pe.data)==null?void 0:$e.detail)||"Erro ao desvincular produto")}},je=q=>{var ua;const ne=((ua=q.produto_vinculado)==null?void 0:ua.produto_nome)||q.produto_nome;if(!ne)return[];const pe=[],$e=q.descricao_nf||q.descricao||"",Oe=ne||"";if(!$e||!Oe)return[];const Ke=$e.toLowerCase(),He=Oe.toLowerCase(),ea=/(\d+(?:[.,]\d+)?)\s*(kg|g|ml|l|un|und|unid)/gi,na=[...Ke.matchAll(ea)],ia=[...He.matchAll(ea)];if(na.length>0&&ia.length>0){const xe=na[0][0],Ae=ia[0][0];xe!==Ae&&pe.push(`Peso/Tamanho diferente: NF="${xe}" vs Produto="${Ae}"`)}const Ue=["preto","branco","vermelho","azul","verde","amarelo","rosa","roxo","laranja","marrom","cinza"],Ca=Ue.find(xe=>Ke.includes(xe)),V=Ue.find(xe=>He.includes(xe));Ca&&V&&Ca!==V&&pe.push(`Cor diferente: NF="${Ca}" vs Produto="${V}"`);const Fe=["frango","carne","peixe","cordeiro","salmao","salm√£o","atum","vegetais"],Te=Fe.find(xe=>Ke.includes(xe)),We=Fe.find(xe=>He.includes(xe));return Te&&We&&Te!==We&&pe.push(`Sabor diferente: NF="${Te}" vs Produto="${We}"`),(Ke.includes("cao")||Ke.includes("cachorro")||Ke.includes("dog"))&&(He.includes("gato")||He.includes("cat"))&&pe.push("‚ö†Ô∏è Animal diferente: NF para CACHORRO mas produto √© para GATO"),(Ke.includes("gato")||Ke.includes("cat"))&&(He.includes("cao")||He.includes("cachorro")||He.includes("dog"))&&pe.push("‚ö†Ô∏è Animal diferente: NF para GATO mas produto √© para CACHORRO"),pe},Me=async q=>{W(q),z(!0),de(!0),Pe({sku:"",nome:"",descricao:"",preco_custo:"",preco_venda:"",margem_lucro:"",estoque_minimo:10,estoque_maximo:100});try{const ne=await F.get(`/notas-entrada/${f.id}/itens/${q.id}/sugerir-sku`);ee(ne.data);let pe=ne.data.sku_proposto||q.codigo_produto||"PROD-"+q.id;ne.data.ja_existe&&ne.data.sugestoes&&ne.data.sugestoes.length>0&&(pe=(ne.data.sugestoes.find(Oe=>Oe.padrao)||ne.data.sugestoes[0]).sku),Pe({sku:pe,nome:q.descricao||q.descricao_produto||"Produto sem nome",descricao:q.descricao||q.descricao_produto||"",preco_custo:q.valor_unitario.toString(),preco_venda:(q.valor_unitario*1.5).toFixed(2),margem_lucro:"50",estoque_minimo:10,estoque_maximo:100}),console.log("‚úÖ Formul√°rio preenchido:",{sku:pe,nome:q.descricao,preco_custo:q.valor_unitario})}catch(ne){ce.error("Erro ao buscar sugest√µes de SKU"),console.error("Erro ao buscar SKU:",ne),Pe({sku:q.codigo_produto||"PROD-"+q.id,nome:q.descricao||"Produto sem nome",descricao:q.descricao||"",preco_custo:q.valor_unitario.toString(),preco_venda:(q.valor_unitario*1.5).toFixed(2),margem_lucro:"50",estoque_minimo:10,estoque_maximo:100})}finally{de(!1)}},T=async()=>{var q,ne;try{r(!0);const pe={...me,preco_custo:parseFloat(me.preco_custo)||0,preco_venda:parseFloat(me.preco_venda)||0,margem_lucro:parseFloat(me.margem_lucro)||0,estoque_minimo:parseInt(me.estoque_minimo)||10,estoque_maximo:parseInt(me.estoque_maximo)||100},$e=await F.post(`/notas-entrada/${f.id}/itens/${ae.id}/criar-produto`,pe);ce.success(`‚úÖ Produto ${$e.data.produto.codigo} criado e vinculado!`),z(!1),W(null),ee(null),await ke();const Oe=await F.get(`/notas-entrada/${f.id}`);y(Oe.data)}catch(pe){ce.error(((ne=(q=pe.response)==null?void 0:q.data)==null?void 0:ne.detail)||"Erro ao criar produto"),console.error(pe)}finally{r(!1)}},X=async()=>{var $e;const q=f.itens.filter(Oe=>!Oe.produto_id);if(q.length===0){ce.success("Todos os produtos j√° est√£o vinculados!");return}if(!window.confirm(`Criar ${q.length} produto(s) automaticamente?

Padr√µes aplicados:
‚Ä¢ Estoque m√≠nimo: 10
‚Ä¢ Estoque m√°ximo: 100
‚Ä¢ Margem de lucro: 50%

Voc√™ poder√° editar os produtos depois no cadastro.`))return;let pe;try{r(!0);let Oe=0,Ke=0;pe=ce.loading(`üì¶ Criando ${q.length} produtos...`);for(const ea of q)try{const na=await F.get(`/notas-entrada/${f.id}/itens/${ea.id}/sugerir-sku`);let ia=na.data.sku_proposto||ea.codigo_produto||`PROD-${ea.id}`;na.data.ja_existe&&(($e=na.data.sugestoes)==null?void 0:$e.length)>0&&(ia=(na.data.sugestoes.find(V=>V.padrao)||na.data.sugestoes[0]).sku);const Ue={sku:ia,nome:ea.descricao||"Produto sem nome",descricao:ea.descricao||"",preco_custo:parseFloat(ea.valor_unitario)||0,preco_venda:parseFloat((ea.valor_unitario*1.5).toFixed(2)),margem_lucro:50,estoque_minimo:10,estoque_maximo:100};await F.post(`/notas-entrada/${f.id}/itens/${ea.id}/criar-produto`,Ue),Oe++}catch(na){console.error(`Erro ao criar produto do item ${ea.id}:`,na),Ke++}Oe>0&&ce.success(`‚úÖ ${Oe} produto(s) criado(s) com sucesso!`),Ke>0&&ce.error(`‚ùå ${Ke} erro(s) ao criar produtos`),await ke();const He=await F.get(`/notas-entrada/${f.id}`);y(He.data)}catch(Oe){ce.error("Erro ao criar produtos em lote"),console.error(Oe)}finally{pe&&ce.dismiss(pe),r(!1)}},fe=(q,ne)=>q===0?0:((ne-q)/q*100).toFixed(2),U=q=>{const ne={pendente:"bg-yellow-200 text-yellow-800",processada:"bg-green-200 text-green-800",cancelada:"bg-red-200 text-red-800",erro:"bg-red-300 text-red-900"};return e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${ne[q]||"bg-gray-200"}`,children:q.toUpperCase()})},le=q=>{if(!q)return e.jsx("span",{className:"text-gray-400 text-sm",children:"N√£o vinculado"});const ne=q>=90?"alta":q>=70?"media":"baixa",pe={alta:"bg-green-100 text-green-800",media:"bg-yellow-100 text-yellow-800",baixa:"bg-orange-100 text-orange-800"};return e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-semibold ${pe[ne]}`,children:[q.toFixed(1),"% ",ne==="alta"?"‚úÖ":ne==="media"?"‚ö†Ô∏è":"‚ö°"]})};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"üìÑ Entrada por NF-e (XML)"}),e.jsx("p",{className:"text-gray-600",children:"Importe notas fiscais eletr√¥nicas e vincule produtos automaticamente"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-8 mb-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx("svg",{className:"mx-auto h-16 w-16 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:v?"‚è≥ Processando XML...":"Selecione o arquivo XML da NF-e"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"O sistema ir√° processar automaticamente os dados da nota fiscal"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("label",{className:"inline-block",children:[e.jsx("input",{type:"file",accept:".xml",onChange:Ye,disabled:v||x,className:"hidden"}),e.jsx("span",{className:`
                px-6 py-3 rounded-lg font-semibold cursor-pointer inline-block
                ${v||x?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}
              `,children:v?"‚è≥ Processando...":"üìÅ Upload √önico"})]}),e.jsxs("label",{className:"inline-block",children:[e.jsx("input",{type:"file",accept:".xml",multiple:!0,onChange:ze,disabled:v||x,className:"hidden"}),e.jsx("span",{className:`
                px-6 py-3 rounded-lg font-semibold cursor-pointer inline-block
                ${v||x?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"}
              `,children:x?"‚è≥ Processando Lote...":"üì¶ Upload M√∫ltiplo"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"Formatos aceitos: XML de NF-e (padr√£o SEFAZ)"})]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Notas"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:n.filter(q=>q.status==="pendente").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pendentes"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:n.filter(q=>q.status==="processada").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Processadas"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:["R$ ",n.filter(q=>q.status==="processada").reduce((q,ne)=>q+(ne.valor_total||0),0).toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Valor Processado"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b bg-gray-50",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Notas Fiscais Importadas"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Chave NF-e"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Fornecedor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Data Emiss√£o"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Itens"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"A√ß√µes"})]})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500",children:"Nenhuma nota fiscal importada ainda. Fa√ßa o upload de um XML acima."})}):n.map(q=>e.jsxs("tr",{onClick:()=>be(q.id),className:"border-t hover:bg-blue-50 cursor-pointer transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"font-mono text-xs",children:[q.chave_acesso.substring(0,20),"..."]})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold",children:q.fornecedor_nome}),e.jsx("div",{className:"text-xs text-gray-500",children:q.fornecedor_cnpj})]}),e.jsx("td",{className:"px-4 py-3",children:new Date(q.data_emissao).toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold",children:["R$ ",(q.valor_total||0).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-semibold",children:[q.produtos_vinculados+q.produtos_nao_vinculados," itens"]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:U(q.status)}),e.jsx("td",{className:"px-4 py-3 text-center",onClick:ne=>ne.stopPropagation(),children:e.jsxs("div",{className:"flex gap-2 justify-center",children:[q.status==="pendente"&&e.jsx("button",{onClick:()=>Qe(q.id),className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded font-semibold text-sm",title:"Vincular produtos",children:"üîó Vincular"}),q.entrada_estoque_realizada?e.jsx("button",{onClick:()=>Ie(q.id,q.numero_nota),className:"text-orange-600 hover:text-orange-800 font-semibold text-sm",title:"Reverter entrada no estoque",children:"‚Ü©Ô∏è Reverter"}):e.jsx("button",{onClick:()=>Ce(q.id,q.numero_nota),className:"text-red-600 hover:text-red-800 font-semibold text-sm",title:"Excluir nota",children:"üóëÔ∏è Excluir"})]})})]},q.id))})]})})]}),c&&f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"üìÑ Detalhes da NF-e"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Chave: ",f.chave_acesso]})]}),e.jsx("button",{onClick:()=>{m(!1),y(null)},className:"text-gray-500 hover:text-gray-700 text-2xl",children:"√ó"})]}),e.jsx("div",{className:"px-6 py-4 border-b bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Fornecedor:"}),e.jsx("div",{className:"font-semibold",children:f.fornecedor_nome}),e.jsx("div",{className:"text-xs text-gray-500",children:f.fornecedor_cnpj}),f.fornecedor_id&&e.jsx("div",{className:"text-xs text-green-600 mt-1",children:"‚úÖ Cadastrado"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Data Emiss√£o:"}),e.jsx("div",{className:"font-semibold",children:new Date(f.data_emissao).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Valor Total:"}),e.jsxs("div",{className:"font-bold text-lg text-green-600",children:["R$ ",(f.valor_total||0).toFixed(2)]})]})]})}),f.fornecedor_id&&f.fornecedor_criado_automaticamente&&e.jsx("div",{className:"px-6 py-2 bg-blue-50 border-b border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:f.fornecedor_nome})," foi cadastrado automaticamente."]}),e.jsx("button",{onClick:()=>s(`/clientes/${f.fornecedor_id}`),className:"px-3 py-1 bg-blue-600 text-white rounded font-medium hover:bg-blue-700 text-xs",children:"üìù Completar Cadastro"})]})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-bold text-xl text-gray-800",children:["üì¶ Produtos da Nota (",f.itens.length,")"]}),f.status==="pendente"&&f.itens.some(q=>!q.produto_id)&&e.jsxs("button",{onClick:X,disabled:g,className:"px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400 flex items-center gap-2 text-sm",title:"Cria automaticamente todos os produtos n√£o vinculados com os padr√µes: Estoque m√≠n: 10, m√°x: 100, Margem: 50%",children:[e.jsx("span",{children:"‚ú® Criar Todos N√£o Vinculados"}),e.jsx("span",{className:"text-xs bg-purple-800 px-2 py-0.5 rounded",children:f.itens.filter(q=>!q.produto_id).length})]})]}),e.jsx("div",{className:"space-y-3",children:f.itens.map(q=>{const ne=je(q),pe=ne.length>0;return e.jsxs("div",{className:"border-2 border-gray-400 rounded-lg overflow-hidden bg-white shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] gap-0",children:[e.jsxs("div",{className:"bg-blue-50 border-r-2 border-gray-300 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs font-bold",children:"NF-e"}),le(q.confianca_vinculo)]}),e.jsx("div",{className:"font-semibold text-base mb-2 text-blue-900",children:q.descricao}),e.jsxs("div",{className:"space-y-1.5 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"C√≥digo:"}),e.jsx("span",{className:"font-mono font-semibold",children:q.codigo_produto})]}),q.ean&&q.ean!=="SEM GTIN"&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"EAN:"}),e.jsx("span",{className:"font-mono font-semibold",children:q.ean})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"NCM:"}),e.jsx("span",{className:"font-mono font-semibold",children:q.ncm})]}),e.jsxs("div",{className:"flex justify-between border-t pt-1.5 mt-1.5",children:[e.jsx("span",{className:"text-gray-600",children:"Qtd:"}),e.jsx("span",{className:"font-semibold",children:q.quantidade})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Unit.:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",q.valor_unitario.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["R$ ",q.valor_total.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"CFOP:"}),e.jsx("span",{className:"font-semibold",children:q.cfop})]})]}),(q.lote||q.data_validade)&&e.jsxs("div",{className:"mt-3 pt-3 border-t space-y-2",children:[q.lote&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"üì¶ Lote:"}),e.jsx("div",{className:"font-semibold text-purple-800",children:q.lote})]}),q.data_validade&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"üìÖ Validade:"}),e.jsx("div",{className:"font-semibold text-orange-800",children:new Date(q.data_validade).toLocaleDateString("pt-BR")})]})]})]}),e.jsx("div",{className:"flex flex-col items-center justify-center bg-gray-100 px-2 py-4",children:q.produto_id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Y(f.id,q.id),className:"text-3xl text-green-600 hover:text-red-600 transition-colors mb-2",title:"‚úÖ Vinculado - Clique para desvincular",children:"‚úì"}),pe&&e.jsx("div",{className:"bg-red-100 border-2 border-red-500 rounded-lg p-2 max-w-[200px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:"‚ö†Ô∏è"}),e.jsx("div",{className:"font-bold text-red-700 text-xs mb-1",children:"DIVERG√äNCIA!"}),e.jsx("div",{className:"text-[10px] text-red-600 space-y-0.5",children:ne.map(($e,Oe)=>e.jsxs("div",{children:["‚Ä¢ ",$e]},Oe))})]})})]}):e.jsx("div",{className:"text-3xl text-gray-400",title:"‚ùå N√£o vinculado",children:"‚úï"})}),e.jsx("div",{className:`p-4 ${q.produto_id?"bg-green-50":"bg-gray-50"}`,children:e.jsx("div",{className:`p-4 ${q.produto_id?"bg-green-50":"bg-gray-50"}`,children:f.status==="pendente"?e.jsx(e.Fragment,{children:q.produto_id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsx("div",{className:"bg-green-600 text-white px-2 py-1 rounded text-xs font-bold",children:"‚úÖ PRODUTO SISTEMA"})}),e.jsx("div",{className:"font-semibold text-base mb-3 text-green-900",children:q.produto_nome}),e.jsx("div",{className:"text-xs text-green-700 mb-3 italic",children:"üí° Para alterar o v√≠nculo, selecione outro produto ou clique no ‚úì para desvincular"}),e.jsxs("select",{value:q.produto_id,onChange:$e=>{$e.target.value&&$e.target.value!=q.produto_id&&Ee(f.id,q.id,$e.target.value)},className:"w-full px-3 py-2 border-2 border-green-400 rounded text-sm focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:q.produto_id,children:q.produto_nome}),Array.isArray(d)&&d.filter($e=>$e.id!==q.produto_id).map($e=>e.jsxs("option",{value:$e.id,children:[$e.codigo," - ",$e.nome," ",$e.descricao?`| ${$e.descricao.substring(0,50)}...`:""," (Est: ",$e.estoque_atual||0,")"]},$e.id))]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsx("div",{className:"bg-orange-600 text-white px-2 py-1 rounded text-xs font-bold",children:"‚ö†Ô∏è N√ÉO VINCULADO"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1",children:"üîç Pesquisar produto existente:"}),e.jsx("input",{type:"text",placeholder:"Digite nome ou SKU...",value:se[q.id]||"",onChange:$e=>_e({...se,[q.id]:$e.target.value}),className:"w-full px-3 py-2 border-2 border-gray-400 rounded focus:ring-2 focus:ring-blue-500 text-sm"})]}),se[q.id]&&se[q.id].length>=2&&e.jsxs("div",{className:"border-2 border-gray-300 rounded max-h-48 overflow-y-auto bg-white",children:[Array.isArray(d)&&d.filter($e=>{var Ke,He,ea;const Oe=se[q.id].toLowerCase();return((Ke=$e.nome)==null?void 0:Ke.toLowerCase().includes(Oe))||((He=$e.codigo)==null?void 0:He.toLowerCase().includes(Oe))||((ea=$e.descricao)==null?void 0:ea.toLowerCase().includes(Oe))}).sort(($e,Oe)=>$e.ativo===Oe.ativo?0:$e.ativo?-1:1).slice(0,15).map($e=>e.jsxs("button",{type:"button",onClick:()=>{Ee(f.id,q.id,$e.id),_e({...se,[q.id]:""})},className:`w-full text-left px-3 py-2 hover:bg-blue-50 border-b border-gray-200 last:border-b-0 text-xs ${$e.ativo?"":"text-red-600 font-bold"}`,children:[!$e.ativo&&"üî¥ ",$e.codigo," - ",$e.nome,!$e.ativo&&" [INATIVO]",e.jsxs("span",{className:"text-gray-500 ml-1",children:["(Est: ",$e.estoque_atual||0,")"]})]},`produto-${q.id}-${$e.id}`)),d.filter($e=>{var Ke,He,ea;const Oe=se[q.id].toLowerCase();return((Ke=$e.nome)==null?void 0:Ke.toLowerCase().includes(Oe))||((He=$e.codigo)==null?void 0:He.toLowerCase().includes(Oe))||((ea=$e.descricao)==null?void 0:ea.toLowerCase().includes(Oe))}).length===0&&e.jsx("div",{className:"px-3 py-4 text-center text-gray-500 text-xs",children:"‚ùå Nenhum produto encontrado"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 border-t border-gray-300"}),e.jsx("span",{className:"text-xs text-gray-500",children:"ou"}),e.jsx("div",{className:"flex-1 border-t border-gray-300"})]}),e.jsx("button",{onClick:()=>Me(q),className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 text-sm",children:"‚ûï Criar Novo Produto"})]})]})}):e.jsx("div",{children:q.produto_id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-green-600 text-white px-2 py-1 rounded text-xs font-bold inline-block mb-2",children:"‚úÖ VINCULADO"}),e.jsx("div",{className:"font-semibold text-base text-green-900",children:q.produto_nome})]}):e.jsx("div",{className:"bg-gray-600 text-white px-2 py-1 rounded text-xs font-bold inline-block",children:"‚ö†Ô∏è N√ÉO VINCULADO"})})})}),f.status==="pendente"&&P==="parcial"&&q.produto_id&&e.jsxs("div",{className:"col-span-3 p-4 border-t-2 border-gray-300 bg-gradient-to-r from-blue-50 via-gray-50 to-green-50",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-3 flex items-center text-sm",children:"üì¶ Quantidade destinada ao estoque online"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"üìã Total NF"}),e.jsx("input",{type:"number",value:q.quantidade,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded bg-gray-100 text-base font-semibold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"üåê Online"}),e.jsx("input",{type:"number",min:"0",max:q.quantidade,step:"0.01",value:B[q.id]??q.quantidade_online??0,onChange:$e=>{const Oe=parseFloat($e.target.value)||0;N({...B,[q.id]:Math.min(Oe,q.quantidade)})},className:"w-full px-3 py-2 border-2 border-blue-400 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base font-semibold",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"üè™ Loja"}),e.jsx("input",{type:"number",value:(q.quantidade-(B[q.id]??q.quantidade_online??0)).toFixed(2),disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded bg-gray-100 text-base font-semibold"})]})]}),e.jsxs("div",{className:"mt-3 text-sm text-gray-700 bg-white rounded-lg p-3 border border-gray-300 font-medium",children:["üíµ Valor online: R$ ",((B[q.id]??q.quantidade_online??0)*q.valor_unitario).toFixed(2)]}),B[q.id]!==void 0&&B[q.id]!==q.quantidade_online?e.jsx("button",{onClick:()=>Xe(f.id,q.id,B[q.id]),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 mt-3 text-sm",children:"üíæ Salvar Distribui√ß√£o"}):q.quantidade_online!==null&&q.quantidade_online!==void 0&&e.jsxs("div",{className:"mt-3 text-sm text-green-700 bg-green-50 rounded-lg p-3 border border-green-200 flex items-center justify-center font-medium",children:["‚úÖ Salvo: ",q.quantidade_online," online / ",(q.quantidade-q.quantidade_online).toFixed(2)," loja"]})]})]}),f.status==="processada"&&q.produto_id&&e.jsxs("div",{className:"mt-3 pt-3 border-t bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("span",{className:"text-blue-800 font-semibold",children:"‚úÖ Lan√ßado no estoque:"}),e.jsx("span",{className:"ml-2",children:q.produto_nome})]})]},q.id)})})]}),f.status==="pendente"&&e.jsxs("div",{className:"sticky bottom-0 bg-white border-t px-6 py-4 space-y-3",children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"üìä Distribui√ß√£o (informativo para relat√≥rios)"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Estoque unificado ‚Ä¢ Classifica√ß√£o apenas para an√°lises"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>he(f.id,"loja"),disabled:g,className:`px-3 py-1 rounded text-xs font-medium transition-colors ${P==="loja"?"bg-gray-800 text-white":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-100"} ${g?"opacity-50 cursor-not-allowed":""}`,children:"üè™ Loja"}),e.jsx("button",{onClick:()=>he(f.id,"online"),disabled:g,className:`px-3 py-1 rounded text-xs font-medium transition-colors ${P==="online"?"bg-gray-800 text-white":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-100"} ${g?"opacity-50 cursor-not-allowed":""}`,children:"üåê Online"}),e.jsx("button",{onClick:()=>he(f.id,"parcial"),disabled:g,className:`px-3 py-1 rounded text-xs font-medium transition-colors ${P==="parcial"?"bg-gray-800 text-white":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-100"} ${g?"opacity-50 cursor-not-allowed":""}`,children:"üìä Parcial"}),(f.percentual_online>0||f.tipo_rateio)&&e.jsxs("div",{className:"ml-auto flex gap-3 text-xs text-gray-600",children:[e.jsxs("span",{children:["Online: ",(f.percentual_online||0).toFixed(0),"%"]}),e.jsxs("span",{children:["Loja: ",(f.percentual_loja||100).toFixed(0),"%"]})]})]}),P==="parcial"&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-gray-100 rounded p-2",children:["üí° Defina a quantidade destinada ao ",e.jsx("strong",{children:"estoque online"})," em cada produto acima. O sistema calcula automaticamente a % baseado nos valores."]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[f.itens.filter(q=>q.produto_id).length," de ",f.itens.length," produtos vinculados"]}),e.jsxs("div",{className:"flex gap-3",children:[f.entrada_estoque_realizada?e.jsx("button",{onClick:()=>Ie(f.id,f.numero_nota),disabled:g,className:"px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 disabled:bg-gray-400",children:g?"‚è≥ Revertendo...":"‚Ü©Ô∏è Reverter Entrada"}):e.jsxs(e.Fragment,{children:[!f.entrada_estoque_realizada&&e.jsx("button",{onClick:()=>Ce(f.id,f.numero_nota),disabled:g,className:"px-6 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 disabled:bg-gray-400",children:"üóëÔ∏è Excluir Nota"}),f.itens.some(q=>q.produto_id)&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ca(f.id),disabled:g,className:"px-6 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400",children:"üí∞ Revisar Pre√ßos"}),e.jsx("button",{onClick:()=>Je(f.id),disabled:g,className:"px-6 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 disabled:bg-gray-400",children:g?"‚è≥ Processando...":"‚úÖ Processar Nota"})]})]}),e.jsx("button",{onClick:()=>{m(!1),y(null)},className:"px-6 py-2 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50",children:"Fechar"})]})]})]})]})}),O&&ae&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"‚ûï Criar Novo Produto"}),e.jsx("p",{className:"text-sm text-gray-600",children:"A partir do item da NF-e"})]}),e.jsx("button",{onClick:()=>{z(!1),W(null),ee(null)},className:"text-gray-500 hover:text-gray-700 text-2xl",children:"√ó"})]}),e.jsx("div",{className:"px-6 py-4",children:Q?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Gerando sugest√µes de SKU..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold text-blue-900 mb-2",children:"üìÑ Dados da NF-e:"}),e.jsxs("div",{className:"text-sm space-y-1 text-blue-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Descri√ß√£o:"})," ",ae.descricao]}),e.jsxs("div",{children:[e.jsx("strong",{children:"C√≥digo Fornecedor:"})," ",ae.codigo_produto]}),e.jsxs("div",{children:[e.jsx("strong",{children:"NCM:"})," ",ae.ncm]}),ae.ean&&e.jsxs("div",{children:[e.jsx("strong",{children:"EAN:"})," ",ae.ean]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Valor Unit√°rio:"})," R$ ",ae.valor_unitario.toFixed(2)]})]})]}),(ie==null?void 0:ie.ja_existe)&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-300 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"‚ö†Ô∏è"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-semibold text-yellow-900 mb-2",children:['C√≥digo do fornecedor "',ie.sku_proposto,'" j√° est√° em uso!']}),e.jsxs("div",{className:"text-sm text-yellow-800 mb-3",children:["Produto existente: ",e.jsx("strong",{children:ie.produto_existente.nome}),e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Um SKU alternativo foi sugerido automaticamente. Voc√™ pode alterar se preferir."})]}),e.jsx("div",{className:"text-sm text-yellow-800 mb-2 font-semibold",children:"Outras op√ß√µes de SKU dispon√≠veis:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ie.sugestoes.map(q=>e.jsxs("button",{onClick:()=>Pe({...me,sku:q.sku}),className:`px-3 py-1 rounded-lg text-sm font-semibold transition-all ${me.sku===q.sku?"bg-blue-600 text-white shadow-md":"bg-white border border-blue-300 text-blue-700 hover:bg-blue-50"} ${q.padrao?"ring-2 ring-yellow-400":""}`,children:[q.sku," ",q.padrao&&"‚≠ê"]},q.sku))})]})]})}),ie&&!ie.ja_existe&&e.jsx("div",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"‚úÖ"}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("strong",{children:"SKU dispon√≠vel!"})," O c√≥digo do fornecedor pode ser usado diretamente."]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["SKU / C√≥digo do Produto *",e.jsx("span",{className:"text-xs text-gray-500 font-normal ml-2",children:"(Baseado no c√≥digo do fornecedor)"})]}),e.jsx("input",{type:"text",value:me.sku,onChange:q=>Pe({...me,sku:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 font-mono",placeholder:"Ex: MGZ-12345"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"üí° Voc√™ pode editar o SKU se preferir"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Nome do Produto *"}),e.jsx("input",{type:"text",value:me.nome,onChange:q=>Pe({...me,nome:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Nome completo do produto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Descri√ß√£o"}),e.jsx("textarea",{value:me.descricao,onChange:q=>Pe({...me,descricao:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:"2",placeholder:"Descri√ß√£o detalhada (opcional)"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Pre√ßo de Custo *"}),e.jsx("input",{type:"number",step:"0.01",value:me.preco_custo,onChange:q=>{const ne=q.target.value,pe=parseFloat(me.margem_lucro)||0;Pe({...me,preco_custo:ne,preco_venda:ne?pa(parseFloat(ne),pe):""})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Margem (%) *"}),e.jsx("input",{type:"number",step:"0.01",value:me.margem_lucro,onChange:q=>{const ne=q.target.value,pe=parseFloat(me.preco_custo)||0;Pe({...me,margem_lucro:ne,preco_venda:pe&&ne?pa(pe,parseFloat(ne)):""})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Pre√ßo de Venda *"}),e.jsx("input",{type:"number",step:"0.01",value:me.preco_venda,onChange:q=>{const ne=q.target.value,pe=parseFloat(me.preco_custo)||0;Pe({...me,preco_venda:ne,margem_lucro:pe&&ne?fe(pe,parseFloat(ne)):""})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Estoque M√≠nimo"}),e.jsx("input",{type:"number",value:me.estoque_minimo,onChange:q=>Pe({...me,estoque_minimo:parseInt(q.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Estoque M√°ximo"}),e.jsx("input",{type:"number",value:me.estoque_maximo,onChange:q=>Pe({...me,estoque_maximo:parseInt(q.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]})]})}),e.jsxs("div",{className:"sticky bottom-0 bg-white border-t px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{z(!1),W(null),ee(null)},className:"px-6 py-2 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{onClick:T,disabled:g||!me.sku||!me.nome||!me.preco_custo||parseFloat(me.preco_custo)<=0||!me.preco_venda||parseFloat(me.preco_venda)<=0,className:"px-6 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:g?"‚è≥ Criando...":"‚úÖ Criar e Vincular Produto"})]})]})}),k&&f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["üìÑ NF-e ",f.numero_nota]}),e.jsxs("p",{className:"text-blue-100 mt-1",children:["S√©rie: ",f.serie]})]}),e.jsx("button",{onClick:()=>{w(!1),y(null)},className:"text-white hover:bg-white/20 rounded-full p-2 transition-colors",children:"‚úï"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-3",children:"üìã Dados da Nota"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Data Emiss√£o:"}),e.jsx("span",{className:"font-semibold",children:new Date(f.data_emissao).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{children:U(f.status)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Total:"}),e.jsxs("span",{className:"font-bold text-green-600",children:["R$ ",f.valor_total.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-3",children:"üè¢ Fornecedor"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Nome:"}),e.jsx("div",{className:"font-semibold",children:f.fornecedor_nome})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"CNPJ:"}),e.jsx("div",{className:"font-mono text-xs",children:f.fornecedor_cnpj})]})]})]})]}),e.jsxs("div",{className:"mb-6 p-3 bg-gray-50 rounded",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"üîë Chave de Acesso"}),e.jsx("div",{className:"font-mono text-xs break-all",children:f.chave_acesso})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((Ne=f.itens)==null?void 0:Ne.length)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Itens"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:f.produtos_vinculados}),e.jsx("div",{className:"text-sm text-gray-600",children:"Vinculados"})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:f.produtos_nao_vinculados}),e.jsx("div",{className:"text-sm text-gray-600",children:"N√£o Vinculados"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-3",children:"üì¶ Itens da Nota"}),e.jsx("div",{className:"space-y-3",children:(Re=f.itens)==null?void 0:Re.map((q,ne)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:q.descricao}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["C√≥digo: ",q.codigo_produto," | NCM: ",q.ncm]})]}),q.vinculado?e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded",children:"‚úì Vinculado"}):e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs font-semibold rounded",children:"‚ö† N√£o Vinculado"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 text-sm mt-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Qtd:"}),e.jsx("div",{className:"font-semibold",children:q.quantidade})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Unit:"}),e.jsxs("div",{className:"font-semibold",children:["R$ ",q.valor_unitario.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("div",{className:"font-semibold text-green-600",children:["R$ ",q.valor_total.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"CFOP:"}),e.jsx("div",{className:"font-semibold",children:q.cfop})]})]}),(q.lote||q.data_validade)&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3 text-sm",children:[q.lote&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsx("span",{className:"text-gray-600",children:"üì¶ Lote:"}),e.jsx("div",{className:"font-semibold text-purple-800",children:q.lote})]}),q.data_validade&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded p-2",children:[e.jsx("span",{className:"text-gray-600",children:"üìÖ Validade:"}),e.jsx("div",{className:"font-semibold text-orange-800",children:new Date(q.data_validade).toLocaleDateString("pt-BR")})]})]}),q.vinculado&&q.produto_nome&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"‚Üí Produto vinculado: "}),e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:q.produto_nome})]})]},q.id))})]})]}),e.jsxs("div",{className:"border-t p-6 bg-gray-50 flex justify-between items-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:f.entrada_estoque_realizada?e.jsx("span",{className:"text-green-600 font-semibold",children:"‚úÖ Entrada realizada no estoque"}):e.jsx("span",{className:"text-orange-600 font-semibold",children:"‚ö†Ô∏è Entrada ainda n√£o processada"})}),e.jsxs("div",{className:"flex gap-3",children:[f.status==="pendente"&&f.produtos_vinculados>0&&!f.entrada_estoque_realizada&&e.jsx(e.Fragment,{children:e.jsx("button",{onClick:()=>{w(!1),Je(f.id)},className:"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold",children:"üí∞ Revisar Pre√ßos e Processar"})}),f.status==="pendente"&&e.jsx("button",{onClick:()=>{w(!1),Qe(f.id)},className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold",children:"üîó Vincular Produtos"}),e.jsx("button",{onClick:()=>{w(!1),y(null)},className:"px-6 py-2 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50",children:"Fechar"})]})]})]})}),R&&te&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white p-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"üí∞ Revis√£o de Pre√ßos e Custos"}),e.jsxs("p",{className:"text-purple-100 mt-1",children:["NF-e ",te.numero_nota," - ",te.fornecedor_nome]})]}),e.jsx("div",{className:"px-6 py-3 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Filtrar:"}),(()=>{const q=te.itens.filter(Ke=>Ke.produto_vinculado!==null||Ke.produto_id!==null),ne=q.filter(Ke=>{var ea;return(((ea=Ke.produto_vinculado)==null?void 0:ea.variacao_custo_percentual)||Ke.variacao_custo_percentual||0)>0}).length,pe=q.filter(Ke=>{var ea;return(((ea=Ke.produto_vinculado)==null?void 0:ea.variacao_custo_percentual)||Ke.variacao_custo_percentual||0)<0}).length,$e=q.filter(Ke=>{var ea;return(((ea=Ke.produto_vinculado)==null?void 0:ea.variacao_custo_percentual)||Ke.variacao_custo_percentual||0)===0}).length,Oe=q.length;return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>E("todos"),className:`px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1 transition-all ${G==="todos"?"bg-blue-600 text-white shadow-md":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx("span",{className:"text-base",children:"üìã"}),"Todos (",Oe,")"]}),ne>0&&e.jsxs("button",{onClick:()=>E("aumentou"),className:`px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1 transition-all ${G==="aumentou"?"bg-red-600 text-white shadow-md":"bg-red-100 text-red-700 hover:bg-red-200"}`,children:[e.jsx("span",{className:"text-base",children:"üìà"}),ne," custo",ne>1?"s":""," maior",ne>1?"es":""]}),pe>0&&e.jsxs("button",{onClick:()=>E("diminuiu"),className:`px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1 transition-all ${G==="diminuiu"?"bg-green-600 text-white shadow-md":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:[e.jsx("span",{className:"text-base",children:"üìâ"}),pe," custo",pe>1?"s":""," menor",pe>1?"es":""]}),$e>0&&e.jsxs("button",{onClick:()=>E("igual"),className:`px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1 transition-all ${G==="igual"?"bg-gray-600 text-white shadow-md":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx("span",{className:"text-base",children:"‚û°Ô∏è"}),$e," sem altera√ß√£o"]})]})})()]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"space-y-6",children:te.itens.filter(q=>{var $e;if(!(q.produto_vinculado!==null||q.produto_id!==null))return!1;const pe=(($e=q.produto_vinculado)==null?void 0:$e.variacao_custo_percentual)||q.variacao_custo_percentual||0;return G==="todos"?!0:G==="aumentou"?pe>0:G==="diminuiu"?pe<0:G==="igual"?pe===0:!0}).map(q=>{const ne=q.produto_vinculado||{produto_id:q.produto_id,produto_nome:q.produto_nome,produto_codigo:q.produto_codigo,produto_ean:q.produto_ean,custo_anterior:q.custo_anterior,custo_novo:q.custo_novo,variacao_custo_percentual:q.variacao_custo_percentual,preco_venda_atual:q.preco_venda_atual,margem_atual:q.margem_atual,estoque_atual:q.estoque_atual};if(!ne.produto_id||!ne.produto_id)return null;const pe=ne.variacao_custo_percentual||0,$e=pe>0,Oe=Z[ne.produto_id]||{preco_venda:ne.preco_venda_atual||0,margem:ne.margem_atual||0};return e.jsxs("div",{className:"border-2 border-gray-300 rounded-xl overflow-hidden shadow-md hover:shadow-xl transition-all",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-500 text-white p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-xl mb-1",children:ne.produto_nome}),e.jsxs("p",{className:"text-sm text-blue-100",children:["SKU: ",ne.produto_codigo]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("button",{onClick:()=>Be(ne.produto_id,ne.produto_nome),className:"px-3 py-1 bg-white/20 hover:bg-white/30 rounded text-sm font-medium transition-colors",children:"üìä Hist√≥rico"}),e.jsxs("div",{className:"mt-1 text-sm",children:["Quantidade ",e.jsx("strong",{children:q.quantidade||q.quantidade_nf||0})]})]})]})}),e.jsxs("div",{className:"p-5 bg-white space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"üíµ Custo Anterior"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-700",children:["R$ ",(ne.custo_anterior||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"üÜï Custo Novo"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["R$ ",(ne.custo_novo||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"üìä Varia√ß√£o"}),e.jsxs("div",{className:`text-2xl font-bold ${$e?"text-red-600":pe<0?"text-green-600":"text-gray-600"}`,children:[pe>0?"‚Üó":pe<0?"‚Üò":"‚û°"," ",Math.abs(pe).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"üí∞ Pre√ßo de Venda"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:Oe.preco_venda,onChange:Ke=>oe(ne.produto_id,parseFloat(Ke.target.value)||0,ne.custo_novo),className:"w-full pl-10 pr-3 py-3 border-2 border-gray-300 rounded-lg text-xl font-bold focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Anterior: R$ ",ne.preco_venda_atual.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"üìà Margem de Lucro"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.1",value:Oe.margem,onChange:Ke=>ye(ne.produto_id,parseFloat(Ke.target.value)||0,ne.custo_novo),className:"w-full pr-10 pl-3 py-3 border-2 border-gray-300 rounded-lg text-xl font-bold focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:"%"})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"Com o novo custo"})]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-purple-800 mb-3",children:"üìä An√°lise Comparativa (Valores Anteriores)"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"üíµ Custo Anterior"}),e.jsxs("div",{className:"text-lg font-bold text-gray-700",children:["R$ ",(ne.custo_anterior||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"üí∞ Pre√ßo Anterior"}),e.jsxs("div",{className:"text-lg font-bold text-blue-700",children:["R$ ",(ne.preco_venda_atual||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"üìà Margem Anterior"}),e.jsxs("div",{className:"text-lg font-bold text-purple-700",children:[(ne.margem_atual||0).toFixed(1),"%"]})]})]})]})]})]},q.item_id)}).filter(Boolean)})}),e.jsxs("div",{className:"border-t border-gray-200 p-6 bg-gray-50 flex justify-between items-center",children:[e.jsx("button",{onClick:()=>{J(!1),L(null)},className:"px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors",children:"‚ùå Cancelar"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Valor Total da Nota"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["R$ ",te.valor_total.toFixed(2)]})]}),e.jsx("button",{onClick:ra,disabled:g,className:"px-8 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-lg font-bold text-lg shadow-lg disabled:opacity-50 transition-all",children:g?"‚è≥ Processando...":"‚úÖ Confirmar e Processar Nota"})]})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"üìä Hist√≥rico de Altera√ß√µes de Pre√ßos"}),$&&e.jsx("p",{className:"mt-2 text-purple-100",children:$.nome})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:re?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-purple-600"})}):_.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhuma altera√ß√£o de pre√ßo registrada"})}):e.jsx("div",{className:"space-y-4",children:_.map(q=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:q.motivo==="nfe_entrada"?"üì¶":q.motivo==="nfe_revisao_precos"?"üí∞":q.motivo==="manual"?"‚úèÔ∏è":"üìù"}),e.jsx("span",{className:"font-semibold text-gray-800",children:q.motivo==="nfe_entrada"?"Entrada NF-e":q.motivo==="nfe_revisao_precos"?"Revis√£o de Pre√ßos":q.motivo==="manual"?"Ajuste Manual":q.motivo})]}),q.referencia&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:q.referencia}),q.nota_numero&&e.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["Nota: ",q.nota_numero]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-500",children:[new Date(q.data).toLocaleString("pt-BR"),q.usuario&&e.jsx("div",{className:"text-xs mt-1",children:q.usuario})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[q.preco_custo_anterior!==null&&q.preco_custo_novo!==null&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 font-semibold mb-2",children:"üíµ CUSTO"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Anterior"}),e.jsxs("div",{className:"text-lg font-bold",children:["R$ ",q.preco_custo_anterior.toFixed(2)]})]}),e.jsx("div",{className:"text-2xl",children:"‚Üí"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Novo"}),e.jsxs("div",{className:"text-lg font-bold text-blue-700",children:["R$ ",q.preco_custo_novo.toFixed(2)]})]})]}),q.variacao_custo_percentual!==null&&q.variacao_custo_percentual!==0&&e.jsxs("div",{className:`mt-2 text-sm font-semibold text-center ${q.variacao_custo_percentual>0?"text-red-600":"text-green-600"}`,children:[q.variacao_custo_percentual>0?"‚Üë":"‚Üì"," ",Math.abs(q.variacao_custo_percentual).toFixed(2),"%"]})]}),q.preco_venda_anterior!==null&&q.preco_venda_novo!==null&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 font-semibold mb-2",children:"üí≤ PRE√áO DE VENDA"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Anterior"}),e.jsxs("div",{className:"text-lg font-bold",children:["R$ ",q.preco_venda_anterior.toFixed(2)]})]}),e.jsx("div",{className:"text-2xl",children:"‚Üí"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Novo"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",q.preco_venda_novo.toFixed(2)]})]})]}),q.variacao_venda_percentual!==null&&q.variacao_venda_percentual!==0&&e.jsxs("div",{className:`mt-2 text-sm font-semibold text-center ${q.variacao_venda_percentual>0?"text-green-600":"text-red-600"}`,children:[q.variacao_venda_percentual>0?"‚Üë":"‚Üì"," ",Math.abs(q.variacao_venda_percentual).toFixed(2),"%"]})]})]}),q.margem_anterior!==null&&q.margem_nova!==null&&e.jsxs("div",{className:"mt-3 bg-purple-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 font-semibold mb-2",children:"üìà MARGEM DE LUCRO"}),e.jsxs("div",{className:"flex items-center justify-around",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Anterior"}),e.jsxs("div",{className:"text-xl font-bold",children:[q.margem_anterior.toFixed(1),"%"]})]}),e.jsx("div",{className:"text-2xl",children:"‚Üí"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Nova"}),e.jsxs("div",{className:"text-xl font-bold text-purple-700",children:[q.margem_nova.toFixed(1),"%"]})]})]})]}),q.observacoes&&e.jsx("div",{className:"mt-3 text-sm text-gray-600 italic bg-gray-50 rounded p-2",children:q.observacoes})]},q.id))})}),e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsx("button",{onClick:()=>{h(!1),S([]),K(null)},className:"w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors",children:"Fechar"})})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white p-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"üì¶ Resultado do Processamento em Lote"}),p&&e.jsxs("p",{className:"mt-2",children:[p.sucessos," sucesso(s) | ",p.erros," erro(s) | Total: ",p.total_arquivos]})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1",children:[x&&!p&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-green-600 mb-4"}),e.jsx("p",{className:"text-lg text-gray-600",children:"Processando arquivos..."})]}),p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-100 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:p.total_arquivos}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:p.sucessos}),e.jsx("div",{className:"text-sm text-gray-600",children:"Sucessos"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:p.erros}),e.jsx("div",{className:"text-sm text-gray-600",children:"Erros"})]})]}),e.jsx("div",{className:"space-y-3",children:p.resultados.map((q,ne)=>{var pe;return e.jsx("div",{className:`border rounded-lg p-4 ${q.sucesso?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:q.sucesso?"‚úÖ":"‚ùå"}),e.jsx("span",{className:"font-semibold text-gray-800",children:q.arquivo})]}),q.sucesso?e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Nota:"})," ",q.numero_nota]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Fornecedor:"})," ",q.fornecedor]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Valor:"})," R$ ",(pe=q.valor_total)==null?void 0:pe.toFixed(2)]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Produtos:"})," ",q.produtos_vinculados," vinculados, ",q.produtos_nao_vinculados," n√£o vinculados"]})]}):e.jsx("p",{className:"text-sm text-red-700",children:q.mensagem})]}),e.jsxs("span",{className:"text-sm text-gray-500 ml-4",children:["#",q.ordem]})]})},ne)})})]})]}),e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsx("button",{onClick:()=>{i(!1),l(null)},disabled:x,className:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold disabled:opacity-50 transition-colors",children:x?"‚è≥ Processando...":"Fechar"})})]})})]})},Wi=({isOpen:s,onClose:n,onSuccess:t})=>{const[d,o]=a.useState(!1),[g,r]=a.useState(!1),[v,j]=a.useState({contas_pagar:[],contas_receber:[]}),[f,y]=a.useState({}),[c,m]=a.useState(new Set),[k,w]=a.useState("todos"),[x,b]=a.useState(!1),[u,i]=a.useState([]),[p,l]=a.useState({});a.useEffect(()=>{s&&(h(),C())},[s]);const C=async()=>{try{const A=await F.get("/dre/subcategorias");i(A.data)}catch(A){console.error("Erro ao carregar categorias DRE:",A)}},h=async()=>{o(!0);try{const A=await F.get("/dre/classificar/pendentes",{params:{limit:100}});j(A.data),await _(A.data),ce.success(`${A.data.total_pendentes} lan√ßamentos pendentes encontrados`)}catch(A){console.error("Erro ao carregar pendentes:",A),ce.error("Erro ao carregar lan√ßamentos pendentes")}finally{o(!1)}},_=async A=>{const G={};for(const E of A.contas_pagar)try{const P=await F.post("/dre/classificar/sugerir",{tipo:"pagar",lancamento_id:E.id});G[`pagar_${E.id}`]=P.data}catch(P){console.error(`Erro ao buscar sugest√µes para pagar #${E.id}:`,P),G[`pagar_${E.id}`]=[]}for(const E of A.contas_receber)try{const P=await F.post("/dre/classificar/sugerir",{tipo:"receber",lancamento_id:E.id});G[`receber_${E.id}`]=P.data}catch(P){console.error(`Erro ao buscar sugest√µes para receber #${E.id}:`,P),G[`receber_${E.id}`]=[]}y(G)},S=async(A,G,E)=>{r(!0);try{await F.post("/dre/classificar/aplicar",{tipo:A,lancamento_id:G,dre_subcategoria_id:E.dre_subcategoria_id,canal:null,regra_id:E.regra_id,forma_classificacao:"sugestao_aceita"}),m(P=>new Set([...P,`${A}_${G}`])),ce.success(`‚úÖ Classificado: ${E.subcategoria_nome}`)}catch(P){console.error("Erro ao aplicar classifica√ß√£o:",P),ce.error("Erro ao aplicar classifica√ß√£o")}finally{r(!1)}},$=async()=>{b(!0);try{const A=await F.post("/dre/classificar/auto-classificar-pendentes",null,{params:{apenas_alta_confianca:!0}});ce.success(`ü§ñ Auto-classifica√ß√£o conclu√≠da!
${A.data.total_classificado} de ${A.data.total_processado} lan√ßamentos classificados`,{duration:5e3}),await h(),t&&t()}catch(A){console.error("Erro ao auto-classificar:",A),ce.error("Erro ao executar auto-classifica√ß√£o")}finally{b(!1)}},K=async(A,G,E)=>{if(!E){ce.error("Selecione uma categoria DRE");return}r(!0);try{const P=u.find(H=>H.id===parseInt(E));await F.post("/dre/classificar/aplicar",{tipo:A,lancamento_id:G,dre_subcategoria_id:parseInt(E),canal:null,regra_id:null,forma_classificacao:"manual"}),m(H=>new Set([...H,`${A}_${G}`])),l(H=>{const B={...H};return delete B[`${A}_${G}`],B}),ce.success(`‚úÖ Classificado manualmente: ${(P==null?void 0:P.nome)||"Categoria"}`)}catch(P){console.error("Erro ao aplicar classifica√ß√£o manual:",P),ce.error("Erro ao aplicar classifica√ß√£o manual")}finally{r(!1)}},re=async(A,G)=>{r(!0);try{m(E=>new Set([...E,`${A}_${G}`])),ce.success('üì¶ Marcado como "N√£o Controla DRE" (Estoque/Produtos)')}catch(E){console.error("Erro ao marcar como n√£o-DRE:",E),ce.error("Erro ao processar")}finally{r(!1)}},M=async(A,G,E,P,H)=>{if(!E){ce.error("Lan√ßamento sem fornecedor/cliente vinculado");return}const B=P||H;if(!B){ce.error("ID do fornecedor/cliente n√£o encontrado");return}if(window.confirm(`Deseja marcar "${E}" como fornecedor de produtos (N√£o Controla DRE)?

Todos os lan√ßamentos deste fornecedor ser√£o automaticamente ignorados no DRE.`)){r(!0);try{await F.patch(`/clientes/${B}/controla-dre?controla_dre=false`),m(N=>new Set([...N,`${A}_${G}`])),ce.success(`‚úÖ Fornecedor "${E}" marcado como "N√£o Controla DRE"

Todos os lan√ßamentos futuros ser√£o ignorados automaticamente.`,{duration:6e3}),setTimeout(()=>h(),1e3)}catch(N){console.error("Erro ao marcar fornecedor:",N),ce.error("Erro ao marcar fornecedor como N√£o DRE")}finally{r(!1)}}},R=A=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(A||0),J=A=>A?new Date(A).toLocaleDateString("pt-BR"):"-",te=A=>A>=90?"text-green-600 bg-green-100":A>=70?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100",Z=(k==="pagar"?v.contas_pagar.map(A=>({...A,tipo:"pagar"})):k==="receber"?v.contas_receber.map(A=>({...A,tipo:"receber"})):[...v.contas_pagar.map(A=>({...A,tipo:"pagar"})),...v.contas_receber.map(A=>({...A,tipo:"receber"}))]).filter(A=>!c.has(`${A.tipo}_${A.id}`));return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-t-lg",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold flex items-center gap-2",children:"üè∑Ô∏è Classificar Lan√ßamentos Pendentes"}),e.jsxs("p",{className:"text-sm text-purple-100 mt-1",children:[Z.length," lan√ßamentos aguardando classifica√ß√£o DRE"]})]}),e.jsx("button",{onClick:n,className:"text-white hover:bg-white hover:bg-opacity-20 p-2 rounded-lg transition-colors",children:e.jsx(ps,{size:24})})]}),e.jsxs("div",{className:"p-4 border-b bg-gray-50 flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>w("todos"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${k==="todos"?"bg-purple-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:["üìä Todos (",v.contas_pagar.length+v.contas_receber.length,")"]}),e.jsxs("button",{onClick:()=>w("pagar"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${k==="pagar"?"bg-red-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:["üí∏ A Pagar (",v.contas_pagar.length,")"]}),e.jsxs("button",{onClick:()=>w("receber"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${k==="receber"?"bg-green-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:["üí∞ A Receber (",v.contas_receber.length,")"]})]}),e.jsx("button",{onClick:$,disabled:x||Z.length===0,className:"flex items-center gap-2 bg-gradient-to-r from-green-600 to-emerald-600 text-white px-6 py-2 rounded-lg font-medium hover:from-green-700 hover:to-emerald-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:x?e.jsxs(e.Fragment,{children:[e.jsx(mo,{className:"animate-spin",size:20}),"Auto-Classificando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(vt,{size:20}),"Auto-Classificar (Alta Confian√ßa)"]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:d?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(mo,{className:"animate-spin text-purple-600",size:48})}):Z.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(ws,{size:64,className:"text-green-500 mb-4"}),e.jsx("p",{className:"text-xl font-semibold",children:"Nenhum lan√ßamento pendente!"}),e.jsx("p",{className:"text-sm mt-2",children:"Todos os lan√ßamentos foram classificados."})]}):e.jsx("div",{className:"space-y-4",children:Z.map(A=>{const G=`${A.tipo}_${A.id}`,E=f[G]||[];return E[0],e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white shadow-sm hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${A.tipo==="pagar"?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:A.tipo==="pagar"?"üí∏ A Pagar":"üí∞ A Receber"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["#",A.id]})]}),e.jsx("h3",{className:"font-semibold text-gray-800 text-lg mb-1",children:A.descricao}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[A.beneficiario&&e.jsxs("span",{className:"flex items-center gap-1",children:["üë§ ",A.beneficiario]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ga,{size:14}),R(A.valor)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ns,{size:14}),J(A.data_vencimento)]}),A.tipo_documento&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs",children:A.tipo_documento})]})]})}),E.length===0?e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(_a,{className:"text-yellow-600",size:20}),e.jsx("span",{className:"text-sm text-yellow-700 font-semibold",children:"Nenhuma sugest√£o autom√°tica. Classifique manualmente."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:p[G]||"",onChange:P=>l(H=>({...H,[G]:P.target.value})),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"",children:"Selecione uma categoria DRE..."}),u.map(P=>e.jsxs("option",{value:P.id,children:[P.categoria_nome," ‚Üí ",P.nome]},P.id))]}),e.jsxs("button",{onClick:()=>K(A.tipo,A.id,p[G]),disabled:g||!p[G],className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",children:[e.jsx(_t,{size:18}),"Classificar"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>re(A.tipo,A.id),disabled:g,className:"flex-1 flex items-center justify-center gap-2 bg-gray-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Marca apenas ESTE lan√ßamento como N√£o DRE",children:"üì¶ Este Lan√ßamento"}),A.beneficiario&&e.jsxs("button",{onClick:()=>M(A.tipo,A.id,A.beneficiario,A.fornecedor_id,A.cliente_id),disabled:g,className:"flex-1 flex items-center justify-center gap-2 bg-orange-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:`Marca TODOS os lan√ßamentos de ${A.beneficiario} como N√£o DRE`,children:['üè™ Todo Fornecedor "',A.beneficiario,'"']})]})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase mb-2",children:"ü§ñ Sugest√µes de Classifica√ß√£o:"}),E.slice(0,3).map((P,H)=>e.jsxs("div",{className:`flex justify-between items-center p-3 rounded-lg border-2 ${H===0?"border-purple-300 bg-purple-50":"border-gray-200 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:P.subcategoria_nome}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${te(P.confianca)}`,children:[P.confianca,"% confian√ßa"]}),H===0&&e.jsx("span",{className:"px-2 py-1 bg-purple-600 text-white rounded-full text-xs font-bold",children:"‚≠ê Melhor"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:P.motivo}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Regra: ",P.regra_nome]})]}),e.jsxs("button",{onClick:()=>S(A.tipo,A.id,P),disabled:g,className:"ml-4 flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(_t,{size:18}),"Aceitar"]})]},H))]})]},G)})})}),e.jsxs("div",{className:"p-4 border-t bg-gray-50 flex justify-between items-center rounded-b-lg",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:c.size})," classificados nesta sess√£o"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{c.size>0&&t&&t(),n()},className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors",children:"Fechar"}),c.size>0&&e.jsx("button",{onClick:h,className:"px-6 py-2 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition-colors",children:"Atualizar Lista"})]})]})]})}):null},Eo=()=>{const s=fa(),[n,t]=a.useState(!0),[d,o]=a.useState(30),[g,r]=a.useState(!1),[v,j]=a.useState({saldo_atual:0,contas_receber:{total:0,vencidas:0},contas_pagar:{total:0,vencidas:0},vendas_periodo:{quantidade:0,valor_total:0,finalizadas:0,ticket_medio:0},fluxo_periodo:{entradas:0,saidas:0,lucro:0}}),[f,y]=a.useState([]),[c,m]=a.useState({contas_receber:[],contas_pagar:[]}),k=i=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i||0),w=i=>new Date(i).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}),x=async()=>{t(!0);try{const i=await F.get(`/dashboard/resumo?periodo_dias=${d}`);j(i.data)}catch(i){console.error("Erro ao carregar resumo:",i)}try{const i=await F.get(`/dashboard/entradas-saidas?periodo_dias=${d}`);y(i.data)}catch(i){console.error("Erro ao carregar entradas/sa√≠das:",i)}try{const i=await F.get("/dashboard/contas-vencidas?limite=5");m(i.data)}catch(i){console.error("Erro ao carregar contas vencidas:",i)}t(!1)};if(a.useEffect(()=>{x()},[d]),n)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500"})});const b=[{nome:"Loja F√≠sica",valor:v.vendas_periodo.valor_total||0,margem:35.5,lucro:(v.vendas_periodo.valor_total||0)*.355,icon:Un,color:"blue",isMock:!1,onClick:()=>s("/financeiro/relatorio-vendas")},{nome:"Mercado Livre",valor:8450,margem:18.2,lucro:1537.9,icon:Za,color:"yellow",isMock:!0,onClick:()=>ce("Integra√ß√£o com Mercado Livre em breve",{icon:"üì¶"})},{nome:"Shopee",valor:5230,margem:22.5,lucro:1176.75,icon:sr,color:"orange",isMock:!0,onClick:()=>ce("Integra√ß√£o com Shopee em breve",{icon:"üõí"})},{nome:"Amazon",valor:12890,margem:15.8,lucro:2036.62,icon:Za,color:"purple",isMock:!0,onClick:()=>ce("Integra√ß√£o com Amazon em breve",{icon:"üì¶"})}],u=i=>{const p={blue:"from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700",green:"from-green-500 to-green-600 hover:from-green-600 hover:to-green-700",red:"from-red-500 to-red-600 hover:from-red-600 hover:to-red-700",purple:"from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700",yellow:"from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700",orange:"from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700"};return p[i]||p.blue};return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Dashboard Gerencial"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Vis√£o consolidada do seu neg√≥cio"})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("button",{onClick:()=>r(!0),className:"flex items-center gap-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white px-5 py-2.5 rounded-lg font-medium hover:from-purple-700 hover:to-blue-700 transition-all shadow-lg hover:shadow-xl transform hover:scale-105",children:[e.jsx("span",{className:"text-xl",children:"üè∑Ô∏è"}),"Classificar DRE"]}),e.jsx("div",{className:"flex gap-2",children:[7,15,30,60,90].map(i=>e.jsxs("button",{onClick:()=>o(i),className:`px-4 py-2 rounded-lg font-medium transition-colors ${d===i?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:[i," dias"]},i))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs("div",{onClick:()=>s("/financeiro/fluxo-caixa"),className:`bg-gradient-to-br ${u("blue")} rounded-xl p-6 text-white shadow-lg cursor-pointer transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-lg",children:e.jsx(za,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-xs font-medium bg-white/20 px-2 py-1 rounded",children:"Atual"})]}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"Saldo Atual"}),e.jsx("p",{className:"text-2xl font-bold",children:k(v.saldo_atual)}),e.jsx("p",{className:"text-xs mt-2 opacity-75",children:"Clique para ver fluxo de caixa"})]}),e.jsxs("div",{onClick:()=>s("/financeiro/contas-receber"),className:`bg-gradient-to-br ${u("green")} rounded-xl p-6 text-white shadow-lg cursor-pointer transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-lg",children:e.jsx(Ma,{className:"w-6 h-6"})}),v.contas_receber.vencidas>0&&e.jsx(da,{className:"w-5 h-5 text-yellow-300"})]}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"A Receber"}),e.jsx("p",{className:"text-2xl font-bold",children:k(v.contas_receber.total)}),v.contas_receber.vencidas>0?e.jsxs("p",{className:"text-xs mt-2 opacity-90",children:["‚ö†Ô∏è Vencidas: ",k(v.contas_receber.vencidas)]}):e.jsx("p",{className:"text-xs mt-2 opacity-75",children:"Clique para gerenciar"})]}),e.jsxs("div",{onClick:()=>s("/financeiro/contas-pagar"),className:`bg-gradient-to-br ${u("red")} rounded-xl p-6 text-white shadow-lg cursor-pointer transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-lg",children:e.jsx(Oa,{className:"w-6 h-6"})}),v.contas_pagar.vencidas>0&&e.jsx(da,{className:"w-5 h-5 text-yellow-300"})]}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"A Pagar"}),e.jsx("p",{className:"text-2xl font-bold",children:k(v.contas_pagar.total)}),v.contas_pagar.vencidas>0?e.jsxs("p",{className:"text-xs mt-2 opacity-90",children:["‚ö†Ô∏è Vencidas: ",k(v.contas_pagar.vencidas)]}):e.jsx("p",{className:"text-xs mt-2 opacity-75",children:"Clique para gerenciar"})]}),e.jsxs("div",{onClick:()=>s("/financeiro/dre"),className:`bg-gradient-to-br ${v.fluxo_periodo.lucro>=0?u("purple"):u("orange")} rounded-xl p-6 text-white shadow-lg cursor-pointer transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-lg",children:e.jsx(Xa,{className:"w-6 h-6"})}),e.jsxs("span",{className:"text-xs font-medium bg-white/20 px-2 py-1 rounded",children:[d," dias"]})]}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:v.fluxo_periodo.lucro>=0?"Lucro":"Preju√≠zo"}),e.jsx("p",{className:"text-2xl font-bold",children:k(Math.abs(v.fluxo_periodo.lucro))}),e.jsx("p",{className:"text-xs mt-2 opacity-75",children:"Clique para ver DRE completo"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Vendas por Canal"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Performance de cada canal de vendas"})]}),e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full font-medium",children:"Marketplaces em prepara√ß√£o"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:b.map((i,p)=>e.jsxs("div",{onClick:i.onClick,className:"bg-gray-50 rounded-lg p-5 border border-gray-200 hover:shadow-md transition-all cursor-pointer transform hover:scale-105 relative",children:[i.isMock&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:"text-xs bg-gray-200 text-gray-600 px-2 py-0.5 rounded",children:"Mock"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`bg-gradient-to-br ${u(i.color)} p-3 rounded-lg`,children:e.jsx(i.icon,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"font-semibold text-gray-800",children:i.nome})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Valor Vendido"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:k(i.valor)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Margem"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-800",children:[i.margem,"%"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Lucro Est."}),e.jsx("p",{className:"text-sm font-semibold text-green-600",children:k(i.lucro)})]})]})]})]},p))}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Total consolidado:"})," ",k(b.reduce((i,p)=>i+p.valor,0))," "," | ",e.jsx("strong",{children:"Lucro total:"})," ",k(b.reduce((i,p)=>i+p.lucro,0))]})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl shadow-lg p-6 mb-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-lg",children:e.jsx(us,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Insights Inteligentes"}),e.jsx("p",{className:"text-sm opacity-90",children:"Alertas e sugest√µes autom√°ticas"})]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-6 text-center",children:[e.jsx(us,{className:"w-12 h-12 mx-auto mb-3 opacity-75"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Em breve a IA mostrar√° aqui:"}),e.jsxs("div",{className:"mt-3 space-y-2 text-sm opacity-90",children:[e.jsx("p",{children:"‚Ä¢ Problemas urgentes detectados"}),e.jsx("p",{children:"‚Ä¢ Oportunidades de lucro identificadas"}),e.jsx("p",{children:"‚Ä¢ A√ß√µes recomendadas para hoje"})]}),e.jsx("p",{className:"text-xs mt-4 opacity-75",children:"Sem m√°gica. Apenas an√°lise inteligente dos seus dados reais."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>s("/pdv"),className:"bg-gradient-to-br from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all transform hover:scale-105 flex items-center justify-center gap-3",children:[e.jsx(sr,{className:"w-5 h-5"}),"Nova Venda"]}),e.jsxs("button",{onClick:()=>s("/financeiro/contas-receber"),className:"bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all transform hover:scale-105 flex items-center justify-center gap-3",children:[e.jsx(Ma,{className:"w-5 h-5"}),"Registrar Recebimento"]}),e.jsxs("button",{onClick:()=>s("/financeiro/contas-pagar"),className:"bg-gradient-to-br from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all transform hover:scale-105 flex items-center justify-center gap-3",children:[e.jsx(Oa,{className:"w-5 h-5"}),"Registrar Despesa"]}),e.jsxs("button",{onClick:()=>s("/ia/fluxo-caixa"),className:"bg-gradient-to-br from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all transform hover:scale-105 flex items-center justify-center gap-3",children:[e.jsx(us,{className:"w-5 h-5"}),"Revis√µes IA"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg mb-6",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-4",children:["Fluxo Financeiro (",d," dias)"]}),e.jsx(qa,{width:"100%",height:300,children:e.jsxs(ct,{data:f,children:[e.jsx(Ba,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:"data",tickFormatter:w,style:{fontSize:"12px"}}),e.jsx(Ta,{tickFormatter:i=>`R$ ${(i/1e3).toFixed(0)}k`,style:{fontSize:"12px"}}),e.jsx(Aa,{formatter:i=>k(i),labelFormatter:w}),e.jsx(Va,{}),e.jsx(ls,{type:"monotone",dataKey:"entradas",stroke:"#10B981",strokeWidth:2,name:"Entradas"}),e.jsx(ls,{type:"monotone",dataKey:"saidas",stroke:"#EF4444",strokeWidth:2,name:"Sa√≠das"})]})})]}),(c.contas_receber.length>0||c.contas_pagar.length>0)&&e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(da,{className:"w-5 h-5 text-red-500"}),"Aten√ß√£o: Contas Vencidas"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[c.contas_receber.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:["A Receber (",c.contas_receber.length,")"]}),e.jsx("div",{className:"space-y-2",children:c.contas_receber.slice(0,3).map(i=>e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:i.cliente||"Sem cliente"}),e.jsx("p",{className:"font-bold text-red-600 text-sm",children:k(i.saldo)})]}),e.jsxs("p",{className:"text-xs text-red-600",children:["Venceu h√° ",i.dias_vencido," dias"]})]},i.id))})]}),c.contas_pagar.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:["A Pagar (",c.contas_pagar.length,")"]}),e.jsx("div",{className:"space-y-2",children:c.contas_pagar.slice(0,3).map(i=>e.jsxs("div",{className:"p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:i.fornecedor||"Sem fornecedor"}),e.jsx("p",{className:"font-bold text-orange-600 text-sm",children:k(i.saldo)})]}),e.jsxs("p",{className:"text-xs text-orange-600",children:["Venceu h√° ",i.dias_vencido," dias"]})]},i.id))})]})]})]}),e.jsx(Wi,{isOpen:g,onClose:()=>r(!1)})]})},Js=[{value:"banco",label:"Banco",icon:Xo,cor_padrao:"#dc2626"},{value:"caixa",label:"Caixa F√≠sico",icon:it,cor_padrao:"#16a34a"},{value:"digital",label:"Carteira Digital",icon:lt,cor_padrao:"#2563eb"}],Ki=["üè¶","üí∞","üí≥","üíµ","üí∏","üèß","ü™ô","üí¥","üí∂","üí∑","ü§ë","üí≤","üîí","üè¶","üè™","üè¢","üè≠","üéØ","üìä","üìà","üíº","üëõ","üéÅ","‚ö°"];function Hi(){const[s,n]=a.useState([]),[t,d]=a.useState(!0),[o,g]=a.useState(!1),[r,v]=a.useState(null),[j,f]=a.useState(""),[y,c]=a.useState({nome:"",tipo:"banco",banco:"",saldo_inicial:0,cor:"#dc2626",icone:"üè¶",instituicao_bancaria:!1,ativa:!0});a.useEffect(()=>{m()},[]);const m=async()=>{try{d(!0);const b=await F.get("/contas-bancarias");n(b.data)}catch(b){console.error("Erro:",b),f("Erro ao carregar contas banc√°rias")}finally{d(!1)}},k=(b=null)=>{if(b)c({nome:b.nome,tipo:b.tipo,banco:b.banco||"",saldo_inicial:b.saldo_inicial,cor:b.cor||"#dc2626",icone:b.icone||"üè¶",instituicao_bancaria:b.instituicao_bancaria||!1,ativa:b.ativa}),v(b);else{const u=Js[0];c({nome:"",tipo:"banco",banco:"",saldo_inicial:0,cor:u.cor_padrao,icone:"üè¶",instituicao_bancaria:!1,ativa:!0}),v(null)}g(!0),f("")},w=async b=>{var u,i,p;b.preventDefault();try{const l={nome:y.nome.trim(),tipo:y.tipo,banco:((u=y.banco)==null?void 0:u.trim())||null,saldo_inicial:Number(y.saldo_inicial)||0,cor:y.cor,icone:y.icone||"üè¶",instituicao_bancaria:!!y.instituicao_bancaria,ativa:!!y.ativa};console.log("Enviando dados:",l),r?await F.put(`/contas-bancarias/${r.id}`,l):await F.post("/contas-bancarias",l),await m(),g(!1),f("")}catch(l){console.error("Erro completo:",l),console.error("Response:",l.response),f(((p=(i=l.response)==null?void 0:i.data)==null?void 0:p.detail)||l.message||"Erro ao salvar conta")}},x=async b=>{var u,i;if(confirm("Deseja realmente excluir esta conta?"))try{await F.delete(`/contas-bancarias/${b}`),await m()}catch(p){console.error("Erro:",p),f(((i=(u=p.response)==null?void 0:u.data)==null?void 0:i.detail)||"Erro ao excluir conta")}};return t?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Cadastro de Bancos"}),e.jsx("p",{className:"text-gray-600",children:"Configure as contas banc√°rias, caixas e carteiras digitais do sistema"})]}),e.jsxs("button",{onClick:()=>k(),className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",children:[e.jsx(os,{className:"w-5 h-5"}),"Nova Conta"]})]})}),j&&e.jsxs("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-2",children:[e.jsx(da,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-red-800",children:j})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(b=>{var i,p,l;const u=((i=Js.find(C=>C.value===b.tipo))==null?void 0:i.icon)||Xo;return e.jsxs("div",{className:`bg-white rounded-xl border-2 p-4 transition ${b.ativa?"border-gray-200 hover:border-blue-300":"border-gray-100 opacity-60"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-2xl",style:{backgroundColor:`${b.cor}20`},children:b.icone}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800",children:b.nome}),e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(u,{className:"w-3 h-3"}),(p=Js.find(C=>C.value===b.tipo))==null?void 0:p.label]})]})]}),!b.ativa&&e.jsx("span",{className:"text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded",children:"Inativa"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Tipo de Conta"}),e.jsx("p",{className:"text-lg font-semibold text-gray-800",children:(l=Js.find(C=>C.value===b.tipo))==null?void 0:l.label}),b.banco&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:b.banco})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k(b),className:"flex items-center justify-center bg-gray-100 text-gray-700 p-2 rounded-lg hover:bg-gray-200 transition",children:e.jsx(Dr,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>x(b.id),className:"flex items-center justify-center bg-red-50 text-red-600 p-2 rounded-lg hover:bg-red-100 transition",children:e.jsx(hs,{className:"w-4 h-4"})})]})]},b.id)})}),s.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(it,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"Nenhuma conta cadastrada"}),e.jsx("button",{onClick:()=>k(),className:"text-blue-600 hover:text-blue-700 font-medium",children:"Cadastrar primeira conta"})]}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:r?"Editar Conta":"Nova Conta"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(ma,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[j&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-red-800 text-sm",children:j}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{type:"text",value:y.nome,onChange:b=>c({...y,nome:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsx("select",{value:y.tipo,onChange:b=>{const u=Js.find(i=>i.value===b.target.value);c({...y,tipo:b.target.value,cor:(u==null?void 0:u.cor_padrao)||y.cor})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:Js.map(b=>e.jsx("option",{value:b.value,children:b.label},b.value))})]}),y.tipo==="banco"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Banco"}),e.jsx("input",{type:"text",value:y.banco,onChange:b=>c({...y,banco:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: Santander, Bradesco..."})]}),!r&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Saldo Inicial"}),e.jsx("input",{type:"number",step:"0.01",value:y.saldo_inicial,onChange:b=>c({...y,saldo_inicial:parseFloat(b.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor"}),e.jsx("input",{type:"color",value:y.cor,onChange:b=>c({...y,cor:b.target.value}),className:"w-full h-10 rounded-lg cursor-pointer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"√çcone Atual"}),e.jsx("div",{className:"w-full h-10 border border-gray-300 rounded-lg flex items-center justify-center text-2xl bg-white",style:{backgroundColor:`${y.cor}10`},children:y.icone})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Escolher √çcone"}),e.jsx("div",{className:"grid grid-cols-8 gap-2 p-3 bg-gray-50 rounded-lg border border-gray-200 max-h-32 overflow-y-auto",children:Ki.map((b,u)=>e.jsx("button",{type:"button",onClick:()=>c({...y,icone:b}),className:`w-10 h-10 rounded-lg flex items-center justify-center text-xl transition hover:scale-110 ${y.icone===b?"bg-blue-100 border-2 border-blue-500 ring-2 ring-blue-200":"bg-white border border-gray-200 hover:border-blue-300"}`,children:b},u))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"instituicao_bancaria",checked:y.instituicao_bancaria,onChange:b=>c({...y,instituicao_bancaria:b.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"instituicao_bancaria",className:"text-sm text-gray-700",children:"üè¶ Institui√ß√£o Banc√°ria (para concilia√ß√£o OFX)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"ativa",checked:y.ativa,onChange:b=>c({...y,ativa:b.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"ativa",className:"text-sm text-gray-700",children:"Conta ativa"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>g(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"flex-1 flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",children:[e.jsx(Ct,{className:"w-4 h-4"}),"Salvar"]})]})]})]})})]})}const Gi=({isOpen:s,onClose:n,onSave:t})=>{const[d,o]=a.useState(!1),[g,r]=a.useState([]),[v,j]=a.useState([]),[f,y]=a.useState([]),[c,m]=a.useState([]),[k,w]=a.useState(30),[x,b]=a.useState(!1),[u,i]=a.useState({nome:"",tipo:"despesa",cor:"#ef4444",icone:"üí∏",descricao:"",ativo:!0,novasSubcategorias:[]}),[p,l]=a.useState({descricao:"",fornecedor_id:null,categoria_id:null,dre_subcategoria_id:null,valor_original:"",data_emissao:new Date().toISOString().split("T")[0],data_vencimento:new Date().toISOString().split("T")[0],documento:"",observacoes:"",eh_parcelado:!1,total_parcelas:1,eh_recorrente:!1,tipo_recorrencia:"mensal",intervalo_dias:null,data_inicio_recorrencia:null,data_fim_recorrencia:null,numero_repeticoes:null});a.useEffect(()=>{s&&C()},[s]);const C=async()=>{var L;try{const[Z,A,G]=await Promise.all([F.get("/clientes/?tipo_cadastro=fornecedor"),F.get("/categorias-financeiras/"),F.get("/dre/subcategorias")]);console.log("üì¶ Categorias recebidas:",A.data),r(Z.data);const E=A.data.filter(P=>{const H=P.tipo?P.tipo.toLowerCase():"",B=P.nome?P.nome.toLowerCase():"",N=H==="receita"||H==="entrada",O=B.includes("receita")||B.includes("venda");return!N&&!O});j(E),y(G.data||[]),console.log("‚úÖ Categorias de DESPESA setadas:",E.length),console.log("üìã Lista completa:",E),console.log("üìä Subcategorias DRE carregadas:",(L=G.data)==null?void 0:L.length)}catch(Z){console.error("‚ùå Erro ao carregar dados:",Z),ce.error("Erro ao carregar formul√°rio")}},h=()=>{if(!p.eh_parcelado||!p.total_parcelas||!p.data_vencimento||!p.valor_original){m([]);return}const L=parseFloat(p.valor_original),Z=parseInt(p.total_parcelas),A=L/Z,G=[];let E=new Date(p.data_vencimento);for(let B=0;B<Z;B++){const N=new Date(E);N.setDate(E.getDate()+B*k),G.push({numero:B+1,valor:B===Z-1?L-A*(Z-1):A,data_vencimento:N.toISOString().split("T")[0]})}const P=G.reduce((B,N)=>B+N.valor,0),H=L-P;Math.abs(H)>.01&&(G[G.length-1].valor+=H),m(G)},_=()=>{i({...u,novasSubcategorias:[...u.novasSubcategorias,{nome:"",descricao:"",ativo:!0}]})},S=(L,Z,A)=>{const G=[...u.novasSubcategorias];G[L][Z]=A,i({...u,novasSubcategorias:G})},$=L=>{const Z=u.novasSubcategorias.filter((A,G)=>G!==L);i({...u,novasSubcategorias:Z})},K=(L,Z)=>{L.key==="Tab"&&!L.shiftKey&&Z===u.novasSubcategorias.length-1&&(L.preventDefault(),_())},re=async L=>{var Z,A;if(L.preventDefault(),!u.nome){ce.error("Preencha o nome da categoria");return}try{const E=(await F.post("/categorias-financeiras/",{nome:u.nome,tipo:u.tipo,cor:u.cor,icone:u.icone,descricao:u.descricao,ativo:u.ativo},jo({key:"financeiro:categoria:create-despesa",duplicateWindowMs:3e3}))).data.id;if(ce.success("Categoria criada com sucesso!"),u.novasSubcategorias.length>0){const P=u.novasSubcategorias.filter(H=>H.nome.trim());for(const H of P)try{await F.post("/subcategorias/",{categoria_id:E,nome:H.nome,descricao:H.descricao,ativo:H.ativo})}catch(B){console.error("Erro ao criar subcategoria:",B)}P.length>0&&ce.success(`${P.length} subcategoria(s) criada(s)!`)}await C(),l({...p,categoria_id:E}),b(!1),i({nome:"",tipo:"despesa",cor:"#ef4444",icone:"üí∏",descricao:"",ativo:!0,novasSubcategorias:[]})}catch(G){console.error("Erro ao salvar categoria:",G),ce.error(((A=(Z=G.response)==null?void 0:Z.data)==null?void 0:A.detail)||"Erro ao salvar categoria")}},M=(L,Z)=>{const A=[...c];A[L].data_vencimento=Z,m(A)},R=(L,Z)=>{const A=[...c];A[L].valor=parseFloat(Z)||0,m(A)},J=async L=>{var Z,A;if(L.preventDefault(),!p.descricao||!p.valor_original||!p.data_vencimento){ce.error("Preencha todos os campos obrigat√≥rios");return}o(!0);try{await F.post("/contas-pagar/",{...p,valor_original:parseFloat(p.valor_original),total_parcelas:p.eh_parcelado?parseInt(p.total_parcelas):1,intervalo_dias:p.tipo_recorrencia==="personalizado"?parseInt(p.intervalo_dias):null,numero_repeticoes:p.numero_repeticoes?parseInt(p.numero_repeticoes):null},jo({key:"financeiro:conta-pagar:create",duplicateWindowMs:3e3})),ce.success(p.eh_recorrente?"Conta recorrente criada com sucesso!":"Conta criada com sucesso!"),t(),n(),te()}catch(G){console.error("Erro ao criar conta:",G),ce.error(((A=(Z=G.response)==null?void 0:Z.data)==null?void 0:A.detail)||"Erro ao criar conta a pagar")}finally{o(!1)}},te=()=>{l({descricao:"",fornecedor_id:null,categoria_id:null,valor_original:"",data_emissao:new Date().toISOString().split("T")[0],data_vencimento:new Date().toISOString().split("T")[0],documento:"",observacoes:"",eh_parcelado:!1,total_parcelas:1,eh_recorrente:!1,tipo_recorrencia:"mensal",intervalo_dias:null,data_inicio_recorrencia:null,data_fim_recorrencia:null,numero_repeticoes:null})};return s?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full m-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b sticky top-0 bg-white",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(os,{className:"text-red-600"}),"Nova Conta a Pagar"]}),e.jsx("button",{onClick:n,className:"text-gray-500 hover:text-gray-700",children:e.jsx(ma,{size:24})})]}),e.jsxs("form",{onSubmit:J,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(Xa,{size:20,className:"text-blue-600"}),"Informa√ß√µes B√°sicas"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri√ß√£o *"}),e.jsx("input",{type:"text",value:p.descricao,onChange:L=>l({...p,descricao:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",placeholder:"Ex: Aluguel, Conta de luz, Fornecedor XYZ...",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(tr,{size:16,className:"inline mr-1"}),"Fornecedor"]}),e.jsxs("select",{value:p.fornecedor_id||"",onChange:L=>l({...p,fornecedor_id:L.target.value?parseInt(L.target.value):null}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),g.map(L=>e.jsx("option",{value:L.id,children:L.nome},L.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Wn,{size:16,className:"inline mr-1"}),"Categoria"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:p.categoria_id||"",onChange:L=>l({...p,categoria_id:L.target.value?parseInt(L.target.value):null}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),v.map(L=>e.jsx("option",{value:L.id,children:L.nome},L.id))]}),e.jsxs("button",{type:"button",onClick:()=>b(!0),className:"px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center gap-1 whitespace-nowrap",title:"Adicionar nova categoria",children:[e.jsx(os,{size:16})," Adicionar"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"üè∑Ô∏è Subcategoria DRE (Demonstrativo de Resultado)"}),e.jsxs("select",{value:p.dre_subcategoria_id||"",onChange:L=>l({...p,dre_subcategoria_id:L.target.value?parseInt(L.target.value):null}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Sem classifica√ß√£o DRE"}),f.map(L=>e.jsx("option",{value:L.id,children:L.nome},L.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Classifique para melhor an√°lise gerencial"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(za,{size:16,className:"inline mr-1"}),"Valor *"]}),e.jsx("input",{type:"number",step:"0.01",value:p.valor_original,onChange:L=>l({...p,valor_original:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Cs,{size:16,className:"inline mr-1"}),"Data Vencimento *"]}),e.jsx("input",{type:"date",value:p.data_vencimento,onChange:L=>l({...p,data_vencimento:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Documento/NF"}),e.jsx("input",{type:"text",value:p.documento,onChange:L=>l({...p,documento:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",placeholder:"N√∫mero do documento"})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"eh_recorrente",checked:p.eh_recorrente,onChange:L=>l({...p,eh_recorrente:L.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsxs("label",{htmlFor:"eh_recorrente",className:"text-lg font-semibold text-gray-700 flex items-center gap-2 cursor-pointer",children:[e.jsx(Kn,{size:20,className:"text-purple-600"}),"Despesa Recorrente"]})]}),p.eh_recorrente&&e.jsxs("div",{className:"ml-6 space-y-4 p-4 bg-purple-50 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Recorr√™ncia *"}),e.jsxs("select",{value:p.tipo_recorrencia,onChange:L=>l({...p,tipo_recorrencia:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"semanal",children:"üìÖ Semanal (7 em 7 dias)"}),e.jsx("option",{value:"quinzenal",children:"üìÜ Quinzenal (15 em 15 dias)"}),e.jsx("option",{value:"mensal",children:"üóìÔ∏è Mensal"}),e.jsx("option",{value:"personalizado",children:"‚öôÔ∏è Personalizado"})]})]}),p.tipo_recorrencia==="personalizado"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Intervalo (em dias) *"}),e.jsx("input",{type:"number",min:"1",value:p.intervalo_dias||"",onChange:L=>l({...p,intervalo_dias:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500",placeholder:"Ex: 10, 20, 45...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N√∫mero de Repeti√ß√µes"}),e.jsx("input",{type:"number",min:"1",value:p.numero_repeticoes||"",onChange:L=>l({...p,numero_repeticoes:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500",placeholder:"Ex: 12 (deixe vazio para infinito)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Quantas vezes deve se repetir (opcional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de T√©rmino (alternativa)"}),e.jsx("input",{type:"date",value:p.data_fim_recorrencia||"",onChange:L=>l({...p,data_fim_recorrencia:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"At√© quando deve repetir (opcional)"})]})]}),e.jsx("div",{className:"bg-blue-100 border border-blue-300 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"üí° Como funciona:"})," Esta conta ser√° criada agora e o sistema ir√° gerar automaticamente novas contas nos pr√≥ximos per√≠odos conforme a recorr√™ncia configurada."]})})]})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"eh_parcelado",checked:p.eh_parcelado,onChange:L=>{l({...p,eh_parcelado:L.target.checked}),L.target.checked||m([])},disabled:p.eh_recorrente,className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 disabled:opacity-50"}),e.jsx("label",{htmlFor:"eh_parcelado",className:"text-lg font-semibold text-gray-700 cursor-pointer",children:"üí≥ Parcelar esta conta"})]}),p.eh_parcelado&&!p.eh_recorrente&&e.jsxs("div",{className:"ml-6 space-y-4 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N√∫mero de Parcelas *"}),e.jsx("input",{type:"number",min:"2",max:"120",value:p.total_parcelas,onChange:L=>l({...p,total_parcelas:L.target.value}),onBlur:h,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Intervalo (dias)"}),e.jsxs("select",{value:k,onChange:L=>{w(parseInt(L.target.value)),setTimeout(h,100)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"7",children:"7 dias (semanal)"}),e.jsx("option",{value:"14",children:"14 dias (quinzenal)"}),e.jsx("option",{value:"15",children:"15 dias"}),e.jsx("option",{value:"21",children:"21 dias"}),e.jsx("option",{value:"30",children:"30 dias (mensal)"}),e.jsx("option",{value:"60",children:"60 dias (bimestral)"}),e.jsx("option",{value:"90",children:"90 dias (trimestral)"})]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:h,className:"mt-6 w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"üìã Gerar Preview"})})]}),c.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-3",children:"üìÖ Preview das Parcelas"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:c.map((L,Z)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white rounded border",children:[e.jsxs("span",{className:"font-semibold text-gray-600 min-w-[80px]",children:["Parcela ",L.numero,"/",c.length]}),e.jsx("input",{type:"number",step:"0.01",value:L.valor,onChange:A=>R(Z,A.target.value),className:"w-32 px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Valor"}),e.jsx("input",{type:"date",value:L.data_vencimento,onChange:A=>M(Z,A.target.value),className:"flex-1 px-2 py-1 border border-gray-300 rounded text-sm"})]},Z))}),e.jsx("div",{className:"mt-3 p-2 bg-gray-100 rounded",children:e.jsxs("strong",{children:["Total: R$ ",c.reduce((L,Z)=>L+Z.valor,0).toFixed(2)]})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observa√ß√µes"}),e.jsx("textarea",{value:p.observacoes,onChange:L=>l({...p,observacoes:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Informa√ß√µes adicionais..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{n(),te()},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:d,className:"px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50",children:d?"Salvando...":"Salvar Conta"})]})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Nova Categoria Financeira"}),e.jsx("button",{type:"button",onClick:()=>b(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(ma,{size:24})})]}),e.jsxs("form",{onSubmit:re,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Categoria *"}),e.jsx("input",{type:"text",value:u.nome,onChange:L=>i({...u,nome:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0,placeholder:"Ex: Fornecedores, Aluguel, Sal√°rios..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"√çcone"}),e.jsx("select",{value:u.icone,onChange:L=>i({...u,icone:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:["üí∏","üè†","‚ö°","üíß","üë•","üì¶","üîß","üöó","üçΩÔ∏è","üìù","üõ°Ô∏è","üõí"].map(L=>e.jsx("option",{value:L,children:L},L))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor"}),e.jsx("input",{type:"color",value:u.cor,onChange:L=>i({...u,cor:L.target.value}),className:"w-full h-10 border border-gray-300 rounded-md"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri√ß√£o"}),e.jsx("textarea",{value:u.descricao,onChange:L=>i({...u,descricao:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",rows:"2"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subcategorias DRE (opcional)"}),e.jsxs("button",{type:"button",onClick:_,className:"text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[e.jsx(os,{size:14})," Adicionar"]})]}),u.novasSubcategorias.length>0&&e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:u.novasSubcategorias.map((L,Z)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-md",children:[e.jsx("input",{type:"text",value:L.nome,onChange:A=>S(Z,"nome",A.target.value),onKeyDown:A=>K(A,Z),placeholder:"Nome (Tab para adicionar mais)",className:"flex-1 px-2 py-1 border border-gray-300 rounded-md text-sm"}),e.jsx("button",{type:"button",onClick:()=>$(Z),className:"text-red-600 hover:text-red-800 p-1",children:e.jsx(ma,{size:16})})]},Z))}),u.novasSubcategorias.length===0&&e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Aperte Tab no √∫ltimo campo para adicionar mais subcategorias"})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Criar Categoria"})]})]})]})})]}):null},wa=s=>Array.isArray(s)?s:[],Qi=()=>{var B;const s=fa(),[n,t]=a.useState([]),[d,o]=a.useState(!0),[g,r]=a.useState({status:"todos",fornecedor_id:null,data_inicio:"",data_fim:"",apenas_vencidas:!1,apenas_vencer:!1,numero_nf:""}),[v,j]=a.useState([]),[f,y]=a.useState(null),[c,m]=a.useState(!1),[k,w]=a.useState(!1),[x,b]=a.useState(!1),[u,i]=a.useState([]),[p,l]=a.useState([]),[C,h]=a.useState(!1),[_,S]=a.useState({nome:"",tipo:"dinheiro",conta_bancaria_destino_id:null}),[$,K]=a.useState({valor_pago:0,data_pagamento:new Date().toISOString().split("T")[0],forma_pagamento_id:"",conta_bancaria_id:"",valor_juros:0,valor_multa:0,valor_desconto:0,observacoes:""});a.useEffect(()=>{re()},[]);const re=async()=>{try{const[N,O,z,ae]=await Promise.all([F.get(`/contas-pagar/?_t=${Date.now()}`),F.get("/clientes/?tipo_cadastro=fornecedor"),F.get("/financeiro/formas-pagamento/"),F.get("/contas-bancarias?apenas_ativas=true")]);t(wa(N.data)),j(wa(O.data)),i(wa(z.data)),l(wa(ae.data))}catch(N){console.error("Erro ao carregar dados:",N),ce.error("Erro ao carregar contas a pagar")}finally{o(!1)}},M=async()=>{try{o(!0);const N=new URLSearchParams;g.status!=="todos"&&N.append("status",g.status),g.fornecedor_id&&N.append("fornecedor_id",g.fornecedor_id),g.data_inicio&&N.append("data_inicio",g.data_inicio),g.data_fim&&N.append("data_fim",g.data_fim),g.apenas_vencidas&&N.append("apenas_vencidas","true"),g.apenas_vencer&&N.append("apenas_vencer","true"),g.numero_nf&&N.append("numero_nf",g.numero_nf);const O=await F.get(`/contas-pagar/?${N}`);t(O.data)}catch(N){console.error("Erro ao filtrar:",N),ce.error("Erro ao aplicar filtros")}finally{o(!1)}},R=N=>{y(N);const O=u.find(z=>z.id===N.forma_pagamento_id);K({valor_pago:N.valor_final-N.valor_pago,forma_pagamento_id:N.forma_pagamento_id||"",conta_bancaria_id:(O==null?void 0:O.conta_bancaria_destino_id)||"",valor_juros:0,valor_multa:0,valor_desconto:0,observacoes:""}),m(!0)},J=N=>{y(N),b(!0)},te=N=>{N.nota_entrada_id?s(`/compras?nota_id=${N.nota_entrada_id}`):N.nfe_numero?s(`/compras?numero=${N.nfe_numero}`):ce.error("Nota fiscal n√£o encontrada")},L=N=>{const O=new URLSearchParams;N.fornecedor_nome&&O.append("busca",N.fornecedor_nome),N.documento&&O.append("documento",N.documento),s(`/financeiro/fluxo-caixa?${O.toString()}`),ce.success("Redirecionando para o Fluxo de Caixa...")},Z=N=>{const O=u.find(z=>z.id===parseInt(N));K({...$,forma_pagamento_id:parseInt(N)||"",conta_bancaria_id:(O==null?void 0:O.conta_bancaria_destino_id)||$.conta_bancaria_id||""})},A=async()=>{try{await F.post("/financeiro/formas-pagamento",{..._,taxa_percentual:0,taxa_fixa:0,prazo_dias:0,ativo:!0,permite_parcelamento:!1,parcelas_maximas:1}),ce.success("Forma de pagamento criada!"),h(!1),S({nome:"",tipo:"dinheiro",conta_bancaria_destino_id:null}),re()}catch(N){console.error("Erro:",N),ce.error("Erro ao criar forma de pagamento")}},G=async()=>{var N,O;try{await F.post(`/contas-pagar/${f.id}/pagar`,$),ce.success("Pagamento registrado com sucesso!"),m(!1),re()}catch(z){console.error("Erro ao registrar pagamento:",z),ce.error(((O=(N=z.response)==null?void 0:N.data)==null?void 0:O.detail)||"Erro ao registrar pagamento")}},E=N=>{if(!N)return"-";const O=N.split("T")[0].split("-");return new Date(parseInt(O[0]),parseInt(O[1])-1,parseInt(O[2])).toLocaleDateString("pt-BR")},P=N=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(N),H=N=>{const O=new Date,z=new Date(N.data_vencimento);return N.status==="pago"?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-green-100 text-green-800",children:"‚úì Pago"}):z<O?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-red-100 text-red-800",children:"‚ö† Vencida"}):N.status==="parcial"?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-yellow-100 text-yellow-800",children:"‚ö° Parcial"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-blue-100 text-blue-800",children:"‚è± Pendente"})};return d?e.jsx("div",{className:"text-center p-8",children:"Carregando contas a pagar..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"üí∞ Contas a Pagar"}),e.jsx("button",{onClick:()=>w(!0),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg",children:"‚ûï Nova Conta"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:[e.jsx("h5",{className:"text-lg font-semibold mb-4",children:"üîç Filtros"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:g.status,onChange:N=>r({...g,status:N.target.value}),children:[e.jsx("option",{value:"todos",children:"Todos"}),e.jsx("option",{value:"pendente",children:"Pendente"}),e.jsx("option",{value:"parcial",children:"Parcial"}),e.jsx("option",{value:"pago",children:"Pago"}),e.jsx("option",{value:"vencido",children:"Vencido"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fornecedor"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:g.fornecedor_id||"",onChange:N=>r({...g,fornecedor_id:N.target.value||null}),children:[e.jsx("option",{value:"",children:"Todos"}),wa(v).map(N=>e.jsx("option",{value:N.id,children:N.nome},N.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"N√∫mero NF"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",placeholder:"Ex: 12345",value:g.numero_nf,onChange:N=>r({...g,numero_nf:N.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data In√≠cio"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:g.data_inicio,onChange:N=>r({...g,data_inicio:N.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:g.data_fim,onChange:N=>r({...g,data_fim:N.target.value})})]}),e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:g.apenas_vencidas,onChange:N=>r({...g,apenas_vencidas:N.target.checked,apenas_vencer:!1})}),e.jsx("span",{className:"text-sm",children:"S√≥ Vencidas"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:g.apenas_vencer,onChange:N=>r({...g,apenas_vencer:N.target.checked,apenas_vencidas:!1})}),e.jsx("span",{className:"text-sm",children:"A Vencer"})]}),e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm",onClick:M,children:"Filtrar"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Descri√ß√£o"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Fornecedor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Vencimento"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Valor Original"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Valor Pago"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Saldo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"px-4 py-8 text-center text-gray-500",children:"Nenhuma conta encontrada"})}):wa(n).map(N=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:N.id}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[N.descricao,N.eh_parcelado&&e.jsxs("span",{className:"ml-2 px-2 py-1 text-xs rounded bg-gray-100 text-gray-700",children:[N.numero_parcela,"/",N.total_parcelas]})]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:N.fornecedor_nome||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:E(N.data_vencimento)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:P(N.valor_original)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:P(N.valor_pago)}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold",children:P(N.valor_final-N.valor_pago)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:H(N)}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[N.status!=="pago"&&e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>R(N),title:"Registrar Pagamento",children:"üí∞ Pagar"}),e.jsx("button",{className:"bg-blue-50 hover:bg-blue-100 text-blue-600 px-3 py-1 rounded text-xs",onClick:()=>J(N),title:"Ver Detalhes",children:"üëÅÔ∏è"})]})]},N.id))})]})}),n.length>0&&e.jsxs("div",{className:"bg-green-50 border-t border-green-200 px-4 py-3",children:[e.jsx("strong",{children:"Total:"})," ",n.length," conta(s) |",e.jsx("strong",{className:"ml-3",children:"Saldo a Pagar:"})," ",P(n.reduce((N,O)=>N+(O.valor_final-O.valor_pago),0))]})]}),c&&f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b p-4",children:[e.jsx("h5",{className:"text-xl font-bold",children:"üí∞ Registrar Pagamento"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 text-2xl",onClick:()=>m(!1),children:"√ó"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mb-4 text-sm",children:[e.jsx("strong",{children:"Conta:"})," ",f.descricao,e.jsx("br",{}),e.jsx("strong",{children:"Valor Total:"})," ",P(f.valor_final),e.jsx("br",{}),e.jsx("strong",{children:"J√° Pago:"})," ",P(f.valor_pago),e.jsx("br",{}),e.jsx("strong",{children:"Saldo Restante:"})," ",P(f.valor_final-f.valor_pago)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Valor a Pagar *"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:$.valor_pago,onChange:N=>K({...$,valor_pago:parseFloat(N.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data do Pagamento *"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:$.data_pagamento,onChange:N=>K({...$,data_pagamento:N.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Forma de Pagamento"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"flex-1 border border-gray-300 rounded px-3 py-2",value:$.forma_pagamento_id||"",onChange:N=>Z(N.target.value),children:[e.jsx("option",{value:"",children:"Selecione..."}),wa(u).map(N=>e.jsxs("option",{value:N.id,children:[N.icone||"üí≥"," ",N.nome]},N.id))]}),e.jsx("button",{type:"button",className:"px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:()=>h(!0),title:"Adicionar nova forma de pagamento",children:"+"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Conta Banc√°ria *",$.forma_pagamento_id&&((B=u.find(N=>N.id===$.forma_pagamento_id))==null?void 0:B.conta_bancaria_destino_id)&&e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(Padr√£o da forma selecionada)"})]}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:$.conta_bancaria_id||"",onChange:N=>K({...$,conta_bancaria_id:parseInt(N.target.value)||null}),children:[e.jsx("option",{value:"",children:"Selecione a conta..."}),wa(p).map(N=>e.jsxs("option",{value:N.id,children:[N.nome," - ",P(N.saldo_atual||0)]},N.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Juros"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:$.valor_juros,onChange:N=>K({...$,valor_juros:parseFloat(N.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Multa"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:$.valor_multa,onChange:N=>K({...$,valor_multa:parseFloat(N.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Desconto"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:$.valor_desconto,onChange:N=>K({...$,valor_desconto:parseFloat(N.target.value)||0})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Observa√ß√µes"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded px-3 py-2",rows:"3",value:$.observacoes,onChange:N=>K({...$,observacoes:N.target.value})})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded p-3 mt-4",children:[e.jsx("strong",{children:"Valor Final do Pagamento:"})," ",P(($.valor_pago||0)+($.valor_juros||0)+($.valor_multa||0)-($.valor_desconto||0))]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t p-4",children:[e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",onClick:()=>m(!1),children:"Cancelar"}),e.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:G,children:"‚úì Confirmar Pagamento"})]})]})}),x&&f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-6 py-4 flex justify-between items-center sticky top-0",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Detalhes da Conta"}),e.jsx("button",{onClick:()=>b(!1),className:"text-white hover:bg-blue-700 px-3 py-1 rounded",children:"‚úï"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Parcela"}),e.jsx("p",{className:"mt-1 text-lg",children:f.numero_parcela&&f.total_parcelas?`${f.numero_parcela}/${f.total_parcelas}`:f.documento||"√önica"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Fornecedor"}),e.jsx("p",{className:"mt-1 text-lg",children:f.fornecedor_nome||"N/A"})]})]}),f.nfe_numero&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nota Fiscal"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>te(f),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg border border-blue-200 transition-colors",children:[e.jsx("span",{className:"text-xl",children:"üìÑ"}),e.jsx("span",{className:"font-medium",children:f.nfe_numero})]}),e.jsxs("button",{onClick:()=>L(f),className:"flex items-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg border border-green-200 transition-colors",title:"Ver no Fluxo de Caixa",children:[e.jsx("span",{className:"text-xl",children:"üìà"}),e.jsx("span",{className:"text-sm",children:"Fluxo"})]})]})]}),!f.nfe_numero&&e.jsx("div",{children:e.jsxs("button",{onClick:()=>L(f),className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg border border-green-200 transition-colors",children:[e.jsx("span",{className:"text-xl",children:"üìà"}),e.jsx("span",{className:"font-medium",children:"Ver no Fluxo de Caixa"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Data de Emiss√£o"}),e.jsx("p",{className:"mt-1",children:E(f.data_emissao)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Data de Vencimento"}),e.jsx("p",{className:"mt-1",children:E(f.data_vencimento)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor Original"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-blue-600",children:P(f.valor_final||f.valor_total||0)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor Pago"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-green-600",children:P(f.valor_pago||0)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Saldo Restante"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-red-600",children:P((f.valor_final||f.valor_total||0)-(f.valor_pago||0))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsx("p",{className:"mt-1",children:e.jsx("span",{className:`px-2 py-1 rounded text-sm ${f.status==="pago"?"bg-green-100 text-green-800":f.status==="parcial"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:f.status==="pago"?"Pago":f.status==="parcial"?"Parcial":"Pendente"})})]})]}),f.observacoes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Observa√ß√µes"}),e.jsx("p",{className:"mt-1 text-gray-600",children:f.observacoes})]})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"bg-green-600 text-white px-6 py-4 flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Nova Forma de Pagamento"}),e.jsx("button",{onClick:()=>h(!1),className:"text-white hover:bg-green-700 px-3 py-1 rounded",children:"‚úï"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nome *"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",value:_.nome,onChange:N=>S({..._,nome:N.target.value}),placeholder:"Ex: PIX Santander, Dinheiro..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipo"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:_.tipo,onChange:N=>S({..._,tipo:N.target.value}),children:[e.jsx("option",{value:"dinheiro",children:"üíµ Dinheiro"}),e.jsx("option",{value:"pix",children:"üì± PIX"}),e.jsx("option",{value:"cartao_debito",children:"üí≥ Cart√£o D√©bito"}),e.jsx("option",{value:"cartao_credito",children:"üí≥ Cart√£o Cr√©dito"}),e.jsx("option",{value:"transferencia",children:"üè¶ Transfer√™ncia"}),e.jsx("option",{value:"boleto",children:"üìÑ Boleto"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Conta Banc√°ria Padr√£o"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:_.conta_bancaria_destino_id||"",onChange:N=>S({..._,conta_bancaria_destino_id:parseInt(N.target.value)||null}),children:[e.jsx("option",{value:"",children:"Nenhuma (selecionar manualmente)"}),wa(p).map(N=>e.jsx("option",{value:N.id,children:N.nome},N.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Esta conta ser√° pr√©-selecionada automaticamente ao usar esta forma"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t p-4",children:[e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",onClick:()=>h(!1),children:"Cancelar"}),e.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:A,children:"‚úì Criar"})]})]})}),e.jsx(Gi,{isOpen:k,onClose:()=>w(!1),onSave:re})]})},Xi=()=>{var B;const s=fa(),[n,t]=a.useState([]),[d,o]=a.useState(!0),[g,r]=a.useState({status:"todos",cliente_id:null,data_inicio:"",data_fim:"",apenas_vencidas:!1,apenas_vencer:!1}),[v,j]=a.useState(""),[f,y]=a.useState("desc"),[c,m]=a.useState([]),[k,w]=a.useState(null),[x,b]=a.useState(null),[u,i]=a.useState(!1),[p,l]=a.useState(!1),[C,h]=a.useState([]),[_,S]=a.useState([]),[$,K]=a.useState({valor_recebido:0,data_recebimento:new Date().toISOString().split("T")[0],forma_pagamento_id:null,conta_bancaria_id:null,valor_juros:0,valor_multa:0,valor_desconto:0,observacoes:""});a.useEffect(()=>{re()},[]),a.useEffect(()=>{if(v.trim().length>0){const N=setTimeout(()=>{M()},500);return()=>clearTimeout(N)}else v===""&&re()},[v]);const re=async()=>{try{const O={Authorization:`Bearer ${localStorage.getItem("token")}`},[z,ae,W,ie]=await Promise.all([F.get("/contas-receber/",{headers:O}),F.get("/clientes/",{headers:O}),F.get("/financeiro/formas-pagamento/",{headers:O}),F.get("/contas-bancarias?apenas_ativas=true",{headers:O})]);console.log("üìä Contas carregadas:",z.data.length,"contas"),console.log("üìã Status das contas:",wa(z.data).map(Q=>({id:Q.id,status:Q.status,descricao:Q.descricao}))),console.log("üî¢ Todas as vendas nos contas:",wa(z.data).map(Q=>Q.numero_venda).filter(Q=>Q)),console.log("üéØ Procurando venda 202601100007:",z.data.find(Q=>{var de;return Q.numero_venda==="202601100007"||((de=Q.descricao)==null?void 0:de.includes("202601100007"))})),console.log("üì¶ Antes de setContas:",z.data);const ee=[...wa(z.data)].sort((Q,de)=>de.id-Q.id);t(ee),console.log("‚úÖ Contas setadas no estado"),m(wa(ae.data)),m(wa(ae.data)),h(wa(W.data)),S(wa(ie.data))}catch(N){console.error("Erro ao carregar dados:",N),ce.error("Erro ao carregar contas a receber")}finally{o(!1)}},M=async()=>{try{o(!0);const N=new URLSearchParams;g.status!=="todos"&&N.append("status",g.status),g.cliente_id&&N.append("cliente_id",g.cliente_id),g.data_inicio&&N.append("data_inicio",g.data_inicio),g.data_fim&&N.append("data_fim",g.data_fim),g.apenas_vencidas&&N.append("apenas_vencidas","true"),g.apenas_vencer&&N.append("apenas_vencer","true"),v&&N.append("numero_venda",v);const O=await F.get(`/contas-receber/?${N}`);t(O.data)}catch(N){console.error("Erro ao filtrar:",N),ce.error("Erro ao aplicar filtros")}finally{o(!1)}},R=N=>{sessionStorage.setItem("abrirVenda",N),sessionStorage.setItem("abrirModalPagamento","true"),ce.success("Redirecionando para o PDV..."),s("/pdv")},J=N=>{const O=new URLSearchParams;N.cliente_nome&&O.append("busca",N.cliente_nome),N.documento&&O.append("documento",N.documento),s(`/financeiro/fluxo-caixa?${O.toString()}`),ce.success("Redirecionando para o Fluxo de Caixa...")},te=()=>{const N=f==="desc"?"asc":"desc";y(N);const O=[...n].sort((z,ae)=>N==="desc"?ae.id-z.id:z.id-ae.id);t(O),ce.success(N==="desc"?"üìÖ Ordenado: Mais recentes primeiro":"üìÖ Ordenado: Mais antigas primeiro")},L=N=>{w(N),K({valor_recebido:parseFloat((N.valor_final-N.valor_recebido).toFixed(2)),data_recebimento:new Date().toISOString().split("T")[0],forma_pagamento_id:N.forma_pagamento_id||null,conta_bancaria_id:null,valor_juros:0,valor_multa:0,valor_desconto:0,observacoes:""}),i(!0)},Z=async N=>{try{const O=await F.get(`/contas-receber/${N.id}`);w(N),b(O.data),l(!0)}catch(O){console.error("Erro ao carregar detalhes:",O),ce.error("Erro ao carregar detalhes da conta")}},A=N=>{s(`/pdv?venda=${N}`)},G=async()=>{var N,O;try{await F.post(`/contas-receber/${k.id}/receber`,$),ce.success("Recebimento registrado com sucesso!"),i(!1),re()}catch(z){console.error("Erro ao registrar recebimento:",z),ce.error(((O=(N=z.response)==null?void 0:N.data)==null?void 0:O.detail)||"Erro ao registrar recebimento")}},E=N=>{if(!N)return"-";const O=N.split("T")[0].split("-");return new Date(parseInt(O[0]),parseInt(O[1])-1,parseInt(O[2])).toLocaleDateString("pt-BR")},P=N=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(N),H=N=>{const O=new Date,z=new Date(N.data_vencimento);return N.status==="recebido"?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-green-100 text-green-800",children:"‚úì Recebido"}):z<O?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-red-100 text-red-800",children:"‚ö† Vencida"}):N.status==="parcial"?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-yellow-100 text-yellow-800",children:"‚ö° Parcial"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-blue-100 text-blue-800",children:"‚è± Pendente"})};return d?e.jsx("div",{className:"text-center p-8",children:"Carregando contas a receber..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"üíµ Contas a Receber"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:te,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2",title:f==="desc"?"Clique para ver mais antigas primeiro":"Clique para ver mais recentes primeiro",children:f==="desc"?"üîΩ Mais Recentes":"üîº Mais Antigas"}),e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg",children:"‚ûï Nova Conta"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:[e.jsx("h5",{className:"text-lg font-semibold mb-4",children:"üîç Filtros"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"üî¢ Buscar por N√∫mero da Venda"}),e.jsx("input",{type:"text",placeholder:"Digite o n√∫mero da venda (ex: 202601100003) e pressione Enter",className:"w-full border border-gray-300 rounded px-3 py-2",value:v,onChange:N=>{const O=N.target.value.replace("#","");j(O)},onKeyPress:N=>{N.key==="Enter"&&M()}})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:g.status,onChange:N=>r({...g,status:N.target.value}),children:[e.jsx("option",{value:"todos",children:"Todos"}),e.jsx("option",{value:"pendente",children:"Pendente"}),e.jsx("option",{value:"parcial",children:"Parcial"}),e.jsx("option",{value:"recebido",children:"Recebido"}),e.jsx("option",{value:"vencido",children:"Vencido"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Cliente"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:g.cliente_id||"",onChange:N=>r({...g,cliente_id:N.target.value||null}),children:[e.jsx("option",{value:"",children:"Todos"}),wa(c).map(N=>e.jsx("option",{value:N.id,children:N.nome},N.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data In√≠cio"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:g.data_inicio,onChange:N=>r({...g,data_inicio:N.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:g.data_fim,onChange:N=>r({...g,data_fim:N.target.value})})]}),e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:g.apenas_vencidas,onChange:N=>r({...g,apenas_vencidas:N.target.checked,apenas_vencer:!1})}),e.jsx("span",{className:"text-sm",children:"S√≥ Vencidas"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:g.apenas_vencer,onChange:N=>r({...g,apenas_vencer:N.target.checked,apenas_vencidas:!1})}),e.jsx("span",{className:"text-sm",children:"A Vencer"})]}),e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm",onClick:M,children:"Filtrar"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Descri√ß√£o"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Vencimento"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Valor Original"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Valor Recebido"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Saldo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:wa(n).length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"px-4 py-8 text-center text-gray-500",children:"Nenhuma conta encontrada"})}):wa(n).filter(N=>{if(!v)return!0;const O=String(N.numero_venda||""),z=String(N.descricao||""),ae=v.toLowerCase();return O.toLowerCase().includes(ae)||z.toLowerCase().includes(ae)}).map(N=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:N.id}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[N.descricao,N.eh_parcelado&&e.jsxs("span",{className:"ml-2 px-2 py-1 text-xs rounded bg-gray-100 text-gray-700",children:[N.numero_parcela,"/",N.total_parcelas]})]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:N.cliente_nome||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:E(N.data_vencimento)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:P(N.valor_original)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:P(N.valor_recebido)}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold",children:P(N.valor_final-N.valor_recebido)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:H(N)}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[N.status!=="recebido"&&e.jsx(e.Fragment,{children:N.nsu&&!N.conciliado?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>s(`/conciliacao-cartao?nsu=${N.nsu}`),title:`Conciliar NSU ${N.nsu} com extrato da operadora`,children:"üîÑ Conciliar"}),e.jsx("button",{className:"bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>L(N),title:"Receber manual (caso n√£o consiga conciliar)",children:"üí≥ Manual"})]}):N.venda_id&&!N.nsu?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>{console.log("Conta:",N),N.venda_id?R(N.venda_id):L(N)},title:"Receber no PDV (movimenta caixa)",children:"üíµ PDV"}),e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>L(N),title:"Receber manual (sem PDV)",children:"üí∞ Manual"})]}):e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>L(N),title:"Registrar recebimento manual",children:"üí∞ Receber Manual"})}),N.conciliado&&e.jsx("span",{className:"text-xs text-green-600 font-semibold mr-2",title:`Conciliado em ${N.data_conciliacao}`,children:"‚úì Conciliado"}),e.jsx("button",{className:"bg-blue-50 hover:bg-blue-100 text-blue-600 px-3 py-1 rounded text-xs",title:"Ver Detalhes",onClick:()=>Z(N),children:"üëÅÔ∏è"})]})]},N.id))})]})}),n.length>0&&e.jsxs("div",{className:"bg-green-50 border-t border-green-200 px-4 py-3",children:[e.jsx("strong",{children:"Total:"})," ",n.length," conta(s) |",e.jsx("strong",{className:"ml-3",children:"Saldo a Receber:"})," ",P(n.reduce((N,O)=>N+(O.valor_final-O.valor_recebido),0))]})]}),u&&k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b p-4",children:[e.jsx("h5",{className:"text-xl font-bold",children:"üí∞ Registrar Recebimento"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 text-2xl",onClick:()=>i(!1),children:"√ó"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mb-4 text-sm",children:[e.jsx("strong",{children:"Conta:"})," ",k.descricao,e.jsx("br",{}),e.jsx("strong",{children:"Valor Total:"})," ",P(k.valor_final),e.jsx("br",{}),e.jsx("strong",{children:"J√° Recebido:"})," ",P(k.valor_recebido),e.jsx("br",{}),e.jsx("strong",{children:"Saldo Restante:"})," ",P(k.valor_final-k.valor_recebido)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Valor a Receber *"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:$.valor_recebido,onChange:N=>K({...$,valor_recebido:parseFloat(N.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data do Recebimento *"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:$.data_recebimento,onChange:N=>K({...$,data_recebimento:N.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Forma de Pagamento"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:$.forma_pagamento_id||"",onChange:N=>K({...$,forma_pagamento_id:parseInt(N.target.value)||null}),children:[e.jsx("option",{value:"",children:"Selecione..."}),wa(C).map(N=>e.jsx("option",{value:N.id,children:N.nome},N.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Conta Banc√°ria *"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:$.conta_bancaria_id||"",onChange:N=>K({...$,conta_bancaria_id:parseInt(N.target.value)||null}),children:[e.jsx("option",{value:"",children:"Selecione a conta..."}),wa(_).map(N=>e.jsxs("option",{value:N.id,children:[N.nome," - ",P(N.saldo_atual||0)]},N.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Juros"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:$.valor_juros,onChange:N=>K({...$,valor_juros:parseFloat(N.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Multa"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:$.valor_multa,onChange:N=>K({...$,valor_multa:parseFloat(N.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Desconto"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:$.valor_desconto,onChange:N=>K({...$,valor_desconto:parseFloat(N.target.value)||0})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Observa√ß√µes"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded px-3 py-2",rows:"3",value:$.observacoes,onChange:N=>K({...$,observacoes:N.target.value})})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded p-3 mt-4",children:[e.jsx("strong",{children:"Valor Final do Recebimento:"})," ",P(($.valor_recebido||0)+($.valor_juros||0)+($.valor_multa||0)-($.valor_desconto||0))]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t p-4",children:[e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",onClick:()=>i(!1),children:"Cancelar"}),e.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:G,children:"‚úì Confirmar Recebimento"})]})]})}),p&&k&&x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-6 py-4 flex justify-between items-center sticky top-0",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Detalhes da Conta"}),e.jsx("button",{onClick:()=>l(!1),className:"text-white hover:bg-blue-700 px-3 py-1 rounded",children:"‚úï"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"N√∫mero da Conta"}),e.jsx("p",{className:"mt-1 text-lg",children:k.numero_documento||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Cliente"}),e.jsx("p",{className:"mt-1 text-lg",children:((B=x.cliente)==null?void 0:B.nome)||"N/A"})]})]}),x.venda&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pedido/Venda"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>A(x.venda.id),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg border border-blue-200 transition-colors",children:[e.jsx("span",{className:"text-xl",children:"üõí"}),e.jsx("span",{className:"font-semibold",children:x.venda.numero_venda})]}),e.jsxs("button",{onClick:()=>J(k),className:"flex items-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg border border-green-200 transition-colors",title:"Ver no Fluxo de Caixa",children:[e.jsx("span",{className:"text-xl",children:"üìà"}),e.jsx("span",{className:"text-sm",children:"Fluxo"})]})]})]}),!x.venda&&e.jsx("div",{children:e.jsxs("button",{onClick:()=>J(k),className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg border border-green-200 transition-colors",children:[e.jsx("span",{className:"text-xl",children:"üìà"}),e.jsx("span",{className:"font-medium",children:"Ver no Fluxo de Caixa"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Data de Emiss√£o"}),e.jsx("p",{className:"mt-1",children:E(x.datas.emissao)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Data de Vencimento"}),e.jsx("p",{className:"mt-1",children:E(x.datas.vencimento)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor Original"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-blue-600",children:P(x.valores.final)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor Recebido"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-green-600",children:P(x.valores.recebido)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Saldo Restante"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-red-600",children:P(x.valores.saldo)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsx("p",{className:"mt-1",children:e.jsx("span",{className:`px-2 py-1 rounded text-sm ${x.status==="recebido"?"bg-green-100 text-green-800":x.status==="parcial"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:x.status==="recebido"?"‚úì Recebido":x.status==="parcial"?"‚ö° Parcial":"‚è± Pendente"})})]})]}),x.recebimentos&&x.recebimentos.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"üí∞ Hist√≥rico de Recebimentos"}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700",children:"Data"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700",children:"Valor"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700",children:"Conta Banc√°ria"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:wa(x==null?void 0:x.recebimentos).map((N,O)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2 text-sm",children:E(N.data)}),e.jsx("td",{className:"px-3 py-2 text-sm font-semibold text-green-600",children:P(N.valor)}),e.jsx("td",{className:"px-3 py-2 text-sm",children:N.conta_bancaria_nome?e.jsxs("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs",children:["üè¶ ",N.conta_bancaria_nome]}):e.jsx("span",{className:"text-gray-400 text-xs",children:"N√£o informada"})})]},O))})]})})]}),x.observacoes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Observa√ß√µes"}),e.jsx("p",{className:"mt-1 text-gray-600",children:x.observacoes})]})]})]})})]})};function Ji({onConcluida:s,status:n}){const t=fa(),[d,o]=a.useState([]),[g,r]=a.useState([]),[v,j]=a.useState(!1),[f,y]=a.useState(null),[c,m]=a.useState(!1),[k,w]=a.useState(null),[x,b]=a.useState(!1),[u,i]=a.useState([]),[p,l]=a.useState([]),[C,h]=a.useState(!1),[_,S]=a.useState(!1),[$,K]=a.useState("pendentes"),[re,M]=a.useState([]),[R,J]=a.useState(null),[te,L]=a.useState(!0),[Z,A]=a.useState(1),[G,E]=a.useState(1);a.useEffect(()=>{(async()=>{try{if(!localStorage.getItem("access_token")){y("Voc√™ precisa estar logado."),setTimeout(()=>t("/login"),2e3);return}const de=await F.get("/operadoras-cartao?apenas_ativas=true");M(de.data);const me=de.data.find(Pe=>Pe.padrao);me&&J(me)}catch(Q){console.error("Erro ao carregar operadoras:",Q),y("Erro ao carregar operadoras")}finally{L(!1)}})()},[t]),a.useEffect(()=>{R&&(P(),B())},[Z,R,$]),a.useEffect(()=>{if($==="conciliadas"&&d.length>0&&g.length>0){const ee=[];d.forEach(Q=>{var _e;const de=Q.pagamento||((_e=Q.pagamentos)==null?void 0:_e.find(ke=>ke.nsu||ke.nsu_cartao)),me=(de==null?void 0:de.nsu)||(de==null?void 0:de.nsu_cartao)||Q.nsu;if(!me)return;const Pe=g.find(ke=>ke.nsu===me);if(!Pe)return;const se={...Q,numero:Q.numero||Q.numero_venda,nsu:me,bandeira:de==null?void 0:de.bandeira,parcelas:de==null?void 0:de.parcelas,valor:(de==null?void 0:de.valor)??Q.total};ee.push({venda_id:Q.id,status:"ok",venda_pdv:se,venda_stone:Pe})}),l(ee)}else l([])},[$,d,g]),a.useEffect(()=>{const ee=Q=>{Q.key==="Escape"&&_&&(S(!1),i([]),h(!1))};return window.addEventListener("keydown",ee),()=>window.removeEventListener("keydown",ee)},[_]),a.useEffect(()=>{R&&(B(),P())},[R]);const P=async()=>{try{if(j(!0),!localStorage.getItem("access_token")){y("Voc√™ precisa estar logado."),setTimeout(()=>t("/login"),2e3);return}const Q=await F.get("/conciliacao/aba1/vendas-pdv",{params:{status:$,operadora_id:(R==null?void 0:R.id)==="legacy"?"legacy":R==null?void 0:R.id,page:Z,limit:50}});Q.data.success&&(o(Q.data.vendas),E(Q.data.total_pages))}catch(ee){console.error("Erro ao carregar vendas PDV:",ee),y("Erro ao carregar vendas do PDV")}finally{j(!1)}},H=async ee=>{var Pe,se;const Q=ee.target.files[0];if(!Q)return;if(!R){alert(`‚ö†Ô∏è Selecione uma operadora primeiro!

As vendas da planilha ser√£o importadas com a tag da operadora selecionada.
Isso √© importante para o processo de concilia√ß√£o.`),ee.target.value="";return}if(R.id==="legacy"){alert(`‚ö†Ô∏è Vendas Legacy n√£o t√™m planilha!

Vendas sem operadora devem ter a operadora preenchida manualmente usando o bot√£o "Preencher Operadora".`),ee.target.value="";return}if(!window.confirm(`üéØ Confirmar Upload

Operadora selecionada: ${R.nome}

Todas as vendas da planilha "${Q.name}" ser√£o marcadas com esta operadora.

Deseja continuar?`)){ee.target.value="";return}w(Q),b(!0),y(null);const me=new FormData;me.append("arquivo",Q),me.append("operadora_id",R.id);try{const _e=await F.post("/conciliacao/aba1/upload-stone",me,{headers:{"Content-Type":"multipart/form-data"}});_e.data.success&&(await B(),await P(),alert(`‚úÖ Planilha importada com sucesso!

üìä ${_e.data.total_nsus||0} NSUs carregados
Operadora: ${R.nome}

Clique em "Processar Matches" para conciliar automaticamente.`),ee.target.value="")}catch(_e){console.error("Erro no upload:",_e),y(((se=(Pe=_e.response)==null?void 0:Pe.data)==null?void 0:se.detail)||"Erro ao importar planilha"),ee.target.value=""}finally{b(!1)}},B=async()=>{if(R){if(R.id==="legacy"){r([]);return}try{const ee=await F.get("/conciliacao/aba1/stone-nao-conciliadas",{params:{operadora_id:R.id,status:$}});ee.data.success&&r(ee.data.nsus)}catch(ee){console.error("Erro ao carregar NSUs:",ee)}}},N=async()=>{var ee,Q;if(!R){alert("Selecione uma operadora primeiro!");return}b(!0),y(null);try{const de=await F.post("/conciliacao/aba1/processar-matches");de.data.success&&(i(de.data.matches||[]),S(!0),alert(`üîç Matches encontrados!

üìä Resumo:
‚Ä¢ ${de.data.conferidas||0} vendas OK
‚Ä¢ ${de.data.corrigidas||0} com diverg√™ncias
‚Ä¢ ${de.data.sem_nsu||0} sem NSU
‚Ä¢ ${de.data.orfaos||0} NSUs √≥rf√£os

üëÄ Visualize os matches abaixo e confirme para conciliar.`))}catch(de){console.error("Erro ao processar matches:",de),y(((Q=(ee=de.response)==null?void 0:ee.data)==null?void 0:Q.detail)||"Erro ao processar matches autom√°ticos")}finally{b(!1)}},O=async()=>{var Q,de;if(u.length===0)return;const ee=u.filter(me=>me.status==="ok");if(ee.length===0){alert(`‚ö†Ô∏è Nenhum match OK para confirmar!

Apenas matches perfeitos (sem diverg√™ncias) podem ser conciliados.`);return}b(!0);try{const Pe=(await F.get("/conciliacao/aba1/stone-nao-conciliadas",{params:{operadora_id:R==null?void 0:R.id}})).data.importacao_id,se=await F.post("/conciliacao/aba1/confirmar-matches",{importacao_id:Pe,matches_confirmados:ee});se.data.success&&(alert("‚úÖ "+se.data.message),i([]),S(!1),await P(),await B())}catch(me){console.error("Erro ao confirmar matches:",me),y(((de=(Q=me.response)==null?void 0:Q.data)==null?void 0:de.detail)||"Erro ao confirmar matches")}finally{b(!1)}},z=async(ee,Q)=>{var de,me;try{const Pe=await F.put("/conciliacao/aba1/atualizar-operadora",{pagamento_id:ee,operadora_id:Q});if(Pe.data.success)return await P(),alert(`Operadora atualizada para ${Pe.data.operadora_nome}`),!0}catch(Pe){return console.error("Erro ao atualizar operadora:",Pe),alert(((me=(de=Pe.response)==null?void 0:de.data)==null?void 0:me.detail)||"Erro ao atualizar operadora"),!1}},ae=({venda:ee,expandir:Q})=>{var Xe;const[de,me]=a.useState(c),[Pe,se]=a.useState(!1),[_e,ke]=a.useState(""),[Ye,ze]=a.useState(!1),[Qe,be]=a.useState(""),Ee=async()=>{var Je,ca;if(!_e||_e.trim()===""){alert("Digite um NSU v√°lido");return}try{(await F.patch(`/vendas/${ee.id}/pagamento/${ee.pagamento.id}/nsu`,{nsu_cartao:_e.trim()})).data&&(se(!1),ke(""),await P(),alert("NSU atualizado com sucesso!"))}catch(ra){console.error("Erro ao salvar NSU:",ra),alert(((ca=(Je=ra.response)==null?void 0:Je.data)==null?void 0:ca.detail)||"Erro ao salvar NSU")}},he=async()=>{if(!Qe||Qe===""){alert("Selecione uma operadora");return}await z(ee.pagamento.id,parseInt(Qe))&&(ze(!1),be(""))};return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 mb-2 hover:bg-gray-50 cursor-pointer",onClick:Je=>{Je.target.tagName==="INPUT"||Je.target.tagName==="BUTTON"||c||me(!de)},children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"font-medium text-gray-900",children:["Venda ",ee.numero_venda]}),ee.pagamento.operadora_id&&!Ye?e.jsx("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded-full",children:((Xe=re.find(Je=>Je.id===ee.pagamento.operadora_id))==null?void 0:Xe.nome)||"N/A"}):Ye?e.jsxs("div",{className:"flex items-center gap-1",onClick:Je=>Je.stopPropagation(),children:[e.jsxs("select",{value:Qe,onChange:Je=>be(Je.target.value),className:"border border-purple-300 rounded px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-purple-500",autoFocus:!0,children:[e.jsx("option",{value:"",children:"Selecione..."}),re.map(Je=>e.jsx("option",{value:Je.id,children:Je.nome},Je.id))]}),e.jsx("button",{onClick:he,className:"bg-green-500 text-white px-2 py-1 rounded text-xs hover:bg-green-600",children:"‚úì"}),e.jsx("button",{onClick:()=>{ze(!1),be("")},className:"bg-gray-400 text-white px-2 py-1 rounded text-xs hover:bg-gray-500",children:"‚úó"})]}):e.jsx("button",{onClick:Je=>{Je.stopPropagation(),ze(!0)},className:"text-xs text-purple-600 hover:text-purple-700 underline font-medium px-2 py-1 bg-purple-50 rounded",children:"üè¢ Sem Operadora - Clique aqui"}),ee.pagamento.nsu?e.jsxs("span",{className:"text-sm text-green-600",children:["NSU: ",ee.pagamento.nsu]}):Pe?e.jsxs("div",{className:"flex items-center gap-1",onClick:Je=>Je.stopPropagation(),children:[e.jsx("input",{type:"text",value:_e,onChange:Je=>ke(Je.target.value),placeholder:"Digite o NSU",className:"border border-orange-300 rounded px-2 py-1 text-xs w-32 focus:outline-none focus:ring-1 focus:ring-orange-500",autoFocus:!0}),e.jsx("button",{onClick:Ee,className:"bg-green-500 text-white px-2 py-1 rounded text-xs hover:bg-green-600",children:"‚úì"}),e.jsx("button",{onClick:()=>{se(!1),ke("")},className:"bg-gray-400 text-white px-2 py-1 rounded text-xs hover:bg-gray-500",children:"‚úó"})]}):e.jsx("button",{onClick:Je=>{Je.stopPropagation(),se(!0)},className:"text-sm text-orange-600 hover:text-orange-700 underline font-medium",children:"SEM NSU - Clique para preencher"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["R$ ",ee.total.toFixed(2)]}),!c&&e.jsx("svg",{className:`h-4 w-4 text-gray-400 transition-transform ${de?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),(de||c)&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{children:new Date(ee.data_venda).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tipo:"}),e.jsx("span",{className:"capitalize",children:ee.pagamento.forma})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Operadora:"}),e.jsx("span",{className:"font-medium text-blue-600",children:(R==null?void 0:R.nome)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Bandeira:"}),e.jsx("span",{children:ee.pagamento.bandeira||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Parcelas:"}),e.jsxs("span",{children:[ee.pagamento.parcelas,"x"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",ee.pagamento.valor.toFixed(2)]})]})]})]})},W=({nsu:ee,expandir:Q})=>{var Pe,se,_e;const[de,me]=a.useState(c);return e.jsxs("div",{className:"border border-blue-200 rounded-lg p-3 mb-2 hover:bg-blue-50 cursor-pointer",onClick:()=>!c&&me(!de),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("span",{className:"font-medium text-blue-900",children:["NSU: ",ee.nsu]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["R$ ",(Pe=ee.valor_liquido)==null?void 0:Pe.toFixed(2)]}),!c&&e.jsx("svg",{className:`h-4 w-4 text-gray-400 transition-transform ${de?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),(de||c)&&ee.data_venda&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200 text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{children:new Date(ee.data_venda).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Bandeira:"}),e.jsx("span",{children:ee.bandeira})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Parcelas:"}),e.jsxs("span",{children:[ee.parcelas,"x"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Bruto:"}),e.jsxs("span",{children:["R$ ",(se=ee.valor_bruto)==null?void 0:se.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor L√≠quido:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["R$ ",(_e=ee.valor_liquido)==null?void 0:_e.toFixed(2)]})]})]})]})},ie=({match:ee,isConciliado:Q=!1})=>{var me,Pe,se;const de={ok:"bg-green-50 border-green-300",divergencia:"bg-yellow-50 border-yellow-300",orfao:"bg-red-50 border-red-300",sem_nsu:"bg-orange-50 border-orange-300"};return e.jsxs("div",{className:`border-2 rounded-lg p-4 mb-3 ${de[ee.status]} relative`,children:[Q&&e.jsx("div",{className:"absolute top-2 right-2 px-3 py-1 bg-green-600 text-white text-xs font-bold rounded-full",children:"‚úÖ CONCILIADO"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[e.jsx("div",{className:"bg-white p-3 rounded border",children:ee.venda_pdv?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-800",children:["Venda #",ee.venda_pdv.numero]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["NSU: ",ee.venda_pdv.nsu||e.jsx("span",{className:"text-orange-600",children:"SEM NSU"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[ee.venda_pdv.bandeira," - ",ee.venda_pdv.parcelas,"x"]}),e.jsxs("div",{className:"text-xs font-semibold text-gray-800 mt-1",children:["R$ ",(me=ee.venda_pdv.valor)==null?void 0:me.toFixed(2)]})]}):e.jsx("div",{className:"text-sm text-gray-400 italic",children:"Sem venda no PDV"})}),e.jsxs("div",{className:"flex items-center justify-center",children:[ee.status==="ok"&&e.jsx("div",{className:"text-green-600 text-2xl",children:"‚úÖ"}),ee.status==="divergencia"&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-yellow-600 text-xl",children:"‚ö†Ô∏è"}),e.jsx("div",{className:"text-xs text-yellow-700 font-semibold mt-1",children:(Pe=ee.divergencia)==null?void 0:Pe.tipo})]}),ee.status==="orfao"&&e.jsx("div",{className:"text-red-600 text-2xl",children:"‚ùå"}),ee.status==="sem_nsu"&&e.jsx("div",{className:"text-orange-600 text-2xl",children:"‚û°Ô∏è"})]}),e.jsx("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:ee.venda_stone?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-semibold text-blue-800",children:"Planilha Operadora"}),e.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:["NSU: ",ee.venda_stone.nsu]}),e.jsxs("div",{className:"text-xs text-blue-600",children:[ee.venda_stone.bandeira," - ",ee.venda_stone.parcelas,"x"]}),e.jsxs("div",{className:"text-xs font-semibold text-blue-800 mt-1",children:["R$ ",(se=ee.venda_stone.valor_bruto)==null?void 0:se.toFixed(2)]})]}):e.jsx("div",{className:"text-sm text-blue-300 italic",children:"Sem NSU na planilha"})})]}),ee.divergencia&&e.jsx("div",{className:"mt-3 pt-3 border-t border-yellow-300",children:e.jsxs("div",{className:"text-xs text-yellow-800",children:[e.jsx("span",{className:"font-semibold",children:"PDV:"})," ",ee.divergencia.pdv," ‚Üí"," ",e.jsx("span",{className:"font-semibold",children:"Stone:"})," ",ee.divergencia.stone]})})]})};return e.jsxs("div",{className:"flex flex-col h-full p-6 bg-gray-50",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Concilia√ß√£o de Vendas - Stone"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Compare vendas do PDV com a planilha da operadora"})]}),e.jsxs("div",{className:"flex gap-4 mb-4 items-center bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1",children:"Exibir:"}),e.jsxs("select",{value:$,onChange:ee=>K(ee.target.value),className:"border border-gray-300 rounded px-3 py-2 text-sm min-w-[180px] focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"pendentes",children:"‚è≥ Pendentes (N√£o Conciliadas)"}),e.jsx("option",{value:"todas",children:"üìã Todas as Vendas"}),e.jsx("option",{value:"conciliadas",children:"‚úÖ Conciliadas"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1",children:"Operadora de Cart√£o:"}),e.jsxs("select",{value:(R==null?void 0:R.id)||"",onChange:ee=>{const Q=ee.target.value;if(Q==="legacy")J({id:"legacy",nome:"Legacy (Sem Operadora)"});else{const de=re.find(me=>me.id===parseInt(Q));J(de)}},disabled:te,className:"border border-gray-300 rounded px-3 py-2 text-sm min-w-[200px] focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"legacy",className:"text-orange-600 font-semibold",children:"üì¶ Legacy (Sem Operadora)"}),re.map(ee=>e.jsxs("option",{value:ee.id,children:[ee.nome," ",ee.padrao?"(Padr√£o)":""]},ee.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`px-4 py-2 rounded-md ${R&&R.id!=="legacy"?"bg-blue-600 text-white hover:bg-blue-700 cursor-pointer":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:["üì§ Upload Planilha",e.jsx("input",{type:"file",accept:".csv",onChange:H,className:"hidden",disabled:!R||R.id==="legacy"})]}),(R==null?void 0:R.id)==="legacy"&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:'Vendas Legacy n√£o t√™m planilha. Use o campo "Preencher Operadora".'})]}),g.length>0&&!_&&(R==null?void 0:R.id)!=="legacy"&&e.jsx("button",{onClick:N,disabled:x,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400",children:"üîç Processar Matches"}),_&&u.length>0&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:O,disabled:x,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 animate-pulse",children:"‚úÖ Confirmar Matches OK"}),e.jsx("button",{onClick:()=>{S(!1),i([]),h(!1)},className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"‚ùå Cancelar"})]}),e.jsxs("label",{className:"flex items-center gap-2 ml-auto",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:()=>m(!c),className:"rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Mostrar Expandido"})]})]}),f&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg",children:f}),_&&u.length>0||$==="conciliadas"&&p.length>0?e.jsxs("div",{className:"flex-1 overflow-hidden bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"px-6 py-4 bg-gradient-to-r from-blue-100 to-green-100 border-b",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:$==="conciliadas"?"‚úÖ Vendas Conciliadas":"üîç Matches Encontrados - Revise e Confirme"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:$==="conciliadas"?"Vendas PDV conciliadas com NSUs da planilha":"Matches OK no topo ‚Üí Diverg√™ncias ‚Üí Sem match"})]}),e.jsx("div",{className:"overflow-y-auto p-6",style:{maxHeight:"calc(100vh - 300px)"},children:$==="conciliadas"?p.length>0?p.map((ee,Q)=>e.jsx(ie,{match:ee,isConciliado:!0},Q)):e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Nenhuma venda conciliada ainda"}):u.sort((ee,Q)=>{const de={ok:1,divergencia:2,orfao:3,sem_nsu:4};return de[ee.status]-de[Q.status]}).map((ee,Q)=>e.jsx(ie,{match:ee},Q))})]}):e.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-4 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-100 border-b border-gray-200",children:[e.jsxs("h3",{className:"font-semibold text-gray-800",children:["‚¨ÖÔ∏è Vendas PDV (",d.length,")"]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Vendas com cart√£o pendentes"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:v?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Carregando..."}):d.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Nenhuma venda pendente"}):d.map(ee=>e.jsx(ae,{venda:ee},ee.id))}),G>1&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex justify-between items-center",children:[e.jsx("button",{onClick:()=>A(ee=>Math.max(1,ee-1)),disabled:Z===1,className:"px-3 py-1 text-sm bg-white border rounded disabled:opacity-50",children:"‚Üê Anterior"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["P√°gina ",Z," de ",G]}),e.jsx("button",{onClick:()=>A(ee=>Math.min(G,ee+1)),disabled:Z===G,className:"px-3 py-1 text-sm bg-white border rounded disabled:opacity-50",children:"Pr√≥xima ‚Üí"})]})]}),e.jsxs("div",{className:"flex flex-col bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-blue-100 border-b border-blue-200",children:[e.jsxs("h3",{className:"font-semibold text-blue-900",children:[R?`${R.nome} Planilha`:"Planilha"," ‚û°Ô∏è (",g.length,")"]}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"NSUs n√£o conciliados"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:(R==null?void 0:R.id)==="legacy"?e.jsxs("div",{className:"text-center text-orange-600 py-8 bg-orange-50 rounded-lg border-2 border-orange-200",children:[e.jsx("div",{className:"text-5xl mb-4",children:"üì¶"}),e.jsx("h4",{className:"font-bold text-lg mb-2",children:"Vendas Legacy"}),e.jsx("p",{className:"text-sm max-w-md mx-auto",children:"Vendas sem operadora n√£o possuem planilha para concilia√ß√£o autom√°tica."}),e.jsxs("p",{className:"text-sm max-w-md mx-auto mt-2",children:["Use o bot√£o ",e.jsx("strong",{children:'"üè¢ Preencher Operadora"'})," nas vendas do lado esquerdo para associ√°-las a uma operadora."]})]}):g.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:k?"Processando...":`Fa√ßa upload da planilha ${(R==null?void 0:R.nome)||""}`}):g.map((ee,Q)=>e.jsx(W,{nsu:ee},Q))})]})]})]})}function Yi({onConcluida:s,status:n}){var E,P,H;const[t,d]=a.useState(!1),[o,g]=a.useState({recebimentos:null,recibo:null,ofx:null}),[r,v]=a.useState(!1),[j,f]=a.useState(null),[y,c]=a.useState(null),[m,k]=a.useState([]),[w,x]=a.useState(null),[b,u]=a.useState(!0),[i,p]=a.useState(!1),[l,C]=a.useState(!1),[h,_]=a.useState(null),[S,$]=a.useState(0),[K,re]=a.useState(!1),M=()=>{console.log("üéØ Tentando avan√ßar para Aba 3..."),console.log("onConcluida existe?",typeof s),typeof s=="function"?(console.log("‚úÖ Chamando onConcluida()"),s(),console.log("‚úÖ onConcluida() foi chamado com sucesso")):(console.error("‚ùå onConcluida n√£o √© uma fun√ß√£o!",s),alert("Erro: Fun√ß√£o de callback n√£o encontrada. Recarregue a p√°gina."))},R=()=>{g({recebimentos:null,recibo:null,ofx:null}),f(null),c(null),v(!1),re(!1),_(null),$(0),p(!1),C(!1),console.log("üîÑ Estado resetado")};a.useEffect(()=>{(async()=>{try{const N=await F.get("/operadoras-cartao?apenas_ativas=true");k(N.data);const O=N.data.find(z=>z.padrao);O&&x(O)}catch(N){console.error("Erro ao carregar operadoras:",N),c("Erro ao carregar operadoras")}finally{u(!1)}})()},[]),a.useEffect(()=>{const B=localStorage.getItem("conciliacao_aba2_aviso_ate");if(!B)return;const N=Number(B);Number.isFinite(N)&&Date.now()<N&&d(!0)},[]);const J=B=>{const N=Date.now()+B*24*60*60*1e3;localStorage.setItem("conciliacao_aba2_aviso_ate",String(N)),d(!0)},te=(B,N)=>{var z;const O=(z=N.target.files)==null?void 0:z[0];if(!O){console.warn(`Nenhum arquivo selecionado para ${B}`);return}console.log(`üìé Arquivo selecionado para ${B}:`,{name:O.name,size:O.size,type:O.type,lastModified:new Date(O.lastModified).toISOString()}),g(ae=>({...ae,[B]:O})),c(null),f(null)},L=()=>{if(!w){c("Por favor, selecione uma operadora antes de validar.");return}if(!o.recebimentos||!o.recibo||!o.ofx){c("Por favor, fa√ßa upload dos 3 arquivos antes de validar.");return}p(!0)},Z=async()=>{var B,N,O,z,ae,W,ie,ee,Q,de,me,Pe;if(p(!1),console.log("üöÄ Iniciando valida√ß√£o...",{arquivos_estado:{recebimentos:!!o.recebimentos,recibo:!!o.recibo,ofx:!!o.ofx}}),!o.recebimentos||!o.recibo||!o.ofx){c("Voc√™ precisa enviar os 3 arquivos para continuar");return}if(console.log("üîç Validando tipos de arquivo...",{recebimentos_isFile:o.recebimentos instanceof File,recibo_isFile:o.recibo instanceof File,ofx_isFile:o.ofx instanceof File}),!(o.recebimentos instanceof File)){console.error("‚ùå Arquivo de recebimentos n√£o √© um File v√°lido:",o.recebimentos),c("Arquivo de recebimentos inv√°lido. Por favor, selecione novamente."),g(se=>({...se,recebimentos:null}));return}if(!(o.recibo instanceof File)){console.error("‚ùå Arquivo de recibo n√£o √© um File v√°lido:",o.recibo),c("Arquivo de recibo inv√°lido. Por favor, selecione novamente."),g(se=>({...se,recibo:null}));return}if(!(o.ofx instanceof File)){console.error("‚ùå Arquivo OFX n√£o √© um File v√°lido:",o.ofx),c("Arquivo OFX inv√°lido. Por favor, selecione novamente."),g(se=>({...se,ofx:null}));return}v(!0),c(null);try{let se,_e,ke;console.log("üìÇ Lendo arquivos:",{recebimentos:o.recebimentos.name,recibo:o.recibo.name,ofx:o.ofx.name});try{if(se=await o.recebimentos.text(),!se||se.trim().length===0)throw new Error("Arquivo de recebimentos est√° vazio")}catch(oe){throw console.error("Erro ao ler recebimentos:",oe),new Error(`Erro ao ler arquivo de recebimentos: ${oe.message}`)}try{if(_e=await o.recibo.text(),!_e||_e.trim().length===0)throw new Error("Arquivo de recibo est√° vazio")}catch(oe){throw console.error("Erro ao ler recibo:",oe),new Error(`Erro ao ler arquivo de recibo: ${oe.message}`)}try{if(ke=await o.ofx.text(),!ke||ke.trim().length===0)throw new Error("Arquivo OFX est√° vazio")}catch(oe){throw console.error("Erro ao ler OFX:",oe),new Error(`Erro ao ler arquivo OFX: ${oe.message}`)}console.log("üìÑ Arquivos carregados:",{recebimentos_length:se.length,recibo_length:_e.length,ofx_length:ke.length});const Ye=se.split(`
`);console.log("üîç Primeiras 3 linhas do arquivo de recebimentos:"),console.log("Linha 0 (header):",Ye[0]),console.log("Linha 1:",Ye[1]),console.log("Linha 2:",Ye[2]);const ze=_e.split(`
`);console.log("üîç Primeiras 3 linhas do arquivo de recibo:"),console.log("Linha 0 (header):",ze[0]),console.log("Linha 1:",ze[1]),console.log("Linha 2:",ze[2]);const Qe=(B=Ye[0])!=null&&B.includes(";")?";":",";console.log("üìã Separador detectado:",Qe);let be,Ee,he;try{be=se.split(`
`).slice(1).filter(oe=>oe.trim()).map((oe,ye)=>{var Ce,Be,Ie,Y,je,Me;try{const T=oe.split(Qe);ye===0&&(console.log("üîç DEBUG - Primeira linha parseada:"),console.log("Total de campos:",T.length),console.log("Campos relevantes:"),console.log("  Campo 8 (STONE ID/NSU):",T[8]),console.log("  Campo 4 (DATA DE VENCIMENTO):",T[4]),console.log("  Campo 12 (VALOR L√çQUIDO):",T[12]),console.log("  Campo 10 (N¬∫ DA PARCELA):",T[10]),console.log("  Campo 9 (QTD DE PARCELAS):",T[9]),console.log("  Campo 16 (√öLTIMO STATUS):",T[16]));const X=(Ce=T[8])==null?void 0:Ce.trim(),fe=(Be=T[4])==null?void 0:Be.trim(),U=(Ie=T[12])==null?void 0:Ie.trim(),le=(Y=T[10])==null?void 0:Y.trim(),Ne=(je=T[9])==null?void 0:je.trim(),Re=(Me=T[16])==null?void 0:Me.trim(),q=U==null?void 0:U.replace(",","."),ne=parseFloat(q||0);return ye===0&&(console.log("üí∞ Convers√£o de valor:"),console.log("  Original:",U),console.log("  Limpo:",q),console.log("  Final:",ne),console.log("  Is NaN?",isNaN(ne))),{nsu:X,data_recebimento:fe,valor:ne,parcela_numero:parseInt(le||1),total_parcelas:parseInt(Ne||1),tipo_recebimento:Re||"Pago",lote_id:null}}catch(T){throw console.error(`Erro ao parsear linha ${ye+1} de recebimentos:`,oe,T),new Error(`Erro na linha ${ye+1} do arquivo de recebimentos detalhados`)}})}catch(oe){c(`‚ùå Erro ao processar arquivo de recebimentos: ${oe.message}`);return}try{const oe=(N=ze[0])!=null&&N.includes(";")?";":",";console.log("üìÑ Primeira linha do recibo:",ze[0]),console.log("üìÑ Segunda linha do recibo:",ze[1]),Ee=_e.split(`
`).slice(1).filter(ye=>ye.trim()).map((ye,Ce)=>{var Be,Ie,Y;try{const je=ye.split(oe);Ce===0&&(console.log("üîç DEBUG - Recibo primeira linha parseada:"),console.log("Total de campos:",je.length),console.log("  Campo 0 (Valor):",je[0]),console.log("  Campo 13 (ID Rastre√°vel):",je[13]),console.log("  Campo 18 (Status):",je[18]));const Me=(Be=je[0])==null?void 0:Be.trim(),T=(Ie=je[13])==null?void 0:Ie.trim(),X=(Y=je[18])==null?void 0:Y.trim(),fe=Me==null?void 0:Me.replace(",","."),U=parseFloat(fe||0);return Ce===0&&(console.log("üí∞ Convers√£o recibo:"),console.log("  Original:",Me),console.log("  Limpo:",fe),console.log("  Final:",U)),{lote_id:T,valor:U,status:X}}catch(je){throw console.error(`Erro ao parsear linha ${Ce+1} de recibo:`,ye,je),new Error(`Erro na linha ${Ce+1} do arquivo de recibo de lote`)}})}catch(oe){c(`‚ùå Erro ao processar arquivo de recibo: ${oe.message}`);return}try{console.log("üìÑ Primeiras linhas do OFX:",ke.split(`
`).slice(0,30).join(`
`));const oe=[],ye=ke.split(`
`);let Ce=null;for(let Be=0;Be<ye.length;Be++){const Ie=ye[Be].trim();if(Ie==="<STMTTRN>")Ce={};else if(Ie==="</STMTTRN>"&&Ce)(Ce.type==="CREDIT"||Ce.valor&&Ce.valor>0)&&oe.push(Ce),Ce=null;else if(Ce)if(Ie.startsWith("<TRNTYPE>"))Ce.type=Ie.replace("<TRNTYPE>","").replace("</TRNTYPE>","");else if(Ie.startsWith("<DTPOSTED>"))Ce.data=Ie.replace("<DTPOSTED>","").replace("</DTPOSTED>","");else if(Ie.startsWith("<TRNAMT>")){const Y=Ie.replace("<TRNAMT>","").replace("</TRNAMT>","");Ce.valor=parseFloat(Y)}else Ie.startsWith("<FITID>")?Ce.id=Ie.replace("<FITID>","").replace("</FITID>",""):Ie.startsWith("<MEMO>")&&(Ce.memo=Ie.replace("<MEMO>","").replace("</MEMO>",""))}he=oe,console.log("üí≥ OFX parseado:",he.length,"transa√ß√µes encontradas"),he.length>0&&console.log("Primeira transa√ß√£o:",he[0])}catch(oe){console.error("Erro ao parsear OFX:",oe),c(`‚ùå Erro ao processar arquivo OFX: ${oe.message}`);return}if(be.length===0){c("‚ùå Arquivo de recebimentos detalhados est√° vazio ou mal formatado. Verifique o formato CSV.");return}if(Ee.length===0){c("‚ùå Arquivo de recibo de lote est√° vazio ou mal formatado. Verifique o formato CSV.");return}if(he.length===0){c("‚ùå Arquivo OFX est√° vazio ou mal formatado. Verifique o formato.");return}const Xe=be.filter(oe=>isNaN(oe.valor)||oe.valor===null);if(Xe.length>0){console.error("‚ùå Recebimentos com valores inv√°lidos:",Xe),console.error("üìã Primeiras 5 linhas RAW do arquivo:"),Ye.slice(0,6).forEach((oe,ye)=>{console.error(`Linha ${ye}:`,oe)}),c(`‚ùå ${Xe.length} recebimentos t√™m valores inv√°lidos. Verifique o formato dos valores no CSV (use v√≠rgula ou ponto decimal). Veja o console para mais detalhes.`);return}const Je=Ee.filter(oe=>isNaN(oe.valor)||oe.valor===null);if(Je.length>0){console.error("‚ùå Lotes com valores inv√°lidos:",Je),c(`‚ùå ${Je.length} lotes t√™m valores inv√°lidos. Verifique o formato dos valores no CSV.`);return}console.log("‚úÖ Todos os valores validados! Enviando para API..."),console.log("üì§ Enviando dados para API:",{recebimentos_count:be.length,recibo_count:Ee.length,ofx_count:he.length,sample_recebimento:be[0],sample_recebimento_2:be[1],sample_recibo:Ee[0],sample_ofx:he[0]}),console.log("üí∞ Valores parseados (primeiros 3):"),console.log("Recebimento 1:",(O=be[0])==null?void 0:O.valor),console.log("Recebimento 2:",(z=be[1])==null?void 0:z.valor),console.log("Recibo 1:",(ae=Ee[0])==null?void 0:ae.valor),console.log("OFX 1:",(W=he[0])==null?void 0:W.valor);const ra=(oe=>{var Be;const ye={};return oe.forEach(Ie=>{const Y=["data","data_recebimento","data_pagamento","Data de Pagamento","Data do Pagamento"];for(const je of Y)if(Ie[je]){let Me=Ie[je];if(Me.match(/^\d{2}\/\d{2}\/\d{4}$/)){const[T,X,fe]=Me.split("/");Me=`${fe}-${X}-${T}`}ye[Me]=(ye[Me]||0)+1;break}}),((Be=Object.entries(ye).sort((Ie,Y)=>Y[1]-Ie[1])[0])==null?void 0:Be[0])||null})(be);console.log("üìÖ Data de refer√™ncia detectada:",ra);const pa=[{nome:o.recebimentos.name,tamanho:o.recebimentos.size,tipo:"recebimentos_detalhados"},{nome:o.recibo.name,tamanho:o.recibo.size,tipo:"recibo_lote"},{nome:o.ofx.name,tamanho:o.ofx.size,tipo:"extrato_ofx"}],la=await F.post("/conciliacao/aba2/validar-recebimentos",{recebimentos_detalhados:be,recibo_lote:Ee,ofx_creditos:he,data_referencia:ra,arquivos_info:pa,operadora:w==null?void 0:w.nome});if(!K){const oe=w.nome,ye=la.data.operadora_detectada,Ce=la.data.confianca_deteccao||0;if(console.log("üîç Compara√ß√£o de operadoras:",{selecionada:oe,detectada:ye,confianca:Ce,ignorar:K}),ye&&oe!==ye&&Ce>=.7){_(ye),$(Ce),f(la.data),C(!0),v(!1);return}}f(la.data),console.log("üìä Resultado da valida√ß√£o:",{success:la.data.success,tem_divergencias:la.data.tem_divergencias,validado:la.data.validado,historico_id:la.data.historico_id,operadora_detectada:la.data.operadora_detectada,ja_conciliado:la.data.ja_conciliado}),la.data.ja_conciliado&&la.data.aviso_reprocessamento&&console.warn("‚ö†Ô∏è Reprocessamento detectado:",la.data.aviso_reprocessamento),la.data.success&&(la.data.tem_divergencias?console.log("‚ö†Ô∏è Tem diverg√™ncias, aguardando decis√£o do usu√°rio..."):(console.log("‚úÖ Valida√ß√£o perfeita, avan√ßando automaticamente em 1.5s..."),setTimeout(()=>{M()},1500)))}catch(se){console.error("Erro ao validar:",se),console.error("Detalhes do erro:",(ie=se.response)==null?void 0:ie.data);const _e=((Q=(ee=se.response)==null?void 0:ee.data)==null?void 0:Q.detail)||((me=(de=se.response)==null?void 0:de.data)==null?void 0:me.message)||JSON.stringify((Pe=se.response)==null?void 0:Pe.data)||"Erro ao validar recebimentos";c(_e)}finally{v(!1)}},A=o.recebimentos&&o.recibo&&o.ofx,G=fa();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Aba 2: Concilia√ß√£o de Recebimentos"}),e.jsx("p",{className:"text-gray-600",children:"Valide que dinheiro entrou na conta (3 arquivos: detalhados, recibo, OFX)"})]}),e.jsxs("button",{onClick:()=>G("/financeiro/historico-conciliacoes"),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-lg hover:from-purple-600 hover:to-indigo-700 transition-all shadow-md hover:shadow-lg",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-semibold",children:"üìú Ver Hist√≥rico"})]})]}),t?e.jsx("button",{onClick:()=>d(!1),className:"text-xs text-blue-700 hover:text-blue-900",children:"Mostrar aviso de sequencia"}):e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Ordem recomendada:"})," Aba 1 prepara os NSUs; esta Aba 2 valida os recebimentos; a Aba 3 baixa as parcelas com seguranca."]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>J(30),className:"text-xs text-blue-700 hover:text-blue-900",children:"Ocultar 30 dias"}),e.jsx("button",{onClick:()=>J(365),className:"text-xs text-blue-700 hover:text-blue-900",children:"Ocultar 1 ano"})]})]})}),e.jsx("div",{className:"bg-purple-50 border-l-4 border-purple-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-purple-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("p",{className:"text-sm text-purple-700 mb-2",children:[e.jsx("strong",{children:"Esta aba N√ÉO conhece vendas."})," Apenas valida que o dinheiro entrou na conta. Valida√ß√£o em cascata: Recebimentos ‚Üí Recibo ‚Üí OFX (todos precisam bater)."]}),e.jsxs("details",{className:"text-xs text-purple-600 mt-2",children:[e.jsx("summary",{className:"cursor-pointer font-semibold hover:text-purple-800",children:"üìã Formato esperado dos arquivos"}),e.jsxs("div",{className:"mt-2 space-y-2 pl-4",children:[e.jsx("p",{children:e.jsx("strong",{children:"Recebimentos Detalhados CSV da Stone:"})}),e.jsx("p",{className:"text-xs font-mono",children:"DOCUMENTO;STONECODE;CATEGORIA;DATA DA VENDA;DATA DE VENCIMENTO;DATA DE VENCIMENTO ORIGINAL;BANDEIRA;PRODUTO;STONE ID;QTD DE PARCELAS;N¬∫ DA PARCELA;VALOR BRUTO;VALOR L√çQUIDO;DESCONTO DE MDR;DESCONTO DE ANTECIPA√á√ÉO;DESCONTO UNIFICADO;√öLTIMO STATUS;DATA DO √öLTIMO STATUS"}),e.jsx("p",{className:"text-xs text-purple-500",children:"Separador: ponto-e-v√≠rgula (;) | Valores com v√≠rgula decimal (21,012265)"}),e.jsx("p",{className:"mt-2",children:e.jsx("strong",{children:"Comprovante de Pagamentos CSV da Stone:"})}),e.jsx("p",{className:"text-xs font-mono",children:"Valor;Bandeira;Modalidade;...;Identificador Rastre√°vel do Pagamento;...;Status do Pagamento (19 colunas)"}),e.jsx("p",{className:"text-xs text-purple-500",children:"Separador: ponto-e-v√≠rgula (;) | Valores com v√≠rgula decimal (202,11)"}),e.jsx("p",{className:"mt-2",children:e.jsx("strong",{children:"OFX:"})}),e.jsx("p",{className:"text-xs",children:"Arquivo banc√°rio padr√£o OFX com tags <STMTTRN>, <TRNAMT>, <TRNTYPE>"})]})]})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-2 border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-8 w-8 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-semibold text-blue-900 mb-2",children:"üèõ Operadora de Cart√£o:"}),e.jsxs("select",{value:(w==null?void 0:w.id)||"",onChange:B=>{const N=m.find(O=>O.id===parseInt(B.target.value));x(N),f(null),c(null),re(!1),_(null)},disabled:b||r,className:"w-full border-2 border-blue-300 rounded-lg px-4 py-3 text-base font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Selecione a operadora..."}),m.map(B=>e.jsxs("option",{value:B.id,children:[B.nome," ",B.padrao?"üéØ (Padr√£o)":""]},B.id))]}),w&&e.jsxs("p",{className:"mt-2 text-xs text-blue-700",children:["‚úÖ Operadora selecionada: ",e.jsx("strong",{children:w.nome})]}),!w&&e.jsx("p",{className:"mt-2 text-xs text-orange-600 font-medium",children:"‚ö†Ô∏è Selecione a operadora antes de fazer upload dos arquivos"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-blue-400 flex items-center justify-center",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-full w-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{htmlFor:"file-recebimentos",className:"cursor-pointer",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-900 mb-1",children:"1Ô∏è‚É£ Recebimentos Detalhados"}),e.jsx("span",{className:"block text-xs text-gray-500 mb-3",children:"Arquivo CSV da Stone (18 colunas)"}),e.jsx("input",{id:"file-recebimentos",type:"file",accept:".csv",onChange:B=>te("recebimentos",B),className:"sr-only"}),e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"Selecionar CSV"})]}),o.recebimentos&&e.jsxs("p",{className:"mt-2 text-xs text-green-600 font-medium truncate",children:["‚úì ",o.recebimentos.name]})]})]})}),e.jsx("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-green-400 flex items-center justify-center",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-full w-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{htmlFor:"file-recibo",className:"cursor-pointer",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-900 mb-1",children:"2Ô∏è‚É£ Recibo de Lote"}),e.jsx("span",{className:"block text-xs text-gray-500 mb-3",children:'CSV "Comprovante de Pagamentos" (19 colunas)'}),e.jsx("input",{id:"file-recibo",type:"file",accept:".csv",onChange:B=>te("recibo",B),className:"sr-only"}),e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"Selecionar CSV"})]}),o.recibo&&e.jsxs("p",{className:"mt-2 text-xs text-green-600 font-medium truncate",children:["‚úì ",o.recibo.name]})]})]})}),e.jsx("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-purple-400 flex items-center justify-center",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-full w-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{htmlFor:"file-ofx",className:"cursor-pointer",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-900 mb-1",children:"3Ô∏è‚É£ Extrato OFX"}),e.jsx("span",{className:"block text-xs text-gray-500 mb-3",children:"Extrato banc√°rio"}),e.jsx("input",{id:"file-ofx",type:"file",accept:".ofx,.xml",onChange:B=>te("ofx",B),className:"sr-only"}),e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"Selecionar OFX"})]}),o.ofx&&e.jsxs("p",{className:"mt-2 text-xs text-green-600 font-medium truncate",children:["‚úì ",o.ofx.name]})]})]})})]}),A&&!j&&e.jsx("button",{onClick:L,disabled:r||!w,className:`
            w-full flex justify-center items-center gap-2 py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white
            ${r?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}
          `,children:r?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Validando recebimentos..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),e.jsx("span",{children:"Validar Cascata (3 arquivos)"})]})}),y&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:y})})]}),e.jsx("button",{onClick:R,className:"ml-4 px-3 py-1 bg-red-100 hover:bg-red-200 text-red-700 text-xs font-medium rounded",children:"Limpar e Tentar Novamente"})]})}),j&&j.success&&e.jsxs("div",{className:"space-y-4",children:[j.ja_conciliado&&j.aviso_reprocessamento&&e.jsx("div",{className:"bg-orange-50 border-l-4 border-orange-400 p-4 rounded-lg",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6 text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-orange-800",children:"‚ö†Ô∏è REPROCESSAMENTO DETECTADO"}),e.jsxs("div",{className:"mt-2 text-sm text-orange-700",children:[e.jsx("p",{children:j.aviso_reprocessamento.mensagem}),j.aviso_reprocessamento.usuario_anterior&&e.jsxs("p",{className:"mt-1",children:[e.jsx("span",{className:"font-medium",children:"Processado anteriormente por:"})," ",j.aviso_reprocessamento.usuario_anterior]})]}),e.jsx("div",{className:"mt-3",children:e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:["Data: ",j.data_referencia," | Operadora: ",j.operadora_detectada]})})]})]})}),(j.operadora_detectada||j.data_referencia)&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Informa√ß√µes da Concilia√ß√£o"}),e.jsxs("div",{className:"mt-2 text-sm text-blue-700 space-y-1",children:[j.operadora_detectada&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Operadora:"})," ",j.operadora_detectada,j.confianca_deteccao&&e.jsxs("span",{className:"ml-2 text-xs",children:["(Confian√ßa: ",(j.confianca_deteccao*100).toFixed(0),"%)"]})]}),j.data_referencia&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Data de Refer√™ncia:"})," ",new Date(j.data_referencia+"T00:00:00").toLocaleDateString("pt-BR")]}),j.historico_id&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"ID do Hist√≥rico:"})," #",j.historico_id]})]})]})]})}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"h-6 w-6 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Resumo da Valida√ß√£o em Cascata"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"1Ô∏è‚É£ Recebimentos Detalhados"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:["R$ ",(E=j.valor_total_recebimentos)==null?void 0:E.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[j.recebimentos_salvos," transa√ß√µes"]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:"2Ô∏è‚É£ Comprovante (Lotes)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-900",children:["R$ ",(P=j.valor_total_lotes)==null?void 0:P.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[j.lotes_count," lotes"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-purple-600 font-medium mb-1",children:"3Ô∏è‚É£ Extrato Banc√°rio (OFX)"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900",children:["R$ ",(H=j.valor_total_ofx)==null?void 0:H.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:[j.ofx_count," cr√©ditos"]})]})]})]}),!j.tem_divergencias&&e.jsx("div",{className:"bg-green-50 border-l-4 border-green-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:"‚úÖ Valida√ß√£o Perfeita! Nenhuma diverg√™ncia encontrada."}),e.jsxs("p",{className:"mt-1 text-sm text-green-700",children:["Todas as 3 somas est√£o id√™nticas. As ",j.recebimentos_salvos," vendas foram confirmadas na conta."]})]})]})}),j.tem_divergencias&&j.divergencias&&j.divergencias.length>0&&e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"‚ö†Ô∏è Diverg√™ncias Detectadas"}),e.jsx("p",{className:"mt-1 text-sm text-yellow-700",children:"Foram encontradas diferen√ßas entre os arquivos. Analise abaixo e decida se aceita ou n√£o."}),e.jsx("div",{className:"mt-4 space-y-3",children:j.divergencias.map((B,N)=>{var ie,ee,Q;const O=B.nivel==="arredondamento",z=O?"bg-blue-50 border-blue-200":"bg-orange-50 border-orange-200",ae=O?"text-blue-900":"text-orange-900",W=O?"bg-blue-100 text-blue-800":"bg-orange-100 text-orange-800";return e.jsxs("div",{className:`border rounded-lg p-4 ${z}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-semibold px-2 py-1 rounded ${W}`,children:O?"üîµ Arredondamento":"üü† Aten√ß√£o"}),e.jsx("p",{className:`text-sm font-medium ${ae}`,children:B.tipo==="recebimentos_vs_lotes"?"Recebimentos √ó Lotes":"Lotes √ó OFX"})]}),e.jsxs("div",{className:`text-right ${ae}`,children:[e.jsxs("p",{className:"text-lg font-bold",children:["R$ ",Math.abs(B.diferenca).toFixed(2)]}),e.jsxs("p",{className:"text-xs",children:[(ie=B.percentual)==null?void 0:ie.toFixed(3),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:B.tipo==="recebimentos_vs_lotes"?"Recebimentos:":"Lotes:"}),e.jsxs("p",{className:`font-semibold ${ae}`,children:["R$ ",(ee=B.tipo==="recebimentos_vs_lotes"?B.soma_recebimentos:B.soma_lotes)==null?void 0:ee.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:B.tipo==="recebimentos_vs_lotes"?"Lotes:":"OFX:"}),e.jsxs("p",{className:`font-semibold ${ae}`,children:["R$ ",(Q=B.tipo==="recebimentos_vs_lotes"?B.soma_lotes:B.soma_ofx)==null?void 0:Q.toFixed(2)]})]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-2 italic",children:B.mensagem})]},N)})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsx("div",{className:"text-sm text-gray-600",children:j.tem_divergencias?e.jsx("p",{children:"‚ö†Ô∏è Analise as diverg√™ncias e decida se aceita a valida√ß√£o"}):e.jsx("p",{children:"‚úÖ Valida√ß√£o perfeita! Pode avan√ßar para a Aba 3."})}),e.jsxs("div",{className:"flex gap-3",children:[j.tem_divergencias&&e.jsx("button",{onClick:R,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 font-medium",children:"‚úï Cancelar e Recome√ßar"}),e.jsx("button",{onClick:()=>{console.log("üñ±Ô∏è Bot√£o Aceitar e Avan√ßar clicado"),M()},className:`px-6 py-2 rounded-md font-medium transition-colors ${j.tem_divergencias?"bg-yellow-600 hover:bg-yellow-700 text-white":"bg-green-600 hover:bg-green-700 text-white"}`,children:j.tem_divergencias?"‚úì Aceitar e Avan√ßar ‚Üí":"Avan√ßar para Aba 3 ‚Üí"})]})]})]}),i&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>p(!1)}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Confirmar Operadora"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Voc√™ est√° prestes a validar recebimentos para a operadora:"}),e.jsx("div",{className:"mt-3 p-3 bg-blue-50 rounded border border-blue-200",children:e.jsxs("p",{className:"text-lg font-bold text-blue-900",children:["üè¶ ",w==null?void 0:w.nome]})}),e.jsxs("p",{className:"text-sm text-gray-500 mt-3",children:["‚ö†Ô∏è ",e.jsx("strong",{children:"Todos os lan√ßamentos ser√£o vinculados a esta operadora."})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"O sistema detectar√° automaticamente se os arquivos correspondem a esta operadora e alertar√° se houver diverg√™ncia."})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"button",onClick:Z,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm",children:"‚úì Confirmar e Validar"}),e.jsx("button",{type:"button",onClick:()=>p(!1),className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Cancelar"})]})]})]})}),l&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-orange-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{className:"h-6 w-6 text-orange-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left flex-1",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-orange-900",children:"‚ö†Ô∏è Diverg√™ncia de Operadora Detectada"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-4",children:e.jsx("strong",{children:"Os arquivos enviados parecem ser de uma operadora diferente da selecionada."})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-red-50 border-2 border-red-300 rounded-lg",children:[e.jsx("p",{className:"text-xs text-red-600 font-medium mb-1",children:"Operadora Selecionada:"}),e.jsx("p",{className:"text-lg font-bold text-red-900",children:w==null?void 0:w.nome})]}),e.jsxs("div",{className:"p-3 bg-green-50 border-2 border-green-300 rounded-lg",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:"Operadora Detectada nos Arquivos:"}),e.jsx("p",{className:"text-lg font-bold text-green-900",children:h}),e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["Confian√ßa da detec√ß√£o: ",(S*100).toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded",children:[e.jsx("p",{className:"text-sm text-yellow-800",children:e.jsx("strong",{children:"O que voc√™ deseja fazer?"})}),e.jsxs("ul",{className:"text-xs text-yellow-700 mt-2 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsxs("strong",{children:["Mudar para ",h,":"]})," Recomendado se os arquivos est√£o corretos"]}),e.jsxs("li",{children:[e.jsxs("strong",{children:["Manter ",w==null?void 0:w.nome,":"]})," Use se voc√™ tem certeza da operadora"]})]})]})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{const B=m.find(N=>N.nome===h);B&&x(B),C(!1),setTimeout(()=>{Z()},100)},className:"inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none sm:text-sm",children:["‚úì Mudar para ",h]}),e.jsxs("button",{type:"button",onClick:()=>{re(!0),C(!1),setTimeout(()=>{Z()},100)},className:"inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:text-sm",children:["Manter ",w==null?void 0:w.nome]}),e.jsx("button",{type:"button",onClick:()=>{C(!1),v(!1),R()},className:"inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:text-sm",children:"‚úï Cancelar Tudo"})]})]})]})})]})}function Zi({onConcluida:s,status:n}){var $,K,re,M;const t=fa(),[d,o]=a.useState(!1),[g,r]=a.useState(""),[v,j]=a.useState(null),[f,y]=a.useState(!1),[c,m]=a.useState(null),[k,w]=a.useState(null),[x,b]=a.useState([]),[u,i]=a.useState(null),[p,l]=a.useState(!0);a.useEffect(()=>{(async()=>{try{const J=await F.get("/operadoras-cartao?apenas_ativas=true");b(J.data);const te=J.data.find(L=>L.padrao);te&&i(te)}catch(J){console.error("Erro ao carregar operadoras:",J),w("Erro ao carregar operadoras")}finally{l(!1)}})()},[]),a.useEffect(()=>{const R=localStorage.getItem("conciliacao_aba3_aviso_ate");if(!R)return;const J=Number(R);Number.isFinite(J)&&Date.now()<J&&o(!0)},[]);const C=R=>{const J=Date.now()+R*24*60*60*1e3;localStorage.setItem("conciliacao_aba3_aviso_ate",String(J)),o(!0)};a.useEffect(()=>{g&&u?h():j(null)},[g,u]);const h=async()=>{try{const R=await F.get("/conciliacao/aba3/preview-amarracao",{params:{data_recebimento:g,operadora:u==null?void 0:u.nome}});j(R.data)}catch(R){console.error("Erro ao buscar preview:",R),j(null)}},_=async()=>{var R,J;if(!u||!g){w("Selecione a operadora e a data primeiro");return}y(!0),w(null);try{const te=await F.post("/conciliacao/aba3/amarrar-automatico",{data_recebimento:g,operadora:u==null?void 0:u.nome});m(te.data)}catch(te){console.error("Erro ao processar:",te),w(((J=(R=te.response)==null?void 0:R.data)==null?void 0:J.detail)||"Erro ao processar amarra√ß√£o")}finally{y(!1)}},S=()=>{var R,J;if(c){const te=`‚úÖ Concilia√ß√£o finalizada com sucesso!

üìä Resumo:
‚Ä¢ ${c.parcelas_liquidadas} parcelas baixadas
‚Ä¢ Valor total: R$ ${(R=c.valor_total_liquidado)==null?void 0:R.toFixed(2)}
‚Ä¢ Taxa de amarra√ß√£o: ${(J=c.taxa_amarracao_automatica)==null?void 0:J.toFixed(1)}%`;alert(te)}s&&s(),t("/financeiro/historico-conciliacoes")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Aba 3: Amarra√ß√£o Autom√°tica"}),e.jsx("p",{className:"text-gray-600",children:"Amarra√ß√£o 98% autom√°tica: recebimentos ‚Üí vendas ‚Üí baixa de parcelas"})]}),d?e.jsx("button",{onClick:()=>o(!1),className:"text-xs text-blue-700 hover:text-blue-900",children:"Mostrar aviso de sequencia"}):e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Ordem recomendada:"})," Execute a Aba 1 e Aba 2 antes para garantir que a amarracao encontre todos os recebimentos."]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>C(30),className:"text-xs text-blue-700 hover:text-blue-900",children:"Ocultar 30 dias"}),e.jsx("button",{onClick:()=>C(365),className:"text-xs text-blue-700 hover:text-blue-900",children:"Ocultar 1 ano"})]})]})}),e.jsx("div",{className:"bg-green-50 border-l-4 border-green-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"98% autom√°tico!"})," Se as Abas 1 e 2 foram bem feitas, esta etapa √© quase instant√¢nea. Sistema vincula recebimentos √†s vendas pelo NSU e baixa as parcelas automaticamente."]})})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Operadora:"}),e.jsxs("select",{value:(u==null?void 0:u.id)||"",onChange:R=>{const J=x.find(te=>String(te.id)===R.target.value);i(J||null)},disabled:p,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Selecione a operadora"}),x.map(R=>e.jsx("option",{value:R.id,children:R.nome},R.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data dos recebimentos:"}),e.jsx("input",{type:"date",value:g,onChange:R=>r(R.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Selecione a operadora e a data dos recebimentos validados na Aba 2"})]}),v&&v.recebimentos_validados>0&&e.jsx("div",{className:"bg-blue-50 border-2 border-blue-300 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:"üìä Preview da Amarra√ß√£o"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white rounded",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Recebimentos validados:"}),e.jsx("span",{className:"text-lg font-bold text-gray-900",children:v.recebimentos_validados})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-100 rounded border-2 border-blue-400",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-900",children:"‚úÖ Parcelas que ser√£o baixadas:"}),e.jsx("span",{className:"text-xl font-bold text-blue-900",children:v.parcelas_a_baixar})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-100 rounded border-2 border-green-400",children:[e.jsx("span",{className:"text-sm font-semibold text-green-900",children:"üí∞ Valor total a liquidar:"}),e.jsxs("span",{className:"text-xl font-bold text-green-900",children:["R$ ",($=v.valor_total)==null?void 0:$.toFixed(2)]})]})]})]})]})}),v&&v.recebimentos_validados===0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"‚ö†Ô∏è Nenhum recebimento validado encontrado para esta data. Verifique se a Aba 2 foi processada corretamente."})}),v&&v.parcelas_a_baixar>0&&!c&&e.jsx("button",{onClick:_,disabled:f,className:`
            w-full flex justify-center items-center gap-3 py-4 px-6 border-2 border-transparent rounded-lg shadow-lg text-base font-bold
            ${f?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white"}
          `,children:f?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-6 w-6 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Processando amarra√ß√£o..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsxs("span",{children:["‚úÖ Processar ‚Üí baixar ",v.parcelas_a_baixar," parcelas"]})]})}),k&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:k})})]})}),c&&c.success&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:`border-l-4 p-6 rounded-lg ${c.alerta_saude==="OK"?"bg-green-50 border-green-400":"bg-red-50 border-red-400"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:c.alerta_saude==="OK"?e.jsx("svg",{className:"h-8 w-8 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):e.jsx("svg",{className:"h-8 w-8 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:`text-xl font-bold mb-2 ${c.alerta_saude==="OK"?"text-green-900":"text-red-900"}`,children:c.alerta_saude==="OK"?"‚úÖ Amarra√ß√£o Conclu√≠da com Sucesso!":"‚ö†Ô∏è Amarra√ß√£o Conclu√≠da com Alertas"}),e.jsxs("p",{className:"text-sm text-gray-700 font-medium mb-4 bg-green-100 border border-green-300 rounded px-3 py-2",children:["üí∞ ",c.parcelas_liquidadas," conta(s) a receber foi(ram) baixada(s) com sucesso! Valor total: R$ ",(K=c.valor_total_liquidado)==null?void 0:K.toFixed(2)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white rounded p-4 shadow",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Amarrados"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:c.amarrados})]}),e.jsxs("div",{className:"bg-white rounded p-4 shadow",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"√ìrf√£os"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:c.orfaos})]}),e.jsxs("div",{className:"bg-white rounded p-4 shadow",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Parcelas Liquidadas"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c.parcelas_liquidadas})]}),e.jsxs("div",{className:"bg-white rounded p-4 shadow",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Valor Liquidado"}),e.jsxs("p",{className:"text-xl font-bold text-purple-600",children:["R$ ",(re=c.valor_total_liquidado)==null?void 0:re.toFixed(2)]})]})]}),e.jsxs("div",{className:`p-4 rounded-lg border-2 ${c.alerta_saude==="OK"?"bg-green-100 border-green-400":"bg-red-100 border-red-400"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"üìä Sa√∫de do Sistema"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Taxa de amarra√ß√£o autom√°tica"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-4xl font-bold ${c.alerta_saude==="OK"?"text-green-700":"text-red-700"}`,children:[(M=c.taxa_amarracao_automatica)==null?void 0:M.toFixed(1),"%"]}),e.jsx("p",{className:`text-sm font-medium mt-1 ${c.alerta_saude==="OK"?"text-green-700":"text-red-700"}`,children:c.alerta_saude==="OK"?"‚úÖ SAUD√ÅVEL":"üö® CR√çTICO"})]})]}),c.alerta_saude!=="OK"&&e.jsx("p",{className:"mt-3 text-xs text-red-700 font-medium",children:"‚ö†Ô∏è Taxa abaixo de 90% indica problema na opera√ß√£o. Revise a Aba 1 (confer√™ncia de vendas)."})]})]})]})}),c.orfaos>0&&c.lista_orfaos&&e.jsxs("div",{className:"bg-white border-2 border-red-300 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-red-50 border-b border-red-200",children:[e.jsxs("h4",{className:"text-lg font-semibold text-red-900",children:["‚ö†Ô∏è Recebimentos √ìrf√£os (",c.orfaos,")"]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Estes recebimentos n√£o t√™m venda correspondente. Precisa resolver na Aba 1."})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-3",children:c.lista_orfaos.map((R,J)=>{var te;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-red-900",children:["NSU: ",R.nsu]}),e.jsxs("p",{className:"text-xs text-red-700",children:["Data: ",R.data," ‚Ä¢ Valor: R$ ",(te=R.valor)==null?void 0:te.toFixed(2)]})]}),e.jsx("button",{className:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded hover:bg-red-700",children:"Resolver na Aba 1"})]},J)})})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsx("div",{className:"text-sm text-gray-600",children:e.jsx("p",{children:"üéâ Concilia√ß√£o completa! Todas as 3 abas foram processadas."})}),e.jsxs("button",{onClick:S,className:"px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 font-semibold flex items-center gap-2 shadow-lg",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{children:"Concluir e Ver Hist√≥rico"})]})]})]})]})}function ed(){const[s,n]=a.useState(1),[t,d]=a.useState(!1),[o,g]=a.useState(null),[r,v]=a.useState(!1),[j,f]=a.useState("pendente"),[y,c]=a.useState("pendente"),[m,k]=a.useState("pendente");a.useEffect(()=>{const C=localStorage.getItem("conciliacao_tabs_skip_aviso");v(C==="true")},[]),a.useEffect(()=>{console.log("üîÑ abaAtiva MUDOU PARA:",s)},[s]);const w=()=>{console.log("‚úÖ Aba 1 conclu√≠da, marcando como processado"),f("processado")},x=()=>{console.log("‚úÖ Aba 2 conclu√≠da, marcando como processado e avan√ßando para Aba 3"),c("processado"),console.log("üöÄ Mudando para Aba 3 imediatamente..."),console.log("üîç abaAtiva ANTES de setAbaAtiva:",s),n(C=>(console.log("üîç abaAtiva ANTERIOR (dentro do setState):",C),console.log("üîç Retornando novo valor:",3),3)),console.log("‚úÖ setAbaAtiva(3) executado")},b=()=>{console.log("‚úÖ Aba 3 conclu√≠da, marcando como processado"),k("processado")},u=C=>{if(r||C===1){n(C);return}g(C),d(!0)},i=()=>{o&&n(o),d(!1)},p=()=>{localStorage.setItem("conciliacao_tabs_skip_aviso","true"),v(!0),o&&n(o),d(!1)},l=C=>{switch(C){case"processado":return e.jsx("span",{className:"text-green-600 text-xl",children:"‚úÖ"});case"pendente":return e.jsx("span",{className:"text-yellow-600 text-xl",children:"‚è≥"});case"bloqueado":return e.jsx("span",{className:"text-gray-400 text-xl",children:"üîí"});case"erro":return e.jsx("span",{className:"text-red-600 text-xl",children:"‚ùå"});default:return null}};return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Concilia√ß√£o de Cart√µes - 3 Etapas"}),e.jsx("p",{className:"text-gray-600",children:"Processo completo: Vendas ‚Üí Recebimentos ‚Üí Amarra√ß√£o (baixa autom√°tica)"})]}),e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-yellow-700 font-medium",children:["Ordem recomendada: ",e.jsx("strong",{children:"Aba 1"})," ‚Üí ",e.jsx("strong",{children:"Aba 2"})," ‚Üí ",e.jsx("strong",{children:"Aba 3"}),". As abas ficam abertas, mas a sequencia evita divergencias."]})})]})}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsxs("nav",{className:"flex -mb-px space-x-8",children:[e.jsxs("button",{onClick:()=>u(1),disabled:!1,className:`
              flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${s===1?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx("span",{className:"text-lg",children:"1Ô∏è‚É£"}),e.jsx("span",{children:"Concilia√ß√£o de Vendas"}),l(j),j==="pendente"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Obrigat√≥ria"})]}),e.jsxs("button",{onClick:()=>u(2),disabled:!1,className:`
              flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${s===2?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx("span",{className:"text-lg",children:"2Ô∏è‚É£"}),e.jsx("span",{children:"Concilia√ß√£o de Recebimentos"}),l(y),y==="pendente"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Recomendada apos Aba 1"})]}),e.jsxs("button",{onClick:()=>u(3),disabled:!1,className:`
              flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${s===3?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx("span",{className:"text-lg",children:"3Ô∏è‚É£"}),e.jsx("span",{children:"Amarra√ß√£o Autom√°tica"}),l(m),m==="pendente"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Recomendada apos Aba 2"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[s===1&&e.jsx(Ji,{onConcluida:w,status:j}),s===2&&e.jsx(Yi,{onConcluida:x,status:y}),s===3&&e.jsx(Zi,{onConcluida:b,status:m})]}),t&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Ordem recomendada das etapas"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["A sequencia ",e.jsx("strong",{children:"Aba 1 ‚Üí Aba 2 ‚Üí Aba 3"})," reduz divergencias e garante que a amarracao automatica encontre todos os recebimentos."]}),e.jsxs("div",{className:"bg-gray-50 rounded-md p-3 text-sm text-gray-700 mb-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Aba 1:"})," prepara vendas e NSUs."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Aba 2:"})," valida que o dinheiro entrou."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Aba 3:"})," baixa parcelas automaticamente."]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>d(!1),className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-800",children:"Cancelar"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:p,className:"px-3 py-2 text-sm text-blue-700 hover:text-blue-900",children:"Nao mostrar novamente"}),e.jsx("button",{onClick:i,className:"px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded hover:bg-blue-700",children:"Continuar"})]})]})]})}),e.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-2",children:"‚ÑπÔ∏è Como funciona:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Aba 1:"})," Confere NSU, bandeira, parcelas, taxa (prepara dados)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Aba 2:"})," Valida que dinheiro entrou na conta (3 arquivos: detalhados, recibo, OFX)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Aba 3:"})," Vincula recebimentos √†s vendas e baixa parcelas automaticamente (98%!)"]})]})]})]})}function ad(){const s=fa(),[n,t]=a.useState([]),[d,o]=a.useState(!1),[g,r]=a.useState({operadora:"",status:"",data_inicio:"",data_fim:""});a.useEffect(()=>{v()},[]);const v=async()=>{o(!0);try{const c=new URLSearchParams;g.operadora&&c.append("operadora",g.operadora),g.status&&c.append("status",g.status),g.data_inicio&&c.append("data_inicio",g.data_inicio),g.data_fim&&c.append("data_fim",g.data_fim);const m=await F.get(`/conciliacao/historico?${c.toString()}`);m.data&&m.data.items&&t(m.data.items)}catch(c){console.error("Erro ao carregar hist√≥rico:",c)}finally{o(!1)}},j=c=>{if(!c)return"-";const[m,k,w]=c.split("T")[0].split("-");return`${w}/${k}/${m}`},f=(c,m)=>{var x,b;if((b=(x=m==null?void 0:m.abas)==null?void 0:x.aba2)!=null&&b.concluida&&c==="em_andamento")return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:"‚úì Aba 2 Conclu√≠da"});const w={concluida:{cor:"bg-green-100 text-green-800",texto:"‚úì Conclu√≠da"},em_andamento:{cor:"bg-yellow-100 text-yellow-800",texto:"‚è≥ Em Andamento"},reprocessada:{cor:"bg-blue-100 text-blue-800",texto:"‚Üª Reprocessada"},cancelada:{cor:"bg-gray-100 text-gray-800",texto:"‚úï Cancelada"}}[c]||{cor:"bg-gray-100 text-gray-800",texto:c};return e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${w.cor}`,children:w.texto})},y=c=>c?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c):"-";return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"üìã Hist√≥rico de Concilia√ß√µes"}),e.jsx("p",{className:"text-gray-600",children:"Consulte todas as concilia√ß√µes j√° realizadas"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>s("/financeiro/conciliacao-3abas"),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium transition-colors flex items-center gap-2",title:"Voltar para Concilia√ß√£o",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),e.jsx("span",{children:"Voltar para Concilia√ß√£o"})]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Filtros"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Operadora"}),e.jsxs("select",{value:g.operadora,onChange:c=>r({...g,operadora:c.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"Stone",children:"Stone"}),e.jsx("option",{value:"PagSeguro",children:"PagSeguro"}),e.jsx("option",{value:"Rede",children:"Rede"}),e.jsx("option",{value:"Cielo",children:"Cielo"}),e.jsx("option",{value:"Getnet",children:"Getnet"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:g.status,onChange:c=>r({...g,status:c.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"concluida",children:"Conclu√≠da"}),e.jsx("option",{value:"em_andamento",children:"Em Andamento"}),e.jsx("option",{value:"reprocessada",children:"Reprocessada"}),e.jsx("option",{value:"cancelada",children:"Cancelada"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data In√≠cio"}),e.jsx("input",{type:"date",value:g.data_inicio,onChange:c=>r({...g,data_inicio:c.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:g.data_fim,onChange:c=>r({...g,data_fim:c.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:v,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium",children:"üîç Filtrar"}),e.jsx("button",{onClick:()=>{r({operadora:"",status:"",data_inicio:"",data_fim:""}),v()},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 font-medium",children:"‚úï Limpar Filtros"})]})]}),d&&e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),!d&&n.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",style:{display:"grid",gridTemplateColumns:"minmax(48px, 0.6fr) minmax(90px, 1fr) minmax(100px, 1.1fr) minmax(140px, 1.6fr) minmax(120px, 1.4fr) minmax(130px, 1.5fr) minmax(180px, 2.4fr)",columnGap:"8px",background:"#f9fafb",borderBottom:"2px solid #e5e7eb"},children:[e.jsx("span",{style:{padding:"8px 10px"},children:"ID"}),e.jsx("span",{style:{padding:"8px 10px"},children:"Data"}),e.jsx("span",{style:{padding:"8px 10px"},children:"Operadora"}),e.jsx("span",{style:{padding:"8px 10px"},children:"Status"}),e.jsx("span",{style:{padding:"8px 10px",textAlign:"right"},children:"Valor"}),e.jsx("span",{style:{padding:"8px 10px"},children:"Processado"}),e.jsx("span",{style:{padding:"8px 10px"},children:"Usu√°rio"})]}),n.map((c,m)=>{var k,w,x,b,u;return e.jsxs("div",{className:"hover:bg-blue-50 transition-colors",style:{display:"grid",gridTemplateColumns:"minmax(48px, 0.6fr) minmax(90px, 1fr) minmax(100px, 1.1fr) minmax(140px, 1.6fr) minmax(120px, 1.4fr) minmax(130px, 1.5fr) minmax(180px, 2.4fr)",columnGap:"8px",alignItems:"center",borderBottom:"1px solid #f0f0f0",background:m%2===0?"#fff":"#fafbfc"},children:[e.jsxs("span",{style:{padding:"8px 10px"},className:"text-sm font-mono text-gray-400",children:["#",c.id]}),e.jsx("span",{style:{padding:"8px 10px"},className:"text-sm font-medium text-gray-900",children:j(c.data_referencia)}),e.jsx("span",{style:{padding:"8px 10px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},className:"text-sm text-gray-700",title:c.operadora,children:c.operadora}),e.jsx("span",{style:{padding:"8px 10px"},children:f(c.status,c)}),e.jsxs("span",{style:{padding:"8px 10px",textAlign:"right"},children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:y((w=(k=c.totais)==null?void 0:k.recebimentos)==null?void 0:w.valor_total)}),((b=(x=c.totais)==null?void 0:x.recebimentos)==null?void 0:b.quantidade)&&e.jsxs("div",{className:"text-xs text-gray-400",children:[c.totais.recebimentos.quantidade," trans."]})]}),e.jsxs("span",{style:{padding:"8px 10px"},children:[e.jsx("div",{className:"text-sm text-gray-700",children:j((u=c.created_at)==null?void 0:u.split("T")[0])}),e.jsx("div",{className:"text-xs text-gray-400",children:c.created_at?new Date(c.created_at).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}):"-"})]}),e.jsx("span",{style:{padding:"8px 10px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},className:"text-sm text-gray-700",title:c.usuario_responsavel,children:c.usuario_responsavel||"-"})]},c.id)})]}),!d&&n.length===0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"üìã"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhuma concilia√ß√£o encontrada"}),e.jsx("p",{className:"text-gray-500",children:"N√£o h√° concilia√ß√µes registradas com os filtros selecionados."})]})]})}const oa=qo.create({baseURL:"/api",timeout:15e3});on(oa);oa.interceptors.request.use(s=>{const n=localStorage.getItem("access_token"),t=localStorage.getItem("selectedTenant");if(s.headers=s.headers||{},n&&(s.headers.Authorization=`Bearer ${n}`),t)try{const d=JSON.parse(t);d!=null&&d.id&&(s.headers["X-Tenant-ID"]=d.id)}catch{}return s},s=>Promise.reject(s));oa.interceptors.response.use(s=>s,s=>{var t;if((s==null?void 0:s.code)==="ERR_LOADING_SAFE_DUPLICATE")return Promise.reject(s);const n=(t=s.response)==null?void 0:t.status;return n===401&&(console.warn("Sess√£o inv√°lida ou tenant n√£o selecionado"),localStorage.removeItem("access_token"),localStorage.removeItem("tenants"),window.location.href="/login"),n===403&&console.warn("Acesso negado para este tenant"),Promise.reject(s)});function sd(){var E;const[s,n]=a.useState([]),[t,d]=a.useState(null),[o,g]=a.useState([]),[r,v]=a.useState([]),[j,f]=a.useState(!1),[y,c]=a.useState(!1),[m,k]=a.useState(null),[w,x]=a.useState("todos"),[b,u]=a.useState(!0),[i,p]=a.useState(""),[l,C]=a.useState(""),[h,_]=a.useState(null),[S,$]=a.useState(!1);a.useEffect(()=>{K(),R()},[]),a.useEffect(()=>{r.length>0&&m&&(re(),M())},[m,w,b,i,l]);const K=async()=>{var P;try{const H=await oa.get("/contas-bancarias",{params:{apenas_ativas:!0}});console.log("üìä Contas banc√°rias carregadas:",H.data);const B=H.data.filter(N=>N.instituicao_bancaria);v(B)}catch(H){console.error("‚ùå Erro ao carregar contas banc√°rias:",H),console.error("Detalhes:",(P=H.response)==null?void 0:P.data)}},re=async()=>{try{f(!0);const P={};m&&(P.conta_bancaria_id=m),w!=="todos"&&(P.status=w),P.ocultar_conciliadas=b,i&&(P.data_inicio=i),l&&(P.data_fim=l),P.limit=200;const H=await oa.get("/conciliacao/movimentacoes",{params:P});n(H.data)}catch(P){console.error("Erro ao carregar movimenta√ß√µes:",P)}finally{f(!1)}},M=async()=>{try{const P={};m&&(P.conta_bancaria_id=m);const H=await oa.get("/conciliacao/estatisticas",{params:P});d(H.data)}catch(P){console.error("Erro ao carregar estat√≠sticas:",P)}},R=async()=>{try{const P=await oa.get("/conciliacao/regras");g(P.data)}catch(P){console.error("Erro ao carregar regras:",P)}},J=async P=>{var B,N;const H=P.target.files[0];if(console.log("üì§ Upload OFX iniciado:",{file:H,contaSelecionada:m}),!!H){if(!m){alert("Selecione uma conta banc√°ria primeiro");return}try{c(!0);const O=new FormData;O.append("arquivo",H),console.log("üì§ Enviando arquivo para API...");const z=await oa.post(`/api/conciliacao/upload-ofx?conta_bancaria_id=${m}`,O,{headers:{"Content-Type":"multipart/form-data"}});console.log("‚úÖ Upload conclu√≠do:",z.data),alert(`‚úÖ OFX importado com sucesso!

üìä Total de transa√ß√µes: ${z.data.total_transacoes}
‚è≥ Pendentes: ${z.data.pendentes}
üìÖ Per√≠odo: ${z.data.periodo_inicio||"N/A"} a ${z.data.periodo_fim||"N/A"}`),re(),M()}catch(O){console.error("‚ùå Erro ao fazer upload:",O),alert("‚ùå Erro ao processar OFX: "+(((N=(B=O.response)==null?void 0:B.data)==null?void 0:N.detail)||O.message))}finally{c(!1),P.target.value=""}}},te=async(P,H)=>{try{await oa.post(`/api/conciliacao/movimentacoes/${P.id}/classificar`,H),re(),M(),R(),_(null)}catch(B){console.error("Erro ao classificar:",B),alert("‚ùå Erro ao classificar movimenta√ß√£o")}},L=(P,H)=>{const B={conciliado:e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-800 flex items-center gap-1",children:[e.jsx(ha,{size:12})," Conciliado"]}),sugerido:e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800 flex items-center gap-1",children:[e.jsx(da,{size:12})," Sugerido (",H,"%)"]}),pendente:e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-red-100 text-red-800 flex items-center gap-1",children:[e.jsx(Os,{size:12})," Pendente"]}),manual:e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800 flex items-center gap-1",children:[e.jsx(rr,{size:12})," Manual"]})};return B[P]||B.pendente},Z=P=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(P),A=P=>P?new Date(P).toLocaleDateString("pt-BR"):"-",G=()=>{k(null)};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Concilia√ß√£o Banc√°ria"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Sistema inteligente de classifica√ß√£o autom√°tica"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>$(!0),className:"px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(rr,{size:18}),"Regras (",o.length,")"]}),e.jsxs("label",{className:`px-4 py-2 rounded-lg flex items-center gap-2 ${y||!m?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 cursor-pointer"} text-white`,children:[y?e.jsxs(e.Fragment,{children:[e.jsx($a,{size:18,className:"animate-spin"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(or,{size:18}),"Upload OFX"]}),e.jsx("input",{type:"file",accept:".ofx,.OFX",onChange:J,className:"hidden",disabled:y||!m})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(ha,{size:20,className:"text-blue-600"}),"Selecione a Conta Banc√°ria"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Escolha a conta para visualizar movimenta√ß√µes e fazer upload de extrato OFX"})]}),m&&e.jsx("button",{onClick:G,className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"Limpar Sele√ß√£o"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:r.map(P=>{const H=m===P.id,B=P.cor||"#3B82F6",N=H?{backgroundColor:B,borderColor:B,color:"#ffffff"}:{backgroundColor:`${B}15`,borderColor:`${B}40`,color:B};return e.jsxs("button",{onClick:()=>k(P.id),style:N,className:`border-2 rounded-lg p-4 transition-all duration-200 transform font-medium ${H?"scale-105 shadow-lg":"hover:scale-102 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[P.icone&&e.jsx("span",{className:"text-xl",children:P.icone}),e.jsx("span",{className:"font-semibold text-sm",children:P.nome})]}),H&&e.jsx(ha,{size:20,className:"flex-shrink-0"})]}),P.banco&&e.jsx("div",{className:`text-xs mt-1 ${H?"opacity-90":"opacity-70"}`,children:P.banco})]},P.id)})}),r.length===0&&e.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(da,{size:20,className:"text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-red-800",children:[e.jsx("span",{className:"font-semibold",children:"Nenhuma institui√ß√£o banc√°ria cadastrada."})," ",'V√° em Financeiro ‚Üí Contas Banc√°rias e marque o checkbox "üè¶ Institui√ß√£o Banc√°ria" nas contas que s√£o bancos reais (n√£o caixa f√≠sico).']})]})}),!m&&r.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(da,{size:18,className:"text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("span",{className:"font-semibold",children:"Nenhuma conta selecionada."})," ","Clique em uma conta acima para visualizar movimenta√ß√µes e fazer upload de extrato OFX."]})]})}),m&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ha,{size:18,className:"text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("span",{className:"font-semibold",children:[(E=r.find(P=>P.id===m))==null?void 0:E.nome," selecionada."]})," ","Visualizando movimenta√ß√µes desta conta. Pronto para upload de extrato OFX."]})]})})]}),t&&m&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.total_movimentacoes})]}),e.jsx(Xa,{className:"text-gray-400",size:24})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Conciliadas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:t.conciliadas})]}),e.jsx(ha,{className:"text-green-400",size:24})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-yellow-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Sugeridas"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:t.sugeridas})]}),e.jsx(da,{className:"text-yellow-400",size:24})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pendentes"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:t.pendentes})]}),e.jsx(Os,{className:"text-red-400",size:24})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Automa√ß√£o"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[t.taxa_automacao,"%"]})]}),e.jsx(Ma,{className:"text-blue-400",size:24})]})})]}),m&&e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(St,{size:18,className:"text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtros:"})]}),e.jsxs("select",{value:w,onChange:P=>x(P.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"todos",children:"Todos os status"}),e.jsx("option",{value:"pendente",children:"Pendente"}),e.jsx("option",{value:"sugerido",children:"Sugerido"}),e.jsx("option",{value:"conciliado",children:"Conciliado"}),e.jsx("option",{value:"manual",children:"Manual"})]}),e.jsx("input",{type:"date",value:i,onChange:P=>p(P.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"Data in√≠cio"}),e.jsx("input",{type:"date",value:l,onChange:P=>C(P.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"Data fim"}),e.jsxs("button",{onClick:()=>u(!b),className:`px-3 py-2 rounded-lg text-sm flex items-center gap-2 ${b?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:[b?e.jsx(ar,{size:16}):e.jsx(wt,{size:16}),b?"Ocultar":"Mostrar"," Conciliadas"]}),e.jsxs("button",{onClick:re,className:"ml-auto px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm flex items-center gap-2",children:[e.jsx($a,{size:16}),"Atualizar"]})]})}),m&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Descri√ß√£o"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Vinculado"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:j?e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500",children:[e.jsx($a,{className:"animate-spin mx-auto mb-2",size:24}),"Carregando..."]})}):s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500",children:"Nenhuma movimenta√ß√£o encontrada. Fa√ßa upload de um arquivo OFX."})}):s.map(P=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:A(P.data_movimento)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 max-w-xs truncate",children:P.memo||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded ${P.tipo==="CREDIT"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:P.tipo==="CREDIT"?"Cr√©dito":"D√©bito"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-medium",children:e.jsxs("span",{className:P.tipo==="CREDIT"?"text-green-600":"text-red-600",children:[P.tipo==="CREDIT"?"+":"-"," ",Z(Math.abs(P.valor))]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:L(P.status_conciliacao,P.confianca_sugestao)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 max-w-xs truncate",children:P.fornecedor_nome||P.tipo_vinculo||"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:P.status_conciliacao!=="conciliado"&&e.jsx("button",{onClick:()=>_(P),className:"px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700",children:"Classificar"})})]},P.id))})]})})}),h&&e.jsx(td,{movimentacao:h,onClose:()=>_(null),onClassificar:te}),S&&e.jsx(rd,{regras:o,onClose:()=>$(!1),onAtualizar:R})]})})}function td({movimentacao:s,onClose:n,onClassificar:t}){const[d,o]=a.useState(s.tipo_vinculo||"fornecedor"),[g,r]=a.useState(!0),[v,j]=a.useState(!1),[f,y]=a.useState("mensal"),c=m=>{m.preventDefault(),t(s,{tipo_vinculo:d,criar_regra:g,recorrente:v,periodicidade:v?f:null})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Classificar Movimenta√ß√£o"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Data:"}),e.jsx("span",{className:"text-sm font-medium",children:new Date(s.data_movimento).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Valor:"}),e.jsx("span",{className:"text-sm font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.valor)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Descri√ß√£o:"}),e.jsx("span",{className:"text-sm font-medium truncate ml-4",children:s.memo})]})]}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de V√≠nculo"}),e.jsxs("select",{value:d,onChange:m=>o(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"fornecedor",children:"Pagamento a Fornecedor"}),e.jsx("option",{value:"taxa",children:"Taxa Banc√°ria"}),e.jsx("option",{value:"transferencia",children:"Transfer√™ncia Entre Contas"}),e.jsx("option",{value:"recebimento",children:"Recebimento de Cliente"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"criar_regra",checked:g,onChange:m=>r(m.target.checked),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("label",{htmlFor:"criar_regra",className:"text-sm text-gray-700",children:"Criar regra autom√°tica para movimenta√ß√µes similares"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"recorrente",checked:v,onChange:m=>j(m.target.checked),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("label",{htmlFor:"recorrente",className:"text-sm text-gray-700",children:"Movimenta√ß√£o recorrente (criar provis√µes futuras)"})]}),v&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Periodicidade"}),e.jsxs("select",{value:f,onChange:m=>y(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"mensal",children:"Mensal"}),e.jsx("option",{value:"anual",children:"Anual"}),e.jsx("option",{value:"trimestral",children:"Trimestral"}),e.jsx("option",{value:"semestral",children:"Semestral"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:n,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Classificar"})]})]})]})]})})}function rd({regras:s,onClose:n,onAtualizar:t}){const[d,o]=a.useState(s),g=async r=>{if(confirm("Deseja realmente desativar esta regra?"))try{await oa.delete(`/conciliacao/regras/${r}`),t();const v=d.filter(j=>j.id!==r);o(v)}catch(v){console.error("Erro ao excluir regra:",v)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Regras de Aprendizado"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Sistema aprende com suas classifica√ß√µes"})]}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",children:"‚úï"})]}),e.jsx("div",{className:"p-6",children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(rr,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Nenhuma regra criada ainda."}),e.jsx("p",{className:"text-sm mt-2",children:"Classifique movimenta√ß√µes para criar regras autom√°ticas."})]}):e.jsx("div",{className:"space-y-3",children:d.map(r=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded",children:r.padrao_memo}),r.tipo_operacao&&e.jsx("span",{className:"text-xs text-gray-600",children:r.tipo_operacao})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Confian√ßa:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${r.confianca>=80?"bg-green-500":r.confianca>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.confianca}%`}})}),e.jsxs("span",{className:"font-medium",children:[r.confianca,"%"]})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Aplicada:"}),e.jsxs("p",{className:"font-medium mt-1",children:[r.vezes_aplicada,"x"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Confirmada:"}),e.jsxs("p",{className:"font-medium mt-1",children:[r.vezes_confirmada,"x"]})]})]}),r.fornecedor_nome&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["‚Üí ",r.fornecedor_nome]})]}),e.jsx("button",{onClick:()=>g(r.id),className:"ml-4 px-3 py-1 text-xs text-red-600 hover:bg-red-50 rounded",children:"Desativar"})]})},r.id))})})]})})}const od=()=>{var p,l,C;const[s,n]=a.useState([]),[t,d]=a.useState([]),[o,g]=a.useState([]),[r,v]=a.useState(!0),[j,f]=a.useState(!1),[y,c]=a.useState(null),[m,k]=a.useState({nome:"",tipo:"dinheiro",taxa_percentual:0,taxa_fixa:0,prazo_dias:0,operadora:"",operadora_id:null,gera_contas_receber:!1,split_parcelas:!1,conta_bancaria_destino_id:null,requer_nsu:!1,tipo_cartao:"",bandeira:"",ativo:!0,permite_parcelamento:!1,parcelas_maximas:1,taxas_por_parcela:{},permite_antecipacao:!1,dias_recebimento_antecipado:null,taxa_antecipacao_percentual:null,icone:"üí≥",cor:"#3B82F6"});a.useEffect(()=>{w()},[]);const w=async()=>{try{const[h,_,S]=await Promise.all([F.get("/financeiro/formas-pagamento?apenas_ativas=false"),F.get("/contas-bancarias?apenas_ativas=true"),F.get("/operadoras-cartao?apenas_ativas=true")]);n(h.data),d(_.data),g(S.data)}catch(h){console.error("Erro ao carregar dados:",h),ce.error("Erro ao carregar formas de pagamento")}finally{v(!1)}},x=(h=null)=>{if(h){c(h.id);let _={};if(h.taxas_por_parcela)try{_=typeof h.taxas_por_parcela=="string"?JSON.parse(h.taxas_por_parcela):h.taxas_por_parcela}catch(S){console.error("Erro ao parsear taxas_por_parcela:",S)}k({nome:h.nome,tipo:h.tipo,taxa_percentual:h.taxa_percentual,taxa_fixa:h.taxa_fixa,prazo_dias:h.prazo_dias,operadora:h.operadora||"",operadora_id:h.operadora_id||null,gera_contas_receber:h.gera_contas_receber,split_parcelas:h.split_parcelas,conta_bancaria_destino_id:h.conta_bancaria_destino_id,requer_nsu:h.requer_nsu,tipo_cartao:h.tipo_cartao||"",bandeira:h.bandeira||"",ativo:h.ativo,permite_parcelamento:h.permite_parcelamento,parcelas_maximas:h.parcelas_maximas,taxas_por_parcela:_,permite_antecipacao:h.permite_antecipacao||!1,dias_recebimento_antecipado:h.dias_recebimento_antecipado||null,taxa_antecipacao_percentual:h.taxa_antecipacao_percentual||null,icone:h.icone||"üí≥",cor:h.cor||"#3B82F6"})}else c(null),k({nome:"",tipo:"dinheiro",taxa_percentual:0,taxa_fixa:0,prazo_dias:0,operadora:"",operadora_id:null,gera_contas_receber:!1,split_parcelas:!1,conta_bancaria_destino_id:null,requer_nsu:!1,tipo_cartao:"",bandeira:"",ativo:!0,permite_parcelamento:!1,parcelas_maximas:1,taxas_por_parcela:{},permite_antecipacao:!1,dias_recebimento_antecipado:null,taxa_antecipacao_percentual:null,icone:"üí≥",cor:"#3B82F6"});f(!0)},b=async()=>{try{const h={...m,taxas_por_parcela:Object.keys(m.taxas_por_parcela).length>0?JSON.stringify(m.taxas_por_parcela):null};y?(await F.put(`/financeiro/formas-pagamento/${y}`,h),ce.success("Forma de pagamento atualizada!")):(await F.post("/financeiro/formas-pagamento",h),ce.success("Forma de pagamento criada!")),f(!1),w()}catch(h){console.error("Erro ao salvar:",h),ce.error("Erro ao salvar forma de pagamento")}},u=async h=>{if(confirm("Deseja realmente excluir esta forma de pagamento?"))try{await F.delete(`/financeiro/formas-pagamento/${h}`),ce.success("Forma de pagamento exclu√≠da!"),w()}catch(_){console.error("Erro ao excluir:",_),ce.error("Erro ao excluir forma de pagamento")}},i=[{value:"dinheiro",label:"Dinheiro",icone:"üíµ"},{value:"cartao_credito",label:"Cart√£o de Cr√©dito",icone:"üí≥"},{value:"cartao_debito",label:"Cart√£o de D√©bito",icone:"üí≥"},{value:"pix",label:"PIX",icone:"üì±"},{value:"boleto",label:"Boleto",icone:"üìÑ"},{value:"transferencia",label:"Transfer√™ncia",icone:"üè¶"}];return r?e.jsx("div",{className:"flex justify-center items-center h-64",children:"Carregando..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Formas de Pagamento/Recebimento"}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:()=>x(),children:"+ Nova Forma"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nome"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Taxa %"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Taxa Fixa"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Prazo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Conta Destino"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"px-6 py-4 text-center text-gray-500",children:"Nenhuma forma de pagamento cadastrada"})}):s.map(h=>{var _,S,$,K;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:h.icone}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:h.nome}),h.operadora_id&&e.jsx("div",{className:"text-xs text-gray-500",children:((_=o.find(re=>re.id===h.operadora_id))==null?void 0:_.nome)||h.operadora||"Operadora n√£o encontrada"})]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:((S=i.find(re=>re.value===h.tipo))==null?void 0:S.label)||h.tipo}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[h.taxa_percentual,"%"]}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:["R$ ",(($=h.taxa_fixa)==null?void 0:$.toFixed(2))||"0.00"]}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[h.prazo_dias," dias"]}),e.jsx("td",{className:"px-6 py-4 text-sm",children:h.conta_bancaria_destino_id?((K=t.find(re=>re.id===h.conta_bancaria_destino_id))==null?void 0:K.nome)||"N/A":e.jsx("span",{className:"text-gray-400",children:"Nenhuma"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${h.ativo?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:h.ativo?"Ativo":"Inativo"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"text-blue-600 hover:text-blue-800",onClick:()=>x(h),children:"‚úèÔ∏è"}),e.jsx("button",{className:"text-red-600 hover:text-red-800",onClick:()=>u(h.id),children:"üóëÔ∏è"})]})})]},h.id)})})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-6 py-4 flex justify-between items-center sticky top-0",children:[e.jsxs("h3",{className:"text-xl font-semibold",children:[y?"Editar":"Nova"," Forma de Pagamento"]}),e.jsx("button",{onClick:()=>f(!1),className:"text-white hover:bg-blue-700 px-3 py-1 rounded",children:"‚úï"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nome *"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",value:m.nome,onChange:h=>k({...m,nome:h.target.value}),placeholder:"Ex: Dinheiro, PIX, Stone Cr√©dito..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipo *"}),e.jsx("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:m.tipo,onChange:h=>k({...m,tipo:h.target.value}),children:i.map(h=>e.jsxs("option",{value:h.value,children:[h.icone," ",h.label]},h.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"√çcone"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",value:m.icone,onChange:h=>k({...m,icone:h.target.value}),placeholder:"üíµ",maxLength:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa % (Ex: 2.5%)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:m.taxa_percentual,onChange:h=>k({...m,taxa_percentual:parseFloat(h.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa Fixa (R$)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:m.taxa_fixa,onChange:h=>k({...m,taxa_fixa:parseFloat(h.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Prazo (dias)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",value:m.prazo_dias,onChange:h=>k({...m,prazo_dias:parseInt(h.target.value)||0})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Conta Banc√°ria Destino"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:m.conta_bancaria_destino_id||"",onChange:h=>k({...m,conta_bancaria_destino_id:parseInt(h.target.value)||null}),children:[e.jsx("option",{value:"",children:"Selecione..."}),t.map(h=>e.jsx("option",{value:h.id,children:h.nome},h.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Esta conta ser√° usada automaticamente quando esta forma for selecionada em pagamentos/recebimentos"})]}),(m.tipo==="cartao_credito"||m.tipo==="cartao_debito")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Operadora *"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:m.operadora_id||"",onChange:h=>{const _=parseInt(h.target.value)||null,S=o.find(K=>K.id===_);let $=(S==null?void 0:S.max_parcelas)||m.parcelas_maximas;k({...m,operadora_id:_,operadora:(S==null?void 0:S.nome)||"",parcelas_maximas:$})},children:[e.jsx("option",{value:"",children:"Selecione a operadora..."}),o.map(h=>e.jsxs("option",{value:h.id,children:[h.icone," ",h.nome," (at√© ",h.max_parcelas,"x)"]},h.id))]}),m.operadora_id&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Limite de parcelas desta operadora: ",(p=o.find(h=>h.id===m.operadora_id))==null?void 0:p.max_parcelas,"x"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Bandeira"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:m.bandeira,onChange:h=>k({...m,bandeira:h.target.value}),children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"visa",children:"Visa"}),e.jsx("option",{value:"master",children:"Mastercard"}),e.jsx("option",{value:"elo",children:"Elo"}),e.jsx("option",{value:"amex",children:"American Express"}),e.jsx("option",{value:"hipercard",children:"Hipercard"})]})]})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.ativo,onChange:h=>k({...m,ativo:h.target.checked})}),e.jsx("span",{className:"text-sm",children:"Ativo"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.gera_contas_receber,onChange:h=>k({...m,gera_contas_receber:h.target.checked})}),e.jsx("span",{className:"text-sm",children:"Gera Contas a Receber (para cart√µes com prazo)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.requer_nsu,onChange:h=>k({...m,requer_nsu:h.target.checked})}),e.jsx("span",{className:"text-sm",children:"Requer NSU (n√∫mero de transa√ß√£o)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.permite_parcelamento,onChange:h=>k({...m,permite_parcelamento:h.target.checked})}),e.jsx("span",{className:"text-sm",children:"Permite Parcelamento"})]}),m.permite_parcelamento&&e.jsxs("div",{className:"ml-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"M√°ximo de Parcelas"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",min:"1",max:m.operadora_id&&((l=o.find(h=>h.id===m.operadora_id))==null?void 0:l.max_parcelas)||24,value:m.parcelas_maximas,onChange:h=>{const _=parseInt(h.target.value)||1,S=o.find(K=>K.id===m.operadora_id),$=(S==null?void 0:S.max_parcelas)||24;if(_>$){ce.error(`‚ùå Esta operadora permite no m√°ximo ${$}x`);return}k({...m,parcelas_maximas:_})}}),m.operadora_id&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["‚ö†Ô∏è Limitado a ",(C=o.find(h=>h.id===m.operadora_id))==null?void 0:C.max_parcelas,"x pela operadora selecionada"]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"üìä Taxas Espec√≠ficas por N√∫mero de Parcelas"}),e.jsxs("p",{className:"text-xs text-blue-700 mb-3",children:["Configure taxas diferentes para cada quantidade de parcelas. Se n√£o informado, usa a taxa base (",m.taxa_percentual,"%)."]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-48 overflow-y-auto",children:Array.from({length:m.parcelas_maximas},(h,_)=>_+1).map(h=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"text-xs font-medium text-gray-700 w-10",children:[h,"x:"]}),e.jsx("input",{type:"number",step:"0.01",className:"flex-1 border border-gray-300 rounded px-2 py-1 text-sm",placeholder:m.taxa_percentual,value:m.taxas_por_parcela[h]||"",onChange:_=>{const S={...m.taxas_por_parcela};_.target.value?S[h]=parseFloat(_.target.value):delete S[h],k({...m,taxas_por_parcela:S})}}),e.jsx("span",{className:"text-xs text-gray-500",children:"%"})]},h))})]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.permite_antecipacao,onChange:h=>k({...m,permite_antecipacao:h.target.checked})}),e.jsx("span",{className:"text-sm",children:"Permite Antecipa√ß√£o de Receb√≠veis"})]}),m.permite_antecipacao&&e.jsxs("div",{className:"ml-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Dias para Recebimento Antecipado"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",min:"0",max:"30",value:m.dias_recebimento_antecipado||"",onChange:h=>k({...m,dias_recebimento_antecipado:parseInt(h.target.value)||null}),placeholder:"Ex: 1 (cai em D+1)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Quantos dias ap√≥s a venda o dinheiro cai na conta com antecipa√ß√£o (geralmente D+1)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa de Antecipa√ß√£o (%) - OPCIONAL"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full border border-gray-300 rounded px-3 py-2",value:m.taxa_antecipacao_percentual||"",onChange:h=>k({...m,taxa_antecipacao_percentual:parseFloat(h.target.value)||null}),placeholder:"Ex: 0.50"}),e.jsxs("div",{className:"mt-2 p-3 bg-amber-50 border border-amber-200 rounded",children:[e.jsx("p",{className:"text-xs text-amber-800 font-semibold mb-1",children:"üí° Duas formas de configurar:"}),e.jsxs("p",{className:"text-xs text-amber-700 mb-1",children:[e.jsx("strong",{children:"1. Com taxa de antecipa√ß√£o:"})," Preencha este campo e a taxa ser√° somada automaticamente √†s taxas por parcela configuradas acima"]}),e.jsxs("p",{className:"text-xs text-amber-700",children:[e.jsx("strong",{children:"2. Sem taxa de antecipa√ß√£o:"})," Deixe vazio e configure nos campos 1x a 12x acima j√° com o valor final (taxa normal + antecipa√ß√£o somadas)"]})]})]})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 border-t p-4",children:[e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",onClick:()=>f(!1),children:"Cancelar"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:b,children:"‚úì Salvar"})]})]})})]})},nd=["üí≥","üè¶","üí∞","üíµ","üí∏","üèß","üíº","üéØ","‚ö°","üîí","‚ú®","üåü","üìä","üíé","üéÅ","üîë","‚≠ê","üöÄ"];function ld(){const[s,n]=a.useState([]),[t,d]=a.useState(!0),[o,g]=a.useState(!1),[r,v]=a.useState(null),[j,f]=a.useState(""),[y,c]=a.useState(!1),[m,k]=a.useState({nome:"",codigo:"",max_parcelas:12,padrao:!1,ativo:!0,api_enabled:!1,api_endpoint:"",api_token_encrypted:"",cor:"#00A868",icone:"üí≥"});a.useEffect(()=>{w()},[]);const w=async()=>{try{d(!0);const p=await F.get("/operadoras-cartao");n(p.data)}catch(p){console.error("Erro ao carregar operadoras:",p),ce.error("Erro ao carregar operadoras de cart√£o")}finally{d(!1)}},x=(p=null)=>{p?(k({nome:p.nome,codigo:p.codigo||"",max_parcelas:p.max_parcelas,padrao:p.padrao,ativo:p.ativo,api_enabled:p.api_enabled,api_endpoint:p.api_endpoint||"",api_token_encrypted:p.api_token_encrypted||"",cor:p.cor||"#00A868",icone:p.icone||"üí≥"}),v(p)):(k({nome:"",codigo:"",max_parcelas:12,padrao:!1,ativo:!0,api_enabled:!1,api_endpoint:"",api_token_encrypted:"",cor:"#00A868",icone:"üí≥"}),v(null)),g(!0),f(""),c(!1)},b=async p=>{var l,C,h,_,S,$;if(p.preventDefault(),!m.nome.trim()){ce.error("Nome da operadora √© obrigat√≥rio");return}if(m.max_parcelas<1||m.max_parcelas>24){ce.error("Parcelas devem estar entre 1 e 24");return}try{const K={...m,nome:m.nome.trim(),codigo:((C=(l=m.codigo)==null?void 0:l.trim())==null?void 0:C.toUpperCase())||null,api_endpoint:((h=m.api_endpoint)==null?void 0:h.trim())||null,api_token_encrypted:((_=m.api_token_encrypted)==null?void 0:_.trim())||null};r?(await F.put(`/operadoras-cartao/${r.id}`,K),ce.success("Operadora atualizada com sucesso!")):(await F.post("/operadoras-cartao",K),ce.success("Operadora criada com sucesso!")),g(!1),w()}catch(K){console.error("Erro ao salvar:",K);const re=(($=(S=K.response)==null?void 0:S.data)==null?void 0:$.detail)||"Erro ao salvar operadora";ce.error(re),f(re)}},u=async p=>{var l,C;if(window.confirm("Deseja realmente excluir esta operadora? Ela ser√° desativada se houver vendas vinculadas."))try{await F.delete(`/operadoras-cartao/${p}`),ce.success("Operadora removida com sucesso!"),w()}catch(h){console.error("Erro ao excluir:",h);const _=((C=(l=h.response)==null?void 0:l.data)==null?void 0:C.detail)||"Erro ao excluir operadora";ce.error(_)}},i=()=>{const p=s.find(l=>l.padrao&&l.ativo);return p?e.jsx("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:e.jsx(Ho,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-emerald-900",children:"Operadora Padr√£o"}),e.jsxs("p",{className:"text-sm text-emerald-700",children:[e.jsx("span",{className:"font-medium",children:p.nome})," ser√° pr√©-selecionada no PDV"]})]})]})}):null};return t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Operadoras de Cart√£o"}),e.jsx("p",{className:"text-gray-600",children:"Configure as operadoras de cart√£o dispon√≠veis (Stone, Cielo, Rede, Getnet, etc)"})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Da,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-amber-900 mb-1",children:"Importante"}),e.jsxs("ul",{className:"text-sm text-amber-700 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Pelo menos uma operadora deve estar marcada como padr√£o e ativa"}),e.jsx("li",{children:"‚Ä¢ O PDV usar√° a operadora padr√£o automaticamente para vendas com cart√£o"}),e.jsx("li",{children:"‚Ä¢ Operadoras com vendas vinculadas n√£o podem ser exclu√≠das (apenas desativadas)"})]})]})]})}),i(),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>x(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 transition-colors",children:[e.jsx(os,{className:"w-4 h-4"}),"Nova Operadora"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(p=>{const l=p.icone&&!p.icone.startsWith("Fi")&&!p.icone.startsWith("Bi")?p.icone:"üí≥";return e.jsxs("div",{className:`border rounded-lg p-4 hover:shadow-md transition-shadow ${p.ativo?"bg-white border-gray-200":"bg-gray-50 border-gray-300"} ${p.padrao?"ring-2 ring-emerald-500":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-2xl",style:{backgroundColor:`${p.cor}20`},children:l}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[p.nome,p.padrao&&e.jsx("span",{className:"text-xs bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full",children:"Padr√£o"})]}),p.codigo&&e.jsx("p",{className:"text-xs text-gray-500 font-mono",children:p.codigo})]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${p.ativo?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"}`,children:p.ativo?"Ativo":"Inativo"})]}),e.jsxs("div",{className:"space-y-2 mb-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Parcelas m√°ximas:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[p.max_parcelas,"x"]})]}),p.api_enabled&&e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-200",children:e.jsxs("span",{className:"text-xs text-blue-600 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-600 rounded-full"}),"API Integrada"]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>x(p),className:"flex-1 bg-blue-50 text-blue-600 px-3 py-2 rounded hover:bg-blue-100 flex items-center justify-center gap-2 transition-colors text-sm",children:[e.jsx(Dr,{className:"w-4 h-4"}),"Editar"]}),e.jsxs("button",{onClick:()=>u(p.id),className:"flex-1 bg-red-50 text-red-600 px-3 py-2 rounded hover:bg-red-100 flex items-center justify-center gap-2 transition-colors text-sm",children:[e.jsx(hs,{className:"w-4 h-4"}),"Excluir"]})]})]},p.id)})}),s.length===0&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx(lt,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Nenhuma operadora cadastrada"}),e.jsx("p",{className:"text-sm text-gray-500",children:'Clique em "Nova Operadora" para come√ßar'})]}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between sticky top-0 bg-white z-10",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:r?"Editar Operadora":"Nova Operadora"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(ma,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6",children:[j&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2",children:[e.jsx(da,{className:"w-4 h-4 text-red-600 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-red-700",children:j})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informa√ß√µes B√°sicas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Operadora *"}),e.jsx("input",{type:"text",value:m.nome,onChange:p=>k({...m,nome:p.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ex: Stone, Cielo, Rede",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C√≥digo (sigla)"}),e.jsx("input",{type:"text",value:m.codigo,onChange:p=>k({...m,codigo:p.target.value.toUpperCase()}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono",placeholder:"Ex: STONE, CIELO",maxLength:50})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"M√°ximo de Parcelas *"}),e.jsx("input",{type:"number",value:m.max_parcelas,onChange:p=>k({...m,max_parcelas:parseInt(p.target.value)||1}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1",max:"24",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Entre 1 e 24 parcelas"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.padrao,onChange:p=>k({...m,padrao:p.target.checked}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Operadora Padr√£o"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.ativo,onChange:p=>k({...m,ativo:p.target.checked}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Ativo"})]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Interface"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cor"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:m.cor,onChange:p=>k({...m,cor:p.target.value}),className:"w-16 h-10 border border-gray-300 rounded cursor-pointer"}),e.jsx("input",{type:"text",value:m.cor,onChange:p=>k({...m,cor:p.target.value}),className:"flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono",placeholder:"#00A868"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"√çcone"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:nd.map(p=>e.jsx("button",{type:"button",onClick:()=>k({...m,icone:p}),className:`w-10 h-10 rounded flex items-center justify-center text-xl transition-colors ${m.icone===p?"bg-blue-100 ring-2 ring-blue-500":"bg-gray-100 hover:bg-gray-200"}`,children:p},p))})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Integra√ß√£o API (Opcional)"}),e.jsxs("label",{className:"flex items-center gap-2 mb-4 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.api_enabled,onChange:p=>k({...m,api_enabled:p.target.checked}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Habilitar integra√ß√£o via API"})]}),m.api_enabled&&e.jsxs("div",{className:"space-y-4 pl-6 border-l-2 border-blue-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Endpoint da API"}),e.jsx("input",{type:"url",value:m.api_endpoint,onChange:p=>k({...m,api_endpoint:p.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm",placeholder:"https://api.operadora.com/v1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Token de Acesso"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:y?"text":"password",value:m.api_token_encrypted,onChange:p=>k({...m,api_token_encrypted:p.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm",placeholder:"Token ser√° criptografado ao salvar"}),e.jsx("button",{type:"button",onClick:()=>c(!y),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:y?e.jsx(ar,{className:"w-4 h-4"}):e.jsx(wt,{className:"w-4 h-4"})})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>g(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 transition-colors",children:[e.jsx(Ct,{className:"w-4 h-4"}),r?"Salvar Altera√ß√µes":"Criar Operadora"]})]})]})]})})]})}const id=({isOpen:s,onClose:n,contexto:t})=>{const[d,o]=a.useState([]),[g,r]=a.useState(""),[v,j]=a.useState(!1),f=a.useRef(null);a.useEffect(()=>{s&&d.length===0&&o([{tipo:"ia",conteudo:`Ol√°! Sou seu especialista financeiro com IA. Analisando seu ${(t==null?void 0:t.tipo)||"relat√≥rio"}...

Posso ajudar com:
‚Ä¢ An√°lise de resultados
‚Ä¢ Sugest√µes de melhoria
‚Ä¢ Compara√ß√µes de per√≠odos
‚Ä¢ Proje√ß√µes financeiras

O que deseja saber?`,timestamp:new Date}])},[s,d.length,t]),a.useEffect(()=>{y()},[d]);const y=()=>{var x;(x=f.current)==null||x.scrollIntoView({behavior:"smooth"})},c=async()=>{if(!g.trim())return;const x={tipo:"usuario",conteudo:g,timestamp:new Date};o(b=>[...b,x]),r(""),j(!0);try{const u={tipo:"ia",conteudo:(await F.post("/ia/chat",{mensagem:g,contexto:t})).data.resposta,timestamp:new Date};o(i=>[...i,u])}catch(b){console.error("Erro ao enviar mensagem:",b);const u={tipo:"ia",conteudo:"Desculpe, houve um erro ao processar sua mensagem. Tente novamente.",timestamp:new Date};o(i=>[...i,u])}finally{j(!1)}},m=x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),c())},k=["Como melhorar minha margem de lucro?","Quais s√£o os principais gastos?","Compare com o m√™s anterior","H√° despesas at√≠picas?"],w=x=>{r(x)};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl h-[600px] flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-4 rounded-t-2xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white bg-opacity-20 p-2 rounded-lg",children:e.jsx(us,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Especialista Financeiro IA"}),e.jsx("p",{className:"text-sm text-purple-100",children:"An√°lise inteligente dos seus dados"})]})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(ma,{size:24})})]}),t&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-indigo-200 p-3",children:e.jsxs("div",{className:"text-sm text-indigo-800",children:["üìä Analisando: ",e.jsx("span",{className:"font-semibold",children:t.tipo}),t.periodo&&e.jsxs("span",{className:"ml-2",children:["‚Ä¢ ",t.periodo]}),t.valor&&e.jsxs("span",{className:"ml-2",children:["‚Ä¢ Valor: R$ ",t.valor.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[d.map((x,b)=>e.jsx("div",{className:`flex ${x.tipo==="usuario"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-2xl p-4 ${x.tipo==="usuario"?"bg-gradient-to-r from-purple-600 to-indigo-600 text-white":"bg-gray-100 text-gray-800"}`,children:[x.tipo==="ia"&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Jo,{size:16,className:"text-purple-600"}),e.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"IA Especialista"})]}),e.jsx("p",{className:"whitespace-pre-wrap",children:x.conteudo}),e.jsx("span",{className:"text-xs opacity-70 mt-2 block",children:x.timestamp.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})})]})},b)),v&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-100 rounded-2xl p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(dt,{className:"animate-spin text-purple-600",size:20}),e.jsx("span",{className:"text-gray-600",children:"Analisando..."})]})})}),e.jsx("div",{ref:f})]}),d.length<=1&&e.jsxs("div",{className:"border-t border-gray-200 p-3 bg-gray-50",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2 font-medium",children:"üí° Sugest√µes de perguntas:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.map((x,b)=>e.jsx("button",{onClick:()=>w(x),className:"text-xs px-3 py-1.5 bg-white border border-purple-200 text-purple-700 rounded-full hover:bg-purple-50 transition-colors",children:x},b))})]}),e.jsx("div",{className:"border-t border-gray-200 p-4 bg-white rounded-b-2xl",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:g,onChange:x=>r(x.target.value),onKeyPress:m,placeholder:"Digite sua pergunta...",disabled:v,className:"flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent disabled:bg-gray-100"}),e.jsx("button",{onClick:c,disabled:!g.trim()||v,className:"px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl hover:from-purple-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2",children:e.jsx(Yo,{size:20})})]})})]})}):null},dd=()=>{const[s,n]=a.useState([]),[t,d]=a.useState(!0),[o,g]=a.useState(30),[r,v]=a.useState({media:0,desvio:0});a.useEffect(()=>{j()},[o]);const j=async()=>{d(!0);try{const x=await f();n(x)}catch(x){console.error("Erro ao carregar proje√ß√µes:",x)}finally{d(!1)}},f=async()=>{const x=new Date,b=new Date;b.setDate(b.getDate()-90);try{const i=(await F.get("/financeiro/movimentacoes",{params:{data_inicio:b.toISOString().split("T")[0],data_fim:x.toISOString().split("T")[0]}})).data,p=y(i,"entrada"),l=y(i,"saida"),C=await c(),h=[];let _=C;for(let S=1;S<=o;S++){const $=new Date;$.setDate($.getDate()+S);const K=p*(.8+Math.random()*.4),re=l*(.8+Math.random()*.4),M=K,R=re;_=_+M-R;const J=Math.max(95-S*1.5,50);h.push({data:$.toISOString().split("T")[0],dataFormatada:$.toLocaleDateString("pt-BR"),entradasProjetadas:M,saidasProjetadas:R,saldoProjetado:_,nivelConfianca:J,diaSemana:$.toLocaleDateString("pt-BR",{weekday:"short"}),alerta:_<1e3?"cr√≠tico":_<5e3?"aten√ß√£o":null})}return h}catch(u){return console.error("Erro ao gerar proje√ß√µes:",u),[]}},y=(x,b)=>{const u=x.filter(p=>p.tipo===b);return u.length===0?0:u.reduce((p,l)=>p+l.valor,0)/90},c=async()=>{try{return(await F.get("/financeiro/saldo-atual")).data.saldo||1e4}catch(x){return console.error("Erro ao buscar saldo:",x),1e4}},m=x=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(x),k=x=>x==="cr√≠tico"?"bg-red-100 border-red-300 text-red-800":x==="aten√ß√£o"?"bg-yellow-100 border-yellow-300 text-yellow-800":"bg-green-50 border-green-200",w=()=>{var b,u,i;const x=[];for(let p=0;p<s.length;p+=7){const l=s.slice(p,p+7),C=l.reduce((S,$)=>S+$.entradasProjetadas,0),h=l.reduce((S,$)=>S+$.saidasProjetadas,0),_=((b=l[l.length-1])==null?void 0:b.saldoProjetado)||0;x.push({numero:Math.floor(p/7)+1,dataInicio:(u=l[0])==null?void 0:u.dataFormatada,dataFim:(i=l[l.length-1])==null?void 0:i.dataFormatada,entradas:C,saidas:h,saldo:h-C,saldoFinal:_})}return x};return t?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(us,{className:"w-6 h-6 text-purple-600 animate-spin"}),e.jsx("span",{className:"text-gray-600",children:"Calculando proje√ß√µes..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 rounded-lg p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Ma,{className:"w-6 h-6"}),"Proje√ß√µes de Fluxo de Caixa"]}),e.jsx("p",{className:"text-purple-100 mt-1",children:"Previs√µes baseadas em padr√µes hist√≥ricos e tend√™ncias"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g(15),className:`px-4 py-2 rounded-lg font-medium transition-colors ${o===15?"bg-white text-purple-600":"bg-purple-500 text-white hover:bg-purple-400"}`,children:"15 dias"}),e.jsx("button",{onClick:()=>g(30),className:`px-4 py-2 rounded-lg font-medium transition-colors ${o===30?"bg-white text-purple-600":"bg-purple-500 text-white hover:bg-purple-400"}`,children:"30 dias"}),e.jsx("button",{onClick:()=>g(60),className:`px-4 py-2 rounded-lg font-medium transition-colors ${o===60?"bg-white text-purple-600":"bg-purple-500 text-white hover:bg-purple-400"}`,children:"60 dias"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Cs,{className:"w-5 h-5 text-indigo-600"}),"Resumo Semanal"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:w().map(x=>e.jsxs("div",{className:`border rounded-lg p-4 ${x.saldoFinal<5e3?"border-yellow-300 bg-yellow-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"text-sm font-medium text-gray-600 mb-2",children:["Semana ",x.numero]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-3",children:[x.dataInicio," - ",x.dataFim]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-600",children:"Entradas:"}),e.jsx("span",{className:"font-medium",children:m(x.entradas)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-red-600",children:"Sa√≠das:"}),e.jsx("span",{className:"font-medium",children:m(x.saidas)})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-semibold",children:[e.jsx("span",{children:"Saldo Final:"}),e.jsx("span",{className:x.saldoFinal<5e3?"text-yellow-600":"text-gray-800",children:m(x.saldoFinal)})]})]})]},x.numero))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(za,{className:"w-5 h-5 text-green-600"}),"Proje√ß√µes Di√°rias Detalhadas"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:"Data"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:"Dia"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-gray-700",children:"Entradas"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-gray-700",children:"Sa√≠das"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-gray-700",children:"Saldo Projetado"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-gray-700",children:"Confian√ßa"})]})}),e.jsx("tbody",{children:s.map((x,b)=>e.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 ${x.alerta?k(x.alerta):""}`,children:[e.jsx("td",{className:"py-3 px-4 text-sm",children:x.dataFormatada}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:x.diaSemana}),e.jsx("td",{className:"py-3 px-4 text-sm text-right text-green-600 font-medium",children:m(x.entradasProjetadas)}),e.jsx("td",{className:"py-3 px-4 text-sm text-right text-red-600 font-medium",children:m(x.saidasProjetadas)}),e.jsx("td",{className:"py-3 px-4 text-sm text-right font-semibold",children:m(x.saldoProjetado)}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${x.nivelConfianca>=80?"bg-green-100 text-green-800":x.nivelConfianca>=65?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800"}`,children:[x.nivelConfianca.toFixed(0),"%"]})})]},b))})]})})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(da,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Sobre as Proje√ß√µes"}),e.jsx("p",{children:"As proje√ß√µes s√£o calculadas com base em padr√µes hist√≥ricos dos √∫ltimos 90 dias. O n√≠vel de confian√ßa diminui com o tempo, pois eventos futuros podem alterar as tend√™ncias."})]})]})]})},cd=()=>{const[s,n]=a.useState([]),[t,d]=a.useState(!0),[o,g]=a.useState("todos");a.useEffect(()=>{r()},[]);const r=async()=>{d(!0);try{const i=await v();n(i)}catch(i){console.error("Erro ao carregar alertas:",i)}finally{d(!1)}},v=async()=>{const i=[],p=new Date;try{const l=await j();l<1e3?i.push({id:"saldo-critico",tipo:"saldo",severidade:"cr√≠tico",titulo:"Saldo Cr√≠tico",mensagem:`Seu saldo est√° abaixo de R$ 1.000,00. Saldo atual: ${w(l)}`,recomendacao:"Considere adiar pagamentos n√£o essenciais ou antecipar recebimentos.",icone:Da,data:p.toISOString()}):l<5e3&&i.push({id:"saldo-atencao",tipo:"saldo",severidade:"aten√ß√£o",titulo:"Saldo Baixo",mensagem:`Seu saldo est√° em n√≠vel de aten√ß√£o: ${w(l)}`,recomendacao:"Monitore suas despesas e prepare-se para poss√≠veis necessidades de caixa.",icone:da,data:p.toISOString()});const C=await f(7);if(C.length>0){const K=C.reduce((re,M)=>re+M.valor,0);i.push({id:"vencimentos-proximos",tipo:"vencimento",severidade:"aten√ß√£o",titulo:`${C.length} Pagamentos Vencendo`,mensagem:`Voc√™ tem ${C.length} pagamentos vencendo nos pr√≥ximos 7 dias, totalizando ${w(K)}`,recomendacao:"Verifique se h√° saldo suficiente para cobrir estes pagamentos.",icone:Cs,data:p.toISOString(),detalhes:C})}const h=await y();if(h.length>0){const K=h.reduce((re,M)=>re+M.valor,0);i.push({id:"vencimentos-atrasados",tipo:"atraso",severidade:"cr√≠tico",titulo:`${h.length} Pagamentos Atrasados`,mensagem:`Voc√™ tem ${h.length} pagamentos em atraso, totalizando ${w(K)}`,recomendacao:"Priorize a quita√ß√£o destes d√©bitos para evitar juros e multas.",icone:Da,data:p.toISOString(),detalhes:h})}const _=await c();_.variacao>30&&i.push({id:"gastos-anormais",tipo:"anomalia",severidade:"aten√ß√£o",titulo:"Gastos Acima do Normal",mensagem:`Suas despesas aumentaram ${_.variacao.toFixed(0)}% em rela√ß√£o √† m√©dia hist√≥rica`,recomendacao:"Revise seus gastos recentes e identifique poss√≠veis despesas extraordin√°rias.",icone:Ma,data:p.toISOString(),detalhes:_});const S=await m();S.length>0&&i.push({id:"recorrencias-pendentes",tipo:"recorrencia",severidade:"info",titulo:"Despesas Recorrentes Pr√≥ximas",mensagem:`${S.length} despesas recorrentes vencer√£o em breve`,recomendacao:"Certifique-se de que h√° saldo para cobrir estas despesas autom√°ticas.",icone:Os,data:p.toISOString(),detalhes:S});const $=await k(15);return $.diasAteNegativo>0&&i.push({id:"projecao-negativa",tipo:"projecao",severidade:"cr√≠tico",titulo:"Risco de Saldo Negativo",mensagem:`Com o padr√£o atual, seu saldo pode ficar negativo em ${$.diasAteNegativo} dias`,recomendacao:"Tome medidas urgentes para aumentar receitas ou reduzir despesas.",icone:Oa,data:p.toISOString(),detalhes:$}),i.sort((K,re)=>{const M={cr√≠tico:0,aten√ß√£o:1,info:2};return M[K.severidade]-M[re.severidade]})}catch(l){return console.error("Erro ao gerar alertas:",l),[]}},j=async()=>{try{return(await F.get("/financeiro/saldo-atual")).data.saldo||1e4}catch{return 1e4}},f=async i=>{try{const p=new Date,l=new Date;return l.setDate(l.getDate()+i),(await F.get("/financeiro/contas-pagar",{params:{data_inicio:p.toISOString().split("T")[0],data_fim:l.toISOString().split("T")[0],status:"pendente"}})).data||[]}catch{return[]}},y=async()=>{try{return(await F.get("/financeiro/contas-pagar",{params:{atrasadas:!0}})).data||[]}catch{return[]}},c=async()=>{try{const i=new Date,p=new Date;return p.setDate(p.getDate()-30),(await F.get("/financeiro/analise-gastos",{params:{data_inicio:p.toISOString().split("T")[0],data_fim:i.toISOString().split("T")[0]}})).data||{variacao:0}}catch{return{variacao:0}}},m=async()=>{try{return(await F.get("/financeiro/recorrencias-proximas")).data||[]}catch{return[]}},k=async i=>{try{return(await F.get("/ia/fluxo/projecao-saldo",{params:{dias:i}})).data||{diasAteNegativo:0}}catch{return{diasAteNegativo:0}}},w=i=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i),x=i=>{n(s.filter(p=>p.id!==i))},b=i=>{switch(i){case"cr√≠tico":return{bg:"bg-red-50",border:"border-red-300",text:"text-red-800",badge:"bg-red-100 text-red-800"};case"aten√ß√£o":return{bg:"bg-yellow-50",border:"border-yellow-300",text:"text-yellow-800",badge:"bg-yellow-100 text-yellow-800"};case"info":return{bg:"bg-blue-50",border:"border-blue-300",text:"text-blue-800",badge:"bg-blue-100 text-blue-800"};default:return{bg:"bg-gray-50",border:"border-gray-300",text:"text-gray-800",badge:"bg-gray-100 text-gray-800"}}},u=s.filter(i=>o==="todos"?!0:i.severidade===o);return t?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(us,{className:"w-6 h-6 text-purple-600 animate-spin"}),e.jsx("span",{className:"text-gray-600",children:"Analisando alertas..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-red-600 rounded-lg p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Da,{className:"w-6 h-6"}),"Alertas Inteligentes"]}),e.jsx("p",{className:"text-orange-100 mt-1",children:"Avisos autom√°ticos sobre situa√ß√µes que requerem aten√ß√£o"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>g("todos"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${o==="todos"?"bg-white text-orange-600":"bg-orange-500 text-white hover:bg-orange-400"}`,children:["Todos (",s.length,")"]}),e.jsxs("button",{onClick:()=>g("cr√≠tico"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${o==="cr√≠tico"?"bg-white text-orange-600":"bg-orange-500 text-white hover:bg-orange-400"}`,children:["Cr√≠ticos (",s.filter(i=>i.severidade==="cr√≠tico").length,")"]})]})]})}),u.length===0?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-8 text-center",children:[e.jsx(ha,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),e.jsx("h4",{className:"text-lg font-semibold text-green-800 mb-2",children:"Tudo em ordem!"}),e.jsx("p",{className:"text-green-700",children:"N√£o h√° alertas no momento. Seu fluxo de caixa est√° saud√°vel."})]}):e.jsx("div",{className:"space-y-4",children:u.map(i=>{const p=b(i.severidade),l=i.icone;return e.jsx("div",{className:`${p.bg} border ${p.border} rounded-lg p-5 transition-all hover:shadow-md`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`${p.text} mt-1`,children:e.jsx(l,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:`font-semibold ${p.text}`,children:i.titulo}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${p.badge}`,children:i.severidade})]}),e.jsx("p",{className:`text-sm mb-3 ${p.text}`,children:i.mensagem}),e.jsxs("div",{className:"bg-white bg-opacity-50 rounded-lg p-3 mb-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"üí° Recomenda√ß√£o:"}),e.jsx("p",{className:"text-sm text-gray-600",children:i.recomendacao})]}),i.detalhes&&e.jsxs("details",{className:"text-sm",children:[e.jsx("summary",{className:"cursor-pointer font-medium text-gray-700 hover:text-gray-900",children:"Ver detalhes"}),e.jsx("div",{className:"mt-2 pl-4 border-l-2 border-gray-300",children:e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap",children:JSON.stringify(i.detalhes,null,2)})})]})]})]}),e.jsx("button",{onClick:()=>x(i.id),className:"ml-4 text-gray-400 hover:text-gray-600 transition-colors",title:"Marcar como resolvido",children:e.jsx(ma,{className:"w-5 h-5"})})]})},i.id)})})]})},xd=()=>{fa();const[s,n]=a.useState(!1),[t,d]=a.useState(null),[o,g]=a.useState("movimentacoes"),[r,v]=a.useState(!1),j=()=>{const R=new Date,J=R.getFullYear(),te=String(R.getMonth()+1).padStart(2,"0"),L=String(R.getDate()).padStart(2,"0");return`${J}-${te}-${L}`},f=()=>{const R=new Date,J=R.getFullYear(),te=String(R.getMonth()+1).padStart(2,"0");return`${J}-${te}-01`},[y,c]=a.useState({data_inicio:f(),data_fim:j(),conta_bancaria_id:null,agrupamento:"dia"}),[m,k]=a.useState("todos"),[w,x]=a.useState("todos"),[b,u]=a.useState([]),[i,p]=a.useState(null),[l,C]=a.useState(!1),[h,_]=a.useState("");a.useEffect(()=>{S(),$()},[]);const S=async()=>{try{const R=await F.get("/contas-bancarias");u(R.data)}catch(R){console.error("Erro ao carregar contas banc√°rias:",R)}},$=async()=>{var R,J;n(!0);try{const te=new URLSearchParams({data_inicio:y.data_inicio,data_fim:y.data_fim,agrupamento:y.agrupamento});y.conta_bancaria_id&&te.append("conta_bancaria_id",y.conta_bancaria_id),h&&te.append("numero_venda",h);const L=await F.get(`/financeiro/fluxo-caixa?${te}`);d(L.data)}catch(te){console.error("Erro ao carregar fluxo de caixa:",te),alert("Erro ao carregar fluxo de caixa: "+(((J=(R=te.response)==null?void 0:R.data)==null?void 0:J.detail)||te.message))}finally{n(!1)}},K=R=>{const J=new Date;let te,L;switch(R){case"7dias":te=new Date(J.setDate(J.getDate()-7)),L=new Date;break;case"30dias":te=new Date(J.setDate(J.getDate()-30)),L=new Date;break;case"mes_atual":te=new Date(J.getFullYear(),J.getMonth(),1),L=new Date(J.getFullYear(),J.getMonth()+1,0);break;case"proximo_mes":te=new Date(J.getFullYear(),J.getMonth()+1,1),L=new Date(J.getFullYear(),J.getMonth()+2,0);break;default:return}const Z={...y,data_inicio:te.toISOString().split("T")[0],data_fim:L.toISOString().split("T")[0]};c(Z),setTimeout(()=>$(),100)},re=R=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(R||0),M=R=>t?t.movimentacoes.filter(J=>{const te=new Date(J.data),L=new Date(R.data_inicio),Z=new Date(R.data_fim);if(!(te>=L&&te<=Z)||m==="entradas"&&J.tipo!=="credito"||m==="saidas"&&J.tipo!=="debito"||w==="realizado"&&J.status!=="realizado"||w==="previsto"&&J.status!=="previsto")return!1;if(h){const G=J.descricao||"",E=J.numero_venda||"",P=h.toLowerCase();return E.toLowerCase().includes(P)||G.toLowerCase().includes(P)}return!0}):[];return s&&!t?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx($a,{className:"animate-spin mx-auto mb-4",size:48}),e.jsx("p",{className:"text-gray-600",children:"Carregando fluxo de caixa..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"üíπ Fluxo de Caixa"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Vis√£o completa: Previsto vs Realizado"}),e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"‚ú® Os lan√ßamentos s√£o criados automaticamente a partir de Contas a Pagar e Contas a Receber"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"üî¢ Buscar por N√∫mero da Venda"}),e.jsx("input",{type:"text",placeholder:"Digite o n√∫mero da venda (ex: 202601100007) e pressione Enter",className:"w-full px-3 py-2 border border-gray-300 rounded-md",value:h,onChange:R=>_(R.target.value),onKeyPress:R=>{R.key==="Enter"&&$()}})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Visualiza√ß√£o"}),e.jsxs("select",{value:y.agrupamento,onChange:R=>c({...y,agrupamento:R.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"dia",children:"üìÖ Di√°rio"}),e.jsx("option",{value:"semana",children:"üìä Semanal"}),e.jsx("option",{value:"mes",children:"üìà Mensal"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Movimenta√ß√£o"}),e.jsxs("select",{value:m,onChange:R=>k(R.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"todos",children:"üìä Todas"}),e.jsx("option",{value:"entradas",children:"üí∞ Apenas Entradas"}),e.jsx("option",{value:"saidas",children:"üí∏ Apenas Sa√≠das"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:w,onChange:R=>x(R.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"todos",children:"üìã Todos"}),e.jsx("option",{value:"realizado",children:"‚úÖ Apenas Realizados"}),e.jsx("option",{value:"previsto",children:"üìÖ Apenas Previstos"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data In√≠cio"}),e.jsx("input",{type:"date",value:y.data_inicio,onChange:R=>c({...y,data_inicio:R.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:y.data_fim,onChange:R=>c({...y,data_fim:R.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Conta Banc√°ria"}),e.jsxs("select",{value:y.conta_bancaria_id||"",onChange:R=>c({...y,conta_bancaria_id:R.target.value||null}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Todas as Contas"}),wa(b).map(R=>e.jsx("option",{value:R.id,children:R.nome},R.id))]})]}),e.jsx("div",{className:"flex items-end gap-2",children:e.jsxs("button",{onClick:$,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",children:[e.jsx($a,{size:18}),"Atualizar"]})})]}),(m!=="todos"||w!=="todos")&&e.jsxs("div",{className:"mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-blue-800 font-medium",children:"üîç Filtros ativos:"}),m!=="todos"&&e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:m==="entradas"?"üí∞ Apenas Entradas":"üí∏ Apenas Sa√≠das"}),w!=="todos"&&e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:w==="realizado"?"‚úÖ Apenas Realizados":"üìÖ Apenas Previstos"})]}),e.jsx("button",{onClick:()=>{k("todos"),x("todos")},className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Limpar filtros"})]}),e.jsxs("div",{className:"flex gap-2 mt-3 flex-wrap items-center",children:[e.jsx("button",{onClick:()=>K("7dias"),className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded",children:"√öltimos 7 dias"}),e.jsx("button",{onClick:()=>K("30dias"),className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded",children:"√öltimos 30 dias"}),e.jsx("button",{onClick:()=>K("mes_atual"),className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded",children:"M√™s Atual"}),e.jsx("button",{onClick:()=>K("proximo_mes"),className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded",children:"Pr√≥ximo M√™s"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 bg-blue-50 px-3 py-2 rounded border border-blue-200",children:[e.jsx("input",{type:"checkbox",id:"apenasComLancamentos",checked:l,onChange:R=>C(R.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"apenasComLancamentos",className:"text-sm font-medium text-blue-700 cursor-pointer",children:"üìä Apenas dias com lan√ßamentos"})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[e.jsxs("button",{onClick:()=>g("movimentacoes"),className:`flex items-center gap-2 px-6 py-4 border-b-2 font-medium transition-colors ${o==="movimentacoes"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(za,{className:"w-5 h-5"}),"Movimenta√ß√µes"]}),e.jsxs("button",{onClick:()=>g("projecoes"),className:`flex items-center gap-2 px-6 py-4 border-b-2 font-medium transition-colors ${o==="projecoes"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(Et,{className:"w-5 h-5"}),"Proje√ß√µes IA",e.jsx(us,{className:"w-4 h-4"})]}),e.jsxs("button",{onClick:()=>g("alertas"),className:`flex items-center gap-2 px-6 py-4 border-b-2 font-medium transition-colors ${o==="alertas"?"border-orange-600 text-orange-600":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(Da,{className:"w-5 h-5"}),"Alertas IA",e.jsx(us,{className:"w-4 h-4"})]})]})})}),o==="projecoes"&&e.jsx(dd,{}),o==="alertas"&&e.jsx(cd,{}),o==="movimentacoes"&&t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Saldo Inicial"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:re(t.saldo_inicial)})]}),e.jsx(za,{className:"text-blue-500",size:32})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-4 border-l-4 border-green-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Total Realizado (Entradas)"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:re(t.total_realizado_entradas)}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["Previsto: ",re(t.total_previsto_entradas)]})]}),e.jsx(Ma,{className:"text-green-500",size:32})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg p-4 border-l-4 border-red-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Total Realizado (Sa√≠das)"}),e.jsx("p",{className:"text-2xl font-bold text-red-700",children:re(t.total_realizado_saidas)}),e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Previsto: ",re(t.total_previsto_saidas)]})]}),e.jsx(Oa,{className:"text-red-500",size:32})]})}),e.jsx("div",{className:`rounded-lg p-4 border-l-4 ${t.saldo_final>=0?"bg-blue-50 border-blue-500":"bg-red-50 border-red-500"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:t.saldo_final>=0?"#2563eb":"#dc2626"},children:"Saldo Final Realizado"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:t.saldo_final>=0?"#1d4ed8":"#b91c1c"},children:re(t.saldo_final)}),e.jsxs("p",{className:"text-xs mt-1",style:{color:t.saldo_final>=0?"#2563eb":"#dc2626"},children:["Previsto: ",re(t.saldo_previsto_final)]})]}),e.jsx(za,{className:t.saldo_final>=0?"text-blue-500":"text-red-500",size:32})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsxs("thead",{className:"bg-gray-50",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Per√≠odo"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider bg-green-50",colSpan:"2",children:"üí∞ Entradas"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider bg-red-50",colSpan:"2",children:"üí∏ Sa√≠das"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider bg-blue-50",children:"üíµ Saldo Final"}),e.jsx("th",{className:"px-6 py-3"})]}),e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"px-6 py-2"}),e.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 bg-green-50",children:"Previsto"}),e.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 bg-green-100",children:"Realizado"}),e.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 bg-red-50",children:"Previsto"}),e.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 bg-red-100",children:"Realizado"}),e.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 bg-blue-50",children:"Real / Previsto"}),e.jsx("th",{className:"px-4 py-2"})]})]}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:wa(t==null?void 0:t.periodos).length>0?wa(t==null?void 0:t.periodos).filter(R=>l?R.realizado_entradas>0||R.realizado_saidas>0||R.previsto_entradas>0||R.previsto_saidas>0:!0).map((R,J)=>{const te=M(R),L=R.data,Z=i===L;return e.jsxs(ts.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:R.data}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-600 text-right bg-green-50",children:re(R.previsto_entradas)}),e.jsx("td",{className:"px-4 py-4 text-sm font-bold text-green-700 text-right bg-green-100",children:re(R.realizado_entradas)}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-600 text-right bg-red-50",children:re(R.previsto_saidas)}),e.jsx("td",{className:"px-4 py-4 text-sm font-bold text-red-700 text-right bg-red-100",children:re(R.realizado_saidas)}),e.jsxs("td",{className:"px-4 py-4 text-sm text-center bg-blue-50",children:[e.jsx("div",{className:`font-bold ${R.realizado_saldo>=0?"text-green-700":"text-red-700"}`,children:re(R.realizado_saldo)}),e.jsxs("div",{className:`text-xs ${R.previsto_saldo>=0?"text-green-600":"text-red-600"}`,children:["Prev: ",re(R.previsto_saldo)]})]}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("button",{onClick:()=>p(Z?null:L),className:"text-blue-600 hover:text-blue-800",children:e.jsx(st,{size:20,className:`transform transition-transform ${Z?"rotate-90":""}`})})})]}),Z&&te.length>0&&e.jsx("tr",{className:"bg-gray-50",children:e.jsx("td",{colSpan:"7",className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-3",children:"üìã Movimenta√ß√µes Detalhadas"}),wa(te).map((A,G)=>e.jsxs("div",{className:`flex justify-between items-center p-2 rounded ${A.status==="previsto"?"bg-yellow-50 border-l-2 border-yellow-400":"bg-white border-l-2 border-blue-400"}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:A.descricao}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",A.categoria,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded ${A.status==="previsto"?"bg-yellow-200 text-yellow-800":"bg-blue-200 text-blue-800"}`,children:A.status==="previsto"?"üìÖ Previsto":"‚úÖ Realizado"}),e.jsxs("span",{className:`font-bold ${A.tipo==="entrada"?"text-green-600":"text-red-600"}`,children:[A.tipo==="entrada"?"+":"-"," ",re(A.valor)]})]})]},G))]})})})]},L)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-8 text-center text-gray-500",children:"Nenhuma movimenta√ß√£o encontrada para o per√≠odo selecionado"})})})]})})})]})]})};function md(){const[s,n]=a.useState(!0),[t,d]=a.useState("resumo"),[o,g]=a.useState(new Date().toISOString().split("T")[0]),[r,v]=a.useState(new Date().toISOString().split("T")[0]),[j,f]=a.useState({venda_bruta:0,taxa_entrega:0,desconto:0,venda_liquida:0,em_aberto:0,quantidade_vendas:0}),[y,c]=a.useState([]),[m,k]=a.useState([]),[w,x]=a.useState([]),[b,u]=a.useState([]),[i,p]=a.useState([]),[l,C]=a.useState([]),[h,_]=a.useState([]),S=()=>localStorage.getItem("access_token"),$=M=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(M||0),K=M=>new Date(M).toLocaleDateString("pt-BR"),re=async()=>{var J,te;n(!0);const R={headers:{Authorization:`Bearer ${S()}`},params:{data_inicio:o,data_fim:r}};try{const Z=(await F.get("/vendas/relatorio",R)).data;f(Z.resumo||{}),c(Z.vendas_por_data||[]),k(Z.formas_recebimento||[]),x(Z.vendas_por_funcionario||[]),u(Z.vendas_por_tipo||[]),p(Z.vendas_por_grupo||[]),C(Z.produtos_detalhados||[]),_(Z.lista_vendas||[]),console.log("‚úÖ Dados carregados:",{vendasPorData:((J=Z.vendas_por_data)==null?void 0:J.length)||0,formasRecebimento:((te=Z.formas_recebimento)==null?void 0:te.length)||0})}catch(L){console.error("Erro ao carregar relat√≥rio:",L)}finally{n(!1)}};return a.useEffect(()=>{re()},[o,r]),s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsx("div",{style:{backgroundColor:"red",color:"white",padding:"20px",fontSize:"24px",fontWeight:"bold"},children:"üî¥ TESTE: ARQUIVO EST√Å SENDO CARREGADO CORRETAMENTE"}),e.jsxs("div",{className:"mb-6 bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Consulta de Vendas"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:o,onChange:M=>g(M.target.value),className:"border rounded px-3 py-2"}),e.jsx("span",{className:"self-center",children:"at√©"}),e.jsx("input",{type:"date",value:r,onChange:M=>v(M.target.value),className:"border rounded px-3 py-2"})]})]}),e.jsxs("div",{className:"flex gap-2 border-b",children:[e.jsx("button",{onClick:()=>d("resumo"),className:`px-4 py-2 font-medium ${t==="resumo"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Resumo"}),e.jsx("button",{onClick:()=>d("produtos"),className:`px-4 py-2 font-medium ${t==="produtos"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Totais por produto/servi√ßo"}),e.jsx("button",{onClick:()=>d("lista"),className:`px-4 py-2 font-medium ${t==="lista"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Lista de Vendas"})]})]}),t==="resumo"&&e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:$(j.venda_bruta)}),e.jsx("div",{className:"text-sm",children:"Venda bruta"})]}),e.jsxs("div",{className:"bg-gray-400 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:$(j.taxa_entrega)}),e.jsx("div",{className:"text-sm",children:"Taxa de entrega"})]}),e.jsxs("div",{className:"bg-yellow-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:$(j.desconto)}),e.jsxs("div",{className:"text-sm",children:[j.percentual_desconto,"% de desconto"]})]}),e.jsxs("div",{className:"bg-blue-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:$(j.venda_liquida)}),e.jsx("div",{className:"text-sm",children:"Venda L√≠quida"})]}),e.jsxs("div",{className:"bg-red-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:$(j.em_aberto)}),e.jsx("div",{className:"text-sm",children:"Em aberto"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Vendas por data"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Data"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Tkt. M√©dio"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Taxa entrega"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"(%)"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. l√≠quido"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. recebido"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo aberto"})]})}),e.jsxs("tbody",{children:[y.map((M,R)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:K(M.data)}),e.jsx("td",{className:"px-4 py-2 text-right",children:M.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.ticket_medio)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.taxa_entrega)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.desconto)}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[M.percentual_desconto,"%"]}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_liquido)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_recebido)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.saldo_aberto)})]},R)),y.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:y.reduce((M,R)=>M+R.quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(y.reduce((M,R)=>M+R.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(y.reduce((M,R)=>M+R.taxa_entrega,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(y.reduce((M,R)=>M+R.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(y.reduce((M,R)=>M+R.valor_liquido,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(y.reduce((M,R)=>M+R.valor_recebido,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(y.reduce((M,R)=>M+R.saldo_aberto,0))})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Formas de recebimento"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Forma"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Valor pago"})]})}),e.jsxs("tbody",{children:[m.map((M,R)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:M.forma_pagamento}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_total)})]},R)),m.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(m.reduce((M,R)=>M+R.valor_total,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Funcion√°rio"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nome"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. l√≠quido"})]})}),e.jsxs("tbody",{children:[w.map((M,R)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:M.funcionario}),e.jsx("td",{className:"px-4 py-2 text-right",children:M.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_liquido)})]},R)),w.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:w.reduce((M,R)=>M+R.quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(w.reduce((M,R)=>M+R.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(w.reduce((M,R)=>M+R.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(w.reduce((M,R)=>M+R.valor_liquido,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Tipo"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Tipo"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. l√≠quido"})]})}),e.jsxs("tbody",{children:[b.map((M,R)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:M.tipo}),e.jsx("td",{className:"px-4 py-2 text-right",children:M.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_liquido)})]},R)),b.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:b.reduce((M,R)=>M+R.quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(b.reduce((M,R)=>M+R.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(b.reduce((M,R)=>M+R.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(b.reduce((M,R)=>M+R.valor_liquido,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Grupo de produto"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nome"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Percentual"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. l√≠quido"})]})}),e.jsxs("tbody",{children:[i.map((M,R)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:M.grupo}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[M.percentual,"%"]}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.valor_liquido)})]},R)),i.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(i.reduce((M,R)=>M+R.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(i.reduce((M,R)=>M+R.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(i.reduce((M,R)=>M+R.valor_liquido,0))})]})]})]})]})]})]}),t==="produtos"&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Produtos/Servi√ßos"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Produtos/Servi√ßos"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Itens"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"L√≠quido"})]})}),e.jsxs("tbody",{children:[l.map((M,R)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"bg-blue-50 font-semibold border-b-2 border-blue-300",children:[e.jsx("td",{className:"px-4 py-2",children:M.categoria}),e.jsx("td",{className:"px-4 py-2 text-right",children:M.total_quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.total_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.total_desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.total_liquido)})]},`cat-${R}`),M.subcategorias&&M.subcategorias.map((J,te)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"bg-gray-50 font-medium border-b",children:[e.jsxs("td",{className:"px-4 py-2 pl-8",children:["üìÅ ",J.subcategoria]}),e.jsx("td",{className:"px-4 py-2 text-right",children:J.total_quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(J.total_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(J.total_desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(J.total_liquido)})]},`subcat-${R}-${te}`),J.produtos.map((L,Z)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 pl-12 text-gray-700",children:L.produto}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:L.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:$(L.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:$(L.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:$(L.valor_liquido)})]},`prod-${R}-${te}-${Z}`))]})),M.produtos&&M.produtos.map((J,te)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 pl-8 text-gray-700",children:J.produto}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:J.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:$(J.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:$(J.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:$(J.valor_liquido)})]},`prod-${R}-${te}`))]})),l.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL GERAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:l.reduce((M,R)=>M+R.total_quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(l.reduce((M,R)=>M+R.total_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(l.reduce((M,R)=>M+R.total_desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:$(l.reduce((M,R)=>M+R.total_liquido,0))})]})]})]})})]}),t==="lista"&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Lista de Vendas"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"C√≥d."}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Data e hora"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Cliente"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Animal"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Valor"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Status"})]})}),e.jsx("tbody",{children:h.map(M=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:M.numero_venda||M.id}),e.jsx("td",{className:"px-4 py-2",children:K(M.data_venda)}),e.jsx("td",{className:"px-4 py-2",children:M.cliente_nome}),e.jsx("td",{className:"px-4 py-2",children:M.pet_nome||"-"}),e.jsx("td",{className:"px-4 py-2 text-right",children:$(M.total)}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${M.status==="finalizada"?"bg-green-100 text-green-800":M.status==="baixa_parcial"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:M.status==="finalizada"?"Baixada":M.status==="baixa_parcial"?"Parcial":"Em aberto"})})]},M.id))})]})})]})]})}function ud(){const[s,n]=a.useState(!1),[t,d]=a.useState("resumo"),[o,g]=a.useState(""),[r,v]=a.useState(""),[j,f]=a.useState(""),[y,c]=a.useState(!1),[m,k]=a.useState("mes_anterior"),[w,x]=a.useState(""),[b,u]=a.useState(""),[i,p]=a.useState(""),[l,C]=a.useState(!0),[h,_]=a.useState("financeiro"),[S,$]=a.useState({venda_bruta:0,taxa_entrega:0,desconto:0,venda_liquida:0,em_aberto:0,quantidade_vendas:0}),[K,re]=a.useState({venda_bruta:0,taxa_entrega:0,desconto:0,venda_liquida:0,em_aberto:0,quantidade_vendas:0}),[M,R]=a.useState([]),[J,te]=a.useState([]),[L,Z]=a.useState([]),[A,G]=a.useState([]),[E,P]=a.useState([]),[H,B]=a.useState([]),[N,O]=a.useState([]),[z,ae]=a.useState(new Set),[W,ie]=a.useState([]),[ee,Q]=a.useState([]),[de,me]=a.useState([]),[Pe,se]=a.useState([]),[_e,ke]=a.useState({}),[Ye,ze]=a.useState([]),Qe=T=>{const X=new Set(z);X.has(T)?X.delete(T):X.add(T),ae(X)},be=T=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(T||0),Ee=T=>T==null||isNaN(T)||!isFinite(T)?0:T,he=T=>{if(!T)return"N/A";try{if(T instanceof Date)return T.toLocaleDateString("pt-BR");if(typeof T=="string"&&T.includes("T")){const fe=T.split("T")[0],[U,le,Ne]=fe.split("-");return`${Ne}/${le}/${U}`}const X=new Date(T);return isNaN(X.getTime())?"N/A":X.toLocaleDateString("pt-BR")}catch{return"N/A"}},Xe=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#14B8A6","#F97316"],Je=(T,X)=>{if(!T||T.length===0)return T;let fe=[...T];return w&&X==="funcionario"&&(fe=fe.filter(U=>U.funcionario===w)),b&&X==="formaPagamento"&&(fe=fe.filter(U=>U.forma_pagamento===b)),i&&X==="categoria"&&(fe=fe.filter(U=>U.categoria===i)),fe},ca=Je(J,"formaPagamento"),ra=Je(L,"funcionario"),pa=Je(H,"categoria"),la=({titulo:T,valor:X,icone:fe,cor:U,valorAnterior:le})=>{const Ne=Y(X,le),Re=Ne.percentual>0,q=Ne.percentual===0;return e.jsxs("div",{className:`${U} text-white p-4 rounded-lg shadow`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm opacity-90",children:T}),e.jsx(fe,{className:"w-5 h-5 opacity-80"})]}),e.jsx("div",{className:"text-3xl font-bold mb-1",children:be(X)}),y&&le!==void 0&&e.jsxs("div",{className:`flex items-center gap-1 text-sm ${q?"opacity-70":""}`,children:[Re&&e.jsx(js,{className:"w-4 h-4"}),!Re&&!q&&e.jsx(vs,{className:"w-4 h-4"}),q&&e.jsx(xr,{className:"w-4 h-4"}),e.jsxs("span",{children:[Math.abs(Ne.percentual),"%"]})]})]})},oe=()=>{switch(m){case"periodo_anterior":return"mesmo per√≠odo anterior";case"mes_anterior":return"mesmo per√≠odo do m√™s anterior";case"ano_anterior":return"mesmo per√≠odo do ano anterior";default:return"per√≠odo anterior"}},ye=async()=>{if(!o||!r){Se.error("Selecione um per√≠odo para gerar o relat√≥rio");return}const T=Se.loading("Gerando PDF...");try{const X=new URLSearchParams({data_inicio:o,data_fim:r});w&&X.append("funcionario",w),b&&X.append("forma_pagamento",b),i&&X.append("categoria",i);const fe=await F.get(`/relatorios/vendas/export/pdf?${X.toString()}`,{responseType:"blob"}),U=window.URL.createObjectURL(new Blob([fe.data])),le=document.createElement("a");le.href=U,le.setAttribute("download",`relatorio_vendas_${o}_${r}.pdf`),document.body.appendChild(le),le.click(),le.remove(),Se.success("üìÑ PDF exportado com sucesso!")}catch(X){console.error("Erro ao exportar PDF:",X),Se.error("Erro ao exportar PDF")}finally{Se.dismiss(T)}},Ce=()=>{const T=$s.book_new(),X=[["RELAT√ìRIO DE VENDAS"],["Per√≠odo:",`${he(o)} at√© ${he(r)}`],[""],["M√©trica","Valor"],["Venda Bruta",S.venda_bruta],["Taxa de Entrega",S.taxa_entrega],["Desconto",S.desconto],["Venda L√≠quida",S.venda_liquida],["Em Aberto",S.em_aberto],["Quantidade de Vendas",S.quantidade_vendas]],fe=$s.aoa_to_sheet(X);if($s.book_append_sheet(T,fe,"Resumo"),M.length>0){const q=[["Data","Qtd","Tkt. M√©dio","Vl. bruto","Taxa entrega","Desconto","(%)","Vl. l√≠quido","Vl. recebido","Saldo aberto"],...M.map(pe=>[he(pe.data),pe.quantidade,pe.ticket_medio,pe.valor_bruto,pe.taxa_entrega,pe.desconto,pe.percentual_desconto,pe.valor_liquido,pe.valor_recebido,pe.saldo_aberto])],ne=$s.aoa_to_sheet(q);$s.book_append_sheet(T,ne,"Vendas por Data")}if(ca.length>0){const q=[["Forma","Valor pago"],...ca.map(pe=>[pe.forma_pagamento,pe.valor_total])],ne=$s.aoa_to_sheet(q);$s.book_append_sheet(T,ne,"Formas Pagamento")}const U=al(T,{bookType:"xlsx",type:"binary"}),le=new ArrayBuffer(U.length),Ne=new Uint8Array(le);for(let q=0;q<U.length;q++)Ne[q]=U.charCodeAt(q)&255;const Re=`relatorio_vendas_${o}_${r}.xlsx`;_n.saveAs(new Blob([le],{type:"application/octet-stream"}),Re)},Be=T=>{const X=new Date,fe=X.getFullYear(),U=String(X.getMonth()+1).padStart(2,"0"),le=String(X.getDate()).padStart(2,"0"),Ne=`${fe}-${U}-${le}`;let Re,q;switch(T){case"hoje":Re=q=Ne;break;case"ontem":const ne=new Date(X);ne.setDate(X.getDate()-1);const pe=ne.getFullYear(),$e=String(ne.getMonth()+1).padStart(2,"0"),Oe=String(ne.getDate()).padStart(2,"0");Re=q=`${pe}-${$e}-${Oe}`;break;case"esta_semana":const Ke=X.getDay(),He=Ke===0?6:Ke-1,ea=new Date(X);ea.setDate(X.getDate()-He);const na=ea.getFullYear(),ia=String(ea.getMonth()+1).padStart(2,"0"),Ue=String(ea.getDate()).padStart(2,"0");Re=`${na}-${ia}-${Ue}`,q=Ne;break;case"este_mes":Re=`${fe}-${U}-01`,q=Ne;break;case"mes_anterior":const Ca=new Date(X.getFullYear(),X.getMonth()-1,1),V=new Date(X.getFullYear(),X.getMonth(),0),Fe=Ca.getFullYear(),Te=String(Ca.getMonth()+1).padStart(2,"0"),We=V.getFullYear(),ua=String(V.getMonth()+1).padStart(2,"0"),xe=String(V.getDate()).padStart(2,"0");Re=`${Fe}-${Te}-01`,q=`${We}-${ua}-${xe}`;break;case"ultimos_7_dias":const Ae=new Date(X);Ae.setDate(X.getDate()-7);const qe=Ae.getFullYear(),sa=String(Ae.getMonth()+1).padStart(2,"0"),Ia=String(Ae.getDate()).padStart(2,"0");Re=`${qe}-${sa}-${Ia}`,q=Ne;break;case"ultimos_30_dias":const va=new Date(X);va.setDate(X.getDate()-30);const Ea=va.getFullYear(),Na=String(va.getMonth()+1).padStart(2,"0"),Ja=String(va.getDate()).padStart(2,"0");Re=`${Ea}-${Na}-${Ja}`,q=Ne;break;case"este_ano":Re=`${fe}-01-01`,q=Ne;break;default:return}g(Re),v(q),f(T)},Ie=()=>{const[T,X,fe]=o.split("-").map(Number),[U,le,Ne]=r.split("-").map(Number),Re=new Date(T,X-1,fe),q=new Date(U,le-1,Ne),ne=Math.floor((q-Re)/(1e3*60*60*24))+1;let pe,$e;switch(m){case"periodo_anterior":pe=new Date(Re),pe.setDate(Re.getDate()-ne),$e=new Date(Re),$e.setDate(Re.getDate()-1);break;case"mes_anterior":pe=new Date(Re),pe.setMonth(Re.getMonth()-1),$e=new Date(q),$e.setMonth(q.getMonth()-1);break;case"ano_anterior":pe=new Date(Re),pe.setFullYear(Re.getFullYear()-1),$e=new Date(q),$e.setFullYear(q.getFullYear()-1);break;default:return{data_inicio:"",data_fim:""}}const Oe=pe.getFullYear(),Ke=String(pe.getMonth()+1).padStart(2,"0"),He=String(pe.getDate()).padStart(2,"0"),ea=$e.getFullYear(),na=String($e.getMonth()+1).padStart(2,"0"),ia=String($e.getDate()).padStart(2,"0");return{data_inicio:`${Oe}-${Ke}-${He}`,data_fim:`${ea}-${na}-${ia}`}},Y=(T,X)=>{if(!X||X===0)return{valor:0,percentual:0};const fe=T-X,U=(fe/X*100).toFixed(1);return{valor:fe,percentual:parseFloat(U)}},je=async()=>{if(!(!o||!r)){n(!0);try{const X=(await F.get("/relatorios/vendas/relatorio",{params:{data_inicio:o,data_fim:r}})).data;if($(X.resumo||{}),R(X.vendas_por_data||[]),te(X.formas_recebimento||[]),Z(X.vendas_por_funcionario||[]),G(X.vendas_por_tipo||[]),P(X.vendas_por_grupo||[]),B(X.produtos_detalhados||[]),ze(X.produtos_analise||[]),O(X.lista_vendas||[]),y||t==="comparacao"){const fe=Ie(),U=await F.get("/relatorios/vendas/relatorio",{params:fe});re(U.data.resumo||{}),ie(U.data.formas_recebimento||[]),Q(U.data.vendas_por_grupo||[]),me(U.data.vendas_por_funcionario||[])}else re({venda_bruta:0,taxa_entrega:0,desconto:0,venda_liquida:0,em_aberto:0,quantidade_vendas:0})}catch(T){console.error("Erro ao carregar relat√≥rio:",T)}finally{n(!1)}}},Me=()=>{if(!Ye||Ye.length===0){se([]),ke({});return}const T=Ye.map(U=>{const le=Ee(U.custo_total),Ne=Ee(U.valor_total),Re=Ee(U.quantidade)||1,q=Ne-le,ne=le>0?q/le*100:0;return{nome:U.nome||U.produto||"Produto sem nome",marca:U.marca||"-",quantidade:Re,custo:Ee(le/Re),preco:Ee(Ne/Re),lucro_total:Ee(q),margem:Ee(ne),categoria:U.categoria||"Sem Categoria"}}),X=T.sort((U,le)=>le.lucro_total-U.lucro_total).slice(0,20);se(X);const fe={};T.forEach(U=>{const le=U.categoria||"Sem Categoria";fe[le]||(fe[le]={quantidade:0,total:0,margens:[]}),fe[le].quantidade+=U.quantidade,fe[le].total+=U.preco*U.quantidade,fe[le].margens.push(U.margem)}),Object.keys(fe).forEach(U=>{const le=fe[U].margens,Ne=le.reduce((Re,q)=>Ee(Re)+Ee(q),0);fe[U].margem_media=Ee(le.length>0?Ne/le.length:0),delete fe[U].margens}),ke(fe)};return a.useEffect(()=>{t==="analise"&&Me()},[Ye,t]),a.useEffect(()=>{je()},[o,r,y,m,t]),a.useEffect(()=>{Be("este_mes")},[]),s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"mb-6 bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Consulta de Vendas"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:ye,disabled:!o||!r,title:o&&r?`Exportar PDF de ${he(o)} at√© ${he(r)}`:"Selecione um per√≠odo",className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:[e.jsx(Xa,{className:"w-4 h-4"}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:"Exportar PDF"}),o&&r&&e.jsxs("span",{className:"text-xs opacity-90",children:["(",he(o)," - ",he(r),")"]})]})]}),e.jsxs("button",{onClick:Ce,disabled:!o||!r,title:o&&r?`Exportar dados de ${he(o)} at√© ${he(r)}`:"Selecione um per√≠odo",className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:[e.jsx(kt,{className:"w-4 h-4"}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:"Exportar Excel"}),o&&r&&e.jsxs("span",{className:"text-xs opacity-90",children:["(",he(o)," - ",he(r),")"]})]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:T=>c(T.target.checked),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Comparar com:"})]}),y&&e.jsxs("select",{value:m,onChange:T=>k(T.target.value),className:"border rounded px-3 py-2 text-sm bg-blue-50 font-medium",children:[e.jsx("option",{value:"periodo_anterior",children:"Per√≠odo imediatamente anterior (mesmo n¬∫ de dias)"}),e.jsx("option",{value:"mes_anterior",children:"Mesmo per√≠odo do m√™s passado"}),e.jsx("option",{value:"ano_anterior",children:"Mesmo per√≠odo do ano passado"})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:[{id:"hoje",label:"Hoje"},{id:"ontem",label:"Ontem"},{id:"esta_semana",label:"Esta semana"},{id:"este_mes",label:"Este m√™s"},{id:"mes_anterior",label:"M√™s anterior"},{id:"ultimos_7_dias",label:"√öltimos 7 dias"},{id:"ultimos_30_dias",label:"√öltimos 30 dias"},{id:"este_ano",label:"Este ano"},{id:"personalizado",label:"Personalizado"}].map(T=>e.jsx("button",{onClick:()=>{T.id==="personalizado"?f("personalizado"):Be(T.id)},className:`px-3 py-1 rounded text-sm font-medium transition-colors ${j===T.id?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:T.label},T.id))}),j==="personalizado"&&e.jsxs("div",{className:"flex gap-2 items-center mb-4 p-3 bg-gray-50 rounded",children:[e.jsx(Cs,{className:"w-5 h-5 text-gray-500"}),e.jsx("input",{type:"date",value:o,onChange:T=>g(T.target.value),className:"border rounded px-3 py-2"}),e.jsx("span",{className:"text-gray-600",children:"at√©"}),e.jsx("input",{type:"date",value:r,onChange:T=>v(T.target.value),className:"border rounded px-3 py-2"})]}),e.jsxs("div",{className:"flex gap-2 items-center mb-4 p-3 bg-blue-50 rounded border border-blue-200",children:[e.jsx(St,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtros Avan√ßados:"}),e.jsxs("select",{value:w,onChange:T=>x(T.target.value),className:"border rounded px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Todos os funcion√°rios"}),L.map((T,X)=>e.jsx("option",{value:T.funcionario,children:T.funcionario},X))]}),e.jsxs("select",{value:b,onChange:T=>u(T.target.value),className:"border rounded px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Todas as formas"}),J.map((T,X)=>e.jsx("option",{value:T.forma_pagamento,children:T.forma_pagamento},X))]}),e.jsxs("select",{value:i,onChange:T=>p(T.target.value),className:"border rounded px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Todas as categorias"}),H.map((T,X)=>e.jsx("option",{value:T.categoria,children:T.categoria},X))]}),e.jsx("button",{onClick:()=>{x(""),u(""),p("")},className:"px-3 py-2 bg-gray-200 text-gray-700 rounded text-sm hover:bg-gray-300 transition-colors",children:"Limpar Filtros"}),e.jsxs("button",{onClick:()=>C(!l),className:"ml-auto px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(Ft,{className:"w-4 h-4"}),l?"Ocultar":"Mostrar"," Gr√°ficos"]})]}),e.jsxs("div",{className:"flex gap-2 border-b",children:[e.jsx("button",{onClick:()=>d("resumo"),className:`px-4 py-2 font-medium ${t==="resumo"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Resumo"}),e.jsx("button",{onClick:()=>d("produtos"),className:`px-4 py-2 font-medium ${t==="produtos"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Totais por produto/servi√ßo"}),e.jsx("button",{onClick:()=>d("lista"),className:`px-4 py-2 font-medium ${t==="lista"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Lista de Vendas"}),e.jsx("button",{onClick:()=>d("comparacao"),className:`px-4 py-2 font-medium ${t==="comparacao"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Compara√ß√£o de Per√≠odos"}),e.jsx("button",{onClick:()=>d("analise"),className:`px-4 py-2 font-medium ${t==="analise"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"An√°lise Inteligente"})]})]}),t==="resumo"&&e.jsxs("div",{children:[y&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold text-blue-800",children:"Modo Compara√ß√£o Ativo:"}),e.jsxs("span",{className:"text-blue-700 ml-2",children:["Comparando ",e.jsxs("span",{className:"font-medium",children:[he(o)," at√© ",he(r)]})," com ",e.jsx("span",{className:"font-medium",children:oe()})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-5 gap-4 mb-6",children:[e.jsx(la,{titulo:"Venda Bruta",valor:S.venda_bruta,icone:za,cor:"bg-green-500",valorAnterior:K.venda_bruta}),e.jsx(la,{titulo:"Taxa de Entrega",valor:S.taxa_entrega,icone:Za,cor:"bg-gray-400",valorAnterior:K.taxa_entrega}),e.jsx(la,{titulo:"Desconto",valor:S.desconto,icone:Ma,cor:"bg-yellow-500",valorAnterior:K.desconto}),e.jsx(la,{titulo:"Venda L√≠quida",valor:S.venda_liquida,icone:za,cor:"bg-blue-500",valorAnterior:K.venda_liquida}),e.jsx(la,{titulo:"Em Aberto",valor:S.em_aberto,icone:lt,cor:"bg-red-500",valorAnterior:K.em_aberto})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-orange-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:be(S.custo_total||0)}),e.jsx("div",{className:"text-sm",children:"Custo Total"})]}),e.jsxs("div",{className:"bg-purple-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:be(S.taxa_cartao_total||0)}),e.jsx("div",{className:"text-sm",children:"Taxas de Cart√£o"})]}),e.jsxs("div",{className:"bg-green-600 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:be(S.lucro_total||0)}),e.jsx("div",{className:"text-sm",children:"Lucro Total"})]}),e.jsxs("div",{className:"bg-teal-500 text-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"text-3xl font-bold",children:[S.margem_media||0,"%"]}),e.jsx("div",{className:"text-sm",children:"Margem M√©dia"})]})]}),l&&e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Vendas no Per√≠odo"}),e.jsx(qa,{width:"100%",height:300,children:e.jsxs(ct,{data:M,children:[e.jsx(Ba,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:"data",tickFormatter:T=>new Date(T).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})}),e.jsx(Ta,{tickFormatter:T=>`R$ ${(T/1e3).toFixed(0)}k`}),e.jsx(Aa,{formatter:T=>be(T),labelFormatter:T=>he(T)}),e.jsx(Va,{}),e.jsx(ls,{type:"monotone",dataKey:"valor_bruto",stroke:"#3B82F6",strokeWidth:2,name:"Venda Bruta"}),e.jsx(ls,{type:"monotone",dataKey:"valor_liquido",stroke:"#10B981",strokeWidth:2,name:"Venda L√≠quida"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Formas de Pagamento"}),e.jsx(qa,{width:"100%",height:350,children:e.jsxs(is,{data:ca,layout:"vertical",margin:{top:5,right:30,left:120,bottom:5},children:[e.jsx(Ba,{strokeDasharray:"3 3"}),e.jsx(Ua,{type:"number",tickFormatter:T=>be(T)}),e.jsx(Ta,{type:"category",dataKey:"forma_pagamento",width:110,style:{fontSize:"12px"}}),e.jsx(Aa,{formatter:(T,X,fe)=>{const U=ca.reduce((Ne,Re)=>Ne+Re.valor_total,0),le=(T/U*100).toFixed(1);return[`${be(T)} (${le}%)`,"Valor"]},contentStyle:{backgroundColor:"white",border:"1px solid #ccc",borderRadius:"4px",padding:"8px"}}),e.jsx(Ka,{dataKey:"valor_total",fill:"#3B82F6",radius:[0,8,8,0],label:{position:"right",formatter:T=>{const X=ca.reduce((U,le)=>U+le.valor_total,0);return`${(T/X*100).toFixed(1)}%`},style:{fontSize:"11px",fontWeight:"bold"}},children:ca.map((T,X)=>e.jsx(Xt,{fill:Xe[X%Xe.length]},`cell-${X}`))})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 col-span-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Top 10 Categorias de Produtos"}),e.jsx(qa,{width:"100%",height:300,children:e.jsxs(is,{data:pa.slice(0,10),children:[e.jsx(Ba,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:"categoria"}),e.jsx(Ta,{tickFormatter:T=>`R$ ${(T/1e3).toFixed(0)}k`}),e.jsx(Aa,{formatter:T=>be(T)}),e.jsx(Va,{}),e.jsx(Ka,{dataKey:"total_liquido",fill:"#3B82F6",name:"Valor L√≠quido"})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Vendas por data"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Data"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Tkt. M√©dio"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Taxa entrega"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"(%)"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. l√≠quido"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. recebido"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo aberto"})]})}),e.jsxs("tbody",{children:[M.map((T,X)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:he(T.data)}),e.jsx("td",{className:"px-4 py-2 text-right",children:T.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.ticket_medio)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.taxa_entrega)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.desconto)}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[T.percentual_desconto,"%"]}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.valor_liquido)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.valor_recebido)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.saldo_aberto)})]},X)),M.length>0&&(()=>{const T=M.reduce((Ne,Re)=>Ne+Re.quantidade,0),X=M.reduce((Ne,Re)=>Ne+Re.valor_bruto,0),fe=M.reduce((Ne,Re)=>Ne+Re.desconto,0),U=T>0?X/T:0,le=X>0?(fe/X*100).toFixed(1):0;return e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:T}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(U)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(X)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(M.reduce((Ne,Re)=>Ne+Re.taxa_entrega,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(fe)}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[le,"%"]}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(M.reduce((Ne,Re)=>Ne+Re.valor_liquido,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(M.reduce((Ne,Re)=>Ne+Re.valor_recebido,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(M.reduce((Ne,Re)=>Ne+Re.saldo_aberto,0))})]})})()]})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Formas de recebimento"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Forma"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Valor pago"})]})}),e.jsxs("tbody",{children:[J.map((T,X)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:T.forma_pagamento}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.valor_total)})]},X)),J.length>0&&e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(J.reduce((T,X)=>T+X.valor_total,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Funcion√°rio"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nome"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. l√≠quido"})]})}),e.jsxs("tbody",{children:[ra.map((T,X)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:T.funcionario}),e.jsx("td",{className:"px-4 py-2 text-right",children:T.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.valor_liquido)})]},X)),ra.length>0&&e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:ra.reduce((T,X)=>T+X.quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(ra.reduce((T,X)=>T+X.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(ra.reduce((T,X)=>T+X.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(ra.reduce((T,X)=>T+X.valor_liquido,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Tipo"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Tipo"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. l√≠quido"})]})}),e.jsxs("tbody",{children:[A.map((T,X)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:T.tipo}),e.jsx("td",{className:"px-4 py-2 text-right",children:T.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.valor_liquido)})]},X)),A.length>0&&e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:A.reduce((T,X)=>T+X.quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(A.reduce((T,X)=>T+X.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(A.reduce((T,X)=>T+X.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(A.reduce((T,X)=>T+X.valor_liquido,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Grupo de produto"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nome"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Percentual"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. l√≠quido"})]})}),e.jsxs("tbody",{children:[E.map((T,X)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:T.grupo}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[T.percentual,"%"]}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.valor_liquido)})]},X)),E.length>0&&e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(E.reduce((T,X)=>T+X.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(E.reduce((T,X)=>T+X.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(E.reduce((T,X)=>T+X.valor_liquido,0))})]})]})]})]})]})]}),t==="produtos"&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Produtos/Servi√ßos"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Produtos/Servi√ßos"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Itens"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"L√≠quido"})]})}),e.jsxs("tbody",{children:[pa.map((T,X)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"bg-blue-50 font-semibold",children:[e.jsx("td",{className:"px-4 py-2",children:T.categoria}),e.jsx("td",{className:"px-4 py-2 text-right",children:T.total_quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.total_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.total_desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(T.total_liquido)})]},`cat-${X}`),T.subcategorias&&T.subcategorias.map((fe,U)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"bg-gray-50 font-medium",children:[e.jsx("td",{className:"px-4 py-2 pl-8",children:fe.subcategoria}),e.jsx("td",{className:"px-4 py-2 text-right",children:fe.total_quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(fe.total_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(fe.total_desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(fe.total_liquido)})]},`sub-${X}-${U}`),fe.produtos&&fe.produtos.map((le,Ne)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 pl-12 text-gray-700",children:le.produto}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:le.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(le.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(le.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(le.valor_liquido)})]},`prod-${X}-${U}-${Ne}`))]})),T.produtos&&T.produtos.map((fe,U)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 pl-8 text-gray-700",children:fe.produto}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:fe.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(fe.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(fe.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(fe.valor_liquido)})]},`prod-${X}-${U}`))]})),H.length>0&&e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL GERAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:H.reduce((T,X)=>T+X.total_quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(H.reduce((T,X)=>T+X.total_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(H.reduce((T,X)=>T+X.total_desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(H.reduce((T,X)=>T+X.total_liquido,0))})]})]})]})})]}),t==="lista"&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Lista de Vendas com An√°lise de Rentabilidade"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left w-8"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Data"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"C√≥digo"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Cliente"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Venda Bruta"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Taxa Entrega"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Taxa Operac."}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Taxa Cart√£o"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Comiss√£o"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Imposto"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Custo"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"L√≠quida"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Lucro"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"MG Venda"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"MG Custo"}),e.jsx("th",{className:"px-2 py-2 text-center",children:"Status"})]})}),e.jsx("tbody",{children:N.map(T=>e.jsxs(ts.Fragment,{children:[e.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>Qe(T.id),children:[e.jsx("td",{className:"px-2 py-2",children:z.has(T.id)?e.jsx(Ls,{className:"w-4 h-4 text-gray-600"}):e.jsx(st,{className:"w-4 h-4 text-gray-600"})}),e.jsx("td",{className:"px-2 py-2 whitespace-nowrap",children:he(T.data_venda)}),e.jsx("td",{className:"px-2 py-2",children:T.numero_venda}),e.jsx("td",{className:"px-2 py-2",children:T.cliente_nome}),e.jsx("td",{className:"px-2 py-2 text-right font-medium",children:be(T.venda_bruta)}),e.jsxs("td",{className:"px-2 py-2 text-right text-red-600",children:["-",be(T.desconto)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-blue-600",title:"Comiss√£o repassada ao entregador",children:["-",be(T.taxa_entrega)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-orange-500",title:"Custo operacional da entrega (empresa)",children:["-",be(T.taxa_operacional||0)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-purple-600",children:["-",be(T.taxa_cartao)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-blue-600",children:["-",be(T.comissao)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-pink-600",title:"Impostos sobre faturamento",children:["-",be(T.imposto||0)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-orange-600",children:["-",be(T.custo_produtos)]}),e.jsx("td",{className:"px-2 py-2 text-right font-medium",children:be(T.venda_liquida)}),e.jsx("td",{className:`px-2 py-2 text-right font-bold ${T.lucro>=0?"text-green-600":"text-red-600"}`,children:be(T.lucro)}),e.jsxs("td",{className:"px-2 py-2 text-right",children:[T.margem_sobre_venda,"%"]}),e.jsxs("td",{className:"px-2 py-2 text-right",children:[T.margem_sobre_custo,"%"]}),e.jsx("td",{className:"px-2 py-2 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${T.status==="finalizada"?"bg-green-100 text-green-800":T.status==="baixa_parcial"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:T.status==="finalizada"?"Baixada":T.status==="baixa_parcial"?"Parcial":"Aberta"})})]}),z.has(T.id)&&T.itens&&T.itens.length>0&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"17",className:"px-4 py-3",children:e.jsxs("div",{className:"pl-8",children:[e.jsx("div",{className:"font-semibold text-gray-700 mb-2",children:"Produtos desta venda:"}),e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-blue-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1 text-left",children:"Produto"}),e.jsx("th",{className:"px-2 py-1 text-center",children:"Qtd"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Pre√ßo Unit."}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Venda Bruta"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Desconto"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Taxa Entr."}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Taxa Oper."}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Taxa Cart√£o"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Comiss√£o"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Imposto"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Custo Unit."}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Custo Total"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"L√≠quido"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Lucro"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"MG Venda"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"MG Custo"})]})}),e.jsx("tbody",{children:T.itens.map((X,fe)=>e.jsxs("tr",{className:"border-b border-blue-200 hover:bg-blue-100",children:[e.jsx("td",{className:"px-2 py-1",children:X.produto_nome}),e.jsx("td",{className:"px-2 py-1 text-center",children:X.quantidade}),e.jsx("td",{className:"px-2 py-1 text-right",children:be(X.preco_unitario)}),e.jsx("td",{className:"px-2 py-1 text-right font-medium",children:be(X.venda_bruta)}),e.jsxs("td",{className:"px-2 py-1 text-right text-red-600",children:["-",be(X.desconto)]}),e.jsxs("td",{className:"px-2 py-1 text-right text-blue-600",children:["-",be(X.taxa_entrega)]}),e.jsxs("td",{className:"px-2 py-1 text-right text-orange-500",children:["-",be(X.taxa_operacional||0)]}),e.jsxs("td",{className:"px-2 py-1 text-right text-purple-600",children:["-",be(X.taxa_cartao)]}),e.jsxs("td",{className:"px-2 py-1 text-right text-blue-600",children:["-",be(X.comissao)]}),e.jsxs("td",{className:"px-2 py-1 text-right text-pink-600",children:["-",be(X.imposto||0)]}),e.jsx("td",{className:"px-2 py-1 text-right text-orange-600",children:be(X.custo_unitario)}),e.jsxs("td",{className:"px-2 py-1 text-right text-orange-600 font-medium",children:["-",be(X.custo_total)]}),e.jsx("td",{className:"px-2 py-1 text-right font-medium",children:be(X.valor_liquido)}),e.jsx("td",{className:`px-2 py-1 text-right font-bold ${X.lucro>=0?"text-green-600":"text-red-600"} cursor-help`,title:`Lucro unit√°rio: ${be(X.lucro_unitario)}`,children:be(X.lucro)}),e.jsxs("td",{className:"px-2 py-1 text-right cursor-help",title:`Margem unit√°ria: ${X.margem_sobre_venda}%`,children:[X.margem_sobre_venda,"%"]}),e.jsxs("td",{className:"px-2 py-1 text-right cursor-help",title:`Markup unit√°rio: ${X.margem_sobre_custo}%`,children:[X.margem_sobre_custo,"%"]})]},fe))})]})]})})},`${T.id}-detalhes`)]},T.id))})]})})]}),t==="comparacao"&&e.jsxs("div",{children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Tipo de An√°lise:"}),e.jsxs("select",{value:h,onChange:T=>_(T.target.value),className:"border rounded px-4 py-2 text-sm bg-blue-50 font-medium min-w-[250px]",children:[e.jsx("option",{value:"financeiro",children:"üìä Compara√ß√£o Financeira"}),e.jsx("option",{value:"formas_pagamento",children:"üí≥ Por Forma de Pagamento"}),e.jsx("option",{value:"produtos",children:"üì¶ Por Grupo de Produtos"}),e.jsx("option",{value:"funcionarios",children:"üë• Por Funcion√°rio"})]}),e.jsxs("div",{className:"ml-auto text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Per√≠odo Atual:"})," ",he(o)," - ",he(r)]})]})}),h==="financeiro"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border-2 border-gray-300",children:[e.jsxs("div",{className:"bg-gray-500 text-white px-4 py-3 rounded-t-lg",children:[e.jsx("h3",{className:"font-bold text-lg",children:"üìÖ Per√≠odo Anterior"}),e.jsx("p",{className:"text-xs opacity-90 mt-1",children:oe()})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Quantidade de Vendas"}),e.jsx("div",{className:"text-2xl font-bold text-gray-700",children:K.quantidade_vendas||0})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Bruto"}),e.jsx("div",{className:"text-xl font-bold text-gray-700",children:be(K.venda_bruta)})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor L√≠quido"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:be(K.venda_liquida)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Recebido"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:be(K.venda_liquida-K.em_aberto||0)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border-2 border-blue-500",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-4 py-3 rounded-t-lg",children:[e.jsx("h3",{className:"font-bold text-lg",children:"üìÖ Per√≠odo Atual"}),e.jsxs("p",{className:"text-xs opacity-90 mt-1",children:[he(o)," - ",he(r)]})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Quantidade de Vendas"}),e.jsx("div",{className:"text-2xl font-bold text-gray-700",children:S.quantidade_vendas||0})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Bruto"}),e.jsx("div",{className:"text-xl font-bold text-gray-700",children:be(S.venda_bruta)})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor L√≠quido"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:be(S.venda_liquida)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Recebido"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:be(S.venda_liquida-S.em_aberto||0)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border-2 border-green-500",children:[e.jsxs("div",{className:"bg-green-600 text-white px-4 py-3 rounded-t-lg",children:[e.jsx("h3",{className:"font-bold text-lg",children:"üìà Diferen√ßa"}),e.jsx("p",{className:"text-xs opacity-90 mt-1",children:"Varia√ß√£o vs per√≠odo anterior"})]}),e.jsx("div",{className:"p-4 space-y-3",children:(()=>{const T=Y(S.quantidade_vendas,K.quantidade_vendas),X=Y(S.venda_bruta,K.venda_bruta),fe=Y(S.venda_liquida,K.venda_liquida),U=S.venda_liquida-S.em_aberto,le=K.venda_liquida-K.em_aberto,Ne=Y(U,le);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Qtd de Vendas"}),e.jsxs("div",{className:`text-2xl font-bold flex items-center gap-2 ${T.percentual>=0?"text-green-600":"text-red-600"}`,children:[T.percentual>=0?e.jsx(js,{className:"w-6 h-6"}):e.jsx(vs,{className:"w-6 h-6"}),Math.abs(T.percentual),"%"]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[T.valor>=0?"+":"",T.valor.toFixed(0)," vendas"]})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Bruto"}),e.jsxs("div",{className:`text-xl font-bold flex items-center gap-2 ${X.percentual>=0?"text-green-600":"text-red-600"}`,children:[X.percentual>=0?e.jsx(js,{className:"w-5 h-5"}):e.jsx(vs,{className:"w-5 h-5"}),Math.abs(X.percentual),"%"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:be(X.valor)})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor L√≠quido"}),e.jsxs("div",{className:`text-xl font-bold flex items-center gap-2 ${fe.percentual>=0?"text-green-600":"text-red-600"}`,children:[fe.percentual>=0?e.jsx(js,{className:"w-5 h-5"}):e.jsx(vs,{className:"w-5 h-5"}),Math.abs(fe.percentual),"%"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:be(fe.valor)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Recebido"}),e.jsxs("div",{className:`text-xl font-bold flex items-center gap-2 ${Ne.percentual>=0?"text-green-600":"text-red-600"}`,children:[Ne.percentual>=0?e.jsx(js,{className:"w-5 h-5"}):e.jsx(vs,{className:"w-5 h-5"}),Math.abs(Ne.percentual),"%"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:be(Ne.valor)})]})]})})()})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Compara√ß√£o Visual"}),e.jsx(qa,{width:"100%",height:300,children:e.jsxs(is,{data:[{nome:"Qtd Vendas",Anterior:K.quantidade_vendas||0,Atual:S.quantidade_vendas||0},{nome:"Vl. Bruto (mil)",Anterior:(K.venda_bruta||0)/1e3,Atual:(S.venda_bruta||0)/1e3},{nome:"Vl. L√≠quido (mil)",Anterior:(K.venda_liquida||0)/1e3,Atual:(S.venda_liquida||0)/1e3},{nome:"Vl. Recebido (mil)",Anterior:(K.venda_liquida-K.em_aberto||0)/1e3,Atual:(S.venda_liquida-S.em_aberto||0)/1e3}],children:[e.jsx(Ba,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:"nome"}),e.jsx(Ta,{}),e.jsx(Aa,{formatter:(T,X)=>[X.includes("mil")?`R$ ${T.toFixed(1)}k`:T.toFixed(0),X]}),e.jsx(Va,{}),e.jsx(Ka,{dataKey:"Anterior",fill:"#9CA3AF",name:"Per√≠odo Anterior"}),e.jsx(Ka,{dataKey:"Atual",fill:"#3B82F6",name:"Per√≠odo Atual"})]})})]})]}),h==="formas_pagamento"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Compara√ß√£o por Forma de Pagamento"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Forma de Pagamento"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Anterior"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Atual"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Diferen√ßa"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Varia√ß√£o %"})]})}),e.jsx("tbody",{children:J.map((T,X)=>{const fe=W.find(le=>le.forma_pagamento===T.forma_pagamento)||{valor_total:0},U=Y(T.valor_total,fe.valor_total);return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:T.forma_pagamento}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:be(fe.valor_total)}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:be(T.valor_total)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(U.valor)}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded font-medium ${U.percentual>=0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[U.percentual>=0?e.jsx(js,{className:"w-4 h-4"}):e.jsx(vs,{className:"w-4 h-4"}),Math.abs(U.percentual),"%"]})})]},X)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Compara√ß√£o Visual"}),e.jsx(qa,{width:"100%",height:350,children:e.jsxs(is,{data:J.map(T=>{var X;return{nome:T.forma_pagamento,Anterior:(((X=W.find(fe=>fe.forma_pagamento===T.forma_pagamento))==null?void 0:X.valor_total)||0)/1e3,Atual:T.valor_total/1e3}}),children:[e.jsx(Ba,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:"nome",angle:-15,textAnchor:"end",height:80}),e.jsx(Ta,{tickFormatter:T=>`R$ ${T.toFixed(0)}k`}),e.jsx(Aa,{formatter:T=>`R$ ${T.toFixed(1)}k`}),e.jsx(Va,{}),e.jsx(Ka,{dataKey:"Anterior",fill:"#9CA3AF",name:"Per√≠odo Anterior"}),e.jsx(Ka,{dataKey:"Atual",fill:"#10B981",name:"Per√≠odo Atual"})]})})]})]}),h==="produtos"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Compara√ß√£o por Grupo de Produtos"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Grupo"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Anterior"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Atual"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Diferen√ßa"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Varia√ß√£o %"})]})}),e.jsx("tbody",{children:E.map((T,X)=>{const fe=ee.find(le=>le.grupo===T.grupo)||{valor_liquido:0},U=Y(T.valor_liquido,fe.valor_liquido);return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:T.grupo}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:be(fe.valor_liquido)}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:be(T.valor_liquido)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(U.valor)}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded font-medium ${U.percentual>=0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[U.percentual>=0?e.jsx(js,{className:"w-4 h-4"}):e.jsx(vs,{className:"w-4 h-4"}),Math.abs(U.percentual),"%"]})})]},X)})})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Per√≠odo Anterior"}),e.jsx(qa,{width:"100%",height:300,children:e.jsxs(wr,{children:[e.jsx(Cr,{data:ee,dataKey:"valor_liquido",nameKey:"grupo",cx:"50%",cy:"50%",outerRadius:80,label:T=>{const X=(T.valor_liquido/ee.reduce((fe,U)=>fe+U.valor_liquido,0)*100).toFixed(1);return X>5?`${X}%`:""},children:ee.map((T,X)=>e.jsx(Xt,{fill:Xe[X%Xe.length]},`cell-${X}`))}),e.jsx(Aa,{formatter:T=>be(T)}),e.jsx(Va,{verticalAlign:"bottom",height:36})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Per√≠odo Atual"}),e.jsx(qa,{width:"100%",height:300,children:e.jsxs(wr,{children:[e.jsx(Cr,{data:E,dataKey:"valor_liquido",nameKey:"grupo",cx:"50%",cy:"50%",outerRadius:80,label:T=>{const X=(T.valor_liquido/E.reduce((fe,U)=>fe+U.valor_liquido,0)*100).toFixed(1);return X>5?`${X}%`:""},children:E.map((T,X)=>e.jsx(Xt,{fill:Xe[X%Xe.length]},`cell-${X}`))}),e.jsx(Aa,{formatter:T=>be(T)}),e.jsx(Va,{verticalAlign:"bottom",height:36})]})})]})]})]}),h==="funcionarios"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Compara√ß√£o por Funcion√°rio"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Funcion√°rio"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Qtd Ant."}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Qtd Atual"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Vl. Ant."}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Vl. Atual"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Varia√ß√£o"})]})}),e.jsx("tbody",{children:L.map((T,X)=>{const fe=de.find(le=>le.funcionario===T.funcionario)||{quantidade:0,valor_liquido:0},U=Y(T.valor_liquido,fe.valor_liquido);return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:T.funcionario}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:fe.quantidade}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:T.quantidade}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:be(fe.valor_liquido)}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:be(T.valor_liquido)}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded font-medium ${U.percentual>=0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[U.percentual>=0?e.jsx(js,{className:"w-4 h-4"}):e.jsx(vs,{className:"w-4 h-4"}),Math.abs(U.percentual),"%"]})})]},X)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Compara√ß√£o Visual - Valor L√≠quido"}),e.jsx(qa,{width:"100%",height:350,children:e.jsxs(is,{data:L.map(T=>{var X;return{nome:T.funcionario,Anterior:(((X=de.find(fe=>fe.funcionario===T.funcionario))==null?void 0:X.valor_liquido)||0)/1e3,Atual:T.valor_liquido/1e3}}),children:[e.jsx(Ba,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:"nome",angle:-15,textAnchor:"end",height:80}),e.jsx(Ta,{tickFormatter:T=>`R$ ${T.toFixed(0)}k`}),e.jsx(Aa,{formatter:T=>`R$ ${T.toFixed(1)}k`}),e.jsx(Va,{}),e.jsx(Ka,{dataKey:"Anterior",fill:"#9CA3AF",name:"Per√≠odo Anterior"}),e.jsx(Ka,{dataKey:"Atual",fill:"#8B5CF6",name:"Per√≠odo Atual"})]})})]})]})]}),t==="analise"&&e.jsxs("div",{className:"space-y-6",children:[s&&e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),!s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("h2",{className:"text-2xl font-bold",children:"An√°lise Inteligente de Produtos"})]}),e.jsx("p",{className:"text-blue-100",children:"Identifique os produtos mais lucrativos e oportunidades de melhoria no seu mix de produtos"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"üèÜ Top Produtos por Lucro"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"#"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Produto"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Marca"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Qtd"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Custo Unit."}),e.jsx("th",{className:"text-right py-2 px-2",children:"Pre√ßo Venda"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Margem %"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Lucro Total"})]})}),e.jsx("tbody",{children:Pe.map((T,X)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-2",children:e.jsx("span",{className:`inline-flex items-center justify-center w-7 h-7 rounded-full text-xs font-bold ${X===0?"bg-yellow-100 text-yellow-800":X===1?"bg-gray-100 text-gray-800":X===2?"bg-orange-100 text-orange-800":"bg-blue-50 text-blue-800"}`,children:X+1})}),e.jsx("td",{className:"py-3 px-2 font-medium",children:T.nome}),e.jsx("td",{className:"py-3 px-2 text-gray-600",children:T.marca||"-"}),e.jsx("td",{className:"py-3 px-2 text-right",children:Ee(T.quantidade)}),e.jsx("td",{className:"py-3 px-2 text-right text-red-600",children:be(Ee(T.custo))}),e.jsx("td",{className:"py-3 px-2 text-right text-green-600",children:be(Ee(T.preco))}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsxs("span",{className:`inline-block px-2 py-1 rounded text-xs font-semibold ${Ee(T.margem)>=50?"bg-green-100 text-green-800":Ee(T.margem)>=30?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[Ee(T.margem).toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 px-2 text-right font-bold text-green-600",children:be(Ee(T.lucro_total))})]},X))})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"üìä Desempenho por Categoria"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(_e).map(([T,X])=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"font-semibold text-gray-800 mb-2",children:T}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Vendas:"}),e.jsx("span",{className:"font-semibold",children:Ee(X.quantidade)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Faturamento:"}),e.jsx("span",{className:"font-semibold text-green-600",children:be(Ee(X.total))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Margem M√©dia:"}),e.jsxs("span",{className:`font-semibold ${Ee(X.margem_media)>=40?"text-green-600":Ee(X.margem_media)>=25?"text-yellow-600":"text-red-600"}`,children:[Ee(X.margem_media).toFixed(1),"%"]})]})]})]},T))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"‚ö†Ô∏è Aten√ß√£o: Margens Baixas"})]}),e.jsxs("div",{className:"space-y-2",children:[Pe.filter(T=>Ee(T.margem)<25).slice(0,5).map((T,X)=>e.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border-l-4 border-red-500",children:[e.jsx("div",{className:"font-medium text-sm",children:T.nome}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["Margem: ",e.jsxs("span",{className:"font-semibold text-red-600",children:[Ee(T.margem).toFixed(1),"%"]})," - ","Revisar pre√ßo de custo ou venda"]})]},X)),Pe.filter(T=>Ee(T.margem)<25).length===0&&e.jsx("div",{className:"text-center text-gray-500 py-4",children:"‚úÖ Nenhum produto com margem cr√≠tica"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"üí° Oportunidades"})]}),e.jsxs("div",{className:"space-y-3",children:[Pe.filter(T=>Ee(T.margem)>=40&&Ee(T.quantidade)<10).slice(0,3).map((T,X)=>e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx("div",{className:"font-medium text-sm",children:T.nome}),e.jsxs("div",{className:"text-xs text-blue-800 mt-1",children:[e.jsxs("strong",{children:["Alta margem (",Ee(T.margem).toFixed(1),"%)"]})," mas poucas vendas (",Ee(T.quantidade)," un.)",e.jsx("br",{}),"üí¨ Considere promover este produto"]})]},X)),Pe.filter(T=>Ee(T.margem)>=40).slice(0,2).map((T,X)=>e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border-l-4 border-green-500",children:[e.jsx("div",{className:"font-medium text-sm",children:T.nome}),e.jsxs("div",{className:"text-xs text-green-800 mt-1",children:[e.jsx("strong",{children:"‚≠ê Campe√£o de vendas"})," com excelente margem",e.jsx("br",{}),"üí¨ Mantenha em destaque"]})]},`camp-${X}`))]})]})]}),l&&Pe.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"üìà Margem vs Volume de Vendas"}),e.jsx(qa,{width:"100%",height:400,children:e.jsxs(is,{data:Pe.slice(0,15).map(T=>({...T,margem:Ee(T.margem),quantidade:Ee(T.quantidade)})),children:[e.jsx(Ba,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:"nome",angle:-45,textAnchor:"end",height:120,interval:0,tick:{fontSize:11}}),e.jsx(Ta,{yAxisId:"left",orientation:"left",stroke:"#10B981",label:{value:"Margem %",angle:-90,position:"insideLeft"}}),e.jsx(Ta,{yAxisId:"right",orientation:"right",stroke:"#3B82F6",label:{value:"Quantidade",angle:90,position:"insideRight"}}),e.jsx(Aa,{}),e.jsx(Va,{}),e.jsx(Ka,{yAxisId:"left",dataKey:"margem",fill:"#10B981",name:"Margem %"}),e.jsx(Ka,{yAxisId:"right",dataKey:"quantidade",fill:"#3B82F6",name:"Qtd Vendida"})]})})]})]})]}),"    "]})}const pd=()=>{const[s,n]=a.useState(!0),[t,d]=a.useState(!1),[o,g]=a.useState(null),[r,v]=a.useState([]),[j,f]=a.useState([]),[y,c]=a.useState([]),[m,k]=a.useState([]),[w,x]=a.useState({campo:null,direcao:"asc"}),[b,u]=a.useState({especies:[],linhas:[],portes:[],fases:[],tratamentos:[],sabores:[],pesos:[],marca_ids:[],categoria_ids:[],margem_min:null,margem_max:null,data_inicio:null,data_fim:null}),[i,p]=a.useState({marcas:[],categorias:[],especies:[],linhas:[],portes:[],fases:[],tratamentos:[],sabores:[],pesos:[]}),[l,C]=a.useState("porte"),[h,_]=a.useState(!0),[S,$]=a.useState("comparacao");a.useEffect(()=>{K()},[]);const K=async()=>{var W,ie,ee;try{n(!0);const Q=localStorage.getItem("access_token");console.log("üîê [DashboardAnaliseRacoes] Iniciando carregamento de dados",{hasToken:!!Q,tokenPreview:Q?`${Q.substring(0,20)}...`:"NO TOKEN"}),console.log("üì° [DashboardAnaliseRacoes] Chamando: /racoes/analises/opcoes-filtros");const de=await F.get("/racoes/analises/opcoes-filtros");console.log("‚úÖ [DashboardAnaliseRacoes] Op√ß√µes carregadas:",de.data),p(de.data),await re(),n(!1)}catch(Q){console.error("‚ùå [DashboardAnaliseRacoes] Erro ao carregar dados:",{message:Q.message,status:(W=Q.response)==null?void 0:W.status,data:(ie=Q.response)==null?void 0:ie.data,config:Q.config}),((ee=Q.response)==null?void 0:ee.status)===403?ce.error("Acesso negado. Verifique suas permiss√µes ou fa√ßa login novamente."):ce.error("Erro ao carregar dados do dashboard"),n(!1)}},re=async(W=null,ie=null)=>{try{const ee={};W&&(ee.data_inicio=W),ie&&(ee.data_fim=ie);const Q=await F.get("/racoes/analises/resumo",{params:ee});g(Q.data)}catch(ee){console.error("Erro ao carregar resumo:",ee),ce.error("Erro ao carregar resumo")}},M=async()=>{try{d(!0);const W=await F.post(`/racoes/analises/margem-por-segmento?tipo_segmento=${l}`,b);v(W.data),d(!1)}catch(W){console.error("Erro ao carregar an√°lise:",W),ce.error("Erro ao carregar an√°lise de segmento"),d(!1)}},R=async()=>{try{d(!0);const W=await F.post("/racoes/analises/comparacao-marcas",b);f(W.data),d(!1)}catch(W){console.error("Erro ao carregar compara√ß√£o:",W),ce.error("Erro ao carregar compara√ß√£o de marcas"),d(!1)}},J=async()=>{try{if(!b.data_inicio||!b.data_fim){ce.error("Selecione um per√≠odo para ver o ranking de vendas");return}d(!0);const W=await F.get("/racoes/analises/ranking-vendas",{params:{data_inicio:b.data_inicio,data_fim:b.data_fim,limite:20}});c(W.data),d(!1)}catch(W){console.error("Erro ao carregar ranking:",W),ce.error("Erro ao carregar ranking de vendas"),d(!1)}},te=async()=>{try{d(!0);const W=await F.post("/racoes/analises/produtos-comparacao",b);k(W.data),x({campo:null,direcao:"asc"}),d(!1)}catch(W){console.error("Erro ao carregar produtos para compara√ß√£o:",W),ce.error("Erro ao carregar produtos"),d(!1)}},L=W=>{const ie=w.campo===W&&w.direcao==="asc"?"desc":"asc";x({campo:W,direcao:ie});const ee=[...m].sort((Q,de)=>{let me,Pe;switch(W){case"nome":me=Q.nome,Pe=de.nome;break;case"custo":me=Q.preco_custo||0,Pe=de.preco_custo||0;break;case"venda":me=Q.preco_venda||0,Pe=de.preco_venda||0;break;case"lucro":me=(Q.preco_venda||0)-(Q.preco_custo||0),Pe=(de.preco_venda||0)-(de.preco_custo||0);break;case"margem":me=calcularMargem(Q.preco_custo,Q.preco_venda),Pe=calcularMargem(de.preco_custo,de.preco_venda);break;case"roi":me=calcularROI(Q.preco_custo,Q.preco_venda),Pe=calcularROI(de.preco_custo,de.preco_venda);break;case"custokg":me=(Q.preco_custo||0)/(Q.peso_embalagem||1),Pe=(de.preco_custo||0)/(de.peso_embalagem||1);break;case"vendakg":me=(Q.preco_venda||0)/(Q.peso_embalagem||1),Pe=(de.preco_venda||0)/(de.peso_embalagem||1);break;default:return 0}return typeof me=="string"?ie==="asc"?me.localeCompare(Pe):Pe.localeCompare(me):ie==="asc"?me-Pe:Pe-me});k(ee)},Z=(W,ie)=>{u(ee=>({...ee,[W]:ie}))},A=(W,ie)=>{u(ee=>{const Q=ee[W]||[],de=Q.includes(ie);return{...ee,[W]:de?Q.filter(me=>me!==ie):[...Q,ie]}})},G=()=>{S==="segmento"?M():S==="marcas"?R():S==="ranking"?J():S==="comparacao"&&te(),b.data_inicio&&b.data_fim&&re(b.data_inicio,b.data_fim)},E=()=>{u({especies:[],linhas:[],portes:[],fases:[],tratamentos:[],sabores:[],pesos:[],marca_ids:[],categoria_ids:[],margem_min:null,margem_max:null,data_inicio:null,data_fim:null})},P=W=>{$(W),W==="segmento"&&r.length===0?M():W==="marcas"&&j.length===0?R():W==="ranking"&&y.length===0?b.data_inicio&&b.data_fim&&J():W==="comparacao"&&m.length===0&&te()},H=()=>o?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Za,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ra√ß√µes Cadastradas"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:o.total_racoes}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[o.total_classificadas," classificadas (",o.percentual_classificadas,"%)"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(en,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Margem M√©dia"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[o.margem_media_geral,"%"]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["em ",o.total_racoes," produtos"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(za,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Faturamento Per√≠odo"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",o.faturamento_periodo.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[o.marcas_cadastradas," marcas ativas"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Hn,{className:"h-5 w-5 text-purple-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Mais Vendido"})]}),o.produto_mais_vendido?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 truncate",children:o.produto_mais_vendido.nome}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[o.produto_mais_vendido.quantidade," unidades"]})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Sem dados de vendas"})]})]}):null,B=()=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(St,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Filtros"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:"Clique para selecionar/desmarcar"})]}),e.jsx("button",{onClick:()=>_(!h),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:h?"Ocultar ‚ñ≤":"Mostrar ‚ñº"})]}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Marcas"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.marcas.map(W=>e.jsx("button",{onClick:()=>A("marca_ids",W.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${b.marca_ids.includes(W.id)?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:W.nome},W.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Linha de Ra√ß√£o"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.linhas.map(W=>e.jsx("button",{onClick:()=>A("linhas",W.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${b.linhas.includes(W.id)?"bg-purple-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:W.nome},W.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Porte do Animal"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.portes.map(W=>e.jsx("button",{onClick:()=>A("portes",W.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${b.portes.includes(W.id)?"bg-green-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:W.nome},W.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Fase/P√∫blico"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.fases.map(W=>e.jsx("button",{onClick:()=>A("fases",W.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${b.fases.includes(W.id)?"bg-amber-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:W.nome},W.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Sabor/Prote√≠na"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.sabores.map(W=>e.jsx("button",{onClick:()=>A("sabores",W),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${b.sabores.includes(W)?"bg-pink-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:W},W))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Peso da Embalagem"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.pesos.map(W=>e.jsxs("button",{onClick:()=>A("pesos",W),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${b.pesos.includes(W)?"bg-indigo-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[W," kg"]},W))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Margem M√≠nima (%)"}),e.jsx("input",{type:"number",step:"0.01",value:b.margem_min||"",onChange:W=>Z("margem_min",parseFloat(W.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"Ex: 25"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Margem M√°xima (%)"}),e.jsx("input",{type:"number",step:"0.01",value:b.margem_max||"",onChange:W=>Z("margem_max",parseFloat(W.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"Ex: 50"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data In√≠cio"}),e.jsx("input",{type:"date",value:b.data_inicio||"",onChange:W=>Z("data_inicio",W.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:b.data_fim||"",onChange:W=>Z("data_fim",W.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsxs("button",{onClick:G,className:"px-6 py-2.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2 font-medium",children:[e.jsx(St,{className:"h-4 w-4"}),"Aplicar Filtros"]}),e.jsx("button",{onClick:E,className:"px-6 py-2.5 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 font-medium",children:"Limpar Tudo"}),b.marca_ids.length+b.linhas.length+b.portes.length+b.fases.length+b.sabores.length+b.pesos.length>0&&e.jsxs("div",{className:"flex items-center gap-2 ml-auto text-sm text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:b.marca_ids.length+b.linhas.length+b.portes.length+b.fases.length+b.sabores.length+b.pesos.length}),"filtros ativos"]})]})]})]}),N=()=>t?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando an√°lise..."}):r.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(da,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),'Nenhum dado encontrado. Aplique filtros e clique em "Aplicar Filtros"']}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Analisar por:"}),e.jsxs("select",{value:l,onChange:W=>{C(W.target.value),setTimeout(()=>M(),0)},className:"px-3 py-1.5 border border-gray-300 rounded-md text-sm",children:[e.jsx("option",{value:"porte",children:"Porte"}),e.jsx("option",{value:"fase",children:"Fase"}),e.jsx("option",{value:"sabor",children:"Sabor"}),e.jsx("option",{value:"linha",children:"Linha"}),e.jsx("option",{value:"especie",children:"Esp√©cie"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Segmento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Produtos"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Margem M√©dia"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Margem Min/Max"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Pre√ßo/Kg M√©dio"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Faturamento"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:r.map((W,ie)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900",children:W.segmento}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:W.total_produtos}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("span",{className:`font-semibold ${W.margem_media>=30?"text-green-600":W.margem_media>=20?"text-yellow-600":"text-red-600"}`,children:[W.margem_media,"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:[W.margem_minima,"% - ",W.margem_maxima,"%"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:["R$ ",W.preco_medio_kg.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center font-semibold text-gray-900",children:["R$ ",W.faturamento.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]},ie))})]})})]}),O=()=>t?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando compara√ß√£o..."}):j.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(da,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),'Nenhum dado encontrado. Aplique filtros e clique em "Aplicar Filtros"']}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Marca"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Produtos"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Pre√ßo/Kg M√©dio"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Margem M√©dia"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Mais Barato"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Mais Caro"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:j.map(W=>{var ie,ee,Q,de,me,Pe;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900",children:W.marca_nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:W.total_produtos}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center font-semibold text-gray-900",children:["R$ ",W.preco_medio_kg.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("span",{className:`font-semibold ${W.margem_media>=30?"text-green-600":W.margem_media>=20?"text-yellow-600":"text-red-600"}`,children:[W.margem_media,"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-xs text-gray-700",children:[((ee=(ie=W.produto_mais_barato)==null?void 0:ie.nome)==null?void 0:ee.substring(0,30))||"-",((Q=W.produto_mais_barato)==null?void 0:Q.preco_kg)&&e.jsxs("div",{className:"text-green-600 font-semibold",children:["R$ ",W.produto_mais_barato.preco_kg,"/kg"]})]}),e.jsxs("td",{className:"px-4 py-3 text-xs text-gray-700",children:[((me=(de=W.produto_mais_caro)==null?void 0:de.nome)==null?void 0:me.substring(0,30))||"-",((Pe=W.produto_mais_caro)==null?void 0:Pe.preco_kg)&&e.jsxs("div",{className:"text-red-600 font-semibold",children:["R$ ",W.produto_mais_caro.preco_kg,"/kg"]})]})]},W.marca_id)})})]})}),z=()=>t?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando ranking..."}):y.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(da,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),'Selecione um per√≠odo nos filtros e clique em "Aplicar Filtros"']}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Marca"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Qtd Vendida"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Faturamento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Margem M√©dia"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Pre√ßo M√©dio"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:y.map((W,ie)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold ${ie===0?"bg-yellow-100 text-yellow-700":ie===1?"bg-gray-200 text-gray-700":ie===2?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-600"}`,children:ie+1})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:W.nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:W.marca}),e.jsx("td",{className:"px-4 py-3 text-sm text-center font-semibold text-gray-900",children:W.quantidade_vendida}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center font-semibold text-green-600",children:["R$ ",W.faturamento.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("span",{className:`font-semibold ${W.margem_media>=30?"text-green-600":W.margem_media>=20?"text-yellow-600":"text-red-600"}`,children:[W.margem_media,"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center text-gray-900",children:["R$ ",W.preco_medio_venda.toFixed(2)]})]},W.produto_id))})]})}),ae=()=>{if(t)return e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx($a,{className:"h-8 w-8 animate-spin text-blue-500 mr-3"}),e.jsx("span",{className:"text-gray-600",children:"Carregando produtos..."})]});if(m.length===0)return e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(da,{className:"h-16 w-16 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Nenhum produto encontrado"}),e.jsx("p",{className:"text-sm",children:'Selecione filtros acima e clique em "Aplicar Filtros"'})]});const W=(he,Xe)=>!Xe||Xe===0?0:parseFloat(((Xe-he)/Xe*100).toFixed(2)),ie=(he,Xe)=>!he||he===0?0:parseFloat(((Xe-he)/he*100).toFixed(2)),ee=(he,Xe)=>parseFloat((Xe-he).toFixed(2)),Q=(he,Xe)=>!he||he===0?0:parseFloat(((Xe-he)/he*100).toFixed(2)),de=m.map(he=>he.preco_custo||0),me=m.map(he=>W(he.preco_custo,he.preco_venda)),Pe=m.map(he=>ee(he.preco_custo||0,he.preco_venda||0)),se=m.map(he=>Q(he.preco_custo,he.preco_venda)),_e=Math.min(...de.filter(he=>he>0)),ke=Math.max(...me),Ye=Math.max(...Pe),ze=Math.max(...se),Qe=(he,Xe,Je,ca=!1)=>{if(Je===Xe)return"bg-gray-50";const ra=(he-Xe)/(Je-Xe)*100;return ca?ra<=20?"bg-green-50 text-green-800 font-semibold":ra<=40?"bg-green-50 text-green-700":ra<=60?"bg-yellow-50 text-yellow-700":ra<=80?"bg-orange-50 text-orange-700":"bg-red-50 text-red-700":ra>=80?"bg-green-50 text-green-800 font-semibold":ra>=60?"bg-green-50 text-green-700":ra>=40?"bg-yellow-50 text-yellow-700":ra>=20?"bg-orange-50 text-orange-700":"bg-red-50 text-red-700"},be=he=>he>=40?"text-green-700 bg-green-100 border-green-300":he>=30?"text-green-600 bg-green-50 border-green-200":he>=20?"text-yellow-600 bg-yellow-50 border-yellow-200":he>=10?"text-orange-600 bg-orange-50 border-orange-200":"text-red-600 bg-red-50 border-red-200",Ee=({campo:he,children:Xe,className:Je=""})=>e.jsx("th",{onClick:()=>L(he),className:`px-3 py-3 text-xs font-bold text-gray-700 uppercase cursor-pointer hover:bg-gray-200 transition-colors ${Je}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[Xe,w.campo===he&&e.jsx("span",{className:"text-blue-600",children:w.direcao==="asc"?"‚ñ≤":"‚ñº"})]})});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4 border-2 border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:"üí∞"}),e.jsx("span",{className:"text-xs font-semibold text-green-700 uppercase",children:"Menor Custo"})]}),e.jsxs("p",{className:"text-2xl font-bold text-green-900",children:["R$ ",_e.toFixed(2)]}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Melhor pre√ßo de compra"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border-2 border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:"‚≠ê"}),e.jsx("span",{className:"text-xs font-semibold text-blue-700 uppercase",children:"Melhor Margem"})]}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[ke.toFixed(2),"%"]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Maior percentual de lucro"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4 border-2 border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:"üéØ"}),e.jsx("span",{className:"text-xs font-semibold text-purple-700 uppercase",children:"Melhor ROI"})]}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900",children:[ze.toFixed(2),"%"]}),e.jsx("p",{className:"text-xs text-purple-600 mt-1",children:"Retorno sobre investimento"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 rounded-lg p-4 border-2 border-amber-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:"üíµ"}),e.jsx("span",{className:"text-xs font-semibold text-amber-700 uppercase",children:"Maior Lucro"})]}),e.jsxs("p",{className:"text-2xl font-bold text-amber-900",children:["R$ ",Ye.toFixed(2)]}),e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"Lucro absoluto por unidade"})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total de Produtos Encontrados"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:m.length})]}),m.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Margem M√©dia"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[(me.reduce((he,Xe)=>he+Xe,0)/me.length).toFixed(2),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Custo M√©dio/kg"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["R$ ",(m.reduce((he,Xe)=>he+(Xe.preco_custo||0)/(Xe.peso_embalagem||1),0)/m.length).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Pre√ßo Venda M√©dio/kg"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["R$ ",(m.reduce((he,Xe)=>he+(Xe.preco_venda||0)/(Xe.peso_embalagem||1),0)/m.length).toFixed(2)]})]})]})]})}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-start gap-2",children:[e.jsx(da,{className:"h-5 w-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("strong",{children:"üí° Dica:"})," Clique nos cabe√ßalhos das colunas para ordenar. As cores indicam valores melhores (verde) e piores (vermelho). Produtos destacados com badges s√£o os melhores em cada categoria."]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border-2 border-gray-300 shadow-lg",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{className:"bg-gradient-to-r from-gray-100 to-gray-200 border-b-2 border-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase sticky left-0 bg-gray-100 border-r border-gray-300",children:"Produto / Marca"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-gray-700 uppercase border-r border-gray-300",children:"Linha"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-gray-700 uppercase border-r border-gray-300",children:"Peso"}),e.jsx(Ee,{campo:"custo",className:"border-r border-gray-300",children:"üí∞ Custo"}),e.jsx(Ee,{campo:"venda",className:"border-r border-gray-300",children:"üíµ Venda"}),e.jsx(Ee,{campo:"lucro",className:"border-r border-gray-300",children:"Lucro R$"}),e.jsx(Ee,{campo:"margem",className:"border-r border-gray-300",children:"üìä Margem %"}),e.jsx(Ee,{campo:"roi",className:"border-r border-gray-300",children:"üéØ ROI %"}),e.jsx(Ee,{campo:"custokg",className:"border-r border-gray-300",children:"Custo/kg"}),e.jsx(Ee,{campo:"vendakg",className:"border-r border-gray-300",children:"Venda/kg"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-gray-700 uppercase",children:"Estoque"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:m.map(he=>{var Ie;const Xe=W(he.preco_custo,he.preco_venda);ie(he.preco_custo,he.preco_venda);const Je=ee(he.preco_custo||0,he.preco_venda||0),ca=Q(he.preco_custo,he.preco_venda),ra=(he.preco_custo||0)/(he.peso_embalagem||1),pa=(he.preco_venda||0)/(he.peso_embalagem||1),la=(he.preco_custo||0)===_e&&_e>0,oe=Xe===ke&&ke>0,ye=Je===Ye&&Ye>0,Ce=ca===ze&&ze>0,Be=la||oe||ye||Ce;return e.jsxs("tr",{className:`hover:bg-blue-50 transition-colors ${Be?"bg-yellow-50 border-l-4 border-yellow-400":""}`,children:[e.jsx("td",{className:"px-4 py-3 sticky left-0 bg-white border-r border-gray-200",children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm",children:he.nome}),e.jsxs("p",{className:"text-xs text-gray-600 mt-0.5",children:[((Ie=he.marca)==null?void 0:Ie.nome)||"Sem marca"," ‚Ä¢ C√≥d: ",he.codigo]}),e.jsxs("div",{className:"flex gap-1 mt-1.5 flex-wrap",children:[he.porte_animal&&Array.isArray(he.porte_animal)&&he.porte_animal.map(Y=>e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-1.5 py-0.5 rounded",children:Y},Y)),he.fase_publico&&Array.isArray(he.fase_publico)&&he.fase_publico.map(Y=>e.jsx("span",{className:"text-xs bg-amber-100 text-amber-700 px-1.5 py-0.5 rounded",children:Y},Y)),he.sabor_proteina&&e.jsx("span",{className:"text-xs bg-pink-100 text-pink-700 px-1.5 py-0.5 rounded",children:he.sabor_proteina})]}),e.jsxs("div",{className:"flex gap-1 mt-2 flex-wrap",children:[la&&e.jsx("span",{className:"text-xs bg-green-600 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:"üí∞ MENOR CUSTO"}),oe&&e.jsx("span",{className:"text-xs bg-blue-600 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:"‚≠ê MELHOR MARGEM"}),Ce&&e.jsx("span",{className:"text-xs bg-purple-600 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:"üéØ MELHOR ROI"}),ye&&e.jsx("span",{className:"text-xs bg-amber-600 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:"üíµ MAIOR LUCRO"})]})]})}),e.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-700 border-r border-gray-200",children:e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-medium",children:he.classificacao_racao||"-"})}),e.jsx("td",{className:"px-3 py-3 text-sm text-center font-medium text-gray-900 border-r border-gray-200",children:he.peso_embalagem?e.jsxs("span",{className:"px-2 py-1 bg-gray-100 rounded font-bold",children:[he.peso_embalagem," kg"]}):"-"}),e.jsxs("td",{className:`px-3 py-3 text-sm text-center font-bold border-r border-gray-200 ${Qe(he.preco_custo||0,_e,Math.max(...de),!0)}`,children:["R$ ",(he.preco_custo||0).toFixed(2)]}),e.jsxs("td",{className:`px-3 py-3 text-sm text-center font-bold border-r border-gray-200 ${Qe(he.preco_venda||0,Math.min(...m.map(Y=>Y.preco_venda||0)),Math.max(...m.map(Y=>Y.preco_venda||0)))}`,children:["R$ ",(he.preco_venda||0).toFixed(2)]}),e.jsxs("td",{className:`px-3 py-3 text-sm text-center font-bold border-r border-gray-200 ${Qe(Je,Math.min(...Pe),Math.max(...Pe))}`,children:["R$ ",Je.toFixed(2)]}),e.jsx("td",{className:"px-3 py-3 text-center border-r border-gray-200",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsxs("span",{className:`px-3 py-1.5 rounded-lg font-bold text-sm border-2 ${be(Xe)}`,children:[Xe.toFixed(2),"%"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${Xe>=40?"bg-green-500":Xe>=30?"bg-green-400":Xe>=20?"bg-yellow-400":Xe>=10?"bg-orange-400":"bg-red-400"}`,style:{width:`${Math.min(Xe,100)}%`}})})]})}),e.jsxs("td",{className:`px-3 py-3 text-sm text-center font-bold border-r border-gray-200 ${Qe(ca,Math.min(...se),Math.max(...se))}`,children:[ca.toFixed(2),"%"]}),e.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-700 border-r border-gray-200",children:e.jsxs("span",{className:`px-2 py-1 rounded font-semibold ${Qe(ra,Math.min(...m.map(Y=>(Y.preco_custo||0)/(Y.peso_embalagem||1))),Math.max(...m.map(Y=>(Y.preco_custo||0)/(Y.peso_embalagem||1))),!0)}`,children:["R$ ",ra.toFixed(2)]})}),e.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-700 border-r border-gray-200",children:e.jsxs("span",{className:`px-2 py-1 rounded font-semibold ${Qe(pa,Math.min(...m.map(Y=>(Y.preco_venda||0)/(Y.peso_embalagem||1))),Math.max(...m.map(Y=>(Y.preco_venda||0)/(Y.peso_embalagem||1))))}`,children:["R$ ",pa.toFixed(2)]})}),e.jsx("td",{className:"px-3 py-3 text-sm text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${(he.estoque_atual||0)>10?"bg-green-100 text-green-700 border border-green-300":(he.estoque_atual||0)>0?"bg-yellow-100 text-yellow-700 border border-yellow-300":"bg-red-100 text-red-700 border border-red-300"}`,children:he.estoque_atual||0})})]},he.id)})})]})}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg p-4 border-2 border-gray-300",children:[e.jsxs("p",{className:"text-sm font-bold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üìñ"})," Legenda e Dicas de Interpreta√ß√£o:"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx("span",{className:"font-bold text-green-700",children:"üü¢ Verde:"}),e.jsx("span",{className:"text-gray-700",children:"Valores melhores (menor custo, maior margem/lucro)"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx("span",{className:"font-bold text-red-700",children:"üî¥ Vermelho:"}),e.jsx("span",{className:"text-gray-700",children:"Valores piores (maior custo, menor margem/lucro)"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx("span",{className:"font-bold text-yellow-700",children:"üü° Amarelo:"}),e.jsx("span",{className:"text-gray-700",children:"Destaque na linha = um dos melhores produtos"})]})]}),e.jsxs("div",{className:"space-y-1.5 text-xs text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Margem %:"})," (Venda - Custo) / Venda √ó 100"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ROI %:"})," (Lucro / Custo) √ó 100"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Lucro R$:"})," Venda - Custo (valor absoluto)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Custo/Venda por kg:"})," Pre√ßo dividido pelo peso"]})]})]})]})]})};return s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx($a,{className:"h-8 w-8 animate-spin text-blue-500"})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Ft,{className:"h-7 w-7 text-blue-600"}),"An√°lise Inteligente de Ra√ß√µes"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Dashboard din√¢mico com an√°lises avan√ßadas de margem e vendas"})]}),e.jsxs("button",{onClick:()=>K(),className:"px-4 py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 flex items-center gap-2",children:[e.jsx($a,{className:"h-4 w-4"}),"Atualizar"]})]}),H(),B(),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex space-x-1 p-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>P("comparacao"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${S==="comparacao"?"bg-blue-600 text-white shadow-md":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Zo,{className:"h-4 w-4 inline mr-2"}),"üìä Compara√ß√£o Detalhada"]}),e.jsxs("button",{onClick:()=>P("segmento"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${S==="segmento"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Ma,{className:"h-4 w-4 inline mr-2"}),"Margem por Segmento"]}),e.jsxs("button",{onClick:()=>P("marcas"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${S==="marcas"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Za,{className:"h-4 w-4 inline mr-2"}),"Compara√ß√£o de Marcas"]}),e.jsxs("button",{onClick:()=>P("ranking"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${S==="ranking"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(sr,{className:"h-4 w-4 inline mr-2"}),"Ranking de Vendas"]})]})}),e.jsxs("div",{className:"p-4",children:[S==="comparacao"&&ae(),S==="resumo"&&H(),S==="segmento"&&N(),S==="marcas"&&O(),S==="ranking"&&z()]})]})]})},gd=()=>{var Z,A,G;const[s,n]=a.useState(!0),[t,d]=a.useState(null),[o,g]=a.useState([]),[r,v]=a.useState([]),[j,f]=a.useState([]),[y,c]=a.useState("resumo"),[m,k]=a.useState(.8),[w,x]=a.useState("porte"),[b,u]=a.useState({}),[i,p]=a.useState({});a.useEffect(()=>{l()},[]);const l=async()=>{try{n(!0);const E=await F.get("/racoes/sugestoes/relatorio-completo");d(E.data),n(!1)}catch(E){console.error("Erro ao carregar relat√≥rio:",E),ce.error("Erro ao carregar relat√≥rio de sugest√µes"),n(!1)}},C=async()=>{try{n(!0);const E=await F.get(`/racoes/sugestoes/duplicatas?threshold_similaridade=${m}`);g(E.data),n(!1)}catch(E){console.error("Erro ao carregar duplicatas:",E),ce.error("Erro ao carregar duplicatas"),n(!1)}},h=async()=>{try{n(!0);const E=await F.get("/racoes/sugestoes/padronizar-nomes?limite=50");v(E.data),n(!1)}catch(E){console.error("Erro ao carregar padroniza√ß√µes:",E),ce.error("Erro ao carregar sugest√µes de padroniza√ß√£o"),n(!1)}},_=async()=>{try{n(!0);const E=await F.get(`/racoes/sugestoes/gaps-estoque?tipo_segmento=${w}`);f(E.data),n(!1)}catch(E){console.error("Erro ao carregar gaps:",E),ce.error("Erro ao carregar gaps de estoque"),n(!1)}},S=E=>{c(E),E==="duplicatas"&&o.length===0?C():E==="padronizacao"&&r.length===0?h():E==="gaps"&&j.length===0&&_()},$=async E=>{try{const P=i[E.produto_id],H=(P==null?void 0:P.nome)||E.nome_sugerido;await F.patch(`/produtos/${E.produto_id}`,{nome:H}),ce.success("Nome atualizado com sucesso!"),v(B=>B.filter(N=>N.produto_id!==E.produto_id)),p(B=>{const N={...B};return delete N[E.produto_id],N}),l()}catch(P){console.error("Erro ao aplicar padroniza√ß√£o:",P),ce.error("Erro ao atualizar nome do produto")}},K=async E=>{try{await F.post("/racoes/sugestoes/duplicatas/ignorar",null,{params:{produto_id_1:E.produto_1.id,produto_id_2:E.produto_2.id}}),ce.success("Duplicata ignorada com sucesso!"),g(P=>P.filter(H=>!(H.produto_1.id===E.produto_1.id&&H.produto_2.id===E.produto_2.id))),l()}catch(P){console.error("Erro ao ignorar duplicata:",P),ce.error("Erro ao ignorar duplicata")}},re=(E,P)=>{u(H=>({...H,[E]:P}))},M=async(E,P)=>{const H=b[P];if(!H){ce.error("Selecione qual produto deseja manter antes de confirmar");return}const B=H==="produto_1"?E.produto_1.id:E.produto_2.id,N=H==="produto_1"?E.produto_2.id:E.produto_1.id;H==="produto_1"?E.produto_1.nome:E.produto_2.nome,H==="produto_1"?E.produto_2.nome:E.produto_1.nome;try{const O=await F.post("/racoes/sugestoes/duplicatas/mesclar",null,{params:{produto_id_manter:B,produto_id_remover:N,transferir_estoque:!0}});ce.success(O.data.mensagem),g(z=>z.filter(ae=>!(ae.produto_1.id===E.produto_1.id&&ae.produto_2.id===E.produto_2.id))),u(z=>{const ae={...z};return delete ae[P],ae}),l()}catch(O){console.error("Erro ao mesclar produtos:",O),ce.error("Erro ao mesclar produtos")}},R=()=>{if(!t)return null;const{score_saude:E,classificacao:P,cor:H,resumo:B,recomendacoes:N}=t;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Score de Sa√∫de do Cadastro"}),e.jsx("button",{onClick:l,className:"text-blue-600 hover:text-blue-700",children:e.jsx($a,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:`w-32 h-32 rounded-full flex items-center justify-center border-8 ${H==="green"?"border-green-500":H==="blue"?"border-blue-500":H==="yellow"?"border-yellow-500":"border-red-500"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:E}),e.jsx("div",{className:"text-xs text-gray-600",children:"pontos"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`inline-block px-4 py-2 rounded-full text-white font-semibold mb-3 ${H==="green"?"bg-green-500":H==="blue"?"bg-blue-500":H==="yellow"?"bg-yellow-500":"bg-red-500"}`,children:P}),e.jsxs("p",{className:"text-gray-700 mb-4",children:[E>=90&&"Parab√©ns! Seu cadastro de ra√ß√µes est√° excelente.",E>=70&&E<90&&"Seu cadastro est√° em bom estado, mas h√° algumas melhorias poss√≠veis.",E>=50&&E<70&&"Aten√ß√£o! Existem v√°rios pontos de melhoria no cadastro.",E<50&&"CR√çTICO! √â necess√°rio realizar melhorias urgentes no cadastro."]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ut,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:B.duplicatas_detectadas})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Duplicatas Detectadas"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Qt,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:B.nomes_padronizar})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Nomes para Padronizar"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(uo,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:B.gaps_criticos})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Gaps de Estoque Cr√≠ticos"})]})]}),N&&N.filter(Boolean).length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(da,{className:"h-5 w-5"}),"Recomenda√ß√µes Priorit√°rias"]}),e.jsx("ul",{className:"space-y-2",children:N.filter(Boolean).map((O,z)=>e.jsxs("li",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),O]},z))})]})]})},J=()=>s?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando..."}):o.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ha,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-700 font-semibold",children:"Nenhuma duplicata detectada!"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Seu cadastro est√° livre de produtos duplicados"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mr-2",children:"Threshold de Similaridade:"}),e.jsx("input",{type:"range",min:"0.5",max:"1",step:"0.05",value:m,onChange:E=>k(parseFloat(E.target.value)),className:"w-32"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:[(m*100).toFixed(0),"%"]})]}),e.jsxs("button",{onClick:C,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(As,{className:"h-4 w-4"}),"Buscar Duplicatas"]})]}),o.map((E,P)=>e.jsxs("div",{className:"bg-white border-2 border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ut,{className:"h-5 w-5 text-orange-500"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["Similaridade: ",(E.score_similaridade*100).toFixed(0),"%"]})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${E.score_similaridade>=.9?"bg-red-100 text-red-700":E.score_similaridade>=.8?"bg-orange-100 text-orange-700":"bg-yellow-100 text-yellow-700"}`,children:E.sugestao_acao})]}),e.jsxs("div",{className:"mb-3 text-sm text-gray-700 bg-blue-50 p-2 rounded",children:["üëÜ ",e.jsx("strong",{children:"Clique no produto que deseja MANTER"})," (o outro ser√° inativado e ter√° o estoque transferido)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{onClick:()=>re(P,"produto_1"),className:`rounded p-3 cursor-pointer transition-all border-2 ${b[P]==="produto_1"?"bg-green-50 border-green-500 shadow-lg":b[P]==="produto_2"?"bg-red-50 border-red-300 opacity-60":"bg-gray-50 border-gray-200 hover:border-blue-400 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Produto 1 (ID: ",E.produto_1.id,")"]}),b[P]==="produto_1"&&e.jsx(ha,{className:"h-5 w-5 text-green-600"})]}),e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:E.produto_1.nome}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Marca: ",E.produto_1.marca]}),e.jsxs("div",{children:["Pre√ßo: R$ ",E.produto_1.preco.toFixed(2)]}),e.jsxs("div",{children:["Estoque: ",E.produto_1.estoque]})]}),b[P]==="produto_1"&&e.jsx("div",{className:"mt-2 text-xs font-semibold text-green-700 bg-green-100 px-2 py-1 rounded",children:"‚úì ESTE PRODUTO SER√Å MANTIDO"}),b[P]==="produto_2"&&e.jsx("div",{className:"mt-2 text-xs text-red-700 bg-red-100 px-2 py-1 rounded",children:"‚úó Este produto ser√° inativado"})]}),e.jsxs("div",{onClick:()=>re(P,"produto_2"),className:`rounded p-3 cursor-pointer transition-all border-2 ${b[P]==="produto_2"?"bg-green-50 border-green-500 shadow-lg":b[P]==="produto_1"?"bg-red-50 border-red-300 opacity-60":"bg-gray-50 border-gray-200 hover:border-blue-400 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Produto 2 (ID: ",E.produto_2.id,")"]}),b[P]==="produto_2"&&e.jsx(ha,{className:"h-5 w-5 text-green-600"})]}),e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:E.produto_2.nome}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Marca: ",E.produto_2.marca]}),e.jsxs("div",{children:["Pre√ßo: R$ ",E.produto_2.preco.toFixed(2)]}),e.jsxs("div",{children:["Estoque: ",E.produto_2.estoque]})]}),b[P]==="produto_2"&&e.jsx("div",{className:"mt-2 text-xs font-semibold text-green-700 bg-green-100 px-2 py-1 rounded",children:"‚úì ESTE PRODUTO SER√Å MANTIDO"}),b[P]==="produto_1"&&e.jsx("div",{className:"mt-2 text-xs text-red-700 bg-red-100 px-2 py-1 rounded",children:"‚úó Este produto ser√° inativado"})]})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-1",children:E.razoes.map((H,B)=>e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:H},B))}),e.jsxs("div",{className:"mt-4 flex gap-2 justify-end",children:[e.jsxs("button",{onClick:()=>K(E),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 flex items-center gap-2 text-sm",children:[e.jsx(cs,{className:"h-4 w-4"}),"Ignorar (N√£o √© Duplicata)"]}),b[P]?e.jsxs("button",{onClick:()=>M(E,P),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center gap-2 text-sm font-semibold shadow-md",children:[e.jsx(ha,{className:"h-4 w-4"}),"Confirmar Mesclagem"]}):e.jsxs("button",{disabled:!0,className:"px-4 py-2 bg-gray-300 text-gray-500 rounded-md flex items-center gap-2 text-sm cursor-not-allowed",children:[e.jsx(Ut,{className:"h-4 w-4"}),"Selecione um Produto"]})]})]},P))]}),te=()=>s?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando..."}):r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ha,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-700 font-semibold",children:"Todos os nomes est√£o padronizados!"})]}):e.jsx("div",{className:"space-y-3",children:r.map((E,P)=>{var H,B,N,O,z;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:["ID: ",E.produto_id]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Nome Atual:"}),e.jsx("div",{className:"text-sm text-gray-700 bg-gray-50 p-2 rounded",children:E.nome_atual})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-green-700 mb-1",children:"Nome Sugerido:"}),(H=i[E.produto_id])!=null&&H.editando?e.jsx("input",{type:"text",value:((B=i[E.produto_id])==null?void 0:B.nome)||E.nome_sugerido,onChange:ae=>p(W=>({...W,[E.produto_id]:{editando:!0,nome:ae.target.value}})),className:"w-full text-sm text-green-900 bg-green-50 p-2 rounded font-medium border-2 border-blue-400 focus:outline-none focus:border-blue-600",autoFocus:!0}):e.jsx("div",{className:"text-sm text-green-900 bg-green-50 p-2 rounded font-medium",children:((N=i[E.produto_id])==null?void 0:N.nome)||E.nome_sugerido})]})]}),e.jsx("div",{className:"ml-4 flex items-center gap-2",children:e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:[(E.confianca*100).toFixed(0),"% confian√ßa"]})})]}),e.jsxs("div",{className:"text-xs text-gray-600 mb-3",children:[e.jsx("strong",{children:"Raz√£o:"})," ",E.razao]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>$(E),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm flex items-center gap-1",children:[e.jsx(ha,{className:"h-4 w-4"}),"Aplicar ",(O=i[E.produto_id])!=null&&O.nome?"Edi√ß√£o":"Sugest√£o"]}),(z=i[E.produto_id])!=null&&z.editando?e.jsxs("button",{onClick:()=>p(ae=>{const W={...ae};return delete W[E.produto_id],W}),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 text-sm flex items-center gap-1",children:[e.jsx(cs,{className:"h-4 w-4"}),"Cancelar Edi√ß√£o"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>p(ae=>{var W;return{...ae,[E.produto_id]:{editando:!0,nome:((W=i[E.produto_id])==null?void 0:W.nome)||E.nome_sugerido}}}),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm flex items-center gap-1",children:[e.jsx(Qt,{className:"h-4 w-4"}),"Editar"]}),e.jsxs("button",{className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 text-sm flex items-center gap-1",children:[e.jsx(cs,{className:"h-4 w-4"}),"Ignorar"]})]})]})]},P)})}),L=()=>s?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando..."}):j.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ha,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-700 font-semibold",children:"Nenhum gap cr√≠tico de estoque!"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mr-2",children:"Analisar por:"}),e.jsxs("select",{value:w,onChange:E=>x(E.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-md text-sm",children:[e.jsx("option",{value:"porte",children:"Porte"}),e.jsx("option",{value:"fase",children:"Fase"}),e.jsx("option",{value:"sabor",children:"Sabor"}),e.jsx("option",{value:"linha",children:"Linha"}),e.jsx("option",{value:"especie",children:"Esp√©cie"})]})]}),e.jsxs("button",{onClick:_,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(As,{className:"h-4 w-4"}),"Analisar"]})]}),j.map((E,P)=>e.jsxs("div",{className:`rounded-lg p-4 border-2 ${E.importancia==="Alta"?"bg-red-50 border-red-300":E.importancia==="M√©dia"?"bg-yellow-50 border-yellow-300":"bg-gray-50 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Oa,{className:`h-5 w-5 ${E.importancia==="Alta"?"text-red-600":E.importancia==="M√©dia"?"text-yellow-600":"text-gray-600"}`}),e.jsx("span",{className:"font-bold text-gray-900 text-lg",children:E.segmento_valor})]}),e.jsxs("div",{className:"text-sm text-gray-700",children:[E.produtos_sem_estoque," de ",E.total_produtos," produtos sem estoque (",E.percentual_sem_estoque,"%)"]})]}),e.jsx("span",{className:`px-3 py-1 rounded text-xs font-semibold ${E.importancia==="Alta"?"bg-red-600 text-white":E.importancia==="M√©dia"?"bg-yellow-500 text-white":"bg-gray-500 text-white"}`,children:E.importancia})]}),e.jsx("div",{className:"bg-white bg-opacity-50 rounded p-3 mb-3",children:e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Faturamento Hist√≥rico (90 dias):"})," R$ ",E.faturamento_historico.toLocaleString("pt-BR",{minimumFractionDigits:2})]})}),e.jsxs("div",{className:`text-sm font-medium ${E.importancia==="Alta"?"text-red-800":E.importancia==="M√©dia"?"text-yellow-800":"text-gray-800"}`,children:["üí° ",E.sugestao]})]},P))]});return s&&y==="resumo"?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx($a,{className:"h-8 w-8 animate-spin text-blue-500"})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(da,{className:"h-7 w-7 text-blue-600"}),"Sugest√µes Inteligentes"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Otimize seu cadastro de ra√ß√µes com sugest√µes autom√°ticas"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex space-x-1 p-2",children:[e.jsxs("button",{onClick:()=>S("resumo"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${y==="resumo"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(ha,{className:"h-4 w-4 inline mr-2"}),"Resumo Geral"]}),e.jsxs("button",{onClick:()=>S("duplicatas"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${y==="duplicatas"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Ut,{className:"h-4 w-4 inline mr-2"}),"Duplicatas",((Z=t==null?void 0:t.resumo)==null?void 0:Z.duplicatas_detectadas)>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-orange-500 text-white text-xs rounded-full",children:t.resumo.duplicatas_detectadas})]}),e.jsxs("button",{onClick:()=>S("padronizacao"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${y==="padronizacao"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Qt,{className:"h-4 w-4 inline mr-2"}),"Padroniza√ß√£o",((A=t==null?void 0:t.resumo)==null?void 0:A.nomes_padronizar)>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-blue-500 text-white text-xs rounded-full",children:t.resumo.nomes_padronizar})]}),e.jsxs("button",{onClick:()=>S("gaps"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${y==="gaps"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(uo,{className:"h-4 w-4 inline mr-2"}),"Gaps de Estoque",((G=t==null?void 0:t.resumo)==null?void 0:G.gaps_criticos)>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-red-500 text-white text-xs rounded-full",children:t.resumo.gaps_criticos})]})]})}),e.jsxs("div",{className:"p-4",children:[y==="resumo"&&R(),y==="duplicatas"&&J(),y==="padronizacao"&&te(),y==="gaps"&&L()]})]})]})};function hd(){const s=fa(),[n,t]=a.useState("dashboard"),[d,o]=a.useState([]),[g,r]=a.useState(!1),[v,j]=a.useState(new Set),[f,y]=a.useState({total:0,limite:50,offset:0}),[c,m]=a.useState(""),k=[{value:"",label:"Todas as esp√©cies"},{value:"dog",label:"C√£es"},{value:"cat",label:"Gatos"},{value:"bird",label:"P√°ssaros"},{value:"rodent",label:"Roedores"},{value:"fish",label:"Peixes"}];a.useEffect(()=>{w()},[]),a.useEffect(()=>{n==="alertas"&&x()},[c,n]);const w=async()=>{try{const l=await F.get("/produtos/racao/alertas",{params:{limite:1,offset:0}});y(C=>({...C,total:l.data.total}))}catch(l){console.error("Erro ao carregar contagem de alertas:",l)}},x=async()=>{var l,C,h,_;r(!0);try{const S=localStorage.getItem("access_token");console.log("üîê [AlertasRacao] Iniciando carregamento de alertas",{hasToken:!!S,tokenPreview:S?`${S.substring(0,20)}...`:"NO TOKEN",especieFiltro:c});const $={limite:50,offset:0};c&&($.especie=c),console.log("üì° [AlertasRacao] Chamando: /produtos/racao/alertas",$);const K=await F.get("/produtos/racao/alertas",{params:$});console.log("‚úÖ [AlertasRacao] Alertas carregados:",{total:K.data.total,items:(l=K.data.items)==null?void 0:l.length}),o(K.data.items||[]),y({total:K.data.total,limite:K.data.limite,offset:K.data.offset})}catch(S){console.error("‚ùå [AlertasRacao] Erro ao carregar alertas:",{message:S.message,status:(C=S.response)==null?void 0:C.status,data:(h=S.response)==null?void 0:h.data,config:S.config}),((_=S.response)==null?void 0:_.status)===403?Se.error("Acesso negado. Verifique suas permiss√µes ou fa√ßa login novamente."):Se.error("Erro ao carregar alertas de ra√ß√µes")}finally{r(!1)}},b=async l=>{j(C=>new Set(C).add(l));try{const C=await F.post(`/produtos/${l}/classificar-ia`,null,{params:{forcar:!0}});Se.success(`${C.data.campos_atualizados.length} campos classificados! Score: ${C.data.confianca.score}%`,{duration:4e3}),o(h=>h.filter(_=>_.id!==l)),y(h=>({...h,total:h.total-1}))}catch(C){console.error("Erro ao classificar produto:",C),Se.error("Erro ao classificar produto")}finally{j(C=>{const h=new Set(C);return h.delete(l),h})}},u=async()=>{r(!0);try{const l=await F.post("/produtos/classificar-lote",null,{params:{apenas_sem_classificacao:!0}});Se.success(`${l.data.sucessos} produtos classificados com sucesso!`,{duration:5e3}),l.data.erros>0&&Se.error(`${l.data.erros} produtos com erro na classifica√ß√£o`),await x()}catch(l){console.error("Erro ao classificar lote:",l),Se.error("Erro ao classificar produtos em lote")}finally{r(!1)}},i=l=>l>=75?{cor:"text-yellow-600 bg-yellow-50",texto:"Quase completo"}:l>=50?{cor:"text-orange-600 bg-orange-50",texto:"Incompleto"}:{cor:"text-red-600 bg-red-50",texto:"Muito incompleto"},p=l=>({porte_animal:"Porte",fase_publico:"Fase",sabor_proteina:"Sabor/Prote√≠na",peso_embalagem:"Peso"})[l]||l;return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Da,{className:"w-8 h-8 text-amber-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Sistema Inteligente de Ra√ß√µes"})]}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>t("dashboard"),className:`px-6 py-3 font-medium text-sm transition-colors relative ${n==="dashboard"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ft,{className:"w-4 h-4"}),"Dashboard de An√°lise"]})}),e.jsx("button",{onClick:()=>t("alertas"),className:`px-6 py-3 font-medium text-sm transition-colors relative ${n==="alertas"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Da,{className:"w-4 h-4"}),"Alertas de Classifica√ß√£o",f.total>0&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-red-500 text-white rounded-full",children:f.total})]})}),e.jsx("button",{onClick:()=>t("sugestoes"),className:`px-6 py-3 font-medium text-sm transition-colors relative ${n==="sugestoes"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(an,{className:"w-4 h-4"}),"Sugest√µes Inteligentes"]})})]})]}),n==="dashboard"&&e.jsx(pd,{}),n==="sugestoes"&&e.jsx(gd,{}),n==="alertas"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-gray-600",children:"Produtos classificados como ra√ß√£o mas sem informa√ß√µes completas"}),e.jsxs("button",{onClick:u,disabled:g||d.length===0,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition",children:[e.jsx($a,{className:`w-4 h-4 ${g?"animate-spin":""}`}),"Classificar Todos"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Filtrar por:"}),e.jsx("select",{value:c,onChange:l=>m(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:k.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),c&&e.jsx("button",{onClick:()=>m(""),className:"text-sm text-indigo-600 hover:text-indigo-800",children:"Limpar filtro"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-red-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Alertas"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:f.total})]}),e.jsx(Da,{className:"w-10 h-10 text-red-500 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-amber-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nesta P√°gina"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:d.length})]}),e.jsx(Gn,{className:"w-10 h-10 text-amber-500 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-green-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Completude M√©dia"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[d.length>0?Math.round(d.reduce((l,C)=>l+C.completude,0)/d.length):0,"%"]})]}),e.jsx(ha,{className:"w-10 h-10 text-green-500 opacity-20"})]})})]}),g&&d.length===0&&e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx($a,{className:"w-8 h-8 animate-spin text-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando alertas..."})]}),!g&&d.length===0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-8 text-center",children:[e.jsx(ha,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-green-800 mb-2",children:"Nenhum alerta encontrado!"}),e.jsx("p",{className:"text-green-700",children:"Todas as ra√ß√µes cadastradas possuem informa√ß√µes completas."})]}),d.length>0&&e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"C√≥digo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Categoria / Marca"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Campos Faltantes"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Completude"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map(l=>{var _;const C=i(l.completude),h=v.has(l.id);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-mono",children:l.codigo}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"max-w-md",children:[e.jsx("p",{className:"font-medium",children:l.nome}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[l.classificacao_racao&&e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:l.classificacao_racao}),l.especies_indicadas&&e.jsx("span",{className:"text-xs text-white bg-indigo-600 px-2 py-1 rounded",children:((_=k.find(S=>S.value===l.especies_indicadas))==null?void 0:_.label)||l.especies_indicadas})]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-700",children:l.categoria||"-"}),e.jsx("div",{className:"text-xs text-gray-500",children:l.marca||"-"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:l.campos_faltantes.map(S=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-red-100 text-red-800 text-xs rounded",children:[e.jsx(cs,{className:"w-3 h-3"}),p(S)]},S))})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${C.cor}`,children:[l.completude,"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-center",children:[e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>b(l.id),disabled:h||!l.auto_classificar_ativo,className:"inline-flex items-center gap-2 px-3 py-1 bg-indigo-600 text-white text-sm rounded hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition",children:h?e.jsxs(e.Fragment,{children:[e.jsx($a,{className:"w-4 h-4 animate-spin"}),"Classificando..."]}):e.jsxs(e.Fragment,{children:[e.jsx($a,{className:"w-4 h-4"}),"Classificar IA"]})}),e.jsxs("button",{onClick:()=>s(`/produtos/${l.id}/editar?aba=7`),className:"inline-flex items-center gap-2 px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition",title:"Editar produto manualmente",children:[e.jsx(Qt,{className:"w-4 h-4"}),"Editar"]})]}),!l.auto_classificar_ativo&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Auto-class. desativada"})]})]},l.id)})})]})})})]})]})}function bd(){const[s,n]=a.useState("linhas"),[t,d]=a.useState({}),[o,g]=a.useState(!1),[r,v]=a.useState(null),[j,f]=a.useState({nome:"",descricao:"",ordem:0,ativo:!0}),[y,c]=a.useState({peso_kg:0,descricao:"",ordem:0,ativo:!0}),m=[{id:"linhas",nome:"Linhas de Ra√ß√£o",endpoint:"/opcoes-racao/linhas",icon:"üì¶"},{id:"portes",nome:"Portes",endpoint:"/opcoes-racao/portes",icon:"üêï"},{id:"fases",nome:"Fases/P√∫blico",endpoint:"/opcoes-racao/fases",icon:"üë∂"},{id:"tratamentos",nome:"Tratamentos",endpoint:"/opcoes-racao/tratamentos",icon:"üíä"},{id:"sabores",nome:"Sabores/Prote√≠nas",endpoint:"/opcoes-racao/sabores",icon:"üçñ"},{id:"apresentacoes",nome:"Apresenta√ß√µes (Peso)",endpoint:"/opcoes-racao/apresentacoes",icon:"‚öñÔ∏è"}],k=m.find(l=>l.id===s);a.useEffect(()=>{w()},[s]);const w=async()=>{g(!0);try{const l=await F.get(k.endpoint,{params:{apenas_ativos:!1}});d(C=>({...C,[s]:l.data}))}catch(l){console.error("Erro ao carregar dados:",l),Se.error(`Erro ao carregar ${k.nome.toLowerCase()}`)}finally{g(!1)}},x=()=>{f({nome:"",descricao:"",ordem:0,ativo:!0}),c({peso_kg:0,descricao:"",ordem:0,ativo:!0}),v(null)},b=l=>{v(l.id),s==="apresentacoes"?c({peso_kg:l.peso_kg,descricao:l.descricao||"",ordem:l.ordem||0,ativo:l.ativo}):f({nome:l.nome,descricao:l.descricao||"",ordem:l.ordem||0,ativo:l.ativo})},u=async()=>{var l,C;try{const h=s==="apresentacoes"?y:j;r?(await F.put(`${k.endpoint}/${r}`,h),Se.success("Atualizado com sucesso!")):(await F.post(k.endpoint,h),Se.success("Criado com sucesso!")),x(),w()}catch(h){console.error("Erro ao salvar:",h),Se.error(((C=(l=h.response)==null?void 0:l.data)==null?void 0:C.detail)||"Erro ao salvar")}},i=async l=>{if(confirm("Tem certeza que deseja inativar este item?"))try{await F.delete(`${k.endpoint}/${l}`),Se.success("Inativado com sucesso!"),w()}catch(C){console.error("Erro ao deletar:",C),Se.error("Erro ao inativar")}},p=t[s]||[];return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(rr,{className:"w-8 h-8 text-indigo-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Op√ß√µes de Classifica√ß√£o de Ra√ß√µes"})]}),e.jsx("p",{className:"text-gray-600",children:"Gerencie os valores dispon√≠veis para classifica√ß√£o de produtos de ra√ß√£o"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex overflow-x-auto",children:m.map(l=>e.jsxs("button",{onClick:()=>{n(l.id),x()},className:`
                  flex items-center gap-2 px-6 py-4 text-sm font-medium border-b-2 whitespace-nowrap
                  ${s===l.id?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                `,children:[e.jsx("span",{className:"text-xl",children:l.icon}),l.nome]},l.id))})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:r?"Editar":"Adicionar Novo"}),s==="apresentacoes"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Peso (kg) *"}),e.jsx("input",{type:"number",step:"0.001",value:y.peso_kg,onChange:l=>c({...y,peso_kg:parseFloat(l.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Ex: 15.0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri√ß√£o"}),e.jsx("input",{type:"text",value:y.descricao,onChange:l=>c({...y,descricao:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Ex: 15kg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ordem"}),e.jsx("input",{type:"number",value:y.ordem,onChange:l=>c({...y,ordem:parseInt(l.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"ativo-peso",checked:y.ativo,onChange:l=>c({...y,ativo:l.target.checked}),className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"ativo-peso",className:"text-sm text-gray-700",children:"Ativo"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",value:j.nome,onChange:l=>f({...j,nome:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:`Ex: ${s==="linhas"?"Premium":s==="portes"?"Pequeno":"Filhote"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri√ß√£o"}),e.jsx("textarea",{value:j.descricao,onChange:l=>f({...j,descricao:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",rows:"2",placeholder:"Descri√ß√£o opcional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ordem"}),e.jsx("input",{type:"number",value:j.ordem,onChange:l=>f({...j,ordem:parseInt(l.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"ativo",checked:j.ativo,onChange:l=>f({...j,ativo:l.target.checked}),className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"ativo",className:"text-sm text-gray-700",children:"Ativo"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsxs("button",{onClick:u,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition",children:[e.jsx(Ct,{className:"w-4 h-4"}),r?"Atualizar":"Adicionar"]}),r&&e.jsx("button",{onClick:x,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:e.jsx(ma,{className:"w-4 h-4"})})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"bg-white rounded-lg shadow",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:[k.nome," Cadastrados (",p.length,")"]}),o?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando..."})]}):p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:e.jsx(os,{className:"w-16 h-16 mx-auto"})}),e.jsx("p",{className:"text-gray-600",children:"Nenhum item cadastrado ainda"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Use o formul√°rio ao lado para adicionar"})]}):e.jsx("div",{className:"space-y-2",children:p.map(l=>e.jsxs("div",{className:`
                        flex items-center justify-between p-4 border rounded-lg transition
                        ${r===l.id?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300"}
                        ${!l.ativo&&"opacity-50"}
                      `,children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:k.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s==="apresentacoes"?`${l.peso_kg}kg${l.descricao?` - ${l.descricao}`:""}`:l.nome}),l.descricao&&s!=="apresentacoes"&&e.jsx("p",{className:"text-sm text-gray-500",children:l.descricao})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500 mr-2",children:["Ordem: ",l.ordem]}),!l.ativo&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-red-100 text-red-800 rounded",children:"Inativo"}),e.jsx("button",{onClick:()=>b(l),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition",title:"Editar",children:e.jsx(Dr,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>i(l.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition",title:"Inativar",children:e.jsx(hs,{className:"w-4 h-4"})})]})]},l.id))})]})})})]}),e.jsx("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(st,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-1",children:"Dica"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Os valores cadastrados aqui ser√£o usados no cadastro de produtos e na classifica√ß√£o autom√°tica por IA. Mantenha ativos apenas os valores que voc√™ utiliza no seu neg√≥cio."})]})]})})]})}const fd=()=>{const[s,n]=a.useState(null),[t,d]=a.useState(!1),[o,g]=a.useState(null),[r,v]=a.useState([]),[j,f]=a.useState(!1),[y,c]=a.useState([]),[m,k]=a.useState(null),[w,x]=a.useState("upload"),b=_=>{var $;const S=($=_.target.files)==null?void 0:$[0];S&&n(S)},u=async()=>{var S,$;if(!s){alert("Selecione um arquivo primeiro");return}const _=new FormData;_.append("arquivo",s),d(!0);try{const K=await F.post("/ia/extrato/upload",_,{headers:{"Content-Type":"multipart/form-data"}});g(K.data),alert(`Upload conclu√≠do! ${K.data.categorias_aplicadas} categorias aplicadas automaticamente.`)}catch(K){console.error("Erro no upload:",K);const re=(($=(S=K.response)==null?void 0:S.data)==null?void 0:$.detail)||K.message;alert("Erro ao processar arquivo: "+re)}finally{d(!1)}},i=async()=>{f(!0);try{const _=await F.get("/ia/extrato/pendentes");v(_.data)}catch(_){console.error("Erro ao carregar pendentes:",_),alert("Erro ao carregar lan√ßamentos pendentes")}finally{f(!1)}},p=async _=>{try{await F.post("/ia/extrato/validar",{lancamento_id:_,aprovado:!0}),alert("Lan√ßamento aprovado!"),i()}catch(S){console.error("Erro ao aprovar:",S),alert("Erro ao aprovar lan√ßamento")}},l=async(_,S)=>{try{await F.post("/ia/extrato/validar",{lancamento_id:_,aprovado:!1,categoria_correta_id:S}),alert("Lan√ßamento corrigido e padr√£o aprendido!"),i()}catch($){console.error("Erro ao corrigir:",$),alert("Erro ao corrigir lan√ßamento")}},C=async()=>{try{const _=await F.get("/ia/extrato/padroes");c(_.data)}catch(_){console.error("Erro ao carregar padr√µes:",_),alert("Erro ao carregar padr√µes aprendidos")}},h=async()=>{try{const _=await F.get("/ia/extrato/estatisticas");k(_.data)}catch(_){console.error("Erro ao carregar estat√≠sticas:",_),alert("Erro ao carregar estat√≠sticas")}};return ts.useEffect(()=>{w==="validacao"?i():w==="padroes"?C():w==="estatisticas"&&h()},[w]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>x("upload"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${w==="upload"?"bg-green-100 text-green-700 font-medium":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(or,{size:18}),"Upload de Extrato"]}),e.jsxs("button",{onClick:()=>x("validacao"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${w==="validacao"?"bg-orange-100 text-orange-700 font-medium":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(da,{size:18}),"Valida√ß√£o (",r.length,")"]}),e.jsxs("button",{onClick:()=>x("padroes"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${w==="padroes"?"bg-blue-100 text-blue-700 font-medium":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(Et,{size:18}),"Padr√µes IA"]}),e.jsxs("button",{onClick:()=>x("estatisticas"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${w==="estatisticas"?"bg-purple-100 text-purple-700 font-medium":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(Ma,{size:18}),"Estat√≠sticas"]})]})}),w==="upload"&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(or,{className:"text-green-600"}),"Upload de Extrato Banc√°rio"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx(Xa,{className:"mx-auto mb-4 text-gray-400",size:48}),e.jsx("p",{className:"mb-2 text-gray-600",children:"Arraste um arquivo ou clique para selecionar"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"‚úÖ Formatos: Excel (.xlsx, .xls), CSV (.csv), PDF (.pdf), OFX (.ofx)"}),e.jsx("input",{type:"file",onChange:b,accept:".xlsx,.xls,.csv,.pdf,.ofx",className:"hidden",id:"file-upload"}),e.jsx("label",{htmlFor:"file-upload",className:"inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer",children:"Selecionar Arquivo"}),s&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 rounded-lg",children:[e.jsx("p",{className:"text-green-700 font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-green-600",children:[(s.size/1024).toFixed(2)," KB"]})]})]}),e.jsx("button",{onClick:u,disabled:!s||t,className:"w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium",children:t?"Processando...":"Processar Extrato"}),o&&e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"font-bold text-blue-900 mb-2",children:"‚úÖ Resultado do Processamento"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:["‚Ä¢ Total de lan√ßamentos: ",e.jsx("span",{className:"font-bold",children:o.total_lancamentos})]}),e.jsxs("p",{children:["‚Ä¢ Categorizados automaticamente: ",e.jsx("span",{className:"font-bold text-green-700",children:o.categorias_aplicadas})]}),e.jsxs("p",{children:["‚Ä¢ Pendentes de valida√ß√£o: ",e.jsx("span",{className:"font-bold text-orange-700",children:o.pendentes_validacao})]})]})]})]})]}),w==="validacao"&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(da,{className:"text-orange-600"}),"Lan√ßamentos Pendentes de Valida√ß√£o (",r.length,")"]}),j?e.jsx("p",{className:"text-center text-gray-600 py-8",children:"Carregando..."}):r.length===0?e.jsxs("div",{className:"text-center text-gray-600 py-8",children:[e.jsx(ha,{className:"mx-auto mb-2 text-green-500",size:48}),e.jsx("p",{children:"Nenhum lan√ßamento pendente! üéâ"})]}):e.jsx("div",{className:"space-y-3",children:r.map(_=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800",children:_.descricao}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Data: ",new Date(_.data).toLocaleDateString("pt-BR")," | Valor: R$ ",Math.abs(_.valor).toFixed(2)]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded",children:["Sugest√£o IA: ",_.categoria_sugerida]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Confian√ßa: ",(_.confianca*100).toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx("button",{onClick:()=>p(_.id),className:"px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm",title:"Aprovar categoria sugerida",children:e.jsx(ha,{size:16})}),e.jsx("button",{onClick:()=>{const S=prompt("Digite a categoria correta:");S&&l(_.id,S)},className:"px-3 py-2 bg-orange-600 text-white rounded hover:bg-orange-700 text-sm",title:"Corrigir categoria",children:e.jsx(cs,{size:16})})]})]})},_.id))})]}),w==="padroes"&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Et,{className:"text-blue-600"}),"Padr√µes Aprendidos pela IA"]}),y.length===0?e.jsx("p",{className:"text-center text-gray-600 py-8",children:"Nenhum padr√£o aprendido ainda"}):e.jsx("div",{className:"space-y-3",children:y.map((_,S)=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-800",children:["Padr√£o: ",_.descricao_padrao]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Categoria: ",_.categoria]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsxs("span",{className:"text-xs px-2 py-1 bg-green-100 text-green-700 rounded",children:["‚úì ",_.vezes_usado," vezes usado"]}),e.jsxs("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded",children:["Confian√ßa: ",(_.confianca*100).toFixed(0),"%"]})]})]})})},S))})]}),w==="estatisticas"&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Ma,{className:"text-purple-600"}),"Estat√≠sticas do Sistema IA"]}),m?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total de Padr√µes"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900 mt-1",children:m.total_padroes})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Taxa de Acerto"}),e.jsxs("p",{className:"text-3xl font-bold text-green-900 mt-1",children:[(m.taxa_acerto*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Confian√ßa M√©dia"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-900 mt-1",children:[(m.confianca_media*100).toFixed(0),"%"]})]})]}):e.jsx("p",{className:"text-center text-gray-600 py-8",children:"Carregando estat√≠sticas..."})]})})]})},jd=({dados:s,periodo:n})=>{const[t,d]=a.useState(null),[o,g]=a.useState(!0),[r,v]=a.useState(null),[j,f]=a.useState(null);a.useEffect(()=>{s&&(c(),y())},[s,n]);const y=async()=>{try{const u=await F.get("/ia/dre/indices-mercado",{params:{setor:"pet_shop"}});f(u.data)}catch(u){console.error("Erro ao carregar √≠ndices:",u)}},c=async()=>{g(!0);try{await new Promise(i=>setTimeout(i,1e3));const u=w(s);if(d(u),n.mes>1){const i=await m(n);i&&v(k(s,i))}}catch(u){console.error("Erro ao carregar an√°lise:",u)}finally{g(!1)}},m=async u=>{try{const i=u.mes===1?12:u.mes-1,p=u.mes===1?u.ano-1:u.ano;return(await F.get("/financeiro/dre",{params:{ano:p,mes:i}})).data}catch{return null}},k=(u,i)=>{const p=(l,C)=>!C||C===0?null:(l-C)/Math.abs(C)*100;return{receita:{atual:u.receita_bruta||0,anterior:i.receita_bruta||0,variacao:p(u.receita_bruta,i.receita_bruta)},lucro:{atual:u.lucro_liquido||0,anterior:i.lucro_liquido||0,variacao:p(u.lucro_liquido,i.lucro_liquido)},despesas:{atual:u.total_despesas||0,anterior:i.total_despesas||0,variacao:p(u.total_despesas,i.total_despesas)},margem:{atual:u.margem_liquida||0,anterior:i.margem_liquida||0,variacao:p(u.margem_liquida,i.margem_liquida)}}},w=u=>{const i=[],p=[],l=[],C=u.margem_liquida||0;C<5?(l.push({tipo:"critico",titulo:"Margem l√≠quida cr√≠tica",descricao:`Margem de apenas ${C.toFixed(1)}%. Ideal: acima de 10%`,icon:Da}),p.push({prioridade:"alta",titulo:"Urgente: Revisar estrutura de custos",descricao:"Margem muito baixa. Considere: aumentar pre√ßos, reduzir custos fixos, ou renegociar com fornecedores."})):C<10?i.push({tipo:"atencao",titulo:"Margem l√≠quida abaixo do ideal",descricao:`${C.toFixed(1)}% - H√° espa√ßo para melhoria`,icon:Oa}):i.push({tipo:"positivo",titulo:"Margem l√≠quida saud√°vel",descricao:`${C.toFixed(1)}% - Acima da m√©dia do setor`,icon:ha});const h=u.receita_bruta||0,_=u.total_despesas||0;_>h*.8&&l.push({tipo:"atencao",titulo:"Despesas elevadas",descricao:`Despesas representam ${(_/h*100).toFixed(0)}% da receita`,icon:Da});const S=u.cmv||0,$=(h-S)/h*100;$<30&&p.push({prioridade:"media",titulo:"Revisar custo dos produtos",descricao:`Margem bruta de ${$.toFixed(1)}%. Considere negociar com fornecedores ou ajustar pre√ßos.`});const K=u.lucro_liquido||0;K>0?i.push({tipo:"positivo",titulo:"Resultado positivo",descricao:`Lucro de R$ ${K.toLocaleString("pt-BR",{minimumFractionDigits:2})}`,icon:Ma}):(l.push({tipo:"critico",titulo:"Preju√≠zo no per√≠odo",descricao:`Resultado negativo de R$ ${Math.abs(K).toLocaleString("pt-BR",{minimumFractionDigits:2})}`,icon:Oa}),p.push({prioridade:"alta",titulo:"Plano de recupera√ß√£o necess√°rio",descricao:"An√°lise detalhada de custos e revis√£o de estrat√©gia de precifica√ß√£o urgente."}));let re=50;return C>10&&(re+=20),C>5&&C<=10&&(re+=10),K>0&&(re+=15),$>30&&(re+=15),_<h*.7&&(re+=10),{insights:i,recomendacoes:p,alertas:l,score:Math.min(re,100)}},x=u=>{let i="red",p="Cr√≠tico";return u>=80?(i="green",p="Excelente"):u>=60?(i="yellow",p="Bom"):u>=40&&(i="orange",p="Regular"),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Zo,{className:"text-purple-600"}),"Score de Sa√∫de Financeira"]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative w-32 h-32",children:[e.jsxs("svg",{className:"transform -rotate-90 w-32 h-32",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"#e5e7eb",strokeWidth:"12",fill:"none"}),e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:i==="green"?"#10b981":i==="yellow"?"#fbbf24":i==="orange"?"#f59e0b":"#ef4444",strokeWidth:"12",fill:"none",strokeDasharray:`${u/100*351.86} 351.86`,className:"transition-all duration-1000"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-3xl font-bold text-gray-800",children:u})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800 mb-1",children:p}),e.jsxs("p",{className:"text-sm text-gray-600",children:[u>=80&&"Sua sa√∫de financeira est√° √≥tima! Continue assim.",u>=60&&u<80&&"Boa sa√∫de financeira. Pequenos ajustes podem melhorar.",u>=40&&u<60&&"Situa√ß√£o est√°vel, mas requer aten√ß√£o.",u<40&&"Aten√ß√£o! Medidas corretivas s√£o necess√°rias."]})]})]})]})},b=()=>{if(!j||!s)return null;const u=j.benchmarks,i=s.receita_liquida||0,p=i>0?(s.cmv||0)/i*100:0,l=s.margem_bruta||0,C=s.margem_liquida||0,h=i>0?(s.despesas_admin||0)/i*100:0,_=i>0?(s.total_despesas||0)/i*100:0,S=[{nome:"CMV",seu:p,idealMin:u.cmv.min,idealMax:u.cmv.max,inverter:!0,unidade:"%",cor:p<=u.cmv.max?"green":p<=u.cmv.max*1.1?"yellow":"red"},{nome:"Margem Bruta",seu:l,idealMin:u.margem_bruta.min,idealMax:u.margem_bruta.max,inverter:!1,unidade:"%",cor:l>=u.margem_bruta.min?"green":l>=u.margem_bruta.min*.9?"yellow":"red"},{nome:"Margem L√≠quida",seu:C,idealMin:u.margem_liquida.min,idealMax:u.margem_liquida.max,inverter:!1,unidade:"%",cor:C>=u.margem_liquida.min?"green":C>=u.margem_liquida.min*.8?"yellow":"red"},{nome:"Despesas Admin",seu:h,idealMin:0,idealMax:u.despesas_admin.max,inverter:!0,unidade:"%",cor:h<=u.despesas_admin.max?"green":h<=u.despesas_admin.max*1.2?"yellow":"red"},{nome:"Despesas Totais",seu:_,idealMin:0,idealMax:u.despesas_totais.max,inverter:!0,unidade:"%",cor:_<=u.despesas_totais.max?"green":_<=u.despesas_totais.max*1.2?"yellow":"red"}];return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Ft,{className:"text-indigo-600"}),"Seus Indicadores vs Mercado Pet Shop"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Mr,{size:16}),e.jsxs("span",{children:["Fonte: ",j.fonte]})]})]}),e.jsx("div",{className:"space-y-4",children:S.map(($,K)=>{const re=$.idealMax-$.idealMin;$.idealMin+re/2;const M=$.seu>=$.idealMin&&$.seu<=$.idealMax;return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:$.nome}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:`text-lg font-bold ${$.cor==="green"?"text-green-600":$.cor==="yellow"?"text-yellow-600":"text-red-600"}`,children:[$.seu.toFixed(1),$.unidade]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Ideal: ",$.idealMin>0?`${$.idealMin.toFixed(0)}-`:"",$.idealMax.toFixed(0),$.unidade]})]})]}),e.jsxs("div",{className:"relative h-8 bg-gray-200 rounded-full overflow-hidden",children:[e.jsx("div",{className:"absolute h-full bg-green-200",style:{left:`${$.idealMin/100*100}%`,width:`${re/100*100}%`}}),e.jsx("div",{className:"absolute h-full w-2 bg-gray-800 shadow-lg z-10",style:{left:`${Math.min(Math.max($.seu/100*100,0),100)}%`,transform:"translateX(-50%)"},children:e.jsx("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap",children:"Voc√™"})})]}),e.jsx("div",{className:"mt-2 flex items-center gap-2 text-sm",children:M?e.jsxs(e.Fragment,{children:[e.jsx(ha,{size:16,className:"text-green-600"}),e.jsx("span",{className:"text-green-600 font-medium",children:"Dentro da faixa ideal!"})]}):$.seu<$.idealMin?e.jsxs(e.Fragment,{children:[e.jsx(Oa,{size:16,className:"text-orange-600"}),e.jsxs("span",{className:"text-orange-600",children:["Abaixo do ideal (",($.idealMin-$.seu).toFixed(1),$.unidade," a menos)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Da,{size:16,className:"text-red-600"}),e.jsxs("span",{className:"text-red-600",children:["Acima do ideal (+",($.seu-$.idealMax).toFixed(1),$.unidade,")"]})]})})]},K)})}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"üí° Faixa verde = Ideal para pet shops | Barra preta = Seu valor atual"})})]})};return o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Gerando an√°lise inteligente..."})]})}):t?e.jsxs("div",{className:"space-y-6",children:[x(t.score),b(),r&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Cs,{className:"text-blue-600"}),"Compara√ß√£o com Per√≠odo Anterior"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(r).map(([u,i])=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1 capitalize",children:u}),e.jsxs("p",{className:"text-xl font-bold text-gray-800 mb-2",children:["R$ ",i.atual.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),i.variacao!==null&&e.jsxs("div",{className:`flex items-center gap-1 text-sm ${i.variacao>0?"text-green-600":"text-red-600"}`,children:[i.variacao>0?e.jsx(Qn,{size:16}):e.jsx(Xn,{size:16}),e.jsxs("span",{className:"font-semibold",children:[Math.abs(i.variacao).toFixed(1),"%"]})]})]},u))})]}),t.alertas.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Da,{className:"text-orange-600"}),"Pontos de Aten√ß√£o"]}),e.jsx("div",{className:"space-y-3",children:t.alertas.map((u,i)=>e.jsx("div",{className:`p-4 rounded-lg border-l-4 ${u.tipo==="critico"?"bg-red-50 border-red-500":"bg-yellow-50 border-yellow-500"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(u.icon,{size:20,className:u.tipo==="critico"?"text-red-600":"text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:u.titulo}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:u.descricao})]})]})},i))})]}),t.insights.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Ft,{className:"text-indigo-600"}),"Insights Inteligentes"]}),e.jsx("div",{className:"space-y-3",children:t.insights.map((u,i)=>e.jsx("div",{className:`p-4 rounded-lg ${u.tipo==="positivo"?"bg-green-50":u.tipo==="atencao"?"bg-yellow-50":"bg-blue-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(u.icon,{size:20,className:u.tipo==="positivo"?"text-green-600":u.tipo==="atencao"?"text-yellow-600":"text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:u.titulo}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:u.descricao})]})]})},i))})]}),t.recomendacoes.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(an,{className:"text-yellow-600"}),"Recomenda√ß√µes Estrat√©gicas"]}),e.jsx("div",{className:"space-y-3",children:t.recomendacoes.map((u,i)=>e.jsx("div",{className:"p-4 rounded-lg bg-gradient-to-r from-purple-50 to-indigo-50 border border-purple-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-semibold ${u.prioridade==="alta"?"bg-red-100 text-red-700":u.prioridade==="media"?"bg-yellow-100 text-yellow-700":"bg-blue-100 text-blue-700"}`,children:u.prioridade.toUpperCase()}),e.jsx("p",{className:"font-semibold text-gray-800",children:u.titulo})]}),e.jsx("p",{className:"text-sm text-gray-600",children:u.descricao})]}),e.jsx(za,{className:"text-purple-600 flex-shrink-0 ml-3",size:24})]})},i))})]})]}):e.jsxs("div",{className:"bg-gray-50 rounded-lg p-12 text-center",children:[e.jsx(Brain,{className:"mx-auto mb-4 text-gray-400",size:64}),e.jsx("p",{className:"text-gray-600",children:"N√£o h√° dados suficientes para an√°lise"})]})},vd=()=>{var _,S,$,K,re,M,R;const[s,n]=a.useState("demonstrativo"),[t,d]=a.useState(!1),[o,g]=a.useState(!1),[r,v]=a.useState(null),[j]=a.useState([{id:"loja_fisica",nome:"Loja F√≠sica",cor:"blue"},{id:"mercado_livre",nome:"Mercado Livre",cor:"yellow"},{id:"shopee",nome:"Shopee",cor:"orange"},{id:"amazon",nome:"Amazon",cor:"green"}]),[f,y]=a.useState(["loja_fisica"]),c=()=>{const J=new Date,te=J.getFullYear(),L=String(J.getMonth()+1).padStart(2,"0");return`${te}-${L}`},[m,k]=a.useState(c());a.useEffect(()=>{w()},[]);const w=async()=>{var J,te;g(!0);try{const[L,Z]=m.split("-"),A=f.join(","),G=await F.get("/financeiro/dre/canais",{params:{ano:L,mes:Z,canais:A}});v(G.data)}catch(L){console.error("Erro ao carregar DRE:",L),Se.error("Erro ao carregar DRE: "+(((te=(J=L.response)==null?void 0:J.data)==null?void 0:te.detail)||L.message))}finally{g(!1)}},x=J=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(J||0),b=J=>`${(J||0).toFixed(2)}%`,u=(J,te)=>!te||te===0?0:J/te*100,i=J=>{y(te=>te.includes(J)?te.filter(Z=>Z!==J):[...te,J])},p=()=>{y([])};a.useEffect(()=>{r&&w()},[f]);const l=J=>{const te=new Date;let L;switch(J){case"mes_atual":L=c();break;case"mes_anterior":const Z=new Date(te.getFullYear(),te.getMonth()-1,1);L=`${Z.getFullYear()}-${String(Z.getMonth()+1).padStart(2,"0")}`;break;case"ano_atual":L=`${te.getFullYear()}-01`;break;default:return}k(L),setTimeout(()=>w(),100)},C=async()=>{const J=Se.loading("Gerando PDF...");try{const[te,L]=m.split("-"),Z=await F.get("/financeiro/dre/export/pdf",{params:{ano:te,mes:L},responseType:"blob"}),A=window.URL.createObjectURL(new Blob([Z.data])),G=document.createElement("a");G.href=A,G.setAttribute("download",`dre_${L}_${te}.pdf`),document.body.appendChild(G),G.click(),G.remove(),Se.success("√∞≈∏‚Äú‚Äû PDF exportado com sucesso!")}catch(te){console.error("Erro ao exportar PDF:",te),Se.error("Erro ao exportar PDF")}finally{Se.dismiss(J)}},h=async()=>{const J=Se.loading("Gerando Excel...");try{const[te,L]=m.split("-"),Z=await F.get("/financeiro/dre/export/excel",{params:{ano:te,mes:L},responseType:"blob"}),A=window.URL.createObjectURL(new Blob([Z.data])),G=document.createElement("a");G.href=A,G.setAttribute("download",`dre_${L}_${te}.xlsx`),document.body.appendChild(G),G.click(),G.remove(),Se.success("√∞≈∏‚Äú≈† Excel exportado com sucesso!")}catch(te){console.error("Erro ao exportar Excel:",te),Se.error("Erro ao exportar Excel")}finally{Se.dismiss(J)}};return o&&!r?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx($a,{className:"animate-spin mx-auto mb-4",size:48}),e.jsx("p",{className:"text-gray-600",children:"Carregando DRE..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"üìä DRE - Demonstra√ß√£o do Resultado"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"An√°lise gerencial de receitas, custos e lucro"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all shadow-lg hover:shadow-xl",title:"Consultar Especialista IA",children:[e.jsx(Jo,{size:20}),e.jsx("span",{className:"font-medium",children:"Chat IA"}),e.jsx(us,{size:16,className:"animate-pulse"})]}),e.jsxs("button",{onClick:C,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",title:"Exportar para PDF",children:[e.jsx(Xa,{size:18}),"PDF"]}),e.jsxs("button",{onClick:h,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",title:"Exportar para Excel",children:[e.jsx(kt,{size:18}),"Excel"]})]})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>n("demonstrativo"),className:`${s==="demonstrativo"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors`,children:[e.jsx(Xa,{size:18}),"Demonstrativo"]}),e.jsxs("button",{onClick:()=>n("extrato"),className:`${s==="extrato"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors`,children:[e.jsx(or,{size:18}),"Extrato Banc√°rio",e.jsx("span",{className:"ml-1 px-2 py-0.5 text-xs bg-green-100 text-green-700 rounded-full font-bold",children:"IA"})]}),e.jsxs("button",{onClick:()=>n("analise"),className:`${s==="analise"?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors`,children:[e.jsx(Et,{size:18}),"An√°lise Inteligente",e.jsx("span",{className:"ml-1 px-2 py-0.5 text-xs bg-purple-100 text-purple-700 rounded-full font-bold",children:"EM BREVE"})]})]})}),s==="demonstrativo"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>l("mes_atual"),className:"px-3 py-2 text-sm bg-blue-50 text-blue-700 rounded-md hover:bg-blue-100",children:"M√™s Atual"}),e.jsx("button",{onClick:()=>l("mes_anterior"),className:"px-3 py-2 text-sm bg-blue-50 text-blue-700 rounded-md hover:bg-blue-100",children:"M√™s Anterior"}),e.jsx("button",{onClick:()=>l("ano_atual"),className:"px-3 py-2 text-sm bg-blue-50 text-blue-700 rounded-md hover:bg-blue-100",children:"Ano Atual"})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Per√≠odo (M√™s/Ano)"}),e.jsx("input",{type:"month",value:m,onChange:J=>k(J.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:w,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",children:[e.jsx($a,{size:18}),"Atualizar"]})})]})}),r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-green-500 text-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm opacity-90",children:"Receita Bruta"}),e.jsx(Ma,{className:"w-5 h-5"})]}),e.jsx("div",{className:"text-3xl font-bold",children:x(((_=r.totais)==null?void 0:_.receita_bruta)||0)}),e.jsx("div",{className:"text-xs mt-1 opacity-80",children:"Base de c√°lculo"})]}),e.jsxs("div",{className:"bg-red-500 text-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm opacity-90",children:"CMV"}),e.jsx(Oa,{className:"w-5 h-5"})]}),e.jsx("div",{className:"text-3xl font-bold",children:x(((S=r.totais)==null?void 0:S.cmv)||0)}),e.jsxs("div",{className:"text-xs mt-1 opacity-80",children:[b(u(($=r.totais)==null?void 0:$.cmv,(K=r.totais)==null?void 0:K.receita_bruta))," da receita"]})]}),e.jsxs("div",{className:"bg-blue-500 text-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm opacity-90",children:"Lucro Bruto"}),e.jsx(za,{className:"w-5 h-5"})]}),e.jsx("div",{className:"text-3xl font-bold",children:x(((re=r.totais)==null?void 0:re.lucro_bruto)||0)}),e.jsx("div",{className:"text-xs mt-1 opacity-80",children:"Ap√≥s custos"})]}),e.jsxs("div",{className:"bg-purple-500 text-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm opacity-90",children:"Margem Bruta"}),e.jsx(en,{className:"w-5 h-5"})]}),e.jsx("div",{className:"text-3xl font-bold",children:b(((M=r.totais)==null?void 0:M.margem_bruta)||0)}),e.jsx("div",{className:"text-xs mt-1 opacity-80",children:"Rentabilidade"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(ha,{size:20,className:"text-blue-600"}),"An√°lise por Canal de Vendas"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Selecione os canais para adicionar suas m√©tricas na tabela DRE"})]}),f.length>0&&e.jsx("button",{onClick:p,className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"Limpar Sele√ß√£o"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:j.map(J=>{const te=f.includes(J.id),L={blue:te?"bg-blue-600 text-white border-blue-600":"bg-blue-50 text-blue-700 border-blue-200 hover:bg-blue-100",yellow:te?"bg-yellow-500 text-white border-yellow-500":"bg-yellow-50 text-yellow-700 border-yellow-200 hover:bg-yellow-100",orange:te?"bg-orange-500 text-white border-orange-500":"bg-orange-50 text-orange-700 border-orange-200 hover:bg-orange-100",green:te?"bg-green-600 text-white border-green-600":"bg-green-50 text-green-700 border-green-200 hover:bg-green-100"};return e.jsxs("button",{onClick:()=>i(J.id),className:`${L[J.cor]} border-2 rounded-lg p-4 transition-all duration-200 transform ${te?"scale-105 shadow-lg":"hover:scale-102"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:J.nome}),te&&e.jsx(ha,{size:20,className:"flex-shrink-0"})]}),te&&e.jsx("div",{className:"text-xs mt-1 opacity-90",children:"Ativo na tabela"})]},J.id)})}),f.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Et,{size:18,className:"text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("span",{className:"font-semibold",children:[f.length," canal(is) selecionado(s)."]})," ","As m√©tricas de cada canal ser√£o adicionadas na tabela DRE abaixo com suas respectivas receitas, custos e lucros."]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descri√ß√£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"% Receita"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(R=r==null?void 0:r.linhas)==null?void 0:R.map((J,te)=>{const L=J.nivel===0,Z=J.nivel===1,A=J.cor_bg!=="#ffffff"?{backgroundColor:J.cor_bg}:{},G={color:J.cor};return e.jsxs("tr",{style:A,className:L?"font-bold":"",children:[e.jsx("td",{className:`px-6 py-3 ${Z?"pl-12":""} ${L?"font-bold":""}`,style:G,children:J.descricao}),e.jsx("td",{className:`px-6 py-3 text-right ${L?"font-bold":""}`,style:G,children:x(J.valor)}),e.jsx("td",{className:`px-6 py-3 text-right ${L?"font-bold":""}`,style:G,children:b(J.percentual)})]},te)})})]})}),f.length===0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-blue-800",children:"√∞≈∏‚Äô¬° A DRE agora mostra automaticamente todos os canais com vendas no per√É¬≠odo selecionado."})})]}),!r&&!o&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-12 text-center",children:[e.jsx(Xa,{className:"mx-auto mb-4 text-gray-400",size:64}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Selecione um per√≠odo e clique em Atualizar para visualizar o DRE"})]})]}),s==="extrato"&&e.jsx(fd,{}),s==="analise"&&e.jsx(jd,{dados:r,periodo:{mes:m.mes,ano:m.ano}}),e.jsx(id,{isOpen:t,onClose:()=>d(!1),contexto:{tipo:"DRE",periodo:`${m.mes}/${m.ano}`,valor:r==null?void 0:r.lucro_liquido,dados:r}})]})},yd=s=>{const n={critico:"bg-red-100 text-red-800 border-red-200",alerta:"bg-yellow-100 text-yellow-800 border-yellow-200",ok:"bg-green-100 text-green-800 border-green-200"};return n[s]||n.ok},Nd=s=>s==="critico"?e.jsx(Da,{className:"w-5 h-5"}):s==="alerta"?e.jsx(Da,{className:"w-5 h-5"}):e.jsx(ha,{className:"w-5 h-5"}),_d=s=>s==="melhorando"?e.jsx(Ma,{className:"w-5 h-5 text-green-600"}):s==="piorando"?e.jsx(Oa,{className:"w-5 h-5 text-red-600"}):e.jsx(xr,{className:"w-5 h-5 text-gray-600"});function wd({indices:s}){const[n,t]=a.useState(null);if(!s)return e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Nenhum √≠ndice dispon√≠vel"});const{saldo_atual:d,dias_de_caixa:o,status:g,tendencia:r,score_saude:v,receita_mensal_estimada:j,despesa_mensal_estimada:f,percentual_variacao_7d:y}=s;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 relative group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(za,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"relative",children:[_d(r),e.jsx("button",{onMouseEnter:()=>t("saldo"),onMouseLeave:()=>t(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:e.jsx(Wt,{className:"w-4 h-4"})}),n==="saldo"&&e.jsxs("div",{className:"absolute -right-40 top-8 bg-gray-900 text-white text-xs rounded p-2 w-48 z-10 whitespace-normal",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Saldo Atual"}),e.jsx("p",{children:"Seu saldo de caixa real neste momento. O n√∫mero verde ao lado mostra a varia√ß√£o dos √∫ltimos 7 dias."})]})]})]}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Saldo Atual"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(d||0)}),y&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[y>0?"+":"",y.toFixed(1),"% em 7 dias"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 relative group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(Cs,{className:"w-6 h-6 text-purple-600"})}),e.jsx("button",{onMouseEnter:()=>t("dias"),onMouseLeave:()=>t(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Wt,{className:"w-4 h-4"})}),n==="dias"&&e.jsxs("div",{className:"absolute -right-40 top-8 bg-gray-900 text-white text-xs rounded p-2 w-48 z-10 whitespace-normal",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Dias de Caixa"}),e.jsx("p",{children:"Quantos dias voc√™ consegue pagar as despesas com seu saldo atual. Se tem R$ 10.000 e gasta R$ 1.000/dia = 10 dias."})]})]}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Dias de Caixa"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[(o==null?void 0:o.toFixed(1))||"0.0"," dias"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:o<7?"Cr√≠tico - menos de 1 semana":o<15?"Alerta - menos de 2 semanas":"Saud√°vel"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 relative group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${yd(g)}`,children:Nd(g)}),e.jsx("button",{onMouseEnter:()=>t("status"),onMouseLeave:()=>t(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Wt,{className:"w-4 h-4"})}),n==="status"&&e.jsxs("div",{className:"absolute -right-40 top-8 bg-gray-900 text-white text-xs rounded p-2 w-48 z-10 whitespace-normal",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Status"}),e.jsxs("p",{children:[e.jsx("strong",{children:"CRITICO:"})," <7 dias (risco iminente). ",e.jsx("strong",{children:"ALERTA:"})," 7-15 dias. ",e.jsx("strong",{children:"OK:"})," >15 dias."]})]})]}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Status"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 capitalize",children:g||"N/A"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1 capitalize",children:["Tend√™ncia: ",r||"est√°vel"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 relative group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(Jn,{className:"w-6 h-6 text-green-600"})}),e.jsx("button",{onMouseEnter:()=>t("score"),onMouseLeave:()=>t(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Wt,{className:"w-4 h-4"})}),n==="score"&&e.jsxs("div",{className:"absolute -right-40 top-8 bg-gray-900 text-white text-xs rounded p-2 w-48 z-10 whitespace-normal",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Score de Sa√∫de"}),e.jsx("p",{children:"Nota de 0-100 que resume a sa√∫de financeira. Considera dias de caixa, tend√™ncia e volatilidade."})]})]}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Score de Sa√∫de"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[(v==null?void 0:v.toFixed(0))||"0","/100"]}),e.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${v>=70?"bg-green-600":v>=40?"bg-yellow-600":"bg-red-600"}`,style:{width:`${v||0}%`}})})]}),j&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(Ma,{className:"w-6 h-6 text-green-600"})})}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Receita Mensal"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(j)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Estimativa"})]}),f&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:e.jsx(Oa,{className:"w-6 h-6 text-red-600"})})}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Despesa Mensal"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(f)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Estimativa"})]})]})}const ot=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0}).format(s),gn=s=>{try{const n=sl(s);return tn(n,"dd/MMM",{locale:Lr})}catch{return s}},Fo=({active:s,payload:n})=>{if(!s||!n||!n.length)return null;const t=n[0].payload;return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-lg border border-gray-200",children:[e.jsx("p",{className:"font-medium text-gray-900 mb-2",children:gn(t.data_projetada)}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{className:"text-blue-600",children:["Saldo: ",e.jsx("strong",{children:ot(t.saldo_estimado)})]}),t.limite_superior&&e.jsxs("p",{className:"text-green-600",children:["Otimista: ",ot(t.limite_superior)]}),t.limite_inferior&&e.jsxs("p",{className:"text-red-600",children:["Pessimista: ",ot(t.limite_inferior)]}),t.alerta_nivel&&e.jsxs("p",{className:`font-medium ${t.alerta_nivel==="critico"?"text-red-600":t.alerta_nivel==="alerta"?"text-yellow-600":"text-green-600"}`,children:["Status: ",t.alerta_nivel]})]})]})};function ir({projecoes:s,titulo:n="Proje√ß√£o de Fluxo de Caixa",detalhado:t=!1}){var g,r,v,j,f,y;if(!s||s.length===0)return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:n}),e.jsx("div",{className:"text-center py-8 text-gray-500",children:'Nenhuma proje√ß√£o dispon√≠vel. Clique em "Atualizar Proje√ß√£o" para gerar.'})]});const d=s.map(c=>({...c,data_formatada:gn(c.data_projetada),saldo:c.saldo_estimado||0,superior:c.limite_superior||null,inferior:c.limite_inferior||null})),o=d.some(c=>c.superior!==null||c.inferior!==null);return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:n}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Saldo Inicial"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:ot(((g=d[0])==null?void 0:g.saldo)||0)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Saldo Final"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:ot(((r=d[d.length-1])==null?void 0:r.saldo)||0)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Varia√ß√£o"}),e.jsx("p",{className:`text-lg font-bold ${((v=d[d.length-1])==null?void 0:v.saldo)-((j=d[0])==null?void 0:j.saldo)>=0?"text-green-600":"text-red-600"}`,children:ot((((f=d[d.length-1])==null?void 0:f.saldo)||0)-(((y=d[0])==null?void 0:y.saldo)||0))})]})]}),e.jsx(qa,{width:"100%",height:t?400:300,children:o?e.jsxs(el,{data:d,children:[e.jsx(Ba,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Ua,{dataKey:"data_formatada",stroke:"#6b7280",style:{fontSize:"12px"}}),e.jsx(Ta,{stroke:"#6b7280",style:{fontSize:"12px"},tickFormatter:c=>`R$ ${(c/1e3).toFixed(0)}k`}),e.jsx(Aa,{content:e.jsx(Fo,{})}),e.jsx(Va,{}),e.jsx(go,{type:"monotone",dataKey:"superior",stroke:"#10b981",fill:"#d1fae5",fillOpacity:.3,name:"Cen√°rio Otimista"}),e.jsx(go,{type:"monotone",dataKey:"inferior",stroke:"#ef4444",fill:"#fee2e2",fillOpacity:.3,name:"Cen√°rio Pessimista"}),e.jsx(ls,{type:"monotone",dataKey:"saldo",stroke:"#3b82f6",strokeWidth:3,dot:{r:4,fill:"#3b82f6"},name:"Saldo Estimado"})]}):e.jsxs(ct,{data:d,children:[e.jsx(Ba,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Ua,{dataKey:"data_formatada",stroke:"#6b7280",style:{fontSize:"12px"}}),e.jsx(Ta,{stroke:"#6b7280",style:{fontSize:"12px"},tickFormatter:c=>`R$ ${(c/1e3).toFixed(0)}k`}),e.jsx(Aa,{content:e.jsx(Fo,{})}),e.jsx(Va,{}),e.jsx(ls,{type:"monotone",dataKey:"saldo",stroke:"#3b82f6",strokeWidth:3,dot:{r:4,fill:"#3b82f6"},name:"Saldo Estimado"})]})}),d.some(c=>c.vai_faltar_caixa)&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800 font-medium",children:"‚ö†Ô∏è Aten√ß√£o: Proje√ß√£o indica que o caixa pode ficar negativo nos pr√≥ximos dias!"})})]})}const Cd=s=>{const n={critico:{icon:Da,bgColor:"bg-red-50",borderColor:"border-red-200",textColor:"text-red-800",iconColor:"text-red-600"},alerta:{icon:da,bgColor:"bg-yellow-50",borderColor:"border-yellow-200",textColor:"text-yellow-800",iconColor:"text-yellow-600"},aviso:{icon:Mr,bgColor:"bg-blue-50",borderColor:"border-blue-200",textColor:"text-blue-800",iconColor:"text-blue-600"},info:{icon:ha,bgColor:"bg-green-50",borderColor:"border-green-200",textColor:"text-green-800",iconColor:"text-green-600"}};return n[s]||n.info};function $o({alertas:s}){if(!s||s.length===0)return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Alertas do Caixa"}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ha,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Nenhum alerta no momento"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Seu caixa est√° saud√°vel! üéâ"})]})]});const n={critico:0,alerta:1,aviso:2,info:3},t=[...s].sort((d,o)=>(n[d.tipo]||3)-(n[o.tipo]||3));return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Alertas do Caixa"}),e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-sm rounded-full",children:t.length})]}),e.jsx("div",{className:"space-y-3",children:t.map((d,o)=>{const g=Cd(d.tipo),r=g.icon;return e.jsx("div",{className:`p-4 rounded-lg border ${g.bgColor} ${g.borderColor}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(r,{className:`w-5 h-5 flex-shrink-0 mt-0.5 ${g.iconColor}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-medium ${g.textColor} mb-1`,children:d.titulo}),e.jsx("p",{className:`text-sm ${g.textColor} opacity-90`,children:d.mensagem}),d.data&&e.jsx("p",{className:`text-xs ${g.textColor} opacity-70 mt-2`,children:new Date(d.data).toLocaleString("pt-BR")})]})]})},o)})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 grid grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:t.filter(d=>d.tipo==="critico").length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Cr√≠ticos"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:t.filter(d=>d.tipo==="alerta").length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Alertas"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:t.filter(d=>d.tipo==="aviso").length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Avisos"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:t.filter(d=>d.tipo==="info").length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Infos"})]})]})]})}const Po=[{id:"otimista",nome:"Otimista",descricao:"Aumento de 20% nas receitas e redu√ß√£o de 10% nas despesas",icon:Ma,color:"green"},{id:"realista",nome:"Realista",descricao:"Mant√©m o padr√£o atual de receitas e despesas",icon:xr,color:"blue"},{id:"pessimista",nome:"Pessimista",descricao:"Redu√ß√£o de 20% nas receitas e aumento de 10% nas despesas",icon:Oa,color:"red"}];function kd({userId:s,projecoesBase:n=[]}){var y,c,m,k,w,x,b,u,i,p,l,C,h,_,S,$,K,re,M;const[t,d]=a.useState("realista"),[o,g]=a.useState(!1),[r,v]=a.useState(null),j=async()=>{g(!0);try{const J={Authorization:`Bearer ${localStorage.getItem("token")}`},te=await F.post(`/api/ia/fluxo/simular-cenario/${s}`,{cenario:t},{headers:J});v(te.data),ce.success(`Cen√°rio ${t} simulado com sucesso!`)}catch(R){console.error("Erro ao simular cen√°rio:",R),ce.error("Erro ao simular cen√°rio")}finally{g(!1)}},f=Po.find(R=>R.id===t);return f==null||f.icon,e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Simulador de Cen√°rios"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Simule diferentes cen√°rios para entender o impacto no seu fluxo de caixa"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:Po.map(R=>{const J=R.icon,te=t===R.id;return e.jsxs("button",{onClick:()=>d(R.id),className:`p-4 rounded-lg border-2 transition-all text-left ${te?`border-${R.color}-500 bg-${R.color}-50`:"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(J,{className:`w-6 h-6 ${te?`text-${R.color}-600`:"text-gray-400"}`}),e.jsx("h4",{className:`font-semibold ${te?`text-${R.color}-900`:"text-gray-900"}`,children:R.nome})]}),e.jsx("p",{className:`text-sm ${te?`text-${R.color}-700`:"text-gray-600"}`,children:R.descricao})]},R.id)})}),e.jsx("button",{onClick:j,disabled:o,className:"w-full md:w-auto px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Simulando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Yn,{className:"w-5 h-5"}),"Simular Cen√°rio"]})})]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Compara√ß√£o: Base vs ",f==null?void 0:f.nome]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-3",children:"Cen√°rio Atual"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Saldo Final"}),e.jsx("span",{className:"font-semibold text-gray-900",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(((y=n==null?void 0:n[(n==null?void 0:n.length)-1])==null?void 0:y.saldo_estimado)||0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Varia√ß√£o"}),e.jsx("span",{className:"font-semibold text-gray-900",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format((((c=n==null?void 0:n[(n==null?void 0:n.length)-1])==null?void 0:c.saldo_estimado)||0)-(((m=n==null?void 0:n[0])==null?void 0:m.saldo_estimado)||0))})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-700 mb-3",children:["Cen√°rio ",f==null?void 0:f.nome]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Saldo Final"}),e.jsx("span",{className:`font-semibold ${t==="otimista"?"text-green-600":t==="pessimista"?"text-red-600":"text-blue-600"}`,children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(((x=(w=r==null?void 0:r.projecoes_ajustadas)==null?void 0:w[((k=r==null?void 0:r.projecoes_ajustadas)==null?void 0:k.length)-1])==null?void 0:x.saldo_ajustado)||0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Varia√ß√£o"}),e.jsx("span",{className:`font-semibold ${t==="otimista"?"text-green-600":t==="pessimista"?"text-red-600":"text-blue-600"}`,children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format((((i=(u=r==null?void 0:r.projecoes_ajustadas)==null?void 0:u[((b=r==null?void 0:r.projecoes_ajustadas)==null?void 0:b.length)-1])==null?void 0:i.saldo_ajustado)||0)-(((l=(p=r==null?void 0:r.projecoes_ajustadas)==null?void 0:p[0])==null?void 0:l.saldo_ajustado)||0))})]})]})]})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Diferen√ßa no Saldo Final"}),e.jsx("span",{className:`text-xl font-bold ${(((_=(h=r==null?void 0:r.projecoes_ajustadas)==null?void 0:h[((C=r==null?void 0:r.projecoes_ajustadas)==null?void 0:C.length)-1])==null?void 0:_.saldo_ajustado)||0)>(((S=n==null?void 0:n[(n==null?void 0:n.length)-1])==null?void 0:S.saldo_estimado)||0)?"text-green-600":"text-red-600"}`,children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format((((re=(K=r==null?void 0:r.projecoes_ajustadas)==null?void 0:K[(($=r==null?void 0:r.projecoes_ajustadas)==null?void 0:$.length)-1])==null?void 0:re.saldo_ajustado)||0)-(((M=n==null?void 0:n[(n==null?void 0:n.length)-1])==null?void 0:M.saldo_estimado)||0))})]})})]}),e.jsx(ir,{projecoes:(r==null?void 0:r.projecoes_ajustadas)||[],titulo:`Proje√ß√£o - Cen√°rio ${f==null?void 0:f.nome}`,detalhado:!0})]}),!r&&n&&n.length>0&&e.jsx(ir,{projecoes:n,titulo:"Proje√ß√£o Atual (Cen√°rio Base)",detalhado:!0})]})}function Sd(){const[s,n]=a.useState(!1),t=[{titulo:"Dias de Caixa",descricao:"Quantos dias seu caixa consegue cobrir as despesas com o saldo atual. Se tem R$ 10.000 e gasta R$ 1.000/dia, ter√° 10 dias de caixa.",formula:"Saldo Atual √∑ Despesa M√©dia Di√°ria",referencia:"√öltimos 30 dias"},{titulo:"Saldo Estimado (Proje√ß√£o)",descricao:"Previs√£o do saldo do caixa para os pr√≥ximos 15 dias, calculada usando intelig√™ncia artificial (Prophet) baseada em hist√≥rico de 30+ dias.",formula:"Saldo Atual + Receitas Previstas - Despesas Previstas",referencia:"Pr√≥ximos 15 dias"},{titulo:"Entrada/Sa√≠da Estimada",descricao:"Previs√£o di√°ria de quanto voc√™ deve receber (entradas) e gastar (sa√≠das) nos pr√≥ximos dias.",formula:"M√©dia hist√≥rica √∑ 30 dias √ó fator sazonalidade",referencia:"Pr√≥ximos 15 dias"},{titulo:"Status do Caixa",descricao:"Classifica√ß√£o da sa√∫de financeira: CRITICO (<7 dias), ALERTA (7-15 dias) ou OK (>15 dias)",formula:'Status = IF(dias_caixa < 7) "CRITICO" ELSE IF(dias_caixa < 15) "ALERTA" ELSE "OK"',referencia:"Dados em tempo real"}],d=[{nome:"Vis√£o Geral",conteudo:"Mostra os √≠ndices principais de sa√∫de do caixa: quanto tempo de saldo voc√™ tem, a tend√™ncia (melhorando/piorando), despesa m√©dia di√°ria e score geral de sa√∫de.",periodo:"√öltimos 30 dias de hist√≥rico"},{nome:"Proje√ß√µes 15 Dias",conteudo:"Gr√°fico e tabela com a previs√£o de saldo di√°rio para os pr√≥ximos 15 dias. Usa algoritmo Prophet com intelig√™ncia artificial.",periodo:"Pr√≥ximos 15 dias a partir de hoje"},{nome:"Alertas",conteudo:"Lista autom√°tica de avisos: se o caixa est√° cr√≠tico, se h√° risco de falta de saldo, ou se a tend√™ncia est√° piorando.",periodo:"Monitoramento cont√≠nuo"},{nome:"Simulador",conteudo:"Permite simular 3 cen√°rios: OTIMISTA (+20% receita, -10% despesa), REALISTA (sem mudan√ßas) e PESSIMISTA (-20% receita, +10% despesa).",periodo:"Pr√≥ximos 15 dias com mudan√ßas aplicadas"}];return e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg p-6",children:[e.jsxs("button",{onClick:()=>n(!s),className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Mr,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Entenda os Dados"})]}),e.jsx(Ls,{className:`w-5 h-5 text-blue-600 transition-transform ${s?"rotate-180":""}`})]}),s&&e.jsxs("div",{className:"mt-6 space-y-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-gray-900 mb-4",children:"O que cada aba mostra?"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:d.map((o,g)=>e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:o.nome}),e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:o.conteudo}),e.jsxs("p",{className:"text-xs text-blue-600 font-medium",children:["üìÖ ",o.periodo]})]},g))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-gray-900 mb-4",children:"M√©tricas Explicadas"}),e.jsx("div",{className:"space-y-4",children:t.map((o,g)=>e.jsx("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-blue-600",children:g+1})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:o.titulo}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:o.descricao}),e.jsxs("div",{className:"mt-2 text-xs space-y-1",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("strong",{children:"C√°lculo:"})," ",o.formula]}),e.jsxs("p",{className:"text-blue-600",children:[e.jsx("strong",{children:"Per√≠odo:"})," ",o.referencia]})]})]})]})},g))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-gray-900 mb-4",children:"Perguntas Frequentes"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:'‚ùì Qual per√≠odo a "Vis√£o Geral" est√° analisando?'}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Os √∫ltimos ",e.jsx("strong",{children:"30 dias"})," de movimenta√ß√µes realizadas. Ela calcula a despesa m√©dia desse per√≠odo para determinar quantos dias de caixa voc√™ tem."]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:"‚ùì O gr√°fico de Proje√ß√µes √© confi√°vel?"}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Usa algoritmo Prophet (intelig√™ncia artificial) que aprende com os √∫ltimos ",e.jsx("strong",{children:"30+ dias"})," de dados. Quanto mais hist√≥rico, mais preciso. Funciona bem para tend√™ncias, mas n√£o prev√™ eventos inesperados."]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:"‚ùì O Simulador altera meus dados reais?"}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"N√ÉO!"}),' √â apenas uma simula√ß√£o. Mostra "E se..." ocorressem essas mudan√ßas. Seus dados permanecem intactos.']})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:'‚ùì Como interpretar "Dias de Caixa"?'}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"10 dias"})," = voc√™ pode cobrir ",e.jsx("strong",{children:"10 dias de despesas"})," com saldo atual. Se ",e.jsx("strong",{children:"<7 dias"})," √© cr√≠tico (risco iminente). Se ",e.jsx("strong",{children:"7-15"})," √© alerta. Se ",e.jsx("strong",{children:">15"})," est√° ok."]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:'‚ùì Qual √© a diferen√ßa entre "Saldo Atual" e "Saldo Estimado"?'}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Saldo Atual"})," = saldo real hoje. ",e.jsx("strong",{children:"Saldo Estimado"})," = previs√£o do saldo daqui a X dias (levando em conta receitas/despesas esperadas)."]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-300 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-900 mb-2",children:"üí° Dicas Importantes:"}),e.jsxs("ul",{className:"text-sm text-blue-900 space-y-1",children:[e.jsxs("li",{children:["‚Ä¢ Clique em ",e.jsx("strong",{children:'"Atualizar Proje√ß√£o"'})," para recalcular com dados mais recentes"]}),e.jsx("li",{children:"‚Ä¢ Os Alertas aparecem automaticamente quando h√° risco (caixa <7 dias ou tend√™ncia negativa)"}),e.jsx("li",{children:'‚Ä¢ Use o Simulador para planejar: "E se aumentar despesas de marketing em 20%?"'}),e.jsx("li",{children:"‚Ä¢ Se tiver menos de 30 dias de hist√≥rico, as proje√ß√µes ser√£o mais conservadoras"})]})]})]})]})}function Ed({userId:s}){const[n,t]=a.useState(!0),[d,o]=a.useState(null),[g,r]=a.useState([]),[v,j]=a.useState([]),[f,y]=a.useState("visao-geral");a.useEffect(()=>{c()},[s]);const c=async()=>{t(!0);try{const w={Authorization:`Bearer ${localStorage.getItem("token")}`},[x,b,u]=await Promise.all([F.get(`/ia/fluxo/indices-saude/${s}`,{headers:w}),F.get(`/ia/fluxo/projecoes/${s}?dias=15`,{headers:w}),F.get(`/ia/fluxo/alertas/${s}`,{headers:w})]);o(x.data),r(b.data||[]),j(u.data||[])}catch(k){console.error("Erro ao carregar dados IA:",k),ce.error("Erro ao carregar dados da IA")}finally{t(!1)}},m=async()=>{const k=ce.loading("Gerando proje√ß√£o com Prophet...");try{const x={Authorization:`Bearer ${localStorage.getItem("token")}`};await F.post(`/ia/fluxo/projetar-15-dias/${s}`,{},{headers:x}),ce.success("Proje√ß√£o gerada com sucesso!"),c()}catch(w){console.error("Erro ao gerar proje√ß√£o:",w),ce.error("Erro ao gerar proje√ß√£o")}finally{ce.dismiss(k)}};return n?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(Sd,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ü§ñ Fluxo de Caixa Preditivo"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Intelig√™ncia artificial analisando seu caixa"})]}),e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx($a,{className:"w-4 h-4"}),"Atualizar Proje√ß√£o"]})]}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>y("visao-geral"),className:`px-4 py-2 font-medium transition-colors ${f==="visao-geral"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"Vis√£o Geral"}),e.jsx("button",{onClick:()=>y("projecoes"),className:`px-4 py-2 font-medium transition-colors ${f==="projecoes"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"Proje√ß√µes 15 Dias"}),e.jsxs("button",{onClick:()=>y("alertas"),className:`px-4 py-2 font-medium transition-colors relative ${f==="alertas"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["Alertas",v.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:v.length})]}),e.jsx("button",{onClick:()=>y("simulador"),className:`px-4 py-2 font-medium transition-colors ${f==="simulador"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"Simulador"})]}),e.jsxs("div",{className:"space-y-6",children:[f==="visao-geral"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 border-l-4 border-green-500 p-4 rounded",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"üìä Vis√£o Geral:"})," An√°lise dos √∫ltimos ",e.jsx("strong",{children:"30 dias"})," para calcular a sa√∫de do caixa. Mostra quanto tempo voc√™ consegue manter o neg√≥cio com saldo atual."]})}),e.jsx(wd,{indices:d}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(ir,{projecoes:g.slice(0,7),titulo:"Pr√≥ximos 7 Dias"}),e.jsx($o,{alertas:v.slice(0,3)})]})]}),f==="projecoes"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 p-4 rounded",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"üìà Proje√ß√£o 15 Dias:"})," Previs√£o usando intelig√™ncia artificial (Prophet). Baseada em ",e.jsx("strong",{children:"30+ dias de hist√≥rico"})," para prever entradas e sa√≠das dos pr√≥ximos ",e.jsx("strong",{children:"15 dias"}),". Quanto mais hist√≥rico, mais precisa a previs√£o."]})}),e.jsx(ir,{projecoes:g,titulo:"Proje√ß√£o 15 Dias com Prophet",detalhado:!0})]}),f==="alertas"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border-l-4 border-orange-500 p-4 rounded",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"‚ö†Ô∏è Alertas:"})," Avisos autom√°ticos gerados em tempo real.",e.jsx("strong",{children:" Cr√≠tico"})," = menos de 7 dias de caixa (risco iminente).",e.jsx("strong",{children:" Alerta"})," = 7-15 dias (aten√ß√£o necess√°ria).",e.jsx("strong",{children:" OK"})," = mais de 15 dias (situa√ß√£o confort√°vel)."]})}),e.jsx($o,{alertas:v})]}),f==="simulador"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 border-l-4 border-purple-500 p-4 rounded",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"üéØ Simulador:"})," Teste 3 cen√°rios para os ",e.jsx("strong",{children:"pr√≥ximos 15 dias"}),".",e.jsx("strong",{children:" Otimista:"})," +20% receita, -10% despesa.",e.jsx("strong",{children:" Realista:"})," sem mudan√ßas.",e.jsx("strong",{children:" Pessimista:"})," -20% receita, +10% despesa.",e.jsx("strong",{children:"Seus dados reais n√£o s√£o alterados!"})]})}),e.jsx(kd,{userId:s,projecoesBase:g})]})]})]})}function Fd(){const{user:s}=mt();return e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(Ed,{userId:(s==null?void 0:s.id)||1})})}function $d(){const[s,n]=a.useState([]),[t,d]=a.useState(null),[o,g]=a.useState([]),[r,v]=a.useState(""),[j,f]=a.useState(!1),[y,c]=a.useState(!1),m=a.useRef(null);a.useEffect(()=>{w()},[]),a.useEffect(()=>{t&&x(t)},[t]),a.useEffect(()=>{k()},[o]);const k=()=>{var p;(p=m.current)==null||p.scrollIntoView({behavior:"smooth"})},w=async()=>{try{const p=await F.get("/chat/conversas");n(p.data)}catch(p){console.error("Erro ao carregar conversas:",p)}},x=async p=>{f(!0);try{const l=await F.get(`/chat/conversa/${p}/mensagens`);g(l.data)}catch(l){console.error("Erro ao carregar mensagens:",l),ce.error("Erro ao carregar mensagens")}finally{f(!1)}},b=async()=>{try{const p=await F.post("/chat/nova-conversa",{});n([p.data,...s]),d(p.data.id),g([]),ce.success("Nova conversa criada!")}catch(p){console.error("Erro ao criar conversa:",p),ce.error("Erro ao criar conversa")}},u=async p=>{if(p.preventDefault(),!r.trim()||!t)return;c(!0);const l=r;v("");try{const C=await F.post("/chat/enviar",{conversa_id:t,mensagem:l});g([...o,{id:C.data.mensagem_usuario.id,tipo:"usuario",conteudo:C.data.mensagem_usuario.conteudo,criado_em:C.data.mensagem_usuario.criado_em},{id:C.data.mensagem_ia.id,tipo:"assistente",conteudo:C.data.mensagem_ia.conteudo,criado_em:C.data.mensagem_ia.criado_em}]),w()}catch(C){console.error("Erro ao enviar mensagem:",C),ce.error("Erro ao enviar mensagem"),v(l)}finally{c(!1)}},i=async p=>{if(confirm("Deseja deletar esta conversa?"))try{await F.delete(`/chat/conversa/${p}`),n(s.filter(l=>l.id!==p)),t===p&&(d(null),g([])),ce.success("Conversa deletada")}catch(l){console.error("Erro ao deletar conversa:",l),ce.error("Erro ao deletar conversa")}};return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(mr,{className:"w-8 h-8 text-blue-600"}),"Chat IA Financeiro"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Pergunte sobre seu fluxo de caixa, proje√ß√µes e sa√∫de financeira"})]}),e.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(os,{className:"w-5 h-5"}),"Nova Conversa"]})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"w-80 bg-white border-r border-gray-200 overflow-y-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Conversas Recentes"}),s.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(po,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Nenhuma conversa ainda"}),e.jsx("button",{onClick:b,className:"mt-3 text-blue-600 text-sm hover:underline",children:"Criar primeira conversa"})]}):e.jsx("div",{className:"space-y-2",children:s.map(p=>e.jsx("div",{onClick:()=>d(p.id),className:`p-3 rounded-lg cursor-pointer transition-colors group ${t===p.id?"bg-blue-50 border-2 border-blue-200":"bg-gray-50 hover:bg-gray-100"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:p.titulo||"Nova conversa"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[p.total_mensagens," mensagens"]})]}),e.jsx("button",{onClick:l=>{l.stopPropagation(),i(p.id)},className:"opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-700 transition-opacity",children:e.jsx(hs,{className:"w-4 h-4"})})]})},p.id))})]})}),e.jsx("div",{className:"flex-1 flex flex-col bg-gray-50",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[j?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(dt,{className:"w-8 h-8 animate-spin text-blue-600"})}):o.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(po,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Inicie a conversa fazendo uma pergunta"}),e.jsxs("div",{className:"mt-4 text-sm space-y-1",children:[e.jsx("p",{className:"text-gray-400",children:"Exemplos:"}),e.jsx("p",{className:"text-blue-600",children:'"Qual √© meu saldo atual?"'}),e.jsx("p",{className:"text-blue-600",children:'"Como est√° minha situa√ß√£o financeira?"'}),e.jsx("p",{className:"text-blue-600",children:'"H√° algum alerta?"'})]})]})}):o.map(p=>e.jsx("div",{className:`flex ${p.tipo==="usuario"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex gap-3 max-w-3xl ${p.tipo==="usuario"?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${p.tipo==="usuario"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"}`,children:p.tipo==="usuario"?e.jsx(tr,{className:"w-5 h-5"}):e.jsx(mr,{className:"w-5 h-5"})}),e.jsx("div",{className:`px-4 py-3 rounded-lg ${p.tipo==="usuario"?"bg-blue-600 text-white":"bg-white text-gray-900 border border-gray-200"}`,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:p.conteudo})})]})},p.id)),e.jsx("div",{ref:m})]}),e.jsx("div",{className:"border-t border-gray-200 bg-white p-4",children:e.jsxs("form",{onSubmit:u,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:r,onChange:p=>v(p.target.value),placeholder:"Digite sua pergunta...",disabled:y,className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"}),e.jsx("button",{type:"submit",disabled:y||!r.trim(),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:y?e.jsx(dt,{className:"w-5 h-5 animate-spin"}):e.jsx(Yo,{className:"w-5 h-5"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(mr,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"Selecione ou crie uma conversa"}),e.jsx("p",{className:"text-sm mt-2",children:"Fa√ßa perguntas sobre seu fluxo de caixa e receba an√°lises inteligentes"})]})})})]})]})}const Ra="/whatsapp",ss={async getConfig(){return(await oa.get(`${Ra}/config`)).data},async getStats(){return(await oa.get(`${Ra}/analytics/dashboard`)).data},async getAgents(){return(await oa.get(`${Ra}/agents`)).data},async createAgent(s){return(await oa.post(`${Ra}/agents`,s)).data},async getAgent(s){return(await oa.get(`${Ra}/agents/${s}`)).data},async updateAgent(s,n){return(await oa.put(`${Ra}/agents/${s}`,n)).data},async deleteAgent(s){await oa.delete(`${Ra}/agents/${s}`)},async getHandoffs(s){const n=s?{status:s}:{};return(await oa.get(`${Ra}/handoffs/pending`,{params:n})).data},async createHandoff(s){return(await oa.post(`${Ra}/handoffs`,s)).data},async getHandoff(s){return(await oa.get(`${Ra}/handoffs/${s}`)).data},async assignHandoff(s,n){return(await oa.post(`${Ra}/handoffs/${s}/assign`,{agent_id:n})).data},async resolveHandoff(s,n){await oa.post(`${Ra}/handoffs/${s}/resolve`,{resolution_notes:n})},async cancelHandoff(s){await oa.post(`${Ra}/handoffs/${s}/cancel`)},async getNotes(s){return(await oa.get(`${Ra}/handoffs/${s}/notes`)).data},async addNote(s,n){return(await oa.post(`${Ra}/handoffs/${s}/notes`,{content:n})).data},async getMessages(s){return(await oa.get(`${Ra}/sessions/${s}/messages`)).data},async sendMessage(s,n){return(await oa.post(`${Ra}/messages`,{session_id:s,message:n})).data},async createSession(s){return(await oa.post(`${Ra}/sessions`,s)).data},async getSession(s){return(await oa.get(`${Ra}/sessions/${s}`)).data},async testSentiment(s){return(await oa.post(`${Ra}/sentiment/test`,{text:s})).data}},Pt=Cn()((s,n)=>({stats:null,isLoadingStats:!1,agents:[],currentAgent:null,isLoadingAgents:!1,handoffs:[],activeHandoff:null,isLoadingHandoffs:!1,filterStatus:"all",messages:{},isLoadingMessages:{},isConnected:!1,isSidebarOpen:!0,isBotAssistOpen:!1,notifications:[],fetchStats:async()=>{if(n().isLoadingStats){console.log("‚è≠Ô∏è Stats already loading, skipping...");return}console.log("üìä Fetching stats..."),s({isLoadingStats:!0});const d=new Promise((o,g)=>setTimeout(()=>g(new Error("Stats timeout")),1e4));try{const o=await Promise.race([ss.getStats(),d]);console.log("‚úÖ Stats received:",o),s({stats:o,isLoadingStats:!1})}catch(o){console.error("‚ùå Error fetching stats:",o),s({isLoadingStats:!1})}},fetchAgents:async()=>{s({isLoadingAgents:!0});try{const t=await ss.getAgents();s({agents:t,isLoadingAgents:!1})}catch(t){console.error("Error fetching agents:",t),s({isLoadingAgents:!1})}},initializeCurrentAgent:async()=>{try{console.log("üîÑ Initializing current agent...");const t=localStorage.getItem("user");if(!t){console.warn("‚ö†Ô∏è No user found in localStorage");return}const d=JSON.parse(t);console.log("üë§ User loaded:",d.email);const o=await ss.getAgents();console.log("üìã Agents fetched:",o.length);let g=o.find(r=>r.user_id===d.id);g?(console.log("üîÑ Updating existing agent to online..."),g=await ss.updateAgent(g.id,{status:"online"}),console.log("‚úÖ Agent set to online:",g.id)):(console.log("‚ûï Creating new agent..."),g=await ss.createAgent({name:d.name||d.email,email:d.email,status:"online",max_concurrent_chats:5,auto_assign:!0,receive_notifications:!0}),console.log("‚úÖ Created new agent:",g.id)),s({currentAgent:g}),console.log("‚úÖ Current agent initialized")}catch(t){console.error("‚ùå Error initializing current agent:",t)}},updateAgentStatus:async t=>{const{currentAgent:d}=n();if(d)try{const o=await ss.updateAgent(d.id,{status:t});s({currentAgent:o}),s(g=>({agents:g.agents.map(r=>r.id===o.id?o:r)}))}catch(o){console.error("Error updating agent status:",o)}},fetchHandoffs:async t=>{s({isLoadingHandoffs:!0});try{const d=await ss.getHandoffs(t);s({handoffs:d,isLoadingHandoffs:!1})}catch(d){console.error("Error fetching handoffs:",d),s({isLoadingHandoffs:!1})}},setFilterStatus:t=>{s({filterStatus:t});const d={all:void 0,pending:"pending",active:"active",my:"active"};n().fetchHandoffs(d[t])},takeHandoff:async t=>{const{currentAgent:d}=n();if(d)try{const o=await ss.assignHandoff(t,d.id);s(g=>({handoffs:g.handoffs.map(r=>r.id===o.id?o:r)})),s({activeHandoff:o}),n().addNotification({type:"success",title:"Conversa assumida",message:`Voc√™ assumiu a conversa com ${o.customer_name||o.phone_number}`,timestamp:new Date().toISOString()})}catch(o){console.error("Error taking handoff:",o),n().addNotification({type:"error",title:"Erro",message:"N√£o foi poss√≠vel assumir a conversa",timestamp:new Date().toISOString()})}},resolveHandoff:async(t,d)=>{try{await ss.resolveHandoff(t,d),s(o=>{var g;return{handoffs:o.handoffs.filter(r=>r.id!==t),activeHandoff:((g=o.activeHandoff)==null?void 0:g.id)===t?null:o.activeHandoff}}),n().addNotification({type:"success",title:"Conversa resolvida",message:"A conversa foi finalizada com sucesso",timestamp:new Date().toISOString()}),n().fetchStats()}catch(o){console.error("Error resolving handoff:",o),n().addNotification({type:"error",title:"Erro",message:"N√£o foi poss√≠vel resolver a conversa",timestamp:new Date().toISOString()})}},setActiveHandoff:t=>{s({activeHandoff:t})},fetchMessages:async t=>{s(d=>({isLoadingMessages:{...d.isLoadingMessages,[t]:!0}}));try{const d=await ss.getMessages(t);s(o=>({messages:{...o.messages,[t]:d},isLoadingMessages:{...o.isLoadingMessages,[t]:!1}}))}catch(d){console.error("Error fetching messages:",d),s(o=>({isLoadingMessages:{...o.isLoadingMessages,[t]:!1}}))}},sendMessage:async(t,d)=>{try{const o=await ss.sendMessage(t,d);s(g=>({messages:{...g.messages,[t]:[...g.messages[t]||[],o]}}))}catch(o){console.error("Error sending message:",o),n().addNotification({type:"error",title:"Erro ao enviar",message:"N√£o foi poss√≠vel enviar a mensagem",timestamp:new Date().toISOString()})}},addMessage:(t,d)=>{s(o=>({messages:{...o.messages,[t]:[...o.messages[t]||[],d]}}))},setConnected:t=>s({isConnected:t}),toggleSidebar:()=>s(t=>({isSidebarOpen:!t.isSidebarOpen})),toggleBotAssist:()=>s(t=>({isBotAssistOpen:!t.isBotAssistOpen})),addNotification:t=>{const d=Math.random().toString(36).substring(7);s(o=>({notifications:[...o.notifications,{...t,id:d}]})),setTimeout(()=>{n().removeNotification(d)},5e3)},removeNotification:t=>{s(d=>({notifications:d.notifications.filter(o=>o.id!==t)}))}}));class Pd{constructor(){this.ws=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.reconnectTimeout=null,this.pingInterval=null,this.agentId=null,this.token=null,this.handlers={},this.onConnectionChange=null,this.onMaxReconnectAttemptsReached=null}connect(n,t){var r;if(((r=this.ws)==null?void 0:r.readyState)===WebSocket.OPEN){console.log("WebSocket already connected");return}this.token=n,this.agentId=t;const g=`${"/api".replace("http://","ws://").replace("https://","wss://")}/ws/whatsapp/${t}?token=${n}`;console.log("üîå Connecting to WebSocket:",g);try{this.ws=new WebSocket(g),this.setupEventListeners()}catch(v){console.error("Error creating WebSocket:",v),this.handleReconnect()}}disconnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null),this.ws&&(this.ws.readyState===WebSocket.OPEN&&this.send({event:"leave_agent_room"}),this.ws.close(),this.ws=null),this.reconnectAttempts=0,this.token=null,this.agentId=null}setupEventListeners(){this.ws&&(this.ws.onopen=()=>{console.log("‚úÖ WebSocket connected"),this.reconnectAttempts=0,this.onConnectionChange&&this.onConnectionChange(!0),this.send({event:"join_agent_room"}),this.pingInterval=window.setInterval(()=>{var n;((n=this.ws)==null?void 0:n.readyState)===WebSocket.OPEN&&this.send({event:"ping"})},3e4)},this.ws.onclose=n=>{console.log("‚ùå WebSocket disconnected:",n.code,n.reason),this.onConnectionChange&&this.onConnectionChange(!1),n.code!==1e3&&this.handleReconnect()},this.ws.onerror=n=>{console.error("WebSocket error:",n)},this.ws.onmessage=n=>{try{const t=JSON.parse(n.data);this.handleMessage(t)}catch(t){console.error("Error parsing WebSocket message:",t)}})}handleMessage(n){const{event:t,data:d}=n;switch(console.log("üì© WebSocket message:",t,d),t){case"connected":console.log("Connection confirmed:",d);break;case"new_handoff":this.handlers.onNewHandoff&&this.handlers.onNewHandoff(d);break;case"handoff_assigned":this.handlers.onHandoffAssigned&&this.handlers.onHandoffAssigned(d);break;case"handoff_resolved":this.handlers.onHandoffResolved&&this.handlers.onHandoffResolved(d.handoff_id);break;case"new_message":this.handlers.onNewMessage&&this.handlers.onNewMessage(d.session_id,d.message);break;case"agent_status_change":this.handlers.onAgentStatusChange&&this.handlers.onAgentStatusChange(d);break;case"typing_indicator":this.handlers.onTypingIndicator&&this.handlers.onTypingIndicator(d.session_id,d.is_typing);break;default:console.warn("Unknown WebSocket event:",t)}}handleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached"),this.onMaxReconnectAttemptsReached&&this.onMaxReconnectAttemptsReached();return}this.reconnectAttempts++;const n=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`Reconnecting in ${n}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})...`),this.reconnectTimeout=setTimeout(()=>{this.token&&this.agentId&&this.connect(this.token,this.agentId)},n)}send(n){var t;((t=this.ws)==null?void 0:t.readyState)===WebSocket.OPEN?this.ws.send(JSON.stringify(n)):console.warn("WebSocket is not open. Cannot send message:",n)}registerHandlers(n){this.handlers=n}joinAgentRoom(n){this.send({event:"join_agent_room",data:{agent_id:n}})}leaveAgentRoom(n){this.send({event:"leave_agent_room",data:{agent_id:n}})}sendTypingIndicator(n,t){this.send({event:"typing",data:{session_id:n,is_typing:t}})}isConnected(){var n;return((n=this.ws)==null?void 0:n.readyState)===WebSocket.OPEN}getSocketId(){return this.agentId}}const ms=new Pd,Rd=(s,n)=>{const[t,d]=a.useState(!1),{addNotification:o,fetchHandoffs:g,setConnected:r,addMessage:v,fetchStats:j}=Pt();return a.useEffect(()=>{if(!(!s||!n||t))return d(!0),console.log("üîå useSocket: Initializing WebSocket connection..."),ms.onConnectionChange=f=>{r(f),o(f?{type:"success",title:"Conectado",message:"Conex√£o com servidor estabelecida",timestamp:new Date().toISOString()}:{type:"warning",title:"Desconectado",message:"Tentando reconectar ao servidor...",timestamp:new Date().toISOString()})},ms.onMaxReconnectAttemptsReached=()=>{o({type:"error",title:"Erro de Conex√£o",message:"N√£o foi poss√≠vel conectar ao servidor. Recarregue a p√°gina.",timestamp:new Date().toISOString()})},ms.registerHandlers({onNewHandoff:f=>{console.log("üÜï New handoff received:",f),g(),o({type:"info",title:"Nova Conversa",message:`${f.customer_name||f.phone_number} precisa de ajuda`,timestamp:new Date().toISOString()}),hn("Nova Conversa - WhatsApp",`${f.customer_name||f.phone_number} - ${f.reason}`,f.priority),(f.priority==="urgent"||f.priority==="high")&&Ro()},onHandoffAssigned:f=>{console.log("üë§ Handoff assigned:",f),g(),f.assigned_agent_id===n&&o({type:"success",title:"Conversa Atribu√≠da",message:`Voc√™ foi atribu√≠do √† conversa com ${f.customer_name||f.phone_number}`,timestamp:new Date().toISOString()})},onHandoffResolved:f=>{console.log("‚úÖ Handoff resolved:",f),g(),j()},onNewMessage:(f,y)=>{console.log("üí¨ New message:",f,y),v(f,y),y.sender_type==="customer"&&(o({type:"info",title:"Nova Mensagem",message:y.content.substring(0,50)+"...",timestamp:new Date().toISOString()}),Ro("message"))},onAgentStatusChange:f=>{console.log("üìä Agent status changed:",f),j()},onTypingIndicator:(f,y)=>{console.log("‚å®Ô∏è Typing indicator:",f,y)}}),ms.connect(s,n),()=>{ms.disconnect()}},[s,n]),{isConnected:ms.isConnected(),socketId:ms.getSocketId(),sendTypingIndicator:ms.sendTypingIndicator.bind(ms)}};function hn(s,n,t){if(!("Notification"in window)){console.warn("Browser does not support notifications");return}if(Notification.permission==="granted"){const d=new Notification(s,{body:n,icon:"/logo192.png",badge:"/logo192.png",tag:"whatsapp-notification",requireInteraction:t==="urgent",silent:!1});d.onclick=()=>{window.focus(),d.close()},setTimeout(()=>d.close(),1e4)}else Notification.permission!=="denied"&&Notification.requestPermission().then(d=>{d==="granted"&&hn(s,n,t)})}function Ro(s="handoff"){try{const n=new Audio(s==="handoff"?"/sounds/notification-handoff.mp3":"/sounds/notification-message.mp3");n.volume=.5,n.play().catch(t=>{console.warn("Could not play notification sound:",t)})}catch(n){console.warn("Error playing sound:",n)}}class Ad extends a.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,t){console.error("ErrorBoundary caught an error:",n,t)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900 text-center mb-2",children:"Algo deu errado"}),e.jsx("p",{className:"text-sm text-gray-600 text-center mb-6",children:"Ocorreu um erro inesperado. Por favor, recarregue a p√°gina."}),this.state.error&&e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded border border-gray-200",children:e.jsx("p",{className:"text-xs font-mono text-gray-700 break-words",children:this.state.error.message})}),e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Recarregar P√°gina"})]})}):this.props.children}}const Dd=a.memo(({stats:s,isLoading:n})=>{if(n)return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[...Array(6)].map((d,o)=>e.jsxs("div",{className:"bg-gray-100 rounded-lg p-4 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-3/4"})]},o))});if(!s)return null;const t=[{label:"Total",value:s.total_handoffs,icon:"üí¨",color:"bg-blue-50 text-blue-700"},{label:"Aguardando",value:s.pending_count,icon:"‚è≥",color:"bg-yellow-50 text-yellow-700"},{label:"Ativas",value:s.active_count,icon:"üí≠",color:"bg-green-50 text-green-700"},{label:"Resolvidas",value:s.resolved_count,icon:"‚úÖ",color:"bg-gray-50 text-gray-700"},{label:"Agentes Online",value:s.available_agents||0,icon:"üë§",color:"bg-purple-50 text-purple-700"},{label:"Tempo M√©dio",value:s.avg_response_time_seconds?Math.round(s.avg_response_time_seconds/60)+"min":"0min",icon:"‚ö°",color:"bg-orange-50 text-orange-700"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:t.map((d,o)=>e.jsxs("div",{className:`rounded-lg p-4 ${d.color}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-lg",children:d.icon}),e.jsx("p",{className:"text-xs font-medium opacity-75",children:d.label})]}),e.jsx("p",{className:"text-2xl font-bold",children:d.value})]},o))})}),Md=a.memo(({agents:s,isLoading:n})=>{const{currentAgent:t,updateAgentStatus:d}=Pt(),o={online:"bg-green-500",busy:"bg-yellow-500",away:"bg-orange-500",offline:"bg-gray-400"},g={online:"Online",busy:"Ocupado",away:"Ausente",offline:"Offline"};return n?e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((r,v)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg animate-pulse",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3 mb-1"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-1/2"})]})]},v))}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:["Agentes (",s.length,")"]}),s.map(r=>e.jsxs("div",{className:`
            flex items-center gap-3 p-2 rounded-lg transition-colors
            ${(t==null?void 0:t.id)===r.id?"bg-blue-50":"hover:bg-gray-50"}
          `,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${o[r.status]}`}),r.status==="online"&&e.jsx("div",{className:`absolute inset-0 w-2 h-2 rounded-full ${o[r.status]} animate-ping opacity-75`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:g[r.status]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[r.current_chats,"/",r.max_concurrent_chats]})]})]}),(t==null?void 0:t.id)===r.id&&e.jsxs("select",{value:r.status,onChange:v=>d(v.target.value),className:"text-xs border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"busy",children:"Ocupado"}),e.jsx("option",{value:"away",children:"Ausente"}),e.jsx("option",{value:"offline",children:"Offline"})]})]},r.id)),s.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"Nenhum agente dispon√≠vel"})]})}),Ld=a.memo(({handoffs:s,activeHandoff:n,isLoading:t})=>{const{setActiveHandoff:d,takeHandoff:o}=Pt(),g={urgent:"bg-red-100 text-red-700 border-red-200",high:"bg-orange-100 text-orange-700 border-orange-200",medium:"bg-yellow-100 text-yellow-700 border-yellow-200",low:"bg-gray-100 text-gray-700 border-gray-200"},r={urgent:"üö® Urgente",high:"‚ö†Ô∏è Alta",medium:"üìå M√©dia",low:"üìã Baixa"},v={pending:"‚è≥",active:"üí¨",resolved:"‚úÖ",cancelled:"‚ùå"};return t?e.jsx("div",{className:"p-4 space-y-3",children:[...Array(5)].map((j,f)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 animate-pulse",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})]})},f))}):s.length===0?e.jsx("div",{className:"flex items-center justify-center h-full p-8",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-sm font-medium",children:"Nenhuma conversa"})]})}):e.jsx("div",{className:"p-4 space-y-3",children:s.map(j=>{const f=(n==null?void 0:n.id)===j.id,y=j.status==="pending";return e.jsx("div",{onClick:()=>d(j),className:`
              border rounded-lg p-3 cursor-pointer transition-all
              ${f?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:shadow-sm"}
            `,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`
                w-10 h-10 rounded-full flex items-center justify-center text-lg font-semibold
                ${g[j.priority]}
              `,children:j.customer_name?j.customer_name.charAt(0).toUpperCase():"üë§"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:j.customer_name||"Cliente"}),e.jsx("span",{className:"text-xs text-gray-500 whitespace-nowrap",children:tl(new Date(j.created_at),{addSuffix:!0,locale:Lr})})]}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:j.phone_number}),e.jsx("p",{className:"text-sm text-gray-700 mb-2 line-clamp-2",children:j.reason_details||j.reason}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`
                    text-xs px-2 py-1 rounded border
                    ${g[j.priority]}
                  `,children:r[j.priority]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:v[j.status]}),y&&e.jsx("button",{onClick:c=>{c.stopPropagation(),o(j.id)},className:"text-xs px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Assumir"})]})]})]})]})},j.id)})})}),qd=({handoff:s})=>{const{messages:n,isLoadingMessages:t,fetchMessages:d,sendMessage:o,resolveHandoff:g,toggleBotAssist:r}=Pt(),[v,j]=a.useState(""),[f,y]=a.useState(!1),[c,m]=a.useState(""),k=a.useRef(null),w=n[s.session_id]||[],x=t[s.session_id]||!1;a.useEffect(()=>{s.session_id&&d(s.session_id)},[s.session_id]),a.useEffect(()=>{var l;(l=k.current)==null||l.scrollIntoView({behavior:"smooth"})},[w]);const b=async()=>{v.trim()&&(await o(s.session_id,v),j(""))},u=async()=>{if(!c.trim()){alert("Por favor, adicione notas de resolu√ß√£o");return}await g(s.id,c),y(!1),m("")},i=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),b())},p={urgent:"border-red-500 bg-red-50",high:"border-orange-500 bg-orange-50",medium:"border-yellow-500 bg-yellow-50",low:"border-gray-500 bg-gray-50"};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:`border-b-4 ${p[s.priority]} p-4`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white text-lg font-semibold",children:s.customer_name?s.customer_name.charAt(0).toUpperCase():"üë§"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:s.customer_name||"Cliente"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.phone_number})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-white hover:shadow transition-all",title:"Bot Assist",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),s.status==="active"&&e.jsx("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:"Resolver"})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Motivo:"})," ",s.reason]}),s.reason_details&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.reason_details})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:x?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"Carregando mensagens..."})]})}):w.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("p",{className:"text-sm font-medium",children:"Nenhuma mensagem ainda"})]})}):e.jsxs(e.Fragment,{children:[w.map(l=>{const C=l.sender_type==="agent";return l.sender_type==="system"?e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"bg-gray-100 text-gray-600 text-xs px-3 py-1 rounded-full",children:l.content})},l.id):e.jsx("div",{className:`flex ${C?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[70%] ${C?"order-2":"order-1"}`,children:[e.jsx("div",{className:`
                      rounded-lg px-4 py-2
                      ${C?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}
                    `,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:l.content})}),e.jsx("p",{className:`text-xs text-gray-500 mt-1 ${C?"text-right":"text-left"}`,children:tn(new Date(l.timestamp),"HH:mm",{locale:Lr})})]})},l.id)}),e.jsx("div",{ref:k})]})}),s.status==="active"&&!f&&e.jsx("div",{className:"border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("textarea",{value:v,onChange:l=>j(l.target.value),onKeyPress:i,placeholder:"Digite sua mensagem...",rows:3,className:"flex-1 border border-gray-300 rounded-lg px-4 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:b,disabled:!v.trim(),className:"px-6 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-medium",children:"Enviar"})]})}),f&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Resolver Conversa"}),e.jsx("textarea",{value:c,onChange:l=>m(l.target.value),placeholder:"Descreva como foi resolvido o atendimento...",rows:4,className:"w-full border border-gray-300 rounded-lg px-4 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{y(!1),m("")},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:u,disabled:!c.trim(),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:"Confirmar Resolu√ß√£o"})]})]})})]})},zd=({handoff:s})=>{const[n,t]=a.useState(""),[d,o]=a.useState(null),[g,r]=a.useState(!1),v=async()=>{if(n.trim()){r(!0);try{const f=await ss.testSentiment(n);o(f)}catch(f){console.error("Error analyzing sentiment:",f)}finally{r(!1)}}},j=["Entendo sua frustra√ß√£o. Vou verificar isso imediatamente.","Obrigado por aguardar. Estou analisando sua solicita√ß√£o.","Vou encaminhar para o setor respons√°vel e retorno em breve.","Consegui resolver! Precisa de mais alguma coisa?"];return s?e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Bot Assist ü§ñ"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"An√°lise de sentimento e sugest√µes"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Analisar Sentimento"}),e.jsx("textarea",{value:n,onChange:f=>t(f.target.value),placeholder:"Cole uma mensagem do cliente...",rows:4,className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:v,disabled:!n.trim()||g,className:"mt-2 w-full px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:g?"Analisando...":"Analisar"}),d&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Score:"}),e.jsx("span",{className:`text-sm font-bold ${d.score>0?"text-green-600":d.score<0?"text-red-600":"text-gray-600"}`,children:d.score.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Label:"}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:d.label})]}),d.emotions.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Emo√ß√µes:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:d.emotions.map((f,y)=>e.jsx("span",{className:"text-xs px-2 py-0.5 bg-purple-100 text-purple-700 rounded",children:f},y))})]}),d.triggers.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Gatilhos:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:d.triggers.map((f,y)=>e.jsx("span",{className:"text-xs px-2 py-0.5 bg-red-100 text-red-700 rounded",children:f},y))})]}),d.should_handoff&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsx("span",{className:"text-xs font-medium text-red-600",children:"‚ö†Ô∏è Recomenda handoff humano"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Respostas Sugeridas"}),e.jsx("div",{className:"space-y-2",children:j.map((f,y)=>e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(f)},className:"w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg border border-gray-200 text-sm text-gray-700 transition-colors",children:f},y))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"A√ß√µes R√°pidas"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{className:"w-full px-4 py-2 bg-orange-50 text-orange-700 border border-orange-200 rounded-lg text-sm font-medium hover:bg-orange-100 transition-colors",children:"üìã Ver hist√≥rico completo"}),e.jsx("button",{className:"w-full px-4 py-2 bg-purple-50 text-purple-700 border border-purple-200 rounded-lg text-sm font-medium hover:bg-purple-100 transition-colors",children:"üìä An√°lise de perfil"}),e.jsx("button",{className:"w-full px-4 py-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors",children:"üîó Criar ticket"})]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full p-8",children:e.jsx("p",{className:"text-sm text-gray-400 text-center",children:"Selecione uma conversa para ver sugest√µes"})})},Id=({notification:s,onClose:n})=>{const[t,d]=a.useState(!1);a.useEffect(()=>{const r=setTimeout(()=>{d(!0),setTimeout(n,300)},5e3);return()=>clearTimeout(r)},[n]);const o={info:"bg-blue-50 border-blue-200 text-blue-800",success:"bg-green-50 border-green-200 text-green-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800",error:"bg-red-50 border-red-200 text-red-800"},g={info:"‚ÑπÔ∏è",success:"‚úÖ",warning:"‚ö†Ô∏è",error:"‚ùå"};return e.jsx("div",{className:`
        max-w-sm w-full bg-white border-2 rounded-lg shadow-lg p-4
        transform transition-all duration-300 ease-out
        ${t?"translate-x-full opacity-0":"translate-x-0 opacity-100"}
        ${o[s.type]}
      `,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-xl",children:g[s.type]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm mb-1",children:s.title}),e.jsx("p",{className:"text-sm opacity-90",children:s.message})]}),e.jsx("button",{onClick:()=>{d(!0),setTimeout(n,300)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})},Td=a.memo(({isConnected:s,socketId:n})=>e.jsxs("div",{className:`
      flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-medium
      ${s?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}
    `,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`
          w-2 h-2 rounded-full
          ${s?"bg-green-500":"bg-red-500"}
        `}),s&&e.jsx("div",{className:"absolute inset-0 w-2 h-2 bg-green-500 rounded-full animate-ping opacity-75"})]}),e.jsx("span",{children:s?"Online":"Desconectado"}),s&&n&&e.jsxs("span",{className:"text-[10px] opacity-50 font-mono",title:`Socket ID: ${n}`,children:["‚Ä¢ ",n.substring(0,6)]})]})),Vd=()=>{const[s,n]=a.useState("default"),[t,d]=a.useState(!1);a.useEffect(()=>{"Notification"in window&&(n(Notification.permission),Notification.permission==="default"&&d(!0))},[]);const o=async()=>{if("Notification"in window){const g=await Notification.requestPermission();n(g),g==="granted"&&(d(!1),new Notification("Notifica√ß√µes Ativadas",{body:"Voc√™ receber√° alertas de novas conversas",icon:"/logo192.png"}))}};return!t||s==="granted"?null:e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-1",children:"Ativar Notifica√ß√µes"}),e.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"Receba alertas instant√¢neos quando novas conversas precisarem de atendimento"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors",children:"Ativar Notifica√ß√µes"}),e.jsx("button",{onClick:()=>d(!1),className:"px-4 py-2 bg-white text-blue-700 text-sm font-medium rounded-lg border border-blue-200 hover:bg-blue-50 transition-colors",children:"Agora N√£o"})]})]}),e.jsx("button",{onClick:()=>d(!1),className:"flex-shrink-0 text-blue-400 hover:text-blue-600 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})},Od=()=>{const[s,n]=ts.useState(!0);console.log("üéØ WhatsAppDashboard component rendering...");const{stats:t,agents:d,handoffs:o,activeHandoff:g,filterStatus:r,isLoadingStats:v,isLoadingAgents:j,isLoadingHandoffs:f,isSidebarOpen:y,isBotAssistOpen:c,isConnected:m,notifications:k,currentAgent:w,fetchStats:x,fetchAgents:b,fetchHandoffs:u,initializeCurrentAgent:i,setFilterStatus:p,toggleSidebar:l,removeNotification:C}=Pt(),h=localStorage.getItem("access_token"),{socketId:_}=Rd(h,(w==null?void 0:w.id)||null);return a.useEffect(()=>{let S=!0,$=!1,K=null,re=!1;const M=async()=>{if(!(!S||$)){$=!0;try{console.log("üöÄ Initializing WhatsApp Dashboard...");const te=new Promise((L,Z)=>setTimeout(()=>Z(new Error("Initialization timeout")),15e3));try{await Promise.race([Promise.all([i(),x(),b(),u()]),te])}catch(L){console.warn("‚ö†Ô∏è Initialization timeout, continuing anyway:",L)}console.log("‚úÖ Dashboard initialized")}catch(te){console.error("‚ùå Error initializing dashboard:",te)}finally{S&&n(!1)}}},R=async()=>{if(!(re||!S)){if(document.hidden){console.log("‚è∏Ô∏è Page hidden, skipping refresh");return}re=!0,console.log("üîÑ Refreshing dashboard data...");try{await Promise.all([x(),u(r==="all"?void 0:r)])}catch(te){console.error("Error refreshing data:",te)}finally{re=!1}}};M(),K=setInterval(R,6e4);const J=()=>{!document.hidden&&S&&(console.log("üëÅÔ∏è Page visible again, refreshing data"),R())};return document.addEventListener("visibilitychange",J),()=>{S=!1,K&&clearInterval(K),document.removeEventListener("visibilitychange",J)}},[]),s?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando WhatsApp Dashboard..."})]})}):e.jsx(Ad,{children:e.jsxs("div",{className:"flex h-screen bg-gray-50",role:"main","aria-label":"WhatsApp Dashboard",children:[e.jsx("div",{className:`
        transition-all duration-300 ease-in-out
        ${y?"w-80":"w-0"}
        border-r border-gray-200 bg-white overflow-hidden
      `,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Atendimento WhatsApp"}),e.jsx("div",{className:"mt-2",children:e.jsx(Td,{isConnected:m,socketId:_})})]}),e.jsx("button",{onClick:l,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Recolher painel",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"})})})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","active","my"].map(S=>e.jsxs("button",{onClick:()=>p(S),className:`
                    px-3 py-1.5 rounded-lg text-sm font-medium transition-colors
                    ${r===S?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}
                  `,children:[S==="all"&&"Todas",S==="pending"&&"Aguardando",S==="active"&&"Ativas",S==="my"&&"Minhas"]},S))})]}),e.jsx("div",{className:"px-4 py-3 border-b border-gray-200",children:e.jsx(Md,{agents:d,isLoading:j})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(Ld,{handoffs:o,activeHandoff:g,isLoading:f})})]})}),!y&&e.jsx("button",{onClick:l,className:"absolute top-4 left-4 z-10 p-2 bg-white rounded-lg shadow-lg hover:bg-gray-50 transition-colors",title:"Expandir painel",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 bg-white border-b border-gray-200",children:e.jsx(Vd,{})}),e.jsx("div",{className:"p-4 bg-white border-b border-gray-200",children:e.jsx(Dd,{stats:t,isLoading:v})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"flex-1",children:g?e.jsx(qd,{handoff:g}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("p",{className:"text-lg font-medium",children:"Selecione uma conversa"}),e.jsx("p",{className:"text-sm mt-1",children:"Escolha uma conversa da fila para come√ßar"})]})})}),c&&e.jsx("div",{className:"w-80 border-l border-gray-200 bg-white",children:e.jsx(zd,{handoff:g})})]})]}),e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:k.map(S=>e.jsx(Id,{notification:S,onClose:()=>C(S.id)},S.id))})]})})},Bd=()=>{const[s,n]=a.useState([]),[t,d]=a.useState(!0),[o,g]=a.useState(!1),[r,v]=a.useState(null),[j,f]=a.useState([]),[y,c]=a.useState([]),[m,k]=a.useState(!1),[w,x]=a.useState(null);a.useEffect(()=>{b()},[]);const b=async()=>{try{d(!0);const l=await F.get("/comissoes/configuracoes/funcionarios");l.data.success&&n(l.data.data)}catch(l){console.error("Erro ao carregar funcion√°rios:",l),x("Erro ao carregar funcion√°rios com comiss√µes")}finally{d(!1)}},u=async(l=null)=>{v(l),g(!0),k(!0);try{const C=await F.get("/comissoes/arvore-produtos");if(C.data.success&&c(C.data.data),l){const h=await F.get(`/comissoes/configuracoes/funcionario/${l}`);h.data.success&&f(h.data.data)}}catch(C){console.error("Erro ao carregar dados:",C),x("Erro ao carregar dados de configura√ß√£o")}finally{k(!1)}},i=()=>{g(!1),v(null),f([]),c([]),b()},p=async l=>{const C=prompt("Digite o ID do funcion√°rio de destino:");if(C)try{const h=await F.post("/comissoes/configuracoes/duplicar",{funcionario_origem_id:parseInt(l),funcionario_destino_id:parseInt(C)});h.data.success&&(alert(h.data.message),b())}catch(h){console.error("Erro ao duplicar configura√ß√£o:",h),alert("Erro ao duplicar configura√ß√£o")}};return t?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Cadastro de Comiss√µes"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie as comiss√µes dos funcion√°rios"})]}),e.jsxs("button",{onClick:()=>u(),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2",children:[e.jsx("span",{children:"+"}),"Nova Comiss√£o"]})]})}),w&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:w}),e.jsx("div",{className:"bg-white rounded-lg shadow",children:s.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"Nenhuma comiss√£o configurada"}),e.jsx("p",{className:"text-sm",children:'Clique em "Nova Comiss√£o" para come√ßar'})]}):e.jsx("div",{className:"divide-y",children:s.map(l=>e.jsx("div",{className:"p-4 hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>u(l.id),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:l.nome.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:l.nome}),e.jsx("p",{className:"text-sm text-gray-500",children:l.cargo})]})]}),e.jsxs("div",{className:"mt-2 flex gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:[e.jsx("strong",{children:l.categorias})," categorias"]}),e.jsxs("span",{children:[e.jsx("strong",{children:l.subcategorias})," subcategorias"]}),e.jsxs("span",{children:[e.jsx("strong",{children:l.produtos})," produtos espec√≠ficos"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:C=>{C.stopPropagation(),u(l.id)},className:"px-3 py-1 text-blue-600 hover:bg-blue-50 rounded",children:"Editar"}),e.jsx("button",{onClick:C=>{C.stopPropagation(),p(l.id)},className:"px-3 py-1 text-gray-600 hover:bg-gray-100 rounded",title:"Duplicar configura√ß√£o para outro funcion√°rio",children:"Duplicar"})]})]})},l.id))})}),o&&e.jsx(Ud,{funcionarioId:r,configuracoes:j,arvoreProdutos:y,loading:m,onClose:i,onSave:()=>{b(),i()}})]})},Ud=({funcionarioId:s,configuracoes:n,arvoreProdutos:t,loading:d,onClose:o,onSave:g})=>{const[r,v]=a.useState([]),[j,f]=a.useState(s||""),[y,c]=a.useState(""),[m,k]=a.useState({desconta_taxa_cartao:!0,desconta_impostos:!0,desconta_taxa_entrega:!1,comissao_venda_parcial:!0}),[w,x]=a.useState({}),[b,u]=a.useState({}),[i,p]=a.useState(null),[l,C]=a.useState([]),[h,_]=a.useState(!1),[S,$]=a.useState({atual:0,total:0}),[K,re]=a.useState(null);a.useEffect(()=>{M()},[]),a.useEffect(()=>{const B={};if(n.forEach(N=>{const O=`${N.tipo}-${N.referencia_id}`;B[O]=N}),u(B),n.length>0){const N=n[0],O={desconta_taxa_cartao:N.desconta_taxa_cartao??!0,desconta_impostos:N.desconta_impostos??!0,desconta_taxa_entrega:N.desconta_custo_entrega??!1,comissao_venda_parcial:N.comissao_venda_parcial??!0};k(O),re(O)}},[n]);const M=async()=>{try{const B=await F.get("/comissoes/funcionarios");if(B.data.success&&(v(B.data.data),s)){const N=B.data.data.find(O=>O.id===parseInt(s));N&&N.data_fechamento_comissao&&c(String(N.data_fechamento_comissao))}}catch(B){console.error("Erro ao carregar funcion√°rios:",B)}},R=B=>{x(N=>({...N,[B]:!N[B]}))},J=(B,N,O)=>{const z=`${B}-${N}`,ae=b[z];p({tipo:B,id:N,nome:O,tipo_calculo:(ae==null?void 0:ae.tipo_calculo)||"percentual",percentual:(ae==null?void 0:ae.percentual)||10,percentual_loja:(ae==null?void 0:ae.percentual_loja)||50,permite_edicao_venda:(ae==null?void 0:ae.permite_edicao_venda)||!1,observacoes:(ae==null?void 0:ae.observacoes)||""})},te=()=>{if(!j){alert("Selecione um funcion√°rio");return}if(!i){alert("Selecione um item para configurar");return}if(l.some(O=>O.tipo===i.tipo&&O.referencia_id===i.id)){alert("Este item j√° foi adicionado √† lista!");return}if(i.tipo==="categoria"&&l.some(z=>(z.tipo==="subcategoria"||z.tipo==="produto")&&z.nome.includes(i.nome))&&!confirm(`‚ö†Ô∏è ATEN√á√ÉO: Voc√™ j√° configurou produtos/subcategorias desta categoria.

HIERARQUIA: Produto > Subcategoria > Categoria

A configura√ß√£o mais espec√≠fica tem prioridade.

Deseja adicionar mesmo assim?`))return;const N={tipo:i.tipo,referencia_id:i.id,nome:i.nome,tipo_calculo:i.tipo_calculo,percentual:parseFloat(i.percentual)||0,percentual_loja:i.tipo_calculo==="lucro"?parseFloat(i.percentual_loja)||0:null,permite_edicao_venda:i.permite_edicao_venda||!1,observacoes:i.observacoes||""};C([...l,N]),p(null),alert('Configura√ß√£o adicionada! Configure mais itens ou clique em "Salvar Todas"')},L=B=>{C(l.filter((N,O)=>O!==B))},Z=async()=>{var B,N,O;if(!j){alert("Selecione um funcion√°rio");return}if(l.length===0){alert("Adicione pelo menos uma configura√ß√£o");return}_(!0);try{y&&await F.put(`/funcionarios/${j}`,{data_fechamento_comissao:parseInt(y)});const z=l.map(W=>({funcionario_id:parseInt(j),tipo:W.tipo,referencia_id:W.referencia_id,tipo_calculo:W.tipo_calculo,percentual:parseFloat(W.percentual)||0,percentual_loja:W.percentual_loja?parseFloat(W.percentual_loja):null,permite_edicao_venda:W.permite_edicao_venda||!1,observacoes:W.observacoes||"",desconta_taxa_cartao:m.desconta_taxa_cartao,desconta_impostos:m.desconta_impostos,desconta_taxa_entrega:m.desconta_taxa_entrega,comissao_venda_parcial:m.comissao_venda_parcial}));console.log("Enviando configura√ß√µes em batch:",z);const ae=await F.post("/comissoes/configuracoes/batch",{configuracoes:z});if(console.log("Resposta do servidor:",ae.data),ae.data.success){if(alert(`‚úÖ ${ae.data.total} configura√ß√µes salvas com sucesso!`),C([]),j)try{const W=await F.get(`/comissoes/configuracoes/funcionario/${j}`);if(W.data.success){const ie={};W.data.data.forEach(ee=>{const Q=`${ee.tipo}-${ee.referencia_id}`;ie[Q]=ee}),u(ie)}}catch(W){console.error("Erro ao recarregar configura√ß√µes:",W)}g()}}catch(z){console.error("Erro ao salvar configura√ß√µes:",z),console.error("Resposta do servidor:",(B=z.response)==null?void 0:B.data);const ae=((O=(N=z.response)==null?void 0:N.data)==null?void 0:O.detail)||z.message||"Erro desconhecido";alert(`‚ùå Erro ao salvar configura√ß√µes:

${ae}`)}finally{_(!1),$({atual:0,total:0})}},A=async()=>{if(!j){alert("Selecione um funcion√°rio");return}if(!i){if(Object.keys(b).length===0){alert("Nenhuma configura√ß√£o encontrada para atualizar as regras.");return}if(!(K&&(m.desconta_taxa_cartao!==K.desconta_taxa_cartao||m.desconta_impostos!==K.desconta_impostos||m.desconta_taxa_entrega!==K.desconta_taxa_entrega||m.comissao_venda_parcial!==K.comissao_venda_parcial))){alert("Nenhuma altera√ß√£o detectada nas regras.");return}if(!confirm("Deseja atualizar as regras de c√°lculo em TODAS as configura√ß√µes deste funcion√°rio?"))return;try{console.log("üíæ SALVANDO REGRAS - Estado atual:",m);for(const[N,O]of Object.entries(b)){const z={funcionario_id:parseInt(j),tipo:O.tipo,referencia_id:O.referencia_id,tipo_calculo:O.tipo_calculo,percentual:parseFloat(O.percentual),percentual_loja:O.percentual_loja?parseFloat(O.percentual_loja):null,desconta_taxa_cartao:m.desconta_taxa_cartao,desconta_impostos:m.desconta_impostos,desconta_custo_entrega:m.desconta_taxa_entrega,comissao_venda_parcial:m.comissao_venda_parcial,permite_edicao_venda:O.permite_edicao_venda,observacoes:O.observacoes||""};console.log("üíæ Dados sendo enviados ao backend:",z),await F.post("/comissoes/configuracoes",z)}alert("‚úÖ Regras atualizadas com sucesso em todas as configura√ß√µes!"),re(m)}catch(N){console.error("Erro ao atualizar regras:",N),alert("Erro ao atualizar regras")}return}if(!i){alert("Selecione um item para configurar");return}try{const B={funcionario_id:parseInt(j),tipo:i.tipo,referencia_id:i.id,tipo_calculo:i.tipo_calculo,percentual:parseFloat(i.percentual),percentual_loja:i.tipo_calculo==="lucro"?parseFloat(i.percentual_loja):null,desconta_taxa_cartao:m.desconta_taxa_cartao,desconta_impostos:m.desconta_impostos,desconta_custo_entrega:m.desconta_taxa_entrega,comissao_venda_parcial:m.comissao_venda_parcial,permite_edicao_venda:i.permite_edicao_venda,observacoes:i.observacoes},N=await F.post("/comissoes/configuracoes",B);if(N.data.success){alert("Configura√ß√£o salva com sucesso!");const O=`${i.tipo}-${i.id}`;u(z=>({...z,[O]:{...B,id:N.data.config_id,nome_item:i.nome}})),p(null)}}catch(B){console.error("Erro ao salvar configura√ß√£o:",B),alert("Erro ao salvar configura√ß√£o")}},G=(B,N)=>{const O=`${B}-${N}`;return b[O]},E=(B,N)=>!!G(B,N),P=(B,N)=>l.some(O=>O.tipo===B&&O.referencia_id===N),H=(B,N=0)=>{const O="  ".repeat(N),z=N===0?"üì¶":"‚Üí",ae=B.filhas&&B.filhas.length>0,W=B.produtos&&B.produtos.length>0;return E("categoria",B.id)?w[B.id]?e.jsxs(ts.Fragment,{children:[ae&&B.filhas.map(ee=>H(ee,N+1)),W&&e.jsx("div",{className:"pl-6",style:{paddingLeft:`${24+N*20}px`},children:B.produtos.map(ee=>{const Q=E("produto",ee.id),de=P("produto",ee.id);return Q?null:e.jsxs("div",{className:`p-2 flex items-center justify-between cursor-pointer hover:bg-gray-50 ${de?"bg-yellow-50":""}`,onClick:()=>J("produto",ee.id,ee.nome),children:[e.jsxs("span",{className:"text-sm",children:["üìå ",ee.nome]}),de&&e.jsx("span",{className:"text-xs text-yellow-600",children:"‚è≥ Na lista"})]},`prod-${ee.id}`)})})]},`cat-${B.id}`):null:e.jsxs("div",{className:"border-b last:border-b-0",children:[e.jsxs("div",{className:`p-3 flex items-center justify-between cursor-pointer hover:bg-gray-50 ${P("categoria",B.id)?"bg-yellow-50":""}`,style:{paddingLeft:`${12+N*20}px`},onClick:()=>J("categoria",B.id,`${O}${B.nome}`),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[(ae||W)&&e.jsx("button",{onClick:ee=>{ee.stopPropagation(),R(B.id)},className:"text-gray-500",children:w[B.id]?"‚ñº":"‚ñ∂"}),e.jsxs("span",{className:N===0?"font-medium":"text-sm",children:[z," ",B.nome,N>0&&e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(N√≠vel ",N+1,")"]})]})]}),P("categoria",B.id)&&e.jsx("span",{className:"text-xs text-yellow-600",children:"‚è≥ Na lista"})]}),w[B.id]&&e.jsxs("div",{children:[ae&&e.jsx("div",{children:B.filhas.map(ee=>H(ee,N+1))}),W&&e.jsx("div",{className:"pl-6",style:{paddingLeft:`${24+N*20}px`},children:B.produtos.map(ee=>{const Q=E("produto",ee.id),de=P("produto",ee.id);return Q?null:e.jsxs("div",{className:`p-2 flex items-center justify-between cursor-pointer hover:bg-gray-50 ${de?"bg-yellow-50":""}`,onClick:()=>J("produto",ee.id,ee.nome),children:[e.jsxs("span",{className:"text-sm",children:["üìå ",ee.nome]}),de&&e.jsx("span",{className:"text-xs text-yellow-600",children:"‚è≥ Na lista"})]},`prod-${ee.id}`)})})]})]},`cat-${B.id}`)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Configura√ß√£o de Comiss√£o"}),e.jsx("button",{onClick:o,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"√ó"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Funcion√°rio"}),e.jsxs("select",{value:j,onChange:B=>f(B.target.value),className:"w-full border rounded-lg px-3 py-2",disabled:!!s,children:[e.jsx("option",{value:"",children:"Selecione um funcion√°rio"}),r.map(B=>e.jsxs("option",{value:B.id,children:[B.nome," - ",B.cargo]},B.id))]}),e.jsx("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded text-xs",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"‚ÑπÔ∏è"}),e.jsxs("div",{className:"text-blue-700",children:[e.jsx("strong",{children:"Apenas parceiros podem receber comiss√µes."}),e.jsx("br",{}),'Se a pessoa n√£o aparecer na lista, marque-a como "Parceiro" no cadastro de pessoas primeiro.']})]})})]}),j&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"üìÖ Dia do m√™s para fechamento de comiss√£o"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",min:"1",max:"31",value:y,onChange:B=>c(B.target.value),placeholder:"Ex: 5 (paga dia 5 de cada m√™s)",className:"flex-1 border rounded-lg px-3 py-2"}),e.jsx("button",{onClick:async()=>{try{await F.put(`/clientes/${j}`,{data_fechamento_comissao:y?parseInt(y):null}),alert("‚úÖ Data de fechamento salva com sucesso!")}catch(B){console.error("Erro ao salvar data:",B),alert("‚ùå Erro ao salvar data de fechamento")}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 whitespace-nowrap",children:"üíæ Salvar Data"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Deixe em branco para pagamento 30 dias ap√≥s a venda (padr√£o)"})]}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Regras de C√°lculo"}),e.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded text-sm",children:[e.jsx("div",{className:"font-semibold text-blue-800 mb-1",children:"üìã Hierarquia de Configura√ß√µes"}),e.jsxs("div",{className:"text-blue-700 text-xs",children:[e.jsx("strong",{children:"Produto"})," (prioridade m√°xima) ‚Üí ",e.jsx("strong",{children:"Subcategoria"})," ‚Üí ",e.jsx("strong",{children:"Categoria"})," (prioridade m√≠nima)",e.jsx("br",{}),e.jsx("span",{className:"text-blue-600",children:"Ao vender um produto, o sistema busca a configura√ß√£o mais espec√≠fica."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.desconta_taxa_cartao,onChange:B=>{console.log("‚úÖ Checkbox TAXA CART√ÉO alterado para:",B.target.checked),k({...m,desconta_taxa_cartao:B.target.checked})},className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Desconta taxa de cart√£o"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.desconta_impostos,onChange:B=>{console.log("‚úÖ Checkbox IMPOSTOS alterado para:",B.target.checked),k({...m,desconta_impostos:B.target.checked})},className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Desconta impostos"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.desconta_taxa_entrega,onChange:B=>{console.log("‚úÖ Checkbox TAXA ENTREGA alterado para:",B.target.checked),k({...m,desconta_taxa_entrega:B.target.checked})},className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Desconta taxa de entrega"})]}),e.jsx("div",{className:"border-t pt-2 mt-3",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.comissao_venda_parcial,onChange:B=>{console.log("‚úÖ Checkbox VENDA PARCIAL alterado para:",B.target.checked),k({...m,comissao_venda_parcial:B.target.checked})},className:"rounded"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium",children:"Gerar comiss√£o em vendas parciais"}),e.jsx("span",{className:"text-xs text-gray-500",children:m.comissao_venda_parcial?"Comiss√£o gerada proporcionalmente a cada pagamento recebido":"Comiss√£o gerada somente quando a venda estiver 100% paga"})]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Sele√ß√£o de Produtos"}),Object.keys(b).length>0&&e.jsxs("div",{className:"mb-4 border rounded-lg p-3 bg-green-50",children:[e.jsxs("h4",{className:"text-sm font-semibold text-green-800 mb-2",children:["‚úÖ Itens J√° Configurados (",Object.keys(b).length,")"]}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:Object.entries(b).map(([B,N])=>e.jsxs("div",{className:"w-full flex items-center justify-between text-xs bg-white p-2 rounded hover:bg-gray-50 transition-colors group",children:[e.jsxs("button",{onClick:()=>J(N.tipo,N.referencia_id,N.nome_item||"Item"),className:"flex-1 flex items-center gap-2 text-left",children:[N.tipo==="categoria"&&"üì¶",N.tipo==="subcategoria"&&"üìÇ",N.tipo==="produto"&&"üìå",e.jsx("span",{className:"text-gray-700",children:N.nome_item||"Item"}),e.jsx("span",{className:"text-green-600 font-medium ml-auto",children:N.tipo_calculo==="percentual"?`${N.percentual}%`:`Lucro ${N.percentual}%`})]}),e.jsx("button",{onClick:async()=>{if(confirm(`Deseja remover a configura√ß√£o de "${N.nome_item||"Item"}"?`))try{await F.delete(`/comissoes/configuracoes/${N.id}`),alert("Configura√ß√£o removida com sucesso!");const O={...b};delete O[B],u(O)}catch(O){console.error("Erro ao remover:",O),alert("Erro ao remover configura√ß√£o")}},className:"ml-2 text-red-600 hover:text-red-800 opacity-0 group-hover:opacity-100 transition-opacity",children:"üóëÔ∏è"})]},B))}),e.jsx("p",{className:"text-xs text-green-700 mt-2 italic",children:"üí° Clique em um item para editar"})]}),d?e.jsx("div",{className:"text-center py-8",children:"Carregando..."}):e.jsx("div",{className:"border rounded-lg max-h-96 overflow-y-auto",children:t.map(B=>H(B,0))},Object.keys(b).length)]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Configura√ß√£o"}),i?e.jsxs("div",{className:"border rounded-lg p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-700",children:[i.tipo==="categoria"&&"üì¶ ",i.tipo==="subcategoria"&&"üìÇ ",i.tipo==="produto"&&"üìå ",i.nome]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Tipo: ",i.tipo]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Tipo de Comiss√£o"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"percentual",checked:i.tipo_calculo==="percentual",onChange:B=>p({...i,tipo_calculo:B.target.value})}),e.jsx("span",{className:"text-sm",children:"Percentual fixo sobre venda"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"lucro",checked:i.tipo_calculo==="lucro",onChange:B=>p({...i,tipo_calculo:B.target.value})}),e.jsx("span",{className:"text-sm",children:"Divis√£o de lucro"})]})]})]}),i.tipo_calculo==="percentual"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentual"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",value:i.percentual,onChange:B=>p({...i,percentual:B.target.value}),className:"border rounded px-3 py-2 w-24"}),e.jsx("span",{children:"%"})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Divis√£o do Lucro"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Funcion√°rio"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("input",{type:"number",min:"0",max:"100",value:i.percentual,onChange:B=>{const N=parseFloat(B.target.value);p({...i,percentual:N,percentual_loja:100-N})},className:"border rounded px-2 py-1 w-20"}),e.jsx("span",{className:"text-sm",children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Loja"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("input",{type:"number",value:i.percentual_loja,readOnly:!0,className:"border rounded px-2 py-1 w-20 bg-gray-100"}),e.jsx("span",{className:"text-sm",children:"%"})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"C√°lculo: Pre√ßo Venda - Desconto - Taxas - Impostos - Custo = Lucro"})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:i.permite_edicao_venda,onChange:B=>p({...i,permite_edicao_venda:B.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Permite editar percentual na venda"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Observa√ß√µes"}),e.jsx("textarea",{value:i.observacoes,onChange:B=>p({...i,observacoes:B.target.value}),className:"border rounded px-3 py-2 w-full",rows:"3"})]}),e.jsx("button",{onClick:te,className:"w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded mb-2",children:"‚ûï Adicionar √† Lista"}),e.jsx("button",{onClick:A,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded",children:"üíæ Salvar Agora"})]}):e.jsx("div",{className:"border rounded-lg p-8 text-center text-gray-500",children:e.jsx("p",{children:"Selecione uma categoria, subcategoria ou produto ao lado para configurar"})}),l.length>0&&e.jsxs("div",{className:"mt-6 border rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold mb-3",children:["Configura√ß√µes a Salvar (",l.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:l.map((B,N)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:B.nome}),e.jsxs("span",{className:"text-gray-500 ml-2",children:["(",B.tipo_calculo==="percentual"?`${B.percentual}%`:`Lucro ${B.percentual}%`,")"]})]}),e.jsx("button",{onClick:()=>L(N),className:"text-red-600 hover:text-red-800",children:"‚úï"})]},N))}),e.jsx("button",{onClick:Z,disabled:h,className:`w-full py-2 rounded mt-4 text-white ${h?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:h?e.jsxs("span",{children:["‚è≥ Salvando ",S.atual,"/",S.total,"..."]}):"üíæ Salvar Todas as Configura√ß√µes"})]})]})]})]}),e.jsx("div",{className:"p-6 border-t bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["‚ÑπÔ∏è As configura√ß√µes se aplicam ",e.jsx("strong",{children:"apenas √†s comiss√µes futuras"}),". Comiss√µes j√° geradas n√£o s√£o alteradas."]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 border rounded hover:bg-gray-50 bg-white",children:"Fechar"}),e.jsxs("button",{onClick:A,disabled:!i&&(!K||m.desconta_taxa_cartao===K.desconta_taxa_cartao&&m.desconta_impostos===K.desconta_impostos&&m.desconta_taxa_entrega===K.desconta_taxa_entrega&&m.comissao_venda_parcial===K.comissao_venda_parcial),className:`px-6 py-2 rounded font-medium ${i||K&&(m.desconta_taxa_cartao!==K.desconta_taxa_cartao||m.desconta_impostos!==K.desconta_impostos||m.desconta_taxa_entrega!==K.desconta_taxa_entrega||m.comissao_venda_parcial!==K.comissao_venda_parcial)?"bg-blue-600 hover:bg-blue-700 text-white cursor-pointer":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:["üíæ ",i?"Salvar Altera√ß√µes":"Atualizar Regras"]})]})]})})]})})},Wd=({comissaoId:s,onClose:n})=>{var x,b,u,i,p;const[t,d]=a.useState(null),[o,g]=a.useState(!0),[r,v]=a.useState(null);a.useEffect(()=>{s&&j()},[s]),a.useEffect(()=>{const l=C=>{C.key==="Escape"&&n()};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[n]);const j=async()=>{var l,C;try{g(!0),v(null);const h=await F.get(`/comissoes/comissao/${s}`);h.data.success?d(h.data.comissao):v("Erro ao carregar detalhes da comiss√£o")}catch(h){console.error("Erro ao carregar detalhe:",h),v(((C=(l=h.response)==null?void 0:l.data)==null?void 0:C.detail)||"Erro ao conectar com o servidor")}finally{g(!1)}},f=l=>l?new Date(l).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",y=l=>l==null?"R$ 0,00":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(l),c=l=>l==null?"0%":`${l.toFixed(1)}%`,m=l=>{const h={pendente:"bg-yellow-100 text-yellow-800",pago:"bg-green-100 text-green-800",estornado:"bg-red-100 text-red-800"}[l]||"bg-gray-100 text-gray-800";return e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${h}`,children:l.toUpperCase()})},k=({label:l,valor:C,destaque:h=!1})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:l}),e.jsx("div",{className:`text-sm ${h?"text-lg font-bold text-gray-900":"text-gray-900"}`,children:C})]}),w=({titulo:l,children:C,cor:h="blue"})=>{const _={blue:"border-blue-500 bg-blue-50",green:"border-green-500 bg-green-50",purple:"border-purple-500 bg-purple-50",yellow:"border-yellow-500 bg-yellow-50",red:"border-red-500 bg-red-50"};return e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:`border-l-4 ${_[h]} px-4 py-2 mb-3`,children:e.jsx("h3",{className:"font-semibold text-gray-800",children:l})}),e.jsx("div",{className:"px-4",children:C})]})};return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 transition-opacity",onClick:n}),e.jsxs("div",{className:"fixed inset-y-0 right-0 w-full md:w-2/3 lg:w-1/2 bg-white shadow-xl z-50 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Detalhes da Comiss√£o"}),e.jsxs("p",{className:"text-sm text-blue-100",children:["Snapshot Imut√°vel #",s]})]}),e.jsx("button",{onClick:n,className:"text-white hover:bg-blue-500 rounded-full p-2 transition",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[o&&e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando detalhes..."})]})}),r&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-red-800 font-semibold mb-2",children:"Erro ao carregar"}),e.jsx("p",{className:"text-red-600",children:r}),e.jsx("button",{onClick:j,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition",children:"Tentar Novamente"})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx(w,{titulo:"üìã Identifica√ß√£o",cor:"blue",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(k,{label:"ID da Comiss√£o",valor:`#${t.id}`}),e.jsx(k,{label:"Venda",valor:t.numero_venda||`#${t.venda_id}`}),e.jsx(k,{label:"ID do Produto",valor:`#${t.produto_id}`}),e.jsx(k,{label:"ID do Funcion√°rio",valor:`#${t.funcionario_id}`}),e.jsx(k,{label:"Data da Venda",valor:f(t.data_venda)}),e.jsx(k,{label:"N√∫mero da Parcela",valor:t.parcela_numero}),e.jsx(k,{label:"Quantidade",valor:t.quantidade})]})}),e.jsxs(w,{titulo:"üí∞ Valores Financeiros (Snapshot)",cor:"green",children:[e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-300 rounded-lg",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Contexto do Pagamento"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-3 rounded border border-blue-200",children:[e.jsx("span",{className:"text-xs text-gray-600 block mb-1",children:"Valor Total da Venda (Produtos)"}),e.jsx("span",{className:"text-lg font-bold text-blue-700",children:y(t.total_venda||0)})]}),e.jsxs("div",{className:"bg-white p-3 rounded border border-green-200",children:[e.jsxs("span",{className:"text-xs text-gray-600 block mb-1",children:["Valor Pago (Parcela ",t.parcela_numero,")"]}),e.jsx("span",{className:"text-lg font-bold text-green-600",children:y(((x=t.pagamento)==null?void 0:x.valor_pago_referencia)||0)}),((b=t.pagamento)==null?void 0:b.forma_pagamento)&&e.jsxs("span",{className:"text-xs text-gray-500 block mt-1",children:["via ",t.pagamento.forma_pagamento]})]})]}),((u=t.pagamento)==null?void 0:u.percentual_pago)<100&&e.jsxs("div",{className:"mt-2 text-xs text-blue-700",children:["‚ÑπÔ∏è Comiss√£o calculada proporcionalmente (",c(t.pagamento.percentual_pago)," do total)"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(k,{label:"Valor de Venda",valor:y(t.valores_financeiros.valor_venda)}),e.jsx(k,{label:"Valor de Custo",valor:y(t.valores_financeiros.valor_custo)}),e.jsx(k,{label:"Base Original (Lucro)",valor:y(t.valores_financeiros.valor_base_original)}),e.jsx(k,{label:"Base Comissionada",valor:y(t.valores_financeiros.valor_base_comissionada)})]}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Como chegamos na Base de C√°lculo?"]}),e.jsxs("div",{className:"space-y-2 text-sm font-mono bg-white p-4 rounded border border-blue-200",children:[e.jsxs("div",{className:"flex justify-between pb-2 border-b border-gray-200",children:[e.jsxs("span",{className:"text-gray-700 font-semibold",children:["Valor Pago (Parcela ",t.parcela_numero||1,"):"]}),e.jsx("span",{className:"font-bold text-blue-600",children:y(((i=t.pagamento)==null?void 0:i.valor_pago_referencia)||t.valores_financeiros.valor_venda)})]}),t.deducoes&&t.deducoes.receita_taxa_entrega>0&&e.jsxs("div",{className:"flex justify-between text-green-600 pl-4",children:[e.jsx("span",{children:"(+) Taxa de Entrega (Receita):"}),e.jsxs("span",{className:"font-medium",children:["+ ",y(t.deducoes.receita_taxa_entrega)]})]}),t.deducoes&&e.jsxs(e.Fragment,{children:[t.deducoes.taxa_cartao>0&&e.jsxs("div",{className:"flex justify-between text-red-600 pl-4",children:[e.jsxs("span",{children:["(-) ",(()=>{const l=t.deducoes.forma_pagamento||"Cart√£o",C=t.deducoes.numero_parcelas||1;let h=t.deducoes.taxa_percentual;if(C>1&&t.deducoes.taxas_por_parcela)try{h=JSON.parse(t.deducoes.taxas_por_parcela)[C.toString()]||h}catch{}let _="Taxa ";return l.includes("Cr√©dito")?C>1?_+=`Cart√£o Cr√©dito ${C}x`:_+="Cart√£o Cr√©dito √† Vista":l.includes("D√©bito")?_+="Cart√£o D√©bito":_+=l,h&&(_+=` (${h}%)`),_+":"})()]}),e.jsxs("span",{className:"font-medium",children:["- ",y(t.deducoes.taxa_cartao)]})]}),t.deducoes.imposto>0&&e.jsxs("div",{className:"flex justify-between text-red-600 pl-4",children:[e.jsxs("span",{children:["(-) Impostos (",t.deducoes.percentual_impostos?t.deducoes.percentual_impostos.toFixed(1)+"%":"","):"]}),e.jsxs("span",{className:"font-medium",children:["- ",y(t.deducoes.imposto)]})]}),t.deducoes.taxa_entregador>0&&e.jsxs("div",{className:"flex justify-between text-red-600 pl-4",children:[e.jsx("span",{children:"(-) Taxa paga ao Entregador:"}),e.jsxs("span",{className:"font-medium",children:["- ",y(t.deducoes.taxa_entregador)]})]}),t.deducoes.custo_operacional>0&&e.jsxs("div",{className:"flex justify-between text-red-600 pl-4",children:[e.jsx("span",{children:"(-) Custo Operacional de Entrega:"}),e.jsxs("span",{className:"font-medium",children:["- ",y(t.deducoes.custo_operacional)]})]}),t.deducoes.desconto>0&&e.jsxs("div",{className:"flex justify-between text-red-600 pl-4",children:[e.jsx("span",{children:"(-) Desconto:"}),e.jsxs("span",{className:"font-medium",children:["- ",y(t.deducoes.desconto)]})]})]}),e.jsxs("div",{className:"border-t-2 border-blue-400 pt-2 mt-2 flex justify-between font-bold",children:[e.jsx("span",{className:"text-blue-900",children:"(=) Base de C√°lculo:"}),e.jsx("span",{className:"text-blue-900 text-lg",children:y(t.calculo.valor_base_calculo)})]})]})]})]}),e.jsxs(w,{titulo:"üßÆ C√°lculo da Comiss√£o",cor:"purple",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(k,{label:"Tipo de C√°lculo",valor:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${t.calculo.tipo_calculo==="percentual"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:t.calculo.tipo_calculo.toUpperCase()})}),e.jsx(k,{label:"Percentual da Comiss√£o",valor:c(t.calculo.percentual_comissao)}),e.jsx(k,{label:"Percentual Aplicado (Pago)",valor:c(t.calculo.percentual_aplicado)}),e.jsx(k,{label:"Valor Base de C√°lculo",valor:y(t.calculo.valor_base_calculo),destaque:!0}),e.jsx(k,{label:"Valor da Comiss√£o (Total)",valor:y(t.calculo.valor_comissao)}),e.jsx(k,{label:"Valor Efetivamente Gerado",valor:y(t.calculo.valor_comissao_gerada),destaque:!0})]}),e.jsxs("div",{className:"mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-purple-900 mb-3",children:"üìê F√≥rmula Aplicada:"}),e.jsxs("div",{className:"space-y-2 text-sm font-mono",children:[e.jsxs("div",{className:"bg-white p-3 rounded border border-purple-200",children:[e.jsx("div",{className:"text-gray-700 mb-2",children:"Base de C√°lculo √ó Percentual = Comiss√£o"}),e.jsxs("div",{className:"text-purple-900 font-bold",children:[y(t.calculo.valor_base_calculo)," √ó ",c(t.calculo.percentual_comissao)," = ",y(t.calculo.valor_comissao)]})]}),t.calculo.percentual_aplicado<100&&e.jsxs("div",{className:"bg-yellow-50 p-3 rounded border border-yellow-200",children:[e.jsx("div",{className:"text-gray-700 mb-2",children:"‚ö†Ô∏è Venda parcial - Comiss√£o proporcional ao valor pago:"}),e.jsxs("div",{className:"text-yellow-900 font-bold",children:[y(t.calculo.valor_comissao)," √ó ",c(t.calculo.percentual_aplicado)," = ",y(t.calculo.valor_comissao_gerada)]})]})]})]})]}),e.jsxs(w,{titulo:"üí≥ Controle de Pagamento",cor:"yellow",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(k,{label:"Percentual Pago da Venda",valor:c(t.pagamento.percentual_pago)}),e.jsx(k,{label:"Valor Pago de Refer√™ncia",valor:y(t.pagamento.valor_pago_referencia)}),e.jsx(k,{label:"Valor Pago da Comiss√£o",valor:y(t.pagamento.valor_pago)}),e.jsx(k,{label:"Saldo Restante",valor:y(t.pagamento.saldo_restante)}),t.pagamento.data_pagamento&&e.jsxs(e.Fragment,{children:[e.jsx(k,{label:"Data do Pagamento",valor:f(t.pagamento.data_pagamento)}),e.jsx(k,{label:"Forma de Pagamento",valor:t.pagamento.forma_pagamento||"N√£o informado"})]})]}),t.pagamento.percentual_pago<100&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-yellow-800",children:["‚ö†Ô∏è Esta comiss√£o foi gerada proporcionalmente ao pagamento parcial da venda. Apenas ",c(t.pagamento.percentual_pago)," do valor total foi pago."]})})]}),e.jsxs(w,{titulo:"üìä Status e Controle",cor:t.status.status==="estornado"?"red":"blue",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-2",children:"Status Atual"}),m(t.status.status)]}),t.status.status==="estornado"&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-red-800 mb-2",children:"Informa√ß√µes do Estorno"}),e.jsx(k,{label:"Data do Estorno",valor:f(t.status.data_estorno)}),e.jsx(k,{label:"Motivo do Estorno",valor:t.status.motivo_estorno||"N√£o informado"})]}),t.status.observacao_pagamento&&e.jsxs("div",{className:"mt-4 bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Observa√ß√µes"}),e.jsx("p",{className:"text-sm text-gray-600",children:t.status.observacao_pagamento})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-6 text-white shadow-lg",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center",children:[e.jsx("svg",{className:"w-6 h-6 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Resumo do C√°lculo Completo"]}),e.jsxs("div",{className:"space-y-3 font-mono text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-white/20 pb-2",children:[e.jsxs("span",{className:"text-blue-100",children:["Valor Pago (Parcela ",t.parcela_numero||1,"):"]}),e.jsx("span",{className:"font-bold text-lg",children:y(((p=t.pagamento)==null?void 0:p.valor_pago_referencia)||t.valores_financeiros.valor_venda)})]}),t.deducoes&&e.jsxs(e.Fragment,{children:[t.deducoes.taxa_cartao>0&&e.jsxs("div",{className:"flex justify-between items-center pl-4 text-red-200",children:[e.jsxs("span",{children:["(-) ",(()=>{const l=t.deducoes.forma_pagamento||"Cart√£o",C=t.deducoes.numero_parcelas||1;let h=t.deducoes.taxa_percentual;if(C>1&&t.deducoes.taxas_por_parcela)try{h=JSON.parse(t.deducoes.taxas_por_parcela)[C.toString()]||h}catch{}let _="Taxa ";return l.includes("Cr√©dito")?C>1?_+=`Cart√£o Cr√©dito ${C}x`:_+="Cart√£o Cr√©dito √† Vista":l.includes("D√©bito")?_+="Cart√£o D√©bito":_+=l,h&&(_+=` (${h}%)`),_+":"})()]}),e.jsxs("span",{className:"font-medium",children:["- ",y(t.deducoes.taxa_cartao)]})]}),t.deducoes.imposto>0&&e.jsxs("div",{className:"flex justify-between items-center pl-4 text-red-200",children:[e.jsx("span",{children:"(-) Impostos:"}),e.jsxs("span",{className:"font-medium",children:["- ",y(t.deducoes.imposto)]})]}),t.deducoes.custo_entrega>0&&e.jsxs("div",{className:"flex justify-between items-center pl-4 text-red-200",children:[e.jsx("span",{children:"(-) Custo de Entrega:"}),e.jsxs("span",{className:"font-medium",children:["- ",y(t.deducoes.custo_entrega)]})]}),t.deducoes.desconto>0&&e.jsxs("div",{className:"flex justify-between items-center pl-4 text-red-200",children:[e.jsx("span",{children:"(-) Desconto:"}),e.jsxs("span",{className:"font-medium",children:["- ",y(t.deducoes.desconto)]})]})]}),e.jsxs("div",{className:"flex justify-between items-center border-t-2 border-white/40 pt-2",children:[e.jsx("span",{className:"text-blue-100 font-semibold",children:"(=) Base de C√°lculo:"}),e.jsx("span",{className:"font-bold text-lg",children:y(t.calculo.valor_base_calculo)})]}),e.jsxs("div",{className:"flex justify-between items-center border-b border-white/20 pb-2",children:[e.jsx("span",{className:"text-blue-100",children:"(√ó) Percentual:"}),e.jsx("span",{className:"font-bold text-lg",children:c(t.calculo.percentual_comissao)})]}),e.jsxs("div",{className:"flex justify-between items-center bg-white/10 rounded-lg p-3 border-2 border-yellow-300",children:[e.jsx("span",{className:"text-xl font-bold",children:"Comiss√£o Gerada:"}),e.jsx("span",{className:"font-bold text-3xl text-yellow-300",children:y(t.calculo.valor_comissao_gerada)})]})]})]})]})]}),t&&e.jsx("div",{className:"bg-blue-50 border-t border-blue-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-500 mt-0.5 mr-3 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-blue-800 mb-1",children:"Snapshot Financeiro Imut√°vel"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Este √© um snapshot financeiro imut√°vel. Os valores refletem exatamente o momento da venda e n√£o podem ser alterados. Qualquer discrep√¢ncia deve ser tratada atrav√©s de ajustes ou estornos, nunca por edi√ß√£o direta."})]})]})})]})]}):null},Kd=()=>{const s=fa(),[n,t]=a.useState([]),[d,o]=a.useState(!0),[g,r]=a.useState(null),[v,j]=a.useState(null),[f,y]=a.useState(!0),[c,m]=a.useState(null),[k,w]=a.useState(null),[x,b]=a.useState({funcionario_id:"",status:"",data_inicio:"",data_fim:"",venda_id:"",produto_id:"",grupo_id:""}),[u,i]=a.useState("ate_hoje"),[p,l]=a.useState([]),[C,h]=a.useState([]),[_,S]=a.useState(null),[$,K]=a.useState(null),[re,M]=a.useState(""),[R,J]=a.useState(""),[te,L]=a.useState(!1),[Z,A]=a.useState(!1),[G,E]=a.useState([]),[P,H]=a.useState(null),[B,N]=a.useState(!1),[O,z]=a.useState(""),[ae,W]=a.useState(!1),[ie,ee]=a.useState([]),[Q,de]=a.useState(!1),[me,Pe]=a.useState(""),[se,_e]=a.useState(""),[ke,Ye]=a.useState(!1),[ze,Qe]=a.useState("sem_pagar"),[be,Ee]=a.useState(""),[he,Xe]=a.useState(""),[Je,ca]=a.useState(0),[ra,pa]=a.useState([]),[la,oe]=a.useState([]),ye=1;a.useEffect(()=>{console.log("[ComissoesListagem] Iniciando carregamento..."),(async()=>{try{await Ce(),await Be(),await Ie(),await Y(),await je(),await Me(),await T()}catch(qe){console.error("[ComissoesListagem] Erro no carregamento inicial:",qe)}})();const Ae=new Date().toISOString().split("T")[0];b(qe=>({...qe,data_fim:Ae}))},[]),a.useEffect(()=>{const xe=Ae=>{ae&&!Ae.target.closest(".autocomplete-container")&&W(!1)};return document.addEventListener("mousedown",xe),()=>{document.removeEventListener("mousedown",xe)}},[ae]);const Ce=async()=>{var xe,Ae;console.log("[carregarComissoes] Iniciando...");try{o(!0),r(null);const qe=new URLSearchParams;x.funcionario_id&&qe.append("funcionario_id",x.funcionario_id),x.status&&qe.append("status",x.status),x.data_inicio&&qe.append("data_inicio",x.data_inicio),x.data_fim&&qe.append("data_fim",x.data_fim),x.venda_id&&qe.append("venda_id",x.venda_id);const sa=qe.toString(),Ia=sa?`/comissoes?${sa}`:"/comissoes",va=await F.get(Ia);va.data.success?t(va.data.lista):r("Erro ao carregar comiss√µes")}catch(qe){console.error("Erro ao carregar comiss√µes:",qe),r(((Ae=(xe=qe.response)==null?void 0:xe.data)==null?void 0:Ae.detail)||"Erro ao conectar com o servidor")}finally{o(!1),console.log("[carregarComissoes] Finalizado")}},Be=async()=>{var xe,Ae;try{y(!0),m(null);const qe=await F.get(`/comissoes/resumo?funcionario_id=${ye}`);qe.data.success?j(qe.data.resumo):m("Erro ao carregar resumo")}catch(qe){console.error("Erro ao carregar resumo:",qe),m(((Ae=(xe=qe.response)==null?void 0:xe.data)==null?void 0:Ae.detail)||"Erro ao carregar resumo")}finally{y(!1)}},Ie=async()=>{try{N(!0);const xe=await F.get("/comissoes/funcionarios");if(xe.data.success){const Ae=Array.isArray(xe.data.lista)?xe.data.lista:Array.isArray(xe.data.data)?xe.data.data:[];E(Ae)}}catch(xe){console.error("Erro ao carregar funcion√°rios:",xe),E([])}finally{N(!1)}},Y=async()=>{try{const xe=await F.get("/produtos/");xe.data&&l(Array.isArray(xe.data)?xe.data:[])}catch(xe){console.error("Erro ao carregar produtos:",xe),l([])}},je=async()=>{try{const xe=await F.get("/categorias-financeiras");xe.data&&h(Array.isArray(xe.data)?xe.data:[])}catch(xe){console.error("Erro ao carregar grupos:",xe),h([])}},Me=async()=>{console.log("[carregarFormasPagamento] Iniciando...");try{const xe=await F.get("/comissoes/formas-pagamento");xe.data&&pa(Array.isArray(xe.data)?xe.data:[])}catch(xe){console.error("[carregarFormasPagamento] Erro:",xe)}finally{console.log("[carregarFormasPagamento] Finalizado")}},T=async()=>{try{const xe=await F.get("/contas-bancarias");xe.data&&oe(Array.isArray(xe.data)?xe.data.filter(Ae=>Ae.ativa):[])}catch(xe){console.error("Erro ao carregar contas banc√°rias:",xe)}},X=()=>n.filter(Ae=>Ae.status==="pendente").reduce((Ae,qe)=>Ae+(qe.valor_comissao_gerada||0),0),fe=()=>n.filter(Ae=>ie.includes(Ae.id)).reduce((Ae,qe)=>Ae+(qe.valor_comissao_gerada||0),0),U=xe=>xe?new Date(xe).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",le=xe=>xe==null?"R$ 0,00":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(xe),Ne=xe=>xe==null?"0%":`${xe.toFixed(1)}%`,Re=xe=>{const qe={pendente:"bg-yellow-100 text-yellow-800",pago:"bg-green-100 text-green-800",estornado:"bg-red-100 text-red-800"}[xe]||"bg-gray-100 text-gray-800";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${qe}`,children:xe.toUpperCase()})},q=xe=>{const qe={percentual:"bg-blue-100 text-blue-800",lucro:"bg-purple-100 text-purple-800"}[xe]||"bg-gray-100 text-gray-800";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${qe}`,children:xe.toUpperCase()})},ne=()=>{if(f)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[1,2,3,4].map(Ae=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24 mb-3"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-32"})]},Ae))});if(c)return e.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"‚ö†Ô∏è N√£o foi poss√≠vel carregar o resumo financeiro"})});if(!v)return null;const xe=[{titulo:"Total Gerado",valor:v.total_gerado,cor:"blue",bgColor:"bg-blue-50",borderColor:"border-blue-200",textColor:"text-blue-600"},{titulo:"Total Pago",valor:v.total_pago,cor:"green",bgColor:"bg-green-50",borderColor:"border-green-200",textColor:"text-green-600"},{titulo:"Total Pendente",valor:v.total_pendente,cor:"yellow",bgColor:"bg-yellow-50",borderColor:"border-yellow-200",textColor:"text-yellow-600"},{titulo:"Saldo a Pagar",valor:v.saldo_a_pagar,cor:"purple",bgColor:"bg-purple-50",borderColor:"border-purple-200",textColor:"text-purple-600"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:xe.map((Ae,qe)=>e.jsxs("div",{className:`${Ae.bgColor} border ${Ae.borderColor} rounded-lg shadow-sm p-6 transition hover:shadow-md`,children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:Ae.titulo}),e.jsx("p",{className:`text-2xl font-bold ${Ae.textColor}`,children:le(Ae.valor)})]},qe))})},pe=xe=>{w(xe)},$e=()=>{w(null)},Oe=(xe,Ae)=>{b(qe=>({...qe,[xe]:Ae}))},Ke=()=>{Ce()},He=()=>{b({funcionario_id:"",status:"",data_inicio:"",data_fim:"",venda_id:"",produto_id:"",grupo_id:""}),H(null),S(null),K(null),z(""),M(""),J(""),i("ate_hoje");const Ae=new Date().toISOString().split("T")[0];setTimeout(()=>{(async()=>{try{o(!0);const sa=await F.get(`/comissoes?data_fim=${Ae}`);sa.data.success&&t(sa.data.lista)}catch(sa){console.error("Erro:",sa)}finally{o(!1)}})()},100)},ea=xe=>{S(xe),M(xe.nome),L(!1),b(Ae=>({...Ae,produto_id:xe.id}))},na=xe=>{K(xe),J(xe.nome),A(!1),b(Ae=>({...Ae,grupo_id:xe.id}))},ia=xe=>{H(xe),z(xe.nome),W(!1),b(Ae=>({...Ae,funcionario_id:xe.id}))},Ue=(G||[]).filter(xe=>{var Ae;return(Ae=xe==null?void 0:xe.nome)==null?void 0:Ae.toLowerCase().includes(O.toLowerCase())}),Ca=(xe,Ae)=>{Ae==="pendente"&&ee(qe=>qe.includes(xe)?qe.filter(sa=>sa!==xe):[...qe,xe])},V=()=>{const xe=n.filter(Ae=>Ae.status==="pendente");ie.length===xe.length?ee([]):ee(xe.map(Ae=>Ae.id))},Fe=()=>{const xe=new Date().toISOString().split("T")[0];Pe(xe),_e(""),Qe("sem_pagar"),Ee(""),Xe("");const Ae=fe();ca(Ae),de(!0)},Te=()=>{de(!1),Pe(""),_e("")},We=async()=>{var xe,Ae;if(!me){alert("Por favor, informe a data de pagamento");return}if(ze==="com_pagamento"&&!he){alert("Por favor, selecione a conta banc√°ria para o pagamento");return}try{Ye(!0);let qe;if(ze==="sem_pagar")qe=await F.post("/comissoes/fechar",{comissoes_ids:ie,data_pagamento:me,observacao:se||null});else{const sa=new URLSearchParams({valor_pago:Je.toString(),forma_pagamento:be||"nao_informado",data_pagamento:me});he&&sa.append("conta_bancaria_id",he),se&&sa.append("observacoes",se),ie.forEach(Ia=>{sa.append("comissoes_ids",Ia)}),qe=await F.post(`/comissoes/fechar-com-pagamento?${sa.toString()}`)}if(qe.data.success){const sa=ze==="sem_pagar"?qe.data.valor_total_fechamento:qe.data.valor_total_pago;alert(`‚úÖ ${qe.data.total_processadas} comiss√£o(√µes) fechada(s) com sucesso!

Valor total: ${le(sa)}
Modo: ${ze==="sem_pagar"?"Sem pagamento (para pagar depois)":"Com pagamento no ato"}`),await Ce(),await Be(),ee([]),Te()}}catch(qe){console.error("Erro ao fechar comiss√µes:",qe),alert("‚ùå Erro ao fechar comiss√µes: "+(((Ae=(xe=qe.response)==null?void 0:xe.data)==null?void 0:Ae.detail)||qe.message))}finally{Ye(!1)}},ua=()=>{const xe=(p||[]).filter(qe=>{var sa;return(sa=qe==null?void 0:qe.nome)==null?void 0:sa.toLowerCase().includes(re.toLowerCase())}),Ae=(C||[]).filter(qe=>{var sa;return(sa=qe==null?void 0:qe.nome)==null?void 0:sa.toLowerCase().includes(R.toLowerCase())});return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Filtros"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[n.length," registro",n.length!==1?"s":""," encontrado",n.length!==1?"s":""]})]}),e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"üìÖ Per√≠odo"}),e.jsxs("div",{className:"flex gap-4 mb-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"ate_hoje",checked:u==="ate_hoje",onChange:qe=>{i(qe.target.value);const sa=new Date().toISOString().split("T")[0];b(Ia=>({...Ia,data_inicio:"",data_fim:sa}))},className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"At√© hoje"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"personalizado",checked:u==="personalizado",onChange:qe=>i(qe.target.value),className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Per√≠odo personalizado"})]})]}),u==="personalizado"&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Data In√≠cio"}),e.jsx("input",{type:"date",value:x.data_inicio,onChange:qe=>Oe("data_inicio",qe.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:x.data_fim,onChange:qe=>Oe("data_fim",qe.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"relative autocomplete-container",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Funcion√°rio"}),e.jsx("input",{type:"text",value:O,onChange:qe=>{z(qe.target.value),W(!0),qe.target.value===""&&(H(null),b(sa=>({...sa,funcionario_id:""})))},onFocus:()=>W(!0),disabled:B,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",placeholder:B?"Carregando...":"Digite o nome"}),ae&&O&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-auto",children:Ue.length>0?Ue.map(qe=>e.jsxs("div",{onClick:()=>ia(qe),className:"px-3 py-2 hover:bg-blue-50 cursor-pointer transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900",children:qe.nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",qe.id]})]},qe.id)):e.jsx("div",{className:"px-3 py-2 text-gray-500 text-sm",children:"Nenhum funcion√°rio encontrado"})})]}),e.jsxs("div",{className:"relative autocomplete-container",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Produto"}),e.jsx("input",{type:"text",value:re,onChange:qe=>{M(qe.target.value),L(!0),qe.target.value===""&&(S(null),b(sa=>({...sa,produto_id:""})))},onFocus:()=>L(!0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Digite o nome do produto"}),te&&re&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-auto",children:xe.length>0?xe.map(qe=>e.jsxs("div",{onClick:()=>ea(qe),className:"px-3 py-2 hover:bg-blue-50 cursor-pointer transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900",children:qe.nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",qe.id]})]},qe.id)):e.jsx("div",{className:"px-3 py-2 text-gray-500 text-sm",children:"Nenhum produto encontrado"})})]}),e.jsxs("div",{className:"relative autocomplete-container",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Grupo/Categoria"}),e.jsx("input",{type:"text",value:R,onChange:qe=>{J(qe.target.value),A(!0),qe.target.value===""&&(K(null),b(sa=>({...sa,grupo_id:""})))},onFocus:()=>A(!0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Digite o nome do grupo"}),Z&&R&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-auto",children:Ae.length>0?Ae.map(qe=>e.jsxs("div",{onClick:()=>na(qe),className:"px-3 py-2 hover:bg-blue-50 cursor-pointer transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900",children:qe.nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",qe.id]})]},qe.id)):e.jsx("div",{className:"px-3 py-2 text-gray-500 text-sm",children:"Nenhum grupo encontrado"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:x.status,onChange:qe=>Oe("status",qe.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"pendente",children:"Pendente"}),e.jsx("option",{value:"pago",children:"Pago"}),e.jsx("option",{value:"estornado",children:"Estornado"})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:Ke,disabled:d,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"Filtrar"]}),e.jsxs("button",{onClick:He,disabled:d,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition disabled:opacity-50 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Limpar Filtros"]})]})]})};return d?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando comiss√µes..."})]})}):g?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-red-800 font-semibold mb-2",children:"Erro ao carregar comiss√µes"}),e.jsx("p",{className:"text-red-600",children:g}),e.jsx("button",{onClick:Ce,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition",children:"Tentar Novamente"})]})}):n.length===0?e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Demonstrativo de Comiss√µes"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-blue-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Nenhuma comiss√£o encontrada"}),e.jsx("p",{className:"text-gray-600",children:"Ainda n√£o h√° registros de comiss√µes no sistema."})]})]}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Demonstrativo de Comiss√µes"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Total de registros: ",n.length]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>s("/comissoes/relatorios"),className:"inline-flex items-center px-4 py-2 border border-purple-300 rounded-md shadow-sm text-sm font-medium text-purple-700 bg-purple-50 hover:bg-purple-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:[e.jsx("svg",{className:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),"üìä Relat√≥rios"]}),e.jsxs("button",{onClick:()=>s("/comissoes/fechamentos"),className:"inline-flex items-center px-4 py-2 border border-purple-300 rounded-md shadow-sm text-sm font-medium text-purple-700 bg-purple-50 hover:bg-purple-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:[e.jsx("svg",{className:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Ver Hist√≥rico"]})]})]}),ne(),ua(),ie.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-blue-800 font-medium",children:[ie.length," comiss√£o(√µes) selecionada(s)"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ee([]),className:"px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Limpar Sele√ß√£o"}),e.jsxs("button",{onClick:Fe,disabled:ke,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:opacity-50 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Fechar Comiss√µes"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:ie.length>0&&ie.length===n.filter(xe=>xe.status==="pendente").length,onChange:V,disabled:n.filter(xe=>xe.status==="pendente").length===0,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer",title:"Selecionar todas pendentes"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data da Venda"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"N√∫mero da Venda"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Parcela"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo de C√°lculo"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Base de C√°lculo"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"% Comiss√£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor Comiss√£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(xe=>e.jsxs("tr",{className:"hover:bg-blue-50 transition",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",onClick:Ae=>Ae.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:ie.includes(xe.id),onChange:()=>Ca(xe.id,xe.status),disabled:xe.status!=="pendente",className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer disabled:opacity-30 disabled:cursor-not-allowed",title:xe.status!=="pendente"?`Comiss√£o ${xe.status}`:"Selecionar para fechamento"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 cursor-pointer",onClick:()=>pe(xe.id),children:U(xe.data_venda)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-blue-600 font-medium cursor-pointer",onClick:()=>pe(xe.id),title:`ID interno: #${xe.venda_id}`,children:xe.numero_venda||`#${xe.venda_id}`}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 cursor-pointer",onClick:()=>pe(xe.id),children:["#",xe.produto_id]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 cursor-pointer",onClick:()=>pe(xe.id),children:xe.parcela_numero}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm cursor-pointer",onClick:()=>pe(xe.id),children:q(xe.tipo_calculo)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium cursor-pointer",onClick:()=>pe(xe.id),children:le(xe.valor_base_calculo)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right cursor-pointer",onClick:()=>pe(xe.id),children:Ne(xe.percentual_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-bold cursor-pointer",onClick:()=>pe(xe.id),children:le(xe.valor_comissao_gerada)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm cursor-pointer",onClick:()=>pe(xe.id),children:Re(xe.status)})]},xe.id))})]})})}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"‚ÑπÔ∏è Informa√ß√£o:"})," Os valores exibidos s√£o snapshots imut√°veis do momento da venda. Eles n√£o s√£o recalculados e refletem exatamente como a comiss√£o foi gerada.",e.jsx("span",{className:"ml-2 text-blue-600 font-medium",children:"Clique em qualquer linha para ver mais detalhes."})]})}),n.length>0&&e.jsx("div",{className:"fixed bottom-0 left-64 right-0 bg-gradient-to-r from-indigo-600 via-blue-600 to-indigo-600 text-white shadow-lg z-40 border-t border-indigo-300/30",children:e.jsx("div",{className:"max-w-7xl mx-auto px-8 py-3.5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-semibold text-indigo-200 mb-0.5 tracking-wide uppercase",children:"üìÖ Per√≠odo"}),e.jsx("div",{className:"text-sm font-bold text-white",children:u==="ate_hoje"?"At√© hoje":e.jsxs(e.Fragment,{children:[x.data_inicio?new Date(x.data_inicio).toLocaleDateString("pt-BR"):"In√≠cio"," ‚Üí ",x.data_fim?new Date(x.data_fim).toLocaleDateString("pt-BR"):"Fim"]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-semibold text-indigo-200 mb-0.5 tracking-wide uppercase",children:"üîç Filtros"}),e.jsxs("div",{className:"text-sm font-bold text-white",children:[P&&e.jsxs("span",{className:"mr-2 bg-white/10 px-2 py-0.5 rounded",children:["üë§ ",P.nome]}),_&&e.jsxs("span",{className:"mr-2 bg-white/10 px-2 py-0.5 rounded",children:["üì¶ ",_.nome]}),$&&e.jsxs("span",{className:"mr-2 bg-white/10 px-2 py-0.5 rounded",children:["üìÇ ",$.nome]}),x.status&&e.jsxs("span",{className:"mr-2 bg-white/10 px-2 py-0.5 rounded",children:["‚ö° ",x.status]}),!P&&!_&&!$&&!x.status&&e.jsx("span",{className:"text-indigo-200",children:"Sem filtros"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-[10px] font-semibold text-indigo-200 mb-0.5 tracking-wide uppercase",children:"üí∞ Total Pendente (Filtrado)"}),e.jsx("div",{className:"text-3xl font-bold text-white drop-shadow-sm",children:le(X())}),e.jsxs("div",{className:"text-[11px] text-indigo-100 mt-0.5 font-medium",children:[n.filter(xe=>xe.status==="pendente").length," comiss√£o(√µes) pendente(s)"]})]})]})})}),n.length>0&&e.jsx("div",{className:"h-24"}),k&&e.jsx(Wd,{comissaoId:k,onClose:$e}),Q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Fechar Comiss√µes Selecionadas"}),e.jsx("button",{onClick:Te,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700 font-medium",children:[ie.length," comiss√£o(√µes) selecionada(s)"]})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Valor Total"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:le(fe())})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-3",children:"‚öôÔ∏è Tipo de Fechamento"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("button",{type:"button",onClick:()=>Qe("sem_pagar"),className:`p-4 border-2 rounded-lg transition-all ${ze==="sem_pagar"?"border-blue-500 bg-blue-50 shadow-md":"border-gray-300 hover:border-blue-300"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"üìã"}),e.jsx("div",{className:"font-bold text-gray-800",children:"Fechar sem Pagar"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Apenas registrar fechamento"})]})}),e.jsx("button",{type:"button",onClick:()=>Qe("com_pagamento"),className:`p-4 border-2 rounded-lg transition-all ${ze==="com_pagamento"?"border-green-500 bg-green-50 shadow-md":"border-gray-300 hover:border-green-300"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"üí∞"}),e.jsx("div",{className:"font-bold text-gray-800",children:"Fechar e Pagar"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Com lan√ßamento financeiro"})]})})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["üìÖ Data do Fechamento/Pagamento ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:me,onChange:xe=>Pe(xe.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),ze==="com_pagamento"&&e.jsxs("div",{className:"space-y-4 mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-bold text-green-800 mb-3",children:"üí≥ Dados do Pagamento"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"üíµ Valor a Pagar (edit√°vel)"}),e.jsx("input",{type:"number",step:"0.01",value:Je,onChange:xe=>ca(parseFloat(xe.target.value)),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Valor original: ",le(fe())]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["üí≥ Forma de Pagamento ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:be,onChange:xe=>Ee(xe.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),formasPagamento.map(xe=>e.jsx("option",{value:xe.id,children:xe.nome},xe.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["üè¶ Conta Banc√°ria ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:he,onChange:xe=>Xe(xe.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),la.map(xe=>e.jsxs("option",{value:xe.id,children:[xe.nome," (",xe.banco,") - Saldo: ",le(xe.saldo||0)]},xe.id))]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"üìù Observa√ß√µes"}),e.jsx("textarea",{value:se,onChange:xe=>_e(xe.target.value),rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Observa√ß√µes sobre o fechamento..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:Te,disabled:ke,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:We,disabled:ke||!me||ze==="com_pagamento"&&(!be||!he),className:`flex-1 px-4 py-2 rounded-lg transition disabled:opacity-50 flex items-center justify-center gap-2 ${ze==="com_pagamento"?"bg-green-600 hover:bg-green-700":"bg-blue-600 hover:bg-blue-700"} text-white`,children:ke?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),ze==="com_pagamento"?"üí∞ Fechar e Pagar":"üìã Fechar sem Pagar"]})})]})]})})]})},Hd=()=>{const s=fa(),[n,t]=a.useState([]),[d,o]=a.useState(!0),[g,r]=a.useState(null);a.useEffect(()=>{v()},[]);const v=async()=>{var c,m;try{o(!0),r(null);const k=await F.get("/comissoes/abertas");k.data.success?t(k.data.funcionarios||[]):r("Erro ao carregar comiss√µes em aberto")}catch(k){console.error("Erro ao carregar comiss√µes abertas:",k),r(((m=(c=k.response)==null?void 0:c.data)==null?void 0:m.detail)||"Erro ao carregar comiss√µes em aberto")}finally{o(!1)}},j=c=>{s(`/comissoes/fechamento/${c}`)},f=c=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c),y=c=>c?new Date(c+"T00:00:00").toLocaleDateString("pt-BR"):"-";return d?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"bg-white shadow-md rounded-lg p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando comiss√µes em aberto..."})]})})}):g?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-6 w-6 text-red-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-medium",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:g})]})]}),e.jsx("button",{onClick:v,className:"mt-4 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-md transition-colors",children:"Tentar Novamente"})]})}):n.length===0?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Comiss√µes em Aberto"}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"h-16 w-16 text-green-500 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-xl font-semibold text-green-800 mb-2",children:"Nenhuma comiss√£o pendente"}),e.jsx("p",{className:"text-green-600",children:"N√£o h√° funcion√°rios com comiss√µes em aberto no momento."})]})]})}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Comiss√µes em Aberto"}),e.jsx("p",{className:"text-gray-600",children:"Funcion√°rios com comiss√µes pendentes de pagamento"})]}),e.jsxs("button",{onClick:()=>s("/comissoes/fechamentos"),className:"inline-flex items-center px-4 py-2 border border-purple-300 rounded-md shadow-sm text-sm font-medium text-purple-700 bg-purple-50 hover:bg-purple-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:[e.jsx("svg",{className:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Ver Hist√≥rico"]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total de Funcion√°rios"}),e.jsx("p",{className:"text-2xl font-bold text-blue-800",children:n.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Pendente"}),e.jsx("p",{className:"text-2xl font-bold text-blue-800",children:f(n.reduce((c,m)=>c+m.total_pendente,0))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total de Comiss√µes"}),e.jsx("p",{className:"text-2xl font-bold text-blue-800",children:n.reduce((c,m)=>c+m.quantidade_comissoes,0)})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Funcion√°rio"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Pendente"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qtde de Comiss√µes"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"√öltima Venda"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A√ß√£o"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(c=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold text-sm",children:c.nome_funcionario.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:c.nome_funcionario}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",c.funcionario_id]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-semibold text-green-600",children:f(c.total_pendente)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:c.quantidade_comissoes})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500",children:y(c.data_ultima_venda)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsxs("button",{onClick:()=>j(c.funcionario_id),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",children:[e.jsx("svg",{className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Conferir"]})})]},c.funcionario_id))})]})}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsx("p",{className:"text-sm text-gray-500 text-center",children:'Clique em "Conferir" para visualizar os detalhes das comiss√µes de cada funcion√°rio'})})]})})},Gd=()=>{const{funcionario_id:s}=Bs(),n=fa(),[t,d]=a.useState(!0),[o,g]=a.useState(null),[r,v]=a.useState(null),[j,f]=a.useState([]),[y,c]=a.useState(null),[m,k]=a.useState(null),[w,x]=a.useState([]),[b,u]=a.useState([]),[i,p]=a.useState([]),[l,C]=a.useState(""),[h,_]=a.useState(""),[S,$]=a.useState(""),[K,re]=a.useState(""),[M,R]=a.useState(!1),[J,te]=a.useState(new Set),[L,Z]=a.useState(""),[A,G]=a.useState("nao_informado"),[E,P]=a.useState(new Date().toISOString().split("T")[0]),[H,B]=a.useState(""),[N,O]=a.useState(!1),[z,ae]=a.useState(null);a.useEffect(()=>{W()},[s]);const W=async()=>{var ke,Ye;try{d(!0),g(null);const ze=await F.get(`/comissoes/conferencia-avancada/${s}`);ze.data.success&&(v(ze.data.funcionario),f(ze.data.comissoes),c(ze.data.resumo),k(ze.data.periodo_selecionado));const Qe=await F.get("/comissoes/formas-pagamento");Qe.data.success&&p(Qe.data.formas);const be=await F.get("/produtos/categorias");be.data.data&&x(be.data.data)}catch(ze){g(((Ye=(ke=ze.response)==null?void 0:ke.data)==null?void 0:Ye.detail)||"Erro ao carregar dados"),console.error("Erro:",ze)}finally{d(!1)}},ie=async()=>{var ke,Ye;try{d(!0);const ze={grupo_produto:l?parseInt(l):void 0,produto_id:h?parseInt(h):void 0,data_inicio:S||void 0,data_fim:K||void 0},Qe=await F.get(`/comissoes/conferencia-avancada/${s}`,{params:Object.fromEntries(Object.entries(ze).filter(([be,Ee])=>Ee!==void 0))});Qe.data.success&&(f(Qe.data.comissoes),c(Qe.data.resumo),k(Qe.data.periodo_selecionado))}catch(ze){g(((Ye=(ke=ze.response)==null?void 0:ke.data)==null?void 0:Ye.detail)||"Erro ao aplicar filtros")}finally{d(!1)}},ee=()=>{C(""),_(""),$(""),re(""),setTimeout(()=>W(),100)},Q=ke=>{const Ye=new Set(J);Ye.has(ke)?Ye.delete(ke):Ye.add(ke),te(Ye)},de=()=>{J.size===j.length?te(new Set):te(new Set(j.map(ke=>ke.id)))},me=()=>{if(J.size===0){alert("Selecione pelo menos uma comiss√£o");return}P(new Date().toISOString().split("T")[0]),Z(""),G("nao_informado"),B(""),ae(null),R(!0)},Pe=async()=>{var ke,Ye;try{if(!L||parseFloat(L)<=0){ae("Valor a pagar deve ser maior que zero");return}O(!0),ae(null);const ze={comissoes_ids:Array.from(J),valor_pago:parseFloat(L),forma_pagamento:A,data_pagamento:E,observacoes:H||null},Qe=await F.post("/comissoes/fechar-com-pagamento",ze);Qe.data.success&&(alert(`‚úÖ Fechamento realizado com sucesso!

Processadas: ${Qe.data.total_processadas}
Valor total: R$ ${Qe.data.valor_total_fechado.toFixed(2)}
Valor pago: R$ ${Qe.data.valor_total_pago.toFixed(2)}
Saldo restante: R$ ${Qe.data.saldo_total_restante.toFixed(2)}
Comiss√µes com saldo: ${Qe.data.comissoes_com_saldo}`),R(!1),te(new Set),W())}catch(ze){ae(((Ye=(ke=ze.response)==null?void 0:ke.data)==null?void 0:Ye.detail)||"Erro ao fechar comiss√µes")}finally{O(!1)}};if(t)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})});const se=Array.from(J).reduce((ke,Ye)=>{const ze=j.find(Qe=>Qe.id===Ye);return ke+(ze?ze.valor_comissao:0)},0),_e=se-(parseFloat(L)||0);return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Confer√™ncia de Comiss√µes"}),e.jsx("p",{className:"text-gray-600 mt-1",children:r?`${r.nome} (ID: ${r.id})`:"Carregando..."})]}),e.jsx("button",{onClick:()=>n("/comissoes/abertas"),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"‚Üê Voltar"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Filtros Avan√ßados"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Grupo de Produto"}),e.jsxs("select",{value:l,onChange:ke=>C(ke.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"",children:"Todos"}),w.map(ke=>e.jsx("option",{value:ke.id,children:ke.nome},ke.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Produto"}),e.jsx("input",{type:"text",placeholder:"Buscar produto...",value:h,onChange:ke=>_(ke.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data In√≠cio"}),e.jsx("input",{type:"date",value:S,onChange:ke=>$(ke.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Fim"}),e.jsx("input",{type:"date",value:K,onChange:ke=>re(ke.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:ie,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Aplicar Filtros"}),e.jsx("button",{onClick:ee,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Limpar"})]})]}),m&&y&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 mb-6 border border-blue-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Per√≠odo Selecionado"}),e.jsx("p",{className:"text-gray-600",children:m.data_inicio&&m.data_fim?`${new Date(m.data_inicio).toLocaleDateString("pt-BR")} at√© ${new Date(m.data_fim).toLocaleDateString("pt-BR")}`:"Sem per√≠odo espec√≠fico"}),m.grupo_produto_nome&&e.jsxs("p",{className:"text-gray-600 text-sm",children:["Grupo: ",m.grupo_produto_nome]}),m.produto_nome&&e.jsxs("p",{className:"text-gray-600 text-sm",children:["Produto: ",m.produto_nome]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Resumo do Per√≠odo"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Quantidade"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:y.quantidade_comissoes})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["R$ ",y.valor_total.toFixed(2)]})]}),y.valor_pago_total>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pago"}),e.jsxs("p",{className:"text-lg font-semibold text-blue-600",children:["R$ ",y.valor_pago_total.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Saldo"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["R$ ",y.saldo_restante_total.toFixed(2)]})]})]})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden mb-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:J.size===j.length&&j.length>0,onChange:de})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Quantidade"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Base"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"%"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Pago"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Saldo"})]})}),e.jsx("tbody",{children:j.map(ke=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:J.has(ke.id),onChange:()=>Q(ke.id)})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(ke.data_venda).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"px-4 py-3 text-sm",children:ke.nome_produto}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:ke.cliente_nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:ke.quantidade.toFixed(2)}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right",children:["R$ ",ke.valor_base_calculo.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right",children:[ke.percentual_comissao.toFixed(2),"%"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right font-semibold text-green-600",children:["R$ ",ke.valor_comissao.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-blue-600",children:ke.valor_pago?`R$ ${ke.valor_pago.toFixed(2)}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-orange-600",children:ke.saldo_restante?`R$ ${ke.saldo_restante.toFixed(2)}`:"-"})]},ke.id))})]})})}),e.jsx("div",{className:"bg-gray-900 text-white rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-300",children:[J.size," de ",j.length," comiss√µes selecionadas"]})}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Total Selecionado"}),e.jsxs("p",{className:"text-2xl font-bold text-green-400",children:["R$ ",se.toFixed(2)]})]}),parseFloat(L)>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Ser√° Pago"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-400",children:["R$ ",parseFloat(L).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Saldo Restante"}),e.jsxs("p",{className:`text-2xl font-bold ${_e>0?"text-orange-400":"text-green-400"}`,children:["R$ ",_e.toFixed(2)]})]})]}),e.jsx("button",{onClick:me,disabled:J.size===0,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-500 rounded-lg font-semibold transition",children:"Fechar e Pagar"})]})]})}),M&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-2xl p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Fechamento com Pagamento"}),z&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:z}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded border border-blue-200",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Comiss√µes a processar: ",J.size]}),e.jsxs("p",{className:"text-lg font-bold text-gray-800",children:["Valor Total: R$ ",se.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de Pagamento *"}),e.jsx("select",{value:A,onChange:ke=>G(ke.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:i.map(ke=>e.jsx("option",{value:ke.nome,children:ke.descricao},ke.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor a Pagar *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"flex items-center bg-gray-100 px-3 py-2 rounded-lg border border-gray-300",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:se,value:L,onChange:ke=>Z(ke.target.value),placeholder:"0.00",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["M√°ximo: R$ ",se.toFixed(2),parseFloat(L)<se&&parseFloat(L)>0&&e.jsxs("span",{className:"text-orange-600 font-semibold ml-2",children:["(Pagamento Parcial - Saldo: R$ ",(se-parseFloat(L)).toFixed(2),")"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data de Pagamento *"}),e.jsx("input",{type:"date",value:E,onChange:ke=>P(ke.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes"}),e.jsx("textarea",{value:H,onChange:ke=>B(ke.target.value),placeholder:"Observa√ß√µes opcionais...",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>R(!1),disabled:N,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:Pe,disabled:N,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:N?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"‚è≥"}),"Processando..."]}):"Confirmar Fechamento"})]})]})})]})},Qd=()=>{const s=fa(),[n,t]=a.useState([]),[d,o]=a.useState(!0),[g,r]=a.useState(null),[v,j]=a.useState(null),[f,y]=a.useState(""),[c,m]=a.useState(""),[k,w]=a.useState("");a.useEffect(()=>{x()},[]);const x=async()=>{var h,_;try{o(!0),r(null);const S=new URLSearchParams;f&&S.append("data_inicio",f),c&&S.append("data_fim",c),k&&S.append("funcionario_id",k);const $=`/comissoes/fechamentos${S.toString()?"?"+S.toString():""}`,K=await F.get($);K.data.success?(t(K.data.fechamentos||[]),j(K.data.resumo)):r("Erro ao carregar hist√≥rico")}catch(S){console.error("Erro ao carregar hist√≥rico:",S),r(((_=(h=S.response)==null?void 0:h.data)==null?void 0:_.detail)||"Erro ao carregar hist√≥rico de fechamentos")}finally{o(!1)}},b=()=>{x()},u=()=>{y(""),m(""),w(""),setTimeout(()=>x(),100)},i=h=>{s(`/comissoes/fechamentos/detalhe?funcionario_id=${h.funcionario_id}&data_pagamento=${h.data_pagamento}`)},p=h=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(h),l=h=>h?new Date(h+"T00:00:00").toLocaleDateString("pt-BR"):"-",C=h=>h?new Date(h).toLocaleString("pt-BR"):"-";return d?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"bg-white shadow-md rounded-lg p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando hist√≥rico..."})]})})}):g?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-6 w-6 text-red-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-medium",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:g})]})]}),e.jsx("button",{onClick:x,className:"mt-4 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-md transition-colors",children:"Tentar Novamente"})]})}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-8",children:[e.jsxs("div",{className:"mb-6 border-b border-gray-200 pb-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Hist√≥rico de Fechamentos"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Auditoria de comiss√µes fechadas - somente leitura"})]}),e.jsxs("div",{className:"mb-6 bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Filtros"}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data In√≠cio"}),e.jsx("input",{type:"date",value:f,onChange:h=>y(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:c,onChange:h=>m(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ID do Funcion√°rio"}),e.jsx("input",{type:"number",value:k,onChange:h=>w(h.target.value),placeholder:"Deixe vazio para todos",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors",children:"Aplicar"}),e.jsx("button",{onClick:u,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md transition-colors",children:"Limpar"})]})]})]}),v&&e.jsx("div",{className:"mb-6 bg-purple-50 border border-purple-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Total de Fechamentos"}),e.jsx("p",{className:"text-2xl font-bold text-purple-800",children:v.total_fechamentos})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Valor Total Pago"}),e.jsx("p",{className:"text-2xl font-bold text-purple-800",children:p(v.valor_total_geral)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Total de Comiss√µes"}),e.jsx("p",{className:"text-2xl font-bold text-purple-800",children:v.quantidade_total_geral})]})]})}),n.length===0?e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"h-16 w-16 text-yellow-500 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-xl font-semibold text-yellow-800 mb-2",children:"Nenhum fechamento encontrado"}),e.jsx("p",{className:"text-yellow-600",children:"N√£o h√° fechamentos registrados no per√≠odo selecionado."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Funcion√°rio"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Fechamento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Pagamento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qtde"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor Total"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A√ß√£o"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map((h,_)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>i(h),children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-purple-600 font-semibold text-sm",children:h.nome_funcionario.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:h.nome_funcionario}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",h.funcionario_id]})]})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-600",children:C(h.data_fechamento)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm font-medium text-gray-900",children:l(h.data_pagamento)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800",children:h.quantidade_comissoes})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-semibold text-green-600",children:p(h.valor_total)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("button",{onClick:S=>{S.stopPropagation(),i(h)},className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:"Ver Detalhes"})})]},`${h.funcionario_id}_${h.data_pagamento}_${_}`))})]})}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"üí° Clique em uma linha para ver os detalhes do fechamento"})})]})]})})},Xd=()=>{const s=fa(),[n]=dr(),t=n.get("funcionario_id"),d=n.get("data_pagamento"),[o,g]=a.useState(null),[r,v]=a.useState(!0),[j,f]=a.useState(null);a.useEffect(()=>{if(!t||!d){f("Par√¢metros inv√°lidos: funcionario_id e data_pagamento s√£o obrigat√≥rios"),v(!1);return}y()},[t,d]);const y=async()=>{var u,i;try{v(!0),f(null);const p=await F.get("/comissoes/fechamentos/detalhe",{params:{funcionario_id:t,data_pagamento:d}});p.data.success?g(p.data):f("Erro ao carregar detalhes do fechamento")}catch(p){console.error("Erro ao carregar detalhes:",p),f(((i=(u=p.response)==null?void 0:u.data)==null?void 0:i.detail)||"Erro ao carregar detalhes do fechamento")}finally{v(!1)}},c=u=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(u),m=u=>u?new Date(u+"T00:00:00").toLocaleDateString("pt-BR"):"-",k=u=>u?new Date(u).toLocaleString("pt-BR"):"-",w=()=>{s("/comissoes/fechamentos")};if(r)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"bg-white shadow-md rounded-lg p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando detalhes..."})]})})});if(j||!o)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-6 w-6 text-red-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-medium",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:j||"Fechamento n√£o encontrado"})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:y,className:"px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-md transition-colors",children:"Tentar Novamente"}),e.jsx("button",{onClick:w,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md transition-colors",children:"Voltar"})]})]})});const{fechamento:x,comissoes:b}=o;return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-8",children:[e.jsxs("div",{className:"mb-6 border-b border-gray-200 pb-4",children:[e.jsxs("button",{onClick:w,className:"mb-4 inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:[e.jsx("svg",{className:"mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Voltar"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Detalhes do Fechamento"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Visualiza√ß√£o completa das comiss√µes inclu√≠das neste fechamento"}),e.jsxs("div",{className:"mt-3 inline-flex items-center px-3 py-1 rounded-full bg-yellow-100 border border-yellow-300",children:[e.jsx("svg",{className:"h-4 w-4 text-yellow-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Somente Leitura - Registro de Auditoria"})]})]}),e.jsxs("div",{className:"mb-6 bg-purple-50 border border-purple-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-purple-800 mb-4",children:"Informa√ß√µes do Fechamento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Funcion√°rio"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-purple-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-purple-700 font-semibold text-sm",children:x.nome_funcionario.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:x.nome_funcionario}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",x.funcionario_id]})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Data do Fechamento"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:k(x.data_fechamento)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Data de Pagamento"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:m(x.data_pagamento)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Quantidade de Comiss√µes"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:x.quantidade_comissoes})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Valor Total"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c(x.valor_total)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Per√≠odo das Vendas"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:x.periodo_vendas})]})]}),x.observacao_pagamento&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-purple-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Observa√ß√µes"}),e.jsx("p",{className:"text-sm text-gray-800 italic",children:x.observacao_pagamento})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Comiss√µes Inclu√≠das"}),b&&b.length>0?e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Venda"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qtde"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor Venda"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"% Comiss√£o"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Comiss√£o"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map((u,i)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:u.nome_cliente||"Cliente n√£o identificado"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:u.nome_produto||"Produto n√£o identificado"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-600",children:m(u.data_venda)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-600",children:u.quantidade}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-gray-900",children:c(u.valor_venda_snapshot)}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-600",children:[u.percentual_snapshot,"%"]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-semibold text-green-600",children:c(u.valor_comissao)})]},u.id||i))}),e.jsx("tfoot",{className:"bg-gray-50 border-t-2 border-gray-300",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"6",className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"TOTAL:"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-base font-bold text-green-700",children:c(x.valor_total)})]})})]})}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-yellow-800",children:"Nenhuma comiss√£o encontrada para este fechamento."})})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-500 mt-0.5 mr-3 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800 mb-1",children:"Informa√ß√µes Importantes"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Este √© um registro imut√°vel de auditoria"}),e.jsx("li",{children:"N√£o √© poss√≠vel editar ou reverter fechamentos realizados"}),e.jsx("li",{children:"Os valores foram capturados no momento do fechamento (snapshot)"}),e.jsx("li",{children:"Para quest√µes sobre este fechamento, entre em contato com a administra√ß√£o"})]})]})]})})]})})},Jd=()=>{const s=fa(),[n,t]=a.useState("margem-produto"),[d,o]=a.useState(!1),[g,r]=a.useState(""),[v,j]=a.useState(""),[f,y]=a.useState(null),[c,m]=a.useState(null),[k,w]=a.useState(null),[x,b]=a.useState(null),[u,i]=a.useState(null),[p,l]=a.useState(null),C=async E=>{o(!0);try{const P={};g&&(P.data_inicio=g),v&&(P.data_fim=v);let H="",B=null;switch(E){case"margem-produto":H="/relatorios-comissoes/margem-produto",B=y;break;case"produtos-prejudiciais":H="/relatorios-comissoes/produtos-prejudiciais",B=m;break;case"ranking-funcionarios":H="/relatorios-comissoes/ranking-funcionarios",B=w;break;case"ranking-produtos":H="/relatorios-comissoes/ranking-produtos",B=b;break;case"ranking-categorias":H="/relatorios-comissoes/ranking-categorias",B=i;break;case"dre":H="/relatorios-comissoes/visao-dre",P.ano=2026,B=l;break;default:o(!1);return}const N=await F.get(H,{params:P,timeout:1e4});B(N.data)}catch(P){console.error(`Erro ao carregar relat√≥rio ${E}:`,P),P.code==="ECONNABORTED"||P.message.includes("timeout")?alert("‚è±Ô∏è Tempo de resposta excedido. Verifique se o backend est√° rodando."):alert("‚ùå Erro ao carregar relat√≥rio. Verifique o console para detalhes.")}finally{o(!1)}};a.useEffect(()=>{C(n)},[n]);const h=()=>{C(n)},_=E=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(E),S=E=>`${E.toFixed(2)}%`,$=async()=>{try{const E={tipo:n,data_inicio:g,data_fim:v},P=await F.get("/relatorios-comissoes/exportar-csv",{params:E,responseType:"blob"}),H=window.URL.createObjectURL(new Blob([P.data])),B=document.createElement("a");B.href=H,B.setAttribute("download",`relatorio_${n}_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(B),B.click(),B.remove()}catch(E){console.error("Erro ao exportar CSV:",E),alert("Erro ao exportar arquivo")}},K=["#8884d8","#82ca9d","#ffc658","#ff7c7c","#a28bd4","#f48fb1"],re=E=>E===3?"text-red-700 bg-red-100 border-red-300":E===2?"text-orange-700 bg-orange-100 border-orange-300":"text-yellow-700 bg-yellow-100 border-yellow-300",M=()=>{const E=[{id:"margem-produto",label:"üìä Margem por Produto",icone:"üí∞"},{id:"produtos-prejudiciais",label:"‚ö†Ô∏è Produtos Prejudiciais",icone:"üö®"},{id:"ranking-funcionarios",label:"üë• Ranking Funcion√°rios",icone:"üèÜ"},{id:"ranking-produtos",label:"üì¶ Ranking Produtos",icone:"üìà"},{id:"ranking-categorias",label:"üìÇ Ranking Categorias",icone:"üéØ"},{id:"dre",label:"üìë Vis√£o DRE",icone:"üíº"}];return e.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:E.map(P=>e.jsxs("button",{onClick:()=>t(P.id),className:`px-4 py-3 rounded-lg font-medium whitespace-nowrap transition-all ${n===P.id?"bg-blue-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx("span",{className:"text-xl mr-2",children:P.icone}),P.label]},P.id))})},R=()=>e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"üìÖ Data In√≠cio"}),e.jsx("input",{type:"date",value:g,onChange:E=>r(E.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"üìÖ Data Fim"}),e.jsx("input",{type:"date",value:v,onChange:E=>j(E.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition mt-6",children:"üîç Buscar"}),e.jsx("button",{onClick:()=>{r(""),j(""),C(n)},className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition mt-6",children:"üîÑ Limpar"}),["margem-produto","produtos-prejudiciais","ranking-funcionarios","ranking-produtos"].includes(n)&&e.jsx("button",{onClick:$,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition mt-6",children:"üì• Exportar CSV"})]})]})}),J=()=>{if(!f)return e.jsx("div",{className:"text-center py-12",children:"Carregando..."});const E=f.dados.slice(0,10);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Total de Produtos"}),e.jsx("div",{className:"text-3xl font-bold text-blue-800",children:f.total_produtos})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-red-600 font-medium",children:"Produtos com Margem Negativa"}),e.jsx("div",{className:"text-3xl font-bold text-red-800",children:f.produtos_com_alerta})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Produtos Saud√°veis"}),e.jsx("div",{className:"text-3xl font-bold text-green-800",children:f.total_produtos-f.produtos_com_alerta})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Top 10 Produtos por Margem L√≠quida"}),e.jsx(qa,{width:"100%",height:400,children:e.jsxs(is,{data:E,children:[e.jsx(Ba,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:"produto_nome",angle:-45,textAnchor:"end",height:100}),e.jsx(Ta,{}),e.jsx(Aa,{formatter:P=>_(P)}),e.jsx(Va,{}),e.jsx(Ka,{dataKey:"margem_liquida",fill:"#82ca9d",name:"Margem L√≠quida"}),e.jsx(Ka,{dataKey:"valor_comissao",fill:"#ff7c7c",name:"Comiss√£o"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Produto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Categoria"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Venda"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Custo"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Comiss√£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Margem L√≠quida"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"% Margem"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.dados.map((P,H)=>e.jsxs("tr",{className:P.alerta_margem_negativa?"bg-red-50":"",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:P.produto_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:P.categoria_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:_(P.valor_venda)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:_(P.valor_custo)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-orange-600 font-medium",children:_(P.valor_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold",children:e.jsx("span",{className:P.margem_liquida<0?"text-red-600":"text-green-600",children:_(P.margem_liquida)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:S(P.percentual_margem)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:P.alerta_margem_negativa?e.jsx("span",{className:"px-2 py-1 text-xs font-bold text-red-700 bg-red-100 rounded",children:"‚ö†Ô∏è NEGATIVA"}):e.jsx("span",{className:"px-2 py-1 text-xs font-bold text-green-700 bg-green-100 rounded",children:"‚úÖ OK"})})]},H))})]})})})]})},te=()=>c?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{className:"font-semibold",children:"Relat√≥rio informativo"})," baseado em vendas j√° realizadas. Os dados n√£o alteram comiss√µes, pre√ßos ou hist√≥ricos e n√£o devem ser usados para ajustes retroativos."]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Produtos Analisados"}),e.jsx("div",{className:"text-3xl font-bold text-blue-800",children:c.total_produtos_analisados})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-red-600 font-medium",children:"Cr√≠ticos"}),e.jsx("div",{className:"text-3xl font-bold text-red-800",children:c.produtos_criticos})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-orange-600 font-medium",children:"Total Prejudiciais"}),e.jsx("div",{className:"text-3xl font-bold text-orange-800",children:c.total_produtos_prejudiciais})]})]}),e.jsx("div",{className:"space-y-4",children:c.dados.map((E,P)=>e.jsxs("div",{className:`border-2 rounded-lg p-6 ${re(E.nivel_gravidade)}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:[E.nivel_gravidade===3&&"üö®",E.nivel_gravidade===2&&"‚ö†Ô∏è",E.nivel_gravidade===1&&"‚ö°"," ",E.produto_nome]}),e.jsx("p",{className:"text-sm opacity-75",children:E.categoria_nome})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-medium",children:"Impacto Financeiro"}),e.jsx("div",{className:"text-2xl font-bold",children:_(E.impacto_financeiro)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium opacity-75",children:"Margem L√≠quida"}),e.jsx("div",{className:"text-lg font-bold",children:_(E.margem_liquida)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium opacity-75",children:"% Margem"}),e.jsx("div",{className:"text-lg font-bold",children:S(E.percentual_margem)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium opacity-75",children:"Comiss√£o"}),e.jsx("div",{className:"text-lg font-bold",children:_(E.valor_comissao)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium opacity-75",children:"% Comiss√£o"}),e.jsx("div",{className:"text-lg font-bold",children:S(E.percentual_comissao)})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold mb-2",children:"‚ö†Ô∏è Alertas:"}),e.jsx("ul",{className:"list-disc list-inside text-sm space-y-1",children:E.alertas.map((H,B)=>e.jsx("li",{children:H},B))})]})]},P))})]}):e.jsx("div",{className:"text-center py-12",children:"Carregando..."}),L=()=>k?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{className:"font-semibold",children:"Relat√≥rio informativo"})," baseado em volume hist√≥rico. N√£o representa meta, desempenho ou pol√≠tica de incentivo."]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Funcion√°rios por Volume de Comiss√µes (10 maiores)"}),e.jsx(qa,{width:"100%",height:400,children:e.jsxs(is,{data:k.ranking,children:[e.jsx(Ba,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:"funcionario_nome",angle:-45,textAnchor:"end",height:100}),e.jsx(Ta,{}),e.jsx(Aa,{formatter:E=>_(E)}),e.jsx(Va,{}),e.jsx(Ka,{dataKey:"total_comissao",fill:"#8884d8",name:"Total de Comiss√µes"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Posi√ß√£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Funcion√°rio"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total Comiss√µes"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Quantidade"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"M√©dia"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:k.ranking.map(E=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsxs("span",{className:"text-lg font-semibold text-gray-700",children:[E.posicao,"¬∫"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:E.funcionario_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-green-600",children:_(E.total_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:E.quantidade_comissoes}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:_(E.media_comissao)})]},E.posicao))})]})})]}):e.jsx("div",{className:"text-center py-12",children:"Carregando..."}),Z=()=>x?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{className:"font-semibold",children:"Relat√≥rio informativo"})," baseado em volume hist√≥rico. N√£o representa meta, desempenho ou pol√≠tica de incentivo."]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Produtos por Volume de Comiss√µes (10 maiores)"}),e.jsx(qa,{width:"100%",height:400,children:e.jsxs(is,{data:x.ranking,children:[e.jsx(Ba,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:"produto_nome",angle:-45,textAnchor:"end",height:100}),e.jsx(Ta,{}),e.jsx(Aa,{formatter:E=>_(E)}),e.jsx(Va,{}),e.jsx(Ka,{dataKey:"total_comissao",fill:"#82ca9d",name:"Total de Comiss√µes"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Posi√ß√£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Produto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Categoria"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total Comiss√£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Qtd Vendas"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total Venda"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.ranking.map(E=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-center text-lg font-bold text-gray-700",children:[E.posicao,"¬∫"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:E.produto_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:E.categoria_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-green-600",children:_(E.total_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:E.quantidade_vendas}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:_(E.total_venda)})]},E.posicao))})]})})]}):e.jsx("div",{className:"text-center py-12",children:"Carregando..."}),A=()=>u?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{className:"font-semibold",children:"Relat√≥rio informativo"})," baseado em volume hist√≥rico. N√£o representa meta, desempenho ou pol√≠tica de incentivo."]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Distribui√ß√£o de Comiss√µes por Categoria"}),e.jsx(qa,{width:"100%",height:400,children:e.jsxs(wr,{children:[e.jsx(Cr,{data:u.ranking,dataKey:"total_comissao",nameKey:"categoria_nome",cx:"50%",cy:"50%",outerRadius:120,label:E=>`${E.categoria_nome}: ${E.percentual_total}%`,children:u.ranking.map((E,P)=>e.jsx(Xt,{fill:K[P%K.length]},`cell-${P}`))}),e.jsx(Aa,{formatter:E=>_(E)})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Posi√ß√£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Categoria"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total Comiss√£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"% do Total"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Qtd Comiss√µes"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total Vendas"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.ranking.map(E=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-center text-lg font-bold text-gray-700",children:[E.posicao,"¬∫"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:E.categoria_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-green-600",children:_(E.total_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-blue-600 font-medium",children:S(E.percentual_total)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:E.quantidade_comissoes}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:_(E.total_venda)})]},E.posicao))})]})})]}):e.jsx("div",{className:"text-center py-12",children:"Carregando..."}),G=()=>p?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{className:"font-semibold",children:"Regime de compet√™ncia:"})," as comiss√µes s√£o reconhecidas como despesa na data da venda, independentemente do pagamento. Inclui comiss√µes pendentes e pagas."]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Receita Bruta (Ano)"}),e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:_(p.total_ano.receita_bruta)})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-orange-600 font-medium",children:"Despesa Comiss√£o (Ano)"}),e.jsx("div",{className:"text-2xl font-bold text-orange-800",children:_(p.total_ano.despesa_comissao)})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Margem L√≠quida (Ano)"}),e.jsx("div",{className:"text-2xl font-bold text-green-800",children:_(p.total_ano.margem_liquida)})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-purple-600 font-medium",children:"% Comiss√£o sobre Receita"}),e.jsx("div",{className:"text-2xl font-bold text-purple-800",children:S(p.total_ano.percentual_comissao)})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Evolu√ß√£o Mensal - DRE"}),e.jsx(qa,{width:"100%",height:400,children:e.jsxs(ct,{data:p.dados_mensais,children:[e.jsx(Ba,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:"mes_nome"}),e.jsx(Ta,{}),e.jsx(Aa,{formatter:E=>_(E)}),e.jsx(Va,{}),e.jsx(ls,{type:"monotone",dataKey:"receita_bruta",stroke:"#8884d8",name:"Receita Bruta",strokeWidth:2}),e.jsx(ls,{type:"monotone",dataKey:"despesa_comissao",stroke:"#ff7c7c",name:"Despesa Comiss√£o",strokeWidth:2}),e.jsx(ls,{type:"monotone",dataKey:"margem_liquida",stroke:"#82ca9d",name:"Margem L√≠quida",strokeWidth:2})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"M√™s"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Receita Bruta"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Custo"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Comiss√£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Margem Bruta"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Margem L√≠quida"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"% Comiss√£o"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.dados_mensais.map(E=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:E.mes_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-blue-600 font-medium",children:_(E.receita_bruta)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:_(E.custo_total)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-orange-600 font-medium",children:_(E.despesa_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-700",children:_(E.margem_bruta)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-green-600",children:_(E.margem_liquida)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-purple-600",children:S(E.percentual_comissao_sobre_receita)})]},E.mes))})]})})]}):e.jsx("div",{className:"text-center py-12",children:"Carregando..."});return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>s("/comissoes-listagem"),className:"flex items-center gap-2 text-blue-600 hover:text-blue-800 mb-4",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Voltar para Demonstrativo"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"üìä Relat√≥rios Anal√≠ticos de Comiss√µes"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"An√°lise de rentabilidade, margem e tomada de decis√£o estrat√©gica"})]}),M(),R(),d?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600"})}):e.jsxs(e.Fragment,{children:[n==="margem-produto"&&J(),n==="produtos-prejudiciais"&&te(),n==="ranking-funcionarios"&&L(),n==="ranking-produtos"&&Z(),n==="ranking-categorias"&&A(),n==="dre"&&G()]})]})};function Ao(){const[s,n]=a.useState([]),[t,d]=a.useState([]),[o,g]=a.useState(!1),[r,v]=a.useState(!1),[j,f]=a.useState({id:null,categoria_id:"",nome:"",descricao:"",ativo:!0});a.useEffect(()=>{y(),c()},[]);const y=async()=>{try{const u=await F.get("/categorias-financeiras");n(u.data.filter(i=>i.ativo))}catch(u){console.error("Erro ao carregar categorias:",u),alert("Erro ao carregar categorias")}},c=async()=>{g(!0);try{const u=await F.get("/subcategorias");d(u.data)}catch(u){console.error("Erro ao carregar subcategorias:",u),alert("Erro ao carregar subcategorias")}finally{g(!1)}},m=async u=>{if(u.preventDefault(),!j.categoria_id||!j.nome){alert("Preencha categoria e nome");return}try{j.id?await F.put(`/subcategorias/${j.id}`,j):await F.post("/subcategorias",j),v(!1),f({id:null,categoria_id:"",nome:"",descricao:"",ativo:!0}),c()}catch(i){console.error("Erro ao salvar:",i),alert("Erro ao salvar subcategoria")}},k=u=>{f(u),v(!0)},w=async u=>{if(confirm("Deseja realmente excluir esta subcategoria?"))try{await F.delete(`/subcategorias/${u}`),c()}catch(i){console.error("Erro ao excluir:",i),alert("Erro ao excluir subcategoria")}},x=u=>{const i=s.find(p=>p.id===u);return i?i.nome:"-"},b=t.reduce((u,i)=>{const p=i.categoria_id;return u[p]||(u[p]={categoria:x(p),itens:[]}),u[p].itens.push(i),u},{});return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Subcategorias"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Gerencie as subcategorias de produtos"})]}),e.jsxs("button",{onClick:()=>{f({id:null,categoria_id:"",nome:"",descricao:"",ativo:!0}),v(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx("span",{children:"+"}),"Nova Subcategoria"]})]}),o?e.jsx("div",{className:"text-center py-8",children:"Carregando..."}):e.jsxs("div",{className:"space-y-6",children:[Object.entries(b).map(([u,i])=>e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-b",children:e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:i.categoria})}),e.jsx("div",{className:"divide-y",children:i.itens.map(p=>e.jsxs("div",{className:"px-4 py-3 flex justify-between items-center hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:p.nome}),p.descricao&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:p.descricao})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${p.ativo?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:p.ativo?"Ativo":"Inativo"}),e.jsx("button",{onClick:()=>k(p),className:"text-blue-600 hover:text-blue-800 px-3 py-1",children:"Editar"}),e.jsx("button",{onClick:()=>w(p.id),className:"text-red-600 hover:text-red-800 px-3 py-1",children:"Excluir"})]})]},p.id))})]},u)),Object.keys(b).length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Nenhuma subcategoria cadastrada"})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:[j.id?"Editar":"Nova"," Subcategoria"]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria *"}),e.jsxs("select",{value:j.categoria_id,onChange:u=>f({...j,categoria_id:parseInt(u.target.value)}),className:"w-full border rounded-lg px-3 py-2",required:!0,children:[e.jsx("option",{value:"",children:"Selecione..."}),s.map(u=>e.jsx("option",{value:u.id,children:u.nome},u.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",value:j.nome,onChange:u=>f({...j,nome:u.target.value}),className:"w-full border rounded-lg px-3 py-2",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri√ß√£o"}),e.jsx("textarea",{value:j.descricao,onChange:u=>f({...j,descricao:u.target.value}),className:"w-full border rounded-lg px-3 py-2",rows:"3"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:j.ativo,onChange:u=>f({...j,ativo:u.target.checked}),className:"mr-2"}),e.jsx("label",{className:"text-sm text-gray-700",children:"Ativo"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>v(!1),className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Salvar"})]})]})]})})]})}const Yd=()=>{const[s,n]=a.useState([]),[t,d]=a.useState(!0),[o,g]=a.useState(!1),[r,v]=a.useState(null),[j,f]=a.useState(new Set),[y,c]=a.useState({nome:"",descricao:"",categoria_pai_id:null,ordem:0}),m=4;a.useEffect(()=>{k()},[]);const k=async()=>{try{d(!0);const _=await F.get("/produtos/categorias");n(_.data)}catch(_){console.error("Erro ao carregar categorias:",_),alert("Erro ao carregar categorias")}finally{d(!1)}},w=_=>{const S=new Set(j);S.has(_)?S.delete(_):S.add(_),f(S)},x=async _=>{var S,$;_.preventDefault();try{r?await F.put(`/produtos/categorias/${r}`,y):await F.post("/produtos/categorias",y),g(!1),v(null),c({nome:"",descricao:"",categoria_pai_id:null,ordem:0}),k()}catch(K){console.error("Erro ao salvar categoria:",K),($=(S=K.response)==null?void 0:S.data)!=null&&$.detail?alert(K.response.data.detail):alert("Erro ao salvar categoria")}},b=_=>{v(_.id),c({nome:_.nome,descricao:_.descricao||"",categoria_pai_id:_.categoria_pai_id,ordem:_.ordem}),g(!0)},u=async _=>{var S,$;if(_.total_filhos>0){alert(`Esta categoria possui ${_.total_filhos} subcategoria(s). Remova-as primeiro.`);return}if(!(_.total_produtos>0&&!confirm(`Esta categoria possui ${_.total_produtos} produto(s). Deseja realmente excluir?`)))try{await F.delete(`/produtos/categorias/${_.id}`),k()}catch(K){console.error("Erro ao excluir categoria:",K),alert((($=(S=K.response)==null?void 0:S.data)==null?void 0:$.detail)||"Erro ao excluir categoria")}},i=_=>{if(_.nivel>=m){alert(`Limite de ${m} n√≠veis de categorias atingido.`);return}v(null),c({nome:"",descricao:"",categoria_pai_id:_.id,ordem:0}),g(!0)},p=()=>{v(null),c({nome:"",descricao:"",categoria_pai_id:null,ordem:0}),g(!0)},l=(_=null,S=1)=>s.filter($=>$.categoria_pai_id===_).sort(($,K)=>$.ordem-K.ordem||$.nome.localeCompare(K.nome)).map($=>({...$,nivel:S,filhos:l($.id,S+1)})),C=(_,S=1)=>{const $=_.filhos&&_.filhos.length>0,K=j.has(_.id),re=S<m,M=(S-1)*30;return e.jsxs(ts.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white hover:bg-gray-50 border-b",style:{paddingLeft:`${20+M}px`},children:[e.jsx("div",{className:"w-5 flex items-center justify-center",children:$?e.jsx("button",{onClick:()=>w(_.id),className:"text-gray-500 hover:text-gray-700 transition-colors",children:K?e.jsx(Ws,{size:18}):e.jsx(zs,{size:18})}):e.jsx("span",{className:"text-gray-300",children:"‚Ä¢"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-800",children:_.nome}),e.jsxs("span",{className:"text-xs text-gray-500",children:["N√≠vel ",S]}),_.total_filhos>0&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:[_.total_filhos," sub"]}),_.total_produtos>0&&e.jsxs("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded",children:[_.total_produtos," produtos"]})]}),_.descricao&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:_.descricao})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[re&&e.jsx("button",{onClick:()=>i(_),className:"p-2 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Adicionar subcategoria",children:e.jsx(Qa,{size:18})}),!re&&e.jsx("span",{className:"p-2 text-gray-300 cursor-not-allowed",title:`Limite de ${m} n√≠veis atingido`,children:e.jsx(_a,{size:18})}),e.jsx("button",{onClick:()=>b(_),className:"p-2 text-yellow-600 hover:bg-yellow-50 rounded transition-colors",title:"Editar",children:e.jsx(_s,{size:18})}),e.jsx("button",{onClick:()=>u(_),className:"p-2 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Excluir",children:e.jsx(gs,{size:18})})]})]}),$&&K&&e.jsx("div",{children:_.filhos.map(R=>C(R,S+1))})]},_.id)},h=l();return t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-600",children:"Carregando categorias..."})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Categorias"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Gerencie suas categorias hierarquicamente (at√© ",m," n√≠veis)"]})]}),e.jsxs("button",{onClick:p,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors",children:[e.jsx(Qa,{size:20}),"Nova Categoria"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:h.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(_a,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhuma categoria cadastrada"}),e.jsx("button",{onClick:p,className:"mt-4 text-blue-600 hover:text-blue-700",children:"Criar primeira categoria"})]}):e.jsx("div",{children:h.map(_=>C(_))})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:r?"Editar Categoria":y.categoria_pai_id?"Nova Subcategoria":"Nova Categoria"}),e.jsxs("form",{onSubmit:x,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",value:y.nome,onChange:_=>c({...y,nome:_.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,autoFocus:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri√ß√£o"}),e.jsx("textarea",{value:y.descricao,onChange:_=>c({...y,descricao:_.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ordem"}),e.jsx("input",{type:"number",value:y.ordem,onChange:_=>c({...y,ordem:parseInt(_.target.value)||0}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Menor valor aparece primeiro"})]}),y.categoria_pai_id&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx(_a,{className:"inline mr-1"}),"Esta ser√° uma subcategoria"]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{g(!1),v(null),c({nome:"",descricao:"",categoria_pai_id:null,ordem:0})},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded hover:bg-gray-300 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:r?"Salvar":"Criar"})]})]})]})})]})},Zd=()=>{const[s,n]=a.useState([]),[t,d]=a.useState([]),[o,g]=a.useState(!0),[r,v]=a.useState(!1),[j,f]=a.useState(!1),[y,c]=a.useState(null),[m,k]=a.useState(null),[w,x]=a.useState(new Set),[b,u]=a.useState("todos"),[i,p]=a.useState({nome:"",tipo:"despesa",cor:"#6366f1",icone:"üìã",descricao:"",ativo:!0,novasSubcategorias:[]}),[l,C]=a.useState({categoria_id:null,nome:"",descricao:"",ativo:!0}),h=["üí∞","üí∏","üìã","üè†","‚ö°","üíß","üì°","üë•","üì¶","üîß","üöó","üçΩÔ∏è","üìù","üõ°Ô∏è","üõí","‚ú®","üêï","ü©∫","üè®","üéì"],_=["#ef4444","#f97316","#f59e0b","#84cc16","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899"];a.useEffect(()=>{S()},[]);const S=async()=>{await Promise.all([$(),K()])},$=async()=>{try{g(!0);const z=await F.get("/categorias-financeiras/");console.log("üìÇ Categorias carregadas:",z.data.length),console.log("üîç Primeira categoria:",z.data[0]),n(z.data)}catch(z){console.error("Erro ao carregar categorias:",z),ce.error("Erro ao carregar categorias financeiras")}finally{g(!1)}},K=async()=>{var z,ae;try{console.log("üîÑ Iniciando carregamento de subcategorias DRE...");const W=await F.get("/dre/subcategorias");console.log("‚úÖ Resposta recebida:",W),console.log("üìã Subcategorias DRE carregadas:",W.data.length),console.log("üîç Primeira subcategoria:",W.data[0]),console.log("üì¶ Todas as subcategorias:",W.data),d(W.data)}catch(W){console.error("‚ùå ERRO ao carregar subcategorias DRE:",W),console.error("‚ùå Erro completo:",((z=W.response)==null?void 0:z.data)||W.message),console.error("‚ùå Status:",(ae=W.response)==null?void 0:ae.status),d([])}},re=z=>{const ae=new Set(w);ae.has(z)?ae.delete(z):ae.add(z),x(ae)},M=z=>{if(!z.dre_subcategoria_id)return[];const ae=t.find(ie=>ie.id===z.dre_subcategoria_id);if(!ae)return console.log(`‚ö†Ô∏è Categoria "${z.nome}" tem dre_subcategoria_id=${z.dre_subcategoria_id} mas n√£o encontrada`),[];const W=t.filter(ie=>ie.categoria_id===ae.categoria_id);return console.log(`üì¶ Categoria "${z.nome}" ‚Üí ${W.length} subcategorias DRE`),W},R=async z=>{var ae,W;if(z.preventDefault(),!i.nome||!i.tipo){ce.error("Preencha nome e tipo");return}try{let ie;if(y)await F.put(`/categorias-financeiras/${y}`,{nome:i.nome,tipo:i.tipo,cor:i.cor,icone:i.icone,descricao:i.descricao,ativo:i.ativo}),ie=y,ce.success("Categoria atualizada com sucesso!");else if(ie=(await F.post("/categorias-financeiras/",{nome:i.nome,tipo:i.tipo,cor:i.cor,icone:i.icone,descricao:i.descricao,ativo:i.ativo})).data.id,ce.success("Categoria criada com sucesso!"),i.novasSubcategorias.length>0){const Q=i.novasSubcategorias.filter(de=>de.nome.trim());for(const de of Q)try{await F.post("/subcategorias/",{categoria_id:ie,nome:de.nome,descricao:de.descricao,ativo:de.ativo})}catch(me){console.error("Erro ao criar subcategoria:",me),ce.error(`Erro ao criar subcategoria: ${de.nome}`)}Q.length>0&&ce.success(`${Q.length} subcategoria(s) criada(s)!`)}v(!1),L(),S()}catch(ie){console.error("Erro ao salvar:",ie),ce.error(((W=(ae=ie.response)==null?void 0:ae.data)==null?void 0:W.detail)||"Erro ao salvar categoria")}},J=async z=>{console.log(`üîß Editando categoria "${z.nome}" (ID: ${z.id})`);const ae=M(z);console.log(`üì¶ Subcategorias DRE encontradas: ${ae.length}`,ae);const W=ae.map(ie=>({id:ie.id,nome:ie.nome,descricao:ie.descricao||"",ativo:ie.ativo,tipo_custo:ie.tipo_custo,escopo_rateio:ie.escopo_rateio}));p({nome:z.nome,tipo:z.tipo,cor:z.cor||"#6366f1",icone:z.icone||"üìã",descricao:z.descricao||"",ativo:z.ativo,novasSubcategorias:W}),c(z.id),v(!0)},te=async z=>{var ae,W;if(window.confirm("Deseja realmente excluir esta categoria?"))try{await F.delete(`/categorias-financeiras/${z}`),ce.success("Categoria exclu√≠da com sucesso!"),S()}catch(ie){console.error("Erro ao excluir:",ie),ce.error(((W=(ae=ie.response)==null?void 0:ae.data)==null?void 0:W.detail)||"Erro ao excluir categoria")}},L=()=>{p({nome:"",tipo:"despesa",cor:"#6366f1",icone:"üìã",descricao:"",ativo:!0,novasSubcategorias:[]}),c(null)},Z=(z="")=>{p({...i,novasSubcategorias:[...i.novasSubcategorias,{nome:z,descricao:"",ativo:!0}]})},A=(z,ae,W)=>{const ie=[...i.novasSubcategorias];ie[z][ae]=W,p({...i,novasSubcategorias:ie})},G=z=>{const ae=i.novasSubcategorias.filter((W,ie)=>ie!==z);p({...i,novasSubcategorias:ae})},E=(z,ae)=>{z.key==="Tab"&&!z.shiftKey&&ae===i.novasSubcategorias.length-1&&(z.preventDefault(),Z())},P=()=>{C({categoria_id:null,nome:"",descricao:"",ativo:!0}),k(null)},H=async z=>{var ae,W;if(z.preventDefault(),!l.categoria_id||!l.nome){ce.error("Preencha categoria e nome");return}try{m?(await F.put(`/subcategorias/${m}`,l),ce.success("Subcategoria atualizada!")):(await F.post("/subcategorias",l),ce.success("Subcategoria criada!")),f(!1),P(),carregarSubcategorias()}catch(ie){console.error("Erro ao salvar:",ie),ce.error(((W=(ae=ie.response)==null?void 0:ae.data)==null?void 0:W.detail)||"Erro ao salvar subcategoria")}},B=s.filter(z=>b==="todos"?!0:z.tipo===b),N=s.filter(z=>z.tipo==="despesa").length,O=s.filter(z=>z.tipo==="receita").length;return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"üè∑Ô∏è Categorias Financeiras"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Organize suas receitas e despesas |",e.jsxs("span",{className:"text-red-600 ml-2",children:["üí∏ ",N," despesas"]}),e.jsxs("span",{className:"text-green-600 ml-2",children:["üí∞ ",O," receitas"]})]})]}),e.jsxs("button",{onClick:()=>{L(),v(!0)},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:[e.jsx(Qa,{})," Nova Categoria"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:()=>u("todos"),className:`px-4 py-2 rounded-lg ${b==="todos"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"}`,children:["üìä Todas (",s.length,")"]}),e.jsxs("button",{onClick:()=>u("despesa"),className:`px-4 py-2 rounded-lg ${b==="despesa"?"bg-red-600 text-white":"bg-gray-200 text-gray-700"}`,children:["üí∏ Despesas (",N,")"]}),e.jsxs("button",{onClick:()=>u("receita"),className:`px-4 py-2 rounded-lg ${b==="receita"?"bg-green-600 text-white":"bg-gray-200 text-gray-700"}`,children:["üí∞ Receitas (",O,")"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:o?e.jsx("div",{className:"px-6 py-8 text-center text-gray-500",children:"Carregando..."}):B.length===0?e.jsx("div",{className:"px-6 py-8 text-center text-gray-500",children:"Nenhuma categoria encontrada"}):e.jsx("div",{className:"divide-y divide-gray-200",children:B.map(z=>{const ae=M(z),W=w.has(z.id),ie=ae.length>0;return e.jsxs("div",{children:[e.jsxs("div",{className:"px-6 py-4 hover:bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("button",{onClick:()=>re(z.id),className:`flex items-center justify-center w-10 h-10 rounded-lg transition-all duration-200 transform hover:scale-105 ${ie?W?"text-white bg-gradient-to-r from-purple-600 to-purple-700 shadow-lg hover:shadow-xl":"text-purple-600 bg-purple-100 hover:bg-purple-200 hover:text-purple-700 shadow-md hover:shadow-lg":"text-gray-300 cursor-not-allowed bg-gray-50"}`,disabled:!ie,title:ie?W?"Recolher subcategorias":"Expandir subcategorias":"Sem subcategorias DRE",children:ie?W?e.jsx(Ws,{size:22,strokeWidth:2.5}):e.jsx(zs,{size:22,strokeWidth:2.5}):e.jsx(zs,{size:22})}),e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("span",{style:{backgroundColor:z.cor},className:"w-10 h-10 rounded-full flex items-center justify-center text-white text-lg",children:z.icone||"üìã"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800",children:z.nome}),z.descricao&&e.jsx("div",{className:"text-sm text-gray-500",children:z.descricao})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${z.tipo==="receita"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:z.tipo==="receita"?"üí∞ Receita":"üí∏ Despesa"}),ie&&e.jsxs("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-medium flex items-center gap-1",children:[e.jsx("span",{children:"üìä DRE"}),e.jsx("span",{className:"bg-purple-200 text-purple-900 px-1.5 rounded-full font-bold",children:ae.length})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>J(z),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-md",title:"Editar",children:e.jsx(_s,{size:18})}),e.jsx("button",{onClick:()=>te(z.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-md",title:"Excluir",children:e.jsx(gs,{size:18})})]})]}),W&&e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 border-t border-purple-100",children:ie?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-6 py-2 bg-purple-100/50 border-b border-purple-200",children:e.jsxs("span",{className:"text-xs font-semibold text-purple-700 uppercase tracking-wide",children:["üèóÔ∏è Subcategorias DRE (",ae.length,")"]})}),ae.map(ee=>e.jsxs("div",{className:"px-6 py-3 flex items-center gap-4 ml-9",children:[e.jsx("span",{className:"text-purple-400 text-lg",children:"‚îî‚îÄ"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:ee.nome}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500 bg-white px-2 py-0.5 rounded",children:ee.tipo_custo}),ee.escopo_rateio&&e.jsx("span",{className:"text-xs text-gray-500 bg-white px-2 py-0.5 rounded",children:ee.escopo_rateio})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${ee.ativo?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"}`,children:ee.ativo?"‚úì Ativo":"‚úó Inativo"})]},ee.id))]}):e.jsx("div",{className:"px-6 py-4 ml-9 text-center",children:e.jsxs("div",{className:"text-gray-400 text-sm",children:[e.jsx("div",{className:"mb-2",children:"üì≠"}),e.jsx("div",{className:"font-medium",children:"Nenhuma subcategoria DRE cadastrada"}),e.jsx("div",{className:"text-xs mt-1",children:"Configure subcategorias no m√≥dulo DRE"})]})})})]},z.id)})})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full m-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("h3",{className:"text-xl font-bold",children:y?"Editar Categoria":"Nova Categoria"}),e.jsx("button",{onClick:()=>{v(!1),L()},className:"text-gray-500 hover:text-gray-700",children:"‚úï"})]}),e.jsxs("form",{onSubmit:R,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",value:i.nome,onChange:z=>p({...i,nome:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo *"}),e.jsxs("select",{value:i.tipo,onChange:z=>p({...i,tipo:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"despesa",children:"üí∏ Despesa"}),e.jsx("option",{value:"receita",children:"üí∞ Receita"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"√çcone"}),e.jsx("select",{value:i.icone,onChange:z=>p({...i,icone:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:h.map(z=>e.jsx("option",{value:z,children:z},z))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:i.cor,onChange:z=>p({...i,cor:z.target.value}),className:"w-12 h-10 border border-gray-300 rounded-md"}),e.jsx("select",{value:i.cor,onChange:z=>p({...i,cor:z.target.value}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:_.map(z=>e.jsx("option",{value:z,children:z},z))})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri√ß√£o"}),e.jsx("textarea",{value:i.descricao,onChange:z=>p({...i,descricao:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",rows:"3"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"ativo",checked:i.ativo,onChange:z=>p({...i,ativo:z.target.checked}),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("label",{htmlFor:"ativo",className:"text-sm text-gray-700",children:"Categoria ativa"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subcategorias DRE (opcional)"}),e.jsxs("button",{type:"button",onClick:()=>Z(),className:"text-sm text-purple-600 hover:text-purple-800 flex items-center gap-1",children:[e.jsx(Qa,{size:14})," Adicionar"]})]}),i.novasSubcategorias.length>0&&e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:i.novasSubcategorias.map((z,ae)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-md",children:[e.jsx("input",{type:"text",value:z.nome,onChange:W=>A(ae,"nome",W.target.value),onKeyDown:W=>E(W,ae),placeholder:"Nome da subcategoria (Tab para adicionar mais)",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>G(ae),className:"text-red-600 hover:text-red-800 p-1",title:"Remover",children:e.jsx(gs,{size:16})})]},ae))}),i.novasSubcategorias.length===0&&e.jsx("p",{className:"text-sm text-gray-500 italic",children:'Clique em "Adicionar" ou crie a categoria primeiro e depois adicione subcategorias'})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{v(!1),L()},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:y?"Atualizar":"Criar"})]})]})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:m?"Editar Subcategoria DRE":"Nova Subcategoria DRE"}),l.categoria_id&&s.find(z=>z.id===l.categoria_id)&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-md border border-blue-200",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Categoria: "}),e.jsx("span",{className:"font-semibold text-gray-800",children:s.find(z=>z.id===l.categoria_id).nome})]}),e.jsxs("form",{onSubmit:H,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Subcategoria *"}),e.jsx("input",{type:"text",value:l.nome,onChange:z=>C({...l,nome:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri√ß√£o"}),e.jsx("textarea",{value:l.descricao,onChange:z=>C({...l,descricao:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",rows:"3"})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.ativo,onChange:z=>C({...l,ativo:z.target.checked}),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Ativo"})]})}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{f(!1),P()},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:m?"Atualizar":"Criar"})]})]})]})})]})},ec=()=>{const[s,n]=a.useState([]),[t,d]=a.useState(!0),[o,g]=a.useState(new Set),[r,v]=a.useState(!1),[j,f]=a.useState(!1),[y,c]=a.useState(null),[m,k]=a.useState(null),[w,x]=a.useState(null),[b,u]=a.useState(""),[i,p]=a.useState(""),[l,C]=a.useState({nome:"",ativo:!0}),[h,_]=a.useState({nome:"",especie_id:"",ativo:!0});a.useEffect(()=>{S()},[]);const S=async()=>{try{d(!0);const[G,E]=await Promise.all([F.get("/cadastros/especies"),F.get("/cadastros/racas")]),P=G.data.map(B=>({...B,racas:E.data.filter(N=>N.especie_id===B.id)}));n(P);const H=new Set(P.map(B=>B.id));g(H)}catch(G){console.error("Erro ao carregar dados:",G),u("Erro ao carregar dados")}finally{d(!1)}},$=G=>{const E=new Set(o);E.has(G)?E.delete(G):E.add(G),g(E)},K=(G=null)=>{G?(c(G),C({nome:G.nome,ativo:G.ativo})):(c(null),C({nome:"",ativo:!0})),u(""),v(!0)},re=()=>{v(!1),c(null),C({nome:"",ativo:!0}),u("")},M=async G=>{var E,P;if(G.preventDefault(),u(""),!l.nome||l.nome.trim()===""){u("O nome da esp√©cie √© obrigat√≥rio");return}try{y?await F.put(`/cadastros/especies/${y.id}`,l):await F.post("/cadastros/especies",l),S(),re()}catch(H){console.error("Erro ao salvar esp√©cie:",H),u(((P=(E=H.response)==null?void 0:E.data)==null?void 0:P.detail)||"Erro ao salvar esp√©cie")}},R=async G=>{var E,P;if(window.confirm(`Deseja realmente desativar a esp√©cie "${G.nome}"?

Isso tamb√©m desativar√° todas as ra√ßas vinculadas.`))try{await F.delete(`/cadastros/especies/${G.id}`),S()}catch(H){console.error("Erro ao desativar esp√©cie:",H),alert(((P=(E=H.response)==null?void 0:E.data)==null?void 0:P.detail)||"Erro ao desativar esp√©cie")}},J=(G,E=null)=>{x(G),E?(k(E),_({nome:E.nome,especie_id:E.especie_id,ativo:E.ativo})):(k(null),_({nome:"",especie_id:G.id,ativo:!0})),u(""),f(!0)},te=()=>{f(!1),k(null),x(null),_({nome:"",especie_id:"",ativo:!0}),u("")},L=async G=>{var E,P;if(G.preventDefault(),u(""),!h.nome||h.nome.trim()===""){u("O nome da ra√ßa √© obrigat√≥rio");return}try{const H={nome:h.nome,especie_id:parseInt(h.especie_id),ativo:h.ativo};m?await F.put(`/cadastros/racas/${m.id}`,H):await F.post("/cadastros/racas",H),S(),te()}catch(H){console.error("Erro ao salvar ra√ßa:",H),u(((P=(E=H.response)==null?void 0:E.data)==null?void 0:P.detail)||"Erro ao salvar ra√ßa")}},Z=async G=>{var E,P;if(window.confirm(`Deseja realmente desativar a ra√ßa "${G.nome}"?`))try{await F.delete(`/cadastros/racas/${G.id}`),S()}catch(H){console.error("Erro ao desativar ra√ßa:",H),alert(((P=(E=H.response)==null?void 0:E.data)==null?void 0:P.detail)||"Erro ao desativar ra√ßa")}},A=s.filter(G=>G.nome.toLowerCase().includes(i.toLowerCase())||G.racas.some(E=>E.nome.toLowerCase().includes(i.toLowerCase())));return t?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Carregando esp√©cies e ra√ßas..."})]}):e.jsxs("div",{className:"cadastros-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Esp√©cies e Ra√ßas"}),e.jsx("p",{className:"page-subtitle",children:"Gerencie as esp√©cies de animais e suas ra√ßas"})]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>K(),children:[e.jsx(Qa,{})," Nova Esp√©cie"]})]}),e.jsxs("div",{className:"filters-bar",children:[e.jsx("input",{type:"text",placeholder:"Buscar esp√©cie ou ra√ßa...",value:i,onChange:G=>p(G.target.value),className:"search-input"}),e.jsxs("div",{className:"filter-info",children:[A.length," esp√©cie",A.length!==1?"s":""]})]}),e.jsx("div",{className:"especies-list",children:A.length===0?e.jsx("div",{className:"empty-state",children:i?"Nenhuma esp√©cie ou ra√ßa encontrada":"Nenhuma esp√©cie cadastrada"}):A.map(G=>{const E=o.has(G.id),P=G.racas.filter(H=>H.ativo);return e.jsxs("div",{className:`especie-card ${G.ativo?"":"inactive"}`,children:[e.jsxs("div",{className:"especie-header",children:[e.jsxs("div",{className:"especie-info",onClick:()=>$(G.id),children:[e.jsx("button",{className:"expand-btn",children:E?e.jsx(Ws,{size:20}):e.jsx(zs,{size:20})}),e.jsx(Fa,{className:"especie-icon",size:24}),e.jsxs("div",{children:[e.jsx("h3",{className:"especie-nome",children:G.nome}),e.jsxs("span",{className:"racas-count",children:[P.length," ra√ßa",P.length!==1?"s":""," ativa",P.length!==1?"s":""]})]}),!G.ativo&&e.jsx("span",{className:"badge badge-danger",children:"Inativa"})]}),e.jsxs("div",{className:"especie-actions",children:[e.jsx("button",{className:"btn-icon btn-success",onClick:()=>J(G),title:"Adicionar Ra√ßa",children:e.jsx(Qa,{})}),e.jsx("button",{className:"btn-icon btn-edit",onClick:()=>K(G),title:"Editar Esp√©cie",children:e.jsx(_s,{})}),G.ativo&&e.jsx("button",{className:"btn-icon btn-delete",onClick:()=>R(G),title:"Desativar Esp√©cie",children:e.jsx(gs,{})})]})]}),E&&e.jsx("div",{className:"racas-list",children:G.racas.length===0?e.jsxs("div",{className:"empty-racas",children:[e.jsx("p",{children:"Nenhuma ra√ßa cadastrada ainda"}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>J(G),children:[e.jsx(Qa,{})," Adicionar Primeira Ra√ßa"]})]}):e.jsx(e.Fragment,{children:G.racas.map(H=>e.jsxs("div",{className:`raca-item ${H.ativo?"":"inactive"}`,children:[e.jsxs("div",{className:"raca-info",children:[e.jsx(_t,{className:"raca-icon",size:16}),e.jsx("span",{className:"raca-nome",children:H.nome}),!H.ativo&&e.jsx("span",{className:"badge badge-sm badge-danger",children:"Inativa"})]}),e.jsxs("div",{className:"raca-actions",children:[e.jsx("button",{className:"btn-icon-sm btn-edit",onClick:()=>J(G,H),title:"Editar Ra√ßa",children:e.jsx(_s,{size:14})}),H.ativo&&e.jsx("button",{className:"btn-icon-sm btn-delete",onClick:()=>Z(H),title:"Desativar Ra√ßa",children:e.jsx(gs,{size:14})})]})]},H.id))})})]},G.id)})}),r&&e.jsx("div",{className:"modal-overlay",onClick:re,children:e.jsxs("div",{className:"modal-content",onClick:G=>G.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:y?"Editar Esp√©cie":"Nova Esp√©cie"}),e.jsx("button",{className:"btn-close",onClick:re,children:e.jsx(ps,{})})]}),e.jsxs("form",{onSubmit:M,children:[e.jsxs("div",{className:"modal-body",children:[b&&e.jsxs("div",{className:"alert alert-danger",children:[e.jsx(_a,{})," ",b]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nome da Esp√©cie *"}),e.jsx("input",{type:"text",value:l.nome,onChange:G=>C({...l,nome:G.target.value}),placeholder:"Ex: C√£o, Gato, Ave, R√©ptil...",required:!0,autoFocus:!0}),e.jsx("small",{children:"Exemplos: C√£o, Gato, Ave, R√©ptil, Coelho, Peixe, Hamster"})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:l.ativo,onChange:G=>C({...l,ativo:G.target.checked})}),e.jsx("span",{children:"Esp√©cie ativa"})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:re,children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"btn btn-primary",children:[e.jsx(Vs,{})," Salvar"]})]})]})]})}),j&&e.jsx("div",{className:"modal-overlay",onClick:te,children:e.jsxs("div",{className:"modal-content",onClick:G=>G.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[m?"Editar Ra√ßa":"Nova Ra√ßa",w&&e.jsxs("span",{className:"subtitle",children:[" - ",w.nome]})]}),e.jsx("button",{className:"btn-close",onClick:te,children:e.jsx(ps,{})})]}),e.jsxs("form",{onSubmit:L,children:[e.jsxs("div",{className:"modal-body",children:[b&&e.jsxs("div",{className:"alert alert-danger",children:[e.jsx(_a,{})," ",b]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nome da Ra√ßa *"}),e.jsx("input",{type:"text",value:h.nome,onChange:G=>_({...h,nome:G.target.value}),placeholder:"Ex: Labrador, Siam√™s, SRD...",required:!0,autoFocus:!0}),e.jsx("small",{children:"Exemplos: Labrador, Golden Retriever, SRD (Sem Ra√ßa Definida)"})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:h.ativo,onChange:G=>_({...h,ativo:G.target.checked})}),e.jsx("span",{children:"Ra√ßa ativa"})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:te,children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"btn btn-primary",children:[e.jsx(Vs,{})," Salvar"]})]})]})]})})]})},ac=()=>{var L,Z,A,G;const{clienteId:s}=Bs(),n=fa(),[t,d]=a.useState(null),[o,g]=a.useState(null),[r,v]=a.useState([]),[j,f]=a.useState(null),[y,c]=a.useState(!0),[m,k]=a.useState(""),[w,x]=a.useState({}),[b,u]=a.useState({}),[i,p]=a.useState({}),[l,C]=a.useState({page:1,per_page:20,data_inicio:"",data_fim:"",tipo:"",status:""});a.useEffect(()=>{s&&h()},[s,l]);const h=async()=>{var E,P;try{c(!0),k("");const H=new URLSearchParams;H.append("page",l.page),H.append("per_page",l.per_page),l.data_inicio&&H.append("data_inicio",l.data_inicio),l.data_fim&&H.append("data_fim",l.data_fim),l.tipo&&H.append("tipo",l.tipo),l.status&&H.append("status",l.status);const B=await F.get(`/financeiro/cliente/${s}?${H.toString()}`);d(B.data.cliente),g(B.data.resumo),v(B.data.historico),f(B.data.paginacao)}catch(H){console.error("Erro ao carregar hist√≥rico financeiro:",H),k(((P=(E=H.response)==null?void 0:E.data)==null?void 0:P.detail)||"Erro ao carregar hist√≥rico financeiro")}finally{c(!1)}},_=E=>{C({...l,page:E})},S=E=>{C({...l,...E,page:1})},$=()=>{C({page:1,per_page:20,data_inicio:"",data_fim:"",tipo:"",status:""})},K=async(E,P)=>{var B,N;const H=`${E.tipo}-${P}`;if(w[H]){x({...w,[H]:!1});return}x({...w,[H]:!0}),E.tipo==="venda"&&!b[(B=E.detalhes)==null?void 0:B.venda_id]&&await re((N=E.detalhes)==null?void 0:N.venda_id)},re=async E=>{if(E)try{p({...i,[E]:!0});const P=await F.get(`/vendas/${E}`);u({...b,[E]:P.data})}catch(P){console.error("Erro ao carregar detalhes da venda:",P)}finally{p({...i,[E]:!1})}},M=E=>{E&&n(`/pdv?venda=${E}`)},R=E=>{switch(E){case"venda":return"üõí";case"devolucao":return"‚Ü©Ô∏è";case"conta_receber":return"üìÑ";case"recebimento":return"üí∞";case"credito":return"üí≥";default:return"üìä"}},J=E=>{switch(E){case"venda":return"Venda";case"devolucao":return"Devolu√ß√£o";case"conta_receber":return"Conta a Receber";case"recebimento":return"Recebimento";case"credito":return"Cr√©dito";default:return E}},te=E=>({finalizada:"bg-green-100 text-green-700",concluida:"bg-green-100 text-green-700",pendente:"bg-yellow-100 text-yellow-700",paga:"bg-blue-100 text-blue-700",cancelada:"bg-red-100 text-red-700",devolvida:"bg-red-100 text-red-700",efetivado:"bg-green-100 text-green-700"})[E]||"bg-gray-100 text-gray-700";return y&&!r.length?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando hist√≥rico financeiro..."})]})}):m?e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-red-50 border border-red-300 rounded-xl p-6 text-center",children:[e.jsx(_a,{className:"text-red-600 text-4xl mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Erro ao Carregar Dados"}),e.jsx("p",{className:"text-red-600 mb-4",children:m}),e.jsx("button",{onClick:()=>n("/clientes"),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Voltar para Clientes"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>n("/clientes"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4 transition-colors",children:[e.jsx(nt,{}),e.jsx("span",{className:"font-medium",children:"Voltar para Clientes"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(er,{className:"text-purple-600"}),"Hist√≥rico Financeiro"]}),t&&e.jsxs("p",{className:"text-lg text-gray-600 mt-2 flex items-center gap-2",children:[e.jsx(ds,{className:"text-gray-400"}),t.nome,e.jsxs("span",{className:"text-sm text-gray-400",children:["(",t.codigo,")"]})]})]}),o&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 border border-purple-200 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Cr√©dito Dispon√≠vel"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["R$ ",((L=t.credito_atual)==null?void 0:L.toFixed(2).replace(".",","))||"0,00"]})]})]})]}),o&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Total Vendas (90d)"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["R$ ",((Z=o.total_vendas_90d)==null?void 0:Z.toFixed(2).replace(".",","))||"0,00"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Total em Aberto"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:["R$ ",((A=o.total_em_aberto)==null?void 0:A.toFixed(2).replace(".",","))||"0,00"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"√öltima Compra"}),o.ultima_compra?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["R$ ",((G=o.ultima_compra.valor)==null?void 0:G.toFixed(2).replace(".",","))||"0,00"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(o.ultima_compra.data).toLocaleDateString("pt-BR")})]}):e.jsx("p",{className:"text-sm text-gray-400",children:"Nenhuma compra"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Total Transa√ß√µes"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:o.total_transacoes_historico||0})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 mb-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Ar,{}),"Filtros"]}),e.jsx("button",{onClick:$,className:"text-sm text-gray-600 hover:text-gray-900 underline",children:"Limpar filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:[e.jsx(ns,{className:"inline mr-1"}),"Data In√≠cio"]}),e.jsx("input",{type:"date",value:l.data_inicio,onChange:E=>S({data_inicio:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:[e.jsx(ns,{className:"inline mr-1"}),"Data Fim"]}),e.jsx("input",{type:"date",value:l.data_fim,onChange:E=>S({data_fim:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:l.tipo,onChange:E=>S({tipo:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todas as transa√ß√µes"}),e.jsx("option",{value:"venda",children:"üõí Vendas"}),e.jsx("option",{value:"devolucao",children:"‚Ü©Ô∏è Devolu√ß√µes"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:l.status,onChange:E=>S({status:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todos os status"}),e.jsx("option",{value:"aberta",children:"üìã Em Aberto"}),e.jsx("option",{value:"finalizada",children:"‚úÖ Finalizada (Paga)"}),e.jsx("option",{value:"cancelada",children:"‚ùå Cancelada"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Por p√°gina"}),e.jsxs("select",{value:l.per_page,onChange:E=>S({per_page:parseInt(E.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]})]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:y?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Atualizando..."})]}):r.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descri√ß√£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map((E,P)=>{var z,ae,W,ie,ee;const H=`${E.tipo}-${P}`,B=w[H],N=(z=E.detalhes)==null?void 0:z.venda_id,O=N?b[N]:null;return e.jsxs(ts.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("button",{onClick:()=>K(E,P),className:"text-gray-600 hover:text-purple-600 transition-colors",children:B?e.jsx(Go,{size:18}):e.jsx(Ws,{size:18})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:E.data?new Date(E.data).toLocaleDateString("pt-BR"):"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"inline-flex items-center gap-1 text-sm font-medium",children:[e.jsx("span",{className:"text-xl",children:R(E.tipo)}),J(E.tipo)]})}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-md",children:[e.jsx("div",{className:"truncate",children:E.descricao}),((ae=E.detalhes)==null?void 0:ae.numero_venda)&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["#",E.detalhes.numero_venda]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:e.jsxs("span",{className:`font-bold ${E.valor<0?"text-red-600":"text-green-600"}`,children:[E.valor<0?"- ":"+ ","R$ ",Math.abs(E.valor).toFixed(2).replace(".",",")]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${te(E.status)}`,children:E.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:E.tipo==="venda"&&N&&e.jsxs("button",{onClick:()=>M(N),className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded-lg transition-colors flex items-center gap-1 mx-auto",children:[e.jsx(qs,{size:14}),"Ver no PDV"]})})]}),B&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-4 bg-gray-50",children:E.tipo==="venda"&&N?i[N]?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Carregando detalhes..."})]}):O?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 pb-3",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(qs,{className:"text-blue-600"}),"Detalhes da Venda #",O.numero_venda]}),e.jsx("div",{className:"text-sm text-gray-600",children:new Date(O.data_venda).toLocaleString("pt-BR")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 bg-white rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"üí∞ Total da Venda"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["R$ ",(W=O.total)==null?void 0:W.toFixed(2).replace(".",",")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"üì¶ Total de Itens"}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:((ie=O.itens)==null?void 0:ie.length)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"üéØ Desconto Total"}),e.jsxs("p",{className:"text-xl font-bold text-orange-600",children:["R$ ",(O.desconto||0).toFixed(2).replace(".",",")]})]})]}),O.itens&&O.itens.length>0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-blue-50 px-4 py-2 border-b border-gray-200",children:e.jsxs("h5",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx($t,{className:"text-blue-600"}),"Produtos Vendidos"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:"Produto"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-500",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Pre√ßo Unit."}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Desc. %"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Desc. R$"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Subtotal"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:O.itens.map((Q,de)=>{var me,Pe;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:Q.produto_nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-center font-semibold text-gray-700",children:Q.quantidade}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-gray-700",children:["R$ ",(me=Q.preco_unitario)==null?void 0:me.toFixed(2).replace(".",",")]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-orange-600",children:[Q.desconto_percentual||0,"%"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-orange-600",children:["R$ ",(Q.desconto||0).toFixed(2).replace(".",",")]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right font-bold text-green-600",children:["R$ ",(Pe=Q.subtotal)==null?void 0:Pe.toFixed(2).replace(".",",")]})]},de)})}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Total Geral:"}),e.jsxs("td",{className:"px-4 py-3 text-right text-lg font-bold text-green-600",children:["R$ ",(ee=O.total)==null?void 0:ee.toFixed(2).replace(".",",")]})]})})]})})]}),O.observacoes&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-yellow-800 mb-1",children:"üìù Observa√ß√µes:"}),e.jsx("p",{className:"text-sm text-gray-700",children:O.observacoes})]})]}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"N√£o foi poss√≠vel carregar os detalhes da venda"})}):e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("h5",{className:"font-semibold text-gray-800 mb-3",children:"Detalhes da Transa√ß√£o"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 text-sm",children:Object.entries(E.detalhes||{}).map(([Q,de])=>e.jsxs("div",{className:"flex justify-between border-b border-gray-100 pb-2",children:[e.jsxs("span",{className:"text-gray-600 capitalize",children:[Q.replace(/_/g," "),":"]}),e.jsx("span",{className:"font-semibold text-gray-900",children:typeof de=="number"?`R$ ${de.toFixed(2).replace(".",",")}`:(de==null?void 0:de.toString())||"N/A"})]},Q))})]})})})]},H)})})]})}),j&&j.total_paginas>1&&e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",(j.pagina_atual-1)*j.itens_por_pagina+1," a"," ",Math.min(j.pagina_atual*j.itens_por_pagina,j.total_itens)," de"," ",j.total_itens," transa√ß√µes"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>_(j.pagina_atual-1),disabled:!j.tem_anterior,className:`px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${j.tem_anterior?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(sn,{}),"Anterior"]}),e.jsxs("span",{className:"px-4 py-2 text-sm text-gray-700",children:["P√°gina ",j.pagina_atual," de ",j.total_paginas]}),e.jsxs("button",{onClick:()=>_(j.pagina_atual+1),disabled:!j.tem_proxima,className:`px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${j.tem_proxima?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:["Pr√≥xima",e.jsx(zs,{})]})]})]})})]}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx(Ga,{className:"text-gray-300 text-6xl mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Nenhuma transa√ß√£o encontrada"}),e.jsx("p",{className:"text-gray-500 mb-6",children:l.tipo||l.status||l.data_inicio||l.data_fim?"Tente ajustar os filtros para ver mais resultados":"Ainda n√£o h√° transa√ß√µes financeiras para este cliente"}),(l.tipo||l.status||l.data_inicio||l.data_fim)&&e.jsx("button",{onClick:$,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Limpar Filtros"})]})})]})})},sc={vips_inativos:{titulo:"VIPs em Risco",descricao:"Clientes VIP sem compra h√° mais de 20 dias",icone:Vo,cor:"red",bgGradient:"from-red-500 to-red-600",bgLight:"bg-red-50",borderLight:"border-red-200",textColor:"text-red-700"},clientes_inativos:{titulo:"Clientes Inativos",descricao:"Sem compra h√° mais de 90 dias",icone:Is,cor:"orange",bgGradient:"from-orange-500 to-orange-600",bgLight:"bg-orange-50",borderLight:"border-orange-200",textColor:"text-orange-700"},clientes_endividados:{titulo:"Alto Endividamento",descricao:"Clientes com saldo devedor significativo",icone:Ga,cor:"yellow",bgGradient:"from-yellow-500 to-yellow-600",bgLight:"bg-yellow-50",borderLight:"border-yellow-200",textColor:"text-yellow-700"},oportunidades_novos:{titulo:"Novos Promissores",descricao:"Clientes novos com ticket alto",icone:Us,cor:"green",bgGradient:"from-green-500 to-green-600",bgLight:"bg-green-50",borderLight:"border-green-200",textColor:"text-green-700"},pets_sem_eventos:{titulo:"Pets Inativos",descricao:"Sem consulta h√° mais de 60 dias",icone:Rr,cor:"purple",bgGradient:"from-purple-500 to-purple-600",bgLight:"bg-purple-50",borderLight:"border-purple-200",textColor:"text-purple-700"},whatsapp_inativo:{titulo:"WhatsApp Faltando",descricao:"Clientes sem n√∫mero cadastrado",icone:Ns,cor:"blue",bgGradient:"from-blue-500 to-blue-600",bgLight:"bg-blue-50",borderLight:"border-blue-200",textColor:"text-blue-700"}};function Ys({tipo:s,dados:n,onClick:t}){const d=sc[s],o=(d==null?void 0:d.icone)||Ts,g=n||{quantidade:0,impacto:null};return e.jsxs("div",{className:`${d.bgLight} border-2 ${d.borderLight} rounded-xl p-6 hover:shadow-lg transition-all cursor-pointer`,onClick:t,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`p-3 bg-gradient-to-br ${d.bgGradient} rounded-lg`,children:e.jsx(o,{className:"text-white",size:24})}),e.jsx(Zt,{className:d.textColor,size:20})]}),e.jsx("h3",{className:`text-2xl font-bold ${d.textColor} mb-1`,children:(g==null?void 0:g.quantidade)??0}),e.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:d.titulo}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:d.descricao}),(g==null?void 0:g.impacto)&&e.jsx("div",{className:"pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Impacto estimado:"}),e.jsx("span",{className:`font-bold ${d.textColor}`,children:g.impacto})]})}),e.jsxs("button",{className:`mt-3 w-full py-2 text-sm font-medium ${d.textColor} hover:bg-white rounded-lg transition-colors flex items-center justify-center gap-2`,children:["Ver detalhes",e.jsx(Zt,{size:14})]})]})}function tc(){var c,m,k,w,x;const s=fa(),[n,t]=a.useState(!0),[d,o]=a.useState(null),[g,r]=a.useState(null);a.useEffect(()=>{v()},[]);const v=async()=>{var b;try{t(!0);const[u,i]=await Promise.all([F.get("/clientes/"),F.get("/segmentacao/estatisticas")]),p=u==null?void 0:u.data,l=Array.isArray(p)?p:Array.isArray(p==null?void 0:p.data)?p.data:[],h=(i==null?void 0:i.data)||{};console.log("üìä [Dashboard] Clientes carregados:",l.length);const _=j(l,h);o(_),r(new Date)}catch(u){console.error("Erro ao carregar dashboard:",u),o({vips_inativos:{quantidade:0,clientes:[],impacto:"R$ 0"},clientes_inativos:{quantidade:0,clientes:[],diasMedia:0},clientes_novos:{quantidade:0,clientes:[]},oportunidades_upsell:{quantidade:0,clientes:[],potencial:"R$ 0"},clientes_risco_churn:{quantidade:0,clientes:[],diasMedia:0}}),((b=u.response)==null?void 0:b.status)===403?alert("Voc√™ n√£o tem permiss√£o para acessar o dashboard gerencial"):alert("Erro ao carregar dashboard gerencial")}finally{t(!1)}},j=(b,u)=>{const i=new Date,l=(Array.isArray(b)?b:[]).filter(Z=>(Z==null?void 0:Z.tipo_cadastro)==="cliente"),C=l.filter(Z=>{const A=(Z==null?void 0:Z.segmento)||"Regular",G=(Z==null?void 0:Z.dias_desde_ultima_compra)??999;return A==="VIP"&&G>20}),h=C.reduce((Z,A)=>Z+((A==null?void 0:A.total_90d)??0),0),_=l.filter(Z=>((Z==null?void 0:Z.dias_desde_ultima_compra)??0)>90),S=_.reduce((Z,A)=>Z+((A==null?void 0:A.total_historico)??0),0),$=l.filter(Z=>((Z==null?void 0:Z.saldo_devedor)??0)>0),K=$.reduce((Z,A)=>Z+((A==null?void 0:A.saldo_devedor)??0),0),re=l.filter(Z=>{const A=(Z==null?void 0:Z.segmento)||"Regular",G=(Z==null?void 0:Z.ticket_medio)??0;return A==="Novo"&&G>200}),M=re.reduce((Z,A)=>Z+((A==null?void 0:A.ticket_medio)??0),0),R=l.filter(Z=>Array.isArray(Z==null?void 0:Z.pets)&&Z.pets.length>0);let J=0,te=[];R.forEach(Z=>{const A=Array.isArray(Z==null?void 0:Z.pets)?Z.pets:[];if(A.length>0){const G=A.filter(E=>{if(!(E!=null&&E.ultima_consulta))return!0;const P=new Date(E.ultima_consulta);return Math.floor((i-P)/(1e3*60*60*24))>60});G.length>0&&(J+=G.length,te.push(Z))}});const L=l.filter(Z=>!(Z!=null&&Z.celular)||Z.celular.trim()==="");return{vips_inativos:{quantidade:(C==null?void 0:C.length)??0,impacto:`R$ ${(h??0).toFixed(2)}`,clientes:C},clientes_inativos:{quantidade:(_==null?void 0:_.length)??0,impacto:`R$ ${((S??0)/12).toFixed(2)}/m√™s`,clientes:_},clientes_endividados:{quantidade:($==null?void 0:$.length)??0,impacto:`R$ ${(K??0).toFixed(2)}`,clientes:$},oportunidades_novos:{quantidade:(re==null?void 0:re.length)??0,impacto:`~R$ ${(M??0).toFixed(0)}/m√™s`,clientes:re},pets_sem_eventos:{quantidade:J??0,impacto:`${(te==null?void 0:te.length)??0} donos`,clientes:te},whatsapp_inativo:{quantidade:(L==null?void 0:L.length)??0,impacto:"Canal perdido",clientes:L},total_clientes:(l==null?void 0:l.length)??0,estatisticas:u??{}}},f=b=>{s("/pessoas",{state:{filtro:b}})},y=()=>{v()};return n?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Carregando dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-6",children:[e.jsx("div",{className:"max-w-7xl mx-auto mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:"üìä Dashboard Gerencial"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["Vis√£o executiva do neg√≥cio ‚Ä¢ ",(d==null?void 0:d.total_clientes)||0," clientes ativos"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[g&&e.jsxs("div",{className:"text-sm text-gray-500",children:["Atualizado √†s ",g.toLocaleTimeString("pt-BR")]}),e.jsxs("button",{onClick:y,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(Nt,{size:18}),"Atualizar"]})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(Ys,{tipo:"vips_inativos",dados:(d==null?void 0:d.vips_inativos)||{quantidade:0,impacto:"R$ 0",clientes:[]},onClick:()=>f("vips_inativos")}),e.jsx(Ys,{tipo:"clientes_inativos",dados:(d==null?void 0:d.clientes_inativos)||{quantidade:0,impacto:"R$ 0",clientes:[]},onClick:()=>f("clientes_inativos")}),e.jsx(Ys,{tipo:"clientes_endividados",dados:(d==null?void 0:d.clientes_endividados)||{quantidade:0,impacto:"R$ 0",clientes:[]},onClick:()=>f("clientes_endividados")}),e.jsx(Ys,{tipo:"oportunidades_novos",dados:(d==null?void 0:d.oportunidades_novos)||{quantidade:0,impacto:"R$ 0",clientes:[]},onClick:()=>f("oportunidades_novos")}),e.jsx(Ys,{tipo:"pets_sem_eventos",dados:(d==null?void 0:d.pets_sem_eventos)||{quantidade:0,impacto:"0 donos",clientes:[]},onClick:()=>f("pets_sem_eventos")}),e.jsx(Ys,{tipo:"whatsapp_inativo",dados:(d==null?void 0:d.whatsapp_inativo)||{quantidade:0,impacto:"Canal perdido",clientes:[]},onClick:()=>f("whatsapp_inativo")})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ts,{className:"text-blue-600",size:24}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Resumo Executivo"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"border-l-4 border-red-500 pl-4",children:[e.jsx("h3",{className:"font-semibold text-red-700 mb-2",children:"üö® A√ß√£o Urgente"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("strong",{children:((c=d==null?void 0:d.vips_inativos)==null?void 0:c.quantidade)??0})," clientes VIP em risco de churn"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Contate imediatamente para evitar perda de ",((m=d==null?void 0:d.vips_inativos)==null?void 0:m.impacto)??"R$ 0"," em receita"]})]}),e.jsxs("div",{className:"border-l-4 border-yellow-500 pl-4",children:[e.jsx("h3",{className:"font-semibold text-yellow-700 mb-2",children:"‚ö†Ô∏è Aten√ß√£o"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("strong",{children:((k=d==null?void 0:d.clientes_endividados)==null?void 0:k.quantidade)??0})," clientes endividados"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Total de ",((w=d==null?void 0:d.clientes_endividados)==null?void 0:w.impacto)??"R$ 0"," em aberto ‚Ä¢ Avaliar condi√ß√µes"]})]}),e.jsxs("div",{className:"border-l-4 border-green-500 pl-4",children:[e.jsx("h3",{className:"font-semibold text-green-700 mb-2",children:"üí° Oportunidade"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("strong",{children:((x=d==null?void 0:d.oportunidades_novos)==null?void 0:x.quantidade)??0})," novos clientes promissores"]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Potencial de fideliza√ß√£o ‚Ä¢ Ticket m√©dio alto"})]})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(Ts,{size:12}),"Dados calculados em tempo real com base em regras de neg√≥cio pr√©-definidas"]})})]})]})]})}function rc(){const[s,n]=a.useState([]),[t,d]=a.useState([]),[o,g]=a.useState(!0),[r,v]=a.useState(!1),[j,f]=a.useState(!1),[y,c]=a.useState({email:"",password:"",role_id:null});async function m(){try{g(!0);const b=await F.get("/usuarios");n(b.data)}catch(b){console.error("Erro ao carregar usu√°rios:",b),alert("Erro ao carregar usu√°rios")}finally{g(!1)}}async function k(){try{const b=await F.get("/roles");d(b.data)}catch(b){console.error("Erro ao carregar roles:",b)}}async function w(b,u){try{await F.patch(`/usuarios/${b}/status`,{is_active:!u}),m()}catch(i){console.error("Erro ao alterar status:",i),alert("Erro ao alterar status do usu√°rio")}}async function x(b){var u,i;b.preventDefault();try{await F.post("/usuarios",y),alert("Usu√°rio criado com sucesso!"),v(!1),c({email:"",password:"",role_id:null}),m()}catch(p){console.error("Erro ao criar usu√°rio:",p),alert(((i=(u=p.response)==null?void 0:u.data)==null?void 0:i.detail)||"Erro ao criar usu√°rio")}}return a.useEffect(()=>{m(),k()},[]),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Usu√°rios"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie os usu√°rios do sistema"})]}),e.jsxs("button",{onClick:()=>{c({email:"",password:"",role_id:null}),f(!1),v(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Novo Usu√°rio"]})]}),o?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Carregando..."})]}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"px-6 py-12 text-center text-gray-500",children:"Nenhum usu√°rio encontrado"})}):s.map(b=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:b.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:b.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${b.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:b.is_active?"Ativo":"Inativo"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:e.jsx("button",{onClick:()=>w(b.user_id,b.is_active),className:`px-3 py-1 rounded text-white transition-colors ${b.is_active?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"}`,children:b.is_active?"Desativar":"Ativar"})})]},b.user_id))})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Novo Usu√°rio"}),e.jsx("button",{onClick:()=>{v(!1),c({email:"",password:"",role:"user"})},className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{type:"email",required:!0,value:y.email,onChange:b=>c({...y,email:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"usuario@exemplo.com",autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Senha *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:j?"text":"password",required:!0,value:y.password,onChange:b=>c({...y,password:b.target.value}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"M√≠nimo 6 caracteres",autoComplete:"new-password"}),e.jsx("button",{type:"button",onClick:()=>f(!j),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:j?e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),e.jsx("select",{value:y.role_id||"",onChange:b=>c({...y,role_id:parseInt(b.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:t.length===0?e.jsx("option",{value:"",children:"Carregando..."}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",children:"Selecione uma role..."}),t.map(b=>e.jsx("option",{value:b.role_id,children:b.nome},b.role_id))]})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{v(!1),c({email:"",password:"",role_id:null})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Criar Usu√°rio"})]})]})]})})})]})}function oc(){const[s,n]=a.useState([]),[t,d]=a.useState([]),[o,g]=a.useState(!0),[r,v]=a.useState(!1),[j,f]=a.useState(null),[y,c]=a.useState({}),[m,k]=a.useState({nome:"",descricao:"",permissions:[]});async function w(){try{g(!0);const[$,K]=await Promise.all([F.get("/roles"),F.get("/permissions")]);n($.data),d(K.data)}catch($){console.error("Erro ao carregar dados:",$),alert("Erro ao carregar dados")}finally{g(!1)}}async function x($){var K,re;$.preventDefault();try{j?(await F.put(`/roles/${j.role_id}`,m),alert("Role atualizada com sucesso!")):(await F.post("/roles",m),alert("Role criada com sucesso!")),v(!1),f(null),k({nome:"",descricao:"",permissions:[]}),w()}catch(M){console.error("Erro ao salvar role:",M),alert(((re=(K=M.response)==null?void 0:K.data)==null?void 0:re.detail)||"Erro ao salvar role")}}function b($){f($),k({nome:$.nome,descricao:$.descricao||"",permissions:$.permissions.map(K=>K.permission_id)}),v(!0)}function u($){k(K=>({...K,permissions:K.permissions.includes($)?K.permissions.filter(re=>re!==$):[...K.permissions,$]}))}function i(){const $={};return t.forEach(K=>{const re=K.nome&&K.nome.includes(".")?K.nome.split(".")[0]:"outras";$[re]||($[re]=[]),$[re].push(K)}),$}function p($){return{financeiro:"Financeiro",comissoes:"Comiss√µes",entregas:"Entregas",compras:"Compras",cadastros:"Cadastros",configuracoes:"Configura√ß√µes",rh:"Recursos Humanos",vendas:"Vendas",usuarios:"Usu√°rios",relatorios:"Relat√≥rios",ia:"Intelig√™ncia Artificial",outras:"Outras"}[$]||$.charAt(0).toUpperCase()+$.slice(1)}function l($){c(K=>({...K,[$]:!K[$]}))}function C($,K){const re=K.map(R=>R.permission_id),M=re.every(R=>m.permissions.includes(R));k(R=>({...R,permissions:M?R.permissions.filter(J=>!re.includes(J)):[...new Set([...R.permissions,...re])]}))}function h($){return $.every(K=>m.permissions.includes(K.permission_id))}function _($){const K=$.filter(re=>m.permissions.includes(re.permission_id));return K.length>0&&K.length<$.length}async function S($){if(confirm("Tem certeza que deseja excluir esta role?"))try{await F.delete(`/roles/${$}`),alert("Role exclu√≠da com sucesso!"),w()}catch(K){console.error("Erro ao excluir role:",K),alert("Erro ao excluir role")}}return a.useEffect(()=>{w()},[]),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Permiss√µes (Roles)"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie roles e suas permiss√µes"})]}),e.jsxs("button",{onClick:()=>{f(null),k({nome:"",descricao:"",permissions:[]}),v(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Nova Role"]})]}),o?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Carregando..."})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:s.length===0?e.jsx("div",{className:"col-span-full text-center py-12 text-gray-500",children:"Nenhuma role encontrada"}):s.map($=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:$.nome}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:$.descricao})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b($),className:"text-blue-600 hover:text-blue-700",title:"Editar",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>S($.role_id),className:"text-red-600 hover:text-red-700",title:"Excluir",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-2",children:"Permiss√µes:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:$.permissions.length===0?e.jsx("span",{className:"text-sm text-gray-400",children:"Nenhuma permiss√£o"}):$.permissions.map(K=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:K.nome},K.permission_id))})]})]},$.role_id))}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:j?"Editar Role":"Nova Role"}),e.jsx("button",{onClick:()=>{v(!1),f(null)},className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Role *"}),e.jsx("input",{type:"text",required:!0,value:m.nome,onChange:$=>k({...m,nome:$.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: Gerente, Vendedor, etc"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri√ß√£o"}),e.jsx("textarea",{value:m.descricao||"",onChange:$=>k({...m,descricao:$.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"2",placeholder:"Descri√ß√£o da role"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Permiss√µes *"}),e.jsx("div",{className:"border border-gray-300 rounded-lg p-4 max-h-96 overflow-y-auto",children:t.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhuma permiss√£o dispon√≠vel"}):e.jsx("div",{className:"space-y-1",children:Object.entries(i()).map(([$,K])=>{const re=y[$],M=h(K),R=_(K);return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-center p-3 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>l($),className:"text-gray-600 hover:text-gray-900 transition-colors",children:re?e.jsx(Ws,{className:"w-5 h-5"}):e.jsx(zs,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center flex-1 cursor-pointer",onClick:()=>C($,K),children:[e.jsx("input",{type:"checkbox",checked:M,ref:J=>{J&&(J.indeterminate=R)},onChange:()=>{},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-3 font-medium text-gray-900",children:p($)}),e.jsxs("span",{className:"ml-auto text-xs text-gray-500",children:["(",K.filter(J=>m.permissions.includes(J.permission_id)).length,"/",K.length,")"]})]})]})}),re&&e.jsx("div",{className:"bg-white p-3 space-y-1 border-t border-gray-200",children:K.map(J=>e.jsxs("label",{className:"flex items-start cursor-pointer hover:bg-gray-50 p-2 rounded ml-4",children:[e.jsx("input",{type:"checkbox",checked:m.permissions.includes(J.permission_id),onChange:()=>u(J.permission_id),className:"mt-1 mr-3 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:J.nome.split(".")[1]||J.nome}),J.descricao&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:J.descricao})]})]},J.permission_id))})]},$)})})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{v(!1),f(null)},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[j?"Atualizar":"Criar"," Role"]})]})]})]})})})]})}function nc(){console.log("üîß Configuracoes carregou - Total de cards:",7);const s=[{title:"Usu√°rios",description:"Gerenciar usu√°rios do sistema",icon:zo,link:"/admin/usuarios",color:"blue"},{title:"Permiss√µes",description:"Gerenciar roles e permiss√µes",icon:To,link:"/admin/roles",color:"purple"},{title:"Configura√ß√µes Fiscais",description:"Configurar tributa√ß√£o padr√£o da empresa",icon:jt,link:"/configuracoes/fiscal",color:"green"},{title:"Entregas",description:"Configurar entregadores e ponto inicial de rotas",icon:at,link:"/configuracoes/entregas",color:"blue"},{title:"Custos da Moto",description:"Configurar custos operacionais da moto de entregas",icon:jt,link:"/configuracoes/custos-moto",color:"orange"},{title:"Estoque",description:"Configurar comportamento do controle de estoque",icon:$t,link:"/configuracoes/estoque",color:"indigo"},{title:"Sistema",description:"Configura√ß√µes gerais do sistema",icon:jt,link:"#",color:"gray",disabled:!0}];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Configura√ß√µes"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gerencie usu√°rios, permiss√µes e configura√ß√µes do sistema"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(n=>{const t=n.icon,d={blue:"bg-blue-50 text-blue-600 hover:bg-blue-100",purple:"bg-purple-50 text-purple-600 hover:bg-purple-100",green:"bg-green-50 text-green-600 hover:bg-green-100",orange:"bg-orange-50 text-orange-600 hover:bg-orange-100",indigo:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100",gray:"bg-gray-50 text-gray-400"};return n.disabled?e.jsxs("div",{className:`p-6 rounded-lg border-2 border-gray-200 ${d[n.color]} cursor-not-allowed opacity-60`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(t,{className:"text-2xl"}),e.jsx("h3",{className:"text-lg font-semibold",children:n.title})]}),e.jsx("p",{className:"text-sm text-gray-500",children:n.description}),e.jsx("span",{className:"text-xs text-gray-400 mt-2 block",children:"Em breve"})]},n.title):e.jsxs(Ms,{to:n.link,className:`p-6 rounded-lg border-2 border-gray-200 ${d[n.color]} transition-all hover:shadow-lg`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(t,{className:"text-2xl"}),e.jsx("h3",{className:"text-lg font-semibold",children:n.title})]}),e.jsx("p",{className:"text-sm opacity-80",children:n.description}),e.jsxs("div",{className:"mt-4 flex items-center text-sm font-medium",children:["Acessar",e.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]},n.title)})})]})}function lc(){const[s,n]=a.useState(!0),[t,d]=a.useState(!1),[o,g]=a.useState(!1),r=C=>{if(console.log("üîß normalizeCnaesSecundarios chamado com:",C,"tipo:",typeof C),!C)return[];if(Array.isArray(C))return C;if(typeof C=="string")try{const h=JSON.parse(C);return Array.isArray(h)?h:[]}catch{return[]}return console.warn("‚ö†Ô∏è Valor inesperado para CNAEs, retornando array vazio"),[]},[v,j]=a.useState(""),[f,y]=a.useState([]),[c,m]=a.useState({cnpj:"",razao_social:"",nome_fantasia:"",inscricao_estadual:"",inscricao_municipal:"",email:"",telefone:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",uf:""}),[k,w]=a.useState({regime_tributario:"",simples_anexo:"I",aliquota_simples_vigente:0,aliquota_simples_sugerida:0,cnae_principal:"",cnae_descricao:"",cnaes_secundarios:[],uf:""});a.useEffect(()=>{async function C(){try{const h=await oa.get("/empresa/fiscal");console.log("üìä Dados fiscais carregados:",h.data),console.log("üîç cnaes_secundarios recebido:",h.data.cnaes_secundarios),console.log("üîç Tipo:",typeof h.data.cnaes_secundarios),console.log("üîç √â array?",Array.isArray(h.data.cnaes_secundarios));const _=r(h.data.cnaes_secundarios);console.log("‚úÖ Ap√≥s normalizar:",_),console.log("‚úÖ √â array agora?",Array.isArray(_)),w({regime_tributario:h.data.regime_tributario||"",simples_anexo:h.data.simples_anexo||"I",aliquota_simples_vigente:h.data.aliquota_simples_vigente??0,aliquota_simples_sugerida:h.data.aliquota_simples_sugerida??0,cnae_principal:h.data.cnae_principal||"",cnae_descricao:h.data.cnae_descricao||"",cnaes_secundarios:_,uf:h.data.uf||""}),h.data.cnae_descricao&&j(h.data.cnae_descricao),y(_);try{const S=await oa.get("/empresa/dados-cadastrais");S.data&&m({cnpj:S.data.cnpj||"",razao_social:S.data.razao_social||"",nome_fantasia:S.data.nome_fantasia||"",inscricao_estadual:S.data.inscricao_estadual||"",inscricao_municipal:S.data.inscricao_municipal||"",email:S.data.email||"",telefone:S.data.telefone||"",cep:S.data.cep||"",endereco:S.data.endereco||"",numero:S.data.numero||"",complemento:S.data.complemento||"",bairro:S.data.bairro||"",cidade:S.data.cidade||"",uf:S.data.uf||""})}catch{console.log("Endpoint de dados cadastrais n√£o existe ainda")}}catch(h){console.error("‚ùå Erro ao carregar configura√ß√µes:",h),console.error("‚ùå Resposta completa:",h.response),Se.error("Erro ao carregar configura√ß√µes da empresa"),y([]),w(_=>({..._,cnaes_secundarios:[]}))}finally{n(!1)}}C()},[]);function x(C){const{name:h,value:_}=C.target;w(S=>{const $={...S,[h]:_};return h==="regime_tributario"&&_==="Simples Nacional"&&((!$.simples_anexo||$.simples_anexo==="")&&($.simples_anexo="I"),(!$.aliquota_simples_vigente||$.aliquota_simples_vigente===0)&&($.aliquota_simples_vigente=4)),$})}function b(C){const{name:h,value:_}=C.target;m(S=>({...S,[h]:_}))}async function u(){const C=c.cnpj.replace(/[^0-9]/g,"");if(C.length!==14){Se.error("CNPJ deve ter 14 d√≠gitos");return}g(!0);try{const h=await fetch(`https://brasilapi.com.br/api/cnpj/v1/${C}`);if(!h.ok)throw new Error("CNPJ n√£o encontrado");const _=await h.json();console.log("üîç Dados completos da API:",_),console.log("üìã CNAE Fiscal:",_.cnae_fiscal),console.log("üìã CNAE Descri√ß√£o:",_.cnae_fiscal_descricao),console.log("üìã CNAEs Secund√°rios:",_.cnaes_secundarios);const S={...c};_.razao_social&&(S.razao_social=_.razao_social),_.nome_fantasia&&(S.nome_fantasia=_.nome_fantasia),_.email&&(S.email=_.email),_.inscricao_estadual&&(S.inscricao_estadual=_.inscricao_estadual);const $=_.ddd_telefone_1||_.telefone;if($&&(S.telefone=$),_.cep&&(S.cep=_.cep.replace(/[^0-9]/g,"")),_.logradouro&&(S.endereco=_.logradouro),_.numero&&(S.numero=_.numero),_.complemento&&(S.complemento=_.complemento),_.bairro&&(S.bairro=_.bairro),_.municipio&&(S.cidade=_.municipio),_.uf&&(S.uf=_.uf),m(S),_.cnae_fiscal){const K=_.cnae_fiscal.toString();console.log("‚úÖ CNAE encontrado:",K);const re=r(_.cnaes_secundarios);w(M=>({...M,cnae_principal:K,cnae_descricao:_.cnae_fiscal_descricao||"",cnaes_secundarios:re})),_.cnae_fiscal_descricao&&j(_.cnae_fiscal_descricao),y(re),re.length>0&&console.log(`üìã Encontrados ${re.length} CNAEs secund√°rios`)}Se.success("‚úÖ Dados preenchidos com sucesso!")}catch(h){console.error("Erro ao buscar CNPJ:",h),Se.error("‚ùå Erro ao buscar CNPJ. Verifique o n√∫mero.")}finally{g(!1)}}async function i(){var C,h;d(!0);try{const _={...k,cnaes_secundarios:r(k.cnaes_secundarios)};console.log("üíæ Salvando dados fiscais:",_),console.log("üìã CNAE Descri√ß√£o no form:",k.cnae_descricao),console.log("üìã CNAEs Secund√°rios no form:",k.cnaes_secundarios);const S=await oa.put("/empresa/fiscal",_);console.log("‚úÖ Resposta do servidor (fiscal):",S.data);try{console.log("üíæ Salvando dados cadastrais:",c),await oa.put("/empresa/dados-cadastrais",c)}catch{console.log("Endpoint de dados cadastrais n√£o implementado ainda")}Se.success("Configura√ß√µes salvas com sucesso!")}catch(_){console.error("Erro ao salvar:",_),Se.error(((h=(C=_.response)==null?void 0:C.data)==null?void 0:h.detail)||"Erro ao salvar configura√ß√µes")}finally{d(!1)}}if(s)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando configura√ß√µes..."})]})});const p=Array.isArray(f)?f:[],l=k.regime_tributario==="Simples Nacional";return e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Configura√ß√£o da Empresa"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure os dados cadastrais, fiscais e tribut√°rios da sua empresa"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"bg-blue-50 px-6 py-4 border-b border-blue-100",children:[e.jsx("h2",{className:"text-lg font-semibold text-blue-900",children:"üìã Dados Cadastrais"}),e.jsxs("p",{className:"text-sm text-blue-700 mt-2",children:["üí° ",e.jsx("strong",{children:"Dica:"})," Digite o CNPJ e clique no bot√£o üîç para preencher automaticamente os dados da empresa (raz√£o social, endere√ßo, CNAEs, etc.) consultando a Receita Federal."]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["CNPJ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",name:"cnpj",value:c.cnpj,onChange:b,placeholder:"00.000.000/0000-00",maxLength:"18",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:u,disabled:o||!c.cnpj,title:"Buscar dados da Receita Federal pelo CNPJ",className:"px-3 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed flex items-center justify-center shadow-md hover:shadow-lg transition-all duration-200",children:o?e.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Raz√£o Social ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"razao_social",value:c.razao_social,onChange:b,placeholder:"Nome empresarial completo",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome Fantasia"}),e.jsx("input",{type:"text",name:"nome_fantasia",value:c.nome_fantasia,onChange:b,placeholder:"Nome comercial",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Inscri√ß√£o Estadual"}),e.jsx("input",{type:"text",name:"inscricao_estadual",value:c.inscricao_estadual,onChange:b,placeholder:"000.000.000.000",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Inscri√ß√£o Municipal"}),e.jsx("input",{type:"text",name:"inscricao_municipal",value:c.inscricao_municipal,onChange:b,placeholder:"000000",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail"}),e.jsx("input",{type:"email",name:"email",value:c.email,onChange:b,placeholder:"contato@empresa.com.br",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefone"}),e.jsx("input",{type:"text",name:"telefone",value:c.telefone,onChange:b,placeholder:"(00) 0000-0000",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CEP"}),e.jsx("input",{type:"text",name:"cep",value:c.cep,onChange:b,placeholder:"00000-000",maxLength:"9",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Endere√ßo"}),e.jsx("input",{type:"text",name:"endereco",value:c.endereco,onChange:b,placeholder:"Rua, Avenida, etc",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"N√∫mero"}),e.jsx("input",{type:"text",name:"numero",value:c.numero,onChange:b,placeholder:"123",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Complemento"}),e.jsx("input",{type:"text",name:"complemento",value:c.complemento,onChange:b,placeholder:"Sala, Apto, etc",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bairro"}),e.jsx("input",{type:"text",name:"bairro",value:c.bairro,onChange:b,placeholder:"Centro",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"UF"}),e.jsxs("select",{name:"uf",value:c.uf,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"-"}),e.jsx("option",{value:"SP",children:"SP"}),e.jsx("option",{value:"RJ",children:"RJ"}),e.jsx("option",{value:"MG",children:"MG"}),e.jsx("option",{value:"RS",children:"RS"}),e.jsx("option",{value:"PR",children:"PR"}),e.jsx("option",{value:"SC",children:"SC"}),e.jsx("option",{value:"BA",children:"BA"}),e.jsx("option",{value:"PE",children:"PE"}),e.jsx("option",{value:"CE",children:"CE"}),e.jsx("option",{value:"GO",children:"GO"}),e.jsx("option",{value:"DF",children:"DF"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cidade"}),e.jsx("input",{type:"text",name:"cidade",value:c.cidade,onChange:b,placeholder:"Nome da cidade",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-green-50 px-6 py-4 border-b border-green-100",children:e.jsx("h2",{className:"text-lg font-semibold text-green-900",children:"üí∞ Configura√ß√£o Fiscal e Tribut√°ria"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CNAE Principal"}),e.jsx("input",{type:"text",name:"cnae_principal",value:k.cnae_principal,onChange:x,placeholder:"0000-0/00",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),v&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-900 font-medium",children:["üìã ",v]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"C√≥digo da Classifica√ß√£o Nacional de Atividades Econ√¥micas"})]}),p.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["CNAEs Secund√°rios (",p.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:p.map((C,h)=>e.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-md text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:(C==null?void 0:C.codigo)||"N/A"}),e.jsxs("span",{className:"text-gray-600",children:[" - ",(C==null?void 0:C.descricao)||"Sem descri√ß√£o"]})]},h))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Regime Tribut√°rio ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"regime_tributario",value:k.regime_tributario,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Simples Nacional",children:"Simples Nacional"}),e.jsx("option",{value:"Lucro Presumido",children:"Lucro Presumido"}),e.jsx("option",{value:"Lucro Real",children:"Lucro Real"})]})]}),l&&e.jsxs("div",{className:"border-l-4 border-blue-500 bg-blue-50 p-4 space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-blue-900",children:"Par√¢metros do Simples Nacional"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Anexo"}),e.jsxs("select",{name:"simples_anexo",value:k.simples_anexo||"I",onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"I",children:"Anexo I - Com√©rcio"}),e.jsx("option",{value:"II",children:"Anexo II - Ind√∫stria"}),e.jsx("option",{value:"III",children:"Anexo III - Servi√ßos"}),e.jsx("option",{value:"IV",children:"Anexo IV - Servi√ßos (Constru√ß√£o)"}),e.jsx("option",{value:"V",children:"Anexo V - Servi√ßos (Intelectual)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Al√≠quota Vigente (%)"}),e.jsx("input",{type:"number",name:"aliquota_simples_vigente",value:k.aliquota_simples_vigente||"",onChange:x,step:"0.01",min:"0",max:"100",placeholder:"Ex: 4.00",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Al√≠quota atual utilizada para calcular provis√µes"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Al√≠quota Sugerida (%)"}),e.jsx("input",{type:"number",name:"aliquota_simples_sugerida",value:k.aliquota_simples_sugerida||"",onChange:x,step:"0.01",min:"0",max:"100",placeholder:"Ex: 4.50",className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Sugest√£o baseada no hist√≥rico de fechamentos (informativo)"})]})]})]})]}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx("button",{type:"button",onClick:i,disabled:t,className:"px-8 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium",children:t?"Salvando...":"Salvar Todas as Configura√ß√µes"})})]})]})}function ic(){const[s,n]=a.useState(!0),[t,d]=a.useState(!1),[o,g]=a.useState(!1),[r,v]=a.useState([]),[j,f]=a.useState({entregador_padrao_id:"",ponto_inicial_rota:"",cep:"",logradouro:"",numero:"",complemento:"",bairro:"",cidade:"",estado:""});a.useEffect(()=>{async function m(){var k,w;try{const[x,b]=await Promise.all([oa.get("/configuracoes/entregas"),oa.get("/clientes/",{params:{is_entregador:!0,entregador_ativo:!0}})]);f({entregador_padrao_id:x.data.entregador_padrao_id??"",ponto_inicial_rota:"",cep:x.data.cep??"",logradouro:x.data.logradouro??"",numero:x.data.numero??"",complemento:x.data.complemento??"",bairro:x.data.bairro??"",cidade:x.data.cidade??"",estado:x.data.estado??""});const u=Array.isArray(b.data)?b.data:((k=b.data)==null?void 0:k.clientes)||((w=b.data)==null?void 0:w.items)||[];console.log("üöö Entregadores carregados:",u),v(u)}catch(x){console.error("‚ùå Erro ao carregar configura√ß√µes:",x),alert("Erro ao carregar configura√ß√µes de entrega"),v([])}finally{n(!1)}}m()},[]);async function y(){const m=j.cep.replace(/\D/g,"");if(m.length!==8){alert("CEP inv√°lido. Digite 8 d√≠gitos.");return}g(!0);try{const w=await(await fetch(`https://viacep.com.br/ws/${m}/json/`)).json();if(w.erro){alert("CEP n√£o encontrado");return}f({...j,logradouro:w.logradouro||"",bairro:w.bairro||"",cidade:w.localidade||"",estado:w.uf||""})}catch(k){console.error(k),alert("Erro ao buscar CEP")}finally{g(!1)}}async function c(m){m.preventDefault(),d(!0);try{await oa.put("/configuracoes/entregas",{entregador_padrao_id:j.entregador_padrao_id||null,cep:j.cep||null,logradouro:j.logradouro||null,numero:j.numero||null,complemento:j.complemento||null,bairro:j.bairro||null,cidade:j.cidade||null,estado:j.estado||null}),alert("Configura√ß√µes salvas com sucesso")}catch(k){console.error(k),alert("Erro ao salvar configura√ß√µes")}finally{d(!1)}}return s?e.jsx("div",{children:"Carregando..."}):e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"Configura√ß√µes de Entregas"}),e.jsxs("form",{onSubmit:c,style:{maxWidth:600},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Entregador padr√£o"}),e.jsxs("select",{value:j.entregador_padrao_id,onChange:m=>f({...j,entregador_padrao_id:m.target.value}),children:[e.jsx("option",{value:"",children:"Nenhum (escolher manualmente)"}),Array.isArray(r)&&r.map(m=>e.jsx("option",{value:m.id,children:m.nome},m.id))]}),e.jsx("p",{style:{fontSize:12,color:"#666",marginTop:5},children:"Este entregador ser√° pr√©-selecionado ao criar novas rotas."})]}),e.jsx("hr",{style:{margin:"30px 0",border:"none",borderTop:"1px solid #ddd"}}),e.jsx("h3",{style:{marginBottom:20},children:"Ponto Inicial Padr√£o da Rota"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"CEP *"}),e.jsxs("div",{style:{display:"flex",gap:10},children:[e.jsx("input",{type:"text",value:j.cep.replace(/(\d{5})(\d)/,"$1-$2"),onChange:m=>{const k=m.target.value.replace(/\D/g,"");f({...j,cep:k.slice(0,8)})},placeholder:"00000-000",maxLength:9,style:{flex:1}}),e.jsx("button",{type:"button",onClick:y,disabled:o||j.cep.length<8,style:{padding:"0 20px",display:"flex",alignItems:"center",gap:5},children:o?"Buscando...":e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"üîç"}),"Buscar"]})})]}),e.jsx("p",{style:{fontSize:12,color:"#666",marginTop:5},children:"Digite o CEP e clique em Buscar para preencher automaticamente."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Logradouro (Rua/Avenida) *"}),e.jsx("input",{type:"text",value:j.logradouro,onChange:m=>f({...j,logradouro:m.target.value}),placeholder:"Ex: Rua das Flores"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:15},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"N√∫mero *"}),e.jsx("input",{type:"text",value:j.numero,onChange:m=>f({...j,numero:m.target.value}),placeholder:"123"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Complemento"}),e.jsx("input",{type:"text",value:j.complemento,onChange:m=>f({...j,complemento:m.target.value}),placeholder:"Ex: Loja 1"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Bairro *"}),e.jsx("input",{type:"text",value:j.bairro,onChange:m=>f({...j,bairro:m.target.value}),placeholder:"Ex: Centro"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:15},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cidade *"}),e.jsx("input",{type:"text",value:j.cidade,onChange:m=>f({...j,cidade:m.target.value}),placeholder:"Ex: S√£o Paulo"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Estado *"}),e.jsx("input",{type:"text",value:j.estado,onChange:m=>{const k=m.target.value.toUpperCase().slice(0,2);f({...j,estado:k})},placeholder:"SP",maxLength:2})]})]}),e.jsx("p",{style:{fontSize:12,color:"#666",marginTop:15,marginBottom:20},children:"Este endere√ßo ser√° usado como ponto de partida para calcular as rotas de entrega."}),e.jsx("button",{type:"submit",disabled:t,style:{backgroundColor:"#2563eb",color:"white",padding:"12px 24px",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"500",cursor:t?"not-allowed":"pointer",opacity:t?.6:1,transition:"all 0.2s"},onMouseOver:m=>{t||(m.target.style.backgroundColor="#1d4ed8")},onMouseOut:m=>{t||(m.target.style.backgroundColor="#2563eb")},children:t?"Salvando...":"Salvar Configura√ß√µes"})]})]})}function dc(){const[s,n]=a.useState({preco_combustivel:"",km_por_litro:"",km_troca_oleo:"",custo_troca_oleo:"",km_troca_pneu_dianteiro:"",custo_pneu_dianteiro:"",km_troca_pneu_traseiro:"",custo_pneu_traseiro:"",km_troca_kit_traseiro:"",custo_kit_traseiro:"",km_manutencao_geral:"",custo_manutencao_geral:"",seguro_mensal:"",licenciamento_mensal:"",ipva_mensal:"",outros_custos_mensais:"",km_medio_mensal:""}),[t,d]=a.useState(!1),o=()=>{const x=parseFloat(s.preco_combustivel)||0,b=parseFloat(s.km_por_litro)||1;return b>0?(x/b).toFixed(4):"0.0000"},g=()=>{const x=parseFloat(s.custo_troca_oleo)||0,b=parseFloat(s.km_troca_oleo)||1;return b>0?(x/b).toFixed(4):"0.0000"},r=()=>{const x=parseFloat(s.custo_pneu_dianteiro)||0,b=parseFloat(s.km_troca_pneu_dianteiro)||1;return b>0?(x/b).toFixed(4):"0.0000"},v=()=>{const x=parseFloat(s.custo_pneu_traseiro)||0,b=parseFloat(s.km_troca_pneu_traseiro)||1;return b>0?(x/b).toFixed(4):"0.0000"},j=()=>{const x=parseFloat(s.custo_kit_traseiro)||0,b=parseFloat(s.km_troca_kit_traseiro)||1;return b>0?(x/b).toFixed(4):"0.0000"},f=()=>{const x=parseFloat(s.custo_manutencao_geral)||0,b=parseFloat(s.km_manutencao_geral)||1;return b>0?(x/b).toFixed(4):"0.0000"},y=()=>{const x=parseFloat(s.seguro_mensal)||0,b=parseFloat(s.licenciamento_mensal)||0,u=parseFloat(s.ipva_mensal)||0,i=parseFloat(s.outros_custos_mensais)||0,p=x+b+u+i,l=parseFloat(s.km_medio_mensal)||1;return l>0?(p/l).toFixed(4):"0.0000"};a.useEffect(()=>{c()},[]);async function c(){const b=(await oa.get("/configuracoes/custo-moto")).data;Object.keys(b).forEach(u=>{b[u]===null&&(b[u]="")}),n(b)}function m(x){n({...s,[x.target.name]:x.target.value})}function k(){confirm("Preencher com valores sugeridos baseados em uma moto de entrega t√≠pica (CG 160, Biz 125, Pop 110)? Os valores atuais ser√£o substitu√≠dos.")&&n({preco_combustivel:"6.30",km_por_litro:"38",km_troca_oleo:"3000",custo_troca_oleo:"95.00",km_troca_pneu_dianteiro:"14000",custo_pneu_dianteiro:"210.00",km_troca_pneu_traseiro:"10000",custo_pneu_traseiro:"240.00",km_troca_kit_traseiro:"18000",custo_kit_traseiro:"420.00",km_manutencao_geral:"5000",custo_manutencao_geral:"180.00",seguro_mensal:"110.00",licenciamento_mensal:"32.00",ipva_mensal:"55.00",outros_custos_mensais:"75.00",km_medio_mensal:"1200"})}async function w(){d(!0),await oa.put("/configuracoes/custo-moto",s),d(!1),alert("Custos da moto salvos com sucesso")}return e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"üèçÔ∏è Custos da Moto"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure os custos operacionais da moto de entregas"}),e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-800",children:["üí° ",e.jsx("strong",{children:"Dica:"}),' N√£o sabe por onde come√ßar? Clique em "Preencher com Valores Sugeridos" para usar custos t√≠picos de uma moto de entrega (CG 160, Biz 125, Pop 110 na faixa de R$ 15 mil). Depois ajuste conforme sua realidade.']}),e.jsx("div",{className:"mt-4",children:e.jsxs("button",{onClick:k,className:"px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors shadow-sm flex items-center gap-2",children:[e.jsx("span",{children:"üí°"})," Preencher com Valores Sugeridos"]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"‚õΩ"})," Combust√≠vel"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pre√ßo por Litro (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"preco_combustivel",placeholder:"Ex: 6.50",value:s.preco_combustivel,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Consumo M√©dio (KM/Litro)"}),e.jsx("input",{type:"number",step:"0.1",name:"km_por_litro",placeholder:"Ex: 35",value:s.km_por_litro,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"üí∞ Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-blue-50 border border-blue-200 rounded-md text-blue-900 font-semibold text-lg",children:["R$ ",o()]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"üõ†Ô∏è"})," Manuten√ß√£o (Custos Vari√°veis por KM)"]}),e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Troca de √ìleo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"KM para Troca"}),e.jsx("input",{type:"number",name:"km_troca_oleo",placeholder:"Ex: 3000",value:s.km_troca_oleo,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Custo por Troca (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"custo_troca_oleo",placeholder:"Ex: 150.00",value:s.custo_troca_oleo,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"üí∞ Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-green-50 border border-green-200 rounded-md text-green-900 font-semibold",children:["R$ ",g()]})]})]})]}),e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Pneu Dianteiro"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Vida √ötil (KM)"}),e.jsx("input",{type:"number",name:"km_troca_pneu_dianteiro",placeholder:"Ex: 15000",value:s.km_troca_pneu_dianteiro,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Pre√ßo do Pneu (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"custo_pneu_dianteiro",placeholder:"Ex: 250.00",value:s.custo_pneu_dianteiro,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"üí∞ Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-green-50 border border-green-200 rounded-md text-green-900 font-semibold",children:["R$ ",r()]})]})]})]}),e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Pneu Traseiro"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Vida √ötil (KM)"}),e.jsx("input",{type:"number",name:"km_troca_pneu_traseiro",placeholder:"Ex: 12000",value:s.km_troca_pneu_traseiro,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Pre√ßo do Pneu (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"custo_pneu_traseiro",placeholder:"Ex: 280.00",value:s.custo_pneu_traseiro,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"üí∞ Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-green-50 border border-green-200 rounded-md text-green-900 font-semibold",children:["R$ ",v()]})]})]})]}),e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Kit Transmiss√£o (Corrente, Coroa, Pinh√£o)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Vida √ötil do Kit (KM)"}),e.jsx("input",{type:"number",name:"km_troca_kit_traseiro",placeholder:"Ex: 20000",value:s.km_troca_kit_traseiro,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Pre√ßo do Kit (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"custo_kit_traseiro",placeholder:"Ex: 450.00",value:s.custo_kit_traseiro,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"üí∞ Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-green-50 border border-green-200 rounded-md text-green-900 font-semibold",children:["R$ ",j()]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Manuten√ß√£o Geral"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Frequ√™ncia (KM)"}),e.jsx("input",{type:"number",name:"km_manutencao_geral",placeholder:"Ex: 5000",value:s.km_manutencao_geral,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Custo por Manuten√ß√£o (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"custo_manutencao_geral",placeholder:"Ex: 200.00",value:s.custo_manutencao_geral,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"üí∞ Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-green-50 border border-green-200 rounded-md text-green-900 font-semibold",children:["R$ ",f()]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"üìÑ"})," Custos Fixos Mensais"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Seguro Mensal (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"seguro_mensal",placeholder:"Ex: 120.00",value:s.seguro_mensal,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Licenciamento Mensal (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"licenciamento_mensal",placeholder:"Ex: 30.00",value:s.licenciamento_mensal,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"IPVA Mensal (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"ipva_mensal",placeholder:"Ex: 50.00",value:s.ipva_mensal,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Outros Custos Mensais (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"outros_custos_mensais",placeholder:"Ex: 100.00",value:s.outros_custos_mensais,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"üìä"})," Controle"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"KM M√©dio Mensal (para c√°lculo de custos fixos)"}),e.jsx("input",{type:"number",step:"0.01",name:"km_medio_mensal",placeholder:"Ex: 1000",value:s.km_medio_mensal,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Usado para ratear os custos fixos mensais por KM rodado"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"üí∞ Custo Fixo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-purple-50 border border-purple-200 rounded-md text-purple-900 font-semibold text-lg",children:["R$ ",y()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Total dos custos fixos √∑ KM m√©dio mensal"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:w,disabled:t,className:"px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors shadow-sm",children:t?"Salvando...":"üíæ Salvar Configura√ß√µes"})})]})}function cc(){const[s,n]=a.useState(!0),[t,d]=a.useState(!1),[o,g]=a.useState(!1);a.useEffect(()=>{async function v(){try{const j=await oa.get("/empresa/config-estoque");g(j.data.permite_estoque_negativo)}catch(j){console.error("Erro ao carregar configura√ß√µes de estoque",j),Se.error("Erro ao carregar configura√ß√µes")}finally{n(!1)}}v()},[]);async function r(){d(!0);try{await oa.put("/empresa/config-estoque",{permite_estoque_negativo:o}),Se.success("Configura√ß√µes de estoque atualizadas com sucesso!")}catch(v){console.error("Erro ao salvar configura√ß√µes",v),Se.error("Erro ao salvar configura√ß√µes")}finally{d(!1)}}return s?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando configura√ß√µes..."})]})}):e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(Ms,{to:"/configuracoes",className:"inline-flex items-center text-blue-600 hover:text-blue-700 mb-4",children:[e.jsx(sn,{className:"mr-1"}),"Voltar para Configura√ß√µes"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Configura√ß√µes de Estoque"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Configure o comportamento do controle de estoque do sistema"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Controle de Estoque Negativo"}),e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Oo,{className:"text-yellow-600 mt-1 mr-3 flex-shrink-0"}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Aten√ß√£o:"})," Esta configura√ß√£o afeta diretamente o controle de vendas e estoque."]})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-start p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"estoque-negativo",checked:!o,onChange:()=>g(!1),className:"mt-1 mr-3 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"üîí Bloquear vendas sem estoque (Recomendado)"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"O sistema impedir√° finalizar vendas quando n√£o houver estoque suficiente. Ideal para controle rigoroso de estoque."})]})]}),e.jsxs("label",{className:"flex items-start p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"estoque-negativo",checked:o,onChange:()=>g(!0),className:"mt-1 mr-3 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"‚úÖ Permitir estoque negativo"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"O sistema permitir√° vendas mesmo sem estoque dispon√≠vel. √ötil para neg√≥cios que trabalham com encomendas ou reposi√ß√£o r√°pida."}),e.jsx("div",{className:"text-xs text-red-600 mt-2 font-medium",children:"‚ö†Ô∏è Use com cuidado: pode gerar descontinuidade no controle de estoque"})]})]})]})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsxs("button",{onClick:r,disabled:t,className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:[e.jsx(Vs,{className:"mr-2"}),t?"Salvando...":"Salvar Configura√ß√µes"]})})]}),e.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"üí° Como funciona?"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Estoque Bloqueado:"})," Ao tentar vender um produto sem estoque, o sistema exibir√° um erro e impedir√° a finaliza√ß√£o da venda."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Estoque Negativo:"})," O sistema permite a venda e o estoque ficar√° com valor negativo at√© a pr√≥xima reposi√ß√£o."]}),e.jsx("li",{children:"Esta configura√ß√£o √© global e afeta todas as vendas realizadas no PDV e outros pontos de venda."})]})]})]})}function xc(){const s=new Date,[n,t]=a.useState(s.getMonth()+1),[d,o]=a.useState(s.getFullYear()),[g,r]=a.useState(!1),[v,j]=a.useState(null);a.useEffect(()=>{f()},[]);const f=async()=>{if(!n||!d){Se.error("Informe m√™s e ano");return}r(!0);try{const w=await F.get(`/auditoria/provisoes/mensal?mes=${n}&ano=${d}`);j(w.data)}catch(w){console.error("Erro ao buscar auditoria:",w),Se.error("Erro ao buscar auditoria de provis√µes")}finally{r(!1)}},y=w=>!w&&w!==0?"R$ 0,00":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Math.abs(w)),c=w=>!w&&w!==0?"0,0%":`${w.toFixed(1)}%`,m=(w,x)=>{const b={OK:"bg-green-100 text-green-800 border-green-300",AJUSTE:"bg-yellow-100 text-yellow-800 border-yellow-300",ACUMULANDO:"bg-blue-100 text-blue-800 border-blue-300",SEM_DADOS:"bg-gray-100 text-gray-600 border-gray-300"};return e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium border ${b[w]||b.SEM_DADOS}`,children:[x," ",w.replace("_"," ")]})},k=[{valor:1,nome:"Janeiro"},{valor:2,nome:"Fevereiro"},{valor:3,nome:"Mar√ßo"},{valor:4,nome:"Abril"},{valor:5,nome:"Maio"},{valor:6,nome:"Junho"},{valor:7,nome:"Julho"},{valor:8,nome:"Agosto"},{valor:9,nome:"Setembro"},{valor:10,nome:"Outubro"},{valor:11,nome:"Novembro"},{valor:12,nome:"Dezembro"}];return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx("svg",{className:"w-8 h-8 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),"Auditoria Mensal ‚Äî Provis√£o √ó Realizado"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Compare valores provisionados com valores pagos para controle fiscal e trabalhista"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"M√™s"}),e.jsx("select",{value:n,onChange:w=>t(Number(w.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:k.map(w=>e.jsx("option",{value:w.valor,children:w.nome},w.valor))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ano"}),e.jsx("input",{type:"number",value:d,onChange:w=>o(Number(w.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"2026"})]}),e.jsx("div",{children:e.jsx("button",{onClick:f,disabled:g,className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),"Buscando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"Buscar"]})})})]})}),v&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-400 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Interpreta√ß√£o dos Status:"}),e.jsxs("div",{className:"mt-2 text-sm text-blue-700 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"‚úÖ OK:"})," Provis√£o igual ao realizado - situa√ß√£o perfeita"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"‚ö†Ô∏è AJUSTE:"})," Tem pagamento mas valores divergem - revisar"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"üïí ACUMULANDO:"})," Provisionado mas n√£o pago ainda - normal para f√©rias e 13¬∫"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"‚ûñ SEM DADOS:"})," Sem provis√£o e sem pagamento no per√≠odo"]})]})]})]})}),v&&e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Provis√£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Realizado"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Diferen√ßa"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"% Real."}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v.itens.map((w,x)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:w.item})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm text-gray-900",children:y(w.provisao)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:y(w.realizado)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:`text-sm font-medium ${w.diferenca===0?"text-green-600":w.diferenca>0?"text-blue-600":"text-red-600"}`,children:[w.diferenca>0&&"+",y(w.diferenca)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm text-gray-600",children:c(w.percentual_realizado)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:m(w.status,w.status_emoji)})]},x))}),e.jsx("tfoot",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:"TOTAL"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:y(v.total_provisao)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:y(v.total_realizado)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:`text-sm font-bold ${v.total_diferenca===0?"text-green-600":v.total_diferenca>0?"text-blue-600":"text-red-600"}`,children:[v.total_diferenca>0&&"+",y(v.total_diferenca)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:c(v.total_provisao>0?v.total_realizado/v.total_provisao*100:0)})}),e.jsx("td",{className:"px-6 py-4"})]})})]})})}),!g&&!v&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),e.jsx("p",{className:"text-gray-600",children:'Selecione um m√™s e ano e clique em "Buscar" para visualizar a auditoria'})]})]})}function mc(){const[s,n]=a.useState(3),[t,d]=a.useState([]),[o,g]=a.useState(null),[r,v]=a.useState(!1),j=["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];a.useEffect(()=>{f()},[s]);const f=async()=>{v(!0);try{const[k,w]=await Promise.all([F.get(`/projecao-caixa/?meses_a_frente=${s}`),F.get(`/projecao-caixa/resumo?meses_a_frente=${s}`)]);k.data.sucesso&&d(k.data.projecao||[]),w.data.sucesso&&g(w.data.resumo||null)}catch(k){console.error("Erro ao buscar proje√ß√£o:",k),Se.error("Erro ao carregar proje√ß√£o de caixa")}finally{v(!1)}},y=k=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(k),c=k=>{const w={POSITIVO:"bg-green-100 text-green-800",NEGATIVO:"bg-red-100 text-red-800",MISTO:"bg-yellow-100 text-yellow-800",NEUTRO:"bg-gray-100 text-gray-800"},x={POSITIVO:"üìà Todos os meses positivos",NEGATIVO:"üìâ Todos os meses negativos",MISTO:"‚ö†Ô∏è Meses positivos e negativos",NEUTRO:"‚ûñ Sem dados"};return e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${w[k]||w.NEUTRO}`,children:x[k]||x.NEUTRO})},m=k=>k>0?e.jsx("span",{className:"text-green-600 font-bold",children:y(k)}):k<0?e.jsx("span",{className:"text-red-600 font-bold",children:y(k)}):e.jsx("span",{className:"text-gray-600 font-bold",children:y(k)});return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"üí∞ Proje√ß√£o de Caixa"}),e.jsx("p",{className:"text-gray-600",children:"Proje√ß√£o futura baseada em hist√≥rico real + provis√µes obrigat√≥rias"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Projetar para:"}),e.jsxs("select",{value:s,onChange:k=>n(Number(k.target.value)),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:3,children:"3 meses"}),e.jsx("option",{value:6,children:"6 meses"}),e.jsx("option",{value:12,children:"12 meses"})]})]})}),o&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"üìä Resumo da Proje√ß√£o"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Receita Total Projetada"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:y(o.receita_total)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Despesas Totais Projetadas"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:y(o.despesas_totais)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Saldo Total Projetado"}),e.jsx("p",{className:`text-2xl font-bold ${o.saldo_total>=0?"text-green-600":"text-red-600"}`,children:y(o.saldo_total)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Meses Positivos / Negativos"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[e.jsx("span",{className:"text-green-600",children:o.meses_positivos})," / ",e.jsx("span",{className:"text-red-600",children:o.meses_negativos})]})]})]}),e.jsx("div",{className:"flex justify-center mt-4",children:c(o.tendencia)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"üìÖ Proje√ß√£o M√™s a M√™s"})}),r?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Calculando proje√ß√£o..."})]}):t.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"üìä Sem dados suficientes"}),e.jsx("p",{className:"text-sm",children:"√â necess√°rio ter pelo menos 3 meses de hist√≥rico para gerar proje√ß√µes."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"M√™s"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Receita Prevista"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Imposto Simples"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Folha + Encargos"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Despesas Totais"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Saldo Previsto"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(k=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[j[k.mes-1],"/",k.ano]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["+",k.mes_futuro," ",k.mes_futuro===1?"m√™s":"meses"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-green-600 font-semibold",children:y(k.receita_prevista)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-orange-600",children:y(k.imposto_simples_previsto)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-blue-600",children:y(k.folha_encargos_previstos)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-red-600",children:y(k.despesas_previstas)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:m(k.saldo_previsto)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:k.saldo_positivo?e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800",children:"‚úì Positivo"}):e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800",children:"‚ö† Negativo"})})]},k.mes_futuro))})]})})]}),e.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-900",children:e.jsx("strong",{children:"üí° Como funciona a proje√ß√£o:"})}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-800 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"M√©dia de receitas dos √∫ltimos 3 meses (valores reais)"}),e.jsx("li",{children:"M√©dia de despesas fixas (custos + operacionais)"}),e.jsx("li",{children:"Al√≠quota atual do Simples Nacional aplicada sobre receita projetada"}),e.jsx("li",{children:"Folha de pagamento + encargos (INSS + FGTS ~28%)"}),e.jsxs("li",{children:[e.jsx("strong",{children:"Sem chutes"})," ‚Äì Apenas dados reais + regras cont√°beis"]})]})]})]})}function uc(){const[s,n]=a.useState({salario_base:"",inss_percentual:"20",fgts_percentual:"8",meses:"6",cargo:""}),[t,d]=a.useState(null),[o,g]=a.useState(!1),[r,v]=a.useState(!0),j=["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],f=w=>{const{name:x,value:b}=w.target;n(u=>({...u,[x]:b}))},y=async w=>{if(w.preventDefault(),!s.salario_base||parseFloat(s.salario_base)<=0){Se.error("Informe um sal√°rio v√°lido");return}g(!0);try{const x={salario_base:parseFloat(s.salario_base),inss_percentual:parseFloat(s.inss_percentual),fgts_percentual:parseFloat(s.fgts_percentual),meses:parseInt(s.meses),cargo:s.cargo||null},b=await F.post("/simulacao-contratacao/",x);b.data.sucesso&&(d(b.data.simulacao),Se.success("Simula√ß√£o realizada com sucesso!"))}catch(x){console.error("Erro ao simular contrata√ß√£o:",x),Se.error("Erro ao realizar simula√ß√£o")}finally{g(!1)}},c=w=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(w),m=w=>new Intl.NumberFormat("pt-BR",{style:"percent",minimumFractionDigits:2,maximumFractionDigits:2}).format(w/100),k=()=>{d(null),n({salario_base:"",inss_percentual:"20",fgts_percentual:"8",meses:"6",cargo:""})};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"üßÆ Simula√ß√£o de Contrata√ß√£o"}),e.jsx("p",{className:"text-gray-600",children:"Calcule o impacto real de contratar um funcion√°rio no seu neg√≥cio"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"üìù Dados da Contrata√ß√£o"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cargo (opcional)"}),e.jsx("input",{type:"text",name:"cargo",value:s.cargo,onChange:f,placeholder:"Ex: Atendente, Veterin√°rio...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Sal√°rio Base ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"salario_base",value:s.salario_base,onChange:f,placeholder:"Ex: 2000.00",step:"0.01",min:"0",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"INSS Patronal (%)"}),e.jsx("input",{type:"number",name:"inss_percentual",value:s.inss_percentual,onChange:f,step:"0.01",min:"0",max:"100",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"FGTS (%)"}),e.jsx("input",{type:"number",name:"fgts_percentual",value:s.fgts_percentual,onChange:f,step:"0.01",min:"0",max:"100",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Simular por quantos meses?"}),e.jsxs("select",{name:"meses",value:s.meses,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"3",children:"3 meses"}),e.jsx("option",{value:"6",children:"6 meses"}),e.jsx("option",{value:"12",children:"12 meses (1 ano)"}),e.jsx("option",{value:"24",children:"24 meses (2 anos)"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:o,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed",children:o?"Calculando...":"üßÆ Simular Contrata√ß√£o"}),t&&e.jsx("button",{type:"button",onClick:k,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"üîÑ Nova Simula√ß√£o"})]})]})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"üìä Resumo Executivo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Custo Mensal M√©dio"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c(t.totais.media_mensal)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[m(t.analise.custo_total_vs_salario)," do sal√°rio base"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:["Custo Total (",t.parametros.meses_simulados," meses)"]}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:c(t.totais.total_geral)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Encargos Totais"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:c(t.totais.total_inss+t.totais.total_fgts)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[m(t.analise.percentual_encargos)," do sal√°rio"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Provis√µes Totais"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c(t.totais.total_provisao_ferias+t.totais.total_provisao_1_3+t.totais.total_provisao_13)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[m(t.analise.percentual_provisoes)," do sal√°rio"]})]})]}),e.jsx("div",{className:"mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-900",children:[e.jsx("strong",{children:"‚ö†Ô∏è Aten√ß√£o:"})," O custo real mensal √©"," ",e.jsx("strong",{children:c(t.totais.media_mensal)}),", n√£o apenas"," ",e.jsx("strong",{children:c(t.parametros.salario_base)}),". Isso representa um aumento de"," ",e.jsx("strong",{children:m(t.analise.custo_total_vs_salario-100)})," ","devido a encargos e provis√µes obrigat√≥rias."]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"üìÖ Detalhamento Mensal"}),e.jsx("button",{onClick:()=>v(!r),className:"text-sm text-blue-600 hover:text-blue-700",children:r?"‚ñº Ocultar detalhes":"‚ñ∂ Mostrar detalhes"})]}),r&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"M√™s"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sal√°rio"}),e.jsxs("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:["INSS (",t.parametros.inss_percentual,"%)"]}),e.jsxs("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:["FGTS (",t.parametros.fgts_percentual,"%)"]}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"F√©rias (1/12)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"1/3 Const."}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"13¬∫ (1/12)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Custo Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.resultado_mensal.map(w=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[j[w.mes_calendario-1],"/",w.ano]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:c(w.salario)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-orange-600",children:c(w.inss)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-blue-600",children:c(w.fgts)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-green-600",children:c(w.provisao_ferias)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-green-600",children:c(w.provisao_1_3)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-green-600",children:c(w.provisao_13)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-gray-900",children:c(w.custo_total)})]},w.mes))}),e.jsx("tfoot",{className:"bg-gray-100 font-bold",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:"TOTAL"}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-gray-900",children:c(t.totais.total_salarios)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-orange-600",children:c(t.totais.total_inss)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-blue-600",children:c(t.totais.total_fgts)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-green-600",children:c(t.totais.total_provisao_ferias)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-green-600",children:c(t.totais.total_provisao_1_3)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-green-600",children:c(t.totais.total_provisao_13)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-gray-900",children:c(t.totais.total_geral)})]})})]})})]}),e.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-900",children:e.jsx("strong",{children:"üí° Como funciona esta simula√ß√£o:"})}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-800 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Nada √© gravado no banco"})," - √© apenas uma proje√ß√£o"]}),e.jsx("li",{children:"Custos diretos: Sal√°rio + INSS patronal + FGTS"}),e.jsx("li",{children:"Provis√µes obrigat√≥rias: F√©rias (1/12) + 1/3 constitucional + 13¬∫ (1/12)"}),e.jsx("li",{children:"N√£o considera: Vale-transporte, Vale-refei√ß√£o, Plano de sa√∫de"}),e.jsx("li",{children:"Baseado nas mesmas regras do motor de provis√µes real"})]})]})]})]})}function pc(){const[s,n]=a.useState([]),[t,d]=a.useState(null),[o,g]=a.useState(!0),r=async()=>{try{g(!0);const c=await F.get("/cargos");n(c.data)}catch(c){console.error("Erro ao carregar cargos:",c),Se.error("Erro ao carregar cargos")}finally{g(!1)}};a.useEffect(()=>{r()},[]);const v=()=>{d({nome:"",descricao:"",salario_base:"",inss_patronal_percentual:20,fgts_percentual:8,gera_ferias:!0,gera_decimo_terceiro:!0,ativo:!0})},j=async()=>{var c,m;if(!t.nome||!t.salario_base){Se.error("Nome e sal√°rio s√£o obrigat√≥rios");return}try{t.id?(await F.put(`/cargos/${t.id}`,t),Se.success("Cargo atualizado com sucesso!")):(await F.post("/cargos",t),Se.success("Cargo cadastrado com sucesso!")),d(null),r()}catch(k){console.error("Erro ao salvar cargo:",k),Se.error(((m=(c=k.response)==null?void 0:c.data)==null?void 0:m.detail)||"Erro ao salvar cargo")}},f=async c=>{var m,k;try{await F.patch(`/cargos/${c.id}/status?ativo=${!c.ativo}`),Se.success(`Cargo ${c.ativo?"inativado":"ativado"} com sucesso!`),r()}catch(w){console.error("Erro ao alterar status:",w),Se.error(((k=(m=w.response)==null?void 0:m.data)==null?void 0:k.detail)||"Erro ao alterar status")}},y=c=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c);return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Cadastro de Cargos"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie cargos, defina sal√°rios e encargos que alimentam provis√µes, DRE e simula√ß√µes"})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("button",{className:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors flex items-center gap-2",onClick:v,children:[e.jsx("span",{className:"text-xl",children:"+"})," Novo Cargo"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sal√°rio Base"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"INSS %"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"FGTS %"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"F√©rias"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"13¬∫"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ativo"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(c=>e.jsxs("tr",{className:c.ativo?"":"bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:c.nome}),c.descricao&&e.jsx("div",{className:"text-sm text-gray-500",children:c.descricao})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium text-green-600",children:y(c.salario_base)}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[Number(c.inss_patronal_percentual).toFixed(2),"%"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[Number(c.fgts_percentual).toFixed(2),"%"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${c.gera_ferias?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:c.gera_ferias?"Sim":"N√£o"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${c.gera_decimo_terceiro?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:c.gera_decimo_terceiro?"Sim":"N√£o"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${c.ativo?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:c.ativo?"Sim":"N√£o"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:[e.jsx("button",{className:"text-indigo-600 hover:text-indigo-900 mr-4",onClick:()=>d(c),children:"Editar"}),e.jsx("button",{className:`${c.ativo?"text-yellow-600 hover:text-yellow-900":"text-green-600 hover:text-green-900"}`,onClick:()=>f(c),children:c.ativo?"Inativar":"Ativar"})]})]},c.id))})]}),s.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"Nenhum cargo cadastrado"})})]}),t&&e.jsxs("div",{className:"mt-6 bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800 mb-4",children:t.id?"Editar Cargo":"Novo Cargo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Cargo *"}),e.jsx("input",{type:"text",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Ex: Vendedor, Tosador, Gerente",value:t.nome,onChange:c=>d({...t,nome:c.target.value})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri√ß√£o"}),e.jsx("textarea",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Descri√ß√£o das responsabilidades...",rows:2,value:t.descricao,onChange:c=>d({...t,descricao:c.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sal√°rio Base (R$) *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"0.00",value:t.salario_base,onChange:c=>d({...t,salario_base:c.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"INSS Patronal (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",value:t.inss_patronal_percentual,onChange:c=>d({...t,inss_patronal_percentual:c.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"FGTS (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",value:t.fgts_percentual,onChange:c=>d({...t,fgts_percentual:c.target.value})})]}),e.jsxs("div",{className:"md:col-span-2 flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.gera_ferias,onChange:c=>d({...t,gera_ferias:c.target.checked}),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Gera f√©rias"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.gera_decimo_terceiro,onChange:c=>d({...t,gera_decimo_terceiro:c.target.checked}),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Gera 13¬∫"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.ativo,onChange:c=>d({...t,ativo:c.target.checked}),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Ativo"})]})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx("button",{className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors",onClick:j,children:"Salvar"}),e.jsx("button",{className:"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors",onClick:()=>d(null),children:"Cancelar"})]})]})]})}function gc({funcionario:s,onClose:n}){const[t,d]=a.useState(null),[o,g]=a.useState(!1),r=async()=>{const f=await oa.get(`/funcionarios/${s.id}/provisoes`);d(f.data)};a.useEffect(()=>{r()},[]);const v=async()=>{var f,y;if(window.confirm("Confirmar concess√£o de f√©rias?")){g(!0);try{const c=new Date,m={mes:c.getMonth()+1,ano:c.getFullYear(),dias_ferias:30,data_pagamento:null};await oa.post(`/funcionarios/${s.id}/ferias`,m),await r(),alert("F√©rias concedidas com sucesso")}catch(c){console.error("Erro ao conceder f√©rias:",c),alert(((y=(f=c.response)==null?void 0:f.data)==null?void 0:y.detail)||"Erro ao conceder f√©rias")}finally{g(!1)}}},j=async f=>{var y,c;if(window.confirm(`Confirmar pagamento da ${f}¬™ parcela do 13¬∫?`)){g(!0);try{const m=new Date,k={mes:m.getMonth()+1,ano:m.getFullYear(),percentual:f===1?50:100,descricao_parcela:f===1?"1¬™ Parcela":"2¬™ Parcela",data_pagamento:null};await oa.post(`/funcionarios/${s.id}/decimo-terceiro`,k),await r(),alert("13¬∫ registrado com sucesso")}catch(m){console.error("Erro ao pagar 13¬∫:",m),alert(((c=(y=m.response)==null?void 0:y.data)==null?void 0:c.detail)||"Erro ao pagar 13¬∫")}finally{g(!1)}}};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded p-6 w-[500px]",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Eventos ‚Äî ",s.nome]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Provis√µes"}),e.jsxs("p",{children:["F√©rias: R$ ",Number(t.ferias||0).toFixed(2)]}),e.jsxs("p",{children:["13¬∫: R$ ",Number(t.decimo_terceiro||0).toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{disabled:o,onClick:v,className:"w-full bg-blue-600 text-white py-2 rounded",children:"Conceder F√©rias"}),e.jsx("button",{disabled:o,onClick:()=>j(1),className:"w-full bg-green-600 text-white py-2 rounded",children:"Pagar 1¬™ Parcela do 13¬∫"}),e.jsx("button",{disabled:o,onClick:()=>j(2),className:"w-full bg-green-700 text-white py-2 rounded",children:"Pagar 2¬™ Parcela do 13¬∫"})]}),e.jsx("div",{className:"mt-4 text-right",children:e.jsx("button",{onClick:n,className:"text-gray-600 underline",children:"Fechar"})})]})}):null}function hc(){const[s,n]=a.useState([]),[t,d]=a.useState([]),[o,g]=a.useState(null),[r,v]=a.useState(""),[j,f]=a.useState("todos"),[y,c]=a.useState(null),m=async()=>{const i=await F.get("/funcionarios");n(i.data)},k=async()=>{const i=await F.get("/cargos");d(i.data.filter(p=>p.ativo))};a.useEffect(()=>{m(),k()},[]);const w=()=>{g({nome:"",cpf:"",email:"",telefone:"",cargo_id:"",ativo:!0})},x=async()=>{var p,l,C,h,_;if(!o.nome||!o.cargo_id){alert("Nome e cargo s√£o obrigat√≥rios");return}const i={nome:o.nome,cargo_id:Number(o.cargo_id),ativo:o.ativo,email:((p=o.email)==null?void 0:p.trim())||null,telefone:((l=o.telefone)==null?void 0:l.trim())||null,cpf:((C=o.cpf)==null?void 0:C.trim())||null};try{o.id?await F.put(`/funcionarios/${o.id}`,i):await F.post("/funcionarios",i),g(null),m()}catch(S){console.error("Erro ao salvar funcion√°rio:",S),alert(((_=(h=S.response)==null?void 0:h.data)==null?void 0:_.detail)||"Erro ao salvar funcion√°rio")}},b=async i=>{window.confirm("Deseja inativar este funcion√°rio?")&&(await F.delete(`/funcionarios/${i}`),m())},u=s.filter(i=>{const p=i.nome.toLowerCase().includes(r.toLowerCase())||(i.cpf||"").includes(r),l=j==="todos"||j==="ativos"&&i.ativo||j==="inativos"&&!i.ativo;return p&&l});return e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Funcion√°rios"}),e.jsxs("div",{className:"flex justify-between items-center mb-4 gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"border p-2 w-64",placeholder:"Buscar por nome ou CPF",value:r,onChange:i=>v(i.target.value)}),e.jsxs("select",{className:"border p-2 bg-white",value:j,onChange:i=>f(i.target.value),children:[e.jsx("option",{value:"todos",children:"Todos"}),e.jsx("option",{value:"ativos",children:"Ativos"}),e.jsx("option",{value:"inativos",children:"Inativos"})]})]}),e.jsx("button",{onClick:w,className:"bg-blue-600 text-white px-4 py-2 rounded",children:"+ Novo Funcion√°rio"})]}),e.jsxs("table",{className:"w-full border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Nome"}),e.jsx("th",{className:"border p-2",children:"Cargo"}),e.jsx("th",{className:"border p-2",children:"Sal√°rio"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"A√ß√µes"})]})}),e.jsx("tbody",{children:u.map(i=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2",children:i.nome}),e.jsx("td",{className:"border p-2",children:i.cargo?i.cargo.nome:"-"}),e.jsx("td",{className:"border p-2",children:i.cargo?`R$ ${Number(i.cargo.salario_base).toFixed(2)}`:"-"}),e.jsx("td",{className:"border p-2",children:i.ativo?"Ativo":"Inativo"}),e.jsxs("td",{className:"border p-2 space-x-2",children:[e.jsx("button",{className:"text-purple-600",onClick:()=>c(i),children:"Eventos"}),e.jsx("button",{className:"text-blue-600",onClick:()=>{var p;return g({...i,cargo_id:(p=i.cargo)==null?void 0:p.id})},children:"Editar"}),i.ativo&&e.jsx("button",{className:"text-red-600",onClick:()=>b(i.id),children:"Inativar"})]})]},i.id))})]}),o&&e.jsxs("div",{className:"border rounded p-4 mt-6",children:[e.jsx("h3",{className:"font-semibold mb-3",children:o.id?"Editar Funcion√°rio":"Novo Funcion√°rio"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{className:"border p-2",placeholder:"Nome",value:o.nome,onChange:i=>g({...o,nome:i.target.value})}),e.jsx("input",{className:"border p-2",placeholder:"CPF",value:o.cpf||"",onChange:i=>g({...o,cpf:i.target.value})}),e.jsx("input",{className:"border p-2",placeholder:"Email",value:o.email||"",onChange:i=>g({...o,email:i.target.value})}),e.jsx("input",{className:"border p-2",placeholder:"Telefone",value:o.telefone||"",onChange:i=>g({...o,telefone:i.target.value})}),e.jsxs("select",{className:"border p-2 col-span-2",value:o.cargo_id,onChange:i=>g({...o,cargo_id:i.target.value}),children:[e.jsx("option",{value:"",children:"Selecione o cargo"}),t.map(i=>e.jsx("option",{value:i.id,children:i.nome},i.id))]})]}),e.jsxs("div",{className:"mt-4 space-x-2",children:[e.jsx("button",{onClick:x,className:"bg-green-600 text-white px-4 py-2 rounded",children:"Salvar"}),e.jsx("button",{onClick:()=>g(null),className:"bg-gray-400 text-white px-4 py-2 rounded",children:"Cancelar"})]})]}),y&&e.jsx(gc,{funcionario:y,onClose:()=>c(null)})]})}function bc(){const[s,n]=a.useState(!0),[t,d]=a.useState([]),[o,g]=a.useState([]),[r,v]=a.useState(null),[j,f]=a.useState(!1);a.useEffect(()=>{y()},[]);async function y(){n(!0);try{const[w,x]=await Promise.all([oa.get("/rotas-entrega/vendas-pendentes/listar"),oa.get("/configuracoes/entregas").catch(()=>({data:null}))]);d(Array.isArray(w.data)?w.data:[]),v(x.data)}catch(w){console.error(w),alert("Erro ao carregar vendas pendentes"),d([])}finally{n(!1)}}async function c(){var b,u,i;if(t.length===0){alert("N√£o h√° vendas para otimizar");return}if(!r||!r.logradouro){alert("‚ö†Ô∏è Configure o endere√ßo da loja em Configura√ß√µes > Entregas antes de otimizar rotas");return}if(confirm(`‚ö†Ô∏è ATEN√á√ÉO - ESTA OPERA√á√ÉO TEM CUSTO!

üíµ Custo estimado: 5 centavos
üìç Entregas a otimizar: ${t.length}
üó∫Ô∏è Ser√° feita 1 chamada ao Google Maps API
üíæ A ordem ser√° salva no banco (n√£o cobra novamente)

Deseja continuar?`)){f(!0);try{console.log("üó∫Ô∏è Chamando endpoint de otimiza√ß√£o...");const p=await oa.post("/rotas-entrega/vendas-pendentes/otimizar");console.log("‚úÖ Resposta da otimiza√ß√£o:",p.data),alert(`‚úÖ ROTAS OTIMIZADAS COM SUCESSO!

${p.data.message}

Total otimizado: ${p.data.total_otimizado||t.length} entregas`),await y()}catch(p){console.error("‚ùå Erro ao otimizar:",p),console.error("Detalhes:",(b=p.response)==null?void 0:b.data);const l=((i=(u=p.response)==null?void 0:u.data)==null?void 0:i.detail)||"Erro ao otimizar rotas. Verifique se o Google Maps est√° configurado.";alert(`‚ùå ERRO AO OTIMIZAR ROTAS

${l}`)}finally{f(!1)}}}function m(w){g(x=>x.includes(w)?x.filter(b=>b!==w):[...x,w])}async function k(){var w,x;if(o.length===0){alert("Selecione pelo menos uma entrega");return}if(confirm(`Deseja criar uma rota com ${o.length} entrega(s)?`))try{n(!0);const b=t.filter(i=>o.includes(i.id)),u=b.filter(i=>!i.entregador_id);if(u.length>0){alert(`‚ùå As seguintes vendas n√£o t√™m entregador atribu√≠do:
${u.map(i=>i.numero_venda).join(", ")}

Atribua um entregador antes de criar a rota.`),n(!1);return}await oa.post("/rotas-entrega/",{vendas_ids:o,entregador_id:b[0].entregador_id,moto_da_loja:!1}),alert(`‚úÖ Rota criada com ${o.length} entrega(s)!

As entregas foram movidas para "Rotas de Entrega"`),g([]),y()}catch(b){console.error(b),alert(((x=(w=b.response)==null?void 0:w.data)==null?void 0:x.detail)||"Erro ao criar rota. Verifique se todas as entregas t√™m entregador atribu√≠do.")}finally{n(!1)}}return s?e.jsx("div",{className:"page",children:"Carregando..."}):e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"Entregas em Aberto"}),e.jsx("p",{style:{color:"#666",marginBottom:20},children:"Vendas com entrega que est√£o aguardando iniciar a rota"}),!Array.isArray(t)||t.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"‚úÖ N√£o h√° entregas pendentes"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:20,display:"flex",gap:10,alignItems:"center"},children:[e.jsx("button",{onClick:c,disabled:j||s,className:"btn-secondary",title:"Reorganizar entregas usando Google Maps para menor dist√¢ncia",children:j?"üîÑ Otimizando...":"üó∫Ô∏è Otimizar Rotas"}),e.jsxs("span",{style:{color:"#666",fontSize:"0.9em"},children:["‚ÑπÔ∏è ",t.filter(w=>w.ordem_otimizada).length>0?`${t.filter(w=>w.ordem_otimizada).length} entregas j√° otimizadas. `:"","Clique para ordenar pela rota mais eficiente"]})]}),e.jsxs("table",{className:"table-entregas",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:40},children:e.jsx("input",{type:"checkbox",checked:o.length===t.length&&t.length>0,onChange:w=>g(w.target.checked?t.map(x=>x.id):[])})}),e.jsx("th",{children:"Ordem"}),e.jsx("th",{children:"Venda"}),e.jsx("th",{children:"Data da Venda"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Entregador"}),e.jsx("th",{children:"Endere√ßo"}),e.jsx("th",{children:"Taxa Entrega"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:t.map((w,x)=>e.jsxs("tr",{style:{backgroundColor:o.includes(w.id)?"#e3f2fd":w.ordem_otimizada?"#f0f8ff":"white"},children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:o.includes(w.id),onChange:()=>m(w.id)})}),e.jsx("td",{children:e.jsxs("strong",{style:{color:w.ordem_otimizada?"#007bff":"#999",fontSize:"1.1em"},children:[x+1,w.ordem_otimizada&&" üó∫Ô∏è"]})}),e.jsx("td",{children:w.numero_venda}),e.jsx("td",{style:{fontSize:"0.9em"},children:w.data_venda?new Date(w.data_venda).toLocaleDateString("pt-BR"):"N/A"}),e.jsx("td",{children:w.cliente_nome}),e.jsx("td",{children:e.jsx("span",{style:{color:w.entregador_nome?"#28a745":"#999",fontWeight:w.entregador_nome?"600":"normal"},children:w.entregador_nome||"N√£o atribu√≠do"})}),e.jsx("td",{style:{maxWidth:300,fontSize:"0.9em"},children:w.endereco_entrega||"N/A"}),e.jsxs("td",{children:["R$ ",parseFloat(w.taxa_entrega||0).toFixed(2)]}),e.jsxs("td",{children:["R$ ",parseFloat(w.total||0).toFixed(2)]}),e.jsx("td",{children:e.jsx("span",{style:{padding:"4px 8px",borderRadius:4,fontSize:12,fontWeight:"bold",color:"#fff",backgroundColor:"#ffa500"},children:"AGUARDANDO"})})]},w.id))})]}),e.jsxs("div",{style:{marginTop:20,display:"flex",gap:10},children:[e.jsxs("button",{onClick:k,disabled:o.length===0||s,className:"btn-primary",style:{backgroundColor:o.length>0?"#28a745":"#ccc",cursor:o.length>0?"pointer":"not-allowed"},children:["‚úÖ Criar Rota (",o.length," selecionada",o.length!==1?"s":"",")"]}),e.jsx("span",{style:{color:"#666",fontSize:"0.9em",alignSelf:"center"},children:"üí° Selecione as entregas e clique para criar uma rota"})]})]})]})}function fc(){const s=fa(),[n,t]=a.useState([]),[d,o]=a.useState(!0),[g,r]=a.useState(""),[v,j]=a.useState(null);a.useEffect(()=>{f()},[g]);async function f(){try{o(!0);const p=new URLSearchParams;g&&p.append("status",g);const l=await F.get(`/rotas-entrega/?${p.toString()}`);t(l.data)}catch(p){console.error("Erro ao carregar rotas:",p),alert("Erro ao carregar rotas de entrega")}finally{o(!1)}}function y(p){j(v===p?null:p)}async function c(p,l){try{const C=l.map(h=>h.id);await F.put(`/rotas-entrega/${p}/paradas/reordenar`,C),t(h=>h.map(_=>_.id===p?{..._,paradas:l.map((S,$)=>({...S,ordem:$+1}))}:_)),alert("Ordem das paradas atualizada!")}catch(C){console.error("Erro ao reordenar paradas:",C),alert("Erro ao reordenar paradas")}}async function m(p){var C,h;if(!confirm("Deseja iniciar esta rota? Uma mensagem ser√° enviada ao primeiro cliente."))return;const l=prompt(`üèçÔ∏è Digite o KM atual da moto (opcional):

Deixe em branco se n√£o quiser registrar.`);try{const _={};l&&!isNaN(l)&&parseFloat(l)>0&&(_.km_inicial=parseFloat(l)),await F.post(`/rotas-entrega/${p}/iniciar`,null,{params:_}),alert("‚úÖ Rota iniciada! Mensagem enviada ao primeiro cliente."),f()}catch(_){console.error("Erro ao iniciar rota:",_);const S=((h=(C=_.response)==null?void 0:C.data)==null?void 0:h.detail)||"Erro ao iniciar rota";alert(`‚ùå ${S}`)}}async function k(p){var l,C;if(confirm(`‚ö†Ô∏è Tem certeza que deseja excluir esta rota?

As vendas voltar√£o para a listagem de entregas pendentes.`))try{const h=await F.delete(`/rotas-entrega/${p}`),{total_vendas:_}=h.data;alert(`‚úÖ Rota exclu√≠da com sucesso!
${_} venda(s) voltaram para entregas pendentes.`),f()}catch(h){console.error("Erro ao excluir rota:",h);const _=((C=(l=h.response)==null?void 0:l.data)==null?void 0:C.detail)||"Erro ao excluir rota";alert(`‚ùå ${_}`)}}async function w(p){var l,C;if(confirm(`‚Ü©Ô∏è Reverter in√≠cio desta rota?

A rota voltar√° para status pendente e voc√™ poder√° adicionar mais entregas.`))try{await F.post(`/rotas-entrega/${p}/reverter-inicio`),alert("‚úÖ Rota revertida para pendente! Agora voc√™ pode adicionar mais entregas."),f()}catch(h){console.error("Erro ao reverter rota:",h);const _=((C=(l=h.response)==null?void 0:l.data)==null?void 0:C.detail)||"Erro ao reverter in√≠cio da rota";alert(`‚ùå ${_}`)}}function x(p){if(!p.paradas||p.paradas.length===0)return null;const l=p.paradas[p.paradas.length-1];return l.tempo_acumulado?l.tempo_acumulado:null}function b(p){if(!p)return"N/A";const l=Math.floor(p/60),C=Math.floor(l/60),h=l%60;return C>0?`${C}h${h}min`:`${h}min`}function u(p){switch(p){case"pendente":return"#FFA500";case"em_andamento":return"#007BFF";case"em_rota":return"#007BFF";case"concluida":return"#28A745";case"cancelada":return"#DC3545";default:return"#6C757D"}}function i(p){switch(p){case"pendente":return"üü† Pendente";case"em_andamento":return"üîµ Em Andamento";case"em_rota":return"üîµ Em Rota";case"concluida":return"‚úÖ Conclu√≠da";case"cancelada":return"‚ùå Cancelada";default:return p}}return d?e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"Rotas de Entrega"}),e.jsx("p",{children:"Carregando rotas..."})]}):e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"Rotas de Entrega"}),e.jsx("p",{style:{color:"#666",marginBottom:20},children:"Rotas criadas e em andamento"}),e.jsxs("div",{style:{marginBottom:20,display:"flex",gap:10,alignItems:"center"},children:[e.jsxs("label",{children:["Filtrar por status:",e.jsxs("select",{value:g,onChange:p=>r(p.target.value),style:{marginLeft:10,padding:"5px 10px"},children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"pendente",children:"Pendente"}),e.jsx("option",{value:"em_andamento",children:"Em Andamento"}),e.jsx("option",{value:"concluida",children:"Conclu√≠da"}),e.jsx("option",{value:"cancelada",children:"Cancelada"})]})]}),e.jsx("button",{onClick:f,className:"btn-secondary",style:{marginLeft:"auto"},children:"üîÑ Atualizar"})]}),!Array.isArray(n)||n.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"Nenhuma rota encontrada"}),e.jsx("button",{onClick:()=>s("/entregas/abertas"),className:"btn-primary",style:{marginTop:10},children:"Criar Nova Rota"})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:15},children:n.map(p=>e.jsx(jc,{rota:p,expandida:v===p.id,onToggleExpand:()=>y(p.id),onReordenar:c,onIniciarRota:m,onExcluirRota:k,onReverterInicio:w,getStatusColor:u,getStatusLabel:i,calcularTempoEstimado:x,formatarTempo:b},p.id))})]})}function jc({rota:s,expandida:n,onToggleExpand:t,onReordenar:d,onIniciarRota:o,onExcluirRota:g,onReverterInicio:r,getStatusColor:v,getStatusLabel:j,calcularTempoEstimado:f,formatarTempo:y}){var B,N;const[c,m]=a.useState(s.paradas||[]),[k,w]=a.useState(null),[x,b]=a.useState(null),[u,i]=a.useState(null),[p,l]=a.useState(!1),[C,h]=a.useState(null),[_,S]=a.useState(null),[$,K]=a.useState(!1);a.useEffect(()=>{m(s.paradas||[])},[s.paradas]);const re=f(s),M=c.filter(O=>O.status!=="entregue").length,R=c.length>0&&M===0;async function J(O,z){var ae,W,ie;try{l(!0),b(O);const ee=await F.get(`/vendas/${z}`);console.log("üì¶ Detalhes da venda carregados:",ee.data),console.log("üìû Telefones do cliente:",{telefone:(ae=ee.data.cliente)==null?void 0:ae.telefone,celular:(W=ee.data.cliente)==null?void 0:W.celular,email:(ie=ee.data.cliente)==null?void 0:ie.email}),i(ee.data)}catch(ee){console.error("Erro ao carregar detalhes da venda:",ee),alert("Erro ao carregar detalhes da venda"),b(null)}finally{l(!1)}}function te(){b(null),i(null)}async function L(O,z){var W,ie;if(!confirm(`‚úÖ Confirmar entrega realizada?

Uma mensagem ser√° enviada automaticamente para o pr√≥ximo cliente da rota.`))return;const ae=prompt(`üèçÔ∏è Digite o KM atual da moto (opcional):

Deixe em branco se n√£o quiser registrar.`);try{h(O);const ee={};ae&&!isNaN(ae)&&parseFloat(ae)>0&&(ee.km_entrega=parseFloat(ae));const Q=await F.post(`/rotas-entrega/${z}/paradas/${O}/marcar-entregue`,null,{params:ee});alert("‚úÖ "+Q.data.message),m(de=>de.map(me=>me.id===O?{...me,status:"entregue",data_entrega:new Date().toISOString(),km_entrega:ae?parseFloat(ae):null}:me)),window.location.reload()}catch(ee){console.error("Erro ao marcar entrega:",ee);const Q=((ie=(W=ee.response)==null?void 0:W.data)==null?void 0:ie.detail)||"Erro ao marcar entrega como conclu√≠da";alert("‚ùå "+Q)}finally{h(null)}}async function Z(O,z){const ae=prompt(`üìã Digite a observa√ß√£o sobre esta entrega:

(Ex: 'Sempre entregar no vizinho', 'Chamar na casa da frente')`);if(!(!ae||ae.trim()===""))try{await F.put(`/rotas-entrega/${z}/paradas/${O}/observacao`,null,{params:{observacao:ae.trim()}}),alert("‚úÖ Observa√ß√£o salva com sucesso!"),m(W=>W.map(ie=>ie.id===O?{...ie,observacoes:ae.trim()}:ie))}catch(W){console.error("Erro ao salvar observa√ß√£o:",W),alert("‚ùå Erro ao salvar observa√ß√£o")}}async function A(O,z,ae){const W=prompt(`‚ö†Ô∏è Por que a entrega n√£o foi realizada?

(Ex: 'Cliente ausente', 'Cart√£o recusado', 'Endere√ßo n√£o encontrado')`);if(!(!W||W.trim()==="")&&confirm(`‚ö†Ô∏è Confirmar que a entrega N√ÉO foi realizada?

A venda voltar√° para entregas em aberto.`))try{S(O),await F.post(`/rotas-entrega/${z}/paradas/${O}/nao-entregue`,null,{params:{motivo:W.trim()}}),alert("‚úÖ Entrega marcada como n√£o realizada. Venda #"+ae+" voltou para entregas em aberto."),window.location.reload()}catch(ie){console.error("Erro ao marcar como n√£o entregue:",ie),alert("‚ùå Erro ao processar")}finally{S(null)}}async function G(O,z){var ee,Q;const ae=prompt(`üèçÔ∏è Digite o KM final da moto (opcional):

Deixe em branco se n√£o quiser registrar.`);let W=null;if(z&&ae&&!isNaN(ae)&&parseFloat(ae)>parseFloat(z)){const de=(parseFloat(ae)-parseFloat(z)).toFixed(2);confirm(`üìè Dist√¢ncia calculada: ${de} km

KM Inicial: ${z}
KM Final: ${ae}

Deseja usar esta dist√¢ncia?`)&&(W=parseFloat(de))}if(!W){const de=prompt(`üìè Digite a dist√¢ncia percorrida em km (opcional):

Deixe em branco se n√£o souber.`);de&&!isNaN(de)&&parseFloat(de)>0&&(W=parseFloat(de))}const ie=prompt("üìã Observa√ß√µes sobre a rota (opcional):")||"";if(confirm(`‚úÖ Finalizar esta rota?

Esta a√ß√£o n√£o pode ser desfeita.`))try{K(!0);const de={observacoes:ie.trim()};ae&&!isNaN(ae)&&parseFloat(ae)>0&&(de.km_final=parseFloat(ae)),W&&(de.distancia_real=W),await F.post(`/rotas-entrega/${O}/fechar`,de),alert("‚úÖ Rota finalizada com sucesso!"),window.location.reload()}catch(de){console.error("Erro ao finalizar rota:",de);const me=((Q=(ee=de.response)==null?void 0:ee.data)==null?void 0:Q.detail)||"Erro ao finalizar rota";alert("‚ùå "+me)}finally{K(!1)}}const E=(O,z)=>{w(z),O.dataTransfer.effectAllowed="move"},P=(O,z)=>{if(O.preventDefault(),k===null||k===z)return;const ae=[...c],W=ae[k];ae.splice(k,1),ae.splice(z,0,W),m(ae),w(z)},H=()=>{k!==null&&d(s.id,c),w(null)};return e.jsxs("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:15,backgroundColor:"#fff"},children:[e.jsxs("div",{style:{cursor:"pointer",transition:"all 0.2s"},onClick:t,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("h3",{style:{margin:0,marginBottom:10},children:["üöö ",s.numero||`Rota #${s.id}`,n?" üîΩ":" ‚ñ∂Ô∏è"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5,color:"#555"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Entregador:"})," ",((B=s.entregador)==null?void 0:B.nome)||"N√£o informado"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Paradas:"})," ",((N=s.paradas)==null?void 0:N.length)||0," entrega(s)"]}),s.distancia_prevista&&e.jsxs("div",{children:[e.jsx("strong",{children:"Dist√¢ncia Prevista:"})," ",s.distancia_prevista," km"]}),re&&e.jsxs("div",{children:[e.jsx("strong",{children:"Tempo Estimado:"})," ",y(re)]}),s.km_inicial&&e.jsxs("div",{children:[e.jsx("strong",{children:"üèÅ KM Inicial:"})," ",parseFloat(s.km_inicial).toFixed(1)," km"]}),s.km_final&&e.jsxs("div",{children:[e.jsx("strong",{children:"üèÅ KM Final:"})," ",parseFloat(s.km_final).toFixed(1)," km"]}),s.km_inicial&&s.km_final&&e.jsxs("div",{style:{color:"#007BFF",fontWeight:"600"},children:[e.jsx("strong",{children:"üìè Total Rodado:"})," ",(parseFloat(s.km_final)-parseFloat(s.km_inicial)).toFixed(1)," km",s.distancia_prevista&&(()=>{const O=parseFloat(s.km_final)-parseFloat(s.km_inicial),z=parseFloat(s.distancia_prevista),ae=O-z,W=(ae/z*100).toFixed(1);return e.jsxs("span",{style:{marginLeft:10,color:ae>0?"#DC3545":"#28A745",fontSize:13},children:["(",ae>0?"+":"",ae.toFixed(1)," km / ",W>0?"+":"",W,"% vs projetado)"]})})()]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Criada em:"})," ",new Date(s.created_at).toLocaleString("pt-BR")]}),s.data_conclusao&&e.jsxs("div",{children:[e.jsx("strong",{children:"Conclu√≠da em:"})," ",new Date(s.data_conclusao).toLocaleString("pt-BR")]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[s.status==="pendente"&&e.jsx("button",{onClick:O=>{O.stopPropagation(),o(s.id)},style:{padding:"8px 16px",backgroundColor:"#28A745",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontWeight:"bold",fontSize:14,display:"flex",alignItems:"center",gap:5},children:"üöÄ Iniciar Rota"}),(s.status==="em_rota"||s.status==="em_andamento")&&R&&e.jsx("button",{onClick:O=>{O.stopPropagation(),G(s.id,s.km_inicial)},disabled:$,style:{padding:"8px 16px",backgroundColor:$?"#ccc":"#007BFF",color:"#fff",border:"none",borderRadius:6,cursor:$?"not-allowed":"pointer",fontWeight:"bold",fontSize:14,display:"flex",alignItems:"center",gap:5},children:$?"‚è≥ Processando...":"‚úÖ Finalizar Rota"}),(s.status==="em_rota"||s.status==="em_andamento")&&M===c.length&&e.jsx("button",{onClick:O=>{O.stopPropagation(),r(s.id)},style:{padding:"8px 16px",backgroundColor:"#FFC107",color:"#000",border:"none",borderRadius:6,cursor:"pointer",fontWeight:"bold",fontSize:14,display:"flex",alignItems:"center",gap:5},children:"‚Ü©Ô∏è Reverter In√≠cio"}),(s.status==="pendente"||s.status==="em_rota"||s.status==="em_andamento")&&e.jsx("button",{onClick:O=>{O.stopPropagation(),g(s.id)},style:{padding:"8px 16px",backgroundColor:"#DC3545",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontWeight:"bold",fontSize:14,display:"flex",alignItems:"center",gap:5},children:"üóëÔ∏è Excluir"}),e.jsx("div",{style:{padding:"5px 15px",borderRadius:20,backgroundColor:v(s.status),color:"#fff",fontWeight:"bold",fontSize:14,whiteSpace:"nowrap"},children:j(s.status)})]})]}),s.observacoes&&e.jsxs("div",{style:{marginTop:10,padding:10,backgroundColor:"#f8f9fa",borderRadius:5,fontSize:14,color:"#666"},children:[e.jsx("strong",{children:"Observa√ß√µes:"})," ",s.observacoes]})]}),n&&c.length>0&&e.jsxs("div",{style:{marginTop:20,borderTop:"2px solid #eee",paddingTop:15},children:[e.jsx("h4",{style:{marginBottom:15},children:"üìç Paradas da Rota (arraste para reordenar)"}),c.map((O,z)=>{var ae,W,ie,ee;return e.jsxs("div",{children:[e.jsxs("div",{draggable:!0,onDragStart:Q=>E(Q,z),onDragOver:Q=>P(Q,z),onDragEnd:H,style:{padding:12,marginBottom:10,border:"1px solid #ddd",borderRadius:6,backgroundColor:k===z?"#f0f8ff":"#fafafa",cursor:"move",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:5},children:[e.jsxs("span",{style:{fontWeight:"bold",marginRight:10,fontSize:18,color:"#007BFF"},children:[O.ordem,"¬∫"]}),e.jsxs("span",{style:{color:"#666",fontSize:14},children:["Venda #",O.venda_id]}),O.status&&e.jsx("span",{style:{marginLeft:10,padding:"2px 8px",borderRadius:12,fontSize:12,backgroundColor:O.status==="entregue"?"#d4edda":O.status==="tentativa"?"#fff3cd":"#e2e3e5",color:O.status==="entregue"?"#155724":O.status==="tentativa"?"#856404":"#383d41"},children:O.status==="entregue"?"‚úì Entregue":O.status==="tentativa"?"‚ö† Tentativa":"Pendente"})]}),e.jsxs("div",{style:{fontSize:13,color:"#333",lineHeight:1.6},children:[O.cliente_nome&&e.jsxs("div",{style:{marginBottom:4},children:[e.jsxs("strong",{style:{color:"#1565C0"},children:["üë§ ",O.cliente_nome]}),O.cliente_telefone&&e.jsxs("span",{style:{marginLeft:12,color:"#555"},children:["üìû ",O.cliente_telefone]}),O.cliente_celular&&e.jsxs("span",{style:{marginLeft:12,color:"#555"},children:["üì± ",O.cliente_celular]})]}),e.jsxs("div",{style:{color:"#555"},children:["üìç ",O.endereco,O.distancia_acumulada&&e.jsxs("span",{style:{marginLeft:12,color:"#777"},children:["‚Ä¢ Dist: ",O.distancia_acumulada," km"]}),O.tempo_acumulado&&e.jsxs("span",{style:{marginLeft:12,color:"#777"},children:["‚Ä¢ Tempo aprox: ",y(O.tempo_acumulado)]})]})]}),O.data_entrega&&e.jsxs("div",{style:{color:"#28a745",fontSize:12,marginTop:3},children:["‚úì Entregue em: ",new Date(O.data_entrega).toLocaleString("pt-BR")]}),O.observacoes&&e.jsxs("div",{style:{marginTop:6,padding:6,backgroundColor:"#fff3cd",borderRadius:4,fontSize:12,color:"#856404",border:"1px solid #ffc107"},children:["üìã ",O.observacoes]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,alignItems:"flex-end"},children:[O.status!=="entregue"&&s.status==="em_rota"&&e.jsx("button",{onClick:Q=>{Q.stopPropagation(),L(O.id,s.id)},disabled:C===O.id,style:{padding:"8px 12px",backgroundColor:C===O.id?"#ccc":"#28A745",color:"#fff",border:"none",borderRadius:6,cursor:C===O.id?"not-allowed":"pointer",fontWeight:"600",fontSize:12,whiteSpace:"nowrap",width:"130px",textAlign:"center"},children:C===O.id?"‚è≥...":"‚úÖ Entregue"}),O.status!=="entregue"&&(s.status==="em_rota"||s.status==="em_andamento")&&e.jsx("button",{onClick:Q=>{Q.stopPropagation(),A(O.id,s.id,O.venda_id)},disabled:_===O.id,style:{padding:"8px 12px",backgroundColor:_===O.id?"#ccc":"#FFC107",color:"#000",border:"none",borderRadius:6,cursor:_===O.id?"not-allowed":"pointer",fontWeight:"600",fontSize:12,whiteSpace:"nowrap",width:"130px",textAlign:"center"},children:_===O.id?"‚è≥...":"‚ö†Ô∏è Falta Entregar"}),e.jsx("button",{onClick:Q=>{Q.stopPropagation(),Z(O.id,s.id)},style:{padding:"8px 12px",backgroundColor:"#6C757D",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:"600",whiteSpace:"nowrap",width:"130px",textAlign:"center"},children:"üìù Observa√ß√£o"}),e.jsx("button",{onClick:Q=>{Q.stopPropagation(),x===O.id?te():J(O.id,O.venda_id)},style:{padding:"8px 12px",backgroundColor:"#17A2B8",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:"600",whiteSpace:"nowrap",width:"130px",textAlign:"center"},children:"üìÑ Detalhes"})]})]}),x===O.id&&e.jsx("div",{style:{marginTop:0,marginBottom:15,padding:15,backgroundColor:"#f8f9fa",borderRadius:8,border:"2px solid #007BFF",boxShadow:"0 2px 8px rgba(0,123,255,0.2)"},children:p?e.jsx("div",{style:{textAlign:"center",color:"#666",padding:20},children:"Carregando detalhes da venda..."}):u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:15,borderBottom:"2px solid #007BFF",paddingBottom:10},children:[e.jsxs("h4",{style:{margin:0,color:"#007BFF"},children:["üßæ Detalhes da Venda #",u.id]}),e.jsx("button",{onClick:Q=>{Q.stopPropagation(),te()},style:{background:"#dc3545",color:"#fff",border:"none",borderRadius:4,padding:"6px 12px",cursor:"pointer",fontWeight:"bold",fontSize:13},children:"‚úï Fechar"})]}),e.jsx("div",{style:{backgroundColor:"#e7f3ff",padding:12,borderRadius:6,marginBottom:15,border:"1px solid #007BFF"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,fontSize:14},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"üë§ Cliente:"})," ",((ae=u.cliente)==null?void 0:ae.nome)||u.nome_cliente||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"üìÖ Data:"})," ",u.data_venda?new Date(u.data_venda).toLocaleString("pt-BR"):"N/A"]}),((W=u.cliente)==null?void 0:W.telefone)&&e.jsxs("div",{children:[e.jsx("strong",{children:"üìû Telefone:"})," ",u.cliente.telefone]}),((ie=u.cliente)==null?void 0:ie.celular)&&e.jsxs("div",{children:[e.jsx("strong",{children:"üì± Celular:"})," ",u.cliente.celular]}),((ee=u.cliente)==null?void 0:ee.email)&&e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("strong",{children:"üìß Email:"})," ",u.cliente.email]})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,fontSize:14,marginBottom:15},children:[e.jsxs("div",{style:{padding:10,backgroundColor:"#d4edda",borderRadius:4,border:"1px solid #28a745"},children:[e.jsx("div",{style:{fontSize:11,color:"#155724",marginBottom:3},children:"VALOR TOTAL"}),e.jsxs("div",{style:{fontWeight:"bold",fontSize:16,color:"#155724"},children:["R$ ",parseFloat(u.valor_total||u.total||0).toFixed(2)]})]}),e.jsxs("div",{style:{padding:10,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[e.jsx("div",{style:{fontSize:11,color:"#666",marginBottom:3},children:"PAGAMENTO"}),e.jsx("div",{style:{fontWeight:"bold",fontSize:14},children:u.forma_pagamento||"N/A"})]}),e.jsxs("div",{style:{padding:10,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[e.jsx("div",{style:{fontSize:11,color:"#666",marginBottom:3},children:"STATUS"}),e.jsx("div",{style:{fontWeight:"bold",fontSize:14},children:u.status_pagamento||"N/A"})]})]}),u.endereco_entrega&&e.jsxs("div",{style:{padding:12,backgroundColor:"#e3f2fd",borderRadius:6,marginBottom:15,border:"1px solid #2196F3"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:5,color:"#1976D2"},children:"üìç Endere√ßo de Entrega"}),e.jsx("div",{style:{color:"#424242",fontSize:14},children:u.endereco_entrega})]}),u.observacoes&&e.jsxs("div",{style:{padding:12,backgroundColor:"#fff3cd",borderRadius:6,marginBottom:15,border:"1px solid #ffc107"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:5,color:"#f57c00"},children:"üí¨ Observa√ß√µes"}),e.jsx("div",{style:{color:"#424242",fontSize:14},children:u.observacoes})]}),u.itens&&u.itens.length>0&&e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold",fontSize:15,marginBottom:10,color:"#424242"},children:["üõí Itens da Venda (",u.itens.length,")"]}),e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:6,border:"1px solid #ddd",overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[u.itens.map((Q,de)=>{var me,Pe,se,_e;return e.jsxs("div",{style:{padding:12,borderBottom:de<u.itens.length-1?"1px solid #eee":"none",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:de%2===0?"#fafafa":"#fff"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"600",marginBottom:3,color:"#333"},children:((me=Q.produto)==null?void 0:me.nome)||((Pe=Q.servico)==null?void 0:Pe.nome)||Q.produto_nome||Q.servico_descricao||"Item"}),(((se=Q.produto)==null?void 0:se.codigo)||Q.produto_codigo)&&e.jsxs("div",{style:{fontSize:12,color:"#999"},children:["C√≥d: ",((_e=Q.produto)==null?void 0:_e.codigo)||Q.produto_codigo]})]}),e.jsxs("div",{style:{textAlign:"right",minWidth:120},children:[e.jsxs("div",{style:{color:"#666",fontSize:13,marginBottom:2},children:[Q.quantidade," √ó R$ ",parseFloat(Q.valor_unitario||Q.preco_unitario||0).toFixed(2)]}),e.jsxs("div",{style:{fontSize:15,color:"#28a745",fontWeight:"bold"},children:["R$ ",parseFloat((Q.quantidade||0)*(Q.valor_unitario||Q.preco_unitario||0)).toFixed(2)]})]})]},de)}),e.jsxs("div",{style:{padding:14,backgroundColor:"#1976D2",display:"flex",justifyContent:"space-between",alignItems:"center",color:"#fff"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:16},children:"TOTAL DA VENDA"}),e.jsxs("span",{style:{fontWeight:"bold",fontSize:18},children:["R$ ",parseFloat(u.valor_total||u.total||0).toFixed(2)]})]})]})]})]}):null})]},O.id)})]})]})}function vc(){const[s,n]=a.useState([]),[t,d]=a.useState(!0),[o,g]=a.useState(null);a.useEffect(()=>{r()},[]);async function r(){try{d(!0);const j=await F.get("/rotas-entrega/?status=concluida");n(j.data)}catch(j){console.error("Erro ao carregar hist√≥rico:",j),alert("Erro ao carregar hist√≥rico de entregas")}finally{d(!1)}}function v(j){g(o===j?null:j)}return t?e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"üìú Hist√≥rico de Entregas"}),e.jsx("p",{children:"Carregando hist√≥rico..."})]}):e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"üìú Hist√≥rico de Entregas"}),e.jsx("p",{style:{color:"#666",marginBottom:20},children:"Rotas finalizadas e conferidas"}),e.jsx("div",{style:{marginBottom:20,display:"flex",gap:10,alignItems:"center"},children:e.jsx("button",{onClick:r,className:"btn-secondary",style:{marginLeft:"auto"},children:"üîÑ Atualizar"})}),!Array.isArray(s)||s.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"Nenhuma rota finalizada encontrada"})}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:15},children:s.map(j=>{var f,y;return e.jsxs("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:15,backgroundColor:"#fff"},children:[e.jsx("div",{style:{cursor:"pointer"},onClick:()=>v(j.id),children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("h3",{style:{margin:0,marginBottom:10},children:["üöö ",j.numero||`Rota #${j.id}`,o===j.id?" üîΩ":" ‚ñ∂Ô∏è"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:10,color:"#555",fontSize:14},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Entregador:"})," ",((f=j.entregador)==null?void 0:f.nome)||"N√£o informado"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Paradas:"})," ",((y=j.paradas)==null?void 0:y.length)||0," entrega(s)"]}),j.distancia_prevista&&e.jsxs("div",{children:[e.jsx("strong",{children:"üìç Previsto:"})," ",parseFloat(j.distancia_prevista).toFixed(1)," km"]}),j.km_inicial&&e.jsxs("div",{children:[e.jsx("strong",{children:"üèÅ KM Inicial:"})," ",parseFloat(j.km_inicial).toFixed(1)]}),j.km_final&&e.jsxs("div",{children:[e.jsx("strong",{children:"üèÅ KM Final:"})," ",parseFloat(j.km_final).toFixed(1)]}),j.km_inicial&&j.km_final&&e.jsxs("div",{style:{color:"#007BFF",fontWeight:"600"},children:[e.jsx("strong",{children:"üìè Total:"})," ",(parseFloat(j.km_final)-parseFloat(j.km_inicial)).toFixed(1)," km",j.distancia_prevista&&(()=>{const c=parseFloat(j.km_final)-parseFloat(j.km_inicial),m=parseFloat(j.distancia_prevista),k=c-m,w=(k/m*100).toFixed(1);return e.jsxs("div",{style:{fontSize:12,color:k>0?"#DC3545":"#28A745",marginTop:2},children:[k>0?"‚Üë":"‚Üì"," ",Math.abs(k).toFixed(1)," km (",k>0?"+":"",w,"%)"]})})()]}),j.distancia_real&&!(j.km_inicial&&j.km_final)&&e.jsxs("div",{children:[e.jsx("strong",{children:"Dist√¢ncia:"})," ",parseFloat(j.distancia_real).toFixed(1)," km"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Conclu√≠da em:"})," ",new Date(j.data_conclusao).toLocaleString("pt-BR")]}),j.custo_real&&e.jsxs("div",{children:[e.jsx("strong",{children:"Custo:"})," R$ ",parseFloat(j.custo_real).toFixed(2)]})]}),j.observacoes&&e.jsxs("div",{style:{marginTop:10,padding:10,backgroundColor:"#f8f9fa",borderRadius:5,fontSize:14,color:"#666"},children:[e.jsx("strong",{children:"Observa√ß√µes:"})," ",j.observacoes]})]}),e.jsx("div",{style:{padding:"5px 15px",borderRadius:20,backgroundColor:"#28A745",color:"#fff",fontWeight:"bold",fontSize:14,whiteSpace:"nowrap"},children:"‚úÖ Conclu√≠da"})]})}),o===j.id&&j.paradas&&j.paradas.length>0&&e.jsxs("div",{style:{marginTop:20,borderTop:"2px solid #eee",paddingTop:15},children:[e.jsx("h4",{style:{marginBottom:15},children:"üìç Entregas da Rota"}),j.paradas.map(c=>e.jsx("div",{style:{padding:12,marginBottom:10,border:"1px solid #ddd",borderRadius:6,backgroundColor:c.status==="entregue"?"#f0fff4":"#fafafa"},children:e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:5},children:[e.jsxs("span",{style:{fontWeight:"bold",marginRight:10,fontSize:18,color:"#007BFF"},children:[c.ordem,"¬∫"]}),e.jsxs("span",{style:{color:"#666",fontSize:14},children:["Venda #",c.venda_id]}),e.jsx("span",{style:{marginLeft:10,padding:"2px 8px",borderRadius:12,fontSize:12,backgroundColor:c.status==="entregue"?"#d4edda":"#e2e3e5",color:c.status==="entregue"?"#155724":"#383d41"},children:c.status==="entregue"?"‚úì Entregue":c.status})]}),e.jsxs("div",{style:{fontSize:13,color:"#333",lineHeight:1.6},children:[c.cliente_nome&&e.jsxs("div",{style:{marginBottom:4},children:[e.jsxs("strong",{style:{color:"#1565C0"},children:["üë§ ",c.cliente_nome]}),c.cliente_telefone&&e.jsxs("span",{style:{marginLeft:12,color:"#555"},children:["üìû ",c.cliente_telefone]}),c.cliente_celular&&e.jsxs("span",{style:{marginLeft:12,color:"#555"},children:["üì± ",c.cliente_celular]})]}),e.jsxs("div",{style:{color:"#555"},children:["üìç ",c.endereco,c.distancia_acumulada&&e.jsxs("span",{style:{marginLeft:12,color:"#777"},children:["‚Ä¢ Dist: ",c.distancia_acumulada," km"]}),c.km_entrega&&e.jsxs("span",{style:{marginLeft:12,color:"#777"},children:["‚Ä¢ KM: ",c.km_entrega]})]})]}),c.data_entrega&&e.jsxs("div",{style:{color:"#28a745",fontSize:12,marginTop:3},children:["‚úì Entregue em: ",new Date(c.data_entrega).toLocaleString("pt-BR")]}),c.observacoes&&e.jsxs("div",{style:{marginTop:6,padding:6,backgroundColor:"#fff3cd",borderRadius:4,fontSize:12,color:"#856404",border:"1px solid #ffc107"},children:["üìã ",c.observacoes]})]})})},c.id))]})]},j.id)})})]})}function yc(){const[s,n]=a.useState(""),[t,d]=a.useState(""),[o,g]=a.useState(null),[r,v]=a.useState(null),[j,f]=a.useState(null),[y,c]=a.useState(!1),[m,k]=a.useState(null);async function w(){var b,u;if(!s||!t){k("Selecione o per√≠odo para consulta");return}c(!0),k(null);try{const[i,p,l]=await Promise.all([F.get("/dashboard/entregas/financeiro",{params:{data_inicio:s,data_fim:t}}),F.get("/dashboard/entregas/financeiro/graficos",{params:{data_inicio:s,data_fim:t}}),F.get("/dashboard/entregas/financeiro/ia",{params:{data_inicio:s,data_fim:t}}).catch(()=>null)]);g(i.data),v(p.data),f((l==null?void 0:l.data)||{alertas:[],sugestoes:[]})}catch(i){console.error("Erro ao carregar dados:",i),k(((u=(b=i.response)==null?void 0:b.data)==null?void 0:u.detail)||"Erro ao carregar dados do dashboard")}finally{c(!1)}}a.useEffect(()=>{const b=new Date,u=new Date(b.getFullYear(),b.getMonth(),1);n(u.toISOString().slice(0,10)),d(b.toISOString().slice(0,10))},[]),a.useEffect(()=>{s&&t&&w()},[s,t]);const x=()=>{if(!o||o.total_entregas===0)return null;const b=o.margem_media,u=b>=0?"text-green-600":"text-red-600",i=b>=0?"‚úÖ":"‚ö†Ô∏è";return e.jsxs("div",{className:`p-4 border rounded-lg ${b>=0?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:i}),e.jsx("h3",{className:"font-semibold text-gray-700",children:"An√°lise de Margem"})]}),e.jsx("p",{className:`text-sm ${u}`,children:b>=0?e.jsxs(e.Fragment,{children:["A taxa de entrega est√° ",e.jsx("strong",{children:"cobrindo os custos"})," com uma margem m√©dia de ",e.jsx("strong",{children:Ps(b)})," por entrega."]}):e.jsxs(e.Fragment,{children:["‚ö†Ô∏è A taxa de entrega est√° ",e.jsx("strong",{children:"abaixo dos custos"}),". D√©ficit m√©dio de ",e.jsx("strong",{children:Ps(Math.abs(b))})," por entrega."]})})]})};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(at,{className:"text-blue-600"}),"Dashboard Financeiro de Entregas"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Visualize os custos e receitas das entregas realizadas no per√≠odo"})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Per√≠odo:"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"De:"}),e.jsx("input",{type:"date",value:s,onChange:b=>n(b.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"At√©:"}),e.jsx("input",{type:"date",value:t,onChange:b=>d(b.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("button",{onClick:w,disabled:y,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(Nt,{className:y?"animate-spin":""}),y?"Carregando...":"Atualizar"]})]})}),m&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6 flex items-center gap-2",children:[e.jsx(_a,{}),e.jsx("span",{children:m})]}),y&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(Do,{}),e.jsx(Do,{})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((b,u)=>e.jsx(Nc,{},u))}),e.jsx(hr,{}),e.jsx(hr,{}),e.jsx(hr,{})]}),!y&&o&&e.jsxs(e.Fragment,{children:[j&&j.alertas&&j.alertas.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(vt,{className:"text-yellow-600"}),"Alertas Autom√°ticos"]}),e.jsx("div",{className:"space-y-3",children:j.alertas.map((b,u)=>e.jsx("div",{className:"p-4 border border-yellow-200 bg-yellow-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700",children:b})},u))})]}),j&&j.sugestoes&&j.sugestoes.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"üí°"}),"Sugest√µes Pr√°ticas"]}),e.jsx("div",{className:"space-y-3",children:j.sugestoes.map((b,u)=>e.jsx("div",{className:"p-4 border border-blue-200 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700",children:b})},u))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[e.jsx(Zs,{titulo:"Total de Entregas",valor:o.total_entregas,icon:e.jsx(at,{className:"text-blue-600"}),colorClasse:"border-blue-200 bg-blue-50"}),e.jsx(Zs,{titulo:"Custo Total",valor:Ps(o.custo_total_entregas),icon:e.jsx(Ga,{className:"text-red-600"}),colorClasse:"border-red-200 bg-red-50",subtitulo:"Entregadores + Moto"}),e.jsx(Zs,{titulo:"Custo Entregadores",valor:Ps(o.custo_total_entregadores),icon:e.jsx(ds,{className:"text-purple-600"}),colorClasse:"border-purple-200 bg-purple-50"}),e.jsx(Zs,{titulo:"Custo da Moto",valor:Ps(o.custo_total_moto),icon:e.jsx(Zn,{className:"text-orange-600"}),colorClasse:"border-orange-200 bg-orange-50"}),e.jsx(Zs,{titulo:"Repasse aos Entregadores",valor:Ps(o.total_repasse_taxa),icon:e.jsx(er,{className:"text-green-600"}),colorClasse:"border-green-200 bg-green-50"}),e.jsx(Zs,{titulo:"Custo M√©dio por Entrega",valor:Ps(o.custo_medio_por_entrega),icon:e.jsx(cr,{className:"text-indigo-600"}),colorClasse:"border-indigo-200 bg-indigo-50"})]}),x(),r&&e.jsxs("div",{className:"space-y-6 mt-6",children:[r.por_dia&&r.por_dia.length>0&&e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"üìà Custo Total por Dia"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:'Responde: "Estou gastando mais?"'}),e.jsx(qa,{width:"100%",height:300,children:e.jsxs(ct,{data:r.por_dia,children:[e.jsx(Ba,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:"data",tick:{fontSize:12},tickFormatter:b=>{const[u,i,p]=b.split("-");return`${p}/${i}`}}),e.jsx(Ta,{tick:{fontSize:12}}),e.jsx(Aa,{formatter:b=>`R$ ${Number(b).toFixed(2)}`,labelFormatter:b=>{const[u,i,p]=b.split("-");return`${p}/${i}/${u}`}}),e.jsx(Va,{}),e.jsx(ls,{type:"monotone",dataKey:"custo",stroke:"#ef4444",strokeWidth:2,name:"Custo Total (R$)"})]})})]}),r.custo_medio&&r.custo_medio.length>0&&e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"üìâ Custo M√©dio por Entrega"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:'Responde: "Entregar est√° ficando caro?"'}),e.jsx(qa,{width:"100%",height:300,children:e.jsxs(ct,{data:r.custo_medio,children:[e.jsx(Ba,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:"data",tick:{fontSize:12},tickFormatter:b=>{const[u,i,p]=b.split("-");return`${p}/${i}`}}),e.jsx(Ta,{tick:{fontSize:12}}),e.jsx(Aa,{formatter:b=>`R$ ${Number(b).toFixed(2)}`,labelFormatter:b=>{const[u,i,p]=b.split("-");return`${p}/${i}/${u}`}}),e.jsx(Va,{}),e.jsx(ls,{type:"monotone",dataKey:"valor",stroke:"#8b5cf6",strokeWidth:2,name:"Custo M√©dio (R$)"})]})})]}),r.taxa_vs_custo&&e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"üìä Taxa Cobrada √ó Custo Real"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:'Responde: "A taxa cobre o custo?"'}),e.jsx(qa,{width:"100%",height:300,children:e.jsxs(is,{data:[{name:"M√©dia","Taxa Cobrada":r.taxa_vs_custo.taxa_media,"Custo Real":r.taxa_vs_custo.custo_medio}],children:[e.jsx(Ba,{strokeDasharray:"3 3"}),e.jsx(Ua,{dataKey:"name"}),e.jsx(Ta,{}),e.jsx(Aa,{formatter:b=>`R$ ${Number(b).toFixed(2)}`}),e.jsx(Va,{}),e.jsx(Ka,{dataKey:"Taxa Cobrada",fill:"#10b981"}),e.jsx(Ka,{dataKey:"Custo Real",fill:"#ef4444"})]})}),e.jsx("div",{className:"mt-4 text-center",children:r.taxa_vs_custo.taxa_media>=r.taxa_vs_custo.custo_medio?e.jsxs("p",{className:"text-green-600 font-medium",children:["‚úÖ Taxa m√©dia (R$ ",r.taxa_vs_custo.taxa_media.toFixed(2),") cobre o custo m√©dio (R$ ",r.taxa_vs_custo.custo_medio.toFixed(2),")"]}):e.jsxs("p",{className:"text-red-600 font-medium",children:["‚ö†Ô∏è Taxa m√©dia (R$ ",r.taxa_vs_custo.taxa_media.toFixed(2),") est√° abaixo do custo m√©dio (R$ ",r.taxa_vs_custo.custo_medio.toFixed(2),")"]})})]})]}),e.jsxs("div",{className:"mt-6 text-sm text-gray-500 text-center",children:["Dados do per√≠odo: ",Mo(o.periodo.data_inicio)," at√© ",Mo(o.periodo.data_fim)]})]}),!y&&o&&o.total_entregas===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(at,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-2",children:"Nenhuma entrega encontrada"}),e.jsx("p",{className:"text-gray-500",children:"N√£o h√° entregas conclu√≠das no per√≠odo selecionado"})]})]})}function Zs({titulo:s,valor:n,icon:t,colorClasse:d,subtitulo:o}){return e.jsxs("div",{className:`p-5 rounded-lg border shadow-sm ${d||"border-gray-200 bg-white"}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsx("div",{className:"text-2xl",children:t})}),e.jsx("h4",{className:"text-sm font-medium text-gray-600 mb-1",children:s}),o&&e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:o}),e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:n})]})}function Nc(){return e.jsx("div",{style:{height:110,borderRadius:8,background:"linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"}})}function hr(){return e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{style:{height:20,width:"40%",borderRadius:4,background:"linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite",marginBottom:16}}),e.jsx("div",{style:{height:300,borderRadius:8,background:"linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"}})]})}function Do(){return e.jsx("div",{style:{height:80,borderRadius:8,background:"linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"}})}function Ps(s){return s==null?"R$ 0,00":s.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}function Mo(s){if(!s)return"";const[n,t,d]=s.split("-");return`${d}/${t}/${n}`}function br(s){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(s||0))}function Lo(s){return Number((s==null?void 0:s.preco_venda)??(s==null?void 0:s.preco)??(s==null?void 0:s.preco_promocional)??0)}function _c(){const[s,n]=a.useState(!1),[t,d]=a.useState(!1),[o,g]=a.useState([]),[r,v]=a.useState(""),[j,f]=a.useState([]),[y,c]=a.useState(null),[m,k]=a.useState(""),w=a.useMemo(()=>{try{return JSON.parse(localStorage.getItem("selectedTenant")||"null")}catch{return null}},[]);a.useEffect(()=>{x()},[]);async function x(){var C,h;n(!0),k("");try{const _=await mn({limit:100,busca:r||void 0}),S=_==null?void 0:_.data,$=Array.isArray(S)?S:Array.isArray(S==null?void 0:S.items)?S.items:Array.isArray(S==null?void 0:S.itens)?S.itens:Array.isArray(S==null?void 0:S.produtos)?S.produtos:[];g($)}catch(_){g([]),k(((h=(C=_==null?void 0:_.response)==null?void 0:C.data)==null?void 0:h.detail)||"Erro ao carregar produtos vend√°veis")}finally{n(!1)}}function b(C){const h=C.id;if(j.find(S=>S.produto_id===h)){f(S=>S.map($=>$.produto_id===h?{...$,quantidade:$.quantidade+1}:$));return}f(S=>[...S,{produto_id:h,nome:C.nome,preco_unitario:Lo(C),quantidade:1}])}function u(C,h){if(h<=0){f(_=>_.filter(S=>S.produto_id!==C));return}f(_=>_.map(S=>S.produto_id===C?{...S,quantidade:h}:S))}const i=a.useMemo(()=>j.reduce((C,h)=>C+h.preco_unitario*h.quantidade,0),[j]);function p(){var C;return(C=window==null?void 0:window.crypto)!=null&&C.randomUUID?window.crypto.randomUUID():`checkout-${Date.now()}-${Math.random().toString(16).slice(2)}`}async function l(){var C,h;if(!(w!=null&&w.id)){k("Tenant n√£o selecionado. Fa√ßa login novamente e selecione uma empresa.");return}if(j.length===0){k("Adicione pelo menos um item no carrinho.");return}d(!0),k(""),c(null);try{const _=await F.post("/ecommerce/checkout",{cliente_id:888,origem:"web",items:j},{headers:{"Idempotency-Key":p()}});c(_.data),f([])}catch(_){k(((h=(C=_==null?void 0:_.response)==null?void 0:C.data)==null?void 0:h.detail)||"Erro ao finalizar checkout")}finally{d(!1)}}return e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"E-commerce MVP"}),e.jsx("p",{style:{color:"#666",marginBottom:16},children:"Fluxo r√°pido: cat√°logo, carrinho e checkout integrado ao endpoint novo."}),e.jsxs("div",{style:{marginBottom:12,color:w!=null&&w.id?"#0a7d32":"#b00020"},children:["Tenant: ",(w==null?void 0:w.name)||"n√£o selecionado"," (",(w==null?void 0:w.id)||"-",")"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:16},children:[e.jsxs("div",{style:{background:"#fff",padding:16,borderRadius:8},children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12},children:[e.jsx("input",{value:r,onChange:C=>v(C.target.value),placeholder:"Buscar produto...",style:{flex:1,padding:8,border:"1px solid #ddd",borderRadius:6}}),e.jsx("button",{className:"btn-secondary",onClick:x,disabled:s,children:s?"Carregando...":"Buscar"})]}),m&&e.jsx("div",{style:{background:"#ffe8e8",color:"#8c0000",padding:10,borderRadius:6,marginBottom:12},children:m}),e.jsxs("div",{style:{display:"grid",gap:8},children:[o.map(C=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid #eee",borderRadius:6,padding:10},children:[e.jsxs("div",{children:[e.jsx("strong",{children:C.nome}),e.jsxs("div",{style:{fontSize:12,color:"#666"},children:["ID: ",C.id]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{marginBottom:6},children:br(Lo(C))}),e.jsx("button",{className:"btn-primary",onClick:()=>b(C),children:"Adicionar"})]})]},C.id)),!s&&o.length===0&&e.jsxs("div",{style:{color:"#666",padding:12,display:"grid",gap:10},children:[e.jsx("div",{children:"Nenhum produto vend√°vel encontrado para este tenant."}),e.jsxs("div",{style:{fontSize:13},children:["Dica: cadastre um produto em ",e.jsx(Ms,{to:"/produtos/novo",style:{color:"#2563eb"},children:"Produtos > Novo"})," e volte para testar o checkout."]})]})]})]}),e.jsxs("div",{style:{background:"#fff",padding:16,borderRadius:8},children:[e.jsx("h3",{style:{marginTop:0},children:"Carrinho"}),j.length===0?e.jsx("div",{style:{color:"#666"},children:"Carrinho vazio"}):e.jsx("div",{style:{display:"grid",gap:8},children:j.map(C=>e.jsxs("div",{style:{border:"1px solid #eee",borderRadius:6,padding:8},children:[e.jsx("div",{style:{fontWeight:600},children:C.nome}),e.jsx("div",{style:{fontSize:12,color:"#666"},children:br(C.preco_unitario)}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:6},children:[e.jsx("button",{className:"btn-secondary",onClick:()=>u(C.produto_id,C.quantidade-1),children:"-"}),e.jsx("span",{children:C.quantidade}),e.jsx("button",{className:"btn-secondary",onClick:()=>u(C.produto_id,C.quantidade+1),children:"+"})]})]},C.produto_id))}),e.jsx("hr",{style:{margin:"12px 0"}}),e.jsxs("div",{style:{fontWeight:700,marginBottom:10},children:["Total: ",br(i)]}),e.jsx("button",{className:"btn-primary",onClick:l,disabled:t||j.length===0,style:{width:"100%"},children:t?"Finalizando...":"Finalizar Checkout"}),(y==null?void 0:y.pedido_id)&&e.jsxs("div",{style:{marginTop:12,background:"#e8fff0",color:"#0a7d32",padding:10,borderRadius:6},children:["Pedido criado: ",e.jsx("strong",{children:y.pedido_id})]})]})]})]})}function wc(){return e.jsx(hl,{children:e.jsxs(wn,{children:[e.jsx(kn,{position:"top-right"}),e.jsxs(yn,{children:[e.jsx(Ge,{path:"/login",element:e.jsx(vl,{})}),e.jsx(Ge,{path:"/register",element:e.jsx(yl,{})}),e.jsxs(Ge,{path:"/",element:e.jsx(ba,{children:e.jsx(jl,{})}),children:[e.jsx(Ge,{index:!0,element:e.jsx(fr,{to:"/lembretes",replace:!0})}),e.jsx(Ge,{path:"dashboard",element:e.jsx(ba,{permission:"relatorios.gerencial",children:e.jsx(Eo,{})})}),e.jsx(Ge,{path:"dashboard-gerencial",element:e.jsx(ba,{permission:"relatorios.gerencial",children:e.jsx(tc,{})})}),e.jsx(Ge,{path:"clientes",element:e.jsx(ba,{permission:"clientes.visualizar",children:e.jsx($l,{})})}),e.jsx(Ge,{path:"clientes/:clienteId/financeiro",element:e.jsx(ba,{permission:"clientes.visualizar",children:e.jsx(ac,{})})}),e.jsx(Ge,{path:"clientes/:clienteId/timeline",element:e.jsx(ba,{permission:"clientes.visualizar",children:e.jsx(zi,{})})}),e.jsx(Ge,{path:"pets",element:e.jsx(ti,{})}),e.jsx(Ge,{path:"pets/novo",element:e.jsx(Co,{})}),e.jsx(Ge,{path:"pets/:petId",element:e.jsx(ni,{})}),e.jsx(Ge,{path:"pets/:petId/editar",element:e.jsx(Co,{})}),e.jsx(Ge,{path:"produtos",element:e.jsx(ba,{permission:"produtos.visualizar",children:e.jsx(Kl,{})})}),e.jsx(Ge,{path:"produtos/novo",element:e.jsx(ba,{permission:"produtos.criar",children:e.jsx(wo,{})})}),e.jsx(Ge,{path:"produtos/:id/editar",element:e.jsx(ba,{permission:"produtos.editar",children:e.jsx(wo,{})})}),e.jsx(Ge,{path:"produtos/:id/movimentacoes",element:e.jsx(Ii,{})}),e.jsx(Ge,{path:"produtos/relatorio",element:e.jsx(Gl,{})}),e.jsx(Ge,{path:"estoque/alertas",element:e.jsx(ba,{permission:"produtos.visualizar",children:e.jsx(ei,{})})}),e.jsx(Ge,{path:"lembretes",element:e.jsx(ai,{})}),e.jsx(Ge,{path:"calculadora-racao",element:e.jsx(si,{})}),e.jsx(Ge,{path:"pdv",element:e.jsx(ba,{permission:"vendas.criar",children:e.jsx(Di,{})})}),e.jsx(Ge,{path:"meus-caixas",element:e.jsx(Li,{})}),e.jsx(Ge,{path:"notas-fiscais",element:e.jsx(qi,{})}),e.jsx(Ge,{path:"compras/pedidos",element:e.jsx(ba,{permission:"compras.gerenciar",children:e.jsx(Vi,{})})}),e.jsx(Ge,{path:"compras/entrada-xml",element:e.jsx(ba,{permission:"compras.gerenciar",children:e.jsx(Ui,{})})}),e.jsx(Ge,{path:"compras/bling",element:e.jsx(ba,{permission:"compras.gerenciar",children:e.jsx(Ti,{})})}),e.jsx(Ge,{path:"financeiro",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(Eo,{})})}),e.jsx(Ge,{path:"financeiro/vendas",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(ud,{})})}),e.jsx(Ge,{path:"financeiro/relatorio-vendas",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(md,{})})}),e.jsx(Ge,{path:"financeiro/contas-pagar",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(Qi,{})})}),e.jsx(Ge,{path:"financeiro/contas-receber",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(Xi,{})})}),e.jsx(Ge,{path:"financeiro/conciliacao-3abas",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(ed,{})})}),e.jsx(Ge,{path:"financeiro/historico-conciliacoes",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(ad,{})})}),e.jsx(Ge,{path:"financeiro/conciliacao-bancaria",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(sd,{})})}),e.jsx(Ge,{path:"financeiro/fluxo-caixa",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(xd,{})})}),e.jsx(Ge,{path:"financeiro/dre",element:e.jsx(ba,{permission:"relatorios.financeiro",children:e.jsx(vd,{})})}),e.jsx(Ge,{path:"comissoes",element:e.jsx(Bd,{})}),e.jsx(Ge,{path:"comissoes/demonstrativo",element:e.jsx(Kd,{})}),e.jsx(Ge,{path:"comissoes/relatorios",element:e.jsx(Jd,{})}),e.jsx(Ge,{path:"comissoes/abertas",element:e.jsx(Hd,{})}),e.jsx(Ge,{path:"comissoes/fechamento/:funcionario_id",element:e.jsx(Gd,{})}),e.jsx(Ge,{path:"comissoes/fechamentos",element:e.jsx(Qd,{})}),e.jsx(Ge,{path:"comissoes/fechamentos/detalhe",element:e.jsx(Xd,{})}),e.jsx(Ge,{path:"subcategorias",element:e.jsx(Ao,{})}),e.jsx(Ge,{path:"cadastros/categorias",element:e.jsx(Yd,{})}),e.jsx(Ge,{path:"cadastros/categorias-financeiras",element:e.jsx(Zd,{})}),e.jsx(Ge,{path:"cadastros/especies-racas",element:e.jsx(ec,{})}),e.jsx(Ge,{path:"cadastros/cargos",element:e.jsx(pc,{})}),e.jsx(Ge,{path:"cadastros/financeiro/bancos",element:e.jsx(ba,{permission:"configuracoes.editar",children:e.jsx(Hi,{})})}),e.jsx(Ge,{path:"cadastros/financeiro/formas-pagamento",element:e.jsx(ba,{permission:"configuracoes.editar",children:e.jsx(od,{})})}),e.jsx(Ge,{path:"cadastros/financeiro/operadoras",element:e.jsx(ba,{permission:"configuracoes.editar",children:e.jsx(ld,{})})}),e.jsx(Ge,{path:"subcategorias",element:e.jsx(Ao,{})}),e.jsx(Ge,{path:"admin/usuarios",element:e.jsx(ba,{permission:"usuarios.manage",children:e.jsx(rc,{})})}),e.jsx(Ge,{path:"configuracoes",element:e.jsx(ba,{permission:"configuracoes.editar",children:e.jsx(nc,{})})}),e.jsx(Ge,{path:"configuracoes/fiscal",element:e.jsx(lc,{})}),e.jsx(Ge,{path:"configuracoes/entregas",element:e.jsx(ic,{})}),e.jsx(Ge,{path:"configuracoes/custos-moto",element:e.jsx(dc,{})}),e.jsx(Ge,{path:"configuracoes/estoque",element:e.jsx(cc,{})}),e.jsx(Ge,{path:"auditoria/provisoes",element:e.jsx(xc,{})}),e.jsx(Ge,{path:"projecao-caixa",element:e.jsx(mc,{})}),e.jsx(Ge,{path:"simulacao-contratacao",element:e.jsx(uc,{})}),e.jsx(Ge,{path:"rh/funcionarios",element:e.jsx(hc,{})}),e.jsx(Ge,{path:"admin/roles",element:e.jsx(oc,{})}),e.jsx(Ge,{path:"entregas/abertas",element:e.jsx(bc,{})}),e.jsx(Ge,{path:"entregas/rotas",element:e.jsx(fc,{})}),e.jsx(Ge,{path:"entregas/historico",element:e.jsx(vc,{})}),e.jsx(Ge,{path:"entregas/financeiro",element:e.jsx(yc,{})}),e.jsx(Ge,{path:"ecommerce",element:e.jsx(_c,{})}),e.jsx(Ge,{path:"ia/fluxo-caixa",element:e.jsx(ba,{permission:"ia.fluxo_caixa",children:e.jsx(Fd,{})})}),e.jsx(Ge,{path:"ia/chat",element:e.jsx($d,{})}),e.jsx(Ge,{path:"ia/whatsapp",element:e.jsx(ba,{permission:"ia.whatsapp",children:e.jsx(Od,{})})}),e.jsx(Ge,{path:"ia/alertas-racao",element:e.jsx(ba,{permission:"produtos.editar",children:e.jsx(hd,{})})}),e.jsx(Ge,{path:"cadastros/opcoes-racao",element:e.jsx(ba,{permission:"produtos.editar",children:e.jsx(bd,{})})})]}),e.jsx(Ge,{path:"*",element:e.jsx(fr,{to:"/",replace:!0})})]})]})})}Nn.createRoot(document.getElementById("root")).render(e.jsx(ts.StrictMode,{children:e.jsx(wc,{})}));
