import{r as a,j as e}from"./vendor-react-1771786931591.js";import{L as R,a as I}from"./index-1771786931591.js";import{A as P}from"./produtos-17717869315912.js";import"./vendor-utils-1771786931591.js";import"./vendor-icons-1771786931591.js";function m(n){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(n||0))}function _(n){return Number((n==null?void 0:n.preco_venda)??(n==null?void 0:n.preco)??(n==null?void 0:n.preco_promocional)??0)}function F(){const[n,p]=a.useState(!1),[g,y]=a.useState(!1),[f,x]=a.useState([]),[j,S]=a.useState(""),[d,u]=a.useState([]),[h,v]=a.useState(null),[b,l]=a.useState(""),s=a.useMemo(()=>{try{return JSON.parse(localStorage.getItem("selectedTenant")||"null")}catch{return null}},[]);a.useEffect(()=>{k()},[]);async function k(){var r,t;p(!0),l("");try{const i=await P({limit:100,busca:j||void 0}),o=i==null?void 0:i.data,c=Array.isArray(o)?o:Array.isArray(o==null?void 0:o.items)?o.items:Array.isArray(o==null?void 0:o.itens)?o.itens:Array.isArray(o==null?void 0:o.produtos)?o.produtos:[];x(c)}catch(i){x([]),l(((t=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:t.detail)||"Erro ao carregar produtos vendáveis")}finally{p(!1)}}function A(r){const t=r.id;if(d.find(o=>o.produto_id===t)){u(o=>o.map(c=>c.produto_id===t?{...c,quantidade:c.quantidade+1}:c));return}u(o=>[...o,{produto_id:t,nome:r.nome,preco_unitario:_(r),quantidade:1}])}function C(r,t){if(t<=0){u(i=>i.filter(o=>o.produto_id!==r));return}u(i=>i.map(o=>o.produto_id===r?{...o,quantidade:t}:o))}const N=a.useMemo(()=>d.reduce((r,t)=>r+t.preco_unitario*t.quantidade,0),[d]);function w(){var r;return(r=window==null?void 0:window.crypto)!=null&&r.randomUUID?window.crypto.randomUUID():`checkout-${Date.now()}-${Math.random().toString(16).slice(2)}`}async function B(){var r,t;if(!(s!=null&&s.id)){l("Tenant não selecionado. Faça login novamente e selecione uma empresa.");return}if(d.length===0){l("Adicione pelo menos um item no carrinho.");return}y(!0),l(""),v(null);try{const i=await I.post("/ecommerce/checkout",{cliente_id:888,origem:"web",items:d},{headers:{"Idempotency-Key":w()}});v(i.data),u([])}catch(i){l(((t=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:t.detail)||"Erro ao finalizar checkout")}finally{y(!1)}}return e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"E-commerce MVP"}),e.jsx("p",{style:{color:"#666",marginBottom:16},children:"Fluxo rápido: catálogo, carrinho e checkout integrado ao endpoint novo."}),e.jsxs("div",{style:{marginBottom:12,color:s!=null&&s.id?"#0a7d32":"#b00020"},children:["Tenant: ",(s==null?void 0:s.name)||"não selecionado"," (",(s==null?void 0:s.id)||"-",")"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:16},children:[e.jsxs("div",{style:{background:"#fff",padding:16,borderRadius:8},children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12},children:[e.jsx("input",{value:j,onChange:r=>S(r.target.value),placeholder:"Buscar produto...",style:{flex:1,padding:8,border:"1px solid #ddd",borderRadius:6}}),e.jsx("button",{className:"btn-secondary",onClick:k,disabled:n,children:n?"Carregando...":"Buscar"})]}),b&&e.jsx("div",{style:{background:"#ffe8e8",color:"#8c0000",padding:10,borderRadius:6,marginBottom:12},children:b}),e.jsxs("div",{style:{display:"grid",gap:8},children:[f.map(r=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid #eee",borderRadius:6,padding:10},children:[e.jsxs("div",{children:[e.jsx("strong",{children:r.nome}),e.jsxs("div",{style:{fontSize:12,color:"#666"},children:["ID: ",r.id]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{marginBottom:6},children:m(_(r))}),e.jsx("button",{className:"btn-primary",onClick:()=>A(r),children:"Adicionar"})]})]},r.id)),!n&&f.length===0&&e.jsxs("div",{style:{color:"#666",padding:12,display:"grid",gap:10},children:[e.jsx("div",{children:"Nenhum produto vendável encontrado para este tenant."}),e.jsxs("div",{style:{fontSize:13},children:["Dica: cadastre um produto em ",e.jsx(R,{to:"/produtos/novo",style:{color:"#2563eb"},children:"Produtos > Novo"})," e volte para testar o checkout."]})]})]})]}),e.jsxs("div",{style:{background:"#fff",padding:16,borderRadius:8},children:[e.jsx("h3",{style:{marginTop:0},children:"Carrinho"}),d.length===0?e.jsx("div",{style:{color:"#666"},children:"Carrinho vazio"}):e.jsx("div",{style:{display:"grid",gap:8},children:d.map(r=>e.jsxs("div",{style:{border:"1px solid #eee",borderRadius:6,padding:8},children:[e.jsx("div",{style:{fontWeight:600},children:r.nome}),e.jsx("div",{style:{fontSize:12,color:"#666"},children:m(r.preco_unitario)}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:6},children:[e.jsx("button",{className:"btn-secondary",onClick:()=>C(r.produto_id,r.quantidade-1),children:"-"}),e.jsx("span",{children:r.quantidade}),e.jsx("button",{className:"btn-secondary",onClick:()=>C(r.produto_id,r.quantidade+1),children:"+"})]})]},r.produto_id))}),e.jsx("hr",{style:{margin:"12px 0"}}),e.jsxs("div",{style:{fontWeight:700,marginBottom:10},children:["Total: ",m(N)]}),e.jsx("button",{className:"btn-primary",onClick:B,disabled:g||d.length===0,style:{width:"100%"},children:g?"Finalizando...":"Finalizar Checkout"}),(h==null?void 0:h.pedido_id)&&e.jsxs("div",{style:{marginTop:12,background:"#e8fff0",color:"#0a7d32",padding:10,borderRadius:6},children:["Pedido criado: ",e.jsx("strong",{children:h.pedido_id})]})]})]})]})}export{F as default};
