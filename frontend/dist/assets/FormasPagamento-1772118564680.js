import{r as d,aP as m,j as e}from"./vendor-react-1772118564680.js";import{a as u}from"./index-1772118564680.js";const f={dinheiro:"ðŸ’µ",cartao_credito:"ðŸ’³",cartao_debito:"ðŸ’³",pix:"ðŸ“±",boleto:"ðŸ“„",transferencia:"ðŸ¦"},R=c=>{if(typeof c!="string"||!c)return"";try{return decodeURIComponent(escape(c))}catch{return c}},b=c=>{const p=R(c).trim();return!p||p.includes("ï¿½")?"":p.replace(/\?{2,}/g," ").replace(/\s{2,}/g," ").trim().replace(/Cr dito/gi,"Credito").replace(/D bito/gi,"Debito").replace(/Transfer ncia/gi,"Transferencia").replace(/Banc ria/gi,"Bancaria")},D=(c,p)=>{const i=b(c),_=f[p]||"ðŸ’³";return!i||i.includes("?")||i.includes("Ã°")||i.includes("Ãƒ")?_:i},O=()=>{var w,E,F;const[c,p]=d.useState([]),[i,_]=d.useState([]),[x,y]=d.useState([]),[S,z]=d.useState(!0),[P,g]=d.useState(!1),[j,N]=d.useState(null),[t,l]=d.useState({nome:"",tipo:"dinheiro",taxa_percentual:0,taxa_fixa:0,prazo_dias:0,operadora:"",operadora_id:null,gera_contas_receber:!1,split_parcelas:!1,conta_bancaria_destino_id:null,requer_nsu:!1,tipo_cartao:"",bandeira:"",ativo:!0,permite_parcelamento:!1,parcelas_maximas:1,taxas_por_parcela:{},permite_antecipacao:!1,dias_recebimento_antecipado:null,taxa_antecipacao_percentual:null,icone:f.cartao_credito,cor:"#3B82F6"});d.useEffect(()=>{v()},[]);const v=async()=>{try{const[a,r,s]=await Promise.allSettled([u.get("/financeiro/formas-pagamento?apenas_ativas=false"),u.get("/contas-bancarias?apenas_ativas=true"),u.get("/operadoras-cartao?apenas_ativas=true")]);if(a.status==="fulfilled"){const o=(a.value.data||[]).map(n=>({...n,nome:b(n.nome)||n.nome,operadora:b(n.operadora)||n.operadora,icone:D(n.icone,n.tipo)}));p(o)}r.status==="fulfilled"&&_(r.value.data||[]),s.status==="fulfilled"?y(s.value.data||[]):(y([]),console.warn("Operadoras indisponiveis no ambiente atual. Usando lista vazia."))}catch(a){console.error("Erro ao carregar dados:",a),m.error("Erro ao carregar formas de pagamento")}finally{z(!1)}},C=(a=null)=>{if(a){N(a.id);let r={};if(a.taxas_por_parcela)try{r=typeof a.taxas_por_parcela=="string"?JSON.parse(a.taxas_por_parcela):a.taxas_por_parcela}catch(s){console.error("Erro ao parsear taxas_por_parcela:",s)}l({nome:b(a.nome)||a.nome,tipo:a.tipo,taxa_percentual:a.taxa_percentual,taxa_fixa:a.taxa_fixa,prazo_dias:a.prazo_dias,operadora:b(a.operadora)||a.operadora||"",operadora_id:a.operadora_id||null,gera_contas_receber:a.gera_contas_receber,split_parcelas:a.split_parcelas,conta_bancaria_destino_id:a.conta_bancaria_destino_id,requer_nsu:a.requer_nsu,tipo_cartao:a.tipo_cartao||"",bandeira:a.bandeira||"",ativo:a.ativo,permite_parcelamento:a.permite_parcelamento,parcelas_maximas:a.parcelas_maximas,taxas_por_parcela:r,permite_antecipacao:a.permite_antecipacao||!1,dias_recebimento_antecipado:a.dias_recebimento_antecipado||null,taxa_antecipacao_percentual:a.taxa_antecipacao_percentual||null,icone:D(a.icone,a.tipo),cor:a.cor||"#3B82F6"})}else N(null),l({nome:"",tipo:"dinheiro",taxa_percentual:0,taxa_fixa:0,prazo_dias:0,operadora:"",operadora_id:null,gera_contas_receber:!1,split_parcelas:!1,conta_bancaria_destino_id:null,requer_nsu:!1,tipo_cartao:"",bandeira:"",ativo:!0,permite_parcelamento:!1,parcelas_maximas:1,taxas_por_parcela:{},permite_antecipacao:!1,dias_recebimento_antecipado:null,taxa_antecipacao_percentual:null,icone:f.cartao_credito,cor:"#3B82F6"});g(!0)},I=async()=>{try{const a={...t,taxas_por_parcela:Object.keys(t.taxas_por_parcela).length>0?JSON.stringify(t.taxas_por_parcela):null};j?(await u.put(`/financeiro/formas-pagamento/${j}`,a),m.success("Forma de pagamento atualizada!")):(await u.post("/financeiro/formas-pagamento",a),m.success("Forma de pagamento criada!")),g(!1),v()}catch(a){console.error("Erro ao salvar:",a),m.error("Erro ao salvar forma de pagamento")}},T=async a=>{if(confirm("Deseja realmente excluir esta forma de pagamento?"))try{await u.delete(`/financeiro/formas-pagamento/${a}`),m.success("Forma de pagamento excluida!"),v()}catch(r){console.error("Erro ao excluir:",r),m.error("Erro ao excluir forma de pagamento")}},k=[{value:"dinheiro",label:"Dinheiro",icone:"ðŸ’µ"},{value:"cartao_credito",label:"Cartao de Credito",icone:"ðŸ’³"},{value:"cartao_debito",label:"Cartao de Debito",icone:"ðŸ’³"},{value:"pix",label:"PIX",icone:"ðŸ“±"},{value:"boleto",label:"Boleto",icone:"ðŸ“„"},{value:"transferencia",label:"Transferencia",icone:"ðŸ¦"}];return S?e.jsx("div",{className:"flex justify-center items-center h-64",children:"Carregando..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Formas de Pagamento/Recebimento"}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:()=>C(),children:"+ Nova Forma"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nome"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Taxa %"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Taxa Fixa"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Prazo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Conta Destino"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acoes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"px-6 py-4 text-center text-gray-500",children:"Nenhuma forma de pagamento cadastrada"})}):c.map(a=>{var r,s,o,n;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:a.icone}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.nome}),a.operadora_id&&e.jsx("div",{className:"text-xs text-gray-500",children:((r=x.find(h=>h.id===a.operadora_id))==null?void 0:r.nome)||a.operadora||"Operadora nao encontrada"})]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:((s=k.find(h=>h.value===a.tipo))==null?void 0:s.label)||a.tipo}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[a.taxa_percentual,"%"]}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:["R$ ",((o=a.taxa_fixa)==null?void 0:o.toFixed(2))||"0.00"]}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[a.prazo_dias," dias"]}),e.jsx("td",{className:"px-6 py-4 text-sm",children:a.conta_bancaria_destino_id?((n=i.find(h=>h.id===a.conta_bancaria_destino_id))==null?void 0:n.nome)||"N/A":e.jsx("span",{className:"text-gray-400",children:"Nenhuma"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${a.ativo?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:a.ativo?"Ativo":"Inativo"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"text-blue-600 hover:text-blue-800",onClick:()=>C(a),children:"Editar"}),e.jsx("button",{className:"text-red-600 hover:text-red-800",onClick:()=>T(a.id),children:"Excluir"})]})})]},a.id)})})]})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-6 py-4 flex justify-between items-center sticky top-0",children:[e.jsxs("h3",{className:"text-xl font-semibold",children:[j?"Editar":"Nova"," Forma de Pagamento"]}),e.jsx("button",{onClick:()=>g(!1),className:"text-white hover:bg-blue-700 px-3 py-1 rounded",children:"Fechar"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nome *"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",value:t.nome,onChange:a=>l({...t,nome:a.target.value}),placeholder:"Ex: Dinheiro, PIX, Stone Credito..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipo *"}),e.jsx("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:t.tipo,onChange:a=>l({...t,tipo:a.target.value}),children:k.map(a=>e.jsxs("option",{value:a.value,children:[a.icone," ",a.label]},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Icone"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",value:t.icone,onChange:a=>l({...t,icone:a.target.value}),placeholder:"\\uD83D\\uDCB5",maxLength:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa % (Ex: 2.5%)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:t.taxa_percentual,onChange:a=>l({...t,taxa_percentual:parseFloat(a.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa Fixa (R$)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:t.taxa_fixa,onChange:a=>l({...t,taxa_fixa:parseFloat(a.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Prazo (dias)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",value:t.prazo_dias,onChange:a=>l({...t,prazo_dias:parseInt(a.target.value)||0})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Conta Bancaria Destino"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:t.conta_bancaria_destino_id||"",onChange:a=>l({...t,conta_bancaria_destino_id:parseInt(a.target.value)||null}),children:[e.jsx("option",{value:"",children:"Selecione..."}),i.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Esta conta sera usada automaticamente quando esta forma for selecionada em pagamentos/recebimentos"})]}),(t.tipo==="cartao_credito"||t.tipo==="cartao_debito")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Operadora *"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:t.operadora_id||"",onChange:a=>{const r=parseInt(a.target.value)||null,s=x.find(n=>n.id===r);let o=(s==null?void 0:s.max_parcelas)||t.parcelas_maximas;l({...t,operadora_id:r,operadora:(s==null?void 0:s.nome)||"",parcelas_maximas:o})},children:[e.jsx("option",{value:"",children:"Selecione a operadora..."}),x.map(a=>e.jsxs("option",{value:a.id,children:[a.icone," ",a.nome," (ate ",a.max_parcelas,"x)"]},a.id))]}),t.operadora_id&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Limite de parcelas desta operadora: ",(w=x.find(a=>a.id===t.operadora_id))==null?void 0:w.max_parcelas,"x"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Bandeira"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:t.bandeira,onChange:a=>l({...t,bandeira:a.target.value}),children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"visa",children:"Visa"}),e.jsx("option",{value:"master",children:"Mastercard"}),e.jsx("option",{value:"elo",children:"Elo"}),e.jsx("option",{value:"amex",children:"American Express"}),e.jsx("option",{value:"hipercard",children:"Hipercard"})]})]})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.ativo,onChange:a=>l({...t,ativo:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Ativo"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.gera_contas_receber,onChange:a=>l({...t,gera_contas_receber:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Gera Contas a Receber (para cartoes com prazo)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.requer_nsu,onChange:a=>l({...t,requer_nsu:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Requer NSU (numero de transacao)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.permite_parcelamento,onChange:a=>l({...t,permite_parcelamento:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Permite Parcelamento"})]}),t.permite_parcelamento&&e.jsxs("div",{className:"ml-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Maximo de Parcelas"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",min:"1",max:t.operadora_id&&((E=x.find(a=>a.id===t.operadora_id))==null?void 0:E.max_parcelas)||24,value:t.parcelas_maximas,onChange:a=>{const r=parseInt(a.target.value)||1,s=x.find(n=>n.id===t.operadora_id),o=(s==null?void 0:s.max_parcelas)||24;if(r>o){m.error(`Esta operadora permite no maximo ${o}x`);return}l({...t,parcelas_maximas:r})}}),t.operadora_id&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["Limitado a ",(F=x.find(a=>a.id===t.operadora_id))==null?void 0:F.max_parcelas,"x pela operadora selecionada"]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Taxas Especificas por Numero de Parcelas"}),e.jsxs("p",{className:"text-xs text-blue-700 mb-3",children:["Configure taxas diferentes para cada quantidade de parcelas. Se nao informado, usa a taxa base (",t.taxa_percentual,"%)."]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-48 overflow-y-auto",children:Array.from({length:t.parcelas_maximas},(a,r)=>r+1).map(a=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"text-xs font-medium text-gray-700 w-10",children:[a,"x:"]}),e.jsx("input",{type:"number",step:"0.01",className:"flex-1 border border-gray-300 rounded px-2 py-1 text-sm",placeholder:t.taxa_percentual,value:t.taxas_por_parcela[a]||"",onChange:r=>{const s={...t.taxas_por_parcela};r.target.value?s[a]=parseFloat(r.target.value):delete s[a],l({...t,taxas_por_parcela:s})}}),e.jsx("span",{className:"text-xs text-gray-500",children:"%"})]},a))})]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.permite_antecipacao,onChange:a=>l({...t,permite_antecipacao:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Permite Antecipacao de Recebiveis"})]}),t.permite_antecipacao&&e.jsxs("div",{className:"ml-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Dias para Recebimento Antecipado"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",min:"0",max:"30",value:t.dias_recebimento_antecipado||"",onChange:a=>l({...t,dias_recebimento_antecipado:parseInt(a.target.value)||null}),placeholder:"Ex: 1 (cai em D+1)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Quantos dias apos a venda o dinheiro cai na conta com antecipacao (geralmente D+1)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa de Antecipacao (%) - OPCIONAL"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full border border-gray-300 rounded px-3 py-2",value:t.taxa_antecipacao_percentual||"",onChange:a=>l({...t,taxa_antecipacao_percentual:parseFloat(a.target.value)||null}),placeholder:"Ex: 0.50"}),e.jsxs("div",{className:"mt-2 p-3 bg-amber-50 border border-amber-200 rounded",children:[e.jsx("p",{className:"text-xs text-amber-800 font-semibold mb-1",children:"Duas formas de configurar:"}),e.jsxs("p",{className:"text-xs text-amber-700 mb-1",children:[e.jsx("strong",{children:"1. Com taxa de antecipacao:"})," Preencha este campo e a taxa sera somada automaticamente as taxas por parcela configuradas acima"]}),e.jsxs("p",{className:"text-xs text-amber-700",children:[e.jsx("strong",{children:"2. Sem taxa de antecipacao:"})," Deixe vazio e configure nos campos 1x a 12x acima ja com o valor final (taxa normal + antecipacao somadas)"]})]})]})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 border-t p-4",children:[e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",onClick:()=>g(!1),children:"Cancelar"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:I,children:"Salvar"})]})]})})]})};export{O as default};
