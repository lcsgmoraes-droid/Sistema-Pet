import{S as O,r as N,j as e,_ as B,a3 as $,a5 as H,a6 as J,o as K,p as Q,a0 as W,a1 as X,aa as D}from"./vendor-react-1772216752245.js";import{a as z}from"./index-1772216752245.js";const Y={vips_inativos:{titulo:"VIPs em Risco",descricao:"Clientes VIP sem compra h√° mais de 20 dias",icone:X,cor:"red",bgGradient:"from-red-500 to-red-600",bgLight:"bg-red-50",borderLight:"border-red-200",textColor:"text-red-700"},clientes_inativos:{titulo:"Clientes Inativos",descricao:"Sem compra h√° mais de 90 dias",icone:W,cor:"orange",bgGradient:"from-orange-500 to-orange-600",bgLight:"bg-orange-50",borderLight:"border-orange-200",textColor:"text-orange-700"},clientes_endividados:{titulo:"Alto Endividamento",descricao:"Clientes com saldo devedor significativo",icone:Q,cor:"yellow",bgGradient:"from-yellow-500 to-yellow-600",bgLight:"bg-yellow-50",borderLight:"border-yellow-200",textColor:"text-yellow-700"},oportunidades_novos:{titulo:"Novos Promissores",descricao:"Clientes novos com ticket alto",icone:K,cor:"green",bgGradient:"from-green-500 to-green-600",bgLight:"bg-green-50",borderLight:"border-green-200",textColor:"text-green-700"},pets_sem_eventos:{titulo:"Pets Inativos",descricao:"Sem consulta h√° mais de 60 dias",icone:J,cor:"purple",bgGradient:"from-purple-500 to-purple-600",bgLight:"bg-purple-50",borderLight:"border-purple-200",textColor:"text-purple-700"},whatsapp_inativo:{titulo:"WhatsApp Faltando",descricao:"Clientes sem n√∫mero cadastrado",icone:H,cor:"blue",bgGradient:"from-blue-500 to-blue-600",bgLight:"bg-blue-50",borderLight:"border-blue-200",textColor:"text-blue-700"}};function g({tipo:y,dados:C,onClick:v}){const t=Y[y],j=(t==null?void 0:t.icone)||$,i=C||{quantidade:0,impacto:null};return e.jsxs("div",{className:`${t.bgLight} border-2 ${t.borderLight} rounded-xl p-6 hover:shadow-lg transition-all cursor-pointer`,onClick:v,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`p-3 bg-gradient-to-br ${t.bgGradient} rounded-lg`,children:e.jsx(j,{className:"text-white",size:24})}),e.jsx(D,{className:t.textColor,size:20})]}),e.jsx("h3",{className:`text-2xl font-bold ${t.textColor} mb-1`,children:(i==null?void 0:i.quantidade)??0}),e.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:t.titulo}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:t.descricao}),(i==null?void 0:i.impacto)&&e.jsx("div",{className:"pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Impacto estimado:"}),e.jsx("span",{className:`font-bold ${t.textColor}`,children:i.impacto})]})}),e.jsxs("button",{className:`mt-3 w-full py-2 text-sm font-medium ${t.textColor} hover:bg-white rounded-lg transition-colors flex items-center justify-center gap-2`,children:["Ver detalhes",e.jsx(D,{size:14})]})]})}function se(){var A,R,L,F,k;const y=O(),[C,v]=N.useState(!0),[t,j]=N.useState(null),[i,G]=N.useState(null);N.useEffect(()=>{q()},[]);const q=async()=>{var d;try{v(!0);const[r,p]=await Promise.all([z.get("/clientes/"),z.get("/segmentacao/estatisticas")]),n=r==null?void 0:r.data,o=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.data)?n.data:[],w=(p==null?void 0:p.data)||{};console.log("üìä [Dashboard] Clientes carregados:",o.length);const l=I(o,w);j(l),G(new Date)}catch(r){console.error("Erro ao carregar dashboard:",r),j({vips_inativos:{quantidade:0,clientes:[],impacto:"R$ 0"},clientes_inativos:{quantidade:0,clientes:[],diasMedia:0},clientes_novos:{quantidade:0,clientes:[]},oportunidades_upsell:{quantidade:0,clientes:[],potencial:"R$ 0"},clientes_risco_churn:{quantidade:0,clientes:[],diasMedia:0}}),((d=r.response)==null?void 0:d.status)===403?alert("Voc√™ n√£o tem permiss√£o para acessar o dashboard gerencial"):alert("Erro ao carregar dashboard gerencial")}finally{v(!1)}},I=(d,r)=>{const p=new Date,o=(Array.isArray(d)?d:[]).filter(s=>(s==null?void 0:s.tipo_cadastro)==="cliente"),m=o.filter(s=>{const a=(s==null?void 0:s.segmento)||"Regular",x=(s==null?void 0:s.dias_desde_ultima_compra)??999;return a==="VIP"&&x>20}),w=m.reduce((s,a)=>s+((a==null?void 0:a.total_90d)??0),0),l=o.filter(s=>((s==null?void 0:s.dias_desde_ultima_compra)??0)>90),M=l.reduce((s,a)=>s+((a==null?void 0:a.total_historico)??0),0),u=o.filter(s=>((s==null?void 0:s.saldo_devedor)??0)>0),V=u.reduce((s,a)=>s+((a==null?void 0:a.saldo_devedor)??0),0),h=o.filter(s=>{const a=(s==null?void 0:s.segmento)||"Regular",x=(s==null?void 0:s.ticket_medio)??0;return a==="Novo"&&x>200}),P=h.reduce((s,a)=>s+((a==null?void 0:a.ticket_medio)??0),0),T=o.filter(s=>Array.isArray(s==null?void 0:s.pets)&&s.pets.length>0);let S=0,b=[];T.forEach(s=>{const a=Array.isArray(s==null?void 0:s.pets)?s.pets:[];if(a.length>0){const x=a.filter(f=>{if(!(f!=null&&f.ultima_consulta))return!0;const U=new Date(f.ultima_consulta);return Math.floor((p-U)/(1e3*60*60*24))>60});x.length>0&&(S+=x.length,b.push(s))}});const _=o.filter(s=>!(s!=null&&s.celular)||s.celular.trim()==="");return{vips_inativos:{quantidade:(m==null?void 0:m.length)??0,impacto:`R$ ${(w??0).toFixed(2)}`,clientes:m},clientes_inativos:{quantidade:(l==null?void 0:l.length)??0,impacto:`R$ ${((M??0)/12).toFixed(2)}/m√™s`,clientes:l},clientes_endividados:{quantidade:(u==null?void 0:u.length)??0,impacto:`R$ ${(V??0).toFixed(2)}`,clientes:u},oportunidades_novos:{quantidade:(h==null?void 0:h.length)??0,impacto:`~R$ ${(P??0).toFixed(0)}/m√™s`,clientes:h},pets_sem_eventos:{quantidade:S??0,impacto:`${(b==null?void 0:b.length)??0} donos`,clientes:b},whatsapp_inativo:{quantidade:(_==null?void 0:_.length)??0,impacto:"Canal perdido",clientes:_},total_clientes:(o==null?void 0:o.length)??0,estatisticas:r??{}}},c=d=>{y("/pessoas",{state:{filtro:d}})},E=()=>{q()};return C?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Carregando dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-6",children:[e.jsx("div",{className:"max-w-7xl mx-auto mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:"üìä Dashboard Gerencial"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["Vis√£o executiva do neg√≥cio ‚Ä¢ ",(t==null?void 0:t.total_clientes)||0," clientes ativos"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[i&&e.jsxs("div",{className:"text-sm text-gray-500",children:["Atualizado √†s ",i.toLocaleTimeString("pt-BR")]}),e.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(B,{size:18}),"Atualizar"]})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(g,{tipo:"vips_inativos",dados:(t==null?void 0:t.vips_inativos)||{quantidade:0,impacto:"R$ 0",clientes:[]},onClick:()=>c("vips_inativos")}),e.jsx(g,{tipo:"clientes_inativos",dados:(t==null?void 0:t.clientes_inativos)||{quantidade:0,impacto:"R$ 0",clientes:[]},onClick:()=>c("clientes_inativos")}),e.jsx(g,{tipo:"clientes_endividados",dados:(t==null?void 0:t.clientes_endividados)||{quantidade:0,impacto:"R$ 0",clientes:[]},onClick:()=>c("clientes_endividados")}),e.jsx(g,{tipo:"oportunidades_novos",dados:(t==null?void 0:t.oportunidades_novos)||{quantidade:0,impacto:"R$ 0",clientes:[]},onClick:()=>c("oportunidades_novos")}),e.jsx(g,{tipo:"pets_sem_eventos",dados:(t==null?void 0:t.pets_sem_eventos)||{quantidade:0,impacto:"0 donos",clientes:[]},onClick:()=>c("pets_sem_eventos")}),e.jsx(g,{tipo:"whatsapp_inativo",dados:(t==null?void 0:t.whatsapp_inativo)||{quantidade:0,impacto:"Canal perdido",clientes:[]},onClick:()=>c("whatsapp_inativo")})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx($,{className:"text-blue-600",size:24}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Resumo Executivo"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"border-l-4 border-red-500 pl-4",children:[e.jsx("h3",{className:"font-semibold text-red-700 mb-2",children:"üö® A√ß√£o Urgente"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("strong",{children:((A=t==null?void 0:t.vips_inativos)==null?void 0:A.quantidade)??0})," clientes VIP em risco de churn"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Contate imediatamente para evitar perda de ",((R=t==null?void 0:t.vips_inativos)==null?void 0:R.impacto)??"R$ 0"," em receita"]})]}),e.jsxs("div",{className:"border-l-4 border-yellow-500 pl-4",children:[e.jsx("h3",{className:"font-semibold text-yellow-700 mb-2",children:"‚ö†Ô∏è Aten√ß√£o"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("strong",{children:((L=t==null?void 0:t.clientes_endividados)==null?void 0:L.quantidade)??0})," clientes endividados"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Total de ",((F=t==null?void 0:t.clientes_endividados)==null?void 0:F.impacto)??"R$ 0"," em aberto ‚Ä¢ Avaliar condi√ß√µes"]})]}),e.jsxs("div",{className:"border-l-4 border-green-500 pl-4",children:[e.jsx("h3",{className:"font-semibold text-green-700 mb-2",children:"üí° Oportunidade"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("strong",{children:((k=t==null?void 0:t.oportunidades_novos)==null?void 0:k.quantidade)??0})," novos clientes promissores"]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Potencial de fideliza√ß√£o ‚Ä¢ Ticket m√©dio alto"})]})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx($,{size:12}),"Dados calculados em tempo real com base em regras de neg√≥cio pr√©-definidas"]})})]})]})]})}export{se as default};
