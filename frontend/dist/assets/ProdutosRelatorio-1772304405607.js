import{S as A,r as i,j as e}from"./vendor-react-1772304405607.js";import{g as R,z as V,c as h}from"./produtos-17723044056072.js";import"./index-1772304405607.js";function F(){const N=A(),[d,p]=i.useState([]),[w,c]=i.useState([]),[j,y]=i.useState(!1),[u,k]=i.useState({totalEntradas:0,totalSaidas:0,valorTotal:0}),[l,b]=i.useState({data_inicio:f("mes"),data_fim:v(),produto_id:"",tipo_movimentacao:""}),[S,_]=i.useState("mes");i.useEffect(()=>{E()},[]),i.useEffect(()=>{C()},[l]);function f(t){const r=new Date,a=new Date(r);switch(t){case"mes":a.setDate(1);break;case"3meses":a.setMonth(r.getMonth()-3);break;case"6meses":a.setMonth(r.getMonth()-6);break;case"ano":a.setMonth(0),a.setDate(1);break;default:return""}return a.toISOString().split("T")[0]}function v(){return new Date().toISOString().split("T")[0]}const E=async()=>{try{const t=await R();t.data&&Array.isArray(t.data.items)?c(t.data.items):Array.isArray(t.data)?c(t.data):(console.warn("Resposta de produtos não é um array:",t.data),c([]))}catch(t){console.error("Erro ao carregar produtos:",t),c([])}},C=async()=>{var t,r,a;try{y(!0);const n=(await V(l)).data;let s=[];n&&Array.isArray(n.movimentacoes)?s=n.movimentacoes:Array.isArray(n)?s=n:console.warn("Resposta de movimentações não é um array:",n),p(s);const L=s.reduce((m,g)=>(m.totalEntradas+=g.entrada||0,m.totalSaidas+=g.saida||0,m.valorTotal+=g.valor_total||0,m),{totalEntradas:0,totalSaidas:0,valorTotal:0});k(L)}catch(o){console.error("Erro ao carregar relatório:",o),console.error("Detalhes do erro:",(t=o.response)==null?void 0:t.data),alert(`Erro ao carregar relatório: ${((a=(r=o.response)==null?void 0:r.data)==null?void 0:a.detail)||o.message}`),p([])}finally{y(!1)}},T=t=>{_(t),t==="personalizado"||b({...l,data_inicio:f(t),data_fim:v()})},x=(t,r)=>{b(a=>({...a,[t]:r}))},M=()=>{const t=["Data","Produto","Código","Entrada","Saída","Estoque","Tipo","Valor","Usuário","Nº Pedido","Lançamento"],r=d.map(s=>[s.data||"",s.produto_nome||"",s.codigo||"",s.entrada||0,s.saida||0,s.estoque||0,s.tipo||"",h(s.valor_total||0),s.usuario||"",s.numero_pedido||"",s.lancamento||""]);let a=t.join(";")+`
`;r.forEach(s=>{a+=s.join(";")+`
`});const o=new Blob([a],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=URL.createObjectURL(o),n.download=`relatorio_movimentacoes_${new Date().toISOString().split("T")[0]}.csv`,n.click()},D=d.reduce((t,r)=>{const o=new Date(r.data_movimentacao).toLocaleDateString("pt-BR",{month:"short",year:"numeric"});return t[o]||(t[o]=[]),t[o].push(r),t},{}),P=t=>({entrada:"bg-green-100 text-green-800",saida:"bg-red-100 text-red-800",ajuste:"bg-yellow-100 text-yellow-800",transferencia:"bg-blue-100 text-blue-800"})[t]||"bg-gray-100 text-gray-800";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Relatório de Movimentações"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Histórico completo de entradas e saídas de estoque"})]}),e.jsx("button",{onClick:()=>N("/produtos"),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Voltar"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"Último Mês",value:"mes"},{label:"3 Meses",value:"3meses"},{label:"6 Meses",value:"6meses"},{label:"Este Ano",value:"ano"},{label:"Personalizado",value:"personalizado"}].map(t=>e.jsx("button",{onClick:()=>T(t.value),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${S===t.value?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t.label},t.value))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Início"}),e.jsx("input",{type:"date",value:l.data_inicio,onChange:t=>x("data_inicio",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:l.data_fim,onChange:t=>x("data_fim",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Produto"}),e.jsxs("select",{value:l.produto_id,onChange:t=>x("produto_id",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os Produtos"}),w.map(t=>e.jsxs("option",{value:t.id,children:[t.codigo||t.sku," - ",t.nome]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:l.tipo_movimentacao,onChange:t=>x("tipo_movimentacao",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os Tipos"}),e.jsx("option",{value:"entrada",children:"Entrada"}),e.jsx("option",{value:"saida",children:"Saída"}),e.jsx("option",{value:"ajuste",children:"Ajuste"}),e.jsx("option",{value:"transferencia",children:"Transferência"})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Entradas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:u.totalEntradas.toFixed(2)})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 11l5-5m0 0l5 5m-5-5v12"})})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Saídas"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:u.totalSaidas.toFixed(2)})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 13l-5 5m0 0l-5-5m5 5V6"})})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Valor Total"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:h(u.valorTotal)})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})})]}),e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:M,disabled:d.length===0,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Exportar CSV"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[j?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Carregando relatório..."}):d.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Nenhuma movimentação encontrada no período selecionado"}):e.jsx("div",{className:"overflow-x-auto",children:Object.entries(D).map(([t,r])=>e.jsxs("div",{children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 font-semibold text-gray-700 border-b border-gray-200",children:[t.charAt(0).toUpperCase()+t.slice(1)," (",r.length," movimentações)"]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Código"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Entrada"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Saída"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Custo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usuário"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nº Pedido"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map((a,o)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 whitespace-nowrap",children:a.data}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:a.produto_nome||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-700 font-mono",children:a.codigo||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-green-600",children:a.entrada>0?a.entrada:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-red-600",children:a.saida>0?a.saida:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:a.estoque||0}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${P(a.tipo)}`,children:a.tipo})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:h(a.valor_total||0)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:a.usuario||"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:a.numero_pedido?e.jsxs("button",{className:"text-blue-600 hover:text-blue-800 underline font-mono text-sm",title:"Clique para ver o pedido",children:["#",a.numero_pedido]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]},o))})]})]},t))}),!j&&d.length>0&&e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",d.length," movimentações no período"]})})]})]})}export{F as default};
