import{r as n,j as e,N as xo,C as Gs,M as ci,b as xi,u as Co,X as pa,d as Ys,L as mo,z as Ee,F as mi,e as Ar,f as el,P as $a,h as Zt,i as al,k as ui,l as Nt,m as pi,n as gi,o as ot,p as es,q as ft,s as Ot,t as hi,v as bi,w as sl,x as nn,y as ks,B as nt,D as Zs,E as _t,G as fi,O as ji,H as va,I as Ca,J as ko,K as uo,Q as po,S as Dr,T as vs,U as mt,V as ps,W as Ls,Y as et,Z as Ut,_ as Hr,$ as tl,a0 as Vt,a1 as at,a2 as rl,a3 as So,a4 as ol,a5 as vi,a6 as as,a7 as Mr,a8 as Ts,a9 as Ss,aa as Wt,ab as Lr,ac as wt,ad as st,R as ms,ae as lt,af as Kr,ag as La,ah as Ha,ai as ls,aj as Aa,ak as fa,al as ys,am as qs,an as Eo,ao as go,ap as nl,aq as yi,ar as ln,as as ss,at as Ct,au as kt,av as Es,aw as xa,ax as Oa,ay as Ta,az as bt,aA as ll,aB as il,aC as dl,aD as tt,aE as Ht,aF as Tr,aG as Ni,aH as ho,aI as ce,aJ as St,aK as dn,aL as Is,aM as _i,aN as wi,aO as Ci,aP as cl,aQ as Xs,aR as xl,aS as qr,aT as cn,aU as Kt,aV as Ir,aW as us,aX as ki,aY as jt,aZ as Gr,a_ as Si,a$ as Gt,b0 as Xt,b1 as xn,b2 as Ei,b3 as Cs,b4 as ml,b5 as Fo,b6 as Fi,b7 as Pi,b8 as zr,b9 as Or,ba as ul,bb as pl,bc as Qt,bd as Jt,be as $s,bf as As,bg as gl,bh as hl,bi as Ri,bj as jr,bk as Sr,bl as mn,bm as bl,bn as $i,bo as Ai,bp as Di,bq as Po,br as vr,bs as Mi,bt as Li,bu as ao,bv as un,bw as Ti,bx as fl,by as qi,bz as Ii,bA as zi,bB as Oi,bC as Xe,bD as Vi}from"./vendor-react-1772053603252.js";import{R as za,L as Et,C as Ka,X as Ga,Y as Ua,T as Ma,a as Wa,b as gs,B as bs,c as Ja,d as Er,P as bo,e as fo,A as Bi,f as pn}from"./vendor-charts-1772053603252.js";import{u as Us,w as Ui,F as Wi}from"./vendor-utils-1772053603252.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();function jl(a,t){return function(){return a.apply(t,arguments)}}const{toString:Hi}=Object.prototype,{getPrototypeOf:Ro}=Object,{iterator:Xr,toStringTag:vl}=Symbol,Qr=(a=>t=>{const s=Hi.call(t);return a[s]||(a[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),hs=a=>(a=a.toLowerCase(),t=>Qr(t)===a),Jr=a=>t=>typeof t===a,{isArray:Rt}=Array,Ft=Jr("undefined");function er(a){return a!==null&&!Ft(a)&&a.constructor!==null&&!Ft(a.constructor)&&ts(a.constructor.isBuffer)&&a.constructor.isBuffer(a)}const yl=hs("ArrayBuffer");function Ki(a){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(a):t=a&&a.buffer&&yl(a.buffer),t}const Gi=Jr("string"),ts=Jr("function"),Nl=Jr("number"),ar=a=>a!==null&&typeof a=="object",Xi=a=>a===!0||a===!1,Fr=a=>{if(Qr(a)!=="object")return!1;const t=Ro(a);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(vl in a)&&!(Xr in a)},Qi=a=>{if(!ar(a)||er(a))return!1;try{return Object.keys(a).length===0&&Object.getPrototypeOf(a)===Object.prototype}catch{return!1}},Ji=hs("Date"),Yi=hs("File"),Zi=hs("Blob"),ed=hs("FileList"),ad=a=>ar(a)&&ts(a.pipe),sd=a=>{let t;return a&&(typeof FormData=="function"&&a instanceof FormData||ts(a.append)&&((t=Qr(a))==="formdata"||t==="object"&&ts(a.toString)&&a.toString()==="[object FormData]"))},td=hs("URLSearchParams"),[rd,od,nd,ld]=["ReadableStream","Request","Response","Headers"].map(hs),id=a=>a.trim?a.trim():a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function sr(a,t,{allOwnKeys:s=!1}={}){if(a===null||typeof a>"u")return;let o,r;if(typeof a!="object"&&(a=[a]),Rt(a))for(o=0,r=a.length;o<r;o++)t.call(null,a[o],o,a);else{if(er(a))return;const i=s?Object.getOwnPropertyNames(a):Object.keys(a),l=i.length;let x;for(o=0;o<l;o++)x=i[o],t.call(null,a[x],x,a)}}function _l(a,t){if(er(a))return null;t=t.toLowerCase();const s=Object.keys(a);let o=s.length,r;for(;o-- >0;)if(r=s[o],t===r.toLowerCase())return r;return null}const Ks=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,wl=a=>!Ft(a)&&a!==Ks;function jo(){const{caseless:a,skipUndefined:t}=wl(this)&&this||{},s={},o=(r,i)=>{if(i==="__proto__"||i==="constructor"||i==="prototype")return;const l=a&&_l(s,i)||i;Fr(s[l])&&Fr(r)?s[l]=jo(s[l],r):Fr(r)?s[l]=jo({},r):Rt(r)?s[l]=r.slice():(!t||!Ft(r))&&(s[l]=r)};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&sr(arguments[r],o);return s}const dd=(a,t,s,{allOwnKeys:o}={})=>(sr(t,(r,i)=>{s&&ts(r)?Object.defineProperty(a,i,{value:jl(r,s),writable:!0,enumerable:!0,configurable:!0}):Object.defineProperty(a,i,{value:r,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:o}),a),cd=a=>(a.charCodeAt(0)===65279&&(a=a.slice(1)),a),xd=(a,t,s,o)=>{a.prototype=Object.create(t.prototype,o),Object.defineProperty(a.prototype,"constructor",{value:a,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(a,"super",{value:t.prototype}),s&&Object.assign(a.prototype,s)},md=(a,t,s,o)=>{let r,i,l;const x={};if(t=t||{},a==null)return t;do{for(r=Object.getOwnPropertyNames(a),i=r.length;i-- >0;)l=r[i],(!o||o(l,a,t))&&!x[l]&&(t[l]=a[l],x[l]=!0);a=s!==!1&&Ro(a)}while(a&&(!s||s(a,t))&&a!==Object.prototype);return t},ud=(a,t,s)=>{a=String(a),(s===void 0||s>a.length)&&(s=a.length),s-=t.length;const o=a.indexOf(t,s);return o!==-1&&o===s},pd=a=>{if(!a)return null;if(Rt(a))return a;let t=a.length;if(!Nl(t))return null;const s=new Array(t);for(;t-- >0;)s[t]=a[t];return s},gd=(a=>t=>a&&t instanceof a)(typeof Uint8Array<"u"&&Ro(Uint8Array)),hd=(a,t)=>{const o=(a&&a[Xr]).call(a);let r;for(;(r=o.next())&&!r.done;){const i=r.value;t.call(a,i[0],i[1])}},bd=(a,t)=>{let s;const o=[];for(;(s=a.exec(t))!==null;)o.push(s);return o},fd=hs("HTMLFormElement"),jd=a=>a.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(s,o,r){return o.toUpperCase()+r}),gn=(({hasOwnProperty:a})=>(t,s)=>a.call(t,s))(Object.prototype),vd=hs("RegExp"),Cl=(a,t)=>{const s=Object.getOwnPropertyDescriptors(a),o={};sr(s,(r,i)=>{let l;(l=t(r,i,a))!==!1&&(o[i]=l||r)}),Object.defineProperties(a,o)},yd=a=>{Cl(a,(t,s)=>{if(ts(a)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const o=a[s];if(ts(o)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")})}})},Nd=(a,t)=>{const s={},o=r=>{r.forEach(i=>{s[i]=!0})};return Rt(a)?o(a):o(String(a).split(t)),s},_d=()=>{},wd=(a,t)=>a!=null&&Number.isFinite(a=+a)?a:t;function Cd(a){return!!(a&&ts(a.append)&&a[vl]==="FormData"&&a[Xr])}const kd=a=>{const t=new Array(10),s=(o,r)=>{if(ar(o)){if(t.indexOf(o)>=0)return;if(er(o))return o;if(!("toJSON"in o)){t[r]=o;const i=Rt(o)?[]:{};return sr(o,(l,x)=>{const j=s(l,r+1);!Ft(j)&&(i[x]=j)}),t[r]=void 0,i}}return o};return s(a,0)},Sd=hs("AsyncFunction"),Ed=a=>a&&(ar(a)||ts(a))&&ts(a.then)&&ts(a.catch),kl=((a,t)=>a?setImmediate:t?((s,o)=>(Ks.addEventListener("message",({source:r,data:i})=>{r===Ks&&i===s&&o.length&&o.shift()()},!1),r=>{o.push(r),Ks.postMessage(s,"*")}))(`axios@${Math.random()}`,[]):s=>setTimeout(s))(typeof setImmediate=="function",ts(Ks.postMessage)),Fd=typeof queueMicrotask<"u"?queueMicrotask.bind(Ks):typeof process<"u"&&process.nextTick||kl,Pd=a=>a!=null&&ts(a[Xr]),je={isArray:Rt,isArrayBuffer:yl,isBuffer:er,isFormData:sd,isArrayBufferView:Ki,isString:Gi,isNumber:Nl,isBoolean:Xi,isObject:ar,isPlainObject:Fr,isEmptyObject:Qi,isReadableStream:rd,isRequest:od,isResponse:nd,isHeaders:ld,isUndefined:Ft,isDate:Ji,isFile:Yi,isBlob:Zi,isRegExp:vd,isFunction:ts,isStream:ad,isURLSearchParams:td,isTypedArray:gd,isFileList:ed,forEach:sr,merge:jo,extend:dd,trim:id,stripBOM:cd,inherits:xd,toFlatObject:md,kindOf:Qr,kindOfTest:hs,endsWith:ud,toArray:pd,forEachEntry:hd,matchAll:bd,isHTMLForm:fd,hasOwnProperty:gn,hasOwnProp:gn,reduceDescriptors:Cl,freezeMethods:yd,toObjectSet:Nd,toCamelCase:jd,noop:_d,toFiniteNumber:wd,findKey:_l,global:Ks,isContextDefined:wl,isSpecCompliantForm:Cd,toJSONObject:kd,isAsyncFn:Sd,isThenable:Ed,setImmediate:kl,asap:Fd,isIterable:Pd};let na=class Sl extends Error{static from(t,s,o,r,i,l){const x=new Sl(t.message,s||t.code,o,r,i);return x.cause=t,x.name=t.name,l&&Object.assign(x,l),x}constructor(t,s,o,r,i){super(t),this.name="AxiosError",this.isAxiosError=!0,s&&(this.code=s),o&&(this.config=o),r&&(this.request=r),i&&(this.response=i,this.status=i.status)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:je.toJSONObject(this.config),code:this.code,status:this.status}}};na.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE";na.ERR_BAD_OPTION="ERR_BAD_OPTION";na.ECONNABORTED="ECONNABORTED";na.ETIMEDOUT="ETIMEDOUT";na.ERR_NETWORK="ERR_NETWORK";na.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS";na.ERR_DEPRECATED="ERR_DEPRECATED";na.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE";na.ERR_BAD_REQUEST="ERR_BAD_REQUEST";na.ERR_CANCELED="ERR_CANCELED";na.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT";na.ERR_INVALID_URL="ERR_INVALID_URL";const Rd=null;function vo(a){return je.isPlainObject(a)||je.isArray(a)}function El(a){return je.endsWith(a,"[]")?a.slice(0,-2):a}function hn(a,t,s){return a?a.concat(t).map(function(r,i){return r=El(r),!s&&i?"["+r+"]":r}).join(s?".":""):t}function $d(a){return je.isArray(a)&&!a.some(vo)}const Ad=je.toFlatObject(je,{},null,function(t){return/^is[A-Z]/.test(t)});function Yr(a,t,s){if(!je.isObject(a))throw new TypeError("target must be an object");t=t||new FormData,s=je.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(c,f){return!je.isUndefined(f[c])});const o=s.metaTokens,r=s.visitor||v,i=s.dots,l=s.indexes,j=(s.Blob||typeof Blob<"u"&&Blob)&&je.isSpecCompliantForm(t);if(!je.isFunction(r))throw new TypeError("visitor must be a function");function g(y){if(y===null)return"";if(je.isDate(y))return y.toISOString();if(je.isBoolean(y))return y.toString();if(!j&&je.isBlob(y))throw new na("Blob is not supported. Use a Buffer instead.");return je.isArrayBuffer(y)||je.isTypedArray(y)?j&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function v(y,c,f){let b=y;if(y&&!f&&typeof y=="object"){if(je.endsWith(c,"{}"))c=o?c:c.slice(0,-2),y=JSON.stringify(y);else if(je.isArray(y)&&$d(y)||(je.isFileList(y)||je.endsWith(c,"[]"))&&(b=je.toArray(y)))return c=El(c),b.forEach(function(h,p){!(je.isUndefined(h)||h===null)&&t.append(l===!0?hn([c],p,i):l===null?c:c+"[]",g(h))}),!1}return vo(y)?!0:(t.append(hn(f,c,i),g(y)),!1)}const d=[],m=Object.assign(Ad,{defaultVisitor:v,convertValue:g,isVisitable:vo});function C(y,c){if(!je.isUndefined(y)){if(d.indexOf(y)!==-1)throw Error("Circular reference detected in "+c.join("."));d.push(y),je.forEach(y,function(b,u){(!(je.isUndefined(b)||b===null)&&r.call(t,b,je.isString(u)?u.trim():u,c,m))===!0&&C(b,c?c.concat(u):[u])}),d.pop()}}if(!je.isObject(a))throw new TypeError("data must be an object");return C(a),t}function bn(a){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(a).replace(/[!'()~]|%20|%00/g,function(o){return t[o]})}function $o(a,t){this._pairs=[],a&&Yr(a,this,t)}const Fl=$o.prototype;Fl.append=function(t,s){this._pairs.push([t,s])};Fl.toString=function(t){const s=t?function(o){return t.call(this,o,bn)}:bn;return this._pairs.map(function(r){return s(r[0])+"="+s(r[1])},"").join("&")};function Dd(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Pl(a,t,s){if(!t)return a;const o=s&&s.encode||Dd,r=je.isFunction(s)?{serialize:s}:s,i=r&&r.serialize;let l;if(i?l=i(t,r):l=je.isURLSearchParams(t)?t.toString():new $o(t,r).toString(o),l){const x=a.indexOf("#");x!==-1&&(a=a.slice(0,x)),a+=(a.indexOf("?")===-1?"?":"&")+l}return a}class fn{constructor(){this.handlers=[]}use(t,s,o){return this.handlers.push({fulfilled:t,rejected:s,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){je.forEach(this.handlers,function(o){o!==null&&t(o)})}}const Ao={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1,legacyInterceptorReqResOrdering:!0},Md=typeof URLSearchParams<"u"?URLSearchParams:$o,Ld=typeof FormData<"u"?FormData:null,Td=typeof Blob<"u"?Blob:null,qd={isBrowser:!0,classes:{URLSearchParams:Md,FormData:Ld,Blob:Td},protocols:["http","https","file","blob","url","data"]},Do=typeof window<"u"&&typeof document<"u",yo=typeof navigator=="object"&&navigator||void 0,Id=Do&&(!yo||["ReactNative","NativeScript","NS"].indexOf(yo.product)<0),zd=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Od=Do&&window.location.href||"http://localhost",Vd=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Do,hasStandardBrowserEnv:Id,hasStandardBrowserWebWorkerEnv:zd,navigator:yo,origin:Od},Symbol.toStringTag,{value:"Module"})),Ya={...Vd,...qd};function Bd(a,t){return Yr(a,new Ya.classes.URLSearchParams,{visitor:function(s,o,r,i){return Ya.isNode&&je.isBuffer(s)?(this.append(o,s.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...t})}function Ud(a){return je.matchAll(/\w+|\[(\w*)]/g,a).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Wd(a){const t={},s=Object.keys(a);let o;const r=s.length;let i;for(o=0;o<r;o++)i=s[o],t[i]=a[i];return t}function Rl(a){function t(s,o,r,i){let l=s[i++];if(l==="__proto__")return!0;const x=Number.isFinite(+l),j=i>=s.length;return l=!l&&je.isArray(r)?r.length:l,j?(je.hasOwnProp(r,l)?r[l]=[r[l],o]:r[l]=o,!x):((!r[l]||!je.isObject(r[l]))&&(r[l]=[]),t(s,o,r[l],i)&&je.isArray(r[l])&&(r[l]=Wd(r[l])),!x)}if(je.isFormData(a)&&je.isFunction(a.entries)){const s={};return je.forEachEntry(a,(o,r)=>{t(Ud(o),r,s,0)}),s}return null}function Hd(a,t,s){if(je.isString(a))try{return(t||JSON.parse)(a),je.trim(a)}catch(o){if(o.name!=="SyntaxError")throw o}return(s||JSON.stringify)(a)}const tr={transitional:Ao,adapter:["xhr","http","fetch"],transformRequest:[function(t,s){const o=s.getContentType()||"",r=o.indexOf("application/json")>-1,i=je.isObject(t);if(i&&je.isHTMLForm(t)&&(t=new FormData(t)),je.isFormData(t))return r?JSON.stringify(Rl(t)):t;if(je.isArrayBuffer(t)||je.isBuffer(t)||je.isStream(t)||je.isFile(t)||je.isBlob(t)||je.isReadableStream(t))return t;if(je.isArrayBufferView(t))return t.buffer;if(je.isURLSearchParams(t))return s.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let x;if(i){if(o.indexOf("application/x-www-form-urlencoded")>-1)return Bd(t,this.formSerializer).toString();if((x=je.isFileList(t))||o.indexOf("multipart/form-data")>-1){const j=this.env&&this.env.FormData;return Yr(x?{"files[]":t}:t,j&&new j,this.formSerializer)}}return i||r?(s.setContentType("application/json",!1),Hd(t)):t}],transformResponse:[function(t){const s=this.transitional||tr.transitional,o=s&&s.forcedJSONParsing,r=this.responseType==="json";if(je.isResponse(t)||je.isReadableStream(t))return t;if(t&&je.isString(t)&&(o&&!this.responseType||r)){const l=!(s&&s.silentJSONParsing)&&r;try{return JSON.parse(t,this.parseReviver)}catch(x){if(l)throw x.name==="SyntaxError"?na.from(x,na.ERR_BAD_RESPONSE,this,null,this.response):x}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ya.classes.FormData,Blob:Ya.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};je.forEach(["delete","get","head","post","put","patch"],a=>{tr.headers[a]={}});const Kd=je.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Gd=a=>{const t={};let s,o,r;return a&&a.split(`
`).forEach(function(l){r=l.indexOf(":"),s=l.substring(0,r).trim().toLowerCase(),o=l.substring(r+1).trim(),!(!s||t[s]&&Kd[s])&&(s==="set-cookie"?t[s]?t[s].push(o):t[s]=[o]:t[s]=t[s]?t[s]+", "+o:o)}),t},jn=Symbol("internals");function Tt(a){return a&&String(a).trim().toLowerCase()}function Pr(a){return a===!1||a==null?a:je.isArray(a)?a.map(Pr):String(a)}function Xd(a){const t=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=s.exec(a);)t[o[1]]=o[2];return t}const Qd=a=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(a.trim());function so(a,t,s,o,r){if(je.isFunction(o))return o.call(this,t,s);if(r&&(t=s),!!je.isString(t)){if(je.isString(o))return t.indexOf(o)!==-1;if(je.isRegExp(o))return o.test(t)}}function Jd(a){return a.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,s,o)=>s.toUpperCase()+o)}function Yd(a,t){const s=je.toCamelCase(" "+t);["get","set","has"].forEach(o=>{Object.defineProperty(a,o+s,{value:function(r,i,l){return this[o].call(this,t,r,i,l)},configurable:!0})})}let rs=class{constructor(t){t&&this.set(t)}set(t,s,o){const r=this;function i(x,j,g){const v=Tt(j);if(!v)throw new Error("header name must be a non-empty string");const d=je.findKey(r,v);(!d||r[d]===void 0||g===!0||g===void 0&&r[d]!==!1)&&(r[d||j]=Pr(x))}const l=(x,j)=>je.forEach(x,(g,v)=>i(g,v,j));if(je.isPlainObject(t)||t instanceof this.constructor)l(t,s);else if(je.isString(t)&&(t=t.trim())&&!Qd(t))l(Gd(t),s);else if(je.isObject(t)&&je.isIterable(t)){let x={},j,g;for(const v of t){if(!je.isArray(v))throw TypeError("Object iterator must return a key-value pair");x[g=v[0]]=(j=x[g])?je.isArray(j)?[...j,v[1]]:[j,v[1]]:v[1]}l(x,s)}else t!=null&&i(s,t,o);return this}get(t,s){if(t=Tt(t),t){const o=je.findKey(this,t);if(o){const r=this[o];if(!s)return r;if(s===!0)return Xd(r);if(je.isFunction(s))return s.call(this,r,o);if(je.isRegExp(s))return s.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,s){if(t=Tt(t),t){const o=je.findKey(this,t);return!!(o&&this[o]!==void 0&&(!s||so(this,this[o],o,s)))}return!1}delete(t,s){const o=this;let r=!1;function i(l){if(l=Tt(l),l){const x=je.findKey(o,l);x&&(!s||so(o,o[x],x,s))&&(delete o[x],r=!0)}}return je.isArray(t)?t.forEach(i):i(t),r}clear(t){const s=Object.keys(this);let o=s.length,r=!1;for(;o--;){const i=s[o];(!t||so(this,this[i],i,t,!0))&&(delete this[i],r=!0)}return r}normalize(t){const s=this,o={};return je.forEach(this,(r,i)=>{const l=je.findKey(o,i);if(l){s[l]=Pr(r),delete s[i];return}const x=t?Jd(i):String(i).trim();x!==i&&delete s[i],s[x]=Pr(r),o[x]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const s=Object.create(null);return je.forEach(this,(o,r)=>{o!=null&&o!==!1&&(s[r]=t&&je.isArray(o)?o.join(", "):o)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,s])=>t+": "+s).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...s){const o=new this(t);return s.forEach(r=>o.set(r)),o}static accessor(t){const o=(this[jn]=this[jn]={accessors:{}}).accessors,r=this.prototype;function i(l){const x=Tt(l);o[x]||(Yd(r,l),o[x]=!0)}return je.isArray(t)?t.forEach(i):i(t),this}};rs.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);je.reduceDescriptors(rs.prototype,({value:a},t)=>{let s=t[0].toUpperCase()+t.slice(1);return{get:()=>a,set(o){this[s]=o}}});je.freezeMethods(rs);function to(a,t){const s=this||tr,o=t||s,r=rs.from(o.headers);let i=o.data;return je.forEach(a,function(x){i=x.call(s,i,r.normalize(),t?t.status:void 0)}),r.normalize(),i}function $l(a){return!!(a&&a.__CANCEL__)}let rr=class extends na{constructor(t,s,o){super(t??"canceled",na.ERR_CANCELED,s,o),this.name="CanceledError",this.__CANCEL__=!0}};function Al(a,t,s){const o=s.config.validateStatus;!s.status||!o||o(s.status)?a(s):t(new na("Request failed with status code "+s.status,[na.ERR_BAD_REQUEST,na.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s))}function Zd(a){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return t&&t[1]||""}function ec(a,t){a=a||10;const s=new Array(a),o=new Array(a);let r=0,i=0,l;return t=t!==void 0?t:1e3,function(j){const g=Date.now(),v=o[i];l||(l=g),s[r]=j,o[r]=g;let d=i,m=0;for(;d!==r;)m+=s[d++],d=d%a;if(r=(r+1)%a,r===i&&(i=(i+1)%a),g-l<t)return;const C=v&&g-v;return C?Math.round(m*1e3/C):void 0}}function ac(a,t){let s=0,o=1e3/t,r,i;const l=(g,v=Date.now())=>{s=v,r=null,i&&(clearTimeout(i),i=null),a(...g)};return[(...g)=>{const v=Date.now(),d=v-s;d>=o?l(g,v):(r=g,i||(i=setTimeout(()=>{i=null,l(r)},o-d)))},()=>r&&l(r)]}const Vr=(a,t,s=3)=>{let o=0;const r=ec(50,250);return ac(i=>{const l=i.loaded,x=i.lengthComputable?i.total:void 0,j=l-o,g=r(j),v=l<=x;o=l;const d={loaded:l,total:x,progress:x?l/x:void 0,bytes:j,rate:g||void 0,estimated:g&&x&&v?(x-l)/g:void 0,event:i,lengthComputable:x!=null,[t?"download":"upload"]:!0};a(d)},s)},vn=(a,t)=>{const s=a!=null;return[o=>t[0]({lengthComputable:s,total:a,loaded:o}),t[1]]},yn=a=>(...t)=>je.asap(()=>a(...t)),sc=Ya.hasStandardBrowserEnv?((a,t)=>s=>(s=new URL(s,Ya.origin),a.protocol===s.protocol&&a.host===s.host&&(t||a.port===s.port)))(new URL(Ya.origin),Ya.navigator&&/(msie|trident)/i.test(Ya.navigator.userAgent)):()=>!0,tc=Ya.hasStandardBrowserEnv?{write(a,t,s,o,r,i,l){if(typeof document>"u")return;const x=[`${a}=${encodeURIComponent(t)}`];je.isNumber(s)&&x.push(`expires=${new Date(s).toUTCString()}`),je.isString(o)&&x.push(`path=${o}`),je.isString(r)&&x.push(`domain=${r}`),i===!0&&x.push("secure"),je.isString(l)&&x.push(`SameSite=${l}`),document.cookie=x.join("; ")},read(a){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+a+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(a){this.write(a,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function rc(a){return typeof a!="string"?!1:/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}function oc(a,t){return t?a.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):a}function Dl(a,t,s){let o=!rc(t);return a&&(o||s==!1)?oc(a,t):t}const Nn=a=>a instanceof rs?{...a}:a;function rt(a,t){t=t||{};const s={};function o(g,v,d,m){return je.isPlainObject(g)&&je.isPlainObject(v)?je.merge.call({caseless:m},g,v):je.isPlainObject(v)?je.merge({},v):je.isArray(v)?v.slice():v}function r(g,v,d,m){if(je.isUndefined(v)){if(!je.isUndefined(g))return o(void 0,g,d,m)}else return o(g,v,d,m)}function i(g,v){if(!je.isUndefined(v))return o(void 0,v)}function l(g,v){if(je.isUndefined(v)){if(!je.isUndefined(g))return o(void 0,g)}else return o(void 0,v)}function x(g,v,d){if(d in t)return o(g,v);if(d in a)return o(void 0,g)}const j={url:i,method:i,data:i,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:x,headers:(g,v,d)=>r(Nn(g),Nn(v),d,!0)};return je.forEach(Object.keys({...a,...t}),function(v){if(v==="__proto__"||v==="constructor"||v==="prototype")return;const d=je.hasOwnProp(j,v)?j[v]:r,m=d(a[v],t[v],v);je.isUndefined(m)&&d!==x||(s[v]=m)}),s}const Ml=a=>{const t=rt({},a);let{data:s,withXSRFToken:o,xsrfHeaderName:r,xsrfCookieName:i,headers:l,auth:x}=t;if(t.headers=l=rs.from(l),t.url=Pl(Dl(t.baseURL,t.url,t.allowAbsoluteUrls),a.params,a.paramsSerializer),x&&l.set("Authorization","Basic "+btoa((x.username||"")+":"+(x.password?unescape(encodeURIComponent(x.password)):""))),je.isFormData(s)){if(Ya.hasStandardBrowserEnv||Ya.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if(je.isFunction(s.getHeaders)){const j=s.getHeaders(),g=["content-type","content-length"];Object.entries(j).forEach(([v,d])=>{g.includes(v.toLowerCase())&&l.set(v,d)})}}if(Ya.hasStandardBrowserEnv&&(o&&je.isFunction(o)&&(o=o(t)),o||o!==!1&&sc(t.url))){const j=r&&i&&tc.read(i);j&&l.set(r,j)}return t},nc=typeof XMLHttpRequest<"u",lc=nc&&function(a){return new Promise(function(s,o){const r=Ml(a);let i=r.data;const l=rs.from(r.headers).normalize();let{responseType:x,onUploadProgress:j,onDownloadProgress:g}=r,v,d,m,C,y;function c(){C&&C(),y&&y(),r.cancelToken&&r.cancelToken.unsubscribe(v),r.signal&&r.signal.removeEventListener("abort",v)}let f=new XMLHttpRequest;f.open(r.method.toUpperCase(),r.url,!0),f.timeout=r.timeout;function b(){if(!f)return;const h=rs.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders()),k={data:!x||x==="text"||x==="json"?f.responseText:f.response,status:f.status,statusText:f.statusText,headers:h,config:a,request:f};Al(function(w){s(w),c()},function(w){o(w),c()},k),f=null}"onloadend"in f?f.onloadend=b:f.onreadystatechange=function(){!f||f.readyState!==4||f.status===0&&!(f.responseURL&&f.responseURL.indexOf("file:")===0)||setTimeout(b)},f.onabort=function(){f&&(o(new na("Request aborted",na.ECONNABORTED,a,f)),f=null)},f.onerror=function(p){const k=p&&p.message?p.message:"Network Error",N=new na(k,na.ERR_NETWORK,a,f);N.event=p||null,o(N),f=null},f.ontimeout=function(){let p=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const k=r.transitional||Ao;r.timeoutErrorMessage&&(p=r.timeoutErrorMessage),o(new na(p,k.clarifyTimeoutError?na.ETIMEDOUT:na.ECONNABORTED,a,f)),f=null},i===void 0&&l.setContentType(null),"setRequestHeader"in f&&je.forEach(l.toJSON(),function(p,k){f.setRequestHeader(k,p)}),je.isUndefined(r.withCredentials)||(f.withCredentials=!!r.withCredentials),x&&x!=="json"&&(f.responseType=r.responseType),g&&([m,y]=Vr(g,!0),f.addEventListener("progress",m)),j&&f.upload&&([d,C]=Vr(j),f.upload.addEventListener("progress",d),f.upload.addEventListener("loadend",C)),(r.cancelToken||r.signal)&&(v=h=>{f&&(o(!h||h.type?new rr(null,a,f):h),f.abort(),f=null)},r.cancelToken&&r.cancelToken.subscribe(v),r.signal&&(r.signal.aborted?v():r.signal.addEventListener("abort",v)));const u=Zd(r.url);if(u&&Ya.protocols.indexOf(u)===-1){o(new na("Unsupported protocol "+u+":",na.ERR_BAD_REQUEST,a));return}f.send(i||null)})},ic=(a,t)=>{const{length:s}=a=a?a.filter(Boolean):[];if(t||s){let o=new AbortController,r;const i=function(g){if(!r){r=!0,x();const v=g instanceof Error?g:this.reason;o.abort(v instanceof na?v:new rr(v instanceof Error?v.message:v))}};let l=t&&setTimeout(()=>{l=null,i(new na(`timeout of ${t}ms exceeded`,na.ETIMEDOUT))},t);const x=()=>{a&&(l&&clearTimeout(l),l=null,a.forEach(g=>{g.unsubscribe?g.unsubscribe(i):g.removeEventListener("abort",i)}),a=null)};a.forEach(g=>g.addEventListener("abort",i));const{signal:j}=o;return j.unsubscribe=()=>je.asap(x),j}},dc=function*(a,t){let s=a.byteLength;if(s<t){yield a;return}let o=0,r;for(;o<s;)r=o+t,yield a.slice(o,r),o=r},cc=async function*(a,t){for await(const s of xc(a))yield*dc(s,t)},xc=async function*(a){if(a[Symbol.asyncIterator]){yield*a;return}const t=a.getReader();try{for(;;){const{done:s,value:o}=await t.read();if(s)break;yield o}}finally{await t.cancel()}},_n=(a,t,s,o)=>{const r=cc(a,t);let i=0,l,x=j=>{l||(l=!0,o&&o(j))};return new ReadableStream({async pull(j){try{const{done:g,value:v}=await r.next();if(g){x(),j.close();return}let d=v.byteLength;if(s){let m=i+=d;s(m)}j.enqueue(new Uint8Array(v))}catch(g){throw x(g),g}},cancel(j){return x(j),r.return()}},{highWaterMark:2})},wn=64*1024,{isFunction:yr}=je,mc=(({Request:a,Response:t})=>({Request:a,Response:t}))(je.global),{ReadableStream:Cn,TextEncoder:kn}=je.global,Sn=(a,...t)=>{try{return!!a(...t)}catch{return!1}},uc=a=>{a=je.merge.call({skipUndefined:!0},mc,a);const{fetch:t,Request:s,Response:o}=a,r=t?yr(t):typeof fetch=="function",i=yr(s),l=yr(o);if(!r)return!1;const x=r&&yr(Cn),j=r&&(typeof kn=="function"?(y=>c=>y.encode(c))(new kn):async y=>new Uint8Array(await new s(y).arrayBuffer())),g=i&&x&&Sn(()=>{let y=!1;const c=new s(Ya.origin,{body:new Cn,method:"POST",get duplex(){return y=!0,"half"}}).headers.has("Content-Type");return y&&!c}),v=l&&x&&Sn(()=>je.isReadableStream(new o("").body)),d={stream:v&&(y=>y.body)};r&&["text","arrayBuffer","blob","formData","stream"].forEach(y=>{!d[y]&&(d[y]=(c,f)=>{let b=c&&c[y];if(b)return b.call(c);throw new na(`Response type '${y}' is not supported`,na.ERR_NOT_SUPPORT,f)})});const m=async y=>{if(y==null)return 0;if(je.isBlob(y))return y.size;if(je.isSpecCompliantForm(y))return(await new s(Ya.origin,{method:"POST",body:y}).arrayBuffer()).byteLength;if(je.isArrayBufferView(y)||je.isArrayBuffer(y))return y.byteLength;if(je.isURLSearchParams(y)&&(y=y+""),je.isString(y))return(await j(y)).byteLength},C=async(y,c)=>{const f=je.toFiniteNumber(y.getContentLength());return f??m(c)};return async y=>{let{url:c,method:f,data:b,signal:u,cancelToken:h,timeout:p,onDownloadProgress:k,onUploadProgress:N,responseType:w,headers:S,withCredentials:P="same-origin",fetchOptions:W}=Ml(y),te=t||fetch;w=w?(w+"").toLowerCase():"text";let D=ic([u,h&&h.toAbortSignal()],p),A=null;const X=D&&D.unsubscribe&&(()=>{D.unsubscribe()});let re;try{if(N&&g&&f!=="get"&&f!=="head"&&(re=await C(S,b))!==0){let R=new s(c,{method:"POST",body:b,duplex:"half"}),K;if(je.isFormData(b)&&(K=R.headers.get("content-type"))&&S.setContentType(K),R.body){const[B,_]=vn(re,Vr(yn(N)));b=_n(R.body,wn,B,_)}}je.isString(P)||(P=P?"include":"omit");const M=i&&"credentials"in s.prototype,Z={...W,signal:D,method:f.toUpperCase(),headers:S.normalize().toJSON(),body:b,duplex:"half",credentials:M?P:void 0};A=i&&new s(c,Z);let $=await(i?te(A,W):te(c,Z));const J=v&&(w==="stream"||w==="response");if(v&&(k||J&&X)){const R={};["status","statusText","headers"].forEach(O=>{R[O]=$[O]});const K=je.toFiniteNumber($.headers.get("content-length")),[B,_]=k&&vn(K,Vr(yn(k),!0))||[];$=new o(_n($.body,wn,B,()=>{_&&_(),X&&X()}),R)}w=w||"text";let E=await d[je.findKey(d,w)||"text"]($,y);return!J&&X&&X(),await new Promise((R,K)=>{Al(R,K,{data:E,headers:rs.from($.headers),status:$.status,statusText:$.statusText,config:y,request:A})})}catch(M){throw X&&X(),M&&M.name==="TypeError"&&/Load failed|fetch/i.test(M.message)?Object.assign(new na("Network Error",na.ERR_NETWORK,y,A,M&&M.response),{cause:M.cause||M}):na.from(M,M&&M.code,y,A,M&&M.response)}}},pc=new Map,Ll=a=>{let t=a&&a.env||{};const{fetch:s,Request:o,Response:r}=t,i=[o,r,s];let l=i.length,x=l,j,g,v=pc;for(;x--;)j=i[x],g=v.get(j),g===void 0&&v.set(j,g=x?new Map:uc(t)),v=g;return g};Ll();const Mo={http:Rd,xhr:lc,fetch:{get:Ll}};je.forEach(Mo,(a,t)=>{if(a){try{Object.defineProperty(a,"name",{value:t})}catch{}Object.defineProperty(a,"adapterName",{value:t})}});const En=a=>`- ${a}`,gc=a=>je.isFunction(a)||a===null||a===!1;function hc(a,t){a=je.isArray(a)?a:[a];const{length:s}=a;let o,r;const i={};for(let l=0;l<s;l++){o=a[l];let x;if(r=o,!gc(o)&&(r=Mo[(x=String(o)).toLowerCase()],r===void 0))throw new na(`Unknown adapter '${x}'`);if(r&&(je.isFunction(r)||(r=r.get(t))))break;i[x||"#"+l]=r}if(!r){const l=Object.entries(i).map(([j,g])=>`adapter ${j} `+(g===!1?"is not supported by the environment":"is not available in the build"));let x=s?l.length>1?`since :
`+l.map(En).join(`
`):" "+En(l[0]):"as no adapter specified";throw new na("There is no suitable adapter to dispatch the request "+x,"ERR_NOT_SUPPORT")}return r}const Tl={getAdapter:hc,adapters:Mo};function ro(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new rr(null,a)}function Fn(a){return ro(a),a.headers=rs.from(a.headers),a.data=to.call(a,a.transformRequest),["post","put","patch"].indexOf(a.method)!==-1&&a.headers.setContentType("application/x-www-form-urlencoded",!1),Tl.getAdapter(a.adapter||tr.adapter,a)(a).then(function(o){return ro(a),o.data=to.call(a,a.transformResponse,o),o.headers=rs.from(o.headers),o},function(o){return $l(o)||(ro(a),o&&o.response&&(o.response.data=to.call(a,a.transformResponse,o.response),o.response.headers=rs.from(o.response.headers))),Promise.reject(o)})}const ql="1.13.5",Zr={};["object","boolean","number","function","string","symbol"].forEach((a,t)=>{Zr[a]=function(o){return typeof o===a||"a"+(t<1?"n ":" ")+a}});const Pn={};Zr.transitional=function(t,s,o){function r(i,l){return"[Axios v"+ql+"] Transitional option '"+i+"'"+l+(o?". "+o:"")}return(i,l,x)=>{if(t===!1)throw new na(r(l," has been removed"+(s?" in "+s:"")),na.ERR_DEPRECATED);return s&&!Pn[l]&&(Pn[l]=!0,console.warn(r(l," has been deprecated since v"+s+" and will be removed in the near future"))),t?t(i,l,x):!0}};Zr.spelling=function(t){return(s,o)=>(console.warn(`${o} is likely a misspelling of ${t}`),!0)};function bc(a,t,s){if(typeof a!="object")throw new na("options must be an object",na.ERR_BAD_OPTION_VALUE);const o=Object.keys(a);let r=o.length;for(;r-- >0;){const i=o[r],l=t[i];if(l){const x=a[i],j=x===void 0||l(x,i,a);if(j!==!0)throw new na("option "+i+" must be "+j,na.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new na("Unknown option "+i,na.ERR_BAD_OPTION)}}const Rr={assertOptions:bc,validators:Zr},ds=Rr.validators;let Qs=class{constructor(t){this.defaults=t||{},this.interceptors={request:new fn,response:new fn}}async request(t,s){try{return await this._request(t,s)}catch(o){if(o instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{o.stack?i&&!String(o.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+i):o.stack=i}catch{}}throw o}}_request(t,s){typeof t=="string"?(s=s||{},s.url=t):s=t||{},s=rt(this.defaults,s);const{transitional:o,paramsSerializer:r,headers:i}=s;o!==void 0&&Rr.assertOptions(o,{silentJSONParsing:ds.transitional(ds.boolean),forcedJSONParsing:ds.transitional(ds.boolean),clarifyTimeoutError:ds.transitional(ds.boolean),legacyInterceptorReqResOrdering:ds.transitional(ds.boolean)},!1),r!=null&&(je.isFunction(r)?s.paramsSerializer={serialize:r}:Rr.assertOptions(r,{encode:ds.function,serialize:ds.function},!0)),s.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?s.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:s.allowAbsoluteUrls=!0),Rr.assertOptions(s,{baseUrl:ds.spelling("baseURL"),withXsrfToken:ds.spelling("withXSRFToken")},!0),s.method=(s.method||this.defaults.method||"get").toLowerCase();let l=i&&je.merge(i.common,i[s.method]);i&&je.forEach(["delete","get","head","post","put","patch","common"],y=>{delete i[y]}),s.headers=rs.concat(l,i);const x=[];let j=!0;this.interceptors.request.forEach(function(c){if(typeof c.runWhen=="function"&&c.runWhen(s)===!1)return;j=j&&c.synchronous;const f=s.transitional||Ao;f&&f.legacyInterceptorReqResOrdering?x.unshift(c.fulfilled,c.rejected):x.push(c.fulfilled,c.rejected)});const g=[];this.interceptors.response.forEach(function(c){g.push(c.fulfilled,c.rejected)});let v,d=0,m;if(!j){const y=[Fn.bind(this),void 0];for(y.unshift(...x),y.push(...g),m=y.length,v=Promise.resolve(s);d<m;)v=v.then(y[d++],y[d++]);return v}m=x.length;let C=s;for(;d<m;){const y=x[d++],c=x[d++];try{C=y(C)}catch(f){c.call(this,f);break}}try{v=Fn.call(this,C)}catch(y){return Promise.reject(y)}for(d=0,m=g.length;d<m;)v=v.then(g[d++],g[d++]);return v}getUri(t){t=rt(this.defaults,t);const s=Dl(t.baseURL,t.url,t.allowAbsoluteUrls);return Pl(s,t.params,t.paramsSerializer)}};je.forEach(["delete","get","head","options"],function(t){Qs.prototype[t]=function(s,o){return this.request(rt(o||{},{method:t,url:s,data:(o||{}).data}))}});je.forEach(["post","put","patch"],function(t){function s(o){return function(i,l,x){return this.request(rt(x||{},{method:t,headers:o?{"Content-Type":"multipart/form-data"}:{},url:i,data:l}))}}Qs.prototype[t]=s(),Qs.prototype[t+"Form"]=s(!0)});let fc=class Il{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Promise(function(i){s=i});const o=this;this.promise.then(r=>{if(!o._listeners)return;let i=o._listeners.length;for(;i-- >0;)o._listeners[i](r);o._listeners=null}),this.promise.then=r=>{let i;const l=new Promise(x=>{o.subscribe(x),i=x}).then(r);return l.cancel=function(){o.unsubscribe(i)},l},t(function(i,l,x){o.reason||(o.reason=new rr(i,l,x),s(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const s=this._listeners.indexOf(t);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const t=new AbortController,s=o=>{t.abort(o)};return this.subscribe(s),t.signal.unsubscribe=()=>this.unsubscribe(s),t.signal}static source(){let t;return{token:new Il(function(r){t=r}),cancel:t}}};function jc(a){return function(s){return a.apply(null,s)}}function vc(a){return je.isObject(a)&&a.isAxiosError===!0}const No={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(No).forEach(([a,t])=>{No[t]=a});function zl(a){const t=new Qs(a),s=jl(Qs.prototype.request,t);return je.extend(s,Qs.prototype,t,{allOwnKeys:!0}),je.extend(s,t,null,{allOwnKeys:!0}),s.create=function(r){return zl(rt(a,r))},s}const Ra=zl(tr);Ra.Axios=Qs;Ra.CanceledError=rr;Ra.CancelToken=fc;Ra.isCancel=$l;Ra.VERSION=ql;Ra.toFormData=Yr;Ra.AxiosError=na;Ra.Cancel=Ra.CanceledError;Ra.all=function(t){return Promise.all(t)};Ra.spread=jc;Ra.isAxiosError=vc;Ra.mergeConfig=rt;Ra.AxiosHeaders=rs;Ra.formToJSON=a=>Rl(je.isHTMLForm(a)?new FormData(a):a);Ra.getAdapter=Tl.getAdapter;Ra.HttpStatusCode=No;Ra.default=Ra;const{Axios:Hp,AxiosError:Kp,CanceledError:Gp,isCancel:Xp,CancelToken:Qp,VERSION:Jp,all:Yp,Cancel:Zp,isAxiosError:eg,spread:ag,toFormData:sg,AxiosHeaders:tg,HttpStatusCode:rg,formToJSON:og,getAdapter:ng,mergeConfig:lg}=Ra,yc="/api",Nc=yc,Ol=(...a)=>{},_c=(...a)=>{},F=Ra.create({baseURL:Nc,headers:{"Content-Type":"application/json"}});F.interceptors.request.use(a=>{const t=localStorage.getItem("access_token")||localStorage.getItem("token");return t&&(a.headers.Authorization=`Bearer ${t}`),Ol("[API Request]",{method:a.method,url:a.url,baseURL:a.baseURL}),a},a=>Promise.reject(a));F.interceptors.response.use(a=>{var t;return Ol("[API Response]",{status:a.status,url:(t=a.config)==null?void 0:t.url}),a},a=>{var s,o,r,i;const t=(s=a.response)==null?void 0:s.status;return _c("[API Response Error]",{status:t,url:(o=a.config)==null?void 0:o.url,fullURL:`${((r=a.config)==null?void 0:r.baseURL)||""}${((i=a.config)==null?void 0:i.url)||""}`}),t===401&&(localStorage.removeItem("access_token"),localStorage.removeItem("token"),localStorage.removeItem("tenants"),window.location.href="/login"),Promise.reject(a)});const Vl=n.createContext(),$t=()=>{const a=n.useContext(Vl);if(!a)throw new Error("useAuth deve ser usado dentro de AuthProvider");return a},wc=({children:a})=>{const[t,s]=n.useState(null),[o,r]=n.useState(!0);n.useEffect(()=>{(async()=>{try{const d=localStorage.getItem("access_token"),m=localStorage.getItem("user");d&&m?(s(JSON.parse(m)),await i()):r(!1)}catch(d){console.error("Erro ao inicializar auth:",d),r(!1)}})()},[]);const i=async()=>{try{const v=await F.get("/auth/me-multitenant");s(v.data),localStorage.setItem("user",JSON.stringify(v.data)),r(!1)}catch(v){console.error("Erro ao buscar usuÃ¡rio:",v),localStorage.removeItem("access_token"),localStorage.removeItem("tenants"),localStorage.removeItem("user"),s(null),r(!1)}},g={user:t,loading:o,login:async(v,d)=>{var m,C;try{console.log("ðŸ” Iniciando login para:",v);const y=await F.post("/auth/login-multitenant",{email:v,password:d}),{access_token:c,tenants:f}=y.data;if(console.log("âœ… Login fase 1 OK - Tenants:",f.length),f&&f.length>0){localStorage.setItem("tempToken",c),console.log("ðŸ“ Selecionando tenant:",f[0].name);const u=(await F.post("/auth/select-tenant",{tenant_id:f[0].id},{headers:{Authorization:`Bearer ${c}`}})).data.access_token;localStorage.setItem("access_token",u),localStorage.setItem("selectedTenant",JSON.stringify(f[0])),console.log("âœ… Tenant selecionado OK");const h=await F.get("/auth/me-multitenant");return s(h.data),localStorage.setItem("user",JSON.stringify(h.data)),console.log("âœ… Login completo! Redirecionando..."),{success:!0}}else return console.error("âŒ Nenhum tenant disponÃ­vel"),{success:!1,error:"Nenhuma empresa disponÃ­vel para este usuÃ¡rio"}}catch(y){return console.error("Erro no login:",y),{success:!1,error:((C=(m=y.response)==null?void 0:m.data)==null?void 0:C.detail)||"Erro ao fazer login"}}},register:async(v,d,m)=>{var C,y;try{const c=await F.post("/auth/register",{email:v,password:d,nome:m}),{access_token:f}=c.data;localStorage.setItem("access_token",f);const b=await F.get("/auth/me-multitenant");return s(b.data),localStorage.setItem("user",JSON.stringify(b.data)),{success:!0}}catch(c){return console.error("Erro no registro:",c),{success:!1,error:((y=(C=c.response)==null?void 0:C.data)==null?void 0:y.detail)||"Erro ao criar conta"}}},logout:async()=>{try{await F.post("/auth/logout-multitenant")}catch(v){console.error("Erro ao fazer logout:",v)}finally{localStorage.removeItem("access_token"),localStorage.removeItem("tenants"),localStorage.removeItem("user"),localStorage.removeItem("selectedTenant"),localStorage.removeItem("tempToken"),s(null),window.location.href="/login"}},isAuthenticated:!!t};return e.jsx(Vl.Provider,{value:g,children:a})},ja=({children:a,permission:t,requiredPermissions:s})=>{var l,x;const{isAuthenticated:o,loading:r,user:i}=$t();if(r)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})});if(!o)return e.jsx(xo,{to:"/login",replace:!0});if(t||s){const j=(i==null?void 0:i.permissions)||[];if(((x=(l=i==null?void 0:i.role)==null?void 0:l.name)==null?void 0:x.toLowerCase())==="admin")return a;if(t&&!j.includes(t))return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ”’"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Acesso Negado"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"VocÃª nÃ£o tem permissÃ£o para acessar esta pÃ¡gina."}),e.jsxs("p",{className:"text-sm text-gray-500",children:["PermissÃ£o necessÃ¡ria: ",t]}),e.jsx("button",{onClick:()=>window.history.back(),className:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Voltar"})]})});if(s&&s.length>0&&!s.every(d=>j.includes(d)))return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ”’"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Acesso Negado"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"VocÃª nÃ£o tem permissÃ£o para acessar esta pÃ¡gina."}),e.jsxs("p",{className:"text-sm text-gray-500",children:["PermissÃµes necessÃ¡rias: ",s.join(", ")]}),e.jsx("button",{onClick:()=>window.history.back(),className:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Voltar"})]})})}return a};function Cc({onClick:a}){const[t,s]=n.useState(window.innerWidth<768),[o,r]=n.useState(!1),[i,l]=n.useState(!1),[x,j]=n.useState({x:0,y:0}),[g,v]=n.useState({x:0,y:0});n.useEffect(()=>{const k=()=>{s(window.innerWidth<768)};return window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[]);const d=(k,N)=>{const w=window.innerWidth-(N?60:200),S=window.innerHeight-(N?60:300);return{x:Math.max(20,Math.min(k.x,w)),y:Math.max(20,Math.min(k.y,S))}},[m,C]=n.useState(()=>{if(window.innerWidth<768)return{x:window.innerWidth-70,y:80};const k=localStorage.getItem("calc_button_pos"),N={x:window.innerWidth-150,y:window.innerHeight-150};if(k)try{const w=JSON.parse(k);return d(w,!0)}catch{return N}return N}),[y,c]=n.useState(()=>localStorage.getItem("calc_button_minimizado")==="true"),f=k=>{if(t)return;if(k.target.closest('button[title="Expandir"], button[title="Minimizar"]')){k.stopPropagation();return}r(!0),l(!1),v({x:k.clientX,y:k.clientY}),j({x:k.clientX-m.x,y:k.clientY-m.y})},b=k=>{if(o){Math.sqrt(Math.pow(k.clientX-g.x,2)+Math.pow(k.clientY-g.y,2))>5&&l(!0);const w=k.clientX-x.x,S=k.clientY-x.y,P=window.innerWidth-(y?60:200),W=window.innerHeight-(y?60:300),te={x:Math.max(20,Math.min(w,P)),y:Math.max(20,Math.min(S,W))};C(te)}},u=()=>{o&&(r(!1),localStorage.setItem("calc_button_pos",JSON.stringify(m)))};n.useEffect(()=>{if(o)return document.addEventListener("mousemove",b),document.addEventListener("mouseup",u),()=>{document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",u)}},[o,x,m]);const h=k=>{console.log("ðŸ–±ï¸ Clique detectado, hasDragged:",i),i?console.log("âŒ Ignorando clique (foi arraste)"):(console.log("âœ… Abrindo calculadora..."),a())},p=k=>{k.stopPropagation();const N=!y;if(!N){const w=d(m,!1);(w.x!==m.x||w.y!==m.y)&&(C(w),localStorage.setItem("calc_button_pos",JSON.stringify(w)))}c(N),localStorage.setItem("calc_button_minimizado",N.toString())};return n.useEffect(()=>{const k=()=>{if(window.innerWidth<768)C({x:window.innerWidth-70,y:80});else{const w=d(m,y);(w.x!==m.x||w.y!==m.y)&&(C(w),localStorage.setItem("calc_button_pos",JSON.stringify(w)))}};return window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[m,y]),e.jsx("div",{className:"fixed z-50",style:{left:`${m.x}px`,top:`${m.y}px`},children:y?e.jsxs("div",{className:`relative group ${t?"":"cursor-move"}`,onMouseDown:t?void 0:f,children:[e.jsx("button",{onClick:h,onMouseDown:k=>k.stopPropagation(),className:`calc-button-main\r
              flex items-center justify-center\r
              w-12 h-12 md:w-12 md:h-12\r
              bg-gradient-to-br from-orange-500 to-orange-600\r
              hover:from-orange-600 hover:to-orange-700\r
              text-white\r
              rounded-full\r
              shadow-lg hover:shadow-xl\r
              transition-all duration-200\r
              hover:scale-110\r
              active:scale-95\r
              pointer-events-auto\r
            `,title:"Calculadora de RaÃ§Ã£o",children:e.jsx(Gs,{size:20})}),!t&&e.jsx("button",{onClick:p,onMouseDown:k=>k.stopPropagation(),className:`\r
                absolute -bottom-1 -right-1\r
                bg-blue-600 hover:bg-blue-700\r
                text-white\r
                w-6 h-6\r
                rounded-full\r
                flex items-center justify-center\r
                opacity-0 group-hover:opacity-100\r
                transition-opacity\r
                shadow-md\r
              `,title:"Expandir",children:e.jsx(ci,{size:12})})]}):e.jsxs("div",{className:`\r
            flex flex-col gap-2\r
            bg-white\r
            rounded-2xl\r
            shadow-2xl\r
            p-3\r
            border-2 border-orange-500\r
            min-w-[140px]\r
          `,style:{cursor:o?"grabbing":"default"},children:[e.jsxs("div",{className:`flex items-center justify-between gap-2 drag-handle ${t?"":"cursor-move"}`,onMouseDown:t?void 0:f,children:[e.jsxs("div",{className:"flex items-center gap-2 pointer-events-none",children:[e.jsx("div",{className:`\r
                w-10 h-10\r
                bg-gradient-to-br from-orange-500 to-orange-600\r
                rounded-full\r
                flex items-center justify-center\r
                text-white\r
              `,children:e.jsx(Gs,{size:20})}),e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"Calculadora"})]}),e.jsx("button",{onClick:p,className:`\r
                p-1 hover:bg-gray-100 \r
                rounded-lg transition-colors\r
                pointer-events-auto\r
              `,title:"Minimizar",children:e.jsx(xi,{size:16,className:"text-gray-500"})})]}),e.jsx("button",{onClick:h,className:`calc-button-main\r
              w-full\r
              px-4 py-2\r
              bg-gradient-to-r from-orange-500 to-orange-600\r
              hover:from-orange-600 hover:to-orange-700\r
              text-white\r
              rounded-lg\r
              font-medium text-sm\r
              transition-all\r
              hover:shadow-lg\r
            `,children:"ðŸ¥« Calcular RaÃ§Ã£o"}),!t&&e.jsx("div",{className:"text-[10px] text-gray-500 text-center",children:"Arraste para mover"})]})})}function Bl(a){var r,i;if(!a)return!1;if(a.peso_embalagem&&a.peso_embalagem>0)return!0;const t=((r=a.classificacao_racao)==null?void 0:r.toLowerCase())||"",s=a.categoria_id||a.category_id,o=((i=a.categoria_nome)==null?void 0:i.toLowerCase())||"";return t&&t!=="nÃ£o Ã© raÃ§Ã£o"||o.includes("raÃ§Ã£o")||o.includes("racao")||s===5}function kc({isOpen:a=!1,onClose:t=()=>{},itensCarrinho:s=[],clienteId:o=null}){var O,q,ae,H,le;const i=Co().pathname==="/pdv",[l,x]=n.useState(window.innerWidth<768);n.useEffect(()=>{const G=()=>{x(window.innerWidth<768)};return window.addEventListener("resize",G),()=>window.removeEventListener("resize",G)},[]);const[j,g]=n.useState(null),[v,d]=n.useState(null),[m,C]=n.useState(null),[y,c]=n.useState(!1),[f,b]=n.useState(null),[u,h]=n.useState(null),[p,k]=n.useState(!1),[N,w]=n.useState(""),[S,P]=n.useState([]),[W,te]=n.useState(!1),[D,A]=n.useState({peso_pet_kg:"",idade_meses:"",nivel_atividade:"normal"}),[X,re]=n.useState(!1),[M,Z]=n.useState({x:0,y:0}),[$,J]=n.useState({x:0,y:0}),E=i?(()=>{try{const G=sessionStorage.getItem("pdv_calculadora_data");if(console.log("ðŸ” Calculadora Universal - Dados do PDV:",G),G){const{itens:ee}=JSON.parse(G),de=(ee||[]).filter(ue=>Bl(ue));return console.log("ðŸ¥« RaÃ§Ãµes encontradas:",de),de}}catch(G){console.error("Erro ao ler dados do PDV:",G)}return[]})():[];n.useEffect(()=>{if(!i&&N.length>=2){const G=setTimeout(async()=>{te(!0);try{const ee=await F.get("/produtos/",{params:{busca:N}}),ue=(ee.data.items||ee.data.produtos||[]).filter(Ae=>Ae.peso_embalagem&&Ae.peso_embalagem>0);P(ue)}catch(ee){console.error("Erro ao buscar raÃ§Ãµes:",ee)}finally{te(!1)}},300);return()=>clearTimeout(G)}else P([])},[N,i]),n.useEffect(()=>{a||Z({x:0,y:0})},[a]),n.useEffect(()=>{if(a&&i&&E.length>0){const G=E[E.length-1];g(G.produto_id),d(G),G.pet_id&&R(G.pet_id)}},[a,E.length,i]);const R=async G=>{try{const de=(await F.get(`/pets/${G}`)).data;C(de),A({...D,peso_pet_kg:de.peso_kg||de.peso||"",idade_meses:de.idade_meses||de.idade_aproximada||""})}catch(ee){console.error("Erro ao buscar pet:",ee)}},K=async()=>{if(console.log("ðŸ” Iniciando cÃ¡lculo..."),console.log("ðŸ“¦ RaÃ§Ã£o selecionada:",v),console.log("ðŸ“ FormulÃ¡rio:",D),!v){console.log("âŒ Nenhuma raÃ§Ã£o selecionada"),Ee.error("Selecione uma raÃ§Ã£o");return}if(!D.peso_pet_kg){console.log("âŒ Peso do pet nÃ£o informado"),Ee.error("Informe o peso do pet");return}try{c(!0),h(null),b(null);const ee={produto_id:v.produto_id||v.id,peso_pet_kg:parseFloat(D.peso_pet_kg),idade_meses:D.idade_meses?parseInt(D.idade_meses):null,nivel_atividade:D.nivel_atividade};console.log("ðŸ“¤ Enviando payload:",ee);const de=await F.post("/produtos/calculadora-racao",ee);if(console.log("ðŸ“¥ Resposta recebida:",de.data),de.data){const ue={duracao_pacote_dias:de.data.duracao_dias,duracao_meses:de.data.duracao_meses,consumo_diario_gramas:de.data.quantidade_diaria_g,custo_por_kg:de.data.custo_por_kg,custo_diario:de.data.custo_por_dia,custo_mensal:de.data.custo_mensal};b(ue),Ee.success("CÃ¡lculo realizado!")}}catch(ee){console.error("âŒ Erro ao calcular:",ee),Ee.error("Erro ao calcular. Tente novamente.")}finally{c(!1)}},B=G=>{g(G.id),d(G),w(`${G.nome} - ${G.peso_embalagem}kg`),k(!1)},_=G=>{l||G.target.closest("button")||G.target.closest("input")||G.target.closest("select")||(re(!0),J({x:G.clientX-M.x,y:G.clientY-M.y}))};return n.useEffect(()=>{const G=de=>{X&&Z({x:de.clientX-$.x,y:de.clientY-$.y})},ee=()=>{re(!1)};if(X)return window.addEventListener("mousemove",G),window.addEventListener("mouseup",ee),()=>{window.removeEventListener("mousemove",G),window.removeEventListener("mouseup",ee)}},[X,$]),a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start md:items-center justify-center z-50 p-0 md:p-4 overflow-y-auto",children:e.jsxs("div",{className:`
          bg-white 
          ${l?"w-full min-h-screen rounded-none":"rounded-xl w-full max-w-2xl max-h-[90vh]"} 
          shadow-2xl overflow-hidden flex flex-col
        `,style:l?{}:{transform:`translate(${M.x}px, ${M.y}px)`,cursor:X?"grabbing":"default"},children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white px-4 md:px-6 py-3 md:py-4 flex items-center justify-between",onMouseDown:l?void 0:_,style:{cursor:l?"default":X?"grabbing":"grab"},children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("span",{className:"text-2xl md:text-3xl",children:"ðŸ¥«"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold",children:"Calculadora de RaÃ§Ã£o"}),e.jsx("p",{className:"text-xs md:text-sm text-orange-100",children:i?"RaÃ§Ãµes do carrinho":"Buscar raÃ§Ã£o manualmente"})]})]}),e.jsx("button",{onClick:t,className:"p-1.5 md:p-2 hover:bg-orange-400 rounded-lg transition-colors",children:e.jsx(pa,{size:l?20:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700",children:[i?"RaÃ§Ã£o do Carrinho":"Buscar RaÃ§Ã£o"," *"]}),i?E.length>0?e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:(v==null?void 0:v.produto_nome)||"",readOnly:!0,className:"w-full px-4 py-3 pr-10 bg-gray-50 border-2 border-gray-300 rounded-lg text-gray-700 font-medium cursor-pointer",placeholder:"Nenhuma raÃ§Ã£o no carrinho"}),e.jsx("button",{type:"button",onClick:()=>k(!p),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:e.jsx(Ys,{size:20,className:`transition-transform ${p?"rotate-180":""}`})}),p&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-300 rounded-lg shadow-xl z-10 max-h-48 overflow-y-auto",children:E.map((G,ee)=>e.jsxs("button",{type:"button",onClick:()=>{g(G.produto_id),d(G),k(!1),G.pet_id&&R(G.pet_id)},className:`w-full px-4 py-3 text-left hover:bg-orange-50 transition-colors ${G.produto_id===j?"bg-orange-100 border-l-4 border-l-orange-600":""}`,children:[e.jsx("div",{className:"font-medium",children:G.produto_nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:[G.peso_embalagem,"kg â€¢ R$ ",G.preco_unitario.toFixed(2),G.pet_id&&" â€¢ ðŸ¾ Pet vinculado"]})]},ee))})]}):e.jsx("div",{className:"px-4 py-3 bg-yellow-50 border-2 border-yellow-300 rounded-lg text-yellow-700",children:"Adicione raÃ§Ãµes ao carrinho para calcular"}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:N,onChange:G=>w(G.target.value),onFocus:()=>S.length>0&&k(!0),placeholder:"Digite para buscar raÃ§Ã£o...",className:"w-full px-4 py-3 pr-20 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200"}),W?e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx(mo,{size:20,className:"animate-spin text-orange-500"})}):S.length>0&&e.jsx("button",{type:"button",onClick:()=>k(!p),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:e.jsx(Ys,{size:20,className:`transition-transform ${p?"rotate-180":""}`})})]}),p&&S.length>0&&e.jsx("div",{className:"bg-white border-2 border-gray-300 rounded-lg shadow-xl max-h-64 overflow-y-auto",children:S.map(G=>{var ee;return e.jsxs("button",{type:"button",onClick:()=>B(G),className:`w-full px-4 py-3 text-left hover:bg-orange-50 transition-colors border-b last:border-b-0 ${G.id===j?"bg-orange-100 border-l-4 border-l-orange-600":""}`,children:[e.jsx("div",{className:"font-medium",children:G.nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:[G.peso_embalagem,"kg â€¢ R$ ",(ee=G.preco_venda)==null?void 0:ee.toFixed(2),G.classificacao_racao&&` â€¢ ${G.classificacao_racao}`]})]},G.id)})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Peso do Pet (kg) *"}),e.jsx("input",{type:"number",step:"0.1",value:D.peso_pet_kg,onChange:G=>A({...D,peso_pet_kg:G.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200",placeholder:"Ex: 8.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Idade (meses)"}),e.jsx("input",{type:"number",value:D.idade_meses,onChange:G=>A({...D,idade_meses:G.target.value}),className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200",placeholder:"Ex: 24"})]})]}),i&&m&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx("span",{className:"text-xl",children:"ðŸ•"}),e.jsx("span",{className:"font-medium",children:m.nome})]}),e.jsx("div",{className:"text-sm text-blue-600 mt-1",children:"Dados carregados automaticamente do cadastro"})]}),f&&e.jsxs("div",{className:"bg-green-50 border-2 border-green-200 rounded-xl p-6 space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-green-800 flex items-center gap-2",children:[e.jsx("span",{children:"âœ…"})," Resultados do CÃ¡lculo"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"â±ï¸ DuraÃ§Ã£o"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[Math.floor(f.duracao_pacote_dias)," dias"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(O=f.duracao_meses)==null?void 0:O.toFixed(1)," meses"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"ðŸ¥« Consumo diÃ¡rio"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[(q=f.consumo_diario_gramas)==null?void 0:q.toFixed(0),"g"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"ðŸ’° Custo/kg"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",(ae=f.custo_por_kg)==null?void 0:ae.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"ðŸ“… Custo/dia"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",(H=f.custo_diario)==null?void 0:H.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 col-span-1 sm:col-span-2",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"ðŸ“† Custo mensal"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",(le=f.custo_mensal)==null?void 0:le.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border-t px-4 md:px-6 py-3 md:py-4 flex flex-col-reverse sm:flex-row justify-end gap-2 md:gap-3",children:[e.jsx("button",{onClick:t,className:"px-6 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors font-medium",children:"Fechar"}),e.jsx("button",{onClick:K,disabled:y,className:"px-6 py-3 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white rounded-lg font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:y?e.jsxs(e.Fragment,{children:[e.jsx(mo,{size:20,className:"animate-spin"}),"Calculando..."]}):e.jsx(e.Fragment,{children:"ðŸ§® Calcular Consumo"})})]})]})}):null}const Sc=()=>{var u,h,p,k;const a=Co(),{user:t,logout:s}=$t(),[o,r]=n.useState(window.innerWidth<768);n.useEffect(()=>{const N=()=>{r(window.innerWidth<768)};return window.addEventListener("resize",N),()=>window.removeEventListener("resize",N)},[]);const i=N=>{var S,P;return t?((S=t.role)==null?void 0:S.name)==="admin"||((P=t.role)==null?void 0:P.name)==="Admin"?!0:!t.permissions||!Array.isArray(t.permissions)?!1:t.permissions.includes(N):!1},[l,x]=n.useState(()=>{if(window.innerWidth<768)return!1;const N=localStorage.getItem("sidebar_open");return N!==null?JSON.parse(N):a.pathname!=="/pdv"}),[j,g]=n.useState({}),[v,d]=n.useState(()=>{const N=localStorage.getItem("sidebar_visible");return N!==null?JSON.parse(N):!0}),[m,C]=n.useState(!1),y=()=>{o&&x(!1)};n.useEffect(()=>{o||localStorage.setItem("sidebar_open",JSON.stringify(l))},[l,o]),n.useEffect(()=>{o||localStorage.setItem("sidebar_visible",JSON.stringify(v))},[v,o]),n.useEffect(()=>{o&&x(!1)},[a.pathname,o]);const f=[{path:"/dashboard",icon:mi,label:"Dashboard",permission:"relatorios.gerencial"},{path:"/dashboard-gerencial",icon:Ar,label:"ðŸ“Š Dashboard Gerencial",highlight:!0,permission:"relatorios.gerencial"},{path:"/clientes",icon:el,label:"Pessoas",permission:"clientes.visualizar"},{path:"/pets",icon:$a,label:"ðŸ¾ Pets",highlight:!0,permission:"clientes.visualizar"},{path:"/produtos",icon:Zt,label:"Produtos",permission:"produtos.visualizar",submenu:[{path:"/produtos",label:"Listar Produtos",permission:"produtos.visualizar"},{path:"/produtos/relatorio",label:"RelatÃ³rio de MovimentaÃ§Ãµes",permission:"produtos.visualizar"},{path:"/estoque/alertas",label:"Alertas de Estoque",permission:"produtos.visualizar"}]},{path:"/lembretes",icon:al,label:"Lembretes",badge:!0,permission:null},{path:"/calculadora-racao",icon:ui,label:"Calculadora de RaÃ§Ã£o",permission:null},{path:"/pdv",icon:Nt,label:"PDV (Vendas)",permission:"vendas.criar"},{path:"/notas-fiscais",icon:pi,label:"Notas Fiscais",permission:"vendas.visualizar"},{path:"/compras",icon:gi,label:"Compras",permission:"compras.gerenciar",submenu:[{path:"/compras/pedidos",label:"Pedidos de Compra",permission:"compras.pedidos"},{path:"/compras/entrada-xml",label:"Entrada por XML",permission:"compras.entrada_xml"},{path:"/compras/bling",label:"Sinc. Bling",permission:"compras.sincronizacao_bling"}]},{path:"/financeiro",icon:ot,label:"Financeiro/ContÃ¡bil",permission:"relatorios.financeiro",submenu:[{path:"/financeiro",label:"Dashboard",permission:"financeiro.dashboard"},{path:"/financeiro/vendas",label:"Vendas",permission:"financeiro.vendas"},{path:"/financeiro/fluxo-caixa",label:"Fluxo de Caixa",permission:"financeiro.fluxo_caixa"},{path:"/financeiro/dre",label:"DRE",permission:"financeiro.dre"},{path:"/financeiro/contas-pagar",label:"Contas a Pagar",permission:"financeiro.contas_pagar"},{path:"/financeiro/contas-receber",label:"Contas a Receber",permission:"financeiro.contas_receber"},{path:"/financeiro/conciliacao-bancaria",label:"ConciliaÃ§Ã£o BancÃ¡ria",permission:"financeiro.conciliacao_bancaria"},{path:"/financeiro/conciliacao-3abas",label:"ConciliaÃ§Ã£o 3 Abas",highlight:!0,permission:"financeiro.conciliacao_cartao"}]},{path:"/comissoes",icon:es,label:"ComissÃµes",permission:"relatorios.financeiro",submenu:[{path:"/comissoes",label:"ConfiguraÃ§Ã£o",permission:"comissoes.configurar"},{path:"/comissoes/demonstrativo",label:"Demonstrativo",permission:"comissoes.demonstrativo"},{path:"/comissoes/abertas",label:"ComissÃµes em Aberto",permission:"comissoes.abertas"},{path:"/comissoes/fechamentos",label:"HistÃ³rico de Fechamentos",permission:"comissoes.fechamentos"},{path:"/comissoes/relatorios",label:"ðŸ“Š RelatÃ³rios AnalÃ­ticos",permission:"comissoes.relatorios"}]},{path:"/entregas",icon:ft,label:"Entregas",permission:"vendas.visualizar",submenu:[{path:"/entregas/abertas",label:"Entregas em Aberto",permission:"entregas.abertas"},{path:"/entregas/rotas",label:"Rotas de Entrega",permission:"entregas.rotas"},{path:"/entregas/historico",label:"ðŸ“œ HistÃ³rico",permission:"entregas.historico"},{path:"/entregas/financeiro",label:"ðŸ“Š Dashboard Financeiro",permission:"entregas.dashboard"}]},{path:"/cadastros",icon:Ot,label:"Cadastros",permission:"configuracoes.editar",submenu:[{path:"/cadastros/cargos",label:"Cargos",permission:"cadastros.cargos"},{path:"/cadastros/categorias",label:"Categorias de Produtos",permission:"cadastros.categorias_produtos"},{path:"/cadastros/categorias-financeiras",label:"Categorias Financeiras",permission:"cadastros.categorias_financeiras"},{path:"/cadastros/especies-racas",label:"EspÃ©cies e RaÃ§as",permission:"cadastros.especies_racas"},{path:"/cadastros/opcoes-racao",label:"OpÃ§Ãµes de RaÃ§Ã£o",permission:"produtos.editar"},{path:"/cadastros/financeiro/bancos",label:"Bancos",permission:"cadastros.bancos"},{path:"/cadastros/financeiro/formas-pagamento",label:"Formas de Pagamento",permission:"cadastros.formas_pagamento"},{path:"/cadastros/financeiro/operadoras",label:"Operadoras de CartÃ£o",permission:"cadastros.operadoras"}]},{path:"/rh",icon:hi,label:"Recursos Humanos",permission:"usuarios.manage",submenu:[{path:"/rh/funcionarios",label:"FuncionÃ¡rios",permission:"rh.funcionarios"}]},{path:"/ia",icon:bi,label:"InteligÃªncia Artificial",permission:null,submenu:[{path:"/ia/chat",label:"Chat IA",permission:null},{path:"/ia/fluxo-caixa",label:"Fluxo de Caixa Preditivo",permission:"ia.fluxo_caixa"},{path:"/ia/whatsapp",label:"Bot WhatsApp",permission:"ia.whatsapp"},{path:"/ia/alertas-racao",label:"âš  Alertas RaÃ§Ãµes",permission:"produtos.editar"}]},{path:"/admin",icon:sl,label:"AdministraÃ§Ã£o",permission:"usuarios.manage",submenu:[{path:"/admin/usuarios",label:"UsuÃ¡rios",permission:"usuarios.manage"},{path:"/admin/roles",label:"Roles & PermissÃµes",permission:"usuarios.manage"}]},{path:"/configuracoes",icon:Ot,label:"ConfiguraÃ§Ãµes",permission:"configuracoes.editar",submenu:[{path:"/configuracoes/fiscal",label:"ConfiguraÃ§Ã£o da Empresa",permission:"configuracoes.empresa"},{path:"/configuracoes/entregas",label:"Entregas",permission:"configuracoes.entregas"},{path:"/configuracoes/custos-moto",label:"Custos da Moto",permission:"configuracoes.custos_moto"},{path:"/configuracoes/estoque",label:"Estoque"},{path:"/configuracoes/simples/fechamento",label:"Fechamento Mensal",permission:"configuracoes.fechamento_mensal"}]}].filter(N=>{if(N.submenu&&Array.isArray(N.submenu)){const w=N.submenu.filter(S=>S.permission?i(S.permission):!0);if(w.length===0)return!1;N.submenu=w}return N.permission?i(N.permission):!0}),b=N=>a.pathname===N;return e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[o&&l&&v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden",onClick:()=>x(!1)}),v&&e.jsxs("aside",{className:`${o?`fixed inset-y-0 left-0 z-50 w-64 transform transition-transform duration-300 ${l?"translate-x-0":"-translate-x-full"}`:`${l?"w-64":"w-20"} transition-all duration-300`} bg-gradient-to-b from-indigo-50 to-purple-50 border-r border-indigo-100 flex flex-col shadow-lg`,children:[e.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-indigo-100 bg-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[!o&&e.jsx("button",{onClick:()=>x(!l),className:"w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-400 to-purple-500 hover:from-indigo-500 hover:to-purple-600 flex items-center justify-center shadow-md transition-all cursor-pointer",title:l?"Recolher menu":"Expandir menu",children:e.jsx(nn,{className:"text-white w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg text-gray-800",children:"Pet Shop Pro"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Central de GestÃ£o"})]})]}),e.jsx("button",{onClick:()=>o?x(!1):d(!1),className:"p-2 hover:bg-indigo-100 rounded-lg transition-colors",title:o?"Fechar menu":"Esconder menu completamente",children:o?e.jsx(ks,{className:"w-6 h-6 text-indigo-600"}):e.jsx($a,{className:"w-5 h-5 text-indigo-600"})})]}),e.jsx("nav",{className:"flex-1 py-4 overflow-y-auto",children:Array.isArray(f)&&f.map(N=>e.jsx("div",{children:N.submenu?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{g(w=>({...w,[N.path]:!w[N.path]}))},className:`w-full flex items-center justify-between gap-3 px-4 py-3 mx-2 rounded-lg transition-all ${a.pathname.startsWith(N.path)?"bg-gradient-to-r from-indigo-100 to-purple-100 text-indigo-700 shadow-sm":"text-gray-700 hover:bg-white/60"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N.icon,{className:"text-lg flex-shrink-0"}),l&&e.jsx("span",{className:"font-medium text-sm",children:N.label})]}),l&&(j[N.path]?e.jsx(nt,{className:"text-sm text-gray-400"}):e.jsx(Zs,{className:"text-sm text-gray-400"}))]}),j[N.path]&&l&&e.jsx("div",{className:"mt-1 mb-2 space-y-1",children:Array.isArray(N.submenu)&&N.submenu.map(w=>e.jsx(_t,{to:w.path,onClick:y,className:`flex items-center gap-3 px-4 py-2 mx-2 ml-12 rounded-lg transition-all text-sm ${b(w.path)?"bg-white text-indigo-600 shadow-sm font-medium":"text-gray-600 hover:bg-white/50"}`,children:e.jsx("span",{children:w.label})},w.path))})]}):e.jsxs(_t,{to:N.path,onClick:y,className:`flex items-center gap-3 px-4 py-3 mx-2 my-1 rounded-lg transition-all ${b(N.path)?"bg-gradient-to-r from-indigo-100 to-purple-100 text-indigo-700 shadow-sm":"text-gray-700 hover:bg-white/60"}`,title:l?"":N.label,children:[e.jsx(N.icon,{className:"text-lg flex-shrink-0"}),l&&e.jsxs("div",{className:"flex items-center justify-between flex-1",children:[e.jsx("span",{className:"font-medium text-sm",children:N.label}),N.badge&&e.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full animate-pulse"})]})]})},N.path))}),e.jsx("div",{className:"border-t border-indigo-100 bg-white/30",children:e.jsxs("button",{onClick:s,className:"w-full flex items-center gap-3 px-4 py-3 mx-2 my-2 rounded-lg text-gray-700 hover:bg-red-50 hover:text-red-600 transition-all text-left",title:l?"":"Sair",children:[e.jsx(fi,{className:"text-lg"}),l&&e.jsx("span",{className:"font-medium text-sm",children:"Sair"})]})})]}),!v&&!o&&e.jsx("button",{onClick:()=>d(!0),className:"fixed left-0 top-4 z-50 p-3 bg-gradient-to-br from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white rounded-r-xl shadow-lg transition-all",title:"Mostrar menu",children:e.jsx($a,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-3 md:px-6 py-3 md:py-4 flex items-center justify-between",children:[o&&v&&e.jsx("button",{onClick:()=>x(!l),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors md:hidden","aria-label":"Toggle menu",children:e.jsx(nn,{className:"w-6 h-6 text-gray-700"})}),o&&!v&&e.jsx("button",{onClick:()=>d(!0),className:"p-2 rounded-lg hover:bg-indigo-100 transition-colors md:hidden","aria-label":"Mostrar menu",children:e.jsx($a,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 ml-auto",children:[e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:(t==null?void 0:t.nome)||(t==null?void 0:t.email)}),e.jsx("p",{className:"text-xs text-gray-500",children:t==null?void 0:t.email})]}),e.jsx("div",{className:"w-9 h-9 md:w-10 md:h-10 rounded-full bg-purple-600 flex items-center justify-center text-white font-bold text-sm md:text-base",children:((h=(u=t==null?void 0:t.nome)==null?void 0:u[0])==null?void 0:h.toUpperCase())||((k=(p=t==null?void 0:t.email)==null?void 0:p[0])==null?void 0:k.toUpperCase())})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-3 md:p-6",children:e.jsx(ji,{})})]}),e.jsx(Cc,{onClick:()=>{console.log("ðŸŽ¯ Layout: Abrindo calculadora..."),C(!0)}}),m&&e.jsx(kc,{isOpen:m,onClose:()=>{console.log("ðŸŽ¯ Layout: Fechando calculadora..."),C(!1)}})]})},Ec=()=>{const[a,t]=n.useState(""),[s,o]=n.useState(""),[r,i]=n.useState(""),[l,x]=n.useState(!1),[j,g]=n.useState(!1),{login:v}=$t(),d=va(),m=async C=>{var y,c;C.preventDefault(),i(""),g(!0);try{const f=await v(a,s);if(f.success){const b=localStorage.getItem("user");if(b){const u=JSON.parse(b),h=(c=(y=u.role)==null?void 0:y.name)==null?void 0:c.toLowerCase();console.log("ðŸ‘¤ Role do usuÃ¡rio:",h),console.log("ðŸ‘¤ PermissÃµes:",u.permissions),h==="caixa"?(console.log("ðŸŽ¯ UsuÃ¡rio caixa - Navegando para /pdv"),d("/pdv")):h==="admin"||h==="gerente"?(console.log("ðŸŽ¯ UsuÃ¡rio gerencial - Navegando para /dashboard"),d("/dashboard")):(console.log("ðŸŽ¯ Redirecionando para /lembretes"),d("/lembretes"))}else d("/lembretes")}else console.error("âŒ Login falhou:",f.error),i(f.error||"Erro desconhecido ao fazer login")}catch(f){console.error("âŒ Erro inesperado:",f),i("Erro inesperado ao fazer login")}finally{g(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-purple-700 to-purple-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 animate-fade-in",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-purple-100 rounded-full mb-4",children:e.jsx($a,{className:"w-8 h-8 text-purple-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Pet Shop Pro"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Sistema de GestÃ£o Completo"})]}),r&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(Ca,{className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:r})]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(ko,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"email",value:a,onChange:C=>t(C.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"seu@email.com",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(uo,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:l?"text":"password",value:s,onChange:C=>o(C.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0}),"              ",e.jsx("button",{type:"button",onClick:()=>x(!l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition",children:l?e.jsx(po,{}):e.jsx(Dr,{})}),"            "]})]}),e.jsx("button",{type:"submit",disabled:j,className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Entrando...":"Entrar"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["NÃ£o tem uma conta?"," ",e.jsx(_t,{to:"/register",className:"text-purple-600 hover:text-purple-700 font-semibold",children:"Criar conta"})]})})]})})},Fc=()=>{const[a,t]=n.useState(""),[s,o]=n.useState(""),[r,i]=n.useState(""),[l,x]=n.useState(""),[j,g]=n.useState(""),[v,d]=n.useState(!1),[m,C]=n.useState(!1),[y,c]=n.useState(!1),{register:f}=$t(),b=va(),u=async h=>{if(h.preventDefault(),g(""),r!==l){g("As senhas nÃ£o coincidem");return}if(r.length<6){g("A senha deve ter no mÃ­nimo 6 caracteres");return}c(!0);const p=await f(s,r,a);p.success?b("/dashboard"):g(p.error),c(!1)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-purple-700 to-purple-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 animate-fade-in",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-purple-100 rounded-full mb-4",children:e.jsx($a,{className:"w-8 h-8 text-purple-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Criar Conta"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Comece a usar o Pet Shop Pro"})]}),j&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(Ca,{className:"flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:j})]}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome"}),e.jsxs("div",{className:"relative",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:a,onChange:h=>t(h.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"Seu nome",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(ko,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"email",value:s,onChange:h=>o(h.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"seu@email.com",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(uo,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:v?"text":"password",value:r,onChange:h=>i(h.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0}),e.jsx("button",{type:"button",onClick:()=>d(!v),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition",children:v?e.jsx(po,{}):e.jsx(Dr,{})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirmar Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(uo,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:m?"text":"password",value:l,onChange:h=>x(h.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0}),e.jsx("button",{type:"button",onClick:()=>C(!m),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition",children:m?e.jsx(po,{}):e.jsx(Dr,{})})]})]}),e.jsx("button",{type:"submit",disabled:y,className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:y?"Criando conta...":"Criar Conta"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["JÃ¡ tem uma conta?"," ",e.jsx(_t,{to:"/login",className:"text-purple-600 hover:text-purple-700 font-semibold",children:"Fazer login"})]})})]})})};function Pc({isOpen:a,onClose:t,onSuccess:s}){var f,b;const[o,r]=n.useState(null),[i,l]=n.useState(!1),[x,j]=n.useState(null),[g,v]=n.useState("upload"),d=u=>{const h=u.target.files[0];h&&(h.name.endsWith(".xlsx")||h.name.endsWith(".xls")?(r(h),j(null)):(Ee.error("Arquivo deve ser Excel (.xlsx ou .xls)"),u.target.value=""))},m=async()=>{try{const u=localStorage.getItem("access_token")||localStorage.getItem("token"),h=await F.get("/pessoas/template-importacao",{headers:{Authorization:`Bearer ${u}`},responseType:"blob"}),p=window.URL.createObjectURL(new Blob([h.data])),k=document.createElement("a");k.href=p,k.setAttribute("download",`template_pessoas_${new Date().toISOString().split("T")[0]}.xlsx`),document.body.appendChild(k),k.click(),k.remove(),window.URL.revokeObjectURL(p),Ee.success("Template baixado com sucesso!")}catch(u){console.error("Erro ao baixar template:",u),Ee.error("Erro ao baixar template")}},C=async()=>{var u,h,p,k;if(!o){Ee.error("Selecione um arquivo para importar");return}l(!0),v("processando");try{const N=new FormData;N.append("file",o);const w=await F.post("/pessoas/importar",N);j(w.data),v("resultado");const S=(((u=w.data.criados)==null?void 0:u.length)||0)+(((h=w.data.atualizados)==null?void 0:h.length)||0);S>0&&(Ee.success(`${S} pessoas processadas com sucesso!`),s&&s()),w.data.total_erros>0&&Ee.error(`${w.data.total_erros} pessoas com erro`)}catch(N){console.error("Erro ao importar:",N),Ee.error(((k=(p=N.response)==null?void 0:p.data)==null?void 0:k.detail)||"Erro ao importar pessoas"),v("upload")}finally{l(!1)}},y=()=>{r(null),j(null),v("upload")},c=()=>{y(),t()};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gradient-to-r from-purple-600 to-purple-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"ImportaÃƒÂ§ÃƒÂ£o de Pessoas em Lote"})]}),e.jsx("button",{onClick:c,className:"text-white hover:text-gray-200 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[g==="upload"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-purple-900 mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Como funciona"]}),e.jsxs("ul",{className:"text-sm text-purple-800 space-y-1 ml-7",children:[e.jsx("li",{children:"1. Baixe o template Excel clicando no botÃƒÂ£o abaixo"}),e.jsx("li",{children:"2. Preencha os dados das pessoas (clientes, fornecedores, veterinÃƒÂ¡rios)"}),e.jsx("li",{children:"3. Salve o arquivo e faÃƒÂ§a o upload aqui"}),e.jsx("li",{children:"4. Pessoas novas serÃƒÂ£o criadas, existentes serÃƒÂ£o atualizadas (baseado no CPF/CNPJ)"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:m,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Baixar Template Excel"]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecione a Planilha Preenchida"}),e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx("svg",{className:"w-12 h-12 mb-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:"Clique para selecionar"})," ou arraste o arquivo"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Apenas arquivos Excel (.xlsx, .xls)"}),o&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-purple-600",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"font-medium",children:o.name})]})]}),e.jsx("input",{type:"file",className:"hidden",accept:".xlsx,.xls",onChange:d})]})})]})]}),g==="processando"&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mb-4"}),e.jsx("p",{className:"text-lg text-gray-700",children:"Processando planilha..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Isso pode levar alguns segundos"})]}),g==="resultado"&&x&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:x.total_processados||0}),e.jsx("div",{className:"text-sm text-blue-800 mt-1",children:"Total Processado"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:((f=x.criados)==null?void 0:f.length)||0}),e.jsx("div",{className:"text-sm text-green-800 mt-1",children:"Criados"})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:((b=x.atualizados)==null?void 0:b.length)||0}),e.jsx("div",{className:"text-sm text-yellow-800 mt-1",children:"Atualizados"})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:x.total_erros||0}),e.jsx("div",{className:"text-sm text-red-800 mt-1",children:"Erros"})]})]}),x.criados&&x.criados.length>0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-green-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Pessoas Criadas (",x.criados.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-1",children:x.criados.map((u,h)=>e.jsxs("li",{className:"text-green-800",children:["Linha ",u.linha,": ",e.jsx("span",{className:"font-medium",children:u.nome})," (",u.tipo,")"]},h))})})]}),x.atualizados&&x.atualizados.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-yellow-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Pessoas Atualizadas (",x.atualizados.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-1",children:x.atualizados.map((u,h)=>e.jsxs("li",{className:"text-yellow-800",children:["Linha ",u.linha,": ",e.jsx("span",{className:"font-medium",children:u.nome})," (",u.tipo,")"]},h))})})]}),x.erros&&x.erros.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-red-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Erros (",x.erros.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-2",children:x.erros.map((u,h)=>e.jsxs("li",{className:"text-red-800",children:[e.jsxs("strong",{children:["Linha ",u.linha]})," (",u.nome||"?","): ",u.erro]},h))})})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3 bg-gray-50",children:[g==="upload"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:C,disabled:!o||i,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Importando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Importar Pessoas"]})})]}),g==="resultado"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:y,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Importar Novamente"}),e.jsx("button",{onClick:c,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Concluir"})]})]})]})}):null}const Rc={venda:Nt,conta_receber:es,pet_cadastro:$a,pet_atualizacao:$a,pedido_compra:Zt,conta_pagar:es,recebimento:ft,vacina:ps,consulta:ps,whatsapp:Ls},Rn={green:"bg-green-100 text-green-700 border-green-300",yellow:"bg-yellow-100 text-yellow-700 border-yellow-300",red:"bg-red-100 text-red-700 border-red-300",blue:"bg-blue-100 text-blue-700 border-blue-300",purple:"bg-purple-100 text-purple-700 border-purple-300",gray:"bg-gray-100 text-gray-700 border-gray-300"},Lo=({clienteId:a,fornecedorId:t,tipo:s="cliente",limit:o=5,showHeader:r=!0,onVerMais:i})=>{const[l,x]=n.useState([]),[j,g]=n.useState(!0),[v,d]=n.useState(""),m=s==="fornecedor"?t:a,C=s==="fornecedor"?`/clientes/fornecedor/${m}/timeline`:`/clientes/${m}/timeline`;n.useEffect(()=>{m&&y()},[m,o,s]);const y=async()=>{var b,u,h;try{g(!0),d("");const p=await F.get(`${C}?limit=${o}`);x(p.data)}catch(p){((b=p.response)==null?void 0:b.status)===500||((u=p.response)==null?void 0:u.status)===404?(console.warn("Timeline nÃ£o disponÃ­vel:",(h=p.response)==null?void 0:h.status),x([]),d("")):(console.error("Erro ao carregar timeline:",p),d("Erro ao carregar timeline"))}finally{g(!1)}},c=b=>{const u=new Date(b),h=new Date,p=new Date(h);return p.setDate(p.getDate()-1),u.toDateString()===h.toDateString()?`Hoje Ã s ${u.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:u.toDateString()===p.toDateString()?`Ontem Ã s ${u.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`:u.toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})},f=b=>{console.log("Evento clicado:",b)};return j?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Carregando timeline..."})]})}):v?e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(Ca,{}),v]}):l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ps,{className:"mx-auto text-gray-300 mb-4",size:48}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nenhum evento registrado"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Eventos do cliente aparecerÃ£o aqui conforme forem acontecendo"})]}):e.jsxs("div",{className:"space-y-4",children:[r&&e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(ps,{className:"text-blue-600"}),"Linha do Tempo"]}),i&&e.jsx("button",{onClick:i,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Ver completa â†’"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-[19px] top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-6",children:l.map((b,u)=>{const h=Rc[b.tipo_evento]||ps,p=Rn[b.cor_badge]||Rn.gray;return e.jsxs("div",{className:"relative pl-12 group",children:[e.jsx("div",{className:"absolute left-0 top-0 w-10 h-10 rounded-full bg-white border-2 border-gray-200 flex items-center justify-center group-hover:border-blue-400 transition-colors",children:e.jsx(h,{className:"text-gray-600 group-hover:text-blue-600 transition-colors",size:18})}),e.jsxs("div",{onClick:()=>f(b),className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md hover:border-gray-300 transition-all cursor-pointer",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:b.titulo}),e.jsx("p",{className:"text-sm text-gray-600",children:b.descricao})]}),e.jsx("span",{className:`ml-3 px-2 py-1 text-xs font-medium rounded border ${p} whitespace-nowrap`,children:b.status})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-3 pt-3 border-t border-gray-100",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(et,{size:12}),c(b.data_evento)]}),b.pet_id&&e.jsxs("span",{className:"flex items-center gap-1 text-blue-600",children:[e.jsx($a,{size:12}),"Pet relacionado"]})]})]})]},`${b.tipo_evento}-${b.evento_id}-${u}`)})})]}),l.length>=o&&i&&e.jsx("div",{className:"text-center pt-4",children:e.jsx("button",{onClick:i,className:"text-sm text-blue-600 hover:text-blue-700 font-medium underline",children:"Ver todos os eventos â†’"})})]})};Lo.propTypes={clienteId:mt.number,fornecedorId:mt.number,tipo:mt.oneOf(["cliente","fornecedor"]),limit:mt.number,showHeader:mt.bool,onVerMais:mt.func};const Pt={VIP:{color:"purple",bgClass:"bg-purple-100",textClass:"text-purple-800",borderClass:"border-purple-300",icon:tl,descricao:"Cliente de alto valor",emoji:"ðŸ‘‘"},Recorrente:{color:"blue",bgClass:"bg-blue-100",textClass:"text-blue-800",borderClass:"border-blue-300",icon:ot,descricao:"Compra com frequÃªncia",emoji:"ðŸ”„"},Novo:{color:"green",bgClass:"bg-green-100",textClass:"text-green-800",borderClass:"border-green-300",icon:vs,descricao:"Cliente recente",emoji:"ðŸŒŸ"},Inativo:{color:"gray",bgClass:"bg-gray-100",textClass:"text-gray-800",borderClass:"border-gray-300",icon:et,descricao:"Sem compras recentes",emoji:"â°"},Endividado:{color:"red",bgClass:"bg-red-100",textClass:"text-red-800",borderClass:"border-red-300",icon:Ca,descricao:"Alto saldo devedor",emoji:"âš ï¸"},Risco:{color:"orange",bgClass:"bg-orange-100",textClass:"text-orange-800",borderClass:"border-orange-300",icon:Hr,descricao:"DiminuiÃ§Ã£o de frequÃªncia",emoji:"ðŸ“‰"},Regular:{color:"gray",bgClass:"bg-gray-100",textClass:"text-gray-600",borderClass:"border-gray-200",icon:vs,descricao:"Cliente regular",emoji:"ðŸ‘¤"}};function $c({segmento:a,size:t="sm",showIcon:s=!1}){if(!a)return null;const o=Pt[a]||Pt.Regular,r=o.icon,i={xs:"text-xs px-2 py-0.5",sm:"text-xs px-2 py-1",md:"text-sm px-3 py-1.5",lg:"text-base px-4 py-2"};return e.jsxs("span",{className:`inline-flex items-center gap-1 font-medium rounded-full ${o.bgClass} ${o.textClass} ${i[t]}`,title:o.descricao,children:[s&&e.jsx(r,{size:t==="xs"?10:t==="sm"?12:14}),o.emoji," ",a]})}function Ac({tag:a}){const t=Pt[a]||Pt.Regular;return e.jsxs("span",{className:`inline-flex items-center gap-1 text-xs font-medium px-2 py-1 rounded-md ${t.bgClass} ${t.textClass}`,title:t.descricao,children:[t.emoji," ",a]})}function Nr(a){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a)}function Dc({clienteId:a,compact:t=!1}){const[s,o]=n.useState(null),[r,i]=n.useState(!0),[l,x]=n.useState(null),[j,g]=n.useState(!1);n.useEffect(()=>{a&&v()},[a]);const v=async()=>{var b;try{i(!0),x(null);const u=await F.get(`/segmentacao/clientes/${a}`);o(u.data)}catch(u){((b=u.response)==null?void 0:b.status)===404?x("not_calculated"):(x("Erro ao carregar segmentaÃ§Ã£o"),console.error("Erro ao carregar segmentaÃ§Ã£o:",u))}finally{i(!1)}},d=async()=>{try{g(!0);const b=await F.post(`/segmentacao/clientes/${a}/recalcular`);o(b.data),x(null)}catch(b){console.error("Erro ao recalcular segmento:",b),alert("Erro ao recalcular segmento. Tente novamente.")}finally{g(!1)}};if(r)return e.jsxs("div",{className:"animate-pulse bg-gray-100 rounded-lg p-6",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]});if(l==="not_calculated")return e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ca,{className:"text-yellow-600 mt-1",size:20}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-yellow-900 mb-2",children:"SegmentaÃ§Ã£o nÃ£o calculada"}),e.jsx("p",{className:"text-sm text-yellow-800 mb-4",children:"Este cliente ainda nÃ£o foi segmentado. Clique abaixo para calcular."}),e.jsxs("button",{onClick:d,disabled:j,className:"flex items-center gap-2 px-4 py-2 bg-yellow-600 hover:bg-yellow-700 disabled:bg-yellow-400 text-white rounded-lg transition-colors text-sm font-medium",children:[e.jsx(Ut,{className:j?"animate-spin":""}),j?"Calculando...":"Calcular segmento"]})]})]})});if(l&&l!=="not_calculated")return e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-red-800",children:l})});if(!s)return null;const m=Pt[s.segmento]||Pt.Regular,C=m.icon,y=s.metricas||{},c={purple:"bg-gradient-to-br from-purple-50 to-purple-100 border-2 border-purple-300",blue:"bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-300",green:"bg-gradient-to-br from-green-50 to-green-100 border-2 border-green-300",gray:"bg-gradient-to-br from-gray-50 to-gray-100 border-2 border-gray-300",red:"bg-gradient-to-br from-red-50 to-red-100 border-2 border-red-300",orange:"bg-gradient-to-br from-orange-50 to-orange-100 border-2 border-orange-300"},f=c[m.color]||c.gray;return t?e.jsx($c,{segmento:s.segmento,size:"sm"}):e.jsxs("div",{className:`${f} rounded-xl p-6 shadow-sm`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-3 ${m.bgClass} rounded-lg`,children:e.jsx(C,{className:m.textClass,size:24})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[m.emoji," SegmentaÃ§Ã£o: ",e.jsx("span",{className:m.textClass,children:s.segmento})]}),e.jsx("p",{className:"text-sm text-gray-600",children:m.descricao})]})]}),e.jsxs("button",{onClick:d,disabled:j,className:"flex items-center gap-2 px-3 py-2 bg-white hover:bg-gray-50 disabled:bg-gray-100 border border-gray-300 text-gray-700 rounded-lg transition-colors text-sm",title:"Recalcular segmento",children:[e.jsx(Ut,{size:14,className:j?"animate-spin":""}),j?"Calculando...":"Atualizar"]})]}),s.tags&&s.tags.length>1&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-2",children:"TambÃ©m se enquadra em:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.filter(b=>b!==s.segmento).map(b=>e.jsx(Ac,{tag:b},b))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(es,{className:"text-gray-500",size:16}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Total 90 dias"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:Nr(y.total_compras_90d||0)})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Nt,{className:"text-gray-500",size:16}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Compras 90d"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:y.compras_90d||0})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ot,{className:"text-gray-500",size:16}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Ticket mÃ©dio"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:Nr(y.ticket_medio||0)})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(et,{className:"text-gray-500",size:16}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Ãšltima compra"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:y.ultima_compra_dias===9999?"Nunca":`${y.ultima_compra_dias} dias`})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white/60 rounded-lg p-2",children:[e.jsx("span",{className:"text-gray-600",children:"Total em aberto:"}),e.jsx("span",{className:`font-semibold ${y.total_em_aberto>0?"text-red-600":"text-green-600"}`,children:Nr(y.total_em_aberto||0)})]}),e.jsxs("div",{className:"flex justify-between items-center bg-white/60 rounded-lg p-2",children:[e.jsx("span",{className:"text-gray-600",children:"Cliente hÃ¡:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:y.primeira_compra_dias>0?`${y.primeira_compra_dias} dias`:"Sem compras"})]}),e.jsxs("div",{className:"flex justify-between items-center bg-white/60 rounded-lg p-2",children:[e.jsx("span",{className:"text-gray-600",children:"Total histÃ³rico:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:Nr(y.total_historico||0)})]}),e.jsxs("div",{className:"flex justify-between items-center bg-white/60 rounded-lg p-2",children:[e.jsx("span",{className:"text-gray-600",children:"Total de compras:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:y.total_compras_historico||0})]})]}),s.updated_at&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-300/50",children:e.jsxs("p",{className:"text-xs text-gray-600",children:["Atualizado em: ",new Date(s.updated_at).toLocaleString("pt-BR")]})})]})}const Mc={RISCO:{color:"red",bgClass:"bg-red-50",borderClass:"border-red-200",tagClass:"bg-red-100 text-red-700",label:"âš ï¸ Risco"},OPORTUNIDADE:{color:"green",bgClass:"bg-green-50",borderClass:"border-green-200",tagClass:"bg-green-100 text-green-700",label:"ðŸ’¡ Oportunidade"},ATENCAO:{color:"yellow",bgClass:"bg-yellow-50",borderClass:"border-yellow-200",tagClass:"bg-yellow-100 text-yellow-700",label:"ðŸ‘€ AtenÃ§Ã£o"}};function Lc(a,t,s,o){const r=[],i=new Date;if((t==null?void 0:t.segmento)==="VIP"&&(t==null?void 0:t.dias_desde_ultima_compra)>20&&r.push({tipo:"RISCO",icone:rl,titulo:"VIP em risco de churn",descricao:`Sem compras hÃ¡ ${t.dias_desde_ultima_compra} dias. Cliente VIP precisa de atenÃ§Ã£o especial.`,prioridade:10}),(t==null?void 0:t.dias_desde_ultima_compra)>90&&r.push({tipo:"RISCO",icone:et,titulo:"Cliente inativo hÃ¡ muito tempo",descricao:`Ãšltima compra foi hÃ¡ ${t.dias_desde_ultima_compra} dias. Considere campanha de reativaÃ§Ã£o.`,prioridade:8}),(t==null?void 0:t.saldo_devedor)>0&&(t==null?void 0:t.total_90d)>0&&(t==null?void 0:t.dias_desde_ultima_compra)<30){const l=t.saldo_devedor/t.total_90d*100;l>50&&r.push({tipo:"ATENCAO",icone:es,titulo:"Alto endividamento com atividade recente",descricao:`Saldo devedor de R$ ${t.saldo_devedor.toFixed(2)} (${l.toFixed(0)}% das compras). Avaliar condiÃ§Ãµes.`,prioridade:9})}if((t==null?void 0:t.segmento)==="Novo"&&(t==null?void 0:t.ticket_medio)>200&&r.push({tipo:"OPORTUNIDADE",icone:ot,titulo:"Novo cliente de alto valor",descricao:`Ticket mÃ©dio de R$ ${t.ticket_medio.toFixed(2)}. Potencial para se tornar VIP.`,prioridade:7}),o||r.push({tipo:"ATENCAO",icone:Ls,titulo:"WhatsApp nÃ£o registrado",descricao:"Adicione o nÃºmero para facilitar comunicaÃ§Ã£o e envio de promoÃ§Ãµes.",prioridade:5}),s&&s.length>0){const l=s.filter(x=>{if(!x.ultima_consulta)return!0;const j=new Date(x.ultima_consulta);return Math.floor((i-j)/(1e3*60*60*24))>60});if(l.length>0){const x=l[0].nome;r.push({tipo:"OPORTUNIDADE",icone:So,titulo:`Pet ${x} sem consulta hÃ¡ mais de 60 dias`,descricao:`${l.length===1?"Considere":`${l.length} pets precisam de`} check-up ou retorno.`,prioridade:6})}}return(t==null?void 0:t.segmento)==="Recorrente"&&(t==null?void 0:t.dias_desde_ultima_compra)>30&&r.push({tipo:"ATENCAO",icone:et,titulo:"Cliente recorrente com atraso",descricao:`Costuma comprar regularmente, mas estÃ¡ hÃ¡ ${t.dias_desde_ultima_compra} dias sem aparecer.`,prioridade:7}),(t==null?void 0:t.saldo_credito)>0&&r.push({tipo:"OPORTUNIDADE",icone:es,titulo:"Cliente tem crÃ©dito disponÃ­vel",descricao:`R$ ${t.saldo_credito.toFixed(2)} de crÃ©dito pode ser usado. Incentive o uso.`,prioridade:4}),r.sort((l,x)=>x.prioridade-l.prioridade).slice(0,3)}function Tc({clienteId:a,cliente:t,metricas:s}){const[o,r]=n.useState([]),[i,l]=n.useState(!1),[x,j]=n.useState([]);n.useEffect(()=>{a&&g()},[a,s]);const g=async()=>{try{l(!0);let v=(t==null?void 0:t.pets)||[];if(v.length===0&&a)try{v=(await F.get(`/clientes/${a}`)).data.pets||[]}catch(C){console.error("Erro ao carregar pets:",C)}j(v);const d=(t==null?void 0:t.celular)&&t.celular.trim()!=="",m=Lc(t,s,v,d);r(m)}catch(v){console.error("Erro ao calcular insights:",v),r([])}finally{l(!1)}};return i?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Vt,{className:"text-yellow-500",size:24}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"âš¡ Insights & AÃ§Ãµes"})]}),e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm",children:"Analisando cliente..."})]})]}):!o||o.length===0?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Vt,{className:"text-yellow-500",size:24}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"âš¡ Insights & AÃ§Ãµes"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-700",children:[e.jsx(at,{size:20}),e.jsx("p",{className:"font-medium",children:"âœ… Cliente em dia!"})]}),e.jsx("p",{className:"text-sm text-green-600 mt-1",children:"Nenhuma aÃ§Ã£o prioritÃ¡ria no momento"})]})]}):e.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 border-2 border-yellow-300 rounded-xl p-6 shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(Vt,{className:"text-yellow-600",size:24}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"âš¡ Insights & AÃ§Ãµes"}),e.jsxs("span",{className:"ml-auto text-xs text-gray-500 bg-white px-2 py-1 rounded-full",children:[o.length," ",o.length===1?"insight":"insights"]})]}),e.jsx("div",{className:"space-y-3",children:o.map((v,d)=>{const m=Mc[v.tipo],C=v.icone;return e.jsx("div",{className:`${m.bgClass} border ${m.borderClass} rounded-lg p-4 transition-all hover:shadow-md`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx(C,{className:`text-${m.color}-600`,size:20})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:v.titulo}),e.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${m.tagClass}`,children:m.label})]}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:v.descricao})]})]})},d)})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-yellow-200",children:e.jsxs("p",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(at,{size:12}),"Insights calculados automaticamente com base no histÃ³rico do cliente"]})})]})}const qc=()=>{var aa,la,ca,We,Sa;const a=va(),[t,s]=n.useState([]),[o,r]=n.useState(!0),[i,l]=n.useState(""),[x,j]=n.useState(!1),[g,v]=n.useState(!1),[d,m]=n.useState(null),[C,y]=n.useState(""),[c,f]=n.useState("todos"),[b,u]=n.useState(1),[h,p]=n.useState(0),[k,N]=n.useState(20),[w,S]=n.useState(!1),[P,W]=n.useState(1),[te,D]=n.useState([]),[A,X]=n.useState(null),[re,M]=n.useState(""),[Z,$]=n.useState(null),[J,E]=n.useState(!1),[R,K]=n.useState(!1),[B,_]=n.useState([]),[O,q]=n.useState({}),[ae,H]=n.useState(null),[le,G]=n.useState(null),[ee,de]=n.useState(null),[ue,Ae]=n.useState(!1),[se,we]=n.useState({tipo_cadastro:"cliente",tipo_pessoa:"PF",nome:"",cpf:"",email:"",telefone:"",celular:"",celular_whatsapp:!0,cnpj:"",inscricao_estadual:"",razao_social:"",nome_fantasia:"",responsavel:"",crmv:"",parceiro_ativo:!1,parceiro_desde:"",parceiro_observacoes:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",estado:"",endereco_entrega:"",endereco_entrega_2:"",is_entregador:!1,entregador_ativo:!0,entregador_padrao:!1,tipo_vinculo_entrega:"",controla_rh:!1,gera_conta_pagar_custo_entrega:!1,media_entregas_configurada:"",custo_rh_ajustado:"",modelo_custo_entrega:"",taxa_fixa_entrega:"",valor_por_km_entrega:"",moto_propria:!0,tipo_acerto_entrega:"",dia_semana_acerto:"",dia_mes_acerto:"",is_terceirizado:!1,recebe_repasse:!1,gera_conta_pagar:!1,observacoes:"",tags:""}),[Se,ea]=n.useState([]),[Ie,Je]=n.useState(null),[be,Fe]=n.useState(!1),[he,Qe]=n.useState({nome:"",especie:"",raca:"",sexo:"",data_nascimento:"",cor:"",peso:"",observacoes:"",castrado:!1,porte:"",microchip:"",alergias:"",doencas_cronicas:"",medicamentos_continuos:"",historico_clinico:"",foto_url:"",idade_aproximada:""}),Ze=[{number:1,title:"InformaÃ§Ãµes do cliente"},{number:2,title:"Contatos"},{number:3,title:"EndereÃ§o"},{number:4,title:"InformaÃ§Ãµes complementares"},{number:5,title:"Animais"},{number:6,title:"Financeiro"}];n.useEffect(()=>{oa()},[c,b,k]),n.useEffect(()=>{const V=setTimeout(()=>{b!==1?u(1):oa()},500);return()=>clearTimeout(V)},[i]),n.useEffect(()=>{he&&he.especie?ma(he.especie):_([])},[he==null?void 0:he.especie]),n.useEffect(()=>{if(le&&te.length>0){const V=te.findIndex(Re=>Re.id===le);V!==-1&&(Be(V),G(null))}},[te,le]);const ma=async V=>{try{const Re=await F.get(`/clientes/racas?especie=${V}`);_(Re.data)}catch(Re){console.error("Erro ao carregar raÃ§as:",Re),_([])}},oa=async()=>{try{r(!0);const V=(b-1)*k,Re=new URLSearchParams({skip:V.toString(),limit:k.toString()});c!=="todos"&&Re.append("tipo_cadastro",c),i&&i.trim()&&Re.append("search",i.trim());const Oe=`/clientes/?${Re.toString()}`,He=await F.get(Oe);He.data.items?(s(He.data.items),p(He.data.total)):(s(He.data),p(He.data.length))}catch(V){y("Erro ao carregar pessoas"),console.error(V)}finally{r(!1)}},ha=async V=>{const Re=V.replace(/\D/g,"");if(Re.length===8){S(!0),M(""),y("");try{const He=await(await fetch(`https://viacep.com.br/ws/${Re}/json/`)).json();if(He.erro){M("CEP nÃ£o encontrado");return}we(ga=>({...ga,endereco:He.logradouro||"",bairro:He.bairro||"",cidade:He.localidade||"",estado:He.uf||"",cep:V}))}catch(Oe){console.error("Erro ao buscar CEP:",Oe)}finally{S(!1)}}},da=(V=null)=>{Je(V!==null?{...Se[V],index:V}:{tipo:"entrega",apelido:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",estado:""}),Fe(!0)},oe=()=>{Fe(!1),Je(null)},Ne=async V=>{if(!(!V||V.length!==9)){S(!0);try{const Oe=await(await fetch(`https://viacep.com.br/ws/${V.replace("-","")}/json/`)).json();if(Oe.erro){alert("CEP nÃ£o encontrado");return}Je(He=>({...He,endereco:Oe.logradouro||"",bairro:Oe.bairro||"",cidade:Oe.localidade||"",estado:Oe.uf||""}))}catch(Re){console.error("Erro ao buscar CEP:",Re),alert("Erro ao buscar CEP")}finally{S(!1)}}},ke=()=>{if(!Ie.cep||!Ie.endereco||!Ie.cidade){alert("Preencha pelo menos CEP, EndereÃ§o e Cidade");return}const V=[...Se];Ie.index!==void 0?(V[Ie.index]={...Ie},delete V[Ie.index].index):V.push({...Ie}),ea(V),oe()},Ue=V=>{if(confirm("Deseja realmente remover este endereÃ§o?")){const Re=Se.filter((Oe,He)=>He!==V);ea(Re)}},ze=async()=>{var V,Re,Oe,He,ga;y("");try{const xe=[];if((!se.nome||se.nome.trim()==="")&&xe.push("Nome"),se.tipo_pessoa==="PJ"&&((!se.cnpj||se.cnpj.trim()==="")&&xe.push("CNPJ"),(!se.razao_social||se.razao_social.trim()==="")&&xe.push("RazÃ£o Social")),se.tipo_pessoa==="PF"&&se.tipo_cadastro==="cliente"&&(!se.cpf||se.cpf.trim()),xe.length>0){const ya=`âŒ Faltam os seguintes campos obrigatÃ³rios:

`+xe.map(Pa=>`â€¢ ${Pa}`).join(`
`);alert(ya),y(ya);return}if(se.is_entregador){if(!se.tipo_acerto_entrega){alert("Informe o tipo de acerto do entregador (semanal, quinzenal ou mensal)");return}if(se.tipo_acerto_entrega==="semanal"&&!se.dia_semana_acerto){alert("Informe o dia da semana para o acerto semanal");return}if(se.tipo_acerto_entrega==="mensal"&&!se.dia_mes_acerto){alert("Informe o dia do mÃªs para o acerto mensal");return}if(se.tipo_acerto_entrega==="mensal"){const ya=parseInt(se.dia_mes_acerto);if(ya<1||ya>28){alert("O dia do mÃªs deve estar entre 1 e 28");return}}}const{celular_whatsapp:De,tags:qe,...ta}=se;ta.is_entregador&&(ta.tipo_cadastro==="funcionario"?(ta.tipo_vinculo_entrega="funcionario",ta.is_terceirizado=!1):ta.tipo_cadastro==="fornecedor"&&(ta.is_terceirizado=!0,ta.tipo_vinculo_entrega="terceirizado")),ta.enderecos_adicionais=Se.length>0?Se:null,Object.keys(ta).forEach(ya=>{ta[ya]===""&&(ta[ya]=null)}),ta.tipo_cadastro==="todos"&&(ta.tipo_cadastro="cliente");let Va;d?(await F.put(`/clientes/${d.id}`,ta),Va=d.id):Va=(await F.post("/clientes/",ta)).data.id;for(const ya of te){const Pa=ya.id,wa={...ya};delete wa.id,delete wa.created_at,delete wa.updated_at,delete wa.cliente_id,delete wa.user_id,delete wa.ativo,delete wa.codigo,Object.keys(wa).forEach(os=>{wa[os]===""&&(wa[os]=null)}),wa.peso!==null&&wa.peso!==void 0&&(wa.peso=parseFloat(wa.peso)||null),Pa?(console.log(`Atualizando pet ${Pa}:`,wa),await F.put(`/clientes/pets/${Pa}`,wa)):(console.log("Criando novo pet:",wa),await F.post(`/clientes/${Va}/pets`,wa))}oa(),Q()}catch(xe){const De=(Re=(V=xe.response)==null?void 0:V.data)==null?void 0:Re.details;console.error("Erro completo:",(Oe=xe.response)==null?void 0:Oe.data),console.error("Detalhes de validaÃ§Ã£o:",De);const qe={nome:"Nome",cpf:"CPF",cnpj:"CNPJ",razao_social:"RazÃ£o Social",nome_fantasia:"Nome Fantasia",inscricao_estadual:"InscriÃ§Ã£o Estadual",responsavel:"ResponsÃ¡vel",telefone:"Telefone",celular:"Celular",email:"E-mail",cep:"CEP",endereco:"EndereÃ§o",numero:"NÃºmero",bairro:"Bairro",cidade:"Cidade",estado:"Estado",tipo_pessoa:"Tipo de Pessoa",tipo_cadastro:"Tipo de Cadastro",crmv:"CRMV",tipo_acerto_entrega:"Tipo de Acerto",dia_semana_acerto:"Dia da Semana para Acerto",dia_mes_acerto:"Dia do MÃªs para Acerto",tipo_vinculo_entrega:"Tipo de VÃ­nculo"};let ta="";if(De&&Array.isArray(De)){const ya=[];De.forEach(Pa=>{const wa=Pa.loc[Pa.loc.length-1],os=qe[wa]||wa;Pa.type==="missing"||Pa.type==="value_error.missing"?ya.push(os):Pa.msg&&ya.push(`${os}: ${Pa.msg}`),console.error(`Campo: ${os} | Tipo: ${Pa.type} | Mensagem: ${Pa.msg}`)}),ya.length>0&&(ta=`âŒ Faltam os seguintes campos obrigatÃ³rios:

`+ya.map(Pa=>`â€¢ ${Pa}`).join(`
`))}const Va=ta||((ga=(He=xe.response)==null?void 0:He.data)==null?void 0:ga.message)||"Erro ao salvar cliente";y(Va),ta&&alert(ta)}},Y=async V=>{var Re,Oe;if(confirm("Tem certeza que deseja excluir este cliente?"))try{console.log("Excluindo cliente ID:",V);const He=await F.delete(`/clientes/${V}`);console.log("Cliente excluÃ­do com sucesso:",He),await oa()}catch(He){console.error("Erro ao excluir cliente:",He),console.error("Resposta do erro:",He.response),y(((Oe=(Re=He.response)==null?void 0:Re.data)==null?void 0:Oe.detail)||"Erro ao excluir cliente")}},ve=async V=>{var Re,Oe;if(confirm("Tem certeza que deseja excluir este pet?"))try{console.log("Excluindo pet ID:",V),await F.delete(`/clientes/pets/${V}`),console.log("Pet excluÃ­do com sucesso"),q({}),await oa(),console.log("Lista de clientes atualizada")}catch(He){console.error("Erro ao excluir pet:",He),alert(((Oe=(Re=He.response)==null?void 0:Re.data)==null?void 0:Oe.detail)||"Erro ao excluir pet")}},Le=async V=>{var Re;if(V)try{Ae(!0);const Oe=await F.get(`/financeiro/cliente/${V}/resumo`);de(Oe.data.resumo)}catch(Oe){((Re=Oe.response)==null?void 0:Re.status)!==404&&console.error("Erro ao carregar resumo financeiro:",Oe),de(null)}finally{Ae(!1)}},I=(V=null,Re=null,Oe=null)=>{if(V)m(V),console.log("ðŸ› Cliente carregado do backend:",{id:V.id,nome:V.nome,is_entregador:V.is_entregador,entregador_padrao:V.entregador_padrao,entregador_padrao_tipo:typeof V.entregador_padrao}),we({tipo_cadastro:V.tipo_cadastro||"cliente",tipo_pessoa:V.tipo_pessoa||"PF",nome:V.nome,cpf:V.cpf||"",email:V.email||"",telefone:V.telefone||"",celular:V.celular||"",celular_whatsapp:!0,cnpj:V.cnpj||"",inscricao_estadual:V.inscricao_estadual||"",razao_social:V.razao_social||"",nome_fantasia:V.nome_fantasia||"",responsavel:V.responsavel||"",crmv:V.crmv||"",parceiro_ativo:V.parceiro_ativo||!1,parceiro_desde:V.parceiro_desde||"",parceiro_observacoes:V.parceiro_observacoes||"",cep:V.cep||"",endereco:V.endereco||"",numero:V.numero||"",complemento:V.complemento||"",bairro:V.bairro||"",cidade:V.cidade||"",estado:V.estado||"",endereco_entrega:V.endereco_entrega||"",endereco_entrega_2:V.endereco_entrega_2||"",is_entregador:V.is_entregador||!1,entregador_ativo:V.entregador_ativo!==void 0?V.entregador_ativo:!0,entregador_padrao:V.entregador_padrao||!1,tipo_vinculo_entrega:V.tipo_vinculo_entrega||"",controla_rh:V.controla_rh||!1,gera_conta_pagar_custo_entrega:V.gera_conta_pagar_custo_entrega||!1,media_entregas_configurada:V.media_entregas_configurada||"",custo_rh_ajustado:V.custo_rh_ajustado||"",modelo_custo_entrega:V.modelo_custo_entrega||"",taxa_fixa_entrega:V.taxa_fixa_entrega||"",valor_por_km_entrega:V.valor_por_km_entrega||"",moto_propria:V.moto_propria!==void 0?V.moto_propria:!0,tipo_acerto_entrega:V.tipo_acerto_entrega||"",dia_semana_acerto:V.dia_semana_acerto||"",dia_mes_acerto:V.dia_mes_acerto||"",is_terceirizado:V.is_terceirizado||!1,recebe_repasse:V.recebe_repasse||!1,gera_conta_pagar:V.gera_conta_pagar||!1,observacoes:V.observacoes||"",tags:""}),D(V.pets||[]),ea(V.enderecos_adicionais||[]),Le(V.id),Oe?(G(Oe),W(5)):(W(1),G(null));else{m(null);const He=Re||(c==="todos"?"cliente":c);we({tipo_cadastro:He,tipo_pessoa:He==="fornecedor"?"PJ":"PF",nome:"",cpf:"",email:"",telefone:"",celular:"",celular_whatsapp:!0,cnpj:"",inscricao_estadual:"",razao_social:"",nome_fantasia:"",responsavel:"",crmv:"",parceiro_ativo:!1,parceiro_desde:"",parceiro_observacoes:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",estado:"",is_entregador:!1,entregador_ativo:!0,tipo_vinculo_entrega:"",controla_rh:!1,media_entregas_configurada:"",custo_rh_ajustado:"",modelo_custo_entrega:"",taxa_fixa_entrega:"",valor_por_km_entrega:"",moto_propria:!0,is_terceirizado:!1,recebe_repasse:!1,gera_conta_pagar:!1,observacoes:"",tags:""}),D([]),ea([]),W(1)}j(!0),y("")},Q=()=>{j(!1),m(null),W(1),D([]),$(null),E(!1),K(!1),H(null),G(null),de(null)},fe=async()=>{try{const V=new URLSearchParams;if(se.cpf&&V.append("cpf",se.cpf),se.cnpj&&V.append("cnpj",se.cnpj),se.telefone&&V.append("telefone",se.telefone),se.celular&&V.append("celular",se.celular),se.crmv&&V.append("crmv",se.crmv),d&&V.append("cliente_id",d.id),V.toString()){const Re=await F.get(`/clientes/verificar-duplicata/campo?${V.toString()}`);if(Re.data.duplicado)return $(Re.data),E(!0),!0}return!1}catch(V){return console.error("Erro ao verificar duplicata:",V),!1}},U=async()=>{if(P<6){if(y(""),M(""),P===1&&await fe()||P===2&&await fe())return;W(P+1)}},ie=V=>["cpf","cnpj","crmv"].includes(V),_e=()=>{K(!0)},$e=async()=>{var V,Re;try{r(!0);const Oe=(d==null?void 0:d.codigo)||(t.length>0?Math.max(...t.map(He=>He.codigo))+1:1);await F.put(`/clientes/${Z.cliente.id}/remover-campo`,null,{params:{campo:Z.campo,novo_cliente_codigo:Oe}}),K(!1),E(!1),$(null),W(P+1)}catch(Oe){y(((Re=(V=Oe.response)==null?void 0:V.data)==null?void 0:Re.detail)||"Erro ao remover campo duplicado")}finally{r(!1)}},T=()=>{K(!1)},ne=()=>{Q();const V=document.getElementById(`cliente-${Z.cliente.id}`);V&&(V.scrollIntoView({behavior:"smooth",block:"center"}),V.classList.add("ring-4","ring-yellow-400"),setTimeout(()=>{V.classList.remove("ring-4","ring-yellow-400")},3e3))},pe=()=>{const V=t.find(Re=>Re.id===Z.cliente.id);V&&(E(!1),$(null),K(!1),I(V))},Pe=()=>{P>1&&(y(""),M(""),W(P-1))},Be=V=>{const Re=te[V];Qe({nome:Re.nome||"",especie:Re.especie||"",raca:Re.raca||"",sexo:Re.sexo||"",data_nascimento:Re.data_nascimento||"",cor:Re.cor||"",peso:Re.peso||"",observacoes:Re.observacoes||"",castrado:Re.castrado||!1,porte:Re.porte||"",microchip:Re.microchip||"",alergias:Re.alergias||"",doencas_cronicas:Re.doencas_cronicas||"",medicamentos_continuos:Re.medicamentos_continuos||"",historico_clinico:Re.historico_clinico||"",foto_url:Re.foto_url||"",idade_aproximada:Re.idade_aproximada||""}),X(V),Re!=null&&Re.id&&H(Re.id)},Ke=t.filter(V=>{var Re,Oe,He,ga;return((Re=V.codigo)==null?void 0:Re.includes(i))||V.nome.toLowerCase().includes(i.toLowerCase())||((Oe=V.cpf)==null?void 0:Oe.includes(i))||((He=V.email)==null?void 0:He.toLowerCase().includes(i.toLowerCase()))||((ga=V.celular)==null?void 0:ga.includes(i))});function Ge({clienteId:V}){const[Re,Oe]=n.useState([]),[He,ga]=n.useState(!0);n.useEffect(()=>{V&&xe()},[V]);const xe=async()=>{try{ga(!0);const De=await F.get(`/whatsapp/clientes/${V}/whatsapp/ultimas?limit=5`);Oe(De.data)}catch(De){console.error("Erro ao carregar mensagens:",De),Oe([])}finally{ga(!1)}};return He?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Carregando mensagens..."})]}):Re.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(Ls,{size:32,className:"mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm",children:"Nenhuma mensagem registrada ainda"}),e.jsx("p",{className:"text-xs mt-1",children:"As mensagens enviadas e recebidas aparecerÃ£o aqui"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"Ãšltimas 5 mensagens:"}),Re.map(De=>e.jsxs("div",{className:`p-3 rounded-lg border ${De.direcao==="enviada"?"bg-green-50 border-green-200 ml-6":"bg-blue-50 border-blue-200 mr-6"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-semibold ${De.direcao==="enviada"?"text-green-700":"text-blue-700"}`,children:De.direcao==="enviada"?"â†’ Enviada":"â† Recebida"}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${De.status==="lido"?"bg-green-200 text-green-800":De.status==="enviado"?"bg-yellow-200 text-yellow-800":De.status==="recebido"?"bg-blue-200 text-blue-800":"bg-red-200 text-red-800"}`,children:De.status})]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(De.created_at).toLocaleString("pt-BR")})]}),e.jsx("p",{className:"text-sm text-gray-700",children:De.preview||De.conteudo})]},De.id))]})}return o?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando..."})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Cadastros"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerenciamento de clientes, fornecedores, veterinÃ¡rios, funcionÃ¡rios e pets"})]}),e.jsx("div",{className:"mb-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{f("todos"),u(1)},className:`px-4 py-2 font-medium border-b-2 transition-colors ${c==="todos"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Todos"}),e.jsx("button",{onClick:()=>{f("cliente"),u(1)},className:`px-4 py-2 font-medium border-b-2 transition-colors ${c==="cliente"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Clientes"}),e.jsx("button",{onClick:()=>{f("fornecedor"),u(1)},className:`px-4 py-2 font-medium border-b-2 transition-colors ${c==="fornecedor"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Fornecedores"}),e.jsx("button",{onClick:()=>{f("veterinario"),u(1)},className:`px-4 py-2 font-medium border-b-2 transition-colors ${c==="veterinario"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"VeterinÃ¡rios"}),e.jsx("button",{onClick:()=>{f("funcionario"),u(1)},className:`px-4 py-2 font-medium border-b-2 transition-colors ${c==="funcionario"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"FuncionÃ¡rios"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6 flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ol,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por cÃ³digo, nome, CPF/CNPJ, email ou telefone...",value:i,onChange:V=>l(V.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>v(!0),className:"flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx(vi,{})," Importar Excel"]}),e.jsxs("button",{onClick:()=>I(null,c),className:"flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx(as,{})," Novo ",c==="cliente"?"Cliente":c==="fornecedor"?"Fornecedor":c==="veterinario"?"VeterinÃ¡rio":c==="funcionario"?"FuncionÃ¡rio":"Cadastro"]})]})]}),C&&!x&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(Ca,{}),e.jsx("span",{children:C})]}),!o&&h>0&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border border-gray-200 rounded-t-lg flex items-center justify-between mb-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",(b-1)*k+1," a ",Math.min(b*k,h)," de ",h," pessoas"]}),e.jsxs("select",{value:k,onChange:V=>{N(Number(V.target.value)),u(1)},className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10 por pÃ¡gina"}),e.jsx("option",{value:20,children:"20 por pÃ¡gina"}),e.jsx("option",{value:30,children:"30 por pÃ¡gina"}),e.jsx("option",{value:50,children:"50 por pÃ¡gina"}),e.jsx("option",{value:100,children:"100 por pÃ¡gina"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>u(1),disabled:b===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Primeira"}),e.jsx("button",{onClick:()=>u(V=>Math.max(V-1,1)),disabled:b===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(Math.ceil(h/k),5)},(V,Re)=>{const Oe=Math.ceil(h/k);let He;return Oe<=5||b<=3?He=Re+1:b>=Oe-2?He=Oe-4+Re:He=b-2+Re,e.jsx("button",{onClick:()=>u(He),className:`px-3 py-1 text-sm font-medium rounded-lg transition-colors ${b===He?"bg-purple-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:He},He)})}),e.jsx("button",{onClick:()=>u(V=>Math.min(V+1,Math.ceil(h/k))),disabled:b===Math.ceil(h/k),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"PrÃ³xima"}),e.jsx("button",{onClick:()=>u(Math.ceil(h/k)),disabled:b===Math.ceil(h/k),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Ãšltima"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[Ke.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CPF/CNPJ"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Celular"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pets"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Segmento"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ke.map(V=>{var Re;return e.jsxs(n.Fragment,{children:[e.jsxs("tr",{id:`cliente-${V.id}`,onClick:()=>I(V),className:"hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-medium",children:V.codigo}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:V.nome}),V.tipo_pessoa==="PJ"&&V.razao_social&&e.jsx("span",{className:"text-xs text-gray-500",children:V.razao_social}),V.parceiro_ativo&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-green-700 bg-green-100 px-2 py-0.5 rounded-full w-fit",children:[e.jsx(es,{size:12}),"Parceiro"]})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700",children:V.tipo_pessoa==="PF"?V.cpf||"-":V.cnpj||"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-700",children:V.celular||"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",onClick:Oe=>Oe.stopPropagation(),children:e.jsxs("button",{onClick:()=>q({...O,[V.id]:!O[V.id]}),className:"flex items-center gap-2 text-sm text-gray-700 hover:text-gray-900 transition-colors",children:[e.jsx($a,{size:16,className:"text-gray-400"}),e.jsx("span",{children:((Re=V.pets)==null?void 0:Re.length)||0}),V.pets&&V.pets.length>0&&e.jsx(Mr,{size:14,className:`transform transition-transform ${O[V.id]?"rotate-90":""}`})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:"text-xs text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",onClick:Oe=>Oe.stopPropagation(),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[V.celular&&e.jsx("button",{onClick:()=>{const Oe=V.celular.replace(/\D/g,"");window.open(`https://wa.me/55${Oe}`,"_blank")},className:"text-green-600 hover:text-green-900 transition-colors",title:"Abrir WhatsApp",children:e.jsx(Ls,{size:16})}),e.jsx("button",{onClick:()=>I(V),className:"text-blue-600 hover:text-blue-900 transition-colors",title:"Editar",children:e.jsx(Ts,{size:16})}),e.jsx("button",{onClick:()=>Y(V.id),className:"text-red-600 hover:text-red-900 transition-colors",title:"Excluir",children:e.jsx(Ss,{size:16})})]})})]}),O[V.id]&&V.pets&&V.pets.length>0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-3 bg-gray-50",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-xs font-semibold text-gray-700 mb-2",children:["Pets de ",V.nome,":"]}),V.pets.map(Oe=>e.jsxs("div",{className:`bg-white rounded-lg p-3 flex justify-between items-start border border-gray-200 ${ae===Oe.id?"ring-2 ring-blue-400 shadow-lg bg-blue-50":""}`,children:[e.jsxs("div",{className:"flex-1 grid grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Nome"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:Oe.nome})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"EspÃ©cie/RaÃ§a"}),e.jsxs("p",{className:"text-sm text-gray-700",children:[Oe.especie," ",Oe.raca&&`- ${Oe.raca}`]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Sexo"}),e.jsx("p",{className:"text-sm text-gray-700",children:Oe.sexo||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Nascimento"}),e.jsx("p",{className:"text-sm text-gray-700",children:Oe.data_nascimento?new Date(Oe.data_nascimento).toLocaleDateString("pt-BR"):"-"})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx("button",{onClick:()=>{H(Oe.id),I(V,null,Oe.id)},className:"text-blue-600 hover:text-blue-900 p-1 transition-colors",title:"Editar pet",children:e.jsx(Ts,{size:14})}),e.jsx("button",{onClick:()=>ve(Oe.id),className:"text-red-600 hover:text-red-900 p-1 transition-colors",title:"Excluir pet",children:e.jsx(Ss,{size:14})})]})]},Oe.id))]})})})]},V.id)})})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(vs,{className:"mx-auto text-gray-400 mb-4",size:48}),e.jsx("p",{className:"text-gray-600",children:"Nenhum cliente encontrado"})]}),!o&&h>0&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",(b-1)*k+1," a ",Math.min(b*k,h)," de ",h," pessoas"]}),e.jsxs("select",{value:k,onChange:V=>{N(Number(V.target.value)),u(1)},className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10 por pÃ¡gina"}),e.jsx("option",{value:20,children:"20 por pÃ¡gina"}),e.jsx("option",{value:30,children:"30 por pÃ¡gina"}),e.jsx("option",{value:50,children:"50 por pÃ¡gina"}),e.jsx("option",{value:100,children:"100 por pÃ¡gina"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>u(1),disabled:b===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Primeira"}),e.jsx("button",{onClick:()=>u(V=>Math.max(V-1,1)),disabled:b===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(Math.ceil(h/k),5)},(V,Re)=>{const Oe=Math.ceil(h/k);let He;return Oe<=5||b<=3?He=Re+1:b>=Oe-2?He=Oe-4+Re:He=b-2+Re,e.jsx("button",{onClick:()=>u(He),className:`px-3 py-1 text-sm font-medium rounded-lg transition-colors ${b===He?"bg-purple-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:He},He)})}),e.jsx("button",{onClick:()=>u(V=>Math.min(V+1,Math.ceil(h/k))),disabled:b===Math.ceil(h/k),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"PrÃ³xima"}),e.jsx("button",{onClick:()=>u(Math.ceil(h/k)),disabled:b===Math.ceil(h/k),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Ãšltima"})]})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:d?`Editar ${d.tipo_cadastro==="cliente"?"Cliente":d.tipo_cadastro==="fornecedor"?"Fornecedor":"VeterinÃ¡rio"}`:`Adicionar ${se.tipo_cadastro==="cliente"?"Cliente":se.tipo_cadastro==="fornecedor"?"Fornecedor":"VeterinÃ¡rio"}`}),e.jsx("button",{onClick:Q,className:"text-gray-400 hover:text-gray-600",children:e.jsx(ks,{size:24})})]}),e.jsx("div",{className:"flex items-center justify-between mb-2",children:Ze.map((V,Re)=>e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("button",{onClick:()=>W(V.number),className:`w-8 h-8 rounded-full flex items-center justify-center font-semibold text-sm transition-all hover:scale-110 cursor-pointer ${P>V.number?"bg-green-500 text-white hover:bg-green-600":P===V.number?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-600 hover:bg-gray-400"}`,type:"button",title:`Ir para: ${V.title}`,children:P>V.number?e.jsx(Wt,{}):V.number}),e.jsx("span",{className:"text-xs mt-1 text-center hidden md:block",children:V.title})]}),Re<Ze.length-1&&e.jsx("div",{className:`h-0.5 flex-1 ${P>V.number?"bg-green-500":"bg-gray-300"}`})]},V.number))}),e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[P,"/6"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[C&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(Ca,{}),e.jsx("span",{children:C})]}),J&&Z&&e.jsx("div",{className:"mb-4 p-4 bg-yellow-50 border-2 border-yellow-400 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ca,{className:"text-yellow-600 mt-1",size:24}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-yellow-900 mb-2",children:"âš ï¸ Cliente jÃ¡ cadastrado!"}),e.jsxs("p",{className:"text-sm text-yellow-800 mb-3",children:["JÃ¡ existe um cliente com o mesmo ",e.jsx("strong",{children:Z.campo})," cadastrado:"]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-yellow-300 mb-3",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:Z.cliente.nome}),e.jsxs("p",{className:"text-sm text-gray-600",children:["CÃ³digo: ",Z.cliente.codigo]}),Z.cliente.cpf&&e.jsxs("p",{className:"text-sm text-gray-600",children:["CPF: ",Z.cliente.cpf]}),Z.cliente.celular&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Celular: ",Z.cliente.celular]}),Z.cliente.telefone&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Telefone: ",Z.cliente.telefone]})]}),ie(Z.campo)?e.jsxs("div",{children:[e.jsxs("div",{className:"bg-red-50 border border-red-300 rounded-lg p-4 mb-3",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 mb-2",children:"ðŸš« NÃ£o Ã© possÃ­vel criar novo cadastro"}),e.jsxs("p",{className:"text-sm text-red-800 mb-2",children:[Z.campo.toUpperCase()," Ã© um documento Ãºnico e jÃ¡ estÃ¡ cadastrado."]}),e.jsx("p",{className:"text-sm text-red-700",children:"VocÃª pode editar o cadastro existente ou visualizÃ¡-lo."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:pe,className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:"âœï¸ Editar cadastro existente"}),e.jsx("button",{onClick:ne,className:"flex-1 px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm font-medium transition-colors",children:"ðŸ‘ï¸ Ver cadastro"})]})]}):R?e.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-lg p-4 mb-3",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 mb-2",children:"âš ï¸ AtenÃ§Ã£o!"}),e.jsxs("p",{className:"text-sm text-red-800 mb-3",children:["O ",e.jsx("strong",{children:Z.campo})," serÃ¡ removido do cadastro do cliente ",e.jsx("strong",{children:Z.cliente.nome})," (CÃ³digo ",Z.cliente.codigo,") e uma observaÃ§Ã£o serÃ¡ adicionada informando a transferÃªncia."]}),e.jsxs("p",{className:"text-xs text-red-700 mb-3",children:['No cadastro antigo ficarÃ¡ registrado: "Sem nÃºmero por cadastro novo do cliente cÃ³digo ',(d==null?void 0:d.codigo)||(t.length>0?Math.max(...t.map(V=>V.codigo))+1:1),'"']}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:$e,disabled:o,className:"flex-1 px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition-colors disabled:opacity-50",children:o?"Processando...":"Confirmar e continuar"}),e.jsx("button",{onClick:T,disabled:o,className:"flex-1 px-3 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg text-sm font-medium transition-colors disabled:opacity-50",children:"Cancelar"})]})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ne,className:"flex-1 px-3 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg text-sm font-medium transition-colors",children:"Ver cadastro existente"}),e.jsxs("button",{onClick:_e,className:"flex-1 px-3 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-medium transition-colors",children:["Transferir ",Z.campo]})]})]})]})}),P===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"InformaÃ§Ãµes do cadastro"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de cadastro *"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"cliente",checked:se.tipo_cadastro==="cliente",onChange:V=>{we({...se,tipo_cadastro:V.target.value,tipo_pessoa:"PF"})},className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Cliente"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"fornecedor",checked:se.tipo_cadastro==="fornecedor",onChange:V=>{we({...se,tipo_cadastro:V.target.value,tipo_pessoa:"PJ"})},className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Fornecedor"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"veterinario",checked:se.tipo_cadastro==="veterinario",onChange:V=>we({...se,tipo_cadastro:V.target.value}),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"VeterinÃ¡rio"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"funcionario",checked:se.tipo_cadastro==="funcionario",onChange:V=>we({...se,tipo_cadastro:V.target.value,tipo_pessoa:"PF"}),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"FuncionÃ¡rio"})]})]})]}),(se.tipo_cadastro==="funcionario"||se.tipo_cadastro==="fornecedor")&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0"})}),e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Ã‰ entregador"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-auto",children:[e.jsx("input",{type:"checkbox",checked:se.is_entregador||!1,onChange:V=>we({...se,is_entregador:V.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"})]})]}),se.is_entregador&&e.jsxs("div",{className:"ml-5 mt-2 space-y-2 border-l-2 border-blue-300 pl-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.entregador_padrao||!1,onChange:V=>we({...se,entregador_padrao:V.target.checked}),className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Entregador padrÃ£o"}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"(prÃ©-selecionado nas rotas)"})]}),se.tipo_cadastro==="funcionario"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-start gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.controla_rh||!1,onChange:V=>{const Re=V.target.checked;we({...se,controla_rh:Re,modelo_custo_entrega:Re?"":se.modelo_custo_entrega,taxa_fixa_entrega:Re?"":se.taxa_fixa_entrega,valor_por_km_entrega:Re?"":se.valor_por_km_entrega,gera_conta_pagar_custo_entrega:!1})},className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Controla RH"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5",children:"Custo rateado na folha (nÃ£o gera contas a pagar)"})]})]}),se.controla_rh&&e.jsx("div",{className:"ml-5 pl-3 border-l-2 border-blue-300",children:e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"MÃ©dia de entregas por mÃªs"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5 mb-1",children:"Define o rateio inicial do custo do funcionÃ¡rio por entrega. SerÃ¡ ajustado automaticamente no final do mÃªs."}),e.jsx("input",{type:"number",min:"1",step:"1",value:se.media_entregas_configurada||"",onChange:V=>we({...se,media_entregas_configurada:V.target.value}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"Ex: 100 entregas/mÃªs"}),e.jsx("p",{className:"text-[10px] text-blue-600 mt-1",children:"ðŸ’¡ Exemplo: Se o custo mensal Ã© R$ 3.000 e mÃ©dia Ã© 100 entregas, cada entrega custarÃ¡ R$ 30,00 inicialmente"})]})}),!se.controla_rh&&e.jsxs("label",{className:"flex items-start gap-2 cursor-pointer ml-5 pl-2 border-l border-gray-300",children:[e.jsx("input",{type:"checkbox",checked:se.gera_conta_pagar_custo_entrega||!1,onChange:V=>we({...se,gera_conta_pagar_custo_entrega:V.target.checked}),className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Gerar contas a pagar por entrega"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5",children:"Marque se este funcionÃ¡rio recebe por KM ou taxa fixa a cada entrega"})]})]})]}),(se.tipo_cadastro==="fornecedor"||se.tipo_cadastro==="funcionario"&&!se.controla_rh)&&e.jsxs("div",{className:"space-y-2",children:[se.tipo_cadastro==="fornecedor"&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-1.5 text-[10px] text-yellow-800",children:["âš ï¸ ",e.jsx("strong",{children:"Terceirizado"})," - Sempre gera contas a pagar"]}),se.tipo_cadastro==="funcionario"&&!se.controla_rh&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-1.5 text-[10px] text-blue-800",children:["â„¹ï¸ ",e.jsx("strong",{children:"FuncionÃ¡rio sem RH"})," - ",se.gera_conta_pagar_custo_entrega?"Gera CP por entrega":"NÃ£o gera CP"]}),e.jsxs("label",{className:"flex items-start gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.modelo_custo_entrega==="taxa_fixa",onChange:V=>we({...se,modelo_custo_entrega:V.target.checked?"taxa_fixa":"",valor_por_km_entrega:""}),className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Taxa Fixa"}),se.modelo_custo_entrega==="taxa_fixa"&&e.jsx("input",{type:"number",step:"0.01",min:"0",value:se.taxa_fixa_entrega||"",onChange:V=>we({...se,taxa_fixa_entrega:V.target.value}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded mt-1 focus:ring-1 focus:ring-blue-500",placeholder:"Ex: 15.00"})]})]}),e.jsxs("label",{className:"flex items-start gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.modelo_custo_entrega==="por_km",onChange:V=>we({...se,modelo_custo_entrega:V.target.checked?"por_km":"",taxa_fixa_entrega:""}),className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-xs text-gray-700 font-medium",children:"Valor por KM"}),se.modelo_custo_entrega==="por_km"&&e.jsx("input",{type:"number",step:"0.01",min:"0",value:se.valor_por_km_entrega||"",onChange:V=>we({...se,valor_por_km_entrega:V.target.value}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded mt-1 focus:ring-1 focus:ring-blue-500",placeholder:"Ex: 2.50"})]})]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.moto_propria||!1,onChange:V=>we({...se,moto_propria:V.target.checked}),className:"w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-700",children:se.moto_propria?"âœ… Moto prÃ³pria":"ðŸ¢ Moto da loja"})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-blue-200",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700 mb-2",children:"ðŸ“† Acerto Financeiro"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-gray-600 mb-0.5",children:"Periodicidade"}),e.jsxs("select",{value:se.tipo_acerto_entrega||"",onChange:V=>we({...se,tipo_acerto_entrega:V.target.value,dia_semana_acerto:"",dia_mes_acerto:""}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione"}),e.jsx("option",{value:"semanal",children:"Semanal"}),e.jsx("option",{value:"quinzenal",children:"Quinzenal (dias 1 e 15)"}),e.jsx("option",{value:"mensal",children:"Mensal"})]})]}),se.tipo_acerto_entrega==="semanal"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-gray-600 mb-0.5",children:"Dia da semana"}),e.jsxs("select",{value:se.dia_semana_acerto||"",onChange:V=>we({...se,dia_semana_acerto:V.target.value}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione"}),e.jsx("option",{value:"1",children:"Segunda"}),e.jsx("option",{value:"2",children:"TerÃ§a"}),e.jsx("option",{value:"3",children:"Quarta"}),e.jsx("option",{value:"4",children:"Quinta"}),e.jsx("option",{value:"5",children:"Sexta"}),e.jsx("option",{value:"6",children:"SÃ¡bado"}),e.jsx("option",{value:"7",children:"Domingo"})]})]}),se.tipo_acerto_entrega==="mensal"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-gray-600 mb-0.5",children:"Dia do mÃªs (1 a 28)"}),e.jsx("input",{type:"number",min:"1",max:"28",value:se.dia_mes_acerto||"",onChange:V=>we({...se,dia_mes_acerto:V.target.value}),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"Ex: 5"})]}),se.tipo_acerto_entrega==="quinzenal"&&e.jsxs("div",{className:"bg-blue-50 p-1.5 rounded text-[10px] text-blue-700",children:["â„¹ï¸ Acerto nos dias ",e.jsx("strong",{children:"1"})," e ",e.jsx("strong",{children:"15"})]})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"text-green-600",size:20}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Ativar como parceiro (comissÃµes)"}),se.parceiro_ativo&&e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 bg-green-600 text-white rounded-full text-xs font-semibold animate-fade-in",children:[e.jsx(Wt,{size:14,className:"font-bold"}),e.jsx("span",{children:"Parceiro habilitado para comissÃ£o"})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:se.parceiro_ativo,onChange:V=>we({...se,parceiro_ativo:V.target.checked,parceiro_desde:V.target.checked&&!se.parceiro_desde?new Date().toISOString().split("T")[0]:se.parceiro_desde||""}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-7",children:"Ao ativar, esta pessoa poderÃ¡ receber comissÃµes de vendas, independente do tipo de cadastro"}),se.parceiro_ativo&&e.jsxs("div",{className:"mt-3 ml-7",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"ObservaÃ§Ãµes do parceiro (opcional)"}),e.jsx("textarea",{value:se.parceiro_observacoes,onChange:V=>we({...se,parceiro_observacoes:V.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none",placeholder:"Ex: Especialista em produtos de higiene...",rows:"2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:se.tipo_pessoa==="PJ"?"Tipo de pessoa jurÃ­dica *":"Tipo de pessoa *"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"PF",checked:se.tipo_pessoa==="PF",onChange:V=>we({...se,tipo_pessoa:V.target.value}),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Pessoa FÃ­sica"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"PJ",checked:se.tipo_pessoa==="PJ",onChange:V=>we({...se,tipo_pessoa:V.target.value}),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Pessoa JurÃ­dica"})]})]})]}),se.tipo_pessoa==="PF"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome completo *"}),e.jsx("input",{type:"text",value:se.nome,onChange:V=>we({...se,nome:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Digite o nome completo",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CPF"}),e.jsx("input",{type:"text",value:se.cpf,onChange:V=>{we({...se,cpf:V.target.value}),E(!1),$(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"000.000.000-00",maxLength:"14"})]}),se.tipo_cadastro==="veterinario"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CRMV"}),e.jsx("input",{type:"text",value:se.crmv,onChange:V=>{we({...se,crmv:V.target.value}),E(!1),$(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"CRMV XX 1234",maxLength:"20"})]})]}),se.tipo_pessoa==="PJ"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"RazÃ£o Social *"}),e.jsx("input",{type:"text",value:se.razao_social,onChange:V=>we({...se,razao_social:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"RazÃ£o social da empresa"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Fantasia *"}),e.jsx("input",{type:"text",value:se.nome,onChange:V=>we({...se,nome:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Nome fantasia da empresa",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CNPJ *"}),e.jsx("input",{type:"text",value:se.cnpj,onChange:V=>{we({...se,cnpj:V.target.value}),E(!1),$(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"00.000.000/0000-00",maxLength:"18"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"InscriÃ§Ã£o Estadual"}),e.jsx("input",{type:"text",value:se.inscricao_estadual,onChange:V=>we({...se,inscricao_estadual:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"IE"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ResponsÃ¡vel / Contato"}),e.jsx("input",{type:"text",value:se.responsavel,onChange:V=>we({...se,responsavel:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Nome do responsÃ¡vel ou contato"})]})]})]}),P===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Contatos"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Celular *"}),e.jsx("input",{type:"text",value:se.celular,onChange:V=>{we({...se,celular:V.target.value}),E(!1),$(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"(00) 00000-0000"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Este nÃºmero Ã© WhatsApp?"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:se.celular_whatsapp===!0,onChange:()=>we({...se,celular_whatsapp:!0}),className:"text-blue-600"}),e.jsx("span",{className:"text-sm",children:"Sim"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:se.celular_whatsapp===!1,onChange:()=>we({...se,celular_whatsapp:!1}),className:"text-blue-600"}),e.jsx("span",{className:"text-sm",children:"NÃ£o"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone fixo"}),e.jsx("input",{type:"text",value:se.telefone,onChange:V=>{we({...se,telefone:V.target.value}),E(!1),$(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"(00) 0000-0000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-mail"}),e.jsx("input",{type:"email",value:se.email,onChange:V=>we({...se,email:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"email@exemplo.com"})]})]}),P===3&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"EndereÃ§o"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:se.cep,onChange:V=>{const Re=V.target.value;we({...se,cep:Re}),Re.replace(/\D/g,"").length===8&&ha(Re)},className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"00000-000",maxLength:"9"}),e.jsx("button",{type:"button",onClick:()=>ha(se.cep),disabled:w,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50",children:w?"Buscando...":"Buscar"})]}),re&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:re}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Digite o CEP para preencher o endereÃ§o automaticamente"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EndereÃ§o"}),e.jsx("input",{type:"text",value:se.endereco,onChange:V=>we({...se,endereco:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Rua, Avenida..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NÃºmero"}),e.jsx("input",{type:"text",value:se.numero,onChange:V=>we({...se,numero:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"123"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complemento"}),e.jsx("input",{type:"text",value:se.complemento,onChange:V=>we({...se,complemento:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Apto, Bloco..."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bairro"}),e.jsx("input",{type:"text",value:se.bairro,onChange:V=>we({...se,bairro:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cidade"}),e.jsx("input",{type:"text",value:se.cidade,onChange:V=>we({...se,cidade:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsx("input",{type:"text",value:se.estado,onChange:V=>we({...se,estado:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",maxLength:"2",placeholder:"SP"})]})]})]}),P===4&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"InformaÃ§Ãµes complementares"}),e.jsxs("div",{className:"border-b pb-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800",children:"EndereÃ§os Adicionais"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Cadastre mÃºltiplos endereÃ§os para entrega, cobranÃ§a, etc."})]}),e.jsxs("button",{type:"button",onClick:()=>da(),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Adicionar EndereÃ§o"]})]}),Se.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-4",children:Se.map((V,Re)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 bg-gray-50 hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${V.tipo==="entrega"?"bg-blue-100 text-blue-800":V.tipo==="cobranca"?"bg-green-100 text-green-800":V.tipo==="comercial"?"bg-purple-100 text-purple-800":V.tipo==="residencial"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:V.tipo==="entrega"?"ðŸ“¦ Entrega":V.tipo==="cobranca"?"ðŸ’° CobranÃ§a":V.tipo==="comercial"?"ðŸ¢ Comercial":V.tipo==="residencial"?"ðŸ  Residencial":"ðŸ“ Trabalho"}),e.jsxs("span",{className:"text-xs font-medium text-gray-500",children:["+",Re+1]})]}),V.apelido&&e.jsx("p",{className:"text-sm font-semibold text-gray-900 mb-1",children:V.apelido}),e.jsxs("p",{className:"text-sm text-gray-700",children:[V.endereco,", ",V.numero,V.complemento&&` - ${V.complemento}`]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[V.bairro,", ",V.cidade,"/",V.estado]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["CEP: ",V.cep]})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx("button",{type:"button",onClick:()=>da(Re),className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Editar",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{type:"button",onClick:()=>Ue(Re),className:"p-1.5 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Excluir",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},Re))}):e.jsxs("div",{className:"text-center py-8 text-gray-500 text-sm",children:[e.jsxs("svg",{className:"w-12 h-12 mx-auto mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Nenhum endereÃ§o adicional cadastrado"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"MarcaÃ§Ãµes / Tags"}),e.jsx("input",{type:"text",value:se.tags,onChange:V=>we({...se,tags:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Ex: Bom pagador, Cliente fiel, VIP"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Separe por vÃ­rgula para mÃºltiplas tags"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ObservaÃ§Ãµes"}),e.jsx("textarea",{value:se.observacoes,onChange:V=>we({...se,observacoes:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",rows:"4",placeholder:"InformaÃ§Ãµes adicionais sobre o cliente..."})]})]}),P===5&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx($a,{className:"text-blue-600",size:24}),"Pets do Cliente"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Use o mÃ³dulo dedicado para gerenciar pets com informaÃ§Ãµes completas"})]})}),e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-lg p-5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($a,{className:"text-blue-600 flex-shrink-0 mt-1",size:24}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"ðŸŽ¯ GestÃ£o Profissional de Pets"}),e.jsxs("p",{className:"text-sm text-blue-800 mb-3",children:["Agora os pets possuem um ",e.jsx("strong",{children:"mÃ³dulo dedicado"})," com funcionalidades completas: histÃ³rico mÃ©dico, vacinas, consultas, serviÃ§os e muito mais."]}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 mb-4",children:[e.jsx("li",{children:"âœ… Cadastro completo com campos veterinÃ¡rios"}),e.jsx("li",{children:"âœ… HistÃ³rico de saÃºde e medicaÃ§Ãµes"}),e.jsx("li",{children:"âœ… Controle de vacinas e consultas"}),e.jsx("li",{children:"âœ… Timeline de eventos"}),e.jsx("li",{children:"âœ… Preparado para uso clÃ­nico real"})]})]})]})}),te.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3",children:["Pets cadastrados (",te.length,")"]}),e.jsx("div",{className:"space-y-2",children:te.map(V=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($a,{className:"text-blue-600",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:V.nome}),e.jsxs("p",{className:"text-sm text-gray-600",children:[V.especie," ",V.raca&&`â€¢ ${V.raca}`]})]})]}),V.id&&e.jsx("button",{onClick:()=>a(`/pets/${V.id}`),className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm font-medium transition-colors",children:"Ver Detalhes"})]},V.id||V.nome))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>{d!=null&&d.id?a(`/pets?cliente_id=${d.id}`):alert("âš ï¸ Salve o cliente primeiro para gerenciar pets")},className:"flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg transition-all font-semibold shadow-md",children:[e.jsx($a,{size:24}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{children:"ðŸ¾ Gerenciar Pets"}),e.jsx("div",{className:"text-xs font-normal opacity-90",children:"MÃ³dulo completo de gestÃ£o"})]})]}),e.jsxs("button",{type:"button",onClick:()=>{d!=null&&d.id?a("/pets/novo",{state:{clienteId:d.id}}):alert("âš ï¸ Salve o cliente primeiro para adicionar pets")},className:"flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-lg transition-all font-semibold shadow-md",children:[e.jsx(as,{size:24}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{children:"âž• Adicionar Pet"}),e.jsx("div",{className:"text-xs font-normal opacity-90",children:"Cadastro completo"})]})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:["ðŸ’¡ ",e.jsx("strong",{children:"Dica:"})," Pets podem ser adicionados agora ou depois. Todas as informaÃ§Ãµes mÃ©dicas e histÃ³rico ficam no mÃ³dulo dedicado de pets."]})}),!d&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-orange-800",children:["âš ï¸ ",e.jsx("strong",{children:"AtenÃ§Ã£o:"})," Salve o cliente primeiro (etapa 6) para poder gerenciar seus pets."]})})]}),P===6&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(es,{className:"text-green-600"}),"InformaÃ§Ãµes Financeiras"]}),e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800 mb-1",children:"ðŸ’° Saldo de CrÃ©dito"}),e.jsxs("p",{className:"text-3xl font-bold text-green-600",children:["R$ ",d!=null&&d.credito?parseFloat(d.credito).toFixed(2).replace(".",","):"0,00"]}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"DisponÃ­vel para uso em compras"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50",disabled:!d,onClick:async()=>{var He,ga;if(!d){alert("Salve o cliente primeiro antes de adicionar crÃ©dito");return}const V=prompt("Digite o valor a adicionar ao crÃ©dito:");if(!V||isNaN(parseFloat(V)))return;const Re=parseFloat(V);if(Re<=0){alert("Valor deve ser maior que zero");return}const Oe=prompt("Motivo da adiÃ§Ã£o de crÃ©dito:","Ajuste manual");if(Oe)try{const xe=await F.post(`/clientes/${d.id}/credito/adicionar`,{valor:Re,motivo:Oe});alert(`âœ… ${xe.data.message}

CrÃ©dito anterior: R$ ${xe.data.credito_anterior.toFixed(2)}
Valor adicionado: R$ ${xe.data.valor_adicionado.toFixed(2)}
Novo saldo: R$ ${xe.data.credito_atual.toFixed(2)}`),m({...d,credito:xe.data.credito_atual}),oa()}catch(xe){console.error("Erro ao adicionar crÃ©dito:",xe),alert("âŒ Erro ao adicionar crÃ©dito: "+(((ga=(He=xe.response)==null?void 0:He.data)==null?void 0:ga.detail)||xe.message))}},children:[e.jsx(ot,{})," Adicionar CrÃ©dito"]}),e.jsxs("button",{type:"button",className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50",disabled:!d,onClick:async()=>{var ga,xe;if(!d){alert("Salve o cliente primeiro antes de remover crÃ©dito");return}const V=parseFloat(d.credito||0);if(V<=0){alert("Cliente nÃ£o possui crÃ©dito para remover");return}const Re=prompt(`Digite o valor a remover (mÃ¡x: R$ ${V.toFixed(2)}):`);if(!Re||isNaN(parseFloat(Re)))return;const Oe=parseFloat(Re);if(Oe<=0){alert("Valor deve ser maior que zero");return}if(Oe>V){alert(`Valor excede o crÃ©dito disponÃ­vel (R$ ${V.toFixed(2)})`);return}const He=prompt("Motivo da remoÃ§Ã£o de crÃ©dito:","Ajuste manual");if(He)try{const De=await F.post(`/clientes/${d.id}/credito/remover`,{valor:Oe,motivo:He});alert(`âœ… ${De.data.message}

CrÃ©dito anterior: R$ ${De.data.credito_anterior.toFixed(2)}
Valor removido: R$ ${De.data.valor_removido.toFixed(2)}
Novo saldo: R$ ${De.data.credito_atual.toFixed(2)}`),m({...d,credito:De.data.credito_atual}),oa()}catch(De){console.error("Erro ao remover crÃ©dito:",De),alert("âŒ Erro ao remover crÃ©dito: "+(((xe=(ga=De.response)==null?void 0:ga.data)==null?void 0:xe.detail)||De.message))}},children:[e.jsx(Hr,{})," Remover CrÃ©dito"]})]})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("h4",{className:"text-md font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Lr,{}),"Resumo Financeiro (Ãšltimos 90 dias)"]}),d?e.jsx("div",{className:"space-y-4",children:ue?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600 text-sm",children:"Carregando resumo..."})]}):e.jsxs(e.Fragment,{children:[ee?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"ðŸ’° Total Comprado"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["R$ ",((aa=ee.total_vendas)==null?void 0:aa.toFixed(2).replace(".",","))||"0,00"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[ee.quantidade_vendas||0," vendas"]})]}),e.jsxs("div",{className:`rounded-lg p-4 border ${ee.tem_debitos_vencidos?"bg-red-50 border-red-300":ee.tem_debitos?"bg-orange-50 border-orange-200":"bg-green-50 border-green-200"}`,children:[e.jsxs("p",{className:"text-xs text-gray-600 mb-1",children:[ee.tem_debitos_vencidos?"âš ï¸":"ðŸ“‹"," Em Aberto"]}),e.jsxs("p",{className:`text-2xl font-bold ${ee.tem_debitos_vencidos?"text-red-600":ee.tem_debitos?"text-orange-600":"text-green-600"}`,children:["R$ ",((la=ee.total_em_aberto)==null?void 0:la.toFixed(2).replace(".",","))||"0,00"]}),ee.tem_debitos_vencidos&&e.jsxs("p",{className:"text-xs text-red-600 font-semibold mt-1",children:["R$ ",((ca=ee.total_vencido)==null?void 0:ca.toFixed(2).replace(".",","))||"0,00"," vencido"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 border border-purple-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"ðŸ“Š Ticket MÃ©dio"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["R$ ",((We=ee.ticket_medio)==null?void 0:We.toFixed(2).replace(".",","))||"0,00"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"por compra"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"ðŸ• Ãšltima Compra"}),ee.ultima_compra?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-2xl font-bold text-gray-700",children:["R$ ",((Sa=ee.ultima_compra.valor)==null?void 0:Sa.toFixed(2).replace(".",","))||"0,00"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[new Date(ee.ultima_compra.data).toLocaleDateString("pt-BR")," ","(hÃ¡ ",ee.ultima_compra.dias_atras," dias)"]})]}):e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Nenhuma compra"})]})]})}):e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx("p",{className:"mb-2",children:"ðŸ“‹ Nenhuma informaÃ§Ã£o financeira"}),e.jsx("p",{className:"text-sm",children:"Dados aparecerÃ£o apÃ³s a primeira venda"})]}),e.jsxs("button",{type:"button",onClick:()=>a(`/clientes/${d.id}/financeiro`),className:"w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-lg transition-all flex items-center justify-center gap-2 font-semibold shadow-md",children:[e.jsx(Lr,{}),"ðŸ“Š Ver HistÃ³rico Financeiro Completo",ee&&e.jsxs("span",{className:"text-xs bg-white bg-opacity-20 px-2 py-1 rounded",children:[ee.total_transacoes_historico||0," transaÃ§Ãµes"]})]})]})}):e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:e.jsx("p",{className:"text-blue-800 text-sm",children:"â„¹ï¸ Salve o cliente primeiro para visualizar o resumo financeiro"})})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:["ðŸ’¡ ",e.jsx("strong",{children:"Dica:"})," O crÃ©dito pode ser gerado automaticamente nas devoluÃ§Ãµes de produtos e utilizado como forma de pagamento no PDV."]})}),d&&e.jsx(Dc,{clienteId:d.id}),d&&e.jsx(Tc,{clienteId:d.id,cliente:d,metricas:ee}),d&&d.celular&&e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ls,{className:"text-green-600",size:24}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ðŸ’¬ WhatsApp"})]}),e.jsxs("button",{type:"button",onClick:()=>{const V=d.celular.replace(/\D/g,"");window.open(`https://wa.me/55${V}`,"_blank")},className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm font-medium",children:[e.jsx(Ls,{}),"Abrir conversa"]})]}),e.jsx(Ge,{clienteId:d.id})]}),d&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm",children:e.jsx(Lo,{clienteId:d.tipo_cadastro==="cliente"?d.id:null,fornecedorId:d.tipo_cadastro==="fornecedor"?d.id:null,tipo:d.tipo_cadastro==="fornecedor"?"fornecedor":"cliente",limit:5,showHeader:!0,onVerMais:()=>a(`/clientes/${d.id}/timeline`)})})]})]}),e.jsxs("div",{className:"border-t border-gray-200 p-4 bg-gray-50 flex justify-between",children:[e.jsxs("button",{onClick:Pe,disabled:P===1,className:"flex items-center gap-2 px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(wt,{})," Voltar"]}),P<6?e.jsxs("button",{onClick:U,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:["AvanÃ§ar ",e.jsx(Mr,{})]}):e.jsxs("button",{onClick:ze,className:"flex items-center gap-2 px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[e.jsx(st,{})," Salvar Cliente"]})]})]})}),be&&Ie&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between z-10",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:Ie.index!==void 0?"Editar EndereÃ§o":"Adicionar Novo EndereÃ§o"}),e.jsx("button",{onClick:oe,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de EndereÃ§o *"}),e.jsxs("select",{value:Ie.tipo,onChange:V=>Je({...Ie,tipo:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"entrega",children:"ðŸ“¦ Entrega"}),e.jsx("option",{value:"cobranca",children:"ðŸ’° CobranÃ§a"}),e.jsx("option",{value:"comercial",children:"ðŸ¢ Comercial"}),e.jsx("option",{value:"residencial",children:"ðŸ  Residencial"}),e.jsx("option",{value:"trabalho",children:"ðŸ“ Trabalho"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apelido (opcional)"}),e.jsx("input",{type:"text",value:Ie.apelido,onChange:V=>Je({...Ie,apelido:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Ex: Casa da mÃ£e, EscritÃ³rio, Loja"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Ie.cep,onChange:V=>{const Re=V.target.value.replace(/\D/g,""),Oe=Re.length>5?`${Re.slice(0,5)}-${Re.slice(5,8)}`:Re;Je({...Ie,cep:Oe})},onBlur:V=>Ne(V.target.value),maxLength:"9",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"00000-000"}),w&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EndereÃ§o *"}),e.jsx("input",{type:"text",value:Ie.endereco,onChange:V=>Je({...Ie,endereco:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Rua, Avenida, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NÃºmero"}),e.jsx("input",{type:"text",value:Ie.numero,onChange:V=>Je({...Ie,numero:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"123"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complemento"}),e.jsx("input",{type:"text",value:Ie.complemento,onChange:V=>Je({...Ie,complemento:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Apto, Bloco, Sala..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bairro"}),e.jsx("input",{type:"text",value:Ie.bairro,onChange:V=>Je({...Ie,bairro:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Centro, Jardim..."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cidade *"}),e.jsx("input",{type:"text",value:Ie.cidade,onChange:V=>Je({...Ie,cidade:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"SÃ£o Paulo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsx("input",{type:"text",value:Ie.estado,onChange:V=>Je({...Ie,estado:V.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",maxLength:"2",placeholder:"SP"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"* Campos obrigatÃ³rios"})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:oe,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:ke,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Salvar EndereÃ§o"})]})]})}),e.jsx(Pc,{isOpen:g,onClose:()=>{v(!1),fetchClientes()}}),e.jsx("style",{children:`
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: scale(0.95);
          }
          to {
            opacity: 1;
            transform: scale(1);
          }
        }
        
        .animate-fade-in {
          animation: fadeIn 0.3s ease-out;
        }
      `})]})},Ul=(a={})=>F.get("/produtos/categorias",{params:a}),Wl=(a={})=>F.get("/produtos/marcas",{params:a}),Ic=(a={})=>F.get("/produtos/departamentos",{params:a}),Hl=(a={})=>F.get("/produtos/",{params:a}),zc=(a={})=>F.get("/produtos/vendaveis",{params:a}),$n=a=>F.get(`/produtos/${a}`),oo=a=>F.get(`/produtos/${a}/variacoes`),An=a=>F.post("/produtos/",a),Oc=(a,t)=>F.put(`/produtos/${a}`,t),_o=a=>F.delete(`/produtos/${a}`),Vc=(a="")=>F.post("/produtos/gerar-sku",{prefixo:a}),Bc=a=>F.post("/produtos/gerar-codigo-barras",{sku:a}),_r=a=>F.get(`/produtos/${a}/lotes`),Uc=(a,t)=>F.post(`/produtos/${a}/entrada`,t),Wc=(a,t,s)=>F.put(`/produtos/${a}/lotes/${t}`,s),Hc=(a,t)=>F.delete(`/produtos/${a}/lotes/${t}`),Kc=(a,t)=>F.post(`/produtos/${a}/imagens`,t,{headers:{"Content-Type":"multipart/form-data"}}),Gc=a=>F.delete(`/produtos/imagens/${a}`),no=a=>F.get(`/produtos/${a}/fornecedores`),Xc=(a,t)=>F.post(`/produtos/${a}/fornecedores`,t),Qc=(a,t)=>F.put(`/produtos/fornecedores/${a}`,t),Jc=a=>F.delete(`/produtos/fornecedores/${a}`),Yc=(a={})=>F.get("/produtos/relatorio/movimentacoes",{params:a}),Zc=(a,t)=>a*(1+t/100),Dn=(a,t)=>!a||a===0?0:(t-a)/a*100,Js=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a||0),wo=a=>a?new Date(a).toLocaleDateString("pt-BR"):"-";function ex({isOpen:a,onClose:t,onSuccess:s}){const[o,r]=n.useState(null),[i,l]=n.useState(!1),[x,j]=n.useState(null),[g,v]=n.useState("upload"),d=f=>{const b=f.target.files[0];b&&(b.name.endsWith(".xlsx")||b.name.endsWith(".xls")?(r(b),j(null)):(Ee.error("Arquivo deve ser Excel (.xlsx ou .xls)"),f.target.value=""))},m=async()=>{try{const f=localStorage.getItem("access_token")||localStorage.getItem("token"),b=await F.get("/produtos/template-importacao",{headers:{Authorization:`Bearer ${f}`},responseType:"blob"}),u=window.URL.createObjectURL(new Blob([b.data])),h=document.createElement("a");h.href=u,h.setAttribute("download",`template_produtos_${new Date().toISOString().split("T")[0]}.xlsx`),document.body.appendChild(h),h.click(),h.remove(),window.URL.revokeObjectURL(u),Ee.success("Template baixado com sucesso!")}catch(f){console.error("Erro ao baixar template:",f),Ee.error("Erro ao baixar template")}},C=async()=>{var f,b;if(!o){Ee.error("Selecione um arquivo para importar");return}l(!0),v("processando");try{const u=new FormData;u.append("file",o);const h=await F.post("/produtos/importar",u);j(h.data),v("resultado"),h.data.total_sucesso>0&&(Ee.success(`${h.data.total_sucesso} produtos processados com sucesso!`),s&&s()),h.data.total_erros>0&&Ee.error(`${h.data.total_erros} produtos com erro`)}catch(u){console.error("Erro ao importar:",u),Ee.error(((b=(f=u.response)==null?void 0:f.data)==null?void 0:b.detail)||"Erro ao importar produtos"),v("upload")}finally{l(!1)}},y=()=>{r(null),j(null),v("upload")},c=()=>{y(),t()};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-gradient-to-r from-blue-600 to-blue-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"ImportaÃƒÂ§ÃƒÂ£o de Produtos em Lote"})]}),e.jsx("button",{onClick:c,className:"text-white hover:text-gray-200 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:[g==="upload"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Como funciona"]}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 ml-7",children:[e.jsx("li",{children:"1. Baixe o template Excel clicando no botÃƒÂ£o abaixo"}),e.jsx("li",{children:"2. Preencha os dados dos produtos na planilha"}),e.jsx("li",{children:"3. Salve o arquivo e faÃƒÂ§a o upload aqui"}),e.jsx("li",{children:"4. Produtos novos serÃƒÂ£o criados, existentes serÃƒÂ£o atualizados (baseado no SKU)"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:m,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Baixar Template Excel"]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecione a Planilha Preenchida"}),e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx("svg",{className:"w-12 h-12 mb-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:"Clique para selecionar"})," ou arraste o arquivo"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Apenas arquivos Excel (.xlsx, .xls)"}),o&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-blue-600",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"font-medium",children:o.name})]})]}),e.jsx("input",{type:"file",className:"hidden",accept:".xlsx,.xls",onChange:d})]})})]})]}),g==="processando"&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mb-4"}),e.jsx("p",{className:"text-lg text-gray-700",children:"Processando planilha..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Isso pode levar alguns segundos"})]}),g==="resultado"&&x&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:x.total_processado}),e.jsx("div",{className:"text-sm text-blue-800 mt-1",children:"Total Processado"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:x.total_criados}),e.jsx("div",{className:"text-sm text-green-800 mt-1",children:"Criados"})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:x.total_atualizados}),e.jsx("div",{className:"text-sm text-yellow-800 mt-1",children:"Atualizados"})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:x.total_erros}),e.jsx("div",{className:"text-sm text-red-800 mt-1",children:"Erros"})]})]}),x.detalhes.criados.length>0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-green-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Produtos Criados (",x.detalhes.criados.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-1",children:x.detalhes.criados.map((f,b)=>e.jsxs("li",{className:"text-green-800",children:["Linha ",f.linha,": ",e.jsx("span",{className:"font-medium",children:f.sku})," - ",f.nome]},b))})})]}),x.detalhes.atualizados.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-yellow-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Produtos Atualizados (",x.detalhes.atualizados.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-1",children:x.detalhes.atualizados.map((f,b)=>e.jsxs("li",{className:"text-yellow-800",children:["Linha ",f.linha,": ",e.jsx("span",{className:"font-medium",children:f.sku})," - ",f.nome]},b))})})]}),x.detalhes.erros.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-red-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Erros (",x.detalhes.erros.length,")"]}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"text-sm space-y-2",children:x.detalhes.erros.map((f,b)=>e.jsxs("li",{className:"text-red-800",children:[e.jsxs("strong",{children:["Linha ",f.linha]})," (",f.sku,"): ",f.erro]},b))})})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3 bg-gray-50",children:[g==="upload"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:C,disabled:!o||i,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Importando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Importar Produtos"]})})]}),g==="resultado"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:y,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Importar Novamente"}),e.jsx("button",{onClick:c,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Concluir"})]})]})]})}):null}const qt=[{key:"checkbox",label:"",visible:!0,renderHeader:a=>e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:a.produtos.length>0&&a.selecionados.length===a.produtos.length,onChange:a.handleSelecionarTodos,className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"})}),renderCell:(a,t)=>e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:t.selecionados.includes(a.id),onChange:s=>t.handleSelecionar(a.id,s.nativeEvent),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 cursor-pointer"})})},{key:"imagem",label:"Imagem",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Imagem"}),renderCell:(a,t)=>{const s=a.tipo_produto==="VARIACAO";return e.jsx("td",{className:`px-4 py-3 ${s?"pl-12":""}`,children:e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden border border-gray-200 flex-shrink-0",children:a.imagem_principal?e.jsx("img",{src:a.imagem_principal.startsWith("http")?a.imagem_principal:`${window.location.origin}${a.imagem_principal}`,alt:a.nome,className:"w-full h-full object-cover object-center",onError:o=>{console.error("Erro ao carregar imagem:",a.imagem_principal),o.target.style.display="none",o.target.parentElement.innerHTML='<svg class="w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>'}}):e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})})}},{key:"descricao",label:"DescriÃ§Ã£o",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"DescriÃ§Ã£o"}),renderCell:(a,t)=>{const s=a.tipo_produto==="VARIACAO",o=a.tipo_produto==="PAI",r=a.tipo_produto==="KIT",i=(t.kitsExpandidos||[]).includes(a.id),l=(t.paisExpandidos||[]).includes(a.id);return e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`flex-1 ${s?"pl-6":""}`,children:[e.jsxs("div",{className:"flex items-center",children:[s&&e.jsx("svg",{className:"w-4 h-4 text-blue-400 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),o&&e.jsx("button",{onClick:x=>{x.preventDefault(),x.stopPropagation(),t.togglePaiExpandido(a.id)},className:"flex items-center text-blue-600 hover:text-blue-700 transition-colors mr-1",title:l?"Ocultar variaÃ§Ãµes":"Ver variaÃ§Ãµes",children:e.jsx("svg",{className:`w-4 h-4 transition-transform ${l?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),r&&e.jsx("button",{onClick:x=>{x.preventDefault(),x.stopPropagation(),t.toggleKitExpandido(a.id)},className:`flex items-center transition-colors mr-1 ${a.tipo_kit==="VIRTUAL"?"text-indigo-600 hover:text-indigo-700":"text-green-600 hover:text-green-700"}`,title:i?"Ocultar composiÃ§Ã£o":"Ver composiÃ§Ã£o",children:e.jsx("svg",{className:`w-4 h-4 transition-transform ${i?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[a.nome,o&&e.jsxs("span",{className:"ml-2 text-xs text-blue-600",children:["(Pai ",a.total_variacoes||0,")"]}),r&&a.tipo_kit==="VIRTUAL"&&e.jsx("span",{className:"ml-2 text-xs text-indigo-600",children:"(Kit â€¢ Virtual)"}),r&&a.tipo_kit==="FISICO"&&e.jsx("span",{className:"ml-2 text-xs text-green-600",children:"(Kit â€¢ FÃ­sico)"}),a.data_descontinuacao&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800",children:"âš ï¸ Descontinuado"})]})]}),a.descricao&&e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-xs mt-1",children:a.descricao})]}),e.jsx("button",{onClick:x=>{x.stopPropagation(),t.copiarTexto(a.nome,"Nome")},className:"text-gray-400 hover:text-gray-600",title:"Copiar nome",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})})}},{key:"codigo",label:"CÃ³digo",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CÃ³digo"}),renderCell:(a,t)=>e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900 font-mono",children:a.codigo||a.sku}),a.codigo_barras&&e.jsx("div",{className:"text-xs text-gray-500 font-mono",children:a.codigo_barras})]}),e.jsx("button",{onClick:s=>{s.stopPropagation(),t.copiarTexto(a.codigo||a.sku,"SKU")},className:"text-gray-400 hover:text-gray-600",title:"Copiar SKU",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})})},{key:"unidade",label:"Unidade",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unidade"}),renderCell:a=>e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-sm text-gray-700",children:a.unidade||"UN"})})},{key:"custo",label:"Custo",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Custo"}),renderCell:(a,t)=>e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:"text-sm text-gray-900",children:Js(a.preco_custo)})})},{key:"preco_venda",label:"PV",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PV"}),renderCell:(a,t)=>e.jsx("td",{className:"px-4 py-3 text-right",children:t.editandoPreco===a.id?e.jsxs("div",{className:"flex items-center gap-1 justify-end",onClick:s=>s.stopPropagation(),children:[e.jsx("input",{type:"number",step:"0.01",value:t.novoPreco,onChange:s=>t.setNovoPreco(s.target.value),className:"w-24 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",autoFocus:!0}),e.jsx("button",{onClick:()=>t.handleSalvarPreco(a.id),className:"text-green-600 hover:text-green-800",title:"Salvar",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("button",{onClick:t.handleCancelarEdicaoPreco,className:"text-red-600 hover:text-red-800",title:"Cancelar",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("span",{className:"text-sm font-semibold text-green-600",children:Js(a.preco_venda)}),e.jsx("button",{onClick:s=>{s.stopPropagation(),t.handleEditarPreco(a.id,a.preco_venda)},className:"text-blue-600 hover:text-blue-800",title:"Editar preÃ§o",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})})},{key:"validade",label:"Validade",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Validade"}),renderCell:(a,t)=>e.jsx("td",{className:"px-4 py-3 text-center text-sm",children:t.getValidadeMaisProxima(a)})},{key:"estoque",label:"Estoque",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque"}),renderCell:(a,t)=>{const s=a.tipo_produto==="KIT"&&a.tipo_kit==="VIRTUAL",o=s?a.estoque_virtual??0:a.estoque_atual||0;return e.jsx("td",{className:"px-4 py-3 text-center",children:a.controlar_estoque?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:`text-sm ${t.getCorEstoque(a)}`,children:o}),s&&e.jsx("span",{className:"text-xs text-gray-400 mt-0.5",children:"estoque virtual"})]}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})})}},{key:"acoes",label:"AÃ§Ãµes",visible:!0,renderHeader:()=>e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"}),renderCell:(a,t)=>e.jsx("td",{className:"px-4 py-3 text-center",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),console.log("Produto:",a.nome,"Controla estoque:",a.controlar_estoque,"Estoque atual:",a.estoque_atual),t.navigate(`/produtos/${a.id}/movimentacoes`)},className:`rounded hover:opacity-80 transition-opacity ${a.controlar_estoque===!0&&(a.estoque_atual||0)>0?"text-green-600 hover:text-green-800":a.controlar_estoque===!0&&(a.estoque_atual||0)===0?"text-red-600 hover:text-red-800":"text-gray-400 hover:text-gray-600"}`,title:"Ver movimentaÃ§Ãµes de estoque",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),t.navigate(`/produtos/${a.id}/editar`)},className:"text-blue-600 hover:text-blue-800 transition-colors",title:"Editar",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),t.handleExcluir(a.id)},className:"text-red-600 hover:text-red-800 transition-colors",title:"Excluir",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})}];function ax(){const a=va(),[t,s]=n.useState([]),[o,r]=n.useState([]),[i,l]=n.useState([]),[x,j]=n.useState(!0),[g,v]=n.useState([]),[d,m]=n.useState(null),[C,y]=n.useState(null),[c,f]=n.useState(""),[b,u]=n.useState([]),[h,p]=n.useState([]),[k,N]=n.useState(()=>{const Y=localStorage.getItem("produtos_colunas_visiveis");return Y?JSON.parse(Y):null}),[w,S]=n.useState(!1),[P,W]=n.useState([]),[te,D]=n.useState(!1),[A,X]=n.useState({marca_id:"",categoria_id:"",departamento_id:""}),[re,M]=n.useState([]),[Z,$]=n.useState(!1),[J,E]=n.useState({busca:"",categoria_id:"",marca_id:"",estoque_baixo:!1,em_promocao:!1}),[R,K]=n.useState(1),[B,_]=n.useState(20),O=n.useMemo(()=>{if(!t||t.length===0)return[];const Y=[],ve=t.filter(Q=>Q.tipo_produto==="PAI"),Le=t.filter(Q=>Q.tipo_produto==="VARIACAO"),I=t.filter(Q=>Q.tipo_produto!=="PAI"&&Q.tipo_produto!=="VARIACAO");return Y.push(...I),ve.forEach(Q=>{if(Y.push(Q),h.includes(Q.id)){const fe=Le.filter(U=>U.produto_pai_id===Q.id);Y.push(...fe)}}),Y},[t,h]),q=n.useMemo(()=>{let Y=[...O];if(J.busca.trim()){const ve=J.busca.toLowerCase();Y=Y.filter(Le=>Le.nome&&Le.nome.toLowerCase().includes(ve)||Le.codigo&&Le.codigo.toLowerCase().includes(ve))}return J.categoria_id&&(Y=Y.filter(ve=>ve.categoria_id==J.categoria_id)),J.marca_id&&(Y=Y.filter(ve=>ve.marca_id==J.marca_id)),J.estoque_baixo&&(Y=Y.filter(ve=>{const Le=ve.tipo_produto==="KIT"&&ve.tipo_kit==="VIRTUAL"?ve.estoque_virtual??0:ve.estoque_atual||0,I=ve.estoque_minimo||0;return ve.controlar_estoque&&Le<=I})),J.em_promocao&&(Y=Y.filter(ve=>ve.promocao_ativa===!0)),Y},[O,J]),{produtosPaginados:ae,totalPaginas:H,totalItens:le}=n.useMemo(()=>{const Y=Math.ceil(q.length/B),ve=(R-1)*B,Le=ve+B;return{produtosPaginados:q.slice(ve,Le),totalPaginas:Y,totalItens:q.length}},[q,R,B]),G=ae;n.useEffect(()=>{K(1)},[J]),n.useEffect(()=>{ee(),de(),ue(),Ae()},[]);const ee=async()=>{try{j(!0);const Y={};Object.keys(J).forEach(I=>{const Q=J[I];Q!==""&&Q!==null&&Q!==void 0&&(Y[I]=Q)});const ve=await Hl(Y);let Le;if(Array.isArray(ve.data))Le=ve.data;else if(ve.data.itens)Le=ve.data.itens;else if(ve.data.produtos)Le=ve.data.produtos;else if(ve.data.data)Le=ve.data.data;else{const I=Object.keys(ve.data).filter(Q=>Array.isArray(ve.data[Q]));I.length>0?Le=ve.data[I[0]]:Le=[]}s(Le)}catch(Y){console.error("Erro ao carregar produtos:",Y),alert("Erro ao carregar produtos")}finally{j(!1)}},de=async()=>{try{const Y=await Ul();r(Y.data)}catch(Y){console.error("Erro ao carregar categorias:",Y)}},ue=async()=>{try{const Y=await Wl();l(Y.data)}catch(Y){console.error("Erro ao carregar marcas:",Y)}},Ae=async()=>{try{const Y=await F.get("/produtos/departamentos");M(Y.data)}catch(Y){console.error("Erro ao carregar departamentos:",Y)}},se=(Y,ve)=>{E(Le=>({...Le,[Y]:ve}))},we=(Y,ve)=>{if(!Y){console.error("Erro: ID do produto Ã© undefined ou null");return}if(ve!=null&&ve.shiftKey&&d!==null){const Le=G.findIndex(Q=>Q.id===d),I=G.findIndex(Q=>Q.id===Y);if(Le!==-1&&I!==-1){const Q=Math.min(Le,I),fe=Math.max(Le,I),U=G.slice(Q,fe+1).map(ie=>ie.id);v(ie=>{const _e=new Set(ie);return U.forEach($e=>_e.add($e)),Array.from(_e)}),m(Y);return}}v(Le=>Le.includes(Y)?Le.filter(I=>I!==Y):[...Le,Y]),m(Y)},Se=()=>{g.length===G.length?v([]):v(G.map(Y=>Y.id))},ea=async Y=>{if(confirm("Deseja realmente excluir este produto?"))try{await _o(Y),alert("Produto excluÃ­do com sucesso!"),ee()}catch(ve){console.error("Erro ao excluir produto:",ve),alert("Erro ao excluir produto")}},Ie=async()=>{if(confirm(`Deseja realmente excluir ${g.length} produtos?`))try{await Promise.all(g.map(Y=>_o(Y))),alert("Produtos excluÃ­dos com sucesso!"),v([]),ee()}catch(Y){console.error("Erro ao excluir produtos:",Y),alert("Erro ao excluir produtos")}},Je=(Y,ve)=>{navigator.clipboard.writeText(Y),Ee.success(`${ve} copiado!`)},be=(Y,ve)=>{y(Y),f(ve.toString())},Fe=async Y=>{try{await F.patch(`/produtos/${Y}?preco_venda=${c}`,{}),Ee.success("PreÃ§o atualizado!"),y(null),ee()}catch(ve){console.error("Erro ao atualizar preÃ§o:",ve),Ee.error("Erro ao atualizar preÃ§o")}},he=()=>{y(null)},Qe=()=>{if(g.length===0){Ee.error("Selecione pelo menos um produto");return}X({marca_id:"",categoria_id:"",departamento_id:""}),D(!0)},Ze=async()=>{try{if(Object.values(A).filter(Le=>Le!=="").length===0){Ee.error("Preencha pelo menos um campo para atualizar");return}const ve={};A.marca_id&&(ve.marca_id=parseInt(A.marca_id)),A.categoria_id&&(ve.categoria_id=parseInt(A.categoria_id)),A.departamento_id&&(ve.departamento_id=parseInt(A.departamento_id)),await F.patch("/produtos/atualizar-lote",{produto_ids:g,...ve}),Ee.success(`${g.length} produto(s) atualizado(s) com sucesso!`),D(!1),v([]),ee()}catch(Y){console.error("Erro ao atualizar produtos:",Y),Ee.error("Erro ao atualizar produtos")}},ma=Y=>{if(!Y.controlar_estoque)return"text-gray-500";const ve=Y.tipo_produto==="KIT"&&Y.tipo_kit==="VIRTUAL"?Y.estoque_virtual??0:Y.estoque_atual||0,Le=Y.estoque_minimo||0;return ve<=0?"text-red-600 font-semibold":ve<=Le?"text-yellow-600 font-medium":"text-gray-700"},oa=Y=>{if(!Y.lotes||Y.lotes.length===0)return"-";const ve=Y.lotes.filter(fe=>fe.data_validade).sort((fe,U)=>new Date(fe.data_validade)-new Date(U.data_validade));if(ve.length===0)return"-";const Le=ve[0].data_validade,I=Math.floor((new Date(Le)-new Date)/(1e3*60*60*24));let Q="text-gray-700";return I<0?Q="text-red-600 font-bold":I<=30?Q="text-orange-600 font-semibold":I<=90&&(Q="text-yellow-600"),e.jsx("span",{className:Q,children:wo(Le)})},ha=Y=>{u(ve=>ve.includes(Y)?ve.filter(Le=>Le!==Y):[...ve,Y])},da=Y=>{p(ve=>ve.includes(Y)?ve.filter(Le=>Le!==Y):[...ve,Y])},oe=()=>{const Y=k||qt.map(ve=>ve.key);W(Y),S(!0)},Ne=Y=>{W(ve=>ve.includes(Y)?ve.filter(Le=>Le!==Y):[...ve,Y])},ke=()=>{localStorage.setItem("produtos_colunas_visiveis",JSON.stringify(P)),N(P),S(!1),Ee.success("PreferÃªncias de colunas salvas!")},Ue=()=>{localStorage.removeItem("produtos_colunas_visiveis"),N(null),W(qt.map(Y=>Y.key)),Ee.success("Colunas restauradas para o padrÃ£o!")},ze=Y=>k?k.includes(Y.key):!0;return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Produtos"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie seu estoque de produtos"})]}),e.jsxs("div",{className:"flex gap-2",children:[g.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Qe,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:["âœï¸ Editar em Lote (",g.length,")"]}),e.jsxs("button",{onClick:Ie,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:["Excluir Selecionados (",g.length,")"]})]}),e.jsxs("button",{onClick:()=>$(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Importar Excel"]}),e.jsxs("button",{onClick:oe,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium flex items-center gap-2",title:"Configurar colunas visÃ­veis",children:[e.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Colunas"]}),e.jsx("button",{onClick:()=>a("/produtos/novo"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"+ Novo Produto"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx("input",{type:"text",placeholder:"Buscar por cÃ³digo, nome ou cÃ³digo de barras...",value:J.busca,onChange:Y=>se("busca",Y.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),e.jsx("div",{children:e.jsxs("select",{value:J.categoria_id,onChange:Y=>se("categoria_id",Y.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas as Categorias"}),o.map(Y=>e.jsxs("option",{value:Y.id,children:[Y.categoria_pai_id?"  â””â”€ ":"",Y.nome]},Y.id))]})}),e.jsx("div",{children:e.jsxs("select",{value:J.marca_id,onChange:Y=>se("marca_id",Y.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas as Marcas"}),i.map(Y=>e.jsx("option",{value:Y.id,children:Y.nome},Y.id))]})}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:J.estoque_baixo,onChange:Y=>se("estoque_baixo",Y.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Estoque Baixo"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:J.em_promocao,onChange:Y=>se("em_promocao",Y.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Em PromoÃ§Ã£o"})]})]})]})}),!x&&le>0&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border border-gray-200 rounded-t-lg flex items-center justify-between mt-6 mb-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",(R-1)*B+1," a ",Math.min(R*B,le)," de ",le," produtos"]}),e.jsxs("select",{value:B,onChange:Y=>{_(Number(Y.target.value)),K(1)},className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10 por pÃ¡gina"}),e.jsx("option",{value:20,children:"20 por pÃ¡gina"}),e.jsx("option",{value:30,children:"30 por pÃ¡gina"}),e.jsx("option",{value:50,children:"50 por pÃ¡gina"}),e.jsx("option",{value:100,children:"100 por pÃ¡gina"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>K(1),disabled:R===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Primeira"}),e.jsx("button",{onClick:()=>K(Y=>Math.max(Y-1,1)),disabled:R===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(H,5)},(Y,ve)=>{let Le;return H<=5||R<=3?Le=ve+1:R>=H-2?Le=H-4+ve:Le=R-2+ve,e.jsx("button",{onClick:()=>K(Le),className:`px-3 py-1 text-sm font-medium rounded-lg transition-colors ${R===Le?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:Le},Le)})}),e.jsx("button",{onClick:()=>K(Y=>Math.min(Y+1,H)),disabled:R===H,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"PrÃ³xima"}),e.jsx("button",{onClick:()=>K(H),disabled:R===H,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Ãšltima"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:qt.filter(ze).map(Y=>e.jsx(ms.Fragment,{children:Y.renderHeader({produtos:G,selecionados:g,handleSelecionarTodos:Se})},Y.key))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"px-4 py-8 text-center text-gray-500",children:"Carregando produtos..."})}):G.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"px-4 py-8 text-center text-gray-500",children:"Nenhum produto encontrado"})}):G.map((Y,ve)=>{if(!Y||!Y.id)return console.error(`Produto invÃ¡lido no Ã­ndice ${ve}:`,Y),null;const Le=Y.tipo_produto==="KIT",I=b.includes(Y.id);return e.jsxs(ms.Fragment,{children:[e.jsx("tr",{className:`hover:bg-gray-50 transition-colors cursor-pointer ${Y.tipo_produto==="VARIACAO"?"bg-blue-50/30":""} ${Le?"bg-amber-50/30":""}`,onClick:Q=>{Q.target.closest("button, input, a, svg")||a(`/produtos/${Y.id}/editar`)},children:qt.filter(ze).map(Q=>e.jsx(ms.Fragment,{children:Q.renderCell(Y,{selecionados:g,handleSelecionar:we,kitsExpandidos:b,toggleKitExpandido:ha,paisExpandidos:h,togglePaiExpandido:da,copiarTexto:Je,editandoPreco:C,novoPreco:c,setNovoPreco:f,handleSalvarPreco:Fe,handleCancelarEdicaoPreco:he,handleEditarPreco:be,getValidadeMaisProxima:oa,getCorEstoque:ma,navigate:a,handleExcluir:ea})},Q.key))}),Le&&I&&Y.composicao_kit&&Y.composicao_kit.length>0&&e.jsx("tr",{className:"bg-amber-50/50 border-l-4 border-amber-400",children:e.jsx("td",{colSpan:"10",className:"px-4 py-3",children:e.jsxs("div",{className:"ml-12",children:[e.jsxs("div",{className:"text-xs font-semibold text-amber-800 mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"COMPOSIÃ‡ÃƒO DO KIT:"]}),e.jsx("div",{className:"grid gap-1",children:Y.composicao_kit.map((Q,fe)=>e.jsxs("div",{className:"flex items-center gap-3 text-xs bg-white rounded px-3 py-2 border border-amber-200",children:[e.jsxs("span",{className:"font-mono font-semibold text-amber-700 min-w-[40px]",children:[Q.quantidade,"x"]}),e.jsx("span",{className:"flex-1 text-gray-700",children:Q.produto_nome||Q.nome||`Produto #${Q.produto_id||Q.produto_componente_id}`}),Q.produto_estoque!==void 0&&e.jsxs("span",{className:"text-gray-500",children:["Estoque: ",e.jsx("span",{className:Q.produto_estoque>0?"text-green-600 font-semibold":"text-red-600 font-semibold",children:Q.produto_estoque})]})]},fe))})]})})},`kit-${Y.id}`)]},Y.id)})})]})}),!x&&le>0&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Mostrando ",(R-1)*B+1," a ",Math.min(R*B,le)," de ",le," produtos"]}),e.jsxs("select",{value:B,onChange:Y=>{_(Number(Y.target.value)),K(1)},className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10 por pÃ¡gina"}),e.jsx("option",{value:20,children:"20 por pÃ¡gina"}),e.jsx("option",{value:30,children:"30 por pÃ¡gina"}),e.jsx("option",{value:50,children:"50 por pÃ¡gina"}),e.jsx("option",{value:100,children:"100 por pÃ¡gina"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>K(1),disabled:R===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Primeira"}),e.jsx("button",{onClick:()=>K(Y=>Math.max(Y-1,1)),disabled:R===1,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(H,5)},(Y,ve)=>{let Le;return H<=5||R<=3?Le=ve+1:R>=H-2?Le=H-4+ve:Le=R-2+ve,e.jsx("button",{onClick:()=>K(Le),className:`px-3 py-1 text-sm font-medium rounded-lg transition-colors ${R===Le?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:Le},Le)})}),e.jsx("button",{onClick:()=>K(Y=>Math.min(Y+1,H)),disabled:R===H,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"PrÃ³xima"}),e.jsx("button",{onClick:()=>K(H),disabled:R===H,className:"px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Ãšltima"})]})]}),!x&&g.length>0&&e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200",children:e.jsx("div",{className:"flex justify-between items-center text-sm text-gray-600",children:e.jsxs("span",{children:[g.length," produto",g.length>1?"s":""," selecionado",g.length>1?"s":""]})})})]}),te&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Editar em Lote"}),e.jsx("button",{onClick:()=>D(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Atualizar ",e.jsx("strong",{children:g.length})," produto(s) selecionado(s)"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Marca"}),e.jsxs("select",{value:A.marca_id,onChange:Y=>X({...A,marca_id:Y.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"NÃ£o alterar"}),i.map(Y=>e.jsx("option",{value:Y.id,children:Y.nome},Y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria"}),e.jsxs("select",{value:A.categoria_id,onChange:Y=>X({...A,categoria_id:Y.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"NÃ£o alterar"}),o.map(Y=>e.jsxs("option",{value:Y.id,children:[Y.categoria_pai_id?"  â””â”€ ":"",Y.nome]},Y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Departamento"}),e.jsxs("select",{value:A.departamento_id,onChange:Y=>X({...A,departamento_id:Y.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"NÃ£o alterar"}),re.map(Y=>e.jsx("option",{value:Y.id,children:Y.nome},Y.id))]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>D(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:Ze,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Salvar AlteraÃ§Ãµes"})]})]})}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Configurar Colunas"}),e.jsx("button",{onClick:()=>S(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"px-6 py-4 max-h-96 overflow-y-auto",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Selecione quais colunas deseja visualizar na tabela:"}),e.jsx("div",{className:"space-y-2",children:qt.map(Y=>e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:P.includes(Y.key),onChange:()=>Ne(Y.key),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:Y.label||Y.key})]},Y.key))})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-between gap-3",children:[e.jsx("button",{onClick:Ue,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Restaurar PadrÃ£o"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>S(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:ke,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors",children:"Salvar"})]})]})]})}),e.jsx(ex,{isOpen:Z,onClose:()=>$(!1),onSuccess:()=>{ee(),$(!1)}})]})}const sx=({value:a,onChange:t,pesoEmbalagem:s})=>{const[o,r]=n.useState("filhote_peso_adulto"),[i,l]=n.useState([]),[x,j]=n.useState(!1),g=n.useRef(null),[v]=n.useState([{id:"2m",label:"2 meses"},{id:"3m",label:"3 meses"},{id:"4m",label:"4 meses"},{id:"6m",label:"6 meses"},{id:"8m",label:"8 meses"},{id:"10m",label:"10 meses"},{id:"12m",label:"12 meses"},{id:"15m",label:"15 meses"},{id:"18m",label:"18 meses"},{id:"adulto",label:"Adulto"}]);n.useEffect(()=>{if(a&&!x)try{const p=typeof a=="string"?JSON.parse(a):a;if(console.log("ðŸ“¥ Carregando tabela:",p),p.tipo&&r(p.tipo),p.dados){const k=Object.entries(p.dados).map(([N,w])=>({peso:N,consumos:w}));l(k)}j(!0)}catch(p){console.error("Erro ao carregar tabela:",p),j(!0)}},[a,x]);const d=()=>{switch(o){case"filhote_peso_adulto":return"Peso Adulto Esperado";case"adulto":return"Peso Atual";default:return"Peso"}},m=()=>{switch(o){case"filhote_peso_adulto":return"Ex: 5kg, 10kg, 15kg, 20kg";case"adulto":return"Ex: 5kg, 10kg, 15kg, 20kg";default:return""}},C=()=>{const p={peso:"",consumos:{}},k=[...i,p];l(k)},y=p=>{const k=i.filter((N,w)=>w!==p);l(k),u(k)},c=(p,k)=>{const N=[...i];N[p].peso=k,l(N)},f=(p,k,N)=>{const w=[...i];w[p].consumos||(w[p].consumos={});const S=parseFloat(N)||0;w[p].consumos[k]=S,l(w)},b=p=>{if(!s||!p)return"-";const k=s*1e3;return`${Math.floor(k/p)}d`},u=n.useCallback(p=>{if(!x){console.log("â¸ï¸ Aguardando carregamento inicial...");return}const k=p||i,N={};k.forEach(P=>{P.peso&&(N[P.peso]=P.consumos)});const w={tipo:o,dados:N},S=JSON.stringify(w);if(g.current===S){console.log("â­ï¸ Ignorando - jÃ¡ estÃ¡ salvo");return}console.log("ðŸ’¾ Salvando tabela:",w),g.current=S,t(S)},[i,o,t,x]),h=()=>{u(),alert("âœ… Tabela de consumo salva com sucesso!")};return e.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2 flex items-center gap-2",children:"ðŸ“Š Tabela de Consumo da Embalagem"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Preencha a tabela com as informaÃ§Ãµes da embalagem. A IA usarÃ¡ esses dados para calcular duraÃ§Ã£o e custo-benefÃ­cio."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Tabela da Embalagem:"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"filhote_peso_adulto",checked:o==="filhote_peso_adulto",onChange:p=>r(p.target.value),className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"ðŸ¶ Filhote (Peso Adulto Esperado)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"adulto",checked:o==="adulto",onChange:p=>r(p.target.value),className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"ðŸ• Adulto (Peso Atual)"})]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-semibold text-gray-700 w-32",children:d()}),v.map(p=>e.jsxs("th",{className:"border border-gray-300 px-2 py-2 text-center text-xs font-semibold text-gray-700 min-w-[90px]",children:[p.label,e.jsx("div",{className:"text-[10px] text-gray-500 font-normal",children:"g/dia | dias"})]},p.id)),e.jsx("th",{className:"border border-gray-300 px-2 py-2 text-center text-sm font-semibold text-gray-700 w-16",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{children:i.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:v.length+2,className:"border border-gray-300 px-4 py-8 text-center text-gray-500",children:[e.jsx(Ca,{className:"inline-block mr-2"}),'Nenhuma linha adicionada. Clique em "Adicionar Linha" para comeÃ§ar.']})}):i.map((p,k)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 px-2 py-2",children:e.jsx("input",{type:"text",value:p.peso,onChange:N=>c(k,N.target.value),onBlur:()=>u(),placeholder:m(),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})}),v.map(N=>{var P;const w=((P=p.consumos)==null?void 0:P[N.id])||"",S=b(w);return e.jsxs("td",{className:"border border-gray-300 px-1 py-1",children:[e.jsx("input",{type:"number",value:w,onChange:W=>f(k,N.id,W.target.value),onBlur:()=>u(),placeholder:"0",className:"w-full px-2 py-1 text-sm text-center border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("div",{className:"text-[10px] text-center text-gray-500 mt-0.5",children:S})]},N.id)}),e.jsx("td",{className:"border border-gray-300 px-2 py-2 text-center",children:e.jsx("button",{type:"button",onClick:()=>y(k),className:"text-red-600 hover:text-red-800 p-1",title:"Remover linha",children:e.jsx(Ss,{size:16})})})]},k))})]})}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsxs("button",{type:"button",onClick:C,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(as,{size:16}),"Adicionar Linha"]}),e.jsxs("button",{type:"button",onClick:h,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:[e.jsx(st,{size:16}),"Salvar Tabela"]})]}),s&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:["ðŸ’¡ ",e.jsx("strong",{children:"Peso da embalagem:"})," ",s,"kg (",s*1e3,"g)",e.jsx("br",{}),"A duraÃ§Ã£o (dias) Ã© calculada automaticamente: ",e.jsx("code",{children:"peso_embalagem Ã· consumo_diÃ¡rio"})]})})]})},cs=a=>{if(a===""||a===null||a===void 0)return 0;const s=a.toString().replace(/[^\d.,]/g,"").replace(",","."),o=parseFloat(s);return isNaN(o)?0:o};function Mn(){var Dt,ir,it,dr,cr,dt,xr,mr,ur,pr,gr,hr,Fs,Os,Mt;const a=va(),{id:t}=lt(),[s]=Kr(),o=!!t,[r,i]=n.useState(1),[l,x]=n.useState({codigo:"",sku:"",nome:"",codigo_barras:"",categoria_id:"",marca_id:"",departamento_id:"",tipo:"produto",unidade:"UN",descricao:"",preco_custo:"",preco_venda:"",preco_promocional:"",data_inicio_promocao:"",data_fim_promocao:"",markup:"",tipo_produto:"SIMPLES",produto_pai_id:null,tipo_kit:null,e_kit_fisico:!1,composicao_kit:[],produto_predecessor_id:null,motivo_descontinuacao:"",controle_lote:!0,estoque_minimo:"",estoque_maximo:"",tributacao:{origem:null,herdado_da_empresa:!1,origem_mercadoria:"0",ncm:"",cest:"",cfop:"",cst_icms:"",icms_aliquota:"",icms_st:!1,pis_aliquota:"",cofins_aliquota:""},origem:"0",ncm:"",cest:"",cfop:"",aliquota_icms:"",aliquota_pis:"",aliquota_cofins:"",tem_recorrencia:!1,tipo_recorrencia:"monthly",intervalo_dias:"",numero_doses:"",observacoes_recorrencia:"",especie_compativel:"both",classificacao_racao:"",peso_embalagem:"",tabela_nutricional:"",tabela_consumo:"",categoria_racao:"",especies_indicadas:"both",linha_racao_id:"",porte_animal_id:"",fase_publico_id:"",tipo_tratamento_id:"",sabor_proteina_id:"",apresentacao_peso_id:""}),[j,g]=n.useState([]),[v,d]=n.useState([]),[m,C]=n.useState([]),[y,c]=n.useState([]),[f,b]=n.useState([]),[u,h]=n.useState([]),[p,k]=n.useState([]),[N,w]=n.useState([]),[S,P]=n.useState([]),[W,te]=n.useState([]),[D,A]=n.useState([]),[X,re]=n.useState([]),[M,Z]=n.useState([]),[$,J]=n.useState([]),[E,R]=n.useState([]),[K,B]=n.useState({sku:"",nome:"",codigo_barras:"",preco_custo:"",preco_venda:"",estoque_minimo:0,e_kit:!1,e_kit_fisico:!1,composicao_kit:[]}),[_,O]=n.useState(!1),[q,ae]=n.useState([]),[H,le]=n.useState(""),[G,ee]=n.useState(""),[de,ue]=n.useState(0),[Ae,se]=n.useState(!1),[we,Se]=n.useState([]),[ea,Ie]=n.useState(""),[Je,be]=n.useState(null),[Fe,he]=n.useState(null),[Qe,Ze]=n.useState(null),[ma,oa]=n.useState(!1),[ha,da]=n.useState(!1),[oe,Ne]=n.useState(!1),[ke,Ue]=n.useState(!1),[ze,Y]=n.useState({quantidade:"",nome_lote:"",data_fabricacao:"",data_validade:"",preco_custo:""}),[ve,Le]=n.useState(!1),[I,Q]=n.useState({preco_custo:!1,markup:!1,preco_venda:!1,preco_promocional:!1}),[fe,U]=n.useState(null),[ie,_e]=n.useState(!1),[$e,T]=n.useState(null),[ne,pe]=n.useState({fornecedor_id:"",codigo_fornecedor:"",preco_custo:"",prazo_entrega:"",estoque_fornecedor:"",e_principal:!1});n.useEffect(()=>{Be(),o&&aa()},[t]),n.useEffect(()=>{if(!o&&l.nome){const L=l.nome.toLowerCase();(L.includes("racao")||L.includes("raÃ§Ã£o"))&&l.classificacao_racao!=="sim"&&x(Me=>({...Me,classificacao_racao:"sim"}))}},[l.nome,o,l.classificacao_racao]),n.useEffect(()=>{if(!ma&&o){const L=s.get("aba");L&&i(parseInt(L))}},[ma,s,o]),n.useEffect(()=>{o&&l.tipo_produto==="VARIACAO"&&r===8&&i(1)},[l.tipo_produto,r,o]),n.useEffect(()=>{o&&r===8&&l.tipo_produto==="PAI"&&Pe()},[r,o,l.tipo_produto]);const Pe=async()=>{try{const L=await oo(t);R(L.data)}catch(L){console.error("Erro ao carregar variaÃ§Ãµes:",L)}},Be=async()=>{try{const[L,ge,Me,Ye]=await Promise.all([Ul(),Wl(),Ic(),F.get("/clientes/",{params:{tipo_cadastro:"fornecedor",apenas_ativos:!0}})]);g(L.data);const Ve=Ge(L.data);d(Ve),C(ge.data),c(Me.data),w(Ye.data),Ke()}catch(L){console.error("Erro ao carregar dados auxiliares:",L)}},Ke=async()=>{try{const[L,ge,Me,Ye,Ve,Na]=await Promise.all([F.get("/opcoes-racao/linhas",{params:{apenas_ativos:!0}}),F.get("/opcoes-racao/portes",{params:{apenas_ativos:!0}}),F.get("/opcoes-racao/fases",{params:{apenas_ativos:!0}}),F.get("/opcoes-racao/tratamentos",{params:{apenas_ativos:!0}}),F.get("/opcoes-racao/sabores",{params:{apenas_ativos:!0}}),F.get("/opcoes-racao/apresentacoes",{params:{apenas_ativos:!0}})]);P(L.data),te(ge.data),A(Me.data),re(Ye.data),Z(Ve.data),J(Na.data)}catch(L){console.error("Erro ao carregar opÃ§Ãµes de raÃ§Ã£o:",L)}},Ge=(L,ge=null,Me=0)=>{let Ye=[];return L.filter(Na=>Na.categoria_pai_id===ge).forEach(Na=>{const Xa="Â Â Â Â ".repeat(Me),Ea=Me>0?"â†’ ":"";Ye.push({...Na,nomeFormatado:Xa+Ea+Na.nome,nivel:Me});const Ba=Ge(L,Na.id,Me+1);Ye=Ye.concat(Ba)}),Ye},aa=async()=>{var L,ge,Me;try{oa(!0),he(null),Ze(null);const Ve=(await $n(t)).data;let Na="";if(Ve.preco_custo&&Ve.preco_venda&&Ve.preco_custo>0&&(Na=Dn(Ve.preco_custo,Ve.preco_venda).toFixed(2)),x({...Ve,sku:Ve.codigo||"",codigo:Ve.codigo||"",nome:Ve.nome||"",codigo_barras:Ve.codigo_barras||"",categoria_id:Ve.categoria_id||"",marca_id:Ve.marca_id||"",departamento_id:Ve.departamento_id||"",unidade:Ve.unidade||"UN",descricao:Ve.descricao_curta||"",tipo:Ve.tipo||"produto",preco_custo:Ve.preco_custo||"",preco_venda:Ve.preco_venda||"",preco_promocional:Ve.preco_promocional||"",data_inicio_promocao:Ve.promocao_inicio||"",data_fim_promocao:Ve.promocao_fim||"",estoque_minimo:Ve.estoque_minimo||"",estoque_maximo:Ve.estoque_maximo||"",controle_lote:Ve.controle_lote??!0,markup:Na,tipo_produto:Ve.tipo_produto||"SIMPLES",produto_pai_id:Ve.produto_pai_id||null,tipo_kit:Ve.tipo_kit||null,e_kit_fisico:Ve.e_kit_fisico||!1,composicao_kit:Ve.composicao_kit||[],origem:Ve.origem||"0",ncm:Ve.ncm||"",cest:Ve.cest||"",cfop:Ve.cfop||"",aliquota_icms:Ve.aliquota_icms||"",aliquota_pis:Ve.aliquota_pis||"",aliquota_cofins:Ve.aliquota_cofins||"",tem_recorrencia:Ve.tem_recorrencia||!1,tipo_recorrencia:Ve.tipo_recorrencia||"monthly",intervalo_dias:Ve.intervalo_dias||"",numero_doses:Ve.numero_doses||"",especie_compativel:Ve.especie_compativel||"both",observacoes_recorrencia:Ve.observacoes_recorrencia||"",classificacao_racao:Ve.classificacao_racao||"",peso_embalagem:Ve.peso_embalagem||"",tabela_nutricional:Ve.tabela_nutricional||"",tabela_consumo:Ve.tabela_consumo||"",categoria_racao:Ve.categoria_racao||"",especies_indicadas:Ve.especies_indicadas||"both",linha_racao_id:Ve.linha_racao_id||"",porte_animal_id:Ve.porte_animal_id||"",fase_publico_id:Ve.fase_publico_id||"",tipo_tratamento_id:Ve.tipo_tratamento_id||"",sabor_proteina_id:Ve.sabor_proteina_id||"",apresentacao_peso_id:Ve.apresentacao_peso_id||""}),Ve.produto_predecessor_id)try{const Ea=await $n(Ve.produto_predecessor_id);he({id:Ea.data.id,codigo:Ea.data.codigo,nome:Ea.data.nome,motivo_descontinuacao:Ve.motivo_descontinuacao,data_descontinuacao:(L=Ve.predecessor)==null?void 0:L.data_descontinuacao})}catch(Ea){console.error("Erro ao carregar predecessor:",Ea)}if(Ve.data_descontinuacao)try{const Ea=await F.get("/produtos/",{params:{produto_predecessor_id:Ve.id,ativo:null}}),Ba=Array.isArray(Ea.data)?Ea.data:Ea.data.items||[];if(Ba&&Ba.length>0){const Ps=Ba[0];Ze({id:Ps.id,codigo:Ps.codigo,nome:Ps.nome,motivo_descontinuacao:Ve.motivo_descontinuacao,data_descontinuacao:Ve.data_descontinuacao})}}catch(Ea){console.error("âŒ Erro ao carregar sucessor:",Ea)}try{const Ea=await F.get(`/produtos/${t}/imagens`);h(Ea.data||[])}catch(Ea){console.error("Erro ao carregar imagens:",Ea),h([])}if(Ve.controle_lote){const Ea=await _r(t);b(Ea.data)}const Xa=await no(t);k(Xa.data),await la(Ve)}catch(Ye){console.error("âŒ Erro ao carregar produto:",Ye),alert("Erro ao carregar produto: "+(((Me=(ge=Ye.response)==null?void 0:ge.data)==null?void 0:Me.detail)||Ye.message))}finally{oa(!1)}},la=async L=>{try{const ge=L.tipo_produto==="KIT",{data:Me}=ge?await F.get(`/produtos/${L.id}/kit/fiscal`):await F.get(`/produtos/${L.id}/fiscal`);x(Ye=>({...Ye,tributacao:{origem:Me.origem,herdado_da_empresa:Me.herdado_da_empresa,origem_mercadoria:Me.origem_mercadoria??"0",ncm:Me.ncm??"",cest:Me.cest??"",cfop:Me.cfop??"",cst_icms:Me.cst_icms??"",icms_aliquota:Me.icms_aliquota??"",icms_st:Me.icms_st??!1,pis_aliquota:Me.pis_aliquota??"",cofins_aliquota:Me.cofins_aliquota??""}}))}catch(ge){console.error("Erro ao carregar fiscal:",ge)}},ca=async L=>{const ge={origem_mercadoria:l.tributacao.origem_mercadoria,ncm:l.tributacao.ncm,cest:l.tributacao.cest,cfop:l.tributacao.cfop,cst_icms:l.tributacao.cst_icms,icms_aliquota:l.tributacao.icms_aliquota,icms_st:l.tributacao.icms_st,pis_aliquota:l.tributacao.pis_aliquota,cofins_aliquota:l.tributacao.cofins_aliquota};L.tipo_produto==="KIT"?await F.put(`/produtos/${L.id}/kit/fiscal`,ge):await F.put(`/produtos/${L.id}/fiscal`,ge)},We=(L,ge)=>{x(Me=>{const Ye={...Me,[L]:ge};if(L==="preco_custo"||L==="preco_venda"){const Ve=cs(L==="preco_custo"?ge:Me.preco_custo),Na=cs(L==="preco_venda"?ge:Me.preco_venda);if(Ve&&Na&&Ve>0){const Xa=Dn(Ve,Na);Ye.markup=Xa.toFixed(2)}}if(L==="markup"){const Ve=cs(Me.preco_custo),Na=cs(ge);if(Ve&&Ve>0&&Na>=0){const Xa=Zc(Ve,Na);Ye.preco_venda=Xa.toFixed(2)}}return Ye})},Sa=async()=>{try{const L=await Vc("PROD");x(ge=>({...ge,sku:L.data.sku})),alert("SKU gerado com sucesso!")}catch(L){console.error("Erro ao gerar SKU:",L),alert("Erro ao gerar SKU")}},V=async()=>{if(!l.sku){alert("Gere ou informe um SKU primeiro!");return}try{const L=await Bc(l.sku);x(ge=>({...ge,codigo_barras:L.data.codigo_barras})),alert("CÃ³digo de barras gerado com sucesso!")}catch(L){console.error("Erro ao gerar cÃƒÂ³digo de barras:",L),alert("Erro ao gerar cÃƒÂ³digo de barras")}},Re=async()=>{var L,ge;if(!ze.quantidade||!ze.preco_custo){alert("Preencha quantidade e preÃƒÂ§o de custo!");return}try{const Me=ze.nome_lote||`LOTE-${Date.now()}`,Ye=ze.data_fabricacao?new Date(ze.data_fabricacao+"T00:00:00").toISOString():null,Ve=ze.data_validade?new Date(ze.data_validade+"T23:59:59").toISOString():null;await Uc(t,{nome_lote:Me,quantidade:parseFloat(ze.quantidade),preco_custo:parseFloat(ze.preco_custo),data_fabricacao:Ye,data_validade:Ve,observacoes:ze.observacoes||null}),alert("Entrada de estoque realizada com sucesso!"),Ue(!1),Y({quantidade:"",nome_lote:"",data_fabricacao:"",data_validade:"",preco_custo:""});const Na=await _r(t);b(Na.data)}catch(Me){console.error("Erro ao registrar entrada:",Me),alert(((ge=(L=Me.response)==null?void 0:L.data)==null?void 0:ge.detail)||"Erro ao registrar entrada de estoque")}},Oe=L=>{var ge,Me;U({id:L.id,nome_lote:L.nome_lote,quantidade_inicial:L.quantidade_inicial,data_fabricacao:((ge=L.data_fabricacao)==null?void 0:ge.split("T")[0])||"",data_validade:((Me=L.data_validade)==null?void 0:Me.split("T")[0])||"",custo_unitario:L.custo_unitario}),Le(!0)},He=async()=>{var L,ge;try{const Me=fe.data_fabricacao?new Date(fe.data_fabricacao+"T00:00:00").toISOString():null,Ye=fe.data_validade?new Date(fe.data_validade+"T23:59:59").toISOString():null,Ve={nome_lote:fe.nome_lote,quantidade_inicial:parseFloat(fe.quantidade_inicial),data_fabricacao:Me,data_validade:Ye,custo_unitario:parseFloat(fe.custo_unitario)};await Wc(t,fe.id,Ve),alert("Lote atualizado com sucesso!"),Le(!1),U(null);const Na=await _r(t);b(Na.data)}catch(Me){console.error("Erro ao atualizar lote:",Me),alert(((ge=(L=Me.response)==null?void 0:L.data)==null?void 0:ge.detail)||"Erro ao atualizar lote")}},ga=async L=>{var ge,Me;if(window.confirm(`Deseja realmente excluir o lote ${L.nome_lote}?

Quantidade: ${L.quantidade_disponivel} unidades
Isso removerÃ¡ o registro de entrada do estoque.`))try{await Hc(t,L.id),alert("Lote excluÃ­do com sucesso!");const Ye=await _r(t);b(Ye.data)}catch(Ye){console.error("Erro ao excluir lote:",Ye),alert(((Me=(ge=Ye.response)==null?void 0:ge.data)==null?void 0:Me.detail)||"Erro ao excluir lote")}},xe=async L=>{var Ve,Na,Xa,Ea;const ge=Array.from(L.target.files);if(ge.length===0)return;const Me=["image/jpeg","image/png","image/webp"],Ye=5*1024*1024;for(const Ba of ge){if(!Me.includes(Ba.type)){alert(`${Ba.name}: Apenas JPG, PNG e WebP sÃ£o permitidos`);return}if(Ba.size>Ye){alert(`${Ba.name}: Imagem deve ter no mÃ¡ximo 5MB`);return}}try{Ne(!0);const Ba=[];for(const is of ge){const br=new FormData;br.append("file",is);try{const ct=await Kc(t,br);Ba.push(ct.data)}catch(ct){console.error(`Erro ao enviar ${is.name}:`,ct),alert(`Erro ao enviar ${is.name}: ${((Na=(Ve=ct.response)==null?void 0:Ve.data)==null?void 0:Na.detail)||"Erro desconhecido"}`)}}const Ps=await F.get(`/produtos/${t}/imagens`);h(Ps.data||[]),alert(`${Ba.length} imagem(ns) enviada(s) com sucesso!`)}catch(Ba){console.error("Erro ao enviar imagens:",Ba),alert(((Ea=(Xa=Ba.response)==null?void 0:Xa.data)==null?void 0:Ea.detail)||"Erro ao enviar imagens")}finally{Ne(!1),L.target.value=""}},De=async L=>{if(confirm("Deseja realmente excluir esta imagem?"))try{await Gc(L);const ge=await F.get(`/produtos/${t}/imagens`);h(ge.data||[]),alert("Imagem excluÃ­da com sucesso!")}catch(ge){console.error("Erro ao excluir imagem:",ge),alert("Erro ao excluir imagem")}},qe=async L=>{try{await F.put(`/produtos/imagens/${L}`,{principal:!0});const ge=await F.get(`/produtos/${t}/imagens`);h(ge.data||[]),alert("Imagem principal atualizada!")}catch(ge){console.error("Erro ao definir imagem principal:",ge),alert("Erro ao definir imagem principal")}},ta=()=>{T(null),pe({fornecedor_id:"",codigo_fornecedor:"",preco_custo:"",prazo_entrega:"",estoque_fornecedor:"",e_principal:!1}),_e(!0)},Va=L=>{T(L),pe({fornecedor_id:L.fornecedor_id,codigo_fornecedor:L.codigo_fornecedor||"",preco_custo:L.preco_custo||"",prazo_entrega:L.prazo_entrega||"",estoque_fornecedor:L.estoque_fornecedor||"",e_principal:L.e_principal||!1}),_e(!0)},ya=async()=>{var L,ge;if(!ne.fornecedor_id){alert("Selecione um fornecedor");return}try{const Me={...ne,preco_custo:ne.preco_custo?parseFloat(ne.preco_custo):null,prazo_entrega:ne.prazo_entrega?parseInt(ne.prazo_entrega):null,estoque_fornecedor:ne.estoque_fornecedor?parseFloat(ne.estoque_fornecedor):null};$e?(await Qc($e.id,Me),alert("Fornecedor atualizado!")):(await Xc(t,Me),alert("Fornecedor vinculado!"));const Ye=await no(t);k(Ye.data),_e(!1)}catch(Me){console.error("Erro ao salvar fornecedor:",Me),alert(((ge=(L=Me.response)==null?void 0:L.data)==null?void 0:ge.detail)||"Erro ao salvar fornecedor")}},Pa=async L=>{if(confirm("Deseja realmente desvincular este fornecedor?"))try{await Jc(L);const ge=await no(t);k(ge.data),alert("Fornecedor desvinculado!")}catch(ge){console.error("Erro ao desvincular fornecedor:",ge),alert("Erro ao desvincular fornecedor")}},wa=async()=>{try{const L=await F.get("/produtos/",{params:{apenas_ativos:!0,tipo_produto:"SIMPLES"}});ae(L.data.items||[])}catch(L){console.error("Erro ao carregar produtos:",L),ae([])}},os=()=>{if(!H||!G||G<=0){alert("Selecione um produto e informe a quantidade!");return}if(l.composicao_kit.find(Ye=>Ye.produto_id===parseInt(H))){alert("Este produto jÃ¡ foi adicionado ao kit!");return}const ge=q.find(Ye=>Ye.id===parseInt(H)),Me={produto_componente_id:ge.id,produto_id:ge.id,produto_nome:ge.nome,produto_sku:ge.codigo,quantidade:parseFloat(G),estoque_componente:ge.estoque_atual||0};x(Ye=>({...Ye,composicao_kit:[...Ye.composicao_kit,Me]})),le(""),ee(""),At([...l.composicao_kit,Me])},lr=L=>{const ge=l.composicao_kit.filter(Me=>Me.produto_id!==L);x(Me=>({...Me,composicao_kit:ge})),At(ge)},At=L=>{if(!L||L.length===0){ue(0);return}const ge=L.map(Ye=>{const Ve=Ye.estoque_componente||0,Na=Ye.quantidade||1;return Math.floor(Ve/Na)}),Me=Math.min(...ge);ue(Me>=0?Me:0)};n.useEffect(()=>{const L=l.tipo_produto==="KIT"||l.tipo_produto==="VARIACAO"&&l.tipo_kit;r===9&&L&&(wa(),l.composicao_kit&&l.composicao_kit.length>0&&At(l.composicao_kit))},[r,l.tipo_produto,l.tipo_kit]);const zs=async L=>{var ge,Me;if(L.preventDefault(),!l.nome){alert("Preencha o campo Nome");return}if(l.tipo_produto!=="PAI"&&!l.preco_venda){alert("Preencha o PreÃ§o de Venda");return}if(!l.codigo&&!l.sku){alert("Preencha o campo SKU/CÃ³digo");return}try{da(!0);const Ye={codigo:l.codigo||l.sku,nome:l.nome,descricao_curta:l.descricao||null,codigo_barras:l.codigo_barras||null,unidade:l.unidade||"UN",preco_custo:l.preco_custo?parseFloat(l.preco_custo):0,preco_venda:parseFloat(l.preco_venda),preco_promocional:l.preco_promocional?parseFloat(l.preco_promocional):null,promocao_inicio:l.data_inicio_promocao||null,promocao_fim:l.data_fim_promocao||null,controle_lote:l.controle_lote||!1,estoque_minimo:l.estoque_minimo?parseInt(l.estoque_minimo):0,estoque_maximo:l.estoque_maximo?parseInt(l.estoque_maximo):null,categoria_id:l.categoria_id?parseInt(l.categoria_id):null,marca_id:l.marca_id?parseInt(l.marca_id):null,departamento_id:l.departamento_id?parseInt(l.departamento_id):null,tipo_produto:l.tipo_produto||"SIMPLES",produto_pai_id:l.produto_pai_id||null,tipo_kit:l.tipo_produto==="KIT"||l.tipo_produto==="VARIACAO"&&l.tipo_kit?l.e_kit_fisico?"FISICO":"VIRTUAL":null,e_kit_fisico:l.tipo_produto==="KIT"||l.tipo_produto==="VARIACAO"&&l.tipo_kit?l.e_kit_fisico:null,composicao_kit:l.tipo_produto==="KIT"||l.tipo_produto==="VARIACAO"&&l.tipo_kit?l.composicao_kit:null,produto_predecessor_id:l.produto_predecessor_id||null,motivo_descontinuacao:l.motivo_descontinuacao||null,tem_recorrencia:l.tem_recorrencia||!1,tipo_recorrencia:l.tem_recorrencia?l.tipo_recorrencia:null,intervalo_dias:l.tem_recorrencia&&l.intervalo_dias?parseInt(l.intervalo_dias):null,numero_doses:l.tem_recorrencia&&l.numero_doses?parseInt(l.numero_doses):null,especie_compativel:l.tem_recorrencia?l.especie_compativel:null,observacoes_recorrencia:l.tem_recorrencia?l.observacoes_recorrencia:null,classificacao_racao:l.classificacao_racao||null,peso_embalagem:l.peso_embalagem?parseFloat(l.peso_embalagem):null,tabela_nutricional:l.tabela_nutricional||null,tabela_consumo:l.tabela_consumo||null,categoria_racao:l.categoria_racao||null,especies_indicadas:l.especies_indicadas||null,linha_racao_id:l.linha_racao_id?parseInt(l.linha_racao_id):null,porte_animal_id:l.porte_animal_id?parseInt(l.porte_animal_id):null,fase_publico_id:l.fase_publico_id?parseInt(l.fase_publico_id):null,tipo_tratamento_id:l.tipo_tratamento_id?parseInt(l.tipo_tratamento_id):null,sabor_proteina_id:l.sabor_proteina_id?parseInt(l.sabor_proteina_id):null,apresentacao_peso_id:l.apresentacao_peso_id?parseInt(l.apresentacao_peso_id):null};if(console.log("Ã°Å¸â€œÂ¤ Enviando dados para API:",Ye),o)await ca({id:t,tipo_produto:l.tipo_produto}),await Oc(t,Ye),alert("Produto atualizado com sucesso!"),a("/produtos");else{const Na=(await An(Ye)).data.id;l.tipo_produto==="PAI"?(alert("Produto PAI criado com sucesso! Agora cadastre as variaÃ§Ãµes."),a(`/produtos/${Na}/editar?aba=variacoes`)):(alert("Produto cadastrado com sucesso!"),a("/produtos"))}}catch(Ye){console.error("Erro ao salvar produto:",Ye),alert(((Me=(ge=Ye.response)==null?void 0:ge.data)==null?void 0:Me.detail)||"Erro ao salvar produto")}finally{da(!1)}};return ma?e.jsx("div",{className:"p-6 flex justify-center items-center h-96",children:e.jsx("div",{className:"text-gray-600",children:"Carregando produto..."})}):o&&!l.nome?e.jsx("div",{className:"p-6 flex justify-center items-center h-96",children:e.jsx("div",{className:"text-gray-600",children:"Carregando dados..."})}):e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>{l.tipo_produto==="VARIACAO"&&l.produto_pai_id?a(`/produtos/${l.produto_pai_id}/editar?aba=8`):a("/produtos")},className:"text-blue-600 hover:text-blue-800 mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Voltar"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:o?"Editar Produto":"Novo Produto"}),o&&l.codigo&&e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"SKU:"}),e.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-800 rounded-lg font-mono",children:l.codigo})]}),l.nome&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"DescriÃ§Ã£o:"}),e.jsx("span",{className:"text-gray-600",children:l.nome})]})]})]}),e.jsxs("a",{href:"/cadastros/categorias",target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 border border-blue-200 flex items-center gap-2 text-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Gerenciar Categorias"]})]})}),e.jsx("div",{className:"mb-6 border-b border-gray-200",children:e.jsx("nav",{className:"flex gap-8",children:[{id:1,label:"CaracterÃ­sticas"},{id:2,label:"Imagens"},{id:3,label:"Estoque/Lotes"},{id:4,label:"Fornecedores"},{id:5,label:"TributaÃ§Ã£o"},{id:6,label:"ðŸ”„ RecorrÃªncia"},{id:7,label:"ðŸ¥« RaÃ§Ã£o"},...l.tipo_produto==="PAI"?[{id:8,label:"ðŸ“¦ VariaÃ§Ãµes"}]:[],...l.tipo_produto==="KIT"||l.tipo_produto==="VARIACAO"&&l.tipo_kit?[{id:9,label:"ðŸ§© ComposiÃ§Ã£o"}]:[]].map(L=>e.jsx("button",{onClick:()=>i(L.id),className:`pb-4 px-1 border-b-2 font-medium text-sm transition-colors ${r===L.id?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:L.label},L.id))})}),o&&Fe&&e.jsx("div",{className:"mb-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 p-5 rounded-lg shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"w-7 h-7 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ðŸ”— Este produto Ã© continuaÃ§Ã£o de outro"})}),e.jsxs("p",{className:"text-sm text-gray-700 mb-3",children:["Este produto substitui:"," ",e.jsxs("button",{type:"button",onClick:()=>a(`/produtos/${Fe.id}/editar`),className:"font-bold text-blue-700 hover:text-blue-900 hover:underline",children:[Fe.codigo," - ",Fe.nome]})]}),Fe.motivo_descontinuacao&&e.jsxs("div",{className:"bg-white/70 rounded-md px-3 py-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Motivo da substituiÃ§Ã£o:"})," ",e.jsx("span",{className:"text-gray-900",children:Fe.motivo_descontinuacao})]})]})]})}),o&&Qe&&e.jsx("div",{className:"mb-6 bg-gradient-to-r from-red-50 to-orange-50 border-l-4 border-red-500 p-5 rounded-lg shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"w-7 h-7 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"âš ï¸ Este produto foi descontinuado"})}),e.jsxs("p",{className:"text-sm text-gray-700 mb-3",children:["Descontinuado em"," ",e.jsx("span",{className:"font-semibold",children:new Date(Qe.data_descontinuacao).toLocaleDateString("pt-BR")})]}),e.jsxs("p",{className:"text-sm text-gray-700 mb-3",children:["SubstituÃ­do por:"," ",e.jsxs("button",{type:"button",onClick:()=>a(`/produtos/${Qe.id}/editar`),className:"font-bold text-red-700 hover:text-red-900 hover:underline",children:[Qe.codigo," - ",Qe.nome]})]}),Qe.motivo_descontinuacao&&e.jsxs("div",{className:"bg-white/70 rounded-md px-3 py-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Motivo:"})," ",e.jsx("span",{className:"text-gray-900",children:Qe.motivo_descontinuacao})]})]})]})}),e.jsxs("form",{onSubmit:zs,children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[r===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:l.sku,onChange:L=>We("sku",L.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: PROD0001"}),e.jsx("button",{type:"button",onClick:Sa,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm",children:"Gerar"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CÃ³digo de Barras"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:l.codigo_barras,onChange:L=>We("codigo_barras",L.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"EAN-13"}),e.jsx("button",{type:"button",onClick:V,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm",children:"Gerar"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Produto *"}),e.jsx("input",{type:"text",value:l.nome,onChange:L=>We("nome",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: RaÃ§Ã£o Golden para CÃ£es Adultos 15kg",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria"}),e.jsxs("select",{value:l.categoria_id,onChange:L=>We("categoria_id",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),v.map(L=>e.jsx("option",{value:L.id,children:L.nomeFormatado},L.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Marca"}),e.jsxs("select",{value:l.marca_id,onChange:L=>We("marca_id",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),m.map(L=>e.jsx("option",{value:L.id,children:L.nome},L.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Departamento"}),e.jsxs("select",{value:l.departamento_id,onChange:L=>We("departamento_id",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),y.map(L=>e.jsx("option",{value:L.id,children:L.nome},L.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:l.tipo,onChange:L=>We("tipo",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"produto",children:"Produto"}),e.jsx("option",{value:"servico",children:"ServiÃ§o"}),e.jsx("option",{value:"ambos",children:"Produto e ServiÃ§o"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unidade"}),e.jsxs("select",{value:l.unidade,onChange:L=>We("unidade",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"UN",children:"UN - Unidade"}),e.jsx("option",{value:"KG",children:"KG - Quilograma"}),e.jsx("option",{value:"G",children:"G - Grama"}),e.jsx("option",{value:"L",children:"L - Litro"}),e.jsx("option",{value:"ML",children:"ML - Mililitro"}),e.jsx("option",{value:"M",children:"M - Metro"}),e.jsx("option",{value:"CX",children:"CX - Caixa"}),e.jsx("option",{value:"PCT",children:"PCT - Pacote"})]})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:l.descricao,onChange:L=>We("descricao",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"2",placeholder:"DescriÃ§Ã£o detalhada do produto..."})]})]}),l.tipo_produto!=="PAI"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PreÃ§o de Custo"}),e.jsx("input",{type:"text",value:I.preco_custo?l.preco_custo||"":l.preco_custo?`R$ ${cs(l.preco_custo).toFixed(2).replace(".",",")}`:"R$ 0,00",onChange:L=>{const ge=L.target.value.replace(/[^\d.,]/g,"").replace(",",".");We("preco_custo",ge)},onFocus:L=>{Q(ge=>({...ge,preco_custo:!0})),L.target.select()},onBlur:L=>{Q(Me=>({...Me,preco_custo:!1}));const ge=cs(L.target.value);We("preco_custo",ge>0?ge.toFixed(2):"")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"R$ 0,00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Markup"}),e.jsx("input",{type:"text",value:I.markup?l.markup||"":l.markup?`${cs(l.markup).toFixed(2).replace(".",",")}%`:"0,00%",onChange:L=>{const ge=L.target.value.replace(/[^\d.,]/g,"").replace(",",".");We("markup",ge)},onFocus:L=>{Q(ge=>({...ge,markup:!0})),L.target.select()},onBlur:L=>{Q(Me=>({...Me,markup:!1}));const ge=cs(L.target.value);We("markup",ge>=0?ge.toFixed(2):"")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0,00%"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PreÃ§o de Venda *"}),e.jsx("input",{type:"text",value:I.preco_venda?l.preco_venda||"":l.preco_venda?`R$ ${cs(l.preco_venda).toFixed(2).replace(".",",")}`:"R$ 0,00",onChange:L=>{const ge=L.target.value.replace(/[^\d.,]/g,"").replace(",",".");We("preco_venda",ge)},onFocus:L=>{Q(ge=>({...ge,preco_venda:!0})),L.target.select()},onBlur:L=>{Q(Me=>({...Me,preco_venda:!1}));const ge=cs(L.target.value);We("preco_venda",ge>0?ge.toFixed(2):"")},required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"R$ 0,00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PreÃ§o Promocional"}),e.jsx("input",{type:"text",value:I.preco_promocional?l.preco_promocional||"":l.preco_promocional?`R$ ${cs(l.preco_promocional).toFixed(2).replace(".",",")}`:"R$ 0,00",onChange:L=>{const ge=L.target.value.replace(/[^\d.,]/g,"").replace(",",".");We("preco_promocional",ge)},onFocus:L=>{Q(ge=>({...ge,preco_promocional:!0})),L.target.select()},onBlur:L=>{Q(Me=>({...Me,preco_promocional:!1}));const ge=cs(L.target.value);We("preco_promocional",ge>0?ge.toFixed(2):"")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"R$ 0,00"})]})]}),l.preco_promocional&&l.tipo_produto!=="PAI"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"InÃ­cio da PromoÃ§Ã£o"}),e.jsx("input",{type:"date",value:l.data_inicio_promocao,onChange:L=>We("data_inicio_promocao",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fim da PromoÃ§Ã£o"}),e.jsx("input",{type:"date",value:l.data_fim_promocao,onChange:L=>We("data_fim_promocao",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),!o&&e.jsx("div",{className:"border-t pt-6 mt-6",children:e.jsxs("div",{className:"p-6 bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg border border-amber-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"EvoluÃ§Ã£o do Produto"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Ae,onChange:L=>{se(L.target.checked),L.target.checked||(be(null),We("produto_predecessor_id",null),We("motivo_descontinuacao",""))},className:"h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Este produto substitui outro"})]})]}),Ae&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-white rounded-lg border-2 border-amber-300",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ðŸ” Buscar Produto Anterior"}),e.jsx("input",{type:"text",placeholder:"Digite o nome ou cÃ³digo do produto...",value:ea,onChange:async L=>{if(Ie(L.target.value),L.target.value.length>=2)try{const ge=await F.get("/produtos/",{params:{busca:L.target.value,page_size:10}});Se(ge.data.items||[])}catch(ge){console.error("Erro ao buscar produtos:",ge)}else Se([])},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),we.length>0&&e.jsx("div",{className:"mt-2 max-h-48 overflow-y-auto border border-gray-300 rounded-lg",children:we.map(L=>{var ge;return e.jsxs("div",{onClick:()=>{be(L),We("produto_predecessor_id",L.id),Ie(""),Se([])},className:"p-3 hover:bg-amber-50 cursor-pointer border-b border-gray-200 last:border-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:L.nome}),e.jsxs("div",{className:"text-sm text-gray-600",children:["SKU: ",L.codigo," | PreÃ§o: R$ ",(ge=L.preco_venda)==null?void 0:ge.toFixed(2)]})]},L.id)})}),Je&&e.jsx("div",{className:"mt-3 p-3 bg-green-50 border border-green-300 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-green-800",children:"âœ… Produto Selecionado:"}),e.jsx("div",{className:"font-semibold text-gray-900 mt-1",children:Je.nome}),e.jsxs("div",{className:"text-sm text-gray-600",children:["SKU: ",Je.codigo]})]}),e.jsx("button",{type:"button",onClick:()=>{be(null),We("produto_predecessor_id",null)},className:"text-red-600 hover:text-red-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]}),Je&&e.jsxs("div",{className:"p-4 bg-white rounded-lg border-2 border-amber-300",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ðŸ“ Motivo da SubstituiÃ§Ã£o"}),e.jsxs("select",{value:l.motivo_descontinuacao,onChange:L=>We("motivo_descontinuacao",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent mb-2",children:[e.jsx("option",{value:"",children:"Selecione o motivo..."}),e.jsx("option",{value:"MudanÃ§a de embalagem",children:"MudanÃ§a de embalagem"}),e.jsx("option",{value:"MudanÃ§a de peso/gramatura",children:"MudanÃ§a de peso/gramatura"}),e.jsx("option",{value:"ReformulaÃ§Ã£o do produto",children:"ReformulaÃ§Ã£o do produto"}),e.jsx("option",{value:"MudanÃ§a de fornecedor",children:"MudanÃ§a de fornecedor"}),e.jsx("option",{value:"Upgrade de linha",children:"Upgrade de linha"}),e.jsx("option",{value:"Outro",children:"Outro (descrever abaixo)"})]}),l.motivo_descontinuacao==="Outro"&&e.jsx("textarea",{value:l.motivo_descontinuacao,onChange:L=>We("motivo_descontinuacao",L.target.value),placeholder:"Descreva o motivo...",rows:"2",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800",children:[e.jsx("strong",{children:"â„¹ï¸ O que acontecerÃ¡:"}),e.jsxs("ul",{className:"mt-2 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:['O produto "',e.jsx("strong",{children:Je.nome}),'" serÃ¡ marcado como ',e.jsx("strong",{children:"descontinuado"})]}),e.jsx("li",{children:"Todo o histÃ³rico de vendas serÃ¡ mantido e poderÃ¡ ser consultado"}),e.jsx("li",{children:"VocÃª poderÃ¡ gerar relatÃ³rios consolidados somando ambos os produtos"})]})]})]})]}),!Ae&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Marque esta opÃ§Ã£o se este produto substitui outro jÃ¡ cadastrado (ex: mudanÃ§a de embalagem de 350g para 300g). Isso permite manter o histÃ³rico consolidado de vendas."})]})}),!o&&e.jsx("div",{className:"border-t pt-6",children:e.jsxs("div",{className:"p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),"Tipo do Produto"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Escolha o tipo de produto que estÃ¡ cadastrando:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-white rounded-lg border-2 hover:border-blue-400 transition-colors",style:{borderColor:l.tipo_produto==="SIMPLES"?"#3b82f6":"#e5e7eb"},children:[e.jsx("input",{type:"radio",id:"tipo_simples",name:"tipo_produto",value:"SIMPLES",checked:l.tipo_produto==="SIMPLES",onChange:L=>{We("tipo_produto","SIMPLES"),x(ge=>({...ge,composicao_kit:[],e_kit_fisico:!1}))},className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"tipo_simples",className:"font-medium text-gray-900 cursor-pointer",children:"âœ… Produto Simples"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Produto Ãºnico, vendÃ¡vel, com controle de estoque prÃ³prio."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-white rounded-lg border-2 hover:border-blue-400 transition-colors",style:{borderColor:l.tipo_produto==="PAI"?"#3b82f6":"#e5e7eb"},children:[e.jsx("input",{type:"radio",id:"tipo_variacoes",name:"tipo_produto",value:"PAI",checked:l.tipo_produto==="PAI",onChange:L=>{We("tipo_produto","PAI"),x(ge=>({...ge,preco_custo:"",preco_venda:"",preco_promocional:"",composicao_kit:[],e_kit_fisico:!1}))},className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"tipo_variacoes",className:"font-medium text-gray-900 cursor-pointer",children:"ðŸ“¦ Produto com VariaÃ§Ãµes"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Produto agrupador (nÃ£o vendÃ¡vel). TerÃ¡ variaÃ§Ãµes com SKU, preÃ§o e estoque prÃ³prios.",e.jsx("br",{}),e.jsx("span",{className:"text-xs italic",children:"Exemplo: Camiseta (produto pai) â†’ P, M, G (variaÃ§Ãµes)"})]}),l.tipo_produto==="PAI"&&!o&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:["âš ï¸ ",e.jsx("strong",{children:"Salve o produto primeiro"}),' para depois cadastrar as variaÃ§Ãµes na aba "VariaÃ§Ãµes".']}),l.tipo_produto==="PAI"&&o&&e.jsx("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded text-sm text-green-800",children:'âœ… Produto salvo! VÃ¡ para a aba "ðŸ“¦ VariaÃ§Ãµes" para cadastrar as variaÃ§Ãµes.'})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-white rounded-lg border-2 hover:border-blue-400 transition-colors",style:{borderColor:l.tipo_produto==="KIT"?"#3b82f6":"#e5e7eb"},children:[e.jsx("input",{type:"radio",id:"tipo_kit",name:"tipo_produto",value:"KIT",checked:l.tipo_produto==="KIT",onChange:L=>{We("tipo_produto","KIT"),i(9)},className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"tipo_kit",className:"font-medium text-gray-900 cursor-pointer",children:"ðŸ§© Produto com ComposiÃ§Ã£o (Kit)"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Kit composto por outros produtos existentes.",e.jsx("br",{}),e.jsx("span",{className:"text-xs italic",children:"Exemplo: Kit Banho (shampoo + condicionador + toalha)"})]}),l.tipo_produto==="KIT"&&e.jsxs("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded text-sm text-green-800",children:["âœ… ",e.jsx("strong",{children:'Aba "ðŸ§© ComposiÃ§Ã£o" aberta!'})," VÃ¡ para a aba ComposiÃ§Ã£o para definir se o kit terÃ¡ estoque virtual ou fÃ­sico e adicionar os produtos que o compÃµem."]})]})]})]})]})}),o&&l.tipo_produto==="VARIACAO"&&e.jsx("div",{className:"border-t pt-6",children:e.jsxs("div",{className:"p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),"ComposiÃ§Ã£o (Kit)"]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-white rounded-lg border-2 border-gray-300",children:[e.jsx("input",{type:"checkbox",id:"variacao_e_kit",checked:!!l.tipo_kit,onChange:L=>{L.target.checked?(We("tipo_kit","VIRTUAL"),We("e_kit_fisico",!1),i(9)):(We("tipo_kit",null),We("composicao_kit",[]),We("e_kit_fisico",!1))},className:"mt-1 h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"variacao_e_kit",className:"font-medium text-gray-900 cursor-pointer text-lg",children:"ðŸ§© Esta variaÃ§Ã£o Ã© um KIT (possui composiÃ§Ã£o)"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Marque esta opÃ§Ã£o se esta variaÃ§Ã£o Ã© composta por outros produtos.",e.jsx("br",{}),e.jsx("span",{className:"text-xs italic",children:"Exemplo: Camiseta P - Kit (camiseta + brinde)"})]}),l.tipo_kit&&e.jsxs("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded text-sm text-green-800",children:["âœ… ",e.jsx("strong",{children:"VariaÃ§Ã£o configurada como KIT!"}),' VÃ¡ para a aba "ðŸ§© ComposiÃ§Ã£o" para definir os produtos que compÃµem este kit.']})]})]})]})})]}),r===2&&e.jsx("div",{className:"space-y-6",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Imagens do Produto"}),e.jsxs("label",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer",children:[oe?"Enviando...":"+ Adicionar Imagens",e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/webp",onChange:xe,disabled:oe,className:"hidden",multiple:!0})]})]}),u.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"ðŸ“· Nenhuma imagem cadastrada"}),e.jsx("p",{className:"text-sm",children:'Clique em "Adicionar Imagem" para enviar fotos do produto'})]}):e.jsx("div",{className:"grid grid-cols-4 gap-4",children:u.map(L=>e.jsxs("div",{className:"relative group border rounded-lg overflow-hidden",children:[e.jsx("img",{src:`/api${L.url}`,alt:"Imagem do produto",className:"w-full h-48 object-cover"}),L.e_principal&&e.jsx("div",{className:"absolute top-2 left-2 px-2 py-1 bg-blue-600 text-white text-xs rounded",children:"Principal"}),e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100",children:[!L.e_principal&&e.jsx("button",{type:"button",onClick:()=>qe(L.id),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",title:"Definir como principal",children:"â­ Principal"}),e.jsx("button",{type:"button",onClick:()=>De(L.id),className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700",title:"Excluir",children:"ðŸ—‘ï¸ Excluir"})]})]},L.id))}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Dica:"}),' A primeira imagem marcada como "Principal" serÃ¡ exibida na listagem de produtos. Formatos aceitos: JPG, PNG, WebP (mÃ¡x. 5MB).']})})]}):e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Salve o produto primeiro para adicionar imagens"})]})}),r===3&&e.jsx("div",{className:"space-y-6",children:l.tipo_produto==="PAI"?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-blue-300 rounded-lg bg-blue-50",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),e.jsx("p",{className:"mt-4 text-lg font-medium text-blue-900",children:"Produto com VariaÃ§Ãµes"}),e.jsxs("p",{className:"mt-2 text-sm text-blue-700",children:["Produtos PAI nÃ£o possuem estoque prÃ³prio.",e.jsx("br",{}),"O controle de estoque Ã© feito individualmente nas variaÃ§Ãµes."]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.controle_lote,onChange:L=>We("controle_lote",L.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Controlar Estoque"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estoque MÃ­nimo"}),e.jsx("input",{type:"number",step:"0.01",value:l.estoque_minimo,onChange:L=>We("estoque_minimo",L.target.value),disabled:!l.controle_lote,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estoque MÃ¡ximo"}),e.jsx("input",{type:"number",step:"0.01",value:l.estoque_maximo,onChange:L=>We("estoque_maximo",L.target.value),disabled:!l.controle_lote,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100",placeholder:"0"})]})]}),o&&l.controle_lote&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Lotes (FIFO)"}),e.jsx("button",{type:"button",onClick:()=>Ue(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"+ Nova Entrada"})]}),f.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Nenhum lote cadastrado"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Lote"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Qtd DisponÃ­vel"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"FabricaÃ§Ã£o"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Validade"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Custo Unit."}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map(L=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:L.nome_lote||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-gray-900",children:L.quantidade_disponivel}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:wo(L.data_fabricacao)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:wo(L.data_validade)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:Js(L.custo_unitario)}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>Oe(L),className:"text-blue-600 hover:text-blue-800",title:"Editar lote",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{type:"button",onClick:()=>ga(L),className:"text-red-600 hover:text-red-800",title:"Excluir lote",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},L.id))})]})})]}),!o&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Salve o produto primeiro para gerenciar lotes"})]})}),r===4&&e.jsx("div",{className:"space-y-6",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Fornecedores do Produto"}),e.jsx("button",{type:"button",onClick:ta,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"+ Adicionar Fornecedor"})]}),p.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"ðŸ­ Nenhum fornecedor vinculado"}),e.jsx("p",{className:"text-sm",children:'Clique em "Adicionar Fornecedor" para vincular fornecedores a este produto'})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fornecedor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"CÃ³digo"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"PreÃ§o Custo"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Prazo (dias)"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Principal"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.map(L=>e.jsxs("tr",{className:L.ativo?"":"opacity-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:L.fornecedor_nome}),e.jsx("p",{className:"text-xs text-gray-500",children:L.fornecedor_cpf_cnpj})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:L.codigo_fornecedor||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right",children:L.preco_custo?Js(L.preco_custo):"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-center",children:L.prazo_entrega||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-center",children:L.estoque_fornecedor||"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:L.e_principal&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:"Principal"})}),e.jsxs("td",{className:"px-4 py-3 text-right space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>Va(L),className:"text-blue-600 hover:text-blue-800 text-sm",children:"Editar"}),e.jsx("button",{type:"button",onClick:()=>Pa(L.id),className:"text-red-600 hover:text-red-800 text-sm",children:"Excluir"})]})]},L.id))})]})})]}):e.jsx("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg",children:e.jsx("p",{className:"text-gray-600",children:"Salve o produto primeiro para vincular fornecedores"})})}),r===5&&e.jsxs("div",{className:"space-y-6",children:[o&&l.tributacao&&e.jsxs("div",{className:"mb-4 flex gap-2",children:[l.tributacao.origem==="produto_legado"&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-200 text-gray-800",children:"âšª Legado"}),(l.tributacao.origem==="produto_fiscal_v2"||l.tributacao.origem==="kit_fiscal_v2")&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-yellow-200 text-yellow-800",children:"ðŸŸ¡ Personalizado"}),l.tributacao.herdado_da_empresa&&e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-200 text-blue-800",children:"ðŸ”µ Herdado da empresa"})]}),o&&((Dt=l.tributacao)==null?void 0:Dt.herdado_da_empresa)===!0&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Esta configuraÃ§Ã£o fiscal estÃ¡ sendo herdada da empresa. Para editar, personalize o fiscal deste produto."}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{type:"button",className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500",onClick:()=>x(L=>({...L,tributacao:{...L.tributacao,herdado_da_empresa:!1}})),children:"âœï¸ Personalizar fiscal deste produto"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Origem",e.jsx("span",{className:"tooltip-icon",title:"Define se o produto Ã© nacional ou importado. Impacta o cÃ¡lculo do ICMS.",children:"ðŸ›ˆ"})]}),e.jsxs("select",{value:((ir=l.tributacao)==null?void 0:ir.origem_mercadoria)||"0",onChange:L=>x(ge=>({...ge,tributacao:{...ge.tributacao,origem_mercadoria:L.target.value}})),disabled:((it=l.tributacao)==null?void 0:it.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"0",children:"0 - Nacional"}),e.jsx("option",{value:"1",children:"1 - Estrangeira (ImportaÃ§Ã£o direta)"}),e.jsx("option",{value:"2",children:"2 - Estrangeira (Adquirida no mercado interno)"}),e.jsx("option",{value:"3",children:"3 - Nacional (> 40% conteÃºdo importado)"}),e.jsx("option",{value:"4",children:"4 - Nacional (Conforme processo produtivo bÃ¡sico)"}),e.jsx("option",{value:"5",children:"5 - Nacional (< 40% conteÃºdo importado)"}),e.jsx("option",{value:"6",children:"6 - Estrangeira (ImportaÃ§Ã£o direta sem similar)"}),e.jsx("option",{value:"7",children:"7 - Estrangeira (Mercado interno sem similar)"}),e.jsx("option",{value:"8",children:"8 - Nacional (> 70% conteÃºdo importado)"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["NCM",e.jsx("span",{className:"tooltip-icon",title:"Nomenclatura Comum do Mercosul. ClassificaÃ§Ã£o fiscal do produto, base para impostos.",children:"ðŸ›ˆ"})]}),e.jsx("input",{type:"text",value:((dr=l.tributacao)==null?void 0:dr.ncm)||"",onChange:L=>x(ge=>({...ge,tributacao:{...ge.tributacao,ncm:L.target.value}})),disabled:((cr=l.tributacao)==null?void 0:cr.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"00000000"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["CEST",e.jsx("span",{className:"tooltip-icon",title:"CÃ³digo Especificador da SubstituiÃ§Ã£o TributÃ¡ria. Para produtos sujeitos a ICMS ST.",children:"ðŸ›ˆ"})]}),e.jsx("input",{type:"text",value:((dt=l.tributacao)==null?void 0:dt.cest)||"",onChange:L=>x(ge=>({...ge,tributacao:{...ge.tributacao,cest:L.target.value}})),disabled:((xr=l.tributacao)==null?void 0:xr.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0000000"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["CFOP",e.jsx("span",{className:"tooltip-icon",title:"CÃ³digo Fiscal de OperaÃ§Ãµes e PrestaÃ§Ãµes. Define a natureza da operaÃ§Ã£o de venda.",children:"ðŸ›ˆ"})]}),e.jsx("input",{type:"text",value:((mr=l.tributacao)==null?void 0:mr.cfop)||"",onChange:L=>x(ge=>({...ge,tributacao:{...ge.tributacao,cfop:L.target.value}})),disabled:((ur=l.tributacao)==null?void 0:ur.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0000"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["AlÃ­quota ICMS (%)",e.jsx("span",{className:"tooltip-icon",title:"Imposto sobre CirculaÃ§Ã£o de Mercadorias. AlÃ­quota estadual aplicada na venda. Impacta o preÃ§o final.",children:"ðŸ›ˆ"})]}),e.jsx("input",{type:"number",step:"0.01",value:((pr=l.tributacao)==null?void 0:pr.icms_aliquota)||"",onChange:L=>x(ge=>({...ge,tributacao:{...ge.tributacao,icms_aliquota:L.target.value}})),disabled:((gr=l.tributacao)==null?void 0:gr.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0,00"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["AlÃ­quota PIS (%)",e.jsx("span",{className:"tooltip-icon",title:"Programa de IntegraÃ§Ã£o Social. ContribuiÃ§Ã£o federal sobre a venda. Geralmente 1,65%.",children:"ðŸ›ˆ"})]}),e.jsx("input",{type:"number",step:"0.01",value:((hr=l.tributacao)==null?void 0:hr.pis_aliquota)||"",onChange:L=>x(ge=>({...ge,tributacao:{...ge.tributacao,pis_aliquota:L.target.value}})),disabled:((Fs=l.tributacao)==null?void 0:Fs.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0,00"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["AlÃ­quota COFINS (%)",e.jsx("span",{className:"tooltip-icon",title:"ContribuiÃ§Ã£o para Financiamento da Seguridade Social. ContribuiÃ§Ã£o federal sobre a venda. Geralmente 7,6%.",children:"ðŸ›ˆ"})]}),e.jsx("input",{type:"number",step:"0.01",value:((Os=l.tributacao)==null?void 0:Os.cofins_aliquota)||"",onChange:L=>x(ge=>({...ge,tributacao:{...ge.tributacao,cofins_aliquota:L.target.value}})),disabled:((Mt=l.tributacao)==null?void 0:Mt.herdado_da_empresa)===!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0,00"})]})]})]}),r===6&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-purple-50 border-l-4 border-purple-500 p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-purple-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-purple-800",children:"Sistema de RecorrÃªncia (Fase 1)"}),e.jsxs("div",{className:"mt-2 text-sm text-purple-700",children:[e.jsx("p",{children:"Configure produtos que precisam ser recomprados periodicamente (vacinas, antipulgas, raÃ§Ãµes)."}),e.jsx("p",{className:"mt-1",children:"O sistema criarÃ¡ lembretes automÃ¡ticos para notificar clientes 7 dias antes."})]})]})]})}),e.jsxs("div",{className:"flex items-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"tem_recorrencia",checked:l.tem_recorrencia,onChange:L=>We("tem_recorrencia",L.target.checked),className:"h-5 w-5 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"}),e.jsxs("label",{htmlFor:"tem_recorrencia",className:"ml-3",children:[e.jsx("span",{className:"text-base font-medium text-gray-900",children:"Produto com RecorrÃªncia"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Ativar lembretes automÃ¡ticos para este produto"})]})]}),l.tem_recorrencia&&e.jsxs("div",{className:"space-y-4 border-t pt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de RecorrÃªncia *"}),e.jsxs("select",{value:l.tipo_recorrencia,onChange:L=>{We("tipo_recorrencia",L.target.value),L.target.value==="daily"?We("intervalo_dias","1"):L.target.value==="weekly"?We("intervalo_dias","7"):L.target.value==="monthly"?We("intervalo_dias","30"):L.target.value==="yearly"&&We("intervalo_dias","365")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"daily",children:"DiÃ¡ria"}),e.jsx("option",{value:"weekly",children:"Semanal (7 dias)"}),e.jsx("option",{value:"monthly",children:"Mensal (30 dias)"}),e.jsx("option",{value:"yearly",children:"Anual (365 dias)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Intervalo (em dias) *"}),e.jsx("input",{type:"number",min:"1",value:l.intervalo_dias,onChange:L=>We("intervalo_dias",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Ex: 30 (para Nexgard)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Exemplos: Nexgard = 30, Vacina Anual = 365"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NÃºmero de Doses (opcional)"}),e.jsx("input",{type:"number",min:"1",value:l.numero_doses,onChange:L=>We("numero_doses",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Ex: 3 (para vacina com 3 doses)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ðŸ’‰ Se vazio, serÃ¡ recorrente indefinidamente. Se preenchido (ex: 3), o sistema finalizarÃ¡ apÃ³s a Ãºltima dose."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Compatibilidade por EspÃ©cie"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especie_compativel",value:"both",checked:l.especie_compativel==="both",onChange:L=>We("especie_compativel",L.target.value),className:"h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"ðŸ¶ðŸ± CÃ£es e Gatos"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especie_compativel",value:"dog",checked:l.especie_compativel==="dog",onChange:L=>We("especie_compativel",L.target.value),className:"h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"ðŸ¶ Apenas CÃ£es"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especie_compativel",value:"cat",checked:l.especie_compativel==="cat",onChange:L=>We("especie_compativel",L.target.value),className:"h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"ðŸ± Apenas Gatos"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ObservaÃ§Ãµes / InstruÃ§Ãµes"}),e.jsx("textarea",{value:l.observacoes_recorrencia,onChange:L=>We("observacoes_recorrencia",L.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Ex: Aplicar mensalmente no mesmo dia. NÃ£o atrasar mais de 5 dias."})]}),l.intervalo_dias&&e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-purple-900 mb-2",children:"ðŸ“Œ Preview do Lembrete"}),e.jsxs("div",{className:"text-sm text-purple-700 space-y-1",children:[e.jsxs("p",{children:["âœ“ Cliente serÃ¡ notificado ",e.jsx("strong",{children:"7 dias antes"})," da prÃ³xima dose"]}),e.jsxs("p",{children:["âœ“ Intervalo configurado: ",e.jsxs("strong",{children:[l.intervalo_dias," dias"]})]}),e.jsx("p",{children:"âœ“ ApÃ³s a compra, um novo lembrete serÃ¡ criado automaticamente"}),l.especie_compativel!=="both"&&e.jsx("p",{className:"mt-2 text-purple-800",children:"âš ï¸ Sistema validarÃ¡ se o pet Ã© compatÃ­vel na hora da venda"})]})]})]})]}),r===7&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-orange-50 border-l-4 border-orange-500 p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-orange-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-orange-800",children:"Calculadora de RaÃ§Ã£o (Fase 2)"}),e.jsxs("div",{className:"mt-2 text-sm text-orange-700",children:[e.jsx("p",{children:"Configure informaÃ§Ãµes de raÃ§Ã£o para usar na calculadora de duraÃ§Ã£o e custo."}),e.jsx("p",{className:"mt-1",children:"A IA usarÃ¡ esses dados para recomendar raÃ§Ãµes aos clientes."})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ã‰ raÃ§Ã£o?"}),e.jsxs("select",{value:l.classificacao_racao||"nao",onChange:L=>{const ge=L.target.value;x(Me=>({...Me,classificacao_racao:ge,linha_racao_id:ge==="sim"?Me.linha_racao_id:"",porte_animal_id:ge==="sim"?Me.porte_animal_id:"",fase_publico_id:ge==="sim"?Me.fase_publico_id:"",tipo_tratamento_id:ge==="sim"?Me.tipo_tratamento_id:"",sabor_proteina_id:ge==="sim"?Me.sabor_proteina_id:"",apresentacao_peso_id:ge==="sim"?Me.apresentacao_peso_id:"",peso_embalagem:ge==="sim"?Me.peso_embalagem:"",categoria_racao:ge==="sim"?Me.categoria_racao:""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:"nao",children:"NÃ£o"}),e.jsx("option",{value:"sim",children:"Sim"})]})]})}),l.classificacao_racao==="sim"&&e.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-4",children:"ðŸ“‹ InformaÃ§Ãµes Detalhadas da RaÃ§Ã£o"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Linha"}),e.jsxs("select",{value:l.linha_racao_id,onChange:L=>We("linha_racao_id",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),S.map(L=>e.jsx("option",{value:L.id,children:L.nome},L.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Porte do Animal"}),e.jsxs("select",{value:l.porte_animal_id,onChange:L=>We("porte_animal_id",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),W.map(L=>e.jsx("option",{value:L.id,children:L.nome},L.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fase/PÃºblico"}),e.jsxs("select",{value:l.fase_publico_id,onChange:L=>{const ge=L.target.value,Me=D.find(Ye=>String(Ye.id)===String(ge));x(Ye=>({...Ye,fase_publico_id:ge,categoria_racao:Me?Me.nome:""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),D.map(L=>e.jsx("option",{value:L.id,children:L.nome},L.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Tratamento ",e.jsx("span",{className:"text-gray-400",children:"(Opcional)"})]}),e.jsxs("select",{value:l.tipo_tratamento_id,onChange:L=>We("tipo_tratamento_id",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Nenhum"}),X.map(L=>e.jsx("option",{value:L.id,children:L.nome},L.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sabor/ProteÃ­na"}),e.jsxs("select",{value:l.sabor_proteina_id,onChange:L=>We("sabor_proteina_id",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),M.map(L=>e.jsx("option",{value:L.id,children:L.nome},L.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ApresentaÃ§Ã£o (Peso)"}),e.jsxs("select",{value:l.apresentacao_peso_id,onChange:L=>{const ge=L.target.value,Me=$.find(Ye=>String(Ye.id)===String(ge));x(Ye=>({...Ye,apresentacao_peso_id:ge,peso_embalagem:Me?String(Me.peso_kg):Ye.peso_embalagem}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),$.map(L=>e.jsxs("option",{value:L.id,children:[L.peso_kg,"kg"]},L.id))]})]})]}),e.jsxs("p",{className:"text-xs text-blue-600 mt-3",children:["ðŸ’¡ ",e.jsx("strong",{children:"Dica:"})," Essas informaÃ§Ãµes ajudam a IA a recomendar a raÃ§Ã£o ideal para cada pet no PDV. VocÃª pode gerenciar as opÃ§Ãµes disponÃ­veis em ",e.jsx("strong",{children:"Cadastros > OpÃ§Ãµes de RaÃ§Ã£o"}),"."]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"EspÃ©cies Indicadas"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especies_indicadas",value:"both",checked:l.especies_indicadas==="both",onChange:L=>We("especies_indicadas",L.target.value),className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"ðŸ¶ðŸ± Ambos"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especies_indicadas",value:"dog",checked:l.especies_indicadas==="dog",onChange:L=>We("especies_indicadas",L.target.value),className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"ðŸ¶ CÃ£es"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"especies_indicadas",value:"cat",checked:l.especies_indicadas==="cat",onChange:L=>We("especies_indicadas",L.target.value),className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"ðŸ± Gatos"})]})]})]})}),e.jsx("input",{type:"hidden",value:l.tabela_nutricional}),e.jsx("div",{children:e.jsx(sx,{value:l.tabela_consumo,onChange:L=>We("tabela_consumo",L),pesoEmbalagem:parseFloat(l.peso_embalagem)||null})}),l.peso_embalagem&&l.classificacao_racao&&e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-orange-900 mb-2",children:"ðŸ“Š Preview da Calculadora"}),e.jsxs("div",{className:"text-sm text-orange-700 space-y-1",children:[e.jsxs("p",{children:["âœ“ Peso: ",e.jsxs("strong",{children:[l.peso_embalagem,"kg"]})]}),e.jsxs("p",{children:["âœ“ ClassificaÃ§Ã£o: ",e.jsx("strong",{children:l.classificacao_racao.replace("_"," ")})]}),l.categoria_racao&&e.jsxs("p",{children:["âœ“ Categoria: ",e.jsx("strong",{children:l.categoria_racao})]}),l.tabela_consumo&&e.jsx("p",{className:"text-green-600",children:"âœ“ Tabela de consumo configurada"}),!l.tabela_consumo&&e.jsx("p",{className:"text-yellow-600",children:"âš ï¸ Sem tabela de consumo (usarÃ¡ cÃ¡lculo genÃ©rico)"}),e.jsx("p",{className:"mt-2 text-orange-800",children:"ðŸ’¡ Use a Calculadora de RaÃ§Ã£o para ver duraÃ§Ã£o e custo/dia"})]})]})]}),r===8&&l.tipo_produto==="PAI"&&e.jsx("div",{className:"space-y-6",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:["VariaÃ§Ãµes do Produto: ",l.nome]}),e.jsx("p",{className:"text-sm text-blue-700",children:"Cadastre as variaÃ§Ãµes deste produto. Cada variaÃ§Ã£o Ã© um produto vendÃ¡vel independente com seu prÃ³prio SKU, preÃ§o e estoque."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-md font-semibold",children:"VariaÃ§Ãµes Cadastradas"}),e.jsx("button",{type:"button",onClick:()=>O(!_),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:_?"âŒ Cancelar":"âž• Nova VariaÃ§Ã£o"})]}),_&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4",children:[e.jsx("h5",{className:"font-semibold mb-3",children:"Cadastrar Nova VariaÃ§Ã£o"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU *"}),e.jsx("input",{type:"text",value:K.sku,onChange:L=>B({...K,sku:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Ex: PROD001-P"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Complementar *"}),e.jsx("input",{type:"text",value:K.nome,onChange:L=>B({...K,nome:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Ex: Tamanho P"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CÃ³digo de Barras"}),e.jsx("input",{type:"text",value:K.codigo_barras,onChange:L=>B({...K,codigo_barras:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"EAN-13"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PreÃ§o de Custo"}),e.jsx("input",{type:"number",step:"0.01",value:K.preco_custo,onChange:L=>B({...K,preco_custo:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PreÃ§o de Venda *"}),e.jsx("input",{type:"number",step:"0.01",value:K.preco_venda,onChange:L=>B({...K,preco_venda:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estoque MÃ­nimo"}),e.jsx("input",{type:"number",value:K.estoque_minimo,onChange:L=>B({...K,estoque_minimo:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"0"})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:K.e_kit,onChange:L=>B({...K,e_kit:L.target.checked}),className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:"ðŸ§© Esta variaÃ§Ã£o Ã© um KIT (possui composiÃ§Ã£o)"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Se marcado, vocÃª poderÃ¡ definir a composiÃ§Ã£o do kit apÃ³s salvar a variaÃ§Ã£o."})]})]})}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{O(!1),B({sku:"",nome:"",codigo_barras:"",preco_custo:"",preco_venda:"",estoque_minimo:0,e_kit:!1,e_kit_fisico:!1,composicao_kit:[]})},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:async()=>{var L,ge;if(!K.sku||!K.nome||!K.preco_venda){alert("Preencha SKU, Nome e PreÃ§o de Venda");return}try{const Me={codigo:K.sku,nome:`${l.nome} - ${K.nome}`,codigo_barras:K.codigo_barras||null,preco_custo:parseFloat(K.preco_custo)||0,preco_venda:parseFloat(K.preco_venda),estoque_minimo:parseInt(K.estoque_minimo)||0,tipo_produto:"VARIACAO",produto_pai_id:parseInt(t),categoria_id:l.categoria_id||null,marca_id:l.marca_id||null,unidade:l.unidade||"UN"};K.e_kit&&(Me.tipo_kit="VIRTUAL",Me.e_kit_fisico=!1,Me.composicao_kit=[]),await An(Me),alert("VariaÃ§Ã£o cadastrada com sucesso!"),O(!1),B({sku:"",nome:"",codigo_barras:"",preco_custo:"",preco_venda:"",estoque_minimo:0,e_kit:!1,e_kit_fisico:!1,composicao_kit:[]});const Ye=await oo(t);R(Ye.data)}catch(Me){console.error("Erro ao cadastrar variaÃ§Ã£o:",Me),alert(((ge=(L=Me.response)==null?void 0:L.data)==null?void 0:ge.detail)||"Erro ao cadastrar variaÃ§Ã£o")}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Salvar VariaÃ§Ã£o"})]})]}),E.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx("p",{className:"text-gray-500",children:"Nenhuma variaÃ§Ã£o cadastrada ainda."}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:'Clique em "Nova VariaÃ§Ã£o" para comeÃ§ar.'})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"SKU"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"CÃ³digo de Barras"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Custo"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Venda"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:E.map(L=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:L.codigo}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:L.nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:L.codigo_barras||"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:["R$ ",(L.preco_custo||0).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-gray-900 font-semibold",children:["R$ ",L.preco_venda.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:e.jsx("span",{className:`font-semibold ${L.estoque_atual<=L.estoque_minimo?"text-red-600":"text-green-600"}`,children:L.estoque_atual||0})}),e.jsxs("td",{className:"px-4 py-3 text-center",children:[e.jsx("button",{type:"button",onClick:()=>a(`/produtos/${L.id}/editar`),className:"text-blue-600 hover:text-blue-800 mr-2",title:"Editar",children:"âœï¸"}),e.jsx("button",{type:"button",onClick:async()=>{if(confirm(`Deseja excluir a variaÃ§Ã£o ${L.nome}?`))try{await _o(L.id),alert("VariaÃ§Ã£o excluÃ­da com sucesso!");const ge=await oo(t);R(ge.data||[])}catch(ge){console.error("Erro ao excluir variaÃ§Ã£o:",ge),alert("Erro ao excluir variaÃ§Ã£o")}},className:"text-red-600 hover:text-red-800",title:"Excluir",children:"ðŸ—‘ï¸"})]})]},L.id))})]})})]})]}):e.jsxs("div",{className:"text-center py-16 border-2 border-dashed border-yellow-300 rounded-lg bg-yellow-50",children:[e.jsx("svg",{className:"mx-auto h-16 w-16 text-yellow-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),e.jsx("p",{className:"mt-4 text-xl font-semibold text-yellow-900",children:"Aba Bloqueada"}),e.jsx("p",{className:"mt-2 text-sm text-yellow-800",children:"Salve o produto primeiro para habilitar o cadastro de variaÃ§Ãµes."}),e.jsx("p",{className:"mt-4 text-xs text-yellow-700",children:"ApÃ³s salvar, vocÃª serÃ¡ redirecionado automaticamente para cadastrar as variaÃ§Ãµes."})]})}),r===9&&(l.tipo_produto==="KIT"||l.tipo_produto==="VARIACAO"&&l.tipo_kit)&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border-2 border-gray-300 rounded-lg p-5",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Tipo de Estoque do Kit"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{onClick:()=>We("e_kit_fisico",!1),className:`cursor-pointer p-4 border-2 rounded-lg transition-all ${l.e_kit_fisico?"border-gray-300 bg-white hover:border-blue-300":"border-blue-500 bg-blue-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"radio",name:"tipo_estoque_kit",checked:!l.e_kit_fisico,onChange:()=>We("e_kit_fisico",!1),className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“Š"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:"Estoque Virtual"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["O estoque Ã© calculado ",e.jsx("strong",{children:"automaticamente"})," com base nos componentes disponÃ­veis."]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:[e.jsx("div",{children:"âœ“ NÃ£o permite movimentaÃ§Ã£o manual"}),e.jsx("div",{children:"âœ“ Estoque = menor disponibilidade dos componentes"}),e.jsx("div",{children:"âœ“ Ideal para kits montados sob demanda"})]})]})]})}),e.jsx("div",{onClick:()=>We("e_kit_fisico",!0),className:`cursor-pointer p-4 border-2 rounded-lg transition-all ${l.e_kit_fisico?"border-green-500 bg-green-50":"border-gray-300 bg-white hover:border-green-300"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"radio",name:"tipo_estoque_kit",checked:l.e_kit_fisico,onChange:()=>We("e_kit_fisico",!0),className:"mt-1 h-4 w-4 text-green-600 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“¦"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:"Estoque FÃ­sico"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["O kit possui estoque ",e.jsx("strong",{children:"prÃ³prio e independente"})," dos componentes."]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:[e.jsx("div",{children:"âœ“ Permite movimentaÃ§Ã£o manual"}),e.jsx("div",{children:"âœ“ Entrada: diminui componentes (montou kits)"}),e.jsx("div",{children:"âœ“ Ideal para kits prÃ©-montados"})]})]})]})})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-purple-600 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"ComposiÃ§Ã£o do Kit"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Defina quais produtos compÃµem este kit e as quantidades necessÃ¡rias de cada um."}),!l.e_kit_fisico&&e.jsxs("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800",children:[e.jsx("strong",{children:"ðŸ“Š Estoque Virtual Ativo"}),e.jsx("br",{}),"O estoque deste kit serÃ¡ calculado automaticamente baseado nos componentes.",e.jsx("br",{}),e.jsx("span",{className:"text-xs italic",children:"Estoque do kit = menor disponibilidade entre os componentes (considerando as quantidades necessÃ¡rias)"})]}),l.e_kit_fisico&&e.jsxs("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded text-sm text-green-800",children:[e.jsx("strong",{children:"ðŸ“¦ Estoque FÃ­sico Ativo"}),e.jsx("br",{}),e.jsx("strong",{children:"Entrada no kit:"})," Os componentes serÃ£o automaticamente DIMINUÃDOS (unitÃ¡rios viraram kit).",e.jsx("br",{}),e.jsx("strong",{children:"SaÃ­da manual:"})," VocÃª poderÃ¡ escolher se os componentes voltam ao estoque (desfez o kit) ou nÃ£o (perda/roubo)."]})]})]})}),!l.e_kit_fisico&&l.composicao_kit.length>0&&e.jsx("div",{className:"bg-white border-2 border-green-300 rounded-lg p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Estoque Virtual do Kit"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Calculado automaticamente"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-4xl font-bold text-green-600",children:de}),e.jsx("p",{className:"text-xs text-gray-500",children:"kits disponÃ­veis"})]})]})}),e.jsxs("div",{className:"border border-gray-300 rounded-lg p-5 bg-gray-50",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Adicionar Produto ao Kit"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Produto"}),e.jsxs("select",{value:H,onChange:L=>le(L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione um produto..."}),q.map(L=>e.jsxs("option",{value:L.id,children:["[",L.codigo,"] ",L.nome," - Estoque: ",L.estoque_atual||0]},L.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade"}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",value:G,onChange:L=>ee(L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"1"})]})]}),e.jsxs("button",{type:"button",onClick:os,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Adicionar ao Kit"]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-3",children:["Produtos no Kit (",l.composicao_kit.length,")"]}),l.composicao_kit.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Nenhum produto adicionado ao kit ainda"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"SKU"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Quantidade"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Kits PossÃ­veis"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.composicao_kit.map((L,ge)=>{const Me=Math.floor(L.estoque_componente/L.quantidade),Ye=Me===de&&de>0;return e.jsxs("tr",{className:`hover:bg-gray-50 ${Ye?"bg-yellow-50":""}`,children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:L.produto_sku||"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-700",children:[L.produto_nome,Ye&&e.jsx("span",{className:"ml-2 text-xs bg-yellow-200 text-yellow-800 px-2 py-1 rounded",children:"âš ï¸ LIMITADOR"})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-900 font-semibold",children:L.quantidade}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:L.estoque_componente||0}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsx("span",{className:`font-semibold ${Me===0?"text-red-600":Me<5?"text-yellow-600":"text-green-600"}`,children:Me})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{type:"button",onClick:()=>lr(L.produto_id),className:"text-red-600 hover:text-red-800",title:"Remover do kit",children:"ðŸ—‘ï¸"})})]},L.produto_id)})})]})})]}),l.composicao_kit.length>0&&de===0&&!l.e_kit_fisico&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{className:"text-sm text-red-800",children:[e.jsx("strong",{children:"Kit sem estoque disponÃ­vel!"}),e.jsx("p",{className:"mt-1",children:"Pelo menos um dos componentes estÃ¡ sem estoque suficiente para montar o kit."})]})]})})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>a("/produtos"),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:ha,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400",children:ha?"Salvando...":o?"Atualizar":"Cadastrar"})]})]}),ke&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Nova Entrada de Estoque"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade *"}),e.jsx("input",{type:"number",step:"0.01",value:ze.quantidade,onChange:L=>Y({...ze,quantidade:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 flex justify-between items-center",children:[e.jsx("span",{children:"NÃƒÂºmero do Lote"}),e.jsx("button",{type:"button",onClick:()=>{const L=`LOTE-${new Date().toISOString().split("T")[0].replace(/-/g,"")}-${Math.floor(Math.random()*1e3).toString().padStart(3,"0")}`;Y({...ze,nome_lote:L})},className:"text-xs text-blue-600 hover:text-blue-800",children:"Gerar SugestÃƒÂ£o"})]}),e.jsx("input",{type:"text",value:ze.nome_lote,onChange:L=>Y({...ze,nome_lote:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: LOTE-20260105-001 (deixe vazio para gerar automaticamente)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de FabricaÃ§Ã£o"}),e.jsx("input",{type:"date",value:ze.data_fabricacao,onChange:L=>Y({...ze,data_fabricacao:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Validade"}),e.jsx("input",{type:"date",value:ze.data_validade,onChange:L=>Y({...ze,data_validade:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PreÃ§o de Custo *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:ze.preco_custo,onChange:L=>Y({...ze,preco_custo:L.target.value}),className:"w-full pl-12 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0,00"})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>Ue(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:Re,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Registrar Entrada"})]})]})}),ve&&fe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Editar Lote"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Lote *"}),e.jsx("input",{type:"text",value:fe.nome_lote,onChange:L=>U({...fe,nome_lote:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nome do lote"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade *"}),e.jsx("input",{type:"number",step:"0.01",value:fe.quantidade_inicial,onChange:L=>U({...fe,quantidade_inicial:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de FabricaÃ§Ã£o"}),e.jsx("input",{type:"date",value:fe.data_fabricacao,onChange:L=>U({...fe,data_fabricacao:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Validade"}),e.jsx("input",{type:"date",value:fe.data_validade,onChange:L=>U({...fe,data_validade:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Custo UnitÃ¡rio *"}),e.jsx("input",{type:"number",step:"0.01",value:fe.custo_unitario,onChange:L=>U({...fe,custo_unitario:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0,00"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{Le(!1),U(null)},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:He,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Salvar AlteraÃ§Ãµes"})]})]})}),ie&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:$e?"Editar Fornecedor":"Adicionar Fornecedor"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fornecedor *"}),e.jsxs("select",{value:ne.fornecedor_id,onChange:L=>pe({...ne,fornecedor_id:L.target.value}),disabled:!!$e,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",children:[e.jsx("option",{value:"",children:"Selecione..."}),N.map(L=>e.jsx("option",{value:L.id,children:L.nome},L.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CÃ³digo no Fornecedor"}),e.jsx("input",{type:"text",value:ne.codigo_fornecedor,onChange:L=>pe({...ne,codigo_fornecedor:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"SKU-FORNECEDOR-001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PreÃ§o de Custo"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:ne.preco_custo,onChange:L=>pe({...ne,preco_custo:L.target.value}),className:"w-full pl-12 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0,00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prazo de Entrega (dias)"}),e.jsx("input",{type:"number",value:ne.prazo_entrega,onChange:L=>pe({...ne,prazo_entrega:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"7"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estoque no Fornecedor"}),e.jsx("input",{type:"number",step:"0.01",value:ne.estoque_fornecedor,onChange:L=>pe({...ne,estoque_fornecedor:L.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"100"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:ne.e_principal,onChange:L=>pe({...ne,e_principal:L.target.checked}),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Fornecedor Principal"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>_e(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:ya,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Salvar"})]})]})})]})}function tx(){const a=va(),[t,s]=n.useState([]),[o,r]=n.useState([]),[i,l]=n.useState(!1),[x,j]=n.useState({totalEntradas:0,totalSaidas:0,valorTotal:0}),[g,v]=n.useState({data_inicio:C("mes"),data_fim:y(),produto_id:"",tipo_movimentacao:""}),[d,m]=n.useState("mes");n.useEffect(()=>{c()},[]),n.useEffect(()=>{f()},[g]);function C(N){const w=new Date,S=new Date(w);switch(N){case"mes":S.setDate(1);break;case"3meses":S.setMonth(w.getMonth()-3);break;case"6meses":S.setMonth(w.getMonth()-6);break;case"ano":S.setMonth(0),S.setDate(1);break;default:return""}return S.toISOString().split("T")[0]}function y(){return new Date().toISOString().split("T")[0]}const c=async()=>{try{const N=await Hl();N.data&&Array.isArray(N.data.items)?r(N.data.items):Array.isArray(N.data)?r(N.data):(console.warn("Resposta de produtos nÃ£o Ã© um array:",N.data),r([]))}catch(N){console.error("Erro ao carregar produtos:",N),r([])}},f=async()=>{var N,w,S;try{l(!0);const W=(await Yc(g)).data;let te=[];W&&Array.isArray(W.movimentacoes)?te=W.movimentacoes:Array.isArray(W)?te=W:console.warn("Resposta de movimentaÃ§Ãµes nÃ£o Ã© um array:",W),s(te);const D=te.reduce((A,X)=>(A.totalEntradas+=X.entrada||0,A.totalSaidas+=X.saida||0,A.valorTotal+=X.valor_total||0,A),{totalEntradas:0,totalSaidas:0,valorTotal:0});j(D)}catch(P){console.error("Erro ao carregar relatÃ³rio:",P),console.error("Detalhes do erro:",(N=P.response)==null?void 0:N.data),alert(`Erro ao carregar relatÃ³rio: ${((S=(w=P.response)==null?void 0:w.data)==null?void 0:S.detail)||P.message}`),s([])}finally{l(!1)}},b=N=>{m(N),N==="personalizado"||v({...g,data_inicio:C(N),data_fim:y()})},u=(N,w)=>{v(S=>({...S,[N]:w}))},h=()=>{const N=["Data","Produto","CÃ³digo","Entrada","SaÃ­da","Estoque","Tipo","Valor","UsuÃ¡rio","NÂº Pedido","LanÃ§amento"],w=t.map(te=>[te.data||"",te.produto_nome||"",te.codigo||"",te.entrada||0,te.saida||0,te.estoque||0,te.tipo||"",Js(te.valor_total||0),te.usuario||"",te.numero_pedido||"",te.lancamento||""]);let S=N.join(";")+`
`;w.forEach(te=>{S+=te.join(";")+`
`});const P=new Blob([S],{type:"text/csv;charset=utf-8;"}),W=document.createElement("a");W.href=URL.createObjectURL(P),W.download=`relatorio_movimentacoes_${new Date().toISOString().split("T")[0]}.csv`,W.click()},p=t.reduce((N,w)=>{const P=new Date(w.data_movimentacao).toLocaleDateString("pt-BR",{month:"short",year:"numeric"});return N[P]||(N[P]=[]),N[P].push(w),N},{}),k=N=>({entrada:"bg-green-100 text-green-800",saida:"bg-red-100 text-red-800",ajuste:"bg-yellow-100 text-yellow-800",transferencia:"bg-blue-100 text-blue-800"})[N]||"bg-gray-100 text-gray-800";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"RelatÃ³rio de MovimentaÃ§Ãµes"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"HistÃ³rico completo de entradas e saÃ­das de estoque"})]}),e.jsx("button",{onClick:()=>a("/produtos"),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Voltar"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"Ãšltimo MÃªs",value:"mes"},{label:"3 Meses",value:"3meses"},{label:"6 Meses",value:"6meses"},{label:"Este Ano",value:"ano"},{label:"Personalizado",value:"personalizado"}].map(N=>e.jsx("button",{onClick:()=>b(N.value),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${d===N.value?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:N.label},N.value))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:g.data_inicio,onChange:N=>u("data_inicio",N.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:g.data_fim,onChange:N=>u("data_fim",N.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Produto"}),e.jsxs("select",{value:g.produto_id,onChange:N=>u("produto_id",N.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os Produtos"}),o.map(N=>e.jsxs("option",{value:N.id,children:[N.codigo||N.sku," - ",N.nome]},N.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:g.tipo_movimentacao,onChange:N=>u("tipo_movimentacao",N.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os Tipos"}),e.jsx("option",{value:"entrada",children:"Entrada"}),e.jsx("option",{value:"saida",children:"SaÃ­da"}),e.jsx("option",{value:"ajuste",children:"Ajuste"}),e.jsx("option",{value:"transferencia",children:"TransferÃªncia"})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Entradas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:x.totalEntradas.toFixed(2)})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 11l5-5m0 0l5 5m-5-5v12"})})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de SaÃ­das"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:x.totalSaidas.toFixed(2)})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 13l-5 5m0 0l-5-5m5 5V6"})})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Valor Total"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:Js(x.valorTotal)})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})})]}),e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:h,disabled:t.length===0,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Exportar CSV"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[i?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Carregando relatÃ³rio..."}):t.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Nenhuma movimentaÃ§Ã£o encontrada no perÃ­odo selecionado"}):e.jsx("div",{className:"overflow-x-auto",children:Object.entries(p).map(([N,w])=>e.jsxs("div",{children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 font-semibold text-gray-700 border-b border-gray-200",children:[N.charAt(0).toUpperCase()+N.slice(1)," (",w.length," movimentaÃ§Ãµes)"]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CÃ³digo"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Entrada"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SaÃ­da"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Custo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"UsuÃ¡rio"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"NÂº Pedido"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map((S,P)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 whitespace-nowrap",children:S.data}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:S.produto_nome||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-700 font-mono",children:S.codigo||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-green-600",children:S.entrada>0?S.entrada:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-red-600",children:S.saida>0?S.saida:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:S.estoque||0}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${k(S.tipo)}`,children:S.tipo})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:Js(S.valor_total||0)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:S.usuario||"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:S.numero_pedido?e.jsxs("button",{className:"text-blue-600 hover:text-blue-800 underline font-mono text-sm",title:"Clique para ver o pedido",children:["#",S.numero_pedido]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]},P))})]})]},N))}),!i&&t.length>0&&e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",t.length," movimentaÃ§Ãµes no perÃ­odo"]})})]})]})}const rx=()=>F.get("/estoque/alertas/pendentes"),ox=(a={})=>F.get("/estoque/alertas/todos",{params:a}),nx=()=>F.get("/estoque/alertas/dashboard"),lx=(a,t,s=null)=>F.put(`/estoque/alertas/${a}/resolver`,{status:t,observacao:s}),ix=a=>F.post("/estoque/alertas/verificar-estoque-negativo",{itens:a});function dx(){const a=va(),[t,s]=n.useState([]),[o,r]=n.useState([]),[i,l]=n.useState(null),[x,j]=n.useState(!1),[g,v]=n.useState("pendentes");n.useEffect(()=>{d()},[g]);const d=async()=>{j(!0);try{if(g==="pendentes"){const c=await rx();s(c.data)}else if(g==="historico"){const c=await ox();r(c.data)}else if(g==="dashboard"){const c=await nx();l(c.data)}}catch(c){console.error("Erro ao carregar alertas:",c),Ee.error("Erro ao carregar alertas de estoque")}finally{j(!1)}},m=async(c,f,b=null)=>{if(f==="resolvido"&&b){a(`/produtos?produto_id=${b}`),Ee.info("Redirecionando para ajustar o estoque do produto...");return}try{await lx(c,f),Ee.success("Alerta ignorado com sucesso"),d()}catch(u){console.error("Erro ao ignorar alerta:",u),Ee.error("Erro ao processar alerta")}},C=c=>{const f={CRITICO:"bg-red-100 text-red-800 border-red-300",ALTO:"bg-orange-100 text-orange-800 border-orange-300",MEDIO:"bg-yellow-100 text-yellow-800 border-yellow-300",BAIXO:"bg-blue-100 text-blue-800 border-blue-300"};return f[c]||f.MEDIO},y=c=>new Date(c).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(La,{className:"text-red-500"}),"Alertas de Estoque Negativo"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Monitoramento em tempo real de produtos com estoque crÃ­tico"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[e.jsx("button",{onClick:()=>v("pendentes"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${g==="pendentes"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(La,{size:18}),"Pendentes",t.length>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:t.length})]})}),e.jsx("button",{onClick:()=>v("dashboard"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${g==="dashboard"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ha,{size:18}),"Dashboard"]})}),e.jsx("button",{onClick:()=>v("historico"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${g==="historico"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ls,{size:18}),"HistÃ³rico"]})})]})})}),e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:d,disabled:x,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors",children:[e.jsx(Aa,{size:18,className:x?"animate-spin":""}),"Atualizar"]})}),x?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(Aa,{className:"animate-spin mx-auto text-gray-400",size:48}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Carregando..."})]}):e.jsxs(e.Fragment,{children:[g==="pendentes"&&e.jsx("div",{className:"space-y-4",children:t.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(fa,{className:"mx-auto text-green-500",size:64}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mt-4",children:"Nenhum alerta pendente!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Todos os produtos estÃ£o com estoque adequado."})]}):t.map(c=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:c.produto_nome}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${C(c.criticidade)}`,children:c.criticidade})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Estoque Anterior"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.estoque_anterior})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Estoque Resultante"}),e.jsx("p",{className:"text-lg font-semibold text-red-600",children:c.estoque_resultante})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Quantidade Vendida"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.quantidade_vendida})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Venda"}),e.jsx("p",{className:"text-lg font-semibold text-blue-600",children:c.venda_codigo?`#${c.venda_codigo}`:c.venda_id?`ID: ${c.venda_id}`:"N/A"})]})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Data:"})," ",y(c.data_alerta)]}),c.observacao&&e.jsxs("p",{className:"mt-1",children:[e.jsx("strong",{children:"ObservaÃ§Ã£o:"})," ",c.observacao]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[e.jsxs("button",{onClick:()=>m(c.id,"resolvido",c.produto_id),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",title:"Ir para o produto e fazer ajuste de estoque",children:[e.jsx(ls,{size:16}),"Ajustar Estoque"]}),e.jsxs("button",{onClick:()=>m(c.id,"ignorado"),className:"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm",title:"Ignorar este alerta (aceitar estoque negativo)",children:[e.jsx(ys,{size:16}),"Ignorar"]})]})]})},c.id))}),g==="dashboard"&&i&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total de Alertas"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:i.total_alertas})]}),e.jsx(La,{className:"text-gray-400",size:40})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pendentes"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 mt-2",children:i.alertas_pendentes})]}),e.jsx(La,{className:"text-red-400",size:40})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"CrÃ­ticos"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600 mt-2",children:i.alertas_criticos})]}),e.jsx(Ha,{className:"text-orange-400",size:40})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Resolvidos"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 mt-2",children:i.alertas_resolvidos})]}),e.jsx(fa,{className:"text-green-400",size:40})]})})]}),i.produtos_estoque_negativo&&i.produtos_estoque_negativo.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ls,{className:"text-red-500"}),"Produtos com Estoque Negativo Atual"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque Atual"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Alertas Pendentes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.produtos_estoque_negativo.map((c,f)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:c.nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-bold text-red-600",children:c.estoque_atual}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900",children:c.alertas_pendentes})]},f))})]})})]})]}),g==="historico"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Criticidade"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque Ant."}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque Res."}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Venda"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-12 text-center text-gray-500",children:"Nenhum alerta registrado"})}):o.map(c=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:y(c.data_alerta)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:c.produto_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${C(c.criticidade)}`,children:c.criticidade})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900",children:c.estoque_anterior}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-semibold text-red-600",children:c.estoque_resultante}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${c.resolvido?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:c.resolvido?"Resolvido":"Pendente"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm text-blue-600 font-medium",children:c.venda_codigo?`#${c.venda_codigo}`:c.venda_id?`ID: ${c.venda_id}`:"N/A"})]},c.id))})]})})})]})]})}function cx(){const[a,t]=n.useState([]),[s,o]=n.useState(!1),[r,i]=n.useState("pendente");n.useEffect(()=>{l();const m=setInterval(l,6e4);return()=>clearInterval(m)},[]);const l=async()=>{o(!0);try{const m=await F.get("/api/lembretes/pendentes");t(m.data.lembretes||[])}catch(m){console.error("Erro ao carregar lembretes:",m),Ee.error("Erro ao carregar lembretes")}finally{o(!1)}},x=async m=>{try{await F.post(`/api/lembretes/${m}/completar`,{}),Ee.success("Lembrete marcado como completado"),l()}catch{Ee.error("Erro ao completar lembrete")}},j=async m=>{try{await F.post(`/api/lembretes/${m}/renovar`,{}),Ee.success("Lembrete renovado com sucesso"),l()}catch{Ee.error("Erro ao renovar lembrete")}},g=async m=>{if(window.confirm("Tem certeza que deseja cancelar este lembrete?"))try{await F.delete(`/api/lembretes/${m}`),Ee.success("Lembrete cancelado"),l()}catch{Ee.error("Erro ao cancelar lembrete")}},v=a.filter(m=>m.dias_restantes<=7),d=a.filter(m=>m.dias_restantes<0);return e.jsxs("div",{className:"lembretes-container",children:[e.jsxs("div",{className:"lembretes-header",children:[e.jsx("h1",{children:"ðŸ“Œ Lembretes de RecorrÃªncia"}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-number",children:a.length}),e.jsx("span",{className:"stat-label",children:"Total de Lembretes"})]}),e.jsxs("div",{className:"stat-card warning",children:[e.jsx("span",{className:"stat-number",children:v.length}),e.jsx("span",{className:"stat-label",children:"PrÃ³ximos em 7 dias"})]}),e.jsxs("div",{className:"stat-card danger",children:[e.jsx("span",{className:"stat-number",children:d.length}),e.jsx("span",{className:"stat-label",children:"Vencidos"})]})]})]}),s&&e.jsx("div",{className:"loading",children:"Carregando lembretes..."}),a.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(al,{size:48}),e.jsx("h2",{children:"Nenhum lembrete pendente"}),e.jsx("p",{children:"Lembretes serÃ£o criados automaticamente para produtos recorrentes."})]}):e.jsxs("div",{className:"lembretes-list",children:[d.length>0&&e.jsxs("div",{className:"section",children:[e.jsx("h3",{className:"section-title danger",children:"âš ï¸ Vencidos"}),d.map(m=>e.jsx(lo,{lembrete:m,onCompletar:x,onRenovar:j,onCancelar:g},m.id))]}),v.length>0&&e.jsxs("div",{className:"section",children:[e.jsx("h3",{className:"section-title warning",children:"ðŸ”” PrÃ³ximos em atÃ© 7 dias"}),v.map(m=>e.jsx(lo,{lembrete:m,onCompletar:x,onRenovar:j,onCancelar:g},m.id))]}),a.filter(m=>m.dias_restantes>7).length>0&&e.jsxs("div",{className:"section",children:[e.jsx("h3",{className:"section-title",children:"ðŸ“… PrÃ³ximos (mais de 7 dias)"}),a.filter(m=>m.dias_restantes>7).map(m=>e.jsx(lo,{lembrete:m,onCompletar:x,onRenovar:j,onCancelar:g},m.id))]})]})]})}function lo({lembrete:a,onCompletar:t,onRenovar:s,onCancelar:o}){const r=a.dias_restantes,i=new Date(a.data_proxima_dose),l=r<0?"vencido":r<=7?"proximo":"futuro",x=a.dose_total&&a.dose_total>0,j=x?a.dose_atual/a.dose_total*100:0;return e.jsxs("div",{className:`lembrete-card ${l}`,children:[e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h4",{children:a.produto_nome}),e.jsxs("div",{className:"badges",children:[x&&e.jsxs("span",{className:"dose-badge",children:["Dose ",a.dose_atual,"/",a.dose_total]}),e.jsx("span",{className:`status-badge ${l}`,children:r<0?"VENCIDO":`${Math.abs(r)}d`})]})]}),x&&e.jsx("div",{className:"progress-bar-container",children:e.jsx("div",{className:"progress-bar",style:{width:`${j}%`}})}),e.jsxs("div",{className:"card-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"Pet:"}),e.jsx("span",{className:"value",children:a.pet_nome})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"Data:"}),e.jsx("span",{className:"value",children:i.toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"Quantidade:"}),e.jsx("span",{className:"value",children:a.quantidade})]}),a.preco_estimado&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"label",children:"PreÃ§o Est.:"}),e.jsxs("span",{className:"value",children:["R$ ",a.preco_estimado.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"card-actions",children:[e.jsxs("button",{className:"btn btn-success",onClick:()=>t(a.id),title:"Marcar como completado",children:[e.jsx(qs,{})," Comprado"]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>s(a.id),title:"Renovar lembrete",children:[e.jsx(Ut,{})," Renovar"]}),e.jsx("button",{className:"btn btn-danger",onClick:()=>o(a.id),title:"Cancelar lembrete",children:e.jsx(Ss,{})})]})]})}function xx(){const[a,t]=n.useState([]),[s,o]=n.useState([]),[r,i]=n.useState(!1),[l,x]=n.useState({pet_id:"",pet_nome:"",produto_id:"",produto_nome:"",categoria_racao:"",peso_pet_kg:"",idade_meses:"",nivel_atividade:"normal",classificacao:"",especies:"dog",produto_comparar_id:"",produto_comparar_nome:""}),[j,g]=n.useState(null),[v,d]=n.useState([]);n.useEffect(()=>{m(),C()},[]);const m=async()=>{var b,u,h;try{console.log("ðŸ” Iniciando carregamento de produtos...");const p=await F.get("/produtos/");console.log("ðŸ“¡ Resposta da API:",{status:p.status,dataType:typeof p.data,isArray:Array.isArray(p.data),dataPreview:typeof p.data=="string"?p.data.substring(0,200):"object"});let k=p.data;if(typeof k=="string"){console.warn("âš ï¸ API retornou string, tentando parsear JSON...");try{k=JSON.parse(k)}catch(S){console.error("âŒ Erro ao parsear JSON:",S),console.error("âŒ ConteÃºdo recebido:",k.substring(0,500)),Ee.error("Erro: resposta da API invÃ¡lida");return}}const N=Array.isArray(k)?k:k.items||k.produtos||[];console.log("ðŸ“¦ Total de produtos recebidos:",N.length),console.log("ðŸ“¦ Estrutura da resposta:",Array.isArray(k)?"Array direto":`Objeto com keys: ${Object.keys(k).join(", ")}`),N.length>0&&console.log("ðŸ“¦ Estrutura do primeiro produto:",N[0]);const w=N.filter(S=>S.peso_embalagem&&S.peso_embalagem>0);console.log("ðŸ¥« RaÃ§Ãµes encontradas:",w.length),console.log("ðŸ“Š Total de produtos:",N.length),w.length>0?console.log("ðŸ¥« IDs das raÃ§Ãµes:",w.map(S=>`${S.id}-${S.nome}`)):console.log("âš ï¸ Produtos sem peso_embalagem:",N.slice(0,5).map(S=>({id:S.id,nome:S.nome,peso_embalagem:S.peso_embalagem,categoria_racao:S.categoria_racao,classificacao_racao:S.classificacao_racao}))),t(w),w.length===0&&N.length>0?(console.warn("âš ï¸ Produtos encontrados, mas nenhum tem peso de embalagem configurado"),Ee.error(`${N.length} produtos encontrados, mas nenhum tem PESO DE EMBALAGEM configurado. Edite os produtos de raÃ§Ã£o e preencha o campo "Peso da Embalagem (kg)".`,{duration:6e3})):w.length===0&&(console.log("â„¹ï¸ Nenhum produto encontrado"),Ee.error("Nenhum produto encontrado. Cadastre produtos primeiro."))}catch(p){console.error("âŒ Erro ao carregar produtos:",p),console.error("âŒ Detalhes:",((b=p.response)==null?void 0:b.data)||p.message),Ee.error(`Erro ao carregar produtos: ${((h=(u=p.response)==null?void 0:u.data)==null?void 0:h.detail)||p.message}`)}},C=async()=>{try{const b=await F.get("/clientes/pets/todos"),u=Array.isArray(b.data)?b.data:[];o(u),console.log("ðŸ¾ Pets carregados:",u.length)}catch(b){console.error("âŒ Erro ao carregar pets:",b)}},y=b=>{const u=s.find(h=>h.id===parseInt(b));if(u){let h="";if(u.data_nascimento){const k=new Date(u.data_nascimento),w=Math.abs(new Date-k);h=Math.floor(w/(1e3*60*60*24*30.44)).toString()}const p=u.especie==="Cachorro"?"dog":u.especie==="Gato"?"cat":l.especies;x({...l,pet_id:b,pet_nome:`${u.nome} - ${u.especie} ${u.peso?`(${u.peso}kg)`:""}`,peso_pet_kg:u.peso||"",idade_meses:h,especies:p}),Ee.success(`Pet ${u.nome} selecionado!`)}else x({...l,pet_id:"",peso_pet_kg:"",idade_meses:""})},c=async()=>{var b,u;if(!l.peso_pet_kg){Ee.error("Informe o peso do pet");return}if(l.categoria_racao==="filhote"&&!l.idade_meses){Ee.error("âš ï¸ Idade Ã© obrigatÃ³ria para raÃ§Ãµes de filhote!");return}try{i(!0);const h=await F.post("/api/produtos/calculadora-racao",{produto_id:l.produto_id?parseInt(l.produto_id):null,peso_pet_kg:parseFloat(l.peso_pet_kg),idade_meses:l.idade_meses?parseInt(l.idade_meses):null,nivel_atividade:l.nivel_atividade});g(h.data),d([]),Ee.success("CÃ¡lculo realizado!")}catch(h){console.error("Erro:",h),Ee.error(((u=(b=h.response)==null?void 0:b.data)==null?void 0:u.detail)||"Erro ao calcular")}finally{i(!1)}},f=async()=>{var b,u;if(!l.peso_pet_kg){Ee.error("Informe o peso do pet");return}try{if(i(!0),l.produto_comparar_id){const p=(await F.post("/api/produtos/calculadora-racao",{produto_id:parseInt(l.produto_comparar_id),peso_pet_kg:parseFloat(l.peso_pet_kg),idade_meses:l.idade_meses?parseInt(l.idade_meses):null,nivel_atividade:l.nivel_atividade})).data;if(l.produto_id){const k=await F.post("/api/produtos/calculadora-racao",{produto_id:parseInt(l.produto_id),peso_pet_kg:parseFloat(l.peso_pet_kg),idade_meses:l.idade_meses?parseInt(l.idade_meses):null,nivel_atividade:l.nivel_atividade});if(k.data.produto_id===p.produto_id)d([k.data]),Ee.success("Mostrando cÃ¡lculo da raÃ§Ã£o selecionada");else{const N=[k.data,p];d(N),Ee.success("Comparando 2 raÃ§Ãµes selecionadas!")}}else d([p]),Ee.success("Mostrando cÃ¡lculo da raÃ§Ã£o selecionada")}else{const h={peso_pet_kg:parseFloat(l.peso_pet_kg),nivel_atividade:l.nivel_atividade};l.idade_meses&&(h.idade_meses=parseInt(l.idade_meses)),l.classificacao&&(h.classificacao=l.classificacao),l.especies&&(h.especies=l.especies);let k=(await F.post("/api/produtos/comparar-racoes",null,{params:h})).data.racoes||[];if(l.produto_id){k=k.filter(W=>W.produto_id!==parseInt(l.produto_id));const P=(await F.post("/api/produtos/calculadora-racao",{produto_id:parseInt(l.produto_id),peso_pet_kg:parseFloat(l.peso_pet_kg),idade_meses:l.idade_meses?parseInt(l.idade_meses):null,nivel_atividade:l.nivel_atividade})).data;k.sort((W,te)=>W.custo_por_dia-te.custo_por_dia),k=[P,...k]}const N=k.slice(0,10);d(N),k.length===0&&Ee.error("Nenhuma raÃ§Ã£o encontrada com esses filtros. Tente outros critÃ©rios.")}}catch(h){console.error("Erro:",h),Ee.error(((u=(b=h.response)==null?void 0:b.data)==null?void 0:u.detail)||"Erro ao comparar")}finally{i(!1)}};return e.jsxs("div",{className:"calculadora-racao-container",children:[e.jsxs("div",{className:"header",children:[e.jsx("h1",{children:"ðŸ¥« Calculadora de RaÃ§Ã£o"}),e.jsx("p",{children:"Calcule duraÃ§Ã£o, custo/dia e compare produtos"})]}),e.jsxs("div",{className:"calculadora-grid",children:[e.jsxs("div",{className:"form-card",children:[e.jsx("h2",{children:"ðŸ“ Dados do Pet"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ðŸ¾ Buscar Pet Cadastrado"}),e.jsx("input",{type:"text",list:"pets-list",value:l.pet_nome||"",onChange:b=>{const u=b.target.value;x({...l,pet_nome:u});const h=s.find(p=>`${p.nome} - ${p.especie} ${p.peso?`(${p.peso}kg)`:""}`===u);h&&y(h.id)},placeholder:"Digite ou selecione um pet",className:"pet-select"}),e.jsx("datalist",{id:"pets-list",children:s.map(b=>e.jsx("option",{value:`${b.nome} - ${b.especie} ${b.peso?`(${b.peso}kg)`:""}`},b.id))}),e.jsx("small",{className:"form-hint",children:"ðŸ’¡ Digite ou selecione um pet para preencher automaticamente peso e idade"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Peso do Pet (kg) *"}),e.jsx("input",{type:"number",step:"0.1",value:l.peso_pet_kg,onChange:b=>x({...l,peso_pet_kg:b.target.value}),placeholder:"Ex: 8.5"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Idade (meses)",l.categoria_racao==="filhote"&&e.jsx("span",{style:{color:"#ff6b6b"},children:" *"})]}),e.jsx("input",{type:"number",value:l.idade_meses,onChange:b=>x({...l,idade_meses:b.target.value}),placeholder:l.categoria_racao==="filhote"?"ObrigatÃ³rio para filhotes!":"Ex: 24 (opcional)",required:l.categoria_racao==="filhote",style:l.categoria_racao==="filhote"?{borderColor:"#ff6b6b",borderWidth:"2px"}:{}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"NÃ­vel de Atividade"}),e.jsxs("select",{value:l.nivel_atividade,onChange:b=>x({...l,nivel_atividade:b.target.value}),children:[e.jsx("option",{value:"baixo",children:"Baixo"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"alto",children:"Alto"})]})]}),e.jsx("hr",{}),e.jsx("h3",{children:"ðŸ¥« RaÃ§Ã£o"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Selecionar RaÃ§Ã£o"}),e.jsx("input",{type:"text",list:"racoes-list",value:l.produto_nome||"",onChange:b=>{const u=b.target.value;x({...l,produto_nome:u});const h=a.find(p=>`${p.nome} - ${p.peso_embalagem}kg - R$ ${p.preco_venda}`===u);h&&x({...l,produto_id:h.id,produto_nome:u,categoria_racao:h.categoria_racao||""})},placeholder:"Digite ou selecione uma raÃ§Ã£o"}),e.jsx("datalist",{id:"racoes-list",children:a.map(b=>e.jsx("option",{value:`${b.nome} - ${b.peso_embalagem}kg - R$ ${b.preco_venda}`},b.id))}),l.categoria_racao==="filhote"&&e.jsx("small",{className:"form-hint",style:{color:"#ff6b6b",fontWeight:"bold"},children:"âš ï¸ RaÃ§Ã£o de filhote - idade Ã© obrigatÃ³ria!"})]}),e.jsx("div",{className:"button-group",children:e.jsx("button",{onClick:c,disabled:r,className:"btn-primary",children:r?"Calculando...":"ðŸ“Š Calcular"})}),e.jsx("hr",{}),e.jsx("h3",{children:"ðŸ” Comparar RaÃ§Ãµes"}),e.jsxs("div",{className:"info-box",children:[e.jsx("strong",{children:"ðŸ’¡ Dica:"})," Escolha UMA das opÃ§Ãµes abaixo:",e.jsx("br",{}),"â€¢ Selecione uma raÃ§Ã£o especÃ­fica para ver como ela se compara",e.jsx("br",{}),"â€¢ OU use os filtros gerais para ver todas de uma categoria"]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"â­ Comparar RaÃ§Ã£o EspecÃ­fica"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("input",{type:"text",list:"racoes-comparar-list",value:l.produto_comparar_nome||"",onChange:b=>{const u=b.target.value;if(u===""){x({...l,produto_comparar_id:"",produto_comparar_nome:""});return}x({...l,produto_comparar_nome:u,classificacao:""});const h=a.find(p=>`${p.nome} - ${p.classificacao_racao} - R$ ${p.preco_venda}`===u);h&&x({...l,produto_comparar_id:h.id,produto_comparar_nome:u,classificacao:""})},placeholder:"Digite ou selecione uma raÃ§Ã£o",disabled:l.classificacao!=="",style:{flex:1}}),l.produto_comparar_nome&&e.jsx("button",{type:"button",onClick:()=>x({...l,produto_comparar_id:"",produto_comparar_nome:""}),className:"btn-clear",title:"Limpar seleÃ§Ã£o",children:"âœ•"})]}),e.jsx("datalist",{id:"racoes-comparar-list",children:a.map(b=>e.jsx("option",{value:`${b.nome} - ${b.classificacao_racao} - R$ ${b.preco_venda}`},b.id))}),l.classificacao&&e.jsx("small",{className:"form-warning",children:"âš ï¸ Limpe o filtro de classificaÃ§Ã£o para usar esta opÃ§Ã£o"}),!l.produto_comparar_id&&!l.classificacao&&e.jsx("small",{className:"form-hint",children:"ðŸ’¡ Deixe vazio para comparar por classificaÃ§Ã£o abaixo"})]}),e.jsx("div",{className:"divider-text",children:"OU"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ðŸ“‹ Filtro por ClassificaÃ§Ã£o"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("select",{value:l.classificacao,onChange:b=>x({...l,classificacao:b.target.value,produto_comparar_id:"",produto_comparar_nome:""}),disabled:l.produto_comparar_id!=="",style:{flex:1},children:[e.jsx("option",{value:"",children:"Todas as classificaÃ§Ãµes"}),e.jsx("option",{value:"super_premium",children:"Super Premium"}),e.jsx("option",{value:"premium",children:"Premium"}),e.jsx("option",{value:"especial",children:"Especial"}),e.jsx("option",{value:"standard",children:"Standard"})]}),l.classificacao&&e.jsx("button",{type:"button",onClick:()=>x({...l,classificacao:""}),className:"btn-clear",title:"Limpar filtro",children:"âœ•"})]}),l.produto_comparar_id&&e.jsx("small",{className:"form-warning",children:"âš ï¸ Limpe a raÃ§Ã£o especÃ­fica acima para usar este filtro"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"EspÃ©cie"}),e.jsxs("select",{value:l.especies,onChange:b=>x({...l,especies:b.target.value}),children:[e.jsx("option",{value:"dog",children:"ðŸ¶ CÃ£es"}),e.jsx("option",{value:"cat",children:"ðŸ± Gatos"}),e.jsx("option",{value:"both",children:"Ambos"})]})]}),e.jsx("div",{className:"button-group",children:e.jsx("button",{onClick:f,disabled:r,className:"btn-secondary",children:r?"Comparando...":"ðŸ” Comparar Todas"})})]}),e.jsxs("div",{children:[j&&e.jsxs("div",{className:"result-card",children:[e.jsx("h2",{children:"ðŸ“Š Resultado do CÃ¡lculo"}),e.jsxs("div",{className:"result-header",children:[e.jsx("h3",{children:j.produto_nome}),j.classificacao&&e.jsx("span",{className:`badge badge-${j.classificacao}`,children:j.classificacao.replace("_"," ")})]}),e.jsxs("div",{className:"result-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"label",children:"Peso Embalagem"}),e.jsxs("span",{className:"value",children:[j.peso_embalagem_kg," kg"]})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"label",children:"PreÃ§o"}),e.jsxs("span",{className:"value",children:["R$ ",j.preco.toFixed(2)]})]})]}),e.jsxs("div",{className:"result-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"â±ï¸"}),e.jsxs("div",{children:[e.jsx("strong",{children:"DuraÃ§Ã£o"}),e.jsxs("p",{children:[j.duracao_dias," dias (",j.duracao_meses," meses)"]})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"ðŸ¥«"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Consumo diÃ¡rio"}),e.jsxs("p",{children:[j.quantidade_diaria_g,"g"]})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"ðŸ’°"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Custo/kg"}),e.jsxs("p",{children:["R$ ",j.custo_por_kg.toFixed(2)]})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"ðŸ“…"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Custo/dia"}),e.jsxs("p",{children:["R$ ",j.custo_por_dia.toFixed(2)]})]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"icon",children:"ðŸ“†"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Custo mensal"}),e.jsxs("p",{children:["R$ ",j.custo_mensal.toFixed(2)]})]})]})]})]}),v.length>0&&e.jsxs("div",{className:"comparativo-card",children:[e.jsxs("h2",{children:["ðŸ† Comparativo de RaÃ§Ãµes (",v.length,")"]}),e.jsx("p",{className:"subtitle",children:"Ordenado por melhor custo-benefÃ­cio (menor custo diÃ¡rio)"}),e.jsx("div",{className:"comparativo-list",children:(()=>{const b=Math.min(...v.map(u=>u.custo_por_dia));return v.map((u,h)=>{const p=l.produto_id&&u.produto_id===parseInt(l.produto_id),k=u.custo_por_dia===b;return e.jsxs("div",{className:`comparativo-item ${k?"melhor":""} ${p?"selecionada":""}`,style:{position:"relative"},children:[p&&e.jsx("span",{className:"badge-selecionada",style:{position:"absolute",left:"10px",top:"10px",zIndex:10,fontSize:"11px",padding:"4px 8px",whiteSpace:"nowrap"},children:"â­ Selecionada"}),k&&e.jsx("span",{className:"badge-melhor",children:"ðŸ† Melhor Custo-BenefÃ­cio"}),e.jsxs("div",{className:"item-header",children:[e.jsxs("div",{children:[e.jsx("h4",{children:u.produto_nome}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginTop:"4px"},children:[u.classificacao&&e.jsx("span",{className:`badge badge-${u.classificacao}`,children:u.classificacao.replace("_"," ")}),e.jsxs("span",{style:{fontSize:"13px",color:"#64748b",backgroundColor:"#f1f5f9",padding:"2px 8px",borderRadius:"4px"},children:["ðŸ½ï¸ ",u.quantidade_diaria_g,"g/dia"]})]})]}),e.jsxs("div",{className:"item-price",children:["R$ ",u.preco.toFixed(2)]})]}),e.jsxs("div",{className:"item-stats",children:[e.jsxs("div",{className:"stat-small",children:[e.jsx("span",{className:"label",children:"Peso"}),e.jsxs("span",{children:[u.peso_embalagem_kg,"kg"]})]}),e.jsxs("div",{className:"stat-small",children:[e.jsx("span",{className:"label",children:"DuraÃ§Ã£o"}),e.jsxs("span",{children:[u.duracao_dias,"d"]})]}),e.jsxs("div",{className:"stat-small highlight",children:[e.jsx("span",{className:"label",children:"Custo/dia"}),e.jsxs("span",{children:["R$ ",u.custo_por_dia.toFixed(2)]})]}),e.jsxs("div",{className:"stat-small",children:[e.jsx("span",{className:"label",children:"Custo/mÃªs"}),e.jsxs("span",{children:["R$ ",u.custo_mensal.toFixed(2)]})]})]}),k&&v.length>1&&e.jsxs("div",{style:{marginTop:"12px",padding:"12px",backgroundColor:"#ecfdf5",borderLeft:"3px solid #10b981",borderRadius:"4px"},children:[e.jsx("p",{style:{margin:"0 0 6px 0",fontSize:"13px",fontWeight:"600",color:"#065f46"},children:"âœ¨ Por que esta Ã© a melhor opÃ§Ã£o?"}),e.jsxs("p",{style:{margin:"0",fontSize:"13px",color:"#047857",lineHeight:"1.5"},children:["Apesar de ",u.classificacao==="premium"||u.classificacao==="super_premium"?`ter um preÃ§o mais alto (R$ ${u.preco.toFixed(2)})`:`custar R$ ${u.preco.toFixed(2)}`,", esta raÃ§Ã£o ",u.classificacao==="super_premium"?"super premium Ã© muito concentrada em nutrientes":u.classificacao==="premium"?"premium tem melhor densidade nutricional":"tem excelente eficiÃªncia alimentar",", entÃ£o seu pet consome apenas ",e.jsxs("strong",{children:[u.quantidade_diaria_g,"g por dia"]}),".",v[1]&&e.jsxs(e.Fragment,{children:[" Em comparaÃ§Ã£o, a segunda opÃ§Ã£o requer ",e.jsxs("strong",{children:[v[1].quantidade_diaria_g,"g/dia"]}),", resultando em um custo diÃ¡rio ",e.jsxs("strong",{children:["R$ ",(v[1].custo_por_dia-u.custo_por_dia).toFixed(2)," maior"]}),"(R$ ",u.custo_por_dia.toFixed(2)," vs R$ ",v[1].custo_por_dia.toFixed(2),")."]})]})]})]},u.produto_id)})})()})]})]})]})]})}const mx=()=>{var te;const a=va(),[t]=Kr(),s=t.get("cliente_id"),[o,r]=n.useState([]),[i,l]=n.useState([]),[x,j]=n.useState(!0),[g,v]=n.useState(""),[d,m]=n.useState(""),[C,y]=n.useState(s||""),[c,f]=n.useState(""),[b,u]=n.useState(""),[h,p]=n.useState(!1);n.useEffect(()=>{k(),N()},[C,c,b]);const k=async()=>{try{j(!0);const D=new URLSearchParams;d&&D.append("busca",d),C&&D.append("cliente_id",C),c&&D.append("especie",c),b&&D.append("ativo",b==="ativo"?"true":"false");const A=await F.get(`/pets?${D.toString()}`);r(A.data),v("")}catch(D){console.error("Erro ao carregar pets:",D),v("Erro ao carregar pets")}finally{j(!1)}},N=async()=>{try{const D=await F.get("/clientes/");l(D.data)}catch(D){console.error("Erro ao carregar clientes:",D)}},w=D=>{D.preventDefault(),k()},S=()=>{m(""),y(""),f(""),u("")},P=D=>{if(!D)return null;const A=new Date,X=new Date(D),re=A.getFullYear()-X.getFullYear(),M=A.getMonth()-X.getMonth();return re===0?`${M} ${M===1?"mÃªs":"meses"}`:`${re} ${re===1?"ano":"anos"}`},W=async D=>{try{D.ativo?await F.delete(`/pets/${D.id}?soft_delete=true`):await F.post(`/pets/${D.id}/ativar`),k()}catch(A){console.error("Erro ao alterar status do pet:",A),alert("Erro ao alterar status do pet")}};return x?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando pets..."})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx($a,{className:"text-blue-600",size:36}),"Gerenciamento de Pets"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:C?`Pets do cliente: ${((te=i.find(D=>D.id===parseInt(C)))==null?void 0:te.nome)||""}`:"GestÃ£o completa dos animais de estimaÃ§Ã£o"})]}),e.jsxs("button",{onClick:()=>a("/pets/novo"),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(as,{size:20}),"Adicionar Pet"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ol,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por nome, raÃ§a, microchip ou cÃ³digo...",value:d,onChange:D=>m(D.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:"Buscar"}),e.jsxs("button",{type:"button",onClick:()=>p(!h),className:"px-4 py-2 border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(Eo,{}),"Filtros"]})]}),h&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cliente (Tutor)"}),e.jsxs("select",{value:C,onChange:D=>y(D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Todos os clientes"}),i.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EspÃ©cie"}),e.jsxs("select",{value:c,onChange:D=>f(D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Todas as espÃ©cies"}),e.jsx("option",{value:"CÃ£o",children:"CÃ£o"}),e.jsx("option",{value:"Gato",children:"Gato"}),e.jsx("option",{value:"Ave",children:"Ave"}),e.jsx("option",{value:"Roedor",children:"Roedor"}),e.jsx("option",{value:"RÃ©ptil",children:"RÃ©ptil"}),e.jsx("option",{value:"Outro",children:"Outro"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:b,onChange:D=>u(D.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"ativo",children:"Ativos"}),e.jsx("option",{value:"inativo",children:"Inativos"})]})]}),e.jsx("div",{className:"col-span-3 flex justify-end",children:e.jsxs("button",{type:"button",onClick:S,className:"px-4 py-2 text-gray-600 hover:text-gray-900 flex items-center gap-2",children:[e.jsx(ks,{}),"Limpar filtros"]})})]})]})}),g&&e.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(Ca,{}),g]}),o.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx($a,{className:"mx-auto text-gray-300 mb-4",size:64}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Nenhum pet encontrado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:d||C||c||b?"Tente ajustar os filtros ou fazer uma nova busca":"Comece adicionando o primeiro pet"}),e.jsxs("button",{onClick:()=>a("/pets/novo"),className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(as,{}),"Adicionar Primeiro Pet"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(D=>e.jsx("div",{className:`bg-white rounded-lg shadow-sm border-2 transition-all hover:shadow-md ${D.ativo?"border-gray-200":"border-red-200 bg-gray-50"}`,children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:D.nome}),D.ativo?e.jsx(qs,{className:"text-green-500",size:16}):e.jsx(go,{className:"text-red-500",size:16})]}),e.jsx("p",{className:"text-sm text-gray-500",children:D.codigo})]}),D.foto_url&&e.jsx("img",{src:D.foto_url,alt:D.nome,className:"w-16 h-16 rounded-full object-cover border-2 border-gray-200"})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"EspÃ©cie:"}),e.jsx("span",{className:"text-gray-900",children:D.especie})]}),D.raca&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"RaÃ§a:"}),e.jsx("span",{className:"text-gray-900",children:D.raca})]}),D.sexo&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Sexo:"}),e.jsx("span",{className:"text-gray-900",children:D.sexo})]}),D.data_nascimento&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Idade:"}),e.jsx("span",{className:"text-gray-900",children:P(D.data_nascimento)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm pt-2 border-t border-gray-100",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Tutor:"}),e.jsx("span",{className:"text-blue-600",children:D.cliente_nome})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>a(`/pets/${D.id}`),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium",children:[e.jsx(Dr,{size:16}),"Ver Detalhes"]}),e.jsx("button",{onClick:()=>a(`/pets/${D.id}/editar`),className:"px-3 py-2 border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors",title:"Editar",children:e.jsx(Ts,{size:16,className:"text-gray-600"})}),e.jsx("button",{onClick:()=>W(D),className:`px-3 py-2 border rounded-lg transition-colors ${D.ativo?"border-red-300 hover:bg-red-50 text-red-600":"border-green-300 hover:bg-green-50 text-green-600"}`,title:D.ativo?"Desativar":"Reativar",children:D.ativo?e.jsx(go,{size:16}):e.jsx(qs,{size:16})})]})]})},D.id))}),o.length>0&&e.jsxs("div",{className:"mt-6 text-center text-sm text-gray-600",children:["Total: ",e.jsx("strong",{children:o.length})," pet(s) encontrado(s)",b===""&&e.jsxs(e.Fragment,{children:[" â€¢ ",e.jsx("strong",{className:"text-green-600",children:o.filter(D=>D.ativo).length})," ativo(s)"," â€¢ ",e.jsx("strong",{className:"text-red-600",children:o.filter(D=>!D.ativo).length})," inativo(s)"]})]})]})};function ux(a){if(!a)return null;const t=typeof a=="string"?new Date(a):a,s=new Date,o=s.getFullYear()-t.getFullYear(),r=s.getMonth()-t.getMonth();return o*12+r}function Bt(a){if(!a)return"-";const t=Math.floor(a/12),s=a%12;return t===0?`${a} ${a===1?"mÃªs":"meses"}`:s===0?`${t} ${t===1?"ano":"anos"}`:`${t} ${t===1?"ano":"anos"} e ${s} ${s===1?"mÃªs":"meses"}`}function px(a){if(!a)return null;const t=a.toString().toLowerCase().trim();if(/^\d+$/.test(t))return parseInt(t);const s=/(\d+(?:[.,]\d+)?)\s*anos?\s*(?:e\s*)?(\d+)?\s*meses?/i,o=t.match(s);if(o){const j=parseFloat(o[1].replace(",",".")),g=o[2]?parseInt(o[2]):0;return Math.round(j*12)+g}const r=/(\d+(?:[.,]\d+)?)\s*anos?/i,i=t.match(r);if(i){const j=parseFloat(i[1].replace(",","."));return Math.round(j*12)}const l=/(\d+)\s*meses?/i,x=t.match(l);return x?parseInt(x[1]):null}const gx=()=>{const{petId:a}=lt(),t=va(),[s,o]=n.useState(null),[r,i]=n.useState(!0),[l,x]=n.useState(""),[j,g]=n.useState("geral");n.useEffect(()=>{v()},[a]);const v=async()=>{try{i(!0);const c=await F.get(`/pets/${a}`);o(c.data),x("")}catch(c){console.error("Erro ao carregar pet:",c),x("Erro ao carregar informaÃ§Ãµes do pet")}finally{i(!1)}},d=c=>{if(!c)return null;const f=new Date,b=new Date(c),u=f.getFullYear()-b.getFullYear(),h=f.getMonth()-b.getMonth();return u===0?`${h} ${h===1?"mÃªs":"meses"}`:h<0?`${u-1} anos e ${12+h} meses`:h===0?`${u} ${u===1?"ano":"anos"}`:`${u} anos e ${h} ${h===1?"mÃªs":"meses"}`},m=c=>c?new Date(c).toLocaleDateString("pt-BR"):"-",C=async()=>{try{s.ativo?await F.delete(`/pets/${s.id}?soft_delete=true`):await F.post(`/pets/${s.id}/ativar`),v()}catch(c){console.error("Erro ao alterar status do pet:",c),alert("Erro ao alterar status do pet")}};if(r)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando..."})]})});if(l||!s)return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(Ca,{}),l||"Pet nÃ£o encontrado"]}),e.jsxs("button",{onClick:()=>t("/pets"),className:"mt-4 flex items-center gap-2 text-blue-600 hover:text-blue-700",children:[e.jsx(wt,{}),"Voltar para lista de pets"]})]});const y=[{id:"geral",label:"Dados Gerais",icon:yi},{id:"saude",label:"SaÃºde",icon:So},{id:"vacinas",label:"Vacinas",icon:ln},{id:"consultas",label:"Consultas",icon:ps},{id:"servicos",label:"ServiÃ§os",icon:$a}];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>t("/pets"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(wt,{}),"Voltar para Gerenciamento de Pets"]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[s.foto_url?e.jsx("img",{src:s.foto_url,alt:s.nome,className:"w-24 h-24 rounded-full object-cover border-4 border-gray-200"}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-blue-100 flex items-center justify-center border-4 border-gray-200",children:e.jsx($a,{className:"text-blue-600",size:48})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s.nome}),s.ativo?e.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium flex items-center gap-1",children:[e.jsx(qs,{size:14}),"Ativo"]}):e.jsxs("span",{className:"px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-medium flex items-center gap-1",children:[e.jsx(go,{size:14}),"Inativo"]})]}),e.jsxs("p",{className:"text-gray-500 mb-1",children:[s.especie," ",s.raca&&`â€¢ ${s.raca}`," ",s.sexo&&`â€¢ ${s.sexo}`]}),e.jsx("p",{className:"text-sm text-gray-400",children:s.codigo}),e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(vs,{size:16}),e.jsx("span",{className:"font-medium",children:"Tutor:"}),e.jsx("span",{className:"text-blue-600",children:s.cliente_nome})]}),s.cliente_celular&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(nl,{size:16}),e.jsx("span",{children:s.cliente_celular})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>t(`/pets/${s.id}/editar`),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(Ts,{}),"Editar"]}),e.jsx("button",{onClick:C,className:`px-4 py-2 border-2 rounded-lg transition-colors font-medium ${s.ativo?"border-red-300 text-red-600 hover:bg-red-50":"border-green-300 text-green-600 hover:bg-green-50"}`,children:s.ativo?"Desativar":"Reativar"})]})]})})]}),e.jsx("div",{className:"mb-6 border-b border-gray-200",children:e.jsx("div",{className:"flex gap-4",children:y.map(c=>{const f=c.icon;return e.jsxs("button",{onClick:()=>g(c.id),className:`flex items-center gap-2 px-4 py-3 font-medium border-b-2 transition-colors ${j===c.id?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[e.jsx(f,{size:18}),c.label]},c.id)})})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[j==="geral"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"InformaÃ§Ãµes Gerais"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("p",{className:"text-gray-900 font-medium",children:s.nome})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CÃ³digo"}),e.jsx("p",{className:"text-gray-900 font-mono text-sm",children:s.codigo})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EspÃ©cie"}),e.jsx("p",{className:"text-gray-900",children:s.especie})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"RaÃ§a"}),e.jsx("p",{className:"text-gray-900",children:s.raca||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sexo"}),e.jsx("p",{className:"text-gray-900",children:s.sexo||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Castrado"}),e.jsx("p",{className:"text-gray-900",children:s.castrado?"Sim":"NÃ£o"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Nascimento"}),e.jsx("p",{className:"text-gray-900",children:m(s.data_nascimento)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Idade"}),e.jsx("p",{className:"text-gray-900",children:s.idade_meses?Bt(s.idade_meses):s.idade_aproximada?Bt(s.idade_aproximada):s.data_nascimento?d(s.data_nascimento):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Peso"}),e.jsx("p",{className:"text-gray-900",children:s.peso?`${s.peso} kg`:"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Porte"}),e.jsx("p",{className:"text-gray-900",children:s.porte||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor/Pelagem"}),e.jsx("p",{className:"text-gray-900",children:s.cor||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Microchip"}),e.jsx("p",{className:"text-gray-900 font-mono text-sm",children:s.microchip||"-"})]})]}),s.observacoes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ObservaÃ§Ãµes"}),e.jsx("p",{className:"text-gray-900 bg-gray-50 p-3 rounded-lg",children:s.observacoes})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 text-sm text-gray-500",children:[e.jsxs("p",{children:["Cadastrado em: ",m(s.created_at)]}),e.jsxs("p",{children:["Ãšltima atualizaÃ§Ã£o: ",m(s.updated_at)]})]})]}),j==="saude"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"InformaÃ§Ãµes de SaÃºde"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Alergias"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-900",children:s.alergias||"Nenhuma alergia registrada"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"DoenÃ§as CrÃ´nicas"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-900",children:s.doencas_cronicas||"Nenhuma doenÃ§a crÃ´nica registrada"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Medicamentos ContÃ­nuos"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-900",children:s.medicamentos_continuos||"Nenhum medicamento contÃ­nuo registrado"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"HistÃ³rico ClÃ­nico"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-900 whitespace-pre-line",children:s.historico_clinico||"Nenhum histÃ³rico clÃ­nico registrado"})})]})]})]}),j==="vacinas"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Carteira de VacinaÃ§Ã£o"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium",children:"+ Registrar Vacina"})]}),e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(ln,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"MÃ³dulo em desenvolvimento"}),e.jsx("p",{className:"text-sm",children:"Em breve vocÃª poderÃ¡ gerenciar o histÃ³rico de vacinas do pet"})]})]}),j==="consultas"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"HistÃ³rico de Consultas"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium",children:"+ Nova Consulta"})]}),e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(ps,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"MÃ³dulo em desenvolvimento"}),e.jsx("p",{className:"text-sm",children:"Em breve vocÃª poderÃ¡ gerenciar consultas veterinÃ¡rias"})]})]}),j==="servicos"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"HistÃ³rico de ServiÃ§os"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium",children:"+ Registrar ServiÃ§o"})]}),e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx($a,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"MÃ³dulo em desenvolvimento"}),e.jsx("p",{className:"text-sm",children:"Em breve vocÃª poderÃ¡ gerenciar banho, tosa e outros serviÃ§os"})]})]})]})]})};function hx({value:a,onChange:t,name:s="idade",label:o="Idade",className:r="",mostrarDataNascimento:i=!0,required:l=!1}){const[x,j]=n.useState("texto"),[g,v]=n.useState(""),[d,m]=n.useState(""),[C,y]=n.useState("");n.useEffect(()=>{a&&typeof a=="number"&&v(Bt(a))},[a]);const c=h=>{const p=h.target.value;v(p),p||(y(""),t(null))},f=()=>{if(!g){y(""),t(null);return}const h=px(g);if(h!==null){const p=Bt(h);v(p),y(`âœ“ ${p}`),t(h)}else y("âš ï¸ Formato invÃ¡lido. Ex: 12 meses, 2 anos, 1.5 anos"),t(null)},b=h=>{const p=h.target.value;if(m(p),!p){y(""),t(null);return}const k=ux(p);k!==null?(y(`âœ“ ${Bt(k)}`),t(k)):(y("âš ï¸ Data invÃ¡lida"),t(null))},u=()=>{j(x==="texto"?"data":"texto"),v(""),m(""),y(""),t(null)};return e.jsxs("div",{className:r,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[o,l&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),i&&e.jsx("button",{type:"button",onClick:u,className:"text-xs text-blue-600 hover:text-blue-800 underline",children:x==="texto"?"ðŸ“… Usar data de nascimento":"âŒ¨ï¸ Digitar idade"})]}),x==="texto"?e.jsxs("div",{children:[e.jsx("input",{type:"text",name:s,value:g,onChange:c,onBlur:f,placeholder:"Ex: 12 meses, 2 anos, 1.5 anos, 2anos6meses",className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:l}),C&&e.jsx("p",{className:`text-xs mt-1 ${C.startsWith("âœ“")?"text-green-600":"text-orange-600"}`,children:C}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Digite a idade e pressione Tab ou clique fora do campo"})]}):e.jsxs("div",{children:[e.jsx("input",{type:"date",name:s,value:d,onChange:b,max:new Date().toISOString().split("T")[0],className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:l}),C&&e.jsx("p",{className:`text-xs mt-1 ${C.startsWith("âœ“")?"text-green-600":"text-orange-600"}`,children:C}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Data de nascimento do pet"})]})]})}const bx=({tipo:a,especieId:t,especieNome:s,onSuccess:o,onClose:r})=>{const[i,l]=n.useState(""),[x,j]=n.useState(!1),[g,v]=n.useState(""),d=async m=>{var C,y;if(m.preventDefault(),v(""),!i||i.trim()===""){v(`O nome ${a==="especie"?"da espÃ©cie":"da raÃ§a"} Ã© obrigatÃ³rio`);return}try{j(!0);let c;if(a==="especie")c=await F.post("/cadastros/especies",{nome:i.trim(),ativo:!0});else{if(!t){v("Selecione uma espÃ©cie primeiro");return}c=await F.post("/cadastros/racas",{nome:i.trim(),especie_id:t,ativo:!0})}o&&o(c.data),r()}catch(c){console.error("Erro ao salvar:",c),v(((y=(C=c.response)==null?void 0:C.data)==null?void 0:y.detail)||"Erro ao salvar")}finally{j(!1)}};return e.jsx("div",{className:"quick-modal-overlay",onClick:r,children:e.jsxs("div",{className:"quick-modal-content",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"quick-modal-header",children:[e.jsxs("h3",{children:[a==="especie"?"ðŸ¾ Nova EspÃ©cie":"âœ¨ Nova RaÃ§a",a==="raca"&&s&&e.jsxs("span",{className:"quick-subtitle",children:[" - ",s]})]}),e.jsx("button",{className:"quick-btn-close",onClick:r,children:e.jsx(ks,{})})]}),e.jsxs("form",{onSubmit:d,children:[e.jsxs("div",{className:"quick-modal-body",children:[g&&e.jsxs("div",{className:"quick-alert quick-alert-danger",children:[e.jsx(Ca,{})," ",g]}),e.jsxs("div",{className:"quick-form-group",children:[e.jsxs("label",{children:["Nome ",a==="especie"?"da EspÃ©cie":"da RaÃ§a"," *"]}),e.jsx("input",{type:"text",value:i,onChange:m=>l(m.target.value),placeholder:a==="especie"?"Ex: CÃ£o, Gato, Ave...":"Ex: Labrador, SRD, SiamÃªs...",required:!0,autoFocus:!0,disabled:x})]}),e.jsx("div",{className:"quick-info",children:e.jsxs("p",{children:["ðŸ’¡ ",a==="especie"?"Esta espÃ©cie ficarÃ¡ disponÃ­vel para todos os pets":`Esta raÃ§a serÃ¡ adicionada Ã  espÃ©cie "${s}"`]})})]}),e.jsxs("div",{className:"quick-modal-footer",children:[e.jsx("button",{type:"button",className:"quick-btn quick-btn-secondary",onClick:r,disabled:x,children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"quick-btn quick-btn-primary",disabled:x,children:[e.jsx(st,{})," ",x?"Salvando...":"Salvar"]})]})]})]})})},Ln=()=>{var J,E;const{petId:a}=lt(),t=va(),s=Co(),o=!!a,r=(J=s.state)==null?void 0:J.clienteId,[i,l]=n.useState(!1),[x,j]=n.useState(!1),[g,v]=n.useState(""),[d,m]=n.useState(""),[C,y]=n.useState([]),[c,f]=n.useState([]),[b,u]=n.useState([]),[h,p]=n.useState(!1),[k,N]=n.useState(null),[w,S]=n.useState({cliente_id:r||"",nome:"",especie:"",raca:"",sexo:"",castrado:!1,data_nascimento:"",idade_aproximada:"",peso:"",cor:"",porte:"",microchip:"",alergias:"",doencas_cronicas:"",medicamentos_continuos:"",historico_clinico:"",observacoes:"",foto_url:"",ativo:!0});n.useEffect(()=>{(async()=>{await P(),await W(),o&&await D()})()},[a]),n.useEffect(()=>{w.especie?te(w.especie):u([])},[w.especie]);const P=async()=>{try{const R=await F.get("/clientes/");y(R.data)}catch(R){console.error("Erro ao carregar clientes:",R)}},W=async()=>{try{const R=await F.get("/cadastros/especies",{params:{ativo:!0}});f(R.data)}catch(R){console.error("Erro ao carregar espÃ©cies:",R)}},te=async R=>{try{const K=await F.get("/cadastros/racas",{params:{ativo:!0,especie_id:R}});u(K.data)}catch(K){console.error("Erro ao carregar raÃ§as:",K),u([])}},D=async()=>{try{l(!0);const K=(await F.get(`/pets/${a}`)).data,B=c.find(_=>_.nome===K.especie);S({cliente_id:K.cliente_id||"",nome:K.nome||"",especie:B?B.id.toString():"",raca:K.raca||"",sexo:K.sexo||"",castrado:K.castrado||!1,data_nascimento:"",idade_aproximada:K.idade_meses||K.idade_aproximada||"",peso:K.peso||"",cor:K.cor||"",porte:K.porte||"",microchip:K.microchip||"",alergias:K.alergias||"",doencas_cronicas:K.doencas_cronicas||"",medicamentos_continuos:K.medicamentos_continuos||"",historico_clinico:K.historico_clinico||"",observacoes:K.observacoes||"",foto_url:K.foto_url||"",ativo:K.ativo!==void 0?K.ativo:!0})}catch(R){console.error("Erro ao carregar pet:",R),v("Erro ao carregar informaÃ§Ãµes do pet")}finally{l(!1)}},A=R=>{const{name:K,value:B,type:_,checked:O}=R.target;S(q=>({...q,[K]:_==="checkbox"?O:B}))},X=R=>{N(R),p(!0)},re=()=>{p(!1),N(null)},M=R=>{k==="especie"?W().then(()=>{S(K=>({...K,especie:R.id.toString()}))}):k==="raca"&&w.especie&&te(w.especie).then(()=>{S(K=>({...K,raca:R.nome}))})},Z=()=>w.nome.trim()?w.especie?w.cliente_id?!0:(v("Cliente (tutor) Ã© obrigatÃ³rio"),!1):(v("EspÃ©cie Ã© obrigatÃ³ria"),!1):(v("Nome do pet Ã© obrigatÃ³rio"),!1),$=async R=>{var K,B;if(R.preventDefault(),v(""),m(""),!!Z())try{j(!0);const _=c.find(q=>q.id===parseInt(w.especie)),O={...w,especie:(_==null?void 0:_.nome)||w.especie,cliente_id:parseInt(w.cliente_id),peso:w.peso?parseFloat(w.peso):null,idade_aproximada:w.idade_aproximada?parseInt(w.idade_aproximada):null,data_nascimento:w.data_nascimento||null};if(o)await F.put(`/pets/${a}`,O),m("Pet atualizado com sucesso!"),setTimeout(()=>t(`/pets/${a}`),1500);else{const q=await F.post("/pets",O);m("Pet cadastrado com sucesso!"),setTimeout(()=>t(`/pets/${q.data.id}`),1500)}}catch(_){console.error("Erro ao salvar pet:",_),v(((B=(K=_.response)==null?void 0:K.data)==null?void 0:B.detail)||"Erro ao salvar pet")}finally{j(!1)}};return i?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando..."})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>t(o?`/pets/${a}`:"/pets"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(wt,{}),o?"Voltar para detalhes do pet":"Voltar para lista de pets"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx($a,{className:"text-blue-600",size:36}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:o?"Editar Pet":"Cadastrar Novo Pet"})]}),e.jsx("p",{className:"text-gray-600",children:o?"Atualize as informaÃ§Ãµes do pet":"Preencha os dados do animal de estimaÃ§Ã£o"})]}),g&&e.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(Ca,{}),g]}),d&&e.jsxs("div",{className:"mb-6 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(qs,{}),d]}),r&&e.jsxs("div",{className:"mb-6 bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(qs,{}),e.jsx("span",{children:"âœ… Tutor prÃ©-selecionado automaticamente! VocÃª pode alterar se necessÃ¡rio."})]}),e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Dados BÃ¡sicos"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cliente (Tutor) *"}),e.jsxs("select",{name:"cliente_id",value:w.cliente_id,onChange:A,required:!0,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none ${r?"border-blue-400 bg-blue-50":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione o tutor..."}),C.map(R=>e.jsxs("option",{value:R.id,children:[R.nome," ",R.cpf&&`- CPF: ${R.cpf}`]},R.id))]}),r&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"ðŸŽ¯ Tutor selecionado automaticamente"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Pet *"}),e.jsx("input",{type:"text",name:"nome",value:w.nome,onChange:A,required:!0,placeholder:"Ex: Rex, Miau, TotÃ³",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EspÃ©cie *"}),e.jsxs("div",{className:"field-with-action",children:[e.jsxs("select",{name:"especie",value:w.especie,onChange:A,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Selecione..."}),c.map(R=>e.jsx("option",{value:R.id,children:R.nome},R.id))]}),e.jsxs("button",{type:"button",className:"btn-add-quick",onClick:()=>X("especie"),title:"Adicionar nova espÃ©cie",children:[e.jsx(as,{})," Nova"]})]}),c.length===0&&e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"Nenhuma espÃ©cie cadastrada. Cadastre em Cadastros â†’ EspÃ©cies e RaÃ§as."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"RaÃ§a"}),e.jsxs("div",{className:"field-with-action",children:[e.jsxs("select",{name:"raca",value:w.raca,onChange:A,disabled:!w.especie,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:w.especie?"Selecione uma raÃ§a...":"Selecione uma espÃ©cie primeiro"}),b.map(R=>e.jsx("option",{value:R.nome,children:R.nome},R.id))]}),e.jsxs("button",{type:"button",className:"btn-add-quick",onClick:()=>X("raca"),title:"Adicionar nova raÃ§a",disabled:!w.especie,children:[e.jsx(as,{})," Nova"]})]}),w.especie&&b.length===0&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["Nenhuma raÃ§a cadastrada para ",w.especie,". Cadastre em Cadastros â†’ EspÃ©cies e RaÃ§as."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sexo"}),e.jsxs("select",{name:"sexo",value:w.sexo,onChange:A,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Macho",children:"Macho"}),e.jsx("option",{value:"FÃªmea",children:"FÃªmea"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",name:"castrado",id:"castrado",checked:w.castrado,onChange:A,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"castrado",className:"text-sm font-medium text-gray-700",children:"Pet castrado"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"CaracterÃ­sticas FÃ­sicas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(hx,{value:w.idade_aproximada,onChange:R=>S(K=>({...K,idade_aproximada:R,data_nascimento:""})),name:"idade_aproximada",label:"Idade do Pet",mostrarDataNascimento:!0,className:"col-span-2"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Peso (kg)"}),e.jsx("input",{type:"number",name:"peso",value:w.peso,onChange:A,step:"0.1",min:"0",placeholder:"Ex: 5.5",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Porte"}),e.jsxs("select",{name:"porte",value:w.porte,onChange:A,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Mini",children:"Mini"}),e.jsx("option",{value:"Pequeno",children:"Pequeno"}),e.jsx("option",{value:"MÃ©dio",children:"MÃ©dio"}),e.jsx("option",{value:"Grande",children:"Grande"}),e.jsx("option",{value:"Gigante",children:"Gigante"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor/Pelagem"}),e.jsx("input",{type:"text",name:"cor",value:w.cor,onChange:A,placeholder:"Ex: Preto, Branco, Caramelo",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Microchip"}),e.jsx("input",{type:"text",name:"microchip",value:w.microchip,onChange:A,placeholder:"NÃºmero do microchip",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none font-mono text-sm"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL da Foto"}),e.jsx("input",{type:"url",name:"foto_url",value:w.foto_url,onChange:A,placeholder:"https://exemplo.com/foto-do-pet.jpg",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"InformaÃ§Ãµes de SaÃºde"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alergias"}),e.jsx("textarea",{name:"alergias",value:w.alergias,onChange:A,rows:"3",placeholder:"Descreva alergias conhecidas (alimentares, medicamentos, etc)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DoenÃ§as CrÃ´nicas"}),e.jsx("textarea",{name:"doencas_cronicas",value:w.doencas_cronicas,onChange:A,rows:"3",placeholder:"Descreva doenÃ§as crÃ´nicas diagnosticadas",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Medicamentos ContÃ­nuos"}),e.jsx("textarea",{name:"medicamentos_continuos",value:w.medicamentos_continuos,onChange:A,rows:"3",placeholder:"Liste medicamentos de uso contÃ­nuo com dosagem",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"HistÃ³rico ClÃ­nico"}),e.jsx("textarea",{name:"historico_clinico",value:w.historico_clinico,onChange:A,rows:"4",placeholder:"Descreva o histÃ³rico clÃ­nico do pet (cirurgias, tratamentos anteriores, etc)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"ObservaÃ§Ãµes Adicionais"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ObservaÃ§Ãµes Gerais"}),e.jsx("textarea",{name:"observacoes",value:w.observacoes,onChange:A,rows:"4",placeholder:"InformaÃ§Ãµes adicionais, comportamento, preferÃªncias, etc",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),o&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",name:"ativo",id:"ativo",checked:w.ativo,onChange:A,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"ativo",className:"text-sm font-medium text-gray-700",children:"Pet ativo no sistema"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{type:"submit",disabled:x,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(st,{}),o?"Salvar AlteraÃ§Ãµes":"Cadastrar Pet"]})}),e.jsx("button",{type:"button",onClick:()=>t(o?`/pets/${a}`:"/pets"),disabled:x,className:"px-6 py-3 border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors font-medium disabled:opacity-50",children:"Cancelar"})]})]}),h&&e.jsx(bx,{tipo:k,especieId:k==="raca"?parseInt(w.especie):null,especieNome:k==="raca"?(E=c.find(R=>R.id===parseInt(w.especie)))==null?void 0:E.nome:null,onSuccess:M,onClose:re})]})},Tn=async(a={})=>(await F.get("/vendas",{params:a})).data,wr=async a=>(await F.get(`/vendas/${a}`)).data,Kl=async a=>(await F.post("/vendas",a)).data,fx=async(a,t)=>(await F.post(`/vendas/${a}/finalizar`,{pagamentos:t})).data,jx=async(a={})=>{const t=await F.get("/clientes/",{params:a});return t.data.items||t.data.clientes||t.data||[]},It=async a=>(await F.get(`/clientes/${a}`)).data,vx=({status:a,className:t=""})=>{if(!a)return null;const s={verde:{cor:"bg-green-500",borda:"border-green-500",texto:"text-green-700",fundo:"bg-green-50",icone:"âœ…",mensagem:"Margem SaudÃ¡vel",descricao:"Venda em condiÃ§Ãµes ideais"},amarelo:{cor:"bg-yellow-500",borda:"border-yellow-500",texto:"text-yellow-700",fundo:"bg-yellow-50",icone:"âš ï¸",mensagem:"Margem em Alerta",descricao:"AtenÃ§Ã£o com parcelamento e descontos"},vermelho:{cor:"bg-red-500",borda:"border-red-500",texto:"text-red-700",fundo:"bg-red-50",icone:"ðŸ”´",mensagem:"Margem CrÃ­tica",descricao:"Evite mais descontos ou parcelamentos longos"}},o=s[a]||s.verde;return e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg border ${o.borda} ${o.fundo} ${t}`,children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${o.cor} animate-pulse`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`text-sm font-semibold ${o.texto}`,children:[o.icone," ",o.mensagem]}),e.jsx("div",{className:"text-xs text-gray-600",children:o.descricao})]})]})},yx=["Visa","Mastercard","Elo","American Express","Hipercard","Outros"];function Nx({venda:a,onClose:t,onConfirmar:s,onVendaAtualizada:o,onAnalisarVenda:r}){var da;const[i,l]=n.useState([]),[x,j]=n.useState([]),[g,v]=n.useState([]),[d,m]=n.useState([]),[C,y]=n.useState(null),[c,f]=n.useState(null),[b,u]=n.useState(""),[h,p]=n.useState(""),[k,N]=n.useState(1),[w,S]=n.useState(""),[P,W]=n.useState(!1),[te,D]=n.useState(!1),[A,X]=n.useState(""),[re,M]=n.useState(0),[Z,$]=n.useState(!1),[J,E]=n.useState(null),[R,K]=n.useState(null),[B,_]=n.useState(!1),[O,q]=n.useState(""),[ae,H]=n.useState(""),[le,G]=n.useState({}),[ee,de]=n.useState(!1),[ue,Ae]=n.useState(null),se=n.useRef(null);n.useEffect(()=>{(async()=>{try{const Ne=await F.get("/financeiro/formas-pagamento");v(Ne.data)}catch(Ne){console.error("Erro ao carregar formas:",Ne)}})()},[]),n.useEffect(()=>{(async()=>{try{const Ne=await F.get("/operadoras-cartao?apenas_ativas=true");m(Ne.data);const ke=Ne.data.find(Ue=>Ue.padrao);ke&&y(ke)}catch(Ne){console.error("Erro ao carregar operadoras:",Ne)}})()},[]),n.useEffect(()=>{(async()=>{var Ne;if(a.id){D(!0);try{const ke=await F.get(`/vendas/${a.id}/pagamentos`);j(ke.data.pagamentos||[]),M(ke.data.total_pago||0)}catch(ke){console.error("Erro ao buscar pagamentos:",ke),((Ne=ke.response)==null?void 0:Ne.status)!==404&&X("Erro ao carregar pagamentos existentes")}finally{D(!1)}}})()},[a.id,a.status]),n.useEffect(()=>{c!=null&&c.permite_parcelamento&&se.current&&setTimeout(()=>{var oe;(oe=se.current)==null||oe.scrollIntoView({behavior:"smooth",block:"nearest"})},100)},[c==null?void 0:c.permite_parcelamento]);const we=a.total,Se=i.reduce((oe,Ne)=>oe+Ne.valor,0)+re,ea=we-Se,Ie=w?parseFloat(w)-ea:0,Je=async()=>{var oe,Ne,ke;_(!0);try{const Ue=[{forma_pagamento_id:1,valor:a.total,parcelas:1}],ze=(a.itens||[]).map(ve=>({produto_id:ve.produto_id,quantidade:ve.quantidade,preco_venda:ve.preco_unitario||ve.preco_venda||0,custo:ve.custo||null})),Y=await F.post("/formas-pagamento/analisar-venda",{items:ze,formas_pagamento:Ue,desconto:a.desconto_valor||0,taxa_entrega:((oe=a.entrega)==null?void 0:oe.taxa_entrega_total)||0});(ke=(Ne=Y.data)==null?void 0:Ne.resultado)!=null&&ke.cor_indicador&&(K(Y.data.resultado.cor_indicador),console.log("âœ… Status inicial calculado:",Y.data.resultado.cor_indicador))}catch(Ue){console.error("âŒ Erro ao calcular status inicial:",Ue),K(null)}finally{_(!1)}},be=async()=>{var oe,Ne,ke;if(!(i.length===0&&x.length===0)){_(!0);try{const Ue=[...x,...i],ze=(a.itens||[]).map(ve=>({produto_id:ve.produto_id,quantidade:ve.quantidade,preco_venda:ve.preco_unitario||ve.preco_venda||0,custo:ve.custo||null})),Y=await F.post("/formas-pagamento/analisar-venda",{items:ze,formas_pagamento:Ue,desconto:a.desconto_valor||0,taxa_entrega:((oe=a.entrega)==null?void 0:oe.taxa_entrega_total)||0});(ke=(Ne=Y.data)==null?void 0:Ne.resultado)!=null&&ke.cor_indicador&&K(Y.data.resultado.cor_indicador)}catch(Ue){console.error("Erro ao calcular status de margem:",Ue),K(null)}finally{_(!1)}}};n.useEffect(()=>{const oe=setTimeout(()=>{be()},500);return()=>clearTimeout(oe)},[i,k]),n.useEffect(()=>{console.log("ðŸŽ¬ Modal de pagamento aberto - Calculando status inicial..."),Je()},[]),n.useEffect(()=>{if(g&&g.length>0){const oe=g.filter(Ne=>Ne.permite_parcelamento);oe.length>0&&Object.keys(le).length===0&&(console.log("ðŸ“Š Simulando parcelamentos ao carregar formas..."),Fe(oe[0]))}},[g]);const Fe=async oe=>{var Ue,ze,Y;if(!oe||!oe.permite_parcelamento){console.log("â­ï¸ Forma de pagamento invÃ¡lida ou nÃ£o permite parcelamento");return}const Ne=(oe==null?void 0:oe.parcelas_maximas)??12,ke=oe.id;console.log(`ðŸŽ² Simulando parcelamentos para ${oe.nome} (atÃ© ${Ne}x)...`),de(!0);try{const ve={},Le=(a.itens||[]).map(Q=>({produto_id:Q.produto_id,quantidade:Q.quantidade,preco_venda:Q.preco_unitario||Q.preco_venda||0,custo:Q.custo||null}));for(let Q=1;Q<=Ne;Q++){const fe=[{forma_pagamento_id:ke,valor:a.total,parcelas:Q}];try{const U=await F.post("/formas-pagamento/analisar-venda",{items:Le,formas_pagamento:fe,desconto:a.desconto_valor||0,taxa_entrega:((Ue=a.entrega)==null?void 0:Ue.taxa_entrega_total)||0});(Y=(ze=U.data)==null?void 0:ze.resultado)!=null&&Y.cor_indicador&&(ve[Q]={cor:U.data.resultado.cor_indicador,classificacao:U.data.resultado.cor_indicador})}catch(U){console.error(`Erro ao simular ${Q}x:`,U),ve[Q]={cor:null,classificacao:"verde"}}}G(Q=>({...Q,[ke]:ve}));const I=he(ve,Ne);Ae(I),console.log("âœ… SimulaÃ§Ãµes concluÃ­das:",ve),console.log("ðŸ“Š Faixas calculadas:",I)}catch(ve){console.error("âŒ Erro ao simular parcelamentos:",ve)}finally{de(!1)}},he=(oe,Ne)=>{const ke={saudavel:{min:1,max:0},alerta:{min:0,max:0},proibido:{min:0,max:Ne}};let Ue=0,ze=Ne+1;for(let Y=1;Y<=Ne;Y++){const ve=oe[Y];ve&&(ve.cor==="verde"?Ue=Y:ve.cor==="vermelho"&&Y<ze&&(ze=Y))}return ke.saudavel.max=Ue,ke.alerta.min=Ue+1,ke.alerta.max=ze-1,ke.proibido.min=ze,ke};n.useEffect(()=>{if(c!=null&&c.permite_parcelamento)if(!le[c.id])Fe(c);else{const oe=le[c.id],Ne=he(oe,(c==null?void 0:c.parcelas_maximas)??12);Ae(Ne),console.log("â™»ï¸ Reutilizando simulaÃ§Ã£o existente")}else if(!c){const oe=Object.keys(le)[0];if(oe&&g.length>0){const Ne=g.find(ke=>ke.id===parseInt(oe));if(Ne){const ke=he(le[oe],(Ne==null?void 0:Ne.parcelas_maximas)??12);Ae(ke)}}}},[c==null?void 0:c.id]);const Qe=()=>{var ze;if(!c){X("Selecione uma forma de pagamento");return}const oe=parseFloat(w)||0;if(oe<=0){X("Informe o valor recebido");return}if(c.id==="credito_cliente"&&oe>c.credito_disponivel){X(`Valor excede o crÃ©dito disponÃ­vel (R$ ${c.credito_disponivel.toFixed(2)})`);return}if(["cartao_credito","cartao_debito"].includes(c.tipo)&&!b){X("Selecione a bandeira do cartÃ£o");return}if(["cartao_credito","cartao_debito"].includes(c.tipo)&&!C){X("Selecione a operadora do cartÃ£o");return}if(C&&k>C.max_parcelas){X(`A operadora ${C.nome} permite no mÃ¡ximo ${C.max_parcelas}x`);return}console.log("ðŸ” DEBUG formaPagamentoSelecionada:",c);const Ne={forma_pagamento:c.nome,forma_id:c.id,forma_pagamento_id:c.id,nome:c.nome,valor:Math.min(oe,ea),bandeira:["cartao_credito","cartao_debito"].includes(c.tipo)?b:null,nsu_cartao:["cartao_credito","cartao_debito"].includes(c.tipo)&&h?h:null,operadora_id:(C==null?void 0:C.id)||null,numero_parcelas:c.permite_parcelamento?k:1,parcelas:c.permite_parcelamento?k:1,valor_recebido:oe,troco:c.tipo==="dinheiro"&&Ie>0?Ie:null,is_credito_cliente:c.nome==="CrÃ©dito Cliente"||c.tipo==="credito_cliente"};console.log("ðŸ“¤ DEBUG novoPagamento:",Ne);let ke="verde";if(c!=null&&c.permite_parcelamento&&le[c.id]){const Y=(ze=le[c.id])==null?void 0:ze[k];ke=(Y==null?void 0:Y.cor)??"verde",console.log(`â™»ï¸ Reutilizando simulaÃ§Ã£o do backend: ${k}x = cor ${ke}`)}if(R==="vermelho"||ke==="vermelho"){if(!O||O.trim().length<10){H("âš ï¸ Justificativa obrigatÃ³ria para margem crÃ­tica (mÃ­nimo 10 caracteres)"),X("Por favor, preencha a justificativa abaixo");return}const Y=a.observacoes?`${a.observacoes}

âš ï¸ JUSTIFICATIVA (Margem CrÃ­tica): ${O}`:`âš ï¸ JUSTIFICATIVA (Margem CrÃ­tica): ${O}`;a.observacoes=Y}l([...i,Ne]),f(null),S(""),u(""),y(d.find(Y=>Y.padrao)||null),p(""),N(1),X(""),H("")},Ze=oe=>{l(i.filter((Ne,ke)=>ke!==oe))},ma=async oe=>{var Ne,ke;if(confirm("Deseja realmente excluir este pagamento?")){W(!0),X("");try{console.log(`ðŸ—‘ï¸ Excluindo pagamento ID ${oe}...`),await F.delete(`/vendas/pagamentos/${oe}`),console.log("âœ… Pagamento excluÃ­do com sucesso!");const Ue=await F.get(`/vendas/${a.id}/pagamentos`);j(Ue.data.pagamentos||[]),M(Ue.data.total_pago||0),Ue.data.pagamentos.length===0&&o&&await o(),X("")}catch(Ue){console.error("âŒ Erro ao excluir pagamento:",Ue),console.error("   Response:",Ue.response),console.error("   Message:",Ue.message),Ue.message&&Ue.message.includes("CORS")?X("âš ï¸ Erro de CORS: O backend precisa ser reiniciado. Feche e abra novamente o servidor backend."):X(((ke=(Ne=Ue.response)==null?void 0:Ne.data)==null?void 0:ke.detail)||Ue.message||"Erro ao excluir pagamento")}finally{W(!1)}}},oa=async()=>{var oe,Ne,ke,Ue,ze,Y,ve,Le;if(i.length===0){X("Adicione pelo menos uma forma de pagamento");return}W(!0),X("");try{const I=a.itens.filter(U=>U.tipo==="produto"&&U.produto_id).map(U=>({produto_id:U.produto_id,quantidade:U.quantidade}));if(I.length>0){const ie=(await ix(I)).data||[];if(ie.length>0){const _e=ie.map(T=>`â€¢ ${T.produto_nome}: estoque atual ${T.estoque_atual}, apÃ³s venda ficarÃ¡ ${T.estoque_resultante}`).join(`
`);if(!window.confirm(`âš ï¸ ATENÃ‡ÃƒO: Os seguintes produtos ficarÃ£o com ESTOQUE NEGATIVO:

${_e}

Deseja continuar mesmo assim?`)){W(!1);return}}}let Q=a.id;if(!Q){const U=((oe=a.entrega)==null?void 0:oe.taxa_entrega_total)||0,ie=((Ne=a.entrega)==null?void 0:Ne.taxa_loja)||0,_e=((ke=a.entrega)==null?void 0:ke.taxa_entregador)||0,$e=U>0?(ie/U*100).toFixed(2):100,T=U>0?(_e/U*100).toFixed(2):0;Q=(await Kl({cliente_id:(Ue=a.cliente)==null?void 0:Ue.id,funcionario_id:a.funcionario_id,itens:a.itens,desconto_valor:a.desconto_valor,desconto_percentual:a.desconto_percentual,observacoes:a.observacoes,tem_entrega:a.tem_entrega,taxa_entrega:U,percentual_taxa_loja:parseFloat($e),percentual_taxa_entregador:parseFloat(T),entregador_id:a.entregador_id,endereco_entrega:(ze=a.entrega)==null?void 0:ze.endereco_completo,observacoes_entrega:(Y=a.entrega)==null?void 0:Y.observacoes_entrega})).id}const fe=await fx(Q,i);E(Q),(fe==null?void 0:fe.status)==="finalizada"||(fe==null?void 0:fe.status)==="pago_nf"?$(!0):s()}catch(I){console.error("Erro ao finalizar venda:",I),X(((Le=(ve=I.response)==null?void 0:ve.data)==null?void 0:Le.detail)||"Erro ao finalizar venda")}finally{W(!1)}},ha=async oe=>{var Ne,ke;W(!0),X("");try{await F.post("/nfe/emitir",{venda_id:J,tipo_nota:oe}),alert(`${oe==="nfe"?"NF-e":"NFC-e"} emitida com sucesso!`),s()}catch(Ue){console.error("Erro ao emitir nota:",Ue),alert(((ke=(Ne=Ue.response)==null?void 0:Ne.data)==null?void 0:ke.detail)||"Erro ao emitir nota fiscal. VocÃª pode emiti-la depois na tela de vendas."),s()}finally{W(!1)}};return Z?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(fa,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Venda Finalizada!"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Deseja emitir nota fiscal?"})]})]}),e.jsxs("div",{className:"space-y-3",children:[(da=a.cliente)!=null&&da.cnpj?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>ha("nfe"),disabled:P,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(ss,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NF-e (Empresa)"})]}),e.jsxs("button",{onClick:()=>ha("nfce"),disabled:P,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(ss,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NFC-e (Cupom)"})]})]}):e.jsxs("button",{onClick:()=>ha("nfce"),disabled:P,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(ss,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NFC-e"})]}),e.jsx("button",{onClick:s,disabled:P,className:"w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"NÃ£o emitir agora"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-4",children:"VocÃª pode emitir a nota fiscal depois na tela de vendas"})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Ct,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Registrar Recebimento"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Selecione as formas de pagamento"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!1,e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(pa,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Selecione a forma de pagamento"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.cliente&&a.cliente.credito>0&&e.jsxs("button",{onClick:()=>{f({id:"credito_cliente",nome:"CrÃ©dito Cliente",tipo:"credito_cliente",icone:"ðŸŽ",credito_disponivel:parseFloat(a.cliente.credito)}),N(1),u(""),p(""),S(Math.min(parseFloat(a.cliente.credito),ea).toFixed(2))},className:`p-4 rounded-lg border-2 transition-all ${(c==null?void 0:c.id)==="credito_cliente"?"border-purple-500 bg-purple-50":"border-purple-200 bg-purple-50/50 hover:border-purple-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:"ðŸŽ"}),e.jsx("div",{className:`text-sm font-medium ${(c==null?void 0:c.id)==="credito_cliente"?"text-purple-900":"text-purple-700"}`,children:"CrÃ©dito Cliente"}),e.jsxs("div",{className:"text-xs text-purple-600 mt-1 font-semibold",children:["R$ ",parseFloat(a.cliente.credito).toFixed(2).replace(".",",")]})]}),g.map(oe=>{const Ne=(c==null?void 0:c.id)===oe.id;return e.jsxs("button",{onClick:()=>{f(oe),N(1),u(""),p("")},className:`p-4 rounded-lg border-2 transition-all ${Ne?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:oe.icone||"ðŸ’³"}),e.jsx("div",{className:`text-sm font-medium ${Ne?"text-blue-900":"text-gray-700"}`,children:oe.nome}),oe.taxa_percentual>0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Taxa: ",oe.taxa_percentual,"%"]})]},oe.id)})]})]}),c&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[c.id==="credito_cliente"&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-800 mb-2",children:[e.jsx(kt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"CrÃ©dito DisponÃ­vel"})]}),e.jsxs("div",{className:"text-lg font-bold text-purple-600",children:["R$ ",c.credito_disponivel.toFixed(2).replace(".",",")]}),e.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"ðŸ’¡ NÃ£o gera movimentaÃ§Ã£o de caixa"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c.id==="credito_cliente"?"Valor a Utilizar":"Valor Recebido"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:w,onChange:oe=>{S(oe.target.value)},onBlur:oe=>{const Ne=parseFloat(oe.target.value)||0;if(c.id==="credito_cliente"){const ke=Math.min(c.credito_disponivel,ea);Ne>ke&&(S(ke.toFixed(2)),X(`Valor ajustado para o crÃ©dito disponÃ­vel: R$ ${ke.toFixed(2)}`),setTimeout(()=>X(""),3e3))}},placeholder:ea.toFixed(2),max:c.id==="credito_cliente"?Math.min(c.credito_disponivel,ea):void 0,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]}),c.id==="credito_cliente"&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["MÃ¡ximo: R$ ",Math.min(c.credito_disponivel,ea).toFixed(2)]})]}),c.tipo==="dinheiro"&&w&&e.jsx("div",{className:`rounded-lg p-3 ${Ie>0?"bg-yellow-50 border border-yellow-200":"bg-gray-100"}`,children:e.jsx("div",{className:"text-sm font-medium",children:e.jsxs("span",{className:Ie>0?"text-yellow-800":"text-gray-600",children:["Troco: R$ ",Ie.toFixed(2)]})})}),(c==null?void 0:c.tipo)&&["cartao_credito","cartao_debito"].includes(c.tipo)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Operadora *"}),e.jsxs("select",{value:(C==null?void 0:C.id)||"",onChange:oe=>{const Ne=d.find(ke=>ke.id===parseInt(oe.target.value));y(Ne),Ne&&k>Ne.max_parcelas&&N(Ne.max_parcelas)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione a operadora..."}),d.map(oe=>e.jsxs("option",{value:oe.id,children:[oe.nome," (",oe.max_parcelas,"x mÃ¡x)"]},oe.id))]}),C&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["MÃ¡ximo de ",C.max_parcelas," parcelas"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bandeira"}),e.jsxs("select",{value:b,onChange:oe=>u(oe.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),yx.map(oe=>e.jsx("option",{value:oe,children:oe},oe))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["NSU (NÃºmero Sequencial Ãšnico)",e.jsx("span",{className:"text-gray-500 text-xs ml-1",children:"(Opcional - para conciliaÃ§Ã£o)"})]}),e.jsx("input",{type:"text",value:h,onChange:oe=>p(oe.target.value),placeholder:"Ex: 123456789",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),(c==null?void 0:c.permite_parcelamento)&&e.jsxs("div",{ref:se,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"NÃºmero de Parcelas"}),e.jsx("select",{value:k,onChange:oe=>N(parseInt(oe.target.value)),className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${(()=>{var ke;const oe=(ke=le[c.id])==null?void 0:ke[k],Ne=(oe==null?void 0:oe.cor)||R||"verde";return Ne==="verde"?"border-gray-300 bg-white":Ne==="amarelo"?"border-yellow-400 bg-yellow-50 text-yellow-900":"border-red-400 bg-red-50 text-red-900"})()}`,children:Array.from({length:(C==null?void 0:C.max_parcelas)||c.parcelas_maximas||12},(oe,Ne)=>Ne+1).map(oe=>{var Y;const Ne=parseFloat(w)||ea,ke=Ne/oe,Ue=(Y=le[c.id])==null?void 0:Y[oe],ze=(Ue==null?void 0:Ue.cor)||"verde";return e.jsxs("option",{value:oe,className:ze==="verde"?"":ze==="amarelo"?"bg-yellow-100 text-yellow-900":"bg-red-100 text-red-900",children:[ze==="vermelho"?"ðŸš« ":ze==="amarelo"?"âš ï¸ ":"",oe,"x de R$ ",ke.toFixed(2)," ",w?`(Total: R$ ${Ne.toFixed(2)})`:""]},oe)})}),w&&k>1&&e.jsxs("div",{className:`mt-2 p-3 border rounded-lg ${(()=>{var ke;const oe=(ke=le[c.id])==null?void 0:ke[k],Ne=(oe==null?void 0:oe.cor)||R||"verde";return Ne==="verde"?"bg-blue-50 border-blue-200":Ne==="amarelo"?"bg-yellow-50 border-yellow-300":"bg-red-50 border-red-300"})()}`,children:[e.jsx("p",{className:`text-sm font-medium ${(()=>{var ke;const oe=(ke=le[c.id])==null?void 0:ke[k],Ne=(oe==null?void 0:oe.cor)||R||"verde";return Ne==="verde"?"text-blue-800":Ne==="amarelo"?"text-yellow-800":"text-red-800"})()}`,children:(()=>{var ke;const oe=(ke=le[c.id])==null?void 0:ke[k],Ne=(oe==null?void 0:oe.cor)||R||"verde";return e.jsxs(e.Fragment,{children:[Ne==="vermelho"&&"ðŸš« ",Ne==="amarelo"&&"âš ï¸ ","ðŸ’³ ",k,"x de R$ ",(parseFloat(w)/k).toFixed(2)]})})()}),e.jsxs("p",{className:`text-xs mt-1 ${(()=>{var ke;const oe=(ke=le[c.id])==null?void 0:ke[k],Ne=(oe==null?void 0:oe.cor)||R||"verde";return Ne==="verde"?"text-blue-600":Ne==="amarelo"?"text-yellow-700":"text-red-700"})()}`,children:["Valor total parcelado: R$ ",parseFloat(w).toFixed(2),(()=>{var ke;const oe=(ke=le[c.id])==null?void 0:ke[k],Ne=(oe==null?void 0:oe.cor)||R||"verde";return Ne==="amarelo"?" - Requer atenÃ§Ã£o":Ne==="vermelho"?" - Requer justificativa":""})()]})]})]}),e.jsx("button",{onClick:Qe,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Adicionar Pagamento"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Resumo da Venda"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total da Venda:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",we.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Valor Pago:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",Se.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-blue-600 text-lg font-semibold border-t pt-3",children:[e.jsx("span",{children:"Restante:"}),e.jsxs("span",{children:["R$ ",ea.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Formas de Pagamento"}),x.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-600 mb-2",children:["ðŸ’° Pagamentos Registrados (",x.length,")"]}),e.jsx("div",{className:"space-y-2",children:x.map((oe,Ne)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:oe.forma_pagamento==="dinheiro"?"ðŸ’µ Dinheiro":oe.forma_pagamento==="pix"?"ðŸ“± PIX":oe.forma_pagamento==="credito"?"ðŸ’³ CartÃ£o de CrÃ©dito":oe.forma_pagamento==="debito"?"ðŸ’³ CartÃ£o de DÃ©bito":oe.forma_pagamento==="boleto"?"ðŸ“„ Boleto":oe.forma_pagamento}),e.jsxs("span",{className:"px-2 py-0.5 bg-green-200 text-green-800 text-xs rounded-full font-medium",children:["Pagamento ",Ne+1]})]}),oe.bandeira&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Bandeira: ",oe.bandeira]}),oe.nsu_cartao&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1 font-mono",children:["ðŸ”¢ NSU: ",oe.nsu_cartao]}),oe.numero_parcelas&&oe.numero_parcelas>1&&e.jsxs("div",{className:"text-sm text-blue-600 mt-1 font-medium",children:["ðŸ”¢ Parcelado em ",oe.numero_parcelas,"x de R$ ",(parseFloat(oe.valor)/oe.numero_parcelas).toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["ðŸ“… ",new Date(oe.data_pagamento).toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-green-700 text-lg",children:["R$ ",parseFloat(oe.valor).toFixed(2)]}),oe.troco&&parseFloat(oe.troco)>0&&e.jsxs("div",{className:"text-xs text-yellow-600",children:["Troco: R$ ",parseFloat(oe.troco).toFixed(2)]})]}),e.jsx("button",{onClick:()=>ma(oe.id),disabled:P,className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors disabled:opacity-50",title:"Excluir pagamento",children:e.jsx(Es,{className:"w-4 h-4"})})]})]},oe.id))})]}),i.length===0&&x.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400 bg-gray-50 rounded-lg border-2 border-dashed",children:[e.jsx(kt,{className:"w-12 h-12 mx-auto mb-2 opacity-40"}),e.jsx("p",{className:"text-sm font-medium",children:"Nenhuma forma de pagamento adicionada"}),e.jsx("p",{className:"text-xs mt-1",children:"Selecione uma forma acima para comeÃ§ar"})]}):i.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 mb-2",children:"â³ Novos Pagamentos (a confirmar)"}),e.jsx("div",{className:"space-y-3",children:i.map((oe,Ne)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:oe.nome}),e.jsx("span",{className:"px-2 py-0.5 bg-blue-200 text-blue-800 text-xs rounded-full font-medium",children:"Novo"})]}),oe.bandeira&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Bandeira: ",oe.bandeira]}),oe.nsu_cartao&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1 font-mono",children:["ðŸ”¢ NSU: ",oe.nsu_cartao]}),oe.numero_parcelas>1&&e.jsxs("div",{className:"text-sm text-blue-600 mt-1 font-medium",children:["ðŸ”¢ ",oe.numero_parcelas,"x de R$ ",(oe.valor/oe.numero_parcelas).toFixed(2)]}),oe.troco&&oe.troco>0&&e.jsxs("div",{className:"text-sm text-yellow-600 mt-1",children:["ðŸ’µ Troco: R$ ",oe.troco.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"font-semibold text-blue-700 text-lg",children:["R$ ",oe.valor.toFixed(2)]}),e.jsx("button",{onClick:()=>Ze(Ne),className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors",title:"Remover",children:e.jsx(pa,{className:"w-5 h-5"})})]})]},Ne))})]}):null]}),R&&e.jsx(vx,{status:R,loading:B}),ue&&Object.keys(le).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center space-x-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ“Š"}),e.jsx("span",{children:"Parcelamento Recomendado"})]}),ee?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin inline-block w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full"}),e.jsx("p",{className:"text-sm text-blue-700 mt-2",children:"Analisando opÃ§Ãµes..."})]}):e.jsxs("div",{className:"space-y-2",children:[ue.saudavel.max>0&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-green-100 border border-green-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"ðŸŸ¢"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-green-900",children:[ue.saudavel.min===ue.saudavel.max?`${ue.saudavel.max}x`:`${ue.saudavel.min}x a ${ue.saudavel.max}x`,e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- SaudÃ¡vel"})]}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"Margem adequada, sem restriÃ§Ãµes"})]})]}),ue.alerta.max>=ue.alerta.min&&ue.alerta.min>0&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-yellow-100 border border-yellow-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"ðŸŸ¡"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-yellow-900",children:[ue.alerta.min===ue.alerta.max?`${ue.alerta.max}x`:`${ue.alerta.min}x a ${ue.alerta.max}x`,e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- AtenÃ§Ã£o"})]}),e.jsx("div",{className:"text-xs text-yellow-700 mt-1",children:"Margem prÃ³xima ao mÃ­nimo, evite se possÃ­vel"})]})]}),ue.proibido.min<=((c==null?void 0:c.parcelas_maximas)??12)&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-red-100 border border-red-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ”´"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-red-900",children:[ue.proibido.min,"x ou mais",e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- Exige justificativa"})]}),e.jsx("div",{className:"text-xs text-red-700 mt-1",children:"Margem crÃ­tica, justificativa obrigatÃ³ria"})]})]})]})]}),(()=>{var Ue,ze;let oe="verde";return c!=null&&c.permite_parcelamento&&((Ue=le[c.id])!=null&&Ue[k])&&(oe=((ze=le[c.id][k])==null?void 0:ze.cor)??"verde"),R==="vermelho"||oe==="vermelho"||O&&O.trim().length>0?e.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-3",children:[e.jsx(xa,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-red-900",children:"âš ï¸ Justificativa ObrigatÃ³ria"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Esta venda tem margem crÃ­tica. Informe o motivo para prosseguir."})]})]}),e.jsx("textarea",{value:O,onChange:Y=>{q(Y.target.value),Y.target.value.trim().length>=10&&H("")},placeholder:"Ex: Cliente especial, promoÃ§Ã£o de lanÃ§amento, acordo comercial...",className:`w-full px-3 py-2 border-2 rounded-lg focus:ring-2 focus:ring-red-500 resize-none ${ae?"border-red-500":"border-red-300"}`,rows:3}),ae&&e.jsx("p",{className:"text-xs text-red-700 font-medium mt-2",children:ae}),e.jsx("p",{className:"text-xs text-red-600 mt-2",children:"ðŸ’¡ MÃ­nimo 10 caracteres"})]}):null})()]})]})}),e.jsxs("div",{className:"border-t p-6 bg-gray-50",children:[A&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(xa,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:A})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:t,disabled:P,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:oa,disabled:P||i.length===0,className:"flex items-center space-x-2 px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:P?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(fa,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"})]})})]})]})]})})}const _x=async a=>(await F.post("/caixas/abrir",a)).data,wx=async()=>(await F.get("/caixas/aberto")).data,Cx=async(a={})=>(await F.get("/caixas",{params:a})).data,To=async(a,t)=>(await F.post(`/caixas/${a}/movimentacao`,t)).data,kx=async(a,t)=>(await F.post(`/caixas/${a}/fechar`,t)).data,Sx=async a=>(await F.post(`/caixas/${a}/reabrir`)).data,Gl=async a=>(await F.get(`/caixas/${a}/resumo`)).data;function Ex({onClose:a,onSucesso:t}){const[s,o]=n.useState(""),[r,i]=n.useState(""),[l,x]=n.useState(""),[j,g]=n.useState({n2:0,n5:0,n10:0,n20:0,n50:0,n100:0,n200:0,moedas:0}),[v,d]=n.useState(!1),[m,C]=n.useState(!1),[y,c]=n.useState(""),f=()=>j.n200*200+j.n100*100+j.n50*50+j.n20*20+j.n10*10+j.n5*5+j.n2*2+parseFloat(j.moedas||0),b=()=>{const p=f();o(p.toFixed(2)),d(!1)},u=()=>{g({n2:0,n5:0,n10:0,n20:0,n50:0,n100:0,n200:0,moedas:0})},h=async()=>{var k,N;const p=parseFloat(s);if(!p||p<0){c("Informe um valor vÃ¡lido para abertura");return}C(!0),c("");try{await _x({valor_abertura:p,conta_origem_nome:r||"Dinheiro em mÃ£os",observacoes_abertura:l}),t()}catch(w){console.error("Erro ao abrir caixa:",w),c(((N=(k=w.response)==null?void 0:k.data)==null?void 0:N.detail)||"Erro ao abrir caixa")}finally{C(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Oa,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Abrir Caixa"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Informe o valor inicial do caixa"})]})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(pa,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor de Abertura *"}),e.jsxs("button",{type:"button",onClick:()=>d(!v),className:"flex items-center space-x-1 px-3 py-1.5 text-sm bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 rounded-lg transition-colors",children:[e.jsx(Gs,{className:"w-4 h-4"}),e.jsx("span",{children:"Auxiliar Contagem"})]})]}),v&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-xl p-5 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center",children:[e.jsx(Gs,{className:"w-5 h-5 mr-2 text-blue-600"}),"Auxiliar de Contagem"]}),e.jsx("button",{onClick:()=>d(!1),className:"p-1 hover:bg-blue-100 rounded-lg transition-colors",type:"button",children:e.jsx(pa,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-gray-200 hover:border-gray-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-gray-500 to-gray-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 2"}),e.jsx("input",{type:"number",min:"0",value:j.n2,onChange:p=>g({...j,n2:parseInt(p.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-gray-500 focus:ring-2 focus:ring-gray-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-gray-600",children:["R$ ",(j.n2*2).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-purple-200 hover:border-purple-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 5"}),e.jsx("input",{type:"number",min:"0",value:j.n5,onChange:p=>g({...j,n5:parseInt(p.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-purple-600",children:["R$ ",(j.n5*5).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-red-200 hover:border-red-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-red-500 to-red-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 10"}),e.jsx("input",{type:"number",min:"0",value:j.n10,onChange:p=>g({...j,n10:parseInt(p.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-red-500 focus:ring-2 focus:ring-red-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-red-600",children:["R$ ",(j.n10*10).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-yellow-200 hover:border-yellow-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-yellow-500 to-yellow-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 20"}),e.jsx("input",{type:"number",min:"0",value:j.n20,onChange:p=>g({...j,n20:parseInt(p.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-yellow-600",children:["R$ ",(j.n20*20).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-blue-200 hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 50"}),e.jsx("input",{type:"number",min:"0",value:j.n50,onChange:p=>g({...j,n50:parseInt(p.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:["R$ ",(j.n50*50).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-green-200 hover:border-green-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-green-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 100"}),e.jsx("input",{type:"number",min:"0",value:j.n100,onChange:p=>g({...j,n100:parseInt(p.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-green-500 focus:ring-2 focus:ring-green-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",(j.n100*100).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-orange-200 hover:border-orange-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 200"}),e.jsx("input",{type:"number",min:"0",value:j.n200,onChange:p=>g({...j,n200:parseInt(p.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["R$ ",(j.n200*200).toFixed(2)]})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t-2 border-blue-300",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-amber-200 hover:border-amber-400 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-amber-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"ðŸ’° Moedas"})}),e.jsxs("span",{className:"text-lg font-bold text-amber-600",children:["R$ ",parseFloat(j.moedas||0).toFixed(2)]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:j.moedas,onChange:p=>g({...j,moedas:parseFloat(p.target.value)||0}),className:"w-full px-4 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200",placeholder:"0.00"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl p-4 mb-4 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-semibold text-sm",children:"TOTAL CONTADO"}),e.jsxs("span",{className:"text-3xl font-bold text-white",children:["R$ ",f().toFixed(2)]})]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:u,className:"flex-1 px-4 py-3 border-2 border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-semibold transition-colors",children:"ðŸ—‘ï¸ Limpar"}),e.jsx("button",{type:"button",onClick:b,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg font-semibold shadow-md transition-colors",children:"âœ“ Aplicar"})]})]}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:s,onChange:p=>o(p.target.value),placeholder:"0,00",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-lg font-semibold",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conta de Origem"}),e.jsxs("select",{value:r,onChange:p=>i(p.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Dinheiro em mÃ£os",children:"Dinheiro em mÃ£os"}),e.jsx("option",{value:"Caixa geral",children:"Caixa geral"}),e.jsx("option",{value:"Banco",children:"Banco"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ObservaÃ§Ãµes (opcional)"}),e.jsx("textarea",{value:l,onChange:p=>x(p.target.value),rows:3,placeholder:"Ex: Troco do dia anterior...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"border-t p-6 bg-gray-50",children:[y&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(xa,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:y})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:a,disabled:m,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:h,disabled:m||!s,className:"px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Abrindo...":"Abrir Caixa"})]})]})]})})}function Fx({caixaId:a,onClose:t,onSucesso:s}){const[o,r]=n.useState(""),[i,l]=n.useState(""),[x,j]=n.useState(""),[g,v]=n.useState(!1),[d,m]=n.useState(""),C=async()=>{var c,f;const y=parseFloat(o);if(!y||y<=0){m("Informe um valor vÃ¡lido");return}v(!0);try{await To(a,{tipo:"suprimento",valor:y,forma_pagamento:"Dinheiro",conta_origem_nome:i||"NÃ£o informado",descricao:x}),s()}catch(b){m(((f=(c=b.response)==null?void 0:c.data)==null?void 0:f.detail)||"Erro ao adicionar suprimento")}finally{v(!1)}};return e.jsx(qo,{titulo:"Suprimento para o caixa",icone:Ta,corIcone:"green",onClose:t,erro:d,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conta de origem*"}),e.jsxs("select",{value:i,onChange:y=>l(y.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Dinheiro em mÃ£os",children:"Dinheiro em mÃ£os"}),e.jsx("option",{value:"Caixa geral",children:"Caixa geral"}),e.jsx("option",{value:"Banco",children:"Banco"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:o,onChange:y=>r(y.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"DescriÃ§Ã£o*"}),e.jsx("textarea",{value:x,onChange:y=>j(y.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Motivo do suprimento..."})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:t,disabled:g,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:C,disabled:g,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors",children:g?"Salvando...":"Salvar"})]})]})})}function Px({caixaId:a,saldoAtual:t,onClose:s,onSucesso:o}){const[r,i]=n.useState(""),[l,x]=n.useState(""),[j,g]=n.useState(""),[v,d]=n.useState(!1),[m,C]=n.useState(""),y=async()=>{var f,b;const c=parseFloat(r);if(!c||c<=0){C("Informe um valor vÃ¡lido");return}d(!0);try{await To(a,{tipo:"sangria",valor:c,forma_pagamento:"Dinheiro",conta_destino_nome:l||"NÃ£o informado",descricao:j}),o()}catch(u){C(((b=(f=u.response)==null?void 0:f.data)==null?void 0:b.detail)||"Erro ao adicionar sangria")}finally{d(!1)}};return e.jsx(qo,{titulo:"Sangria no caixa",icone:Ha,corIcone:"orange",onClose:s,erro:m,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Em caixa:"})," R$ ",t.toFixed(2)]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor da Sangria*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:r,onChange:c=>i(c.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecione a conta de destino*"}),e.jsxs("select",{value:l,onChange:c=>x(c.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Cofre",children:"Cofre"}),e.jsx("option",{value:"Banco",children:"Banco"}),e.jsx("option",{value:"Outro caixa",children:"Outro caixa"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:j,onChange:c=>g(c.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Motivo da sangria..."})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:s,disabled:v,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:y,disabled:v,className:"flex-1 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors",children:v?"Salvando...":"Salvar"})]})]})})}function Rx({caixaId:a,onClose:t,onSucesso:s}){const[o,r]=n.useState(""),[i,l]=n.useState(""),[x,j]=n.useState(""),[g,v]=n.useState("Dinheiro"),[d,m]=n.useState(""),[C,y]=n.useState(""),[c,f]=n.useState(!1),[b,u]=n.useState(""),h=["Ãgua e Luz","Aluguel","Telefone/Internet","Material de Limpeza","Material de EscritÃ³rio","ManutenÃ§Ã£o","Outros"],p=async()=>{var N,w;const k=parseFloat(x);if(!k||k<=0){u("Informe um valor vÃ¡lido");return}if(!o){u("Selecione uma categoria");return}f(!0);try{await To(a,{tipo:"despesa",valor:k,categoria:o,descricao:i,forma_pagamento:g,fornecedor_nome:d,documento:C}),s()}catch(S){u(((w=(N=S.response)==null?void 0:N.data)==null?void 0:w.detail)||"Erro ao adicionar despesa")}finally{f(!1)}};return e.jsx(qo,{titulo:"Despesa no caixa",icone:bt,corIcone:"red",onClose:t,erro:b,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categoria*"}),e.jsxs("select",{value:o,onChange:k=>r(k.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),h.map(k=>e.jsx("option",{value:k,children:k},k))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"DescriÃ§Ã£o*"}),e.jsx("input",{type:"text",value:i,onChange:k=>l(k.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Ex: Conta de luz - Janeiro"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de pagamento*"}),e.jsxs("select",{value:g,onChange:k=>v(k.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Dinheiro",children:"Dinheiro"}),e.jsx("option",{value:"PIX",children:"PIX"}),e.jsx("option",{value:"CartÃ£o de CrÃ©dito",children:"CartÃ£o de CrÃ©dito"}),e.jsx("option",{value:"CartÃ£o de DÃ©bito",children:"CartÃ£o de DÃ©bito"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:x,onChange:k=>j(k.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fornecedor"}),e.jsx("input",{type:"text",value:d,onChange:k=>m(k.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Documento / NF"}),e.jsx("input",{type:"text",value:C,onChange:k=>y(k.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:t,disabled:c,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:p,disabled:c,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:c?"Salvando...":"Salvar"})]})]})})}function qo({titulo:a,icone:t,corIcone:s,children:o,onClose:r,erro:i}){const l={green:"bg-green-100 text-green-600",orange:"bg-orange-100 text-orange-600",red:"bg-red-100 text-red-600",blue:"bg-blue-100 text-blue-600",purple:"bg-purple-100 text-purple-600"};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-12 h-12 ${l[s]} rounded-full flex items-center justify-center`,children:e.jsx(t,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:a})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(pa,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[i&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(xa,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:i})]}),o]})]})})}function $x({caixaId:a,onClose:t,onSuccess:s}){const[o,r]=n.useState(null),[i,l]=n.useState(""),[x,j]=n.useState(""),[g,v]=n.useState(!0),[d,m]=n.useState(!1),[C,y]=n.useState(!1),[c,f]=n.useState({n100:0,n50:0,n20:0,n10:0,n5:0,n2:0,moedas:0});n.useEffect(()=>{b()},[a]);const b=async()=>{try{const S=await Gl(a);console.log("ðŸ“Š Resumo do caixa recebido:",S),console.log("ðŸ“Š vendas_por_forma_pagamento:",S.vendas_por_forma_pagamento),r(S),l(S.totais.saldo_atual.toFixed(2))}catch(S){console.error("Erro ao carregar resumo:",S),alert("Erro ao carregar dados do caixa")}finally{v(!1)}},u=()=>!o||!i?0:parseFloat(i)-o.totais.saldo_atual,h=()=>c.n100*100+c.n50*50+c.n20*20+c.n10*10+c.n5*5+c.n2*2+parseFloat(c.moedas||0),p=()=>{const S=h();l(S.toFixed(2)),y(!1)},k=()=>{f({n100:0,n50:0,n20:0,n10:0,n5:0,n2:0,moedas:0})},N=async()=>{var P,W;if(!i){alert("Informe o valor contado no caixa");return}const S=u();if(!(Math.abs(S)>.01&&!window.confirm(`DiferenÃ§a de R$ ${Math.abs(S).toFixed(2)} ${S>0?"a mais":"a menos"}

Deseja continuar com o fechamento?`))){m(!0);try{await kx(a,{valor_informado:parseFloat(i),observacoes_fechamento:x||null}),alert("Caixa fechado com sucesso!"),s(),t()}catch(te){console.error("Erro ao fechar caixa:",te),alert(((W=(P=te.response)==null?void 0:P.data)==null?void 0:W.detail)||"Erro ao fechar caixa")}finally{m(!1)}}};if(g)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})});if(!o)return null;const w=u();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-red-600 to-orange-600 text-white p-6 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center",children:[e.jsx(bt,{className:"w-7 h-7 mr-3"}),"Fechar Caixa"]}),e.jsxs("p",{className:"text-red-100 mt-1",children:["Caixa #",o.caixa.numero_caixa," - ",o.caixa.usuario_nome]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(pa,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-6 border-2 border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center",children:[e.jsx(Gs,{className:"w-5 h-5 mr-2 text-gray-700"}),"Resumo do Movimento"]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Valor de Abertura"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",o.caixa.valor_abertura.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(o.caixa.data_abertura).toLocaleString("pt-BR")})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-green-700 mb-1",children:[e.jsx(bt,{className:"w-4 h-4 mr-1"}),"Entradas"]}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["+ R$ ",o.totais.vendas.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Movimento de entrada"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-blue-700 mb-1",children:[e.jsx(Ta,{className:"w-4 h-4 mr-1"}),"Suprimentos"]}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["+ R$ ",o.totais.suprimentos.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-orange-700 mb-1",children:[e.jsx(Ha,{className:"w-4 h-4 mr-1"}),"Sangrias"]}),e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["- R$ ",o.totais.sangrias.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-red-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-red-700 mb-1",children:[e.jsx(Oa,{className:"w-4 h-4 mr-1"}),"Despesas"]}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["- R$ ",o.totais.despesas.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900",children:"Valor Contado no Caixa *"}),e.jsxs("button",{type:"button",onClick:()=>y(!C),className:"flex items-center space-x-1 px-3 py-1.5 text-sm bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors border border-blue-200",title:"Auxiliar na contagem de notas",children:[e.jsx(Gs,{className:"w-4 h-4"}),e.jsx("span",{children:"Auxiliar Contagem"})]})]}),C&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-xl p-5 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center",children:[e.jsx(Gs,{className:"w-5 h-5 mr-2 text-blue-600"}),"Auxiliar de Contagem"]}),e.jsx("button",{onClick:()=>y(!1),className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx(pa,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-gray-200 hover:border-gray-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-gray-500 to-gray-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 2"}),e.jsx("input",{type:"number",min:"0",value:c.n2,onChange:S=>f({...c,n2:parseInt(S.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-gray-500 focus:ring-2 focus:ring-gray-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-gray-600",children:["R$ ",(c.n2*2).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-purple-200 hover:border-purple-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 5"}),e.jsx("input",{type:"number",min:"0",value:c.n5,onChange:S=>f({...c,n5:parseInt(S.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-purple-600",children:["R$ ",(c.n5*5).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-red-200 hover:border-red-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-red-500 to-red-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 10"}),e.jsx("input",{type:"number",min:"0",value:c.n10,onChange:S=>f({...c,n10:parseInt(S.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-red-500 focus:ring-2 focus:ring-red-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-red-600",children:["R$ ",(c.n10*10).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-yellow-200 hover:border-yellow-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-yellow-500 to-yellow-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 20"}),e.jsx("input",{type:"number",min:"0",value:c.n20,onChange:S=>f({...c,n20:parseInt(S.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-yellow-600",children:["R$ ",(c.n20*20).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-blue-200 hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 50"}),e.jsx("input",{type:"number",min:"0",value:c.n50,onChange:S=>f({...c,n50:parseInt(S.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:["R$ ",(c.n50*50).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-green-200 hover:border-green-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-green-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 100"}),e.jsx("input",{type:"number",min:"0",value:c.n100,onChange:S=>f({...c,n100:parseInt(S.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-green-500 focus:ring-2 focus:ring-green-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ã—"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",(c.n100*100).toFixed(2)]})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t-2 border-blue-300",children:e.jsx("div",{className:"bg-white rounded-lg p-4 border-2 border-amber-200 hover:border-amber-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-amber-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"ðŸ’° Moedas"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:c.moedas,onChange:S=>f({...c,moedas:parseFloat(S.target.value)||0}),className:"w-32 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200",placeholder:"0.00"})]}),e.jsxs("span",{className:"text-lg font-bold text-amber-600",children:["R$ ",(c.moedas||0).toFixed(2)]})]})})}),e.jsxs("div",{className:"mt-5 pt-5 border-t-2 border-blue-300",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl p-4 mb-4 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-semibold text-sm",children:"TOTAL CONTADO"}),e.jsxs("span",{className:"text-3xl font-bold text-white",children:["R$ ",h().toFixed(2)]})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:k,className:"flex-1 px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-semibold transition-colors",children:"ðŸ—‘ï¸ Limpar"}),e.jsx("button",{type:"button",onClick:p,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 font-bold shadow-md transition-all",children:"âœ“ Aplicar"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Oa,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:i,onChange:S=>l(S.target.value),className:"w-full pl-10 pr-4 py-3 text-lg font-semibold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",autoFocus:!0})]}),i&&Math.abs(w)>.01&&e.jsx("div",{className:`mt-3 p-4 rounded-lg border-2 ${w>0?"bg-blue-50 border-blue-300":"bg-yellow-50 border-yellow-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-semibold text-gray-900",children:[w>0?"Sobra":"Falta",":"]}),e.jsxs("span",{className:`text-xl font-bold ${w>0?"text-blue-600":"text-yellow-700"}`,children:["R$ ",Math.abs(w).toFixed(2)]})]})}),i&&Math.abs(w)<=.01&&e.jsx("div",{className:"mt-3 p-4 rounded-lg border-2 bg-green-50 border-green-300",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-green-700 font-semibold",children:[e.jsx("span",{className:"text-2xl",children:"âœ“"}),e.jsx("span",{children:"Caixa conferido - Valores corretos!"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"ObservaÃ§Ãµes (opcional)"}),e.jsx("textarea",{value:x,onChange:S=>j(S.target.value),placeholder:"Adicione observaÃ§Ãµes sobre o fechamento...",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),o.vendas_por_forma_pagamento&&Object.keys(o.vendas_por_forma_pagamento).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center",children:[e.jsx(bt,{className:"w-4 h-4 mr-1.5 text-blue-600"}),"Vendas por Forma de Pagamento (Informativo)"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(o.vendas_por_forma_pagamento).map(([S,P])=>{const W=S==="Dinheiro";return e.jsx("div",{className:`bg-white rounded-lg p-3 border ${W?"border-green-300 bg-green-50":"border-gray-200"} hover:shadow-sm transition-shadow cursor-pointer`,title:"Clique para ver detalhes das vendas",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${S==="Dinheiro"?"bg-green-500":S==="PIX"?"bg-purple-500":S.includes("DÃ©bito")?"bg-blue-500":S.includes("CrÃ©dito")?"bg-orange-500":"bg-gray-400"}`}),e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:S}),W&&e.jsx("span",{className:"text-xs bg-green-600 text-white px-1.5 py-0.5 rounded",children:"CAIXA"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[P.quantidade," venda",P.quantidade!==1?"s":""]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:["R$ ",P.total.toFixed(2)]})})]})},S)})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200 text-xs text-gray-600",children:["ðŸ’¡ ",e.jsx("strong",{children:"Dica:"})," Apenas ",e.jsx("strong",{children:"Dinheiro"})," afeta o saldo fÃ­sico do caixa. Demais formas vÃ£o para banco/financeiro."]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:t,disabled:d,className:"px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),e.jsx("button",{onClick:N,disabled:d||!i,className:"px-8 py-3 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white rounded-lg font-bold transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Fechando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"w-5 h-5"}),e.jsx("span",{children:"Fechar Caixa"})]})})]})]})]})})}function Ax({caixaId:a,onClose:t,onSucesso:s}){var B;const[o,r]=n.useState(1),[i,l]=n.useState([]),[x,j]=n.useState(null),[g,v]=n.useState({}),[d,m]=n.useState({}),[C,y]=n.useState(""),[c,f]=n.useState(!1),[b,u]=n.useState(!1),[h,p]=n.useState(""),[k,N]=n.useState({}),[w,S]=n.useState({}),[P,W]=n.useState({}),[te,D]=n.useState({busca:"",data_inicio:"",data_fim:"",status:"finalizada"});n.useEffect(()=>{A()},[te]);const A=async()=>{u(!0),p("");try{const _={per_page:50,...te},O=await F.get("/vendas",{params:_});l(O.data.vendas||[])}catch(_){console.error("Erro ao buscar vendas:",_),p("Erro ao carregar vendas")}finally{u(!1)}},X=async _=>{var O,q;u(!0),p("");try{const ae=await F.get(`/vendas/${_.id}`);j(ae.data);const H={};ae.data.itens.forEach(le=>{H[le.id]=le.quantidade}),m(H),r(2)}catch(ae){console.error("Erro ao buscar venda:",ae),p(((q=(O=ae.response)==null?void 0:O.data)==null?void 0:q.detail)||"Erro ao carregar detalhes da venda")}finally{u(!1)}},re=_=>{const O=g[_];v(q=>({...q,[_]:!q[_]})),O&&(N(q=>{const ae={...q};return delete ae[_],ae}),S(q=>{const ae={...q};return delete ae[_],ae}),W(q=>{const ae={...q};return delete ae[_],ae}))},M=(_,O)=>{const ae=x.itens.find(le=>le.id===_).quantidade,H=Math.min(Math.max(0,parseFloat(O)||0),ae);m(le=>({...le,[_]:H}))},Z=_=>_.tipo_produto==="KIT"&&_.composicao_kit&&_.composicao_kit.length>0,$=(_,O)=>{if(N(q=>({...q,[_]:O})),O==="componentes"){const q=x.itens.find(ae=>ae.id===_);if(q&&q.composicao_kit){const ae={},H={};q.composicao_kit.forEach((le,G)=>{ae[G]=!1,H[G]=le.quantidade*q.quantidade}),S(le=>({...le,[_]:ae})),W(le=>({...le,[_]:H}))}}},J=(_,O)=>{S(q=>{var ae;return{...q,[_]:{...q[_]||{},[O]:!((ae=q[_])!=null&&ae[O])}}})},E=(_,O,q)=>{const ae=x.itens.find(ee=>ee.id===_),le=ae.composicao_kit[O].quantidade*ae.quantidade,G=Math.min(Math.max(0,parseFloat(q)||0),le);W(ee=>({...ee,[_]:{...ee[_]||{},[O]:G}}))},R=async()=>{var ae,H;if(Object.keys(g).filter(le=>g[le]).filter(le=>{const G=x.itens.find(ee=>ee.id===parseInt(le));return Z(G)&&!k[le]}).length>0){p("Para itens KIT, vocÃª deve escolher entre devolver o KIT inteiro ou selecionar componentes");return}const O=[];if(Object.keys(g).filter(le=>g[le]).forEach(le=>{const G=parseInt(le),ee=x.itens.find(de=>de.id===G);if(Z(ee)){const de=k[le];if(de==="kit_inteiro")O.push({item_id:G,quantidade:d[le]});else if(de==="componentes"){const ue=w[le]||{},Ae=P[le]||{},se=Object.keys(ue).filter(we=>ue[we]).map(we=>parseInt(we));if(se.length===0){p(`VocÃª deve selecionar pelo menos um componente do KIT "${ee.produto_nome}"`);return}se.forEach(we=>{const Se=ee.composicao_kit[we],ea=Ae[we]||0;if(ea<=0){p(`Quantidade do componente "${Se.produto_nome}" deve ser maior que zero`);return}O.push({produto_id:Se.produto_id,quantidade:ea,preco_unitario:ee.preco_unitario/ee.composicao_kit.reduce((Ie,Je)=>Ie+Je.quantidade,0)*Se.quantidade,is_componente_kit:!0,kit_item_id:G})})}}else O.push({item_id:G,quantidade:d[le]})}),O.length===0){p("Selecione pelo menos um item para devoluÃ§Ã£o");return}if(O.some(le=>le.quantidade<=0)){p("Todas as quantidades devem ser maiores que zero");return}if(!C.trim()){p("Informe o motivo da devoluÃ§Ã£o");return}u(!0),p("");try{await F.post(`/vendas/${x.id}/devolucao`,{caixa_id:a,itens:O,motivo:C,gerar_credito:c}),alert("DevoluÃ§Ã£o registrada com sucesso!"),s()}catch(le){console.error("Erro ao registrar devoluÃ§Ã£o:",le),p(((H=(ae=le.response)==null?void 0:ae.data)==null?void 0:H.detail)||"Erro ao registrar devoluÃ§Ã£o")}finally{u(!1)}},K=()=>{if(!x)return 0;let _=0;return Object.keys(g).filter(O=>g[O]).forEach(O=>{const q=x.itens.find(ae=>ae.id===parseInt(O));if(Z(q)){const ae=k[O];if(ae==="kit_inteiro"){const H=d[O]||0;_+=q.preco_unitario*H}else if(ae==="componentes"){const H=w[O]||{},le=P[O]||{},G=q.composicao_kit.reduce((ee,de)=>ee+de.quantidade,0);Object.keys(H).filter(ee=>H[ee]).forEach(ee=>{const de=q.composicao_kit[ee],ue=le[ee]||0,Ae=q.preco_unitario/G*de.quantidade,se=ue/de.quantidade;_+=Ae*se})}}else{const ae=d[O]||0;_+=q.preco_unitario*ae}}),_};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(ll,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"DevoluÃ§Ã£o"}),e.jsx("p",{className:"text-sm text-gray-500",children:o===1?"Selecione a venda":"Selecionar itens para devoluÃ§Ã£o"})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(pa,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[o===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar"}),e.jsx("input",{type:"text",value:te.busca,onChange:_=>D({...te,busca:_.target.value}),placeholder:"NÃºmero da venda, cliente...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:te.data_inicio,onChange:_=>D({...te,data_inicio:_.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Fim"}),e.jsx("input",{type:"date",value:te.data_fim,onChange:_=>D({...te,data_fim:_.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})}),b?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando vendas..."})]}):i.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(xa,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Nenhuma venda encontrada"})]}):e.jsx("div",{className:"space-y-2",children:i.map(_=>{var O;return e.jsx("button",{onClick:()=>X(_),className:"w-full text-left p-4 border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:["Venda #",_.numero_venda||_.id]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Cliente: ",((O=_.cliente)==null?void 0:O.nome)||"Consumidor Final"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:_.data_criacao?new Date(_.data_criacao).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Data nÃ£o disponÃ­vel"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold text-green-600",children:["R$ ",_.total.toFixed(2)]}),e.jsx("div",{className:`text-xs mt-1 px-2 py-1 rounded ${_.status==="finalizada"?"bg-green-100 text-green-800":_.status==="baixa_parcial"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:_.status==="finalizada"?"Finalizada":_.status==="baixa_parcial"?"Parcial":"Aberta"})]})]})},_.id)})}),h&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(xa,{className:"w-5 h-5"}),e.jsx("span",{children:h})]})]}),o===2&&x&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-2",children:["Venda #",x.numero_venda||x.id]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{className:"ml-2 font-medium",children:x.data_criacao?new Date(x.data_criacao).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Data nÃ£o disponÃ­vel"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Cliente:"}),e.jsx("span",{className:"ml-2 font-medium",children:((B=x.cliente)==null?void 0:B.nome)||"Consumidor Final"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"ml-2 font-medium text-green-600",children:["R$ ",x.total.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Itens da Venda"}),e.jsx("div",{className:"space-y-2",children:x.itens.map(_=>{const O=Z(_),q=k[_.id];return e.jsx("div",{className:`border rounded-lg p-4 transition-colors ${g[_.id]?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("input",{type:"checkbox",checked:g[_.id]||!1,onChange:()=>re(_.id),className:"mt-1 w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:_.produto_nome}),O&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded",children:[e.jsx(il,{className:"w-3 h-3"}),"KIT"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["PreÃ§o unitÃ¡rio: R$ ",_.preco_unitario.toFixed(2)," | Qtd vendida: ",_.quantidade]}),g[_.id]&&O&&e.jsxs("div",{className:"mt-4 bg-white border-2 border-purple-300 rounded-lg p-4",children:[e.jsxs("div",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(ls,{className:"w-5 h-5 text-purple-600"}),"Como deseja devolver este KIT?"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:`modo-kit-${_.id}`,checked:q==="kit_inteiro",onChange:()=>$(_.id,"kit_inteiro"),className:"mt-1 w-4 h-4 text-blue-600 focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800 group-hover:text-blue-700 transition-colors",children:"ðŸ“¦ Devolver KIT Inteiro"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Devolve o KIT completo como uma unidade"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:`modo-kit-${_.id}`,checked:q==="componentes",onChange:()=>$(_.id,"componentes"),className:"mt-1 w-4 h-4 text-purple-600 focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800 group-hover:text-purple-700 transition-colors",children:"ðŸ§© Selecionar Componentes"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Escolha quais componentes do KIT devolver"})]})]})]})]}),g[_.id]&&!O&&e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantidade a devolver:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:_.quantidade,value:d[_.id],onChange:ae=>M(_.id,ae.target.value),className:"w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Subtotal: R$ ",(_.preco_unitario*(d[_.id]||0)).toFixed(2)]})]}),g[_.id]&&O&&q==="kit_inteiro"&&e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantidade de KITs a devolver:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:_.quantidade,value:d[_.id],onChange:ae=>M(_.id,ae.target.value),className:"w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Subtotal: R$ ",(_.preco_unitario*(d[_.id]||0)).toFixed(2)]})]}),g[_.id]&&O&&q==="componentes"&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-purple-50 to-blue-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold text-gray-800 mb-3",children:"Selecione os componentes a devolver:"}),e.jsx("div",{className:"space-y-3",children:_.composicao_kit.map((ae,H)=>{var ee,de;const le=(ee=w[_.id])==null?void 0:ee[H],G=ae.quantidade*_.quantidade;return e.jsx("div",{className:`border rounded-lg p-3 transition-colors ${le?"border-purple-500 bg-white":"border-gray-200 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:le||!1,onChange:()=>J(_.id,H),className:"mt-1 w-4 h-4 text-purple-600 rounded focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-800",children:ae.produto_nome})]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["Qtd no KIT: ",ae.quantidade," | Qtd total disponÃ­vel: ",G]}),le&&e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Quantidade:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:G,value:((de=P[_.id])==null?void 0:de[H])||0,onChange:ue=>E(_.id,H,ue.target.value),className:"w-24 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500"})]})]})]})},H)})})]})]})]})},_.id)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Motivo da DevoluÃ§Ã£o *"}),e.jsx("textarea",{value:C,onChange:_=>y(_.target.value),placeholder:"Descreva o motivo da devoluÃ§Ã£o...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 border-2 border-purple-200 rounded-lg p-5",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-3",children:"ðŸ’³ Tipo de DevoluÃ§Ã£o"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",checked:!c,onChange:()=>f(!1),className:"mt-1 w-5 h-5 text-green-600 focus:ring-2 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800 group-hover:text-green-700 transition-colors",children:"ðŸ’µ Devolver em Dinheiro"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"O valor serÃ¡ devolvido em dinheiro e registrado como saÃ­da de caixa"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",checked:c,onChange:()=>f(!0),className:"mt-1 w-5 h-5 text-purple-600 focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800 group-hover:text-purple-700 transition-colors",children:"ðŸŽ Gerar CrÃ©dito para o Cliente"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"O valor serÃ¡ convertido em crÃ©dito para uso em futuras compras (sem movimentaÃ§Ã£o de caixa)"})]})]})]}),c&&!(x!=null&&x.cliente_id)&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-300 rounded-lg",children:e.jsxs("p",{className:"text-xs text-yellow-800 flex items-center gap-2",children:[e.jsx(xa,{className:"w-4 h-4"}),e.jsxs("span",{children:[e.jsx("strong",{children:"AtenÃ§Ã£o:"})," Esta venda nÃ£o possui cliente vinculado. Para gerar crÃ©dito, Ã© necessÃ¡rio ter um cliente cadastrado."]})]})})]}),e.jsx("div",{className:`border-2 rounded-lg p-4 ${c?"bg-purple-50 border-purple-300":"bg-orange-50 border-orange-200"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:c?"CrÃ©dito a Gerar:":"Total da DevoluÃ§Ã£o:"}),c&&(x==null?void 0:x.cliente)&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Cliente: ",e.jsx("strong",{children:x.cliente.nome})]})]}),e.jsxs("span",{className:`text-2xl font-bold ${c?"text-purple-600":"text-orange-600"}`,children:["R$ ",K().toFixed(2)]})]})}),h&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(xa,{className:"w-5 h-5"}),e.jsx("span",{children:h})]})]})]}),e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:o===1?t:()=>{r(1),j(null),v({}),m({}),y(""),p("")},disabled:b,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:o===1?"Cancelar":"Voltar"}),o===2&&e.jsx("button",{onClick:R,disabled:b||Object.values(g).filter(Boolean).length===0,className:"flex items-center gap-2 px-8 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(dl,{className:"w-5 h-5"}),e.jsx("span",{children:"Confirmar DevoluÃ§Ã£o"})]})})]})})]})})}function Dx({caixaId:a,onClose:t}){const[s,o]=n.useState([]),[r,i]=n.useState(null),[l,x]=n.useState(!0);n.useEffect(()=>{j()},[a]);const j=async()=>{try{x(!0);const d=await F.get(`/caixas/${a}/movimentacoes`);o(d.data.movimentacoes),i(d.data.caixa)}catch(d){console.error("Erro ao carregar movimentaÃ§Ãµes:",d),Ee.error("Erro ao carregar movimentaÃ§Ãµes do caixa")}finally{x(!1)}},g=d=>{const m=new Date(d);return new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}).format(m)},v=d=>({venda:"Venda",suprimento:"Suprimento",sangria:"Sangria",despesa:"Despesa",devolucao:"DevoluÃ§Ã£o",transferencia:"TransferÃªncia"})[d]||d;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-blue-50 to-purple-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:"ðŸ“‹ Extrato do Caixa"}),r&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Caixa #",r.id," - ",r.nome," | Status: ",r.status]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:j,className:"p-2 hover:bg-white rounded-lg transition-colors",title:"Atualizar",children:e.jsx(Aa,{className:`w-5 h-5 text-gray-600 ${l?"animate-spin":""}`})}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(pa,{className:"w-5 h-5 text-gray-600"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“­"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhuma movimentaÃ§Ã£o registrada"})]}):e.jsx("div",{className:"space-y-3",children:s.map(d=>e.jsx("div",{className:`p-4 rounded-lg border-2 ${d.natureza==="entrada"?"bg-green-50 border-green-200":d.natureza==="saida"?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"text-3xl",children:d.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:v(d.tipo)}),d.forma_pagamento&&e.jsx("span",{className:"text-xs bg-white px-2 py-1 rounded border",children:d.forma_pagamento})]}),d.descricao&&e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:d.descricao}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-2 text-xs text-gray-600",children:[e.jsxs("span",{children:["ðŸ• ",g(d.data_movimento)]}),e.jsxs("span",{children:["ðŸ‘¤ ",d.usuario_nome]}),d.venda_id&&e.jsxs("span",{children:["ðŸ§¾ Venda #",d.venda_numero||d.venda_id]}),d.documento&&e.jsxs("span",{children:["ðŸ“„ ",d.documento]})]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("div",{className:`text-2xl font-bold ${d.natureza==="entrada"?"text-green-600":d.natureza==="saida"?"text-red-600":"text-gray-600"}`,children:[d.natureza==="entrada"&&"+",d.natureza==="saida"&&"-","R$ ",d.valor.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:d.natureza==="entrada"?e.jsxs("span",{className:"flex items-center gap-1 justify-end",children:[e.jsx(Ta,{className:"w-3 h-3"})," Entrada"]}):d.natureza==="saida"?e.jsxs("span",{className:"flex items-center gap-1 justify-end",children:[e.jsx(Ha,{className:"w-3 h-3"})," SaÃ­da"]}):"Neutro"})]})]})},d.id))})}),e.jsx("div",{className:"border-t p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[s.length," movimentaÃ§Ã£o(Ãµes) encontrada(s)"]}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Fechar"})]})})]})})}function Mx({onAbrirCaixa:a}){var h,p,k;const[t,s]=n.useState(null),[o,r]=n.useState(null),[i,l]=n.useState(!1),[x,j]=n.useState(null),[g,v]=n.useState(!0),[d,m]=n.useState(!1),[C,y]=n.useState(!1);n.useEffect(()=>{f();const N=setInterval(f,3e4);return()=>clearInterval(N)},[]),n.useEffect(()=>{const N=()=>{m(!1)};if(d)return document.addEventListener("mouseup",N),()=>document.removeEventListener("mouseup",N)},[d]);const c=()=>{l(!1),y(!1),m(!1)},f=async()=>{try{const N=await wx();if(s(N),N){const w=await Gl(N.id);r(w)}}catch(N){console.error("Erro ao carregar caixa:",N)}finally{v(!1)}},b=()=>{j(null),f()},u=async()=>{await a(),setTimeout(f,500)};return g?e.jsx("div",{className:"px-4 py-2 bg-gray-100 rounded-lg",children:e.jsx("div",{className:"animate-pulse h-10 bg-gray-200 rounded"})}):t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>l(!i),className:"flex items-center space-x-3 px-4 py-2 bg-white border-2 border-green-500 rounded-lg hover:bg-green-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["Caixa #",t.numero_caixa]})]}),e.jsx(Ys,{className:`w-5 h-5 text-gray-400 transition-transform ${i?"rotate-180":""}`})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:c}),e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 z-50",children:[e.jsxs("div",{className:"p-4 border-b bg-gradient-to-r from-green-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Caixa #",t.numero_caixa]}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:t.usuario_nome})]}),e.jsx("button",{onClick:c,className:"p-1 hover:bg-white rounded-lg transition-colors",children:e.jsx(pa,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(tt,{className:"w-4 h-4 mr-1"}),"Aberto em ",new Date(t.data_abertura).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Saldo Atual"}),e.jsx("div",{className:`text-sm font-bold ${d?"text-green-600":"text-gray-400"}`,children:d?`R$ ${((p=(h=o==null?void 0:o.totais)==null?void 0:h.saldo_atual)==null?void 0:p.toFixed(2))||"0,00"}`:"â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsx("button",{onMouseDown:()=>m(!0),className:"p-1 hover:bg-blue-100 rounded transition-colors",children:d?e.jsx(Ht,{className:"w-4 h-4 text-blue-600"}):e.jsx(Tr,{className:"w-4 h-4 text-gray-400"})})]})]})]}),o&&e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900",children:"Resumo do Movimento"}),e.jsx("button",{onClick:()=>y(!C),className:"p-1 hover:bg-gray-200 rounded transition-colors",children:C?e.jsx(Ht,{className:"w-4 h-4 text-blue-600"}):e.jsx(Tr,{className:"w-4 h-4 text-gray-400"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Abertura"}),e.jsx("div",{className:`font-semibold ${C?"text-gray-900":"text-gray-300"}`,children:C?`R$ ${t.valor_abertura.toFixed(2)}`:"â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Entradas"}),e.jsx("div",{className:`font-semibold ${C?"text-green-600":"text-green-300"}`,children:C?`+ R$ ${o.totais.vendas.toFixed(2)}`:"â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Suprimentos"}),e.jsx("div",{className:`font-semibold ${C?"text-green-600":"text-green-300"}`,children:C?`+ R$ ${o.totais.suprimentos.toFixed(2)}`:"â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Sangrias"}),e.jsx("div",{className:`font-semibold ${C?"text-orange-600":"text-orange-300"}`,children:C?`- R$ ${o.totais.sangrias.toFixed(2)}`:"â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Despesas"}),e.jsx("div",{className:`font-semibold ${C?"text-red-600":"text-red-300"}`,children:C?`- R$ ${o.totais.despesas.toFixed(2)}`:"â€¢â€¢â€¢â€¢â€¢â€¢"})]})]})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{onClick:()=>{j("suprimento"),l(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-green-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(Ta,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Suprimento"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Adicionar dinheiro ao caixa"})]})]}),e.jsxs("button",{onClick:()=>{j("sangria"),l(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-orange-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(Ha,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Sangria"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Retirar dinheiro do caixa"})]})]}),e.jsxs("button",{onClick:()=>{j("despesa"),l(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-red-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(bt,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Despesa"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Registrar pagamento de despesa"})]})]}),e.jsxs("button",{onClick:()=>{j("devolucao"),l(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-purple-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(ll,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"DevoluÃ§Ã£o"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Estornar venda e devolver ao estoque"})]})]}),e.jsxs("button",{onClick:()=>{j("movimentacoes"),l(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-blue-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Ni,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Extrato do Caixa"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Ver todas as movimentaÃ§Ãµes"})]})]})]}),e.jsx("div",{className:"p-4 border-t",children:e.jsx("button",{onClick:()=>{j("fechar"),l(!1)},className:"w-full px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Fechar Caixa"})})]})]})]}),x==="suprimento"&&e.jsx(Fx,{caixaId:t.id,onClose:()=>j(null),onSucesso:b}),x==="sangria"&&e.jsx(Px,{caixaId:t.id,saldoAtual:((k=o==null?void 0:o.totais)==null?void 0:k.saldo_atual)||0,onClose:()=>j(null),onSucesso:b}),x==="despesa"&&e.jsx(Rx,{caixaId:t.id,onClose:()=>j(null),onSucesso:b}),x==="fechar"&&e.jsx($x,{caixaId:t.id,onClose:()=>j(null),onSuccess:()=>{j(null),f()}}),x==="devolucao"&&e.jsx(Ax,{caixaId:t.id,onClose:()=>j(null),onSucesso:b}),x==="movimentacoes"&&e.jsx(Dx,{caixaId:t.id,onClose:()=>j(null)})]}):e.jsxs("button",{onClick:u,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(Oa,{className:"w-5 h-5"}),e.jsx("span",{children:"Abrir Caixa"})]})}function Lx({venda:a,onClose:t}){var o,r;const s=()=>{window.print()};return a?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:s,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-800 text-white rounded-lg transition-colors print:hidden",children:[e.jsx(ho,{className:"w-5 h-5"}),e.jsx("span",{children:"Imprimir Cupom"})]}),e.jsx("style",{children:`
        @media print {
          /* Esconder tudo exceto o cupom */
          body * {
            visibility: hidden;
          }
          .cupom-impressao, .cupom-impressao * {
            visibility: visible;
          }
          .cupom-impressao {
            position: absolute;
            left: 0;
            top: 0;
            width: 80mm;
            margin: 0;
            padding: 0;
          }
          
          /* Reset de margens para impressÃ£o */
          @page {
            size: 80mm auto;
            margin: 5mm;
          }
        }
      `}),e.jsxs("div",{className:"cupom-impressao hidden print:block",style:{width:"80mm",fontFamily:"monospace"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"10px"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold"},children:"PET SHOP PRO"}),e.jsx("div",{style:{fontSize:"12px"},children:"Central de Gest\\u00e3o"}),e.jsx("div",{style:{fontSize:"10px",marginTop:"5px"},children:new Date().toLocaleString("pt-BR")})]}),e.jsxs("div",{style:{borderTop:"1px dashed #000",marginBottom:"10px",paddingTop:"10px"},children:[e.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"5px"},children:["VENDA #",a.numero_venda||a.id]}),e.jsxs("div",{style:{fontSize:"11px"},children:[e.jsxs("div",{children:["Data: ",a.data_venda?new Date(a.data_venda).toLocaleString("pt-BR"):new Date().toLocaleString("pt-BR")]}),a.cliente&&e.jsxs("div",{children:["Cliente: ",a.cliente.nome||a.cliente_nome]}),a.pet&&e.jsxs("div",{children:["Pet: ",a.pet.nome]})]})]}),e.jsx("div",{style:{borderTop:"1px dashed #000",marginBottom:"10px",paddingTop:"10px"},children:e.jsxs("table",{style:{width:"100%",fontSize:"10px",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid #000"},children:[e.jsx("th",{style:{textAlign:"left",paddingBottom:"5px"},children:"Item"}),e.jsx("th",{style:{textAlign:"center",paddingBottom:"5px"},children:"Qtd"}),e.jsx("th",{style:{textAlign:"right",paddingBottom:"5px"},children:"Valor"})]})}),e.jsx("tbody",{children:(o=a.itens)==null?void 0:o.map((i,l)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{paddingTop:"5px",paddingBottom:"5px"},children:[i.produto_nome,e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"9px",color:"#666"},children:[i.quantidade," x R$ ",i.preco_unitario.toFixed(2),i.desconto_valor>0&&e.jsxs("span",{style:{color:"#ff8c00"},children:[" ","com R$ ",i.desconto_valor.toFixed(2)," de desconto"]})]})]}),e.jsx("td",{style:{textAlign:"center",paddingTop:"5px",paddingBottom:"5px"},children:i.quantidade}),e.jsxs("td",{style:{textAlign:"right",paddingTop:"5px",paddingBottom:"5px"},children:["R$ ",i.subtotal.toFixed(2)]})]},l))})]})}),e.jsxs("div",{style:{borderTop:"1px dashed #000",paddingTop:"10px",fontSize:"11px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Total bruto:"}),e.jsxs("span",{children:["R$ ",(a.subtotal+a.desconto_valor).toFixed(2)]})]}),a.desconto_valor>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px",color:"#ff8c00"},children:[e.jsxs("span",{children:[(a.desconto_valor/(a.subtotal+a.desconto_valor)*100).toFixed(2),"% de desconto:"]}),e.jsxs("span",{children:["R$ ",a.desconto_valor.toFixed(2)]})]}),a.tem_entrega&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsxs("span",{children:["R$ ",(((r=a.entrega)==null?void 0:r.taxa_entrega_total)||0).toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",paddingTop:"10px",borderTop:"1px solid #000",fontSize:"14px",fontWeight:"bold"},children:[e.jsx("span",{children:"TOTAL:"}),e.jsxs("span",{children:["R$ ",a.total.toFixed(2)]})]})]}),a.pagamentos&&a.pagamentos.length>0&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"PAGAMENTOS:"}),a.pagamentos.map((i,l)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"3px"},children:[e.jsx("span",{children:i.forma_pagamento}),e.jsxs("span",{children:["R$ ",i.valor.toFixed(2)]})]},l))]}),a.tem_entrega&&a.entrega&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"ENTREGA:"}),e.jsx("div",{children:a.entrega.endereco_completo}),a.entrega.observacoes_entrega&&e.jsxs("div",{style:{marginTop:"3px",fontStyle:"italic"},children:["Obs: ",a.entrega.observacoes_entrega]})]}),a.observacoes&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"OBSERVA\\u00c7\\u00d5ES:"}),e.jsx("div",{children:a.observacoes})]}),e.jsxs("div",{style:{textAlign:"center",marginTop:"15px",paddingTop:"10px",borderTop:"1px dashed #000",fontSize:"10px"},children:[e.jsx("div",{children:"Obrigado pela preferencia!"}),e.jsx("div",{style:{marginTop:"5px"},children:"Volte sempre!"})]})]})]}):null}function Tx({clienteId:a,clienteNome:t,onClose:s,onSucesso:o}){const[r,i]=n.useState([]),[l,x]=n.useState([]),[j,g]=n.useState(!0),[v,d]=n.useState(!1),[m,C]=n.useState(""),[y,c]=n.useState("dinheiro"),[f,b]=n.useState(""),[u,h]=n.useState(""),[p,k]=n.useState({total_vendas:0,total_em_aberto:0}),[N,w]=n.useState("antiga");n.useEffect(()=>{S()},[a]);const S=async()=>{try{g(!0);const re=await F.get(`/clientes/${a}/vendas-em-aberto`);i(re.data.vendas||[]),k(re.data.resumo||{total_vendas:0,total_em_aberto:0})}catch(re){console.error("Erro ao carregar vendas em aberto:",re),ce.error("Erro ao carregar vendas em aberto")}finally{g(!1)}},P=re=>{x(M=>M.includes(re)?M.filter(Z=>Z!==re):[...M,re])},W=()=>{l.length===r.length?x([]):x(r.map(re=>re.id))},te=re=>{const M=new Date,Z=new Date(re),$=Math.abs(M-Z);return Math.ceil($/(1e3*60*60*24))},D=[...r].sort((re,M)=>N==="antiga"?new Date(re.data_venda)-new Date(M.data_venda):new Date(M.data_venda)-new Date(re.data_venda)),A=r.filter(re=>l.includes(re.id)).reduce((re,M)=>re+parseFloat(M.saldo_devedor),0),X=async()=>{var re,M,Z,$;if(l.length===0){ce.error("Selecione ao menos uma venda");return}if(!m||parseFloat(m)<=0){ce.error("Informe um valor vÃ¡lido");return}if(parseFloat(m)>A){ce.error("Valor do pagamento nÃ£o pode ser maior que o total selecionado");return}try{d(!0),console.log("Enviando requisiÃ§Ã£o:",{vendas_ids:l,valor_total:parseFloat(m),forma_pagamento:y,numero_transacao:f||null,observacoes:u||null});const J=await F.post(`/clientes/${a}/baixar-vendas-lote`,{vendas_ids:l,valor_total:parseFloat(m),forma_pagamento:y,numero_transacao:f||null,observacoes:u||null});if(console.log("Resposta completa:",J),console.log("Response.data:",J.data),!J.data)throw new Error("Resposta vazia do servidor");const{vendas_quitadas:E,vendas_parciais:R,total_vendas_afetadas:K,valor_total_baixado:B}=J.data;let _=`ðŸ’° Total baixado: R$ ${B.toFixed(2)}
`;E.length>0&&(_+=`
âœ… ${E.length} venda(s) quitada(s):`,E.forEach(O=>{_+=`
  â€¢ ${O.numero_venda}: R$ ${O.valor_baixado.toFixed(2)}`})),R.length>0&&(_+=`

âš ï¸ ${R.length} venda(s) parcial:`,R.forEach(O=>{_+=`
  â€¢ ${O.numero_venda}:`,_+=`
    Baixado: R$ ${O.valor_baixado.toFixed(2)}`,_+=`
    Falta: R$ ${O.saldo_restante.toFixed(2)}`})),ce.success(_,{duration:6e3}),o&&o(),s()}catch(J){console.error("Erro completo:",J),console.error("Erro response:",J.response),console.error("Erro response data:",(re=J.response)==null?void 0:re.data),console.error("Erro response status:",(M=J.response)==null?void 0:M.status);const E=(($=(Z=J.response)==null?void 0:Z.data)==null?void 0:$.detail)||J.message||"Erro ao baixar vendas";ce.error(E)}finally{d(!1)}};return j?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-8 max-w-4xl w-full mx-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(St,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando vendas..."})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-red-50 to-orange-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Vendas em Aberto"}),e.jsx("p",{className:"text-gray-600 mt-1",children:t})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(pa,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Vendas"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:p.total_vendas})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total em Aberto"}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["R$ ",p.total_em_aberto.toFixed(2)]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fa,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-medium text-gray-900",children:"Nenhuma venda em aberto!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Este cliente nÃ£o possui dÃ©bitos pendentes."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:W,className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:l.length===r.length?"Desmarcar todas":"Selecionar todas"}),e.jsxs("button",{onClick:()=>w(N==="antiga"?"recente":"antiga"),className:"text-sm text-gray-600 hover:text-gray-700 flex items-center gap-1 font-medium",children:["ðŸ“… ",N==="antiga"?"â†‘ Mais Antigas":"â†“ Mais Recentes"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[l.length," de ",r.length," selecionada(s)"]})]}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden mb-6",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:e.jsx("input",{type:"checkbox",checked:l.length===r.length,onChange:W,className:"rounded border-gray-300"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Venda"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Pago"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Saldo Devedor"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Dias"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:D.map(re=>{const M=te(re.data_venda),Z=M>30;return e.jsxs("tr",{className:`hover:bg-gray-50 ${l.includes(re.id)?"bg-blue-50":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:l.includes(re.id),onChange:()=>P(re.id),className:"rounded border-gray-300"})}),e.jsxs("td",{className:"px-4 py-3 font-medium text-gray-900",children:["#",re.numero_venda]}),e.jsx("td",{className:"px-4 py-3 text-gray-600 text-sm",children:new Date(re.data_venda).toLocaleDateString("pt-BR")}),e.jsxs("td",{className:"px-4 py-3 text-right text-gray-900",children:["R$ ",parseFloat(re.total).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right text-green-600",children:["R$ ",parseFloat(re.total_pago).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-red-600",children:["R$ ",parseFloat(re.saldo_devedor).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${Z?"bg-red-100 text-red-800":M>15?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:[M," ",M===1?"dia":"dias"]})})]},re.id)})})]})}),l.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Registrar Pagamento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor Total Selecionado"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["R$ ",A.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor do Pagamento *"}),e.jsx("input",{type:"number",step:"0.01",value:m,onChange:re=>C(re.target.value),placeholder:"0.00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de Pagamento *"}),e.jsxs("select",{value:y,onChange:re=>c(re.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"dinheiro",children:"Dinheiro"}),e.jsx("option",{value:"pix",children:"PIX"}),e.jsx("option",{value:"debito",children:"CartÃ£o de DÃ©bito"}),e.jsx("option",{value:"credito",children:"CartÃ£o de CrÃ©dito"}),e.jsx("option",{value:"transferencia",children:"TransferÃªncia"})]})]}),(y==="pix"||y==="transferencia")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"NÃºmero da TransaÃ§Ã£o"}),e.jsx("input",{type:"text",value:f,onChange:re=>b(re.target.value),placeholder:"CÃ³digo/ID da transaÃ§Ã£o",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ObservaÃ§Ãµes"}),e.jsx("textarea",{value:u,onChange:re=>h(re.target.value),rows:"2",placeholder:"InformaÃ§Ãµes adicionais sobre o pagamento...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-start space-x-2 mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(xa,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"AtenÃ§Ã£o:"})," O valor serÃ¡ aplicado automaticamente da venda mais antiga para a mais recente. Se o valor for insuficiente para quitar todas as vendas selecionadas, a Ãºltima venda ficarÃ¡ parcialmente paga."]})]}),e.jsx("button",{onClick:X,disabled:v||!m||parseFloat(m)<=0,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:v?e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Oa,{className:"w-5 h-5"}),e.jsx("span",{children:"Baixar Vendas Selecionadas"})]})})]})]})})]})})}function qx({clienteId:a,clienteNome:t,onClose:s}){var m,C,y;const[o,r]=n.useState(null),[i,l]=n.useState(!0),[x,j]=n.useState("todos");n.useEffect(()=>{g()},[a]);const g=async()=>{try{l(!0);const c=await F.get(`/clientes/${a}/historico-compras`);r(c.data)}catch(c){console.error("Erro ao carregar histÃ³rico:",c),ce.error("Erro ao carregar histÃ³rico do cliente")}finally{l(!1)}},v=c=>{const f={finalizada:"bg-green-100 text-green-800",baixa_parcial:"bg-yellow-100 text-yellow-800",pendente:"bg-blue-100 text-blue-800",cancelada:"bg-red-100 text-red-800",finalizada_devolucao_parcial:"bg-orange-100 text-orange-800",finalizada_devolucao_total:"bg-gray-100 text-gray-800"},b={finalizada:"Finalizada",baixa_parcial:"Baixa Parcial",pendente:"Pendente",cancelada:"Cancelada",finalizada_devolucao_parcial:"Dev. Parcial",finalizada_devolucao_total:"Dev. Total"};return e.jsx("span",{className:`inline-flex px-2 py-1 rounded-full text-xs font-medium ${f[c]||"bg-gray-100 text-gray-800"}`,children:b[c]||c})},d=((m=o==null?void 0:o.vendas)==null?void 0:m.filter(c=>x==="todos"?!0:c.status===x))||[];return i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-8 max-w-4xl w-full mx-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(St,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando histÃ³rico..."})]})})}):o?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"HistÃ³rico de Compras"}),e.jsx("p",{className:"text-gray-600 mt-1",children:t})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(pa,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(dn,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Compras"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:o.total_compras})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(Oa,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Gasto"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",o.valor_total_gasto.toFixed(2)]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Ta,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Ticket MÃ©dio"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",o.ticket_medio.toFixed(2)]})]})]})})]}),o.ultima_compra&&e.jsxs("div",{className:"mt-4 bg-white rounded-lg p-3 shadow-sm flex items-center space-x-2 text-sm",children:[e.jsx(Is,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-gray-600",children:["Ãšltima compra: ",new Date(o.ultima_compra).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"})]})]})]}),e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtrar por status:"}),e.jsxs("select",{value:x,onChange:c=>j(c.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500",children:[e.jsxs("option",{value:"todos",children:["Todos (",((C=o.vendas)==null?void 0:C.length)||0,")"]}),e.jsx("option",{value:"finalizada",children:"Finalizadas"}),e.jsx("option",{value:"baixa_parcial",children:"Baixa Parcial"}),e.jsx("option",{value:"pendente",children:"Pendentes"}),e.jsx("option",{value:"cancelada",children:"Canceladas"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(dn,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:"Nenhuma venda encontrada"}),e.jsx("p",{className:"text-gray-600 mt-2",children:x==="todos"?"Este cliente ainda nÃ£o realizou compras.":"NÃ£o hÃ¡ vendas com este status."})]}):e.jsx("div",{className:"space-y-3",children:d.map(c=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Venda #",c.numero_venda]}),v(c.status)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Data:"}),e.jsx("div",{className:"font-medium text-gray-900",children:new Date(c.data_venda).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal:"}),e.jsxs("div",{className:"font-medium text-gray-900",children:["R$ ",c.subtotal.toFixed(2)]})]}),c.desconto_valor>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Desconto:"}),e.jsxs("div",{className:"font-medium text-red-600",children:["- R$ ",c.desconto_valor.toFixed(2)]})]}),c.taxa_entrega>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Taxa Entrega:"}),e.jsxs("div",{className:"font-medium text-gray-900",children:["R$ ",c.taxa_entrega.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total:"}),e.jsxs("div",{className:"font-bold text-gray-900 text-lg",children:["R$ ",c.total.toFixed(2)]})]}),c.saldo_devedor>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Saldo Devedor:"}),e.jsxs("div",{className:"font-bold text-red-600",children:["R$ ",c.saldo_devedor.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Itens:"}),e.jsx("div",{className:"font-medium text-gray-900",children:c.total_itens})]}),c.vendedor_nome&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Vendedor:"}),e.jsx("div",{className:"font-medium text-gray-900",children:c.vendedor_nome})]})]})]})})},c.id))})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[e.jsxs("span",{children:["Mostrando ",d.length," de ",((y=o.vendas)==null?void 0:y.length)||0," vendas"]}),e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:"Fechar"})]})})]})}):null}function Ix({clienteId:a}){const[t,s]=n.useState(!1),[o,r]=n.useState(null),[i,l]=n.useState(null),[x,j]=n.useState(""),[g,v]=n.useState([]),[d,m]=n.useState(!1),C=n.useRef(null),[y,c]=n.useState({resumo:!1,pets:!1,compras:!1,oportunidades:!1,sugestoes:!1,relacionados:!1,sazonalidade:!1,chat:!1});n.useEffect(()=>{a&&f()},[a]);const f=async()=>{var D,A;try{s(!0),l(null);const X=await F.get(`/clientes/${a}/info-pdv`);r(X.data)}catch(X){console.error("Erro ao carregar informaÃ§Ãµes do cliente:",X),l(((A=(D=X.response)==null?void 0:D.data)==null?void 0:A.detail)||"Erro ao carregar dados")}finally{s(!1)}},b=D=>{c(A=>({...A,[D]:!A[D]}))},u=async()=>{if(!x.trim())return;const D=x;j(""),v(A=>[...A,{tipo:"user",texto:D}]);try{m(!0);const A=await F.post(`/clientes/${a}/chat-pdv`,{mensagem:D});v(X=>[...X,{tipo:"ia",texto:A.data.resposta,ia_disponivel:A.data.ia_disponivel}]),setTimeout(()=>{var X;return(X=C.current)==null?void 0:X.scrollIntoView({behavior:"smooth"})},100)}catch(A){console.error("Erro no chat:",A),v(X=>[...X,{tipo:"erro",texto:"Erro ao processar mensagem. Tente novamente."}])}finally{m(!1)}},h=D=>{D.key==="Enter"&&!D.shiftKey&&(D.preventDefault(),u())};if(!a)return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 text-center text-gray-500",children:[e.jsx(vs,{className:"mx-auto text-4xl mb-2"}),e.jsx("p",{children:"Selecione um cliente para ver informaÃ§Ãµes"})]});if(t)return e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})});if(i)return e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:[e.jsx(Ca,{className:"inline mr-2"}),i]});if(!o)return null;const{cliente:p,resumo_financeiro:k,pets:N,ultimas_compras:w,oportunidades:S,sugestoes:P,produtos_relacionados:W,padroes_sazonais:te}=o;return e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden max-h-[85vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-100 to-purple-100 p-4 border-b",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 mb-1",children:p.nome}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[p.cpf_cnpj&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(vs,{className:"text-xs"}),p.cpf_cnpj]}),p.telefone&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(nl,{className:"text-xs"}),p.telefone]}),p.email&&e.jsxs("p",{className:"flex items-center gap-1 truncate",children:[e.jsx(ko,{className:"text-xs"}),p.email]}),p.endereco&&e.jsxs("p",{className:"flex items-center gap-1 text-xs",children:[e.jsx(_i,{className:"text-xs"}),p.endereco,", ",p.bairro," - ",p.cidade,"/",p.estado]})]})]})})}),e.jsxs(Ds,{titulo:"Resumo Financeiro",icone:e.jsx(es,{}),expandido:y.resumo,onToggle:()=>b("resumo"),badge:k.numero_compras,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:"Total Gasto"}),e.jsxs("p",{className:"text-lg font-bold text-green-700",children:["R$ ",k.total_gasto.toFixed(2)]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"Ticket MÃ©dio"}),e.jsxs("p",{className:"text-lg font-bold text-blue-700",children:["R$ ",k.ticket_medio.toFixed(2)]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-purple-600 font-medium mb-1",children:"NÂº Compras"}),e.jsx("p",{className:"text-lg font-bold text-purple-700",children:k.numero_compras})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-orange-600 font-medium mb-1",children:"Maior Compra"}),e.jsxs("p",{className:"text-lg font-bold text-orange-700",children:["R$ ",k.maior_compra.valor.toFixed(2)]}),k.maior_compra.data&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:k.maior_compra.data})]})]}),k.ultima_compra.data&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(et,{className:"text-xs"}),"Ãšltima compra: ",k.ultima_compra.data," - R$ ",k.ultima_compra.valor.toFixed(2)]})})]}),N&&N.length>0&&e.jsx(Ds,{titulo:"Pets Registrados",icone:e.jsx(vs,{}),expandido:y.pets,onToggle:()=>b("pets"),badge:N.length,children:e.jsx("div",{className:"space-y-2",children:N.map(D=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold",children:D.nome[0].toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800",children:D.nome}),e.jsxs("p",{className:"text-xs text-gray-500",children:[D.especie," ",D.raca&&`â€¢ ${D.raca}`,D.peso&&` â€¢ ${D.peso}kg`,D.idade_anos!==null&&` â€¢ ${D.idade_anos} anos`]})]})]},D.id))})}),S&&S.length>0&&e.jsx(Ds,{titulo:"Oportunidades de Venda",icone:e.jsx(Ca,{}),expandido:y.oportunidades,onToggle:()=>b("oportunidades"),badge:S.length,badgeColor:"bg-orange-500",children:e.jsx("div",{className:"space-y-2",children:S.map((D,A)=>e.jsxs("div",{className:`p-3 rounded-lg border-l-4 ${D.urgencia==="alta"?"bg-red-50 border-red-400":"bg-yellow-50 border-yellow-400"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:D.produto_nome}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:D.mensagem})]}),D.urgencia==="alta"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-red-500 text-white text-xs rounded-full",children:"Urgente"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Atrasado ",D.dias_atraso," dias"]})]},A))})}),P&&P.length>0&&e.jsx(Ds,{titulo:"Produtos Favoritos",icone:e.jsx(ot,{}),expandido:y.sugestoes,onToggle:()=>b("sugestoes"),badge:P.length,children:e.jsx("div",{className:"space-y-2",children:P.map((D,A)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:D.nome}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Comprado ",D.vezes_comprado,"x",D.ultima_compra&&` â€¢ Ãšltima: ${D.ultima_compra}`]})]}),e.jsxs("p",{className:"font-bold text-indigo-600 ml-2",children:["R$ ",D.preco.toFixed(2)]})]},A))})}),w&&w.length>0&&e.jsx(Ds,{titulo:"Ãšltimas Compras",icone:e.jsx(Nt,{}),expandido:y.compras,onToggle:()=>b("compras"),badge:w.length,children:e.jsx("div",{className:"space-y-3",children:w.map((D,A)=>e.jsxs("div",{className:"border-l-4 border-indigo-300 pl-3 py-2 bg-gray-50 rounded-r-lg",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500",children:[D.data," â€¢ Venda #",D.numero_venda]}),e.jsxs("p",{className:"font-bold text-indigo-600",children:["R$ ",D.valor_total.toFixed(2)]})]})}),D.produtos&&D.produtos.length>0&&e.jsx("div",{className:"space-y-1 mt-2",children:D.produtos.map((X,re)=>e.jsxs("p",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(Zt,{className:"text-xs"}),X.quantidade,"x ",X.nome," - R$ ",X.valor.toFixed(2)]},re))})]},A))})}),W&&W.length>0&&e.jsx(Ds,{titulo:"Produtos Comprados Juntos",icone:e.jsx(wi,{}),expandido:y.relacionados,onToggle:()=>b("relacionados"),badge:W.length,badgeColor:"bg-purple-500",children:e.jsx("div",{className:"space-y-2",children:W.map((D,A)=>e.jsxs("div",{className:"p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"text-xs font-semibold text-purple-600",children:[D.vezes_juntos,"x comprados juntos"]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-800",children:D.produto1.nome}),e.jsxs("span",{className:"text-purple-600 font-bold",children:["R$ ",D.produto1.preco.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-800",children:D.produto2.nome}),e.jsxs("span",{className:"text-purple-600 font-bold",children:["R$ ",D.produto2.preco.toFixed(2)]})]})]}),e.jsx("p",{className:"text-xs text-purple-600 mt-2 italic",children:"ðŸ’¡ SugestÃ£o: Oferecer combo!"})]},A))})}),te&&te.length>0&&e.jsx(Ds,{titulo:"PadrÃµes de Compra",icone:e.jsx(Ar,{}),expandido:y.sazonalidade,onToggle:()=>b("sazonalidade"),badge:te.length,badgeColor:"bg-green-500",children:e.jsx("div",{className:"space-y-2",children:te.map((D,A)=>e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-green-700",children:D.mes_ano}),e.jsxs("span",{className:"text-sm text-green-600",children:[D.numero_compras," compras"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"font-bold text-green-700 ml-1",children:["R$ ",D.total_gasto.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Ticket mÃ©dio:"}),e.jsxs("span",{className:"font-bold text-green-700 ml-1",children:["R$ ",D.ticket_medio.toFixed(2)]})]})]})]},A))})}),e.jsx(Ds,{titulo:"Chat IA - Assistente de Vendas",icone:e.jsx(Ls,{}),expandido:y.chat,onToggle:()=>b("chat"),badgeColor:"bg-blue-500",children:e.jsxs("div",{className:"space-y-3",children:[g.length===0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Perguntas sugeridas:"}),["Quais os produtos favoritos?","Quando foi a Ãºltima compra?","Quais pets ele tem?","Quanto jÃ¡ gastou total?"].map((D,A)=>e.jsx("button",{onClick:()=>{j(D),setTimeout(()=>u(),100)},className:"w-full text-left px-3 py-2 text-xs bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition-colors",children:D},A))]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto space-y-2",children:[g.map((D,A)=>e.jsx("div",{className:`flex ${D.tipo==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] px-3 py-2 rounded-lg text-sm ${D.tipo==="user"?"bg-blue-600 text-white":D.tipo==="erro"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-800"}`,children:[D.texto,D.tipo==="ia"&&!D.ia_disponivel&&e.jsx("p",{className:"text-xs mt-1 opacity-70",children:"ðŸ’¡ Modo bÃ¡sico (IA nÃ£o configurada)"})]})},A)),e.jsx("div",{ref:C})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:D=>j(D.target.value),onKeyPress:h,placeholder:"Digite sua pergunta...",disabled:d,className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"}),e.jsx("button",{onClick:u,disabled:d||!x.trim(),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Ci,{className:"w-4 h-4"})})]})]})})]})}function Ds({titulo:a,icone:t,expandido:s,onToggle:o,badge:r,badgeColor:i="bg-indigo-500",children:l}){return e.jsxs("div",{className:"border-b border-gray-200",children:[e.jsxs("button",{onClick:o,className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-indigo-600",children:t}),e.jsx("h4",{className:"font-semibold text-gray-800",children:a}),r!==void 0&&e.jsx("span",{className:`${i} text-white text-xs px-2 py-1 rounded-full`,children:r})]}),s?e.jsx(cl,{className:"text-gray-400"}):e.jsx(nt,{className:"text-gray-400"})]}),s&&e.jsx("div",{className:"px-4 pb-4",children:l})]})}const zx=({mostrar:a,onFechar:t,dados:s,carregando:o})=>{if(n.useEffect(()=>{const x=j=>{j.key==="Escape"&&a&&t()};if(a)return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[a,t]),!a)return null;const r=x=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(x||0),i=x=>{switch(x){case"verde":return"bg-green-100 border-green-500 text-green-800";case"amarelo":return"bg-yellow-100 border-yellow-500 text-yellow-800";case"vermelho":return"bg-red-100 border-red-500 text-red-800";default:return"bg-gray-100 border-gray-500 text-gray-800"}},l=x=>{switch(x){case"success":return e.jsx(qs,{className:"text-green-500"});case"error":return e.jsx(Ca,{className:"text-red-500"});case"warning":return e.jsx(Ca,{className:"text-yellow-500"});case"info":return e.jsx(at,{className:"text-blue-500"});default:return e.jsx(at,{className:"text-gray-500"})}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:t}),e.jsxs("div",{className:"fixed right-0 top-0 h-full w-96 bg-white shadow-2xl z-50 flex flex-col animate-slide-in-right",children:[e.jsxs("div",{className:"p-4 border-b bg-gradient-to-r from-blue-600 to-blue-700 text-white flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ar,{className:"w-5 h-5"}),e.jsx("h3",{className:"text-lg font-bold",children:"AnÃ¡lise da Venda"})]}),e.jsx("button",{onClick:t,className:"hover:bg-white hover:bg-opacity-20 p-1 rounded transition-colors",children:e.jsx(ks,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:o?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(es,{className:"text-blue-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"ComposiÃ§Ã£o Financeira"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Total dos Produtos"}),e.jsx("span",{className:"font-semibold",children:r(s.composicao.total_produtos)})]}),s.composicao.desconto>0&&e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"(-) Descontos Aplicados"}),e.jsxs("span",{className:"font-semibold",children:[r(s.composicao.desconto),e.jsxs("span",{className:"text-xs ml-1",children:["(",(s.composicao.desconto/s.composicao.total_produtos*100).toFixed(1),"%)"]})]})]}),s.composicao.taxa_entrega>0&&e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"(-) Taxa de Entrega"}),e.jsx("span",{className:"font-semibold",children:r(s.composicao.taxa_entrega)})]}),e.jsx("div",{className:"border-t-2 border-blue-600 pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-blue-700",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:r(s.composicao.subtotal)})]})})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Hr,{className:"text-orange-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"DeduÃ§Ãµes"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[s.deducoes.comissao.valor>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["ComissÃ£o do Vendedor (",s.deducoes.comissao.percentual,"%)"]}),e.jsx("span",{className:"font-semibold text-red-600",children:r(s.deducoes.comissao.valor)})]}),s.detalhamento_taxas&&s.detalhamento_taxas.length>0&&e.jsx(e.Fragment,{children:s.detalhamento_taxas.map((x,j)=>e.jsxs(ms.Fragment,{children:[x.taxa_percentual>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-600",children:["Taxa ",x.forma," (",x.taxa_percentual,"%)"]}),e.jsx("span",{className:"text-xs text-gray-500",children:r(x.valor_pagamento)})]}),e.jsx("span",{className:"font-semibold text-red-600",children:r(x.valor_taxa_percentual)})]}),x.taxa_fixa>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-600",children:["Taxa Fixa ",x.forma]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["R$ ",x.taxa_fixa.toFixed(2)]})]}),e.jsx("span",{className:"font-semibold text-red-600",children:r(x.valor_taxa_fixa)})]})]},j))}),(!s.detalhamento_taxas||s.detalhamento_taxas.length===0)&&s.deducoes.taxa_percentual>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Taxa Percentual"}),e.jsx("span",{className:"font-semibold text-red-600",children:r(s.deducoes.taxa_percentual)})]}),(!s.detalhamento_taxas||s.detalhamento_taxas.length===0)&&s.deducoes.taxa_fixa>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Taxa Fixa"}),e.jsx("span",{className:"font-semibold text-red-600",children:r(s.deducoes.taxa_fixa)})]}),s.deducoes.impostos.valor>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Impostos Estimados (",s.deducoes.impostos.percentual,"%)"]}),e.jsx("span",{className:"font-semibold text-red-600",children:r(s.deducoes.impostos.valor)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Custo dos Produtos"}),e.jsx("span",{className:"font-semibold text-red-600",children:r(s.deducoes.custos)})]}),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-semibold text-gray-700",children:[e.jsx("span",{children:"Total de DeduÃ§Ãµes"}),e.jsx("span",{className:"text-red-600",children:r(s.deducoes.total_deducoes)})]})})]})]}),e.jsxs("div",{className:`rounded-lg p-4 border-2 ${i(s.resultado.cor_indicador)}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ar,{className:"w-5 h-5"}),e.jsx("h4",{className:"font-bold",children:"Resultado Final"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold",children:"Lucro LÃ­quido Estimado"}),e.jsx("span",{className:"text-2xl font-bold",children:r(s.resultado.lucro_liquido)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Margem LÃ­quida"}),e.jsxs("span",{className:"text-xl font-bold",children:[s.resultado.margem_liquida.toFixed(2),"%"]})]})]})]}),s.alertas&&s.alertas.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ca,{className:"text-purple-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"Alertas e SugestÃµes"})]}),e.jsx("div",{className:"space-y-2",children:s.alertas.map((x,j)=>e.jsxs("div",{className:`flex items-start gap-2 p-2 rounded text-sm ${x.tipo==="success"?"bg-green-50":x.tipo==="error"?"bg-red-50":x.tipo==="warning"?"bg-yellow-50":"bg-blue-50"}`,children:[e.jsx("span",{className:"flex-shrink-0 mt-0.5",children:l(x.tipo)}),e.jsxs("span",{className:"flex-1",children:[e.jsx("span",{className:"mr-1",children:x.icone}),x.mensagem]})]},j))})]}),s.detalhamento_comissoes&&s.detalhamento_comissoes.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-3",children:"Detalhamento de ComissÃµes"}),e.jsx("div",{className:"space-y-2 text-sm",children:s.detalhamento_comissoes.map((x,j)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-700",children:x.produto}),e.jsxs("div",{className:"text-xs text-gray-500",children:[x.percentual,"% de comissÃ£o"]})]}),e.jsx("span",{className:"font-semibold text-blue-600",children:r(x.valor)})]},j))})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ca,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"Erro ao carregar anÃ¡lise"})]})})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("button",{onClick:t,className:"w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Fechar"}),e.jsx("span",{className:"text-xs text-gray-300",children:"(ESC)"})]})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes slide-in-right {
          from {
            transform: translateX(100%);
          }
          to {
            transform: translateX(0);
          }
        }
        
        .animate-slide-in-right {
          animation: slide-in-right 0.3s ease-out;
        }
      `})]})};function Ox({itensCarrinho:a=[],onClose:t=()=>{},isOpen:s=!1,racaoIdFechada:o=null}){const[r,i]=n.useState(null),[l,x]=n.useState(!1),[j,g]=n.useState(null),[v,d]=n.useState(null),[m,C]=n.useState(!1),y=a.filter(b=>Bl(b));n.useEffect(()=>{s&&(console.log("ðŸ¥« Modal: RaÃ§Ãµes encontradas:",y.length),y.forEach((b,u)=>{console.log(`  ${u+1}. ${b.produto_nome} - peso_embalagem: ${b.peso_embalagem}`)}))},[s,y.length]),n.useEffect(()=>{if(s&&y.length>0){const b=y[y.length-1];o!==b.produto_id&&(i(b.produto_id),g(null),d(null),x(!1))}},[s,y.length,o]);const c=y.find(b=>b.produto_id===r),f=async()=>{if(!c){d("RaÃ§Ã£o nÃ£o selecionada");return}if(!(c.peso_embalagem||c.peso_pacote_kg)||!c.preco_unitario){console.error("âŒ Modal: Dados da raÃ§Ã£o incompletos",{peso_embalagem:c.peso_embalagem,peso_pacote_kg:c.peso_pacote_kg,preco_unitario:c.preco_unitario}),d("Dados da raÃ§Ã£o incompletos");return}try{x(!0),d(null),g(null);const u=c.peso_embalagem||c.peso_pacote_kg||1,h={especie:"cao",peso_kg:15,fase:"adulto",porte:"medio",tipo_racao:"premium",peso_pacote_kg:parseFloat(u),preco_pacote:parseFloat(c.preco_unitario)||0};console.log("ðŸ§‘ Modal: Enviando payload:",h);const p=await F.post("/internal/racao/calcular",h);p.data?g(p.data):d("Sem resposta do servidor")}catch(u){console.error("Erro ao calcular:",u),d(null)}finally{x(!1)}};return!s||y.length===0?(s&&y.length===0&&console.warn("âš ï¸ Modal: isOpen=true mas racoes.length=0"),null):(console.log("âœ… Modal: Renderizando com",y.length,"raÃ§Ãµes"),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-4 flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ¥«"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Calculadora de RaÃ§Ã£o"}),e.jsx("p",{className:"text-sm text-blue-100",children:"InformaÃ§Ãµes rÃ¡pidas"})]})]}),e.jsx("button",{onClick:()=>{t()},className:"p-1 hover:bg-blue-400 rounded-lg transition-colors",title:"Fechar",children:e.jsx(pa,{size:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[y.length>1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Selecionar RaÃ§Ã£o"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>C(!m),className:"w-full px-4 py-2 bg-white border border-gray-300 rounded-lg text-left flex items-center justify-between hover:border-blue-500 transition-colors",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:(c==null?void 0:c.produto_nome)||"Selecione uma raÃ§Ã£o"}),e.jsx(Ys,{size:20,className:`text-gray-500 transition-transform ${m?"rotate-180":""}`})]}),m&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg z-10 max-h-48 overflow-y-auto",children:y.map((b,u)=>e.jsxs("button",{onClick:()=>{i(b.produto_id),C(!1),g(null)},className:`w-full px-4 py-3 text-left border-b last:border-b-0 hover:bg-blue-50 transition-colors ${b.produto_id===r?"bg-blue-100 border-l-4 border-l-blue-600":""}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:b.produto_nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:[b.peso_embalagem||b.peso_pacote_kg?`${b.peso_embalagem||b.peso_pacote_kg}kg`:""," â€¢ R$ ",(b.preco_unitario||0).toFixed(2)]})]},u))})]})]}),c&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 space-y-2",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:c.produto_nome}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Pacote:"}),e.jsx("span",{className:"font-medium",children:c.peso_pacote_kg?`${c.peso_pacote_kg}kg`:"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"PreÃ§o:"}),e.jsxs("span",{className:"font-medium text-blue-600",children:["R$ ",(c.preco_unitario||0).toFixed(2)]})]})]})]}),e.jsx("button",{onClick:f,disabled:l||!c,className:`w-full py-3 rounded-lg font-semibold transition-colors ${l||!c?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white cursor-pointer"}`,children:l?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(mo,{size:18,className:"animate-spin"}),"Calculando..."]}):"ðŸ“Š Calcular Consumo"}),j&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 space-y-3 border border-green-200",children:[e.jsx("h3",{className:"font-bold text-green-900 text-center",children:"âœ… CÃ¡lculo Realizado"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Consumo DiÃ¡rio"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:[(j.consumo_diario_gramas||0).toFixed(0),"g"]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"DuraÃ§Ã£o"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:[(j.duracao_pacote_dias||0).toFixed(1),"d"]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/Dia"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(j.custo_diario||0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/MÃªs"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(j.custo_mensal||0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100 col-span-2",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/kg"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(j.custo_por_kg||0).toFixed(2)]})]})]})]}),v&&e.jsx("div",{className:"bg-yellow-50 rounded-lg p-3 text-sm text-yellow-700 border border-yellow-200",children:"âš ï¸ NÃ£o foi possÃ­vel calcular. Tente novamente."}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 text-xs text-gray-600 border border-gray-200 italic",children:"ðŸ’¡ Valores calculados com base em dados padrÃ£o. Para anÃ¡lises personalizadas, utilize a calculadora completa."})]}),e.jsx("div",{className:"bg-gray-50 border-t px-6 py-3 flex justify-end gap-3 flex-shrink-0",children:e.jsx("button",{onClick:t,className:"px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-medium transition-colors",children:"Fechar"})})]})}))}function Vx({isOpen:a,onClose:t,clienteId:s,produtoId:o=null,onPendenciaAdicionada:r=()=>{}}){const[i,l]=n.useState("listar"),[x,j]=n.useState([]),[g,v]=n.useState([]),[d,m]=n.useState(!1),[C,y]=n.useState(""),[c,f]=n.useState([]),[b,u]=n.useState(!1),[h,p]=n.useState(null),k=n.useRef(null),[N,w]=n.useState({produto_id:o||"",quantidade_desejada:1,prioridade:"media",observacoes:""});n.useEffect(()=>{a&&s&&(S(),o||P())},[a,s]),n.useEffect(()=>{if(C.trim()==="")f(g);else{const $=g.filter(J=>{var E;return J.nome.toLowerCase().includes(C.toLowerCase())||((E=J.codigo)==null?void 0:E.toLowerCase().includes(C.toLowerCase()))});f($)}},[C,g]),n.useEffect(()=>{const $=J=>{k.current&&!k.current.contains(J.target)&&u(!1)};return document.addEventListener("mousedown",$),()=>{document.removeEventListener("mousedown",$)}},[]);const S=async()=>{try{m(!0);const J=(await F.get(`/pendencias-estoque/cliente/${s}`)).data;j(Array.isArray(J==null?void 0:J.pendencias)?J.pendencias:[])}catch($){console.error("Erro ao carregar pendÃªncias:",$),Ee.error("Erro ao carregar lista de espera"),j([])}finally{m(!1)}},P=async()=>{var $;try{const J=await F.get("/produtos/",{params:{page:1,page_size:1e3,ativo:!0}}),E=Array.isArray(($=J.data)==null?void 0:$.items)?J.data.items:[];console.log("Produtos carregados:",E.length,E),v(E),f(E)}catch(J){console.error("Erro ao carregar produtos:",J),Ee.error("Erro ao carregar produtos"),v([]),f([])}},W=$=>{p($),y($.nome),w({...N,produto_id:$.id}),u(!1)},te=()=>{p(null),y(""),w({...N,produto_id:""}),f(g)},D=async()=>{var J,E;if(!N.produto_id){Ee.error("Selecione um produto");return}const $={baixa:0,media:1,alta:2};try{m(!0),await F.post("/pendencias-estoque/",{cliente_id:s,produto_id:parseInt(N.produto_id),quantidade_desejada:parseFloat(N.quantidade_desejada),prioridade:$[N.prioridade]||1,observacoes:N.observacoes||null}),Ee.success("Cliente adicionado Ã  lista de espera!"),w({produto_id:"",quantidade_desejada:1,prioridade:"media",observacoes:""}),te(),l("listar"),S(),r()}catch(R){console.error("Erro ao adicionar pendÃªncia:",R),Ee.error(((E=(J=R.response)==null?void 0:J.data)==null?void 0:E.detail)||"Erro ao adicionar Ã  lista de espera")}finally{m(!1)}},A=async $=>{if(confirm("Deseja realmente cancelar esta pendÃªncia?"))try{await F.delete(`/pendencias-estoque/${$}`),Ee.success("PendÃªncia cancelada"),S()}catch(J){console.error("Erro ao cancelar pendÃªncia:",J),Ee.error("Erro ao cancelar pendÃªncia")}},X=async($,J)=>{try{await F.put(`/pendencias-estoque/${$}`,{prioridade:parseInt(J)}),Ee.success("Prioridade atualizada"),S()}catch(E){console.error("Erro ao alterar prioridade:",E),Ee.error("Erro ao alterar prioridade")}};if(!a)return null;const re=$=>{switch($){case 2:return"text-red-600 bg-red-50";case 1:return"text-yellow-600 bg-yellow-50";case 0:return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},M=$=>{switch($){case 2:return"ALTA";case 1:return"MÃ‰DIA";case 0:return"BAIXA";default:return"N/A"}},Z=$=>{switch($){case"pendente":return e.jsx(tt,{className:"w-4 h-4 text-yellow-500"});case"notificado":return e.jsx(xl,{className:"w-4 h-4 text-blue-500"});case"finalizado":return e.jsx(fa,{className:"w-4 h-4 text-green-500"});default:return e.jsx(xa,{className:"w-4 h-4 text-gray-500"})}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-blue-50 to-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xa,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Lista de Espera - Produtos Sem Estoque"})]}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-200 transition-colors",children:e.jsx(pa,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{onClick:()=>l("listar"),className:`flex-1 px-4 py-3 font-medium transition-colors ${i==="listar"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:bg-gray-50"}`,children:["Lista de Espera (",x.length,")"]}),e.jsx("button",{onClick:()=>l("adicionar"),className:`flex-1 px-4 py-3 font-medium transition-colors ${i==="adicionar"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:bg-gray-50"}`,children:"Adicionar PendÃªncia"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:i==="listar"?e.jsx("div",{className:"space-y-3",children:d?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Carregando..."}):x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xa,{className:"w-16 h-16 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Nenhuma pendÃªncia registrada"}),e.jsx("button",{onClick:()=>l("adicionar"),className:"mt-4 text-blue-600 hover:text-blue-700 font-medium",children:"Adicionar primeira pendÃªncia"})]}):x.map($=>e.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Z($.status),e.jsx("h3",{className:"font-semibold text-gray-900",children:$.produto_nome||"Produto nÃ£o encontrado"}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${re($.prioridade)}`,children:M($.prioridade)})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[$.produto_codigo&&e.jsxs("p",{children:["CÃ³digo: ",e.jsx("span",{className:"font-medium",children:$.produto_codigo})]}),e.jsxs("p",{children:["Quantidade: ",$.quantidade_desejada," un."]}),$.valor_referencia&&e.jsxs("p",{children:["Valor ref.: R$ ",parseFloat($.valor_referencia).toFixed(2)]}),e.jsxs("p",{children:["Status: ",e.jsx("span",{className:"font-medium",children:$.status})]}),e.jsxs("p",{children:["Registrado em: ",new Date($.data_registro).toLocaleDateString("pt-BR")]}),$.data_notificacao&&e.jsxs("p",{children:["Notificado em: ",new Date($.data_notificacao).toLocaleDateString("pt-BR")]}),$.observacoes&&e.jsxs("p",{className:"italic",children:["Obs: ",$.observacoes]})]})]}),e.jsx("div",{className:"flex flex-col gap-2 ml-4",children:$.status==="pendente"&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:$.prioridade,onChange:J=>X($.id,J.target.value),className:"text-xs border rounded px-2 py-1",children:[e.jsx("option",{value:"0",children:"Baixa"}),e.jsx("option",{value:"1",children:"MÃ©dia"}),e.jsx("option",{value:"2",children:"Alta"})]}),e.jsx("button",{onClick:()=>A($.id),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Cancelar pendÃªncia",children:e.jsx(Es,{className:"w-4 h-4"})})]})})]})},$.id))}):e.jsxs("div",{className:"space-y-4 max-w-lg mx-auto",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Produto *"}),o?e.jsx("input",{type:"text",value:"Produto selecionado",disabled:!0,className:"w-full px-3 py-2 border rounded-lg bg-gray-50"}):e.jsxs("div",{ref:k,className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Xs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",value:C,onChange:$=>y($.target.value),onFocus:()=>u(!0),placeholder:"Digite para buscar o produto...",className:"w-full pl-10 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),C&&e.jsx("button",{type:"button",onClick:te,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(pa,{className:"w-4 h-4"})})]}),b&&c.length>0&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[c.slice(0,50).map($=>e.jsxs("button",{type:"button",onClick:()=>W($),className:"w-full px-4 py-3 text-left hover:bg-blue-50 border-b last:border-b-0 transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900",children:$.nome}),e.jsxs("div",{className:"text-sm text-gray-500",children:[$.codigo&&`CÃ³digo: ${$.codigo} â€¢ `,"Estoque: ",$.estoque_atual||0,$.preco_venda&&` â€¢ R$ ${parseFloat($.preco_venda).toFixed(2)}`]})]},$.id)),c.length>50&&e.jsxs("div",{className:"px-4 py-2 text-sm text-gray-500 text-center bg-gray-50",children:["Mostrando 50 de ",c.length," produtos. Continue digitando para refinar."]})]}),b&&C&&c.length===0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg p-4",children:e.jsx("p",{className:"text-gray-500 text-center",children:"Nenhum produto encontrado"})}),h&&e.jsx("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"âœ“ Produto selecionado"}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:h.nome})]})})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantidade Desejada *"}),e.jsx("input",{type:"number",min:"1",value:N.quantidade_desejada,onChange:$=>w({...N,quantidade_desejada:parseInt($.target.value)||1}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prioridade"}),e.jsxs("select",{value:N.prioridade,onChange:$=>w({...N,prioridade:$.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"baixa",children:"Baixa - NÃ£o tem pressa"}),e.jsx("option",{value:"media",children:"MÃ©dia - Normal"}),e.jsx("option",{value:"alta",children:"Alta - Urgente"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ObservaÃ§Ãµes"}),e.jsx("textarea",{value:N.observacoes,onChange:$=>w({...N,observacoes:$.target.value}),rows:"3",placeholder:"Ex: Cliente pediu para avisar assim que chegar...",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"ðŸ“² O cliente serÃ¡ notificado automaticamente via WhatsApp"})," quando o produto entrar no estoque."]})}),e.jsx("button",{onClick:D,disabled:d,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition-colors",children:d?"Adicionando...":"Adicionar Ã  Lista de Espera"})]})})]})})}function qn(a){return a?a.variation_attributes&&typeof a.variation_attributes=="object"?Object.entries(a.variation_attributes).map(([s,o])=>`${s.charAt(0).toUpperCase()+s.slice(1)}: ${o}`).join(" | "):a.variation_signature?a.variation_signature.split("|").map(s=>{const[o,r]=s.split(":");return o&&r?`${o.charAt(0).toUpperCase()+o.slice(1)}: ${r}`:s}).join(" | "):"":""}function Bx(){var zo,Oo,Vo,Bo,Uo,Wo,Ho,Ko,Go;const a=va(),[t]=Kr(),{user:s}=$t(),o=(s==null?void 0:s.is_admin)===!0,[r,i]=n.useState({cliente:null,pet:null,itens:[],subtotal:0,desconto_valor:0,desconto_percentual:0,total:0,observacoes:"",funcionario_id:null,entregador_id:null,tem_entrega:!1,entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}}),[l,x]=n.useState(""),[j,g]=n.useState(""),[v,d]=n.useState([]),[m,C]=n.useState([]),[y,c]=n.useState(!1),[f,b]=n.useState(!1),[u,h]=n.useState(!1),[p,k]=n.useState(!1),[N,w]=n.useState(!1),[S,P]=n.useState(!1),[W,te]=n.useState(0),[D,A]=n.useState(null),[X,re]=n.useState([]),[M,Z]=n.useState("24h"),[$,J]=n.useState("todas"),[E,R]=n.useState(!1),[K,B]=n.useState(""),[_,O]=n.useState(!1),[q,ae]=n.useState(!1),[H,le]=n.useState(""),[G,ee]=n.useState(0),[de,ue]=n.useState(!1),[Ae,se]=n.useState(!1),[we,Se]=n.useState(null),[ea,Ie]=n.useState(!1),[Je,be]=n.useState(!1),[Fe,he]=n.useState(null),[Qe,Ze]=n.useState(!1),[ma,oa]=n.useState("valor"),[ha,da]=n.useState(0),[oe,Ne]=n.useState(!1),[ke,Ue]=n.useState(null),[ze,Y]=n.useState([]),[ve,Le]=n.useState(""),[I,Q]=n.useState(null),[fe,U]=n.useState([]),[ie,_e]=n.useState(null),[$e,T]=n.useState(0);n.useEffect(()=>{i(z=>({...z,funcionario_id:(ke==null?void 0:ke.id)||null}))},[ke]),n.useEffect(()=>{console.log("ðŸ”„ Sincronizando entregador_id:",(ie==null?void 0:ie.id)||null),i(z=>({...z,entregador_id:(ie==null?void 0:ie.id)||null}))},[ie]);const[ne,pe]=n.useState(!1),[Pe,Be]=n.useState(null),[Ke,Ge]=n.useState(!1),[aa,la]=n.useState({}),[ca,We]=n.useState(()=>{const z=localStorage.getItem("pdv_painel_vendas_aberto");return z?JSON.parse(z):!1}),[Sa,V]=n.useState(()=>{const z=localStorage.getItem("pdv_painel_cliente_aberto");return z?JSON.parse(z):!1}),[Re,Oe]=n.useState(!1),[He,ga]=n.useState([]),[xe,De]=n.useState({}),[qe,ta]=n.useState(0),[Va,ya]=n.useState(!1),[Pa,wa]=n.useState(null),os=n.useRef(null);n.useEffect(()=>{localStorage.setItem("pdv_painel_vendas_aberto",JSON.stringify(ca))},[ca]),n.useEffect(()=>{r.cliente&&Dt()},[r.cliente]),n.useEffect(()=>{var z;r.itens&&r.itens.length>0?sessionStorage.setItem("pdv_calculadora_data",JSON.stringify({itens:r.itens,clienteId:((z=r.cliente)==null?void 0:z.id)||null})):sessionStorage.removeItem("pdv_calculadora_data")},[r.itens,r.cliente]),n.useEffect(()=>{localStorage.setItem("pdv_painel_cliente_aberto",JSON.stringify(Sa))},[Sa]),n.useEffect(()=>{lr();const z=setInterval(()=>{lr()},3e4);return()=>clearInterval(z)},[G]);const lr=async()=>{try{const z=await F.get("/caixas/aberto");ue(!!z.data)}catch{ue(!1)}};n.useEffect(()=>{At()},[]);const At=async()=>{try{const z=await F.get("/clientes/",{params:{is_entregador:!0,incluir_inativos:!1,limit:100}});let me=z.data.items||z.data.clientes||z.data||[];Array.isArray(me)||(console.error("âŒ Resposta da API nÃ£o Ã© um array:",me),me=[]),U(me);const Ce=me.find(ye=>ye.entregador_padrao===!0);Ce&&(_e(Ce),i(ye=>({...ye,entregador_id:Ce.id})),zs(Ce))}catch(z){console.error("Erro ao carregar entregadores:",z),Ee.error("Erro ao carregar lista de entregadores")}},zs=async z=>{if(!z){T(0);return}let me=0;if(z.modelo_custo_entrega==="taxa_fixa"&&z.taxa_fixa_entrega)me=Number(z.taxa_fixa_entrega);else if(z.modelo_custo_entrega==="por_km"&&z.valor_por_km_entrega)me=0;else if(z.modelo_custo_entrega==="rateio_rh"&&z.controla_rh)try{me=(await F.get(`/entregadores/${z.id}/custo-operacional`)).data.custo_por_entrega||0}catch(Ce){console.error("Erro ao buscar custo RH:",Ce),me=z.custo_rh_ajustado||0}else try{me=(await F.get("/configuracoes/entregas")).data.taxa_fixa||0}catch(Ce){console.error("Erro ao buscar configuraÃ§Ã£o de entrega:",Ce),me=10}T(me)};n.useEffect(()=>{r.tem_entrega&&ie?zs(ie):T(0)},[ie,r.tem_entrega]);const Dt=async()=>{if(!r.cliente){te(0);return}try{const me=(await F.get(`/pendencias-estoque/cliente/${r.cliente.id}`)).data.filter(Ce=>Ce.status==="pendente"||Ce.status==="notificado");te(me.length)}catch{te(0)}},ir=async z=>{if(!z||!r.cliente){ga([]);return}try{const Ce=(await F.get(`/internal/pdv/oportunidades/${z}`)).data;Ce&&Array.isArray(Ce.oportunidades)?ga(Ce.oportunidades):ga([])}catch{ga([])}},it=async(z,me)=>{try{const Ce={opportunity_id:me.id,event_type:z,user_id:s==null?void 0:s.id,contexto:"PDV",extra_data:{produto_origem_id:me.produto_origem_id||null,produto_sugerido_id:me.produto_sugerido_id||null,tipo_oportunidade:me.tipo||null,venda_id:r.id||null}};F.post("/internal/pdv/eventos-oportunidade",Ce).catch(()=>{})}catch{}};async function dr(z){try{const me={produto_id:z.produto_id,preco_unitario:z.preco_unitario,quantidade:z.quantidade},{data:Ce}=await F.post("/pdv/fiscal/calcular",me);return Ce}catch(me){return console.error("Erro ao calcular fiscal:",me),null}}n.useEffect(()=>{async function z(){let me=0;const Ce={};for(const ye of r.itens){const Te=await dr(ye);Te&&(Ce[ye.produto_id]=Te,me+=Number(Te.total_impostos))}De(Ce),ta(me.toFixed(2))}r.itens&&r.itens.length>0?z():(De({}),ta(0))},[r.itens]),n.useEffect(()=>{Fs()},[M,$,E,K]),n.useEffect(()=>{const z=t.get("venda");z&&Os(parseInt(z))},[t]),n.useEffect(()=>{const z=sessionStorage.getItem("abrirVenda"),me=sessionStorage.getItem("abrirModalPagamento");z&&me==="true"&&(sessionStorage.removeItem("abrirVenda"),sessionStorage.removeItem("abrirModalPagamento"),Os(parseInt(z),!0))},[]);const cr=()=>{Se({tipo:"entrega",apelido:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",estado:""}),se(!0)},dt=()=>{se(!1),Se(null)},xr=async z=>{if(!(!z||z.length!==9)){Ie(!0);try{const Ce=await(await fetch(`https://viacep.com.br/ws/${z.replace("-","")}/json/`)).json();if(Ce.erro){alert("CEP nÃ£o encontrado");return}Se(ye=>({...ye,endereco:Ce.logradouro||"",bairro:Ce.bairro||"",cidade:Ce.localidade||"",estado:Ce.uf||""}))}catch(me){console.error("Erro ao buscar CEP:",me),alert("Erro ao buscar CEP")}finally{Ie(!1)}}},mr=async()=>{if(!we.cep||!we.endereco||!we.cidade){alert("Preencha pelo menos CEP, EndereÃ§o e Cidade");return}if(!r.cliente||!r.cliente.id){alert("Selecione um cliente primeiro");return}try{const z=await It(r.cliente.id),me=z.enderecos_adicionais||[];me.push({...we}),await F.put(`/clientes/${r.cliente.id}`,{...z,enderecos_adicionais:me});const Ce=await It(r.cliente.id);i({...r,cliente:Ce}),alert("EndereÃ§o adicionado com sucesso!"),dt()}catch(z){console.error("Erro ao salvar endereÃ§o:",z),alert("Erro ao salvar endereÃ§o. Tente novamente.")}},ur=z=>{he({...z,preco:z.preco_unitario,descontoValor:z.desconto_valor||0,descontoPercentual:z.desconto_percentual||0,tipoDesconto:"valor"}),be(!0)},pr=()=>{const z=r.itens.map(me=>{if(me.produto_id===Fe.produto_id){const Ce=Fe.preco,ye=me.quantidade,Te=Ce*ye;let sa=0,ra=0;Fe.tipoDesconto==="valor"?(sa=parseFloat(Fe.descontoValor)||0,ra=Te>0?sa/Te*100:0):(ra=parseFloat(Fe.descontoPercentual)||0,sa=Te*ra/100);const ba=Ce-sa/ye,Fa=Te-sa;return{...me,desconto_valor:sa,desconto_percentual:ra,tipo_desconto_aplicado:Fe.tipoDesconto,preco_com_desconto:ba,subtotal:Fa}}return me});Xa(z),be(!1),he(null)},gr=()=>{Ze(!0)},hr=(z,me)=>{var ba;const Ce=r.subtotal;let ye=0,Te=0;z==="valor"?(ye=parseFloat(me)||0,Te=Ce>0?ye/Ce*100:0):(Te=parseFloat(me)||0,ye=Ce*Te/100);const sa=r.tem_entrega&&((ba=r.entrega)==null?void 0:ba.taxa_entrega_total)||0,ra=Ce-ye+sa;i({...r,desconto_valor:ye,desconto_percentual:Te,total:ra}),Ze(!1)},Fs=async()=>{try{const z=new Date;let me;M==="24h"?me=new Date(z.getTime()-24*60*60*1e3):M==="7d"?me=new Date(z.getTime()-7*24*60*60*1e3):me=new Date(z.getTime()-30*24*60*60*1e3);const Ce={data_inicio:me.toISOString().split("T")[0],data_fim:z.toISOString().split("T")[0],per_page:50};K.trim()?(Ce.busca=K.trim(),delete Ce.data_inicio,delete Ce.data_fim):($==="pago"?Ce.status="finalizada":$==="aberta"&&(Ce.status="aberta"),E===!0&&(Ce.tem_entrega=!0)),console.log("ðŸ“Š ParÃ¢metros de busca de vendas:",Ce);const ye=await Tn(Ce);re(ye.vendas||[])}catch(z){console.error("Erro ao carregar vendas:",z)}},Os=async(z,me=!1)=>{var Ce;try{O(!0);const ye=await wr(z);if(!ye){alert("Venda nÃ£o encontrada");return}let Te=null;if(ye.cliente_id)try{Te=await It(ye.cliente_id)}catch(ua){console.error("Erro ao buscar cliente:",ua)}let sa=[],ra=0;try{const ua=await F.get(`/vendas/${z}/pagamentos`);sa=ua.data.pagamentos||[],ra=ua.data.total_pago||0}catch(ua){console.error("Erro ao buscar pagamentos:",ua)}console.log("ðŸ” Venda carregada - funcionario_id:",ye.funcionario_id);let ba=null;if(ye.funcionario_id)try{const Ia=((Ce=(await F.get("/comissoes/configuracoes/funcionarios")).data)==null?void 0:Ce.data)||[];console.log("ðŸ“‹ FuncionÃ¡rios disponÃ­veis:",Ia),ba=Ia.find(ns=>ns.id===ye.funcionario_id),ba?(Ne(!0),Ue(ba),console.log("âœ… FuncionÃ¡rio comissÃ£o carregado:",ba)):console.warn("âš ï¸ FuncionÃ¡rio ID",ye.funcionario_id,"nÃ£o encontrado na lista")}catch(ua){console.error("Erro ao carregar funcionÃ¡rio de comissÃ£o:",ua)}else console.log("â„¹ï¸ Venda sem funcionario_id - limpando estados de comissÃ£o"),Ne(!1),Ue(null),Le("");const Fa={id:ye.id,numero_venda:ye.numero_venda,status:ye.status,data_venda:ye.data_venda,cliente:Te,pet:null,itens:ye.itens||[],subtotal:ye.subtotal||0,desconto_valor:ye.desconto_valor||0,desconto_percentual:ye.desconto_percentual||0,total:ye.total||0,observacoes:ye.observacoes||"",funcionario_id:ye.funcionario_id||null,entregador_id:ye.entregador_id||null,tem_entrega:ye.tem_entrega||!1,entrega:ye.entrega||{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""},pagamentos:sa,total_pago:ra};if(i(Fa),ae(!0),ye.entregador_id){console.log("ðŸ” Venda tem entregador_id:",ye.entregador_id);try{const Ia=(await F.get(`/clientes/${ye.entregador_id}`)).data;Ia&&Ia.is_entregador?(console.log("âœ… Entregador carregado:",Ia.nome),_e(Ia),zs(Ia)):console.warn("âš ï¸ Cliente ID",ye.entregador_id,"nÃ£o Ã© um entregador vÃ¡lido")}catch(ua){console.error("âŒ Erro ao carregar entregador:",ua);const Ia=fe.find(ns=>ns.id===ye.entregador_id);Ia&&(console.log("âœ… Entregador encontrado no array (fallback):",Ia.nome),_e(Ia),zs(Ia))}}else console.log("â„¹ï¸ Venda sem entregador_id - limpando entregadorSelecionado"),_e(null);me&&setTimeout(()=>{c(!0)},500)}catch(ye){console.error("Erro ao carregar venda:",ye),alert("Erro ao carregar venda: "+(ye.message||"Erro desconhecido"))}finally{O(!1)}},Mt=async()=>{var z;if(H.trim())try{O(!0);const me=H.replace(/\D/g,"");if(!me){alert("Digite um nÃºmero de venda vÃ¡lido"),O(!1);return}console.log("ðŸ” Buscando venda com nÃºmero:",me);const Ce=await Tn({busca:me,per_page:50});if(console.log("ðŸ“Š Vendas encontradas:",(z=Ce.vendas)==null?void 0:z.length),!Ce.vendas||Ce.vendas.length===0){alert(`Nenhuma venda encontrada com "${me}"`),O(!1);return}if(Ce.vendas.length===1){await Os(Ce.vendas[0].id),le("");return}const ye=Ce.vendas.slice(0,10).map((ra,ba)=>`${ba+1}. ${ra.numero_venda} - ${ra.cliente_nome||"Sem cliente"} - ${ra.status}`).join(`
`),Te=prompt(`Encontradas ${Ce.vendas.length} vendas. Digite o nÃºmero da opÃ§Ã£o:

${ye}`),sa=parseInt(Te)-1;sa>=0&&sa<Ce.vendas.length&&(await Os(Ce.vendas[sa].id),le(""))}catch(me){console.error("Erro ao buscar venda:",me),alert("Erro ao buscar venda: "+(me.message||"Erro desconhecido"))}finally{O(!1)}};n.useEffect(()=>{if(l.length>=2){const z=setTimeout(async()=>{try{const me=await jx({search:l});d(me||[])}catch(me){console.error("Erro ao buscar clientes:",me),d([])}},300);return()=>clearTimeout(z)}else d([])},[l]),n.useEffect(()=>{if(j.length>=2){const z=setTimeout(async()=>{try{const Ce=(await zc({busca:j})).data.items||[];C(Ce)}catch(me){console.error("Erro ao buscar produtos:",me),C([])}},300);return()=>clearTimeout(z)}else C([])},[j]);const L=async z=>{i({...r,cliente:z,pet:null}),x(""),d([]);try{const me=await F.get(`/clientes/${z.id}/vendas-em-aberto`);me.data.resumo.total_vendas>0?A(me.data.resumo):A(null)}catch(me){console.error("Erro ao verificar vendas em aberto:",me),A(null)}},ge=z=>{i({...r,pet:z})},Me=z=>{var ye,Te;if(!de){alert("âŒ NÃ£o Ã© possÃ­vel adicionar produtos sem caixa aberto. Abra um caixa primeiro.");return}console.log("ðŸ›’ Produto sendo adicionado:",{nome:z.nome,categoria_id:z.categoria_id,categoria_nome:z.categoria_nome,peso_embalagem:z.peso_embalagem,classificacao_racao:z.classificacao_racao});const me=r.itens.find(sa=>sa.produto_id===z.id);let Ce;me?Ce=r.itens.map(sa=>sa.produto_id===z.id?{...sa,quantidade:sa.quantidade+1,subtotal:(sa.quantidade+1)*sa.preco_unitario}:sa):Ce=[...r.itens,{tipo:"produto",produto_id:z.id,produto_nome:z.nome,quantidade:1,preco_unitario:parseFloat(z.preco_venda),desconto_item:0,subtotal:parseFloat(z.preco_venda),pet_id:((ye=r.pet)==null?void 0:ye.id)||null,tipo_produto:z.tipo_produto,tipo_kit:z.tipo_kit,composicao_kit:z.composicao_kit||[],categoria_id:z.categoria_id,categoria_nome:z.categoria_nome,peso_pacote_kg:z.peso_liquido||z.peso_bruto,peso_embalagem:z.peso_embalagem,classificacao_racao:z.classificacao_racao}],Xa(Ce),g(""),C([]),(Te=os.current)==null||Te.focus()},Ye=(z,me)=>{const Ce=r.itens.map((ye,Te)=>{if(Te===z){const sa=Math.max(1,ye.quantidade+me),ra=sa*ye.preco_unitario;let ba=ye.desconto_valor||0;ye.tipo_desconto_aplicado==="percentual"&&ye.desconto_percentual>0&&(ba=ra*ye.desconto_percentual/100);const Fa=ra-ba;return{...ye,quantidade:sa,desconto_valor:ba,subtotal:Fa}}return ye});Xa(Ce)},Ve=z=>{const me=r.itens.filter((Ce,ye)=>ye!==z);Xa(me)},Na=z=>{la(me=>({...me,[z]:!me[z]}))},Xa=z=>{var ba;const me=z.reduce((Fa,ua)=>Fa+ua.subtotal,0),Ce=z.reduce((Fa,ua)=>Fa+(ua.desconto_valor||0),0),ye=me+Ce,Te=ye>0?Ce/ye*100:0,sa=r.tem_entrega&&((ba=r.entrega)==null?void 0:ba.taxa_entrega_total)||0,ra=me+sa;i({...r,itens:z,subtotal:me,desconto_valor:Ce,desconto_percentual:Te,total:ra})},Ea=async()=>{var z,me,Ce,ye,Te,sa,ra,ba,Fa,ua,Ia,ns,Vs,xt,fr,Xo,Qo,Jo,Yo,Zo,en,an,sn,tn;if(r.itens.length===0){alert("Adicione pelo menos um produto ou serviÃ§o");return}if(!de){alert("âŒ NÃ£o Ã© possÃ­vel salvar venda sem caixa aberto. Abra um caixa primeiro.");return}if(!_){O(!0);try{if(r.id){await F.put(`/vendas/${r.id}`,{cliente_id:(z=r.cliente)==null?void 0:z.id,funcionario_id:r.funcionario_id,itens:r.itens.map(Za=>{var Lt;return{tipo:Za.tipo,produto_id:Za.produto_id,servico_descricao:Za.servico_descricao,quantidade:Za.quantidade,preco_unitario:Za.preco_unitario||Za.preco_venda,desconto_item:0,subtotal:Za.subtotal,lote_id:Za.lote_id,pet_id:Za.pet_id||((Lt=r.pet)==null?void 0:Lt.id)}}),desconto_valor:0,desconto_percentual:0,observacoes:r.observacoes,tem_entrega:r.tem_entrega,taxa_entrega:((me=r.entrega)==null?void 0:me.taxa_entrega_total)||0,endereco_entrega:(Ce=r.entrega)==null?void 0:Ce.endereco_completo,observacoes_entrega:(ye=r.entrega)==null?void 0:ye.observacoes_entrega,distancia_km:(Te=r.entrega)==null?void 0:Te.distancia_km,valor_por_km:(sa=r.entrega)==null?void 0:sa.valor_por_km,loja_origem:(ra=r.entrega)==null?void 0:ra.loja_origem,entregador_id:r.entregador_id}),console.log("ðŸš¨ DEBUG - Payload sendo enviado:",{tem_entrega:r.tem_entrega,entregador_id:r.entregador_id,vendaAtual_completo:r});let Qa=0;try{Qa=(await F.get(`/vendas/${r.id}/pagamentos`)).data.total_pago||0}catch(Za){console.error("Erro ao buscar pagamentos:",Za)}const Bs=r.total;let Rs="aberta";Qa>=Bs-.01?Rs="finalizada":Qa>0&&(Rs="baixa_parcial"),r.status!==Rs&&(await F.patch(`/vendas/${r.id}/status`,{status:Rs}),console.log(`âœ… Status atualizado: ${r.status} â†’ ${Rs}`)),alert("Venda atualizada com sucesso!"),is()}else{console.log("ðŸš€ CRIANDO VENDA - VersÃ£o 2.0 - DESCONTOS ZERADOS"),console.log("Desconto valor:",0),console.log("Desconto percentual:",0),console.log("âœ… Checkbox Venda Comissionada:",oe),console.log("ðŸ’¼ FuncionÃ¡rio ComissÃ£o:",ke),console.log("ðŸ“‹ FuncionÃ¡rio ID enviado:",(ke==null?void 0:ke.id)||null),oe&&!ke&&console.error("âš ï¸ ERRO: Checkbox marcado mas funcionÃ¡rio nÃ£o selecionado!");const Qa=((ba=r.entrega)==null?void 0:ba.taxa_entrega_total)||0,Bs=((Fa=r.entrega)==null?void 0:Fa.taxa_loja)||0,Rs=((ua=r.entrega)==null?void 0:ua.taxa_entregador)||0,Za=Qa>0?Bs/Qa*100:100,Lt=Qa>0?Rs/Qa*100:0,rn={cliente_id:(Ia=r.cliente)==null?void 0:Ia.id,funcionario_id:r.funcionario_id,itens:r.itens.map(_s=>{var on;return{tipo:_s.tipo,produto_id:_s.produto_id,servico_descricao:_s.servico_descricao,quantidade:_s.quantidade,preco_unitario:_s.preco_unitario||_s.preco_venda,desconto_item:0,subtotal:_s.subtotal,lote_id:_s.lote_id,pet_id:_s.pet_id||((on=r.pet)==null?void 0:on.id)}}),desconto_valor:0,desconto_percentual:0,observacoes:r.observacoes,tem_entrega:r.tem_entrega,taxa_entrega:((ns=r.entrega)==null?void 0:ns.taxa_entrega_total)||0,percentual_taxa_loja:Za,percentual_taxa_entregador:Lt,endereco_entrega:(Vs=r.entrega)==null?void 0:Vs.endereco_completo,observacoes_entrega:(xt=r.entrega)==null?void 0:xt.observacoes_entrega,distancia_km:(fr=r.entrega)==null?void 0:fr.distancia_km,valor_por_km:(Xo=r.entrega)==null?void 0:Xo.valor_por_km,loja_origem:(Qo=r.entrega)==null?void 0:Qo.loja_origem,entregador_id:r.entregador_id};console.log("ðŸ“¦ PAYLOAD COMPLETO antes de enviar:",JSON.stringify(rn,null,2)),console.log("ðŸšš Dados de entrega:",{tem_entrega:r.tem_entrega,entregador_id:r.entregador_id,entregadorSelecionado:ie==null?void 0:ie.id,vendaAtual_completo:r}),console.log("ðŸ’° Percentuais calculados:",{taxaTotal:Qa,taxaLoja:Bs,taxaEntregador:Rs,percentualLoja:`${Za.toFixed(2)}%`,percentualEntregador:`${Lt.toFixed(2)}%`}),await Kl(rn),alert("Venda salva com sucesso!"),is()}Fs()}catch(Qa){console.error("âŒ Erro ao salvar venda:",Qa),console.error("âŒ Resposta do servidor:",(Jo=Qa.response)==null?void 0:Jo.data),console.error("âŒ Status:",(Yo=Qa.response)==null?void 0:Yo.status),console.error("âŒ Headers:",(Zo=Qa.response)==null?void 0:Zo.headers);const Bs=((an=(en=Qa.response)==null?void 0:en.data)==null?void 0:an.detail)||((tn=(sn=Qa.response)==null?void 0:sn.data)==null?void 0:tn.message)||"Erro ao salvar venda";console.error("âŒ Detalhes do erro:",Bs),alert(`Erro ao salvar venda: ${Bs}`)}finally{O(!1)}}},Ba=async z=>{var me;console.log("ðŸ” DEBUG formasPagamento recebidas:",z),Ge(!0),pe(!0);try{console.log("ðŸ’° Enviando anÃ¡lise com mÃºltiplas formas:",z);const Ce=await F.post("/formas-pagamento/analisar-venda",{items:r.itens.map(ye=>({produto_id:ye.produto_id,quantidade:ye.quantidade,preco_venda:ye.preco_unitario||ye.preco_venda,custo:ye.custo})),desconto:r.desconto_valor||0,taxa_entrega:((me=r.entrega)==null?void 0:me.taxa_entrega_total)||0,formas_pagamento:z,vendedor_id:r.funcionario_id});console.log("âœ… Resposta da anÃ¡lise:",Ce.data),Be(Ce.data)}catch(Ce){console.error("Erro ao buscar anÃ¡lise:",Ce),alert("Erro ao carregar anÃ¡lise da venda"),pe(!1)}finally{Ge(!1)}},Ps=()=>{if(r.itens.length===0){alert("Adicione pelo menos um produto ou serviÃ§o");return}if(r.status==="finalizada"||r.status==="pago_nf"){alert('Esta venda estÃ¡ finalizada. Clique em "Reabrir Venda" para modificar.');return}c(!0)},is=()=>{i({cliente:null,pet:null,itens:[],subtotal:0,desconto_valor:0,desconto_percentual:0,total:0,observacoes:"",funcionario_id:null,entregador_id:(ie==null?void 0:ie.id)||null,tem_entrega:!1,entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}}),Ne(!1),Ue(null),Le(""),ae(!1)},br=async z=>{var me,Ce,ye;try{const Te=await wr(z.id);let sa=null;Te.cliente_id&&(sa=await It(Te.cliente_id));let ra=[],ba=0;try{const ua=await F.get(`/vendas/${z.id}/pagamentos`);ra=ua.data.pagamentos||[],ba=ua.data.total_pago||0}catch(ua){console.error("Erro ao buscar pagamentos:",ua)}if(console.log("ðŸ” Venda carregada - funcionario_id:",Te.funcionario_id),Te.funcionario_id)try{const ns=(((me=(await F.get("/comissoes/configuracoes/funcionarios")).data)==null?void 0:me.data)||[]).find(Vs=>Vs.id===Te.funcionario_id);ns?(Ne(!0),Ue(ns),console.log("âœ… FuncionÃ¡rio comissÃ£o carregado:",ns)):console.warn("âš ï¸ FuncionÃ¡rio ID",Te.funcionario_id,"nÃ£o encontrado na lista")}catch(ua){console.error("Erro ao carregar funcionÃ¡rio de comissÃ£o:",ua)}else console.log("â„¹ï¸ Venda sem funcionario_id - limpando estados de comissÃ£o"),Ne(!1),Ue(null),Le("");const Fa={id:Te.id,numero_venda:Te.numero_venda,data_venda:Te.data_venda,cliente:sa,pet:null,itens:Te.itens||[],subtotal:parseFloat(Te.subtotal||Te.total),desconto_valor:parseFloat(Te.desconto_valor||0),desconto_percentual:parseFloat(Te.desconto_percentual||0),total:parseFloat(Te.total),observacoes:Te.observacoes||"",status:Te.status,tem_entrega:Te.tem_entrega||!1,entregador_id:Te.entregador_id||null,entrega:{endereco_completo:Te.endereco_entrega||"",endereco_id:Te.endereco_id||null,taxa_entrega_total:parseFloat(parseFloat(Te.taxa_entrega||0).toFixed(2)),taxa_loja:parseFloat(parseFloat(((Ce=Te.entrega)==null?void 0:Ce.taxa_loja)||0).toFixed(2)),taxa_entregador:parseFloat(parseFloat(((ye=Te.entrega)==null?void 0:ye.taxa_entregador)||0).toFixed(2)),observacoes_entrega:Te.observacoes_entrega||"",distancia_km:Te.distancia_km||0,valor_por_km:Te.valor_por_km||0,loja_origem:Te.loja_origem||"",status_entrega:Te.status_entrega||"pendente"},pagamentos:ra,total_pago:ba};i(Fa),ae(!0),window.scrollTo({top:0,behavior:"smooth"})}catch(Te){console.error("Erro ao reabrir venda:",Te),alert("Erro ao carregar os dados da venda")}},ct=()=>{ae(!1)},li=async()=>{if(!r.id){is();return}if(I&&r.status!==I)try{O(!0),await F.patch(`/vendas/${r.id}/status`,{status:I}),console.log(`âœ… Status restaurado para: ${I} (alteraÃ§Ãµes descartadas)`)}catch(z){console.error("Erro ao restaurar status:",z)}finally{O(!1)}Q(null),is()},ii=async()=>{var me,Ce;if(!(!r.id||!window.confirm(`Deseja realmente excluir esta venda?

Esta aÃ§Ã£o nÃ£o pode ser desfeita e o estoque serÃ¡ devolvido.`)))try{O(!0),await F.delete(`/vendas/${r.id}`),is(),Fs(),alert("Venda excluÃ­da com sucesso!")}catch(ye){console.error("Erro ao excluir venda:",ye);const Te=(Ce=(me=ye.response)==null?void 0:me.data)==null?void 0:Ce.detail;if(Te&&typeof Te=="object"){let sa=`âŒ ${Te.erro||"Erro ao excluir venda"}

`;sa+=`${Te.mensagem||""}

`,Te.solucao&&(sa+=`ðŸ’¡ SoluÃ§Ã£o:
${Te.solucao}

`),Te.passos&&Array.isArray(Te.passos)&&(sa+=`ðŸ“‹ Passos para resolver:
`,Te.passos.forEach(ra=>{sa+=`${ra}
`})),Te.rota_id&&(sa+=`
ðŸšš Rota ID: ${Te.rota_id}`,Te.rota_status&&(sa+=` (${Te.rota_status})`)),alert(sa)}else alert(typeof Te=="string"?Te:"Erro ao excluir venda. Verifique se nÃ£o hÃ¡ vÃ­nculos pendentes.")}finally{O(!1)}},di=async()=>{var me,Ce;if(!(!r.id||!window.confirm(`Deseja reabrir esta venda?

Os pagamentos serÃ£o mantidos e o status mudarÃ¡ para "aberta".`))){Q(r.status);try{O(!0),await F.post(`/vendas/${r.id}/reabrir`);const ye=await wr(r.id);let Te=null;ye.cliente_id&&(Te=await It(ye.cliente_id)),i({id:ye.id,numero_venda:ye.numero_venda,data_venda:ye.data_venda,cliente:Te,pet:null,itens:ye.itens||[],subtotal:parseFloat(ye.subtotal||ye.total),desconto_valor:parseFloat(ye.desconto_valor||0),desconto_percentual:parseFloat(ye.desconto_percentual||0),total:parseFloat(ye.total),observacoes:ye.observacoes||"",status:"aberta",tem_entrega:ye.tem_entrega||!1,entrega:{endereco_completo:ye.endereco_entrega||"",endereco_id:ye.endereco_id||null,taxa_entrega_total:parseFloat(parseFloat(ye.taxa_entrega||0).toFixed(2)),taxa_loja:parseFloat(parseFloat(ye.taxa_loja||0).toFixed(2)),taxa_entregador:parseFloat(parseFloat(ye.taxa_entregador||0).toFixed(2)),observacoes_entrega:ye.observacoes_entrega||"",distancia_km:ye.distancia_km||0,valor_por_km:ye.valor_por_km||0,loja_origem:ye.loja_origem||"",status_entrega:ye.status_entrega||"pendente"}}),ae(!1),alert(`Venda reaberta com sucesso! Agora vocÃª pode editÃ¡-la.

ATENÃ‡ÃƒO: Se vocÃª nÃ£o fizer alteraÃ§Ãµes e sair, a venda voltarÃ¡ ao status anterior.`)}catch(ye){console.error("Erro ao reabrir venda:",ye),alert(((Ce=(me=ye.response)==null?void 0:me.data)==null?void 0:Ce.detail)||"Erro ao reabrir venda")}finally{O(!1)}}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"bg-white border-b px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(qr,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Ponto de Venda"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Buscar venda (Ex: 0011)",value:H,onChange:z=>le(z.target.value),onKeyPress:z=>{z.key==="Enter"&&H.trim()&&Mt()},className:"pl-10 pr-4 py-2 w-64 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"}),e.jsx(Xs,{className:"w-5 h-5 text-gray-400 absolute left-3 top-2.5"})]}),e.jsx("button",{onClick:Mt,disabled:!H.trim()||_,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Buscar"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[r.cliente&&e.jsxs("button",{onClick:()=>P(!0),className:"flex items-center space-x-2 px-4 py-2 bg-white hover:bg-orange-50 border-2 border-orange-400 rounded-lg transition-colors relative",title:"Lista de espera - Produtos sem estoque",children:[e.jsx(xl,{className:"w-5 h-5 text-orange-500"}),W>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center",children:W})]}),r.cliente&&e.jsxs("button",{onClick:()=>{Oe(!0),r.id&&ir(r.id)},className:"flex items-center space-x-2 px-4 py-2 bg-white hover:bg-yellow-50 border-2 border-yellow-400 rounded-lg transition-colors",title:"Ver oportunidades de venda",children:[e.jsx(cn,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"}),He.length>0&&e.jsx("span",{className:"font-semibold text-yellow-600",children:Math.min(He.length,6)})]}),e.jsx(Mx,{onAbrirCaixa:()=>h(!0)},G),e.jsxs("button",{onClick:()=>a("/meus-caixas"),className:"flex items-center space-x-2 px-4 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-colors",title:"Ver histÃ³rico de caixas",children:[e.jsx(kt,{className:"w-5 h-5"}),e.jsx("span",{children:"Meus Caixas"})]}),!q&&r.id&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:li,disabled:_,className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(pa,{className:"w-5 h-5"}),e.jsx("span",{children:"Cancelar EdiÃ§Ã£o"})]}),e.jsxs("button",{onClick:ii,disabled:_,className:"flex items-center space-x-2 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Es,{className:"w-5 h-5"}),e.jsx("span",{children:"Excluir"})]})]}),e.jsxs("button",{onClick:Ea,disabled:_||q||!de,className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:de?"Salvar venda atual":"ðŸ”’ Caixa fechado - Abra o caixa para salvar vendas",children:[e.jsx(Kt,{className:"w-5 h-5"}),e.jsx("span",{children:"Salvar"}),!de&&e.jsx("span",{className:"text-xs",children:"ðŸ”’"})]}),e.jsxs("button",{onClick:Ps,disabled:_||r.status==="finalizada"||r.status==="pago_nf"||!de,className:"flex items-center space-x-2 px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:de?"Registrar pagamento da venda":"ðŸ”’ Caixa fechado - Abra o caixa para registrar recebimentos",children:[e.jsx(Ct,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"}),!de&&e.jsx("span",{className:"text-xs",children:"ðŸ”’"})]})]})]})}),!de&&!q&&e.jsx("div",{className:"bg-red-50 border-b border-red-200 px-6 py-3",children:e.jsx("div",{className:"flex items-center justify-center max-w-5xl mx-auto",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-800",children:[e.jsx(xa,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold text-lg",children:"ðŸ”’ CAIXA FECHADO"}),e.jsx("span",{className:"text-sm",children:"- Ã‰ necessÃ¡rio abrir o caixa para registrar vendas e recebimentos"})]})})}),r.id&&r.numero_venda&&e.jsx("div",{className:"bg-blue-50 border-b border-blue-200 px-4 py-1.5",children:e.jsxs("div",{className:"flex items-center justify-between max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-blue-800",children:"Venda:"}),e.jsxs("div",{className:"flex items-center gap-1.5 bg-white px-2 py-0.5 rounded border border-blue-300",children:[e.jsxs("span",{className:"font-bold text-blue-700 text-sm",children:["#",r.numero_venda]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(r.numero_venda);const z=event.target.closest("button"),me=z.innerHTML;z.innerHTML="âœ“",z.classList.add("text-green-600"),setTimeout(()=>{z.innerHTML=me,z.classList.remove("text-green-600")},1500)},className:"text-blue-600 hover:text-blue-800 transition-colors text-xs",title:"Copiar nÃºmero da venda",children:"ðŸ“‹"})]})]}),r.data_venda&&e.jsx("span",{className:"text-xs text-blue-600",children:(()=>{const z=r.data_venda;if(typeof z=="string"&&z.includes("T")){const[me]=z.split("T"),[Ce,ye,Te]=me.split("-");return`${Te}/${ye}/${Ce}`}return new Date(z).toLocaleDateString("pt-BR")})()})]})}),q&&e.jsx("div",{className:"bg-yellow-50 border-b border-yellow-200 px-6 py-3",children:e.jsxs("div",{className:"flex items-center justify-between max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-800",children:[e.jsx(xa,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Modo VisualizaÃ§Ã£o - Venda ",r.status==="finalizada"?"Finalizada":r.status==="baixa_parcial"?"com Baixa Parcial":"Aberta"]}),e.jsx("span",{className:"text-sm",children:"(Clique em Editar para modificar)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lx,{venda:r}),e.jsxs("button",{onClick:()=>{ae(!1),is()},className:"flex items-center gap-2 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(pa,{className:"w-4 h-4"}),"Voltar"]}),(r.status==="finalizada"||r.status==="baixa_parcial")&&e.jsxs("button",{onClick:di,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(xa,{className:"w-4 h-4"}),"Reabrir Venda"]}),r.status==="aberta"&&e.jsx("button",{onClick:ct,className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg font-medium transition-colors",children:"Editar"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"max-w-5xl mx-auto space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(Ir,{className:"w-5 h-5 mr-2 text-blue-600"}),"Cliente"]}),r.cliente&&!q&&e.jsx("button",{onClick:()=>i({...r,cliente:null,pet:null}),className:"text-sm text-red-600 hover:text-red-700",children:"Remover"})]}),r.cliente?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-blue-900",children:r.cliente.nome}),e.jsxs("div",{className:"text-sm text-blue-700 mt-1",children:[r.cliente.cpf&&`CPF: ${r.cliente.cpf}`,r.cliente.telefone&&` â€¢ Tel: ${r.cliente.telefone}`]})]})}),r.cliente.credito>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kt,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"CrÃ©dito DisponÃ­vel:"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",parseFloat(r.cliente.credito||0).toFixed(2).replace(".",",")]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"ðŸ’¡ Este crÃ©dito pode ser usado como forma de pagamento"})]}),D&&D.total_vendas>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-blue-300",children:e.jsxs("div",{className:"flex items-center justify-between p-2 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(La,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-yellow-900",children:[D.total_vendas," venda(s) em aberto"]}),e.jsxs("div",{className:"text-xs text-yellow-700",children:["Total: R$ ",D.total_em_aberto.toFixed(2)]})]})]}),e.jsx("button",{onClick:()=>k(!0),className:"px-3 py-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs font-medium rounded transition-colors",children:"Ver Vendas"})]})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-300 flex gap-2",children:[e.jsxs("button",{onClick:()=>w(!0),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(ki,{className:"w-4 h-4"}),"HistÃ³rico"]}),!q&&e.jsx("button",{onClick:()=>{i({...r,cliente:null,pet:null}),A(null)},className:"px-4 py-2 text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Trocar"})]})]}),r.cliente.pets&&r.cliente.pets.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pet (opcional)"}),e.jsxs("select",{value:((zo=r.pet)==null?void 0:zo.id)||"",onChange:z=>{const me=r.cliente.pets.find(Ce=>Ce.id===parseInt(z.target.value));ge(me||null)},disabled:q,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Sem pet especÃ­fico"}),r.cliente.pets.map(z=>e.jsxs("option",{value:z.id,children:[z.codigo," - ",z.nome," (",z.especie,z.raca&&` - ${z.raca}`,")"]},z.id))]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:l,onChange:z=>x(z.target.value),placeholder:"Digite nome, CPF ou telefone do cliente...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:q}),e.jsx(Xs,{className:"w-5 h-5 text-gray-400 absolute right-3 top-1/2 -translate-y-1/2"})]}),e.jsxs("button",{onClick:()=>b(!0),disabled:q,className:"flex items-center space-x-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(us,{className:"w-5 h-5"}),e.jsx("span",{children:"Novo"})]})]}),v.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:v.map(z=>e.jsxs("button",{onClick:()=>L(z),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:z.nome}),e.jsxs("div",{className:"text-sm text-gray-500",children:[z.cpf&&`CPF: ${z.cpf}`,z.telefone&&` â€¢ ${z.telefone}`]}),z.pets&&z.pets.length>0&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:[z.pets.length," pet(s)"]})]},z.id))})]}),l.length>=2&&v.length===0&&e.jsx("div",{className:"text-sm text-gray-500 text-center py-2",children:"Nenhum cliente encontrado"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(ls,{className:"w-5 h-5 mr-2 text-blue-600"}),"Produtos e ServiÃ§os"]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{ref:os,type:"text",value:j,onChange:z=>g(z.target.value),placeholder:"Digite o nome do produto, cÃ³digo de barras ou serviÃ§o...",disabled:q,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",autoFocus:!q}),e.jsx(Xs,{className:"w-5 h-5 text-gray-400 absolute right-3"})]}),m.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:m.map(z=>e.jsx("button",{onClick:()=>Me(z),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b last:border-b-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:z.nome}),z.tipo_produto==="VARIACAO"&&qn(z)&&e.jsxs("div",{className:"text-xs text-blue-600 font-medium mt-0.5",children:["ðŸ”¹ ",qn(z)]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[z.codigo&&`CÃ³d: ${z.codigo}`,z.tipo_produto==="KIT"&&z.tipo_kit==="VIRTUAL"?z.estoque_virtual!==void 0&&` â€¢ Estoque: ${z.estoque_virtual}`:z.estoque_atual!==void 0&&` â€¢ Estoque: ${z.estoque_atual}`]})]}),e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:["R$ ",parseFloat(z.preco_venda).toFixed(2)]})]})},z.id))})]}),r.itens.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(ls,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhum item adicionado"}),e.jsx("p",{className:"text-sm mt-1",children:"Busque e adicione produtos ou serviÃ§os"})]}):e.jsx("div",{className:"space-y-3",children:r.itens.map((z,me)=>{var sa;const Ce=z.tipo_produto==="KIT",ye=aa[me],Te=Ce&&z.composicao_kit&&z.composicao_kit.length>0;return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200 hover:border-blue-400 space-y-3 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>!q&&ur(z),children:[e.jsxs("div",{className:"flex-1 flex items-start gap-2",children:[Te&&e.jsx("button",{onClick:ra=>{ra.stopPropagation(),Na(me)},className:"mt-1 text-gray-500 hover:text-blue-600 transition-colors",children:ye?e.jsx(Ys,{className:"w-5 h-5"}):e.jsx(jt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:z.produto_nome}),Ce&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-700",children:[e.jsx(il,{className:"w-3 h-3"}),"KIT"]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[z.quantidade," Unidade",z.quantidade!==1?"s":""," x R$ ",z.preco_unitario.toFixed(2),z.desconto_valor>0&&e.jsxs("span",{className:"text-orange-600 ml-1",children:["com R$ ",z.desconto_valor.toFixed(2)," de desconto"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",onClick:ra=>ra.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center space-x-2 bg-white border border-gray-300 rounded-lg",children:[e.jsx("button",{onClick:()=>Ye(me,-1),disabled:q,className:"p-2 hover:bg-gray-100 rounded-l-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Gr,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:z.quantidade,onChange:ra=>{const ba=parseFloat(ra.target.value)||0,Fa=r.itens.map((ua,Ia)=>{if(Ia===me){const ns=Math.max(.001,ba),Vs=ns*ua.preco_unitario;let xt=ua.desconto_valor||0;ua.tipo_desconto_aplicado==="percentual"&&ua.desconto_percentual>0&&(xt=Vs*ua.desconto_percentual/100);const fr=Vs-xt;return{...ua,quantidade:ns,desconto_valor:xt,subtotal:fr}}return ua});Xa(Fa)},disabled:q,step:"0.001",min:"0.001",className:"w-20 px-2 py-1 text-center font-medium border-none focus:ring-0 disabled:bg-gray-50"}),e.jsx("button",{onClick:()=>Ye(me,1),disabled:q,className:"p-2 hover:bg-gray-100 rounded-r-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(us,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900 w-24 text-right",children:["R$ ",z.subtotal.toFixed(2)]}),e.jsx("button",{onClick:()=>Ve(me),disabled:q,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Es,{className:"w-5 h-5"})})]})]}),Te&&ye&&e.jsxs("div",{className:"ml-7 mt-3 p-3 bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-600 uppercase mb-2",children:"ComposiÃ§Ã£o do KIT"}),e.jsx("div",{className:"space-y-1.5",children:z.composicao_kit.map((ra,ba)=>e.jsxs("div",{className:"flex items-center justify-between text-sm py-1.5 px-2 rounded hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:ra.produto_nome})]}),e.jsxs("span",{className:"text-gray-500 font-medium",children:[ra.quantidade,"x"]})]},ba))}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 italic",children:"Componentes apenas informativos (nÃ£o editÃ¡veis)"})]}),((sa=r.cliente)==null?void 0:sa.pets)&&r.cliente.pets.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",onClick:ra=>ra.stopPropagation(),children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 w-16",children:"Pet:"}),e.jsxs("select",{value:z.pet_id||"",onChange:ra=>{const ba=r.itens.map((Fa,ua)=>ua===me?{...Fa,pet_id:ra.target.value?parseInt(ra.target.value):null}:Fa);i({...r,itens:ba})},disabled:q,className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"NÃ£o especificado"}),r.cliente.pets.map(ra=>e.jsxs("option",{value:ra.id,children:[ra.codigo," - ",ra.nome]},ra.id))]})]})]},me)})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ObservaÃ§Ãµes"}),e.jsx("textarea",{value:r.observacoes||"",onChange:z=>i({...r,observacoes:z.target.value}),placeholder:"ObservaÃ§Ãµes da venda (opcional)...",disabled:q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:3})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Entrega"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.tem_entrega,onChange:z=>{var Te;const me=z.target.checked,Ce=me&&((Te=r.entrega)==null?void 0:Te.taxa_entrega_total)||0,ye=r.subtotal+Ce;i({...r,tem_entrega:me,total:ye,entrega:me?r.entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}})},disabled:q,className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Tem entrega?"})]})]}),r.tem_entrega&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"EndereÃ§o Completo *"}),r.cliente&&e.jsxs("div",{className:"mb-2 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"EndereÃ§os cadastrados:"}),e.jsxs("button",{type:"button",onClick:z=>{z.preventDefault(),z.stopPropagation(),cr()},disabled:q,className:"flex items-center gap-1 px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(us,{size:14}),"Adicionar EndereÃ§o"]})]}),e.jsxs("div",{className:"space-y-2",children:[(r.cliente.endereco||r.cliente.cidade)&&e.jsxs("button",{type:"button",onClick:z=>{z.preventDefault(),z.stopPropagation();const me=`${r.cliente.endereco}${r.cliente.numero?", "+r.cliente.numero:""}${r.cliente.complemento?" - "+r.cliente.complemento:""}, ${r.cliente.bairro}, ${r.cliente.cidade}/${r.cliente.estado}`;i({...r,entrega:{...r.entrega,endereco_completo:me}})},disabled:q,className:"w-full text-left px-3 py-2 bg-white hover:bg-blue-100 border border-blue-300 rounded text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"font-medium text-blue-700",children:"ðŸ  Cadastro Principal:"})," ",e.jsxs("span",{className:"text-gray-700",children:[r.cliente.endereco,", ",r.cliente.numero," - ",r.cliente.bairro]})]}),r.cliente.enderecos_adicionais&&r.cliente.enderecos_adicionais.map((z,me)=>e.jsxs("button",{type:"button",onClick:Ce=>{Ce.preventDefault(),Ce.stopPropagation();const ye=`${z.endereco}, ${z.numero}${z.complemento?" - "+z.complemento:""}, ${z.bairro}, ${z.cidade}/${z.estado}`;i({...r,entrega:{...r.entrega,endereco_completo:ye}})},disabled:q,className:"w-full text-left px-3 py-2 bg-white hover:bg-blue-100 border border-blue-300 rounded text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsxs("span",{className:`inline-block px-2 py-0.5 text-xs font-medium rounded mr-2 ${z.tipo==="entrega"?"bg-blue-100 text-blue-800":z.tipo==="cobranca"?"bg-green-100 text-green-800":z.tipo==="comercial"?"bg-purple-100 text-purple-800":z.tipo==="residencial"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:[z.tipo==="entrega"?"ðŸ“¦":z.tipo==="cobranca"?"ðŸ’°":z.tipo==="comercial"?"ðŸ¢":z.tipo==="residencial"?"ðŸ ":"ðŸ“"," ",z.apelido||z.tipo]}),e.jsxs("span",{className:"text-gray-700",children:[z.endereco,", ",z.numero," - ",z.bairro]})]},me)),!r.cliente.endereco&&(!r.cliente.enderecos_adicionais||r.cliente.enderecos_adicionais.length===0)&&e.jsx("p",{className:"text-sm text-gray-600 italic",children:'Nenhum endereÃ§o cadastrado. Clique em "+ Adicionar EndereÃ§o"'})]})]}),e.jsx("textarea",{value:((Oo=r.entrega)==null?void 0:Oo.endereco_completo)??"",onChange:z=>i({...r,entrega:{...r.entrega,endereco_completo:z.target.value}}),placeholder:"Rua, nÃºmero, complemento, bairro, cidade...",disabled:q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Entregador"}),e.jsxs("select",{value:(ie==null?void 0:ie.id)||"",onChange:z=>{const me=fe.find(Ce=>Ce.id===parseInt(z.target.value));_e(me),i({...r,entregador_id:(me==null?void 0:me.id)||null}),me&&zs(me)},disabled:q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Selecione um entregador"}),fe.map(z=>e.jsxs("option",{value:z.id,children:[z.nome_fantasia||z.nome,z.entregador_padrao&&" (PadrÃ£o)"]},z.id))]}),ie&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Modelo: ",ie.modelo_custo_entrega==="taxa_fixa"?"ðŸ’µ Taxa Fixa":ie.modelo_custo_entrega==="por_km"?"ðŸš— Por KM":ie.modelo_custo_entrega==="rateio_rh"?"ðŸ‘” Rateio RH":"âš™ï¸ ConfiguraÃ§Ã£o Global"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa de Entrega Total"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((Vo=r.entrega)==null?void 0:Vo.taxa_entrega_total)??0,onChange:z=>{var Fa;const me=parseFloat(z.target.value)||0,Ce=parseFloat(me.toFixed(2)),ye=((Fa=r.entrega)==null?void 0:Fa.taxa_loja)||0,Te=parseFloat((me-ye).toFixed(2)),sa={...r,entrega:{...r.entrega,taxa_entrega_total:Ce,taxa_loja:parseFloat(ye.toFixed(2)),taxa_entregador:Te}},ra=sa.tem_entrega?Ce:0,ba=parseFloat((sa.subtotal+ra).toFixed(2));i({...sa,total:ba})},disabled:q,className:"w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa Loja"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:((Bo=r.entrega)==null?void 0:Bo.taxa_entrega_total)??0,value:parseFloat((((Uo=r.entrega)==null?void 0:Uo.taxa_loja)??0).toFixed(2)),onChange:z=>{var sa;const me=parseFloat(z.target.value)||0,Ce=((sa=r.entrega)==null?void 0:sa.taxa_entrega_total)||0,ye=parseFloat(me.toFixed(2)),Te=parseFloat((Ce-me).toFixed(2));i({...r,entrega:{...r.entrega,taxa_loja:ye,taxa_entregador:Te}})},disabled:q,className:"w-full pl-12 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa Entregador"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:((Wo=r.entrega)==null?void 0:Wo.taxa_entrega_total)??0,value:parseFloat((((Ho=r.entrega)==null?void 0:Ho.taxa_entregador)??0).toFixed(2)),onChange:z=>{var sa;const me=parseFloat(z.target.value)||0,Ce=((sa=r.entrega)==null?void 0:sa.taxa_entrega_total)||0,ye=parseFloat(me.toFixed(2)),Te=parseFloat((Ce-me).toFixed(2));i({...r,entrega:{...r.entrega,taxa_entregador:ye,taxa_loja:Te}})},disabled:q,className:"w-full pl-12 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Preencha a taxa total e depois divida entre loja e entregador. Ao alterar uma, a outra Ã© calculada automaticamente."}),ie&&$e>0&&e.jsxs("div",{className:"mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-amber-600",children:"ðŸ’¼"}),e.jsx("span",{className:"text-sm font-medium text-amber-900",children:"Custo Operacional"})]}),e.jsxs("span",{className:"text-sm font-semibold text-amber-700",children:["R$ ",$e.toFixed(2)]})]}),e.jsxs("p",{className:"text-xs text-amber-600 mt-1 italic",children:[ie.nome_fantasia||ie.nome," -",ie.modelo_custo_entrega==="taxa_fixa"&&" Taxa Fixa",ie.modelo_custo_entrega==="por_km"&&" Valor por KM",ie.modelo_custo_entrega==="rateio_rh"&&" Rateio de RH"," ","(nÃ£o aparece no cupom)"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ObservaÃ§Ãµes da Entrega"}),e.jsx("textarea",{value:((Ko=r.entrega)==null?void 0:Ko.observacoes_entrega)??"",onChange:z=>i({...r,entrega:{...r.entrega,observacoes_entrega:z.target.value}}),placeholder:"HorÃ¡rio preferencial, ponto de referÃªncia...",disabled:q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:2})]})]})]}),r.itens.length>0&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total bruto:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",(r.subtotal+r.desconto_valor).toFixed(2)]})]}),r.desconto_valor>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-orange-600",children:[(r.desconto_valor/(r.subtotal+r.desconto_valor)*100).toFixed(2),"% de desconto:"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium text-orange-600",children:["R$ ",r.desconto_valor.toFixed(2)]}),e.jsx("button",{onClick:gr,disabled:q,className:"p-1 text-blue-600 hover:bg-blue-50 rounded disabled:opacity-50",title:"Aplicar desconto",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",r.subtotal.toFixed(2)]})]}),r.tem_entrega&&e.jsxs("div",{className:"flex justify-between text-blue-600",children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsxs("span",{className:"font-medium",children:["+ R$ ",(((Go=r.entrega)==null?void 0:Go.taxa_entrega_total)||0).toFixed(2)]})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold text-gray-900",children:[e.jsx("span",{children:"Total da Venda:"}),e.jsxs("span",{children:["R$ ",r.total.toFixed(2)]})]})}),qe>0&&e.jsxs("div",{className:"flex justify-between text-sm text-blue-600 bg-blue-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium",children:"Total de Impostos:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",qe]})]}),r.total_pago>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-green-600 border-t pt-3",children:[e.jsx("span",{className:"font-medium",children:"(-) Valor Pago:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",r.total_pago.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-2xl font-bold border-t-2 pt-3",children:[e.jsx("span",{className:r.total-r.total_pago>0?"text-orange-600":"text-green-600",children:r.total-r.total_pago>0?"Saldo Restante:":"Totalmente Pago:"}),e.jsxs("span",{className:r.total-r.total_pago>0?"text-orange-600":"text-green-600",children:["R$ ",Math.max(0,r.total-r.total_pago).toFixed(2)]})]})]}),!r.total_pago&&e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"flex justify-between text-2xl font-bold text-gray-900",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["R$ ",r.total.toFixed(2)]})]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"ComissÃ£o"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:oe,onChange:z=>{Ne(z.target.checked),z.target.checked||Ue(null)},disabled:q,className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Venda comissionada?"})]})]}),oe&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["FuncionÃ¡rio/VeterinÃ¡rio * ",e.jsx("span",{className:"text-xs text-gray-500",children:"(apenas com comissÃ£o configurada)"})]}),ke?e.jsxs("div",{className:"p-4 bg-green-50 border-2 border-green-300 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white font-bold",children:ke.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-green-900",children:ke.nome}),e.jsx("div",{className:"text-sm text-green-700 capitalize",children:ke.cargo})]})]}),e.jsx("button",{onClick:()=>{Ue(null),Le("")},disabled:q,className:"p-2 text-green-600 hover:bg-green-100 rounded-lg transition-colors disabled:cursor-not-allowed",title:"Remover seleÃ§Ã£o",children:e.jsx(pa,{size:20})})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:ve,placeholder:"Buscar funcionÃ¡rio ou veterinÃ¡rio...",disabled:q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",onFocus:async()=>{if(!q)try{const z=await F.get("/comissoes/configuracoes/funcionarios");Y(z.data.data||[])}catch(z){console.error("Erro ao buscar funcionÃ¡rios:",z)}},onChange:async z=>{const me=z.target.value;Le(me);try{const ye=(await F.get("/comissoes/configuracoes/funcionarios")).data.data||[],Te=me?ye.filter(sa=>sa.nome.toLowerCase().includes(me.toLowerCase())):ye;Y(Te)}catch(Ce){console.error("Erro ao buscar funcionÃ¡rios:",Ce)}}}),ze.length>0&&e.jsx("div",{className:"mt-2 border border-gray-200 rounded-lg max-h-48 overflow-y-auto",children:ze.map(z=>e.jsxs("button",{onClick:()=>{Ue(z),Y([]),Le("")},className:"w-full px-4 py-2 text-left hover:bg-gray-50 border-b last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:z.nome}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:z.cargo})]},z.id))})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"â„¹ï¸ A comissÃ£o serÃ¡ calculada automaticamente conforme configurado no mÃ³dulo de comissÃµes"})]})]})]}),r.itens.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[!de&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-700",children:[e.jsx(xa,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:'ðŸ”’ Caixa fechado - Use o botÃ£o "Abrir Caixa" no topo da pÃ¡gina para continuar'})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[r.itens.length>0&&!r.id&&e.jsxs("button",{onClick:()=>{window.confirm("Descartar venda atual sem salvar?")&&is()},disabled:_||q,className:"flex items-center space-x-2 px-4 py-3 bg-red-50 hover:bg-red-100 text-red-600 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed border border-red-200",title:"Descartar venda atual e comeÃ§ar uma nova",children:[e.jsx(pa,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Nova Venda"})]}),e.jsxs("button",{onClick:Ea,disabled:_||q||!de,className:"flex items-center space-x-2 px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:de?"Salvar venda atual":"ðŸ”’ Caixa fechado - Abra o caixa para salvar vendas",children:[e.jsx(Kt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Salvar Venda"}),!de&&e.jsx("span",{className:"text-xs",children:"ðŸ”’"})]}),e.jsxs("button",{onClick:Ps,disabled:_||r.status==="finalizada"||r.status==="pago_nf"||!de,className:"flex items-center space-x-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors shadow-md disabled:opacity-50 disabled:cursor-not-allowed",title:de?"Registrar pagamento da venda":"ðŸ”’ Caixa fechado - Abra o caixa para registrar recebimentos",children:[e.jsx(Ct,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"}),!de&&e.jsx("span",{className:"text-xs",children:"ðŸ”’"})]})]})]})]})]}),r.cliente&&Sa&&e.jsx("div",{className:"w-80 bg-gray-50 border-l flex flex-col overflow-hidden",children:e.jsx(Ix,{clienteId:r.cliente.id})}),r.cliente&&e.jsx("button",{onClick:()=>V(!Sa),className:"fixed right-0 top-1/2 -translate-y-1/2 bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-l-lg shadow-lg transition-all z-10",style:{right:Sa?"320px":"0"},title:Sa?"Recolher informaÃ§Ãµes do cliente":"Expandir informaÃ§Ãµes do cliente",children:Sa?e.jsx(jt,{className:"w-5 h-5"}):e.jsx(Ir,{className:"w-5 h-5"})}),ca&&e.jsxs("div",{className:"w-52 bg-white border-l flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 flex items-center",children:[e.jsx(tt,{className:"w-4 h-4 mr-2 text-blue-600"}),"Vendas Recentes"]}),e.jsx("button",{onClick:()=>We(!1),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Fechar painel",children:e.jsx(pa,{className:"w-4 h-4 text-gray-500"})})]}),e.jsx("div",{className:"flex space-x-1 mb-3",children:["24h","7d","30d"].map(z=>e.jsxs("button",{onClick:()=>Z(z),className:`flex-1 px-2 py-1.5 rounded-lg text-xs font-medium transition-colors ${M===z?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[z==="24h"&&"Ãšltimas 24h",z==="7d"&&"7 dias",z==="30d"&&"30 dias"]},z))}),e.jsx("div",{className:"flex space-x-1 mb-2",children:[{id:"todas",label:"Todas"},{id:"pago",label:"Pago"},{id:"aberta",label:"Aberta"}].map(z=>e.jsx("button",{onClick:()=>J(z.id),className:`flex-1 px-2 py-1.5 rounded-lg text-xs font-medium transition-colors ${$===z.id?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:z.label},z.id))}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 hover:bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",checked:E,onChange:z=>R(z.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Apenas com entrega"})]}),e.jsx("div",{className:"px-2 pb-2",children:e.jsx("input",{type:"text",value:K,onChange:z=>B(z.target.value),placeholder:"Buscar por nÃºmero...",className:"w-full px-3 py-2 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:X.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(xa,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-xs",children:"Nenhuma venda encontrada"})]}):X.map(z=>e.jsxs("div",{onClick:()=>br(z),className:"bg-gray-50 rounded-lg p-2.5 border border-gray-200 hover:border-blue-300 cursor-pointer transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1.5",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:z.cliente_nome||"Cliente nÃ£o informado"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["#",z.numero_venda]})]}),e.jsxs("div",{className:"text-right ml-2 flex-shrink-0",children:[z.status==="baixa_parcial"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[10px] text-gray-500",children:"Pago"}),e.jsxs("div",{className:"text-xs font-semibold text-green-600",children:["R$ ",(z.valor_pago||0).toFixed(2)]}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-0.5",children:["de R$ ",(z.total||0).toFixed(2)]})]}):e.jsxs("div",{className:"text-sm font-semibold text-green-600",children:["R$ ",(z.total||0).toFixed(2)]}),e.jsxs("div",{className:`text-[10px] font-medium px-1.5 py-0.5 rounded-full mt-1 inline-block ${z.status==="pago_nf"?"bg-emerald-100 text-emerald-700":z.status==="finalizada"?"bg-green-100 text-green-700":z.status==="baixa_parcial"?"bg-blue-100 text-blue-700":z.status==="aberta"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[z.status==="pago_nf"&&"Pago NF",z.status==="finalizada"&&"Pago",z.status==="baixa_parcial"&&"Parcial",z.status==="aberta"&&"Aberta",z.status==="cancelada"&&"Cancelada"]})]})]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:(()=>{const me=z.data_venda;if(typeof me=="string"&&me.includes("T")){const[Ce,ye]=me.split("T"),Te=ye.split("-")[0].split("+")[0],[sa,ra,ba]=Ce.split("-"),[Fa,ua]=Te.split(":");return`${ba}/${ra} ${Fa}:${ua}`}return new Date(me).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})()})]},z.id))})]}),Re&&r.cliente&&e.jsx("div",{className:"fixed inset-0 z-40",children:e.jsxs("div",{className:"absolute top-0 right-0 w-80 h-full bg-gray-50 border-l border-gray-300 shadow-lg flex flex-col animate-in slide-in-from-right duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-300 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cn,{className:"w-4 h-4 text-gray-600"}),e.jsx("h2",{className:"text-sm font-medium text-gray-700",children:"Oportunidades"})]}),e.jsx("button",{onClick:()=>Oe(!1),className:"p-1 hover:bg-gray-100 rounded transition-colors",children:e.jsx(pa,{className:"w-4 h-4 text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:[He.slice(0,5).map(z=>e.jsxs("div",{className:"p-3 bg-white border border-gray-200 rounded hover:bg-gray-50 transition-colors",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:z.titulo}),e.jsx("p",{className:"text-xs text-gray-700 mb-2 leading-relaxed",children:z.descricao_curta}),e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs mt-2",children:[e.jsxs("button",{onClick:()=>{it("oportunidade_convertida",z),console.log("Adicionar ao carrinho:",z.id)},className:"flex items-center gap-1 text-green-500 hover:text-green-600 transition-colors whitespace-nowrap font-medium",title:"Adicionar ao carrinho",children:[e.jsx(us,{className:"w-3 h-3"}),e.jsx("span",{children:"Adicionar"})]}),e.jsx("button",{onClick:()=>{it("oportunidade_refinada",z),console.log("Buscar alternativa:",z.id)},className:"text-orange-600 hover:text-orange-700 transition-colors whitespace-nowrap flex-1 text-center font-medium",title:"Ver alternativa",children:"Alternativa"}),e.jsxs("button",{onClick:()=>{it("oportunidade_rejeitada",z),ga(me=>me.filter(Ce=>Ce.id!==z.id))},className:"flex items-center gap-1 text-red-500 hover:text-red-600 transition-colors whitespace-nowrap font-medium",title:"Ignorar sugestÃ£o",children:[e.jsx("span",{children:"Ignorar"}),e.jsx(pa,{className:"w-3 h-3"})]})]})]},z.id)),He.length===0&&e.jsx("div",{className:"flex items-center justify-center py-8 text-gray-400",children:e.jsx("p",{className:"text-xs",children:"Nenhuma oportunidade disponÃ­vel"})})]}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-200 bg-white",children:e.jsx("p",{className:"text-[10px] text-gray-400 text-center",children:He.length>0?`${Math.min(He.length,6)} oportunidades`:""})})]})}),e.jsx("button",{onClick:()=>We(!ca),className:"fixed right-0 bottom-20 bg-blue-600 hover:bg-blue-700 text-white rounded-l-lg shadow-lg transition-all z-10 flex items-center gap-1",style:{right:ca?"208px":"0",padding:ca?"6px":"6px 8px"},title:ca?"Recolher vendas recentes":"Expandir vendas recentes",children:ca?e.jsx(jt,{className:"w-4 h-4"}):e.jsxs(e.Fragment,{children:[e.jsx(Si,{className:"w-4 h-4"}),e.jsx("span",{className:"text-[10px] font-medium whitespace-nowrap",children:"Vendas"})]})}),y&&e.jsx(Nx,{venda:r,onClose:()=>c(!1),onAnalisarVenda:o?Ba:null,onConfirmar:async()=>{if(c(!1),q&&r.id)try{const me=(await F.get(`/vendas/${r.id}`)).data;let Ce=[],ye=0;try{const Te=await F.get(`/vendas/${r.id}/pagamentos`);Ce=Te.data.pagamentos||[],ye=Te.data.total_pago||0}catch(Te){console.error("Erro ao buscar pagamentos:",Te)}i({...me,pagamentos:Ce,total_pago:ye}),console.log("âœ… Venda recarregada:",me)}catch(z){console.error("Erro ao recarregar venda:",z)}else is();Fs(),ee(z=>z+1)},onVendaAtualizada:async()=>{if(r.id){const z=await wr(r.id);let me=[],Ce=0;try{const ye=await F.get(`/vendas/${r.id}/pagamentos`);me=ye.data.pagamentos||[],Ce=ye.data.total_pago||0}catch(ye){console.error("Erro ao buscar pagamentos:",ye)}i({...z,pagamentos:me,total_pago:Ce}),ae(z.status==="finalizada"||z.status==="baixa_parcial"),Fs()}}}),u&&e.jsx(Ex,{onClose:()=>h(!1),onSucesso:()=>{h(!1),ee(z=>z+1),ue(!0)}}),Va&&e.jsx(Ox,{isOpen:Va,itensCarrinho:r.itens,racaoIdFechada:Pa,onClose:()=>{const z=r.itens.filter(me=>{const Ce=(me.categoria_nome||"").toLowerCase();return Ce.includes("raÃ§Ã£o")||Ce.includes("racao")});z.length>0&&wa(z[z.length-1].produto_id),ya(!1)}}),S&&r.cliente&&e.jsx(Vx,{isOpen:S,onClose:()=>P(!1),clienteId:r.cliente.id,onPendenciaAdicionada:()=>Dt()}),f&&e.jsx(Ux,{onClose:()=>b(!1),onClienteCriado:z=>{L(z),b(!1)}}),Ae&&we&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between z-10",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Adicionar Novo EndereÃ§o ao Cliente"}),e.jsx("button",{onClick:dt,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(pa,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de EndereÃ§o *"}),e.jsxs("select",{value:we.tipo,onChange:z=>Se({...we,tipo:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"entrega",children:"ðŸ“¦ Entrega"}),e.jsx("option",{value:"cobranca",children:"ðŸ’° CobranÃ§a"}),e.jsx("option",{value:"comercial",children:"ðŸ¢ Comercial"}),e.jsx("option",{value:"residencial",children:"ðŸ  Residencial"}),e.jsx("option",{value:"trabalho",children:"ðŸ“ Trabalho"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apelido (opcional)"}),e.jsx("input",{type:"text",value:we.apelido,onChange:z=>Se({...we,apelido:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Ex: Casa da mÃ£e, EscritÃ³rio, Loja"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:we.cep,onChange:z=>{const me=z.target.value.replace(/\D/g,""),Ce=me.length>5?`${me.slice(0,5)}-${me.slice(5,8)}`:me;Se({...we,cep:Ce})},onBlur:z=>xr(z.target.value),maxLength:"9",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"00000-000"}),ea&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EndereÃ§o *"}),e.jsx("input",{type:"text",value:we.endereco,onChange:z=>Se({...we,endereco:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Rua, Avenida, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NÃºmero"}),e.jsx("input",{type:"text",value:we.numero,onChange:z=>Se({...we,numero:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"123"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complemento"}),e.jsx("input",{type:"text",value:we.complemento,onChange:z=>Se({...we,complemento:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Apto, Bloco, Sala..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bairro"}),e.jsx("input",{type:"text",value:we.bairro,onChange:z=>Se({...we,bairro:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Centro, Jardim..."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cidade *"}),e.jsx("input",{type:"text",value:we.cidade,onChange:z=>Se({...we,cidade:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"SÃ£o Paulo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsx("input",{type:"text",value:we.estado,onChange:z=>Se({...we,estado:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",maxLength:"2",placeholder:"SP"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"* Campos obrigatÃ³rios"})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:dt,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:mr,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Salvar EndereÃ§o"})]})]})}),Je&&Fe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Alterar item da venda"}),e.jsx("button",{onClick:()=>be(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(pa,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:Fe.produto_nome}),e.jsxs("p",{className:"text-sm text-gray-600",children:["CÃ³digo: ",Fe.produto_codigo]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["PreÃ§o ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:Fe.preco,onChange:z=>he({...Fe,preco:parseFloat(z.target.value)||0}),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade"}),e.jsx("input",{type:"number",step:"0.001",value:Fe.quantidade,readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subtotal"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:"R$"}),e.jsx("input",{type:"text",value:(Fe.preco*Fe.quantidade).toFixed(2),readOnly:!0,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-100"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de desconto"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>he({...Fe,tipoDesconto:"valor",descontoPercentual:0}),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${Fe.tipoDesconto==="valor"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"R$"}),e.jsx("button",{onClick:()=>he({...Fe,tipoDesconto:"percentual",descontoValor:0}),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${Fe.tipoDesconto==="percentual"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor do desconto"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:Fe.tipoDesconto==="valor"?"R$":"%"}),e.jsx("input",{type:"number",step:"0.01",value:Fe.tipoDesconto==="valor"?Fe.descontoValor:Fe.descontoPercentual,onChange:z=>{const me=parseFloat(z.target.value)||0;Fe.tipoDesconto==="valor"?he({...Fe,descontoValor:me}):he({...Fe,descontoPercentual:me})},className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Total bruto"}),e.jsxs("span",{className:"font-medium",children:["R$ ",(Fe.preco*Fe.quantidade).toFixed(2)]})]}),(Fe.descontoValor>0||Fe.descontoPercentual>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm text-red-600 mt-1",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{className:"font-medium",children:["- R$ ",Fe.tipoDesconto==="valor"?Fe.descontoValor.toFixed(2):(Fe.preco*Fe.quantidade*Fe.descontoPercentual/100).toFixed(2)]})]}),e.jsx("div",{className:"flex justify-between text-sm text-orange-600 mt-1",children:e.jsxs("span",{children:[Fe.tipoDesconto==="percentual"&&`${Fe.descontoPercentual.toFixed(2)}% de desconto`,Fe.tipoDesconto==="valor"&&`${(Fe.descontoValor/(Fe.preco*Fe.quantidade)*100).toFixed(2)}% de desconto`]})})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg mt-2 pt-2 border-t border-blue-200",children:[e.jsx("span",{children:"Total lÃ­quido"}),e.jsxs("span",{className:"text-green-600",children:["R$ ",(Fe.preco*Fe.quantidade-(Fe.tipoDesconto==="valor"?Fe.descontoValor:Fe.preco*Fe.quantidade*Fe.descontoPercentual/100)).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-between gap-3",children:[e.jsx("button",{onClick:()=>be(!1),className:"flex-1 px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Fechar"}),e.jsx("button",{onClick:()=>{r.itens.map(z=>(z.produto_id===Fe.produto_id&&Ve(r.itens.indexOf(z)),z)).filter(Boolean),be(!1)},className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Remover"}),e.jsx("button",{onClick:pr,className:"flex-1 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Salvar"})]})]})}),Qe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"ðŸ’° Aplicar desconto"}),e.jsx("button",{onClick:()=>Ze(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(pa,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total bruto"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",r.subtotal.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de desconto"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>oa("valor"),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${ma==="valor"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"R$"}),e.jsx("button",{onClick:()=>oa("percentual"),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${ma==="percentual"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-3 text-gray-500",children:ma==="valor"?"R$":"%"}),e.jsx("input",{type:"number",step:"0.01",value:ha,onChange:z=>da(parseFloat(z.target.value)||0),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-700",children:"Desconto"}),e.jsxs("span",{className:"text-red-600 font-medium",children:["- R$ ",ma==="valor"?ha.toFixed(2):(r.subtotal*ha/100).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-baseline border-t border-blue-200 pt-2 mt-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Total lÃ­quido"}),e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:["R$ ",(ma==="valor"?r.subtotal-ha:r.subtotal-r.subtotal*ha/100).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>Ze(!1),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Fechar"}),e.jsx("button",{onClick:()=>hr(ma,ha),className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Aplicar"})]})]})}),p&&r.cliente&&e.jsx(Tx,{clienteId:r.cliente.id,clienteNome:r.cliente.nome,onClose:()=>k(!1),onSucesso:()=>{F.get(`/clientes/${r.cliente.id}/vendas-em-aberto`).then(z=>{z.data.resumo.total_vendas>0?A(z.data.resumo):A(null)}).catch(()=>A(null))}}),N&&r.cliente&&e.jsx(qx,{clienteId:r.cliente.id,clienteNome:r.cliente.nome,onClose:()=>w(!1)}),o&&e.jsx(zx,{mostrar:ne,onFechar:()=>pe(!1),dados:Pe,carregando:Ke})]})})}function Ux({onClose:a,onClienteCriado:t}){const[s,o]=n.useState({nome:"",telefone:"",cpf:"",email:""}),[r,i]=n.useState(!1),[l,x]=n.useState(""),j=async g=>{if(g.preventDefault(),!s.nome||!s.telefone){x("Nome e telefone sÃ£o obrigatÃ³rios");return}i(!0),x("");try{const v=await F.post("/clientes",{...s,tipo_cadastro:"cliente",tipo_pessoa:"PF"});t(v.data)}catch(v){console.error("Erro:",v),x("Erro ao cadastrar cliente")}finally{i(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Cadastro RÃ¡pido"}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(pa,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-4",children:[l&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:l}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome *"}),e.jsx("input",{type:"text",value:s.nome,onChange:g=>o({...s,nome:g.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefone *"}),e.jsx("input",{type:"tel",value:s.telefone,onChange:g=>o({...s,telefone:g.target.value}),placeholder:"(00) 00000-0000",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CPF"}),e.jsx("input",{type:"text",value:s.cpf,onChange:g=>o({...s,cpf:g.target.value}),placeholder:"000.000.000-00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail"}),e.jsx("input",{type:"email",value:s.email,onChange:g=>o({...s,email:g.target.value}),placeholder:"cliente@email.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:a,disabled:r,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:r,className:"flex items-center space-x-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Cadastrando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(fa,{className:"w-5 h-5"}),e.jsx("span",{children:"Cadastrar"})]})})]})]})]})})}function Wx(){const a=va(),[t,s]=n.useState([]),[o,r]=n.useState(!0),[i,l]=n.useState({data_inicio:"",data_fim:"",status:""});n.useEffect(()=>{x()},[i]);const x=async()=>{try{r(!0);const m={};i.data_inicio&&(m.data_inicio=i.data_inicio),i.data_fim&&(m.data_fim=i.data_fim),i.status&&(m.status_filter=i.status);const C=await Cx(m);s(C)}catch(m){console.error("Erro ao carregar caixas:",m),alert("Erro ao carregar histÃƒÂ³rico de caixas")}finally{r(!1)}},j=async m=>{var C,y;if(confirm("Deseja realmente reabrir este caixa?"))try{await Sx(m),alert("Caixa reaberto com sucesso!"),a("/pdv")}catch(c){console.error("Erro ao reabrir caixa:",c),alert(((y=(C=c.response)==null?void 0:C.data)==null?void 0:y.detail)||"Erro ao reabrir caixa")}},g=async(m,C)=>{try{const y="/api",c=localStorage.getItem("access_token")||localStorage.getItem("token"),f=await fetch(`${y}/caixas/${m}/pdf`,{headers:{Authorization:`Bearer ${c}`}});if(!f.ok)throw new Error("Erro ao gerar PDF");const b=await f.blob(),u=window.URL.createObjectURL(b),h=document.createElement("a");h.href=u,h.download=`Caixa_${C}_${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(h),h.click(),window.URL.revokeObjectURL(u),document.body.removeChild(h),alert("PDF baixado com sucesso!")}catch(y){console.error("Erro ao baixar PDF:",y),alert("Erro ao gerar PDF do caixa")}},v=m=>{const C={aberto:{cor:"bg-green-100 text-green-800",icone:fa,texto:"Aberto"},fechado:{cor:"bg-gray-100 text-gray-800",icone:ys,texto:"Fechado"}},y=C[m]||C.fechado,c=y.icone;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium ${y.cor}`,children:[e.jsx(c,{className:"w-4 h-4"}),y.texto]})},d=(m,C)=>{const y=C-m;return{valor:Math.abs(y),tipo:y>0?"sobra":y<0?"falta":"ok"}};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Meus Caixas"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"HistÃƒÂ³rico e gestÃƒÂ£o dos seus caixas"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data InÃƒÂ­cio"}),e.jsx("input",{type:"date",value:i.data_inicio,onChange:m=>l({...i,data_inicio:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Fim"}),e.jsx("input",{type:"date",value:i.data_fim,onChange:m=>l({...i,data_fim:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:i.status,onChange:m=>l({...i,status:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"aberto",children:"Aberto"}),e.jsx("option",{value:"fechado",children:"Fechado"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>l({data_inicio:"",data_fim:"",status:""}),className:"w-full px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:"Limpar Filtros"})})]})}),o?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando caixas..."})]}):t.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg shadow-sm",children:[e.jsx(xa,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Nenhum caixa encontrado"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:t.map(m=>{const C=m.status==="fechado"&&m.valor_esperado?d(m.valor_esperado,m.valor_informado):null;return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Oa,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["Caixa #",m.numero_caixa]}),e.jsx("p",{className:"text-sm text-gray-600",children:m.usuario_nome})]})]}),v(m.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Is,{className:"w-4 h-4"}),e.jsxs("span",{children:["Abertura: ",new Date(m.data_abertura).toLocaleString("pt-BR")]})]}),m.data_fechamento&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(tt,{className:"w-4 h-4"}),e.jsxs("span",{children:["Fechamento: ",new Date(m.data_fechamento).toLocaleString("pt-BR")]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Abertura"}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["R$ ",m.valor_abertura.toFixed(2)]})]}),m.status==="fechado"&&m.valor_esperado&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Esperado"}),e.jsxs("div",{className:"text-lg font-semibold text-blue-900",children:["R$ ",m.valor_esperado.toFixed(2)]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Informado"}),e.jsxs("div",{className:"text-lg font-semibold text-green-900",children:["R$ ",m.valor_informado.toFixed(2)]})]}),e.jsxs("div",{className:`rounded-lg p-3 ${C.tipo==="ok"?"bg-gray-50":C.tipo==="sobra"?"bg-green-50":"bg-red-50"}`,children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"DiferenÃƒÂ§a"}),e.jsxs("div",{className:`text-lg font-semibold ${C.tipo==="ok"?"text-gray-900":C.tipo==="sobra"?"text-green-900":"text-red-900"}`,children:[C.tipo==="sobra"&&"+",C.tipo==="falta"&&"-","R$ ",C.valor.toFixed(2)]})]})]})]}),(m.observacoes_abertura||m.observacoes_fechamento)&&e.jsxs("div",{className:"border-t pt-4 mb-4",children:[m.observacoes_abertura&&e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Obs. Abertura:"})," ",m.observacoes_abertura]}),m.observacoes_fechamento&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Obs. Fechamento:"})," ",m.observacoes_fechamento]})]}),m.status==="fechado"&&e.jsxs("div",{className:"border-t pt-4 flex gap-3",children:[e.jsxs("button",{onClick:()=>j(m.id),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(Aa,{className:"w-4 h-4"}),"Reabrir Caixa"]}),e.jsxs("button",{onClick:()=>g(m.id,m.numero_caixa),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[e.jsx(Gt,{className:"w-4 h-4"}),"Baixar PDF"]})]})]})},m.id)})})]})}function Hx(){var re,M,Z;const[a,t]=n.useState([]),[s,o]=n.useState(!0),[r,i]=n.useState(""),[l,x]=n.useState(""),[j,g]=n.useState(""),[v,d]=n.useState(""),[m,C]=n.useState(""),[y,c]=n.useState(null),[f,b]=n.useState(null),[u,h]=n.useState(""),[p,k]=n.useState(!1),N=[{value:"",label:"Todas"},{value:"Autorizada",label:"Autorizada"},{value:"Emitida DANFE",label:"Emitida DANFE"},{value:"Cancelada",label:"Cancelada"},{value:"Pendente",label:"Pendente"}];n.useEffect(()=>{w()},[r,l,j]);const w=async()=>{try{o(!0),C("");const $=new URLSearchParams;r&&$.append("situacao",r),l&&$.append("data_inicial",l),j&&$.append("data_final",j);const J=await F.get(`/nfe/?${$.toString()}`);t(J.data.notas||[])}catch($){console.error("Erro ao carregar notas:",$),C("Erro ao carregar notas fiscais")}finally{o(!1)}},S=async($,J)=>{try{const E=await F.get(`/nfe/${$}/danfe`,{responseType:"blob"}),R=window.URL.createObjectURL(new Blob([E.data])),K=document.createElement("a");K.href=R,K.setAttribute("download",`danfe_${J}.pdf`),document.body.appendChild(K),K.click(),K.remove()}catch(E){console.error("Erro ao baixar DANFE:",E),alert("Erro ao baixar DANFE")}},P=async($,J)=>{try{const E=await F.get(`/nfe/${$}/xml`),R=new Blob([E.data.xml],{type:"application/xml"}),K=window.URL.createObjectURL(R),B=document.createElement("a");B.href=K,B.setAttribute("download",`nfe_${J}.xml`),document.body.appendChild(B),B.click(),B.remove()}catch(E){console.error("Erro ao baixar XML:",E),alert("Erro ao baixar XML")}},W=async()=>{var $,J;if(!u||u.length<15){alert("A justificativa deve ter no mÃ­nimo 15 caracteres");return}try{k(!0),await F.post(`/nfe/${f.id}/cancelar`,{justificativa:u}),alert("Nota fiscal cancelada com sucesso!"),b(null),h(""),w()}catch(E){console.error("Erro ao cancelar nota:",E),alert(((J=($=E.response)==null?void 0:$.data)==null?void 0:J.detail)||"Erro ao cancelar nota fiscal")}finally{k(!1)}},te=async($,J)=>{var E,R;if(confirm(`Deseja realmente excluir a nota ${J}?

Isso apenas remove os dados da nota do sistema, nÃ£o cancela no Bling/SEFAZ.`))try{await F.delete(`/nfe/${$}`),alert("Nota fiscal excluÃ­da com sucesso!"),w()}catch(K){console.error("Erro ao excluir nota:",K),alert(((R=(E=K.response)==null?void 0:E.data)==null?void 0:R.detail)||"Erro ao excluir nota fiscal")}},D=$=>{switch($==null?void 0:$.toLowerCase()){case"autorizada":case"emitida danfe":return"bg-green-100 text-green-800";case"cancelada":return"bg-red-100 text-red-800";case"pendente":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},A=$=>{switch($==null?void 0:$.toLowerCase()){case"autorizada":case"emitida danfe":return e.jsx(fa,{className:"w-4 h-4"});case"cancelada":return e.jsx(pa,{className:"w-4 h-4"});case"pendente":return e.jsx(xa,{className:"w-4 h-4"});default:return e.jsx(ss,{className:"w-4 h-4"})}},X=a.filter($=>{var E,R,K,B,_,O;if(!v)return!0;const J=v.toLowerCase();return((E=$.numero)==null?void 0:E.toLowerCase().includes(J))||((R=$.serie)==null?void 0:R.toLowerCase().includes(J))||((B=(K=$.cliente)==null?void 0:K.nome)==null?void 0:B.toLowerCase().includes(J))||((O=(_=$.cliente)==null?void 0:_.cpf_cnpj)==null?void 0:O.toLowerCase().includes(J))});return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ss,{className:"w-8 h-8 text-blue-600"}),"Notas Fiscais de SaÃ­da"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie suas NF-e e NFC-e emitidas"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Xt,{className:"w-5 h-5 text-gray-600"}),e.jsx("h2",{className:"font-semibold text-gray-800",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Xs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por nÃºmero, cliente...",value:v,onChange:$=>d($.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("div",{children:e.jsx("input",{type:"date",value:l,onChange:$=>x($.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),e.jsx("div",{children:e.jsx("input",{type:"date",value:j,onChange:$=>g($.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),e.jsx("select",{value:r,onChange:$=>i($.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:N.map($=>e.jsx("option",{value:$.value,children:$.label},$.value))})]})]}),m&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 rounded-lg p-4 mb-6 flex items-center gap-2",children:[e.jsx(xa,{className:"w-5 h-5"}),m]}),s?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Carregando notas fiscais..."})]}):X.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(ss,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Nenhuma nota encontrada"}),e.jsx("p",{className:"text-gray-600",children:v||r||l||j?"Tente ajustar os filtros":"Emita sua primeira nota fiscal em uma venda"})]}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"NÃºmero"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data EmissÃ£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SituaÃ§Ã£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:X.map($=>{var J,E,R,K;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:$.numero}),e.jsxs("div",{className:"text-sm text-gray-500",children:["SÃ©rie ",$.serie]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:$.data_emissao?new Date($.data_emissao).toLocaleDateString("pt-BR"):"-"})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((J=$.cliente)==null?void 0:J.nome)||"Cliente nÃ£o informado"}),e.jsx("div",{className:"text-sm text-gray-500",children:((E=$.cliente)==null?void 0:E.cpf_cnpj)||""})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium ${D($.status)}`,children:[A($.status),$.status||"Pendente"]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["R$ ",$.valor.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[(((R=$.status)==null?void 0:R.toLowerCase())==="autorizada"||((K=$.status)==null?void 0:K.toLowerCase())==="emitida danfe")&&e.jsx("button",{onClick:()=>b($),className:"text-red-600 hover:text-red-900 p-1 hover:bg-red-50 rounded",title:"Cancelar NF-e",children:e.jsx(ys,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>te($.venda_id,$.numero),className:"text-gray-600 hover:text-gray-900 p-1 hover:bg-gray-50 rounded",title:"Excluir nota do sistema",children:e.jsx(Es,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>S($.id,$.numero),className:"text-blue-600 hover:text-blue-900 p-1 hover:bg-blue-50 rounded",title:"Baixar DANFE",children:e.jsx(ho,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>P($.id,$.numero),className:"text-green-600 hover:text-green-900 p-1 hover:bg-green-50 rounded",title:"Baixar XML",children:e.jsx(Gt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>c($),className:"text-gray-600 hover:text-gray-900 p-1 hover:bg-gray-50 rounded",title:"Ver Detalhes",children:e.jsx(Ht,{className:"w-5 h-5"})})]})})]},$.id)})})]})}),!s&&X.length>0&&e.jsxs("div",{className:"mt-4 text-sm text-gray-600 text-center",children:[X.length," ",X.length===1?"nota encontrada":"notas encontradas"]}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto m-4",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800",children:["Detalhes da Nota Fiscal #",y.numero]}),e.jsx("button",{onClick:()=>c(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(pa,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"NÃºmero"}),e.jsx("p",{className:"text-gray-900",children:y.numero})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"SÃ©rie"}),e.jsx("p",{className:"text-gray-900",children:y.serie})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Modelo"}),e.jsx("p",{className:"text-gray-900",children:y.modelo})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Tipo"}),e.jsx("p",{className:"text-gray-900",children:y.tipo==="nfe"?"NF-e":"NFC-e"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Chave de Acesso"}),e.jsx("p",{className:"text-gray-900 text-xs break-all",children:y.chave||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Cliente"}),e.jsx("p",{className:"text-gray-900",children:(re=y.cliente)==null?void 0:re.nome})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"CPF/CNPJ"}),e.jsx("p",{className:"text-gray-900",children:(M=y.cliente)==null?void 0:M.cpf_cnpj})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Valor Total"}),e.jsxs("p",{className:"text-gray-900 text-lg font-bold",children:["R$ ",y.valor.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"SituaÃ§Ã£o"}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium ${D(y.status)}`,children:[A(y.status),y.status]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{onClick:()=>S(y.id,y.numero),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(ho,{className:"w-5 h-5"}),"Baixar DANFE"]}),e.jsxs("button",{onClick:()=>P(y.id,y.numero),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:[e.jsx(Gt,{className:"w-5 h-5"}),"Baixar XML"]})]})]})]})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full m-4",children:[e.jsxs("div",{className:"bg-red-50 border-b px-6 py-4 flex items-center gap-3",children:[e.jsx(ys,{className:"w-6 h-6 text-red-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Cancelar Nota Fiscal"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"AtenÃ§Ã£o:"})," O cancelamento de uma nota fiscal Ã© irreversÃ­vel e serÃ¡ enviado para a SEFAZ."]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Nota:"})," #",f.numero," - SÃ©rie ",f.serie]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Cliente:"})," ",(Z=f.cliente)==null?void 0:Z.nome]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Justificativa do Cancelamento *"}),e.jsx("textarea",{value:u,onChange:$=>h($.target.value),placeholder:"Digite o motivo do cancelamento (mÃ­nimo 15 caracteres)",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[u.length,"/15 caracteres"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{b(null),h("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",disabled:p,children:"Voltar"}),e.jsx("button",{onClick:W,disabled:p||u.length<15,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Cancelando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ys,{className:"w-5 h-5"}),"Confirmar Cancelamento"]})})]})]})]})})]})}const Kx=()=>{const{clienteId:a}=lt(),t=va(),[s,o]=n.useState(null),[r,i]=n.useState([]),[l,x]=n.useState(!0),[j,g]=n.useState({tipo_evento:"",pet_id:""}),[v,d]=n.useState(!1);n.useEffect(()=>{m(),C()},[a]);const m=async()=>{try{const c=await F.get(`/clientes/${a}`);o(c.data)}catch(c){console.error("Erro ao carregar cliente:",c)}finally{x(!1)}},C=async()=>{try{const c=await F.get(`/pets/cliente/${a}`);i(c.data)}catch(c){console.error("Erro ao carregar pets:",c)}},y=()=>{g({tipo_evento:"",pet_id:""})};return l?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando..."})]})}):s?e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>t("/clientes"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(wt,{}),"Voltar para clientes"]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Timeline de ",s.nome]}),e.jsx("p",{className:"text-gray-600",children:"HistÃ³rico completo de eventos e interaÃ§Ãµes"})]}),e.jsxs("button",{onClick:()=>d(!v),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(Eo,{}),"Filtros"]})]}),v&&e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Evento"}),e.jsxs("select",{value:j.tipo_evento,onChange:c=>g({...j,tipo_evento:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"Todos os tipos"}),e.jsx("option",{value:"venda",children:"ðŸ›’ Vendas"}),e.jsx("option",{value:"conta_receber",children:"ðŸ’° Contas a Receber"}),e.jsx("option",{value:"pet_cadastro",children:"ðŸ¾ Cadastro de Pet"}),e.jsx("option",{value:"pet_atualizacao",children:"âœï¸ AtualizaÃ§Ã£o de Pet"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pet"}),e.jsxs("select",{value:j.pet_id,onChange:c=>g({...j,pet_id:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",disabled:r.length===0,children:[e.jsx("option",{value:"",children:"Todos os pets"}),r.map(c=>e.jsxs("option",{value:c.id,children:[c.nome," - ",c.especie]},c.id))]})]}),e.jsx("div",{className:"col-span-2 flex justify-end gap-2",children:e.jsxs("button",{onClick:y,className:"px-4 py-2 text-gray-600 hover:text-gray-900 flex items-center gap-2",children:[e.jsx(ks,{}),"Limpar filtros"]})})]})})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsx(Lo,{clienteId:parseInt(a),limit:100,showHeader:!1})})]}):e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:"Cliente nÃ£o encontrado"})})};function Gx(){const{id:a}=lt(),t=va(),[s,o]=n.useState(null),[r,i]=n.useState([]),[l,x]=n.useState(!0),[j,g]=n.useState(!1),[v,d]=n.useState([]),[m,C]=n.useState(null),[y,c]=n.useState("entrada"),[f,b]=n.useState({quantidade:"",custo_unitario:"",observacao:"",lote:"",data_validade:"",data_fabricacao:""});n.useEffect(()=>{u()},[a]);const u=async()=>{var M,Z,$;try{x(!0),console.log("Carregando produto ID:",a);const J=await F.get(`/produtos/${a}`);console.log("Produto carregado:",J.data),o(J.data);const E=await F.get(`/estoque/movimentacoes/produto/${a}`);console.log("MovimentaÃ§Ãµes carregadas:",E.data),i(E.data)}catch(J){console.error("Erro ao carregar dados:",J),console.error("Detalhes do erro:",(M=J.response)==null?void 0:M.data),Ee.error((($=(Z=J.response)==null?void 0:Z.data)==null?void 0:$.detail)||"Erro ao carregar dados do produto")}finally{x(!1)}},h=(M,Z=null)=>{var $,J;if((s==null?void 0:s.tipo_produto)==="KIT"&&(s==null?void 0:s.tipo_kit)==="VIRTUAL"&&!Z){Ee.error(`âŒ KIT VIRTUAL nÃ£o permite movimentaÃ§Ã£o manual de estoque.

O estoque deste kit Ã© calculado automaticamente com base nos componentes.

Para alterar o estoque, movimente os produtos componentes individualmente.`,{duration:6e3});return}c(M),C(Z),b(Z?{quantidade:(($=Z.quantidade)==null?void 0:$.toString())||"",custo_unitario:((J=Z.custo_unitario)==null?void 0:J.toString())||"",observacao:Z.observacao||"",lote:Z.lote_id||"",data_validade:"",data_fabricacao:""}:{quantidade:"",custo_unitario:M==="entrada"&&(s==null?void 0:s.preco_custo)||"",observacao:"",lote:"",data_validade:"",data_fabricacao:"",retornar_componentes:!1}),g(!0)},p=()=>{v.length===r.length?d([]):d(r.map(M=>M.id))},k=M=>{v.includes(M)?d(v.filter(Z=>Z!==M)):d([...v,M])},N=async()=>{var M,Z;if(v.length===0){Ee.error("Selecione pelo menos um lanÃ§amento");return}if(confirm(`Deseja realmente excluir ${v.length} lanÃ§amento(s)?`))try{const J=(await Promise.all(v.map(E=>F.delete(`/estoque/movimentacoes/${E}`)))).flatMap(E=>E.data.componentes_estornados||[]);J.length>0?Ee.success(`${v.length} lanÃ§amento(s) excluÃ­do(s)!
âœ… ${J.length} componente(s) estornado(s)`,{duration:5e3}):Ee.success(`${v.length} lanÃ§amento(s) excluÃ­do(s)`),d([]),u()}catch($){console.error("Erro ao excluir:",$),Ee.error(((Z=(M=$.response)==null?void 0:M.data)==null?void 0:Z.detail)||"Erro ao excluir lanÃ§amentos")}},w=async M=>{var Z,$,J;M.preventDefault();try{if(m){const B={quantidade:parseFloat(f.quantidade),custo_unitario:f.custo_unitario?parseFloat(f.custo_unitario):null,observacao:f.observacao||null};await F.patch(`/estoque/movimentacoes/${m.id}`,B),Ee.success("LanÃ§amento atualizado com sucesso!"),g(!1),C(null),u();return}let E="/estoque/",R={produto_id:parseInt(a),quantidade:parseFloat(f.quantidade),custo_unitario:f.custo_unitario?parseFloat(f.custo_unitario):null,observacao:f.observacao||null};if(y==="entrada")E+="entrada",R.tipo="entrada",R.motivo="compra",R.numero_lote=f.lote||null,R.data_validade=f.data_validade||null,R.data_fabricacao=f.data_fabricacao||null;else if(y==="saida")E+="saida",R.tipo="saida",R.motivo="saida_manual",R.numero_lote=f.lote||null,R.data_validade=f.data_validade||null,(s==null?void 0:s.tipo_produto)==="KIT"&&(s==null?void 0:s.tipo_kit)==="FISICO"&&(R.retornar_componentes=f.retornar_componentes===!0);else if(y==="balanco"){const B=parseFloat(f.quantidade),_=(s==null?void 0:s.estoque_atual)||0,O=B-_;E+=O>=0?"entrada":"saida",R.tipo=O>=0?"entrada":"saida",R.quantidade=Math.abs(O),R.motivo="balanco"}const K=await F.post(E,R);if(console.log("Response da entrada:",K.data),y==="entrada"&&K.data){const{custo_anterior:B,custo_unitario:_,variacao_preco:O}=K.data;if(O&&B!==null&&B!==void 0){let q="LanÃ§amento registrado!";O==="aumento"?(q+=` â¬†ï¸ Custo aumentou de R$ ${B==null?void 0:B.toFixed(2)} para R$ ${_==null?void 0:_.toFixed(2)}`,Ee.error(q,{duration:5e3})):O==="reducao"?(q+=` â¬‡ï¸ Custo reduziu de R$ ${B==null?void 0:B.toFixed(2)} para R$ ${_==null?void 0:_.toFixed(2)}`,Ee.success(q,{duration:5e3})):O==="estavel"&&(q+=` Custo mantido em R$ ${_==null?void 0:_.toFixed(2)}`,Ee(q,{icon:"âž–",duration:3e3}))}else _?Ee.success(`LanÃ§amento registrado! Custo: R$ ${_==null?void 0:_.toFixed(2)}`,{duration:3e3}):Ee.success("LanÃ§amento registrado com sucesso!")}else if((Z=K.data)!=null&&Z.componentes_sensibilizados&&K.data.componentes_sensibilizados.length>0){const B=K.data.componentes_sensibilizados.length;Ee.success(`LanÃ§amento registrado com sucesso!
âœ… ${B} componente(s) sensibilizado(s)`,{duration:4e3})}else Ee.success("LanÃ§amento registrado com sucesso!");g(!1),u()}catch(E){console.error("Erro ao registrar lanÃ§amento:",E),Ee.error(((J=($=E.response)==null?void 0:$.data)==null?void 0:J.detail)||"Erro ao registrar lanÃ§amento")}},S=M=>{if(!M)return"-";const Z=new Date(M);return new Date(Z.getTime()-3*60*60*1e3).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"America/Sao_Paulo"})},P=M=>({compra:"Compra",venda:"Venda",venda_online:"Venda Online",ajuste:"Ajuste",saida_manual:"SaÃ­da Manual",devolucao:"DevoluÃ§Ã£o",perda:"Perda",transferencia:"TransferÃªncia",balanco:"BalanÃ§o"})[M]||M,W=M=>M.referencia_tipo==="venda"?M.documento&&(M.documento.length===44||M.documento.startsWith("NF"))?{texto:`NF ${M.documento}`,icone:"nf-venda",cor:"text-red-600",link:null}:{texto:`Pedido #${M.referencia_id}`,icone:"pedido",cor:"text-orange-600",link:`/pdv?vendaId=${M.referencia_id}`}:M.motivo==="balanco"?{texto:"BalanÃ§o",icone:"balanco",cor:"text-blue-600",link:null}:M.tipo==="saida"?{texto:"SaÃ­da Manual",icone:"manual",cor:"text-red-600",link:null}:M.tipo==="entrada"&&M.documento&&M.documento.length===44?{texto:`NF ${M.documento.substring(25,34)}`,icone:"nf-entrada",cor:"text-green-600",link:null}:M.tipo==="entrada"&&M.documento?{texto:M.documento,icone:"documento",cor:"text-blue-600",link:`/pdv?vendaId=${M.documento}`}:M.tipo==="entrada"?{texto:"Entrada Manual",icone:"manual",cor:"text-green-600",link:null}:{texto:"Manual",icone:"manual",cor:"text-gray-500",link:null},te=r.filter(M=>M.tipo==="entrada").reduce((M,Z)=>M+parseFloat(Z.quantidade||0),0),D=r.filter(M=>M.tipo==="saida").reduce((M,Z)=>M+parseFloat(Z.quantidade||0),0);if(l)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-gray-500",children:"Carregando..."})});if(!s)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-red-500",children:"Produto nÃ£o encontrado"})});const A=s.estoque_atual||0,X=s.estoque_minimo||0,re=A>X?"text-green-600":A===0?"text-red-600":"text-yellow-600";return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[(s==null?void 0:s.tipo_produto)==="KIT"&&(s==null?void 0:s.tipo_kit)==="VIRTUAL"&&e.jsx("div",{className:"mb-6 bg-indigo-50 border border-indigo-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-indigo-600 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-indigo-900 mb-1",children:"ðŸ§© KIT VIRTUAL - Estoque Calculado Automaticamente"}),e.jsxs("p",{className:"text-sm text-indigo-800",children:["Este Ã© um produto do tipo ",e.jsx("strong",{children:"KIT VIRTUAL"}),". O estoque Ã© calculado automaticamente com base nos componentes que o compÃµem.",e.jsx("br",{}),e.jsx("strong",{children:"NÃ£o Ã© possÃ­vel movimentar o estoque do kit diretamente."})," Para alterar o estoque, movimente os produtos componentes individualmente."]})]})]})}),(s==null?void 0:s.tipo_produto)==="KIT"&&(s==null?void 0:s.tipo_kit)==="FISICO"&&e.jsx("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-green-600 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-1",children:"ðŸ“¦ KIT FÃSICO - Estoque PrÃ³prio com SensibilizaÃ§Ã£o"}),e.jsxs("p",{className:"text-sm text-green-800",children:["Este Ã© um produto do tipo ",e.jsx("strong",{children:"KIT FÃSICO"}),". Possui estoque prÃ³prio e independente.",e.jsx("br",{}),e.jsx("strong",{children:"Importante:"})," Ao movimentar o estoque do kit, os estoques dos componentes tambÃ©m serÃ£o automaticamente sensibilizados na mesma proporÃ§Ã£o."]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${A>X?"bg-green-100":A===0?"bg-red-100":"bg-yellow-100"}`,children:e.jsx("svg",{className:`w-6 h-6 ${re}`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>t("/produtos"),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s.nome})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{children:["CÃ³digo: ",e.jsx("span",{className:"font-mono",children:s.codigo||s.sku})]}),s.codigo_barras&&e.jsxs("div",{children:["EAN: ",e.jsx("span",{className:"font-mono",children:s.codigo_barras})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-green-600 font-medium mb-1",children:"Total Entradas"}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:te.toFixed(2)})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-red-600 font-medium mb-1",children:"Total SaÃ­das"}),e.jsx("div",{className:"text-2xl font-bold text-red-700",children:D.toFixed(2)})]}),e.jsxs("div",{className:`rounded-lg p-3 ${A>X?"bg-blue-50":A===0?"bg-red-50":"bg-yellow-50"}`,children:[e.jsx("div",{className:`text-xs font-medium mb-1 ${A>X?"text-blue-600":A===0?"text-red-600":"text-yellow-600"}`,children:"Saldo Atual"}),e.jsxs("div",{className:`text-2xl font-bold ${A>X?"text-blue-700":A===0?"text-red-700":"text-yellow-700"}`,children:[A.toFixed(2)," ",s.unidade||"UN"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 font-medium mb-1",children:"Estoque MÃ­n/MÃ¡x"}),e.jsxs("div",{className:"text-lg font-bold text-gray-700",children:[X.toFixed(0)," / ",(s.estoque_maximo||0).toFixed(0)]})]})]}),e.jsx("div",{className:"relative group",children:e.jsxs("button",{onClick:()=>{(s==null?void 0:s.tipo_produto)==="KIT"&&(s==null?void 0:s.tipo_kit)==="VIRTUAL"?Ee.error(`KIT VIRTUAL nÃ£o permite movimentaÃ§Ã£o manual.

Movimente os componentes individualmente.`,{duration:4e3}):g(!0)},disabled:(s==null?void 0:s.tipo_produto)==="KIT"&&(s==null?void 0:s.tipo_kit)==="VIRTUAL",className:`px-6 py-2 rounded-lg transition-colors flex items-center gap-2 ${(s==null?void 0:s.tipo_produto)==="KIT"&&(s==null?void 0:s.tipo_kit)==="VIRTUAL"?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Incluir lanÃ§amento"]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"LanÃ§amentos"}),v.length>0&&e.jsxs("button",{onClick:N,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Excluir (",v.length,")"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 w-12",children:e.jsx("input",{type:"checkbox",checked:v.length===r.length&&r.length>0,onChange:p,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data e Hora"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Entrada"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SaÃ­da"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PreÃ§o Venda"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PreÃ§o Compra"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Lote"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Origem"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ObservaÃ§Ã£o"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"px-6 py-8 text-center text-gray-500",children:"Nenhuma movimentaÃ§Ã£o registrada"})}):r.map((M,Z)=>{const $=W(M),J=Z>0?r[Z-1]:null,E=J&&M.referencia_tipo==="venda"&&J.referencia_tipo==="venda"&&M.referencia_id===J.referencia_id;return e.jsxs("tr",{className:`hover:bg-gray-50 cursor-pointer ${E?"border-l-4 border-l-blue-500 bg-blue-50":""}`,onClick:()=>h(M.tipo,M),children:[e.jsx("td",{className:"px-4 py-3 w-12",onClick:R=>R.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:v.includes(M.id),onChange:()=>k(M.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:S(M.created_at)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-center",children:M.tipo==="entrada"?e.jsx("span",{className:"text-green-600 font-semibold",children:parseFloat(M.quantidade).toFixed(2)}):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-center",children:M.tipo==="saida"?e.jsx("span",{className:"text-red-600 font-semibold",children:parseFloat(M.quantidade).toFixed(2)}):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-right text-gray-900",children:s.preco_venda?`R$ ${s.preco_venda.toFixed(2)}`:"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-right",children:M.custo_unitario?M.variacao_custo?e.jsxs("div",{className:"relative group inline-block",title:`Custo anterior: R$ ${M.variacao_custo.custo_anterior.toFixed(2)}
Custo atual: R$ ${M.variacao_custo.custo_atual.toFixed(2)}
DiferenÃ§a: R$ ${M.variacao_custo.diferenca_valor.toFixed(2)} (${M.variacao_custo.diferenca_percentual>0?"+":""}${M.variacao_custo.diferenca_percentual.toFixed(1)}%)`,children:[e.jsxs("span",{className:`font-semibold ${M.variacao_custo.tipo==="aumento"?"text-red-600":M.variacao_custo.tipo==="reducao"?"text-green-600":"text-gray-900"}`,children:["R$ ",M.custo_unitario.toFixed(2)]}),e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block z-50",children:e.jsxs("div",{className:"bg-gray-900 text-white text-xs rounded-lg py-2 px-3 whitespace-nowrap shadow-lg",children:[e.jsx("div",{className:"font-semibold mb-1",children:"VariaÃ§Ã£o de Custo"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Anterior: R$ ",M.variacao_custo.custo_anterior.toFixed(2)]}),e.jsxs("div",{children:["Atual: R$ ",M.variacao_custo.custo_atual.toFixed(2)]}),e.jsxs("div",{className:M.variacao_custo.tipo==="aumento"?"text-red-400":"text-green-400",children:[M.variacao_custo.tipo==="aumento"?"â–²":"â–¼"," R$ ",Math.abs(M.variacao_custo.diferenca_valor).toFixed(2)," (",M.variacao_custo.diferenca_percentual>0?"+":"",M.variacao_custo.diferenca_percentual.toFixed(1),"%)"]})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2",children:e.jsx("div",{className:"border-4 border-transparent border-t-gray-900"})})]})})]}):e.jsxs("span",{className:"text-gray-900",children:["R$ ",M.custo_unitario.toFixed(2)]}):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-600",children:M.lote_info?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:M.lote_info.nome}),M.lote_info.consumido_acumulado!==void 0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",M.lote_info.consumido_acumulado.toFixed(0),"/",M.lote_info.total_lote.toFixed(0),")"]})]}):M.lote_nome?M.lote_nome:"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",onClick:R=>R.stopPropagation(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[E&&e.jsx("span",{className:"text-blue-600",title:"Mesmo pedido/venda",children:"â†ª"}),$.link?e.jsx("a",{href:$.link,onClick:R=>{R.preventDefault(),R.stopPropagation(),t($.link)},className:`${$.cor} font-medium hover:underline cursor-pointer`,children:$.texto}):e.jsx("span",{className:`${$.cor} font-medium`,children:$.texto})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jsxs("div",{className:"flex items-center gap-2",children:[M.motivo&&M.motivo!=="compra"&&M.motivo!=="venda"&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs",children:P(M.motivo)}),M.observacao]})})]},M.id)})})]})})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:m?"Editar LanÃ§amento":"Novo LanÃ§amento"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:w,className:"p-6 space-y-4",children:[!m&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo *"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>c("entrada"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${y==="entrada"?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Entrada"}),e.jsx("button",{type:"button",onClick:()=>c("saida"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${y==="saida"?"bg-red-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"SaÃ­da"}),e.jsx("button",{type:"button",onClick:()=>c("balanco"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${y==="balanco"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"BalanÃ§o"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:y==="balanco"?"Saldo Total *":"Quantidade *"}),e.jsx("input",{type:"number",step:"0.01",value:f.quantidade,onChange:M=>b({...f,quantidade:M.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0}),y==="balanco"&&e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Estoque atual: ",A,". Digite o novo saldo total."]})]}),y==="entrada"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PreÃ§o de Compra"}),e.jsx("input",{type:"number",step:"0.01",value:f.custo_unitario,onChange:M=>b({...f,custo_unitario:M.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["NÃºmero do Lote ",e.jsx("span",{className:"text-gray-400",children:"(opcional)"})]}),e.jsx("input",{type:"text",value:f.lote,onChange:M=>b({...f,lote:M.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: LOTE-001"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Data de Validade ",e.jsx("span",{className:"text-gray-400",children:"(opcional)"})]}),e.jsx("input",{type:"date",value:f.data_validade,onChange:M=>b({...f,data_validade:M.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Data de FabricaÃ§Ã£o ",e.jsx("span",{className:"text-gray-400",children:"(opcional)"})]}),e.jsx("input",{type:"date",value:f.data_fabricacao,onChange:M=>b({...f,data_fabricacao:M.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),y==="saida"&&e.jsxs(e.Fragment,{children:[(s==null?void 0:s.tipo_produto)==="KIT"&&(s==null?void 0:s.tipo_kit)==="FISICO"&&e.jsx("div",{className:"p-4 bg-yellow-50 border-2 border-yellow-300 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",id:"retornar_componentes",checked:f.retornar_componentes===!0,onChange:M=>b({...f,retornar_componentes:M.target.checked}),className:"mt-1 h-5 w-5 text-green-600 focus:ring-green-500 border-gray-300 rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"retornar_componentes",className:"block text-sm font-semibold text-gray-900 cursor-pointer",children:"ðŸ”„ Desmontar kit e retornar componentes ao estoque"}),e.jsxs("p",{className:"text-xs text-gray-700 mt-1",children:[e.jsx("strong",{children:"Marque esta opÃ§Ã£o"})," se vocÃª desmontou o kit e quer devolver os produtos unitÃ¡rios ao estoque."]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[e.jsx("strong",{children:"Deixe desmarcado"})," se houve perda, roubo ou venda do kit montado."]})]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["NÃºmero do Lote ",e.jsx("span",{className:"text-gray-400",children:"(opcional)"})]}),e.jsx("input",{type:"text",value:f.lote,onChange:M=>b({...f,lote:M.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: LOTE-001"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Deixe vazio para usar FIFO automÃ¡tico"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Data de Validade ",e.jsx("span",{className:"text-gray-400",children:"(opcional)"})]}),e.jsx("input",{type:"date",value:f.data_validade,onChange:M=>b({...f,data_validade:M.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ObservaÃ§Ã£o"}),e.jsx("textarea",{value:f.observacao,onChange:M=>b({...f,observacao:M.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"ObservaÃ§Ãµes sobre este lanÃ§amento..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>g(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Incluir"})]})]})]})})]})}const Xx=()=>{const[a,t]=n.useState([]),[s,o]=n.useState([]),[r,i]=n.useState(!1),[l,x]=n.useState(!1),[j,g]=n.useState("todos"),[v,d]=n.useState("");n.useEffect(()=>{m()},[]);const m=async()=>{i(!0);try{const p=await F.get("/produtos/");t(p.data.items||[])}catch(p){console.error("Erro ao carregar produtos:",p),ce.error("Erro ao carregar produtos"),t([])}finally{i(!1)}},C=async()=>{var p,k;i(!0);try{const N=v?{descricao:v}:{},w=await F.get("/bling-sync/produtos",{params:N});o(w.data||[]),ce.success(`âœ… ${(w.data||[]).length} produtos encontrados no Bling`)}catch(N){console.error("Erro ao buscar no Bling:",N),ce.error(((k=(p=N.response)==null?void 0:p.data)==null?void 0:k.detail)||"Erro ao buscar produtos no Bling"),o([])}finally{i(!1)}},y=async(p,k)=>{var N,w;try{await F.post("/bling-sync/vincular",{produto_id:p,bling_id:k}),ce.success("âœ… Produto vinculado ao Bling com sucesso!"),m()}catch(S){ce.error(((w=(N=S.response)==null?void 0:N.data)==null?void 0:w.detail)||"Erro ao vincular produto")}},c=async p=>{var k,N;x(!0);try{const w=await F.post(`/bling-sync/sincronizar-estoque/${p}`,{});ce.success(`âœ… Estoque sincronizado!
Sistema: ${w.data.estoque_local} â†’ Bling: ${w.data.estoque_bling}`,{duration:4e3}),m()}catch(w){ce.error(((N=(k=w.response)==null?void 0:k.data)==null?void 0:N.detail)||"Erro ao sincronizar estoque")}finally{x(!1)}},f=async()=>{x(!0);const p=a.filter(w=>w.bling_id);if(p.length===0){ce.error("Nenhum produto vinculado ao Bling"),x(!1);return}let k=0,N=0;for(const w of p)try{await F.post(`/bling-sync/sincronizar-estoque/${w.id}`,{}),k++}catch(S){N++,console.error(`Erro ao sincronizar produto ${w.id}:`,S)}ce.success(`âœ… SincronizaÃ§Ã£o concluÃ­da!
${k} produtos atualizados${N>0?`, ${N} erros`:""}`,{duration:5e3}),carregarDados(),x(!1)},b=async()=>{var p,k;i(!0);try{const N=await F.post("/bling-sync/reconciliar",{});ce.success(`âœ… ReconciliaÃ§Ã£o concluÃ­da!
${N.data.total_processados} produtos processados
${N.data.diferencas_encontradas} diferenÃ§as encontradas`,{duration:5e3}),m()}catch(N){ce.error(((k=(p=N.response)==null?void 0:p.data)==null?void 0:k.detail)||"Erro ao reconciliar estoques")}finally{i(!1)}},u=a.filter(p=>j==="sincronizados"?p.bling_id:j==="nao_sincronizados"?!p.bling_id:!0),h={total:a.length,sincronizados:a.filter(p=>p.bling_id).length,naoSincronizados:a.filter(p=>!p.bling_id).length};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"ðŸ”„ SincronizaÃ§Ã£o Bling"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie a integraÃ§Ã£o dos produtos com o Bling ERP"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:h.total}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Produtos"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:h.sincronizados}),e.jsx("div",{className:"text-sm text-gray-600",children:"Vinculados ao Bling"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:h.naoSincronizados}),e.jsx("div",{className:"text-sm text-gray-600",children:"NÃ£o Vinculados"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[h.total>0?(h.sincronizados/h.total*100).toFixed(1):0,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Taxa de SincronizaÃ§Ã£o"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"âš¡ AÃ§Ãµes RÃ¡pidas"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:f,disabled:l||h.sincronizados===0,className:"flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:l?"â³ Sincronizando...":`ðŸ”„ Sincronizar Todos (${h.sincronizados})`}),e.jsx("button",{onClick:b,disabled:r||h.sincronizados===0,className:"flex-1 bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:r?"â³ Reconciliando...":"ðŸ” Reconciliar Estoques"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-3",children:[e.jsx("strong",{children:"Sincronizar:"})," Atualiza o estoque do Bling com os valores do sistema.",e.jsx("strong",{className:"ml-4",children:"Reconciliar:"})," Compara e identifica diferenÃ§as entre os estoques."]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"ðŸ” Buscar Produtos no Bling"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:v,onChange:p=>d(p.target.value),placeholder:"Digite o nome do produto (deixe vazio para buscar todos)",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",onKeyPress:p=>p.key==="Enter"&&C()}),e.jsx("button",{onClick:C,disabled:r,className:"bg-green-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-green-700 disabled:bg-gray-400",children:r?"â³ Buscando...":"ðŸ” Buscar"})]}),s.length>0&&e.jsxs("div",{className:"mt-4 border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-2 font-semibold border-b",children:[s.length," produtos encontrados no Bling"]}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:s.map(p=>e.jsxs("div",{className:"px-4 py-3 border-b hover:bg-gray-50 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:p.descricao}),e.jsxs("div",{className:"text-sm text-gray-600",children:["ID Bling: ",p.id," | CÃ³digo: ",p.codigo," | Estoque: ",p.estoque]})]}),e.jsxs("select",{onChange:k=>k.target.value&&y(parseInt(k.target.value),p.id),className:"px-3 py-2 border border-gray-300 rounded text-sm",children:[e.jsx("option",{value:"",children:"Vincular ao produto..."}),a.filter(k=>!k.bling_id).map(k=>e.jsxs("option",{value:k.id,children:[k.codigo," - ",k.nome]},k.id))]})]},p.id))})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>g("todos"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${j==="todos"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Todos (",h.total,")"]}),e.jsxs("button",{onClick:()=>g("sincronizados"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${j==="sincronizados"?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["âœ… Sincronizados (",h.sincronizados,")"]}),e.jsxs("button",{onClick:()=>g("nao_sincronizados"),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${j==="nao_sincronizados"?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["âš ï¸ NÃ£o Sincronizados (",h.naoSincronizados,")"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"CÃ³digo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Estoque Local"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"ID Bling"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{children:r&&u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:"â³ Carregando produtos..."})}):u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-500",children:"Nenhum produto encontrado com os filtros selecionados"})}):u.map(p=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-mono text-sm",children:p.codigo})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold",children:p.nome}),p.categoria&&e.jsx("div",{className:"text-xs text-gray-500",children:p.categoria})]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`font-semibold ${(p.estoque_atual||0)<=(p.estoque_minimo||0)?"text-red-600":"text-green-600"}`,children:p.estoque_atual||0})}),e.jsx("td",{className:"px-4 py-3 text-center",children:p.bling_id?e.jsx("span",{className:"inline-block bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-semibold",children:p.bling_id}):e.jsx("span",{className:"text-gray-400 text-sm",children:"â€”"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:p.bling_id?e.jsx("span",{className:"inline-block bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-semibold",children:"âœ… VINCULADO"}):e.jsx("span",{className:"inline-block bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs font-semibold",children:"âš ï¸ NÃƒO VINCULADO"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:p.bling_id?e.jsx("button",{onClick:()=>c(p.id),disabled:l,className:"text-blue-600 hover:text-blue-800 font-semibold text-sm disabled:text-gray-400",title:"Sincronizar estoque com Bling",children:"ðŸ”„ Sync"}):e.jsx("span",{className:"text-gray-400 text-sm",children:"â€”"})})]},p.id))})]})})]})},Qx=()=>{const[a,t]=n.useState([]),[s,o]=n.useState([]),[r,i]=n.useState([]),[l,x]=n.useState(!1),[j,g]=n.useState(!1),[v,d]=n.useState(!1),[m,C]=n.useState(null),[y,c]=n.useState(null),[f,b]=n.useState(!1),[u,h]=n.useState(!1),[p,k]=n.useState(null),[N,w]=n.useState({email:"",whatsapp:"",formatos:{pdf:!0,excel:!1}}),[S,P]=n.useState(!1),[W,te]=n.useState([]),[D,A]=n.useState(!1),[X,re]=n.useState(90),[M,Z]=n.useState(30),[$,J]=n.useState(!1),[E,R]=n.useState(!0),[K,B]=n.useState([]),[_,O]=n.useState({}),[q,ae]=n.useState({fornecedor_id:"",data_prevista_entrega:"",valor_frete:"0",valor_desconto:"0",observacoes:"",itens:[]}),[H,le]=n.useState({produto_id:"",quantidade_pedida:"",preco_unitario:""}),[G,ee]=n.useState(""),[de,ue]=n.useState("");n.useEffect(()=>{Ae()},[]);const Ae=async()=>{try{const[U,ie]=await Promise.all([F.get("/pedidos-compra/"),F.get("/clientes/?tipo_cadastro=fornecedor&apenas_ativos=true")]),_e=Array.isArray(U.data)?U.data:U.data.items||U.data.pedidos||[],$e=Array.isArray(ie.data)?ie.data:ie.data.items||ie.data.clientes||[];t(_e),o($e)}catch(U){console.error("Erro ao carregar dados:",U),ce.error("Erro ao carregar dados")}},se=async U=>{if(!U){i([]);return}try{const ie=await F.get(`/produtos/?fornecedor_id=${U}`);let _e;Array.isArray(ie.data)?_e=ie.data:ie.data.items?_e=ie.data.items:ie.data.produtos?_e=ie.data.produtos:_e=[],_e.length===0&&ce.warning("âš ï¸ Este fornecedor nÃ£o possui produtos vinculados. Edite os produtos para vincular ao fornecedor."),i(_e)}catch(ie){console.error("Erro ao carregar produtos:",ie),ce.error("Erro ao carregar produtos do fornecedor")}},we=U=>{const ie=r.find(_e=>_e.id===parseInt(U));ie&&(ue(ie.nome),ie.preco_custo?le({...H,produto_id:U,preco_unitario:ie.preco_custo.toFixed(2)}):le({...H,produto_id:U}))},Se=()=>{if(!H.produto_id||!H.quantidade_pedida||!H.preco_unitario){ce.error("Preencha todos os campos do item");return}const U=r.find(ne=>ne.id===parseInt(H.produto_id)),ie=parseFloat(H.quantidade_pedida),_e=parseFloat(H.preco_unitario),$e=parseInt(H.produto_id),T=q.itens.findIndex(ne=>ne.produto_id===$e);if(T!==-1){const ne=q.itens[T];if(window.confirm(`âš ï¸ O produto "${U.nome}" jÃ¡ estÃ¡ no pedido!

Quantidade atual: ${ne.quantidade_pedida}
PreÃ§o atual: R$ ${ne.preco_unitario.toFixed(2)}

Nova quantidade: ${ie}
Novo preÃ§o: R$ ${_e.toFixed(2)}

Deseja SOMAR a quantidade ao item existente?

âœ… OK = Somar quantidade (${ne.quantidade_pedida} + ${ie} = ${ne.quantidade_pedida+ie})
âŒ CANCELAR = NÃ£o adicionar`)){const Pe=[...q.itens];Pe[T]={...ne,quantidade_pedida:ne.quantidade_pedida+ie,preco_unitario:_e,total:(ne.quantidade_pedida+ie)*_e},ae({...q,itens:Pe}),ce.success(`âœ… Quantidade somada! Total: ${ne.quantidade_pedida+ie}`)}else ce.info("AdiÃ§Ã£o cancelada");ue(""),le({produto_id:"",quantidade_pedida:"",preco_unitario:""});return}ae({...q,itens:[...q.itens,{produto_id:$e,produto_nome:U.nome,quantidade_pedida:ie,preco_unitario:_e,desconto_item:0,total:ie*_e}]}),ue(""),le({produto_id:"",quantidade_pedida:"",preco_unitario:""})},ea=U=>{ae({...q,itens:q.itens.filter((ie,_e)=>_e!==U)})},Ie=()=>{const U=q.itens.reduce(($e,T)=>$e+T.total,0),ie=parseFloat(q.valor_frete||0),_e=parseFloat(q.valor_desconto||0);return U+ie-_e},Je=async()=>{if(!q.fornecedor_id){ce.error("Selecione um fornecedor primeiro");return}A(!0);try{const U=await F.get(`/pedidos-compra/sugestao/${q.fornecedor_id}`,{params:{periodo_dias:X,dias_cobertura:M,apenas_criticos:$,incluir_alerta:E}});te(U.data.sugestoes||[]),B([]),O({}),U.data.sugestoes.length===0?ce.info("Nenhuma sugestÃ£o encontrada com os filtros aplicados"):ce.success(`${U.data.sugestoes.length} produtos analisados`)}catch(U){console.error("Erro ao buscar sugestÃµes:",U),ce.error("Erro ao gerar sugestÃµes")}finally{A(!1)}},be=U=>{B(ie=>ie.includes(U)?ie.filter(_e=>_e!==U):[...ie,U])},Fe=(U,ie)=>{O(_e=>({..._e,[U]:parseFloat(ie)||0}))},he=U=>_[U.produto_id]!==void 0?_[U.produto_id]:U.quantidade_sugerida,Qe=()=>{P(!1),B([]),O({})},Ze=()=>{const U=W.filter(ie=>ie.prioridade==="CRÃTICO"&&ie.quantidade_sugerida>0).map(ie=>ie.produto_id);B(U)},ma=()=>{if(K.length===0){ce.error("Selecione pelo menos um produto");return}const ie=W.filter(_e=>K.includes(_e.produto_id)).map(_e=>{const $e=he(_e);return{produto_id:_e.produto_id,produto_nome:_e.produto_nome,quantidade_pedida:Math.ceil($e),preco_unitario:_e.preco_unitario,desconto_item:0,total:Math.ceil($e)*_e.preco_unitario}});ae({...q,itens:[...q.itens,...ie]}),ce.success(`${ie.length} produtos adicionados ao pedido`),Qe()},oa=async U=>{var ie,_e;if(U.preventDefault(),q.itens.length===0){ce.error("Adicione pelo menos 1 item ao pedido");return}x(!0);try{const $e={...q,data_prevista_entrega:q.data_prevista_entrega?`${q.data_prevista_entrega}T12:00:00`:null};await F.post("/pedidos-compra/",$e),ce.success("âœ… Pedido criado com sucesso!"),g(!1),ae({fornecedor_id:"",data_prevista_entrega:"",valor_frete:"0",valor_desconto:"0",observacoes:"",itens:[]}),Ae()}catch($e){ce.error(((_e=(ie=$e.response)==null?void 0:ie.data)==null?void 0:_e.detail)||"Erro ao criar pedido")}finally{x(!1)}},ha=async U=>{k(U),w({email:"",whatsapp:"",formatos:{pdf:!0,excel:!1}}),h(!0)},da=async()=>{var U,ie;if(!N.email&&!N.whatsapp){ce.error("Informe um e-mail ou WhatsApp");return}if(!N.formatos.pdf&&!N.formatos.excel){ce.error("Selecione pelo menos um formato (PDF ou Excel)");return}try{await F.post(`/pedidos-compra/${p}/enviar`,{email:N.email,whatsapp:N.whatsapp,formatos:N.formatos}),ce.success("âœ… Pedido marcado como enviado!"),h(!1),Ae()}catch(_e){ce.error(((ie=(U=_e.response)==null?void 0:U.data)==null?void 0:ie.detail)||"Erro ao enviar pedido")}},oe=async()=>{var U,ie;try{await F.post(`/pedidos-compra/${p}/enviar`,{envio_manual:!0}),ce.success("âœ… Pedido marcado como enviado manualmente!"),h(!1),Ae()}catch(_e){ce.error(((ie=(U=_e.response)==null?void 0:U.data)==null?void 0:ie.detail)||"Erro ao marcar pedido")}},Ne=async U=>{var ie,_e;try{await F.post(`/pedidos-compra/${U}/confirmar`,{}),ce.success("âœ… Pedido confirmado!"),Ae()}catch($e){ce.error(((_e=(ie=$e.response)==null?void 0:ie.data)==null?void 0:_e.detail)||"Erro ao confirmar pedido")}},ke=async U=>{try{const ie=await F.get(`/pedidos-compra/${U}/export/pdf`,{responseType:"blob"}),_e=window.URL.createObjectURL(new Blob([ie.data])),$e=document.createElement("a");$e.href=_e,$e.setAttribute("download",`pedido_${U}.pdf`),document.body.appendChild($e),$e.click(),$e.remove(),ce.success("ðŸ“„ PDF exportado com sucesso!")}catch{ce.error("Erro ao exportar PDF")}},Ue=async U=>{try{const ie=await F.get(`/pedidos-compra/${U}/export/excel`,{responseType:"blob"}),_e=window.URL.createObjectURL(new Blob([ie.data])),$e=document.createElement("a");$e.href=_e,$e.setAttribute("download",`pedido_${U}.xlsx`),document.body.appendChild($e),$e.click(),$e.remove(),ce.success("ðŸ“Š Excel exportado com sucesso!")}catch{ce.error("Erro ao exportar Excel")}},ze=async U=>{try{const ie=await F.get(`/pedidos-compra/${U.id}`);c(ie.data),b(!0)}catch{ce.error("Erro ao carregar detalhes do pedido")}},Y=async U=>{var ie,_e;if(confirm("âš ï¸ Deseja reverter o status deste pedido para a etapa anterior?"))try{const $e=await F.post(`/pedidos-compra/${U}/reverter`,{});ce.success(`âª Status revertido: ${$e.data.status_anterior} â†’ ${$e.data.status_atual}`),Ae()}catch($e){ce.error(((_e=(ie=$e.response)==null?void 0:ie.data)==null?void 0:_e.detail)||"Erro ao reverter status")}},ve=async U=>{var ie,_e,$e;if(U.status!=="rascunho"){ce.error("âš ï¸ Apenas pedidos em rascunho podem ser editados");return}try{const ne=(await F.get(`/pedidos-compra/${U.id}`)).data;d(!0),C(ne),ae({fornecedor_id:((ie=ne.fornecedor_id)==null?void 0:ie.toString())||"",data_prevista_entrega:ne.data_prevista_entrega?new Date(ne.data_prevista_entrega).toISOString().split("T")[0]:"",valor_frete:((_e=ne.valor_frete)==null?void 0:_e.toString())||"0",valor_desconto:(($e=ne.valor_desconto)==null?void 0:$e.toString())||"0",observacoes:ne.observacoes||"",itens:ne.itens.map(pe=>({produto_id:pe.produto_id,produto_nome:pe.produto_nome||`Produto ${pe.produto_id}`,quantidade_pedida:pe.quantidade_pedida,preco_unitario:pe.preco_unitario,desconto_item:pe.desconto_item||0,total:pe.quantidade_pedida*pe.preco_unitario-(pe.desconto_item||0)}))}),ne.fornecedor_id&&se(ne.fornecedor_id),g(!0),ce.success("ðŸ“ Modo de ediÃ§Ã£o ativado")}catch{ce.error("Erro ao carregar pedido para ediÃ§Ã£o")}},Le=async U=>{var ie,_e;if(U.preventDefault(),q.itens.length===0){ce.error("âš ï¸ Adicione pelo menos um item ao pedido");return}try{x(!0);const $e={...q,fornecedor_id:parseInt(q.fornecedor_id),valor_frete:parseFloat(q.valor_frete),valor_desconto:parseFloat(q.valor_desconto),data_prevista_entrega:q.data_prevista_entrega?`${q.data_prevista_entrega}T12:00:00`:null,itens:q.itens.map(T=>({produto_id:T.produto_id,quantidade_pedida:parseFloat(T.quantidade_pedida),preco_unitario:parseFloat(T.preco_unitario),desconto_item:parseFloat(T.desconto_item||0)}))};await F.put(`/pedidos-compra/${m.id}`,$e),ce.success("âœï¸ Pedido atualizado com sucesso!"),g(!1),d(!1),C(null),ae({fornecedor_id:"",data_prevista_entrega:"",valor_frete:"0",valor_desconto:"0",observacoes:"",itens:[]}),Ae()}catch($e){ce.error(((_e=(ie=$e.response)==null?void 0:ie.data)==null?void 0:_e.detail)||"Erro ao atualizar pedido")}finally{x(!1)}},I=async U=>{try{const ie=await F.get(`/pedidos-compra/${U.id}`);c(ie.data),b(!0)}catch{ce.error("Erro ao carregar detalhes do pedido")}},Q=async U=>{var ie,_e;try{await F.post(`/pedidos-compra/${y.id}/receber`,{itens:U}),ce.success("âœ… Recebimento processado com sucesso!"),b(!1),c(null),Ae()}catch($e){ce.error(((_e=(ie=$e.response)==null?void 0:ie.data)==null?void 0:_e.detail)||"Erro ao processar recebimento")}},fe=U=>{const ie={rascunho:"bg-gray-200 text-gray-800",enviado:"bg-blue-200 text-blue-800",confirmado:"bg-green-200 text-green-800",recebido_parcial:"bg-yellow-200 text-yellow-800",recebido_total:"bg-green-500 text-white",cancelado:"bg-red-200 text-red-800"};return e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${ie[U]||"bg-gray-200"}`,children:U.replace("_"," ").toUpperCase()})};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"ðŸ›’ Pedidos de Compra"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie seus pedidos aos fornecedores"})]}),e.jsx("button",{onClick:()=>g(!j),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors",children:j?"âŒ Cancelar":"âž• Novo Pedido"})]}),j&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:v?"âœï¸ Editar Pedido":"Novo Pedido de Compra"}),e.jsx("button",{type:"button",onClick:()=>{g(!1),d(!1),C(null)},className:"text-gray-500 hover:text-gray-700",children:"âœ–ï¸"})]}),e.jsxs("form",{onSubmit:v?Le:oa,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fornecedor *"}),e.jsx("input",{list:"fornecedores-list",value:G,onChange:U=>{const ie=U.target.value;ee(ie);const _e=s.find($e=>$e.nome===ie);_e?(ae({...q,fornecedor_id:_e.id.toString(),itens:[]}),le({produto_id:"",quantidade_pedida:"",preco_unitario:""}),se(_e.id)):(ae({...q,fornecedor_id:"",itens:[]}),i([]))},placeholder:"Digite ou selecione o fornecedor",required:!!q.fornecedor_id,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsx("datalist",{id:"fornecedores-list",children:s.map(U=>e.jsx("option",{value:U.nome,children:U.cpf_cnpj?`- ${U.cpf_cnpj}`:""},U.id))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Digite ou selecione um fornecedor para carregar seus produtos"}),q.fornecedor_id&&e.jsx("button",{type:"button",onClick:()=>{P(!0),Je()},className:"mt-2 w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition-all flex items-center justify-center gap-2",children:"ðŸ’¡ SugestÃ£o Inteligente de Pedido"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Prevista Entrega"}),e.jsx("input",{type:"date",value:q.data_prevista_entrega,onChange:U=>ae({...q,data_prevista_entrega:U.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Itens do Pedido"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-4",children:[e.jsx("input",{list:"produtos-list",value:de,onChange:U=>{const ie=U.target.value;ue(ie);const _e=r.find($e=>$e.nome===ie);_e?we(_e.id.toString()):le({...H,produto_id:""})},placeholder:q.fornecedor_id?"Digite ou selecione o produto":"Selecione um fornecedor primeiro",disabled:!q.fornecedor_id,className:"col-span-2 px-4 py-2 border border-gray-300 rounded-lg disabled:bg-gray-100 focus:ring-2 focus:ring-blue-500"}),e.jsx("datalist",{id:"produtos-list",children:r.map(U=>e.jsx("option",{value:U.nome,children:`SKU: ${U.sku||U.codigo||"N/A"} | Barras: ${U.codigo_barras||"N/A"} | Estoque: ${U.estoque_atual||0}`},U.id))}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantidade",value:H.quantidade_pedida,onChange:U=>le({...H,quantidade_pedida:U.target.value}),className:"px-4 py-2 border border-gray-300 rounded-lg"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"PreÃ§o",value:H.preco_unitario,onChange:U=>le({...H,preco_unitario:U.target.value}),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg"}),e.jsx("button",{type:"button",onClick:Se,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:"âž•"})]})]}),q.itens.length>0&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-sm font-semibold",children:"Produto"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold",children:"PreÃ§o"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold",children:"Total"}),e.jsx("th",{className:"px-4 py-2"})]})}),e.jsx("tbody",{children:q.itens.map((U,ie)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:U.produto_nome}),e.jsx("td",{className:"px-4 py-2 text-right",children:U.quantidade_pedida}),e.jsxs("td",{className:"px-4 py-2 text-right",children:["R$ ",U.preco_unitario.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-2 text-right font-semibold",children:["R$ ",U.total.toFixed(2)]}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx("button",{type:"button",onClick:()=>ea(ie),className:"text-red-600 hover:text-red-800",children:"ðŸ—‘ï¸"})})]},ie))})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Frete (R$)"}),e.jsx("input",{type:"number",step:"0.01",value:q.valor_frete,onChange:U=>ae({...q,valor_frete:U.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Desconto (R$)"}),e.jsx("input",{type:"number",step:"0.01",value:q.valor_desconto,onChange:U=>ae({...q,valor_desconto:U.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Total"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["R$ ",Ie().toFixed(2)]})]})]}),e.jsx("button",{type:"submit",disabled:l,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-400",children:l?"â³ Processando...":v?"âœï¸ Salvar AlteraÃ§Ãµes":"âœ… Criar Pedido"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"NÃºmero"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Fornecedor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{children:a.map(U=>e.jsxs("tr",{className:`border-t hover:bg-gray-50 ${U.status==="rascunho"?"cursor-pointer":""}`,onClick:()=>U.status==="rascunho"&&ve(U),title:U.status==="rascunho"?"Clique para editar":"",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[U.numero_pedido,U.foi_alterado_apos_envio&&e.jsx("span",{className:"px-2 py-1 text-xs bg-orange-100 text-orange-700 rounded font-semibold",title:"Este pedido foi alterado apÃ³s o envio",children:"âš ï¸ Alterado"})]})}),e.jsx("td",{className:"px-4 py-3",children:U.fornecedor_id}),e.jsx("td",{className:"px-4 py-3",children:new Date(U.data_pedido).toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold",children:["R$ ",U.valor_final.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-center",children:fe(U.status)}),e.jsx("td",{className:"px-4 py-3 text-center",onClick:ie=>ie.stopPropagation(),children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>ze(U),className:"px-2 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 text-xs font-semibold",title:"Ver detalhes completos do pedido",children:"ðŸ” Ver"}),e.jsx("button",{onClick:()=>ke(U.id),className:"px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 text-xs font-semibold",title:"Exportar PDF",children:"ðŸ“„ PDF"}),e.jsx("button",{onClick:()=>Ue(U.id),className:"px-2 py-1 bg-green-100 text-green-700 rounded hover:bg-green-200 text-xs font-semibold",title:"Exportar Excel",children:"ðŸ“Š Excel"}),U.status==="rascunho"&&e.jsx("button",{onClick:()=>ha(U.id),className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs font-semibold",title:"Enviar pedido ao fornecedor",children:"ðŸ“¤ Enviar"}),U.status==="enviado"&&e.jsx("button",{onClick:()=>Ne(U.id),className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-xs font-semibold",title:"Confirmar recebimento do pedido pelo fornecedor",children:"âœ… Confirmar"}),(U.status==="confirmado"||U.status==="recebido_parcial")&&e.jsx("button",{onClick:()=>I(U),className:"px-3 py-1 bg-purple-600 text-white rounded hover:bg-purple-700 text-xs font-semibold",title:"Registrar entrada de produtos no estoque",children:"ðŸ“¦ Receber"}),U.status!=="rascunho"&&U.status!=="recebido_total"&&e.jsx("button",{onClick:()=>Y(U.id),className:"px-2 py-1 bg-orange-100 text-orange-700 rounded hover:bg-orange-200 text-xs font-semibold",title:"Reverter para status anterior",children:"âª Reverter"})]})})]},U.id))})]})}),f&&y&&e.jsx(Jx,{pedido:y,onClose:()=>{b(!1),c(null)},onReceber:Q}),u&&e.jsx(Yx,{pedidoId:p,onClose:()=>h(!1),onEnviar:da,onEnvioManual:oe,dadosEnvio:N,setDadosEnvio:w}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-7xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"ðŸ’¡ SugestÃ£o Inteligente de Pedido"}),e.jsx("p",{className:"text-purple-100",children:"AnÃ¡lise baseada em vendas e estoque atual"})]}),e.jsx("button",{onClick:Qe,className:"text-white hover:bg-white hover:bg-opacity-20 rounded-lg p-2",children:"âœ–ï¸"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-purple-100 mb-1",children:"PerÃ­odo de AnÃ¡lise"}),e.jsxs("select",{value:X,onChange:U=>re(parseInt(U.target.value)),className:"w-full px-3 py-2 rounded-lg text-gray-800 focus:ring-2 focus:ring-purple-300",children:[e.jsx("option",{value:30,children:"Ãšltimos 30 dias"}),e.jsx("option",{value:60,children:"Ãšltimos 60 dias"}),e.jsx("option",{value:90,children:"Ãšltimos 90 dias"}),e.jsx("option",{value:180,children:"Ãšltimos 180 dias"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-purple-100 mb-1",children:"Cobertura de Estoque"}),e.jsxs("select",{value:M,onChange:U=>Z(parseInt(U.target.value)),className:"w-full px-3 py-2 rounded-lg text-gray-800 focus:ring-2 focus:ring-purple-300",children:[e.jsx("option",{value:15,children:"15 dias"}),e.jsx("option",{value:30,children:"30 dias"}),e.jsx("option",{value:45,children:"45 dias"}),e.jsx("option",{value:60,children:"60 dias"}),e.jsx("option",{value:90,children:"90 dias"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2 text-white cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:U=>J(U.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{children:"Apenas CrÃ­ticos"})]})}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2 text-white cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:E,onChange:U=>R(U.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{children:"Incluir Alertas"})]})}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:Je,disabled:D,className:"w-full bg-white text-purple-600 px-4 py-2 rounded-lg font-semibold hover:bg-purple-50 disabled:opacity-50",children:D?"ðŸ”„ Analisando...":"ðŸ” Atualizar"})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Analisando produtos e calculando sugestÃµes..."})]})}):W.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhuma sugestÃ£o encontrada com os filtros aplicados"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Tente ajustar os filtros acima"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex gap-3",children:[e.jsx("button",{onClick:Ze,className:"bg-red-100 text-red-700 px-4 py-2 rounded-lg font-semibold hover:bg-red-200",children:"ðŸ”´ Selecionar Todos CrÃ­ticos"}),e.jsx("div",{className:"flex-1"}),e.jsxs("span",{className:"text-gray-600",children:[K.length," de ",W.length," produtos selecionados"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:e.jsx("input",{type:"checkbox",onChange:U=>{U.target.checked?B(W.map(ie=>ie.produto_id)):B([])},checked:K.length===W.length,className:"w-4 h-4 rounded"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Prioridade"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Consumo/dia"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Dias Restantes"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Qtd Sugerida"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"PreÃ§o Unit."}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"TendÃªncia"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:W.map(U=>e.jsxs("tr",{className:`hover:bg-gray-50 ${K.includes(U.produto_id)?"bg-purple-50":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:K.includes(U.produto_id),onChange:()=>be(U.produto_id),className:"w-4 h-4 rounded"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${U.prioridade==="CRÃTICO"?"bg-red-100 text-red-700":U.prioridade==="ALERTA"?"bg-yellow-100 text-yellow-700":U.prioridade==="ATENÃ‡ÃƒO"?"bg-orange-100 text-orange-700":"bg-green-100 text-green-700"}`,children:U.prioridade})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:U.produto_nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:["SKU: ",U.produto_sku||"N/A"," | Barras: ",U.produto_codigo_barras||"N/A"]}),U.observacao&&e.jsx("div",{className:"text-xs text-gray-600 mt-1 italic",children:U.observacao})]})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("div",{className:"font-medium",children:U.estoque_atual}),e.jsxs("div",{className:"text-xs text-gray-500",children:["MÃ­n: ",U.estoque_minimo]})]}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:U.consumo_diario.toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:`font-semibold ${U.dias_estoque&&U.dias_estoque<7?"text-red-600":U.dias_estoque&&U.dias_estoque<14?"text-yellow-600":"text-green-600"}`,children:U.dias_estoque?`${U.dias_estoque} dias`:"âˆž"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"number",min:"0",step:"1",value:Math.ceil(he(U)),onChange:ie=>Fe(U.produto_id,ie.target.value),className:"w-20 px-2 py-1 text-right font-bold text-purple-600 border rounded focus:ring-2 focus:ring-purple-300"})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["R$ ",U.preco_unitario.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold",children:["R$ ",(he(U)*U.preco_unitario).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`text-xs ${U.tendencia==="CRESCIMENTO"?"text-green-600":U.tendencia==="QUEDA"?"text-red-600":"text-gray-600"}`,children:[U.tendencia==="CRESCIMENTO"?"ðŸ“ˆ":U.tendencia==="QUEDA"?"ðŸ“‰":U.tendencia==="ESTÃVEL"?"âž¡ï¸":"â€”",U.tendencia]})})]},U.produto_id))})]})})]})}),!D&&W.length>0&&e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Resumo da SugestÃ£o:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:["ðŸ”´ ",e.jsx("strong",{children:W.filter(U=>U.prioridade==="CRÃTICO").length})," crÃ­ticos"]}),e.jsxs("div",{children:["âš ï¸ ",e.jsx("strong",{children:W.filter(U=>U.prioridade==="ALERTA").length})," em alerta"]}),e.jsxs("div",{children:["ðŸ’° Total: ",e.jsxs("strong",{children:["R$ ",W.filter(U=>K.includes(U.produto_id)).reduce((U,ie)=>U+he(ie)*ie.preco_unitario,0).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:Qe,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-100",children:"Cancelar"}),e.jsxs("button",{onClick:ma,disabled:K.length===0,className:"px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:["âœ… Adicionar ",K.length," Produtos ao Pedido"]})]})]})})]})})]})},Jx=({pedido:a,onClose:t,onReceber:s})=>{const[o,r]=n.useState(a.itens.map(l=>({item_id:l.id,quantidade_recebida:l.quantidade_pedida-l.quantidade_recebida,max:l.quantidade_pedida-l.quantidade_recebida}))),i=()=>{const l=o.filter(x=>x.quantidade_recebida>0).map(x=>({item_id:x.item_id,quantidade_recebida:parseFloat(x.quantidade_recebida)}));if(l.length===0){ce.error("Informe a quantidade recebida de pelo menos 1 item");return}s(l)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["ðŸ“¦ Receber Pedido ",a.numero_pedido]}),e.jsx("div",{className:"space-y-4",children:a.itens.map((l,x)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold mb-2",children:l.produto_nome}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Pedido:"}),e.jsx("span",{className:"ml-2 font-semibold",children:l.quantidade_pedida})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"JÃ¡ Recebido:"}),e.jsx("span",{className:"ml-2 font-semibold",children:l.quantidade_recebida})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Pendente:"}),e.jsx("span",{className:"ml-2 font-semibold text-orange-600",children:l.quantidade_pedida-l.quantidade_recebida})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade a Receber"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:o[x].max,value:o[x].quantidade_recebida,onChange:j=>{const g=parseFloat(j.target.value)||0,v=[...o];v[x].quantidade_recebida=Math.min(g,v[x].max),r(v)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]},l.id))}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{onClick:i,className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700",children:"âœ… Confirmar Recebimento"}),e.jsx("button",{onClick:t,className:"px-6 py-3 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50",children:"âŒ Cancelar"})]})]})})},Yx=({pedidoId:a,onClose:t,onEnviar:s,onEnvioManual:o,dadosEnvio:r,setDadosEnvio:i})=>e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"ðŸ“¤ Enviar Pedido ao Fornecedor"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail do Fornecedor"}),e.jsx("input",{type:"email",value:r.email,onChange:l=>i({...r,email:l.target.value}),placeholder:"fornecedor@exemplo.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["WhatsApp (futuro)",e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Em breve)"})]}),e.jsx("input",{type:"tel",value:r.whatsapp,onChange:l=>i({...r,whatsapp:l.target.value}),placeholder:"(00) 00000-0000",className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Formatos para Envio"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.formatos.pdf,onChange:l=>i({...r,formatos:{...r.formatos,pdf:l.target.checked}}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm",children:"ðŸ“„ PDF"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.formatos.excel,onChange:l=>i({...r,formatos:{...r.formatos,excel:l.target.checked}}),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),e.jsx("span",{className:"ml-2 text-sm",children:"ðŸ“Š Excel"})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 pt-4",children:[e.jsx("button",{onClick:s,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors",children:"ðŸ“§ Enviar por E-mail"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"ou"})})]}),e.jsx("button",{onClick:o,className:"w-full bg-gray-600 text-white py-3 rounded-lg font-semibold hover:bg-gray-700 transition-colors",children:"âœ… JÃ¡ enviei manualmente"}),e.jsx("button",{onClick:t,className:"w-full border border-gray-300 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-50",children:"âŒ Cancelar"})]})]})]})}),Zx=()=>{var _e,$e;const a=va(),[t,s]=n.useState([]),[o,r]=n.useState([]),[i,l]=n.useState(!1),[x,j]=n.useState(!1),[g,v]=n.useState(null),[d,m]=n.useState(!1),[C,y]=n.useState(!1),[c,f]=n.useState(!1),[b,u]=n.useState(!1),[h,p]=n.useState(null),[k,N]=n.useState(!1),[w,S]=n.useState([]),[P,W]=n.useState(null),[te,D]=n.useState(!1),[A,X]=n.useState(!1),[re,M]=n.useState(null),[Z,$]=n.useState({}),[J,E]=n.useState("todos"),[R,K]=n.useState("loja"),[B,_]=n.useState({}),[O,q]=n.useState(!1),[ae,H]=n.useState(null),[le,G]=n.useState(null),[ee,de]=n.useState(!1),[ue,Ae]=n.useState({sku:"",nome:"",descricao:"",preco_custo:"",preco_venda:"",margem_lucro:"",estoque_minimo:10,estoque_maximo:100}),[se,we]=n.useState({});n.useEffect(()=>{console.log("Ã°Å¸â€â€ž [EntradaXML] Componente montado, iniciando carregamento..."),Se()},[]);const Se=async()=>{var T,ne,pe,Pe,Be,Ke,Ge,aa,la;console.log("Ã°Å¸â€œÅ  [EntradaXML] Carregando dados...");try{const ca=localStorage.getItem("access_token")||localStorage.getItem("token");console.log("Ã°Å¸â€â€˜ [EntradaXML] Token obtido:",ca?"SIM":"NÃƒÆ’O");const We={Authorization:`Bearer ${ca}`};console.log("Ã°Å¸Å’Â [EntradaXML] Fazendo requisiÃƒÂ§ÃƒÂµes para:",{notasEntrada:"/notas-entrada/",produtos:"/produtos/"});const[Sa,V]=await Promise.all([F.get("/notas-entrada/",{headers:We}),F.get("/produtos/",{headers:We,params:{ativo:null}})]);console.log("Ã¢Å“â€¦ [EntradaXML] Dados carregados:",{notasEntrada:((T=Sa.data)==null?void 0:T.length)||0,produtos:((pe=(ne=V.data)==null?void 0:ne.items)==null?void 0:pe.length)||((Pe=V.data)==null?void 0:Pe.length)||0});const Re=((Be=V.data)==null?void 0:Be.items)||V.data,Oe=Re.filter(ga=>ga.ativo===!0).length,He=Re.filter(ga=>ga.ativo===!1).length;console.log("Ã°Å¸â€œÅ  [EntradaXML] Produtos por status:",{ativos:Oe,inativos:He,total:Re.length}),s(Sa.data),r(Re)}catch(ca){console.error("Ã¢ÂÅ’ [EntradaXML] ERRO ao carregar dados:"),console.error("  - Mensagem:",ca.message),console.error("  - Response:",(Ke=ca.response)==null?void 0:Ke.data),console.error("  - Status:",(Ge=ca.response)==null?void 0:Ge.status),console.error("  - Stack:",ca.stack),ce.error(`Erro ao carregar dados: ${((la=(aa=ca.response)==null?void 0:aa.data)==null?void 0:la.detail)||ca.message}`)}},ea=async T=>{var Pe,Be,Ke,Ge,aa;const ne=T.target.files[0];if(console.log("Ã°Å¸â€œÂ¤ [EntradaXML] Upload iniciado"),console.log("  - Arquivo selecionado:",ne==null?void 0:ne.name),console.log("  - Tamanho:",ne==null?void 0:ne.size,"bytes"),console.log("  - Tipo:",ne==null?void 0:ne.type),!ne){console.warn("Ã¢Å¡Â Ã¯Â¸Â [EntradaXML] Nenhum arquivo selecionado");return}if(!ne.name.toLowerCase().endsWith(".xml")){console.error("Ã¢ÂÅ’ [EntradaXML] Arquivo nÃƒÂ£o ÃƒÂ© XML:",ne.name),ce.error("Ã¢ÂÅ’ Por favor, selecione um arquivo XML");return}j(!0);const pe=new FormData;pe.append("file",ne),console.log("Ã°Å¸Å¡â‚¬ [EntradaXML] Enviando arquivo para:","/notas-entrada/upload"),console.log("Ã°Å¸â€œÂ¦ [EntradaXML] FormData preparado:",ne.name,ne.size,"bytes");try{const la=await F.post("/notas-entrada/upload",pe,{headers:{"Content-Type":"multipart/form-data"}});console.log("Ã¢Å“â€¦ [EntradaXML] Upload bem-sucedido!"),console.log("  - Response data:",la.data);const ca=la.data.produtos_vinculados||0,We=la.data.itens_total||0;console.log(`Ã°Å¸â€œÅ  [EntradaXML] Produtos vinculados: ${ca}/${We}`),la.data.fornecedor_criado_automaticamente&&ce.success(`Ã°Å¸ÂÂ¢ Novo fornecedor cadastrado: ${la.data.fornecedor}`,{duration:4e3}),la.data.produtos_reativados>0&&ce.success(`Ã¢â„¢Â»Ã¯Â¸Â ${la.data.produtos_reativados} produto(s) inativo(s) reativado(s) automaticamente`,{duration:4e3}),ce.success(`Ã¢Å“â€¦ NF-e ${la.data.numero_nota} processada! ${ca}/${We} produtos vinculados automaticamente`,{duration:5e3}),Se(),T.target.value=""}catch(la){console.error("Ã¢ÂÅ’ [EntradaXML] ERRO no upload:"),console.error("  - Mensagem:",la.message),console.error("  - Response data:",(Pe=la.response)==null?void 0:Pe.data),console.error("  - Status:",(Be=la.response)==null?void 0:Be.status),console.error("  - Headers:",(Ke=la.response)==null?void 0:Ke.headers),console.error("  - Stack completo:",la.stack);const ca=((aa=(Ge=la.response)==null?void 0:Ge.data)==null?void 0:aa.detail)||la.message||"Erro ao processar XML da NF-e";console.error("  - Mensagem para usuÃƒÂ¡rio:",ca),ce.error(`Ã¢ÂÅ’ ${ca}`)}finally{j(!1),console.log("Ã°Å¸ÂÂ [EntradaXML] Upload finalizado")}},Ie=async T=>{var Be,Ke;const ne=Array.from(T.target.files);if(console.log("Ã°Å¸â€œÂ¦ [EntradaXML] Upload em lote iniciado -",ne.length,"arquivos"),ne.length===0){console.warn("Ã¢Å¡Â Ã¯Â¸Â [EntradaXML] Nenhum arquivo selecionado");return}const pe=ne.filter(Ge=>!Ge.name.toLowerCase().endsWith(".xml"));if(pe.length>0){ce.error(`Ã¢ÂÅ’ ${pe.length} arquivo(s) nÃƒÂ£o sÃƒÂ£o XML: ${pe.map(Ge=>Ge.name).join(", ")}`);return}f(!0),u(!0),p(null);const Pe=new FormData;ne.forEach(Ge=>{Pe.append("files",Ge)}),console.log("Ã°Å¸Å¡â‚¬ [EntradaXML] Enviando",ne.length,"arquivos para:","/notas-entrada/upload-lote");try{const Ge=await F.post("/notas-entrada/upload-lote",Pe);console.log("Ã¢Å“â€¦ [EntradaXML] Upload em lote bem-sucedido!"),console.log("  - Response:",Ge.data),p(Ge.data),Ge.data.sucessos>0&&ce.success(`Ã¢Å“â€¦ ${Ge.data.sucessos}/${Ge.data.total_arquivos} nota(s) processada(s) com sucesso!`,{duration:5e3}),Ge.data.erros>0&&ce.error(`Ã¢Å¡Â Ã¯Â¸Â ${Ge.data.erros}/${Ge.data.total_arquivos} nota(s) com erro`,{duration:5e3}),Se(),T.target.value=""}catch(Ge){console.error("Ã¢ÂÅ’ [EntradaXML] ERRO no upload em lote:",Ge),ce.error(`Ã¢ÂÅ’ Erro ao processar lote: ${((Ke=(Be=Ge.response)==null?void 0:Be.data)==null?void 0:Ke.detail)||Ge.message}`),u(!1)}finally{f(!1)}},Je=async T=>{try{const ne=await F.get(`/notas-entrada/${T}`);ne.data.itens&&ne.data.itens.sort((pe,Pe)=>pe.id-Pe.id),v(ne.data),m(!0),K(ne.data.tipo_rateio||"loja")}catch{ce.error("Erro ao carregar detalhes da nota")}},be=async T=>{try{const ne=await F.get(`/notas-entrada/${T}`);v(ne.data),y(!0)}catch{ce.error("Erro ao carregar nota")}},Fe=async(T,ne,pe)=>{var Pe,Be;try{await F.post(`/notas-entrada/${T}/itens/${ne}/vincular?produto_id=${parseInt(pe)}`),ce.success("Ã¢Å“â€¦ Produto vinculado com sucesso!");const Ke=await F.get(`/notas-entrada/${T}`);Ke.data.itens&&Ke.data.itens.sort((Ge,aa)=>Ge.id-aa.id),v(Ke.data)}catch(Ke){console.error("Ã¢ÂÅ’ Erro ao vincular produto:",Ke),ce.error(((Be=(Pe=Ke.response)==null?void 0:Pe.data)==null?void 0:Be.detail)||"Erro ao vincular produto")}},he=async(T,ne)=>{var pe,Pe;try{await F.post(`/notas-entrada/${T}/rateio`,{tipo_rateio:ne}),ce.success(`Ã¢Å“â€¦ Nota configurada: ${ne==="online"?"100% Online":ne==="loja"?"100% Loja FÃƒÂ­sica":"Rateio Parcial"}`);const Be=await F.get(`/notas-entrada/${T}`);v(Be.data),K(ne)}catch(Be){console.error("Ã¢ÂÅ’ Erro ao salvar tipo de rateio:",Be),ce.error(((Pe=(pe=Be.response)==null?void 0:pe.data)==null?void 0:Pe.detail)||"Erro ao salvar tipo de rateio")}},Qe=async(T,ne,pe)=>{var Pe,Be;try{const Ke=await F.post(`/notas-entrada/${T}/itens/${ne}/rateio`,{quantidade_online:parseFloat(pe)||0});ce.success("Ã°Å¸â€œÅ  Quantidade online configurada!");const Ge=Ke.data.nota_totais;ce.success(`Nota: ${Ge.percentual_online.toFixed(1)}% Online (R$ ${Ge.valor_online.toFixed(2)}) | ${Ge.percentual_loja.toFixed(1)}% Loja (R$ ${Ge.valor_loja.toFixed(2)})`),v(aa=>({...aa,percentual_online:Ge.percentual_online,percentual_loja:Ge.percentual_loja,valor_online:Ge.valor_online,valor_loja:Ge.valor_loja,itens:aa.itens.map(la=>la.id===ne?{...la,quantidade_online:parseFloat(pe)||0}:la)})),_(aa=>({...aa,[ne]:parseFloat(pe)||0}))}catch(Ke){console.error("Ã¢ÂÅ’ Erro ao salvar quantidade online:",Ke),ce.error(((Be=(Pe=Ke.response)==null?void 0:Pe.data)==null?void 0:Be.detail)||"Erro ao salvar")}},Ze=async T=>{var ne,pe;try{const Pe=await F.get(`/notas-entrada/${T}/preview-processamento`);M(Pe.data),X(!0),m(!1);const Be={};Pe.data.itens.forEach(Ke=>{Ke.produto_vinculado&&(Be[Ke.produto_vinculado.produto_id]={preco_venda:Ke.produto_vinculado.preco_venda_atual,margem:Ke.produto_vinculado.margem_atual})}),$(Be)}catch(Pe){ce.error(((pe=(ne=Pe.response)==null?void 0:ne.data)==null?void 0:pe.detail)||"Erro ao carregar preview")}},ma=Ze,oa=async()=>{var T,ne;l(!0);try{const pe=[];Object.entries(Z).forEach(([Be,Ke])=>{const Ge=re.itens.find(aa=>aa.produto_vinculado&&aa.produto_vinculado.produto_id==Be);Ge&&Ge.produto_vinculado&&Ke.preco_venda!==Ge.produto_vinculado.preco_venda_atual&&pe.push({produto_id:parseInt(Be),preco_venda:Ke.preco_venda})}),pe.length>0&&await F.post(`/notas-entrada/${re.nota_id}/atualizar-precos`,pe);const Pe=await F.post(`/notas-entrada/${re.nota_id}/processar`,{});ce.success(`Ã¢Å“â€¦ Nota processada! ${Pe.data.itens_processados} itens lanÃƒÂ§ados no estoque`,{duration:5e3}),m(!1),v(null),X(!1),M(null),Se()}catch(pe){ce.error(((ne=(T=pe.response)==null?void 0:T.data)==null?void 0:ne.detail)||"Erro ao processar nota")}finally{l(!1)}},ha=(T,ne)=>ne>=100?T*2:T/(1-ne/100),da=(T,ne)=>T<=0?0:(T-ne)/T*100,oe=(T,ne,pe)=>{const Pe=da(ne,pe);$(Be=>({...Be,[T]:{preco_venda:ne,margem:Pe}}))},Ne=(T,ne,pe)=>{const Pe=ha(pe,ne);$(Be=>({...Be,[T]:{preco_venda:Pe,margem:ne}}))},ke=async(T,ne)=>{var pe,Pe;if(confirm(`Tem certeza que deseja excluir a nota ${ne}?`)){l(!0);try{await F.delete(`/notas-entrada/${T}`),ce.success("Ã°Å¸â€”â€˜Ã¯Â¸Â Nota excluÃƒÂ­da com sucesso!"),d&&(m(!1),v(null)),Se()}catch(Be){ce.error(((Pe=(pe=Be.response)==null?void 0:pe.data)==null?void 0:Pe.detail)||"Erro ao excluir nota")}finally{l(!1)}}},Ue=async(T,ne)=>{D(!0),W({id:T,nome:ne}),N(!0);try{const pe=await F.get(`/produtos/${T}/historico-precos`);S(pe.data)}catch{ce.error("Erro ao carregar histÃƒÂ³rico de preÃƒÂ§os"),N(!1)}finally{D(!1)}},ze=async(T,ne)=>{var pe,Pe;if(confirm(`Ã¢Å¡Â Ã¯Â¸Â Tem certeza que deseja REVERTER a entrada da nota ${ne}?

Isso irÃƒÂ¡:
Ã¢â‚¬Â¢ Remover as quantidades do estoque
Ã¢â‚¬Â¢ Excluir os lotes criados
Ã¢â‚¬Â¢ Estornar as contas a pagar lanÃƒÂ§adas
Ã¢â‚¬Â¢ Restaurar o status da nota para pendente`)){l(!0);try{const Be=await F.post(`/notas-entrada/${T}/reverter`,{});ce.success(`Ã¢Å“â€¦ Entrada revertida! ${Be.data.itens_revertidos} produtos ajustados`,{duration:5e3}),d&&(m(!1),v(null)),Se()}catch(Be){ce.error(((Pe=(pe=Be.response)==null?void 0:pe.data)==null?void 0:Pe.detail)||"Erro ao reverter entrada")}finally{l(!1)}}},Y=async(T,ne)=>{var pe,Pe;try{await F.post(`/notas-entrada/${T}/itens/${ne}/desvincular`),ce.success("Ã¢Å“â€¦ Produto desvinculado!");const Be=await F.get(`/notas-entrada/${T}`);Be.data.itens&&Be.data.itens.sort((Ke,Ge)=>Ke.id-Ge.id),v(Be.data)}catch(Be){ce.error(((Pe=(pe=Be.response)==null?void 0:pe.data)==null?void 0:Pe.detail)||"Erro ao desvincular produto")}},ve=T=>{var ga;const ne=((ga=T.produto_vinculado)==null?void 0:ga.produto_nome)||T.produto_nome;if(!ne)return[];const pe=[],Pe=T.descricao_nf||T.descricao||"",Be=ne||"";if(!Pe||!Be)return[];const Ke=Pe.toLowerCase(),Ge=Be.toLowerCase(),aa=/(\d+(?:[.,]\d+)?)\s*(kg|g|ml|l|un|und|unid)/gi,la=[...Ke.matchAll(aa)],ca=[...Ge.matchAll(aa)];if(la.length>0&&ca.length>0){const xe=la[0][0],De=ca[0][0];xe!==De&&pe.push(`Peso/Tamanho diferente: NF="${xe}" vs Produto="${De}"`)}const We=["preto","branco","vermelho","azul","verde","amarelo","rosa","roxo","laranja","marrom","cinza"],Sa=We.find(xe=>Ke.includes(xe)),V=We.find(xe=>Ge.includes(xe));Sa&&V&&Sa!==V&&pe.push(`Cor diferente: NF="${Sa}" vs Produto="${V}"`);const Re=["frango","carne","peixe","cordeiro","salmao","salmÃƒÂ£o","atum","vegetais"],Oe=Re.find(xe=>Ke.includes(xe)),He=Re.find(xe=>Ge.includes(xe));return Oe&&He&&Oe!==He&&pe.push(`Sabor diferente: NF="${Oe}" vs Produto="${He}"`),(Ke.includes("cao")||Ke.includes("cachorro")||Ke.includes("dog"))&&(Ge.includes("gato")||Ge.includes("cat"))&&pe.push("Ã¢Å¡Â Ã¯Â¸Â Animal diferente: NF para CACHORRO mas produto ÃƒÂ© para GATO"),(Ke.includes("gato")||Ke.includes("cat"))&&(Ge.includes("cao")||Ge.includes("cachorro")||Ge.includes("dog"))&&pe.push("Ã¢Å¡Â Ã¯Â¸Â Animal diferente: NF para GATO mas produto ÃƒÂ© para CACHORRO"),pe},Le=async T=>{H(T),q(!0),de(!0),Ae({sku:"",nome:"",descricao:"",preco_custo:"",preco_venda:"",margem_lucro:"",estoque_minimo:10,estoque_maximo:100});try{const ne=await F.get(`/notas-entrada/${g.id}/itens/${T.id}/sugerir-sku`);G(ne.data);let pe=ne.data.sku_proposto||T.codigo_produto||"PROD-"+T.id;ne.data.ja_existe&&ne.data.sugestoes&&ne.data.sugestoes.length>0&&(pe=(ne.data.sugestoes.find(Be=>Be.padrao)||ne.data.sugestoes[0]).sku),Ae({sku:pe,nome:T.descricao||T.descricao_produto||"Produto sem nome",descricao:T.descricao||T.descricao_produto||"",preco_custo:T.valor_unitario.toString(),preco_venda:(T.valor_unitario*1.5).toFixed(2),margem_lucro:"50",estoque_minimo:10,estoque_maximo:100}),console.log("Ã¢Å“â€¦ FormulÃƒÂ¡rio preenchido:",{sku:pe,nome:T.descricao,preco_custo:T.valor_unitario})}catch(ne){ce.error("Erro ao buscar sugestÃƒÂµes de SKU"),console.error("Erro ao buscar SKU:",ne),Ae({sku:T.codigo_produto||"PROD-"+T.id,nome:T.descricao||"Produto sem nome",descricao:T.descricao||"",preco_custo:T.valor_unitario.toString(),preco_venda:(T.valor_unitario*1.5).toFixed(2),margem_lucro:"50",estoque_minimo:10,estoque_maximo:100})}finally{de(!1)}},I=async()=>{var T,ne;try{l(!0);const pe={...ue,preco_custo:parseFloat(ue.preco_custo)||0,preco_venda:parseFloat(ue.preco_venda)||0,margem_lucro:parseFloat(ue.margem_lucro)||0,estoque_minimo:parseInt(ue.estoque_minimo)||10,estoque_maximo:parseInt(ue.estoque_maximo)||100},Pe=await F.post(`/notas-entrada/${g.id}/itens/${ae.id}/criar-produto`,pe);ce.success(`Ã¢Å“â€¦ Produto ${Pe.data.produto.codigo} criado e vinculado!`),q(!1),H(null),G(null),await Se();const Be=await F.get(`/notas-entrada/${g.id}`);v(Be.data)}catch(pe){ce.error(((ne=(T=pe.response)==null?void 0:T.data)==null?void 0:ne.detail)||"Erro ao criar produto"),console.error(pe)}finally{l(!1)}},Q=async()=>{var pe;const T=g.itens.filter(Pe=>!Pe.produto_id);if(T.length===0){ce.success("Todos os produtos jÃƒÂ¡ estÃƒÂ£o vinculados!");return}if(window.confirm(`Criar ${T.length} produto(s) automaticamente?

PadrÃƒÂµes aplicados:
Ã¢â‚¬Â¢ Estoque mÃƒÂ­nimo: 10
Ã¢â‚¬Â¢ Estoque mÃƒÂ¡ximo: 100
Ã¢â‚¬Â¢ Margem de lucro: 50%

VocÃƒÂª poderÃƒÂ¡ editar os produtos depois no cadastro.`))try{l(!0);let Pe=0,Be=0;const Ke=ce.loading(`Ã°Å¸â€œÂ¦ Criando ${T.length} produtos...`);for(const aa of T)try{const la=await F.get(`/notas-entrada/${g.id}/itens/${aa.id}/sugerir-sku`);let ca=la.data.sku_proposto||aa.codigo_produto||`PROD-${aa.id}`;la.data.ja_existe&&((pe=la.data.sugestoes)==null?void 0:pe.length)>0&&(ca=(la.data.sugestoes.find(V=>V.padrao)||la.data.sugestoes[0]).sku);const We={sku:ca,nome:aa.descricao||"Produto sem nome",descricao:aa.descricao||"",preco_custo:parseFloat(aa.valor_unitario)||0,preco_venda:parseFloat((aa.valor_unitario*1.5).toFixed(2)),margem_lucro:50,estoque_minimo:10,estoque_maximo:100};await F.post(`/notas-entrada/${g.id}/itens/${aa.id}/criar-produto`,We),Pe++}catch(la){console.error(`Erro ao criar produto do item ${aa.id}:`,la),Be++}ce.dismiss(Ke),Pe>0&&ce.success(`Ã¢Å“â€¦ ${Pe} produto(s) criado(s) com sucesso!`),Be>0&&ce.error(`Ã¢ÂÅ’ ${Be} erro(s) ao criar produtos`),await Se();const Ge=await F.get(`/notas-entrada/${g.id}`);v(Ge.data)}catch(Pe){ce.error("Erro ao criar produtos em lote"),console.error(Pe)}finally{l(!1)}},fe=(T,ne)=>T===0?0:((ne-T)/T*100).toFixed(2),U=T=>{const ne={pendente:"bg-yellow-200 text-yellow-800",processada:"bg-green-200 text-green-800",cancelada:"bg-red-200 text-red-800",erro:"bg-red-300 text-red-900"};return e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${ne[T]||"bg-gray-200"}`,children:T.toUpperCase()})},ie=T=>{if(!T)return e.jsx("span",{className:"text-gray-400 text-sm",children:"NÃƒÂ£o vinculado"});const ne=T>=90?"alta":T>=70?"media":"baixa",pe={alta:"bg-green-100 text-green-800",media:"bg-yellow-100 text-yellow-800",baixa:"bg-orange-100 text-orange-800"};return e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-semibold ${pe[ne]}`,children:[T.toFixed(1),"% ",ne==="alta"?"Ã¢Å“â€¦":ne==="media"?"Ã¢Å¡Â Ã¯Â¸Â":"Ã¢Å¡Â¡"]})};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Ã°Å¸â€œâ€ž Entrada por NF-e (XML)"}),e.jsx("p",{className:"text-gray-600",children:"Importe notas fiscais eletrÃƒÂ´nicas e vincule produtos automaticamente"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-8 mb-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx("svg",{className:"mx-auto h-16 w-16 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:x?"Ã¢ÂÂ³ Processando XML...":"Selecione o arquivo XML da NF-e"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"O sistema irÃƒÂ¡ processar automaticamente os dados da nota fiscal"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("label",{className:"inline-block",children:[e.jsx("input",{type:"file",accept:".xml",onChange:ea,disabled:x||c,className:"hidden"}),e.jsx("span",{className:`
                px-6 py-3 rounded-lg font-semibold cursor-pointer inline-block
                ${x||c?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}
              `,children:x?"Ã¢ÂÂ³ Processando...":"Ã°Å¸â€œÂ Upload ÃƒÅ¡nico"})]}),e.jsxs("label",{className:"inline-block",children:[e.jsx("input",{type:"file",accept:".xml",multiple:!0,onChange:Ie,disabled:x||c,className:"hidden"}),e.jsx("span",{className:`
                px-6 py-3 rounded-lg font-semibold cursor-pointer inline-block
                ${x||c?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"}
              `,children:c?"Ã¢ÂÂ³ Processando Lote...":"Ã°Å¸â€œÂ¦ Upload MÃƒÂºltiplo"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"Formatos aceitos: XML de NF-e (padrÃƒÂ£o SEFAZ)"})]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:t.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Notas"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:t.filter(T=>T.status==="pendente").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pendentes"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.filter(T=>T.status==="processada").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Processadas"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:["R$ ",t.filter(T=>T.status==="processada").reduce((T,ne)=>T+(ne.valor_total||0),0).toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Valor Processado"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b bg-gray-50",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Notas Fiscais Importadas"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Chave NF-e"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Fornecedor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Data EmissÃƒÂ£o"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Itens"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"AÃƒÂ§ÃƒÂµes"})]})}),e.jsx("tbody",{children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500",children:"Nenhuma nota fiscal importada ainda. FaÃƒÂ§a o upload de um XML acima."})}):t.map(T=>e.jsxs("tr",{onClick:()=>be(T.id),className:"border-t hover:bg-blue-50 cursor-pointer transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"font-mono text-xs",children:[T.chave_acesso.substring(0,20),"..."]})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold",children:T.fornecedor_nome}),e.jsx("div",{className:"text-xs text-gray-500",children:T.fornecedor_cnpj})]}),e.jsx("td",{className:"px-4 py-3",children:new Date(T.data_emissao).toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold",children:["R$ ",(T.valor_total||0).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-semibold",children:[T.produtos_vinculados+T.produtos_nao_vinculados," itens"]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:U(T.status)}),e.jsx("td",{className:"px-4 py-3 text-center",onClick:ne=>ne.stopPropagation(),children:e.jsxs("div",{className:"flex gap-2 justify-center",children:[T.status==="pendente"&&e.jsx("button",{onClick:()=>Je(T.id),className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded font-semibold text-sm",title:"Vincular produtos",children:"Ã°Å¸â€â€” Vincular"}),T.entrada_estoque_realizada?e.jsx("button",{onClick:()=>ze(T.id,T.numero_nota),className:"text-orange-600 hover:text-orange-800 font-semibold text-sm",title:"Reverter entrada no estoque",children:"Ã¢â€ Â©Ã¯Â¸Â Reverter"}):e.jsx("button",{onClick:()=>ke(T.id,T.numero_nota),className:"text-red-600 hover:text-red-800 font-semibold text-sm",title:"Excluir nota",children:"Ã°Å¸â€”â€˜Ã¯Â¸Â Excluir"})]})})]},T.id))})]})})]}),d&&g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Ã°Å¸â€œâ€ž Detalhes da NF-e"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Chave: ",g.chave_acesso]})]}),e.jsx("button",{onClick:()=>{m(!1),v(null)},className:"text-gray-500 hover:text-gray-700 text-2xl",children:"Ãƒâ€”"})]}),e.jsx("div",{className:"px-6 py-4 border-b bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Fornecedor:"}),e.jsx("div",{className:"font-semibold",children:g.fornecedor_nome}),e.jsx("div",{className:"text-xs text-gray-500",children:g.fornecedor_cnpj}),g.fornecedor_id&&e.jsx("div",{className:"text-xs text-green-600 mt-1",children:"Ã¢Å“â€¦ Cadastrado"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Data EmissÃƒÂ£o:"}),e.jsx("div",{className:"font-semibold",children:new Date(g.data_emissao).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Valor Total:"}),e.jsxs("div",{className:"font-bold text-lg text-green-600",children:["R$ ",(g.valor_total||0).toFixed(2)]})]})]})}),g.fornecedor_id&&g.fornecedor_criado_automaticamente&&e.jsx("div",{className:"px-6 py-2 bg-blue-50 border-b border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:g.fornecedor_nome})," foi cadastrado automaticamente."]}),e.jsx("button",{onClick:()=>a(`/clientes/${g.fornecedor_id}`),className:"px-3 py-1 bg-blue-600 text-white rounded font-medium hover:bg-blue-700 text-xs",children:"Ã°Å¸â€œÂ Completar Cadastro"})]})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-bold text-xl text-gray-800",children:["Ã°Å¸â€œÂ¦ Produtos da Nota (",g.itens.length,")"]}),g.status==="pendente"&&g.itens.some(T=>!T.produto_id)&&e.jsxs("button",{onClick:Q,disabled:i,className:"px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400 flex items-center gap-2 text-sm",title:"Cria automaticamente todos os produtos nÃƒÂ£o vinculados com os padrÃƒÂµes: Estoque mÃƒÂ­n: 10, mÃƒÂ¡x: 100, Margem: 50%",children:[e.jsx("span",{children:"Ã¢Å“Â¨ Criar Todos NÃƒÂ£o Vinculados"}),e.jsx("span",{className:"text-xs bg-purple-800 px-2 py-0.5 rounded",children:g.itens.filter(T=>!T.produto_id).length})]})]}),e.jsx("div",{className:"space-y-3",children:g.itens.map(T=>{const ne=ve(T),pe=ne.length>0;return e.jsxs("div",{className:"border-2 border-gray-400 rounded-lg overflow-hidden bg-white shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] gap-0",children:[e.jsxs("div",{className:"bg-blue-50 border-r-2 border-gray-300 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs font-bold",children:"NF-e"}),ie(T.confianca_vinculo)]}),e.jsx("div",{className:"font-semibold text-base mb-2 text-blue-900",children:T.descricao}),e.jsxs("div",{className:"space-y-1.5 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"CÃƒÂ³digo:"}),e.jsx("span",{className:"font-mono font-semibold",children:T.codigo_produto})]}),T.ean&&T.ean!=="SEM GTIN"&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"EAN:"}),e.jsx("span",{className:"font-mono font-semibold",children:T.ean})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"NCM:"}),e.jsx("span",{className:"font-mono font-semibold",children:T.ncm})]}),e.jsxs("div",{className:"flex justify-between border-t pt-1.5 mt-1.5",children:[e.jsx("span",{className:"text-gray-600",children:"Qtd:"}),e.jsx("span",{className:"font-semibold",children:T.quantidade})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Unit.:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",T.valor_unitario.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["R$ ",T.valor_total.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"CFOP:"}),e.jsx("span",{className:"font-semibold",children:T.cfop})]})]}),(T.lote||T.data_validade)&&e.jsxs("div",{className:"mt-3 pt-3 border-t space-y-2",children:[T.lote&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Ã°Å¸â€œÂ¦ Lote:"}),e.jsx("div",{className:"font-semibold text-purple-800",children:T.lote})]}),T.data_validade&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Ã°Å¸â€œâ€¦ Validade:"}),e.jsx("div",{className:"font-semibold text-orange-800",children:new Date(T.data_validade).toLocaleDateString("pt-BR")})]})]})]}),e.jsx("div",{className:"flex flex-col items-center justify-center bg-gray-100 px-2 py-4",children:T.produto_id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Y(g.id,T.id),className:"text-3xl text-green-600 hover:text-red-600 transition-colors mb-2",title:"Ã¢Å“â€¦ Vinculado - Clique para desvincular",children:"Ã¢Å“â€œ"}),pe&&e.jsx("div",{className:"bg-red-100 border-2 border-red-500 rounded-lg p-2 max-w-[200px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:"Ã¢Å¡Â Ã¯Â¸Â"}),e.jsx("div",{className:"font-bold text-red-700 text-xs mb-1",children:"DIVERGÃƒÅ NCIA!"}),e.jsx("div",{className:"text-[10px] text-red-600 space-y-0.5",children:ne.map((Pe,Be)=>e.jsxs("div",{children:["Ã¢â‚¬Â¢ ",Pe]},Be))})]})})]}):e.jsx("div",{className:"text-3xl text-gray-400",title:"Ã¢ÂÅ’ NÃƒÂ£o vinculado",children:"Ã¢Å“â€¢"})}),e.jsx("div",{className:`p-4 ${T.produto_id?"bg-green-50":"bg-gray-50"}`,children:e.jsx("div",{className:`p-4 ${T.produto_id?"bg-green-50":"bg-gray-50"}`,children:g.status==="pendente"?e.jsx(e.Fragment,{children:T.produto_id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsx("div",{className:"bg-green-600 text-white px-2 py-1 rounded text-xs font-bold",children:"Ã¢Å“â€¦ PRODUTO SISTEMA"})}),e.jsx("div",{className:"font-semibold text-base mb-3 text-green-900",children:T.produto_nome}),e.jsx("div",{className:"text-xs text-green-700 mb-3 italic",children:"Ã°Å¸â€™Â¡ Para alterar o vÃƒÂ­nculo, selecione outro produto ou clique no Ã¢Å“â€œ para desvincular"}),e.jsxs("select",{value:T.produto_id,onChange:Pe=>{Pe.target.value&&Pe.target.value!=T.produto_id&&Fe(g.id,T.id,Pe.target.value)},className:"w-full px-3 py-2 border-2 border-green-400 rounded text-sm focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:T.produto_id,children:T.produto_nome}),Array.isArray(o)&&o.filter(Pe=>Pe.id!==T.produto_id).map(Pe=>e.jsxs("option",{value:Pe.id,children:[Pe.codigo," - ",Pe.nome," ",Pe.descricao?`| ${Pe.descricao.substring(0,50)}...`:""," (Est: ",Pe.estoque_atual||0,")"]},Pe.id))]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsx("div",{className:"bg-orange-600 text-white px-2 py-1 rounded text-xs font-bold",children:"Ã¢Å¡Â Ã¯Â¸Â NÃƒÆ’O VINCULADO"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-1",children:"Ã°Å¸â€Â Pesquisar produto existente:"}),e.jsx("input",{type:"text",placeholder:"Digite nome ou SKU...",value:se[T.id]||"",onChange:Pe=>we({...se,[T.id]:Pe.target.value}),className:"w-full px-3 py-2 border-2 border-gray-400 rounded focus:ring-2 focus:ring-blue-500 text-sm"})]}),se[T.id]&&se[T.id].length>=2&&e.jsxs("div",{className:"border-2 border-gray-300 rounded max-h-48 overflow-y-auto bg-white",children:[Array.isArray(o)&&o.filter(Pe=>{var Ke,Ge,aa;const Be=se[T.id].toLowerCase();return((Ke=Pe.nome)==null?void 0:Ke.toLowerCase().includes(Be))||((Ge=Pe.codigo)==null?void 0:Ge.toLowerCase().includes(Be))||((aa=Pe.descricao)==null?void 0:aa.toLowerCase().includes(Be))}).sort((Pe,Be)=>Pe.ativo===Be.ativo?0:Pe.ativo?-1:1).slice(0,15).map(Pe=>e.jsxs("button",{type:"button",onClick:()=>{Fe(g.id,T.id,Pe.id),we({...se,[T.id]:""})},className:`w-full text-left px-3 py-2 hover:bg-blue-50 border-b border-gray-200 last:border-b-0 text-xs ${Pe.ativo?"":"text-red-600 font-bold"}`,children:[!Pe.ativo&&"Ã°Å¸â€Â´ ",Pe.codigo," - ",Pe.nome,!Pe.ativo&&" [INATIVO]",e.jsxs("span",{className:"text-gray-500 ml-1",children:["(Est: ",Pe.estoque_atual||0,")"]})]},`produto-${T.id}-${Pe.id}`)),o.filter(Pe=>{var Ke,Ge,aa;const Be=se[T.id].toLowerCase();return((Ke=Pe.nome)==null?void 0:Ke.toLowerCase().includes(Be))||((Ge=Pe.codigo)==null?void 0:Ge.toLowerCase().includes(Be))||((aa=Pe.descricao)==null?void 0:aa.toLowerCase().includes(Be))}).length===0&&e.jsx("div",{className:"px-3 py-4 text-center text-gray-500 text-xs",children:"Ã¢ÂÅ’ Nenhum produto encontrado"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 border-t border-gray-300"}),e.jsx("span",{className:"text-xs text-gray-500",children:"ou"}),e.jsx("div",{className:"flex-1 border-t border-gray-300"})]}),e.jsx("button",{onClick:()=>Le(T),className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 text-sm",children:"Ã¢Å¾â€¢ Criar Novo Produto"})]})]})}):e.jsx("div",{children:T.produto_id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-green-600 text-white px-2 py-1 rounded text-xs font-bold inline-block mb-2",children:"Ã¢Å“â€¦ VINCULADO"}),e.jsx("div",{className:"font-semibold text-base text-green-900",children:T.produto_nome})]}):e.jsx("div",{className:"bg-gray-600 text-white px-2 py-1 rounded text-xs font-bold inline-block",children:"Ã¢Å¡Â Ã¯Â¸Â NÃƒÆ’O VINCULADO"})})})}),g.status==="pendente"&&R==="parcial"&&T.produto_id&&e.jsxs("div",{className:"col-span-3 p-4 border-t-2 border-gray-300 bg-gradient-to-r from-blue-50 via-gray-50 to-green-50",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-3 flex items-center text-sm",children:"Ã°Å¸â€œÂ¦ Quantidade destinada ao estoque online"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Ã°Å¸â€œâ€¹ Total NF"}),e.jsx("input",{type:"number",value:T.quantidade,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded bg-gray-100 text-base font-semibold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Ã°Å¸Å’Â Online"}),e.jsx("input",{type:"number",min:"0",max:T.quantidade,step:"0.01",value:B[T.id]??T.quantidade_online??0,onChange:Pe=>{const Be=parseFloat(Pe.target.value)||0;_({...B,[T.id]:Math.min(Be,T.quantidade)})},className:"w-full px-3 py-2 border-2 border-blue-400 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base font-semibold",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Ã°Å¸ÂÂª Loja"}),e.jsx("input",{type:"number",value:(T.quantidade-(B[T.id]??T.quantidade_online??0)).toFixed(2),disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded bg-gray-100 text-base font-semibold"})]})]}),e.jsxs("div",{className:"mt-3 text-sm text-gray-700 bg-white rounded-lg p-3 border border-gray-300 font-medium",children:["Ã°Å¸â€™Âµ Valor online: R$ ",((B[T.id]??T.quantidade_online??0)*T.valor_unitario).toFixed(2)]}),B[T.id]!==void 0&&B[T.id]!==T.quantidade_online?e.jsx("button",{onClick:()=>Qe(g.id,T.id,B[T.id]),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 mt-3 text-sm",children:"Ã°Å¸â€™Â¾ Salvar DistribuiÃƒÂ§ÃƒÂ£o"}):T.quantidade_online!==null&&T.quantidade_online!==void 0&&e.jsxs("div",{className:"mt-3 text-sm text-green-700 bg-green-50 rounded-lg p-3 border border-green-200 flex items-center justify-center font-medium",children:["Ã¢Å“â€¦ Salvo: ",T.quantidade_online," online / ",(T.quantidade-T.quantidade_online).toFixed(2)," loja"]})]})]}),g.status==="processada"&&T.produto_id&&e.jsxs("div",{className:"mt-3 pt-3 border-t bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("span",{className:"text-blue-800 font-semibold",children:"Ã¢Å“â€¦ LanÃƒÂ§ado no estoque:"}),e.jsx("span",{className:"ml-2",children:T.produto_nome})]})]},T.id)})})]}),g.status==="pendente"&&e.jsxs("div",{className:"sticky bottom-0 bg-white border-t px-6 py-4 space-y-3",children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Ã°Å¸â€œÅ  DistribuiÃƒÂ§ÃƒÂ£o (informativo para relatÃƒÂ³rios)"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Estoque unificado Ã¢â‚¬Â¢ ClassificaÃƒÂ§ÃƒÂ£o apenas para anÃƒÂ¡lises"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>he(g.id,"loja"),disabled:i,className:`px-3 py-1 rounded text-xs font-medium transition-colors ${R==="loja"?"bg-gray-800 text-white":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-100"} ${i?"opacity-50 cursor-not-allowed":""}`,children:"Ã°Å¸ÂÂª Loja"}),e.jsx("button",{onClick:()=>he(g.id,"online"),disabled:i,className:`px-3 py-1 rounded text-xs font-medium transition-colors ${R==="online"?"bg-gray-800 text-white":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-100"} ${i?"opacity-50 cursor-not-allowed":""}`,children:"Ã°Å¸Å’Â Online"}),e.jsx("button",{onClick:()=>he(g.id,"parcial"),disabled:i,className:`px-3 py-1 rounded text-xs font-medium transition-colors ${R==="parcial"?"bg-gray-800 text-white":"bg-white border border-gray-300 text-gray-600 hover:bg-gray-100"} ${i?"opacity-50 cursor-not-allowed":""}`,children:"Ã°Å¸â€œÅ  Parcial"}),(g.percentual_online>0||g.tipo_rateio)&&e.jsxs("div",{className:"ml-auto flex gap-3 text-xs text-gray-600",children:[e.jsxs("span",{children:["Online: ",(g.percentual_online||0).toFixed(0),"%"]}),e.jsxs("span",{children:["Loja: ",(g.percentual_loja||100).toFixed(0),"%"]})]})]}),R==="parcial"&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-gray-100 rounded p-2",children:["Ã°Å¸â€™Â¡ Defina a quantidade destinada ao ",e.jsx("strong",{children:"estoque online"})," em cada produto acima. O sistema calcula automaticamente a % baseado nos valores."]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[g.itens.filter(T=>T.produto_id).length," de ",g.itens.length," produtos vinculados"]}),e.jsxs("div",{className:"flex gap-3",children:[g.entrada_estoque_realizada?e.jsx("button",{onClick:()=>ze(g.id,g.numero_nota),disabled:i,className:"px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 disabled:bg-gray-400",children:i?"Ã¢ÂÂ³ Revertendo...":"Ã¢â€ Â©Ã¯Â¸Â Reverter Entrada"}):e.jsxs(e.Fragment,{children:[!g.entrada_estoque_realizada&&e.jsx("button",{onClick:()=>ke(g.id,g.numero_nota),disabled:i,className:"px-6 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 disabled:bg-gray-400",children:"Ã°Å¸â€”â€˜Ã¯Â¸Â Excluir Nota"}),g.itens.some(T=>T.produto_id)&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ma(g.id),disabled:i,className:"px-6 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400",children:"Ã°Å¸â€™Â° Revisar PreÃƒÂ§os"}),e.jsx("button",{onClick:()=>Ze(g.id),disabled:i,className:"px-6 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 disabled:bg-gray-400",children:i?"Ã¢ÂÂ³ Processando...":"Ã¢Å“â€¦ Processar Nota"})]})]}),e.jsx("button",{onClick:()=>{m(!1),v(null)},className:"px-6 py-2 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50",children:"Fechar"})]})]})]})]})}),O&&ae&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Ã¢Å¾â€¢ Criar Novo Produto"}),e.jsx("p",{className:"text-sm text-gray-600",children:"A partir do item da NF-e"})]}),e.jsx("button",{onClick:()=>{q(!1),H(null),G(null)},className:"text-gray-500 hover:text-gray-700 text-2xl",children:"Ãƒâ€”"})]}),e.jsx("div",{className:"px-6 py-4",children:ee?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Gerando sugestÃƒÂµes de SKU..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold text-blue-900 mb-2",children:"Ã°Å¸â€œâ€ž Dados da NF-e:"}),e.jsxs("div",{className:"text-sm space-y-1 text-blue-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"DescriÃƒÂ§ÃƒÂ£o:"})," ",ae.descricao]}),e.jsxs("div",{children:[e.jsx("strong",{children:"CÃƒÂ³digo Fornecedor:"})," ",ae.codigo_produto]}),e.jsxs("div",{children:[e.jsx("strong",{children:"NCM:"})," ",ae.ncm]}),ae.ean&&e.jsxs("div",{children:[e.jsx("strong",{children:"EAN:"})," ",ae.ean]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Valor UnitÃƒÂ¡rio:"})," R$ ",ae.valor_unitario.toFixed(2)]})]})]}),(le==null?void 0:le.ja_existe)&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-300 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"Ã¢Å¡Â Ã¯Â¸Â"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-semibold text-yellow-900 mb-2",children:['CÃƒÂ³digo do fornecedor "',le.sku_proposto,'" jÃƒÂ¡ estÃƒÂ¡ em uso!']}),e.jsxs("div",{className:"text-sm text-yellow-800 mb-3",children:["Produto existente: ",e.jsx("strong",{children:le.produto_existente.nome}),e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Um SKU alternativo foi sugerido automaticamente. VocÃƒÂª pode alterar se preferir."})]}),e.jsx("div",{className:"text-sm text-yellow-800 mb-2 font-semibold",children:"Outras opÃƒÂ§ÃƒÂµes de SKU disponÃƒÂ­veis:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:le.sugestoes.map(T=>e.jsxs("button",{onClick:()=>Ae({...ue,sku:T.sku}),className:`px-3 py-1 rounded-lg text-sm font-semibold transition-all ${ue.sku===T.sku?"bg-blue-600 text-white shadow-md":"bg-white border border-blue-300 text-blue-700 hover:bg-blue-50"} ${T.padrao?"ring-2 ring-yellow-400":""}`,children:[T.sku," ",T.padrao&&"Ã¢Â­Â"]},T.sku))})]})]})}),le&&!le.ja_existe&&e.jsx("div",{className:"bg-green-50 border border-green-300 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"Ã¢Å“â€¦"}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("strong",{children:"SKU disponÃƒÂ­vel!"})," O cÃƒÂ³digo do fornecedor pode ser usado diretamente."]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:["SKU / CÃƒÂ³digo do Produto *",e.jsx("span",{className:"text-xs text-gray-500 font-normal ml-2",children:"(Baseado no cÃƒÂ³digo do fornecedor)"})]}),e.jsx("input",{type:"text",value:ue.sku,onChange:T=>Ae({...ue,sku:T.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 font-mono",placeholder:"Ex: MGZ-12345"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ã°Å¸â€™Â¡ VocÃƒÂª pode editar o SKU se preferir"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Nome do Produto *"}),e.jsx("input",{type:"text",value:ue.nome,onChange:T=>Ae({...ue,nome:T.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Nome completo do produto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"DescriÃƒÂ§ÃƒÂ£o"}),e.jsx("textarea",{value:ue.descricao,onChange:T=>Ae({...ue,descricao:T.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:"2",placeholder:"DescriÃƒÂ§ÃƒÂ£o detalhada (opcional)"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"PreÃƒÂ§o de Custo *"}),e.jsx("input",{type:"number",step:"0.01",value:ue.preco_custo,onChange:T=>{const ne=T.target.value,pe=parseFloat(ue.margem_lucro)||0;Ae({...ue,preco_custo:ne,preco_venda:ne?ha(parseFloat(ne),pe):""})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Margem (%) *"}),e.jsx("input",{type:"number",step:"0.01",value:ue.margem_lucro,onChange:T=>{const ne=T.target.value,pe=parseFloat(ue.preco_custo)||0;Ae({...ue,margem_lucro:ne,preco_venda:pe&&ne?ha(pe,parseFloat(ne)):""})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"PreÃƒÂ§o de Venda *"}),e.jsx("input",{type:"number",step:"0.01",value:ue.preco_venda,onChange:T=>{const ne=T.target.value,pe=parseFloat(ue.preco_custo)||0;Ae({...ue,preco_venda:ne,margem_lucro:pe&&ne?fe(pe,parseFloat(ne)):""})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Estoque MÃƒÂ­nimo"}),e.jsx("input",{type:"number",value:ue.estoque_minimo,onChange:T=>Ae({...ue,estoque_minimo:parseInt(T.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Estoque MÃƒÂ¡ximo"}),e.jsx("input",{type:"number",value:ue.estoque_maximo,onChange:T=>Ae({...ue,estoque_maximo:parseInt(T.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]})]})}),e.jsxs("div",{className:"sticky bottom-0 bg-white border-t px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{q(!1),H(null),G(null)},className:"px-6 py-2 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{onClick:I,disabled:i||!ue.sku||!ue.nome||!ue.preco_custo||parseFloat(ue.preco_custo)<=0||!ue.preco_venda||parseFloat(ue.preco_venda)<=0,className:"px-6 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:i?"Ã¢ÂÂ³ Criando...":"Ã¢Å“â€¦ Criar e Vincular Produto"})]})]})}),C&&g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["Ã°Å¸â€œâ€ž NF-e ",g.numero_nota]}),e.jsxs("p",{className:"text-blue-100 mt-1",children:["SÃƒÂ©rie: ",g.serie]})]}),e.jsx("button",{onClick:()=>{y(!1),v(null)},className:"text-white hover:bg-white/20 rounded-full p-2 transition-colors",children:"Ã¢Å“â€¢"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-3",children:"Ã°Å¸â€œâ€¹ Dados da Nota"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Data EmissÃƒÂ£o:"}),e.jsx("span",{className:"font-semibold",children:new Date(g.data_emissao).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{children:U(g.status)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Total:"}),e.jsxs("span",{className:"font-bold text-green-600",children:["R$ ",g.valor_total.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-3",children:"Ã°Å¸ÂÂ¢ Fornecedor"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Nome:"}),e.jsx("div",{className:"font-semibold",children:g.fornecedor_nome})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"CNPJ:"}),e.jsx("div",{className:"font-mono text-xs",children:g.fornecedor_cnpj})]})]})]})]}),e.jsxs("div",{className:"mb-6 p-3 bg-gray-50 rounded",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Ã°Å¸â€â€˜ Chave de Acesso"}),e.jsx("div",{className:"font-mono text-xs break-all",children:g.chave_acesso})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((_e=g.itens)==null?void 0:_e.length)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Itens"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:g.produtos_vinculados}),e.jsx("div",{className:"text-sm text-gray-600",children:"Vinculados"})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:g.produtos_nao_vinculados}),e.jsx("div",{className:"text-sm text-gray-600",children:"NÃƒÂ£o Vinculados"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-3",children:"Ã°Å¸â€œÂ¦ Itens da Nota"}),e.jsx("div",{className:"space-y-3",children:($e=g.itens)==null?void 0:$e.map((T,ne)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:T.descricao}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["CÃƒÂ³digo: ",T.codigo_produto," | NCM: ",T.ncm]})]}),T.vinculado?e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded",children:"Ã¢Å“â€œ Vinculado"}):e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs font-semibold rounded",children:"Ã¢Å¡Â  NÃƒÂ£o Vinculado"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 text-sm mt-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Qtd:"}),e.jsx("div",{className:"font-semibold",children:T.quantidade})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Unit:"}),e.jsxs("div",{className:"font-semibold",children:["R$ ",T.valor_unitario.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("div",{className:"font-semibold text-green-600",children:["R$ ",T.valor_total.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"CFOP:"}),e.jsx("div",{className:"font-semibold",children:T.cfop})]})]}),(T.lote||T.data_validade)&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3 text-sm",children:[T.lote&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded p-2",children:[e.jsx("span",{className:"text-gray-600",children:"Ã°Å¸â€œÂ¦ Lote:"}),e.jsx("div",{className:"font-semibold text-purple-800",children:T.lote})]}),T.data_validade&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded p-2",children:[e.jsx("span",{className:"text-gray-600",children:"Ã°Å¸â€œâ€¦ Validade:"}),e.jsx("div",{className:"font-semibold text-orange-800",children:new Date(T.data_validade).toLocaleDateString("pt-BR")})]})]}),T.vinculado&&T.produto_nome&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Ã¢â€ â€™ Produto vinculado: "}),e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:T.produto_nome})]})]},T.id))})]})]}),e.jsxs("div",{className:"border-t p-6 bg-gray-50 flex justify-between items-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:g.entrada_estoque_realizada?e.jsx("span",{className:"text-green-600 font-semibold",children:"Ã¢Å“â€¦ Entrada realizada no estoque"}):e.jsx("span",{className:"text-orange-600 font-semibold",children:"Ã¢Å¡Â Ã¯Â¸Â Entrada ainda nÃƒÂ£o processada"})}),e.jsxs("div",{className:"flex gap-3",children:[g.status==="pendente"&&g.produtos_vinculados>0&&!g.entrada_estoque_realizada&&e.jsx(e.Fragment,{children:e.jsx("button",{onClick:()=>{y(!1),Ze(g.id)},className:"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold",children:"Ã°Å¸â€™Â° Revisar PreÃƒÂ§os e Processar"})}),g.status==="pendente"&&e.jsx("button",{onClick:()=>{y(!1),Je(g.id)},className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold",children:"Ã°Å¸â€â€” Vincular Produtos"}),e.jsx("button",{onClick:()=>{y(!1),v(null)},className:"px-6 py-2 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50",children:"Fechar"})]})]})]})}),A&&re&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white p-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Ã°Å¸â€™Â° RevisÃƒÂ£o de PreÃƒÂ§os e Custos"}),e.jsxs("p",{className:"text-purple-100 mt-1",children:["NF-e ",re.numero_nota," - ",re.fornecedor_nome]})]}),e.jsx("div",{className:"px-6 py-3 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Filtrar:"}),(()=>{const T=re.itens.filter(Ke=>Ke.produto_vinculado!==null||Ke.produto_id!==null),ne=T.filter(Ke=>{var aa;return(((aa=Ke.produto_vinculado)==null?void 0:aa.variacao_custo_percentual)||Ke.variacao_custo_percentual||0)>0}).length,pe=T.filter(Ke=>{var aa;return(((aa=Ke.produto_vinculado)==null?void 0:aa.variacao_custo_percentual)||Ke.variacao_custo_percentual||0)<0}).length,Pe=T.filter(Ke=>{var aa;return(((aa=Ke.produto_vinculado)==null?void 0:aa.variacao_custo_percentual)||Ke.variacao_custo_percentual||0)===0}).length,Be=T.length;return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>E("todos"),className:`px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1 transition-all ${J==="todos"?"bg-blue-600 text-white shadow-md":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx("span",{className:"text-base",children:"Ã°Å¸â€œâ€¹"}),"Todos (",Be,")"]}),ne>0&&e.jsxs("button",{onClick:()=>E("aumentou"),className:`px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1 transition-all ${J==="aumentou"?"bg-red-600 text-white shadow-md":"bg-red-100 text-red-700 hover:bg-red-200"}`,children:[e.jsx("span",{className:"text-base",children:"Ã°Å¸â€œË†"}),ne," custo",ne>1?"s":""," maior",ne>1?"es":""]}),pe>0&&e.jsxs("button",{onClick:()=>E("diminuiu"),className:`px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1 transition-all ${J==="diminuiu"?"bg-green-600 text-white shadow-md":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:[e.jsx("span",{className:"text-base",children:"Ã°Å¸â€œâ€°"}),pe," custo",pe>1?"s":""," menor",pe>1?"es":""]}),Pe>0&&e.jsxs("button",{onClick:()=>E("igual"),className:`px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1 transition-all ${J==="igual"?"bg-gray-600 text-white shadow-md":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx("span",{className:"text-base",children:"Ã¢Å¾Â¡Ã¯Â¸Â"}),Pe," sem alteraÃƒÂ§ÃƒÂ£o"]})]})})()]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"space-y-6",children:re.itens.filter(T=>{var Pe;if(!(T.produto_vinculado!==null||T.produto_id!==null))return!1;const pe=((Pe=T.produto_vinculado)==null?void 0:Pe.variacao_custo_percentual)||T.variacao_custo_percentual||0;return J==="todos"?!0:J==="aumentou"?pe>0:J==="diminuiu"?pe<0:J==="igual"?pe===0:!0}).map(T=>{const ne=T.produto_vinculado||{produto_id:T.produto_id,produto_nome:T.produto_nome,produto_codigo:T.produto_codigo,produto_ean:T.produto_ean,custo_anterior:T.custo_anterior,custo_novo:T.custo_novo,variacao_custo_percentual:T.variacao_custo_percentual,preco_venda_atual:T.preco_venda_atual,margem_atual:T.margem_atual,estoque_atual:T.estoque_atual};if(!ne.produto_id||!ne.produto_id)return null;const pe=ne.variacao_custo_percentual||0,Pe=pe>0,Be=Z[ne.produto_id]||{preco_venda:ne.preco_venda_atual||0,margem:ne.margem_atual||0};return e.jsxs("div",{className:"border-2 border-gray-300 rounded-xl overflow-hidden shadow-md hover:shadow-xl transition-all",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-500 text-white p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-xl mb-1",children:ne.produto_nome}),e.jsxs("p",{className:"text-sm text-blue-100",children:["SKU: ",ne.produto_codigo]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("button",{onClick:()=>Ue(ne.produto_id,ne.produto_nome),className:"px-3 py-1 bg-white/20 hover:bg-white/30 rounded text-sm font-medium transition-colors",children:"Ã°Å¸â€œÅ  HistÃƒÂ³rico"}),e.jsxs("div",{className:"mt-1 text-sm",children:["Quantidade ",e.jsx("strong",{children:T.quantidade||T.quantidade_nf||0})]})]})]})}),e.jsxs("div",{className:"p-5 bg-white space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Ã°Å¸â€™Âµ Custo Anterior"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-700",children:["R$ ",(ne.custo_anterior||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Ã°Å¸â€ â€¢ Custo Novo"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["R$ ",(ne.custo_novo||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Ã°Å¸â€œÅ  VariaÃƒÂ§ÃƒÂ£o"}),e.jsxs("div",{className:`text-2xl font-bold ${Pe?"text-red-600":pe<0?"text-green-600":"text-gray-600"}`,children:[pe>0?"Ã¢â€ â€”":pe<0?"Ã¢â€ Ëœ":"Ã¢Å¾Â¡"," ",Math.abs(pe).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Ã°Å¸â€™Â° PreÃƒÂ§o de Venda"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:Be.preco_venda,onChange:Ke=>oe(ne.produto_id,parseFloat(Ke.target.value)||0,ne.custo_novo),className:"w-full pl-10 pr-3 py-3 border-2 border-gray-300 rounded-lg text-xl font-bold focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Anterior: R$ ",ne.preco_venda_atual.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Ã°Å¸â€œË† Margem de Lucro"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.1",value:Be.margem,onChange:Ke=>Ne(ne.produto_id,parseFloat(Ke.target.value)||0,ne.custo_novo),className:"w-full pr-10 pl-3 py-3 border-2 border-gray-300 rounded-lg text-xl font-bold focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:"%"})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"Com o novo custo"})]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-purple-800 mb-3",children:"Ã°Å¸â€œÅ  AnÃƒÂ¡lise Comparativa (Valores Anteriores)"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Ã°Å¸â€™Âµ Custo Anterior"}),e.jsxs("div",{className:"text-lg font-bold text-gray-700",children:["R$ ",(ne.custo_anterior||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Ã°Å¸â€™Â° PreÃƒÂ§o Anterior"}),e.jsxs("div",{className:"text-lg font-bold text-blue-700",children:["R$ ",(ne.preco_venda_atual||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Ã°Å¸â€œË† Margem Anterior"}),e.jsxs("div",{className:"text-lg font-bold text-purple-700",children:[(ne.margem_atual||0).toFixed(1),"%"]})]})]})]})]})]},T.item_id)}).filter(Boolean)})}),e.jsxs("div",{className:"border-t border-gray-200 p-6 bg-gray-50 flex justify-between items-center",children:[e.jsx("button",{onClick:()=>{X(!1),M(null)},className:"px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors",children:"Ã¢ÂÅ’ Cancelar"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Valor Total da Nota"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["R$ ",re.valor_total.toFixed(2)]})]}),e.jsx("button",{onClick:oa,disabled:i,className:"px-8 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-lg font-bold text-lg shadow-lg disabled:opacity-50 transition-all",children:i?"Ã¢ÂÂ³ Processando...":"Ã¢Å“â€¦ Confirmar e Processar Nota"})]})]})]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Ã°Å¸â€œÅ  HistÃƒÂ³rico de AlteraÃƒÂ§ÃƒÂµes de PreÃƒÂ§os"}),P&&e.jsx("p",{className:"mt-2 text-purple-100",children:P.nome})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:te?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-purple-600"})}):w.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhuma alteraÃƒÂ§ÃƒÂ£o de preÃƒÂ§o registrada"})}):e.jsx("div",{className:"space-y-4",children:w.map(T=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:T.motivo==="nfe_entrada"?"Ã°Å¸â€œÂ¦":T.motivo==="nfe_revisao_precos"?"Ã°Å¸â€™Â°":T.motivo==="manual"?"Ã¢Å“ÂÃ¯Â¸Â":"Ã°Å¸â€œÂ"}),e.jsx("span",{className:"font-semibold text-gray-800",children:T.motivo==="nfe_entrada"?"Entrada NF-e":T.motivo==="nfe_revisao_precos"?"RevisÃƒÂ£o de PreÃƒÂ§os":T.motivo==="manual"?"Ajuste Manual":T.motivo})]}),T.referencia&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:T.referencia}),T.nota_numero&&e.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["Nota: ",T.nota_numero]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-500",children:[new Date(T.data).toLocaleString("pt-BR"),T.usuario&&e.jsx("div",{className:"text-xs mt-1",children:T.usuario})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[T.preco_custo_anterior!==null&&T.preco_custo_novo!==null&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 font-semibold mb-2",children:"Ã°Å¸â€™Âµ CUSTO"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Anterior"}),e.jsxs("div",{className:"text-lg font-bold",children:["R$ ",T.preco_custo_anterior.toFixed(2)]})]}),e.jsx("div",{className:"text-2xl",children:"Ã¢â€ â€™"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Novo"}),e.jsxs("div",{className:"text-lg font-bold text-blue-700",children:["R$ ",T.preco_custo_novo.toFixed(2)]})]})]}),T.variacao_custo_percentual!==null&&T.variacao_custo_percentual!==0&&e.jsxs("div",{className:`mt-2 text-sm font-semibold text-center ${T.variacao_custo_percentual>0?"text-red-600":"text-green-600"}`,children:[T.variacao_custo_percentual>0?"Ã¢â€ â€˜":"Ã¢â€ â€œ"," ",Math.abs(T.variacao_custo_percentual).toFixed(2),"%"]})]}),T.preco_venda_anterior!==null&&T.preco_venda_novo!==null&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 font-semibold mb-2",children:"Ã°Å¸â€™Â² PREÃƒâ€¡O DE VENDA"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Anterior"}),e.jsxs("div",{className:"text-lg font-bold",children:["R$ ",T.preco_venda_anterior.toFixed(2)]})]}),e.jsx("div",{className:"text-2xl",children:"Ã¢â€ â€™"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Novo"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",T.preco_venda_novo.toFixed(2)]})]})]}),T.variacao_venda_percentual!==null&&T.variacao_venda_percentual!==0&&e.jsxs("div",{className:`mt-2 text-sm font-semibold text-center ${T.variacao_venda_percentual>0?"text-green-600":"text-red-600"}`,children:[T.variacao_venda_percentual>0?"Ã¢â€ â€˜":"Ã¢â€ â€œ"," ",Math.abs(T.variacao_venda_percentual).toFixed(2),"%"]})]})]}),T.margem_anterior!==null&&T.margem_nova!==null&&e.jsxs("div",{className:"mt-3 bg-purple-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-600 font-semibold mb-2",children:"Ã°Å¸â€œË† MARGEM DE LUCRO"}),e.jsxs("div",{className:"flex items-center justify-around",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Anterior"}),e.jsxs("div",{className:"text-xl font-bold",children:[T.margem_anterior.toFixed(1),"%"]})]}),e.jsx("div",{className:"text-2xl",children:"Ã¢â€ â€™"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Nova"}),e.jsxs("div",{className:"text-xl font-bold text-purple-700",children:[T.margem_nova.toFixed(1),"%"]})]})]})]}),T.observacoes&&e.jsx("div",{className:"mt-3 text-sm text-gray-600 italic bg-gray-50 rounded p-2",children:T.observacoes})]},T.id))})}),e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsx("button",{onClick:()=>{N(!1),S([]),W(null)},className:"w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors",children:"Fechar"})})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white p-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Ã°Å¸â€œÂ¦ Resultado do Processamento em Lote"}),h&&e.jsxs("p",{className:"mt-2",children:[h.sucessos," sucesso(s) | ",h.erros," erro(s) | Total: ",h.total_arquivos]})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1",children:[c&&!h&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-green-600 mb-4"}),e.jsx("p",{className:"text-lg text-gray-600",children:"Processando arquivos..."})]}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-100 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:h.total_arquivos}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:h.sucessos}),e.jsx("div",{className:"text-sm text-gray-600",children:"Sucessos"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:h.erros}),e.jsx("div",{className:"text-sm text-gray-600",children:"Erros"})]})]}),e.jsx("div",{className:"space-y-3",children:h.resultados.map((T,ne)=>{var pe;return e.jsx("div",{className:`border rounded-lg p-4 ${T.sucesso?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:T.sucesso?"Ã¢Å“â€¦":"Ã¢ÂÅ’"}),e.jsx("span",{className:"font-semibold text-gray-800",children:T.arquivo})]}),T.sucesso?e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Nota:"})," ",T.numero_nota]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Fornecedor:"})," ",T.fornecedor]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Valor:"})," R$ ",(pe=T.valor_total)==null?void 0:pe.toFixed(2)]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Produtos:"})," ",T.produtos_vinculados," vinculados, ",T.produtos_nao_vinculados," nÃƒÂ£o vinculados"]})]}):e.jsx("p",{className:"text-sm text-red-700",children:T.mensagem})]}),e.jsxs("span",{className:"text-sm text-gray-500 ml-4",children:["#",T.ordem]})]})},ne)})})]})]}),e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsx("button",{onClick:()=>{u(!1),p(null)},disabled:c,className:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold disabled:opacity-50 transition-colors",children:c?"Ã¢ÂÂ³ Processando...":"Fechar"})})]})})]})},em=({isOpen:a,onClose:t,onSuccess:s})=>{const[o,r]=n.useState(!1),[i,l]=n.useState(!1),[x,j]=n.useState({contas_pagar:[],contas_receber:[]}),[g,v]=n.useState({}),[d,m]=n.useState(new Set),[C,y]=n.useState("todos"),[c,f]=n.useState(!1),[b,u]=n.useState([]),[h,p]=n.useState({});n.useEffect(()=>{a&&(N(),k())},[a]);const k=async()=>{try{const $=await F.get("/dre/subcategorias");u($.data)}catch($){console.error("Erro ao carregar categorias DRE:",$)}},N=async()=>{r(!0);try{const $=await F.get("/dre/classificar/pendentes",{params:{limit:100}});j($.data),await w($.data),ce.success(`${$.data.total_pendentes} lanÃ§amentos pendentes encontrados`)}catch($){console.error("Erro ao carregar pendentes:",$),ce.error("Erro ao carregar lanÃ§amentos pendentes")}finally{r(!1)}},w=async $=>{const J={};for(const E of $.contas_pagar)try{const R=await F.post("/dre/classificar/sugerir",{tipo:"pagar",lancamento_id:E.id});J[`pagar_${E.id}`]=R.data}catch(R){console.error(`Erro ao buscar sugestÃµes para pagar #${E.id}:`,R),J[`pagar_${E.id}`]=[]}for(const E of $.contas_receber)try{const R=await F.post("/dre/classificar/sugerir",{tipo:"receber",lancamento_id:E.id});J[`receber_${E.id}`]=R.data}catch(R){console.error(`Erro ao buscar sugestÃµes para receber #${E.id}:`,R),J[`receber_${E.id}`]=[]}v(J)},S=async($,J,E)=>{l(!0);try{await F.post("/dre/classificar/aplicar",{tipo:$,lancamento_id:J,dre_subcategoria_id:E.dre_subcategoria_id,canal:null,regra_id:E.regra_id,forma_classificacao:"sugestao_aceita"}),m(R=>new Set([...R,`${$}_${J}`])),ce.success(`âœ… Classificado: ${E.subcategoria_nome}`)}catch(R){console.error("Erro ao aplicar classificaÃ§Ã£o:",R),ce.error("Erro ao aplicar classificaÃ§Ã£o")}finally{l(!1)}},P=async()=>{f(!0);try{const $=await F.post("/dre/classificar/auto-classificar-pendentes",null,{params:{apenas_alta_confianca:!0}});ce.success(`ðŸ¤– Auto-classificaÃ§Ã£o concluÃ­da!
${$.data.total_classificado} de ${$.data.total_processado} lanÃ§amentos classificados`,{duration:5e3}),await N(),s&&s()}catch($){console.error("Erro ao auto-classificar:",$),ce.error("Erro ao executar auto-classificaÃ§Ã£o")}finally{f(!1)}},W=async($,J,E)=>{if(!E){ce.error("Selecione uma categoria DRE");return}l(!0);try{const R=b.find(K=>K.id===parseInt(E));await F.post("/dre/classificar/aplicar",{tipo:$,lancamento_id:J,dre_subcategoria_id:parseInt(E),canal:null,regra_id:null,forma_classificacao:"manual"}),m(K=>new Set([...K,`${$}_${J}`])),p(K=>{const B={...K};return delete B[`${$}_${J}`],B}),ce.success(`âœ… Classificado manualmente: ${(R==null?void 0:R.nome)||"Categoria"}`)}catch(R){console.error("Erro ao aplicar classificaÃ§Ã£o manual:",R),ce.error("Erro ao aplicar classificaÃ§Ã£o manual")}finally{l(!1)}},te=async($,J)=>{l(!0);try{m(E=>new Set([...E,`${$}_${J}`])),ce.success('ðŸ“¦ Marcado como "NÃ£o Controla DRE" (Estoque/Produtos)')}catch(E){console.error("Erro ao marcar como nÃ£o-DRE:",E),ce.error("Erro ao processar")}finally{l(!1)}},D=async($,J,E,R,K)=>{if(!E){ce.error("LanÃ§amento sem fornecedor/cliente vinculado");return}const B=R||K;if(!B){ce.error("ID do fornecedor/cliente nÃ£o encontrado");return}if(window.confirm(`Deseja marcar "${E}" como fornecedor de produtos (NÃ£o Controla DRE)?

Todos os lanÃ§amentos deste fornecedor serÃ£o automaticamente ignorados no DRE.`)){l(!0);try{await F.patch(`/clientes/${B}/controla-dre?controla_dre=false`),m(_=>new Set([..._,`${$}_${J}`])),ce.success(`âœ… Fornecedor "${E}" marcado como "NÃ£o Controla DRE"

Todos os lanÃ§amentos futuros serÃ£o ignorados automaticamente.`,{duration:6e3}),setTimeout(()=>N(),1e3)}catch(_){console.error("Erro ao marcar fornecedor:",_),ce.error("Erro ao marcar fornecedor como NÃ£o DRE")}finally{l(!1)}}},A=$=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format($||0),X=$=>$?new Date($).toLocaleDateString("pt-BR"):"-",re=$=>$>=90?"text-green-600 bg-green-100":$>=70?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100",Z=(C==="pagar"?x.contas_pagar.map($=>({...$,tipo:"pagar"})):C==="receber"?x.contas_receber.map($=>({...$,tipo:"receber"})):[...x.contas_pagar.map($=>({...$,tipo:"pagar"})),...x.contas_receber.map($=>({...$,tipo:"receber"}))]).filter($=>!d.has(`${$.tipo}_${$.id}`));return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-t-lg",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold flex items-center gap-2",children:"ðŸ·ï¸ Classificar LanÃ§amentos Pendentes"}),e.jsxs("p",{className:"text-sm text-purple-100 mt-1",children:[Z.length," lanÃ§amentos aguardando classificaÃ§Ã£o DRE"]})]}),e.jsx("button",{onClick:t,className:"text-white hover:bg-white hover:bg-opacity-20 p-2 rounded-lg transition-colors",children:e.jsx(ks,{size:24})})]}),e.jsxs("div",{className:"p-4 border-b bg-gray-50 flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>y("todos"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${C==="todos"?"bg-purple-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:["ðŸ“Š Todos (",x.contas_pagar.length+x.contas_receber.length,")"]}),e.jsxs("button",{onClick:()=>y("pagar"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${C==="pagar"?"bg-red-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:["ðŸ’¸ A Pagar (",x.contas_pagar.length,")"]}),e.jsxs("button",{onClick:()=>y("receber"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${C==="receber"?"bg-green-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:["ðŸ’° A Receber (",x.contas_receber.length,")"]})]}),e.jsx("button",{onClick:P,disabled:c||Z.length===0,className:"flex items-center gap-2 bg-gradient-to-r from-green-600 to-emerald-600 text-white px-6 py-2 rounded-lg font-medium hover:from-green-700 hover:to-emerald-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:c?e.jsxs(e.Fragment,{children:[e.jsx(xn,{className:"animate-spin",size:20}),"Auto-Classificando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Vt,{size:20}),"Auto-Classificar (Alta ConfianÃ§a)"]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(xn,{className:"animate-spin text-purple-600",size:48})}):Z.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(qs,{size:64,className:"text-green-500 mb-4"}),e.jsx("p",{className:"text-xl font-semibold",children:"Nenhum lanÃ§amento pendente!"}),e.jsx("p",{className:"text-sm mt-2",children:"Todos os lanÃ§amentos foram classificados."})]}):e.jsx("div",{className:"space-y-4",children:Z.map($=>{const J=`${$.tipo}_${$.id}`,E=g[J]||[];return E[0],e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white shadow-sm hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${$.tipo==="pagar"?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:$.tipo==="pagar"?"ðŸ’¸ A Pagar":"ðŸ’° A Receber"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["#",$.id]})]}),e.jsx("h3",{className:"font-semibold text-gray-800 text-lg mb-1",children:$.descricao}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[$.beneficiario&&e.jsxs("span",{className:"flex items-center gap-1",children:["ðŸ‘¤ ",$.beneficiario]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(es,{size:14}),A($.valor)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ps,{size:14}),X($.data_vencimento)]}),$.tipo_documento&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs",children:$.tipo_documento})]})]})}),E.length===0?e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ca,{className:"text-yellow-600",size:20}),e.jsx("span",{className:"text-sm text-yellow-700 font-semibold",children:"Nenhuma sugestÃ£o automÃ¡tica. Classifique manualmente."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:h[J]||"",onChange:R=>p(K=>({...K,[J]:R.target.value})),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"",children:"Selecione uma categoria DRE..."}),b.map(R=>e.jsxs("option",{value:R.id,children:[R.categoria_nome," â†’ ",R.nome]},R.id))]}),e.jsxs("button",{onClick:()=>W($.tipo,$.id,h[J]),disabled:i||!h[J],className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",children:[e.jsx(Wt,{size:18}),"Classificar"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>te($.tipo,$.id),disabled:i,className:"flex-1 flex items-center justify-center gap-2 bg-gray-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Marca apenas ESTE lanÃ§amento como NÃ£o DRE",children:"ðŸ“¦ Este LanÃ§amento"}),$.beneficiario&&e.jsxs("button",{onClick:()=>D($.tipo,$.id,$.beneficiario,$.fornecedor_id,$.cliente_id),disabled:i,className:"flex-1 flex items-center justify-center gap-2 bg-orange-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:`Marca TODOS os lanÃ§amentos de ${$.beneficiario} como NÃ£o DRE`,children:['ðŸª Todo Fornecedor "',$.beneficiario,'"']})]})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase mb-2",children:"ðŸ¤– SugestÃµes de ClassificaÃ§Ã£o:"}),E.slice(0,3).map((R,K)=>e.jsxs("div",{className:`flex justify-between items-center p-3 rounded-lg border-2 ${K===0?"border-purple-300 bg-purple-50":"border-gray-200 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:R.subcategoria_nome}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${re(R.confianca)}`,children:[R.confianca,"% confianÃ§a"]}),K===0&&e.jsx("span",{className:"px-2 py-1 bg-purple-600 text-white rounded-full text-xs font-bold",children:"â­ Melhor"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:R.motivo}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Regra: ",R.regra_nome]})]}),e.jsxs("button",{onClick:()=>S($.tipo,$.id,R),disabled:i,className:"ml-4 flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Wt,{size:18}),"Aceitar"]})]},K))]})]},J)})})}),e.jsxs("div",{className:"p-4 border-t bg-gray-50 flex justify-between items-center rounded-b-lg",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:d.size})," classificados nesta sessÃ£o"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{d.size>0&&s&&s(),t()},className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors",children:"Fechar"}),d.size>0&&e.jsx("button",{onClick:N,className:"px-6 py-2 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition-colors",children:"Atualizar Lista"})]})]})]})}):null},In=()=>{const a=va(),[t,s]=n.useState(!0),[o,r]=n.useState(30),[i,l]=n.useState(!1),[x,j]=n.useState({saldo_atual:0,contas_receber:{total:0,vencidas:0},contas_pagar:{total:0,vencidas:0},vendas_periodo:{quantidade:0,valor_total:0,finalizadas:0,ticket_medio:0},fluxo_periodo:{entradas:0,saidas:0,lucro:0}}),[g,v]=n.useState([]),[d,m]=n.useState({contas_receber:[],contas_pagar:[]}),C=u=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(u||0),y=u=>new Date(u).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}),c=async()=>{s(!0);try{const u=await F.get(`/dashboard/resumo?periodo_dias=${o}`);j(u.data)}catch(u){console.error("Erro ao carregar resumo:",u)}try{const u=await F.get(`/dashboard/entradas-saidas?periodo_dias=${o}`);v(u.data)}catch(u){console.error("Erro ao carregar entradas/saÃ­das:",u)}try{const u=await F.get("/dashboard/contas-vencidas?limite=5");m(u.data)}catch(u){console.error("Erro ao carregar contas vencidas:",u)}s(!1)};if(n.useEffect(()=>{c()},[o]),t)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500"})});const f=[{nome:"Loja FÃ­sica",valor:x.vendas_periodo.valor_total||0,margem:35.5,lucro:(x.vendas_periodo.valor_total||0)*.355,icon:Ei,color:"blue",isMock:!1,onClick:()=>a("/financeiro/relatorio-vendas")},{nome:"Mercado Livre",valor:8450,margem:18.2,lucro:1537.9,icon:ls,color:"yellow",isMock:!0,onClick:()=>ce("IntegraÃ§Ã£o com Mercado Livre em breve",{icon:"ðŸ“¦"})},{nome:"Shopee",valor:5230,margem:22.5,lucro:1176.75,icon:qr,color:"orange",isMock:!0,onClick:()=>ce("IntegraÃ§Ã£o com Shopee em breve",{icon:"ðŸ›’"})},{nome:"Amazon",valor:12890,margem:15.8,lucro:2036.62,icon:ls,color:"purple",isMock:!0,onClick:()=>ce("IntegraÃ§Ã£o com Amazon em breve",{icon:"ðŸ“¦"})}],b=u=>{const h={blue:"from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700",green:"from-green-500 to-green-600 hover:from-green-600 hover:to-green-700",red:"from-red-500 to-red-600 hover:from-red-600 hover:to-red-700",purple:"from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700",yellow:"from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700",orange:"from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700"};return h[u]||h.blue};return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Dashboard Gerencial"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"VisÃ£o consolidada do seu negÃ³cio"})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white px-5 py-2.5 rounded-lg font-medium hover:from-purple-700 hover:to-blue-700 transition-all shadow-lg hover:shadow-xl transform hover:scale-105",children:[e.jsx("span",{className:"text-xl",children:"ðŸ·ï¸"}),"Classificar DRE"]}),e.jsx("div",{className:"flex gap-2",children:[7,15,30,60,90].map(u=>e.jsxs("button",{onClick:()=>r(u),className:`px-4 py-2 rounded-lg font-medium transition-colors ${o===u?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:[u," dias"]},u))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs("div",{onClick:()=>a("/financeiro/fluxo-caixa"),className:`bg-gradient-to-br ${b("blue")} rounded-xl p-6 text-white shadow-lg cursor-pointer transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-lg",children:e.jsx(Oa,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-xs font-medium bg-white/20 px-2 py-1 rounded",children:"Atual"})]}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"Saldo Atual"}),e.jsx("p",{className:"text-2xl font-bold",children:C(x.saldo_atual)}),e.jsx("p",{className:"text-xs mt-2 opacity-75",children:"Clique para ver fluxo de caixa"})]}),e.jsxs("div",{onClick:()=>a("/financeiro/contas-receber"),className:`bg-gradient-to-br ${b("green")} rounded-xl p-6 text-white shadow-lg cursor-pointer transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-lg",children:e.jsx(Ta,{className:"w-6 h-6"})}),x.contas_receber.vencidas>0&&e.jsx(xa,{className:"w-5 h-5 text-yellow-300"})]}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"A Receber"}),e.jsx("p",{className:"text-2xl font-bold",children:C(x.contas_receber.total)}),x.contas_receber.vencidas>0?e.jsxs("p",{className:"text-xs mt-2 opacity-90",children:["âš ï¸ Vencidas: ",C(x.contas_receber.vencidas)]}):e.jsx("p",{className:"text-xs mt-2 opacity-75",children:"Clique para gerenciar"})]}),e.jsxs("div",{onClick:()=>a("/financeiro/contas-pagar"),className:`bg-gradient-to-br ${b("red")} rounded-xl p-6 text-white shadow-lg cursor-pointer transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-lg",children:e.jsx(Ha,{className:"w-6 h-6"})}),x.contas_pagar.vencidas>0&&e.jsx(xa,{className:"w-5 h-5 text-yellow-300"})]}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"A Pagar"}),e.jsx("p",{className:"text-2xl font-bold",children:C(x.contas_pagar.total)}),x.contas_pagar.vencidas>0?e.jsxs("p",{className:"text-xs mt-2 opacity-90",children:["âš ï¸ Vencidas: ",C(x.contas_pagar.vencidas)]}):e.jsx("p",{className:"text-xs mt-2 opacity-75",children:"Clique para gerenciar"})]}),e.jsxs("div",{onClick:()=>a("/financeiro/dre"),className:`bg-gradient-to-br ${x.fluxo_periodo.lucro>=0?b("purple"):b("orange")} rounded-xl p-6 text-white shadow-lg cursor-pointer transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-lg",children:e.jsx(ss,{className:"w-6 h-6"})}),e.jsxs("span",{className:"text-xs font-medium bg-white/20 px-2 py-1 rounded",children:[o," dias"]})]}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:x.fluxo_periodo.lucro>=0?"Lucro":"PrejuÃ­zo"}),e.jsx("p",{className:"text-2xl font-bold",children:C(Math.abs(x.fluxo_periodo.lucro))}),e.jsx("p",{className:"text-xs mt-2 opacity-75",children:"Clique para ver DRE completo"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Vendas por Canal"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Performance de cada canal de vendas"})]}),e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full font-medium",children:"Marketplaces em preparaÃ§Ã£o"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:f.map((u,h)=>e.jsxs("div",{onClick:u.onClick,className:"bg-gray-50 rounded-lg p-5 border border-gray-200 hover:shadow-md transition-all cursor-pointer transform hover:scale-105 relative",children:[u.isMock&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:"text-xs bg-gray-200 text-gray-600 px-2 py-0.5 rounded",children:"Mock"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`bg-gradient-to-br ${b(u.color)} p-3 rounded-lg`,children:e.jsx(u.icon,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"font-semibold text-gray-800",children:u.nome})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Valor Vendido"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:C(u.valor)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Margem"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-800",children:[u.margem,"%"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Lucro Est."}),e.jsx("p",{className:"text-sm font-semibold text-green-600",children:C(u.lucro)})]})]})]})]},h))}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Total consolidado:"})," ",C(f.reduce((u,h)=>u+h.valor,0))," "," | ",e.jsx("strong",{children:"Lucro total:"})," ",C(f.reduce((u,h)=>u+h.lucro,0))]})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl shadow-lg p-6 mb-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-lg",children:e.jsx(Cs,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Insights Inteligentes"}),e.jsx("p",{className:"text-sm opacity-90",children:"Alertas e sugestÃµes automÃ¡ticas"})]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-6 text-center",children:[e.jsx(Cs,{className:"w-12 h-12 mx-auto mb-3 opacity-75"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Em breve a IA mostrarÃ¡ aqui:"}),e.jsxs("div",{className:"mt-3 space-y-2 text-sm opacity-90",children:[e.jsx("p",{children:"â€¢ Problemas urgentes detectados"}),e.jsx("p",{children:"â€¢ Oportunidades de lucro identificadas"}),e.jsx("p",{children:"â€¢ AÃ§Ãµes recomendadas para hoje"})]}),e.jsx("p",{className:"text-xs mt-4 opacity-75",children:"Sem mÃ¡gica. Apenas anÃ¡lise inteligente dos seus dados reais."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>a("/pdv"),className:"bg-gradient-to-br from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all transform hover:scale-105 flex items-center justify-center gap-3",children:[e.jsx(qr,{className:"w-5 h-5"}),"Nova Venda"]}),e.jsxs("button",{onClick:()=>a("/financeiro/contas-receber"),className:"bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all transform hover:scale-105 flex items-center justify-center gap-3",children:[e.jsx(Ta,{className:"w-5 h-5"}),"Registrar Recebimento"]}),e.jsxs("button",{onClick:()=>a("/financeiro/contas-pagar"),className:"bg-gradient-to-br from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all transform hover:scale-105 flex items-center justify-center gap-3",children:[e.jsx(Ha,{className:"w-5 h-5"}),"Registrar Despesa"]}),e.jsxs("button",{onClick:()=>a("/ia/fluxo-caixa"),className:"bg-gradient-to-br from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all transform hover:scale-105 flex items-center justify-center gap-3",children:[e.jsx(Cs,{className:"w-5 h-5"}),"RevisÃµes IA"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg mb-6",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-4",children:["Fluxo Financeiro (",o," dias)"]}),e.jsx(za,{width:"100%",height:300,children:e.jsxs(Et,{data:g,children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ga,{dataKey:"data",tickFormatter:y,style:{fontSize:"12px"}}),e.jsx(Ua,{tickFormatter:u=>`R$ ${(u/1e3).toFixed(0)}k`,style:{fontSize:"12px"}}),e.jsx(Ma,{formatter:u=>C(u),labelFormatter:y}),e.jsx(Wa,{}),e.jsx(gs,{type:"monotone",dataKey:"entradas",stroke:"#10B981",strokeWidth:2,name:"Entradas"}),e.jsx(gs,{type:"monotone",dataKey:"saidas",stroke:"#EF4444",strokeWidth:2,name:"SaÃ­das"})]})})]}),(d.contas_receber.length>0||d.contas_pagar.length>0)&&e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(xa,{className:"w-5 h-5 text-red-500"}),"AtenÃ§Ã£o: Contas Vencidas"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[d.contas_receber.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:["A Receber (",d.contas_receber.length,")"]}),e.jsx("div",{className:"space-y-2",children:d.contas_receber.slice(0,3).map(u=>e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:u.cliente||"Sem cliente"}),e.jsx("p",{className:"font-bold text-red-600 text-sm",children:C(u.saldo)})]}),e.jsxs("p",{className:"text-xs text-red-600",children:["Venceu hÃ¡ ",u.dias_vencido," dias"]})]},u.id))})]}),d.contas_pagar.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:["A Pagar (",d.contas_pagar.length,")"]}),e.jsx("div",{className:"space-y-2",children:d.contas_pagar.slice(0,3).map(u=>e.jsxs("div",{className:"p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:u.fornecedor||"Sem fornecedor"}),e.jsx("p",{className:"font-bold text-orange-600 text-sm",children:C(u.saldo)})]}),e.jsxs("p",{className:"text-xs text-orange-600",children:["Venceu hÃ¡ ",u.dias_vencido," dias"]})]},u.id))})]})]})]}),e.jsx(em,{isOpen:i,onClose:()=>l(!1)})]})},ut=[{value:"banco",label:"Banco",icon:ml,cor_padrao:"#dc2626"},{value:"caixa",label:"Caixa FÃ­sico",icon:kt,cor_padrao:"#16a34a"},{value:"digital",label:"Carteira Digital",icon:Ct,cor_padrao:"#2563eb"}],am=["ðŸ¦","ðŸ’°","ðŸ’³","ðŸ’µ","ðŸ’¸","ðŸ§","ðŸª™","ðŸ’´","ðŸ’¶","ðŸ’·","ðŸ¤‘","ðŸ’²","ðŸ”’","ðŸ¦","ðŸª","ðŸ¢","ðŸ­","ðŸŽ¯","ðŸ“Š","ðŸ“ˆ","ðŸ’¼","ðŸ‘›","ðŸŽ","âš¡"];function sm(){const[a,t]=n.useState([]),[s,o]=n.useState(!0),[r,i]=n.useState(!1),[l,x]=n.useState(null),[j,g]=n.useState(""),[v,d]=n.useState({nome:"",tipo:"banco",banco:"",saldo_inicial:0,cor:"#dc2626",icone:"ðŸ¦",instituicao_bancaria:!1,ativa:!0});n.useEffect(()=>{m()},[]);const m=async()=>{try{o(!0);const f=await F.get("/contas-bancarias");t(f.data)}catch(f){console.error("Erro:",f),g("Erro ao carregar contas bancÃ¡rias")}finally{o(!1)}},C=(f=null)=>{if(f)d({nome:f.nome,tipo:f.tipo,banco:f.banco||"",saldo_inicial:f.saldo_inicial,cor:f.cor||"#dc2626",icone:f.icone||"ðŸ¦",instituicao_bancaria:f.instituicao_bancaria||!1,ativa:f.ativa}),x(f);else{const b=ut[0];d({nome:"",tipo:"banco",banco:"",saldo_inicial:0,cor:b.cor_padrao,icone:"ðŸ¦",instituicao_bancaria:!1,ativa:!0}),x(null)}i(!0),g("")},y=async f=>{var b,u,h;f.preventDefault();try{const p={nome:v.nome.trim(),tipo:v.tipo,banco:((b=v.banco)==null?void 0:b.trim())||null,saldo_inicial:Number(v.saldo_inicial)||0,cor:v.cor,icone:v.icone||"ðŸ¦",instituicao_bancaria:!!v.instituicao_bancaria,ativa:!!v.ativa};console.log("Enviando dados:",p),l?await F.put(`/contas-bancarias/${l.id}`,p):await F.post("/contas-bancarias",p),await m(),i(!1),g("")}catch(p){console.error("Erro completo:",p),console.error("Response:",p.response),g(((h=(u=p.response)==null?void 0:u.data)==null?void 0:h.detail)||p.message||"Erro ao salvar conta")}},c=async f=>{var b,u;if(confirm("Deseja realmente excluir esta conta?"))try{await F.delete(`/contas-bancarias/${f}`),await m()}catch(h){console.error("Erro:",h),g(((u=(b=h.response)==null?void 0:b.data)==null?void 0:u.detail)||"Erro ao excluir conta")}};return s?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Cadastro de Bancos"}),e.jsx("p",{className:"text-gray-600",children:"Configure as contas bancÃ¡rias, caixas e carteiras digitais do sistema"})]}),e.jsxs("button",{onClick:()=>C(),className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",children:[e.jsx(us,{className:"w-5 h-5"}),"Nova Conta"]})]})}),j&&e.jsxs("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-2",children:[e.jsx(xa,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-red-800",children:j})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(f=>{var u,h,p;const b=((u=ut.find(k=>k.value===f.tipo))==null?void 0:u.icon)||ml;return e.jsxs("div",{className:`bg-white rounded-xl border-2 p-4 transition ${f.ativa?"border-gray-200 hover:border-blue-300":"border-gray-100 opacity-60"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-2xl",style:{backgroundColor:`${f.cor}20`},children:f.icone}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800",children:f.nome}),e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),(h=ut.find(k=>k.value===f.tipo))==null?void 0:h.label]})]})]}),!f.ativa&&e.jsx("span",{className:"text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded",children:"Inativa"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Tipo de Conta"}),e.jsx("p",{className:"text-lg font-semibold text-gray-800",children:(p=ut.find(k=>k.value===f.tipo))==null?void 0:p.label}),f.banco&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:f.banco})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>C(f),className:"flex items-center justify-center bg-gray-100 text-gray-700 p-2 rounded-lg hover:bg-gray-200 transition",children:e.jsx(Fo,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>c(f.id),className:"flex items-center justify-center bg-red-50 text-red-600 p-2 rounded-lg hover:bg-red-100 transition",children:e.jsx(Es,{className:"w-4 h-4"})})]})]},f.id)})}),a.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(kt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg mb-4",children:"Nenhuma conta cadastrada"}),e.jsx("button",{onClick:()=>C(),className:"text-blue-600 hover:text-blue-700 font-medium",children:"Cadastrar primeira conta"})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:l?"Editar Conta":"Nova Conta"}),e.jsx("button",{onClick:()=>i(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(pa,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[j&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-red-800 text-sm",children:j}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),e.jsx("input",{type:"text",value:v.nome,onChange:f=>d({...v,nome:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsx("select",{value:v.tipo,onChange:f=>{const b=ut.find(u=>u.value===f.target.value);d({...v,tipo:f.target.value,cor:(b==null?void 0:b.cor_padrao)||v.cor})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:ut.map(f=>e.jsx("option",{value:f.value,children:f.label},f.value))})]}),v.tipo==="banco"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Banco"}),e.jsx("input",{type:"text",value:v.banco,onChange:f=>d({...v,banco:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: Santander, Bradesco..."})]}),!l&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Saldo Inicial"}),e.jsx("input",{type:"number",step:"0.01",value:v.saldo_inicial,onChange:f=>d({...v,saldo_inicial:parseFloat(f.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor"}),e.jsx("input",{type:"color",value:v.cor,onChange:f=>d({...v,cor:f.target.value}),className:"w-full h-10 rounded-lg cursor-pointer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ãcone Atual"}),e.jsx("div",{className:"w-full h-10 border border-gray-300 rounded-lg flex items-center justify-center text-2xl bg-white",style:{backgroundColor:`${v.cor}10`},children:v.icone})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Escolher Ãcone"}),e.jsx("div",{className:"grid grid-cols-8 gap-2 p-3 bg-gray-50 rounded-lg border border-gray-200 max-h-32 overflow-y-auto",children:am.map((f,b)=>e.jsx("button",{type:"button",onClick:()=>d({...v,icone:f}),className:`w-10 h-10 rounded-lg flex items-center justify-center text-xl transition hover:scale-110 ${v.icone===f?"bg-blue-100 border-2 border-blue-500 ring-2 ring-blue-200":"bg-white border border-gray-200 hover:border-blue-300"}`,children:f},b))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"instituicao_bancaria",checked:v.instituicao_bancaria,onChange:f=>d({...v,instituicao_bancaria:f.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"instituicao_bancaria",className:"text-sm text-gray-700",children:"ðŸ¦ InstituiÃ§Ã£o BancÃ¡ria (para conciliaÃ§Ã£o OFX)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"ativa",checked:v.ativa,onChange:f=>d({...v,ativa:f.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"ativa",className:"text-sm text-gray-700",children:"Conta ativa"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"flex-1 flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",children:[e.jsx(Kt,{className:"w-4 h-4"}),"Salvar"]})]})]})]})})]})}const tm=({isOpen:a,onClose:t,onSave:s})=>{const[o,r]=n.useState(!1),[i,l]=n.useState([]),[x,j]=n.useState([]),[g,v]=n.useState([]),[d,m]=n.useState([]),[C,y]=n.useState(30),[c,f]=n.useState(!1),[b,u]=n.useState({nome:"",tipo:"despesa",cor:"#ef4444",icone:"ðŸ’¸",descricao:"",ativo:!0,novasSubcategorias:[]}),[h,p]=n.useState({descricao:"",fornecedor_id:null,categoria_id:null,dre_subcategoria_id:null,valor_original:"",data_emissao:new Date().toISOString().split("T")[0],data_vencimento:new Date().toISOString().split("T")[0],documento:"",observacoes:"",eh_parcelado:!1,total_parcelas:1,eh_recorrente:!1,tipo_recorrencia:"mensal",intervalo_dias:null,data_inicio_recorrencia:null,data_fim_recorrencia:null,numero_repeticoes:null});n.useEffect(()=>{a&&k()},[a]);const k=async()=>{var M;try{const[Z,$,J]=await Promise.all([F.get("/clientes/?tipo_cadastro=fornecedor"),F.get("/categorias-financeiras/"),F.get("/dre/subcategorias")]);console.log("ðŸ“¦ Categorias recebidas:",$.data),l(Z.data);const E=$.data.filter(R=>{const K=R.tipo?R.tipo.toLowerCase():"",B=R.nome?R.nome.toLowerCase():"",_=K==="receita"||K==="entrada",O=B.includes("receita")||B.includes("venda");return!_&&!O});j(E),v(J.data||[]),console.log("âœ… Categorias de DESPESA setadas:",E.length),console.log("ðŸ“‹ Lista completa:",E),console.log("ðŸ“Š Subcategorias DRE carregadas:",(M=J.data)==null?void 0:M.length)}catch(Z){console.error("âŒ Erro ao carregar dados:",Z),ce.error("Erro ao carregar formulÃ¡rio")}},N=()=>{if(!h.eh_parcelado||!h.total_parcelas||!h.data_vencimento||!h.valor_original){m([]);return}const M=parseFloat(h.valor_original),Z=parseInt(h.total_parcelas),$=M/Z,J=[];let E=new Date(h.data_vencimento);for(let B=0;B<Z;B++){const _=new Date(E);_.setDate(E.getDate()+B*C),J.push({numero:B+1,valor:B===Z-1?M-$*(Z-1):$,data_vencimento:_.toISOString().split("T")[0]})}const R=J.reduce((B,_)=>B+_.valor,0),K=M-R;Math.abs(K)>.01&&(J[J.length-1].valor+=K),m(J)},w=()=>{u({...b,novasSubcategorias:[...b.novasSubcategorias,{nome:"",descricao:"",ativo:!0}]})},S=(M,Z,$)=>{const J=[...b.novasSubcategorias];J[M][Z]=$,u({...b,novasSubcategorias:J})},P=M=>{const Z=b.novasSubcategorias.filter(($,J)=>J!==M);u({...b,novasSubcategorias:Z})},W=(M,Z)=>{M.key==="Tab"&&!M.shiftKey&&Z===b.novasSubcategorias.length-1&&(M.preventDefault(),w())},te=async M=>{var Z,$;if(M.preventDefault(),!b.nome){ce.error("Preencha o nome da categoria");return}try{const E=(await F.post("/categorias-financeiras/",{nome:b.nome,tipo:b.tipo,cor:b.cor,icone:b.icone,descricao:b.descricao,ativo:b.ativo})).data.id;if(ce.success("Categoria criada com sucesso!"),b.novasSubcategorias.length>0){const R=b.novasSubcategorias.filter(K=>K.nome.trim());for(const K of R)try{await F.post("/subcategorias/",{categoria_id:E,nome:K.nome,descricao:K.descricao,ativo:K.ativo})}catch(B){console.error("Erro ao criar subcategoria:",B)}R.length>0&&ce.success(`${R.length} subcategoria(s) criada(s)!`)}await k(),p({...h,categoria_id:E}),f(!1),u({nome:"",tipo:"despesa",cor:"#ef4444",icone:"ðŸ’¸",descricao:"",ativo:!0,novasSubcategorias:[]})}catch(J){console.error("Erro ao salvar categoria:",J),ce.error((($=(Z=J.response)==null?void 0:Z.data)==null?void 0:$.detail)||"Erro ao salvar categoria")}},D=(M,Z)=>{const $=[...d];$[M].data_vencimento=Z,m($)},A=(M,Z)=>{const $=[...d];$[M].valor=parseFloat(Z)||0,m($)},X=async M=>{var Z,$;if(M.preventDefault(),!h.descricao||!h.valor_original||!h.data_vencimento){ce.error("Preencha todos os campos obrigatÃ³rios");return}r(!0);try{await F.post("/contas-pagar/",{...h,valor_original:parseFloat(h.valor_original),total_parcelas:h.eh_parcelado?parseInt(h.total_parcelas):1,intervalo_dias:h.tipo_recorrencia==="personalizado"?parseInt(h.intervalo_dias):null,numero_repeticoes:h.numero_repeticoes?parseInt(h.numero_repeticoes):null}),ce.success(h.eh_recorrente?"Conta recorrente criada com sucesso!":"Conta criada com sucesso!"),s(),t(),re()}catch(J){console.error("Erro ao criar conta:",J),ce.error((($=(Z=J.response)==null?void 0:Z.data)==null?void 0:$.detail)||"Erro ao criar conta a pagar")}finally{r(!1)}},re=()=>{p({descricao:"",fornecedor_id:null,categoria_id:null,valor_original:"",data_emissao:new Date().toISOString().split("T")[0],data_vencimento:new Date().toISOString().split("T")[0],documento:"",observacoes:"",eh_parcelado:!1,total_parcelas:1,eh_recorrente:!1,tipo_recorrencia:"mensal",intervalo_dias:null,data_inicio_recorrencia:null,data_fim_recorrencia:null,numero_repeticoes:null})};return a?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full m-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b sticky top-0 bg-white",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(us,{className:"text-red-600"}),"Nova Conta a Pagar"]}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700",children:e.jsx(pa,{size:24})})]}),e.jsxs("form",{onSubmit:X,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(ss,{size:20,className:"text-blue-600"}),"InformaÃ§Ãµes BÃ¡sicas"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o *"}),e.jsx("input",{type:"text",value:h.descricao,onChange:M=>p({...h,descricao:M.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",placeholder:"Ex: Aluguel, Conta de luz, Fornecedor XYZ...",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Ir,{size:16,className:"inline mr-1"}),"Fornecedor"]}),e.jsxs("select",{value:h.fornecedor_id||"",onChange:M=>p({...h,fornecedor_id:M.target.value?parseInt(M.target.value):null}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),i.map(M=>e.jsx("option",{value:M.id,children:M.nome},M.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Fi,{size:16,className:"inline mr-1"}),"Categoria"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:h.categoria_id||"",onChange:M=>p({...h,categoria_id:M.target.value?parseInt(M.target.value):null}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),x.map(M=>e.jsx("option",{value:M.id,children:M.nome},M.id))]}),e.jsxs("button",{type:"button",onClick:()=>f(!0),className:"px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center gap-1 whitespace-nowrap",title:"Adicionar nova categoria",children:[e.jsx(us,{size:16})," Adicionar"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ·ï¸ Subcategoria DRE (Demonstrativo de Resultado)"}),e.jsxs("select",{value:h.dre_subcategoria_id||"",onChange:M=>p({...h,dre_subcategoria_id:M.target.value?parseInt(M.target.value):null}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Sem classificaÃ§Ã£o DRE"}),g.map(M=>e.jsx("option",{value:M.id,children:M.nome},M.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Classifique para melhor anÃ¡lise gerencial"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Oa,{size:16,className:"inline mr-1"}),"Valor *"]}),e.jsx("input",{type:"number",step:"0.01",value:h.valor_original,onChange:M=>p({...h,valor_original:M.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(Is,{size:16,className:"inline mr-1"}),"Data Vencimento *"]}),e.jsx("input",{type:"date",value:h.data_vencimento,onChange:M=>p({...h,data_vencimento:M.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Documento/NF"}),e.jsx("input",{type:"text",value:h.documento,onChange:M=>p({...h,documento:M.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",placeholder:"NÃºmero do documento"})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"eh_recorrente",checked:h.eh_recorrente,onChange:M=>p({...h,eh_recorrente:M.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsxs("label",{htmlFor:"eh_recorrente",className:"text-lg font-semibold text-gray-700 flex items-center gap-2 cursor-pointer",children:[e.jsx(Pi,{size:20,className:"text-purple-600"}),"Despesa Recorrente"]})]}),h.eh_recorrente&&e.jsxs("div",{className:"ml-6 space-y-4 p-4 bg-purple-50 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de RecorrÃªncia *"}),e.jsxs("select",{value:h.tipo_recorrencia,onChange:M=>p({...h,tipo_recorrencia:M.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"semanal",children:"ðŸ“… Semanal (7 em 7 dias)"}),e.jsx("option",{value:"quinzenal",children:"ðŸ“† Quinzenal (15 em 15 dias)"}),e.jsx("option",{value:"mensal",children:"ðŸ—“ï¸ Mensal"}),e.jsx("option",{value:"personalizado",children:"âš™ï¸ Personalizado"})]})]}),h.tipo_recorrencia==="personalizado"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Intervalo (em dias) *"}),e.jsx("input",{type:"number",min:"1",value:h.intervalo_dias||"",onChange:M=>p({...h,intervalo_dias:M.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500",placeholder:"Ex: 10, 20, 45...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NÃºmero de RepetiÃ§Ãµes"}),e.jsx("input",{type:"number",min:"1",value:h.numero_repeticoes||"",onChange:M=>p({...h,numero_repeticoes:M.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500",placeholder:"Ex: 12 (deixe vazio para infinito)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Quantas vezes deve se repetir (opcional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de TÃ©rmino (alternativa)"}),e.jsx("input",{type:"date",value:h.data_fim_recorrencia||"",onChange:M=>p({...h,data_fim_recorrencia:M.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"AtÃ© quando deve repetir (opcional)"})]})]}),e.jsx("div",{className:"bg-blue-100 border border-blue-300 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"ðŸ’¡ Como funciona:"})," Esta conta serÃ¡ criada agora e o sistema irÃ¡ gerar automaticamente novas contas nos prÃ³ximos perÃ­odos conforme a recorrÃªncia configurada."]})})]})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"eh_parcelado",checked:h.eh_parcelado,onChange:M=>{p({...h,eh_parcelado:M.target.checked}),M.target.checked||m([])},disabled:h.eh_recorrente,className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 disabled:opacity-50"}),e.jsx("label",{htmlFor:"eh_parcelado",className:"text-lg font-semibold text-gray-700 cursor-pointer",children:"ðŸ’³ Parcelar esta conta"})]}),h.eh_parcelado&&!h.eh_recorrente&&e.jsxs("div",{className:"ml-6 space-y-4 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NÃºmero de Parcelas *"}),e.jsx("input",{type:"number",min:"2",max:"120",value:h.total_parcelas,onChange:M=>p({...h,total_parcelas:M.target.value}),onBlur:N,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Intervalo (dias)"}),e.jsxs("select",{value:C,onChange:M=>{y(parseInt(M.target.value)),setTimeout(N,100)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"7",children:"7 dias (semanal)"}),e.jsx("option",{value:"14",children:"14 dias (quinzenal)"}),e.jsx("option",{value:"15",children:"15 dias"}),e.jsx("option",{value:"21",children:"21 dias"}),e.jsx("option",{value:"30",children:"30 dias (mensal)"}),e.jsx("option",{value:"60",children:"60 dias (bimestral)"}),e.jsx("option",{value:"90",children:"90 dias (trimestral)"})]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:N,className:"mt-6 w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"ðŸ“‹ Gerar Preview"})})]}),d.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-3",children:"ðŸ“… Preview das Parcelas"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:d.map((M,Z)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white rounded border",children:[e.jsxs("span",{className:"font-semibold text-gray-600 min-w-[80px]",children:["Parcela ",M.numero,"/",d.length]}),e.jsx("input",{type:"number",step:"0.01",value:M.valor,onChange:$=>A(Z,$.target.value),className:"w-32 px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Valor"}),e.jsx("input",{type:"date",value:M.data_vencimento,onChange:$=>D(Z,$.target.value),className:"flex-1 px-2 py-1 border border-gray-300 rounded text-sm"})]},Z))}),e.jsx("div",{className:"mt-3 p-2 bg-gray-100 rounded",children:e.jsxs("strong",{children:["Total: R$ ",d.reduce((M,Z)=>M+Z.valor,0).toFixed(2)]})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ObservaÃ§Ãµes"}),e.jsx("textarea",{value:h.observacoes,onChange:M=>p({...h,observacoes:M.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"InformaÃ§Ãµes adicionais..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{t(),re()},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:o,className:"px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50",children:o?"Salvando...":"Salvar Conta"})]})]})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Nova Categoria Financeira"}),e.jsx("button",{type:"button",onClick:()=>f(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(pa,{size:24})})]}),e.jsxs("form",{onSubmit:te,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Categoria *"}),e.jsx("input",{type:"text",value:b.nome,onChange:M=>u({...b,nome:M.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0,placeholder:"Ex: Fornecedores, Aluguel, SalÃ¡rios..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ãcone"}),e.jsx("select",{value:b.icone,onChange:M=>u({...b,icone:M.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:["ðŸ’¸","ðŸ ","âš¡","ðŸ’§","ðŸ‘¥","ðŸ“¦","ðŸ”§","ðŸš—","ðŸ½ï¸","ðŸ“","ðŸ›¡ï¸","ðŸ›’"].map(M=>e.jsx("option",{value:M,children:M},M))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor"}),e.jsx("input",{type:"color",value:b.cor,onChange:M=>u({...b,cor:M.target.value}),className:"w-full h-10 border border-gray-300 rounded-md"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:b.descricao,onChange:M=>u({...b,descricao:M.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",rows:"2"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subcategorias DRE (opcional)"}),e.jsxs("button",{type:"button",onClick:w,className:"text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[e.jsx(us,{size:14})," Adicionar"]})]}),b.novasSubcategorias.length>0&&e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:b.novasSubcategorias.map((M,Z)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-md",children:[e.jsx("input",{type:"text",value:M.nome,onChange:$=>S(Z,"nome",$.target.value),onKeyDown:$=>W($,Z),placeholder:"Nome (Tab para adicionar mais)",className:"flex-1 px-2 py-1 border border-gray-300 rounded-md text-sm"}),e.jsx("button",{type:"button",onClick:()=>P(Z),className:"text-red-600 hover:text-red-800 p-1",children:e.jsx(pa,{size:16})})]},Z))}),b.novasSubcategorias.length===0&&e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Aperte Tab no Ãºltimo campo para adicionar mais subcategorias"})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Criar Categoria"})]})]})]})})]}):null},ka=a=>Array.isArray(a)?a:[],rm=()=>{var B;const a=va(),[t,s]=n.useState([]),[o,r]=n.useState(!0),[i,l]=n.useState({status:"todos",fornecedor_id:null,data_inicio:"",data_fim:"",apenas_vencidas:!1,apenas_vencer:!1,numero_nf:""}),[x,j]=n.useState([]),[g,v]=n.useState(null),[d,m]=n.useState(!1),[C,y]=n.useState(!1),[c,f]=n.useState(!1),[b,u]=n.useState([]),[h,p]=n.useState([]),[k,N]=n.useState(!1),[w,S]=n.useState({nome:"",tipo:"dinheiro",conta_bancaria_destino_id:null}),[P,W]=n.useState({valor_pago:0,data_pagamento:new Date().toISOString().split("T")[0],forma_pagamento_id:"",conta_bancaria_id:"",valor_juros:0,valor_multa:0,valor_desconto:0,observacoes:""});n.useEffect(()=>{te()},[]);const te=async()=>{try{const[_,O,q,ae]=await Promise.all([F.get(`/contas-pagar/?_t=${Date.now()}`),F.get("/clientes/?tipo_cadastro=fornecedor"),F.get("/financeiro/formas-pagamento/"),F.get("/contas-bancarias?apenas_ativas=true")]);s(ka(_.data)),j(ka(O.data)),u(ka(q.data)),p(ka(ae.data))}catch(_){console.error("Erro ao carregar dados:",_),ce.error("Erro ao carregar contas a pagar")}finally{r(!1)}},D=async()=>{try{r(!0);const _=new URLSearchParams;i.status!=="todos"&&_.append("status",i.status),i.fornecedor_id&&_.append("fornecedor_id",i.fornecedor_id),i.data_inicio&&_.append("data_inicio",i.data_inicio),i.data_fim&&_.append("data_fim",i.data_fim),i.apenas_vencidas&&_.append("apenas_vencidas","true"),i.apenas_vencer&&_.append("apenas_vencer","true"),i.numero_nf&&_.append("numero_nf",i.numero_nf);const O=await F.get(`/contas-pagar/?${_}`);s(O.data)}catch(_){console.error("Erro ao filtrar:",_),ce.error("Erro ao aplicar filtros")}finally{r(!1)}},A=_=>{v(_);const O=b.find(q=>q.id===_.forma_pagamento_id);W({valor_pago:_.valor_final-_.valor_pago,forma_pagamento_id:_.forma_pagamento_id||"",conta_bancaria_id:(O==null?void 0:O.conta_bancaria_destino_id)||"",valor_juros:0,valor_multa:0,valor_desconto:0,observacoes:""}),m(!0)},X=_=>{v(_),f(!0)},re=_=>{_.nota_entrada_id?a(`/compras?nota_id=${_.nota_entrada_id}`):_.nfe_numero?a(`/compras?numero=${_.nfe_numero}`):ce.error("Nota fiscal nÃ£o encontrada")},M=_=>{const O=new URLSearchParams;_.fornecedor_nome&&O.append("busca",_.fornecedor_nome),_.documento&&O.append("documento",_.documento),a(`/financeiro/fluxo-caixa?${O.toString()}`),ce.success("Redirecionando para o Fluxo de Caixa...")},Z=_=>{const O=b.find(q=>q.id===parseInt(_));W({...P,forma_pagamento_id:parseInt(_)||"",conta_bancaria_id:(O==null?void 0:O.conta_bancaria_destino_id)||P.conta_bancaria_id||""})},$=async()=>{try{await F.post("/financeiro/formas-pagamento",{...w,taxa_percentual:0,taxa_fixa:0,prazo_dias:0,ativo:!0,permite_parcelamento:!1,parcelas_maximas:1}),ce.success("Forma de pagamento criada!"),N(!1),S({nome:"",tipo:"dinheiro",conta_bancaria_destino_id:null}),te()}catch(_){console.error("Erro:",_),ce.error("Erro ao criar forma de pagamento")}},J=async()=>{var _,O;try{await F.post(`/contas-pagar/${g.id}/pagar`,P),ce.success("Pagamento registrado com sucesso!"),m(!1),te()}catch(q){console.error("Erro ao registrar pagamento:",q),ce.error(((O=(_=q.response)==null?void 0:_.data)==null?void 0:O.detail)||"Erro ao registrar pagamento")}},E=_=>{if(!_)return"-";const O=_.split("T")[0].split("-");return new Date(parseInt(O[0]),parseInt(O[1])-1,parseInt(O[2])).toLocaleDateString("pt-BR")},R=_=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(_),K=_=>{const O=new Date,q=new Date(_.data_vencimento);return _.status==="pago"?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-green-100 text-green-800",children:"âœ“ Pago"}):q<O?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-red-100 text-red-800",children:"âš  Vencida"}):_.status==="parcial"?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-yellow-100 text-yellow-800",children:"âš¡ Parcial"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-blue-100 text-blue-800",children:"â± Pendente"})};return o?e.jsx("div",{className:"text-center p-8",children:"Carregando contas a pagar..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"ðŸ’° Contas a Pagar"}),e.jsx("button",{onClick:()=>y(!0),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg",children:"âž• Nova Conta"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:[e.jsx("h5",{className:"text-lg font-semibold mb-4",children:"ðŸ” Filtros"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:i.status,onChange:_=>l({...i,status:_.target.value}),children:[e.jsx("option",{value:"todos",children:"Todos"}),e.jsx("option",{value:"pendente",children:"Pendente"}),e.jsx("option",{value:"parcial",children:"Parcial"}),e.jsx("option",{value:"pago",children:"Pago"}),e.jsx("option",{value:"vencido",children:"Vencido"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fornecedor"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:i.fornecedor_id||"",onChange:_=>l({...i,fornecedor_id:_.target.value||null}),children:[e.jsx("option",{value:"",children:"Todos"}),ka(x).map(_=>e.jsx("option",{value:_.id,children:_.nome},_.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"NÃºmero NF"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",placeholder:"Ex: 12345",value:i.numero_nf,onChange:_=>l({...i,numero_nf:_.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:i.data_inicio,onChange:_=>l({...i,data_inicio:_.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:i.data_fim,onChange:_=>l({...i,data_fim:_.target.value})})]}),e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:i.apenas_vencidas,onChange:_=>l({...i,apenas_vencidas:_.target.checked,apenas_vencer:!1})}),e.jsx("span",{className:"text-sm",children:"SÃ³ Vencidas"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:i.apenas_vencer,onChange:_=>l({...i,apenas_vencer:_.target.checked,apenas_vencidas:!1})}),e.jsx("span",{className:"text-sm",children:"A Vencer"})]}),e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm",onClick:D,children:"Filtrar"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"DescriÃ§Ã£o"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Fornecedor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Vencimento"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Valor Original"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Valor Pago"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Saldo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"px-4 py-8 text-center text-gray-500",children:"Nenhuma conta encontrada"})}):ka(t).map(_=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:_.id}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[_.descricao,_.eh_parcelado&&e.jsxs("span",{className:"ml-2 px-2 py-1 text-xs rounded bg-gray-100 text-gray-700",children:[_.numero_parcela,"/",_.total_parcelas]})]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:_.fornecedor_nome||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:E(_.data_vencimento)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:R(_.valor_original)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:R(_.valor_pago)}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold",children:R(_.valor_final-_.valor_pago)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:K(_)}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[_.status!=="pago"&&e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>A(_),title:"Registrar Pagamento",children:"ðŸ’° Pagar"}),e.jsx("button",{className:"bg-blue-50 hover:bg-blue-100 text-blue-600 px-3 py-1 rounded text-xs",onClick:()=>X(_),title:"Ver Detalhes",children:"ðŸ‘ï¸"})]})]},_.id))})]})}),t.length>0&&e.jsxs("div",{className:"bg-green-50 border-t border-green-200 px-4 py-3",children:[e.jsx("strong",{children:"Total:"})," ",t.length," conta(s) |",e.jsx("strong",{className:"ml-3",children:"Saldo a Pagar:"})," ",R(t.reduce((_,O)=>_+(O.valor_final-O.valor_pago),0))]})]}),d&&g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b p-4",children:[e.jsx("h5",{className:"text-xl font-bold",children:"ðŸ’° Registrar Pagamento"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 text-2xl",onClick:()=>m(!1),children:"Ã—"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mb-4 text-sm",children:[e.jsx("strong",{children:"Conta:"})," ",g.descricao,e.jsx("br",{}),e.jsx("strong",{children:"Valor Total:"})," ",R(g.valor_final),e.jsx("br",{}),e.jsx("strong",{children:"JÃ¡ Pago:"})," ",R(g.valor_pago),e.jsx("br",{}),e.jsx("strong",{children:"Saldo Restante:"})," ",R(g.valor_final-g.valor_pago)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Valor a Pagar *"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:P.valor_pago,onChange:_=>W({...P,valor_pago:parseFloat(_.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data do Pagamento *"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:P.data_pagamento,onChange:_=>W({...P,data_pagamento:_.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Forma de Pagamento"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"flex-1 border border-gray-300 rounded px-3 py-2",value:P.forma_pagamento_id||"",onChange:_=>Z(_.target.value),children:[e.jsx("option",{value:"",children:"Selecione..."}),ka(b).map(_=>e.jsxs("option",{value:_.id,children:[_.icone||"ðŸ’³"," ",_.nome]},_.id))]}),e.jsx("button",{type:"button",className:"px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:()=>N(!0),title:"Adicionar nova forma de pagamento",children:"+"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Conta BancÃ¡ria *",P.forma_pagamento_id&&((B=b.find(_=>_.id===P.forma_pagamento_id))==null?void 0:B.conta_bancaria_destino_id)&&e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(PadrÃ£o da forma selecionada)"})]}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:P.conta_bancaria_id||"",onChange:_=>W({...P,conta_bancaria_id:parseInt(_.target.value)||null}),children:[e.jsx("option",{value:"",children:"Selecione a conta..."}),ka(h).map(_=>e.jsxs("option",{value:_.id,children:[_.nome," - ",R(_.saldo_atual||0)]},_.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Juros"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:P.valor_juros,onChange:_=>W({...P,valor_juros:parseFloat(_.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Multa"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:P.valor_multa,onChange:_=>W({...P,valor_multa:parseFloat(_.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Desconto"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:P.valor_desconto,onChange:_=>W({...P,valor_desconto:parseFloat(_.target.value)||0})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"ObservaÃ§Ãµes"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded px-3 py-2",rows:"3",value:P.observacoes,onChange:_=>W({...P,observacoes:_.target.value})})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded p-3 mt-4",children:[e.jsx("strong",{children:"Valor Final do Pagamento:"})," ",R((P.valor_pago||0)+(P.valor_juros||0)+(P.valor_multa||0)-(P.valor_desconto||0))]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t p-4",children:[e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",onClick:()=>m(!1),children:"Cancelar"}),e.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:J,children:"âœ“ Confirmar Pagamento"})]})]})}),c&&g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-6 py-4 flex justify-between items-center sticky top-0",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Detalhes da Conta"}),e.jsx("button",{onClick:()=>f(!1),className:"text-white hover:bg-blue-700 px-3 py-1 rounded",children:"âœ•"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Parcela"}),e.jsx("p",{className:"mt-1 text-lg",children:g.numero_parcela&&g.total_parcelas?`${g.numero_parcela}/${g.total_parcelas}`:g.documento||"Ãšnica"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Fornecedor"}),e.jsx("p",{className:"mt-1 text-lg",children:g.fornecedor_nome||"N/A"})]})]}),g.nfe_numero&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nota Fiscal"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>re(g),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg border border-blue-200 transition-colors",children:[e.jsx("span",{className:"text-xl",children:"ðŸ“„"}),e.jsx("span",{className:"font-medium",children:g.nfe_numero})]}),e.jsxs("button",{onClick:()=>M(g),className:"flex items-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg border border-green-200 transition-colors",title:"Ver no Fluxo de Caixa",children:[e.jsx("span",{className:"text-xl",children:"ðŸ“ˆ"}),e.jsx("span",{className:"text-sm",children:"Fluxo"})]})]})]}),!g.nfe_numero&&e.jsx("div",{children:e.jsxs("button",{onClick:()=>M(g),className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg border border-green-200 transition-colors",children:[e.jsx("span",{className:"text-xl",children:"ðŸ“ˆ"}),e.jsx("span",{className:"font-medium",children:"Ver no Fluxo de Caixa"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Data de EmissÃ£o"}),e.jsx("p",{className:"mt-1",children:E(g.data_emissao)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Data de Vencimento"}),e.jsx("p",{className:"mt-1",children:E(g.data_vencimento)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor Original"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-blue-600",children:R(g.valor_final||g.valor_total||0)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor Pago"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-green-600",children:R(g.valor_pago||0)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Saldo Restante"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-red-600",children:R((g.valor_final||g.valor_total||0)-(g.valor_pago||0))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsx("p",{className:"mt-1",children:e.jsx("span",{className:`px-2 py-1 rounded text-sm ${g.status==="pago"?"bg-green-100 text-green-800":g.status==="parcial"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:g.status==="pago"?"Pago":g.status==="parcial"?"Parcial":"Pendente"})})]})]}),g.observacoes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"ObservaÃ§Ãµes"}),e.jsx("p",{className:"mt-1 text-gray-600",children:g.observacoes})]})]})]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"bg-green-600 text-white px-6 py-4 flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Nova Forma de Pagamento"}),e.jsx("button",{onClick:()=>N(!1),className:"text-white hover:bg-green-700 px-3 py-1 rounded",children:"âœ•"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nome *"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",value:w.nome,onChange:_=>S({...w,nome:_.target.value}),placeholder:"Ex: PIX Santander, Dinheiro..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipo"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:w.tipo,onChange:_=>S({...w,tipo:_.target.value}),children:[e.jsx("option",{value:"dinheiro",children:"ðŸ’µ Dinheiro"}),e.jsx("option",{value:"pix",children:"ðŸ“± PIX"}),e.jsx("option",{value:"cartao_debito",children:"ðŸ’³ CartÃ£o DÃ©bito"}),e.jsx("option",{value:"cartao_credito",children:"ðŸ’³ CartÃ£o CrÃ©dito"}),e.jsx("option",{value:"transferencia",children:"ðŸ¦ TransferÃªncia"}),e.jsx("option",{value:"boleto",children:"ðŸ“„ Boleto"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Conta BancÃ¡ria PadrÃ£o"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:w.conta_bancaria_destino_id||"",onChange:_=>S({...w,conta_bancaria_destino_id:parseInt(_.target.value)||null}),children:[e.jsx("option",{value:"",children:"Nenhuma (selecionar manualmente)"}),ka(h).map(_=>e.jsx("option",{value:_.id,children:_.nome},_.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Esta conta serÃ¡ prÃ©-selecionada automaticamente ao usar esta forma"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t p-4",children:[e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",onClick:()=>N(!1),children:"Cancelar"}),e.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:$,children:"âœ“ Criar"})]})]})}),e.jsx(tm,{isOpen:C,onClose:()=>y(!1),onSave:te})]})},om=()=>{var B;const a=va(),[t,s]=n.useState([]),[o,r]=n.useState(!0),[i,l]=n.useState({status:"todos",cliente_id:null,data_inicio:"",data_fim:"",apenas_vencidas:!1,apenas_vencer:!1}),[x,j]=n.useState(""),[g,v]=n.useState("desc"),[d,m]=n.useState([]),[C,y]=n.useState(null),[c,f]=n.useState(null),[b,u]=n.useState(!1),[h,p]=n.useState(!1),[k,N]=n.useState([]),[w,S]=n.useState([]),[P,W]=n.useState({valor_recebido:0,data_recebimento:new Date().toISOString().split("T")[0],forma_pagamento_id:null,conta_bancaria_id:null,valor_juros:0,valor_multa:0,valor_desconto:0,observacoes:""});n.useEffect(()=>{te()},[]),n.useEffect(()=>{if(x.trim().length>0){const _=setTimeout(()=>{D()},500);return()=>clearTimeout(_)}else x===""&&te()},[x]);const te=async()=>{try{const O={Authorization:`Bearer ${localStorage.getItem("access_token")||localStorage.getItem("token")}`},[q,ae,H,le]=await Promise.all([F.get("/contas-receber/",{headers:O}),F.get("/clientes/",{headers:O}),F.get("/financeiro/formas-pagamento/",{headers:O}),F.get("/contas-bancarias?apenas_ativas=true",{headers:O})]);console.log("Ã°Å¸â€œÅ  Contas carregadas:",q.data.length,"contas"),console.log("Ã°Å¸â€œâ€¹ Status das contas:",ka(q.data).map(ee=>({id:ee.id,status:ee.status,descricao:ee.descricao}))),console.log("Ã°Å¸â€Â¢ Todas as vendas nos contas:",ka(q.data).map(ee=>ee.numero_venda).filter(ee=>ee)),console.log("Ã°Å¸Å½Â¯ Procurando venda 202601100007:",q.data.find(ee=>{var de;return ee.numero_venda==="202601100007"||((de=ee.descricao)==null?void 0:de.includes("202601100007"))})),console.log("Ã°Å¸â€œÂ¦ Antes de setContas:",q.data);const G=[...ka(q.data)].sort((ee,de)=>de.id-ee.id);s(G),console.log("Ã¢Å“â€¦ Contas setadas no estado"),m(ka(ae.data)),m(ka(ae.data)),N(ka(H.data)),S(ka(le.data))}catch(_){console.error("Erro ao carregar dados:",_),ce.error("Erro ao carregar contas a receber")}finally{r(!1)}},D=async()=>{try{r(!0);const _=new URLSearchParams;i.status!=="todos"&&_.append("status",i.status),i.cliente_id&&_.append("cliente_id",i.cliente_id),i.data_inicio&&_.append("data_inicio",i.data_inicio),i.data_fim&&_.append("data_fim",i.data_fim),i.apenas_vencidas&&_.append("apenas_vencidas","true"),i.apenas_vencer&&_.append("apenas_vencer","true"),x&&_.append("numero_venda",x);const O=await F.get(`/contas-receber/?${_}`);s(O.data)}catch(_){console.error("Erro ao filtrar:",_),ce.error("Erro ao aplicar filtros")}finally{r(!1)}},A=_=>{sessionStorage.setItem("abrirVenda",_),sessionStorage.setItem("abrirModalPagamento","true"),ce.success("Redirecionando para o PDV..."),a("/pdv")},X=_=>{const O=new URLSearchParams;_.cliente_nome&&O.append("busca",_.cliente_nome),_.documento&&O.append("documento",_.documento),a(`/financeiro/fluxo-caixa?${O.toString()}`),ce.success("Redirecionando para o Fluxo de Caixa...")},re=()=>{const _=g==="desc"?"asc":"desc";v(_);const O=[...t].sort((q,ae)=>_==="desc"?ae.id-q.id:q.id-ae.id);s(O),ce.success(_==="desc"?"Ã°Å¸â€œâ€¦ Ordenado: Mais recentes primeiro":"Ã°Å¸â€œâ€¦ Ordenado: Mais antigas primeiro")},M=_=>{y(_),W({valor_recebido:parseFloat((_.valor_final-_.valor_recebido).toFixed(2)),data_recebimento:new Date().toISOString().split("T")[0],forma_pagamento_id:_.forma_pagamento_id||null,conta_bancaria_id:null,valor_juros:0,valor_multa:0,valor_desconto:0,observacoes:""}),u(!0)},Z=async _=>{try{const O=await F.get(`/contas-receber/${_.id}`);y(_),f(O.data),p(!0)}catch(O){console.error("Erro ao carregar detalhes:",O),ce.error("Erro ao carregar detalhes da conta")}},$=_=>{a(`/pdv?venda=${_}`)},J=async()=>{var _,O;try{await F.post(`/contas-receber/${C.id}/receber`,P),ce.success("Recebimento registrado com sucesso!"),u(!1),te()}catch(q){console.error("Erro ao registrar recebimento:",q),ce.error(((O=(_=q.response)==null?void 0:_.data)==null?void 0:O.detail)||"Erro ao registrar recebimento")}},E=_=>{if(!_)return"-";const O=_.split("T")[0].split("-");return new Date(parseInt(O[0]),parseInt(O[1])-1,parseInt(O[2])).toLocaleDateString("pt-BR")},R=_=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(_),K=_=>{const O=new Date,q=new Date(_.data_vencimento);return _.status==="recebido"?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-green-100 text-green-800",children:"Ã¢Å“â€œ Recebido"}):q<O?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-red-100 text-red-800",children:"Ã¢Å¡Â  Vencida"}):_.status==="parcial"?e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-yellow-100 text-yellow-800",children:"Ã¢Å¡Â¡ Parcial"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-blue-100 text-blue-800",children:"Ã¢ÂÂ± Pendente"})};return o?e.jsx("div",{className:"text-center p-8",children:"Carregando contas a receber..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Ã°Å¸â€™Âµ Contas a Receber"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:re,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2",title:g==="desc"?"Clique para ver mais antigas primeiro":"Clique para ver mais recentes primeiro",children:g==="desc"?"Ã°Å¸â€Â½ Mais Recentes":"Ã°Å¸â€Â¼ Mais Antigas"}),e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg",children:"Ã¢Å¾â€¢ Nova Conta"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:[e.jsx("h5",{className:"text-lg font-semibold mb-4",children:"Ã°Å¸â€Â Filtros"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ã°Å¸â€Â¢ Buscar por NÃƒÂºmero da Venda"}),e.jsx("input",{type:"text",placeholder:"Digite o nÃƒÂºmero da venda (ex: 202601100003) e pressione Enter",className:"w-full border border-gray-300 rounded px-3 py-2",value:x,onChange:_=>{const O=_.target.value.replace("#","");j(O)},onKeyPress:_=>{_.key==="Enter"&&D()}})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:i.status,onChange:_=>l({...i,status:_.target.value}),children:[e.jsx("option",{value:"todos",children:"Todos"}),e.jsx("option",{value:"pendente",children:"Pendente"}),e.jsx("option",{value:"parcial",children:"Parcial"}),e.jsx("option",{value:"recebido",children:"Recebido"}),e.jsx("option",{value:"vencido",children:"Vencido"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Cliente"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:i.cliente_id||"",onChange:_=>l({...i,cliente_id:_.target.value||null}),children:[e.jsx("option",{value:"",children:"Todos"}),ka(d).map(_=>e.jsx("option",{value:_.id,children:_.nome},_.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data InÃƒÂ­cio"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:i.data_inicio,onChange:_=>l({...i,data_inicio:_.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:i.data_fim,onChange:_=>l({...i,data_fim:_.target.value})})]}),e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:i.apenas_vencidas,onChange:_=>l({...i,apenas_vencidas:_.target.checked,apenas_vencer:!1})}),e.jsx("span",{className:"text-sm",children:"SÃƒÂ³ Vencidas"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:i.apenas_vencer,onChange:_=>l({...i,apenas_vencer:_.target.checked,apenas_vencidas:!1})}),e.jsx("span",{className:"text-sm",children:"A Vencer"})]}),e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm",onClick:D,children:"Filtrar"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"DescriÃƒÂ§ÃƒÂ£o"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Vencimento"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Valor Original"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Valor Recebido"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Saldo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"AÃƒÂ§ÃƒÂµes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:ka(t).length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"px-4 py-8 text-center text-gray-500",children:"Nenhuma conta encontrada"})}):ka(t).filter(_=>{if(!x)return!0;const O=String(_.numero_venda||""),q=String(_.descricao||""),ae=x.toLowerCase();return O.toLowerCase().includes(ae)||q.toLowerCase().includes(ae)}).map(_=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:_.id}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[_.descricao,_.eh_parcelado&&e.jsxs("span",{className:"ml-2 px-2 py-1 text-xs rounded bg-gray-100 text-gray-700",children:[_.numero_parcela,"/",_.total_parcelas]})]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:_.cliente_nome||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:E(_.data_vencimento)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:R(_.valor_original)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:R(_.valor_recebido)}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold",children:R(_.valor_final-_.valor_recebido)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:K(_)}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[_.status!=="recebido"&&e.jsx(e.Fragment,{children:_.nsu&&!_.conciliado?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>a(`/conciliacao-cartao?nsu=${_.nsu}`),title:`Conciliar NSU ${_.nsu} com extrato da operadora`,children:"Ã°Å¸â€â€ž Conciliar"}),e.jsx("button",{className:"bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>M(_),title:"Receber manual (caso nÃƒÂ£o consiga conciliar)",children:"Ã°Å¸â€™Â³ Manual"})]}):_.venda_id&&!_.nsu?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>{console.log("Conta:",_),_.venda_id?A(_.venda_id):M(_)},title:"Receber no PDV (movimenta caixa)",children:"Ã°Å¸â€™Âµ PDV"}),e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>M(_),title:"Receber manual (sem PDV)",children:"Ã°Å¸â€™Â° Manual"})]}):e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs mr-2",onClick:()=>M(_),title:"Registrar recebimento manual",children:"Ã°Å¸â€™Â° Receber Manual"})}),_.conciliado&&e.jsx("span",{className:"text-xs text-green-600 font-semibold mr-2",title:`Conciliado em ${_.data_conciliacao}`,children:"Ã¢Å“â€œ Conciliado"}),e.jsx("button",{className:"bg-blue-50 hover:bg-blue-100 text-blue-600 px-3 py-1 rounded text-xs",title:"Ver Detalhes",onClick:()=>Z(_),children:"Ã°Å¸â€˜ÂÃ¯Â¸Â"})]})]},_.id))})]})}),t.length>0&&e.jsxs("div",{className:"bg-green-50 border-t border-green-200 px-4 py-3",children:[e.jsx("strong",{children:"Total:"})," ",t.length," conta(s) |",e.jsx("strong",{className:"ml-3",children:"Saldo a Receber:"})," ",R(t.reduce((_,O)=>_+(O.valor_final-O.valor_recebido),0))]})]}),b&&C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b p-4",children:[e.jsx("h5",{className:"text-xl font-bold",children:"Ã°Å¸â€™Â° Registrar Recebimento"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 text-2xl",onClick:()=>u(!1),children:"Ãƒâ€”"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mb-4 text-sm",children:[e.jsx("strong",{children:"Conta:"})," ",C.descricao,e.jsx("br",{}),e.jsx("strong",{children:"Valor Total:"})," ",R(C.valor_final),e.jsx("br",{}),e.jsx("strong",{children:"JÃƒÂ¡ Recebido:"})," ",R(C.valor_recebido),e.jsx("br",{}),e.jsx("strong",{children:"Saldo Restante:"})," ",R(C.valor_final-C.valor_recebido)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Valor a Receber *"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:P.valor_recebido,onChange:_=>W({...P,valor_recebido:parseFloat(_.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data do Recebimento *"}),e.jsx("input",{type:"date",className:"w-full border border-gray-300 rounded px-3 py-2",value:P.data_recebimento,onChange:_=>W({...P,data_recebimento:_.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Forma de Pagamento"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:P.forma_pagamento_id||"",onChange:_=>W({...P,forma_pagamento_id:parseInt(_.target.value)||null}),children:[e.jsx("option",{value:"",children:"Selecione..."}),ka(k).map(_=>e.jsx("option",{value:_.id,children:_.nome},_.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Conta BancÃƒÂ¡ria *"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:P.conta_bancaria_id||"",onChange:_=>W({...P,conta_bancaria_id:parseInt(_.target.value)||null}),children:[e.jsx("option",{value:"",children:"Selecione a conta..."}),ka(w).map(_=>e.jsxs("option",{value:_.id,children:[_.nome," - ",R(_.saldo_atual||0)]},_.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Juros"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:P.valor_juros,onChange:_=>W({...P,valor_juros:parseFloat(_.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Multa"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:P.valor_multa,onChange:_=>W({...P,valor_multa:parseFloat(_.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Desconto"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:P.valor_desconto,onChange:_=>W({...P,valor_desconto:parseFloat(_.target.value)||0})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"ObservaÃƒÂ§ÃƒÂµes"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded px-3 py-2",rows:"3",value:P.observacoes,onChange:_=>W({...P,observacoes:_.target.value})})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded p-3 mt-4",children:[e.jsx("strong",{children:"Valor Final do Recebimento:"})," ",R((P.valor_recebido||0)+(P.valor_juros||0)+(P.valor_multa||0)-(P.valor_desconto||0))]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t p-4",children:[e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",onClick:()=>u(!1),children:"Cancelar"}),e.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:J,children:"Ã¢Å“â€œ Confirmar Recebimento"})]})]})}),h&&C&&c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-6 py-4 flex justify-between items-center sticky top-0",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Detalhes da Conta"}),e.jsx("button",{onClick:()=>p(!1),className:"text-white hover:bg-blue-700 px-3 py-1 rounded",children:"Ã¢Å“â€¢"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"NÃƒÂºmero da Conta"}),e.jsx("p",{className:"mt-1 text-lg",children:C.numero_documento||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Cliente"}),e.jsx("p",{className:"mt-1 text-lg",children:((B=c.cliente)==null?void 0:B.nome)||"N/A"})]})]}),c.venda&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pedido/Venda"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>$(c.venda.id),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg border border-blue-200 transition-colors",children:[e.jsx("span",{className:"text-xl",children:"Ã°Å¸â€ºâ€™"}),e.jsx("span",{className:"font-semibold",children:c.venda.numero_venda})]}),e.jsxs("button",{onClick:()=>X(C),className:"flex items-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg border border-green-200 transition-colors",title:"Ver no Fluxo de Caixa",children:[e.jsx("span",{className:"text-xl",children:"Ã°Å¸â€œË†"}),e.jsx("span",{className:"text-sm",children:"Fluxo"})]})]})]}),!c.venda&&e.jsx("div",{children:e.jsxs("button",{onClick:()=>X(C),className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg border border-green-200 transition-colors",children:[e.jsx("span",{className:"text-xl",children:"Ã°Å¸â€œË†"}),e.jsx("span",{className:"font-medium",children:"Ver no Fluxo de Caixa"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Data de EmissÃƒÂ£o"}),e.jsx("p",{className:"mt-1",children:E(c.datas.emissao)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Data de Vencimento"}),e.jsx("p",{className:"mt-1",children:E(c.datas.vencimento)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor Original"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-blue-600",children:R(c.valores.final)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor Recebido"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-green-600",children:R(c.valores.recebido)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Saldo Restante"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-red-600",children:R(c.valores.saldo)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsx("p",{className:"mt-1",children:e.jsx("span",{className:`px-2 py-1 rounded text-sm ${c.status==="recebido"?"bg-green-100 text-green-800":c.status==="parcial"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:c.status==="recebido"?"Ã¢Å“â€œ Recebido":c.status==="parcial"?"Ã¢Å¡Â¡ Parcial":"Ã¢ÂÂ± Pendente"})})]})]}),c.recebimentos&&c.recebimentos.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ã°Å¸â€™Â° HistÃƒÂ³rico de Recebimentos"}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700",children:"Data"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700",children:"Valor"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-700",children:"Conta BancÃƒÂ¡ria"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:ka(c==null?void 0:c.recebimentos).map((_,O)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2 text-sm",children:E(_.data)}),e.jsx("td",{className:"px-3 py-2 text-sm font-semibold text-green-600",children:R(_.valor)}),e.jsx("td",{className:"px-3 py-2 text-sm",children:_.conta_bancaria_nome?e.jsxs("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs",children:["Ã°Å¸ÂÂ¦ ",_.conta_bancaria_nome]}):e.jsx("span",{className:"text-gray-400 text-xs",children:"NÃƒÂ£o informada"})})]},O))})]})})]}),c.observacoes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"ObservaÃƒÂ§ÃƒÂµes"}),e.jsx("p",{className:"mt-1 text-gray-600",children:c.observacoes})]})]})]})})]})};function nm({onConcluida:a,status:t}){const s=va(),[o,r]=n.useState([]),[i,l]=n.useState([]),[x,j]=n.useState(!1),[g,v]=n.useState(null),[d,m]=n.useState(!1),[C,y]=n.useState(null),[c,f]=n.useState(!1),[b,u]=n.useState([]),[h,p]=n.useState([]),[k,N]=n.useState(!1),[w,S]=n.useState(!1),[P,W]=n.useState("pendentes"),[te,D]=n.useState([]),[A,X]=n.useState(null),[re,M]=n.useState(!0),[Z,$]=n.useState(1),[J,E]=n.useState(1);n.useEffect(()=>{(async()=>{try{if(!localStorage.getItem("access_token")){v("VocÃª precisa estar logado."),setTimeout(()=>s("/login"),2e3);return}const de=await F.get("/operadoras-cartao?apenas_ativas=true");D(de.data);const ue=de.data.find(Ae=>Ae.padrao);ue&&X(ue)}catch(ee){console.error("Erro ao carregar operadoras:",ee),v("Erro ao carregar operadoras")}finally{M(!1)}})()},[s]),n.useEffect(()=>{A&&(R(),B())},[Z,A,P]),n.useEffect(()=>{if(P==="conciliadas"&&o.length>0&&i.length>0){const G=[];o.forEach(ee=>{var we;const de=ee.pagamento||((we=ee.pagamentos)==null?void 0:we.find(Se=>Se.nsu||Se.nsu_cartao)),ue=(de==null?void 0:de.nsu)||(de==null?void 0:de.nsu_cartao)||ee.nsu;if(!ue)return;const Ae=i.find(Se=>Se.nsu===ue);if(!Ae)return;const se={...ee,numero:ee.numero||ee.numero_venda,nsu:ue,bandeira:de==null?void 0:de.bandeira,parcelas:de==null?void 0:de.parcelas,valor:(de==null?void 0:de.valor)??ee.total};G.push({venda_id:ee.id,status:"ok",venda_pdv:se,venda_stone:Ae})}),p(G)}else p([])},[P,o,i]),n.useEffect(()=>{const G=ee=>{ee.key==="Escape"&&w&&(S(!1),u([]),N(!1))};return window.addEventListener("keydown",G),()=>window.removeEventListener("keydown",G)},[w]),n.useEffect(()=>{A&&(B(),R())},[A]);const R=async()=>{try{if(j(!0),!localStorage.getItem("access_token")){v("VocÃª precisa estar logado."),setTimeout(()=>s("/login"),2e3);return}const ee=await F.get("/conciliacao/aba1/vendas-pdv",{params:{status:P,operadora_id:(A==null?void 0:A.id)==="legacy"?"legacy":A==null?void 0:A.id,page:Z,limit:50}});ee.data.success&&(r(ee.data.vendas),E(ee.data.total_pages))}catch(G){console.error("Erro ao carregar vendas PDV:",G),v("Erro ao carregar vendas do PDV")}finally{j(!1)}},K=async G=>{var Ae,se;const ee=G.target.files[0];if(!ee)return;if(!A){alert(`âš ï¸ Selecione uma operadora primeiro!

As vendas da planilha serÃ£o importadas com a tag da operadora selecionada.
Isso Ã© importante para o processo de conciliaÃ§Ã£o.`),G.target.value="";return}if(A.id==="legacy"){alert(`âš ï¸ Vendas Legacy nÃ£o tÃªm planilha!

Vendas sem operadora devem ter a operadora preenchida manualmente usando o botÃ£o "Preencher Operadora".`),G.target.value="";return}if(!window.confirm(`ðŸŽ¯ Confirmar Upload

Operadora selecionada: ${A.nome}

Todas as vendas da planilha "${ee.name}" serÃ£o marcadas com esta operadora.

Deseja continuar?`)){G.target.value="";return}y(ee),f(!0),v(null);const ue=new FormData;ue.append("arquivo",ee),ue.append("operadora_id",A.id);try{const we=await F.post("/conciliacao/aba1/upload-stone",ue,{headers:{"Content-Type":"multipart/form-data"}});we.data.success&&(await B(),await R(),alert(`âœ… Planilha importada com sucesso!

ðŸ“Š ${we.data.total_nsus||0} NSUs carregados
Operadora: ${A.nome}

Clique em "Processar Matches" para conciliar automaticamente.`),G.target.value="")}catch(we){console.error("Erro no upload:",we),v(((se=(Ae=we.response)==null?void 0:Ae.data)==null?void 0:se.detail)||"Erro ao importar planilha"),G.target.value=""}finally{f(!1)}},B=async()=>{if(A){if(A.id==="legacy"){l([]);return}try{const G=await F.get("/conciliacao/aba1/stone-nao-conciliadas",{params:{operadora_id:A.id,status:P}});G.data.success&&l(G.data.nsus)}catch(G){console.error("Erro ao carregar NSUs:",G)}}},_=async()=>{var G,ee;if(!A){alert("Selecione uma operadora primeiro!");return}f(!0),v(null);try{const de=await F.post("/conciliacao/aba1/processar-matches");de.data.success&&(u(de.data.matches||[]),S(!0),alert(`ðŸ” Matches encontrados!

ðŸ“Š Resumo:
â€¢ ${de.data.conferidas||0} vendas OK
â€¢ ${de.data.corrigidas||0} com divergÃªncias
â€¢ ${de.data.sem_nsu||0} sem NSU
â€¢ ${de.data.orfaos||0} NSUs Ã³rfÃ£os

ðŸ‘€ Visualize os matches abaixo e confirme para conciliar.`))}catch(de){console.error("Erro ao processar matches:",de),v(((ee=(G=de.response)==null?void 0:G.data)==null?void 0:ee.detail)||"Erro ao processar matches automÃ¡ticos")}finally{f(!1)}},O=async()=>{var ee,de;if(b.length===0)return;const G=b.filter(ue=>ue.status==="ok");if(G.length===0){alert(`âš ï¸ Nenhum match OK para confirmar!

Apenas matches perfeitos (sem divergÃªncias) podem ser conciliados.`);return}f(!0);try{const Ae=(await F.get("/conciliacao/aba1/stone-nao-conciliadas",{params:{operadora_id:A==null?void 0:A.id}})).data.importacao_id,se=await F.post("/conciliacao/aba1/confirmar-matches",{importacao_id:Ae,matches_confirmados:G});se.data.success&&(alert("âœ… "+se.data.message),u([]),S(!1),await R(),await B())}catch(ue){console.error("Erro ao confirmar matches:",ue),v(((de=(ee=ue.response)==null?void 0:ee.data)==null?void 0:de.detail)||"Erro ao confirmar matches")}finally{f(!1)}},q=async(G,ee)=>{var de,ue;try{const Ae=await F.put("/conciliacao/aba1/atualizar-operadora",{pagamento_id:G,operadora_id:ee});if(Ae.data.success)return await R(),alert(`Operadora atualizada para ${Ae.data.operadora_nome}`),!0}catch(Ae){return console.error("Erro ao atualizar operadora:",Ae),alert(((ue=(de=Ae.response)==null?void 0:de.data)==null?void 0:ue.detail)||"Erro ao atualizar operadora"),!1}},ae=({venda:G,expandir:ee})=>{var Qe;const[de,ue]=n.useState(d),[Ae,se]=n.useState(!1),[we,Se]=n.useState(""),[ea,Ie]=n.useState(!1),[Je,be]=n.useState(""),Fe=async()=>{var Ze,ma;if(!we||we.trim()===""){alert("Digite um NSU vÃ¡lido");return}try{(await F.patch(`/vendas/${G.id}/pagamento/${G.pagamento.id}/nsu`,{nsu_cartao:we.trim()})).data&&(se(!1),Se(""),await R(),alert("NSU atualizado com sucesso!"))}catch(oa){console.error("Erro ao salvar NSU:",oa),alert(((ma=(Ze=oa.response)==null?void 0:Ze.data)==null?void 0:ma.detail)||"Erro ao salvar NSU")}},he=async()=>{if(!Je||Je===""){alert("Selecione uma operadora");return}await q(G.pagamento.id,parseInt(Je))&&(Ie(!1),be(""))};return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 mb-2 hover:bg-gray-50 cursor-pointer",onClick:Ze=>{Ze.target.tagName==="INPUT"||Ze.target.tagName==="BUTTON"||d||ue(!de)},children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"font-medium text-gray-900",children:["Venda ",G.numero_venda]}),G.pagamento.operadora_id&&!ea?e.jsx("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded-full",children:((Qe=te.find(Ze=>Ze.id===G.pagamento.operadora_id))==null?void 0:Qe.nome)||"N/A"}):ea?e.jsxs("div",{className:"flex items-center gap-1",onClick:Ze=>Ze.stopPropagation(),children:[e.jsxs("select",{value:Je,onChange:Ze=>be(Ze.target.value),className:"border border-purple-300 rounded px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-purple-500",autoFocus:!0,children:[e.jsx("option",{value:"",children:"Selecione..."}),te.map(Ze=>e.jsx("option",{value:Ze.id,children:Ze.nome},Ze.id))]}),e.jsx("button",{onClick:he,className:"bg-green-500 text-white px-2 py-1 rounded text-xs hover:bg-green-600",children:"âœ“"}),e.jsx("button",{onClick:()=>{Ie(!1),be("")},className:"bg-gray-400 text-white px-2 py-1 rounded text-xs hover:bg-gray-500",children:"âœ—"})]}):e.jsx("button",{onClick:Ze=>{Ze.stopPropagation(),Ie(!0)},className:"text-xs text-purple-600 hover:text-purple-700 underline font-medium px-2 py-1 bg-purple-50 rounded",children:"ðŸ¢ Sem Operadora - Clique aqui"}),G.pagamento.nsu?e.jsxs("span",{className:"text-sm text-green-600",children:["NSU: ",G.pagamento.nsu]}):Ae?e.jsxs("div",{className:"flex items-center gap-1",onClick:Ze=>Ze.stopPropagation(),children:[e.jsx("input",{type:"text",value:we,onChange:Ze=>Se(Ze.target.value),placeholder:"Digite o NSU",className:"border border-orange-300 rounded px-2 py-1 text-xs w-32 focus:outline-none focus:ring-1 focus:ring-orange-500",autoFocus:!0}),e.jsx("button",{onClick:Fe,className:"bg-green-500 text-white px-2 py-1 rounded text-xs hover:bg-green-600",children:"âœ“"}),e.jsx("button",{onClick:()=>{se(!1),Se("")},className:"bg-gray-400 text-white px-2 py-1 rounded text-xs hover:bg-gray-500",children:"âœ—"})]}):e.jsx("button",{onClick:Ze=>{Ze.stopPropagation(),se(!0)},className:"text-sm text-orange-600 hover:text-orange-700 underline font-medium",children:"SEM NSU - Clique para preencher"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["R$ ",G.total.toFixed(2)]}),!d&&e.jsx("svg",{className:`h-4 w-4 text-gray-400 transition-transform ${de?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),(de||d)&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{children:new Date(G.data_venda).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tipo:"}),e.jsx("span",{className:"capitalize",children:G.pagamento.forma})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Operadora:"}),e.jsx("span",{className:"font-medium text-blue-600",children:(A==null?void 0:A.nome)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Bandeira:"}),e.jsx("span",{children:G.pagamento.bandeira||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Parcelas:"}),e.jsxs("span",{children:[G.pagamento.parcelas,"x"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",G.pagamento.valor.toFixed(2)]})]})]})]})},H=({nsu:G,expandir:ee})=>{var Ae,se,we;const[de,ue]=n.useState(d);return e.jsxs("div",{className:"border border-blue-200 rounded-lg p-3 mb-2 hover:bg-blue-50 cursor-pointer",onClick:()=>!d&&ue(!de),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("span",{className:"font-medium text-blue-900",children:["NSU: ",G.nsu]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["R$ ",(Ae=G.valor_liquido)==null?void 0:Ae.toFixed(2)]}),!d&&e.jsx("svg",{className:`h-4 w-4 text-gray-400 transition-transform ${de?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),(de||d)&&G.data_venda&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200 text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{children:new Date(G.data_venda).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Bandeira:"}),e.jsx("span",{children:G.bandeira})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Parcelas:"}),e.jsxs("span",{children:[G.parcelas,"x"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Bruto:"}),e.jsxs("span",{children:["R$ ",(se=G.valor_bruto)==null?void 0:se.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor LÃ­quido:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["R$ ",(we=G.valor_liquido)==null?void 0:we.toFixed(2)]})]})]})]})},le=({match:G,isConciliado:ee=!1})=>{var ue,Ae,se;const de={ok:"bg-green-50 border-green-300",divergencia:"bg-yellow-50 border-yellow-300",orfao:"bg-red-50 border-red-300",sem_nsu:"bg-orange-50 border-orange-300"};return e.jsxs("div",{className:`border-2 rounded-lg p-4 mb-3 ${de[G.status]} relative`,children:[ee&&e.jsx("div",{className:"absolute top-2 right-2 px-3 py-1 bg-green-600 text-white text-xs font-bold rounded-full",children:"âœ… CONCILIADO"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[e.jsx("div",{className:"bg-white p-3 rounded border",children:G.venda_pdv?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-800",children:["Venda #",G.venda_pdv.numero]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["NSU: ",G.venda_pdv.nsu||e.jsx("span",{className:"text-orange-600",children:"SEM NSU"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[G.venda_pdv.bandeira," - ",G.venda_pdv.parcelas,"x"]}),e.jsxs("div",{className:"text-xs font-semibold text-gray-800 mt-1",children:["R$ ",(ue=G.venda_pdv.valor)==null?void 0:ue.toFixed(2)]})]}):e.jsx("div",{className:"text-sm text-gray-400 italic",children:"Sem venda no PDV"})}),e.jsxs("div",{className:"flex items-center justify-center",children:[G.status==="ok"&&e.jsx("div",{className:"text-green-600 text-2xl",children:"âœ…"}),G.status==="divergencia"&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-yellow-600 text-xl",children:"âš ï¸"}),e.jsx("div",{className:"text-xs text-yellow-700 font-semibold mt-1",children:(Ae=G.divergencia)==null?void 0:Ae.tipo})]}),G.status==="orfao"&&e.jsx("div",{className:"text-red-600 text-2xl",children:"âŒ"}),G.status==="sem_nsu"&&e.jsx("div",{className:"text-orange-600 text-2xl",children:"âž¡ï¸"})]}),e.jsx("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:G.venda_stone?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-semibold text-blue-800",children:"Planilha Operadora"}),e.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:["NSU: ",G.venda_stone.nsu]}),e.jsxs("div",{className:"text-xs text-blue-600",children:[G.venda_stone.bandeira," - ",G.venda_stone.parcelas,"x"]}),e.jsxs("div",{className:"text-xs font-semibold text-blue-800 mt-1",children:["R$ ",(se=G.venda_stone.valor_bruto)==null?void 0:se.toFixed(2)]})]}):e.jsx("div",{className:"text-sm text-blue-300 italic",children:"Sem NSU na planilha"})})]}),G.divergencia&&e.jsx("div",{className:"mt-3 pt-3 border-t border-yellow-300",children:e.jsxs("div",{className:"text-xs text-yellow-800",children:[e.jsx("span",{className:"font-semibold",children:"PDV:"})," ",G.divergencia.pdv," â†’"," ",e.jsx("span",{className:"font-semibold",children:"Stone:"})," ",G.divergencia.stone]})})]})};return e.jsxs("div",{className:"flex flex-col h-full p-6 bg-gray-50",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"ConciliaÃ§Ã£o de Vendas - Stone"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Compare vendas do PDV com a planilha da operadora"})]}),e.jsxs("div",{className:"flex gap-4 mb-4 items-center bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1",children:"Exibir:"}),e.jsxs("select",{value:P,onChange:G=>W(G.target.value),className:"border border-gray-300 rounded px-3 py-2 text-sm min-w-[180px] focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"pendentes",children:"â³ Pendentes (NÃ£o Conciliadas)"}),e.jsx("option",{value:"todas",children:"ðŸ“‹ Todas as Vendas"}),e.jsx("option",{value:"conciliadas",children:"âœ… Conciliadas"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1",children:"Operadora de CartÃ£o:"}),e.jsxs("select",{value:(A==null?void 0:A.id)||"",onChange:G=>{const ee=G.target.value;if(ee==="legacy")X({id:"legacy",nome:"Legacy (Sem Operadora)"});else{const de=te.find(ue=>ue.id===parseInt(ee));X(de)}},disabled:re,className:"border border-gray-300 rounded px-3 py-2 text-sm min-w-[200px] focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"legacy",className:"text-orange-600 font-semibold",children:"ðŸ“¦ Legacy (Sem Operadora)"}),te.map(G=>e.jsxs("option",{value:G.id,children:[G.nome," ",G.padrao?"(PadrÃ£o)":""]},G.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`px-4 py-2 rounded-md ${A&&A.id!=="legacy"?"bg-blue-600 text-white hover:bg-blue-700 cursor-pointer":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:["ðŸ“¤ Upload Planilha",e.jsx("input",{type:"file",accept:".csv",onChange:K,className:"hidden",disabled:!A||A.id==="legacy"})]}),(A==null?void 0:A.id)==="legacy"&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:'Vendas Legacy nÃ£o tÃªm planilha. Use o campo "Preencher Operadora".'})]}),i.length>0&&!w&&(A==null?void 0:A.id)!=="legacy"&&e.jsx("button",{onClick:_,disabled:c,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400",children:"ðŸ” Processar Matches"}),w&&b.length>0&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:O,disabled:c,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 animate-pulse",children:"âœ… Confirmar Matches OK"}),e.jsx("button",{onClick:()=>{S(!1),u([]),N(!1)},className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"âŒ Cancelar"})]}),e.jsxs("label",{className:"flex items-center gap-2 ml-auto",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:()=>m(!d),className:"rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Mostrar Expandido"})]})]}),g&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg",children:g}),w&&b.length>0||P==="conciliadas"&&h.length>0?e.jsxs("div",{className:"flex-1 overflow-hidden bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"px-6 py-4 bg-gradient-to-r from-blue-100 to-green-100 border-b",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:P==="conciliadas"?"âœ… Vendas Conciliadas":"ðŸ” Matches Encontrados - Revise e Confirme"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:P==="conciliadas"?"Vendas PDV conciliadas com NSUs da planilha":"Matches OK no topo â†’ DivergÃªncias â†’ Sem match"})]}),e.jsx("div",{className:"overflow-y-auto p-6",style:{maxHeight:"calc(100vh - 300px)"},children:P==="conciliadas"?h.length>0?h.map((G,ee)=>e.jsx(le,{match:G,isConciliado:!0},ee)):e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Nenhuma venda conciliada ainda"}):b.sort((G,ee)=>{const de={ok:1,divergencia:2,orfao:3,sem_nsu:4};return de[G.status]-de[ee.status]}).map((G,ee)=>e.jsx(le,{match:G},ee))})]}):e.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-4 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-100 border-b border-gray-200",children:[e.jsxs("h3",{className:"font-semibold text-gray-800",children:["â¬…ï¸ Vendas PDV (",o.length,")"]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Vendas com cartÃ£o pendentes"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:x?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Carregando..."}):o.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Nenhuma venda pendente"}):o.map(G=>e.jsx(ae,{venda:G},G.id))}),J>1&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 flex justify-between items-center",children:[e.jsx("button",{onClick:()=>$(G=>Math.max(1,G-1)),disabled:Z===1,className:"px-3 py-1 text-sm bg-white border rounded disabled:opacity-50",children:"â† Anterior"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["PÃ¡gina ",Z," de ",J]}),e.jsx("button",{onClick:()=>$(G=>Math.min(J,G+1)),disabled:Z===J,className:"px-3 py-1 text-sm bg-white border rounded disabled:opacity-50",children:"PrÃ³xima â†’"})]})]}),e.jsxs("div",{className:"flex flex-col bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-blue-100 border-b border-blue-200",children:[e.jsxs("h3",{className:"font-semibold text-blue-900",children:[A?`${A.nome} Planilha`:"Planilha"," âž¡ï¸ (",i.length,")"]}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"NSUs nÃ£o conciliados"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:(A==null?void 0:A.id)==="legacy"?e.jsxs("div",{className:"text-center text-orange-600 py-8 bg-orange-50 rounded-lg border-2 border-orange-200",children:[e.jsx("div",{className:"text-5xl mb-4",children:"ðŸ“¦"}),e.jsx("h4",{className:"font-bold text-lg mb-2",children:"Vendas Legacy"}),e.jsx("p",{className:"text-sm max-w-md mx-auto",children:"Vendas sem operadora nÃ£o possuem planilha para conciliaÃ§Ã£o automÃ¡tica."}),e.jsxs("p",{className:"text-sm max-w-md mx-auto mt-2",children:["Use o botÃ£o ",e.jsx("strong",{children:'"ðŸ¢ Preencher Operadora"'})," nas vendas do lado esquerdo para associÃ¡-las a uma operadora."]})]}):i.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:C?"Processando...":`FaÃ§a upload da planilha ${(A==null?void 0:A.nome)||""}`}):i.map((G,ee)=>e.jsx(H,{nsu:G},ee))})]})]})]})}function lm({onConcluida:a,status:t}){var E,R,K;const[s,o]=n.useState(!1),[r,i]=n.useState({recebimentos:null,recibo:null,ofx:null}),[l,x]=n.useState(!1),[j,g]=n.useState(null),[v,d]=n.useState(null),[m,C]=n.useState([]),[y,c]=n.useState(null),[f,b]=n.useState(!0),[u,h]=n.useState(!1),[p,k]=n.useState(!1),[N,w]=n.useState(null),[S,P]=n.useState(0),[W,te]=n.useState(!1),D=()=>{console.log("ðŸŽ¯ Tentando avanÃ§ar para Aba 3..."),console.log("onConcluida existe?",typeof a),typeof a=="function"?(console.log("âœ… Chamando onConcluida()"),a(),console.log("âœ… onConcluida() foi chamado com sucesso")):(console.error("âŒ onConcluida nÃ£o Ã© uma funÃ§Ã£o!",a),alert("Erro: FunÃ§Ã£o de callback nÃ£o encontrada. Recarregue a pÃ¡gina."))},A=()=>{i({recebimentos:null,recibo:null,ofx:null}),g(null),d(null),x(!1),te(!1),w(null),P(0),h(!1),k(!1),console.log("ðŸ”„ Estado resetado")};n.useEffect(()=>{(async()=>{try{const _=await F.get("/operadoras-cartao?apenas_ativas=true");C(_.data);const O=_.data.find(q=>q.padrao);O&&c(O)}catch(_){console.error("Erro ao carregar operadoras:",_),d("Erro ao carregar operadoras")}finally{b(!1)}})()},[]),n.useEffect(()=>{const B=localStorage.getItem("conciliacao_aba2_aviso_ate");if(!B)return;const _=Number(B);Number.isFinite(_)&&Date.now()<_&&o(!0)},[]);const X=B=>{const _=Date.now()+B*24*60*60*1e3;localStorage.setItem("conciliacao_aba2_aviso_ate",String(_)),o(!0)},re=(B,_)=>{var q;const O=(q=_.target.files)==null?void 0:q[0];if(!O){console.warn(`Nenhum arquivo selecionado para ${B}`);return}console.log(`ðŸ“Ž Arquivo selecionado para ${B}:`,{name:O.name,size:O.size,type:O.type,lastModified:new Date(O.lastModified).toISOString()}),i(ae=>({...ae,[B]:O})),d(null),g(null)},M=()=>{if(!y){d("Por favor, selecione uma operadora antes de validar.");return}if(!r.recebimentos||!r.recibo||!r.ofx){d("Por favor, faÃ§a upload dos 3 arquivos antes de validar.");return}h(!0)},Z=async()=>{var B,_,O,q,ae,H,le,G,ee,de,ue,Ae;if(h(!1),console.log("ðŸš€ Iniciando validaÃ§Ã£o...",{arquivos_estado:{recebimentos:!!r.recebimentos,recibo:!!r.recibo,ofx:!!r.ofx}}),!r.recebimentos||!r.recibo||!r.ofx){d("VocÃª precisa enviar os 3 arquivos para continuar");return}if(console.log("ðŸ” Validando tipos de arquivo...",{recebimentos_isFile:r.recebimentos instanceof File,recibo_isFile:r.recibo instanceof File,ofx_isFile:r.ofx instanceof File}),!(r.recebimentos instanceof File)){console.error("âŒ Arquivo de recebimentos nÃ£o Ã© um File vÃ¡lido:",r.recebimentos),d("Arquivo de recebimentos invÃ¡lido. Por favor, selecione novamente."),i(se=>({...se,recebimentos:null}));return}if(!(r.recibo instanceof File)){console.error("âŒ Arquivo de recibo nÃ£o Ã© um File vÃ¡lido:",r.recibo),d("Arquivo de recibo invÃ¡lido. Por favor, selecione novamente."),i(se=>({...se,recibo:null}));return}if(!(r.ofx instanceof File)){console.error("âŒ Arquivo OFX nÃ£o Ã© um File vÃ¡lido:",r.ofx),d("Arquivo OFX invÃ¡lido. Por favor, selecione novamente."),i(se=>({...se,ofx:null}));return}x(!0),d(null);try{let se,we,Se;console.log("ðŸ“‚ Lendo arquivos:",{recebimentos:r.recebimentos.name,recibo:r.recibo.name,ofx:r.ofx.name});try{if(se=await r.recebimentos.text(),!se||se.trim().length===0)throw new Error("Arquivo de recebimentos estÃ¡ vazio")}catch(oe){throw console.error("Erro ao ler recebimentos:",oe),new Error(`Erro ao ler arquivo de recebimentos: ${oe.message}`)}try{if(we=await r.recibo.text(),!we||we.trim().length===0)throw new Error("Arquivo de recibo estÃ¡ vazio")}catch(oe){throw console.error("Erro ao ler recibo:",oe),new Error(`Erro ao ler arquivo de recibo: ${oe.message}`)}try{if(Se=await r.ofx.text(),!Se||Se.trim().length===0)throw new Error("Arquivo OFX estÃ¡ vazio")}catch(oe){throw console.error("Erro ao ler OFX:",oe),new Error(`Erro ao ler arquivo OFX: ${oe.message}`)}console.log("ðŸ“„ Arquivos carregados:",{recebimentos_length:se.length,recibo_length:we.length,ofx_length:Se.length});const ea=se.split(`
`);console.log("ðŸ” Primeiras 3 linhas do arquivo de recebimentos:"),console.log("Linha 0 (header):",ea[0]),console.log("Linha 1:",ea[1]),console.log("Linha 2:",ea[2]);const Ie=we.split(`
`);console.log("ðŸ” Primeiras 3 linhas do arquivo de recibo:"),console.log("Linha 0 (header):",Ie[0]),console.log("Linha 1:",Ie[1]),console.log("Linha 2:",Ie[2]);const Je=(B=ea[0])!=null&&B.includes(";")?";":",";console.log("ðŸ“‹ Separador detectado:",Je);let be,Fe,he;try{be=se.split(`
`).slice(1).filter(oe=>oe.trim()).map((oe,Ne)=>{var ke,Ue,ze,Y,ve,Le;try{const I=oe.split(Je);Ne===0&&(console.log("ðŸ” DEBUG - Primeira linha parseada:"),console.log("Total de campos:",I.length),console.log("Campos relevantes:"),console.log("  Campo 8 (STONE ID/NSU):",I[8]),console.log("  Campo 4 (DATA DE VENCIMENTO):",I[4]),console.log("  Campo 12 (VALOR LÃQUIDO):",I[12]),console.log("  Campo 10 (NÂº DA PARCELA):",I[10]),console.log("  Campo 9 (QTD DE PARCELAS):",I[9]),console.log("  Campo 16 (ÃšLTIMO STATUS):",I[16]));const Q=(ke=I[8])==null?void 0:ke.trim(),fe=(Ue=I[4])==null?void 0:Ue.trim(),U=(ze=I[12])==null?void 0:ze.trim(),ie=(Y=I[10])==null?void 0:Y.trim(),_e=(ve=I[9])==null?void 0:ve.trim(),$e=(Le=I[16])==null?void 0:Le.trim(),T=U==null?void 0:U.replace(",","."),ne=parseFloat(T||0);return Ne===0&&(console.log("ðŸ’° ConversÃ£o de valor:"),console.log("  Original:",U),console.log("  Limpo:",T),console.log("  Final:",ne),console.log("  Is NaN?",isNaN(ne))),{nsu:Q,data_recebimento:fe,valor:ne,parcela_numero:parseInt(ie||1),total_parcelas:parseInt(_e||1),tipo_recebimento:$e||"Pago",lote_id:null}}catch(I){throw console.error(`Erro ao parsear linha ${Ne+1} de recebimentos:`,oe,I),new Error(`Erro na linha ${Ne+1} do arquivo de recebimentos detalhados`)}})}catch(oe){d(`âŒ Erro ao processar arquivo de recebimentos: ${oe.message}`);return}try{const oe=(_=Ie[0])!=null&&_.includes(";")?";":",";console.log("ðŸ“„ Primeira linha do recibo:",Ie[0]),console.log("ðŸ“„ Segunda linha do recibo:",Ie[1]),Fe=we.split(`
`).slice(1).filter(Ne=>Ne.trim()).map((Ne,ke)=>{var Ue,ze,Y;try{const ve=Ne.split(oe);ke===0&&(console.log("ðŸ” DEBUG - Recibo primeira linha parseada:"),console.log("Total de campos:",ve.length),console.log("  Campo 0 (Valor):",ve[0]),console.log("  Campo 13 (ID RastreÃ¡vel):",ve[13]),console.log("  Campo 18 (Status):",ve[18]));const Le=(Ue=ve[0])==null?void 0:Ue.trim(),I=(ze=ve[13])==null?void 0:ze.trim(),Q=(Y=ve[18])==null?void 0:Y.trim(),fe=Le==null?void 0:Le.replace(",","."),U=parseFloat(fe||0);return ke===0&&(console.log("ðŸ’° ConversÃ£o recibo:"),console.log("  Original:",Le),console.log("  Limpo:",fe),console.log("  Final:",U)),{lote_id:I,valor:U,status:Q}}catch(ve){throw console.error(`Erro ao parsear linha ${ke+1} de recibo:`,Ne,ve),new Error(`Erro na linha ${ke+1} do arquivo de recibo de lote`)}})}catch(oe){d(`âŒ Erro ao processar arquivo de recibo: ${oe.message}`);return}try{console.log("ðŸ“„ Primeiras linhas do OFX:",Se.split(`
`).slice(0,30).join(`
`));const oe=[],Ne=Se.split(`
`);let ke=null;for(let Ue=0;Ue<Ne.length;Ue++){const ze=Ne[Ue].trim();if(ze==="<STMTTRN>")ke={};else if(ze==="</STMTTRN>"&&ke)(ke.type==="CREDIT"||ke.valor&&ke.valor>0)&&oe.push(ke),ke=null;else if(ke)if(ze.startsWith("<TRNTYPE>"))ke.type=ze.replace("<TRNTYPE>","").replace("</TRNTYPE>","");else if(ze.startsWith("<DTPOSTED>"))ke.data=ze.replace("<DTPOSTED>","").replace("</DTPOSTED>","");else if(ze.startsWith("<TRNAMT>")){const Y=ze.replace("<TRNAMT>","").replace("</TRNAMT>","");ke.valor=parseFloat(Y)}else ze.startsWith("<FITID>")?ke.id=ze.replace("<FITID>","").replace("</FITID>",""):ze.startsWith("<MEMO>")&&(ke.memo=ze.replace("<MEMO>","").replace("</MEMO>",""))}he=oe,console.log("ðŸ’³ OFX parseado:",he.length,"transaÃ§Ãµes encontradas"),he.length>0&&console.log("Primeira transaÃ§Ã£o:",he[0])}catch(oe){console.error("Erro ao parsear OFX:",oe),d(`âŒ Erro ao processar arquivo OFX: ${oe.message}`);return}if(be.length===0){d("âŒ Arquivo de recebimentos detalhados estÃ¡ vazio ou mal formatado. Verifique o formato CSV.");return}if(Fe.length===0){d("âŒ Arquivo de recibo de lote estÃ¡ vazio ou mal formatado. Verifique o formato CSV.");return}if(he.length===0){d("âŒ Arquivo OFX estÃ¡ vazio ou mal formatado. Verifique o formato.");return}const Qe=be.filter(oe=>isNaN(oe.valor)||oe.valor===null);if(Qe.length>0){console.error("âŒ Recebimentos com valores invÃ¡lidos:",Qe),console.error("ðŸ“‹ Primeiras 5 linhas RAW do arquivo:"),ea.slice(0,6).forEach((oe,Ne)=>{console.error(`Linha ${Ne}:`,oe)}),d(`âŒ ${Qe.length} recebimentos tÃªm valores invÃ¡lidos. Verifique o formato dos valores no CSV (use vÃ­rgula ou ponto decimal). Veja o console para mais detalhes.`);return}const Ze=Fe.filter(oe=>isNaN(oe.valor)||oe.valor===null);if(Ze.length>0){console.error("âŒ Lotes com valores invÃ¡lidos:",Ze),d(`âŒ ${Ze.length} lotes tÃªm valores invÃ¡lidos. Verifique o formato dos valores no CSV.`);return}console.log("âœ… Todos os valores validados! Enviando para API..."),console.log("ðŸ“¤ Enviando dados para API:",{recebimentos_count:be.length,recibo_count:Fe.length,ofx_count:he.length,sample_recebimento:be[0],sample_recebimento_2:be[1],sample_recibo:Fe[0],sample_ofx:he[0]}),console.log("ðŸ’° Valores parseados (primeiros 3):"),console.log("Recebimento 1:",(O=be[0])==null?void 0:O.valor),console.log("Recebimento 2:",(q=be[1])==null?void 0:q.valor),console.log("Recibo 1:",(ae=Fe[0])==null?void 0:ae.valor),console.log("OFX 1:",(H=he[0])==null?void 0:H.valor);const oa=(oe=>{var Ue;const Ne={};return oe.forEach(ze=>{const Y=["data","data_recebimento","data_pagamento","Data de Pagamento","Data do Pagamento"];for(const ve of Y)if(ze[ve]){let Le=ze[ve];if(Le.match(/^\d{2}\/\d{2}\/\d{4}$/)){const[I,Q,fe]=Le.split("/");Le=`${fe}-${Q}-${I}`}Ne[Le]=(Ne[Le]||0)+1;break}}),((Ue=Object.entries(Ne).sort((ze,Y)=>Y[1]-ze[1])[0])==null?void 0:Ue[0])||null})(be);console.log("ðŸ“… Data de referÃªncia detectada:",oa);const ha=[{nome:r.recebimentos.name,tamanho:r.recebimentos.size,tipo:"recebimentos_detalhados"},{nome:r.recibo.name,tamanho:r.recibo.size,tipo:"recibo_lote"},{nome:r.ofx.name,tamanho:r.ofx.size,tipo:"extrato_ofx"}],da=await F.post("/conciliacao/aba2/validar-recebimentos",{recebimentos_detalhados:be,recibo_lote:Fe,ofx_creditos:he,data_referencia:oa,arquivos_info:ha,operadora:y==null?void 0:y.nome});if(!W){const oe=y.nome,Ne=da.data.operadora_detectada,ke=da.data.confianca_deteccao||0;if(console.log("ðŸ” ComparaÃ§Ã£o de operadoras:",{selecionada:oe,detectada:Ne,confianca:ke,ignorar:W}),Ne&&oe!==Ne&&ke>=.7){w(Ne),P(ke),g(da.data),k(!0),x(!1);return}}g(da.data),console.log("ðŸ“Š Resultado da validaÃ§Ã£o:",{success:da.data.success,tem_divergencias:da.data.tem_divergencias,validado:da.data.validado,historico_id:da.data.historico_id,operadora_detectada:da.data.operadora_detectada,ja_conciliado:da.data.ja_conciliado}),da.data.ja_conciliado&&da.data.aviso_reprocessamento&&console.warn("âš ï¸ Reprocessamento detectado:",da.data.aviso_reprocessamento),da.data.success&&(da.data.tem_divergencias?console.log("âš ï¸ Tem divergÃªncias, aguardando decisÃ£o do usuÃ¡rio..."):(console.log("âœ… ValidaÃ§Ã£o perfeita, avanÃ§ando automaticamente em 1.5s..."),setTimeout(()=>{D()},1500)))}catch(se){console.error("Erro ao validar:",se),console.error("Detalhes do erro:",(le=se.response)==null?void 0:le.data);const we=((ee=(G=se.response)==null?void 0:G.data)==null?void 0:ee.detail)||((ue=(de=se.response)==null?void 0:de.data)==null?void 0:ue.message)||JSON.stringify((Ae=se.response)==null?void 0:Ae.data)||"Erro ao validar recebimentos";d(we)}finally{x(!1)}},$=r.recebimentos&&r.recibo&&r.ofx,J=va();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Aba 2: ConciliaÃ§Ã£o de Recebimentos"}),e.jsx("p",{className:"text-gray-600",children:"Valide que dinheiro entrou na conta (3 arquivos: detalhados, recibo, OFX)"})]}),e.jsxs("button",{onClick:()=>J("/financeiro/historico-conciliacoes"),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-lg hover:from-purple-600 hover:to-indigo-700 transition-all shadow-md hover:shadow-lg",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-semibold",children:"ðŸ“œ Ver HistÃ³rico"})]})]}),s?e.jsx("button",{onClick:()=>o(!1),className:"text-xs text-blue-700 hover:text-blue-900",children:"Mostrar aviso de sequencia"}):e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Ordem recomendada:"})," Aba 1 prepara os NSUs; esta Aba 2 valida os recebimentos; a Aba 3 baixa as parcelas com seguranca."]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>X(30),className:"text-xs text-blue-700 hover:text-blue-900",children:"Ocultar 30 dias"}),e.jsx("button",{onClick:()=>X(365),className:"text-xs text-blue-700 hover:text-blue-900",children:"Ocultar 1 ano"})]})]})}),e.jsx("div",{className:"bg-purple-50 border-l-4 border-purple-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-purple-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("p",{className:"text-sm text-purple-700 mb-2",children:[e.jsx("strong",{children:"Esta aba NÃƒO conhece vendas."})," Apenas valida que o dinheiro entrou na conta. ValidaÃ§Ã£o em cascata: Recebimentos â†’ Recibo â†’ OFX (todos precisam bater)."]}),e.jsxs("details",{className:"text-xs text-purple-600 mt-2",children:[e.jsx("summary",{className:"cursor-pointer font-semibold hover:text-purple-800",children:"ðŸ“‹ Formato esperado dos arquivos"}),e.jsxs("div",{className:"mt-2 space-y-2 pl-4",children:[e.jsx("p",{children:e.jsx("strong",{children:"Recebimentos Detalhados CSV da Stone:"})}),e.jsx("p",{className:"text-xs font-mono",children:"DOCUMENTO;STONECODE;CATEGORIA;DATA DA VENDA;DATA DE VENCIMENTO;DATA DE VENCIMENTO ORIGINAL;BANDEIRA;PRODUTO;STONE ID;QTD DE PARCELAS;NÂº DA PARCELA;VALOR BRUTO;VALOR LÃQUIDO;DESCONTO DE MDR;DESCONTO DE ANTECIPAÃ‡ÃƒO;DESCONTO UNIFICADO;ÃšLTIMO STATUS;DATA DO ÃšLTIMO STATUS"}),e.jsx("p",{className:"text-xs text-purple-500",children:"Separador: ponto-e-vÃ­rgula (;) | Valores com vÃ­rgula decimal (21,012265)"}),e.jsx("p",{className:"mt-2",children:e.jsx("strong",{children:"Comprovante de Pagamentos CSV da Stone:"})}),e.jsx("p",{className:"text-xs font-mono",children:"Valor;Bandeira;Modalidade;...;Identificador RastreÃ¡vel do Pagamento;...;Status do Pagamento (19 colunas)"}),e.jsx("p",{className:"text-xs text-purple-500",children:"Separador: ponto-e-vÃ­rgula (;) | Valores com vÃ­rgula decimal (202,11)"}),e.jsx("p",{className:"mt-2",children:e.jsx("strong",{children:"OFX:"})}),e.jsx("p",{className:"text-xs",children:"Arquivo bancÃ¡rio padrÃ£o OFX com tags <STMTTRN>, <TRNAMT>, <TRNTYPE>"})]})]})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-2 border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-8 w-8 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-semibold text-blue-900 mb-2",children:"ðŸ› Operadora de CartÃ£o:"}),e.jsxs("select",{value:(y==null?void 0:y.id)||"",onChange:B=>{const _=m.find(O=>O.id===parseInt(B.target.value));c(_),g(null),d(null),te(!1),w(null)},disabled:f||l,className:"w-full border-2 border-blue-300 rounded-lg px-4 py-3 text-base font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Selecione a operadora..."}),m.map(B=>e.jsxs("option",{value:B.id,children:[B.nome," ",B.padrao?"ðŸŽ¯ (PadrÃ£o)":""]},B.id))]}),y&&e.jsxs("p",{className:"mt-2 text-xs text-blue-700",children:["âœ… Operadora selecionada: ",e.jsx("strong",{children:y.nome})]}),!y&&e.jsx("p",{className:"mt-2 text-xs text-orange-600 font-medium",children:"âš ï¸ Selecione a operadora antes de fazer upload dos arquivos"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-blue-400 flex items-center justify-center",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-full w-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{htmlFor:"file-recebimentos",className:"cursor-pointer",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-900 mb-1",children:"1ï¸âƒ£ Recebimentos Detalhados"}),e.jsx("span",{className:"block text-xs text-gray-500 mb-3",children:"Arquivo CSV da Stone (18 colunas)"}),e.jsx("input",{id:"file-recebimentos",type:"file",accept:".csv",onChange:B=>re("recebimentos",B),className:"sr-only"}),e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"Selecionar CSV"})]}),r.recebimentos&&e.jsxs("p",{className:"mt-2 text-xs text-green-600 font-medium truncate",children:["âœ“ ",r.recebimentos.name]})]})]})}),e.jsx("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-green-400 flex items-center justify-center",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-full w-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{htmlFor:"file-recibo",className:"cursor-pointer",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-900 mb-1",children:"2ï¸âƒ£ Recibo de Lote"}),e.jsx("span",{className:"block text-xs text-gray-500 mb-3",children:'CSV "Comprovante de Pagamentos" (19 colunas)'}),e.jsx("input",{id:"file-recibo",type:"file",accept:".csv",onChange:B=>re("recibo",B),className:"sr-only"}),e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"Selecionar CSV"})]}),r.recibo&&e.jsxs("p",{className:"mt-2 text-xs text-green-600 font-medium truncate",children:["âœ“ ",r.recibo.name]})]})]})}),e.jsx("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-purple-400 flex items-center justify-center",children:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"h-full w-full",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{htmlFor:"file-ofx",className:"cursor-pointer",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-900 mb-1",children:"3ï¸âƒ£ Extrato OFX"}),e.jsx("span",{className:"block text-xs text-gray-500 mb-3",children:"Extrato bancÃ¡rio"}),e.jsx("input",{id:"file-ofx",type:"file",accept:".ofx,.xml",onChange:B=>re("ofx",B),className:"sr-only"}),e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:"Selecionar OFX"})]}),r.ofx&&e.jsxs("p",{className:"mt-2 text-xs text-green-600 font-medium truncate",children:["âœ“ ",r.ofx.name]})]})]})})]}),$&&!j&&e.jsx("button",{onClick:M,disabled:l||!y,className:`
            w-full flex justify-center items-center gap-2 py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white
            ${l?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}
          `,children:l?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Validando recebimentos..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),e.jsx("span",{children:"Validar Cascata (3 arquivos)"})]})}),v&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:v})})]}),e.jsx("button",{onClick:A,className:"ml-4 px-3 py-1 bg-red-100 hover:bg-red-200 text-red-700 text-xs font-medium rounded",children:"Limpar e Tentar Novamente"})]})}),j&&j.success&&e.jsxs("div",{className:"space-y-4",children:[j.ja_conciliado&&j.aviso_reprocessamento&&e.jsx("div",{className:"bg-orange-50 border-l-4 border-orange-400 p-4 rounded-lg",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6 text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-orange-800",children:"âš ï¸ REPROCESSAMENTO DETECTADO"}),e.jsxs("div",{className:"mt-2 text-sm text-orange-700",children:[e.jsx("p",{children:j.aviso_reprocessamento.mensagem}),j.aviso_reprocessamento.usuario_anterior&&e.jsxs("p",{className:"mt-1",children:[e.jsx("span",{className:"font-medium",children:"Processado anteriormente por:"})," ",j.aviso_reprocessamento.usuario_anterior]})]}),e.jsx("div",{className:"mt-3",children:e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:["Data: ",j.data_referencia," | Operadora: ",j.operadora_detectada]})})]})]})}),(j.operadora_detectada||j.data_referencia)&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"InformaÃ§Ãµes da ConciliaÃ§Ã£o"}),e.jsxs("div",{className:"mt-2 text-sm text-blue-700 space-y-1",children:[j.operadora_detectada&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Operadora:"})," ",j.operadora_detectada,j.confianca_deteccao&&e.jsxs("span",{className:"ml-2 text-xs",children:["(ConfianÃ§a: ",(j.confianca_deteccao*100).toFixed(0),"%)"]})]}),j.data_referencia&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Data de ReferÃªncia:"})," ",new Date(j.data_referencia+"T00:00:00").toLocaleDateString("pt-BR")]}),j.historico_id&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"ID do HistÃ³rico:"})," #",j.historico_id]})]})]})]})}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"h-6 w-6 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Resumo da ValidaÃ§Ã£o em Cascata"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"1ï¸âƒ£ Recebimentos Detalhados"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:["R$ ",(E=j.valor_total_recebimentos)==null?void 0:E.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[j.recebimentos_salvos," transaÃ§Ãµes"]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:"2ï¸âƒ£ Comprovante (Lotes)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-900",children:["R$ ",(R=j.valor_total_lotes)==null?void 0:R.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[j.lotes_count," lotes"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-purple-600 font-medium mb-1",children:"3ï¸âƒ£ Extrato BancÃ¡rio (OFX)"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900",children:["R$ ",(K=j.valor_total_ofx)==null?void 0:K.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:[j.ofx_count," crÃ©ditos"]})]})]})]}),!j.tem_divergencias&&e.jsx("div",{className:"bg-green-50 border-l-4 border-green-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:"âœ… ValidaÃ§Ã£o Perfeita! Nenhuma divergÃªncia encontrada."}),e.jsxs("p",{className:"mt-1 text-sm text-green-700",children:["Todas as 3 somas estÃ£o idÃªnticas. As ",j.recebimentos_salvos," vendas foram confirmadas na conta."]})]})]})}),j.tem_divergencias&&j.divergencias&&j.divergencias.length>0&&e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"âš ï¸ DivergÃªncias Detectadas"}),e.jsx("p",{className:"mt-1 text-sm text-yellow-700",children:"Foram encontradas diferenÃ§as entre os arquivos. Analise abaixo e decida se aceita ou nÃ£o."}),e.jsx("div",{className:"mt-4 space-y-3",children:j.divergencias.map((B,_)=>{var le,G,ee;const O=B.nivel==="arredondamento",q=O?"bg-blue-50 border-blue-200":"bg-orange-50 border-orange-200",ae=O?"text-blue-900":"text-orange-900",H=O?"bg-blue-100 text-blue-800":"bg-orange-100 text-orange-800";return e.jsxs("div",{className:`border rounded-lg p-4 ${q}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-semibold px-2 py-1 rounded ${H}`,children:O?"ðŸ”µ Arredondamento":"ðŸŸ  AtenÃ§Ã£o"}),e.jsx("p",{className:`text-sm font-medium ${ae}`,children:B.tipo==="recebimentos_vs_lotes"?"Recebimentos Ã— Lotes":"Lotes Ã— OFX"})]}),e.jsxs("div",{className:`text-right ${ae}`,children:[e.jsxs("p",{className:"text-lg font-bold",children:["R$ ",Math.abs(B.diferenca).toFixed(2)]}),e.jsxs("p",{className:"text-xs",children:[(le=B.percentual)==null?void 0:le.toFixed(3),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:B.tipo==="recebimentos_vs_lotes"?"Recebimentos:":"Lotes:"}),e.jsxs("p",{className:`font-semibold ${ae}`,children:["R$ ",(G=B.tipo==="recebimentos_vs_lotes"?B.soma_recebimentos:B.soma_lotes)==null?void 0:G.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:B.tipo==="recebimentos_vs_lotes"?"Lotes:":"OFX:"}),e.jsxs("p",{className:`font-semibold ${ae}`,children:["R$ ",(ee=B.tipo==="recebimentos_vs_lotes"?B.soma_lotes:B.soma_ofx)==null?void 0:ee.toFixed(2)]})]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-2 italic",children:B.mensagem})]},_)})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsx("div",{className:"text-sm text-gray-600",children:j.tem_divergencias?e.jsx("p",{children:"âš ï¸ Analise as divergÃªncias e decida se aceita a validaÃ§Ã£o"}):e.jsx("p",{children:"âœ… ValidaÃ§Ã£o perfeita! Pode avanÃ§ar para a Aba 3."})}),e.jsxs("div",{className:"flex gap-3",children:[j.tem_divergencias&&e.jsx("button",{onClick:A,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 font-medium",children:"âœ• Cancelar e RecomeÃ§ar"}),e.jsx("button",{onClick:()=>{console.log("ðŸ–±ï¸ BotÃ£o Aceitar e AvanÃ§ar clicado"),D()},className:`px-6 py-2 rounded-md font-medium transition-colors ${j.tem_divergencias?"bg-yellow-600 hover:bg-yellow-700 text-white":"bg-green-600 hover:bg-green-700 text-white"}`,children:j.tem_divergencias?"âœ“ Aceitar e AvanÃ§ar â†’":"AvanÃ§ar para Aba 3 â†’"})]})]})]}),u&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>h(!1)}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Confirmar Operadora"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"VocÃª estÃ¡ prestes a validar recebimentos para a operadora:"}),e.jsx("div",{className:"mt-3 p-3 bg-blue-50 rounded border border-blue-200",children:e.jsxs("p",{className:"text-lg font-bold text-blue-900",children:["ðŸ¦ ",y==null?void 0:y.nome]})}),e.jsxs("p",{className:"text-sm text-gray-500 mt-3",children:["âš ï¸ ",e.jsx("strong",{children:"Todos os lanÃ§amentos serÃ£o vinculados a esta operadora."})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"O sistema detectarÃ¡ automaticamente se os arquivos correspondem a esta operadora e alertarÃ¡ se houver divergÃªncia."})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"button",onClick:Z,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm",children:"âœ“ Confirmar e Validar"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Cancelar"})]})]})]})}),p&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-orange-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{className:"h-6 w-6 text-orange-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left flex-1",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-orange-900",children:"âš ï¸ DivergÃªncia de Operadora Detectada"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-4",children:e.jsx("strong",{children:"Os arquivos enviados parecem ser de uma operadora diferente da selecionada."})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-red-50 border-2 border-red-300 rounded-lg",children:[e.jsx("p",{className:"text-xs text-red-600 font-medium mb-1",children:"Operadora Selecionada:"}),e.jsx("p",{className:"text-lg font-bold text-red-900",children:y==null?void 0:y.nome})]}),e.jsxs("div",{className:"p-3 bg-green-50 border-2 border-green-300 rounded-lg",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:"Operadora Detectada nos Arquivos:"}),e.jsx("p",{className:"text-lg font-bold text-green-900",children:N}),e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["ConfianÃ§a da detecÃ§Ã£o: ",(S*100).toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded",children:[e.jsx("p",{className:"text-sm text-yellow-800",children:e.jsx("strong",{children:"O que vocÃª deseja fazer?"})}),e.jsxs("ul",{className:"text-xs text-yellow-700 mt-2 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsxs("strong",{children:["Mudar para ",N,":"]})," Recomendado se os arquivos estÃ£o corretos"]}),e.jsxs("li",{children:[e.jsxs("strong",{children:["Manter ",y==null?void 0:y.nome,":"]})," Use se vocÃª tem certeza da operadora"]})]})]})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{const B=m.find(_=>_.nome===N);B&&c(B),k(!1),setTimeout(()=>{Z()},100)},className:"inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none sm:text-sm",children:["âœ“ Mudar para ",N]}),e.jsxs("button",{type:"button",onClick:()=>{te(!0),k(!1),setTimeout(()=>{Z()},100)},className:"inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:text-sm",children:["Manter ",y==null?void 0:y.nome]}),e.jsx("button",{type:"button",onClick:()=>{k(!1),x(!1),A()},className:"inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:text-sm",children:"âœ• Cancelar Tudo"})]})]})]})})]})}function im({onConcluida:a,status:t}){var P,W,te,D;const s=va(),[o,r]=n.useState(!1),[i,l]=n.useState(""),[x,j]=n.useState(null),[g,v]=n.useState(!1),[d,m]=n.useState(null),[C,y]=n.useState(null),[c,f]=n.useState([]),[b,u]=n.useState(null),[h,p]=n.useState(!0);n.useEffect(()=>{(async()=>{try{const X=await F.get("/operadoras-cartao?apenas_ativas=true");f(X.data);const re=X.data.find(M=>M.padrao);re&&u(re)}catch(X){console.error("Erro ao carregar operadoras:",X),y("Erro ao carregar operadoras")}finally{p(!1)}})()},[]),n.useEffect(()=>{const A=localStorage.getItem("conciliacao_aba3_aviso_ate");if(!A)return;const X=Number(A);Number.isFinite(X)&&Date.now()<X&&r(!0)},[]);const k=A=>{const X=Date.now()+A*24*60*60*1e3;localStorage.setItem("conciliacao_aba3_aviso_ate",String(X)),r(!0)};n.useEffect(()=>{i&&b?N():j(null)},[i,b]);const N=async()=>{try{const A=await F.get("/conciliacao/aba3/preview-amarracao",{params:{data_recebimento:i,operadora:b==null?void 0:b.nome}});j(A.data)}catch(A){console.error("Erro ao buscar preview:",A),j(null)}},w=async()=>{var A,X;if(!b||!i){y("Selecione a operadora e a data primeiro");return}v(!0),y(null);try{const re=await F.post("/conciliacao/aba3/amarrar-automatico",{data_recebimento:i,operadora:b==null?void 0:b.nome});m(re.data)}catch(re){console.error("Erro ao processar:",re),y(((X=(A=re.response)==null?void 0:A.data)==null?void 0:X.detail)||"Erro ao processar amarraÃ§Ã£o")}finally{v(!1)}},S=()=>{var A,X;if(d){const re=`âœ… ConciliaÃ§Ã£o finalizada com sucesso!

ðŸ“Š Resumo:
â€¢ ${d.parcelas_liquidadas} parcelas baixadas
â€¢ Valor total: R$ ${(A=d.valor_total_liquidado)==null?void 0:A.toFixed(2)}
â€¢ Taxa de amarraÃ§Ã£o: ${(X=d.taxa_amarracao_automatica)==null?void 0:X.toFixed(1)}%`;alert(re)}a&&a(),s("/financeiro/historico-conciliacoes")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Aba 3: AmarraÃ§Ã£o AutomÃ¡tica"}),e.jsx("p",{className:"text-gray-600",children:"AmarraÃ§Ã£o 98% automÃ¡tica: recebimentos â†’ vendas â†’ baixa de parcelas"})]}),o?e.jsx("button",{onClick:()=>r(!1),className:"text-xs text-blue-700 hover:text-blue-900",children:"Mostrar aviso de sequencia"}):e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Ordem recomendada:"})," Execute a Aba 1 e Aba 2 antes para garantir que a amarracao encontre todos os recebimentos."]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>k(30),className:"text-xs text-blue-700 hover:text-blue-900",children:"Ocultar 30 dias"}),e.jsx("button",{onClick:()=>k(365),className:"text-xs text-blue-700 hover:text-blue-900",children:"Ocultar 1 ano"})]})]})}),e.jsx("div",{className:"bg-green-50 border-l-4 border-green-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"98% automÃ¡tico!"})," Se as Abas 1 e 2 foram bem feitas, esta etapa Ã© quase instantÃ¢nea. Sistema vincula recebimentos Ã s vendas pelo NSU e baixa as parcelas automaticamente."]})})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Operadora:"}),e.jsxs("select",{value:(b==null?void 0:b.id)||"",onChange:A=>{const X=c.find(re=>String(re.id)===A.target.value);u(X||null)},disabled:h,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Selecione a operadora"}),c.map(A=>e.jsx("option",{value:A.id,children:A.nome},A.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data dos recebimentos:"}),e.jsx("input",{type:"date",value:i,onChange:A=>l(A.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Selecione a operadora e a data dos recebimentos validados na Aba 2"})]}),x&&x.recebimentos_validados>0&&e.jsx("div",{className:"bg-blue-50 border-2 border-blue-300 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:"ðŸ“Š Preview da AmarraÃ§Ã£o"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white rounded",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Recebimentos validados:"}),e.jsx("span",{className:"text-lg font-bold text-gray-900",children:x.recebimentos_validados})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-100 rounded border-2 border-blue-400",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-900",children:"âœ… Parcelas que serÃ£o baixadas:"}),e.jsx("span",{className:"text-xl font-bold text-blue-900",children:x.parcelas_a_baixar})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-100 rounded border-2 border-green-400",children:[e.jsx("span",{className:"text-sm font-semibold text-green-900",children:"ðŸ’° Valor total a liquidar:"}),e.jsxs("span",{className:"text-xl font-bold text-green-900",children:["R$ ",(P=x.valor_total)==null?void 0:P.toFixed(2)]})]})]})]})]})}),x&&x.recebimentos_validados===0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"âš ï¸ Nenhum recebimento validado encontrado para esta data. Verifique se a Aba 2 foi processada corretamente."})}),x&&x.parcelas_a_baixar>0&&!d&&e.jsx("button",{onClick:w,disabled:g,className:`
            w-full flex justify-center items-center gap-3 py-4 px-6 border-2 border-transparent rounded-lg shadow-lg text-base font-bold
            ${g?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white"}
          `,children:g?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-6 w-6 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Processando amarraÃ§Ã£o..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsxs("span",{children:["âœ… Processar â†’ baixar ",x.parcelas_a_baixar," parcelas"]})]})}),C&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:C})})]})}),d&&d.success&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:`border-l-4 p-6 rounded-lg ${d.alerta_saude==="OK"?"bg-green-50 border-green-400":"bg-red-50 border-red-400"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:d.alerta_saude==="OK"?e.jsx("svg",{className:"h-8 w-8 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):e.jsx("svg",{className:"h-8 w-8 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:`text-xl font-bold mb-2 ${d.alerta_saude==="OK"?"text-green-900":"text-red-900"}`,children:d.alerta_saude==="OK"?"âœ… AmarraÃ§Ã£o ConcluÃ­da com Sucesso!":"âš ï¸ AmarraÃ§Ã£o ConcluÃ­da com Alertas"}),e.jsxs("p",{className:"text-sm text-gray-700 font-medium mb-4 bg-green-100 border border-green-300 rounded px-3 py-2",children:["ðŸ’° ",d.parcelas_liquidadas," conta(s) a receber foi(ram) baixada(s) com sucesso! Valor total: R$ ",(W=d.valor_total_liquidado)==null?void 0:W.toFixed(2)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white rounded p-4 shadow",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Amarrados"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:d.amarrados})]}),e.jsxs("div",{className:"bg-white rounded p-4 shadow",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Ã“rfÃ£os"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:d.orfaos})]}),e.jsxs("div",{className:"bg-white rounded p-4 shadow",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Parcelas Liquidadas"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:d.parcelas_liquidadas})]}),e.jsxs("div",{className:"bg-white rounded p-4 shadow",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Valor Liquidado"}),e.jsxs("p",{className:"text-xl font-bold text-purple-600",children:["R$ ",(te=d.valor_total_liquidado)==null?void 0:te.toFixed(2)]})]})]}),e.jsxs("div",{className:`p-4 rounded-lg border-2 ${d.alerta_saude==="OK"?"bg-green-100 border-green-400":"bg-red-100 border-red-400"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"ðŸ“Š SaÃºde do Sistema"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Taxa de amarraÃ§Ã£o automÃ¡tica"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-4xl font-bold ${d.alerta_saude==="OK"?"text-green-700":"text-red-700"}`,children:[(D=d.taxa_amarracao_automatica)==null?void 0:D.toFixed(1),"%"]}),e.jsx("p",{className:`text-sm font-medium mt-1 ${d.alerta_saude==="OK"?"text-green-700":"text-red-700"}`,children:d.alerta_saude==="OK"?"âœ… SAUDÃVEL":"ðŸš¨ CRÃTICO"})]})]}),d.alerta_saude!=="OK"&&e.jsx("p",{className:"mt-3 text-xs text-red-700 font-medium",children:"âš ï¸ Taxa abaixo de 90% indica problema na operaÃ§Ã£o. Revise a Aba 1 (conferÃªncia de vendas)."})]})]})]})}),d.orfaos>0&&d.lista_orfaos&&e.jsxs("div",{className:"bg-white border-2 border-red-300 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-red-50 border-b border-red-200",children:[e.jsxs("h4",{className:"text-lg font-semibold text-red-900",children:["âš ï¸ Recebimentos Ã“rfÃ£os (",d.orfaos,")"]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Estes recebimentos nÃ£o tÃªm venda correspondente. Precisa resolver na Aba 1."})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-3",children:d.lista_orfaos.map((A,X)=>{var re;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-red-900",children:["NSU: ",A.nsu]}),e.jsxs("p",{className:"text-xs text-red-700",children:["Data: ",A.data," â€¢ Valor: R$ ",(re=A.valor)==null?void 0:re.toFixed(2)]})]}),e.jsx("button",{className:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded hover:bg-red-700",children:"Resolver na Aba 1"})]},X)})})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsx("div",{className:"text-sm text-gray-600",children:e.jsx("p",{children:"ðŸŽ‰ ConciliaÃ§Ã£o completa! Todas as 3 abas foram processadas."})}),e.jsxs("button",{onClick:S,className:"px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 font-semibold flex items-center gap-2 shadow-lg",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{children:"Concluir e Ver HistÃ³rico"})]})]})]})]})}function dm(){const[a,t]=n.useState(1),[s,o]=n.useState(!1),[r,i]=n.useState(null),[l,x]=n.useState(!1),[j,g]=n.useState("pendente"),[v,d]=n.useState("pendente"),[m,C]=n.useState("pendente");n.useEffect(()=>{const k=localStorage.getItem("conciliacao_tabs_skip_aviso");x(k==="true")},[]),n.useEffect(()=>{console.log("ðŸ”„ abaAtiva MUDOU PARA:",a)},[a]);const y=()=>{console.log("âœ… Aba 1 concluÃ­da, marcando como processado"),g("processado")},c=()=>{console.log("âœ… Aba 2 concluÃ­da, marcando como processado e avanÃ§ando para Aba 3"),d("processado"),console.log("ðŸš€ Mudando para Aba 3 imediatamente..."),console.log("ðŸ” abaAtiva ANTES de setAbaAtiva:",a),t(k=>(console.log("ðŸ” abaAtiva ANTERIOR (dentro do setState):",k),console.log("ðŸ” Retornando novo valor:",3),3)),console.log("âœ… setAbaAtiva(3) executado")},f=()=>{console.log("âœ… Aba 3 concluÃ­da, marcando como processado"),C("processado")},b=k=>{if(l||k===1){t(k);return}i(k),o(!0)},u=()=>{r&&t(r),o(!1)},h=()=>{localStorage.setItem("conciliacao_tabs_skip_aviso","true"),x(!0),r&&t(r),o(!1)},p=k=>{switch(k){case"processado":return e.jsx("span",{className:"text-green-600 text-xl",children:"âœ…"});case"pendente":return e.jsx("span",{className:"text-yellow-600 text-xl",children:"â³"});case"bloqueado":return e.jsx("span",{className:"text-gray-400 text-xl",children:"ðŸ”’"});case"erro":return e.jsx("span",{className:"text-red-600 text-xl",children:"âŒ"});default:return null}};return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"ConciliaÃ§Ã£o de CartÃµes - 3 Etapas"}),e.jsx("p",{className:"text-gray-600",children:"Processo completo: Vendas â†’ Recebimentos â†’ AmarraÃ§Ã£o (baixa automÃ¡tica)"})]}),e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-yellow-700 font-medium",children:["Ordem recomendada: ",e.jsx("strong",{children:"Aba 1"})," â†’ ",e.jsx("strong",{children:"Aba 2"})," â†’ ",e.jsx("strong",{children:"Aba 3"}),". As abas ficam abertas, mas a sequencia evita divergencias."]})})]})}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsxs("nav",{className:"flex -mb-px space-x-8",children:[e.jsxs("button",{onClick:()=>b(1),disabled:!1,className:`
              flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${a===1?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx("span",{className:"text-lg",children:"1ï¸âƒ£"}),e.jsx("span",{children:"ConciliaÃ§Ã£o de Vendas"}),p(j),j==="pendente"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"ObrigatÃ³ria"})]}),e.jsxs("button",{onClick:()=>b(2),disabled:!1,className:`
              flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${a===2?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx("span",{className:"text-lg",children:"2ï¸âƒ£"}),e.jsx("span",{children:"ConciliaÃ§Ã£o de Recebimentos"}),p(v),v==="pendente"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Recomendada apos Aba 1"})]}),e.jsxs("button",{onClick:()=>b(3),disabled:!1,className:`
              flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${a===3?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx("span",{className:"text-lg",children:"3ï¸âƒ£"}),e.jsx("span",{children:"AmarraÃ§Ã£o AutomÃ¡tica"}),p(m),m==="pendente"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Recomendada apos Aba 2"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[a===1&&e.jsx(nm,{onConcluida:y,status:j}),a===2&&e.jsx(lm,{onConcluida:c,status:v}),a===3&&e.jsx(im,{onConcluida:f,status:m})]}),s&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Ordem recomendada das etapas"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["A sequencia ",e.jsx("strong",{children:"Aba 1 â†’ Aba 2 â†’ Aba 3"})," reduz divergencias e garante que a amarracao automatica encontre todos os recebimentos."]}),e.jsxs("div",{className:"bg-gray-50 rounded-md p-3 text-sm text-gray-700 mb-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Aba 1:"})," prepara vendas e NSUs."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Aba 2:"})," valida que o dinheiro entrou."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Aba 3:"})," baixa parcelas automaticamente."]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>o(!1),className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-800",children:"Cancelar"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:h,className:"px-3 py-2 text-sm text-blue-700 hover:text-blue-900",children:"Nao mostrar novamente"}),e.jsx("button",{onClick:u,className:"px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded hover:bg-blue-700",children:"Continuar"})]})]})]})}),e.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-2",children:"â„¹ï¸ Como funciona:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Aba 1:"})," Confere NSU, bandeira, parcelas, taxa (prepara dados)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Aba 2:"})," Valida que dinheiro entrou na conta (3 arquivos: detalhados, recibo, OFX)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Aba 3:"})," Vincula recebimentos Ã s vendas e baixa parcelas automaticamente (98%!)"]})]})]})]})}function cm(){const a=va(),[t,s]=n.useState([]),[o,r]=n.useState(!1),[i,l]=n.useState({operadora:"",status:"",data_inicio:"",data_fim:""});n.useEffect(()=>{x()},[]);const x=async()=>{r(!0);try{const d=new URLSearchParams;i.operadora&&d.append("operadora",i.operadora),i.status&&d.append("status",i.status),i.data_inicio&&d.append("data_inicio",i.data_inicio),i.data_fim&&d.append("data_fim",i.data_fim);const m=await F.get(`/conciliacao/historico?${d.toString()}`);m.data&&m.data.items&&s(m.data.items)}catch(d){console.error("Erro ao carregar histÃ³rico:",d)}finally{r(!1)}},j=d=>{if(!d)return"-";const[m,C,y]=d.split("T")[0].split("-");return`${y}/${C}/${m}`},g=(d,m)=>{var c,f;if((f=(c=m==null?void 0:m.abas)==null?void 0:c.aba2)!=null&&f.concluida&&d==="em_andamento")return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:"âœ“ Aba 2 ConcluÃ­da"});const y={concluida:{cor:"bg-green-100 text-green-800",texto:"âœ“ ConcluÃ­da"},em_andamento:{cor:"bg-yellow-100 text-yellow-800",texto:"â³ Em Andamento"},reprocessada:{cor:"bg-blue-100 text-blue-800",texto:"â†» Reprocessada"},cancelada:{cor:"bg-gray-100 text-gray-800",texto:"âœ• Cancelada"}}[d]||{cor:"bg-gray-100 text-gray-800",texto:d};return e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${y.cor}`,children:y.texto})},v=d=>d?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(d):"-";return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"ðŸ“‹ HistÃ³rico de ConciliaÃ§Ãµes"}),e.jsx("p",{className:"text-gray-600",children:"Consulte todas as conciliaÃ§Ãµes jÃ¡ realizadas"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>a("/financeiro/conciliacao-3abas"),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium transition-colors flex items-center gap-2",title:"Voltar para ConciliaÃ§Ã£o",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),e.jsx("span",{children:"Voltar para ConciliaÃ§Ã£o"})]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Filtros"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Operadora"}),e.jsxs("select",{value:i.operadora,onChange:d=>l({...i,operadora:d.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"Stone",children:"Stone"}),e.jsx("option",{value:"PagSeguro",children:"PagSeguro"}),e.jsx("option",{value:"Rede",children:"Rede"}),e.jsx("option",{value:"Cielo",children:"Cielo"}),e.jsx("option",{value:"Getnet",children:"Getnet"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:i.status,onChange:d=>l({...i,status:d.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"concluida",children:"ConcluÃ­da"}),e.jsx("option",{value:"em_andamento",children:"Em Andamento"}),e.jsx("option",{value:"reprocessada",children:"Reprocessada"}),e.jsx("option",{value:"cancelada",children:"Cancelada"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:i.data_inicio,onChange:d=>l({...i,data_inicio:d.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:i.data_fim,onChange:d=>l({...i,data_fim:d.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:x,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium",children:"ðŸ” Filtrar"}),e.jsx("button",{onClick:()=>{l({operadora:"",status:"",data_inicio:"",data_fim:""}),x()},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 font-medium",children:"âœ• Limpar Filtros"})]})]}),o&&e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),!o&&t.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",style:{display:"grid",gridTemplateColumns:"minmax(48px, 0.6fr) minmax(90px, 1fr) minmax(100px, 1.1fr) minmax(140px, 1.6fr) minmax(120px, 1.4fr) minmax(130px, 1.5fr) minmax(180px, 2.4fr)",columnGap:"8px",background:"#f9fafb",borderBottom:"2px solid #e5e7eb"},children:[e.jsx("span",{style:{padding:"8px 10px"},children:"ID"}),e.jsx("span",{style:{padding:"8px 10px"},children:"Data"}),e.jsx("span",{style:{padding:"8px 10px"},children:"Operadora"}),e.jsx("span",{style:{padding:"8px 10px"},children:"Status"}),e.jsx("span",{style:{padding:"8px 10px",textAlign:"right"},children:"Valor"}),e.jsx("span",{style:{padding:"8px 10px"},children:"Processado"}),e.jsx("span",{style:{padding:"8px 10px"},children:"UsuÃ¡rio"})]}),t.map((d,m)=>{var C,y,c,f,b;return e.jsxs("div",{className:"hover:bg-blue-50 transition-colors",style:{display:"grid",gridTemplateColumns:"minmax(48px, 0.6fr) minmax(90px, 1fr) minmax(100px, 1.1fr) minmax(140px, 1.6fr) minmax(120px, 1.4fr) minmax(130px, 1.5fr) minmax(180px, 2.4fr)",columnGap:"8px",alignItems:"center",borderBottom:"1px solid #f0f0f0",background:m%2===0?"#fff":"#fafbfc"},children:[e.jsxs("span",{style:{padding:"8px 10px"},className:"text-sm font-mono text-gray-400",children:["#",d.id]}),e.jsx("span",{style:{padding:"8px 10px"},className:"text-sm font-medium text-gray-900",children:j(d.data_referencia)}),e.jsx("span",{style:{padding:"8px 10px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},className:"text-sm text-gray-700",title:d.operadora,children:d.operadora}),e.jsx("span",{style:{padding:"8px 10px"},children:g(d.status,d)}),e.jsxs("span",{style:{padding:"8px 10px",textAlign:"right"},children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:v((y=(C=d.totais)==null?void 0:C.recebimentos)==null?void 0:y.valor_total)}),((f=(c=d.totais)==null?void 0:c.recebimentos)==null?void 0:f.quantidade)&&e.jsxs("div",{className:"text-xs text-gray-400",children:[d.totais.recebimentos.quantidade," trans."]})]}),e.jsxs("span",{style:{padding:"8px 10px"},children:[e.jsx("div",{className:"text-sm text-gray-700",children:j((b=d.created_at)==null?void 0:b.split("T")[0])}),e.jsx("div",{className:"text-xs text-gray-400",children:d.created_at?new Date(d.created_at).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}):"-"})]}),e.jsx("span",{style:{padding:"8px 10px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},className:"text-sm text-gray-700",title:d.usuario_responsavel,children:d.usuario_responsavel||"-"})]},d.id)})]}),!o&&t.length===0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhuma conciliaÃ§Ã£o encontrada"}),e.jsx("p",{className:"text-gray-500",children:"NÃ£o hÃ¡ conciliaÃ§Ãµes registradas com os filtros selecionados."})]})]})}const xm="/api",mm=xm,ia=Ra.create({baseURL:mm});ia.interceptors.request.use(a=>{const t=localStorage.getItem("access_token")||localStorage.getItem("token");return t&&(a.headers.Authorization=`Bearer ${t}`),a},a=>Promise.reject(a));ia.interceptors.response.use(a=>a,a=>{var s;const t=(s=a.response)==null?void 0:s.status;return t===401&&(console.warn("Sessao invalida ou tenant nao selecionado"),localStorage.removeItem("access_token"),localStorage.removeItem("token"),localStorage.removeItem("tenants"),window.location.href="/login"),t===403&&console.warn("Acesso negado para este tenant"),Promise.reject(a)});function um(){var E;const[a,t]=n.useState([]),[s,o]=n.useState(null),[r,i]=n.useState([]),[l,x]=n.useState([]),[j,g]=n.useState(!1),[v,d]=n.useState(!1),[m,C]=n.useState(null),[y,c]=n.useState("todos"),[f,b]=n.useState(!0),[u,h]=n.useState(""),[p,k]=n.useState(""),[N,w]=n.useState(null),[S,P]=n.useState(!1);n.useEffect(()=>{W(),A()},[]),n.useEffect(()=>{l.length>0&&m&&(te(),D())},[m,y,f,u,p]);const W=async()=>{var R;try{const K=await ia.get("/contas-bancarias",{params:{apenas_ativas:!0}});console.log("ðŸ“Š Contas bancÃ¡rias carregadas:",K.data);const B=K.data.filter(_=>_.instituicao_bancaria);x(B)}catch(K){console.error("âŒ Erro ao carregar contas bancÃ¡rias:",K),console.error("Detalhes:",(R=K.response)==null?void 0:R.data)}},te=async()=>{try{g(!0);const R={};m&&(R.conta_bancaria_id=m),y!=="todos"&&(R.status=y),R.ocultar_conciliadas=f,u&&(R.data_inicio=u),p&&(R.data_fim=p),R.limit=200;const K=await ia.get("/conciliacao/movimentacoes",{params:R});t(K.data)}catch(R){console.error("Erro ao carregar movimentaÃ§Ãµes:",R)}finally{g(!1)}},D=async()=>{try{const R={};m&&(R.conta_bancaria_id=m);const K=await ia.get("/conciliacao/estatisticas",{params:R});o(K.data)}catch(R){console.error("Erro ao carregar estatÃ­sticas:",R)}},A=async()=>{try{const R=await ia.get("/conciliacao/regras");i(R.data)}catch(R){console.error("Erro ao carregar regras:",R)}},X=async R=>{var B,_;const K=R.target.files[0];if(console.log("ðŸ“¤ Upload OFX iniciado:",{file:K,contaSelecionada:m}),!!K){if(!m){alert("Selecione uma conta bancÃ¡ria primeiro");return}try{d(!0);const O=new FormData;O.append("arquivo",K),console.log("ðŸ“¤ Enviando arquivo para API...");const q=await ia.post(`/api/conciliacao/upload-ofx?conta_bancaria_id=${m}`,O,{headers:{"Content-Type":"multipart/form-data"}});console.log("âœ… Upload concluÃ­do:",q.data),alert(`âœ… OFX importado com sucesso!

ðŸ“Š Total de transaÃ§Ãµes: ${q.data.total_transacoes}
â³ Pendentes: ${q.data.pendentes}
ðŸ“… PerÃ­odo: ${q.data.periodo_inicio||"N/A"} a ${q.data.periodo_fim||"N/A"}`),te(),D()}catch(O){console.error("âŒ Erro ao fazer upload:",O),alert("âŒ Erro ao processar OFX: "+(((_=(B=O.response)==null?void 0:B.data)==null?void 0:_.detail)||O.message))}finally{d(!1),R.target.value=""}}},re=async(R,K)=>{try{await ia.post(`/api/conciliacao/movimentacoes/${R.id}/classificar`,K),te(),D(),A(),w(null)}catch(B){console.error("Erro ao classificar:",B),alert("âŒ Erro ao classificar movimentaÃ§Ã£o")}},M=(R,K)=>{const B={conciliado:e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-800 flex items-center gap-1",children:[e.jsx(fa,{size:12})," Conciliado"]}),sugerido:e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800 flex items-center gap-1",children:[e.jsx(xa,{size:12})," Sugerido (",K,"%)"]}),pendente:e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-red-100 text-red-800 flex items-center gap-1",children:[e.jsx(tt,{size:12})," Pendente"]}),manual:e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800 flex items-center gap-1",children:[e.jsx(zr,{size:12})," Manual"]})};return B[R]||B.pendente},Z=R=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(R),$=R=>R?new Date(R).toLocaleDateString("pt-BR"):"-",J=()=>{C(null)};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ConciliaÃ§Ã£o BancÃ¡ria"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Sistema inteligente de classificaÃ§Ã£o automÃ¡tica"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>P(!0),className:"px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(zr,{size:18}),"Regras (",r.length,")"]}),e.jsxs("label",{className:`px-4 py-2 rounded-lg flex items-center gap-2 ${v||!m?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 cursor-pointer"} text-white`,children:[v?e.jsxs(e.Fragment,{children:[e.jsx(Aa,{size:18,className:"animate-spin"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Or,{size:18}),"Upload OFX"]}),e.jsx("input",{type:"file",accept:".ofx,.OFX",onChange:X,className:"hidden",disabled:v||!m})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(fa,{size:20,className:"text-blue-600"}),"Selecione a Conta BancÃ¡ria"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Escolha a conta para visualizar movimentaÃ§Ãµes e fazer upload de extrato OFX"})]}),m&&e.jsx("button",{onClick:J,className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"Limpar SeleÃ§Ã£o"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:l.map(R=>{const K=m===R.id,B=R.cor||"#3B82F6",_=K?{backgroundColor:B,borderColor:B,color:"#ffffff"}:{backgroundColor:`${B}15`,borderColor:`${B}40`,color:B};return e.jsxs("button",{onClick:()=>C(R.id),style:_,className:`border-2 rounded-lg p-4 transition-all duration-200 transform font-medium ${K?"scale-105 shadow-lg":"hover:scale-102 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[R.icone&&e.jsx("span",{className:"text-xl",children:R.icone}),e.jsx("span",{className:"font-semibold text-sm",children:R.nome})]}),K&&e.jsx(fa,{size:20,className:"flex-shrink-0"})]}),R.banco&&e.jsx("div",{className:`text-xs mt-1 ${K?"opacity-90":"opacity-70"}`,children:R.banco})]},R.id)})}),l.length===0&&e.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xa,{size:20,className:"text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-red-800",children:[e.jsx("span",{className:"font-semibold",children:"Nenhuma instituiÃ§Ã£o bancÃ¡ria cadastrada."})," ",'VÃ¡ em Financeiro â†’ Contas BancÃ¡rias e marque o checkbox "ðŸ¦ InstituiÃ§Ã£o BancÃ¡ria" nas contas que sÃ£o bancos reais (nÃ£o caixa fÃ­sico).']})]})}),!m&&l.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xa,{size:18,className:"text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("span",{className:"font-semibold",children:"Nenhuma conta selecionada."})," ","Clique em uma conta acima para visualizar movimentaÃ§Ãµes e fazer upload de extrato OFX."]})]})}),m&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(fa,{size:18,className:"text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("span",{className:"font-semibold",children:[(E=l.find(R=>R.id===m))==null?void 0:E.nome," selecionada."]})," ","Visualizando movimentaÃ§Ãµes desta conta. Pronto para upload de extrato OFX."]})]})})]}),s&&m&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.total_movimentacoes})]}),e.jsx(ss,{className:"text-gray-400",size:24})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Conciliadas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:s.conciliadas})]}),e.jsx(fa,{className:"text-green-400",size:24})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-yellow-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Sugeridas"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:s.sugeridas})]}),e.jsx(xa,{className:"text-yellow-400",size:24})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pendentes"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:s.pendentes})]}),e.jsx(tt,{className:"text-red-400",size:24})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"AutomaÃ§Ã£o"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[s.taxa_automacao,"%"]})]}),e.jsx(Ta,{className:"text-blue-400",size:24})]})})]}),m&&e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xt,{size:18,className:"text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtros:"})]}),e.jsxs("select",{value:y,onChange:R=>c(R.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"todos",children:"Todos os status"}),e.jsx("option",{value:"pendente",children:"Pendente"}),e.jsx("option",{value:"sugerido",children:"Sugerido"}),e.jsx("option",{value:"conciliado",children:"Conciliado"}),e.jsx("option",{value:"manual",children:"Manual"})]}),e.jsx("input",{type:"date",value:u,onChange:R=>h(R.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"Data inÃ­cio"}),e.jsx("input",{type:"date",value:p,onChange:R=>k(R.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"Data fim"}),e.jsxs("button",{onClick:()=>b(!f),className:`px-3 py-2 rounded-lg text-sm flex items-center gap-2 ${f?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:[f?e.jsx(Tr,{size:16}):e.jsx(Ht,{size:16}),f?"Ocultar":"Mostrar"," Conciliadas"]}),e.jsxs("button",{onClick:te,className:"ml-auto px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm flex items-center gap-2",children:[e.jsx(Aa,{size:16}),"Atualizar"]})]})}),m&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"DescriÃ§Ã£o"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Vinculado"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:j?e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500",children:[e.jsx(Aa,{className:"animate-spin mx-auto mb-2",size:24}),"Carregando..."]})}):a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500",children:"Nenhuma movimentaÃ§Ã£o encontrada. FaÃ§a upload de um arquivo OFX."})}):a.map(R=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:$(R.data_movimento)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 max-w-xs truncate",children:R.memo||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded ${R.tipo==="CREDIT"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:R.tipo==="CREDIT"?"CrÃ©dito":"DÃ©bito"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-medium",children:e.jsxs("span",{className:R.tipo==="CREDIT"?"text-green-600":"text-red-600",children:[R.tipo==="CREDIT"?"+":"-"," ",Z(Math.abs(R.valor))]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:M(R.status_conciliacao,R.confianca_sugestao)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 max-w-xs truncate",children:R.fornecedor_nome||R.tipo_vinculo||"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:R.status_conciliacao!=="conciliado"&&e.jsx("button",{onClick:()=>w(R),className:"px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700",children:"Classificar"})})]},R.id))})]})})}),N&&e.jsx(pm,{movimentacao:N,onClose:()=>w(null),onClassificar:re}),S&&e.jsx(gm,{regras:r,onClose:()=>P(!1),onAtualizar:A})]})})}function pm({movimentacao:a,onClose:t,onClassificar:s}){const[o,r]=n.useState(a.tipo_vinculo||"fornecedor"),[i,l]=n.useState(!0),[x,j]=n.useState(!1),[g,v]=n.useState("mensal"),d=m=>{m.preventDefault(),s(a,{tipo_vinculo:o,criar_regra:i,recorrente:x,periodicidade:x?g:null})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Classificar MovimentaÃ§Ã£o"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Data:"}),e.jsx("span",{className:"text-sm font-medium",children:new Date(a.data_movimento).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Valor:"}),e.jsx("span",{className:"text-sm font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.valor)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"DescriÃ§Ã£o:"}),e.jsx("span",{className:"text-sm font-medium truncate ml-4",children:a.memo})]})]}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de VÃ­nculo"}),e.jsxs("select",{value:o,onChange:m=>r(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"fornecedor",children:"Pagamento a Fornecedor"}),e.jsx("option",{value:"taxa",children:"Taxa BancÃ¡ria"}),e.jsx("option",{value:"transferencia",children:"TransferÃªncia Entre Contas"}),e.jsx("option",{value:"recebimento",children:"Recebimento de Cliente"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"criar_regra",checked:i,onChange:m=>l(m.target.checked),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("label",{htmlFor:"criar_regra",className:"text-sm text-gray-700",children:"Criar regra automÃ¡tica para movimentaÃ§Ãµes similares"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"recorrente",checked:x,onChange:m=>j(m.target.checked),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("label",{htmlFor:"recorrente",className:"text-sm text-gray-700",children:"MovimentaÃ§Ã£o recorrente (criar provisÃµes futuras)"})]}),x&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Periodicidade"}),e.jsxs("select",{value:g,onChange:m=>v(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"mensal",children:"Mensal"}),e.jsx("option",{value:"anual",children:"Anual"}),e.jsx("option",{value:"trimestral",children:"Trimestral"}),e.jsx("option",{value:"semestral",children:"Semestral"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Classificar"})]})]})]})]})})}function gm({regras:a,onClose:t,onAtualizar:s}){const[o,r]=n.useState(a),i=async l=>{if(confirm("Deseja realmente desativar esta regra?"))try{await ia.delete(`/conciliacao/regras/${l}`),s();const x=o.filter(j=>j.id!==l);r(x)}catch(x){console.error("Erro ao excluir regra:",x)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Regras de Aprendizado"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Sistema aprende com suas classificaÃ§Ãµes"})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),e.jsx("div",{className:"p-6",children:o.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(zr,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Nenhuma regra criada ainda."}),e.jsx("p",{className:"text-sm mt-2",children:"Classifique movimentaÃ§Ãµes para criar regras automÃ¡ticas."})]}):e.jsx("div",{className:"space-y-3",children:o.map(l=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded",children:l.padrao_memo}),l.tipo_operacao&&e.jsx("span",{className:"text-xs text-gray-600",children:l.tipo_operacao})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"ConfianÃ§a:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${l.confianca>=80?"bg-green-500":l.confianca>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${l.confianca}%`}})}),e.jsxs("span",{className:"font-medium",children:[l.confianca,"%"]})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Aplicada:"}),e.jsxs("p",{className:"font-medium mt-1",children:[l.vezes_aplicada,"x"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Confirmada:"}),e.jsxs("p",{className:"font-medium mt-1",children:[l.vezes_confirmada,"x"]})]})]}),l.fornecedor_nome&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["â†’ ",l.fornecedor_nome]})]}),e.jsx("button",{onClick:()=>i(l.id),className:"ml-4 px-3 py-1 text-xs text-red-600 hover:bg-red-50 rounded",children:"Desativar"})]})},l.id))})})]})})}const hm=()=>{var h,p,k;const[a,t]=n.useState([]),[s,o]=n.useState([]),[r,i]=n.useState([]),[l,x]=n.useState(!0),[j,g]=n.useState(!1),[v,d]=n.useState(null),[m,C]=n.useState({nome:"",tipo:"dinheiro",taxa_percentual:0,taxa_fixa:0,prazo_dias:0,operadora:"",operadora_id:null,gera_contas_receber:!1,split_parcelas:!1,conta_bancaria_destino_id:null,requer_nsu:!1,tipo_cartao:"",bandeira:"",ativo:!0,permite_parcelamento:!1,parcelas_maximas:1,taxas_por_parcela:{},permite_antecipacao:!1,dias_recebimento_antecipado:null,taxa_antecipacao_percentual:null,icone:"ðŸ’³",cor:"#3B82F6"});n.useEffect(()=>{y()},[]);const y=async()=>{try{const[N,w,S]=await Promise.all([F.get("/financeiro/formas-pagamento?apenas_ativas=false"),F.get("/contas-bancarias?apenas_ativas=true"),F.get("/operadoras-cartao?apenas_ativas=true")]);t(N.data),o(w.data),i(S.data)}catch(N){console.error("Erro ao carregar dados:",N),ce.error("Erro ao carregar formas de pagamento")}finally{x(!1)}},c=(N=null)=>{if(N){d(N.id);let w={};if(N.taxas_por_parcela)try{w=typeof N.taxas_por_parcela=="string"?JSON.parse(N.taxas_por_parcela):N.taxas_por_parcela}catch(S){console.error("Erro ao parsear taxas_por_parcela:",S)}C({nome:N.nome,tipo:N.tipo,taxa_percentual:N.taxa_percentual,taxa_fixa:N.taxa_fixa,prazo_dias:N.prazo_dias,operadora:N.operadora||"",operadora_id:N.operadora_id||null,gera_contas_receber:N.gera_contas_receber,split_parcelas:N.split_parcelas,conta_bancaria_destino_id:N.conta_bancaria_destino_id,requer_nsu:N.requer_nsu,tipo_cartao:N.tipo_cartao||"",bandeira:N.bandeira||"",ativo:N.ativo,permite_parcelamento:N.permite_parcelamento,parcelas_maximas:N.parcelas_maximas,taxas_por_parcela:w,permite_antecipacao:N.permite_antecipacao||!1,dias_recebimento_antecipado:N.dias_recebimento_antecipado||null,taxa_antecipacao_percentual:N.taxa_antecipacao_percentual||null,icone:N.icone||"ðŸ’³",cor:N.cor||"#3B82F6"})}else d(null),C({nome:"",tipo:"dinheiro",taxa_percentual:0,taxa_fixa:0,prazo_dias:0,operadora:"",operadora_id:null,gera_contas_receber:!1,split_parcelas:!1,conta_bancaria_destino_id:null,requer_nsu:!1,tipo_cartao:"",bandeira:"",ativo:!0,permite_parcelamento:!1,parcelas_maximas:1,taxas_por_parcela:{},permite_antecipacao:!1,dias_recebimento_antecipado:null,taxa_antecipacao_percentual:null,icone:"ðŸ’³",cor:"#3B82F6"});g(!0)},f=async()=>{try{const N={...m,taxas_por_parcela:Object.keys(m.taxas_por_parcela).length>0?JSON.stringify(m.taxas_por_parcela):null};v?(await F.put(`/financeiro/formas-pagamento/${v}`,N),ce.success("Forma de pagamento atualizada!")):(await F.post("/financeiro/formas-pagamento",N),ce.success("Forma de pagamento criada!")),g(!1),y()}catch(N){console.error("Erro ao salvar:",N),ce.error("Erro ao salvar forma de pagamento")}},b=async N=>{if(confirm("Deseja realmente excluir esta forma de pagamento?"))try{await F.delete(`/financeiro/formas-pagamento/${N}`),ce.success("Forma de pagamento excluÃ­da!"),y()}catch(w){console.error("Erro ao excluir:",w),ce.error("Erro ao excluir forma de pagamento")}},u=[{value:"dinheiro",label:"Dinheiro",icone:"ðŸ’µ"},{value:"cartao_credito",label:"CartÃ£o de CrÃ©dito",icone:"ðŸ’³"},{value:"cartao_debito",label:"CartÃ£o de DÃ©bito",icone:"ðŸ’³"},{value:"pix",label:"PIX",icone:"ðŸ“±"},{value:"boleto",label:"Boleto",icone:"ðŸ“„"},{value:"transferencia",label:"TransferÃªncia",icone:"ðŸ¦"}];return l?e.jsx("div",{className:"flex justify-center items-center h-64",children:"Carregando..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Formas de Pagamento/Recebimento"}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:()=>c(),children:"+ Nova Forma"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nome"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Taxa %"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Taxa Fixa"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Prazo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Conta Destino"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"px-6 py-4 text-center text-gray-500",children:"Nenhuma forma de pagamento cadastrada"})}):a.map(N=>{var w,S,P,W;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:N.icone}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:N.nome}),N.operadora_id&&e.jsx("div",{className:"text-xs text-gray-500",children:((w=r.find(te=>te.id===N.operadora_id))==null?void 0:w.nome)||N.operadora||"Operadora nÃ£o encontrada"})]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:((S=u.find(te=>te.value===N.tipo))==null?void 0:S.label)||N.tipo}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[N.taxa_percentual,"%"]}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:["R$ ",((P=N.taxa_fixa)==null?void 0:P.toFixed(2))||"0.00"]}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[N.prazo_dias," dias"]}),e.jsx("td",{className:"px-6 py-4 text-sm",children:N.conta_bancaria_destino_id?((W=s.find(te=>te.id===N.conta_bancaria_destino_id))==null?void 0:W.nome)||"N/A":e.jsx("span",{className:"text-gray-400",children:"Nenhuma"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${N.ativo?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:N.ativo?"Ativo":"Inativo"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"text-blue-600 hover:text-blue-800",onClick:()=>c(N),children:"âœï¸"}),e.jsx("button",{className:"text-red-600 hover:text-red-800",onClick:()=>b(N.id),children:"ðŸ—‘ï¸"})]})})]},N.id)})})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-6 py-4 flex justify-between items-center sticky top-0",children:[e.jsxs("h3",{className:"text-xl font-semibold",children:[v?"Editar":"Nova"," Forma de Pagamento"]}),e.jsx("button",{onClick:()=>g(!1),className:"text-white hover:bg-blue-700 px-3 py-1 rounded",children:"âœ•"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nome *"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",value:m.nome,onChange:N=>C({...m,nome:N.target.value}),placeholder:"Ex: Dinheiro, PIX, Stone CrÃ©dito..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipo *"}),e.jsx("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:m.tipo,onChange:N=>C({...m,tipo:N.target.value}),children:u.map(N=>e.jsxs("option",{value:N.value,children:[N.icone," ",N.label]},N.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ãcone"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",value:m.icone,onChange:N=>C({...m,icone:N.target.value}),placeholder:"ðŸ’µ",maxLength:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa % (Ex: 2.5%)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:m.taxa_percentual,onChange:N=>C({...m,taxa_percentual:parseFloat(N.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa Fixa (R$)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:m.taxa_fixa,onChange:N=>C({...m,taxa_fixa:parseFloat(N.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Prazo (dias)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",value:m.prazo_dias,onChange:N=>C({...m,prazo_dias:parseInt(N.target.value)||0})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Conta BancÃ¡ria Destino"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:m.conta_bancaria_destino_id||"",onChange:N=>C({...m,conta_bancaria_destino_id:parseInt(N.target.value)||null}),children:[e.jsx("option",{value:"",children:"Selecione..."}),s.map(N=>e.jsx("option",{value:N.id,children:N.nome},N.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Esta conta serÃ¡ usada automaticamente quando esta forma for selecionada em pagamentos/recebimentos"})]}),(m.tipo==="cartao_credito"||m.tipo==="cartao_debito")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Operadora *"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:m.operadora_id||"",onChange:N=>{const w=parseInt(N.target.value)||null,S=r.find(W=>W.id===w);let P=(S==null?void 0:S.max_parcelas)||m.parcelas_maximas;C({...m,operadora_id:w,operadora:(S==null?void 0:S.nome)||"",parcelas_maximas:P})},children:[e.jsx("option",{value:"",children:"Selecione a operadora..."}),r.map(N=>e.jsxs("option",{value:N.id,children:[N.icone," ",N.nome," (atÃ© ",N.max_parcelas,"x)"]},N.id))]}),m.operadora_id&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Limite de parcelas desta operadora: ",(h=r.find(N=>N.id===m.operadora_id))==null?void 0:h.max_parcelas,"x"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Bandeira"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:m.bandeira,onChange:N=>C({...m,bandeira:N.target.value}),children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"visa",children:"Visa"}),e.jsx("option",{value:"master",children:"Mastercard"}),e.jsx("option",{value:"elo",children:"Elo"}),e.jsx("option",{value:"amex",children:"American Express"}),e.jsx("option",{value:"hipercard",children:"Hipercard"})]})]})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.ativo,onChange:N=>C({...m,ativo:N.target.checked})}),e.jsx("span",{className:"text-sm",children:"Ativo"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.gera_contas_receber,onChange:N=>C({...m,gera_contas_receber:N.target.checked})}),e.jsx("span",{className:"text-sm",children:"Gera Contas a Receber (para cartÃµes com prazo)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.requer_nsu,onChange:N=>C({...m,requer_nsu:N.target.checked})}),e.jsx("span",{className:"text-sm",children:"Requer NSU (nÃºmero de transaÃ§Ã£o)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.permite_parcelamento,onChange:N=>C({...m,permite_parcelamento:N.target.checked})}),e.jsx("span",{className:"text-sm",children:"Permite Parcelamento"})]}),m.permite_parcelamento&&e.jsxs("div",{className:"ml-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"MÃ¡ximo de Parcelas"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",min:"1",max:m.operadora_id&&((p=r.find(N=>N.id===m.operadora_id))==null?void 0:p.max_parcelas)||24,value:m.parcelas_maximas,onChange:N=>{const w=parseInt(N.target.value)||1,S=r.find(W=>W.id===m.operadora_id),P=(S==null?void 0:S.max_parcelas)||24;if(w>P){ce.error(`âŒ Esta operadora permite no mÃ¡ximo ${P}x`);return}C({...m,parcelas_maximas:w})}}),m.operadora_id&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["âš ï¸ Limitado a ",(k=r.find(N=>N.id===m.operadora_id))==null?void 0:k.max_parcelas,"x pela operadora selecionada"]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"ðŸ“Š Taxas EspecÃ­ficas por NÃºmero de Parcelas"}),e.jsxs("p",{className:"text-xs text-blue-700 mb-3",children:["Configure taxas diferentes para cada quantidade de parcelas. Se nÃ£o informado, usa a taxa base (",m.taxa_percentual,"%)."]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-48 overflow-y-auto",children:Array.from({length:m.parcelas_maximas},(N,w)=>w+1).map(N=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"text-xs font-medium text-gray-700 w-10",children:[N,"x:"]}),e.jsx("input",{type:"number",step:"0.01",className:"flex-1 border border-gray-300 rounded px-2 py-1 text-sm",placeholder:m.taxa_percentual,value:m.taxas_por_parcela[N]||"",onChange:w=>{const S={...m.taxas_por_parcela};w.target.value?S[N]=parseFloat(w.target.value):delete S[N],C({...m,taxas_por_parcela:S})}}),e.jsx("span",{className:"text-xs text-gray-500",children:"%"})]},N))})]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.permite_antecipacao,onChange:N=>C({...m,permite_antecipacao:N.target.checked})}),e.jsx("span",{className:"text-sm",children:"Permite AntecipaÃ§Ã£o de RecebÃ­veis"})]}),m.permite_antecipacao&&e.jsxs("div",{className:"ml-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Dias para Recebimento Antecipado"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",min:"0",max:"30",value:m.dias_recebimento_antecipado||"",onChange:N=>C({...m,dias_recebimento_antecipado:parseInt(N.target.value)||null}),placeholder:"Ex: 1 (cai em D+1)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Quantos dias apÃ³s a venda o dinheiro cai na conta com antecipaÃ§Ã£o (geralmente D+1)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa de AntecipaÃ§Ã£o (%) - OPCIONAL"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full border border-gray-300 rounded px-3 py-2",value:m.taxa_antecipacao_percentual||"",onChange:N=>C({...m,taxa_antecipacao_percentual:parseFloat(N.target.value)||null}),placeholder:"Ex: 0.50"}),e.jsxs("div",{className:"mt-2 p-3 bg-amber-50 border border-amber-200 rounded",children:[e.jsx("p",{className:"text-xs text-amber-800 font-semibold mb-1",children:"ðŸ’¡ Duas formas de configurar:"}),e.jsxs("p",{className:"text-xs text-amber-700 mb-1",children:[e.jsx("strong",{children:"1. Com taxa de antecipaÃ§Ã£o:"})," Preencha este campo e a taxa serÃ¡ somada automaticamente Ã s taxas por parcela configuradas acima"]}),e.jsxs("p",{className:"text-xs text-amber-700",children:[e.jsx("strong",{children:"2. Sem taxa de antecipaÃ§Ã£o:"})," Deixe vazio e configure nos campos 1x a 12x acima jÃ¡ com o valor final (taxa normal + antecipaÃ§Ã£o somadas)"]})]})]})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 border-t p-4",children:[e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",onClick:()=>g(!1),children:"Cancelar"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:f,children:"âœ“ Salvar"})]})]})})]})},bm=["ðŸ’³","ðŸ¦","ðŸ’°","ðŸ’µ","ðŸ’¸","ðŸ§","ðŸ’¼","ðŸŽ¯","âš¡","ðŸ”’","âœ¨","ðŸŒŸ","ðŸ“Š","ðŸ’Ž","ðŸŽ","ðŸ”‘","â­","ðŸš€"];function fm(){const[a,t]=n.useState([]),[s,o]=n.useState(!0),[r,i]=n.useState(!1),[l,x]=n.useState(null),[j,g]=n.useState(""),[v,d]=n.useState(!1),[m,C]=n.useState({nome:"",codigo:"",max_parcelas:12,padrao:!1,ativo:!0,api_enabled:!1,api_endpoint:"",api_token_encrypted:"",cor:"#00A868",icone:"ðŸ’³"});n.useEffect(()=>{y()},[]);const y=async()=>{try{o(!0);const h=await F.get("/operadoras-cartao");t(h.data)}catch(h){console.error("Erro ao carregar operadoras:",h),ce.error("Erro ao carregar operadoras de cartÃ£o")}finally{o(!1)}},c=(h=null)=>{h?(C({nome:h.nome,codigo:h.codigo||"",max_parcelas:h.max_parcelas,padrao:h.padrao,ativo:h.ativo,api_enabled:h.api_enabled,api_endpoint:h.api_endpoint||"",api_token_encrypted:h.api_token_encrypted||"",cor:h.cor||"#00A868",icone:h.icone||"ðŸ’³"}),x(h)):(C({nome:"",codigo:"",max_parcelas:12,padrao:!1,ativo:!0,api_enabled:!1,api_endpoint:"",api_token_encrypted:"",cor:"#00A868",icone:"ðŸ’³"}),x(null)),i(!0),g(""),d(!1)},f=async h=>{var p,k,N,w,S,P;if(h.preventDefault(),!m.nome.trim()){ce.error("Nome da operadora Ã© obrigatÃ³rio");return}if(m.max_parcelas<1||m.max_parcelas>24){ce.error("Parcelas devem estar entre 1 e 24");return}try{const W={...m,nome:m.nome.trim(),codigo:((k=(p=m.codigo)==null?void 0:p.trim())==null?void 0:k.toUpperCase())||null,api_endpoint:((N=m.api_endpoint)==null?void 0:N.trim())||null,api_token_encrypted:((w=m.api_token_encrypted)==null?void 0:w.trim())||null};l?(await F.put(`/operadoras-cartao/${l.id}`,W),ce.success("Operadora atualizada com sucesso!")):(await F.post("/operadoras-cartao",W),ce.success("Operadora criada com sucesso!")),i(!1),y()}catch(W){console.error("Erro ao salvar:",W);const te=((P=(S=W.response)==null?void 0:S.data)==null?void 0:P.detail)||"Erro ao salvar operadora";ce.error(te),g(te)}},b=async h=>{var p,k;if(window.confirm("Deseja realmente excluir esta operadora? Ela serÃ¡ desativada se houver vendas vinculadas."))try{await F.delete(`/operadoras-cartao/${h}`),ce.success("Operadora removida com sucesso!"),y()}catch(N){console.error("Erro ao excluir:",N);const w=((k=(p=N.response)==null?void 0:p.data)==null?void 0:k.detail)||"Erro ao excluir operadora";ce.error(w)}},u=()=>{const h=a.find(p=>p.padrao&&p.ativo);return h?e.jsx("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:e.jsx(dl,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-emerald-900",children:"Operadora PadrÃ£o"}),e.jsxs("p",{className:"text-sm text-emerald-700",children:[e.jsx("span",{className:"font-medium",children:h.nome})," serÃ¡ prÃ©-selecionada no PDV"]})]})]})}):null};return s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Operadoras de CartÃ£o"}),e.jsx("p",{className:"text-gray-600",children:"Configure as operadoras de cartÃ£o disponÃ­veis (Stone, Cielo, Rede, Getnet, etc)"})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(La,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-amber-900 mb-1",children:"Importante"}),e.jsxs("ul",{className:"text-sm text-amber-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Pelo menos uma operadora deve estar marcada como padrÃ£o e ativa"}),e.jsx("li",{children:"â€¢ O PDV usarÃ¡ a operadora padrÃ£o automaticamente para vendas com cartÃ£o"}),e.jsx("li",{children:"â€¢ Operadoras com vendas vinculadas nÃ£o podem ser excluÃ­das (apenas desativadas)"})]})]})]})}),u(),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>c(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 transition-colors",children:[e.jsx(us,{className:"w-4 h-4"}),"Nova Operadora"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(h=>{const p=h.icone&&!h.icone.startsWith("Fi")&&!h.icone.startsWith("Bi")?h.icone:"ðŸ’³";return e.jsxs("div",{className:`border rounded-lg p-4 hover:shadow-md transition-shadow ${h.ativo?"bg-white border-gray-200":"bg-gray-50 border-gray-300"} ${h.padrao?"ring-2 ring-emerald-500":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-2xl",style:{backgroundColor:`${h.cor}20`},children:p}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[h.nome,h.padrao&&e.jsx("span",{className:"text-xs bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full",children:"PadrÃ£o"})]}),h.codigo&&e.jsx("p",{className:"text-xs text-gray-500 font-mono",children:h.codigo})]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium ${h.ativo?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"}`,children:h.ativo?"Ativo":"Inativo"})]}),e.jsxs("div",{className:"space-y-2 mb-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Parcelas mÃ¡ximas:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[h.max_parcelas,"x"]})]}),h.api_enabled&&e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-200",children:e.jsxs("span",{className:"text-xs text-blue-600 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-600 rounded-full"}),"API Integrada"]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>c(h),className:"flex-1 bg-blue-50 text-blue-600 px-3 py-2 rounded hover:bg-blue-100 flex items-center justify-center gap-2 transition-colors text-sm",children:[e.jsx(Fo,{className:"w-4 h-4"}),"Editar"]}),e.jsxs("button",{onClick:()=>b(h.id),className:"flex-1 bg-red-50 text-red-600 px-3 py-2 rounded hover:bg-red-100 flex items-center justify-center gap-2 transition-colors text-sm",children:[e.jsx(Es,{className:"w-4 h-4"}),"Excluir"]})]})]},h.id)})}),a.length===0&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx(Ct,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Nenhuma operadora cadastrada"}),e.jsx("p",{className:"text-sm text-gray-500",children:'Clique em "Nova Operadora" para comeÃ§ar'})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between sticky top-0 bg-white z-10",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:l?"Editar Operadora":"Nova Operadora"}),e.jsx("button",{onClick:()=>i(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(pa,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:f,className:"p-6",children:[j&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2",children:[e.jsx(xa,{className:"w-4 h-4 text-red-600 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-red-700",children:j})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"InformaÃ§Ãµes BÃ¡sicas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Operadora *"}),e.jsx("input",{type:"text",value:m.nome,onChange:h=>C({...m,nome:h.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ex: Stone, Cielo, Rede",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CÃ³digo (sigla)"}),e.jsx("input",{type:"text",value:m.codigo,onChange:h=>C({...m,codigo:h.target.value.toUpperCase()}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono",placeholder:"Ex: STONE, CIELO",maxLength:50})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"MÃ¡ximo de Parcelas *"}),e.jsx("input",{type:"number",value:m.max_parcelas,onChange:h=>C({...m,max_parcelas:parseInt(h.target.value)||1}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1",max:"24",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Entre 1 e 24 parcelas"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.padrao,onChange:h=>C({...m,padrao:h.target.checked}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Operadora PadrÃ£o"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.ativo,onChange:h=>C({...m,ativo:h.target.checked}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Ativo"})]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Interface"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cor"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:m.cor,onChange:h=>C({...m,cor:h.target.value}),className:"w-16 h-10 border border-gray-300 rounded cursor-pointer"}),e.jsx("input",{type:"text",value:m.cor,onChange:h=>C({...m,cor:h.target.value}),className:"flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono",placeholder:"#00A868"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ãcone"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:bm.map(h=>e.jsx("button",{type:"button",onClick:()=>C({...m,icone:h}),className:`w-10 h-10 rounded flex items-center justify-center text-xl transition-colors ${m.icone===h?"bg-blue-100 ring-2 ring-blue-500":"bg-gray-100 hover:bg-gray-200"}`,children:h},h))})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"IntegraÃ§Ã£o API (Opcional)"}),e.jsxs("label",{className:"flex items-center gap-2 mb-4 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.api_enabled,onChange:h=>C({...m,api_enabled:h.target.checked}),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Habilitar integraÃ§Ã£o via API"})]}),m.api_enabled&&e.jsxs("div",{className:"space-y-4 pl-6 border-l-2 border-blue-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Endpoint da API"}),e.jsx("input",{type:"url",value:m.api_endpoint,onChange:h=>C({...m,api_endpoint:h.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm",placeholder:"https://api.operadora.com/v1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Token de Acesso"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:v?"text":"password",value:m.api_token_encrypted,onChange:h=>C({...m,api_token_encrypted:h.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm",placeholder:"Token serÃ¡ criptografado ao salvar"}),e.jsx("button",{type:"button",onClick:()=>d(!v),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:v?e.jsx(Tr,{className:"w-4 h-4"}):e.jsx(Ht,{className:"w-4 h-4"})})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 transition-colors",children:[e.jsx(Kt,{className:"w-4 h-4"}),l?"Salvar AlteraÃ§Ãµes":"Criar Operadora"]})]})]})]})})]})}const jm=({isOpen:a,onClose:t,contexto:s})=>{const[o,r]=n.useState([]),[i,l]=n.useState(""),[x,j]=n.useState(!1),g=n.useRef(null);n.useEffect(()=>{a&&o.length===0&&r([{tipo:"ia",conteudo:`OlÃ¡! Sou seu especialista financeiro com IA. Analisando seu ${(s==null?void 0:s.tipo)||"relatÃ³rio"}...

Posso ajudar com:
â€¢ AnÃ¡lise de resultados
â€¢ SugestÃµes de melhoria
â€¢ ComparaÃ§Ãµes de perÃ­odos
â€¢ ProjeÃ§Ãµes financeiras

O que deseja saber?`,timestamp:new Date}])},[a,o.length,s]),n.useEffect(()=>{v()},[o]);const v=()=>{var c;(c=g.current)==null||c.scrollIntoView({behavior:"smooth"})},d=async()=>{if(!i.trim())return;const c={tipo:"usuario",conteudo:i,timestamp:new Date};r(f=>[...f,c]),l(""),j(!0);try{const b={tipo:"ia",conteudo:(await F.post("/ia/chat",{mensagem:i,contexto:s})).data.resposta,timestamp:new Date};r(u=>[...u,b])}catch(f){console.error("Erro ao enviar mensagem:",f);const b={tipo:"ia",conteudo:"Desculpe, houve um erro ao processar sua mensagem. Tente novamente.",timestamp:new Date};r(u=>[...u,b])}finally{j(!1)}},m=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),d())},C=["Como melhorar minha margem de lucro?","Quais sÃ£o os principais gastos?","Compare com o mÃªs anterior","HÃ¡ despesas atÃ­picas?"],y=c=>{l(c)};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl h-[600px] flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-4 rounded-t-2xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white bg-opacity-20 p-2 rounded-lg",children:e.jsx(Cs,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Especialista Financeiro IA"}),e.jsx("p",{className:"text-sm text-purple-100",children:"AnÃ¡lise inteligente dos seus dados"})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(pa,{size:24})})]}),s&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-indigo-200 p-3",children:e.jsxs("div",{className:"text-sm text-indigo-800",children:["ðŸ“Š Analisando: ",e.jsx("span",{className:"font-semibold",children:s.tipo}),s.periodo&&e.jsxs("span",{className:"ml-2",children:["â€¢ ",s.periodo]}),s.valor&&e.jsxs("span",{className:"ml-2",children:["â€¢ Valor: R$ ",s.valor.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[o.map((c,f)=>e.jsx("div",{className:`flex ${c.tipo==="usuario"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-2xl p-4 ${c.tipo==="usuario"?"bg-gradient-to-r from-purple-600 to-indigo-600 text-white":"bg-gray-100 text-gray-800"}`,children:[c.tipo==="ia"&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ul,{size:16,className:"text-purple-600"}),e.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"IA Especialista"})]}),e.jsx("p",{className:"whitespace-pre-wrap",children:c.conteudo}),e.jsx("span",{className:"text-xs opacity-70 mt-2 block",children:c.timestamp.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})})]})},f)),x&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-100 rounded-2xl p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(St,{className:"animate-spin text-purple-600",size:20}),e.jsx("span",{className:"text-gray-600",children:"Analisando..."})]})})}),e.jsx("div",{ref:g})]}),o.length<=1&&e.jsxs("div",{className:"border-t border-gray-200 p-3 bg-gray-50",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2 font-medium",children:"ðŸ’¡ SugestÃµes de perguntas:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:C.map((c,f)=>e.jsx("button",{onClick:()=>y(c),className:"text-xs px-3 py-1.5 bg-white border border-purple-200 text-purple-700 rounded-full hover:bg-purple-50 transition-colors",children:c},f))})]}),e.jsx("div",{className:"border-t border-gray-200 p-4 bg-white rounded-b-2xl",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:i,onChange:c=>l(c.target.value),onKeyPress:m,placeholder:"Digite sua pergunta...",disabled:x,className:"flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent disabled:bg-gray-100"}),e.jsx("button",{onClick:d,disabled:!i.trim()||x,className:"px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl hover:from-purple-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2",children:e.jsx(pl,{size:20})})]})})]})}):null},vm=()=>{const[a,t]=n.useState([]),[s,o]=n.useState(!0),[r,i]=n.useState(30),[l,x]=n.useState({media:0,desvio:0});n.useEffect(()=>{j()},[r]);const j=async()=>{o(!0);try{const c=await g();t(c)}catch(c){console.error("Erro ao carregar projeÃ§Ãµes:",c)}finally{o(!1)}},g=async()=>{const c=new Date,f=new Date;f.setDate(f.getDate()-90);try{const u=(await F.get("/financeiro/movimentacoes",{params:{data_inicio:f.toISOString().split("T")[0],data_fim:c.toISOString().split("T")[0]}})).data,h=v(u,"entrada"),p=v(u,"saida"),k=await d(),N=[];let w=k;for(let S=1;S<=r;S++){const P=new Date;P.setDate(P.getDate()+S);const W=h*(.8+Math.random()*.4),te=p*(.8+Math.random()*.4),D=W,A=te;w=w+D-A;const X=Math.max(95-S*1.5,50);N.push({data:P.toISOString().split("T")[0],dataFormatada:P.toLocaleDateString("pt-BR"),entradasProjetadas:D,saidasProjetadas:A,saldoProjetado:w,nivelConfianca:X,diaSemana:P.toLocaleDateString("pt-BR",{weekday:"short"}),alerta:w<1e3?"crÃ­tico":w<5e3?"atenÃ§Ã£o":null})}return N}catch(b){return console.error("Erro ao gerar projeÃ§Ãµes:",b),[]}},v=(c,f)=>{const b=c.filter(h=>h.tipo===f);return b.length===0?0:b.reduce((h,p)=>h+p.valor,0)/90},d=async()=>{try{return(await F.get("/financeiro/saldo-atual")).data.saldo||1e4}catch(c){return console.error("Erro ao buscar saldo:",c),1e4}},m=c=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c),C=c=>c==="crÃ­tico"?"bg-red-100 border-red-300 text-red-800":c==="atenÃ§Ã£o"?"bg-yellow-100 border-yellow-300 text-yellow-800":"bg-green-50 border-green-200",y=()=>{var f,b,u;const c=[];for(let h=0;h<a.length;h+=7){const p=a.slice(h,h+7),k=p.reduce((S,P)=>S+P.entradasProjetadas,0),N=p.reduce((S,P)=>S+P.saidasProjetadas,0),w=((f=p[p.length-1])==null?void 0:f.saldoProjetado)||0;c.push({numero:Math.floor(h/7)+1,dataInicio:(b=p[0])==null?void 0:b.dataFormatada,dataFim:(u=p[p.length-1])==null?void 0:u.dataFormatada,entradas:k,saidas:N,saldo:N-k,saldoFinal:w})}return c};return s?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Cs,{className:"w-6 h-6 text-purple-600 animate-spin"}),e.jsx("span",{className:"text-gray-600",children:"Calculando projeÃ§Ãµes..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 rounded-lg p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Ta,{className:"w-6 h-6"}),"ProjeÃ§Ãµes de Fluxo de Caixa"]}),e.jsx("p",{className:"text-purple-100 mt-1",children:"PrevisÃµes baseadas em padrÃµes histÃ³ricos e tendÃªncias"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>i(15),className:`px-4 py-2 rounded-lg font-medium transition-colors ${r===15?"bg-white text-purple-600":"bg-purple-500 text-white hover:bg-purple-400"}`,children:"15 dias"}),e.jsx("button",{onClick:()=>i(30),className:`px-4 py-2 rounded-lg font-medium transition-colors ${r===30?"bg-white text-purple-600":"bg-purple-500 text-white hover:bg-purple-400"}`,children:"30 dias"}),e.jsx("button",{onClick:()=>i(60),className:`px-4 py-2 rounded-lg font-medium transition-colors ${r===60?"bg-white text-purple-600":"bg-purple-500 text-white hover:bg-purple-400"}`,children:"60 dias"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Is,{className:"w-5 h-5 text-indigo-600"}),"Resumo Semanal"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:y().map(c=>e.jsxs("div",{className:`border rounded-lg p-4 ${c.saldoFinal<5e3?"border-yellow-300 bg-yellow-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"text-sm font-medium text-gray-600 mb-2",children:["Semana ",c.numero]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-3",children:[c.dataInicio," - ",c.dataFim]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-600",children:"Entradas:"}),e.jsx("span",{className:"font-medium",children:m(c.entradas)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-red-600",children:"SaÃ­das:"}),e.jsx("span",{className:"font-medium",children:m(c.saidas)})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-semibold",children:[e.jsx("span",{children:"Saldo Final:"}),e.jsx("span",{className:c.saldoFinal<5e3?"text-yellow-600":"text-gray-800",children:m(c.saldoFinal)})]})]})]},c.numero))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Oa,{className:"w-5 h-5 text-green-600"}),"ProjeÃ§Ãµes DiÃ¡rias Detalhadas"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:"Data"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:"Dia"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-gray-700",children:"Entradas"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-gray-700",children:"SaÃ­das"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-gray-700",children:"Saldo Projetado"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-semibold text-gray-700",children:"ConfianÃ§a"})]})}),e.jsx("tbody",{children:a.map((c,f)=>e.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 ${c.alerta?C(c.alerta):""}`,children:[e.jsx("td",{className:"py-3 px-4 text-sm",children:c.dataFormatada}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:c.diaSemana}),e.jsx("td",{className:"py-3 px-4 text-sm text-right text-green-600 font-medium",children:m(c.entradasProjetadas)}),e.jsx("td",{className:"py-3 px-4 text-sm text-right text-red-600 font-medium",children:m(c.saidasProjetadas)}),e.jsx("td",{className:"py-3 px-4 text-sm text-right font-semibold",children:m(c.saldoProjetado)}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${c.nivelConfianca>=80?"bg-green-100 text-green-800":c.nivelConfianca>=65?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800"}`,children:[c.nivelConfianca.toFixed(0),"%"]})})]},f))})]})})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(xa,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Sobre as ProjeÃ§Ãµes"}),e.jsx("p",{children:"As projeÃ§Ãµes sÃ£o calculadas com base em padrÃµes histÃ³ricos dos Ãºltimos 90 dias. O nÃ­vel de confianÃ§a diminui com o tempo, pois eventos futuros podem alterar as tendÃªncias."})]})]})]})},ym=()=>{const[a,t]=n.useState([]),[s,o]=n.useState(!0),[r,i]=n.useState("todos");n.useEffect(()=>{l()},[]);const l=async()=>{o(!0);try{const u=await x();t(u)}catch(u){console.error("Erro ao carregar alertas:",u)}finally{o(!1)}},x=async()=>{const u=[],h=new Date;try{const p=await j();p<1e3?u.push({id:"saldo-critico",tipo:"saldo",severidade:"crÃ­tico",titulo:"Saldo CrÃ­tico",mensagem:`Seu saldo estÃ¡ abaixo de R$ 1.000,00. Saldo atual: ${y(p)}`,recomendacao:"Considere adiar pagamentos nÃ£o essenciais ou antecipar recebimentos.",icone:La,data:h.toISOString()}):p<5e3&&u.push({id:"saldo-atencao",tipo:"saldo",severidade:"atenÃ§Ã£o",titulo:"Saldo Baixo",mensagem:`Seu saldo estÃ¡ em nÃ­vel de atenÃ§Ã£o: ${y(p)}`,recomendacao:"Monitore suas despesas e prepare-se para possÃ­veis necessidades de caixa.",icone:xa,data:h.toISOString()});const k=await g(7);if(k.length>0){const W=k.reduce((te,D)=>te+D.valor,0);u.push({id:"vencimentos-proximos",tipo:"vencimento",severidade:"atenÃ§Ã£o",titulo:`${k.length} Pagamentos Vencendo`,mensagem:`VocÃª tem ${k.length} pagamentos vencendo nos prÃ³ximos 7 dias, totalizando ${y(W)}`,recomendacao:"Verifique se hÃ¡ saldo suficiente para cobrir estes pagamentos.",icone:Is,data:h.toISOString(),detalhes:k})}const N=await v();if(N.length>0){const W=N.reduce((te,D)=>te+D.valor,0);u.push({id:"vencimentos-atrasados",tipo:"atraso",severidade:"crÃ­tico",titulo:`${N.length} Pagamentos Atrasados`,mensagem:`VocÃª tem ${N.length} pagamentos em atraso, totalizando ${y(W)}`,recomendacao:"Priorize a quitaÃ§Ã£o destes dÃ©bitos para evitar juros e multas.",icone:La,data:h.toISOString(),detalhes:N})}const w=await d();w.variacao>30&&u.push({id:"gastos-anormais",tipo:"anomalia",severidade:"atenÃ§Ã£o",titulo:"Gastos Acima do Normal",mensagem:`Suas despesas aumentaram ${w.variacao.toFixed(0)}% em relaÃ§Ã£o Ã  mÃ©dia histÃ³rica`,recomendacao:"Revise seus gastos recentes e identifique possÃ­veis despesas extraordinÃ¡rias.",icone:Ta,data:h.toISOString(),detalhes:w});const S=await m();S.length>0&&u.push({id:"recorrencias-pendentes",tipo:"recorrencia",severidade:"info",titulo:"Despesas Recorrentes PrÃ³ximas",mensagem:`${S.length} despesas recorrentes vencerÃ£o em breve`,recomendacao:"Certifique-se de que hÃ¡ saldo para cobrir estas despesas automÃ¡ticas.",icone:tt,data:h.toISOString(),detalhes:S});const P=await C(15);return P.diasAteNegativo>0&&u.push({id:"projecao-negativa",tipo:"projecao",severidade:"crÃ­tico",titulo:"Risco de Saldo Negativo",mensagem:`Com o padrÃ£o atual, seu saldo pode ficar negativo em ${P.diasAteNegativo} dias`,recomendacao:"Tome medidas urgentes para aumentar receitas ou reduzir despesas.",icone:Ha,data:h.toISOString(),detalhes:P}),u.sort((W,te)=>{const D={crÃ­tico:0,atenÃ§Ã£o:1,info:2};return D[W.severidade]-D[te.severidade]})}catch(p){return console.error("Erro ao gerar alertas:",p),[]}},j=async()=>{try{return(await F.get("/financeiro/saldo-atual")).data.saldo||1e4}catch{return 1e4}},g=async u=>{try{const h=new Date,p=new Date;return p.setDate(p.getDate()+u),(await F.get("/financeiro/contas-pagar",{params:{data_inicio:h.toISOString().split("T")[0],data_fim:p.toISOString().split("T")[0],status:"pendente"}})).data||[]}catch{return[]}},v=async()=>{try{return(await F.get("/financeiro/contas-pagar",{params:{atrasadas:!0}})).data||[]}catch{return[]}},d=async()=>{try{const u=new Date,h=new Date;return h.setDate(h.getDate()-30),(await F.get("/financeiro/analise-gastos",{params:{data_inicio:h.toISOString().split("T")[0],data_fim:u.toISOString().split("T")[0]}})).data||{variacao:0}}catch{return{variacao:0}}},m=async()=>{try{return(await F.get("/financeiro/recorrencias-proximas")).data||[]}catch{return[]}},C=async u=>{try{return(await F.get("/ia/fluxo/projecao-saldo",{params:{dias:u}})).data||{diasAteNegativo:0}}catch{return{diasAteNegativo:0}}},y=u=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(u),c=u=>{t(a.filter(h=>h.id!==u))},f=u=>{switch(u){case"crÃ­tico":return{bg:"bg-red-50",border:"border-red-300",text:"text-red-800",badge:"bg-red-100 text-red-800"};case"atenÃ§Ã£o":return{bg:"bg-yellow-50",border:"border-yellow-300",text:"text-yellow-800",badge:"bg-yellow-100 text-yellow-800"};case"info":return{bg:"bg-blue-50",border:"border-blue-300",text:"text-blue-800",badge:"bg-blue-100 text-blue-800"};default:return{bg:"bg-gray-50",border:"border-gray-300",text:"text-gray-800",badge:"bg-gray-100 text-gray-800"}}},b=a.filter(u=>r==="todos"?!0:u.severidade===r);return s?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Cs,{className:"w-6 h-6 text-purple-600 animate-spin"}),e.jsx("span",{className:"text-gray-600",children:"Analisando alertas..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-red-600 rounded-lg p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(La,{className:"w-6 h-6"}),"Alertas Inteligentes"]}),e.jsx("p",{className:"text-orange-100 mt-1",children:"Avisos automÃ¡ticos sobre situaÃ§Ãµes que requerem atenÃ§Ã£o"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>i("todos"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${r==="todos"?"bg-white text-orange-600":"bg-orange-500 text-white hover:bg-orange-400"}`,children:["Todos (",a.length,")"]}),e.jsxs("button",{onClick:()=>i("crÃ­tico"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${r==="crÃ­tico"?"bg-white text-orange-600":"bg-orange-500 text-white hover:bg-orange-400"}`,children:["CrÃ­ticos (",a.filter(u=>u.severidade==="crÃ­tico").length,")"]})]})]})}),b.length===0?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-8 text-center",children:[e.jsx(fa,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),e.jsx("h4",{className:"text-lg font-semibold text-green-800 mb-2",children:"Tudo em ordem!"}),e.jsx("p",{className:"text-green-700",children:"NÃ£o hÃ¡ alertas no momento. Seu fluxo de caixa estÃ¡ saudÃ¡vel."})]}):e.jsx("div",{className:"space-y-4",children:b.map(u=>{const h=f(u.severidade),p=u.icone;return e.jsx("div",{className:`${h.bg} border ${h.border} rounded-lg p-5 transition-all hover:shadow-md`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`${h.text} mt-1`,children:e.jsx(p,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:`font-semibold ${h.text}`,children:u.titulo}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${h.badge}`,children:u.severidade})]}),e.jsx("p",{className:`text-sm mb-3 ${h.text}`,children:u.mensagem}),e.jsxs("div",{className:"bg-white bg-opacity-50 rounded-lg p-3 mb-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"ðŸ’¡ RecomendaÃ§Ã£o:"}),e.jsx("p",{className:"text-sm text-gray-600",children:u.recomendacao})]}),u.detalhes&&e.jsxs("details",{className:"text-sm",children:[e.jsx("summary",{className:"cursor-pointer font-medium text-gray-700 hover:text-gray-900",children:"Ver detalhes"}),e.jsx("div",{className:"mt-2 pl-4 border-l-2 border-gray-300",children:e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap",children:JSON.stringify(u.detalhes,null,2)})})]})]})]}),e.jsx("button",{onClick:()=>c(u.id),className:"ml-4 text-gray-400 hover:text-gray-600 transition-colors",title:"Marcar como resolvido",children:e.jsx(pa,{className:"w-5 h-5"})})]})},u.id)})})]})},Nm=()=>{va();const[a,t]=n.useState(!1),[s,o]=n.useState(null),[r,i]=n.useState("movimentacoes"),[l,x]=n.useState(!1),j=()=>{const A=new Date,X=A.getFullYear(),re=String(A.getMonth()+1).padStart(2,"0"),M=String(A.getDate()).padStart(2,"0");return`${X}-${re}-${M}`},g=()=>{const A=new Date,X=A.getFullYear(),re=String(A.getMonth()+1).padStart(2,"0");return`${X}-${re}-01`},[v,d]=n.useState({data_inicio:g(),data_fim:j(),conta_bancaria_id:null,agrupamento:"dia"}),[m,C]=n.useState("todos"),[y,c]=n.useState("todos"),[f,b]=n.useState([]),[u,h]=n.useState(null),[p,k]=n.useState(!1),[N,w]=n.useState("");n.useEffect(()=>{S(),P()},[]);const S=async()=>{try{const A=await F.get("/contas-bancarias");b(A.data)}catch(A){console.error("Erro ao carregar contas bancÃ¡rias:",A)}},P=async()=>{var A,X;t(!0);try{const re=new URLSearchParams({data_inicio:v.data_inicio,data_fim:v.data_fim,agrupamento:v.agrupamento});v.conta_bancaria_id&&re.append("conta_bancaria_id",v.conta_bancaria_id),N&&re.append("numero_venda",N);const M=await F.get(`/financeiro/fluxo-caixa?${re}`);o(M.data)}catch(re){console.error("Erro ao carregar fluxo de caixa:",re),alert("Erro ao carregar fluxo de caixa: "+(((X=(A=re.response)==null?void 0:A.data)==null?void 0:X.detail)||re.message))}finally{t(!1)}},W=A=>{const X=new Date;let re,M;switch(A){case"7dias":re=new Date(X.setDate(X.getDate()-7)),M=new Date;break;case"30dias":re=new Date(X.setDate(X.getDate()-30)),M=new Date;break;case"mes_atual":re=new Date(X.getFullYear(),X.getMonth(),1),M=new Date(X.getFullYear(),X.getMonth()+1,0);break;case"proximo_mes":re=new Date(X.getFullYear(),X.getMonth()+1,1),M=new Date(X.getFullYear(),X.getMonth()+2,0);break;default:return}const Z={...v,data_inicio:re.toISOString().split("T")[0],data_fim:M.toISOString().split("T")[0]};d(Z),setTimeout(()=>P(),100)},te=A=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(A||0),D=A=>s?s.movimentacoes.filter(X=>{const re=new Date(X.data),M=new Date(A.data_inicio),Z=new Date(A.data_fim);if(!(re>=M&&re<=Z)||m==="entradas"&&X.tipo!=="credito"||m==="saidas"&&X.tipo!=="debito"||y==="realizado"&&X.status!=="realizado"||y==="previsto"&&X.status!=="previsto")return!1;if(N){const J=X.descricao||"",E=X.numero_venda||"",R=N.toLowerCase();return E.toLowerCase().includes(R)||J.toLowerCase().includes(R)}return!0}):[];return a&&!s?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Aa,{className:"animate-spin mx-auto mb-4",size:48}),e.jsx("p",{className:"text-gray-600",children:"Carregando fluxo de caixa..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"ðŸ’¹ Fluxo de Caixa"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"VisÃ£o completa: Previsto vs Realizado"}),e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"âœ¨ Os lanÃ§amentos sÃ£o criados automaticamente a partir de Contas a Pagar e Contas a Receber"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ”¢ Buscar por NÃºmero da Venda"}),e.jsx("input",{type:"text",placeholder:"Digite o nÃºmero da venda (ex: 202601100007) e pressione Enter",className:"w-full px-3 py-2 border border-gray-300 rounded-md",value:N,onChange:A=>w(A.target.value),onKeyPress:A=>{A.key==="Enter"&&P()}})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"VisualizaÃ§Ã£o"}),e.jsxs("select",{value:v.agrupamento,onChange:A=>d({...v,agrupamento:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"dia",children:"ðŸ“… DiÃ¡rio"}),e.jsx("option",{value:"semana",children:"ðŸ“Š Semanal"}),e.jsx("option",{value:"mes",children:"ðŸ“ˆ Mensal"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de MovimentaÃ§Ã£o"}),e.jsxs("select",{value:m,onChange:A=>C(A.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"todos",children:"ðŸ“Š Todas"}),e.jsx("option",{value:"entradas",children:"ðŸ’° Apenas Entradas"}),e.jsx("option",{value:"saidas",children:"ðŸ’¸ Apenas SaÃ­das"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:y,onChange:A=>c(A.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"todos",children:"ðŸ“‹ Todos"}),e.jsx("option",{value:"realizado",children:"âœ… Apenas Realizados"}),e.jsx("option",{value:"previsto",children:"ðŸ“… Apenas Previstos"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:v.data_inicio,onChange:A=>d({...v,data_inicio:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:v.data_fim,onChange:A=>d({...v,data_fim:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Conta BancÃ¡ria"}),e.jsxs("select",{value:v.conta_bancaria_id||"",onChange:A=>d({...v,conta_bancaria_id:A.target.value||null}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Todas as Contas"}),ka(f).map(A=>e.jsx("option",{value:A.id,children:A.nome},A.id))]})]}),e.jsx("div",{className:"flex items-end gap-2",children:e.jsxs("button",{onClick:P,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(Aa,{size:18}),"Atualizar"]})})]}),(m!=="todos"||y!=="todos")&&e.jsxs("div",{className:"mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-blue-800 font-medium",children:"ðŸ” Filtros ativos:"}),m!=="todos"&&e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:m==="entradas"?"ðŸ’° Apenas Entradas":"ðŸ’¸ Apenas SaÃ­das"}),y!=="todos"&&e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:y==="realizado"?"âœ… Apenas Realizados":"ðŸ“… Apenas Previstos"})]}),e.jsx("button",{onClick:()=>{C("todos"),c("todos")},className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Limpar filtros"})]}),e.jsxs("div",{className:"flex gap-2 mt-3 flex-wrap items-center",children:[e.jsx("button",{onClick:()=>W("7dias"),className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded",children:"Ãšltimos 7 dias"}),e.jsx("button",{onClick:()=>W("30dias"),className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded",children:"Ãšltimos 30 dias"}),e.jsx("button",{onClick:()=>W("mes_atual"),className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded",children:"MÃªs Atual"}),e.jsx("button",{onClick:()=>W("proximo_mes"),className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded",children:"PrÃ³ximo MÃªs"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 bg-blue-50 px-3 py-2 rounded border border-blue-200",children:[e.jsx("input",{type:"checkbox",id:"apenasComLancamentos",checked:p,onChange:A=>k(A.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"apenasComLancamentos",className:"text-sm font-medium text-blue-700 cursor-pointer",children:"ðŸ“Š Apenas dias com lanÃ§amentos"})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[e.jsxs("button",{onClick:()=>i("movimentacoes"),className:`flex items-center gap-2 px-6 py-4 border-b-2 font-medium transition-colors ${r==="movimentacoes"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(Oa,{className:"w-5 h-5"}),"MovimentaÃ§Ãµes"]}),e.jsxs("button",{onClick:()=>i("projecoes"),className:`flex items-center gap-2 px-6 py-4 border-b-2 font-medium transition-colors ${r==="projecoes"?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(Qt,{className:"w-5 h-5"}),"ProjeÃ§Ãµes IA",e.jsx(Cs,{className:"w-4 h-4"})]}),e.jsxs("button",{onClick:()=>i("alertas"),className:`flex items-center gap-2 px-6 py-4 border-b-2 font-medium transition-colors ${r==="alertas"?"border-orange-600 text-orange-600":"border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300"}`,children:[e.jsx(La,{className:"w-5 h-5"}),"Alertas IA",e.jsx(Cs,{className:"w-4 h-4"})]})]})})}),r==="projecoes"&&e.jsx(vm,{}),r==="alertas"&&e.jsx(ym,{}),r==="movimentacoes"&&s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Saldo Inicial"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:te(s.saldo_inicial)})]}),e.jsx(Oa,{className:"text-blue-500",size:32})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-4 border-l-4 border-green-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Total Realizado (Entradas)"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:te(s.total_realizado_entradas)}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["Previsto: ",te(s.total_previsto_entradas)]})]}),e.jsx(Ta,{className:"text-green-500",size:32})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg p-4 border-l-4 border-red-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Total Realizado (SaÃ­das)"}),e.jsx("p",{className:"text-2xl font-bold text-red-700",children:te(s.total_realizado_saidas)}),e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Previsto: ",te(s.total_previsto_saidas)]})]}),e.jsx(Ha,{className:"text-red-500",size:32})]})}),e.jsx("div",{className:`rounded-lg p-4 border-l-4 ${s.saldo_final>=0?"bg-blue-50 border-blue-500":"bg-red-50 border-red-500"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:s.saldo_final>=0?"#2563eb":"#dc2626"},children:"Saldo Final Realizado"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:s.saldo_final>=0?"#1d4ed8":"#b91c1c"},children:te(s.saldo_final)}),e.jsxs("p",{className:"text-xs mt-1",style:{color:s.saldo_final>=0?"#2563eb":"#dc2626"},children:["Previsto: ",te(s.saldo_previsto_final)]})]}),e.jsx(Oa,{className:s.saldo_final>=0?"text-blue-500":"text-red-500",size:32})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsxs("thead",{className:"bg-gray-50",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PerÃ­odo"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider bg-green-50",colSpan:"2",children:"ðŸ’° Entradas"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider bg-red-50",colSpan:"2",children:"ðŸ’¸ SaÃ­das"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider bg-blue-50",children:"ðŸ’µ Saldo Final"}),e.jsx("th",{className:"px-6 py-3"})]}),e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"px-6 py-2"}),e.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 bg-green-50",children:"Previsto"}),e.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 bg-green-100",children:"Realizado"}),e.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 bg-red-50",children:"Previsto"}),e.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 bg-red-100",children:"Realizado"}),e.jsx("th",{className:"px-4 py-2 text-xs text-gray-600 bg-blue-50",children:"Real / Previsto"}),e.jsx("th",{className:"px-4 py-2"})]})]}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:ka(s==null?void 0:s.periodos).length>0?ka(s==null?void 0:s.periodos).filter(A=>p?A.realizado_entradas>0||A.realizado_saidas>0||A.previsto_entradas>0||A.previsto_saidas>0:!0).map((A,X)=>{const re=D(A),M=A.data,Z=u===M;return e.jsxs(ms.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:A.data}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-600 text-right bg-green-50",children:te(A.previsto_entradas)}),e.jsx("td",{className:"px-4 py-4 text-sm font-bold text-green-700 text-right bg-green-100",children:te(A.realizado_entradas)}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-600 text-right bg-red-50",children:te(A.previsto_saidas)}),e.jsx("td",{className:"px-4 py-4 text-sm font-bold text-red-700 text-right bg-red-100",children:te(A.realizado_saidas)}),e.jsxs("td",{className:"px-4 py-4 text-sm text-center bg-blue-50",children:[e.jsx("div",{className:`font-bold ${A.realizado_saldo>=0?"text-green-700":"text-red-700"}`,children:te(A.realizado_saldo)}),e.jsxs("div",{className:`text-xs ${A.previsto_saldo>=0?"text-green-600":"text-red-600"}`,children:["Prev: ",te(A.previsto_saldo)]})]}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("button",{onClick:()=>h(Z?null:M),className:"text-blue-600 hover:text-blue-800",children:e.jsx(jt,{size:20,className:`transform transition-transform ${Z?"rotate-90":""}`})})})]}),Z&&re.length>0&&e.jsx("tr",{className:"bg-gray-50",children:e.jsx("td",{colSpan:"7",className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-3",children:"ðŸ“‹ MovimentaÃ§Ãµes Detalhadas"}),ka(re).map(($,J)=>e.jsxs("div",{className:`flex justify-between items-center p-2 rounded ${$.status==="previsto"?"bg-yellow-50 border-l-2 border-yellow-400":"bg-white border-l-2 border-blue-400"}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:$.descricao}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",$.categoria,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded ${$.status==="previsto"?"bg-yellow-200 text-yellow-800":"bg-blue-200 text-blue-800"}`,children:$.status==="previsto"?"ðŸ“… Previsto":"âœ… Realizado"}),e.jsxs("span",{className:`font-bold ${$.tipo==="entrada"?"text-green-600":"text-red-600"}`,children:[$.tipo==="entrada"?"+":"-"," ",te($.valor)]})]})]},J))]})})})]},M)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-8 text-center text-gray-500",children:"Nenhuma movimentaÃ§Ã£o encontrada para o perÃ­odo selecionado"})})})]})})})]})]})};function _m(){const[a,t]=n.useState(!0),[s,o]=n.useState("resumo"),[r,i]=n.useState(new Date().toISOString().split("T")[0]),[l,x]=n.useState(new Date().toISOString().split("T")[0]),[j,g]=n.useState({venda_bruta:0,taxa_entrega:0,desconto:0,venda_liquida:0,em_aberto:0,quantidade_vendas:0}),[v,d]=n.useState([]),[m,C]=n.useState([]),[y,c]=n.useState([]),[f,b]=n.useState([]),[u,h]=n.useState([]),[p,k]=n.useState([]),[N,w]=n.useState([]),S=()=>localStorage.getItem("access_token"),P=D=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(D||0),W=D=>new Date(D).toLocaleDateString("pt-BR"),te=async()=>{var X,re;t(!0);const A={headers:{Authorization:`Bearer ${S()}`},params:{data_inicio:r,data_fim:l}};try{const Z=(await F.get("/vendas/relatorio",A)).data;g(Z.resumo||{}),d(Z.vendas_por_data||[]),C(Z.formas_recebimento||[]),c(Z.vendas_por_funcionario||[]),b(Z.vendas_por_tipo||[]),h(Z.vendas_por_grupo||[]),k(Z.produtos_detalhados||[]),w(Z.lista_vendas||[]),console.log("âœ… Dados carregados:",{vendasPorData:((X=Z.vendas_por_data)==null?void 0:X.length)||0,formasRecebimento:((re=Z.formas_recebimento)==null?void 0:re.length)||0})}catch(M){console.error("Erro ao carregar relatÃ³rio:",M)}finally{t(!1)}};return n.useEffect(()=>{te()},[r,l]),a?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsx("div",{style:{backgroundColor:"red",color:"white",padding:"20px",fontSize:"24px",fontWeight:"bold"},children:"ðŸ”´ TESTE: ARQUIVO ESTÃ SENDO CARREGADO CORRETAMENTE"}),e.jsxs("div",{className:"mb-6 bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Consulta de Vendas"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:r,onChange:D=>i(D.target.value),className:"border rounded px-3 py-2"}),e.jsx("span",{className:"self-center",children:"atÃ©"}),e.jsx("input",{type:"date",value:l,onChange:D=>x(D.target.value),className:"border rounded px-3 py-2"})]})]}),e.jsxs("div",{className:"flex gap-2 border-b",children:[e.jsx("button",{onClick:()=>o("resumo"),className:`px-4 py-2 font-medium ${s==="resumo"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Resumo"}),e.jsx("button",{onClick:()=>o("produtos"),className:`px-4 py-2 font-medium ${s==="produtos"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Totais por produto/serviÃ§o"}),e.jsx("button",{onClick:()=>o("lista"),className:`px-4 py-2 font-medium ${s==="lista"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Lista de Vendas"})]})]}),s==="resumo"&&e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:P(j.venda_bruta)}),e.jsx("div",{className:"text-sm",children:"Venda bruta"})]}),e.jsxs("div",{className:"bg-gray-400 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:P(j.taxa_entrega)}),e.jsx("div",{className:"text-sm",children:"Taxa de entrega"})]}),e.jsxs("div",{className:"bg-yellow-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:P(j.desconto)}),e.jsxs("div",{className:"text-sm",children:[j.percentual_desconto,"% de desconto"]})]}),e.jsxs("div",{className:"bg-blue-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:P(j.venda_liquida)}),e.jsx("div",{className:"text-sm",children:"Venda LÃ­quida"})]}),e.jsxs("div",{className:"bg-red-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:P(j.em_aberto)}),e.jsx("div",{className:"text-sm",children:"Em aberto"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Vendas por data"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Data"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Tkt. MÃ©dio"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Taxa entrega"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"(%)"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. lÃ­quido"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. recebido"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo aberto"})]})}),e.jsxs("tbody",{children:[v.map((D,A)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:W(D.data)}),e.jsx("td",{className:"px-4 py-2 text-right",children:D.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.ticket_medio)}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.taxa_entrega)}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.desconto)}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[D.percentual_desconto,"%"]}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.valor_liquido)}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.valor_recebido)}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.saldo_aberto)})]},A)),v.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:v.reduce((D,A)=>D+A.quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(v.reduce((D,A)=>D+A.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(v.reduce((D,A)=>D+A.taxa_entrega,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(v.reduce((D,A)=>D+A.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(v.reduce((D,A)=>D+A.valor_liquido,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(v.reduce((D,A)=>D+A.valor_recebido,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(v.reduce((D,A)=>D+A.saldo_aberto,0))})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Formas de recebimento"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Forma"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Valor pago"})]})}),e.jsxs("tbody",{children:[m.map((D,A)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:D.forma_pagamento}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.valor_total)})]},A)),m.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(m.reduce((D,A)=>D+A.valor_total,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"FuncionÃ¡rio"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nome"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. lÃ­quido"})]})}),e.jsxs("tbody",{children:[y.map((D,A)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:D.funcionario}),e.jsx("td",{className:"px-4 py-2 text-right",children:D.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.valor_liquido)})]},A)),y.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:y.reduce((D,A)=>D+A.quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(y.reduce((D,A)=>D+A.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(y.reduce((D,A)=>D+A.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(y.reduce((D,A)=>D+A.valor_liquido,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Tipo"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Tipo"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. lÃ­quido"})]})}),e.jsxs("tbody",{children:[f.map((D,A)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:D.tipo}),e.jsx("td",{className:"px-4 py-2 text-right",children:D.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.valor_liquido)})]},A)),f.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:f.reduce((D,A)=>D+A.quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(f.reduce((D,A)=>D+A.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(f.reduce((D,A)=>D+A.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(f.reduce((D,A)=>D+A.valor_liquido,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Grupo de produto"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nome"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Percentual"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. lÃ­quido"})]})}),e.jsxs("tbody",{children:[u.map((D,A)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:D.grupo}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[D.percentual,"%"]}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.valor_liquido)})]},A)),u.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(u.reduce((D,A)=>D+A.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(u.reduce((D,A)=>D+A.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(u.reduce((D,A)=>D+A.valor_liquido,0))})]})]})]})]})]})]}),s==="produtos"&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Produtos/ServiÃ§os"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Produtos/ServiÃ§os"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Itens"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"LÃ­quido"})]})}),e.jsxs("tbody",{children:[p.map((D,A)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"bg-blue-50 font-semibold border-b-2 border-blue-300",children:[e.jsx("td",{className:"px-4 py-2",children:D.categoria}),e.jsx("td",{className:"px-4 py-2 text-right",children:D.total_quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.total_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.total_desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.total_liquido)})]},`cat-${A}`),D.subcategorias&&D.subcategorias.map((X,re)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"bg-gray-50 font-medium border-b",children:[e.jsxs("td",{className:"px-4 py-2 pl-8",children:["ðŸ“ ",X.subcategoria]}),e.jsx("td",{className:"px-4 py-2 text-right",children:X.total_quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(X.total_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(X.total_desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(X.total_liquido)})]},`subcat-${A}-${re}`),X.produtos.map((M,Z)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 pl-12 text-gray-700",children:M.produto}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:M.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:P(M.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:P(M.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:P(M.valor_liquido)})]},`prod-${A}-${re}-${Z}`))]})),D.produtos&&D.produtos.map((X,re)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 pl-8 text-gray-700",children:X.produto}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:X.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:P(X.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:P(X.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:P(X.valor_liquido)})]},`prod-${A}-${re}`))]})),p.length>0&&e.jsxs("tr",{style:{backgroundColor:"#374151",color:"white",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL GERAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:p.reduce((D,A)=>D+A.total_quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(p.reduce((D,A)=>D+A.total_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(p.reduce((D,A)=>D+A.total_desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:P(p.reduce((D,A)=>D+A.total_liquido,0))})]})]})]})})]}),s==="lista"&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Lista de Vendas"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"CÃ³d."}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Data e hora"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Cliente"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Animal"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Valor"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Status"})]})}),e.jsx("tbody",{children:N.map(D=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:D.numero_venda||D.id}),e.jsx("td",{className:"px-4 py-2",children:W(D.data_venda)}),e.jsx("td",{className:"px-4 py-2",children:D.cliente_nome}),e.jsx("td",{className:"px-4 py-2",children:D.pet_nome||"-"}),e.jsx("td",{className:"px-4 py-2 text-right",children:P(D.total)}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${D.status==="finalizada"?"bg-green-100 text-green-800":D.status==="baixa_parcial"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:D.status==="finalizada"?"Baixada":D.status==="baixa_parcial"?"Parcial":"Em aberto"})})]},D.id))})]})})]})]})}function wm(){const[a,t]=n.useState(!1),[s,o]=n.useState("resumo"),[r,i]=n.useState(""),[l,x]=n.useState(""),[j,g]=n.useState(""),[v,d]=n.useState(!1),[m,C]=n.useState("mes_anterior"),[y,c]=n.useState(""),[f,b]=n.useState(""),[u,h]=n.useState(""),[p,k]=n.useState(!0),[N,w]=n.useState("financeiro"),[S,P]=n.useState({venda_bruta:0,taxa_entrega:0,desconto:0,venda_liquida:0,em_aberto:0,quantidade_vendas:0}),[W,te]=n.useState({venda_bruta:0,taxa_entrega:0,desconto:0,venda_liquida:0,em_aberto:0,quantidade_vendas:0}),[D,A]=n.useState([]),[X,re]=n.useState([]),[M,Z]=n.useState([]),[$,J]=n.useState([]),[E,R]=n.useState([]),[K,B]=n.useState([]),[_,O]=n.useState([]),[q,ae]=n.useState(new Set),[H,le]=n.useState([]),[G,ee]=n.useState([]),[de,ue]=n.useState([]),[Ae,se]=n.useState([]),[we,Se]=n.useState({}),[ea,Ie]=n.useState([]),Je=I=>{const Q=new Set(q);Q.has(I)?Q.delete(I):Q.add(I),ae(Q)},be=I=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(I||0),Fe=I=>I==null||isNaN(I)||!isFinite(I)?0:I,he=I=>{if(!I)return"N/A";try{if(I instanceof Date)return I.toLocaleDateString("pt-BR");if(typeof I=="string"&&I.includes("T")){const fe=I.split("T")[0],[U,ie,_e]=fe.split("-");return`${_e}/${ie}/${U}`}const Q=new Date(I);return isNaN(Q.getTime())?"N/A":Q.toLocaleDateString("pt-BR")}catch{return"N/A"}},Qe=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#14B8A6","#F97316"],Ze=(I,Q)=>{if(!I||I.length===0)return I;let fe=[...I];return y&&Q==="funcionario"&&(fe=fe.filter(U=>U.funcionario===y)),f&&Q==="formaPagamento"&&(fe=fe.filter(U=>U.forma_pagamento===f)),u&&Q==="categoria"&&(fe=fe.filter(U=>U.categoria===u)),fe},ma=Ze(X,"formaPagamento"),oa=Ze(M,"funcionario"),ha=Ze(K,"categoria"),da=({titulo:I,valor:Q,icone:fe,cor:U,valorAnterior:ie})=>{const _e=Y(Q,ie),$e=_e.percentual>0,T=_e.percentual===0;return e.jsxs("div",{className:`${U} text-white p-4 rounded-lg shadow`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm opacity-90",children:I}),e.jsx(fe,{className:"w-5 h-5 opacity-80"})]}),e.jsx("div",{className:"text-3xl font-bold mb-1",children:be(Q)}),v&&ie!==void 0&&e.jsxs("div",{className:`flex items-center gap-1 text-sm ${T?"opacity-70":""}`,children:[$e&&e.jsx($s,{className:"w-4 h-4"}),!$e&&!T&&e.jsx(As,{className:"w-4 h-4"}),T&&e.jsx(Gr,{className:"w-4 h-4"}),e.jsxs("span",{children:[Math.abs(_e.percentual),"%"]})]})]})},oe=()=>{switch(m){case"periodo_anterior":return"mesmo perÃ­odo anterior";case"mes_anterior":return"mesmo perÃ­odo do mÃªs anterior";case"ano_anterior":return"mesmo perÃ­odo do ano anterior";default:return"perÃ­odo anterior"}},Ne=async()=>{if(!r||!l){Ee.error("Selecione um perÃ­odo para gerar o relatÃ³rio");return}try{Ee.loading("Gerando PDF...",{id:"pdf"});const I=new URLSearchParams({data_inicio:r,data_fim:l});y&&I.append("funcionario",y),f&&I.append("forma_pagamento",f),u&&I.append("categoria",u);const Q=await F.get(`/relatorios/vendas/export/pdf?${I.toString()}`,{responseType:"blob"}),fe=window.URL.createObjectURL(new Blob([Q.data])),U=document.createElement("a");U.href=fe,U.setAttribute("download",`relatorio_vendas_${r}_${l}.pdf`),document.body.appendChild(U),U.click(),U.remove(),Ee.success("ðŸ“„ PDF exportado com sucesso!",{id:"pdf"})}catch(I){console.error("Erro ao exportar PDF:",I),Ee.error("Erro ao exportar PDF",{id:"pdf"})}},ke=()=>{const I=Us.book_new(),Q=[["RELATÃ“RIO DE VENDAS"],["PerÃ­odo:",`${he(r)} atÃ© ${he(l)}`],[""],["MÃ©trica","Valor"],["Venda Bruta",S.venda_bruta],["Taxa de Entrega",S.taxa_entrega],["Desconto",S.desconto],["Venda LÃ­quida",S.venda_liquida],["Em Aberto",S.em_aberto],["Quantidade de Vendas",S.quantidade_vendas]],fe=Us.aoa_to_sheet(Q);if(Us.book_append_sheet(I,fe,"Resumo"),D.length>0){const T=[["Data","Qtd","Tkt. MÃ©dio","Vl. bruto","Taxa entrega","Desconto","(%)","Vl. lÃ­quido","Vl. recebido","Saldo aberto"],...D.map(pe=>[he(pe.data),pe.quantidade,pe.ticket_medio,pe.valor_bruto,pe.taxa_entrega,pe.desconto,pe.percentual_desconto,pe.valor_liquido,pe.valor_recebido,pe.saldo_aberto])],ne=Us.aoa_to_sheet(T);Us.book_append_sheet(I,ne,"Vendas por Data")}if(ma.length>0){const T=[["Forma","Valor pago"],...ma.map(pe=>[pe.forma_pagamento,pe.valor_total])],ne=Us.aoa_to_sheet(T);Us.book_append_sheet(I,ne,"Formas Pagamento")}const U=Ui(I,{bookType:"xlsx",type:"binary"}),ie=new ArrayBuffer(U.length),_e=new Uint8Array(ie);for(let T=0;T<U.length;T++)_e[T]=U.charCodeAt(T)&255;const $e=`relatorio_vendas_${r}_${l}.xlsx`;Wi.saveAs(new Blob([ie],{type:"application/octet-stream"}),$e)},Ue=I=>{const Q=new Date,fe=Q.getFullYear(),U=String(Q.getMonth()+1).padStart(2,"0"),ie=String(Q.getDate()).padStart(2,"0"),_e=`${fe}-${U}-${ie}`;let $e,T;switch(I){case"hoje":$e=T=_e;break;case"ontem":const ne=new Date(Q);ne.setDate(Q.getDate()-1);const pe=ne.getFullYear(),Pe=String(ne.getMonth()+1).padStart(2,"0"),Be=String(ne.getDate()).padStart(2,"0");$e=T=`${pe}-${Pe}-${Be}`;break;case"esta_semana":const Ke=Q.getDay(),Ge=Ke===0?6:Ke-1,aa=new Date(Q);aa.setDate(Q.getDate()-Ge);const la=aa.getFullYear(),ca=String(aa.getMonth()+1).padStart(2,"0"),We=String(aa.getDate()).padStart(2,"0");$e=`${la}-${ca}-${We}`,T=_e;break;case"este_mes":$e=`${fe}-${U}-01`,T=_e;break;case"mes_anterior":const Sa=new Date(Q.getFullYear(),Q.getMonth()-1,1),V=new Date(Q.getFullYear(),Q.getMonth(),0),Re=Sa.getFullYear(),Oe=String(Sa.getMonth()+1).padStart(2,"0"),He=V.getFullYear(),ga=String(V.getMonth()+1).padStart(2,"0"),xe=String(V.getDate()).padStart(2,"0");$e=`${Re}-${Oe}-01`,T=`${He}-${ga}-${xe}`;break;case"ultimos_7_dias":const De=new Date(Q);De.setDate(Q.getDate()-7);const qe=De.getFullYear(),ta=String(De.getMonth()+1).padStart(2,"0"),Va=String(De.getDate()).padStart(2,"0");$e=`${qe}-${ta}-${Va}`,T=_e;break;case"ultimos_30_dias":const ya=new Date(Q);ya.setDate(Q.getDate()-30);const Pa=ya.getFullYear(),wa=String(ya.getMonth()+1).padStart(2,"0"),os=String(ya.getDate()).padStart(2,"0");$e=`${Pa}-${wa}-${os}`,T=_e;break;case"este_ano":$e=`${fe}-01-01`,T=_e;break;default:return}i($e),x(T),g(I)},ze=()=>{const[I,Q,fe]=r.split("-").map(Number),[U,ie,_e]=l.split("-").map(Number),$e=new Date(I,Q-1,fe),T=new Date(U,ie-1,_e),ne=Math.floor((T-$e)/(1e3*60*60*24))+1;let pe,Pe;switch(m){case"periodo_anterior":pe=new Date($e),pe.setDate($e.getDate()-ne),Pe=new Date($e),Pe.setDate($e.getDate()-1);break;case"mes_anterior":pe=new Date($e),pe.setMonth($e.getMonth()-1),Pe=new Date(T),Pe.setMonth(T.getMonth()-1);break;case"ano_anterior":pe=new Date($e),pe.setFullYear($e.getFullYear()-1),Pe=new Date(T),Pe.setFullYear(T.getFullYear()-1);break;default:return{data_inicio:"",data_fim:""}}const Be=pe.getFullYear(),Ke=String(pe.getMonth()+1).padStart(2,"0"),Ge=String(pe.getDate()).padStart(2,"0"),aa=Pe.getFullYear(),la=String(Pe.getMonth()+1).padStart(2,"0"),ca=String(Pe.getDate()).padStart(2,"0");return{data_inicio:`${Be}-${Ke}-${Ge}`,data_fim:`${aa}-${la}-${ca}`}},Y=(I,Q)=>{if(!Q||Q===0)return{valor:0,percentual:0};const fe=I-Q,U=(fe/Q*100).toFixed(1);return{valor:fe,percentual:parseFloat(U)}},ve=async()=>{if(!(!r||!l)){t(!0);try{const Q=(await F.get("/relatorios/vendas/relatorio",{params:{data_inicio:r,data_fim:l}})).data;if(P(Q.resumo||{}),A(Q.vendas_por_data||[]),re(Q.formas_recebimento||[]),Z(Q.vendas_por_funcionario||[]),J(Q.vendas_por_tipo||[]),R(Q.vendas_por_grupo||[]),B(Q.produtos_detalhados||[]),Ie(Q.produtos_analise||[]),O(Q.lista_vendas||[]),v||s==="comparacao"){const fe=ze(),U=await F.get("/relatorios/vendas/relatorio",{params:fe});te(U.data.resumo||{}),le(U.data.formas_recebimento||[]),ee(U.data.vendas_por_grupo||[]),ue(U.data.vendas_por_funcionario||[])}else te({venda_bruta:0,taxa_entrega:0,desconto:0,venda_liquida:0,em_aberto:0,quantidade_vendas:0})}catch(I){console.error("Erro ao carregar relatÃ³rio:",I)}finally{t(!1)}}},Le=()=>{if(!ea||ea.length===0){se([]),Se({});return}const I=ea.map(U=>{const ie=Fe(U.custo_total),_e=Fe(U.valor_total),$e=Fe(U.quantidade)||1,T=_e-ie,ne=ie>0?T/ie*100:0;return{nome:U.nome||U.produto||"Produto sem nome",marca:U.marca||"-",quantidade:$e,custo:Fe(ie/$e),preco:Fe(_e/$e),lucro_total:Fe(T),margem:Fe(ne),categoria:U.categoria||"Sem Categoria"}}),Q=I.sort((U,ie)=>ie.lucro_total-U.lucro_total).slice(0,20);se(Q);const fe={};I.forEach(U=>{const ie=U.categoria||"Sem Categoria";fe[ie]||(fe[ie]={quantidade:0,total:0,margens:[]}),fe[ie].quantidade+=U.quantidade,fe[ie].total+=U.preco*U.quantidade,fe[ie].margens.push(U.margem)}),Object.keys(fe).forEach(U=>{const ie=fe[U].margens,_e=ie.reduce(($e,T)=>Fe($e)+Fe(T),0);fe[U].margem_media=Fe(ie.length>0?_e/ie.length:0),delete fe[U].margens}),Se(fe)};return n.useEffect(()=>{s==="analise"&&Le()},[ea,s]),n.useEffect(()=>{ve()},[r,l,v,m,s]),n.useEffect(()=>{Ue("este_mes")},[]),a?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"mb-6 bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Consulta de Vendas"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:Ne,disabled:!r||!l,title:r&&l?`Exportar PDF de ${he(r)} atÃ© ${he(l)}`:"Selecione um perÃ­odo",className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:[e.jsx(ss,{className:"w-4 h-4"}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:"Exportar PDF"}),r&&l&&e.jsxs("span",{className:"text-xs opacity-90",children:["(",he(r)," - ",he(l),")"]})]})]}),e.jsxs("button",{onClick:ke,disabled:!r||!l,title:r&&l?`Exportar dados de ${he(r)} atÃ© ${he(l)}`:"Selecione um perÃ­odo",className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:[e.jsx(Gt,{className:"w-4 h-4"}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:"Exportar Excel"}),r&&l&&e.jsxs("span",{className:"text-xs opacity-90",children:["(",he(r)," - ",he(l),")"]})]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:I=>d(I.target.checked),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Comparar com:"})]}),v&&e.jsxs("select",{value:m,onChange:I=>C(I.target.value),className:"border rounded px-3 py-2 text-sm bg-blue-50 font-medium",children:[e.jsx("option",{value:"periodo_anterior",children:"PerÃ­odo imediatamente anterior (mesmo nÂº de dias)"}),e.jsx("option",{value:"mes_anterior",children:"Mesmo perÃ­odo do mÃªs passado"}),e.jsx("option",{value:"ano_anterior",children:"Mesmo perÃ­odo do ano passado"})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:[{id:"hoje",label:"Hoje"},{id:"ontem",label:"Ontem"},{id:"esta_semana",label:"Esta semana"},{id:"este_mes",label:"Este mÃªs"},{id:"mes_anterior",label:"MÃªs anterior"},{id:"ultimos_7_dias",label:"Ãšltimos 7 dias"},{id:"ultimos_30_dias",label:"Ãšltimos 30 dias"},{id:"este_ano",label:"Este ano"},{id:"personalizado",label:"Personalizado"}].map(I=>e.jsx("button",{onClick:()=>{I.id==="personalizado"?g("personalizado"):Ue(I.id)},className:`px-3 py-1 rounded text-sm font-medium transition-colors ${j===I.id?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:I.label},I.id))}),j==="personalizado"&&e.jsxs("div",{className:"flex gap-2 items-center mb-4 p-3 bg-gray-50 rounded",children:[e.jsx(Is,{className:"w-5 h-5 text-gray-500"}),e.jsx("input",{type:"date",value:r,onChange:I=>i(I.target.value),className:"border rounded px-3 py-2"}),e.jsx("span",{className:"text-gray-600",children:"atÃ©"}),e.jsx("input",{type:"date",value:l,onChange:I=>x(I.target.value),className:"border rounded px-3 py-2"})]}),e.jsxs("div",{className:"flex gap-2 items-center mb-4 p-3 bg-blue-50 rounded border border-blue-200",children:[e.jsx(Xt,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtros AvanÃ§ados:"}),e.jsxs("select",{value:y,onChange:I=>c(I.target.value),className:"border rounded px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Todos os funcionÃ¡rios"}),M.map((I,Q)=>e.jsx("option",{value:I.funcionario,children:I.funcionario},Q))]}),e.jsxs("select",{value:f,onChange:I=>b(I.target.value),className:"border rounded px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Todas as formas"}),X.map((I,Q)=>e.jsx("option",{value:I.forma_pagamento,children:I.forma_pagamento},Q))]}),e.jsxs("select",{value:u,onChange:I=>h(I.target.value),className:"border rounded px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Todas as categorias"}),K.map((I,Q)=>e.jsx("option",{value:I.categoria,children:I.categoria},Q))]}),e.jsx("button",{onClick:()=>{c(""),b(""),h("")},className:"px-3 py-2 bg-gray-200 text-gray-700 rounded text-sm hover:bg-gray-300 transition-colors",children:"Limpar Filtros"}),e.jsxs("button",{onClick:()=>k(!p),className:"ml-auto px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(Jt,{className:"w-4 h-4"}),p?"Ocultar":"Mostrar"," GrÃ¡ficos"]})]}),e.jsxs("div",{className:"flex gap-2 border-b",children:[e.jsx("button",{onClick:()=>o("resumo"),className:`px-4 py-2 font-medium ${s==="resumo"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Resumo"}),e.jsx("button",{onClick:()=>o("produtos"),className:`px-4 py-2 font-medium ${s==="produtos"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Totais por produto/serviÃ§o"}),e.jsx("button",{onClick:()=>o("lista"),className:`px-4 py-2 font-medium ${s==="lista"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"Lista de Vendas"}),e.jsx("button",{onClick:()=>o("comparacao"),className:`px-4 py-2 font-medium ${s==="comparacao"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"ComparaÃ§Ã£o de PerÃ­odos"}),e.jsx("button",{onClick:()=>o("analise"),className:`px-4 py-2 font-medium ${s==="analise"?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:"AnÃ¡lise Inteligente"})]})]}),s==="resumo"&&e.jsxs("div",{children:[v&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold text-blue-800",children:"Modo ComparaÃ§Ã£o Ativo:"}),e.jsxs("span",{className:"text-blue-700 ml-2",children:["Comparando ",e.jsxs("span",{className:"font-medium",children:[he(r)," atÃ© ",he(l)]})," com ",e.jsx("span",{className:"font-medium",children:oe()})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-5 gap-4 mb-6",children:[e.jsx(da,{titulo:"Venda Bruta",valor:S.venda_bruta,icone:Oa,cor:"bg-green-500",valorAnterior:W.venda_bruta}),e.jsx(da,{titulo:"Taxa de Entrega",valor:S.taxa_entrega,icone:ls,cor:"bg-gray-400",valorAnterior:W.taxa_entrega}),e.jsx(da,{titulo:"Desconto",valor:S.desconto,icone:Ta,cor:"bg-yellow-500",valorAnterior:W.desconto}),e.jsx(da,{titulo:"Venda LÃ­quida",valor:S.venda_liquida,icone:Oa,cor:"bg-blue-500",valorAnterior:W.venda_liquida}),e.jsx(da,{titulo:"Em Aberto",valor:S.em_aberto,icone:Ct,cor:"bg-red-500",valorAnterior:W.em_aberto})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-orange-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:be(S.custo_total||0)}),e.jsx("div",{className:"text-sm",children:"Custo Total"})]}),e.jsxs("div",{className:"bg-purple-500 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:be(S.taxa_cartao_total||0)}),e.jsx("div",{className:"text-sm",children:"Taxas de CartÃ£o"})]}),e.jsxs("div",{className:"bg-green-600 text-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-3xl font-bold",children:be(S.lucro_total||0)}),e.jsx("div",{className:"text-sm",children:"Lucro Total"})]}),e.jsxs("div",{className:"bg-teal-500 text-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"text-3xl font-bold",children:[S.margem_media||0,"%"]}),e.jsx("div",{className:"text-sm",children:"Margem MÃ©dia"})]})]}),p&&e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Vendas no PerÃ­odo"}),e.jsx(za,{width:"100%",height:300,children:e.jsxs(Et,{data:D,children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ga,{dataKey:"data",tickFormatter:I=>new Date(I).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})}),e.jsx(Ua,{tickFormatter:I=>`R$ ${(I/1e3).toFixed(0)}k`}),e.jsx(Ma,{formatter:I=>be(I),labelFormatter:I=>he(I)}),e.jsx(Wa,{}),e.jsx(gs,{type:"monotone",dataKey:"valor_bruto",stroke:"#3B82F6",strokeWidth:2,name:"Venda Bruta"}),e.jsx(gs,{type:"monotone",dataKey:"valor_liquido",stroke:"#10B981",strokeWidth:2,name:"Venda LÃ­quida"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Formas de Pagamento"}),e.jsx(za,{width:"100%",height:350,children:e.jsxs(bs,{data:ma,layout:"vertical",margin:{top:5,right:30,left:120,bottom:5},children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ga,{type:"number",tickFormatter:I=>be(I)}),e.jsx(Ua,{type:"category",dataKey:"forma_pagamento",width:110,style:{fontSize:"12px"}}),e.jsx(Ma,{formatter:(I,Q,fe)=>{const U=ma.reduce((_e,$e)=>_e+$e.valor_total,0),ie=(I/U*100).toFixed(1);return[`${be(I)} (${ie}%)`,"Valor"]},contentStyle:{backgroundColor:"white",border:"1px solid #ccc",borderRadius:"4px",padding:"8px"}}),e.jsx(Ja,{dataKey:"valor_total",fill:"#3B82F6",radius:[0,8,8,0],label:{position:"right",formatter:I=>{const Q=ma.reduce((U,ie)=>U+ie.valor_total,0);return`${(I/Q*100).toFixed(1)}%`},style:{fontSize:"11px",fontWeight:"bold"}},children:ma.map((I,Q)=>e.jsx(Er,{fill:Qe[Q%Qe.length]},`cell-${Q}`))})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 col-span-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Top 10 Categorias de Produtos"}),e.jsx(za,{width:"100%",height:300,children:e.jsxs(bs,{data:ha.slice(0,10),children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ga,{dataKey:"categoria"}),e.jsx(Ua,{tickFormatter:I=>`R$ ${(I/1e3).toFixed(0)}k`}),e.jsx(Ma,{formatter:I=>be(I)}),e.jsx(Wa,{}),e.jsx(Ja,{dataKey:"total_liquido",fill:"#3B82F6",name:"Valor LÃ­quido"})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Vendas por data"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Data"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Tkt. MÃ©dio"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Taxa entrega"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"(%)"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. lÃ­quido"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. recebido"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo aberto"})]})}),e.jsxs("tbody",{children:[D.map((I,Q)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:he(I.data)}),e.jsx("td",{className:"px-4 py-2 text-right",children:I.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.ticket_medio)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.taxa_entrega)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.desconto)}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[I.percentual_desconto,"%"]}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_liquido)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_recebido)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.saldo_aberto)})]},Q)),D.length>0&&(()=>{const I=D.reduce((_e,$e)=>_e+$e.quantidade,0),Q=D.reduce((_e,$e)=>_e+$e.valor_bruto,0),fe=D.reduce((_e,$e)=>_e+$e.desconto,0),U=I>0?Q/I:0,ie=Q>0?(fe/Q*100).toFixed(1):0;return e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:I}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(U)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(Q)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(D.reduce((_e,$e)=>_e+$e.taxa_entrega,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(fe)}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[ie,"%"]}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(D.reduce((_e,$e)=>_e+$e.valor_liquido,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(D.reduce((_e,$e)=>_e+$e.valor_recebido,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(D.reduce((_e,$e)=>_e+$e.saldo_aberto,0))})]})})()]})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Formas de recebimento"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Forma"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Valor pago"})]})}),e.jsxs("tbody",{children:[X.map((I,Q)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:I.forma_pagamento}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_total)})]},Q)),X.length>0&&e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(X.reduce((I,Q)=>I+Q.valor_total,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"FuncionÃ¡rio"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nome"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. lÃ­quido"})]})}),e.jsxs("tbody",{children:[oa.map((I,Q)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:I.funcionario}),e.jsx("td",{className:"px-4 py-2 text-right",children:I.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_liquido)})]},Q)),oa.length>0&&e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:oa.reduce((I,Q)=>I+Q.quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(oa.reduce((I,Q)=>I+Q.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(oa.reduce((I,Q)=>I+Q.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(oa.reduce((I,Q)=>I+Q.valor_liquido,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Tipo"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Tipo"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. lÃ­quido"})]})}),e.jsxs("tbody",{children:[$.map((I,Q)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:I.tipo}),e.jsx("td",{className:"px-4 py-2 text-right",children:I.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_liquido)})]},Q)),$.length>0&&e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:$.reduce((I,Q)=>I+Q.quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be($.reduce((I,Q)=>I+Q.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be($.reduce((I,Q)=>I+Q.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be($.reduce((I,Q)=>I+Q.valor_liquido,0))})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Grupo de produto"}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Nome"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Percentual"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Vl. lÃ­quido"})]})}),e.jsxs("tbody",{children:[E.map((I,Q)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2",children:I.grupo}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[I.percentual,"%"]}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.valor_liquido)})]},Q)),E.length>0&&e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(E.reduce((I,Q)=>I+Q.valor_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(E.reduce((I,Q)=>I+Q.desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(E.reduce((I,Q)=>I+Q.valor_liquido,0))})]})]})]})]})]})]}),s==="produtos"&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Produtos/ServiÃ§os"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Produtos/ServiÃ§os"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Itens"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Bruto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"LÃ­quido"})]})}),e.jsxs("tbody",{children:[ha.map((I,Q)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"bg-blue-50 font-semibold",children:[e.jsx("td",{className:"px-4 py-2",children:I.categoria}),e.jsx("td",{className:"px-4 py-2 text-right",children:I.total_quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.total_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.total_desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(I.total_liquido)})]},`cat-${Q}`),I.subcategorias&&I.subcategorias.map((fe,U)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"bg-gray-50 font-medium",children:[e.jsx("td",{className:"px-4 py-2 pl-8",children:fe.subcategoria}),e.jsx("td",{className:"px-4 py-2 text-right",children:fe.total_quantidade}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(fe.total_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(fe.total_desconto)}),e.jsx("td",{className:"px-4 py-2 text-right",children:be(fe.total_liquido)})]},`sub-${Q}-${U}`),fe.produtos&&fe.produtos.map((ie,_e)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 pl-12 text-gray-700",children:ie.produto}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:ie.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(ie.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(ie.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(ie.valor_liquido)})]},`prod-${Q}-${U}-${_e}`))]})),I.produtos&&I.produtos.map((fe,U)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 pl-8 text-gray-700",children:fe.produto}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:fe.quantidade}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(fe.valor_bruto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(fe.desconto)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-700",children:be(fe.valor_liquido)})]},`prod-${Q}-${U}`))]})),K.length>0&&e.jsxs("tr",{style:{backgroundColor:"#E5E7EB",color:"#1F2937",fontWeight:"bold"},children:[e.jsx("td",{className:"px-4 py-3",children:"TOTAL GERAL"}),e.jsx("td",{className:"px-4 py-3 text-right",children:K.reduce((I,Q)=>I+Q.total_quantidade,0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(K.reduce((I,Q)=>I+Q.total_bruto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(K.reduce((I,Q)=>I+Q.total_desconto,0))}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(K.reduce((I,Q)=>I+Q.total_liquido,0))})]})]})]})})]}),s==="lista"&&e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-600 text-white px-4 py-2 rounded-t-lg font-semibold",children:"Lista de Vendas com AnÃ¡lise de Rentabilidade"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left w-8"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Data"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"CÃ³digo"}),e.jsx("th",{className:"px-2 py-2 text-left",children:"Cliente"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Venda Bruta"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Desconto"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Taxa Entrega"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Taxa Operac."}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Taxa CartÃ£o"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"ComissÃ£o"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Imposto"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Custo"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"LÃ­quida"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Lucro"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"MG Venda"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"MG Custo"}),e.jsx("th",{className:"px-2 py-2 text-center",children:"Status"})]})}),e.jsx("tbody",{children:_.map(I=>e.jsxs(ms.Fragment,{children:[e.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>Je(I.id),children:[e.jsx("td",{className:"px-2 py-2",children:q.has(I.id)?e.jsx(Ys,{className:"w-4 h-4 text-gray-600"}):e.jsx(jt,{className:"w-4 h-4 text-gray-600"})}),e.jsx("td",{className:"px-2 py-2 whitespace-nowrap",children:he(I.data_venda)}),e.jsx("td",{className:"px-2 py-2",children:I.numero_venda}),e.jsx("td",{className:"px-2 py-2",children:I.cliente_nome}),e.jsx("td",{className:"px-2 py-2 text-right font-medium",children:be(I.venda_bruta)}),e.jsxs("td",{className:"px-2 py-2 text-right text-red-600",children:["-",be(I.desconto)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-blue-600",title:"ComissÃ£o repassada ao entregador",children:["-",be(I.taxa_entrega)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-orange-500",title:"Custo operacional da entrega (empresa)",children:["-",be(I.taxa_operacional||0)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-purple-600",children:["-",be(I.taxa_cartao)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-blue-600",children:["-",be(I.comissao)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-pink-600",title:"Impostos sobre faturamento",children:["-",be(I.imposto||0)]}),e.jsxs("td",{className:"px-2 py-2 text-right text-orange-600",children:["-",be(I.custo_produtos)]}),e.jsx("td",{className:"px-2 py-2 text-right font-medium",children:be(I.venda_liquida)}),e.jsx("td",{className:`px-2 py-2 text-right font-bold ${I.lucro>=0?"text-green-600":"text-red-600"}`,children:be(I.lucro)}),e.jsxs("td",{className:"px-2 py-2 text-right",children:[I.margem_sobre_venda,"%"]}),e.jsxs("td",{className:"px-2 py-2 text-right",children:[I.margem_sobre_custo,"%"]}),e.jsx("td",{className:"px-2 py-2 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${I.status==="finalizada"?"bg-green-100 text-green-800":I.status==="baixa_parcial"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:I.status==="finalizada"?"Baixada":I.status==="baixa_parcial"?"Parcial":"Aberta"})})]}),q.has(I.id)&&I.itens&&I.itens.length>0&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"17",className:"px-4 py-3",children:e.jsxs("div",{className:"pl-8",children:[e.jsx("div",{className:"font-semibold text-gray-700 mb-2",children:"Produtos desta venda:"}),e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-blue-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1 text-left",children:"Produto"}),e.jsx("th",{className:"px-2 py-1 text-center",children:"Qtd"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"PreÃ§o Unit."}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Venda Bruta"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Desconto"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Taxa Entr."}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Taxa Oper."}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Taxa CartÃ£o"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"ComissÃ£o"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Imposto"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Custo Unit."}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Custo Total"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"LÃ­quido"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Lucro"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"MG Venda"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"MG Custo"})]})}),e.jsx("tbody",{children:I.itens.map((Q,fe)=>e.jsxs("tr",{className:"border-b border-blue-200 hover:bg-blue-100",children:[e.jsx("td",{className:"px-2 py-1",children:Q.produto_nome}),e.jsx("td",{className:"px-2 py-1 text-center",children:Q.quantidade}),e.jsx("td",{className:"px-2 py-1 text-right",children:be(Q.preco_unitario)}),e.jsx("td",{className:"px-2 py-1 text-right font-medium",children:be(Q.venda_bruta)}),e.jsxs("td",{className:"px-2 py-1 text-right text-red-600",children:["-",be(Q.desconto)]}),e.jsxs("td",{className:"px-2 py-1 text-right text-blue-600",children:["-",be(Q.taxa_entrega)]}),e.jsxs("td",{className:"px-2 py-1 text-right text-orange-500",children:["-",be(Q.taxa_operacional||0)]}),e.jsxs("td",{className:"px-2 py-1 text-right text-purple-600",children:["-",be(Q.taxa_cartao)]}),e.jsxs("td",{className:"px-2 py-1 text-right text-blue-600",children:["-",be(Q.comissao)]}),e.jsxs("td",{className:"px-2 py-1 text-right text-pink-600",children:["-",be(Q.imposto||0)]}),e.jsx("td",{className:"px-2 py-1 text-right text-orange-600",children:be(Q.custo_unitario)}),e.jsxs("td",{className:"px-2 py-1 text-right text-orange-600 font-medium",children:["-",be(Q.custo_total)]}),e.jsx("td",{className:"px-2 py-1 text-right font-medium",children:be(Q.valor_liquido)}),e.jsx("td",{className:`px-2 py-1 text-right font-bold ${Q.lucro>=0?"text-green-600":"text-red-600"} cursor-help`,title:`Lucro unitÃ¡rio: ${be(Q.lucro_unitario)}`,children:be(Q.lucro)}),e.jsxs("td",{className:"px-2 py-1 text-right cursor-help",title:`Margem unitÃ¡ria: ${Q.margem_sobre_venda}%`,children:[Q.margem_sobre_venda,"%"]}),e.jsxs("td",{className:"px-2 py-1 text-right cursor-help",title:`Markup unitÃ¡rio: ${Q.margem_sobre_custo}%`,children:[Q.margem_sobre_custo,"%"]})]},fe))})]})]})})},`${I.id}-detalhes`)]},I.id))})]})})]}),s==="comparacao"&&e.jsxs("div",{children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Tipo de AnÃ¡lise:"}),e.jsxs("select",{value:N,onChange:I=>w(I.target.value),className:"border rounded px-4 py-2 text-sm bg-blue-50 font-medium min-w-[250px]",children:[e.jsx("option",{value:"financeiro",children:"ðŸ“Š ComparaÃ§Ã£o Financeira"}),e.jsx("option",{value:"formas_pagamento",children:"ðŸ’³ Por Forma de Pagamento"}),e.jsx("option",{value:"produtos",children:"ðŸ“¦ Por Grupo de Produtos"}),e.jsx("option",{value:"funcionarios",children:"ðŸ‘¥ Por FuncionÃ¡rio"})]}),e.jsxs("div",{className:"ml-auto text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"PerÃ­odo Atual:"})," ",he(r)," - ",he(l)]})]})}),N==="financeiro"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border-2 border-gray-300",children:[e.jsxs("div",{className:"bg-gray-500 text-white px-4 py-3 rounded-t-lg",children:[e.jsx("h3",{className:"font-bold text-lg",children:"ðŸ“… PerÃ­odo Anterior"}),e.jsx("p",{className:"text-xs opacity-90 mt-1",children:oe()})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Quantidade de Vendas"}),e.jsx("div",{className:"text-2xl font-bold text-gray-700",children:W.quantidade_vendas||0})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Bruto"}),e.jsx("div",{className:"text-xl font-bold text-gray-700",children:be(W.venda_bruta)})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor LÃ­quido"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:be(W.venda_liquida)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Recebido"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:be(W.venda_liquida-W.em_aberto||0)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border-2 border-blue-500",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-4 py-3 rounded-t-lg",children:[e.jsx("h3",{className:"font-bold text-lg",children:"ðŸ“… PerÃ­odo Atual"}),e.jsxs("p",{className:"text-xs opacity-90 mt-1",children:[he(r)," - ",he(l)]})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Quantidade de Vendas"}),e.jsx("div",{className:"text-2xl font-bold text-gray-700",children:S.quantidade_vendas||0})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Bruto"}),e.jsx("div",{className:"text-xl font-bold text-gray-700",children:be(S.venda_bruta)})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor LÃ­quido"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:be(S.venda_liquida)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Recebido"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:be(S.venda_liquida-S.em_aberto||0)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg border-2 border-green-500",children:[e.jsxs("div",{className:"bg-green-600 text-white px-4 py-3 rounded-t-lg",children:[e.jsx("h3",{className:"font-bold text-lg",children:"ðŸ“ˆ DiferenÃ§a"}),e.jsx("p",{className:"text-xs opacity-90 mt-1",children:"VariaÃ§Ã£o vs perÃ­odo anterior"})]}),e.jsx("div",{className:"p-4 space-y-3",children:(()=>{const I=Y(S.quantidade_vendas,W.quantidade_vendas),Q=Y(S.venda_bruta,W.venda_bruta),fe=Y(S.venda_liquida,W.venda_liquida),U=S.venda_liquida-S.em_aberto,ie=W.venda_liquida-W.em_aberto,_e=Y(U,ie);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Qtd de Vendas"}),e.jsxs("div",{className:`text-2xl font-bold flex items-center gap-2 ${I.percentual>=0?"text-green-600":"text-red-600"}`,children:[I.percentual>=0?e.jsx($s,{className:"w-6 h-6"}):e.jsx(As,{className:"w-6 h-6"}),Math.abs(I.percentual),"%"]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[I.valor>=0?"+":"",I.valor.toFixed(0)," vendas"]})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Bruto"}),e.jsxs("div",{className:`text-xl font-bold flex items-center gap-2 ${Q.percentual>=0?"text-green-600":"text-red-600"}`,children:[Q.percentual>=0?e.jsx($s,{className:"w-5 h-5"}):e.jsx(As,{className:"w-5 h-5"}),Math.abs(Q.percentual),"%"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:be(Q.valor)})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor LÃ­quido"}),e.jsxs("div",{className:`text-xl font-bold flex items-center gap-2 ${fe.percentual>=0?"text-green-600":"text-red-600"}`,children:[fe.percentual>=0?e.jsx($s,{className:"w-5 h-5"}):e.jsx(As,{className:"w-5 h-5"}),Math.abs(fe.percentual),"%"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:be(fe.valor)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Valor Recebido"}),e.jsxs("div",{className:`text-xl font-bold flex items-center gap-2 ${_e.percentual>=0?"text-green-600":"text-red-600"}`,children:[_e.percentual>=0?e.jsx($s,{className:"w-5 h-5"}):e.jsx(As,{className:"w-5 h-5"}),Math.abs(_e.percentual),"%"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:be(_e.valor)})]})]})})()})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ComparaÃ§Ã£o Visual"}),e.jsx(za,{width:"100%",height:300,children:e.jsxs(bs,{data:[{nome:"Qtd Vendas",Anterior:W.quantidade_vendas||0,Atual:S.quantidade_vendas||0},{nome:"Vl. Bruto (mil)",Anterior:(W.venda_bruta||0)/1e3,Atual:(S.venda_bruta||0)/1e3},{nome:"Vl. LÃ­quido (mil)",Anterior:(W.venda_liquida||0)/1e3,Atual:(S.venda_liquida||0)/1e3},{nome:"Vl. Recebido (mil)",Anterior:(W.venda_liquida-W.em_aberto||0)/1e3,Atual:(S.venda_liquida-S.em_aberto||0)/1e3}],children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ga,{dataKey:"nome"}),e.jsx(Ua,{}),e.jsx(Ma,{formatter:(I,Q)=>[Q.includes("mil")?`R$ ${I.toFixed(1)}k`:I.toFixed(0),Q]}),e.jsx(Wa,{}),e.jsx(Ja,{dataKey:"Anterior",fill:"#9CA3AF",name:"PerÃ­odo Anterior"}),e.jsx(Ja,{dataKey:"Atual",fill:"#3B82F6",name:"PerÃ­odo Atual"})]})})]})]}),N==="formas_pagamento"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ComparaÃ§Ã£o por Forma de Pagamento"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Forma de Pagamento"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Anterior"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Atual"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"DiferenÃ§a"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"VariaÃ§Ã£o %"})]})}),e.jsx("tbody",{children:X.map((I,Q)=>{const fe=H.find(ie=>ie.forma_pagamento===I.forma_pagamento)||{valor_total:0},U=Y(I.valor_total,fe.valor_total);return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:I.forma_pagamento}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:be(fe.valor_total)}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:be(I.valor_total)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(U.valor)}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded font-medium ${U.percentual>=0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[U.percentual>=0?e.jsx($s,{className:"w-4 h-4"}):e.jsx(As,{className:"w-4 h-4"}),Math.abs(U.percentual),"%"]})})]},Q)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ComparaÃ§Ã£o Visual"}),e.jsx(za,{width:"100%",height:350,children:e.jsxs(bs,{data:X.map(I=>{var Q;return{nome:I.forma_pagamento,Anterior:(((Q=H.find(fe=>fe.forma_pagamento===I.forma_pagamento))==null?void 0:Q.valor_total)||0)/1e3,Atual:I.valor_total/1e3}}),children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ga,{dataKey:"nome",angle:-15,textAnchor:"end",height:80}),e.jsx(Ua,{tickFormatter:I=>`R$ ${I.toFixed(0)}k`}),e.jsx(Ma,{formatter:I=>`R$ ${I.toFixed(1)}k`}),e.jsx(Wa,{}),e.jsx(Ja,{dataKey:"Anterior",fill:"#9CA3AF",name:"PerÃ­odo Anterior"}),e.jsx(Ja,{dataKey:"Atual",fill:"#10B981",name:"PerÃ­odo Atual"})]})})]})]}),N==="produtos"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ComparaÃ§Ã£o por Grupo de Produtos"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Grupo"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Anterior"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Atual"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"DiferenÃ§a"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"VariaÃ§Ã£o %"})]})}),e.jsx("tbody",{children:E.map((I,Q)=>{const fe=G.find(ie=>ie.grupo===I.grupo)||{valor_liquido:0},U=Y(I.valor_liquido,fe.valor_liquido);return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:I.grupo}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:be(fe.valor_liquido)}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:be(I.valor_liquido)}),e.jsx("td",{className:"px-4 py-3 text-right",children:be(U.valor)}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded font-medium ${U.percentual>=0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[U.percentual>=0?e.jsx($s,{className:"w-4 h-4"}):e.jsx(As,{className:"w-4 h-4"}),Math.abs(U.percentual),"%"]})})]},Q)})})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"PerÃ­odo Anterior"}),e.jsx(za,{width:"100%",height:300,children:e.jsxs(bo,{children:[e.jsx(fo,{data:G,dataKey:"valor_liquido",nameKey:"grupo",cx:"50%",cy:"50%",outerRadius:80,label:I=>{const Q=(I.valor_liquido/G.reduce((fe,U)=>fe+U.valor_liquido,0)*100).toFixed(1);return Q>5?`${Q}%`:""},children:G.map((I,Q)=>e.jsx(Er,{fill:Qe[Q%Qe.length]},`cell-${Q}`))}),e.jsx(Ma,{formatter:I=>be(I)}),e.jsx(Wa,{verticalAlign:"bottom",height:36})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"PerÃ­odo Atual"}),e.jsx(za,{width:"100%",height:300,children:e.jsxs(bo,{children:[e.jsx(fo,{data:E,dataKey:"valor_liquido",nameKey:"grupo",cx:"50%",cy:"50%",outerRadius:80,label:I=>{const Q=(I.valor_liquido/E.reduce((fe,U)=>fe+U.valor_liquido,0)*100).toFixed(1);return Q>5?`${Q}%`:""},children:E.map((I,Q)=>e.jsx(Er,{fill:Qe[Q%Qe.length]},`cell-${Q}`))}),e.jsx(Ma,{formatter:I=>be(I)}),e.jsx(Wa,{verticalAlign:"bottom",height:36})]})})]})]})]}),N==="funcionarios"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ComparaÃ§Ã£o por FuncionÃ¡rio"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"FuncionÃ¡rio"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Qtd Ant."}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Qtd Atual"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Vl. Ant."}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Vl. Atual"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"VariaÃ§Ã£o"})]})}),e.jsx("tbody",{children:M.map((I,Q)=>{const fe=de.find(ie=>ie.funcionario===I.funcionario)||{quantidade:0,valor_liquido:0},U=Y(I.valor_liquido,fe.valor_liquido);return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:I.funcionario}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:fe.quantidade}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:I.quantidade}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:be(fe.valor_liquido)}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:be(I.valor_liquido)}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded font-medium ${U.percentual>=0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[U.percentual>=0?e.jsx($s,{className:"w-4 h-4"}):e.jsx(As,{className:"w-4 h-4"}),Math.abs(U.percentual),"%"]})})]},Q)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ComparaÃ§Ã£o Visual - Valor LÃ­quido"}),e.jsx(za,{width:"100%",height:350,children:e.jsxs(bs,{data:M.map(I=>{var Q;return{nome:I.funcionario,Anterior:(((Q=de.find(fe=>fe.funcionario===I.funcionario))==null?void 0:Q.valor_liquido)||0)/1e3,Atual:I.valor_liquido/1e3}}),children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ga,{dataKey:"nome",angle:-15,textAnchor:"end",height:80}),e.jsx(Ua,{tickFormatter:I=>`R$ ${I.toFixed(0)}k`}),e.jsx(Ma,{formatter:I=>`R$ ${I.toFixed(1)}k`}),e.jsx(Wa,{}),e.jsx(Ja,{dataKey:"Anterior",fill:"#9CA3AF",name:"PerÃ­odo Anterior"}),e.jsx(Ja,{dataKey:"Atual",fill:"#8B5CF6",name:"PerÃ­odo Atual"})]})})]})]})]}),s==="analise"&&e.jsxs("div",{className:"space-y-6",children:[a&&e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("h2",{className:"text-2xl font-bold",children:"AnÃ¡lise Inteligente de Produtos"})]}),e.jsx("p",{className:"text-blue-100",children:"Identifique os produtos mais lucrativos e oportunidades de melhoria no seu mix de produtos"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"ðŸ† Top Produtos por Lucro"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"#"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Produto"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Marca"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Qtd"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Custo Unit."}),e.jsx("th",{className:"text-right py-2 px-2",children:"PreÃ§o Venda"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Margem %"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Lucro Total"})]})}),e.jsx("tbody",{children:Ae.map((I,Q)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-2",children:e.jsx("span",{className:`inline-flex items-center justify-center w-7 h-7 rounded-full text-xs font-bold ${Q===0?"bg-yellow-100 text-yellow-800":Q===1?"bg-gray-100 text-gray-800":Q===2?"bg-orange-100 text-orange-800":"bg-blue-50 text-blue-800"}`,children:Q+1})}),e.jsx("td",{className:"py-3 px-2 font-medium",children:I.nome}),e.jsx("td",{className:"py-3 px-2 text-gray-600",children:I.marca||"-"}),e.jsx("td",{className:"py-3 px-2 text-right",children:Fe(I.quantidade)}),e.jsx("td",{className:"py-3 px-2 text-right text-red-600",children:be(Fe(I.custo))}),e.jsx("td",{className:"py-3 px-2 text-right text-green-600",children:be(Fe(I.preco))}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsxs("span",{className:`inline-block px-2 py-1 rounded text-xs font-semibold ${Fe(I.margem)>=50?"bg-green-100 text-green-800":Fe(I.margem)>=30?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[Fe(I.margem).toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 px-2 text-right font-bold text-green-600",children:be(Fe(I.lucro_total))})]},Q))})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ðŸ“Š Desempenho por Categoria"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(we).map(([I,Q])=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"font-semibold text-gray-800 mb-2",children:I}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Vendas:"}),e.jsx("span",{className:"font-semibold",children:Fe(Q.quantidade)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Faturamento:"}),e.jsx("span",{className:"font-semibold text-green-600",children:be(Fe(Q.total))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Margem MÃ©dia:"}),e.jsxs("span",{className:`font-semibold ${Fe(Q.margem_media)>=40?"text-green-600":Fe(Q.margem_media)>=25?"text-yellow-600":"text-red-600"}`,children:[Fe(Q.margem_media).toFixed(1),"%"]})]})]})]},I))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"âš ï¸ AtenÃ§Ã£o: Margens Baixas"})]}),e.jsxs("div",{className:"space-y-2",children:[Ae.filter(I=>Fe(I.margem)<25).slice(0,5).map((I,Q)=>e.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border-l-4 border-red-500",children:[e.jsx("div",{className:"font-medium text-sm",children:I.nome}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["Margem: ",e.jsxs("span",{className:"font-semibold text-red-600",children:[Fe(I.margem).toFixed(1),"%"]})," - ","Revisar preÃ§o de custo ou venda"]})]},Q)),Ae.filter(I=>Fe(I.margem)<25).length===0&&e.jsx("div",{className:"text-center text-gray-500 py-4",children:"âœ… Nenhum produto com margem crÃ­tica"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"ðŸ’¡ Oportunidades"})]}),e.jsxs("div",{className:"space-y-3",children:[Ae.filter(I=>Fe(I.margem)>=40&&Fe(I.quantidade)<10).slice(0,3).map((I,Q)=>e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx("div",{className:"font-medium text-sm",children:I.nome}),e.jsxs("div",{className:"text-xs text-blue-800 mt-1",children:[e.jsxs("strong",{children:["Alta margem (",Fe(I.margem).toFixed(1),"%)"]})," mas poucas vendas (",Fe(I.quantidade)," un.)",e.jsx("br",{}),"ðŸ’¬ Considere promover este produto"]})]},Q)),Ae.filter(I=>Fe(I.margem)>=40).slice(0,2).map((I,Q)=>e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border-l-4 border-green-500",children:[e.jsx("div",{className:"font-medium text-sm",children:I.nome}),e.jsxs("div",{className:"text-xs text-green-800 mt-1",children:[e.jsx("strong",{children:"â­ CampeÃ£o de vendas"})," com excelente margem",e.jsx("br",{}),"ðŸ’¬ Mantenha em destaque"]})]},`camp-${Q}`))]})]})]}),p&&Ae.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ðŸ“ˆ Margem vs Volume de Vendas"}),e.jsx(za,{width:"100%",height:400,children:e.jsxs(bs,{data:Ae.slice(0,15).map(I=>({...I,margem:Fe(I.margem),quantidade:Fe(I.quantidade)})),children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ga,{dataKey:"nome",angle:-45,textAnchor:"end",height:120,interval:0,tick:{fontSize:11}}),e.jsx(Ua,{yAxisId:"left",orientation:"left",stroke:"#10B981",label:{value:"Margem %",angle:-90,position:"insideLeft"}}),e.jsx(Ua,{yAxisId:"right",orientation:"right",stroke:"#3B82F6",label:{value:"Quantidade",angle:90,position:"insideRight"}}),e.jsx(Ma,{}),e.jsx(Wa,{}),e.jsx(Ja,{yAxisId:"left",dataKey:"margem",fill:"#10B981",name:"Margem %"}),e.jsx(Ja,{yAxisId:"right",dataKey:"quantidade",fill:"#3B82F6",name:"Qtd Vendida"})]})})]})]})]}),"    "]})}const Cm=()=>{const[a,t]=n.useState(!0),[s,o]=n.useState(!1),[r,i]=n.useState(null),[l,x]=n.useState([]),[j,g]=n.useState([]),[v,d]=n.useState([]),[m,C]=n.useState([]),[y,c]=n.useState({campo:null,direcao:"asc"}),[f,b]=n.useState({especies:[],linhas:[],portes:[],fases:[],tratamentos:[],sabores:[],pesos:[],marca_ids:[],categoria_ids:[],margem_min:null,margem_max:null,data_inicio:null,data_fim:null}),[u,h]=n.useState({marcas:[],categorias:[],especies:[],linhas:[],portes:[],fases:[],tratamentos:[],sabores:[],pesos:[]}),[p,k]=n.useState("porte"),[N,w]=n.useState(!0),[S,P]=n.useState("comparacao");n.useEffect(()=>{W()},[]);const W=async()=>{var H,le,G;try{t(!0);const ee=localStorage.getItem("access_token");console.log("ðŸ” [DashboardAnaliseRacoes] Iniciando carregamento de dados",{hasToken:!!ee,tokenPreview:ee?`${ee.substring(0,20)}...`:"NO TOKEN"}),console.log("ðŸ“¡ [DashboardAnaliseRacoes] Chamando: /racoes/analises/opcoes-filtros");const de=await F.get("/racoes/analises/opcoes-filtros");console.log("âœ… [DashboardAnaliseRacoes] OpÃ§Ãµes carregadas:",de.data),h(de.data),await te(),t(!1)}catch(ee){console.error("âŒ [DashboardAnaliseRacoes] Erro ao carregar dados:",{message:ee.message,status:(H=ee.response)==null?void 0:H.status,data:(le=ee.response)==null?void 0:le.data,config:ee.config}),((G=ee.response)==null?void 0:G.status)===403?ce.error("Acesso negado. Verifique suas permissÃµes ou faÃ§a login novamente."):ce.error("Erro ao carregar dados do dashboard"),t(!1)}},te=async(H=null,le=null)=>{try{const G={};H&&(G.data_inicio=H),le&&(G.data_fim=le);const ee=await F.get("/racoes/analises/resumo",{params:G});i(ee.data)}catch(G){console.error("Erro ao carregar resumo:",G),ce.error("Erro ao carregar resumo")}},D=async()=>{try{o(!0);const H=await F.post(`/racoes/analises/margem-por-segmento?tipo_segmento=${p}`,f);x(H.data),o(!1)}catch(H){console.error("Erro ao carregar anÃ¡lise:",H),ce.error("Erro ao carregar anÃ¡lise de segmento"),o(!1)}},A=async()=>{try{o(!0);const H=await F.post("/racoes/analises/comparacao-marcas",f);g(H.data),o(!1)}catch(H){console.error("Erro ao carregar comparaÃ§Ã£o:",H),ce.error("Erro ao carregar comparaÃ§Ã£o de marcas"),o(!1)}},X=async()=>{try{if(!f.data_inicio||!f.data_fim){ce.error("Selecione um perÃ­odo para ver o ranking de vendas");return}o(!0);const H=await F.get("/racoes/analises/ranking-vendas",{params:{data_inicio:f.data_inicio,data_fim:f.data_fim,limite:20}});d(H.data),o(!1)}catch(H){console.error("Erro ao carregar ranking:",H),ce.error("Erro ao carregar ranking de vendas"),o(!1)}},re=async()=>{try{o(!0);const H=await F.post("/racoes/analises/produtos-comparacao",f);C(H.data),c({campo:null,direcao:"asc"}),o(!1)}catch(H){console.error("Erro ao carregar produtos para comparaÃ§Ã£o:",H),ce.error("Erro ao carregar produtos"),o(!1)}},M=H=>{const le=y.campo===H&&y.direcao==="asc"?"desc":"asc";c({campo:H,direcao:le});const G=[...m].sort((ee,de)=>{let ue,Ae;switch(H){case"nome":ue=ee.nome,Ae=de.nome;break;case"custo":ue=ee.preco_custo||0,Ae=de.preco_custo||0;break;case"venda":ue=ee.preco_venda||0,Ae=de.preco_venda||0;break;case"lucro":ue=(ee.preco_venda||0)-(ee.preco_custo||0),Ae=(de.preco_venda||0)-(de.preco_custo||0);break;case"margem":ue=calcularMargem(ee.preco_custo,ee.preco_venda),Ae=calcularMargem(de.preco_custo,de.preco_venda);break;case"roi":ue=calcularROI(ee.preco_custo,ee.preco_venda),Ae=calcularROI(de.preco_custo,de.preco_venda);break;case"custokg":ue=(ee.preco_custo||0)/(ee.peso_embalagem||1),Ae=(de.preco_custo||0)/(de.peso_embalagem||1);break;case"vendakg":ue=(ee.preco_venda||0)/(ee.peso_embalagem||1),Ae=(de.preco_venda||0)/(de.peso_embalagem||1);break;default:return 0}return typeof ue=="string"?le==="asc"?ue.localeCompare(Ae):Ae.localeCompare(ue):le==="asc"?ue-Ae:Ae-ue});C(G)},Z=(H,le)=>{b(G=>({...G,[H]:le}))},$=(H,le)=>{b(G=>{const ee=G[H]||[],de=ee.includes(le);return{...G,[H]:de?ee.filter(ue=>ue!==le):[...ee,le]}})},J=()=>{S==="segmento"?D():S==="marcas"?A():S==="ranking"?X():S==="comparacao"&&re(),f.data_inicio&&f.data_fim&&te(f.data_inicio,f.data_fim)},E=()=>{b({especies:[],linhas:[],portes:[],fases:[],tratamentos:[],sabores:[],pesos:[],marca_ids:[],categoria_ids:[],margem_min:null,margem_max:null,data_inicio:null,data_fim:null})},R=H=>{P(H),H==="segmento"&&l.length===0?D():H==="marcas"&&j.length===0?A():H==="ranking"&&v.length===0?f.data_inicio&&f.data_fim&&X():H==="comparacao"&&m.length===0&&re()},K=()=>r?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ls,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"RaÃ§Ãµes Cadastradas"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:r.total_racoes}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[r.total_classificadas," classificadas (",r.percentual_classificadas,"%)"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(hl,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Margem MÃ©dia"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[r.margem_media_geral,"%"]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["em ",r.total_racoes," produtos"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Oa,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Faturamento PerÃ­odo"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",r.faturamento_periodo.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[r.marcas_cadastradas," marcas ativas"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ri,{className:"h-5 w-5 text-purple-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Mais Vendido"})]}),r.produto_mais_vendido?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 truncate",children:r.produto_mais_vendido.nome}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[r.produto_mais_vendido.quantidade," unidades"]})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Sem dados de vendas"})]})]}):null,B=()=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xt,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Filtros"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:"Clique para selecionar/desmarcar"})]}),e.jsx("button",{onClick:()=>w(!N),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:N?"Ocultar â–²":"Mostrar â–¼"})]}),N&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Marcas"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.marcas.map(H=>e.jsx("button",{onClick:()=>$("marca_ids",H.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${f.marca_ids.includes(H.id)?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:H.nome},H.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Linha de RaÃ§Ã£o"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.linhas.map(H=>e.jsx("button",{onClick:()=>$("linhas",H.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${f.linhas.includes(H.id)?"bg-purple-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:H.nome},H.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Porte do Animal"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.portes.map(H=>e.jsx("button",{onClick:()=>$("portes",H.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${f.portes.includes(H.id)?"bg-green-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:H.nome},H.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Fase/PÃºblico"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.fases.map(H=>e.jsx("button",{onClick:()=>$("fases",H.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${f.fases.includes(H.id)?"bg-amber-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:H.nome},H.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Sabor/ProteÃ­na"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.sabores.map(H=>e.jsx("button",{onClick:()=>$("sabores",H),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${f.sabores.includes(H)?"bg-pink-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:H},H))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Peso da Embalagem"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.pesos.map(H=>e.jsxs("button",{onClick:()=>$("pesos",H),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${f.pesos.includes(H)?"bg-indigo-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[H," kg"]},H))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Margem MÃ­nima (%)"}),e.jsx("input",{type:"number",step:"0.01",value:f.margem_min||"",onChange:H=>Z("margem_min",parseFloat(H.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"Ex: 25"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Margem MÃ¡xima (%)"}),e.jsx("input",{type:"number",step:"0.01",value:f.margem_max||"",onChange:H=>Z("margem_max",parseFloat(H.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"Ex: 50"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:f.data_inicio||"",onChange:H=>Z("data_inicio",H.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:f.data_fim||"",onChange:H=>Z("data_fim",H.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsxs("button",{onClick:J,className:"px-6 py-2.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2 font-medium",children:[e.jsx(Xt,{className:"h-4 w-4"}),"Aplicar Filtros"]}),e.jsx("button",{onClick:E,className:"px-6 py-2.5 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 font-medium",children:"Limpar Tudo"}),f.marca_ids.length+f.linhas.length+f.portes.length+f.fases.length+f.sabores.length+f.pesos.length>0&&e.jsxs("div",{className:"flex items-center gap-2 ml-auto text-sm text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:f.marca_ids.length+f.linhas.length+f.portes.length+f.fases.length+f.sabores.length+f.pesos.length}),"filtros ativos"]})]})]})]}),_=()=>s?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando anÃ¡lise..."}):l.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(xa,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),'Nenhum dado encontrado. Aplique filtros e clique em "Aplicar Filtros"']}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Analisar por:"}),e.jsxs("select",{value:p,onChange:H=>{k(H.target.value),setTimeout(()=>D(),0)},className:"px-3 py-1.5 border border-gray-300 rounded-md text-sm",children:[e.jsx("option",{value:"porte",children:"Porte"}),e.jsx("option",{value:"fase",children:"Fase"}),e.jsx("option",{value:"sabor",children:"Sabor"}),e.jsx("option",{value:"linha",children:"Linha"}),e.jsx("option",{value:"especie",children:"EspÃ©cie"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Segmento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Produtos"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Margem MÃ©dia"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Margem Min/Max"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"PreÃ§o/Kg MÃ©dio"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Faturamento"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:l.map((H,le)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900",children:H.segmento}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:H.total_produtos}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("span",{className:`font-semibold ${H.margem_media>=30?"text-green-600":H.margem_media>=20?"text-yellow-600":"text-red-600"}`,children:[H.margem_media,"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:[H.margem_minima,"% - ",H.margem_maxima,"%"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:["R$ ",H.preco_medio_kg.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center font-semibold text-gray-900",children:["R$ ",H.faturamento.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]},le))})]})})]}),O=()=>s?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando comparaÃ§Ã£o..."}):j.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(xa,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),'Nenhum dado encontrado. Aplique filtros e clique em "Aplicar Filtros"']}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Marca"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Produtos"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"PreÃ§o/Kg MÃ©dio"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Margem MÃ©dia"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Mais Barato"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Mais Caro"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:j.map(H=>{var le,G,ee,de,ue,Ae;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900",children:H.marca_nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:H.total_produtos}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center font-semibold text-gray-900",children:["R$ ",H.preco_medio_kg.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("span",{className:`font-semibold ${H.margem_media>=30?"text-green-600":H.margem_media>=20?"text-yellow-600":"text-red-600"}`,children:[H.margem_media,"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-xs text-gray-700",children:[((G=(le=H.produto_mais_barato)==null?void 0:le.nome)==null?void 0:G.substring(0,30))||"-",((ee=H.produto_mais_barato)==null?void 0:ee.preco_kg)&&e.jsxs("div",{className:"text-green-600 font-semibold",children:["R$ ",H.produto_mais_barato.preco_kg,"/kg"]})]}),e.jsxs("td",{className:"px-4 py-3 text-xs text-gray-700",children:[((ue=(de=H.produto_mais_caro)==null?void 0:de.nome)==null?void 0:ue.substring(0,30))||"-",((Ae=H.produto_mais_caro)==null?void 0:Ae.preco_kg)&&e.jsxs("div",{className:"text-red-600 font-semibold",children:["R$ ",H.produto_mais_caro.preco_kg,"/kg"]})]})]},H.marca_id)})})]})}),q=()=>s?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando ranking..."}):v.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(xa,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),'Selecione um perÃ­odo nos filtros e clique em "Aplicar Filtros"']}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Marca"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Qtd Vendida"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Faturamento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Margem MÃ©dia"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"PreÃ§o MÃ©dio"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:v.map((H,le)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold ${le===0?"bg-yellow-100 text-yellow-700":le===1?"bg-gray-200 text-gray-700":le===2?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-600"}`,children:le+1})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:H.nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:H.marca}),e.jsx("td",{className:"px-4 py-3 text-sm text-center font-semibold text-gray-900",children:H.quantidade_vendida}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center font-semibold text-green-600",children:["R$ ",H.faturamento.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("span",{className:`font-semibold ${H.margem_media>=30?"text-green-600":H.margem_media>=20?"text-yellow-600":"text-red-600"}`,children:[H.margem_media,"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center text-gray-900",children:["R$ ",H.preco_medio_venda.toFixed(2)]})]},H.produto_id))})]})}),ae=()=>{if(s)return e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Aa,{className:"h-8 w-8 animate-spin text-blue-500 mr-3"}),e.jsx("span",{className:"text-gray-600",children:"Carregando produtos..."})]});if(m.length===0)return e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(xa,{className:"h-16 w-16 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Nenhum produto encontrado"}),e.jsx("p",{className:"text-sm",children:'Selecione filtros acima e clique em "Aplicar Filtros"'})]});const H=(he,Qe)=>!Qe||Qe===0?0:parseFloat(((Qe-he)/Qe*100).toFixed(2)),le=(he,Qe)=>!he||he===0?0:parseFloat(((Qe-he)/he*100).toFixed(2)),G=(he,Qe)=>parseFloat((Qe-he).toFixed(2)),ee=(he,Qe)=>!he||he===0?0:parseFloat(((Qe-he)/he*100).toFixed(2)),de=m.map(he=>he.preco_custo||0),ue=m.map(he=>H(he.preco_custo,he.preco_venda)),Ae=m.map(he=>G(he.preco_custo||0,he.preco_venda||0)),se=m.map(he=>ee(he.preco_custo,he.preco_venda)),we=Math.min(...de.filter(he=>he>0)),Se=Math.max(...ue),ea=Math.max(...Ae),Ie=Math.max(...se),Je=(he,Qe,Ze,ma=!1)=>{if(Ze===Qe)return"bg-gray-50";const oa=(he-Qe)/(Ze-Qe)*100;return ma?oa<=20?"bg-green-50 text-green-800 font-semibold":oa<=40?"bg-green-50 text-green-700":oa<=60?"bg-yellow-50 text-yellow-700":oa<=80?"bg-orange-50 text-orange-700":"bg-red-50 text-red-700":oa>=80?"bg-green-50 text-green-800 font-semibold":oa>=60?"bg-green-50 text-green-700":oa>=40?"bg-yellow-50 text-yellow-700":oa>=20?"bg-orange-50 text-orange-700":"bg-red-50 text-red-700"},be=he=>he>=40?"text-green-700 bg-green-100 border-green-300":he>=30?"text-green-600 bg-green-50 border-green-200":he>=20?"text-yellow-600 bg-yellow-50 border-yellow-200":he>=10?"text-orange-600 bg-orange-50 border-orange-200":"text-red-600 bg-red-50 border-red-200",Fe=({campo:he,children:Qe,className:Ze=""})=>e.jsx("th",{onClick:()=>M(he),className:`px-3 py-3 text-xs font-bold text-gray-700 uppercase cursor-pointer hover:bg-gray-200 transition-colors ${Ze}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[Qe,y.campo===he&&e.jsx("span",{className:"text-blue-600",children:y.direcao==="asc"?"â–²":"â–¼"})]})});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4 border-2 border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ’°"}),e.jsx("span",{className:"text-xs font-semibold text-green-700 uppercase",children:"Menor Custo"})]}),e.jsxs("p",{className:"text-2xl font-bold text-green-900",children:["R$ ",we.toFixed(2)]}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Melhor preÃ§o de compra"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border-2 border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:"â­"}),e.jsx("span",{className:"text-xs font-semibold text-blue-700 uppercase",children:"Melhor Margem"})]}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[Se.toFixed(2),"%"]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Maior percentual de lucro"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4 border-2 border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŽ¯"}),e.jsx("span",{className:"text-xs font-semibold text-purple-700 uppercase",children:"Melhor ROI"})]}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900",children:[Ie.toFixed(2),"%"]}),e.jsx("p",{className:"text-xs text-purple-600 mt-1",children:"Retorno sobre investimento"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 rounded-lg p-4 border-2 border-amber-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ’µ"}),e.jsx("span",{className:"text-xs font-semibold text-amber-700 uppercase",children:"Maior Lucro"})]}),e.jsxs("p",{className:"text-2xl font-bold text-amber-900",children:["R$ ",ea.toFixed(2)]}),e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"Lucro absoluto por unidade"})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total de Produtos Encontrados"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:m.length})]}),m.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Margem MÃ©dia"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[(ue.reduce((he,Qe)=>he+Qe,0)/ue.length).toFixed(2),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Custo MÃ©dio/kg"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["R$ ",(m.reduce((he,Qe)=>he+(Qe.preco_custo||0)/(Qe.peso_embalagem||1),0)/m.length).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"PreÃ§o Venda MÃ©dio/kg"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["R$ ",(m.reduce((he,Qe)=>he+(Qe.preco_venda||0)/(Qe.peso_embalagem||1),0)/m.length).toFixed(2)]})]})]})]})}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-start gap-2",children:[e.jsx(xa,{className:"h-5 w-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("strong",{children:"ðŸ’¡ Dica:"})," Clique nos cabeÃ§alhos das colunas para ordenar. As cores indicam valores melhores (verde) e piores (vermelho). Produtos destacados com badges sÃ£o os melhores em cada categoria."]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border-2 border-gray-300 shadow-lg",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{className:"bg-gradient-to-r from-gray-100 to-gray-200 border-b-2 border-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase sticky left-0 bg-gray-100 border-r border-gray-300",children:"Produto / Marca"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-gray-700 uppercase border-r border-gray-300",children:"Linha"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-gray-700 uppercase border-r border-gray-300",children:"Peso"}),e.jsx(Fe,{campo:"custo",className:"border-r border-gray-300",children:"ðŸ’° Custo"}),e.jsx(Fe,{campo:"venda",className:"border-r border-gray-300",children:"ðŸ’µ Venda"}),e.jsx(Fe,{campo:"lucro",className:"border-r border-gray-300",children:"Lucro R$"}),e.jsx(Fe,{campo:"margem",className:"border-r border-gray-300",children:"ðŸ“Š Margem %"}),e.jsx(Fe,{campo:"roi",className:"border-r border-gray-300",children:"ðŸŽ¯ ROI %"}),e.jsx(Fe,{campo:"custokg",className:"border-r border-gray-300",children:"Custo/kg"}),e.jsx(Fe,{campo:"vendakg",className:"border-r border-gray-300",children:"Venda/kg"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-gray-700 uppercase",children:"Estoque"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:m.map(he=>{var ze;const Qe=H(he.preco_custo,he.preco_venda);le(he.preco_custo,he.preco_venda);const Ze=G(he.preco_custo||0,he.preco_venda||0),ma=ee(he.preco_custo,he.preco_venda),oa=(he.preco_custo||0)/(he.peso_embalagem||1),ha=(he.preco_venda||0)/(he.peso_embalagem||1),da=(he.preco_custo||0)===we&&we>0,oe=Qe===Se&&Se>0,Ne=Ze===ea&&ea>0,ke=ma===Ie&&Ie>0,Ue=da||oe||Ne||ke;return e.jsxs("tr",{className:`hover:bg-blue-50 transition-colors ${Ue?"bg-yellow-50 border-l-4 border-yellow-400":""}`,children:[e.jsx("td",{className:"px-4 py-3 sticky left-0 bg-white border-r border-gray-200",children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm",children:he.nome}),e.jsxs("p",{className:"text-xs text-gray-600 mt-0.5",children:[((ze=he.marca)==null?void 0:ze.nome)||"Sem marca"," â€¢ CÃ³d: ",he.codigo]}),e.jsxs("div",{className:"flex gap-1 mt-1.5 flex-wrap",children:[he.porte_animal&&Array.isArray(he.porte_animal)&&he.porte_animal.map(Y=>e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-1.5 py-0.5 rounded",children:Y},Y)),he.fase_publico&&Array.isArray(he.fase_publico)&&he.fase_publico.map(Y=>e.jsx("span",{className:"text-xs bg-amber-100 text-amber-700 px-1.5 py-0.5 rounded",children:Y},Y)),he.sabor_proteina&&e.jsx("span",{className:"text-xs bg-pink-100 text-pink-700 px-1.5 py-0.5 rounded",children:he.sabor_proteina})]}),e.jsxs("div",{className:"flex gap-1 mt-2 flex-wrap",children:[da&&e.jsx("span",{className:"text-xs bg-green-600 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:"ðŸ’° MENOR CUSTO"}),oe&&e.jsx("span",{className:"text-xs bg-blue-600 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:"â­ MELHOR MARGEM"}),ke&&e.jsx("span",{className:"text-xs bg-purple-600 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:"ðŸŽ¯ MELHOR ROI"}),Ne&&e.jsx("span",{className:"text-xs bg-amber-600 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:"ðŸ’µ MAIOR LUCRO"})]})]})}),e.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-700 border-r border-gray-200",children:e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-medium",children:he.classificacao_racao||"-"})}),e.jsx("td",{className:"px-3 py-3 text-sm text-center font-medium text-gray-900 border-r border-gray-200",children:he.peso_embalagem?e.jsxs("span",{className:"px-2 py-1 bg-gray-100 rounded font-bold",children:[he.peso_embalagem," kg"]}):"-"}),e.jsxs("td",{className:`px-3 py-3 text-sm text-center font-bold border-r border-gray-200 ${Je(he.preco_custo||0,we,Math.max(...de),!0)}`,children:["R$ ",(he.preco_custo||0).toFixed(2)]}),e.jsxs("td",{className:`px-3 py-3 text-sm text-center font-bold border-r border-gray-200 ${Je(he.preco_venda||0,Math.min(...m.map(Y=>Y.preco_venda||0)),Math.max(...m.map(Y=>Y.preco_venda||0)))}`,children:["R$ ",(he.preco_venda||0).toFixed(2)]}),e.jsxs("td",{className:`px-3 py-3 text-sm text-center font-bold border-r border-gray-200 ${Je(Ze,Math.min(...Ae),Math.max(...Ae))}`,children:["R$ ",Ze.toFixed(2)]}),e.jsx("td",{className:"px-3 py-3 text-center border-r border-gray-200",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsxs("span",{className:`px-3 py-1.5 rounded-lg font-bold text-sm border-2 ${be(Qe)}`,children:[Qe.toFixed(2),"%"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${Qe>=40?"bg-green-500":Qe>=30?"bg-green-400":Qe>=20?"bg-yellow-400":Qe>=10?"bg-orange-400":"bg-red-400"}`,style:{width:`${Math.min(Qe,100)}%`}})})]})}),e.jsxs("td",{className:`px-3 py-3 text-sm text-center font-bold border-r border-gray-200 ${Je(ma,Math.min(...se),Math.max(...se))}`,children:[ma.toFixed(2),"%"]}),e.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-700 border-r border-gray-200",children:e.jsxs("span",{className:`px-2 py-1 rounded font-semibold ${Je(oa,Math.min(...m.map(Y=>(Y.preco_custo||0)/(Y.peso_embalagem||1))),Math.max(...m.map(Y=>(Y.preco_custo||0)/(Y.peso_embalagem||1))),!0)}`,children:["R$ ",oa.toFixed(2)]})}),e.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-700 border-r border-gray-200",children:e.jsxs("span",{className:`px-2 py-1 rounded font-semibold ${Je(ha,Math.min(...m.map(Y=>(Y.preco_venda||0)/(Y.peso_embalagem||1))),Math.max(...m.map(Y=>(Y.preco_venda||0)/(Y.peso_embalagem||1))))}`,children:["R$ ",ha.toFixed(2)]})}),e.jsx("td",{className:"px-3 py-3 text-sm text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${(he.estoque_atual||0)>10?"bg-green-100 text-green-700 border border-green-300":(he.estoque_atual||0)>0?"bg-yellow-100 text-yellow-700 border border-yellow-300":"bg-red-100 text-red-700 border border-red-300"}`,children:he.estoque_atual||0})})]},he.id)})})]})}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg p-4 border-2 border-gray-300",children:[e.jsxs("p",{className:"text-sm font-bold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“–"})," Legenda e Dicas de InterpretaÃ§Ã£o:"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx("span",{className:"font-bold text-green-700",children:"ðŸŸ¢ Verde:"}),e.jsx("span",{className:"text-gray-700",children:"Valores melhores (menor custo, maior margem/lucro)"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx("span",{className:"font-bold text-red-700",children:"ðŸ”´ Vermelho:"}),e.jsx("span",{className:"text-gray-700",children:"Valores piores (maior custo, menor margem/lucro)"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx("span",{className:"font-bold text-yellow-700",children:"ðŸŸ¡ Amarelo:"}),e.jsx("span",{className:"text-gray-700",children:"Destaque na linha = um dos melhores produtos"})]})]}),e.jsxs("div",{className:"space-y-1.5 text-xs text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Margem %:"})," (Venda - Custo) / Venda Ã— 100"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ROI %:"})," (Lucro / Custo) Ã— 100"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Lucro R$:"})," Venda - Custo (valor absoluto)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Custo/Venda por kg:"})," PreÃ§o dividido pelo peso"]})]})]})]})]})};return a?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Aa,{className:"h-8 w-8 animate-spin text-blue-500"})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Jt,{className:"h-7 w-7 text-blue-600"}),"AnÃ¡lise Inteligente de RaÃ§Ãµes"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Dashboard dinÃ¢mico com anÃ¡lises avanÃ§adas de margem e vendas"})]}),e.jsxs("button",{onClick:()=>W(),className:"px-4 py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(Aa,{className:"h-4 w-4"}),"Atualizar"]})]}),K(),B(),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex space-x-1 p-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>R("comparacao"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${S==="comparacao"?"bg-blue-600 text-white shadow-md":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(gl,{className:"h-4 w-4 inline mr-2"}),"ðŸ“Š ComparaÃ§Ã£o Detalhada"]}),e.jsxs("button",{onClick:()=>R("segmento"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${S==="segmento"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Ta,{className:"h-4 w-4 inline mr-2"}),"Margem por Segmento"]}),e.jsxs("button",{onClick:()=>R("marcas"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${S==="marcas"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(ls,{className:"h-4 w-4 inline mr-2"}),"ComparaÃ§Ã£o de Marcas"]}),e.jsxs("button",{onClick:()=>R("ranking"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${S==="ranking"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(qr,{className:"h-4 w-4 inline mr-2"}),"Ranking de Vendas"]})]})}),e.jsxs("div",{className:"p-4",children:[S==="comparacao"&&ae(),S==="resumo"&&K(),S==="segmento"&&_(),S==="marcas"&&O(),S==="ranking"&&q()]})]})]})},km=()=>{var Z,$,J;const[a,t]=n.useState(!0),[s,o]=n.useState(null),[r,i]=n.useState([]),[l,x]=n.useState([]),[j,g]=n.useState([]),[v,d]=n.useState("resumo"),[m,C]=n.useState(.8),[y,c]=n.useState("porte"),[f,b]=n.useState({}),[u,h]=n.useState({});n.useEffect(()=>{p()},[]);const p=async()=>{try{t(!0);const E=await F.get("/racoes/sugestoes/relatorio-completo");o(E.data),t(!1)}catch(E){console.error("Erro ao carregar relatÃ³rio:",E),ce.error("Erro ao carregar relatÃ³rio de sugestÃµes"),t(!1)}},k=async()=>{try{t(!0);const E=await F.get(`/racoes/sugestoes/duplicatas?threshold_similaridade=${m}`);i(E.data),t(!1)}catch(E){console.error("Erro ao carregar duplicatas:",E),ce.error("Erro ao carregar duplicatas"),t(!1)}},N=async()=>{try{t(!0);const E=await F.get("/racoes/sugestoes/padronizar-nomes?limite=50");x(E.data),t(!1)}catch(E){console.error("Erro ao carregar padronizaÃ§Ãµes:",E),ce.error("Erro ao carregar sugestÃµes de padronizaÃ§Ã£o"),t(!1)}},w=async()=>{try{t(!0);const E=await F.get(`/racoes/sugestoes/gaps-estoque?tipo_segmento=${y}`);g(E.data),t(!1)}catch(E){console.error("Erro ao carregar gaps:",E),ce.error("Erro ao carregar gaps de estoque"),t(!1)}},S=E=>{d(E),E==="duplicatas"&&r.length===0?k():E==="padronizacao"&&l.length===0?N():E==="gaps"&&j.length===0&&w()},P=async E=>{try{const R=u[E.produto_id],K=(R==null?void 0:R.nome)||E.nome_sugerido;await F.patch(`/produtos/${E.produto_id}`,{nome:K}),ce.success("Nome atualizado com sucesso!"),x(B=>B.filter(_=>_.produto_id!==E.produto_id)),h(B=>{const _={...B};return delete _[E.produto_id],_}),p()}catch(R){console.error("Erro ao aplicar padronizaÃ§Ã£o:",R),ce.error("Erro ao atualizar nome do produto")}},W=async E=>{try{await F.post("/racoes/sugestoes/duplicatas/ignorar",null,{params:{produto_id_1:E.produto_1.id,produto_id_2:E.produto_2.id}}),ce.success("Duplicata ignorada com sucesso!"),i(R=>R.filter(K=>!(K.produto_1.id===E.produto_1.id&&K.produto_2.id===E.produto_2.id))),p()}catch(R){console.error("Erro ao ignorar duplicata:",R),ce.error("Erro ao ignorar duplicata")}},te=(E,R)=>{b(K=>({...K,[E]:R}))},D=async(E,R)=>{const K=f[R];if(!K){ce.error("Selecione qual produto deseja manter antes de confirmar");return}const B=K==="produto_1"?E.produto_1.id:E.produto_2.id,_=K==="produto_1"?E.produto_2.id:E.produto_1.id;K==="produto_1"?E.produto_1.nome:E.produto_2.nome,K==="produto_1"?E.produto_2.nome:E.produto_1.nome;try{const O=await F.post("/racoes/sugestoes/duplicatas/mesclar",null,{params:{produto_id_manter:B,produto_id_remover:_,transferir_estoque:!0}});ce.success(O.data.mensagem),i(q=>q.filter(ae=>!(ae.produto_1.id===E.produto_1.id&&ae.produto_2.id===E.produto_2.id))),b(q=>{const ae={...q};return delete ae[R],ae}),p()}catch(O){console.error("Erro ao mesclar produtos:",O),ce.error("Erro ao mesclar produtos")}},A=()=>{if(!s)return null;const{score_saude:E,classificacao:R,cor:K,resumo:B,recomendacoes:_}=s;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Score de SaÃºde do Cadastro"}),e.jsx("button",{onClick:p,className:"text-blue-600 hover:text-blue-700",children:e.jsx(Aa,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:`w-32 h-32 rounded-full flex items-center justify-center border-8 ${K==="green"?"border-green-500":K==="blue"?"border-blue-500":K==="yellow"?"border-yellow-500":"border-red-500"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:E}),e.jsx("div",{className:"text-xs text-gray-600",children:"pontos"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`inline-block px-4 py-2 rounded-full text-white font-semibold mb-3 ${K==="green"?"bg-green-500":K==="blue"?"bg-blue-500":K==="yellow"?"bg-yellow-500":"bg-red-500"}`,children:R}),e.jsxs("p",{className:"text-gray-700 mb-4",children:[E>=90&&"ParabÃ©ns! Seu cadastro de raÃ§Ãµes estÃ¡ excelente.",E>=70&&E<90&&"Seu cadastro estÃ¡ em bom estado, mas hÃ¡ algumas melhorias possÃ­veis.",E>=50&&E<70&&"AtenÃ§Ã£o! Existem vÃ¡rios pontos de melhoria no cadastro.",E<50&&"CRÃTICO! Ã‰ necessÃ¡rio realizar melhorias urgentes no cadastro."]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(jr,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:B.duplicatas_detectadas})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Duplicatas Detectadas"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Sr,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:B.nomes_padronizar})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Nomes para Padronizar"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(mn,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:B.gaps_criticos})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Gaps de Estoque CrÃ­ticos"})]})]}),_&&_.filter(Boolean).length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(xa,{className:"h-5 w-5"}),"RecomendaÃ§Ãµes PrioritÃ¡rias"]}),e.jsx("ul",{className:"space-y-2",children:_.filter(Boolean).map((O,q)=>e.jsxs("li",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),O]},q))})]})]})},X=()=>a?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando..."}):r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fa,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-700 font-semibold",children:"Nenhuma duplicata detectada!"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Seu cadastro estÃ¡ livre de produtos duplicados"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mr-2",children:"Threshold de Similaridade:"}),e.jsx("input",{type:"range",min:"0.5",max:"1",step:"0.05",value:m,onChange:E=>C(parseFloat(E.target.value)),className:"w-32"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:[(m*100).toFixed(0),"%"]})]}),e.jsxs("button",{onClick:k,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(Xs,{className:"h-4 w-4"}),"Buscar Duplicatas"]})]}),r.map((E,R)=>e.jsxs("div",{className:"bg-white border-2 border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(jr,{className:"h-5 w-5 text-orange-500"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["Similaridade: ",(E.score_similaridade*100).toFixed(0),"%"]})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${E.score_similaridade>=.9?"bg-red-100 text-red-700":E.score_similaridade>=.8?"bg-orange-100 text-orange-700":"bg-yellow-100 text-yellow-700"}`,children:E.sugestao_acao})]}),e.jsxs("div",{className:"mb-3 text-sm text-gray-700 bg-blue-50 p-2 rounded",children:["ðŸ‘† ",e.jsx("strong",{children:"Clique no produto que deseja MANTER"})," (o outro serÃ¡ inativado e terÃ¡ o estoque transferido)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{onClick:()=>te(R,"produto_1"),className:`rounded p-3 cursor-pointer transition-all border-2 ${f[R]==="produto_1"?"bg-green-50 border-green-500 shadow-lg":f[R]==="produto_2"?"bg-red-50 border-red-300 opacity-60":"bg-gray-50 border-gray-200 hover:border-blue-400 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Produto 1 (ID: ",E.produto_1.id,")"]}),f[R]==="produto_1"&&e.jsx(fa,{className:"h-5 w-5 text-green-600"})]}),e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:E.produto_1.nome}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Marca: ",E.produto_1.marca]}),e.jsxs("div",{children:["PreÃ§o: R$ ",E.produto_1.preco.toFixed(2)]}),e.jsxs("div",{children:["Estoque: ",E.produto_1.estoque]})]}),f[R]==="produto_1"&&e.jsx("div",{className:"mt-2 text-xs font-semibold text-green-700 bg-green-100 px-2 py-1 rounded",children:"âœ“ ESTE PRODUTO SERÃ MANTIDO"}),f[R]==="produto_2"&&e.jsx("div",{className:"mt-2 text-xs text-red-700 bg-red-100 px-2 py-1 rounded",children:"âœ— Este produto serÃ¡ inativado"})]}),e.jsxs("div",{onClick:()=>te(R,"produto_2"),className:`rounded p-3 cursor-pointer transition-all border-2 ${f[R]==="produto_2"?"bg-green-50 border-green-500 shadow-lg":f[R]==="produto_1"?"bg-red-50 border-red-300 opacity-60":"bg-gray-50 border-gray-200 hover:border-blue-400 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Produto 2 (ID: ",E.produto_2.id,")"]}),f[R]==="produto_2"&&e.jsx(fa,{className:"h-5 w-5 text-green-600"})]}),e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:E.produto_2.nome}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Marca: ",E.produto_2.marca]}),e.jsxs("div",{children:["PreÃ§o: R$ ",E.produto_2.preco.toFixed(2)]}),e.jsxs("div",{children:["Estoque: ",E.produto_2.estoque]})]}),f[R]==="produto_2"&&e.jsx("div",{className:"mt-2 text-xs font-semibold text-green-700 bg-green-100 px-2 py-1 rounded",children:"âœ“ ESTE PRODUTO SERÃ MANTIDO"}),f[R]==="produto_1"&&e.jsx("div",{className:"mt-2 text-xs text-red-700 bg-red-100 px-2 py-1 rounded",children:"âœ— Este produto serÃ¡ inativado"})]})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-1",children:E.razoes.map((K,B)=>e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:K},B))}),e.jsxs("div",{className:"mt-4 flex gap-2 justify-end",children:[e.jsxs("button",{onClick:()=>W(E),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 flex items-center gap-2 text-sm",children:[e.jsx(ys,{className:"h-4 w-4"}),"Ignorar (NÃ£o Ã© Duplicata)"]}),f[R]?e.jsxs("button",{onClick:()=>D(E,R),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center gap-2 text-sm font-semibold shadow-md",children:[e.jsx(fa,{className:"h-4 w-4"}),"Confirmar Mesclagem"]}):e.jsxs("button",{disabled:!0,className:"px-4 py-2 bg-gray-300 text-gray-500 rounded-md flex items-center gap-2 text-sm cursor-not-allowed",children:[e.jsx(jr,{className:"h-4 w-4"}),"Selecione um Produto"]})]})]},R))]}),re=()=>a?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando..."}):l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fa,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-700 font-semibold",children:"Todos os nomes estÃ£o padronizados!"})]}):e.jsx("div",{className:"space-y-3",children:l.map((E,R)=>{var K,B,_,O,q;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:["ID: ",E.produto_id]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Nome Atual:"}),e.jsx("div",{className:"text-sm text-gray-700 bg-gray-50 p-2 rounded",children:E.nome_atual})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-green-700 mb-1",children:"Nome Sugerido:"}),(K=u[E.produto_id])!=null&&K.editando?e.jsx("input",{type:"text",value:((B=u[E.produto_id])==null?void 0:B.nome)||E.nome_sugerido,onChange:ae=>h(H=>({...H,[E.produto_id]:{editando:!0,nome:ae.target.value}})),className:"w-full text-sm text-green-900 bg-green-50 p-2 rounded font-medium border-2 border-blue-400 focus:outline-none focus:border-blue-600",autoFocus:!0}):e.jsx("div",{className:"text-sm text-green-900 bg-green-50 p-2 rounded font-medium",children:((_=u[E.produto_id])==null?void 0:_.nome)||E.nome_sugerido})]})]}),e.jsx("div",{className:"ml-4 flex items-center gap-2",children:e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:[(E.confianca*100).toFixed(0),"% confianÃ§a"]})})]}),e.jsxs("div",{className:"text-xs text-gray-600 mb-3",children:[e.jsx("strong",{children:"RazÃ£o:"})," ",E.razao]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>P(E),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm flex items-center gap-1",children:[e.jsx(fa,{className:"h-4 w-4"}),"Aplicar ",(O=u[E.produto_id])!=null&&O.nome?"EdiÃ§Ã£o":"SugestÃ£o"]}),(q=u[E.produto_id])!=null&&q.editando?e.jsxs("button",{onClick:()=>h(ae=>{const H={...ae};return delete H[E.produto_id],H}),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 text-sm flex items-center gap-1",children:[e.jsx(ys,{className:"h-4 w-4"}),"Cancelar EdiÃ§Ã£o"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>h(ae=>{var H;return{...ae,[E.produto_id]:{editando:!0,nome:((H=u[E.produto_id])==null?void 0:H.nome)||E.nome_sugerido}}}),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm flex items-center gap-1",children:[e.jsx(Sr,{className:"h-4 w-4"}),"Editar"]}),e.jsxs("button",{className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 text-sm flex items-center gap-1",children:[e.jsx(ys,{className:"h-4 w-4"}),"Ignorar"]})]})]})]},R)})}),M=()=>a?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando..."}):j.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fa,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-700 font-semibold",children:"Nenhum gap crÃ­tico de estoque!"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mr-2",children:"Analisar por:"}),e.jsxs("select",{value:y,onChange:E=>c(E.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-md text-sm",children:[e.jsx("option",{value:"porte",children:"Porte"}),e.jsx("option",{value:"fase",children:"Fase"}),e.jsx("option",{value:"sabor",children:"Sabor"}),e.jsx("option",{value:"linha",children:"Linha"}),e.jsx("option",{value:"especie",children:"EspÃ©cie"})]})]}),e.jsxs("button",{onClick:w,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(Xs,{className:"h-4 w-4"}),"Analisar"]})]}),j.map((E,R)=>e.jsxs("div",{className:`rounded-lg p-4 border-2 ${E.importancia==="Alta"?"bg-red-50 border-red-300":E.importancia==="MÃ©dia"?"bg-yellow-50 border-yellow-300":"bg-gray-50 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ha,{className:`h-5 w-5 ${E.importancia==="Alta"?"text-red-600":E.importancia==="MÃ©dia"?"text-yellow-600":"text-gray-600"}`}),e.jsx("span",{className:"font-bold text-gray-900 text-lg",children:E.segmento_valor})]}),e.jsxs("div",{className:"text-sm text-gray-700",children:[E.produtos_sem_estoque," de ",E.total_produtos," produtos sem estoque (",E.percentual_sem_estoque,"%)"]})]}),e.jsx("span",{className:`px-3 py-1 rounded text-xs font-semibold ${E.importancia==="Alta"?"bg-red-600 text-white":E.importancia==="MÃ©dia"?"bg-yellow-500 text-white":"bg-gray-500 text-white"}`,children:E.importancia})]}),e.jsx("div",{className:"bg-white bg-opacity-50 rounded p-3 mb-3",children:e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Faturamento HistÃ³rico (90 dias):"})," R$ ",E.faturamento_historico.toLocaleString("pt-BR",{minimumFractionDigits:2})]})}),e.jsxs("div",{className:`text-sm font-medium ${E.importancia==="Alta"?"text-red-800":E.importancia==="MÃ©dia"?"text-yellow-800":"text-gray-800"}`,children:["ðŸ’¡ ",E.sugestao]})]},R))]});return a&&v==="resumo"?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Aa,{className:"h-8 w-8 animate-spin text-blue-500"})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(xa,{className:"h-7 w-7 text-blue-600"}),"SugestÃµes Inteligentes"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Otimize seu cadastro de raÃ§Ãµes com sugestÃµes automÃ¡ticas"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex space-x-1 p-2",children:[e.jsxs("button",{onClick:()=>S("resumo"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${v==="resumo"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(fa,{className:"h-4 w-4 inline mr-2"}),"Resumo Geral"]}),e.jsxs("button",{onClick:()=>S("duplicatas"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${v==="duplicatas"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(jr,{className:"h-4 w-4 inline mr-2"}),"Duplicatas",((Z=s==null?void 0:s.resumo)==null?void 0:Z.duplicatas_detectadas)>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-orange-500 text-white text-xs rounded-full",children:s.resumo.duplicatas_detectadas})]}),e.jsxs("button",{onClick:()=>S("padronizacao"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${v==="padronizacao"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Sr,{className:"h-4 w-4 inline mr-2"}),"PadronizaÃ§Ã£o",(($=s==null?void 0:s.resumo)==null?void 0:$.nomes_padronizar)>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-blue-500 text-white text-xs rounded-full",children:s.resumo.nomes_padronizar})]}),e.jsxs("button",{onClick:()=>S("gaps"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${v==="gaps"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(mn,{className:"h-4 w-4 inline mr-2"}),"Gaps de Estoque",((J=s==null?void 0:s.resumo)==null?void 0:J.gaps_criticos)>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-red-500 text-white text-xs rounded-full",children:s.resumo.gaps_criticos})]})]})}),e.jsxs("div",{className:"p-4",children:[v==="resumo"&&A(),v==="duplicatas"&&X(),v==="padronizacao"&&re(),v==="gaps"&&M()]})]})]})};function Sm(){const a=va(),[t,s]=n.useState("dashboard"),[o,r]=n.useState([]),[i,l]=n.useState(!1),[x,j]=n.useState(new Set),[g,v]=n.useState({total:0,limite:50,offset:0}),[d,m]=n.useState(""),C=[{value:"",label:"Todas as espÃ©cies"},{value:"dog",label:"CÃ£es"},{value:"cat",label:"Gatos"},{value:"bird",label:"PÃ¡ssaros"},{value:"rodent",label:"Roedores"},{value:"fish",label:"Peixes"}];n.useEffect(()=>{y()},[]),n.useEffect(()=>{t==="alertas"&&c()},[d,t]);const y=async()=>{try{const p=await F.get("/produtos/racao/alertas",{params:{limite:1,offset:0}});v(k=>({...k,total:p.data.total}))}catch(p){console.error("Erro ao carregar contagem de alertas:",p)}},c=async()=>{var p,k,N,w;l(!0);try{const S=localStorage.getItem("access_token");console.log("ðŸ” [AlertasRacao] Iniciando carregamento de alertas",{hasToken:!!S,tokenPreview:S?`${S.substring(0,20)}...`:"NO TOKEN",especieFiltro:d});const P={limite:50,offset:0};d&&(P.especie=d),console.log("ðŸ“¡ [AlertasRacao] Chamando: /produtos/racao/alertas",P);const W=await F.get("/produtos/racao/alertas",{params:P});console.log("âœ… [AlertasRacao] Alertas carregados:",{total:W.data.total,items:(p=W.data.items)==null?void 0:p.length}),r(W.data.items||[]),v({total:W.data.total,limite:W.data.limite,offset:W.data.offset})}catch(S){console.error("âŒ [AlertasRacao] Erro ao carregar alertas:",{message:S.message,status:(k=S.response)==null?void 0:k.status,data:(N=S.response)==null?void 0:N.data,config:S.config}),((w=S.response)==null?void 0:w.status)===403?Ee.error("Acesso negado. Verifique suas permissÃµes ou faÃ§a login novamente."):Ee.error("Erro ao carregar alertas de raÃ§Ãµes")}finally{l(!1)}},f=async p=>{j(k=>new Set(k).add(p));try{const k=await F.post(`/produtos/${p}/classificar-ia`,null,{params:{forcar:!0}});Ee.success(`${k.data.campos_atualizados.length} campos classificados! Score: ${k.data.confianca.score}%`,{duration:4e3}),r(N=>N.filter(w=>w.id!==p)),v(N=>({...N,total:N.total-1}))}catch(k){console.error("Erro ao classificar produto:",k),Ee.error("Erro ao classificar produto")}finally{j(k=>{const N=new Set(k);return N.delete(p),N})}},b=async()=>{l(!0);try{const p=await F.post("/produtos/classificar-lote",null,{params:{apenas_sem_classificacao:!0}});Ee.success(`${p.data.sucessos} produtos classificados com sucesso!`,{duration:5e3}),p.data.erros>0&&Ee.error(`${p.data.erros} produtos com erro na classificaÃ§Ã£o`),await c()}catch(p){console.error("Erro ao classificar lote:",p),Ee.error("Erro ao classificar produtos em lote")}finally{l(!1)}},u=p=>p>=75?{cor:"text-yellow-600 bg-yellow-50",texto:"Quase completo"}:p>=50?{cor:"text-orange-600 bg-orange-50",texto:"Incompleto"}:{cor:"text-red-600 bg-red-50",texto:"Muito incompleto"},h=p=>({porte_animal:"Porte",fase_publico:"Fase",sabor_proteina:"Sabor/ProteÃ­na",peso_embalagem:"Peso"})[p]||p;return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(La,{className:"w-8 h-8 text-amber-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Sistema Inteligente de RaÃ§Ãµes"})]}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>s("dashboard"),className:`px-6 py-3 font-medium text-sm transition-colors relative ${t==="dashboard"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Jt,{className:"w-4 h-4"}),"Dashboard de AnÃ¡lise"]})}),e.jsx("button",{onClick:()=>s("alertas"),className:`px-6 py-3 font-medium text-sm transition-colors relative ${t==="alertas"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(La,{className:"w-4 h-4"}),"Alertas de ClassificaÃ§Ã£o",g.total>0&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-red-500 text-white rounded-full",children:g.total})]})}),e.jsx("button",{onClick:()=>s("sugestoes"),className:`px-6 py-3 font-medium text-sm transition-colors relative ${t==="sugestoes"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bl,{className:"w-4 h-4"}),"SugestÃµes Inteligentes"]})})]})]}),t==="dashboard"&&e.jsx(Cm,{}),t==="sugestoes"&&e.jsx(km,{}),t==="alertas"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-gray-600",children:"Produtos classificados como raÃ§Ã£o mas sem informaÃ§Ãµes completas"}),e.jsxs("button",{onClick:b,disabled:i||o.length===0,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition",children:[e.jsx(Aa,{className:`w-4 h-4 ${i?"animate-spin":""}`}),"Classificar Todos"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Filtrar por:"}),e.jsx("select",{value:d,onChange:p=>m(p.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:C.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))}),d&&e.jsx("button",{onClick:()=>m(""),className:"text-sm text-indigo-600 hover:text-indigo-800",children:"Limpar filtro"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-red-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Alertas"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:g.total})]}),e.jsx(La,{className:"w-10 h-10 text-red-500 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-amber-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nesta PÃ¡gina"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:o.length})]}),e.jsx($i,{className:"w-10 h-10 text-amber-500 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-green-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Completude MÃ©dia"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[o.length>0?Math.round(o.reduce((p,k)=>p+k.completude,0)/o.length):0,"%"]})]}),e.jsx(fa,{className:"w-10 h-10 text-green-500 opacity-20"})]})})]}),i&&o.length===0&&e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Aa,{className:"w-8 h-8 animate-spin text-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando alertas..."})]}),!i&&o.length===0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-8 text-center",children:[e.jsx(fa,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-green-800 mb-2",children:"Nenhum alerta encontrado!"}),e.jsx("p",{className:"text-green-700",children:"Todas as raÃ§Ãµes cadastradas possuem informaÃ§Ãµes completas."})]}),o.length>0&&e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CÃ³digo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Categoria / Marca"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Campos Faltantes"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Completude"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map(p=>{var w;const k=u(p.completude),N=x.has(p.id);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-mono",children:p.codigo}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"max-w-md",children:[e.jsx("p",{className:"font-medium",children:p.nome}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[p.classificacao_racao&&e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:p.classificacao_racao}),p.especies_indicadas&&e.jsx("span",{className:"text-xs text-white bg-indigo-600 px-2 py-1 rounded",children:((w=C.find(S=>S.value===p.especies_indicadas))==null?void 0:w.label)||p.especies_indicadas})]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-700",children:p.categoria||"-"}),e.jsx("div",{className:"text-xs text-gray-500",children:p.marca||"-"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:p.campos_faltantes.map(S=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-red-100 text-red-800 text-xs rounded",children:[e.jsx(ys,{className:"w-3 h-3"}),h(S)]},S))})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${k.cor}`,children:[p.completude,"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-center",children:[e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>f(p.id),disabled:N||!p.auto_classificar_ativo,className:"inline-flex items-center gap-2 px-3 py-1 bg-indigo-600 text-white text-sm rounded hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition",children:N?e.jsxs(e.Fragment,{children:[e.jsx(Aa,{className:"w-4 h-4 animate-spin"}),"Classificando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Aa,{className:"w-4 h-4"}),"Classificar IA"]})}),e.jsxs("button",{onClick:()=>a(`/produtos/${p.id}/editar?aba=7`),className:"inline-flex items-center gap-2 px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition",title:"Editar produto manualmente",children:[e.jsx(Sr,{className:"w-4 h-4"}),"Editar"]})]}),!p.auto_classificar_ativo&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Auto-class. desativada"})]})]},p.id)})})]})})})]})]})}function Em(){const[a,t]=n.useState("linhas"),[s,o]=n.useState({}),[r,i]=n.useState(!1),[l,x]=n.useState(null),[j,g]=n.useState({nome:"",descricao:"",ordem:0,ativo:!0}),[v,d]=n.useState({peso_kg:0,descricao:"",ordem:0,ativo:!0}),m=[{id:"linhas",nome:"Linhas de RaÃ§Ã£o",endpoint:"/opcoes-racao/linhas",icon:"ðŸ“¦"},{id:"portes",nome:"Portes",endpoint:"/opcoes-racao/portes",icon:"ðŸ•"},{id:"fases",nome:"Fases/PÃºblico",endpoint:"/opcoes-racao/fases",icon:"ðŸ‘¶"},{id:"tratamentos",nome:"Tratamentos",endpoint:"/opcoes-racao/tratamentos",icon:"ðŸ’Š"},{id:"sabores",nome:"Sabores/ProteÃ­nas",endpoint:"/opcoes-racao/sabores",icon:"ðŸ–"},{id:"apresentacoes",nome:"ApresentaÃ§Ãµes (Peso)",endpoint:"/opcoes-racao/apresentacoes",icon:"âš–ï¸"}],C=m.find(p=>p.id===a);n.useEffect(()=>{y()},[a]);const y=async()=>{i(!0);try{const p=await F.get(C.endpoint,{params:{apenas_ativos:!1}});o(k=>({...k,[a]:p.data}))}catch(p){console.error("Erro ao carregar dados:",p),Ee.error(`Erro ao carregar ${C.nome.toLowerCase()}`)}finally{i(!1)}},c=()=>{g({nome:"",descricao:"",ordem:0,ativo:!0}),d({peso_kg:0,descricao:"",ordem:0,ativo:!0}),x(null)},f=p=>{x(p.id),a==="apresentacoes"?d({peso_kg:p.peso_kg,descricao:p.descricao||"",ordem:p.ordem||0,ativo:p.ativo}):g({nome:p.nome,descricao:p.descricao||"",ordem:p.ordem||0,ativo:p.ativo})},b=async()=>{var p,k;try{const N=a==="apresentacoes"?v:j;l?(await F.put(`${C.endpoint}/${l}`,N),Ee.success("Atualizado com sucesso!")):(await F.post(C.endpoint,N),Ee.success("Criado com sucesso!")),c(),y()}catch(N){console.error("Erro ao salvar:",N),Ee.error(((k=(p=N.response)==null?void 0:p.data)==null?void 0:k.detail)||"Erro ao salvar")}},u=async p=>{if(confirm("Tem certeza que deseja inativar este item?"))try{await F.delete(`${C.endpoint}/${p}`),Ee.success("Inativado com sucesso!"),y()}catch(k){console.error("Erro ao deletar:",k),Ee.error("Erro ao inativar")}},h=s[a]||[];return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(zr,{className:"w-8 h-8 text-indigo-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"OpÃ§Ãµes de ClassificaÃ§Ã£o de RaÃ§Ãµes"})]}),e.jsx("p",{className:"text-gray-600",children:"Gerencie os valores disponÃ­veis para classificaÃ§Ã£o de produtos de raÃ§Ã£o"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex overflow-x-auto",children:m.map(p=>e.jsxs("button",{onClick:()=>{t(p.id),c()},className:`
                  flex items-center gap-2 px-6 py-4 text-sm font-medium border-b-2 whitespace-nowrap
                  ${a===p.id?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                `,children:[e.jsx("span",{className:"text-xl",children:p.icon}),p.nome]},p.id))})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:l?"Editar":"Adicionar Novo"}),a==="apresentacoes"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Peso (kg) *"}),e.jsx("input",{type:"number",step:"0.001",value:v.peso_kg,onChange:p=>d({...v,peso_kg:parseFloat(p.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Ex: 15.0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("input",{type:"text",value:v.descricao,onChange:p=>d({...v,descricao:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Ex: 15kg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ordem"}),e.jsx("input",{type:"number",value:v.ordem,onChange:p=>d({...v,ordem:parseInt(p.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"ativo-peso",checked:v.ativo,onChange:p=>d({...v,ativo:p.target.checked}),className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"ativo-peso",className:"text-sm text-gray-700",children:"Ativo"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",value:j.nome,onChange:p=>g({...j,nome:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:`Ex: ${a==="linhas"?"Premium":a==="portes"?"Pequeno":"Filhote"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:j.descricao,onChange:p=>g({...j,descricao:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",rows:"2",placeholder:"DescriÃ§Ã£o opcional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ordem"}),e.jsx("input",{type:"number",value:j.ordem,onChange:p=>g({...j,ordem:parseInt(p.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"ativo",checked:j.ativo,onChange:p=>g({...j,ativo:p.target.checked}),className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"ativo",className:"text-sm text-gray-700",children:"Ativo"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsxs("button",{onClick:b,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition",children:[e.jsx(Kt,{className:"w-4 h-4"}),l?"Atualizar":"Adicionar"]}),l&&e.jsx("button",{onClick:c,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:e.jsx(pa,{className:"w-4 h-4"})})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"bg-white rounded-lg shadow",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:[C.nome," Cadastrados (",h.length,")"]}),r?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando..."})]}):h.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:e.jsx(us,{className:"w-16 h-16 mx-auto"})}),e.jsx("p",{className:"text-gray-600",children:"Nenhum item cadastrado ainda"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Use o formulÃ¡rio ao lado para adicionar"})]}):e.jsx("div",{className:"space-y-2",children:h.map(p=>e.jsxs("div",{className:`
                        flex items-center justify-between p-4 border rounded-lg transition
                        ${l===p.id?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300"}
                        ${!p.ativo&&"opacity-50"}
                      `,children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:C.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:a==="apresentacoes"?`${p.peso_kg}kg${p.descricao?` - ${p.descricao}`:""}`:p.nome}),p.descricao&&a!=="apresentacoes"&&e.jsx("p",{className:"text-sm text-gray-500",children:p.descricao})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500 mr-2",children:["Ordem: ",p.ordem]}),!p.ativo&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-red-100 text-red-800 rounded",children:"Inativo"}),e.jsx("button",{onClick:()=>f(p),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition",title:"Editar",children:e.jsx(Fo,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>u(p.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition",title:"Inativar",children:e.jsx(Es,{className:"w-4 h-4"})})]})]},p.id))})]})})})]}),e.jsx("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(jt,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-1",children:"Dica"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Os valores cadastrados aqui serÃ£o usados no cadastro de produtos e na classificaÃ§Ã£o automÃ¡tica por IA. Mantenha ativos apenas os valores que vocÃª utiliza no seu negÃ³cio."})]})]})})]})}const Fm=()=>{const[a,t]=n.useState(null),[s,o]=n.useState(!1),[r,i]=n.useState(null),[l,x]=n.useState([]),[j,g]=n.useState(!1),[v,d]=n.useState([]),[m,C]=n.useState(null),[y,c]=n.useState("upload"),f=w=>{var P;const S=(P=w.target.files)==null?void 0:P[0];S&&t(S)},b=async()=>{var S,P;if(!a){alert("Selecione um arquivo primeiro");return}const w=new FormData;w.append("arquivo",a),o(!0);try{const W=await F.post("/ia/extrato/upload",w,{headers:{"Content-Type":"multipart/form-data"}});i(W.data),alert(`Upload concluÃ­do! ${W.data.categorias_aplicadas} categorias aplicadas automaticamente.`)}catch(W){console.error("Erro no upload:",W);const te=((P=(S=W.response)==null?void 0:S.data)==null?void 0:P.detail)||W.message;alert("Erro ao processar arquivo: "+te)}finally{o(!1)}},u=async()=>{g(!0);try{const w=await F.get("/ia/extrato/pendentes");x(w.data)}catch(w){console.error("Erro ao carregar pendentes:",w),alert("Erro ao carregar lanÃ§amentos pendentes")}finally{g(!1)}},h=async w=>{try{await F.post("/ia/extrato/validar",{lancamento_id:w,aprovado:!0}),alert("LanÃ§amento aprovado!"),u()}catch(S){console.error("Erro ao aprovar:",S),alert("Erro ao aprovar lanÃ§amento")}},p=async(w,S)=>{try{await F.post("/ia/extrato/validar",{lancamento_id:w,aprovado:!1,categoria_correta_id:S}),alert("LanÃ§amento corrigido e padrÃ£o aprendido!"),u()}catch(P){console.error("Erro ao corrigir:",P),alert("Erro ao corrigir lanÃ§amento")}},k=async()=>{try{const w=await F.get("/ia/extrato/padroes");d(w.data)}catch(w){console.error("Erro ao carregar padrÃµes:",w),alert("Erro ao carregar padrÃµes aprendidos")}},N=async()=>{try{const w=await F.get("/ia/extrato/estatisticas");C(w.data)}catch(w){console.error("Erro ao carregar estatÃ­sticas:",w),alert("Erro ao carregar estatÃ­sticas")}};return ms.useEffect(()=>{y==="validacao"?u():y==="padroes"?k():y==="estatisticas"&&N()},[y]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>c("upload"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${y==="upload"?"bg-green-100 text-green-700 font-medium":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(Or,{size:18}),"Upload de Extrato"]}),e.jsxs("button",{onClick:()=>c("validacao"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${y==="validacao"?"bg-orange-100 text-orange-700 font-medium":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(xa,{size:18}),"ValidaÃ§Ã£o (",l.length,")"]}),e.jsxs("button",{onClick:()=>c("padroes"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${y==="padroes"?"bg-blue-100 text-blue-700 font-medium":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(Qt,{size:18}),"PadrÃµes IA"]}),e.jsxs("button",{onClick:()=>c("estatisticas"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${y==="estatisticas"?"bg-purple-100 text-purple-700 font-medium":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(Ta,{size:18}),"EstatÃ­sticas"]})]})}),y==="upload"&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Or,{className:"text-green-600"}),"Upload de Extrato BancÃ¡rio"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx(ss,{className:"mx-auto mb-4 text-gray-400",size:48}),e.jsx("p",{className:"mb-2 text-gray-600",children:"Arraste um arquivo ou clique para selecionar"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"âœ… Formatos: Excel (.xlsx, .xls), CSV (.csv), PDF (.pdf), OFX (.ofx)"}),e.jsx("input",{type:"file",onChange:f,accept:".xlsx,.xls,.csv,.pdf,.ofx",className:"hidden",id:"file-upload"}),e.jsx("label",{htmlFor:"file-upload",className:"inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer",children:"Selecionar Arquivo"}),a&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 rounded-lg",children:[e.jsx("p",{className:"text-green-700 font-medium",children:a.name}),e.jsxs("p",{className:"text-sm text-green-600",children:[(a.size/1024).toFixed(2)," KB"]})]})]}),e.jsx("button",{onClick:b,disabled:!a||s,className:"w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium",children:s?"Processando...":"Processar Extrato"}),r&&e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"font-bold text-blue-900 mb-2",children:"âœ… Resultado do Processamento"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:["â€¢ Total de lanÃ§amentos: ",e.jsx("span",{className:"font-bold",children:r.total_lancamentos})]}),e.jsxs("p",{children:["â€¢ Categorizados automaticamente: ",e.jsx("span",{className:"font-bold text-green-700",children:r.categorias_aplicadas})]}),e.jsxs("p",{children:["â€¢ Pendentes de validaÃ§Ã£o: ",e.jsx("span",{className:"font-bold text-orange-700",children:r.pendentes_validacao})]})]})]})]})]}),y==="validacao"&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(xa,{className:"text-orange-600"}),"LanÃ§amentos Pendentes de ValidaÃ§Ã£o (",l.length,")"]}),j?e.jsx("p",{className:"text-center text-gray-600 py-8",children:"Carregando..."}):l.length===0?e.jsxs("div",{className:"text-center text-gray-600 py-8",children:[e.jsx(fa,{className:"mx-auto mb-2 text-green-500",size:48}),e.jsx("p",{children:"Nenhum lanÃ§amento pendente! ðŸŽ‰"})]}):e.jsx("div",{className:"space-y-3",children:l.map(w=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800",children:w.descricao}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Data: ",new Date(w.data).toLocaleDateString("pt-BR")," | Valor: R$ ",Math.abs(w.valor).toFixed(2)]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded",children:["SugestÃ£o IA: ",w.categoria_sugerida]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["ConfianÃ§a: ",(w.confianca*100).toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx("button",{onClick:()=>h(w.id),className:"px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm",title:"Aprovar categoria sugerida",children:e.jsx(fa,{size:16})}),e.jsx("button",{onClick:()=>{const S=prompt("Digite a categoria correta:");S&&p(w.id,S)},className:"px-3 py-2 bg-orange-600 text-white rounded hover:bg-orange-700 text-sm",title:"Corrigir categoria",children:e.jsx(ys,{size:16})})]})]})},w.id))})]}),y==="padroes"&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Qt,{className:"text-blue-600"}),"PadrÃµes Aprendidos pela IA"]}),v.length===0?e.jsx("p",{className:"text-center text-gray-600 py-8",children:"Nenhum padrÃ£o aprendido ainda"}):e.jsx("div",{className:"space-y-3",children:v.map((w,S)=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-800",children:["PadrÃ£o: ",w.descricao_padrao]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Categoria: ",w.categoria]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsxs("span",{className:"text-xs px-2 py-1 bg-green-100 text-green-700 rounded",children:["âœ“ ",w.vezes_usado," vezes usado"]}),e.jsxs("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded",children:["ConfianÃ§a: ",(w.confianca*100).toFixed(0),"%"]})]})]})})},S))})]}),y==="estatisticas"&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Ta,{className:"text-purple-600"}),"EstatÃ­sticas do Sistema IA"]}),m?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total de PadrÃµes"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900 mt-1",children:m.total_padroes})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Taxa de Acerto"}),e.jsxs("p",{className:"text-3xl font-bold text-green-900 mt-1",children:[(m.taxa_acerto*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"ConfianÃ§a MÃ©dia"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-900 mt-1",children:[(m.confianca_media*100).toFixed(0),"%"]})]})]}):e.jsx("p",{className:"text-center text-gray-600 py-8",children:"Carregando estatÃ­sticas..."})]})})]})},Pm=({dados:a,periodo:t})=>{const[s,o]=n.useState(null),[r,i]=n.useState(!0),[l,x]=n.useState(null),[j,g]=n.useState(null);n.useEffect(()=>{a&&(d(),v())},[a,t]);const v=async()=>{try{const b=await F.get("/ia/dre/indices-mercado",{params:{setor:"pet_shop"}});g(b.data)}catch(b){console.error("Erro ao carregar Ã­ndices:",b)}},d=async()=>{i(!0);try{await new Promise(u=>setTimeout(u,1e3));const b=y(a);if(o(b),t.mes>1){const u=await m(t);u&&x(C(a,u))}}catch(b){console.error("Erro ao carregar anÃ¡lise:",b)}finally{i(!1)}},m=async b=>{try{const u=b.mes===1?12:b.mes-1,h=b.mes===1?b.ano-1:b.ano;return(await F.get("/financeiro/dre",{params:{ano:h,mes:u}})).data}catch{return null}},C=(b,u)=>{const h=(p,k)=>!k||k===0?null:(p-k)/Math.abs(k)*100;return{receita:{atual:b.receita_bruta||0,anterior:u.receita_bruta||0,variacao:h(b.receita_bruta,u.receita_bruta)},lucro:{atual:b.lucro_liquido||0,anterior:u.lucro_liquido||0,variacao:h(b.lucro_liquido,u.lucro_liquido)},despesas:{atual:b.total_despesas||0,anterior:u.total_despesas||0,variacao:h(b.total_despesas,u.total_despesas)},margem:{atual:b.margem_liquida||0,anterior:u.margem_liquida||0,variacao:h(b.margem_liquida,u.margem_liquida)}}},y=b=>{const u=[],h=[],p=[],k=b.margem_liquida||0;k<5?(p.push({tipo:"critico",titulo:"Margem lÃ­quida crÃ­tica",descricao:`Margem de apenas ${k.toFixed(1)}%. Ideal: acima de 10%`,icon:La}),h.push({prioridade:"alta",titulo:"Urgente: Revisar estrutura de custos",descricao:"Margem muito baixa. Considere: aumentar preÃ§os, reduzir custos fixos, ou renegociar com fornecedores."})):k<10?u.push({tipo:"atencao",titulo:"Margem lÃ­quida abaixo do ideal",descricao:`${k.toFixed(1)}% - HÃ¡ espaÃ§o para melhoria`,icon:Ha}):u.push({tipo:"positivo",titulo:"Margem lÃ­quida saudÃ¡vel",descricao:`${k.toFixed(1)}% - Acima da mÃ©dia do setor`,icon:fa});const N=b.receita_bruta||0,w=b.total_despesas||0;w>N*.8&&p.push({tipo:"atencao",titulo:"Despesas elevadas",descricao:`Despesas representam ${(w/N*100).toFixed(0)}% da receita`,icon:La});const S=b.cmv||0,P=(N-S)/N*100;P<30&&h.push({prioridade:"media",titulo:"Revisar custo dos produtos",descricao:`Margem bruta de ${P.toFixed(1)}%. Considere negociar com fornecedores ou ajustar preÃ§os.`});const W=b.lucro_liquido||0;W>0?u.push({tipo:"positivo",titulo:"Resultado positivo",descricao:`Lucro de R$ ${W.toLocaleString("pt-BR",{minimumFractionDigits:2})}`,icon:Ta}):(p.push({tipo:"critico",titulo:"PrejuÃ­zo no perÃ­odo",descricao:`Resultado negativo de R$ ${Math.abs(W).toLocaleString("pt-BR",{minimumFractionDigits:2})}`,icon:Ha}),h.push({prioridade:"alta",titulo:"Plano de recuperaÃ§Ã£o necessÃ¡rio",descricao:"AnÃ¡lise detalhada de custos e revisÃ£o de estratÃ©gia de precificaÃ§Ã£o urgente."}));let te=50;return k>10&&(te+=20),k>5&&k<=10&&(te+=10),W>0&&(te+=15),P>30&&(te+=15),w<N*.7&&(te+=10),{insights:u,recomendacoes:h,alertas:p,score:Math.min(te,100)}},c=b=>{let u="red",h="CrÃ­tico";return b>=80?(u="green",h="Excelente"):b>=60?(u="yellow",h="Bom"):b>=40&&(u="orange",h="Regular"),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(gl,{className:"text-purple-600"}),"Score de SaÃºde Financeira"]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative w-32 h-32",children:[e.jsxs("svg",{className:"transform -rotate-90 w-32 h-32",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"#e5e7eb",strokeWidth:"12",fill:"none"}),e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:u==="green"?"#10b981":u==="yellow"?"#fbbf24":u==="orange"?"#f59e0b":"#ef4444",strokeWidth:"12",fill:"none",strokeDasharray:`${b/100*351.86} 351.86`,className:"transition-all duration-1000"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-3xl font-bold text-gray-800",children:b})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800 mb-1",children:h}),e.jsxs("p",{className:"text-sm text-gray-600",children:[b>=80&&"Sua saÃºde financeira estÃ¡ Ã³tima! Continue assim.",b>=60&&b<80&&"Boa saÃºde financeira. Pequenos ajustes podem melhorar.",b>=40&&b<60&&"SituaÃ§Ã£o estÃ¡vel, mas requer atenÃ§Ã£o.",b<40&&"AtenÃ§Ã£o! Medidas corretivas sÃ£o necessÃ¡rias."]})]})]})]})},f=()=>{if(!j||!a)return null;const b=j.benchmarks,u=a.receita_liquida||0,h=u>0?(a.cmv||0)/u*100:0,p=a.margem_bruta||0,k=a.margem_liquida||0,N=u>0?(a.despesas_admin||0)/u*100:0,w=u>0?(a.total_despesas||0)/u*100:0,S=[{nome:"CMV",seu:h,idealMin:b.cmv.min,idealMax:b.cmv.max,inverter:!0,unidade:"%",cor:h<=b.cmv.max?"green":h<=b.cmv.max*1.1?"yellow":"red"},{nome:"Margem Bruta",seu:p,idealMin:b.margem_bruta.min,idealMax:b.margem_bruta.max,inverter:!1,unidade:"%",cor:p>=b.margem_bruta.min?"green":p>=b.margem_bruta.min*.9?"yellow":"red"},{nome:"Margem LÃ­quida",seu:k,idealMin:b.margem_liquida.min,idealMax:b.margem_liquida.max,inverter:!1,unidade:"%",cor:k>=b.margem_liquida.min?"green":k>=b.margem_liquida.min*.8?"yellow":"red"},{nome:"Despesas Admin",seu:N,idealMin:0,idealMax:b.despesas_admin.max,inverter:!0,unidade:"%",cor:N<=b.despesas_admin.max?"green":N<=b.despesas_admin.max*1.2?"yellow":"red"},{nome:"Despesas Totais",seu:w,idealMin:0,idealMax:b.despesas_totais.max,inverter:!0,unidade:"%",cor:w<=b.despesas_totais.max?"green":w<=b.despesas_totais.max*1.2?"yellow":"red"}];return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Jt,{className:"text-indigo-600"}),"Seus Indicadores vs Mercado Pet Shop"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Po,{size:16}),e.jsxs("span",{children:["Fonte: ",j.fonte]})]})]}),e.jsx("div",{className:"space-y-4",children:S.map((P,W)=>{const te=P.idealMax-P.idealMin;P.idealMin+te/2;const D=P.seu>=P.idealMin&&P.seu<=P.idealMax;return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:P.nome}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:`text-lg font-bold ${P.cor==="green"?"text-green-600":P.cor==="yellow"?"text-yellow-600":"text-red-600"}`,children:[P.seu.toFixed(1),P.unidade]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Ideal: ",P.idealMin>0?`${P.idealMin.toFixed(0)}-`:"",P.idealMax.toFixed(0),P.unidade]})]})]}),e.jsxs("div",{className:"relative h-8 bg-gray-200 rounded-full overflow-hidden",children:[e.jsx("div",{className:"absolute h-full bg-green-200",style:{left:`${P.idealMin/100*100}%`,width:`${te/100*100}%`}}),e.jsx("div",{className:"absolute h-full w-2 bg-gray-800 shadow-lg z-10",style:{left:`${Math.min(Math.max(P.seu/100*100,0),100)}%`,transform:"translateX(-50%)"},children:e.jsx("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap",children:"VocÃª"})})]}),e.jsx("div",{className:"mt-2 flex items-center gap-2 text-sm",children:D?e.jsxs(e.Fragment,{children:[e.jsx(fa,{size:16,className:"text-green-600"}),e.jsx("span",{className:"text-green-600 font-medium",children:"Dentro da faixa ideal!"})]}):P.seu<P.idealMin?e.jsxs(e.Fragment,{children:[e.jsx(Ha,{size:16,className:"text-orange-600"}),e.jsxs("span",{className:"text-orange-600",children:["Abaixo do ideal (",(P.idealMin-P.seu).toFixed(1),P.unidade," a menos)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(La,{size:16,className:"text-red-600"}),e.jsxs("span",{className:"text-red-600",children:["Acima do ideal (+",(P.seu-P.idealMax).toFixed(1),P.unidade,")"]})]})})]},W)})}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"ðŸ’¡ Faixa verde = Ideal para pet shops | Barra preta = Seu valor atual"})})]})};return r?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Gerando anÃ¡lise inteligente..."})]})}):s?e.jsxs("div",{className:"space-y-6",children:[c(s.score),f(),l&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Is,{className:"text-blue-600"}),"ComparaÃ§Ã£o com PerÃ­odo Anterior"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(l).map(([b,u])=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1 capitalize",children:b}),e.jsxs("p",{className:"text-xl font-bold text-gray-800 mb-2",children:["R$ ",u.atual.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),u.variacao!==null&&e.jsxs("div",{className:`flex items-center gap-1 text-sm ${u.variacao>0?"text-green-600":"text-red-600"}`,children:[u.variacao>0?e.jsx(Ai,{size:16}):e.jsx(Di,{size:16}),e.jsxs("span",{className:"font-semibold",children:[Math.abs(u.variacao).toFixed(1),"%"]})]})]},b))})]}),s.alertas.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(La,{className:"text-orange-600"}),"Pontos de AtenÃ§Ã£o"]}),e.jsx("div",{className:"space-y-3",children:s.alertas.map((b,u)=>e.jsx("div",{className:`p-4 rounded-lg border-l-4 ${b.tipo==="critico"?"bg-red-50 border-red-500":"bg-yellow-50 border-yellow-500"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(b.icon,{size:20,className:b.tipo==="critico"?"text-red-600":"text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:b.titulo}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:b.descricao})]})]})},u))})]}),s.insights.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Jt,{className:"text-indigo-600"}),"Insights Inteligentes"]}),e.jsx("div",{className:"space-y-3",children:s.insights.map((b,u)=>e.jsx("div",{className:`p-4 rounded-lg ${b.tipo==="positivo"?"bg-green-50":b.tipo==="atencao"?"bg-yellow-50":"bg-blue-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(b.icon,{size:20,className:b.tipo==="positivo"?"text-green-600":b.tipo==="atencao"?"text-yellow-600":"text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:b.titulo}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:b.descricao})]})]})},u))})]}),s.recomendacoes.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(bl,{className:"text-yellow-600"}),"RecomendaÃ§Ãµes EstratÃ©gicas"]}),e.jsx("div",{className:"space-y-3",children:s.recomendacoes.map((b,u)=>e.jsx("div",{className:"p-4 rounded-lg bg-gradient-to-r from-purple-50 to-indigo-50 border border-purple-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-semibold ${b.prioridade==="alta"?"bg-red-100 text-red-700":b.prioridade==="media"?"bg-yellow-100 text-yellow-700":"bg-blue-100 text-blue-700"}`,children:b.prioridade.toUpperCase()}),e.jsx("p",{className:"font-semibold text-gray-800",children:b.titulo})]}),e.jsx("p",{className:"text-sm text-gray-600",children:b.descricao})]}),e.jsx(Oa,{className:"text-purple-600 flex-shrink-0 ml-3",size:24})]})},u))})]})]}):e.jsxs("div",{className:"bg-gray-50 rounded-lg p-12 text-center",children:[e.jsx(Brain,{className:"mx-auto mb-4 text-gray-400",size:64}),e.jsx("p",{className:"text-gray-600",children:"NÃ£o hÃ¡ dados suficientes para anÃ¡lise"})]})},Rm=()=>{var w,S,P,W,te,D,A;const[a,t]=n.useState("demonstrativo"),[s,o]=n.useState(!1),[r,i]=n.useState(!1),[l,x]=n.useState(null),[j]=n.useState([{id:"loja_fisica",nome:"Loja FÃ­sica",cor:"blue"},{id:"mercado_livre",nome:"Mercado Livre",cor:"yellow"},{id:"shopee",nome:"Shopee",cor:"orange"},{id:"amazon",nome:"Amazon",cor:"green"}]),[g,v]=n.useState(["loja_fisica"]),d=()=>{const X=new Date,re=X.getFullYear(),M=String(X.getMonth()+1).padStart(2,"0");return`${re}-${M}`},[m,C]=n.useState(d());n.useEffect(()=>{y()},[]);const y=async()=>{var X,re;i(!0);try{const[M,Z]=m.split("-"),$=g.join(","),J=await F.get("/financeiro/dre/canais",{params:{ano:M,mes:Z,canais:$}});x(J.data)}catch(M){console.error("Erro ao carregar DRE:",M),Ee.error("Erro ao carregar DRE: "+(((re=(X=M.response)==null?void 0:X.data)==null?void 0:re.detail)||M.message))}finally{i(!1)}},c=X=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(X||0),f=X=>`${(X||0).toFixed(2)}%`,b=(X,re)=>!re||re===0?0:X/re*100,u=X=>{v(re=>re.includes(X)?re.filter(Z=>Z!==X):[...re,X])},h=()=>{v([])};n.useEffect(()=>{l&&y()},[g]);const p=X=>{const re=new Date;let M;switch(X){case"mes_atual":M=d();break;case"mes_anterior":const Z=new Date(re.getFullYear(),re.getMonth()-1,1);M=`${Z.getFullYear()}-${String(Z.getMonth()+1).padStart(2,"0")}`;break;case"ano_atual":M=`${re.getFullYear()}-01`;break;default:return}C(M),setTimeout(()=>y(),100)},k=async()=>{try{const[X,re]=m.split("-");Ee.loading("Gerando PDF...",{id:"pdf"});const M=await F.get("/financeiro/dre/export/pdf",{params:{ano:X,mes:re},responseType:"blob"}),Z=window.URL.createObjectURL(new Blob([M.data])),$=document.createElement("a");$.href=Z,$.setAttribute("download",`dre_${re}_${X}.pdf`),document.body.appendChild($),$.click(),$.remove(),Ee.success("Ã°Å¸â€œâ€ž PDF exportado com sucesso!",{id:"pdf"})}catch(X){console.error("Erro ao exportar PDF:",X),Ee.error("Erro ao exportar PDF",{id:"pdf"})}},N=async()=>{try{const[X,re]=m.split("-");Ee.loading("Gerando Excel...",{id:"excel"});const M=await F.get("/financeiro/dre/export/excel",{params:{ano:X,mes:re},responseType:"blob"}),Z=window.URL.createObjectURL(new Blob([M.data])),$=document.createElement("a");$.href=Z,$.setAttribute("download",`dre_${re}_${X}.xlsx`),document.body.appendChild($),$.click(),$.remove(),Ee.success("Ã°Å¸â€œÅ  Excel exportado com sucesso!",{id:"excel"})}catch(X){console.error("Erro ao exportar Excel:",X),Ee.error("Erro ao exportar Excel",{id:"excel"})}};return r&&!l?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Aa,{className:"animate-spin mx-auto mb-4",size:48}),e.jsx("p",{className:"text-gray-600",children:"Carregando DRE..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"ðŸ“Š DRE - DemonstraÃ§Ã£o do Resultado"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"AnÃ¡lise gerencial de receitas, custos e lucro"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all shadow-lg hover:shadow-xl",title:"Consultar Especialista IA",children:[e.jsx(ul,{size:20}),e.jsx("span",{className:"font-medium",children:"Chat IA"}),e.jsx(Cs,{size:16,className:"animate-pulse"})]}),e.jsxs("button",{onClick:k,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",title:"Exportar para PDF",children:[e.jsx(ss,{size:18}),"PDF"]}),e.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",title:"Exportar para Excel",children:[e.jsx(Gt,{size:18}),"Excel"]})]})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>t("demonstrativo"),className:`${a==="demonstrativo"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors`,children:[e.jsx(ss,{size:18}),"Demonstrativo"]}),e.jsxs("button",{onClick:()=>t("extrato"),className:`${a==="extrato"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors`,children:[e.jsx(Or,{size:18}),"Extrato BancÃ¡rio",e.jsx("span",{className:"ml-1 px-2 py-0.5 text-xs bg-green-100 text-green-700 rounded-full font-bold",children:"IA"})]}),e.jsxs("button",{onClick:()=>t("analise"),className:`${a==="analise"?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors`,children:[e.jsx(Qt,{size:18}),"AnÃ¡lise Inteligente",e.jsx("span",{className:"ml-1 px-2 py-0.5 text-xs bg-purple-100 text-purple-700 rounded-full font-bold",children:"EM BREVE"})]})]})}),a==="demonstrativo"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p("mes_atual"),className:"px-3 py-2 text-sm bg-blue-50 text-blue-700 rounded-md hover:bg-blue-100",children:"MÃªs Atual"}),e.jsx("button",{onClick:()=>p("mes_anterior"),className:"px-3 py-2 text-sm bg-blue-50 text-blue-700 rounded-md hover:bg-blue-100",children:"MÃªs Anterior"}),e.jsx("button",{onClick:()=>p("ano_atual"),className:"px-3 py-2 text-sm bg-blue-50 text-blue-700 rounded-md hover:bg-blue-100",children:"Ano Atual"})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PerÃ­odo (MÃªs/Ano)"}),e.jsx("input",{type:"month",value:m,onChange:X=>C(X.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:y,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(Aa,{size:18}),"Atualizar"]})})]})}),l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-green-500 text-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm opacity-90",children:"Receita Bruta"}),e.jsx(Ta,{className:"w-5 h-5"})]}),e.jsx("div",{className:"text-3xl font-bold",children:c(((w=l.totais)==null?void 0:w.receita_bruta)||0)}),e.jsx("div",{className:"text-xs mt-1 opacity-80",children:"Base de cÃ¡lculo"})]}),e.jsxs("div",{className:"bg-red-500 text-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm opacity-90",children:"CMV"}),e.jsx(Ha,{className:"w-5 h-5"})]}),e.jsx("div",{className:"text-3xl font-bold",children:c(((S=l.totais)==null?void 0:S.cmv)||0)}),e.jsxs("div",{className:"text-xs mt-1 opacity-80",children:[f(b((P=l.totais)==null?void 0:P.cmv,(W=l.totais)==null?void 0:W.receita_bruta))," da receita"]})]}),e.jsxs("div",{className:"bg-blue-500 text-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm opacity-90",children:"Lucro Bruto"}),e.jsx(Oa,{className:"w-5 h-5"})]}),e.jsx("div",{className:"text-3xl font-bold",children:c(((te=l.totais)==null?void 0:te.lucro_bruto)||0)}),e.jsx("div",{className:"text-xs mt-1 opacity-80",children:"ApÃ³s custos"})]}),e.jsxs("div",{className:"bg-purple-500 text-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm opacity-90",children:"Margem Bruta"}),e.jsx(hl,{className:"w-5 h-5"})]}),e.jsx("div",{className:"text-3xl font-bold",children:f(((D=l.totais)==null?void 0:D.margem_bruta)||0)}),e.jsx("div",{className:"text-xs mt-1 opacity-80",children:"Rentabilidade"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(fa,{size:20,className:"text-blue-600"}),"AnÃ¡lise por Canal de Vendas"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Selecione os canais para adicionar suas mÃ©tricas na tabela DRE"})]}),g.length>0&&e.jsx("button",{onClick:h,className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"Limpar SeleÃ§Ã£o"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:j.map(X=>{const re=g.includes(X.id),M={blue:re?"bg-blue-600 text-white border-blue-600":"bg-blue-50 text-blue-700 border-blue-200 hover:bg-blue-100",yellow:re?"bg-yellow-500 text-white border-yellow-500":"bg-yellow-50 text-yellow-700 border-yellow-200 hover:bg-yellow-100",orange:re?"bg-orange-500 text-white border-orange-500":"bg-orange-50 text-orange-700 border-orange-200 hover:bg-orange-100",green:re?"bg-green-600 text-white border-green-600":"bg-green-50 text-green-700 border-green-200 hover:bg-green-100"};return e.jsxs("button",{onClick:()=>u(X.id),className:`${M[X.cor]} border-2 rounded-lg p-4 transition-all duration-200 transform ${re?"scale-105 shadow-lg":"hover:scale-102"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:X.nome}),re&&e.jsx(fa,{size:20,className:"flex-shrink-0"})]}),re&&e.jsx("div",{className:"text-xs mt-1 opacity-90",children:"Ativo na tabela"})]},X.id)})}),g.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Qt,{size:18,className:"text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("span",{className:"font-semibold",children:[g.length," canal(is) selecionado(s)."]})," ","As mÃ©tricas de cada canal serÃ£o adicionadas na tabela DRE abaixo com suas respectivas receitas, custos e lucros."]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"DescriÃ§Ã£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"% Receita"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(A=l==null?void 0:l.linhas)==null?void 0:A.map((X,re)=>{const M=X.nivel===0,Z=X.nivel===1,$=X.cor_bg!=="#ffffff"?{backgroundColor:X.cor_bg}:{},J={color:X.cor};return e.jsxs("tr",{style:$,className:M?"font-bold":"",children:[e.jsx("td",{className:`px-6 py-3 ${Z?"pl-12":""} ${M?"font-bold":""}`,style:J,children:X.descricao}),e.jsx("td",{className:`px-6 py-3 text-right ${M?"font-bold":""}`,style:J,children:c(X.valor)}),e.jsx("td",{className:`px-6 py-3 text-right ${M?"font-bold":""}`,style:J,children:f(X.percentual)})]},re)})})]})}),g.length===0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-blue-800",children:"Ã°Å¸â€™Â¡ A DRE agora mostra automaticamente todos os canais com vendas no perÃƒÂ­odo selecionado."})})]}),!l&&!r&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-12 text-center",children:[e.jsx(ss,{className:"mx-auto mb-4 text-gray-400",size:64}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Selecione um perÃ­odo e clique em Atualizar para visualizar o DRE"})]})]}),a==="extrato"&&e.jsx(Fm,{}),a==="analise"&&e.jsx(Pm,{dados:l,periodo:{mes:m.mes,ano:m.ano}}),e.jsx(jm,{isOpen:s,onClose:()=>o(!1),contexto:{tipo:"DRE",periodo:`${m.mes}/${m.ano}`,valor:l==null?void 0:l.lucro_liquido,dados:l}})]})},$m=a=>{const t={critico:"bg-red-100 text-red-800 border-red-200",alerta:"bg-yellow-100 text-yellow-800 border-yellow-200",ok:"bg-green-100 text-green-800 border-green-200"};return t[a]||t.ok},Am=a=>a==="critico"?e.jsx(La,{className:"w-5 h-5"}):a==="alerta"?e.jsx(La,{className:"w-5 h-5"}):e.jsx(fa,{className:"w-5 h-5"}),Dm=a=>a==="melhorando"?e.jsx(Ta,{className:"w-5 h-5 text-green-600"}):a==="piorando"?e.jsx(Ha,{className:"w-5 h-5 text-red-600"}):e.jsx(Gr,{className:"w-5 h-5 text-gray-600"});function Mm({indices:a}){const[t,s]=n.useState(null);if(!a)return e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Nenhum Ã­ndice disponÃ­vel"});const{saldo_atual:o,dias_de_caixa:r,status:i,tendencia:l,score_saude:x,receita_mensal_estimada:j,despesa_mensal_estimada:g,percentual_variacao_7d:v}=a;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 relative group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(Oa,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"relative",children:[Dm(l),e.jsx("button",{onMouseEnter:()=>s("saldo"),onMouseLeave:()=>s(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:e.jsx(vr,{className:"w-4 h-4"})}),t==="saldo"&&e.jsxs("div",{className:"absolute -right-40 top-8 bg-gray-900 text-white text-xs rounded p-2 w-48 z-10 whitespace-normal",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Saldo Atual"}),e.jsx("p",{children:"Seu saldo de caixa real neste momento. O nÃºmero verde ao lado mostra a variaÃ§Ã£o dos Ãºltimos 7 dias."})]})]})]}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Saldo Atual"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o||0)}),v&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[v>0?"+":"",v.toFixed(1),"% em 7 dias"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 relative group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(Is,{className:"w-6 h-6 text-purple-600"})}),e.jsx("button",{onMouseEnter:()=>s("dias"),onMouseLeave:()=>s(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(vr,{className:"w-4 h-4"})}),t==="dias"&&e.jsxs("div",{className:"absolute -right-40 top-8 bg-gray-900 text-white text-xs rounded p-2 w-48 z-10 whitespace-normal",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Dias de Caixa"}),e.jsx("p",{children:"Quantos dias vocÃª consegue pagar as despesas com seu saldo atual. Se tem R$ 10.000 e gasta R$ 1.000/dia = 10 dias."})]})]}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Dias de Caixa"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[(r==null?void 0:r.toFixed(1))||"0.0"," dias"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:r<7?"CrÃ­tico - menos de 1 semana":r<15?"Alerta - menos de 2 semanas":"SaudÃ¡vel"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 relative group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${$m(i)}`,children:Am(i)}),e.jsx("button",{onMouseEnter:()=>s("status"),onMouseLeave:()=>s(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(vr,{className:"w-4 h-4"})}),t==="status"&&e.jsxs("div",{className:"absolute -right-40 top-8 bg-gray-900 text-white text-xs rounded p-2 w-48 z-10 whitespace-normal",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Status"}),e.jsxs("p",{children:[e.jsx("strong",{children:"CRITICO:"})," <7 dias (risco iminente). ",e.jsx("strong",{children:"ALERTA:"})," 7-15 dias. ",e.jsx("strong",{children:"OK:"})," >15 dias."]})]})]}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Status"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 capitalize",children:i||"N/A"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1 capitalize",children:["TendÃªncia: ",l||"estÃ¡vel"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 relative group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(Mi,{className:"w-6 h-6 text-green-600"})}),e.jsx("button",{onMouseEnter:()=>s("score"),onMouseLeave:()=>s(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(vr,{className:"w-4 h-4"})}),t==="score"&&e.jsxs("div",{className:"absolute -right-40 top-8 bg-gray-900 text-white text-xs rounded p-2 w-48 z-10 whitespace-normal",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Score de SaÃºde"}),e.jsx("p",{children:"Nota de 0-100 que resume a saÃºde financeira. Considera dias de caixa, tendÃªncia e volatilidade."})]})]}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Score de SaÃºde"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[(x==null?void 0:x.toFixed(0))||"0","/100"]}),e.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${x>=70?"bg-green-600":x>=40?"bg-yellow-600":"bg-red-600"}`,style:{width:`${x||0}%`}})})]}),j&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(Ta,{className:"w-6 h-6 text-green-600"})})}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Receita Mensal"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(j)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Estimativa"})]}),g&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:e.jsx(Ha,{className:"w-6 h-6 text-red-600"})})}),e.jsx("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:"Despesa Mensal"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(g)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Estimativa"})]})]})}const Xl=6048e5,Lm=864e5,Ql=6e4,Jl=36e5,Cr=43200,zn=1440,On=Symbol.for("constructDateFrom");function Ns(a,t){return typeof a=="function"?a(t):a&&typeof a=="object"&&On in a?a[On](t):a instanceof Date?new a.constructor(t):new Date(t)}function qa(a,t){return Ns(t||a,a)}let Tm={};function or(){return Tm}function Yt(a,t){var x,j,g,v;const s=or(),o=(t==null?void 0:t.weekStartsOn)??((j=(x=t==null?void 0:t.locale)==null?void 0:x.options)==null?void 0:j.weekStartsOn)??s.weekStartsOn??((v=(g=s.locale)==null?void 0:g.options)==null?void 0:v.weekStartsOn)??0,r=qa(a,t==null?void 0:t.in),i=r.getDay(),l=(i<o?7:0)+i-o;return r.setDate(r.getDate()-l),r.setHours(0,0,0,0),r}function Br(a,t){return Yt(a,{...t,weekStartsOn:1})}function Yl(a,t){const s=qa(a,t==null?void 0:t.in),o=s.getFullYear(),r=Ns(s,0);r.setFullYear(o+1,0,4),r.setHours(0,0,0,0);const i=Br(r),l=Ns(s,0);l.setFullYear(o,0,4),l.setHours(0,0,0,0);const x=Br(l);return s.getTime()>=i.getTime()?o+1:s.getTime()>=x.getTime()?o:o-1}function Ur(a){const t=qa(a),s=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return s.setUTCFullYear(t.getFullYear()),+a-+s}function eo(a,...t){const s=Ns.bind(null,a||t.find(o=>typeof o=="object"));return t.map(s)}function Vn(a,t){const s=qa(a,t==null?void 0:t.in);return s.setHours(0,0,0,0),s}function qm(a,t,s){const[o,r]=eo(s==null?void 0:s.in,a,t),i=Vn(o),l=Vn(r),x=+i-Ur(i),j=+l-Ur(l);return Math.round((x-j)/Lm)}function Im(a,t){const s=Yl(a,t),o=Ns(a,0);return o.setFullYear(s,0,4),o.setHours(0,0,0,0),Br(o)}function $r(a,t){const s=+qa(a)-+qa(t);return s<0?-1:s>0?1:s}function zm(a){return Ns(a,Date.now())}function Om(a){return a instanceof Date||typeof a=="object"&&Object.prototype.toString.call(a)==="[object Date]"}function Vm(a){return!(!Om(a)&&typeof a!="number"||isNaN(+qa(a)))}function Bm(a,t,s){const[o,r]=eo(s==null?void 0:s.in,a,t),i=o.getFullYear()-r.getFullYear(),l=o.getMonth()-r.getMonth();return i*12+l}function Um(a){return t=>{const o=(a?Math[a]:Math.trunc)(t);return o===0?0:o}}function Wm(a,t){return+qa(a)-+qa(t)}function Hm(a,t){const s=qa(a,t==null?void 0:t.in);return s.setHours(23,59,59,999),s}function Km(a,t){const s=qa(a,t==null?void 0:t.in),o=s.getMonth();return s.setFullYear(s.getFullYear(),o+1,0),s.setHours(23,59,59,999),s}function Gm(a,t){const s=qa(a,t==null?void 0:t.in);return+Hm(s,t)==+Km(s,t)}function Xm(a,t,s){const[o,r,i]=eo(s==null?void 0:s.in,a,a,t),l=$r(r,i),x=Math.abs(Bm(r,i));if(x<1)return 0;r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-l*x);let j=$r(r,i)===-l;Gm(o)&&x===1&&$r(o,i)===1&&(j=!1);const g=l*(x-+j);return g===0?0:g}function Qm(a,t,s){const o=Wm(a,t)/1e3;return Um(s==null?void 0:s.roundingMethod)(o)}function Jm(a,t){const s=qa(a,t==null?void 0:t.in);return s.setFullYear(s.getFullYear(),0,1),s.setHours(0,0,0,0),s}const Ym={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Zm=(a,t,s)=>{let o;const r=Ym[a];return typeof r=="string"?o=r:t===1?o=r.one:o=r.other.replace("{{count}}",t.toString()),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?"in "+o:o+" ago":o};function vt(a){return(t={})=>{const s=t.width?String(t.width):a.defaultWidth;return a.formats[s]||a.formats[a.defaultWidth]}}const eu={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},au={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},su={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},tu={date:vt({formats:eu,defaultWidth:"full"}),time:vt({formats:au,defaultWidth:"full"}),dateTime:vt({formats:su,defaultWidth:"full"})},ru={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},ou=(a,t,s,o)=>ru[a];function fs(a){return(t,s)=>{const o=s!=null&&s.context?String(s.context):"standalone";let r;if(o==="formatting"&&a.formattingValues){const l=a.defaultFormattingWidth||a.defaultWidth,x=s!=null&&s.width?String(s.width):l;r=a.formattingValues[x]||a.formattingValues[l]}else{const l=a.defaultWidth,x=s!=null&&s.width?String(s.width):a.defaultWidth;r=a.values[x]||a.values[l]}const i=a.argumentCallback?a.argumentCallback(t):t;return r[i]}}const nu={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},lu={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},iu={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},du={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},cu={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},xu={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},mu=(a,t)=>{const s=Number(a),o=s%100;if(o>20||o<10)switch(o%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},uu={ordinalNumber:mu,era:fs({values:nu,defaultWidth:"wide"}),quarter:fs({values:lu,defaultWidth:"wide",argumentCallback:a=>a-1}),month:fs({values:iu,defaultWidth:"wide"}),day:fs({values:du,defaultWidth:"wide"}),dayPeriod:fs({values:cu,defaultWidth:"wide",formattingValues:xu,defaultFormattingWidth:"wide"})};function js(a){return(t,s={})=>{const o=s.width,r=o&&a.matchPatterns[o]||a.matchPatterns[a.defaultMatchWidth],i=t.match(r);if(!i)return null;const l=i[0],x=o&&a.parsePatterns[o]||a.parsePatterns[a.defaultParseWidth],j=Array.isArray(x)?gu(x,d=>d.test(l)):pu(x,d=>d.test(l));let g;g=a.valueCallback?a.valueCallback(j):j,g=s.valueCallback?s.valueCallback(g):g;const v=t.slice(l.length);return{value:g,rest:v}}}function pu(a,t){for(const s in a)if(Object.prototype.hasOwnProperty.call(a,s)&&t(a[s]))return s}function gu(a,t){for(let s=0;s<a.length;s++)if(t(a[s]))return s}function Zl(a){return(t,s={})=>{const o=t.match(a.matchPattern);if(!o)return null;const r=o[0],i=t.match(a.parsePattern);if(!i)return null;let l=a.valueCallback?a.valueCallback(i[0]):i[0];l=s.valueCallback?s.valueCallback(l):l;const x=t.slice(r.length);return{value:l,rest:x}}}const hu=/^(\d+)(th|st|nd|rd)?/i,bu=/\d+/i,fu={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},ju={any:[/^b/i,/^(a|c)/i]},vu={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},yu={any:[/1/i,/2/i,/3/i,/4/i]},Nu={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},_u={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},wu={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Cu={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},ku={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Su={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Eu={ordinalNumber:Zl({matchPattern:hu,parsePattern:bu,valueCallback:a=>parseInt(a,10)}),era:js({matchPatterns:fu,defaultMatchWidth:"wide",parsePatterns:ju,defaultParseWidth:"any"}),quarter:js({matchPatterns:vu,defaultMatchWidth:"wide",parsePatterns:yu,defaultParseWidth:"any",valueCallback:a=>a+1}),month:js({matchPatterns:Nu,defaultMatchWidth:"wide",parsePatterns:_u,defaultParseWidth:"any"}),day:js({matchPatterns:wu,defaultMatchWidth:"wide",parsePatterns:Cu,defaultParseWidth:"any"}),dayPeriod:js({matchPatterns:ku,defaultMatchWidth:"any",parsePatterns:Su,defaultParseWidth:"any"})},ei={code:"en-US",formatDistance:Zm,formatLong:tu,formatRelative:ou,localize:uu,match:Eu,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Fu(a,t){const s=qa(a,t==null?void 0:t.in);return qm(s,Jm(s))+1}function Pu(a,t){const s=qa(a,t==null?void 0:t.in),o=+Br(s)-+Im(s);return Math.round(o/Xl)+1}function ai(a,t){var v,d,m,C;const s=qa(a,t==null?void 0:t.in),o=s.getFullYear(),r=or(),i=(t==null?void 0:t.firstWeekContainsDate)??((d=(v=t==null?void 0:t.locale)==null?void 0:v.options)==null?void 0:d.firstWeekContainsDate)??r.firstWeekContainsDate??((C=(m=r.locale)==null?void 0:m.options)==null?void 0:C.firstWeekContainsDate)??1,l=Ns((t==null?void 0:t.in)||a,0);l.setFullYear(o+1,0,i),l.setHours(0,0,0,0);const x=Yt(l,t),j=Ns((t==null?void 0:t.in)||a,0);j.setFullYear(o,0,i),j.setHours(0,0,0,0);const g=Yt(j,t);return+s>=+x?o+1:+s>=+g?o:o-1}function Ru(a,t){var x,j,g,v;const s=or(),o=(t==null?void 0:t.firstWeekContainsDate)??((j=(x=t==null?void 0:t.locale)==null?void 0:x.options)==null?void 0:j.firstWeekContainsDate)??s.firstWeekContainsDate??((v=(g=s.locale)==null?void 0:g.options)==null?void 0:v.firstWeekContainsDate)??1,r=ai(a,t),i=Ns((t==null?void 0:t.in)||a,0);return i.setFullYear(r,0,o),i.setHours(0,0,0,0),Yt(i,t)}function $u(a,t){const s=qa(a,t==null?void 0:t.in),o=+Yt(s,t)-+Ru(s,t);return Math.round(o/Xl)+1}function _a(a,t){const s=a<0?"-":"",o=Math.abs(a).toString().padStart(t,"0");return s+o}const Ms={y(a,t){const s=a.getFullYear(),o=s>0?s:1-s;return _a(t==="yy"?o%100:o,t.length)},M(a,t){const s=a.getMonth();return t==="M"?String(s+1):_a(s+1,2)},d(a,t){return _a(a.getDate(),t.length)},a(a,t){const s=a.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];case"aaaa":default:return s==="am"?"a.m.":"p.m."}},h(a,t){return _a(a.getHours()%12||12,t.length)},H(a,t){return _a(a.getHours(),t.length)},m(a,t){return _a(a.getMinutes(),t.length)},s(a,t){return _a(a.getSeconds(),t.length)},S(a,t){const s=t.length,o=a.getMilliseconds(),r=Math.trunc(o*Math.pow(10,s-3));return _a(r,t.length)}},pt={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Bn={G:function(a,t,s){const o=a.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return s.era(o,{width:"abbreviated"});case"GGGGG":return s.era(o,{width:"narrow"});case"GGGG":default:return s.era(o,{width:"wide"})}},y:function(a,t,s){if(t==="yo"){const o=a.getFullYear(),r=o>0?o:1-o;return s.ordinalNumber(r,{unit:"year"})}return Ms.y(a,t)},Y:function(a,t,s,o){const r=ai(a,o),i=r>0?r:1-r;if(t==="YY"){const l=i%100;return _a(l,2)}return t==="Yo"?s.ordinalNumber(i,{unit:"year"}):_a(i,t.length)},R:function(a,t){const s=Yl(a);return _a(s,t.length)},u:function(a,t){const s=a.getFullYear();return _a(s,t.length)},Q:function(a,t,s){const o=Math.ceil((a.getMonth()+1)/3);switch(t){case"Q":return String(o);case"QQ":return _a(o,2);case"Qo":return s.ordinalNumber(o,{unit:"quarter"});case"QQQ":return s.quarter(o,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(o,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(o,{width:"wide",context:"formatting"})}},q:function(a,t,s){const o=Math.ceil((a.getMonth()+1)/3);switch(t){case"q":return String(o);case"qq":return _a(o,2);case"qo":return s.ordinalNumber(o,{unit:"quarter"});case"qqq":return s.quarter(o,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(o,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(o,{width:"wide",context:"standalone"})}},M:function(a,t,s){const o=a.getMonth();switch(t){case"M":case"MM":return Ms.M(a,t);case"Mo":return s.ordinalNumber(o+1,{unit:"month"});case"MMM":return s.month(o,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(o,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(o,{width:"wide",context:"formatting"})}},L:function(a,t,s){const o=a.getMonth();switch(t){case"L":return String(o+1);case"LL":return _a(o+1,2);case"Lo":return s.ordinalNumber(o+1,{unit:"month"});case"LLL":return s.month(o,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(o,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(o,{width:"wide",context:"standalone"})}},w:function(a,t,s,o){const r=$u(a,o);return t==="wo"?s.ordinalNumber(r,{unit:"week"}):_a(r,t.length)},I:function(a,t,s){const o=Pu(a);return t==="Io"?s.ordinalNumber(o,{unit:"week"}):_a(o,t.length)},d:function(a,t,s){return t==="do"?s.ordinalNumber(a.getDate(),{unit:"date"}):Ms.d(a,t)},D:function(a,t,s){const o=Fu(a);return t==="Do"?s.ordinalNumber(o,{unit:"dayOfYear"}):_a(o,t.length)},E:function(a,t,s){const o=a.getDay();switch(t){case"E":case"EE":case"EEE":return s.day(o,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(o,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(o,{width:"short",context:"formatting"});case"EEEE":default:return s.day(o,{width:"wide",context:"formatting"})}},e:function(a,t,s,o){const r=a.getDay(),i=(r-o.weekStartsOn+8)%7||7;switch(t){case"e":return String(i);case"ee":return _a(i,2);case"eo":return s.ordinalNumber(i,{unit:"day"});case"eee":return s.day(r,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(r,{width:"short",context:"formatting"});case"eeee":default:return s.day(r,{width:"wide",context:"formatting"})}},c:function(a,t,s,o){const r=a.getDay(),i=(r-o.weekStartsOn+8)%7||7;switch(t){case"c":return String(i);case"cc":return _a(i,t.length);case"co":return s.ordinalNumber(i,{unit:"day"});case"ccc":return s.day(r,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(r,{width:"narrow",context:"standalone"});case"cccccc":return s.day(r,{width:"short",context:"standalone"});case"cccc":default:return s.day(r,{width:"wide",context:"standalone"})}},i:function(a,t,s){const o=a.getDay(),r=o===0?7:o;switch(t){case"i":return String(r);case"ii":return _a(r,t.length);case"io":return s.ordinalNumber(r,{unit:"day"});case"iii":return s.day(o,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(o,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(o,{width:"short",context:"formatting"});case"iiii":default:return s.day(o,{width:"wide",context:"formatting"})}},a:function(a,t,s){const r=a.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(a,t,s){const o=a.getHours();let r;switch(o===12?r=pt.noon:o===0?r=pt.midnight:r=o/12>=1?"pm":"am",t){case"b":case"bb":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(a,t,s){const o=a.getHours();let r;switch(o>=17?r=pt.evening:o>=12?r=pt.afternoon:o>=4?r=pt.morning:r=pt.night,t){case"B":case"BB":case"BBB":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(a,t,s){if(t==="ho"){let o=a.getHours()%12;return o===0&&(o=12),s.ordinalNumber(o,{unit:"hour"})}return Ms.h(a,t)},H:function(a,t,s){return t==="Ho"?s.ordinalNumber(a.getHours(),{unit:"hour"}):Ms.H(a,t)},K:function(a,t,s){const o=a.getHours()%12;return t==="Ko"?s.ordinalNumber(o,{unit:"hour"}):_a(o,t.length)},k:function(a,t,s){let o=a.getHours();return o===0&&(o=24),t==="ko"?s.ordinalNumber(o,{unit:"hour"}):_a(o,t.length)},m:function(a,t,s){return t==="mo"?s.ordinalNumber(a.getMinutes(),{unit:"minute"}):Ms.m(a,t)},s:function(a,t,s){return t==="so"?s.ordinalNumber(a.getSeconds(),{unit:"second"}):Ms.s(a,t)},S:function(a,t){return Ms.S(a,t)},X:function(a,t,s){const o=a.getTimezoneOffset();if(o===0)return"Z";switch(t){case"X":return Wn(o);case"XXXX":case"XX":return Hs(o);case"XXXXX":case"XXX":default:return Hs(o,":")}},x:function(a,t,s){const o=a.getTimezoneOffset();switch(t){case"x":return Wn(o);case"xxxx":case"xx":return Hs(o);case"xxxxx":case"xxx":default:return Hs(o,":")}},O:function(a,t,s){const o=a.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Un(o,":");case"OOOO":default:return"GMT"+Hs(o,":")}},z:function(a,t,s){const o=a.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Un(o,":");case"zzzz":default:return"GMT"+Hs(o,":")}},t:function(a,t,s){const o=Math.trunc(+a/1e3);return _a(o,t.length)},T:function(a,t,s){return _a(+a,t.length)}};function Un(a,t=""){const s=a>0?"-":"+",o=Math.abs(a),r=Math.trunc(o/60),i=o%60;return i===0?s+String(r):s+String(r)+t+_a(i,2)}function Wn(a,t){return a%60===0?(a>0?"-":"+")+_a(Math.abs(a)/60,2):Hs(a,t)}function Hs(a,t=""){const s=a>0?"-":"+",o=Math.abs(a),r=_a(Math.trunc(o/60),2),i=_a(o%60,2);return s+r+t+i}const Hn=(a,t)=>{switch(a){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},si=(a,t)=>{switch(a){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Au=(a,t)=>{const s=a.match(/(P+)(p+)?/)||[],o=s[1],r=s[2];if(!r)return Hn(a,t);let i;switch(o){case"P":i=t.dateTime({width:"short"});break;case"PP":i=t.dateTime({width:"medium"});break;case"PPP":i=t.dateTime({width:"long"});break;case"PPPP":default:i=t.dateTime({width:"full"});break}return i.replace("{{date}}",Hn(o,t)).replace("{{time}}",si(r,t))},Du={p:si,P:Au},Mu=/^D+$/,Lu=/^Y+$/,Tu=["D","DD","YY","YYYY"];function qu(a){return Mu.test(a)}function Iu(a){return Lu.test(a)}function zu(a,t,s){const o=Ou(a,t,s);if(console.warn(o),Tu.includes(a))throw new RangeError(o)}function Ou(a,t,s){const o=a[0]==="Y"?"years":"days of the month";return`Use \`${a.toLowerCase()}\` instead of \`${a}\` (in \`${t}\`) for formatting ${o} to the input \`${s}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Vu=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Bu=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Uu=/^'([^]*?)'?$/,Wu=/''/g,Hu=/[a-zA-Z]/;function ti(a,t,s){var v,d,m,C,y,c,f,b;const o=or(),r=(s==null?void 0:s.locale)??o.locale??ei,i=(s==null?void 0:s.firstWeekContainsDate)??((d=(v=s==null?void 0:s.locale)==null?void 0:v.options)==null?void 0:d.firstWeekContainsDate)??o.firstWeekContainsDate??((C=(m=o.locale)==null?void 0:m.options)==null?void 0:C.firstWeekContainsDate)??1,l=(s==null?void 0:s.weekStartsOn)??((c=(y=s==null?void 0:s.locale)==null?void 0:y.options)==null?void 0:c.weekStartsOn)??o.weekStartsOn??((b=(f=o.locale)==null?void 0:f.options)==null?void 0:b.weekStartsOn)??0,x=qa(a,s==null?void 0:s.in);if(!Vm(x))throw new RangeError("Invalid time value");let j=t.match(Bu).map(u=>{const h=u[0];if(h==="p"||h==="P"){const p=Du[h];return p(u,r.formatLong)}return u}).join("").match(Vu).map(u=>{if(u==="''")return{isToken:!1,value:"'"};const h=u[0];if(h==="'")return{isToken:!1,value:Ku(u)};if(Bn[h])return{isToken:!0,value:u};if(h.match(Hu))throw new RangeError("Format string contains an unescaped latin alphabet character `"+h+"`");return{isToken:!1,value:u}});r.localize.preprocessor&&(j=r.localize.preprocessor(x,j));const g={firstWeekContainsDate:i,weekStartsOn:l,locale:r};return j.map(u=>{if(!u.isToken)return u.value;const h=u.value;(!(s!=null&&s.useAdditionalWeekYearTokens)&&Iu(h)||!(s!=null&&s.useAdditionalDayOfYearTokens)&&qu(h))&&zu(h,t,String(a));const p=Bn[h[0]];return p(x,h,r.localize,g)}).join("")}function Ku(a){const t=a.match(Uu);return t?t[1].replace(Wu,"'"):a}function Gu(a,t,s){const o=or(),r=(s==null?void 0:s.locale)??o.locale??ei,i=2520,l=$r(a,t);if(isNaN(l))throw new RangeError("Invalid time value");const x=Object.assign({},s,{addSuffix:s==null?void 0:s.addSuffix,comparison:l}),[j,g]=eo(s==null?void 0:s.in,...l>0?[t,a]:[a,t]),v=Qm(g,j),d=(Ur(g)-Ur(j))/1e3,m=Math.round((v-d)/60);let C;if(m<2)return s!=null&&s.includeSeconds?v<5?r.formatDistance("lessThanXSeconds",5,x):v<10?r.formatDistance("lessThanXSeconds",10,x):v<20?r.formatDistance("lessThanXSeconds",20,x):v<40?r.formatDistance("halfAMinute",0,x):v<60?r.formatDistance("lessThanXMinutes",1,x):r.formatDistance("xMinutes",1,x):m===0?r.formatDistance("lessThanXMinutes",1,x):r.formatDistance("xMinutes",m,x);if(m<45)return r.formatDistance("xMinutes",m,x);if(m<90)return r.formatDistance("aboutXHours",1,x);if(m<zn){const y=Math.round(m/60);return r.formatDistance("aboutXHours",y,x)}else{if(m<i)return r.formatDistance("xDays",1,x);if(m<Cr){const y=Math.round(m/zn);return r.formatDistance("xDays",y,x)}else if(m<Cr*2)return C=Math.round(m/Cr),r.formatDistance("aboutXMonths",C,x)}if(C=Xm(g,j),C<12){const y=Math.round(m/Cr);return r.formatDistance("xMonths",y,x)}else{const y=C%12,c=Math.trunc(C/12);return y<3?r.formatDistance("aboutXYears",c,x):y<9?r.formatDistance("overXYears",c,x):r.formatDistance("almostXYears",c+1,x)}}function Xu(a,t){return Gu(a,zm(a),t)}function Qu(a,t){const s=()=>Ns(t==null?void 0:t.in,NaN),r=e0(a);let i;if(r.date){const g=a0(r.date,2);i=s0(g.restDateString,g.year)}if(!i||isNaN(+i))return s();const l=+i;let x=0,j;if(r.time&&(x=t0(r.time),isNaN(x)))return s();if(r.timezone){if(j=r0(r.timezone),isNaN(j))return s()}else{const g=new Date(l+x),v=qa(0,t==null?void 0:t.in);return v.setFullYear(g.getUTCFullYear(),g.getUTCMonth(),g.getUTCDate()),v.setHours(g.getUTCHours(),g.getUTCMinutes(),g.getUTCSeconds(),g.getUTCMilliseconds()),v}return qa(l+x+j,t==null?void 0:t.in)}const kr={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Ju=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Yu=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Zu=/^([+-])(\d{2})(?::?(\d{2}))?$/;function e0(a){const t={},s=a.split(kr.dateTimeDelimiter);let o;if(s.length>2)return t;if(/:/.test(s[0])?o=s[0]:(t.date=s[0],o=s[1],kr.timeZoneDelimiter.test(t.date)&&(t.date=a.split(kr.timeZoneDelimiter)[0],o=a.substr(t.date.length,a.length))),o){const r=kr.timezone.exec(o);r?(t.time=o.replace(r[1],""),t.timezone=r[1]):t.time=o}return t}function a0(a,t){const s=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),o=a.match(s);if(!o)return{year:NaN,restDateString:""};const r=o[1]?parseInt(o[1]):null,i=o[2]?parseInt(o[2]):null;return{year:i===null?r:i*100,restDateString:a.slice((o[1]||o[2]).length)}}function s0(a,t){if(t===null)return new Date(NaN);const s=a.match(Ju);if(!s)return new Date(NaN);const o=!!s[4],r=zt(s[1]),i=zt(s[2])-1,l=zt(s[3]),x=zt(s[4]),j=zt(s[5])-1;if(o)return d0(t,x,j)?o0(t,x,j):new Date(NaN);{const g=new Date(0);return!l0(t,i,l)||!i0(t,r)?new Date(NaN):(g.setUTCFullYear(t,i,Math.max(r,l)),g)}}function zt(a){return a?parseInt(a):1}function t0(a){const t=a.match(Yu);if(!t)return NaN;const s=io(t[1]),o=io(t[2]),r=io(t[3]);return c0(s,o,r)?s*Jl+o*Ql+r*1e3:NaN}function io(a){return a&&parseFloat(a.replace(",","."))||0}function r0(a){if(a==="Z")return 0;const t=a.match(Zu);if(!t)return 0;const s=t[1]==="+"?-1:1,o=parseInt(t[2]),r=t[3]&&parseInt(t[3])||0;return x0(o,r)?s*(o*Jl+r*Ql):NaN}function o0(a,t,s){const o=new Date(0);o.setUTCFullYear(a,0,4);const r=o.getUTCDay()||7,i=(t-1)*7+s+1-r;return o.setUTCDate(o.getUTCDate()+i),o}const n0=[31,null,31,30,31,30,31,31,30,31,30,31];function ri(a){return a%400===0||a%4===0&&a%100!==0}function l0(a,t,s){return t>=0&&t<=11&&s>=1&&s<=(n0[t]||(ri(a)?29:28))}function i0(a,t){return t>=1&&t<=(ri(a)?366:365)}function d0(a,t,s){return t>=1&&t<=53&&s>=0&&s<=6}function c0(a,t,s){return a===24?t===0&&s===0:s>=0&&s<60&&t>=0&&t<60&&a>=0&&a<25}function x0(a,t){return t>=0&&t<=59}const m0={lessThanXSeconds:{one:"menos de um segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"meio minuto",lessThanXMinutes:{one:"menos de um minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"cerca de 1 hora",other:"cerca de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 dia",other:"{{count}} dias"},aboutXWeeks:{one:"cerca de 1 semana",other:"cerca de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"cerca de 1 mÃªs",other:"cerca de {{count}} meses"},xMonths:{one:"1 mÃªs",other:"{{count}} meses"},aboutXYears:{one:"cerca de 1 ano",other:"cerca de {{count}} anos"},xYears:{one:"1 ano",other:"{{count}} anos"},overXYears:{one:"mais de 1 ano",other:"mais de {{count}} anos"},almostXYears:{one:"quase 1 ano",other:"quase {{count}} anos"}},u0=(a,t,s)=>{let o;const r=m0[a];return typeof r=="string"?o=r:t===1?o=r.one:o=r.other.replace("{{count}}",String(t)),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?"em "+o:"hÃ¡ "+o:o},p0={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/yyyy"},g0={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},h0={full:"{{date}} 'Ã s' {{time}}",long:"{{date}} 'Ã s' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},b0={date:vt({formats:p0,defaultWidth:"full"}),time:vt({formats:g0,defaultWidth:"full"}),dateTime:vt({formats:h0,defaultWidth:"full"})},f0={lastWeek:a=>{const t=a.getDay();return"'"+(t===0||t===6?"Ãºltimo":"Ãºltima")+"' eeee 'Ã s' p"},yesterday:"'ontem Ã s' p",today:"'hoje Ã s' p",tomorrow:"'amanhÃ£ Ã s' p",nextWeek:"eeee 'Ã s' p",other:"P"},j0=(a,t,s,o)=>{const r=f0[a];return typeof r=="function"?r(t):r},v0={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","depois de cristo"]},y0={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1Âº trimestre","2Âº trimestre","3Âº trimestre","4Âº trimestre"]},N0={narrow:["j","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"],wide:["janeiro","fevereiro","marÃ§o","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"]},_0={narrow:["D","S","T","Q","Q","S","S"],short:["dom","seg","ter","qua","qui","sex","sab"],abbreviated:["domingo","segunda","terÃ§a","quarta","quinta","sexta","sÃ¡bado"],wide:["domingo","segunda-feira","terÃ§a-feira","quarta-feira","quinta-feira","sexta-feira","sÃ¡bado"]},w0={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"manhÃ£",afternoon:"tarde",evening:"tarde",night:"noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"manhÃ£",afternoon:"tarde",evening:"tarde",night:"noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"manhÃ£",afternoon:"tarde",evening:"tarde",night:"noite"}},C0={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"da manhÃ£",afternoon:"da tarde",evening:"da tarde",night:"da noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"da manhÃ£",afternoon:"da tarde",evening:"da tarde",night:"da noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"da manhÃ£",afternoon:"da tarde",evening:"da tarde",night:"da noite"}},k0=(a,t)=>{const s=Number(a);return(t==null?void 0:t.unit)==="week"?s+"Âª":s+"Âº"},S0={ordinalNumber:k0,era:fs({values:v0,defaultWidth:"wide"}),quarter:fs({values:y0,defaultWidth:"wide",argumentCallback:a=>a-1}),month:fs({values:N0,defaultWidth:"wide"}),day:fs({values:_0,defaultWidth:"wide"}),dayPeriod:fs({values:w0,defaultWidth:"wide",formattingValues:C0,defaultFormattingWidth:"wide"})},E0=/^(\d+)[ÂºÂªo]?/i,F0=/\d+/i,P0={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|d\.?\s?c\.?)/i,wide:/^(antes de cristo|depois de cristo)/i},R0={any:[/^ac/i,/^dc/i],wide:[/^antes de cristo/i,/^depois de cristo/i]},$0={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234](Âº)? trimestre/i},A0={any:[/1/i,/2/i,/3/i,/4/i]},D0={narrow:/^[jfmajsond]/i,abbreviated:/^(jan|fev|mar|abr|mai|jun|jul|ago|set|out|nov|dez)/i,wide:/^(janeiro|fevereiro|marÃ§o|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)/i},M0={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^fev/i,/^mar/i,/^abr/i,/^mai/i,/^jun/i,/^jul/i,/^ago/i,/^set/i,/^out/i,/^nov/i,/^dez/i]},L0={narrow:/^(dom|[23456]Âª?|s[aÃ¡]b)/i,short:/^(dom|[23456]Âª?|s[aÃ¡]b)/i,abbreviated:/^(dom|seg|ter|qua|qui|sex|s[aÃ¡]b)/i,wide:/^(domingo|(segunda|ter[cÃ§]a|quarta|quinta|sexta)([- ]feira)?|s[aÃ¡]bado)/i},T0={short:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[aÃ¡]/i],narrow:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[aÃ¡]/i],any:[/^d/i,/^seg/i,/^t/i,/^qua/i,/^qui/i,/^sex/i,/^s[aÃ¡]b/i]},q0={narrow:/^(a|p|mn|md|(da) (manhÃ£|tarde|noite))/i,any:/^([ap]\.?\s?m\.?|meia[-\s]noite|meio[-\s]dia|(da) (manhÃ£|tarde|noite))/i},I0={any:{am:/^a/i,pm:/^p/i,midnight:/^mn|^meia[-\s]noite/i,noon:/^md|^meio[-\s]dia/i,morning:/manhÃ£/i,afternoon:/tarde/i,evening:/tarde/i,night:/noite/i}},z0={ordinalNumber:Zl({matchPattern:E0,parsePattern:F0,valueCallback:a=>parseInt(a,10)}),era:js({matchPatterns:P0,defaultMatchWidth:"wide",parsePatterns:R0,defaultParseWidth:"any"}),quarter:js({matchPatterns:$0,defaultMatchWidth:"wide",parsePatterns:A0,defaultParseWidth:"any",valueCallback:a=>a+1}),month:js({matchPatterns:D0,defaultMatchWidth:"wide",parsePatterns:M0,defaultParseWidth:"any"}),day:js({matchPatterns:L0,defaultMatchWidth:"wide",parsePatterns:T0,defaultParseWidth:"any"}),dayPeriod:js({matchPatterns:q0,defaultMatchWidth:"any",parsePatterns:I0,defaultParseWidth:"any"})},Io={code:"pt-BR",formatDistance:u0,formatLong:b0,formatRelative:j0,localize:S0,match:z0,options:{weekStartsOn:0,firstWeekContainsDate:1}},yt=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0}).format(a),oi=a=>{try{const t=Qu(a);return ti(t,"dd/MMM",{locale:Io})}catch{return a}},Kn=({active:a,payload:t})=>{if(!a||!t||!t.length)return null;const s=t[0].payload;return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-lg border border-gray-200",children:[e.jsx("p",{className:"font-medium text-gray-900 mb-2",children:oi(s.data_projetada)}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{className:"text-blue-600",children:["Saldo: ",e.jsx("strong",{children:yt(s.saldo_estimado)})]}),s.limite_superior&&e.jsxs("p",{className:"text-green-600",children:["Otimista: ",yt(s.limite_superior)]}),s.limite_inferior&&e.jsxs("p",{className:"text-red-600",children:["Pessimista: ",yt(s.limite_inferior)]}),s.alerta_nivel&&e.jsxs("p",{className:`font-medium ${s.alerta_nivel==="critico"?"text-red-600":s.alerta_nivel==="alerta"?"text-yellow-600":"text-green-600"}`,children:["Status: ",s.alerta_nivel]})]})]})};function Wr({projecoes:a,titulo:t="ProjeÃ§Ã£o de Fluxo de Caixa",detalhado:s=!1}){var i,l,x,j,g,v;if(!a||a.length===0)return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:t}),e.jsx("div",{className:"text-center py-8 text-gray-500",children:'Nenhuma projeÃ§Ã£o disponÃ­vel. Clique em "Atualizar ProjeÃ§Ã£o" para gerar.'})]});const o=a.map(d=>({...d,data_formatada:oi(d.data_projetada),saldo:d.saldo_estimado||0,superior:d.limite_superior||null,inferior:d.limite_inferior||null})),r=o.some(d=>d.superior!==null||d.inferior!==null);return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:t}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Saldo Inicial"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:yt(((i=o[0])==null?void 0:i.saldo)||0)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Saldo Final"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:yt(((l=o[o.length-1])==null?void 0:l.saldo)||0)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"VariaÃ§Ã£o"}),e.jsx("p",{className:`text-lg font-bold ${((x=o[o.length-1])==null?void 0:x.saldo)-((j=o[0])==null?void 0:j.saldo)>=0?"text-green-600":"text-red-600"}`,children:yt((((g=o[o.length-1])==null?void 0:g.saldo)||0)-(((v=o[0])==null?void 0:v.saldo)||0))})]})]}),e.jsx(za,{width:"100%",height:s?400:300,children:r?e.jsxs(Bi,{data:o,children:[e.jsx(Ka,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Ga,{dataKey:"data_formatada",stroke:"#6b7280",style:{fontSize:"12px"}}),e.jsx(Ua,{stroke:"#6b7280",style:{fontSize:"12px"},tickFormatter:d=>`R$ ${(d/1e3).toFixed(0)}k`}),e.jsx(Ma,{content:e.jsx(Kn,{})}),e.jsx(Wa,{}),e.jsx(pn,{type:"monotone",dataKey:"superior",stroke:"#10b981",fill:"#d1fae5",fillOpacity:.3,name:"CenÃ¡rio Otimista"}),e.jsx(pn,{type:"monotone",dataKey:"inferior",stroke:"#ef4444",fill:"#fee2e2",fillOpacity:.3,name:"CenÃ¡rio Pessimista"}),e.jsx(gs,{type:"monotone",dataKey:"saldo",stroke:"#3b82f6",strokeWidth:3,dot:{r:4,fill:"#3b82f6"},name:"Saldo Estimado"})]}):e.jsxs(Et,{data:o,children:[e.jsx(Ka,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Ga,{dataKey:"data_formatada",stroke:"#6b7280",style:{fontSize:"12px"}}),e.jsx(Ua,{stroke:"#6b7280",style:{fontSize:"12px"},tickFormatter:d=>`R$ ${(d/1e3).toFixed(0)}k`}),e.jsx(Ma,{content:e.jsx(Kn,{})}),e.jsx(Wa,{}),e.jsx(gs,{type:"monotone",dataKey:"saldo",stroke:"#3b82f6",strokeWidth:3,dot:{r:4,fill:"#3b82f6"},name:"Saldo Estimado"})]})}),o.some(d=>d.vai_faltar_caixa)&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800 font-medium",children:"âš ï¸ AtenÃ§Ã£o: ProjeÃ§Ã£o indica que o caixa pode ficar negativo nos prÃ³ximos dias!"})})]})}const O0=a=>{const t={critico:{icon:La,bgColor:"bg-red-50",borderColor:"border-red-200",textColor:"text-red-800",iconColor:"text-red-600"},alerta:{icon:xa,bgColor:"bg-yellow-50",borderColor:"border-yellow-200",textColor:"text-yellow-800",iconColor:"text-yellow-600"},aviso:{icon:Po,bgColor:"bg-blue-50",borderColor:"border-blue-200",textColor:"text-blue-800",iconColor:"text-blue-600"},info:{icon:fa,bgColor:"bg-green-50",borderColor:"border-green-200",textColor:"text-green-800",iconColor:"text-green-600"}};return t[a]||t.info};function Gn({alertas:a}){if(!a||a.length===0)return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Alertas do Caixa"}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fa,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Nenhum alerta no momento"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Seu caixa estÃ¡ saudÃ¡vel! ðŸŽ‰"})]})]});const t={critico:0,alerta:1,aviso:2,info:3},s=[...a].sort((o,r)=>(t[o.tipo]||3)-(t[r.tipo]||3));return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Alertas do Caixa"}),e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-sm rounded-full",children:s.length})]}),e.jsx("div",{className:"space-y-3",children:s.map((o,r)=>{const i=O0(o.tipo),l=i.icon;return e.jsx("div",{className:`p-4 rounded-lg border ${i.bgColor} ${i.borderColor}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(l,{className:`w-5 h-5 flex-shrink-0 mt-0.5 ${i.iconColor}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-medium ${i.textColor} mb-1`,children:o.titulo}),e.jsx("p",{className:`text-sm ${i.textColor} opacity-90`,children:o.mensagem}),o.data&&e.jsx("p",{className:`text-xs ${i.textColor} opacity-70 mt-2`,children:new Date(o.data).toLocaleString("pt-BR")})]})]})},r)})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 grid grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:s.filter(o=>o.tipo==="critico").length}),e.jsx("p",{className:"text-xs text-gray-600",children:"CrÃ­ticos"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:s.filter(o=>o.tipo==="alerta").length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Alertas"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:s.filter(o=>o.tipo==="aviso").length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Avisos"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:s.filter(o=>o.tipo==="info").length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Infos"})]})]})]})}const Xn=[{id:"otimista",nome:"Otimista",descricao:"Aumento de 20% nas receitas e reduÃƒÂ§ÃƒÂ£o de 10% nas despesas",icon:Ta,color:"green"},{id:"realista",nome:"Realista",descricao:"MantÃƒÂ©m o padrÃƒÂ£o atual de receitas e despesas",icon:Gr,color:"blue"},{id:"pessimista",nome:"Pessimista",descricao:"ReduÃƒÂ§ÃƒÂ£o de 20% nas receitas e aumento de 10% nas despesas",icon:Ha,color:"red"}];function V0({userId:a,projecoesBase:t=[]}){var v,d,m,C,y,c,f,b,u,h,p,k,N,w,S,P,W,te,D;const[s,o]=n.useState("realista"),[r,i]=n.useState(!1),[l,x]=n.useState(null),j=async()=>{i(!0);try{const X={Authorization:`Bearer ${localStorage.getItem("access_token")||localStorage.getItem("token")}`},re=await F.post(`/api/ia/fluxo/simular-cenario/${a}`,{cenario:s},{headers:X});x(re.data),ce.success(`CenÃƒÂ¡rio ${s} simulado com sucesso!`)}catch(A){console.error("Erro ao simular cenÃƒÂ¡rio:",A),ce.error("Erro ao simular cenÃƒÂ¡rio")}finally{i(!1)}},g=Xn.find(A=>A.id===s);return g==null||g.icon,e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Simulador de CenÃƒÂ¡rios"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Simule diferentes cenÃƒÂ¡rios para entender o impacto no seu fluxo de caixa"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:Xn.map(A=>{const X=A.icon,re=s===A.id;return e.jsxs("button",{onClick:()=>o(A.id),className:`p-4 rounded-lg border-2 transition-all text-left ${re?`border-${A.color}-500 bg-${A.color}-50`:"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(X,{className:`w-6 h-6 ${re?`text-${A.color}-600`:"text-gray-400"}`}),e.jsx("h4",{className:`font-semibold ${re?`text-${A.color}-900`:"text-gray-900"}`,children:A.nome})]}),e.jsx("p",{className:`text-sm ${re?`text-${A.color}-700`:"text-gray-600"}`,children:A.descricao})]},A.id)})}),e.jsx("button",{onClick:j,disabled:r,className:"w-full md:w-auto px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Simulando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Li,{className:"w-5 h-5"}),"Simular CenÃƒÂ¡rio"]})})]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["ComparaÃƒÂ§ÃƒÂ£o: Base vs ",g==null?void 0:g.nome]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-3",children:"CenÃƒÂ¡rio Atual"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Saldo Final"}),e.jsx("span",{className:"font-semibold text-gray-900",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(((v=t==null?void 0:t[(t==null?void 0:t.length)-1])==null?void 0:v.saldo_estimado)||0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"VariaÃƒÂ§ÃƒÂ£o"}),e.jsx("span",{className:"font-semibold text-gray-900",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format((((d=t==null?void 0:t[(t==null?void 0:t.length)-1])==null?void 0:d.saldo_estimado)||0)-(((m=t==null?void 0:t[0])==null?void 0:m.saldo_estimado)||0))})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-700 mb-3",children:["CenÃƒÂ¡rio ",g==null?void 0:g.nome]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Saldo Final"}),e.jsx("span",{className:`font-semibold ${s==="otimista"?"text-green-600":s==="pessimista"?"text-red-600":"text-blue-600"}`,children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(((c=(y=l==null?void 0:l.projecoes_ajustadas)==null?void 0:y[((C=l==null?void 0:l.projecoes_ajustadas)==null?void 0:C.length)-1])==null?void 0:c.saldo_ajustado)||0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"VariaÃƒÂ§ÃƒÂ£o"}),e.jsx("span",{className:`font-semibold ${s==="otimista"?"text-green-600":s==="pessimista"?"text-red-600":"text-blue-600"}`,children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format((((u=(b=l==null?void 0:l.projecoes_ajustadas)==null?void 0:b[((f=l==null?void 0:l.projecoes_ajustadas)==null?void 0:f.length)-1])==null?void 0:u.saldo_ajustado)||0)-(((p=(h=l==null?void 0:l.projecoes_ajustadas)==null?void 0:h[0])==null?void 0:p.saldo_ajustado)||0))})]})]})]})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"DiferenÃƒÂ§a no Saldo Final"}),e.jsx("span",{className:`text-xl font-bold ${(((w=(N=l==null?void 0:l.projecoes_ajustadas)==null?void 0:N[((k=l==null?void 0:l.projecoes_ajustadas)==null?void 0:k.length)-1])==null?void 0:w.saldo_ajustado)||0)>(((S=t==null?void 0:t[(t==null?void 0:t.length)-1])==null?void 0:S.saldo_estimado)||0)?"text-green-600":"text-red-600"}`,children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format((((te=(W=l==null?void 0:l.projecoes_ajustadas)==null?void 0:W[((P=l==null?void 0:l.projecoes_ajustadas)==null?void 0:P.length)-1])==null?void 0:te.saldo_ajustado)||0)-(((D=t==null?void 0:t[(t==null?void 0:t.length)-1])==null?void 0:D.saldo_estimado)||0))})]})})]}),e.jsx(Wr,{projecoes:(l==null?void 0:l.projecoes_ajustadas)||[],titulo:`ProjeÃƒÂ§ÃƒÂ£o - CenÃƒÂ¡rio ${g==null?void 0:g.nome}`,detalhado:!0})]}),!l&&t&&t.length>0&&e.jsx(Wr,{projecoes:t,titulo:"ProjeÃƒÂ§ÃƒÂ£o Atual (CenÃƒÂ¡rio Base)",detalhado:!0})]})}function B0(){const[a,t]=n.useState(!1),s=[{titulo:"Dias de Caixa",descricao:"Quantos dias seu caixa consegue cobrir as despesas com o saldo atual. Se tem R$ 10.000 e gasta R$ 1.000/dia, terÃ¡ 10 dias de caixa.",formula:"Saldo Atual Ã· Despesa MÃ©dia DiÃ¡ria",referencia:"Ãšltimos 30 dias"},{titulo:"Saldo Estimado (ProjeÃ§Ã£o)",descricao:"PrevisÃ£o do saldo do caixa para os prÃ³ximos 15 dias, calculada usando inteligÃªncia artificial (Prophet) baseada em histÃ³rico de 30+ dias.",formula:"Saldo Atual + Receitas Previstas - Despesas Previstas",referencia:"PrÃ³ximos 15 dias"},{titulo:"Entrada/SaÃ­da Estimada",descricao:"PrevisÃ£o diÃ¡ria de quanto vocÃª deve receber (entradas) e gastar (saÃ­das) nos prÃ³ximos dias.",formula:"MÃ©dia histÃ³rica Ã· 30 dias Ã— fator sazonalidade",referencia:"PrÃ³ximos 15 dias"},{titulo:"Status do Caixa",descricao:"ClassificaÃ§Ã£o da saÃºde financeira: CRITICO (<7 dias), ALERTA (7-15 dias) ou OK (>15 dias)",formula:'Status = IF(dias_caixa < 7) "CRITICO" ELSE IF(dias_caixa < 15) "ALERTA" ELSE "OK"',referencia:"Dados em tempo real"}],o=[{nome:"VisÃ£o Geral",conteudo:"Mostra os Ã­ndices principais de saÃºde do caixa: quanto tempo de saldo vocÃª tem, a tendÃªncia (melhorando/piorando), despesa mÃ©dia diÃ¡ria e score geral de saÃºde.",periodo:"Ãšltimos 30 dias de histÃ³rico"},{nome:"ProjeÃ§Ãµes 15 Dias",conteudo:"GrÃ¡fico e tabela com a previsÃ£o de saldo diÃ¡rio para os prÃ³ximos 15 dias. Usa algoritmo Prophet com inteligÃªncia artificial.",periodo:"PrÃ³ximos 15 dias a partir de hoje"},{nome:"Alertas",conteudo:"Lista automÃ¡tica de avisos: se o caixa estÃ¡ crÃ­tico, se hÃ¡ risco de falta de saldo, ou se a tendÃªncia estÃ¡ piorando.",periodo:"Monitoramento contÃ­nuo"},{nome:"Simulador",conteudo:"Permite simular 3 cenÃ¡rios: OTIMISTA (+20% receita, -10% despesa), REALISTA (sem mudanÃ§as) e PESSIMISTA (-20% receita, +10% despesa).",periodo:"PrÃ³ximos 15 dias com mudanÃ§as aplicadas"}];return e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg p-6",children:[e.jsxs("button",{onClick:()=>t(!a),className:"w-full flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Po,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Entenda os Dados"})]}),e.jsx(Ys,{className:`w-5 h-5 text-blue-600 transition-transform ${a?"rotate-180":""}`})]}),a&&e.jsxs("div",{className:"mt-6 space-y-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-gray-900 mb-4",children:"O que cada aba mostra?"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map((r,i)=>e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:r.nome}),e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:r.conteudo}),e.jsxs("p",{className:"text-xs text-blue-600 font-medium",children:["ðŸ“… ",r.periodo]})]},i))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-gray-900 mb-4",children:"MÃ©tricas Explicadas"}),e.jsx("div",{className:"space-y-4",children:s.map((r,i)=>e.jsx("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-blue-600",children:i+1})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:r.titulo}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:r.descricao}),e.jsxs("div",{className:"mt-2 text-xs space-y-1",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("strong",{children:"CÃ¡lculo:"})," ",r.formula]}),e.jsxs("p",{className:"text-blue-600",children:[e.jsx("strong",{children:"PerÃ­odo:"})," ",r.referencia]})]})]})]})},i))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-gray-900 mb-4",children:"Perguntas Frequentes"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:'â“ Qual perÃ­odo a "VisÃ£o Geral" estÃ¡ analisando?'}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Os Ãºltimos ",e.jsx("strong",{children:"30 dias"})," de movimentaÃ§Ãµes realizadas. Ela calcula a despesa mÃ©dia desse perÃ­odo para determinar quantos dias de caixa vocÃª tem."]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:"â“ O grÃ¡fico de ProjeÃ§Ãµes Ã© confiÃ¡vel?"}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Usa algoritmo Prophet (inteligÃªncia artificial) que aprende com os Ãºltimos ",e.jsx("strong",{children:"30+ dias"})," de dados. Quanto mais histÃ³rico, mais preciso. Funciona bem para tendÃªncias, mas nÃ£o prevÃª eventos inesperados."]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:"â“ O Simulador altera meus dados reais?"}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"NÃƒO!"}),' Ã‰ apenas uma simulaÃ§Ã£o. Mostra "E se..." ocorressem essas mudanÃ§as. Seus dados permanecem intactos.']})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:'â“ Como interpretar "Dias de Caixa"?'}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"10 dias"})," = vocÃª pode cobrir ",e.jsx("strong",{children:"10 dias de despesas"})," com saldo atual. Se ",e.jsx("strong",{children:"<7 dias"})," Ã© crÃ­tico (risco iminente). Se ",e.jsx("strong",{children:"7-15"})," Ã© alerta. Se ",e.jsx("strong",{children:">15"})," estÃ¡ ok."]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-100",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm mb-1",children:'â“ Qual Ã© a diferenÃ§a entre "Saldo Atual" e "Saldo Estimado"?'}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Saldo Atual"})," = saldo real hoje. ",e.jsx("strong",{children:"Saldo Estimado"})," = previsÃ£o do saldo daqui a X dias (levando em conta receitas/despesas esperadas)."]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-300 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-900 mb-2",children:"ðŸ’¡ Dicas Importantes:"}),e.jsxs("ul",{className:"text-sm text-blue-900 space-y-1",children:[e.jsxs("li",{children:["â€¢ Clique em ",e.jsx("strong",{children:'"Atualizar ProjeÃ§Ã£o"'})," para recalcular com dados mais recentes"]}),e.jsx("li",{children:"â€¢ Os Alertas aparecem automaticamente quando hÃ¡ risco (caixa <7 dias ou tendÃªncia negativa)"}),e.jsx("li",{children:'â€¢ Use o Simulador para planejar: "E se aumentar despesas de marketing em 20%?"'}),e.jsx("li",{children:"â€¢ Se tiver menos de 30 dias de histÃ³rico, as projeÃ§Ãµes serÃ£o mais conservadoras"})]})]})]})]})}function U0({userId:a}){const[t,s]=n.useState(!0),[o,r]=n.useState(null),[i,l]=n.useState([]),[x,j]=n.useState([]),[g,v]=n.useState("visao-geral");n.useEffect(()=>{d()},[a]);const d=async()=>{s(!0);try{const y={Authorization:`Bearer ${localStorage.getItem("access_token")||localStorage.getItem("token")}`},[c,f,b]=await Promise.all([F.get(`/ia/fluxo/indices-saude/${a}`,{headers:y}),F.get(`/ia/fluxo/projecoes/${a}?dias=15`,{headers:y}),F.get(`/ia/fluxo/alertas/${a}`,{headers:y})]);r(c.data),l(f.data||[]),j(b.data||[])}catch(C){console.error("Erro ao carregar dados IA:",C),ce.error("Erro ao carregar dados da IA")}finally{s(!1)}},m=async()=>{const C=ce.loading("Gerando projeÃƒÂ§ÃƒÂ£o com Prophet...");try{const c={Authorization:`Bearer ${localStorage.getItem("access_token")||localStorage.getItem("token")}`};await F.post(`/ia/fluxo/projetar-15-dias/${a}`,{},{headers:c}),ce.success("ProjeÃƒÂ§ÃƒÂ£o gerada com sucesso!",{id:C}),d()}catch(y){console.error("Erro ao gerar projeÃƒÂ§ÃƒÂ£o:",y),ce.error("Erro ao gerar projeÃƒÂ§ÃƒÂ£o",{id:C})}};return t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(B0,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Ã°Å¸Â¤â€“ Fluxo de Caixa Preditivo"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"InteligÃƒÂªncia artificial analisando seu caixa"})]}),e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Aa,{className:"w-4 h-4"}),"Atualizar ProjeÃƒÂ§ÃƒÂ£o"]})]}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>v("visao-geral"),className:`px-4 py-2 font-medium transition-colors ${g==="visao-geral"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"VisÃƒÂ£o Geral"}),e.jsx("button",{onClick:()=>v("projecoes"),className:`px-4 py-2 font-medium transition-colors ${g==="projecoes"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"ProjeÃƒÂ§ÃƒÂµes 15 Dias"}),e.jsxs("button",{onClick:()=>v("alertas"),className:`px-4 py-2 font-medium transition-colors relative ${g==="alertas"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["Alertas",x.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:x.length})]}),e.jsx("button",{onClick:()=>v("simulador"),className:`px-4 py-2 font-medium transition-colors ${g==="simulador"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"Simulador"})]}),e.jsxs("div",{className:"space-y-6",children:[g==="visao-geral"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 border-l-4 border-green-500 p-4 rounded",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Ã°Å¸â€œÅ  VisÃƒÂ£o Geral:"})," AnÃƒÂ¡lise dos ÃƒÂºltimos ",e.jsx("strong",{children:"30 dias"})," para calcular a saÃƒÂºde do caixa. Mostra quanto tempo vocÃƒÂª consegue manter o negÃƒÂ³cio com saldo atual."]})}),e.jsx(Mm,{indices:o}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Wr,{projecoes:i.slice(0,7),titulo:"PrÃƒÂ³ximos 7 Dias"}),e.jsx(Gn,{alertas:x.slice(0,3)})]})]}),g==="projecoes"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 p-4 rounded",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Ã°Å¸â€œË† ProjeÃƒÂ§ÃƒÂ£o 15 Dias:"})," PrevisÃƒÂ£o usando inteligÃƒÂªncia artificial (Prophet). Baseada em ",e.jsx("strong",{children:"30+ dias de histÃƒÂ³rico"})," para prever entradas e saÃƒÂ­das dos prÃƒÂ³ximos ",e.jsx("strong",{children:"15 dias"}),". Quanto mais histÃƒÂ³rico, mais precisa a previsÃƒÂ£o."]})}),e.jsx(Wr,{projecoes:i,titulo:"ProjeÃƒÂ§ÃƒÂ£o 15 Dias com Prophet",detalhado:!0})]}),g==="alertas"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border-l-4 border-orange-500 p-4 rounded",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Ã¢Å¡Â Ã¯Â¸Â Alertas:"})," Avisos automÃƒÂ¡ticos gerados em tempo real.",e.jsx("strong",{children:" CrÃƒÂ­tico"})," = menos de 7 dias de caixa (risco iminente).",e.jsx("strong",{children:" Alerta"})," = 7-15 dias (atenÃƒÂ§ÃƒÂ£o necessÃƒÂ¡ria).",e.jsx("strong",{children:" OK"})," = mais de 15 dias (situaÃƒÂ§ÃƒÂ£o confortÃƒÂ¡vel)."]})}),e.jsx(Gn,{alertas:x})]}),g==="simulador"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 border-l-4 border-purple-500 p-4 rounded",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Ã°Å¸Å½Â¯ Simulador:"})," Teste 3 cenÃƒÂ¡rios para os ",e.jsx("strong",{children:"prÃƒÂ³ximos 15 dias"}),".",e.jsx("strong",{children:" Otimista:"})," +20% receita, -10% despesa.",e.jsx("strong",{children:" Realista:"})," sem mudanÃƒÂ§as.",e.jsx("strong",{children:" Pessimista:"})," -20% receita, +10% despesa.",e.jsx("strong",{children:"Seus dados reais nÃƒÂ£o sÃƒÂ£o alterados!"})]})}),e.jsx(V0,{userId:a,projecoesBase:i})]})]})]})}function W0(){const{user:a}=$t();return e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(U0,{userId:(a==null?void 0:a.id)||1})})}function H0(){const[a,t]=n.useState([]),[s,o]=n.useState(null),[r,i]=n.useState([]),[l,x]=n.useState(""),[j,g]=n.useState(!1),[v,d]=n.useState(!1),m=n.useRef(null);n.useEffect(()=>{y()},[]),n.useEffect(()=>{s&&c(s)},[s]),n.useEffect(()=>{C()},[r]);const C=()=>{var h;(h=m.current)==null||h.scrollIntoView({behavior:"smooth"})},y=async()=>{try{const h=await F.get("/chat/conversas");t(h.data)}catch(h){console.error("Erro ao carregar conversas:",h)}},c=async h=>{g(!0);try{const p=await F.get(`/chat/conversa/${h}/mensagens`);i(p.data)}catch(p){console.error("Erro ao carregar mensagens:",p),ce.error("Erro ao carregar mensagens")}finally{g(!1)}},f=async()=>{try{const h=await F.post("/chat/nova-conversa",{});t([h.data,...a]),o(h.data.id),i([]),ce.success("Nova conversa criada!")}catch(h){console.error("Erro ao criar conversa:",h),ce.error("Erro ao criar conversa")}},b=async h=>{if(h.preventDefault(),!l.trim()||!s)return;d(!0);const p=l;x("");try{const k=await F.post("/chat/enviar",{conversa_id:s,mensagem:p});i([...r,{id:k.data.mensagem_usuario.id,tipo:"usuario",conteudo:k.data.mensagem_usuario.conteudo,criado_em:k.data.mensagem_usuario.criado_em},{id:k.data.mensagem_ia.id,tipo:"assistente",conteudo:k.data.mensagem_ia.conteudo,criado_em:k.data.mensagem_ia.criado_em}]),y()}catch(k){console.error("Erro ao enviar mensagem:",k),ce.error("Erro ao enviar mensagem"),x(p)}finally{d(!1)}},u=async h=>{if(confirm("Deseja deletar esta conversa?"))try{await F.delete(`/chat/conversa/${h}`),t(a.filter(p=>p.id!==h)),s===h&&(o(null),i([])),ce.success("Conversa deletada")}catch(p){console.error("Erro ao deletar conversa:",p),ce.error("Erro ao deletar conversa")}};return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(ao,{className:"w-8 h-8 text-blue-600"}),"Chat IA Financeiro"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Pergunte sobre seu fluxo de caixa, projeÃ§Ãµes e saÃºde financeira"})]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(us,{className:"w-5 h-5"}),"Nova Conversa"]})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"w-80 bg-white border-r border-gray-200 overflow-y-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Conversas Recentes"}),a.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(un,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Nenhuma conversa ainda"}),e.jsx("button",{onClick:f,className:"mt-3 text-blue-600 text-sm hover:underline",children:"Criar primeira conversa"})]}):e.jsx("div",{className:"space-y-2",children:a.map(h=>e.jsx("div",{onClick:()=>o(h.id),className:`p-3 rounded-lg cursor-pointer transition-colors group ${s===h.id?"bg-blue-50 border-2 border-blue-200":"bg-gray-50 hover:bg-gray-100"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:h.titulo||"Nova conversa"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[h.total_mensagens," mensagens"]})]}),e.jsx("button",{onClick:p=>{p.stopPropagation(),u(h.id)},className:"opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-700 transition-opacity",children:e.jsx(Es,{className:"w-4 h-4"})})]})},h.id))})]})}),e.jsx("div",{className:"flex-1 flex flex-col bg-gray-50",children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[j?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(St,{className:"w-8 h-8 animate-spin text-blue-600"})}):r.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(un,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Inicie a conversa fazendo uma pergunta"}),e.jsxs("div",{className:"mt-4 text-sm space-y-1",children:[e.jsx("p",{className:"text-gray-400",children:"Exemplos:"}),e.jsx("p",{className:"text-blue-600",children:'"Qual Ã© meu saldo atual?"'}),e.jsx("p",{className:"text-blue-600",children:'"Como estÃ¡ minha situaÃ§Ã£o financeira?"'}),e.jsx("p",{className:"text-blue-600",children:'"HÃ¡ algum alerta?"'})]})]})}):r.map(h=>e.jsx("div",{className:`flex ${h.tipo==="usuario"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex gap-3 max-w-3xl ${h.tipo==="usuario"?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${h.tipo==="usuario"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"}`,children:h.tipo==="usuario"?e.jsx(Ir,{className:"w-5 h-5"}):e.jsx(ao,{className:"w-5 h-5"})}),e.jsx("div",{className:`px-4 py-3 rounded-lg ${h.tipo==="usuario"?"bg-blue-600 text-white":"bg-white text-gray-900 border border-gray-200"}`,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:h.conteudo})})]})},h.id)),e.jsx("div",{ref:m})]}),e.jsx("div",{className:"border-t border-gray-200 bg-white p-4",children:e.jsxs("form",{onSubmit:b,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:l,onChange:h=>x(h.target.value),placeholder:"Digite sua pergunta...",disabled:v,className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"}),e.jsx("button",{type:"submit",disabled:v||!l.trim(),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:v?e.jsx(St,{className:"w-5 h-5 animate-spin"}):e.jsx(pl,{className:"w-5 h-5"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ao,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"Selecione ou crie uma conversa"}),e.jsx("p",{className:"text-sm mt-2",children:"FaÃ§a perguntas sobre seu fluxo de caixa e receba anÃ¡lises inteligentes"})]})})})]})]})}const Da="/whatsapp",xs={async getConfig(){return(await ia.get(`${Da}/config`)).data},async getStats(){return(await ia.get(`${Da}/analytics/dashboard`)).data},async getAgents(){return(await ia.get(`${Da}/agents`)).data},async createAgent(a){return(await ia.post(`${Da}/agents`,a)).data},async getAgent(a){return(await ia.get(`${Da}/agents/${a}`)).data},async updateAgent(a,t){return(await ia.put(`${Da}/agents/${a}`,t)).data},async deleteAgent(a){await ia.delete(`${Da}/agents/${a}`)},async getHandoffs(a){const t=a?{status:a}:{};return(await ia.get(`${Da}/handoffs/pending`,{params:t})).data},async createHandoff(a){return(await ia.post(`${Da}/handoffs`,a)).data},async getHandoff(a){return(await ia.get(`${Da}/handoffs/${a}`)).data},async assignHandoff(a,t){return(await ia.post(`${Da}/handoffs/${a}/assign`,{agent_id:t})).data},async resolveHandoff(a,t){await ia.post(`${Da}/handoffs/${a}/resolve`,{resolution_notes:t})},async cancelHandoff(a){await ia.post(`${Da}/handoffs/${a}/cancel`)},async getNotes(a){return(await ia.get(`${Da}/handoffs/${a}/notes`)).data},async addNote(a,t){return(await ia.post(`${Da}/handoffs/${a}/notes`,{content:t})).data},async getMessages(a){return(await ia.get(`${Da}/sessions/${a}/messages`)).data},async sendMessage(a,t){return(await ia.post(`${Da}/messages`,{session_id:a,message:t})).data},async createSession(a){return(await ia.post(`${Da}/sessions`,a)).data},async getSession(a){return(await ia.get(`${Da}/sessions/${a}`)).data},async testSentiment(a){return(await ia.post(`${Da}/sentiment/test`,{text:a})).data}},nr=Ti()((a,t)=>({stats:null,isLoadingStats:!1,agents:[],currentAgent:null,isLoadingAgents:!1,handoffs:[],activeHandoff:null,isLoadingHandoffs:!1,filterStatus:"all",messages:{},isLoadingMessages:{},isConnected:!1,isSidebarOpen:!0,isBotAssistOpen:!1,notifications:[],fetchStats:async()=>{if(t().isLoadingStats){console.log("â­ï¸ Stats already loading, skipping...");return}console.log("ðŸ“Š Fetching stats..."),a({isLoadingStats:!0});const o=new Promise((r,i)=>setTimeout(()=>i(new Error("Stats timeout")),1e4));try{const r=await Promise.race([xs.getStats(),o]);console.log("âœ… Stats received:",r),a({stats:r,isLoadingStats:!1})}catch(r){console.error("âŒ Error fetching stats:",r),a({isLoadingStats:!1})}},fetchAgents:async()=>{a({isLoadingAgents:!0});try{const s=await xs.getAgents();a({agents:s,isLoadingAgents:!1})}catch(s){console.error("Error fetching agents:",s),a({isLoadingAgents:!1})}},initializeCurrentAgent:async()=>{try{console.log("ðŸ”„ Initializing current agent...");const s=localStorage.getItem("user");if(!s){console.warn("âš ï¸ No user found in localStorage");return}const o=JSON.parse(s);console.log("ðŸ‘¤ User loaded:",o.email);const r=await xs.getAgents();console.log("ðŸ“‹ Agents fetched:",r.length);let i=r.find(l=>l.user_id===o.id);i?(console.log("ðŸ”„ Updating existing agent to online..."),i=await xs.updateAgent(i.id,{status:"online"}),console.log("âœ… Agent set to online:",i.id)):(console.log("âž• Creating new agent..."),i=await xs.createAgent({name:o.name||o.email,email:o.email,status:"online",max_concurrent_chats:5,auto_assign:!0,receive_notifications:!0}),console.log("âœ… Created new agent:",i.id)),a({currentAgent:i}),console.log("âœ… Current agent initialized")}catch(s){console.error("âŒ Error initializing current agent:",s)}},updateAgentStatus:async s=>{const{currentAgent:o}=t();if(o)try{const r=await xs.updateAgent(o.id,{status:s});a({currentAgent:r}),a(i=>({agents:i.agents.map(l=>l.id===r.id?r:l)}))}catch(r){console.error("Error updating agent status:",r)}},fetchHandoffs:async s=>{a({isLoadingHandoffs:!0});try{const o=await xs.getHandoffs(s);a({handoffs:o,isLoadingHandoffs:!1})}catch(o){console.error("Error fetching handoffs:",o),a({isLoadingHandoffs:!1})}},setFilterStatus:s=>{a({filterStatus:s});const o={all:void 0,pending:"pending",active:"active",my:"active"};t().fetchHandoffs(o[s])},takeHandoff:async s=>{const{currentAgent:o}=t();if(o)try{const r=await xs.assignHandoff(s,o.id);a(i=>({handoffs:i.handoffs.map(l=>l.id===r.id?r:l)})),a({activeHandoff:r}),t().addNotification({type:"success",title:"Conversa assumida",message:`VocÃª assumiu a conversa com ${r.customer_name||r.phone_number}`,timestamp:new Date().toISOString()})}catch(r){console.error("Error taking handoff:",r),t().addNotification({type:"error",title:"Erro",message:"NÃ£o foi possÃ­vel assumir a conversa",timestamp:new Date().toISOString()})}},resolveHandoff:async(s,o)=>{try{await xs.resolveHandoff(s,o),a(r=>{var i;return{handoffs:r.handoffs.filter(l=>l.id!==s),activeHandoff:((i=r.activeHandoff)==null?void 0:i.id)===s?null:r.activeHandoff}}),t().addNotification({type:"success",title:"Conversa resolvida",message:"A conversa foi finalizada com sucesso",timestamp:new Date().toISOString()}),t().fetchStats()}catch(r){console.error("Error resolving handoff:",r),t().addNotification({type:"error",title:"Erro",message:"NÃ£o foi possÃ­vel resolver a conversa",timestamp:new Date().toISOString()})}},setActiveHandoff:s=>{a({activeHandoff:s})},fetchMessages:async s=>{a(o=>({isLoadingMessages:{...o.isLoadingMessages,[s]:!0}}));try{const o=await xs.getMessages(s);a(r=>({messages:{...r.messages,[s]:o},isLoadingMessages:{...r.isLoadingMessages,[s]:!1}}))}catch(o){console.error("Error fetching messages:",o),a(r=>({isLoadingMessages:{...r.isLoadingMessages,[s]:!1}}))}},sendMessage:async(s,o)=>{try{const r=await xs.sendMessage(s,o);a(i=>({messages:{...i.messages,[s]:[...i.messages[s]||[],r]}}))}catch(r){console.error("Error sending message:",r),t().addNotification({type:"error",title:"Erro ao enviar",message:"NÃ£o foi possÃ­vel enviar a mensagem",timestamp:new Date().toISOString()})}},addMessage:(s,o)=>{a(r=>({messages:{...r.messages,[s]:[...r.messages[s]||[],o]}}))},setConnected:s=>a({isConnected:s}),toggleSidebar:()=>a(s=>({isSidebarOpen:!s.isSidebarOpen})),toggleBotAssist:()=>a(s=>({isBotAssistOpen:!s.isBotAssistOpen})),addNotification:s=>{const o=Math.random().toString(36).substring(7);a(r=>({notifications:[...r.notifications,{...s,id:o}]})),setTimeout(()=>{t().removeNotification(o)},5e3)},removeNotification:s=>{a(o=>({notifications:o.notifications.filter(r=>r.id!==s)}))}}));class K0{constructor(){this.ws=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.reconnectTimeout=null,this.pingInterval=null,this.agentId=null,this.token=null,this.handlers={},this.onConnectionChange=null,this.onMaxReconnectAttemptsReached=null}resolveWsBaseUrl(){const t="/api";return t.startsWith("/")?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}${t}`:t.replace("http://","ws://").replace("https://","wss://")}connect(t,s){var i;if(((i=this.ws)==null?void 0:i.readyState)===WebSocket.OPEN){console.log("WebSocket already connected");return}this.token=t,this.agentId=s;const r=`${this.resolveWsBaseUrl().replace(/\/+$/,"")}/ws/whatsapp/${s}?token=${t}`;console.log("ðŸ”Œ Connecting to WebSocket:",r);try{this.ws=new WebSocket(r),this.setupEventListeners()}catch(l){console.error("Error creating WebSocket:",l),this.handleReconnect()}}disconnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null),this.ws&&(this.ws.readyState===WebSocket.OPEN&&this.send({event:"leave_agent_room"}),this.ws.close(),this.ws=null),this.reconnectAttempts=0,this.token=null,this.agentId=null}setupEventListeners(){this.ws&&(this.ws.onopen=()=>{console.log("âœ… WebSocket connected"),this.reconnectAttempts=0,this.onConnectionChange&&this.onConnectionChange(!0),this.send({event:"join_agent_room"}),this.pingInterval=window.setInterval(()=>{var t;((t=this.ws)==null?void 0:t.readyState)===WebSocket.OPEN&&this.send({event:"ping"})},3e4)},this.ws.onclose=t=>{console.log("âŒ WebSocket disconnected:",t.code,t.reason),this.onConnectionChange&&this.onConnectionChange(!1),t.code!==1e3&&this.handleReconnect()},this.ws.onerror=t=>{console.error("WebSocket error:",t)},this.ws.onmessage=t=>{try{const s=JSON.parse(t.data);this.handleMessage(s)}catch(s){console.error("Error parsing WebSocket message:",s)}})}handleMessage(t){const{event:s,data:o}=t;switch(console.log("ðŸ“© WebSocket message:",s,o),s){case"connected":console.log("Connection confirmed:",o);break;case"new_handoff":this.handlers.onNewHandoff&&this.handlers.onNewHandoff(o);break;case"handoff_assigned":this.handlers.onHandoffAssigned&&this.handlers.onHandoffAssigned(o);break;case"handoff_resolved":this.handlers.onHandoffResolved&&this.handlers.onHandoffResolved(o.handoff_id);break;case"new_message":this.handlers.onNewMessage&&this.handlers.onNewMessage(o.session_id,o.message);break;case"agent_status_change":this.handlers.onAgentStatusChange&&this.handlers.onAgentStatusChange(o);break;case"typing_indicator":this.handlers.onTypingIndicator&&this.handlers.onTypingIndicator(o.session_id,o.is_typing);break;default:console.warn("Unknown WebSocket event:",s)}}handleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached"),this.onMaxReconnectAttemptsReached&&this.onMaxReconnectAttemptsReached();return}this.reconnectAttempts++;const t=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`Reconnecting in ${t}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})...`),this.reconnectTimeout=setTimeout(()=>{this.token&&this.agentId&&this.connect(this.token,this.agentId)},t)}send(t){var s;((s=this.ws)==null?void 0:s.readyState)===WebSocket.OPEN?this.ws.send(JSON.stringify(t)):console.warn("WebSocket is not open. Cannot send message:",t)}registerHandlers(t){this.handlers=t}joinAgentRoom(t){this.send({event:"join_agent_room",data:{agent_id:t}})}leaveAgentRoom(t){this.send({event:"leave_agent_room",data:{agent_id:t}})}sendTypingIndicator(t,s){this.send({event:"typing",data:{session_id:t,is_typing:s}})}isConnected(){var t;return((t=this.ws)==null?void 0:t.readyState)===WebSocket.OPEN}getSocketId(){return this.agentId}}const ws=new K0,G0=(a,t)=>{const[s,o]=n.useState(!1),{addNotification:r,fetchHandoffs:i,setConnected:l,addMessage:x,fetchStats:j}=nr();return n.useEffect(()=>{if(!(!a||!t||s))return o(!0),console.log("ðŸ”Œ useSocket: Initializing WebSocket connection..."),ws.onConnectionChange=g=>{l(g),r(g?{type:"success",title:"Conectado",message:"ConexÃ£o com servidor estabelecida",timestamp:new Date().toISOString()}:{type:"warning",title:"Desconectado",message:"Tentando reconectar ao servidor...",timestamp:new Date().toISOString()})},ws.onMaxReconnectAttemptsReached=()=>{r({type:"error",title:"Erro de ConexÃ£o",message:"NÃ£o foi possÃ­vel conectar ao servidor. Recarregue a pÃ¡gina.",timestamp:new Date().toISOString()})},ws.registerHandlers({onNewHandoff:g=>{console.log("ðŸ†• New handoff received:",g),i(),r({type:"info",title:"Nova Conversa",message:`${g.customer_name||g.phone_number} precisa de ajuda`,timestamp:new Date().toISOString()}),ni("Nova Conversa - WhatsApp",`${g.customer_name||g.phone_number} - ${g.reason}`,g.priority),(g.priority==="urgent"||g.priority==="high")&&Qn()},onHandoffAssigned:g=>{console.log("ðŸ‘¤ Handoff assigned:",g),i(),g.assigned_agent_id===t&&r({type:"success",title:"Conversa AtribuÃ­da",message:`VocÃª foi atribuÃ­do Ã  conversa com ${g.customer_name||g.phone_number}`,timestamp:new Date().toISOString()})},onHandoffResolved:g=>{console.log("âœ… Handoff resolved:",g),i(),j()},onNewMessage:(g,v)=>{console.log("ðŸ’¬ New message:",g,v),x(g,v),v.sender_type==="customer"&&(r({type:"info",title:"Nova Mensagem",message:v.content.substring(0,50)+"...",timestamp:new Date().toISOString()}),Qn("message"))},onAgentStatusChange:g=>{console.log("ðŸ“Š Agent status changed:",g),j()},onTypingIndicator:(g,v)=>{console.log("âŒ¨ï¸ Typing indicator:",g,v)}}),ws.connect(a,t),()=>{ws.disconnect()}},[a,t]),{isConnected:ws.isConnected(),socketId:ws.getSocketId(),sendTypingIndicator:ws.sendTypingIndicator.bind(ws)}};function ni(a,t,s){if(!("Notification"in window)){console.warn("Browser does not support notifications");return}if(Notification.permission==="granted"){const o=new Notification(a,{body:t,icon:"/logo192.png",badge:"/logo192.png",tag:"whatsapp-notification",requireInteraction:s==="urgent",silent:!1});o.onclick=()=>{window.focus(),o.close()},setTimeout(()=>o.close(),1e4)}else Notification.permission!=="denied"&&Notification.requestPermission().then(o=>{o==="granted"&&ni(a,t,s)})}function Qn(a="handoff"){try{const t=new Audio(a==="handoff"?"/sounds/notification-handoff.mp3":"/sounds/notification-message.mp3");t.volume=.5,t.play().catch(s=>{console.warn("Could not play notification sound:",s)})}catch(t){console.warn("Error playing sound:",t)}}class X0 extends n.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error("ErrorBoundary caught an error:",t,s)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900 text-center mb-2",children:"Algo deu errado"}),e.jsx("p",{className:"text-sm text-gray-600 text-center mb-6",children:"Ocorreu um erro inesperado. Por favor, recarregue a pÃ¡gina."}),this.state.error&&e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded border border-gray-200",children:e.jsx("p",{className:"text-xs font-mono text-gray-700 break-words",children:this.state.error.message})}),e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Recarregar PÃ¡gina"})]})}):this.props.children}}const Q0=n.memo(({stats:a,isLoading:t})=>{if(t)return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[...Array(6)].map((o,r)=>e.jsxs("div",{className:"bg-gray-100 rounded-lg p-4 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-3/4"})]},r))});if(!a)return null;const s=[{label:"Total",value:a.total_handoffs,icon:"ðŸ’¬",color:"bg-blue-50 text-blue-700"},{label:"Aguardando",value:a.pending_count,icon:"â³",color:"bg-yellow-50 text-yellow-700"},{label:"Ativas",value:a.active_count,icon:"ðŸ’­",color:"bg-green-50 text-green-700"},{label:"Resolvidas",value:a.resolved_count,icon:"âœ…",color:"bg-gray-50 text-gray-700"},{label:"Agentes Online",value:a.available_agents||0,icon:"ðŸ‘¤",color:"bg-purple-50 text-purple-700"},{label:"Tempo MÃ©dio",value:a.avg_response_time_seconds?Math.round(a.avg_response_time_seconds/60)+"min":"0min",icon:"âš¡",color:"bg-orange-50 text-orange-700"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:s.map((o,r)=>e.jsxs("div",{className:`rounded-lg p-4 ${o.color}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-lg",children:o.icon}),e.jsx("p",{className:"text-xs font-medium opacity-75",children:o.label})]}),e.jsx("p",{className:"text-2xl font-bold",children:o.value})]},r))})}),J0=n.memo(({agents:a,isLoading:t})=>{const{currentAgent:s,updateAgentStatus:o}=nr(),r={online:"bg-green-500",busy:"bg-yellow-500",away:"bg-orange-500",offline:"bg-gray-400"},i={online:"Online",busy:"Ocupado",away:"Ausente",offline:"Offline"};return t?e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((l,x)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg animate-pulse",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3 mb-1"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-1/2"})]})]},x))}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:["Agentes (",a.length,")"]}),a.map(l=>e.jsxs("div",{className:`
            flex items-center gap-3 p-2 rounded-lg transition-colors
            ${(s==null?void 0:s.id)===l.id?"bg-blue-50":"hover:bg-gray-50"}
          `,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${r[l.status]}`}),l.status==="online"&&e.jsx("div",{className:`absolute inset-0 w-2 h-2 rounded-full ${r[l.status]} animate-ping opacity-75`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:l.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:i[l.status]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[l.current_chats,"/",l.max_concurrent_chats]})]})]}),(s==null?void 0:s.id)===l.id&&e.jsxs("select",{value:l.status,onChange:x=>o(x.target.value),className:"text-xs border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"busy",children:"Ocupado"}),e.jsx("option",{value:"away",children:"Ausente"}),e.jsx("option",{value:"offline",children:"Offline"})]})]},l.id)),a.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"Nenhum agente disponÃ­vel"})]})}),Y0=n.memo(({handoffs:a,activeHandoff:t,isLoading:s})=>{const{setActiveHandoff:o,takeHandoff:r}=nr(),i={urgent:"bg-red-100 text-red-700 border-red-200",high:"bg-orange-100 text-orange-700 border-orange-200",medium:"bg-yellow-100 text-yellow-700 border-yellow-200",low:"bg-gray-100 text-gray-700 border-gray-200"},l={urgent:"ðŸš¨ Urgente",high:"âš ï¸ Alta",medium:"ðŸ“Œ MÃ©dia",low:"ðŸ“‹ Baixa"},x={pending:"â³",active:"ðŸ’¬",resolved:"âœ…",cancelled:"âŒ"};return s?e.jsx("div",{className:"p-4 space-y-3",children:[...Array(5)].map((j,g)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 animate-pulse",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})]})},g))}):a.length===0?e.jsx("div",{className:"flex items-center justify-center h-full p-8",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-sm font-medium",children:"Nenhuma conversa"})]})}):e.jsx("div",{className:"p-4 space-y-3",children:a.map(j=>{const g=(t==null?void 0:t.id)===j.id,v=j.status==="pending";return e.jsx("div",{onClick:()=>o(j),className:`
              border rounded-lg p-3 cursor-pointer transition-all
              ${g?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:shadow-sm"}
            `,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`
                w-10 h-10 rounded-full flex items-center justify-center text-lg font-semibold
                ${i[j.priority]}
              `,children:j.customer_name?j.customer_name.charAt(0).toUpperCase():"ðŸ‘¤"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:j.customer_name||"Cliente"}),e.jsx("span",{className:"text-xs text-gray-500 whitespace-nowrap",children:Xu(new Date(j.created_at),{addSuffix:!0,locale:Io})})]}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:j.phone_number}),e.jsx("p",{className:"text-sm text-gray-700 mb-2 line-clamp-2",children:j.reason_details||j.reason}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`
                    text-xs px-2 py-1 rounded border
                    ${i[j.priority]}
                  `,children:l[j.priority]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:x[j.status]}),v&&e.jsx("button",{onClick:d=>{d.stopPropagation(),r(j.id)},className:"text-xs px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Assumir"})]})]})]})]})},j.id)})})}),Z0=({handoff:a})=>{const{messages:t,isLoadingMessages:s,fetchMessages:o,sendMessage:r,resolveHandoff:i,toggleBotAssist:l}=nr(),[x,j]=n.useState(""),[g,v]=n.useState(!1),[d,m]=n.useState(""),C=n.useRef(null),y=t[a.session_id]||[],c=s[a.session_id]||!1;n.useEffect(()=>{a.session_id&&o(a.session_id)},[a.session_id]),n.useEffect(()=>{var p;(p=C.current)==null||p.scrollIntoView({behavior:"smooth"})},[y]);const f=async()=>{x.trim()&&(await r(a.session_id,x),j(""))},b=async()=>{if(!d.trim()){alert("Por favor, adicione notas de resoluÃ§Ã£o");return}await i(a.id,d),v(!1),m("")},u=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),f())},h={urgent:"border-red-500 bg-red-50",high:"border-orange-500 bg-orange-50",medium:"border-yellow-500 bg-yellow-50",low:"border-gray-500 bg-gray-50"};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:`border-b-4 ${h[a.priority]} p-4`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white text-lg font-semibold",children:a.customer_name?a.customer_name.charAt(0).toUpperCase():"ðŸ‘¤"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:a.customer_name||"Cliente"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.phone_number})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:l,className:"p-2 rounded-lg hover:bg-white hover:shadow transition-all",title:"Bot Assist",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),a.status==="active"&&e.jsx("button",{onClick:()=>v(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:"Resolver"})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Motivo:"})," ",a.reason]}),a.reason_details&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.reason_details})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:c?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"Carregando mensagens..."})]})}):y.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("p",{className:"text-sm font-medium",children:"Nenhuma mensagem ainda"})]})}):e.jsxs(e.Fragment,{children:[y.map(p=>{const k=p.sender_type==="agent";return p.sender_type==="system"?e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"bg-gray-100 text-gray-600 text-xs px-3 py-1 rounded-full",children:p.content})},p.id):e.jsx("div",{className:`flex ${k?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[70%] ${k?"order-2":"order-1"}`,children:[e.jsx("div",{className:`
                      rounded-lg px-4 py-2
                      ${k?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}
                    `,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:p.content})}),e.jsx("p",{className:`text-xs text-gray-500 mt-1 ${k?"text-right":"text-left"}`,children:ti(new Date(p.timestamp),"HH:mm",{locale:Io})})]})},p.id)}),e.jsx("div",{ref:C})]})}),a.status==="active"&&!g&&e.jsx("div",{className:"border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("textarea",{value:x,onChange:p=>j(p.target.value),onKeyPress:u,placeholder:"Digite sua mensagem...",rows:3,className:"flex-1 border border-gray-300 rounded-lg px-4 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:f,disabled:!x.trim(),className:"px-6 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-medium",children:"Enviar"})]})}),g&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Resolver Conversa"}),e.jsx("textarea",{value:d,onChange:p=>m(p.target.value),placeholder:"Descreva como foi resolvido o atendimento...",rows:4,className:"w-full border border-gray-300 rounded-lg px-4 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{v(!1),m("")},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:b,disabled:!d.trim(),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:"Confirmar ResoluÃ§Ã£o"})]})]})})]})},ep=({handoff:a})=>{const[t,s]=n.useState(""),[o,r]=n.useState(null),[i,l]=n.useState(!1),x=async()=>{if(t.trim()){l(!0);try{const g=await xs.testSentiment(t);r(g)}catch(g){console.error("Error analyzing sentiment:",g)}finally{l(!1)}}},j=["Entendo sua frustraÃ§Ã£o. Vou verificar isso imediatamente.","Obrigado por aguardar. Estou analisando sua solicitaÃ§Ã£o.","Vou encaminhar para o setor responsÃ¡vel e retorno em breve.","Consegui resolver! Precisa de mais alguma coisa?"];return a?e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Bot Assist ðŸ¤–"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"AnÃ¡lise de sentimento e sugestÃµes"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Analisar Sentimento"}),e.jsx("textarea",{value:t,onChange:g=>s(g.target.value),placeholder:"Cole uma mensagem do cliente...",rows:4,className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:x,disabled:!t.trim()||i,className:"mt-2 w-full px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:i?"Analisando...":"Analisar"}),o&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Score:"}),e.jsx("span",{className:`text-sm font-bold ${o.score>0?"text-green-600":o.score<0?"text-red-600":"text-gray-600"}`,children:o.score.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Label:"}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:o.label})]}),o.emotions.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"EmoÃ§Ãµes:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:o.emotions.map((g,v)=>e.jsx("span",{className:"text-xs px-2 py-0.5 bg-purple-100 text-purple-700 rounded",children:g},v))})]}),o.triggers.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Gatilhos:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:o.triggers.map((g,v)=>e.jsx("span",{className:"text-xs px-2 py-0.5 bg-red-100 text-red-700 rounded",children:g},v))})]}),o.should_handoff&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsx("span",{className:"text-xs font-medium text-red-600",children:"âš ï¸ Recomenda handoff humano"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Respostas Sugeridas"}),e.jsx("div",{className:"space-y-2",children:j.map((g,v)=>e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(g)},className:"w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg border border-gray-200 text-sm text-gray-700 transition-colors",children:g},v))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"AÃ§Ãµes RÃ¡pidas"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{className:"w-full px-4 py-2 bg-orange-50 text-orange-700 border border-orange-200 rounded-lg text-sm font-medium hover:bg-orange-100 transition-colors",children:"ðŸ“‹ Ver histÃ³rico completo"}),e.jsx("button",{className:"w-full px-4 py-2 bg-purple-50 text-purple-700 border border-purple-200 rounded-lg text-sm font-medium hover:bg-purple-100 transition-colors",children:"ðŸ“Š AnÃ¡lise de perfil"}),e.jsx("button",{className:"w-full px-4 py-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors",children:"ðŸ”— Criar ticket"})]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full p-8",children:e.jsx("p",{className:"text-sm text-gray-400 text-center",children:"Selecione uma conversa para ver sugestÃµes"})})},ap=({notification:a,onClose:t})=>{const[s,o]=n.useState(!1);n.useEffect(()=>{const l=setTimeout(()=>{o(!0),setTimeout(t,300)},5e3);return()=>clearTimeout(l)},[t]);const r={info:"bg-blue-50 border-blue-200 text-blue-800",success:"bg-green-50 border-green-200 text-green-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800",error:"bg-red-50 border-red-200 text-red-800"},i={info:"â„¹ï¸",success:"âœ…",warning:"âš ï¸",error:"âŒ"};return e.jsx("div",{className:`
        max-w-sm w-full bg-white border-2 rounded-lg shadow-lg p-4
        transform transition-all duration-300 ease-out
        ${s?"translate-x-full opacity-0":"translate-x-0 opacity-100"}
        ${r[a.type]}
      `,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-xl",children:i[a.type]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm mb-1",children:a.title}),e.jsx("p",{className:"text-sm opacity-90",children:a.message})]}),e.jsx("button",{onClick:()=>{o(!0),setTimeout(t,300)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})},sp=n.memo(({isConnected:a,socketId:t})=>e.jsxs("div",{className:`
      flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-medium
      ${a?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}
    `,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`
          w-2 h-2 rounded-full
          ${a?"bg-green-500":"bg-red-500"}
        `}),a&&e.jsx("div",{className:"absolute inset-0 w-2 h-2 bg-green-500 rounded-full animate-ping opacity-75"})]}),e.jsx("span",{children:a?"Online":"Desconectado"}),a&&t&&e.jsxs("span",{className:"text-[10px] opacity-50 font-mono",title:`Socket ID: ${t}`,children:["â€¢ ",t.substring(0,6)]})]})),tp=()=>{const[a,t]=n.useState("default"),[s,o]=n.useState(!1);n.useEffect(()=>{"Notification"in window&&(t(Notification.permission),Notification.permission==="default"&&o(!0))},[]);const r=async()=>{if("Notification"in window){const i=await Notification.requestPermission();t(i),i==="granted"&&(o(!1),new Notification("NotificaÃ§Ãµes Ativadas",{body:"VocÃª receberÃ¡ alertas de novas conversas",icon:"/logo192.png"}))}};return!s||a==="granted"?null:e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-1",children:"Ativar NotificaÃ§Ãµes"}),e.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"Receba alertas instantÃ¢neos quando novas conversas precisarem de atendimento"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors",children:"Ativar NotificaÃ§Ãµes"}),e.jsx("button",{onClick:()=>o(!1),className:"px-4 py-2 bg-white text-blue-700 text-sm font-medium rounded-lg border border-blue-200 hover:bg-blue-50 transition-colors",children:"Agora NÃ£o"})]})]}),e.jsx("button",{onClick:()=>o(!1),className:"flex-shrink-0 text-blue-400 hover:text-blue-600 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})},rp=()=>{const[a,t]=ms.useState(!0);console.log("ðŸŽ¯ WhatsAppDashboard component rendering...");const{stats:s,agents:o,handoffs:r,activeHandoff:i,filterStatus:l,isLoadingStats:x,isLoadingAgents:j,isLoadingHandoffs:g,isSidebarOpen:v,isBotAssistOpen:d,isConnected:m,notifications:C,currentAgent:y,fetchStats:c,fetchAgents:f,fetchHandoffs:b,initializeCurrentAgent:u,setFilterStatus:h,toggleSidebar:p,removeNotification:k}=nr(),N=localStorage.getItem("access_token"),{socketId:w}=G0(N,(y==null?void 0:y.id)||null);return n.useEffect(()=>{let S=!0,P=!1,W=null,te=!1;const D=async()=>{if(!(!S||P)){P=!0;try{console.log("ðŸš€ Initializing WhatsApp Dashboard...");const re=new Promise((M,Z)=>setTimeout(()=>Z(new Error("Initialization timeout")),15e3));try{await Promise.race([Promise.all([u(),c(),f(),b()]),re])}catch(M){console.warn("âš ï¸ Initialization timeout, continuing anyway:",M)}console.log("âœ… Dashboard initialized")}catch(re){console.error("âŒ Error initializing dashboard:",re)}finally{S&&t(!1)}}},A=async()=>{if(!(te||!S)){if(document.hidden){console.log("â¸ï¸ Page hidden, skipping refresh");return}te=!0,console.log("ðŸ”„ Refreshing dashboard data...");try{await Promise.all([c(),b(l==="all"?void 0:l)])}catch(re){console.error("Error refreshing data:",re)}finally{te=!1}}};D(),W=setInterval(A,6e4);const X=()=>{!document.hidden&&S&&(console.log("ðŸ‘ï¸ Page visible again, refreshing data"),A())};return document.addEventListener("visibilitychange",X),()=>{S=!1,W&&clearInterval(W),document.removeEventListener("visibilitychange",X)}},[]),a?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando WhatsApp Dashboard..."})]})}):e.jsx(X0,{children:e.jsxs("div",{className:"flex h-screen bg-gray-50",role:"main","aria-label":"WhatsApp Dashboard",children:[e.jsx("div",{className:`
        transition-all duration-300 ease-in-out
        ${v?"w-80":"w-0"}
        border-r border-gray-200 bg-white overflow-hidden
      `,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Atendimento WhatsApp"}),e.jsx("div",{className:"mt-2",children:e.jsx(sp,{isConnected:m,socketId:w})})]}),e.jsx("button",{onClick:p,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Recolher painel",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"})})})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","active","my"].map(S=>e.jsxs("button",{onClick:()=>h(S),className:`
                    px-3 py-1.5 rounded-lg text-sm font-medium transition-colors
                    ${l===S?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}
                  `,children:[S==="all"&&"Todas",S==="pending"&&"Aguardando",S==="active"&&"Ativas",S==="my"&&"Minhas"]},S))})]}),e.jsx("div",{className:"px-4 py-3 border-b border-gray-200",children:e.jsx(J0,{agents:o,isLoading:j})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(Y0,{handoffs:r,activeHandoff:i,isLoading:g})})]})}),!v&&e.jsx("button",{onClick:p,className:"absolute top-4 left-4 z-10 p-2 bg-white rounded-lg shadow-lg hover:bg-gray-50 transition-colors",title:"Expandir painel",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 bg-white border-b border-gray-200",children:e.jsx(tp,{})}),e.jsx("div",{className:"p-4 bg-white border-b border-gray-200",children:e.jsx(Q0,{stats:s,isLoading:x})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"flex-1",children:i?e.jsx(Z0,{handoff:i}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("p",{className:"text-lg font-medium",children:"Selecione uma conversa"}),e.jsx("p",{className:"text-sm mt-1",children:"Escolha uma conversa da fila para comeÃ§ar"})]})})}),d&&e.jsx("div",{className:"w-80 border-l border-gray-200 bg-white",children:e.jsx(ep,{handoff:i})})]})]}),e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:C.map(S=>e.jsx(ap,{notification:S,onClose:()=>k(S.id)},S.id))})]})})},op=()=>{const[a,t]=n.useState([]),[s,o]=n.useState(!0),[r,i]=n.useState(!1),[l,x]=n.useState(null),[j,g]=n.useState([]),[v,d]=n.useState([]),[m,C]=n.useState(!1),[y,c]=n.useState(null);n.useEffect(()=>{f()},[]);const f=async()=>{try{o(!0);const p=await F.get("/comissoes/configuracoes/funcionarios");p.data.success&&t(p.data.data)}catch(p){console.error("Erro ao carregar funcionÃ¡rios:",p),c("Erro ao carregar funcionÃ¡rios com comissÃµes")}finally{o(!1)}},b=async(p=null)=>{x(p),i(!0),C(!0);try{const k=await F.get("/comissoes/arvore-produtos");if(k.data.success&&d(k.data.data),p){const N=await F.get(`/comissoes/configuracoes/funcionario/${p}`);N.data.success&&g(N.data.data)}}catch(k){console.error("Erro ao carregar dados:",k),c("Erro ao carregar dados de configuraÃ§Ã£o")}finally{C(!1)}},u=()=>{i(!1),x(null),g([]),d([]),f()},h=async p=>{const k=prompt("Digite o ID do funcionÃ¡rio de destino:");if(k)try{const N=await F.post("/comissoes/configuracoes/duplicar",{funcionario_origem_id:parseInt(p),funcionario_destino_id:parseInt(k)});N.data.success&&(alert(N.data.message),f())}catch(N){console.error("Erro ao duplicar configuraÃ§Ã£o:",N),alert("Erro ao duplicar configuraÃ§Ã£o")}};return s?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Cadastro de ComissÃµes"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie as comissÃµes dos funcionÃ¡rios"})]}),e.jsxs("button",{onClick:()=>b(),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2",children:[e.jsx("span",{children:"+"}),"Nova ComissÃ£o"]})]})}),y&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:y}),e.jsx("div",{className:"bg-white rounded-lg shadow",children:a.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"Nenhuma comissÃ£o configurada"}),e.jsx("p",{className:"text-sm",children:'Clique em "Nova ComissÃ£o" para comeÃ§ar'})]}):e.jsx("div",{className:"divide-y",children:a.map(p=>e.jsx("div",{className:"p-4 hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>b(p.id),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:p.nome.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:p.nome}),e.jsx("p",{className:"text-sm text-gray-500",children:p.cargo})]})]}),e.jsxs("div",{className:"mt-2 flex gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:[e.jsx("strong",{children:p.categorias})," categorias"]}),e.jsxs("span",{children:[e.jsx("strong",{children:p.subcategorias})," subcategorias"]}),e.jsxs("span",{children:[e.jsx("strong",{children:p.produtos})," produtos especÃ­ficos"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:k=>{k.stopPropagation(),b(p.id)},className:"px-3 py-1 text-blue-600 hover:bg-blue-50 rounded",children:"Editar"}),e.jsx("button",{onClick:k=>{k.stopPropagation(),h(p.id)},className:"px-3 py-1 text-gray-600 hover:bg-gray-100 rounded",title:"Duplicar configuraÃ§Ã£o para outro funcionÃ¡rio",children:"Duplicar"})]})]})},p.id))})}),r&&e.jsx(np,{funcionarioId:l,configuracoes:j,arvoreProdutos:v,loading:m,onClose:u,onSave:()=>{f(),u()}})]})},np=({funcionarioId:a,configuracoes:t,arvoreProdutos:s,loading:o,onClose:r,onSave:i})=>{const[l,x]=n.useState([]),[j,g]=n.useState(a||""),[v,d]=n.useState(""),[m,C]=n.useState({desconta_taxa_cartao:!0,desconta_impostos:!0,desconta_taxa_entrega:!1,comissao_venda_parcial:!0}),[y,c]=n.useState({}),[f,b]=n.useState({}),[u,h]=n.useState(null),[p,k]=n.useState([]),[N,w]=n.useState(!1),[S,P]=n.useState({atual:0,total:0}),[W,te]=n.useState(null);n.useEffect(()=>{D()},[]),n.useEffect(()=>{const B={};if(t.forEach(_=>{const O=`${_.tipo}-${_.referencia_id}`;B[O]=_}),b(B),t.length>0){const _=t[0],O={desconta_taxa_cartao:_.desconta_taxa_cartao??!0,desconta_impostos:_.desconta_impostos??!0,desconta_taxa_entrega:_.desconta_custo_entrega??!1,comissao_venda_parcial:_.comissao_venda_parcial??!0};C(O),te(O)}},[t]);const D=async()=>{try{const B=await F.get("/comissoes/funcionarios");if(B.data.success&&(x(B.data.data),a)){const _=B.data.data.find(O=>O.id===parseInt(a));_&&_.data_fechamento_comissao&&d(String(_.data_fechamento_comissao))}}catch(B){console.error("Erro ao carregar funcionÃ¡rios:",B)}},A=B=>{c(_=>({..._,[B]:!_[B]}))},X=(B,_,O)=>{const q=`${B}-${_}`,ae=f[q];h({tipo:B,id:_,nome:O,tipo_calculo:(ae==null?void 0:ae.tipo_calculo)||"percentual",percentual:(ae==null?void 0:ae.percentual)||10,percentual_loja:(ae==null?void 0:ae.percentual_loja)||50,permite_edicao_venda:(ae==null?void 0:ae.permite_edicao_venda)||!1,observacoes:(ae==null?void 0:ae.observacoes)||""})},re=()=>{if(!j){alert("Selecione um funcionÃ¡rio");return}if(!u){alert("Selecione um item para configurar");return}if(p.some(O=>O.tipo===u.tipo&&O.referencia_id===u.id)){alert("Este item jÃ¡ foi adicionado Ã  lista!");return}if(u.tipo==="categoria"&&p.some(q=>(q.tipo==="subcategoria"||q.tipo==="produto")&&q.nome.includes(u.nome))&&!confirm(`âš ï¸ ATENÃ‡ÃƒO: VocÃª jÃ¡ configurou produtos/subcategorias desta categoria.

HIERARQUIA: Produto > Subcategoria > Categoria

A configuraÃ§Ã£o mais especÃ­fica tem prioridade.

Deseja adicionar mesmo assim?`))return;const _={tipo:u.tipo,referencia_id:u.id,nome:u.nome,tipo_calculo:u.tipo_calculo,percentual:parseFloat(u.percentual)||0,percentual_loja:u.tipo_calculo==="lucro"?parseFloat(u.percentual_loja)||0:null,permite_edicao_venda:u.permite_edicao_venda||!1,observacoes:u.observacoes||""};k([...p,_]),h(null),alert('ConfiguraÃ§Ã£o adicionada! Configure mais itens ou clique em "Salvar Todas"')},M=B=>{k(p.filter((_,O)=>O!==B))},Z=async()=>{var B,_,O;if(!j){alert("Selecione um funcionÃ¡rio");return}if(p.length===0){alert("Adicione pelo menos uma configuraÃ§Ã£o");return}w(!0);try{v&&await F.put(`/funcionarios/${j}`,{data_fechamento_comissao:parseInt(v)});const q=p.map(H=>({funcionario_id:parseInt(j),tipo:H.tipo,referencia_id:H.referencia_id,tipo_calculo:H.tipo_calculo,percentual:parseFloat(H.percentual)||0,percentual_loja:H.percentual_loja?parseFloat(H.percentual_loja):null,permite_edicao_venda:H.permite_edicao_venda||!1,observacoes:H.observacoes||"",desconta_taxa_cartao:m.desconta_taxa_cartao,desconta_impostos:m.desconta_impostos,desconta_taxa_entrega:m.desconta_taxa_entrega,comissao_venda_parcial:m.comissao_venda_parcial}));console.log("Enviando configuraÃ§Ãµes em batch:",q);const ae=await F.post("/comissoes/configuracoes/batch",{configuracoes:q});if(console.log("Resposta do servidor:",ae.data),ae.data.success){if(alert(`âœ… ${ae.data.total} configuraÃ§Ãµes salvas com sucesso!`),k([]),j)try{const H=await F.get(`/comissoes/configuracoes/funcionario/${j}`);if(H.data.success){const le={};H.data.data.forEach(G=>{const ee=`${G.tipo}-${G.referencia_id}`;le[ee]=G}),b(le)}}catch(H){console.error("Erro ao recarregar configuraÃ§Ãµes:",H)}i()}}catch(q){console.error("Erro ao salvar configuraÃ§Ãµes:",q),console.error("Resposta do servidor:",(B=q.response)==null?void 0:B.data);const ae=((O=(_=q.response)==null?void 0:_.data)==null?void 0:O.detail)||q.message||"Erro desconhecido";alert(`âŒ Erro ao salvar configuraÃ§Ãµes:

${ae}`)}finally{w(!1),P({atual:0,total:0})}},$=async()=>{if(!j){alert("Selecione um funcionÃ¡rio");return}if(!u){if(Object.keys(f).length===0){alert("Nenhuma configuraÃ§Ã£o encontrada para atualizar as regras.");return}if(!(W&&(m.desconta_taxa_cartao!==W.desconta_taxa_cartao||m.desconta_impostos!==W.desconta_impostos||m.desconta_taxa_entrega!==W.desconta_taxa_entrega||m.comissao_venda_parcial!==W.comissao_venda_parcial))){alert("Nenhuma alteraÃ§Ã£o detectada nas regras.");return}if(!confirm("Deseja atualizar as regras de cÃ¡lculo em TODAS as configuraÃ§Ãµes deste funcionÃ¡rio?"))return;try{console.log("ðŸ’¾ SALVANDO REGRAS - Estado atual:",m);for(const[_,O]of Object.entries(f)){const q={funcionario_id:parseInt(j),tipo:O.tipo,referencia_id:O.referencia_id,tipo_calculo:O.tipo_calculo,percentual:parseFloat(O.percentual),percentual_loja:O.percentual_loja?parseFloat(O.percentual_loja):null,desconta_taxa_cartao:m.desconta_taxa_cartao,desconta_impostos:m.desconta_impostos,desconta_custo_entrega:m.desconta_taxa_entrega,comissao_venda_parcial:m.comissao_venda_parcial,permite_edicao_venda:O.permite_edicao_venda,observacoes:O.observacoes||""};console.log("ðŸ’¾ Dados sendo enviados ao backend:",q),await F.post("/comissoes/configuracoes",q)}alert("âœ… Regras atualizadas com sucesso em todas as configuraÃ§Ãµes!"),te(m)}catch(_){console.error("Erro ao atualizar regras:",_),alert("Erro ao atualizar regras")}return}if(!u){alert("Selecione um item para configurar");return}try{const B={funcionario_id:parseInt(j),tipo:u.tipo,referencia_id:u.id,tipo_calculo:u.tipo_calculo,percentual:parseFloat(u.percentual),percentual_loja:u.tipo_calculo==="lucro"?parseFloat(u.percentual_loja):null,desconta_taxa_cartao:m.desconta_taxa_cartao,desconta_impostos:m.desconta_impostos,desconta_custo_entrega:m.desconta_taxa_entrega,comissao_venda_parcial:m.comissao_venda_parcial,permite_edicao_venda:u.permite_edicao_venda,observacoes:u.observacoes},_=await F.post("/comissoes/configuracoes",B);if(_.data.success){alert("ConfiguraÃ§Ã£o salva com sucesso!");const O=`${u.tipo}-${u.id}`;b(q=>({...q,[O]:{...B,id:_.data.config_id,nome_item:u.nome}})),h(null)}}catch(B){console.error("Erro ao salvar configuraÃ§Ã£o:",B),alert("Erro ao salvar configuraÃ§Ã£o")}},J=(B,_)=>{const O=`${B}-${_}`;return f[O]},E=(B,_)=>!!J(B,_),R=(B,_)=>p.some(O=>O.tipo===B&&O.referencia_id===_),K=(B,_=0)=>{const O="  ".repeat(_),q=_===0?"ðŸ“¦":"â†’",ae=B.filhas&&B.filhas.length>0,H=B.produtos&&B.produtos.length>0;return E("categoria",B.id)?y[B.id]?e.jsxs(ms.Fragment,{children:[ae&&B.filhas.map(G=>K(G,_+1)),H&&e.jsx("div",{className:"pl-6",style:{paddingLeft:`${24+_*20}px`},children:B.produtos.map(G=>{const ee=E("produto",G.id),de=R("produto",G.id);return ee?null:e.jsxs("div",{className:`p-2 flex items-center justify-between cursor-pointer hover:bg-gray-50 ${de?"bg-yellow-50":""}`,onClick:()=>X("produto",G.id,G.nome),children:[e.jsxs("span",{className:"text-sm",children:["ðŸ“Œ ",G.nome]}),de&&e.jsx("span",{className:"text-xs text-yellow-600",children:"â³ Na lista"})]},`prod-${G.id}`)})})]},`cat-${B.id}`):null:e.jsxs("div",{className:"border-b last:border-b-0",children:[e.jsxs("div",{className:`p-3 flex items-center justify-between cursor-pointer hover:bg-gray-50 ${R("categoria",B.id)?"bg-yellow-50":""}`,style:{paddingLeft:`${12+_*20}px`},onClick:()=>X("categoria",B.id,`${O}${B.nome}`),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[(ae||H)&&e.jsx("button",{onClick:G=>{G.stopPropagation(),A(B.id)},className:"text-gray-500",children:y[B.id]?"â–¼":"â–¶"}),e.jsxs("span",{className:_===0?"font-medium":"text-sm",children:[q," ",B.nome,_>0&&e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(NÃ­vel ",_+1,")"]})]})]}),R("categoria",B.id)&&e.jsx("span",{className:"text-xs text-yellow-600",children:"â³ Na lista"})]}),y[B.id]&&e.jsxs("div",{children:[ae&&e.jsx("div",{children:B.filhas.map(G=>K(G,_+1))}),H&&e.jsx("div",{className:"pl-6",style:{paddingLeft:`${24+_*20}px`},children:B.produtos.map(G=>{const ee=E("produto",G.id),de=R("produto",G.id);return ee?null:e.jsxs("div",{className:`p-2 flex items-center justify-between cursor-pointer hover:bg-gray-50 ${de?"bg-yellow-50":""}`,onClick:()=>X("produto",G.id,G.nome),children:[e.jsxs("span",{className:"text-sm",children:["ðŸ“Œ ",G.nome]}),de&&e.jsx("span",{className:"text-xs text-yellow-600",children:"â³ Na lista"})]},`prod-${G.id}`)})})]})]},`cat-${B.id}`)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"ConfiguraÃ§Ã£o de ComissÃ£o"}),e.jsx("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"Ã—"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"FuncionÃ¡rio"}),e.jsxs("select",{value:j,onChange:B=>g(B.target.value),className:"w-full border rounded-lg px-3 py-2",disabled:!!a,children:[e.jsx("option",{value:"",children:"Selecione um funcionÃ¡rio"}),l.map(B=>e.jsxs("option",{value:B.id,children:[B.nome," - ",B.cargo]},B.id))]}),e.jsx("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded text-xs",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"â„¹ï¸"}),e.jsxs("div",{className:"text-blue-700",children:[e.jsx("strong",{children:"Apenas parceiros podem receber comissÃµes."}),e.jsx("br",{}),'Se a pessoa nÃ£o aparecer na lista, marque-a como "Parceiro" no cadastro de pessoas primeiro.']})]})})]}),j&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ðŸ“… Dia do mÃªs para fechamento de comissÃ£o"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",min:"1",max:"31",value:v,onChange:B=>d(B.target.value),placeholder:"Ex: 5 (paga dia 5 de cada mÃªs)",className:"flex-1 border rounded-lg px-3 py-2"}),e.jsx("button",{onClick:async()=>{try{await F.put(`/clientes/${j}`,{data_fechamento_comissao:v?parseInt(v):null}),alert("âœ… Data de fechamento salva com sucesso!")}catch(B){console.error("Erro ao salvar data:",B),alert("âŒ Erro ao salvar data de fechamento")}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 whitespace-nowrap",children:"ðŸ’¾ Salvar Data"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Deixe em branco para pagamento 30 dias apÃ³s a venda (padrÃ£o)"})]}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Regras de CÃ¡lculo"}),e.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded text-sm",children:[e.jsx("div",{className:"font-semibold text-blue-800 mb-1",children:"ðŸ“‹ Hierarquia de ConfiguraÃ§Ãµes"}),e.jsxs("div",{className:"text-blue-700 text-xs",children:[e.jsx("strong",{children:"Produto"})," (prioridade mÃ¡xima) â†’ ",e.jsx("strong",{children:"Subcategoria"})," â†’ ",e.jsx("strong",{children:"Categoria"})," (prioridade mÃ­nima)",e.jsx("br",{}),e.jsx("span",{className:"text-blue-600",children:"Ao vender um produto, o sistema busca a configuraÃ§Ã£o mais especÃ­fica."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.desconta_taxa_cartao,onChange:B=>{console.log("âœ… Checkbox TAXA CARTÃƒO alterado para:",B.target.checked),C({...m,desconta_taxa_cartao:B.target.checked})},className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Desconta taxa de cartÃ£o"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.desconta_impostos,onChange:B=>{console.log("âœ… Checkbox IMPOSTOS alterado para:",B.target.checked),C({...m,desconta_impostos:B.target.checked})},className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Desconta impostos"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.desconta_taxa_entrega,onChange:B=>{console.log("âœ… Checkbox TAXA ENTREGA alterado para:",B.target.checked),C({...m,desconta_taxa_entrega:B.target.checked})},className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Desconta taxa de entrega"})]}),e.jsx("div",{className:"border-t pt-2 mt-3",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.comissao_venda_parcial,onChange:B=>{console.log("âœ… Checkbox VENDA PARCIAL alterado para:",B.target.checked),C({...m,comissao_venda_parcial:B.target.checked})},className:"rounded"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium",children:"Gerar comissÃ£o em vendas parciais"}),e.jsx("span",{className:"text-xs text-gray-500",children:m.comissao_venda_parcial?"ComissÃ£o gerada proporcionalmente a cada pagamento recebido":"ComissÃ£o gerada somente quando a venda estiver 100% paga"})]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"SeleÃ§Ã£o de Produtos"}),Object.keys(f).length>0&&e.jsxs("div",{className:"mb-4 border rounded-lg p-3 bg-green-50",children:[e.jsxs("h4",{className:"text-sm font-semibold text-green-800 mb-2",children:["âœ… Itens JÃ¡ Configurados (",Object.keys(f).length,")"]}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:Object.entries(f).map(([B,_])=>e.jsxs("div",{className:"w-full flex items-center justify-between text-xs bg-white p-2 rounded hover:bg-gray-50 transition-colors group",children:[e.jsxs("button",{onClick:()=>X(_.tipo,_.referencia_id,_.nome_item||"Item"),className:"flex-1 flex items-center gap-2 text-left",children:[_.tipo==="categoria"&&"ðŸ“¦",_.tipo==="subcategoria"&&"ðŸ“‚",_.tipo==="produto"&&"ðŸ“Œ",e.jsx("span",{className:"text-gray-700",children:_.nome_item||"Item"}),e.jsx("span",{className:"text-green-600 font-medium ml-auto",children:_.tipo_calculo==="percentual"?`${_.percentual}%`:`Lucro ${_.percentual}%`})]}),e.jsx("button",{onClick:async()=>{if(confirm(`Deseja remover a configuraÃ§Ã£o de "${_.nome_item||"Item"}"?`))try{await F.delete(`/comissoes/configuracoes/${_.id}`),alert("ConfiguraÃ§Ã£o removida com sucesso!");const O={...f};delete O[B],b(O)}catch(O){console.error("Erro ao remover:",O),alert("Erro ao remover configuraÃ§Ã£o")}},className:"ml-2 text-red-600 hover:text-red-800 opacity-0 group-hover:opacity-100 transition-opacity",children:"ðŸ—‘ï¸"})]},B))}),e.jsx("p",{className:"text-xs text-green-700 mt-2 italic",children:"ðŸ’¡ Clique em um item para editar"})]}),o?e.jsx("div",{className:"text-center py-8",children:"Carregando..."}):e.jsx("div",{className:"border rounded-lg max-h-96 overflow-y-auto",children:s.map(B=>K(B,0))},Object.keys(f).length)]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"ConfiguraÃ§Ã£o"}),u?e.jsxs("div",{className:"border rounded-lg p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-700",children:[u.tipo==="categoria"&&"ðŸ“¦ ",u.tipo==="subcategoria"&&"ðŸ“‚ ",u.tipo==="produto"&&"ðŸ“Œ ",u.nome]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Tipo: ",u.tipo]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Tipo de ComissÃ£o"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"percentual",checked:u.tipo_calculo==="percentual",onChange:B=>h({...u,tipo_calculo:B.target.value})}),e.jsx("span",{className:"text-sm",children:"Percentual fixo sobre venda"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"lucro",checked:u.tipo_calculo==="lucro",onChange:B=>h({...u,tipo_calculo:B.target.value})}),e.jsx("span",{className:"text-sm",children:"DivisÃ£o de lucro"})]})]})]}),u.tipo_calculo==="percentual"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentual"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",value:u.percentual,onChange:B=>h({...u,percentual:B.target.value}),className:"border rounded px-3 py-2 w-24"}),e.jsx("span",{children:"%"})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"DivisÃ£o do Lucro"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"FuncionÃ¡rio"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("input",{type:"number",min:"0",max:"100",value:u.percentual,onChange:B=>{const _=parseFloat(B.target.value);h({...u,percentual:_,percentual_loja:100-_})},className:"border rounded px-2 py-1 w-20"}),e.jsx("span",{className:"text-sm",children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Loja"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("input",{type:"number",value:u.percentual_loja,readOnly:!0,className:"border rounded px-2 py-1 w-20 bg-gray-100"}),e.jsx("span",{className:"text-sm",children:"%"})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"CÃ¡lculo: PreÃ§o Venda - Desconto - Taxas - Impostos - Custo = Lucro"})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:u.permite_edicao_venda,onChange:B=>h({...u,permite_edicao_venda:B.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"Permite editar percentual na venda"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"ObservaÃ§Ãµes"}),e.jsx("textarea",{value:u.observacoes,onChange:B=>h({...u,observacoes:B.target.value}),className:"border rounded px-3 py-2 w-full",rows:"3"})]}),e.jsx("button",{onClick:re,className:"w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded mb-2",children:"âž• Adicionar Ã  Lista"}),e.jsx("button",{onClick:$,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded",children:"ðŸ’¾ Salvar Agora"})]}):e.jsx("div",{className:"border rounded-lg p-8 text-center text-gray-500",children:e.jsx("p",{children:"Selecione uma categoria, subcategoria ou produto ao lado para configurar"})}),p.length>0&&e.jsxs("div",{className:"mt-6 border rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold mb-3",children:["ConfiguraÃ§Ãµes a Salvar (",p.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:p.map((B,_)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:B.nome}),e.jsxs("span",{className:"text-gray-500 ml-2",children:["(",B.tipo_calculo==="percentual"?`${B.percentual}%`:`Lucro ${B.percentual}%`,")"]})]}),e.jsx("button",{onClick:()=>M(_),className:"text-red-600 hover:text-red-800",children:"âœ•"})]},_))}),e.jsx("button",{onClick:Z,disabled:N,className:`w-full py-2 rounded mt-4 text-white ${N?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:N?e.jsxs("span",{children:["â³ Salvando ",S.atual,"/",S.total,"..."]}):"ðŸ’¾ Salvar Todas as ConfiguraÃ§Ãµes"})]})]})]})]}),e.jsx("div",{className:"p-6 border-t bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["â„¹ï¸ As configuraÃ§Ãµes se aplicam ",e.jsx("strong",{children:"apenas Ã s comissÃµes futuras"}),". ComissÃµes jÃ¡ geradas nÃ£o sÃ£o alteradas."]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 border rounded hover:bg-gray-50 bg-white",children:"Fechar"}),e.jsxs("button",{onClick:$,disabled:!u&&(!W||m.desconta_taxa_cartao===W.desconta_taxa_cartao&&m.desconta_impostos===W.desconta_impostos&&m.desconta_taxa_entrega===W.desconta_taxa_entrega&&m.comissao_venda_parcial===W.comissao_venda_parcial),className:`px-6 py-2 rounded font-medium ${u||W&&(m.desconta_taxa_cartao!==W.desconta_taxa_cartao||m.desconta_impostos!==W.desconta_impostos||m.desconta_taxa_entrega!==W.desconta_taxa_entrega||m.comissao_venda_parcial!==W.comissao_venda_parcial)?"bg-blue-600 hover:bg-blue-700 text-white cursor-pointer":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:["ðŸ’¾ ",u?"Salvar AlteraÃ§Ãµes":"Atualizar Regras"]})]})]})})]})})},lp=({comissaoId:a,onClose:t})=>{var c,f,b,u,h;const[s,o]=n.useState(null),[r,i]=n.useState(!0),[l,x]=n.useState(null);n.useEffect(()=>{a&&j()},[a]),n.useEffect(()=>{const p=k=>{k.key==="Escape"&&t()};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[t]);const j=async()=>{var p,k;try{i(!0),x(null);const N=await F.get(`/comissoes/comissao/${a}`);N.data.success?o(N.data.comissao):x("Erro ao carregar detalhes da comissÃ£o")}catch(N){console.error("Erro ao carregar detalhe:",N),x(((k=(p=N.response)==null?void 0:p.data)==null?void 0:k.detail)||"Erro ao conectar com o servidor")}finally{i(!1)}},g=p=>p?new Date(p).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",v=p=>p==null?"R$ 0,00":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(p),d=p=>p==null?"0%":`${p.toFixed(1)}%`,m=p=>{const N={pendente:"bg-yellow-100 text-yellow-800",pago:"bg-green-100 text-green-800",estornado:"bg-red-100 text-red-800"}[p]||"bg-gray-100 text-gray-800";return e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${N}`,children:p.toUpperCase()})},C=({label:p,valor:k,destaque:N=!1})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:p}),e.jsx("div",{className:`text-sm ${N?"text-lg font-bold text-gray-900":"text-gray-900"}`,children:k})]}),y=({titulo:p,children:k,cor:N="blue"})=>{const w={blue:"border-blue-500 bg-blue-50",green:"border-green-500 bg-green-50",purple:"border-purple-500 bg-purple-50",yellow:"border-yellow-500 bg-yellow-50",red:"border-red-500 bg-red-50"};return e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:`border-l-4 ${w[N]} px-4 py-2 mb-3`,children:e.jsx("h3",{className:"font-semibold text-gray-800",children:p})}),e.jsx("div",{className:"px-4",children:k})]})};return a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 transition-opacity",onClick:t}),e.jsxs("div",{className:"fixed inset-y-0 right-0 w-full md:w-2/3 lg:w-1/2 bg-white shadow-xl z-50 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Detalhes da ComissÃ£o"}),e.jsxs("p",{className:"text-sm text-blue-100",children:["Snapshot ImutÃ¡vel #",a]})]}),e.jsx("button",{onClick:t,className:"text-white hover:bg-blue-500 rounded-full p-2 transition",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[r&&e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando detalhes..."})]})}),l&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-red-800 font-semibold mb-2",children:"Erro ao carregar"}),e.jsx("p",{className:"text-red-600",children:l}),e.jsx("button",{onClick:j,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition",children:"Tentar Novamente"})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx(y,{titulo:"ðŸ“‹ IdentificaÃ§Ã£o",cor:"blue",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(C,{label:"ID da ComissÃ£o",valor:`#${s.id}`}),e.jsx(C,{label:"Venda",valor:s.numero_venda||`#${s.venda_id}`}),e.jsx(C,{label:"ID do Produto",valor:`#${s.produto_id}`}),e.jsx(C,{label:"ID do FuncionÃ¡rio",valor:`#${s.funcionario_id}`}),e.jsx(C,{label:"Data da Venda",valor:g(s.data_venda)}),e.jsx(C,{label:"NÃºmero da Parcela",valor:s.parcela_numero}),e.jsx(C,{label:"Quantidade",valor:s.quantidade})]})}),e.jsxs(y,{titulo:"ðŸ’° Valores Financeiros (Snapshot)",cor:"green",children:[e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-300 rounded-lg",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Contexto do Pagamento"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-3 rounded border border-blue-200",children:[e.jsx("span",{className:"text-xs text-gray-600 block mb-1",children:"Valor Total da Venda (Produtos)"}),e.jsx("span",{className:"text-lg font-bold text-blue-700",children:v(s.total_venda||0)})]}),e.jsxs("div",{className:"bg-white p-3 rounded border border-green-200",children:[e.jsxs("span",{className:"text-xs text-gray-600 block mb-1",children:["Valor Pago (Parcela ",s.parcela_numero,")"]}),e.jsx("span",{className:"text-lg font-bold text-green-600",children:v(((c=s.pagamento)==null?void 0:c.valor_pago_referencia)||0)}),((f=s.pagamento)==null?void 0:f.forma_pagamento)&&e.jsxs("span",{className:"text-xs text-gray-500 block mt-1",children:["via ",s.pagamento.forma_pagamento]})]})]}),((b=s.pagamento)==null?void 0:b.percentual_pago)<100&&e.jsxs("div",{className:"mt-2 text-xs text-blue-700",children:["â„¹ï¸ ComissÃ£o calculada proporcionalmente (",d(s.pagamento.percentual_pago)," do total)"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(C,{label:"Valor de Venda",valor:v(s.valores_financeiros.valor_venda)}),e.jsx(C,{label:"Valor de Custo",valor:v(s.valores_financeiros.valor_custo)}),e.jsx(C,{label:"Base Original (Lucro)",valor:v(s.valores_financeiros.valor_base_original)}),e.jsx(C,{label:"Base Comissionada",valor:v(s.valores_financeiros.valor_base_comissionada)})]}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Como chegamos na Base de CÃ¡lculo?"]}),e.jsxs("div",{className:"space-y-2 text-sm font-mono bg-white p-4 rounded border border-blue-200",children:[e.jsxs("div",{className:"flex justify-between pb-2 border-b border-gray-200",children:[e.jsxs("span",{className:"text-gray-700 font-semibold",children:["Valor Pago (Parcela ",s.parcela_numero||1,"):"]}),e.jsx("span",{className:"font-bold text-blue-600",children:v(((u=s.pagamento)==null?void 0:u.valor_pago_referencia)||s.valores_financeiros.valor_venda)})]}),s.deducoes&&s.deducoes.receita_taxa_entrega>0&&e.jsxs("div",{className:"flex justify-between text-green-600 pl-4",children:[e.jsx("span",{children:"(+) Taxa de Entrega (Receita):"}),e.jsxs("span",{className:"font-medium",children:["+ ",v(s.deducoes.receita_taxa_entrega)]})]}),s.deducoes&&e.jsxs(e.Fragment,{children:[s.deducoes.taxa_cartao>0&&e.jsxs("div",{className:"flex justify-between text-red-600 pl-4",children:[e.jsxs("span",{children:["(-) ",(()=>{const p=s.deducoes.forma_pagamento||"CartÃ£o",k=s.deducoes.numero_parcelas||1;let N=s.deducoes.taxa_percentual;if(k>1&&s.deducoes.taxas_por_parcela)try{N=JSON.parse(s.deducoes.taxas_por_parcela)[k.toString()]||N}catch{}let w="Taxa ";return p.includes("CrÃ©dito")?k>1?w+=`CartÃ£o CrÃ©dito ${k}x`:w+="CartÃ£o CrÃ©dito Ã  Vista":p.includes("DÃ©bito")?w+="CartÃ£o DÃ©bito":w+=p,N&&(w+=` (${N}%)`),w+":"})()]}),e.jsxs("span",{className:"font-medium",children:["- ",v(s.deducoes.taxa_cartao)]})]}),s.deducoes.imposto>0&&e.jsxs("div",{className:"flex justify-between text-red-600 pl-4",children:[e.jsxs("span",{children:["(-) Impostos (",s.deducoes.percentual_impostos?s.deducoes.percentual_impostos.toFixed(1)+"%":"","):"]}),e.jsxs("span",{className:"font-medium",children:["- ",v(s.deducoes.imposto)]})]}),s.deducoes.taxa_entregador>0&&e.jsxs("div",{className:"flex justify-between text-red-600 pl-4",children:[e.jsx("span",{children:"(-) Taxa paga ao Entregador:"}),e.jsxs("span",{className:"font-medium",children:["- ",v(s.deducoes.taxa_entregador)]})]}),s.deducoes.custo_operacional>0&&e.jsxs("div",{className:"flex justify-between text-red-600 pl-4",children:[e.jsx("span",{children:"(-) Custo Operacional de Entrega:"}),e.jsxs("span",{className:"font-medium",children:["- ",v(s.deducoes.custo_operacional)]})]}),s.deducoes.desconto>0&&e.jsxs("div",{className:"flex justify-between text-red-600 pl-4",children:[e.jsx("span",{children:"(-) Desconto:"}),e.jsxs("span",{className:"font-medium",children:["- ",v(s.deducoes.desconto)]})]})]}),e.jsxs("div",{className:"border-t-2 border-blue-400 pt-2 mt-2 flex justify-between font-bold",children:[e.jsx("span",{className:"text-blue-900",children:"(=) Base de CÃ¡lculo:"}),e.jsx("span",{className:"text-blue-900 text-lg",children:v(s.calculo.valor_base_calculo)})]})]})]})]}),e.jsxs(y,{titulo:"ðŸ§® CÃ¡lculo da ComissÃ£o",cor:"purple",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(C,{label:"Tipo de CÃ¡lculo",valor:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${s.calculo.tipo_calculo==="percentual"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:s.calculo.tipo_calculo.toUpperCase()})}),e.jsx(C,{label:"Percentual da ComissÃ£o",valor:d(s.calculo.percentual_comissao)}),e.jsx(C,{label:"Percentual Aplicado (Pago)",valor:d(s.calculo.percentual_aplicado)}),e.jsx(C,{label:"Valor Base de CÃ¡lculo",valor:v(s.calculo.valor_base_calculo),destaque:!0}),e.jsx(C,{label:"Valor da ComissÃ£o (Total)",valor:v(s.calculo.valor_comissao)}),e.jsx(C,{label:"Valor Efetivamente Gerado",valor:v(s.calculo.valor_comissao_gerada),destaque:!0})]}),e.jsxs("div",{className:"mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-purple-900 mb-3",children:"ðŸ“ FÃ³rmula Aplicada:"}),e.jsxs("div",{className:"space-y-2 text-sm font-mono",children:[e.jsxs("div",{className:"bg-white p-3 rounded border border-purple-200",children:[e.jsx("div",{className:"text-gray-700 mb-2",children:"Base de CÃ¡lculo Ã— Percentual = ComissÃ£o"}),e.jsxs("div",{className:"text-purple-900 font-bold",children:[v(s.calculo.valor_base_calculo)," Ã— ",d(s.calculo.percentual_comissao)," = ",v(s.calculo.valor_comissao)]})]}),s.calculo.percentual_aplicado<100&&e.jsxs("div",{className:"bg-yellow-50 p-3 rounded border border-yellow-200",children:[e.jsx("div",{className:"text-gray-700 mb-2",children:"âš ï¸ Venda parcial - ComissÃ£o proporcional ao valor pago:"}),e.jsxs("div",{className:"text-yellow-900 font-bold",children:[v(s.calculo.valor_comissao)," Ã— ",d(s.calculo.percentual_aplicado)," = ",v(s.calculo.valor_comissao_gerada)]})]})]})]})]}),e.jsxs(y,{titulo:"ðŸ’³ Controle de Pagamento",cor:"yellow",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(C,{label:"Percentual Pago da Venda",valor:d(s.pagamento.percentual_pago)}),e.jsx(C,{label:"Valor Pago de ReferÃªncia",valor:v(s.pagamento.valor_pago_referencia)}),e.jsx(C,{label:"Valor Pago da ComissÃ£o",valor:v(s.pagamento.valor_pago)}),e.jsx(C,{label:"Saldo Restante",valor:v(s.pagamento.saldo_restante)}),s.pagamento.data_pagamento&&e.jsxs(e.Fragment,{children:[e.jsx(C,{label:"Data do Pagamento",valor:g(s.pagamento.data_pagamento)}),e.jsx(C,{label:"Forma de Pagamento",valor:s.pagamento.forma_pagamento||"NÃ£o informado"})]})]}),s.pagamento.percentual_pago<100&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-yellow-800",children:["âš ï¸ Esta comissÃ£o foi gerada proporcionalmente ao pagamento parcial da venda. Apenas ",d(s.pagamento.percentual_pago)," do valor total foi pago."]})})]}),e.jsxs(y,{titulo:"ðŸ“Š Status e Controle",cor:s.status.status==="estornado"?"red":"blue",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-2",children:"Status Atual"}),m(s.status.status)]}),s.status.status==="estornado"&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-red-800 mb-2",children:"InformaÃ§Ãµes do Estorno"}),e.jsx(C,{label:"Data do Estorno",valor:g(s.status.data_estorno)}),e.jsx(C,{label:"Motivo do Estorno",valor:s.status.motivo_estorno||"NÃ£o informado"})]}),s.status.observacao_pagamento&&e.jsxs("div",{className:"mt-4 bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"ObservaÃ§Ãµes"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.status.observacao_pagamento})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-6 text-white shadow-lg",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center",children:[e.jsx("svg",{className:"w-6 h-6 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Resumo do CÃ¡lculo Completo"]}),e.jsxs("div",{className:"space-y-3 font-mono text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-white/20 pb-2",children:[e.jsxs("span",{className:"text-blue-100",children:["Valor Pago (Parcela ",s.parcela_numero||1,"):"]}),e.jsx("span",{className:"font-bold text-lg",children:v(((h=s.pagamento)==null?void 0:h.valor_pago_referencia)||s.valores_financeiros.valor_venda)})]}),s.deducoes&&e.jsxs(e.Fragment,{children:[s.deducoes.taxa_cartao>0&&e.jsxs("div",{className:"flex justify-between items-center pl-4 text-red-200",children:[e.jsxs("span",{children:["(-) ",(()=>{const p=s.deducoes.forma_pagamento||"CartÃ£o",k=s.deducoes.numero_parcelas||1;let N=s.deducoes.taxa_percentual;if(k>1&&s.deducoes.taxas_por_parcela)try{N=JSON.parse(s.deducoes.taxas_por_parcela)[k.toString()]||N}catch{}let w="Taxa ";return p.includes("CrÃ©dito")?k>1?w+=`CartÃ£o CrÃ©dito ${k}x`:w+="CartÃ£o CrÃ©dito Ã  Vista":p.includes("DÃ©bito")?w+="CartÃ£o DÃ©bito":w+=p,N&&(w+=` (${N}%)`),w+":"})()]}),e.jsxs("span",{className:"font-medium",children:["- ",v(s.deducoes.taxa_cartao)]})]}),s.deducoes.imposto>0&&e.jsxs("div",{className:"flex justify-between items-center pl-4 text-red-200",children:[e.jsx("span",{children:"(-) Impostos:"}),e.jsxs("span",{className:"font-medium",children:["- ",v(s.deducoes.imposto)]})]}),s.deducoes.custo_entrega>0&&e.jsxs("div",{className:"flex justify-between items-center pl-4 text-red-200",children:[e.jsx("span",{children:"(-) Custo de Entrega:"}),e.jsxs("span",{className:"font-medium",children:["- ",v(s.deducoes.custo_entrega)]})]}),s.deducoes.desconto>0&&e.jsxs("div",{className:"flex justify-between items-center pl-4 text-red-200",children:[e.jsx("span",{children:"(-) Desconto:"}),e.jsxs("span",{className:"font-medium",children:["- ",v(s.deducoes.desconto)]})]})]}),e.jsxs("div",{className:"flex justify-between items-center border-t-2 border-white/40 pt-2",children:[e.jsx("span",{className:"text-blue-100 font-semibold",children:"(=) Base de CÃ¡lculo:"}),e.jsx("span",{className:"font-bold text-lg",children:v(s.calculo.valor_base_calculo)})]}),e.jsxs("div",{className:"flex justify-between items-center border-b border-white/20 pb-2",children:[e.jsx("span",{className:"text-blue-100",children:"(Ã—) Percentual:"}),e.jsx("span",{className:"font-bold text-lg",children:d(s.calculo.percentual_comissao)})]}),e.jsxs("div",{className:"flex justify-between items-center bg-white/10 rounded-lg p-3 border-2 border-yellow-300",children:[e.jsx("span",{className:"text-xl font-bold",children:"ComissÃ£o Gerada:"}),e.jsx("span",{className:"font-bold text-3xl text-yellow-300",children:v(s.calculo.valor_comissao_gerada)})]})]})]})]})]}),s&&e.jsx("div",{className:"bg-blue-50 border-t border-blue-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-500 mt-0.5 mr-3 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-blue-800 mb-1",children:"Snapshot Financeiro ImutÃ¡vel"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Este Ã© um snapshot financeiro imutÃ¡vel. Os valores refletem exatamente o momento da venda e nÃ£o podem ser alterados. Qualquer discrepÃ¢ncia deve ser tratada atravÃ©s de ajustes ou estornos, nunca por ediÃ§Ã£o direta."})]})]})})]})]}):null},ip=()=>{const a=va(),[t,s]=n.useState([]),[o,r]=n.useState(!0),[i,l]=n.useState(null),[x,j]=n.useState(null),[g,v]=n.useState(!0),[d,m]=n.useState(null),[C,y]=n.useState(null),[c,f]=n.useState({funcionario_id:"",status:"",data_inicio:"",data_fim:"",venda_id:"",produto_id:"",grupo_id:""}),[b,u]=n.useState("ate_hoje"),[h,p]=n.useState([]),[k,N]=n.useState([]),[w,S]=n.useState(null),[P,W]=n.useState(null),[te,D]=n.useState(""),[A,X]=n.useState(""),[re,M]=n.useState(!1),[Z,$]=n.useState(!1),[J,E]=n.useState([]),[R,K]=n.useState(null),[B,_]=n.useState(!1),[O,q]=n.useState(""),[ae,H]=n.useState(!1),[le,G]=n.useState([]),[ee,de]=n.useState(!1),[ue,Ae]=n.useState(""),[se,we]=n.useState(""),[Se,ea]=n.useState(!1),[Ie,Je]=n.useState("sem_pagar"),[be,Fe]=n.useState(""),[he,Qe]=n.useState(""),[Ze,ma]=n.useState(0),[oa,ha]=n.useState([]),[da,oe]=n.useState([]),Ne=1;n.useEffect(()=>{console.log("[ComissoesListagem] Iniciando carregamento..."),(async()=>{try{await ke(),await Ue(),await ze(),await Y(),await ve(),await Le(),await I()}catch(qe){console.error("[ComissoesListagem] Erro no carregamento inicial:",qe)}})();const De=new Date().toISOString().split("T")[0];f(qe=>({...qe,data_fim:De}))},[]),n.useEffect(()=>{const xe=De=>{ae&&!De.target.closest(".autocomplete-container")&&H(!1)};return document.addEventListener("mousedown",xe),()=>{document.removeEventListener("mousedown",xe)}},[ae]);const ke=async()=>{var xe,De;console.log("[carregarComissoes] Iniciando...");try{r(!0),l(null);const qe=new URLSearchParams;c.funcionario_id&&qe.append("funcionario_id",c.funcionario_id),c.status&&qe.append("status",c.status),c.data_inicio&&qe.append("data_inicio",c.data_inicio),c.data_fim&&qe.append("data_fim",c.data_fim),c.venda_id&&qe.append("venda_id",c.venda_id);const ta=qe.toString(),Va=ta?`/comissoes?${ta}`:"/comissoes",ya=await F.get(Va);ya.data.success?s(ya.data.lista):l("Erro ao carregar comissÃµes")}catch(qe){console.error("Erro ao carregar comissÃµes:",qe),l(((De=(xe=qe.response)==null?void 0:xe.data)==null?void 0:De.detail)||"Erro ao conectar com o servidor")}finally{r(!1),console.log("[carregarComissoes] Finalizado")}},Ue=async()=>{var xe,De;try{v(!0),m(null);const qe=await F.get(`/comissoes/resumo?funcionario_id=${Ne}`);qe.data.success?j(qe.data.resumo):m("Erro ao carregar resumo")}catch(qe){console.error("Erro ao carregar resumo:",qe),m(((De=(xe=qe.response)==null?void 0:xe.data)==null?void 0:De.detail)||"Erro ao carregar resumo")}finally{v(!1)}},ze=async()=>{try{_(!0);const xe=await F.get("/comissoes/funcionarios");if(xe.data.success){const De=Array.isArray(xe.data.lista)?xe.data.lista:Array.isArray(xe.data.data)?xe.data.data:[];E(De)}}catch(xe){console.error("Erro ao carregar funcionÃ¡rios:",xe),E([])}finally{_(!1)}},Y=async()=>{try{const xe=await F.get("/produtos/");xe.data&&p(Array.isArray(xe.data)?xe.data:[])}catch(xe){console.error("Erro ao carregar produtos:",xe),p([])}},ve=async()=>{try{const xe=await F.get("/categorias-financeiras");xe.data&&N(Array.isArray(xe.data)?xe.data:[])}catch(xe){console.error("Erro ao carregar grupos:",xe),N([])}},Le=async()=>{console.log("[carregarFormasPagamento] Iniciando...");try{const xe=await F.get("/comissoes/formas-pagamento");xe.data&&ha(Array.isArray(xe.data)?xe.data:[])}catch(xe){console.error("[carregarFormasPagamento] Erro:",xe)}finally{console.log("[carregarFormasPagamento] Finalizado")}},I=async()=>{try{const xe=await F.get("/contas-bancarias");xe.data&&oe(Array.isArray(xe.data)?xe.data.filter(De=>De.ativa):[])}catch(xe){console.error("Erro ao carregar contas bancÃ¡rias:",xe)}},Q=()=>t.filter(De=>De.status==="pendente").reduce((De,qe)=>De+(qe.valor_comissao_gerada||0),0),fe=()=>t.filter(De=>le.includes(De.id)).reduce((De,qe)=>De+(qe.valor_comissao_gerada||0),0),U=xe=>xe?new Date(xe).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",ie=xe=>xe==null?"R$ 0,00":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(xe),_e=xe=>xe==null?"0%":`${xe.toFixed(1)}%`,$e=xe=>{const qe={pendente:"bg-yellow-100 text-yellow-800",pago:"bg-green-100 text-green-800",estornado:"bg-red-100 text-red-800"}[xe]||"bg-gray-100 text-gray-800";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${qe}`,children:xe.toUpperCase()})},T=xe=>{const qe={percentual:"bg-blue-100 text-blue-800",lucro:"bg-purple-100 text-purple-800"}[xe]||"bg-gray-100 text-gray-800";return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${qe}`,children:xe.toUpperCase()})},ne=()=>{if(g)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[1,2,3,4].map(De=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24 mb-3"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-32"})]},De))});if(d)return e.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"âš ï¸ NÃ£o foi possÃ­vel carregar o resumo financeiro"})});if(!x)return null;const xe=[{titulo:"Total Gerado",valor:x.total_gerado,cor:"blue",bgColor:"bg-blue-50",borderColor:"border-blue-200",textColor:"text-blue-600"},{titulo:"Total Pago",valor:x.total_pago,cor:"green",bgColor:"bg-green-50",borderColor:"border-green-200",textColor:"text-green-600"},{titulo:"Total Pendente",valor:x.total_pendente,cor:"yellow",bgColor:"bg-yellow-50",borderColor:"border-yellow-200",textColor:"text-yellow-600"},{titulo:"Saldo a Pagar",valor:x.saldo_a_pagar,cor:"purple",bgColor:"bg-purple-50",borderColor:"border-purple-200",textColor:"text-purple-600"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:xe.map((De,qe)=>e.jsxs("div",{className:`${De.bgColor} border ${De.borderColor} rounded-lg shadow-sm p-6 transition hover:shadow-md`,children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:De.titulo}),e.jsx("p",{className:`text-2xl font-bold ${De.textColor}`,children:ie(De.valor)})]},qe))})},pe=xe=>{y(xe)},Pe=()=>{y(null)},Be=(xe,De)=>{f(qe=>({...qe,[xe]:De}))},Ke=()=>{ke()},Ge=()=>{f({funcionario_id:"",status:"",data_inicio:"",data_fim:"",venda_id:"",produto_id:"",grupo_id:""}),K(null),S(null),W(null),q(""),D(""),X(""),u("ate_hoje");const De=new Date().toISOString().split("T")[0];setTimeout(()=>{(async()=>{try{r(!0);const ta=await F.get(`/comissoes?data_fim=${De}`);ta.data.success&&s(ta.data.lista)}catch(ta){console.error("Erro:",ta)}finally{r(!1)}})()},100)},aa=xe=>{S(xe),D(xe.nome),M(!1),f(De=>({...De,produto_id:xe.id}))},la=xe=>{W(xe),X(xe.nome),$(!1),f(De=>({...De,grupo_id:xe.id}))},ca=xe=>{K(xe),q(xe.nome),H(!1),f(De=>({...De,funcionario_id:xe.id}))},We=(J||[]).filter(xe=>{var De;return(De=xe==null?void 0:xe.nome)==null?void 0:De.toLowerCase().includes(O.toLowerCase())}),Sa=(xe,De)=>{De==="pendente"&&G(qe=>qe.includes(xe)?qe.filter(ta=>ta!==xe):[...qe,xe])},V=()=>{const xe=t.filter(De=>De.status==="pendente");le.length===xe.length?G([]):G(xe.map(De=>De.id))},Re=()=>{const xe=new Date().toISOString().split("T")[0];Ae(xe),we(""),Je("sem_pagar"),Fe(""),Qe("");const De=fe();ma(De),de(!0)},Oe=()=>{de(!1),Ae(""),we("")},He=async()=>{var xe,De;if(!ue){alert("Por favor, informe a data de pagamento");return}if(Ie==="com_pagamento"&&!he){alert("Por favor, selecione a conta bancÃ¡ria para o pagamento");return}try{ea(!0);let qe;if(Ie==="sem_pagar")qe=await F.post("/comissoes/fechar",{comissoes_ids:le,data_pagamento:ue,observacao:se||null});else{const ta=new URLSearchParams({valor_pago:Ze.toString(),forma_pagamento:be||"nao_informado",data_pagamento:ue});he&&ta.append("conta_bancaria_id",he),se&&ta.append("observacoes",se),le.forEach(Va=>{ta.append("comissoes_ids",Va)}),qe=await F.post(`/comissoes/fechar-com-pagamento?${ta.toString()}`)}if(qe.data.success){const ta=Ie==="sem_pagar"?qe.data.valor_total_fechamento:qe.data.valor_total_pago;alert(`âœ… ${qe.data.total_processadas} comissÃ£o(Ãµes) fechada(s) com sucesso!

Valor total: ${ie(ta)}
Modo: ${Ie==="sem_pagar"?"Sem pagamento (para pagar depois)":"Com pagamento no ato"}`),await ke(),await Ue(),G([]),Oe()}}catch(qe){console.error("Erro ao fechar comissÃµes:",qe),alert("âŒ Erro ao fechar comissÃµes: "+(((De=(xe=qe.response)==null?void 0:xe.data)==null?void 0:De.detail)||qe.message))}finally{ea(!1)}},ga=()=>{const xe=(h||[]).filter(qe=>{var ta;return(ta=qe==null?void 0:qe.nome)==null?void 0:ta.toLowerCase().includes(te.toLowerCase())}),De=(k||[]).filter(qe=>{var ta;return(ta=qe==null?void 0:qe.nome)==null?void 0:ta.toLowerCase().includes(A.toLowerCase())});return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Filtros"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t.length," registro",t.length!==1?"s":""," encontrado",t.length!==1?"s":""]})]}),e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"ðŸ“… PerÃ­odo"}),e.jsxs("div",{className:"flex gap-4 mb-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"ate_hoje",checked:b==="ate_hoje",onChange:qe=>{u(qe.target.value);const ta=new Date().toISOString().split("T")[0];f(Va=>({...Va,data_inicio:"",data_fim:ta}))},className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"AtÃ© hoje"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"personalizado",checked:b==="personalizado",onChange:qe=>u(qe.target.value),className:"text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"PerÃ­odo personalizado"})]})]}),b==="personalizado"&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:c.data_inicio,onChange:qe=>Be("data_inicio",qe.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:c.data_fim,onChange:qe=>Be("data_fim",qe.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"relative autocomplete-container",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"FuncionÃ¡rio"}),e.jsx("input",{type:"text",value:O,onChange:qe=>{q(qe.target.value),H(!0),qe.target.value===""&&(K(null),f(ta=>({...ta,funcionario_id:""})))},onFocus:()=>H(!0),disabled:B,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",placeholder:B?"Carregando...":"Digite o nome"}),ae&&O&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-auto",children:We.length>0?We.map(qe=>e.jsxs("div",{onClick:()=>ca(qe),className:"px-3 py-2 hover:bg-blue-50 cursor-pointer transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900",children:qe.nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",qe.id]})]},qe.id)):e.jsx("div",{className:"px-3 py-2 text-gray-500 text-sm",children:"Nenhum funcionÃ¡rio encontrado"})})]}),e.jsxs("div",{className:"relative autocomplete-container",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Produto"}),e.jsx("input",{type:"text",value:te,onChange:qe=>{D(qe.target.value),M(!0),qe.target.value===""&&(S(null),f(ta=>({...ta,produto_id:""})))},onFocus:()=>M(!0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Digite o nome do produto"}),re&&te&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-auto",children:xe.length>0?xe.map(qe=>e.jsxs("div",{onClick:()=>aa(qe),className:"px-3 py-2 hover:bg-blue-50 cursor-pointer transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900",children:qe.nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",qe.id]})]},qe.id)):e.jsx("div",{className:"px-3 py-2 text-gray-500 text-sm",children:"Nenhum produto encontrado"})})]}),e.jsxs("div",{className:"relative autocomplete-container",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Grupo/Categoria"}),e.jsx("input",{type:"text",value:A,onChange:qe=>{X(qe.target.value),$(!0),qe.target.value===""&&(W(null),f(ta=>({...ta,grupo_id:""})))},onFocus:()=>$(!0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Digite o nome do grupo"}),Z&&A&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-auto",children:De.length>0?De.map(qe=>e.jsxs("div",{onClick:()=>la(qe),className:"px-3 py-2 hover:bg-blue-50 cursor-pointer transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900",children:qe.nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",qe.id]})]},qe.id)):e.jsx("div",{className:"px-3 py-2 text-gray-500 text-sm",children:"Nenhum grupo encontrado"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:c.status,onChange:qe=>Be("status",qe.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"pendente",children:"Pendente"}),e.jsx("option",{value:"pago",children:"Pago"}),e.jsx("option",{value:"estornado",children:"Estornado"})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:Ke,disabled:o,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"Filtrar"]}),e.jsxs("button",{onClick:Ge,disabled:o,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition disabled:opacity-50 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Limpar Filtros"]})]})]})};return o?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando comissÃµes..."})]})}):i?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-red-800 font-semibold mb-2",children:"Erro ao carregar comissÃµes"}),e.jsx("p",{className:"text-red-600",children:i}),e.jsx("button",{onClick:ke,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition",children:"Tentar Novamente"})]})}):t.length===0?e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Demonstrativo de ComissÃµes"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-blue-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Nenhuma comissÃ£o encontrada"}),e.jsx("p",{className:"text-gray-600",children:"Ainda nÃ£o hÃ¡ registros de comissÃµes no sistema."})]})]}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Demonstrativo de ComissÃµes"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Total de registros: ",t.length]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>a("/comissoes/relatorios"),className:"inline-flex items-center px-4 py-2 border border-purple-300 rounded-md shadow-sm text-sm font-medium text-purple-700 bg-purple-50 hover:bg-purple-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:[e.jsx("svg",{className:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),"ðŸ“Š RelatÃ³rios"]}),e.jsxs("button",{onClick:()=>a("/comissoes/fechamentos"),className:"inline-flex items-center px-4 py-2 border border-purple-300 rounded-md shadow-sm text-sm font-medium text-purple-700 bg-purple-50 hover:bg-purple-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:[e.jsx("svg",{className:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Ver HistÃ³rico"]})]})]}),ne(),ga(),le.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-blue-800 font-medium",children:[le.length," comissÃ£o(Ãµes) selecionada(s)"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>G([]),className:"px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Limpar SeleÃ§Ã£o"}),e.jsxs("button",{onClick:Re,disabled:Se,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:opacity-50 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Fechar ComissÃµes"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:le.length>0&&le.length===t.filter(xe=>xe.status==="pendente").length,onChange:V,disabled:t.filter(xe=>xe.status==="pendente").length===0,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer",title:"Selecionar todas pendentes"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data da Venda"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"NÃºmero da Venda"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Parcela"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo de CÃ¡lculo"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Base de CÃ¡lculo"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"% ComissÃ£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor ComissÃ£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(xe=>e.jsxs("tr",{className:"hover:bg-blue-50 transition",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",onClick:De=>De.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:le.includes(xe.id),onChange:()=>Sa(xe.id,xe.status),disabled:xe.status!=="pendente",className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer disabled:opacity-30 disabled:cursor-not-allowed",title:xe.status!=="pendente"?`ComissÃ£o ${xe.status}`:"Selecionar para fechamento"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 cursor-pointer",onClick:()=>pe(xe.id),children:U(xe.data_venda)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-blue-600 font-medium cursor-pointer",onClick:()=>pe(xe.id),title:`ID interno: #${xe.venda_id}`,children:xe.numero_venda||`#${xe.venda_id}`}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 cursor-pointer",onClick:()=>pe(xe.id),children:["#",xe.produto_id]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 cursor-pointer",onClick:()=>pe(xe.id),children:xe.parcela_numero}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm cursor-pointer",onClick:()=>pe(xe.id),children:T(xe.tipo_calculo)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium cursor-pointer",onClick:()=>pe(xe.id),children:ie(xe.valor_base_calculo)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right cursor-pointer",onClick:()=>pe(xe.id),children:_e(xe.percentual_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-bold cursor-pointer",onClick:()=>pe(xe.id),children:ie(xe.valor_comissao_gerada)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm cursor-pointer",onClick:()=>pe(xe.id),children:$e(xe.status)})]},xe.id))})]})})}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"â„¹ï¸ InformaÃ§Ã£o:"})," Os valores exibidos sÃ£o snapshots imutÃ¡veis do momento da venda. Eles nÃ£o sÃ£o recalculados e refletem exatamente como a comissÃ£o foi gerada.",e.jsx("span",{className:"ml-2 text-blue-600 font-medium",children:"Clique em qualquer linha para ver mais detalhes."})]})}),t.length>0&&e.jsx("div",{className:"fixed bottom-0 left-64 right-0 bg-gradient-to-r from-indigo-600 via-blue-600 to-indigo-600 text-white shadow-lg z-40 border-t border-indigo-300/30",children:e.jsx("div",{className:"max-w-7xl mx-auto px-8 py-3.5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-semibold text-indigo-200 mb-0.5 tracking-wide uppercase",children:"ðŸ“… PerÃ­odo"}),e.jsx("div",{className:"text-sm font-bold text-white",children:b==="ate_hoje"?"AtÃ© hoje":e.jsxs(e.Fragment,{children:[c.data_inicio?new Date(c.data_inicio).toLocaleDateString("pt-BR"):"InÃ­cio"," â†’ ",c.data_fim?new Date(c.data_fim).toLocaleDateString("pt-BR"):"Fim"]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-semibold text-indigo-200 mb-0.5 tracking-wide uppercase",children:"ðŸ” Filtros"}),e.jsxs("div",{className:"text-sm font-bold text-white",children:[R&&e.jsxs("span",{className:"mr-2 bg-white/10 px-2 py-0.5 rounded",children:["ðŸ‘¤ ",R.nome]}),w&&e.jsxs("span",{className:"mr-2 bg-white/10 px-2 py-0.5 rounded",children:["ðŸ“¦ ",w.nome]}),P&&e.jsxs("span",{className:"mr-2 bg-white/10 px-2 py-0.5 rounded",children:["ðŸ“‚ ",P.nome]}),c.status&&e.jsxs("span",{className:"mr-2 bg-white/10 px-2 py-0.5 rounded",children:["âš¡ ",c.status]}),!R&&!w&&!P&&!c.status&&e.jsx("span",{className:"text-indigo-200",children:"Sem filtros"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-[10px] font-semibold text-indigo-200 mb-0.5 tracking-wide uppercase",children:"ðŸ’° Total Pendente (Filtrado)"}),e.jsx("div",{className:"text-3xl font-bold text-white drop-shadow-sm",children:ie(Q())}),e.jsxs("div",{className:"text-[11px] text-indigo-100 mt-0.5 font-medium",children:[t.filter(xe=>xe.status==="pendente").length," comissÃ£o(Ãµes) pendente(s)"]})]})]})})}),t.length>0&&e.jsx("div",{className:"h-24"}),C&&e.jsx(lp,{comissaoId:C,onClose:Pe}),ee&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Fechar ComissÃµes Selecionadas"}),e.jsx("button",{onClick:Oe,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700 font-medium",children:[le.length," comissÃ£o(Ãµes) selecionada(s)"]})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Valor Total"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:ie(fe())})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-3",children:"âš™ï¸ Tipo de Fechamento"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("button",{type:"button",onClick:()=>Je("sem_pagar"),className:`p-4 border-2 rounded-lg transition-all ${Ie==="sem_pagar"?"border-blue-500 bg-blue-50 shadow-md":"border-gray-300 hover:border-blue-300"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“‹"}),e.jsx("div",{className:"font-bold text-gray-800",children:"Fechar sem Pagar"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Apenas registrar fechamento"})]})}),e.jsx("button",{type:"button",onClick:()=>Je("com_pagamento"),className:`p-4 border-2 rounded-lg transition-all ${Ie==="com_pagamento"?"border-green-500 bg-green-50 shadow-md":"border-gray-300 hover:border-green-300"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ’°"}),e.jsx("div",{className:"font-bold text-gray-800",children:"Fechar e Pagar"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Com lanÃ§amento financeiro"})]})})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ðŸ“… Data do Fechamento/Pagamento ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:ue,onChange:xe=>Ae(xe.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),Ie==="com_pagamento"&&e.jsxs("div",{className:"space-y-4 mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-bold text-green-800 mb-3",children:"ðŸ’³ Dados do Pagamento"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ðŸ’µ Valor a Pagar (editÃ¡vel)"}),e.jsx("input",{type:"number",step:"0.01",value:Ze,onChange:xe=>ma(parseFloat(xe.target.value)),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Valor original: ",ie(fe())]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ðŸ’³ Forma de Pagamento ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:be,onChange:xe=>Fe(xe.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),formasPagamento.map(xe=>e.jsx("option",{value:xe.id,children:xe.nome},xe.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ðŸ¦ Conta BancÃ¡ria ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:he,onChange:xe=>Qe(xe.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),da.map(xe=>e.jsxs("option",{value:xe.id,children:[xe.nome," (",xe.banco,") - Saldo: ",ie(xe.saldo||0)]},xe.id))]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ðŸ“ ObservaÃ§Ãµes"}),e.jsx("textarea",{value:se,onChange:xe=>we(xe.target.value),rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"ObservaÃ§Ãµes sobre o fechamento..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:Oe,disabled:Se,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:He,disabled:Se||!ue||Ie==="com_pagamento"&&(!be||!he),className:`flex-1 px-4 py-2 rounded-lg transition disabled:opacity-50 flex items-center justify-center gap-2 ${Ie==="com_pagamento"?"bg-green-600 hover:bg-green-700":"bg-blue-600 hover:bg-blue-700"} text-white`,children:Se?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),Ie==="com_pagamento"?"ðŸ’° Fechar e Pagar":"ðŸ“‹ Fechar sem Pagar"]})})]})]})})]})},dp=()=>{const a=va(),[t,s]=n.useState([]),[o,r]=n.useState(!0),[i,l]=n.useState(null);n.useEffect(()=>{x()},[]);const x=async()=>{var d,m;try{r(!0),l(null);const C=await F.get("/comissoes/abertas");C.data.success?s(C.data.funcionarios||[]):l("Erro ao carregar comissÃµes em aberto")}catch(C){console.error("Erro ao carregar comissÃµes abertas:",C),l(((m=(d=C.response)==null?void 0:d.data)==null?void 0:m.detail)||"Erro ao carregar comissÃµes em aberto")}finally{r(!1)}},j=d=>{a(`/comissoes/fechamento/${d}`)},g=d=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(d),v=d=>d?new Date(d+"T00:00:00").toLocaleDateString("pt-BR"):"-";return o?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"bg-white shadow-md rounded-lg p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando comissÃµes em aberto..."})]})})}):i?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-6 w-6 text-red-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-medium",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:i})]})]}),e.jsx("button",{onClick:x,className:"mt-4 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-md transition-colors",children:"Tentar Novamente"})]})}):t.length===0?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-6",children:"ComissÃµes em Aberto"}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"h-16 w-16 text-green-500 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-xl font-semibold text-green-800 mb-2",children:"Nenhuma comissÃ£o pendente"}),e.jsx("p",{className:"text-green-600",children:"NÃ£o hÃ¡ funcionÃ¡rios com comissÃµes em aberto no momento."})]})]})}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"ComissÃµes em Aberto"}),e.jsx("p",{className:"text-gray-600",children:"FuncionÃ¡rios com comissÃµes pendentes de pagamento"})]}),e.jsxs("button",{onClick:()=>a("/comissoes/fechamentos"),className:"inline-flex items-center px-4 py-2 border border-purple-300 rounded-md shadow-sm text-sm font-medium text-purple-700 bg-purple-50 hover:bg-purple-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:[e.jsx("svg",{className:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Ver HistÃ³rico"]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total de FuncionÃ¡rios"}),e.jsx("p",{className:"text-2xl font-bold text-blue-800",children:t.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Pendente"}),e.jsx("p",{className:"text-2xl font-bold text-blue-800",children:g(t.reduce((d,m)=>d+m.total_pendente,0))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total de ComissÃµes"}),e.jsx("p",{className:"text-2xl font-bold text-blue-800",children:t.reduce((d,m)=>d+m.quantidade_comissoes,0)})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"FuncionÃ¡rio"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Pendente"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qtde de ComissÃµes"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ãšltima Venda"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ã£o"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(d=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold text-sm",children:d.nome_funcionario.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:d.nome_funcionario}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",d.funcionario_id]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-semibold text-green-600",children:g(d.total_pendente)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:d.quantidade_comissoes})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500",children:v(d.data_ultima_venda)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsxs("button",{onClick:()=>j(d.funcionario_id),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",children:[e.jsx("svg",{className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Conferir"]})})]},d.funcionario_id))})]})}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsx("p",{className:"text-sm text-gray-500 text-center",children:'Clique em "Conferir" para visualizar os detalhes das comissÃµes de cada funcionÃ¡rio'})})]})})},cp=()=>{const{funcionario_id:a}=lt(),t=va(),[s,o]=n.useState(!0),[r,i]=n.useState(null),[l,x]=n.useState(null),[j,g]=n.useState([]),[v,d]=n.useState(null),[m,C]=n.useState(null),[y,c]=n.useState([]),[f,b]=n.useState([]),[u,h]=n.useState([]),[p,k]=n.useState(""),[N,w]=n.useState(""),[S,P]=n.useState(""),[W,te]=n.useState(""),[D,A]=n.useState(!1),[X,re]=n.useState(new Set),[M,Z]=n.useState(""),[$,J]=n.useState("nao_informado"),[E,R]=n.useState(new Date().toISOString().split("T")[0]),[K,B]=n.useState(""),[_,O]=n.useState(!1),[q,ae]=n.useState(null);n.useEffect(()=>{H()},[a]);const H=async()=>{var Se,ea;try{o(!0),i(null);const Ie=await F.get(`/comissoes/conferencia-avancada/${a}`);Ie.data.success&&(x(Ie.data.funcionario),g(Ie.data.comissoes),d(Ie.data.resumo),C(Ie.data.periodo_selecionado));const Je=await F.get("/comissoes/formas-pagamento");Je.data.success&&h(Je.data.formas);const be=await F.get("/produtos/categorias");be.data.data&&c(be.data.data)}catch(Ie){i(((ea=(Se=Ie.response)==null?void 0:Se.data)==null?void 0:ea.detail)||"Erro ao carregar dados"),console.error("Erro:",Ie)}finally{o(!1)}},le=async()=>{var Se,ea;try{o(!0);const Ie={grupo_produto:p?parseInt(p):void 0,produto_id:N?parseInt(N):void 0,data_inicio:S||void 0,data_fim:W||void 0},Je=await F.get(`/comissoes/conferencia-avancada/${a}`,{params:Object.fromEntries(Object.entries(Ie).filter(([be,Fe])=>Fe!==void 0))});Je.data.success&&(g(Je.data.comissoes),d(Je.data.resumo),C(Je.data.periodo_selecionado))}catch(Ie){i(((ea=(Se=Ie.response)==null?void 0:Se.data)==null?void 0:ea.detail)||"Erro ao aplicar filtros")}finally{o(!1)}},G=()=>{k(""),w(""),P(""),te(""),setTimeout(()=>H(),100)},ee=Se=>{const ea=new Set(X);ea.has(Se)?ea.delete(Se):ea.add(Se),re(ea)},de=()=>{X.size===j.length?re(new Set):re(new Set(j.map(Se=>Se.id)))},ue=()=>{if(X.size===0){alert("Selecione pelo menos uma comissÃ£o");return}R(new Date().toISOString().split("T")[0]),Z(""),J("nao_informado"),B(""),ae(null),A(!0)},Ae=async()=>{var Se,ea;try{if(!M||parseFloat(M)<=0){ae("Valor a pagar deve ser maior que zero");return}O(!0),ae(null);const Ie={comissoes_ids:Array.from(X),valor_pago:parseFloat(M),forma_pagamento:$,data_pagamento:E,observacoes:K||null},Je=await F.post("/comissoes/fechar-com-pagamento",Ie);Je.data.success&&(alert(`âœ… Fechamento realizado com sucesso!

Processadas: ${Je.data.total_processadas}
Valor total: R$ ${Je.data.valor_total_fechado.toFixed(2)}
Valor pago: R$ ${Je.data.valor_total_pago.toFixed(2)}
Saldo restante: R$ ${Je.data.saldo_total_restante.toFixed(2)}
ComissÃµes com saldo: ${Je.data.comissoes_com_saldo}`),A(!1),re(new Set),H())}catch(Ie){ae(((ea=(Se=Ie.response)==null?void 0:Se.data)==null?void 0:ea.detail)||"Erro ao fechar comissÃµes")}finally{O(!1)}};if(s)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})});const se=Array.from(X).reduce((Se,ea)=>{const Ie=j.find(Je=>Je.id===ea);return Se+(Ie?Ie.valor_comissao:0)},0),we=se-(parseFloat(M)||0);return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"ConferÃªncia de ComissÃµes"}),e.jsx("p",{className:"text-gray-600 mt-1",children:l?`${l.nome} (ID: ${l.id})`:"Carregando..."})]}),e.jsx("button",{onClick:()=>t("/comissoes/abertas"),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"â† Voltar"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Filtros AvanÃ§ados"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Grupo de Produto"}),e.jsxs("select",{value:p,onChange:Se=>k(Se.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"",children:"Todos"}),y.map(Se=>e.jsx("option",{value:Se.id,children:Se.nome},Se.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Produto"}),e.jsx("input",{type:"text",placeholder:"Buscar produto...",value:N,onChange:Se=>w(Se.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:S,onChange:Se=>P(Se.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Fim"}),e.jsx("input",{type:"date",value:W,onChange:Se=>te(Se.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:le,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Aplicar Filtros"}),e.jsx("button",{onClick:G,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Limpar"})]})]}),m&&v&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 mb-6 border border-blue-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"PerÃ­odo Selecionado"}),e.jsx("p",{className:"text-gray-600",children:m.data_inicio&&m.data_fim?`${new Date(m.data_inicio).toLocaleDateString("pt-BR")} atÃ© ${new Date(m.data_fim).toLocaleDateString("pt-BR")}`:"Sem perÃ­odo especÃ­fico"}),m.grupo_produto_nome&&e.jsxs("p",{className:"text-gray-600 text-sm",children:["Grupo: ",m.grupo_produto_nome]}),m.produto_nome&&e.jsxs("p",{className:"text-gray-600 text-sm",children:["Produto: ",m.produto_nome]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Resumo do PerÃ­odo"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Quantidade"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:v.quantidade_comissoes})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["R$ ",v.valor_total.toFixed(2)]})]}),v.valor_pago_total>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pago"}),e.jsxs("p",{className:"text-lg font-semibold text-blue-600",children:["R$ ",v.valor_pago_total.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Saldo"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["R$ ",v.saldo_restante_total.toFixed(2)]})]})]})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden mb-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:X.size===j.length&&j.length>0,onChange:de})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Quantidade"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Base"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"%"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Pago"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Saldo"})]})}),e.jsx("tbody",{children:j.map(Se=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:X.has(Se.id),onChange:()=>ee(Se.id)})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(Se.data_venda).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"px-4 py-3 text-sm",children:Se.nome_produto}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:Se.cliente_nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:Se.quantidade.toFixed(2)}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right",children:["R$ ",Se.valor_base_calculo.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right",children:[Se.percentual_comissao.toFixed(2),"%"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right font-semibold text-green-600",children:["R$ ",Se.valor_comissao.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-blue-600",children:Se.valor_pago?`R$ ${Se.valor_pago.toFixed(2)}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-orange-600",children:Se.saldo_restante?`R$ ${Se.saldo_restante.toFixed(2)}`:"-"})]},Se.id))})]})})}),e.jsx("div",{className:"bg-gray-900 text-white rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-300",children:[X.size," de ",j.length," comissÃµes selecionadas"]})}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Total Selecionado"}),e.jsxs("p",{className:"text-2xl font-bold text-green-400",children:["R$ ",se.toFixed(2)]})]}),parseFloat(M)>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"SerÃ¡ Pago"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-400",children:["R$ ",parseFloat(M).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Saldo Restante"}),e.jsxs("p",{className:`text-2xl font-bold ${we>0?"text-orange-400":"text-green-400"}`,children:["R$ ",we.toFixed(2)]})]})]}),e.jsx("button",{onClick:ue,disabled:X.size===0,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-500 rounded-lg font-semibold transition",children:"Fechar e Pagar"})]})]})}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-2xl p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Fechamento com Pagamento"}),q&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:q}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded border border-blue-200",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["ComissÃµes a processar: ",X.size]}),e.jsxs("p",{className:"text-lg font-bold text-gray-800",children:["Valor Total: R$ ",se.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de Pagamento *"}),e.jsx("select",{value:$,onChange:Se=>J(Se.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:u.map(Se=>e.jsx("option",{value:Se.nome,children:Se.descricao},Se.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor a Pagar *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"flex items-center bg-gray-100 px-3 py-2 rounded-lg border border-gray-300",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:se,value:M,onChange:Se=>Z(Se.target.value),placeholder:"0.00",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["MÃ¡ximo: R$ ",se.toFixed(2),parseFloat(M)<se&&parseFloat(M)>0&&e.jsxs("span",{className:"text-orange-600 font-semibold ml-2",children:["(Pagamento Parcial - Saldo: R$ ",(se-parseFloat(M)).toFixed(2),")"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data de Pagamento *"}),e.jsx("input",{type:"date",value:E,onChange:Se=>R(Se.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ObservaÃ§Ãµes"}),e.jsx("textarea",{value:K,onChange:Se=>B(Se.target.value),placeholder:"ObservaÃ§Ãµes opcionais...",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>A(!1),disabled:_,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:Ae,disabled:_,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:_?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"â³"}),"Processando..."]}):"Confirmar Fechamento"})]})]})})]})},xp=()=>{const a=va(),[t,s]=n.useState([]),[o,r]=n.useState(!0),[i,l]=n.useState(null),[x,j]=n.useState(null),[g,v]=n.useState(""),[d,m]=n.useState(""),[C,y]=n.useState("");n.useEffect(()=>{c()},[]);const c=async()=>{var N,w;try{r(!0),l(null);const S=new URLSearchParams;g&&S.append("data_inicio",g),d&&S.append("data_fim",d),C&&S.append("funcionario_id",C);const P=`/comissoes/fechamentos${S.toString()?"?"+S.toString():""}`,W=await F.get(P);W.data.success?(s(W.data.fechamentos||[]),j(W.data.resumo)):l("Erro ao carregar histÃ³rico")}catch(S){console.error("Erro ao carregar histÃ³rico:",S),l(((w=(N=S.response)==null?void 0:N.data)==null?void 0:w.detail)||"Erro ao carregar histÃ³rico de fechamentos")}finally{r(!1)}},f=()=>{c()},b=()=>{v(""),m(""),y(""),setTimeout(()=>c(),100)},u=N=>{a(`/comissoes/fechamentos/detalhe?funcionario_id=${N.funcionario_id}&data_pagamento=${N.data_pagamento}`)},h=N=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(N),p=N=>N?new Date(N+"T00:00:00").toLocaleDateString("pt-BR"):"-",k=N=>N?new Date(N).toLocaleString("pt-BR"):"-";return o?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"bg-white shadow-md rounded-lg p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando histÃ³rico..."})]})})}):i?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-6 w-6 text-red-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-medium",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:i})]})]}),e.jsx("button",{onClick:c,className:"mt-4 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-md transition-colors",children:"Tentar Novamente"})]})}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-8",children:[e.jsxs("div",{className:"mb-6 border-b border-gray-200 pb-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"HistÃ³rico de Fechamentos"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Auditoria de comissÃµes fechadas - somente leitura"})]}),e.jsxs("div",{className:"mb-6 bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Filtros"}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:g,onChange:N=>v(N.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:d,onChange:N=>m(N.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ID do FuncionÃ¡rio"}),e.jsx("input",{type:"number",value:C,onChange:N=>y(N.target.value),placeholder:"Deixe vazio para todos",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:f,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors",children:"Aplicar"}),e.jsx("button",{onClick:b,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md transition-colors",children:"Limpar"})]})]})]}),x&&e.jsx("div",{className:"mb-6 bg-purple-50 border border-purple-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Total de Fechamentos"}),e.jsx("p",{className:"text-2xl font-bold text-purple-800",children:x.total_fechamentos})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Valor Total Pago"}),e.jsx("p",{className:"text-2xl font-bold text-purple-800",children:h(x.valor_total_geral)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Total de ComissÃµes"}),e.jsx("p",{className:"text-2xl font-bold text-purple-800",children:x.quantidade_total_geral})]})]})}),t.length===0?e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"h-16 w-16 text-yellow-500 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-xl font-semibold text-yellow-800 mb-2",children:"Nenhum fechamento encontrado"}),e.jsx("p",{className:"text-yellow-600",children:"NÃ£o hÃ¡ fechamentos registrados no perÃ­odo selecionado."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"FuncionÃ¡rio"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Fechamento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Pagamento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qtde"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor Total"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ã£o"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map((N,w)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>u(N),children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-purple-600 font-semibold text-sm",children:N.nome_funcionario.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:N.nome_funcionario}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",N.funcionario_id]})]})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-600",children:k(N.data_fechamento)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm font-medium text-gray-900",children:p(N.data_pagamento)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("span",{className:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800",children:N.quantidade_comissoes})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-semibold text-green-600",children:h(N.valor_total)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:e.jsx("button",{onClick:S=>{S.stopPropagation(),u(N)},className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:"Ver Detalhes"})})]},`${N.funcionario_id}_${N.data_pagamento}_${w}`))})]})}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"ðŸ’¡ Clique em uma linha para ver os detalhes do fechamento"})})]})]})})},mp=()=>{const a=va(),[t]=Kr(),s=t.get("funcionario_id"),o=t.get("data_pagamento"),[r,i]=n.useState(null),[l,x]=n.useState(!0),[j,g]=n.useState(null);n.useEffect(()=>{if(!s||!o){g("ParÃ¢metros invÃ¡lidos: funcionario_id e data_pagamento sÃ£o obrigatÃ³rios"),x(!1);return}v()},[s,o]);const v=async()=>{var b,u;try{x(!0),g(null);const h=await F.get("/comissoes/fechamentos/detalhe",{params:{funcionario_id:s,data_pagamento:o}});h.data.success?i(h.data):g("Erro ao carregar detalhes do fechamento")}catch(h){console.error("Erro ao carregar detalhes:",h),g(((u=(b=h.response)==null?void 0:b.data)==null?void 0:u.detail)||"Erro ao carregar detalhes do fechamento")}finally{x(!1)}},d=b=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(b),m=b=>b?new Date(b+"T00:00:00").toLocaleDateString("pt-BR"):"-",C=b=>b?new Date(b).toLocaleString("pt-BR"):"-",y=()=>{a("/comissoes/fechamentos")};if(l)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"bg-white shadow-md rounded-lg p-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando detalhes..."})]})})});if(j||!r)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-6 w-6 text-red-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-medium",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:j||"Fechamento nÃ£o encontrado"})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:v,className:"px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-md transition-colors",children:"Tentar Novamente"}),e.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md transition-colors",children:"Voltar"})]})]})});const{fechamento:c,comissoes:f}=r;return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-8",children:[e.jsxs("div",{className:"mb-6 border-b border-gray-200 pb-4",children:[e.jsxs("button",{onClick:y,className:"mb-4 inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:[e.jsx("svg",{className:"mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Voltar"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Detalhes do Fechamento"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"VisualizaÃ§Ã£o completa das comissÃµes incluÃ­das neste fechamento"}),e.jsxs("div",{className:"mt-3 inline-flex items-center px-3 py-1 rounded-full bg-yellow-100 border border-yellow-300",children:[e.jsx("svg",{className:"h-4 w-4 text-yellow-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Somente Leitura - Registro de Auditoria"})]})]}),e.jsxs("div",{className:"mb-6 bg-purple-50 border border-purple-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-purple-800 mb-4",children:"InformaÃ§Ãµes do Fechamento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"FuncionÃ¡rio"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-purple-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-purple-700 font-semibold text-sm",children:c.nome_funcionario.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:c.nome_funcionario}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",c.funcionario_id]})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Data do Fechamento"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:C(c.data_fechamento)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Data de Pagamento"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:m(c.data_pagamento)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Quantidade de ComissÃµes"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:c.quantidade_comissoes})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Valor Total"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:d(c.valor_total)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"PerÃ­odo das Vendas"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:c.periodo_vendas})]})]}),c.observacao_pagamento&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-purple-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"ObservaÃ§Ãµes"}),e.jsx("p",{className:"text-sm text-gray-800 italic",children:c.observacao_pagamento})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ComissÃµes IncluÃ­das"}),f&&f.length>0?e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Venda"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Qtde"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor Venda"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"% ComissÃ£o"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ComissÃ£o"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map((b,u)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:b.nome_cliente||"Cliente nÃ£o identificado"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:b.nome_produto||"Produto nÃ£o identificado"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-600",children:m(b.data_venda)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-600",children:b.quantidade}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-gray-900",children:d(b.valor_venda_snapshot)}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-600",children:[b.percentual_snapshot,"%"]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-semibold text-green-600",children:d(b.valor_comissao)})]},b.id||u))}),e.jsx("tfoot",{className:"bg-gray-50 border-t-2 border-gray-300",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"6",className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"TOTAL:"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-base font-bold text-green-700",children:d(c.valor_total)})]})})]})}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-yellow-800",children:"Nenhuma comissÃ£o encontrada para este fechamento."})})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-500 mt-0.5 mr-3 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800 mb-1",children:"InformaÃ§Ãµes Importantes"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Este Ã© um registro imutÃ¡vel de auditoria"}),e.jsx("li",{children:"NÃ£o Ã© possÃ­vel editar ou reverter fechamentos realizados"}),e.jsx("li",{children:"Os valores foram capturados no momento do fechamento (snapshot)"}),e.jsx("li",{children:"Para questÃµes sobre este fechamento, entre em contato com a administraÃ§Ã£o"})]})]})]})})]})})},up=()=>{const a=va(),[t,s]=n.useState("margem-produto"),[o,r]=n.useState(!1),[i,l]=n.useState(""),[x,j]=n.useState(""),[g,v]=n.useState(null),[d,m]=n.useState(null),[C,y]=n.useState(null),[c,f]=n.useState(null),[b,u]=n.useState(null),[h,p]=n.useState(null),k=async E=>{r(!0);try{const R={};i&&(R.data_inicio=i),x&&(R.data_fim=x);let K="",B=null;switch(E){case"margem-produto":K="/relatorios-comissoes/margem-produto",B=v;break;case"produtos-prejudiciais":K="/relatorios-comissoes/produtos-prejudiciais",B=m;break;case"ranking-funcionarios":K="/relatorios-comissoes/ranking-funcionarios",B=y;break;case"ranking-produtos":K="/relatorios-comissoes/ranking-produtos",B=f;break;case"ranking-categorias":K="/relatorios-comissoes/ranking-categorias",B=u;break;case"dre":K="/relatorios-comissoes/visao-dre",R.ano=2026,B=p;break;default:r(!1);return}const _=await F.get(K,{params:R,timeout:1e4});B(_.data)}catch(R){console.error(`Erro ao carregar relatÃ³rio ${E}:`,R),R.code==="ECONNABORTED"||R.message.includes("timeout")?alert("â±ï¸ Tempo de resposta excedido. Verifique se o backend estÃ¡ rodando."):alert("âŒ Erro ao carregar relatÃ³rio. Verifique o console para detalhes.")}finally{r(!1)}};n.useEffect(()=>{k(t)},[t]);const N=()=>{k(t)},w=E=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(E),S=E=>`${E.toFixed(2)}%`,P=async()=>{try{const E={tipo:t,data_inicio:i,data_fim:x},R=await F.get("/relatorios-comissoes/exportar-csv",{params:E,responseType:"blob"}),K=window.URL.createObjectURL(new Blob([R.data])),B=document.createElement("a");B.href=K,B.setAttribute("download",`relatorio_${t}_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(B),B.click(),B.remove()}catch(E){console.error("Erro ao exportar CSV:",E),alert("Erro ao exportar arquivo")}},W=["#8884d8","#82ca9d","#ffc658","#ff7c7c","#a28bd4","#f48fb1"],te=E=>E===3?"text-red-700 bg-red-100 border-red-300":E===2?"text-orange-700 bg-orange-100 border-orange-300":"text-yellow-700 bg-yellow-100 border-yellow-300",D=()=>{const E=[{id:"margem-produto",label:"ðŸ“Š Margem por Produto",icone:"ðŸ’°"},{id:"produtos-prejudiciais",label:"âš ï¸ Produtos Prejudiciais",icone:"ðŸš¨"},{id:"ranking-funcionarios",label:"ðŸ‘¥ Ranking FuncionÃ¡rios",icone:"ðŸ†"},{id:"ranking-produtos",label:"ðŸ“¦ Ranking Produtos",icone:"ðŸ“ˆ"},{id:"ranking-categorias",label:"ðŸ“‚ Ranking Categorias",icone:"ðŸŽ¯"},{id:"dre",label:"ðŸ“‘ VisÃ£o DRE",icone:"ðŸ’¼"}];return e.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:E.map(R=>e.jsxs("button",{onClick:()=>s(R.id),className:`px-4 py-3 rounded-lg font-medium whitespace-nowrap transition-all ${t===R.id?"bg-blue-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx("span",{className:"text-xl mr-2",children:R.icone}),R.label]},R.id))})},A=()=>e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ“… Data InÃ­cio"}),e.jsx("input",{type:"date",value:i,onChange:E=>l(E.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ“… Data Fim"}),e.jsx("input",{type:"date",value:x,onChange:E=>j(E.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition mt-6",children:"ðŸ” Buscar"}),e.jsx("button",{onClick:()=>{l(""),j(""),k(t)},className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition mt-6",children:"ðŸ”„ Limpar"}),["margem-produto","produtos-prejudiciais","ranking-funcionarios","ranking-produtos"].includes(t)&&e.jsx("button",{onClick:P,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition mt-6",children:"ðŸ“¥ Exportar CSV"})]})]})}),X=()=>{if(!g)return e.jsx("div",{className:"text-center py-12",children:"Carregando..."});const E=g.dados.slice(0,10);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Total de Produtos"}),e.jsx("div",{className:"text-3xl font-bold text-blue-800",children:g.total_produtos})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-red-600 font-medium",children:"Produtos com Margem Negativa"}),e.jsx("div",{className:"text-3xl font-bold text-red-800",children:g.produtos_com_alerta})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Produtos SaudÃ¡veis"}),e.jsx("div",{className:"text-3xl font-bold text-green-800",children:g.total_produtos-g.produtos_com_alerta})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Top 10 Produtos por Margem LÃ­quida"}),e.jsx(za,{width:"100%",height:400,children:e.jsxs(bs,{data:E,children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ga,{dataKey:"produto_nome",angle:-45,textAnchor:"end",height:100}),e.jsx(Ua,{}),e.jsx(Ma,{formatter:R=>w(R)}),e.jsx(Wa,{}),e.jsx(Ja,{dataKey:"margem_liquida",fill:"#82ca9d",name:"Margem LÃ­quida"}),e.jsx(Ja,{dataKey:"valor_comissao",fill:"#ff7c7c",name:"ComissÃ£o"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Produto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Categoria"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Venda"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Custo"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"ComissÃ£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Margem LÃ­quida"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"% Margem"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.dados.map((R,K)=>e.jsxs("tr",{className:R.alerta_margem_negativa?"bg-red-50":"",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:R.produto_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:R.categoria_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:w(R.valor_venda)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:w(R.valor_custo)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-orange-600 font-medium",children:w(R.valor_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold",children:e.jsx("span",{className:R.margem_liquida<0?"text-red-600":"text-green-600",children:w(R.margem_liquida)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:S(R.percentual_margem)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:R.alerta_margem_negativa?e.jsx("span",{className:"px-2 py-1 text-xs font-bold text-red-700 bg-red-100 rounded",children:"âš ï¸ NEGATIVA"}):e.jsx("span",{className:"px-2 py-1 text-xs font-bold text-green-700 bg-green-100 rounded",children:"âœ… OK"})})]},K))})]})})})]})},re=()=>d?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{className:"font-semibold",children:"RelatÃ³rio informativo"})," baseado em vendas jÃ¡ realizadas. Os dados nÃ£o alteram comissÃµes, preÃ§os ou histÃ³ricos e nÃ£o devem ser usados para ajustes retroativos."]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Produtos Analisados"}),e.jsx("div",{className:"text-3xl font-bold text-blue-800",children:d.total_produtos_analisados})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-red-600 font-medium",children:"CrÃ­ticos"}),e.jsx("div",{className:"text-3xl font-bold text-red-800",children:d.produtos_criticos})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-orange-600 font-medium",children:"Total Prejudiciais"}),e.jsx("div",{className:"text-3xl font-bold text-orange-800",children:d.total_produtos_prejudiciais})]})]}),e.jsx("div",{className:"space-y-4",children:d.dados.map((E,R)=>e.jsxs("div",{className:`border-2 rounded-lg p-6 ${te(E.nivel_gravidade)}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:[E.nivel_gravidade===3&&"ðŸš¨",E.nivel_gravidade===2&&"âš ï¸",E.nivel_gravidade===1&&"âš¡"," ",E.produto_nome]}),e.jsx("p",{className:"text-sm opacity-75",children:E.categoria_nome})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-medium",children:"Impacto Financeiro"}),e.jsx("div",{className:"text-2xl font-bold",children:w(E.impacto_financeiro)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium opacity-75",children:"Margem LÃ­quida"}),e.jsx("div",{className:"text-lg font-bold",children:w(E.margem_liquida)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium opacity-75",children:"% Margem"}),e.jsx("div",{className:"text-lg font-bold",children:S(E.percentual_margem)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium opacity-75",children:"ComissÃ£o"}),e.jsx("div",{className:"text-lg font-bold",children:w(E.valor_comissao)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium opacity-75",children:"% ComissÃ£o"}),e.jsx("div",{className:"text-lg font-bold",children:S(E.percentual_comissao)})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold mb-2",children:"âš ï¸ Alertas:"}),e.jsx("ul",{className:"list-disc list-inside text-sm space-y-1",children:E.alertas.map((K,B)=>e.jsx("li",{children:K},B))})]})]},R))})]}):e.jsx("div",{className:"text-center py-12",children:"Carregando..."}),M=()=>C?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{className:"font-semibold",children:"RelatÃ³rio informativo"})," baseado em volume histÃ³rico. NÃ£o representa meta, desempenho ou polÃ­tica de incentivo."]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"FuncionÃ¡rios por Volume de ComissÃµes (10 maiores)"}),e.jsx(za,{width:"100%",height:400,children:e.jsxs(bs,{data:C.ranking,children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ga,{dataKey:"funcionario_nome",angle:-45,textAnchor:"end",height:100}),e.jsx(Ua,{}),e.jsx(Ma,{formatter:E=>w(E)}),e.jsx(Wa,{}),e.jsx(Ja,{dataKey:"total_comissao",fill:"#8884d8",name:"Total de ComissÃµes"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"PosiÃ§Ã£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"FuncionÃ¡rio"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total ComissÃµes"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Quantidade"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"MÃ©dia"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:C.ranking.map(E=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsxs("span",{className:"text-lg font-semibold text-gray-700",children:[E.posicao,"Âº"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:E.funcionario_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-green-600",children:w(E.total_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:E.quantidade_comissoes}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:w(E.media_comissao)})]},E.posicao))})]})})]}):e.jsx("div",{className:"text-center py-12",children:"Carregando..."}),Z=()=>c?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{className:"font-semibold",children:"RelatÃ³rio informativo"})," baseado em volume histÃ³rico. NÃ£o representa meta, desempenho ou polÃ­tica de incentivo."]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Produtos por Volume de ComissÃµes (10 maiores)"}),e.jsx(za,{width:"100%",height:400,children:e.jsxs(bs,{data:c.ranking,children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ga,{dataKey:"produto_nome",angle:-45,textAnchor:"end",height:100}),e.jsx(Ua,{}),e.jsx(Ma,{formatter:E=>w(E)}),e.jsx(Wa,{}),e.jsx(Ja,{dataKey:"total_comissao",fill:"#82ca9d",name:"Total de ComissÃµes"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"PosiÃ§Ã£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Produto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Categoria"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total ComissÃ£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Qtd Vendas"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total Venda"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.ranking.map(E=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-center text-lg font-bold text-gray-700",children:[E.posicao,"Âº"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:E.produto_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:E.categoria_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-green-600",children:w(E.total_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:E.quantidade_vendas}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:w(E.total_venda)})]},E.posicao))})]})})]}):e.jsx("div",{className:"text-center py-12",children:"Carregando..."}),$=()=>b?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{className:"font-semibold",children:"RelatÃ³rio informativo"})," baseado em volume histÃ³rico. NÃ£o representa meta, desempenho ou polÃ­tica de incentivo."]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"DistribuiÃ§Ã£o de ComissÃµes por Categoria"}),e.jsx(za,{width:"100%",height:400,children:e.jsxs(bo,{children:[e.jsx(fo,{data:b.ranking,dataKey:"total_comissao",nameKey:"categoria_nome",cx:"50%",cy:"50%",outerRadius:120,label:E=>`${E.categoria_nome}: ${E.percentual_total}%`,children:b.ranking.map((E,R)=>e.jsx(Er,{fill:W[R%W.length]},`cell-${R}`))}),e.jsx(Ma,{formatter:E=>w(E)})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"PosiÃ§Ã£o"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Categoria"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total ComissÃ£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"% do Total"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Qtd ComissÃµes"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total Vendas"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.ranking.map(E=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-center text-lg font-bold text-gray-700",children:[E.posicao,"Âº"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:E.categoria_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-green-600",children:w(E.total_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-blue-600 font-medium",children:S(E.percentual_total)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:E.quantidade_comissoes}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:w(E.total_venda)})]},E.posicao))})]})})]}):e.jsx("div",{className:"text-center py-12",children:"Carregando..."}),J=()=>h?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{className:"font-semibold",children:"Regime de competÃªncia:"})," as comissÃµes sÃ£o reconhecidas como despesa na data da venda, independentemente do pagamento. Inclui comissÃµes pendentes e pagas."]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Receita Bruta (Ano)"}),e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:w(h.total_ano.receita_bruta)})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-orange-600 font-medium",children:"Despesa ComissÃ£o (Ano)"}),e.jsx("div",{className:"text-2xl font-bold text-orange-800",children:w(h.total_ano.despesa_comissao)})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Margem LÃ­quida (Ano)"}),e.jsx("div",{className:"text-2xl font-bold text-green-800",children:w(h.total_ano.margem_liquida)})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-purple-600 font-medium",children:"% ComissÃ£o sobre Receita"}),e.jsx("div",{className:"text-2xl font-bold text-purple-800",children:S(h.total_ano.percentual_comissao)})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"EvoluÃ§Ã£o Mensal - DRE"}),e.jsx(za,{width:"100%",height:400,children:e.jsxs(Et,{data:h.dados_mensais,children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ga,{dataKey:"mes_nome"}),e.jsx(Ua,{}),e.jsx(Ma,{formatter:E=>w(E)}),e.jsx(Wa,{}),e.jsx(gs,{type:"monotone",dataKey:"receita_bruta",stroke:"#8884d8",name:"Receita Bruta",strokeWidth:2}),e.jsx(gs,{type:"monotone",dataKey:"despesa_comissao",stroke:"#ff7c7c",name:"Despesa ComissÃ£o",strokeWidth:2}),e.jsx(gs,{type:"monotone",dataKey:"margem_liquida",stroke:"#82ca9d",name:"Margem LÃ­quida",strokeWidth:2})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"MÃªs"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Receita Bruta"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Custo"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"ComissÃ£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Margem Bruta"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Margem LÃ­quida"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"% ComissÃ£o"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.dados_mensais.map(E=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:E.mes_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-blue-600 font-medium",children:w(E.receita_bruta)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-600",children:w(E.custo_total)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-orange-600 font-medium",children:w(E.despesa_comissao)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-700",children:w(E.margem_bruta)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-green-600",children:w(E.margem_liquida)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-purple-600",children:S(E.percentual_comissao_sobre_receita)})]},E.mes))})]})})]}):e.jsx("div",{className:"text-center py-12",children:"Carregando..."});return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>a("/comissoes-listagem"),className:"flex items-center gap-2 text-blue-600 hover:text-blue-800 mb-4",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Voltar para Demonstrativo"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"ðŸ“Š RelatÃ³rios AnalÃ­ticos de ComissÃµes"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"AnÃ¡lise de rentabilidade, margem e tomada de decisÃ£o estratÃ©gica"})]}),D(),A(),o?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600"})}):e.jsxs(e.Fragment,{children:[t==="margem-produto"&&X(),t==="produtos-prejudiciais"&&re(),t==="ranking-funcionarios"&&M(),t==="ranking-produtos"&&Z(),t==="ranking-categorias"&&$(),t==="dre"&&J()]})]})};function Jn(){const[a,t]=n.useState([]),[s,o]=n.useState([]),[r,i]=n.useState(!1),[l,x]=n.useState(!1),[j,g]=n.useState({id:null,categoria_id:"",nome:"",descricao:"",ativo:!0});n.useEffect(()=>{v(),d()},[]);const v=async()=>{try{const b=await F.get("/categorias-financeiras");t(b.data.filter(u=>u.ativo))}catch(b){console.error("Erro ao carregar categorias:",b),alert("Erro ao carregar categorias")}},d=async()=>{i(!0);try{const b=await F.get("/subcategorias");o(b.data)}catch(b){console.error("Erro ao carregar subcategorias:",b),alert("Erro ao carregar subcategorias")}finally{i(!1)}},m=async b=>{if(b.preventDefault(),!j.categoria_id||!j.nome){alert("Preencha categoria e nome");return}try{j.id?await F.put(`/subcategorias/${j.id}`,j):await F.post("/subcategorias",j),x(!1),g({id:null,categoria_id:"",nome:"",descricao:"",ativo:!0}),d()}catch(u){console.error("Erro ao salvar:",u),alert("Erro ao salvar subcategoria")}},C=b=>{g(b),x(!0)},y=async b=>{if(confirm("Deseja realmente excluir esta subcategoria?"))try{await F.delete(`/subcategorias/${b}`),d()}catch(u){console.error("Erro ao excluir:",u),alert("Erro ao excluir subcategoria")}},c=b=>{const u=a.find(h=>h.id===b);return u?u.nome:"-"},f=s.reduce((b,u)=>{const h=u.categoria_id;return b[h]||(b[h]={categoria:c(h),itens:[]}),b[h].itens.push(u),b},{});return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Subcategorias"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Gerencie as subcategorias de produtos"})]}),e.jsxs("button",{onClick:()=>{g({id:null,categoria_id:"",nome:"",descricao:"",ativo:!0}),x(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx("span",{children:"+"}),"Nova Subcategoria"]})]}),r?e.jsx("div",{className:"text-center py-8",children:"Carregando..."}):e.jsxs("div",{className:"space-y-6",children:[Object.entries(f).map(([b,u])=>e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-b",children:e.jsx("h2",{className:"font-semibold text-lg text-gray-800",children:u.categoria})}),e.jsx("div",{className:"divide-y",children:u.itens.map(h=>e.jsxs("div",{className:"px-4 py-3 flex justify-between items-center hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:h.nome}),h.descricao&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:h.descricao})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${h.ativo?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:h.ativo?"Ativo":"Inativo"}),e.jsx("button",{onClick:()=>C(h),className:"text-blue-600 hover:text-blue-800 px-3 py-1",children:"Editar"}),e.jsx("button",{onClick:()=>y(h.id),className:"text-red-600 hover:text-red-800 px-3 py-1",children:"Excluir"})]})]},h.id))})]},b)),Object.keys(f).length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Nenhuma subcategoria cadastrada"})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:[j.id?"Editar":"Nova"," Subcategoria"]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria *"}),e.jsxs("select",{value:j.categoria_id,onChange:b=>g({...j,categoria_id:parseInt(b.target.value)}),className:"w-full border rounded-lg px-3 py-2",required:!0,children:[e.jsx("option",{value:"",children:"Selecione..."}),a.map(b=>e.jsx("option",{value:b.id,children:b.nome},b.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",value:j.nome,onChange:b=>g({...j,nome:b.target.value}),className:"w-full border rounded-lg px-3 py-2",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:j.descricao,onChange:b=>g({...j,descricao:b.target.value}),className:"w-full border rounded-lg px-3 py-2",rows:"3"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:j.ativo,onChange:b=>g({...j,ativo:b.target.checked}),className:"mr-2"}),e.jsx("label",{className:"text-sm text-gray-700",children:"Ativo"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>x(!1),className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Salvar"})]})]})]})})]})}const pp=()=>{const[a,t]=n.useState([]),[s,o]=n.useState(!0),[r,i]=n.useState(!1),[l,x]=n.useState(null),[j,g]=n.useState(new Set),[v,d]=n.useState({nome:"",descricao:"",categoria_pai_id:null,ordem:0}),m=4;n.useEffect(()=>{C()},[]);const C=async()=>{try{o(!0);const w=await F.get("/produtos/categorias");t(w.data)}catch(w){console.error("Erro ao carregar categorias:",w),alert("Erro ao carregar categorias")}finally{o(!1)}},y=w=>{const S=new Set(j);S.has(w)?S.delete(w):S.add(w),g(S)},c=async w=>{var S,P;w.preventDefault();try{l?await F.put(`/produtos/categorias/${l}`,v):await F.post("/produtos/categorias",v),i(!1),x(null),d({nome:"",descricao:"",categoria_pai_id:null,ordem:0}),C()}catch(W){console.error("Erro ao salvar categoria:",W),(P=(S=W.response)==null?void 0:S.data)!=null&&P.detail?alert(W.response.data.detail):alert("Erro ao salvar categoria")}},f=w=>{x(w.id),d({nome:w.nome,descricao:w.descricao||"",categoria_pai_id:w.categoria_pai_id,ordem:w.ordem}),i(!0)},b=async w=>{var S,P;if(w.total_filhos>0){alert(`Esta categoria possui ${w.total_filhos} subcategoria(s). Remova-as primeiro.`);return}if(!(w.total_produtos>0&&!confirm(`Esta categoria possui ${w.total_produtos} produto(s). Deseja realmente excluir?`)))try{await F.delete(`/produtos/categorias/${w.id}`),C()}catch(W){console.error("Erro ao excluir categoria:",W),alert(((P=(S=W.response)==null?void 0:S.data)==null?void 0:P.detail)||"Erro ao excluir categoria")}},u=w=>{if(w.nivel>=m){alert(`Limite de ${m} nÃ­veis de categorias atingido.`);return}x(null),d({nome:"",descricao:"",categoria_pai_id:w.id,ordem:0}),i(!0)},h=()=>{x(null),d({nome:"",descricao:"",categoria_pai_id:null,ordem:0}),i(!0)},p=(w=null,S=1)=>a.filter(P=>P.categoria_pai_id===w).sort((P,W)=>P.ordem-W.ordem||P.nome.localeCompare(W.nome)).map(P=>({...P,nivel:S,filhos:p(P.id,S+1)})),k=(w,S=1)=>{const P=w.filhos&&w.filhos.length>0,W=j.has(w.id),te=S<m,D=(S-1)*30;return e.jsxs(ms.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white hover:bg-gray-50 border-b",style:{paddingLeft:`${20+D}px`},children:[e.jsx("div",{className:"w-5 flex items-center justify-center",children:P?e.jsx("button",{onClick:()=>y(w.id),className:"text-gray-500 hover:text-gray-700 transition-colors",children:W?e.jsx(nt,{size:18}):e.jsx(Zs,{size:18})}):e.jsx("span",{className:"text-gray-300",children:"â€¢"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-800",children:w.nome}),e.jsxs("span",{className:"text-xs text-gray-500",children:["NÃ­vel ",S]}),w.total_filhos>0&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:[w.total_filhos," sub"]}),w.total_produtos>0&&e.jsxs("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded",children:[w.total_produtos," produtos"]})]}),w.descricao&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:w.descricao})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[te&&e.jsx("button",{onClick:()=>u(w),className:"p-2 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"Adicionar subcategoria",children:e.jsx(as,{size:18})}),!te&&e.jsx("span",{className:"p-2 text-gray-300 cursor-not-allowed",title:`Limite de ${m} nÃ­veis atingido`,children:e.jsx(Ca,{size:18})}),e.jsx("button",{onClick:()=>f(w),className:"p-2 text-yellow-600 hover:bg-yellow-50 rounded transition-colors",title:"Editar",children:e.jsx(Ts,{size:18})}),e.jsx("button",{onClick:()=>b(w),className:"p-2 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Excluir",children:e.jsx(Ss,{size:18})})]})]}),P&&W&&e.jsx("div",{children:w.filhos.map(A=>k(A,S+1))})]},w.id)},N=p();return s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-600",children:"Carregando categorias..."})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Categorias"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Gerencie suas categorias hierarquicamente (atÃ© ",m," nÃ­veis)"]})]}),e.jsxs("button",{onClick:h,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors",children:[e.jsx(as,{size:20}),"Nova Categoria"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:N.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Ca,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhuma categoria cadastrada"}),e.jsx("button",{onClick:h,className:"mt-4 text-blue-600 hover:text-blue-700",children:"Criar primeira categoria"})]}):e.jsx("div",{children:N.map(w=>k(w))})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:l?"Editar Categoria":v.categoria_pai_id?"Nova Subcategoria":"Nova Categoria"}),e.jsxs("form",{onSubmit:c,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",value:v.nome,onChange:w=>d({...v,nome:w.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,autoFocus:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:v.descricao,onChange:w=>d({...v,descricao:w.target.value}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ordem"}),e.jsx("input",{type:"number",value:v.ordem,onChange:w=>d({...v,ordem:parseInt(w.target.value)||0}),className:"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Menor valor aparece primeiro"})]}),v.categoria_pai_id&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx(Ca,{className:"inline mr-1"}),"Esta serÃ¡ uma subcategoria"]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{i(!1),x(null),d({nome:"",descricao:"",categoria_pai_id:null,ordem:0})},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded hover:bg-gray-300 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:l?"Salvar":"Criar"})]})]})]})})]})},gp=()=>{const[a,t]=n.useState([]),[s,o]=n.useState([]),[r,i]=n.useState(!0),[l,x]=n.useState(!1),[j,g]=n.useState(!1),[v,d]=n.useState(null),[m,C]=n.useState(null),[y,c]=n.useState(new Set),[f,b]=n.useState("todos"),[u,h]=n.useState({nome:"",tipo:"despesa",cor:"#6366f1",icone:"ðŸ“‹",descricao:"",ativo:!0,novasSubcategorias:[]}),[p,k]=n.useState({categoria_id:null,nome:"",descricao:"",ativo:!0}),N=["ðŸ’°","ðŸ’¸","ðŸ“‹","ðŸ ","âš¡","ðŸ’§","ðŸ“¡","ðŸ‘¥","ðŸ“¦","ðŸ”§","ðŸš—","ðŸ½ï¸","ðŸ“","ðŸ›¡ï¸","ðŸ›’","âœ¨","ðŸ•","ðŸ©º","ðŸ¨","ðŸŽ“"],w=["#ef4444","#f97316","#f59e0b","#84cc16","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899"];n.useEffect(()=>{S()},[]);const S=async()=>{await Promise.all([P(),W()])},P=async()=>{try{i(!0);const q=await F.get("/categorias-financeiras/");console.log("ðŸ“‚ Categorias carregadas:",q.data.length),console.log("ðŸ” Primeira categoria:",q.data[0]),t(q.data)}catch(q){console.error("Erro ao carregar categorias:",q),ce.error("Erro ao carregar categorias financeiras")}finally{i(!1)}},W=async()=>{var q,ae;try{console.log("ðŸ”„ Iniciando carregamento de subcategorias DRE...");const H=await F.get("/dre/subcategorias");console.log("âœ… Resposta recebida:",H),console.log("ðŸ“‹ Subcategorias DRE carregadas:",H.data.length),console.log("ðŸ” Primeira subcategoria:",H.data[0]),console.log("ðŸ“¦ Todas as subcategorias:",H.data),o(H.data)}catch(H){console.error("âŒ ERRO ao carregar subcategorias DRE:",H),console.error("âŒ Erro completo:",((q=H.response)==null?void 0:q.data)||H.message),console.error("âŒ Status:",(ae=H.response)==null?void 0:ae.status),o([])}},te=q=>{const ae=new Set(y);ae.has(q)?ae.delete(q):ae.add(q),c(ae)},D=q=>{if(!q.dre_subcategoria_id)return[];const ae=s.find(le=>le.id===q.dre_subcategoria_id);if(!ae)return console.log(`âš ï¸ Categoria "${q.nome}" tem dre_subcategoria_id=${q.dre_subcategoria_id} mas nÃ£o encontrada`),[];const H=s.filter(le=>le.categoria_id===ae.categoria_id);return console.log(`ðŸ“¦ Categoria "${q.nome}" â†’ ${H.length} subcategorias DRE`),H},A=async q=>{var ae,H;if(q.preventDefault(),!u.nome||!u.tipo){ce.error("Preencha nome e tipo");return}try{let le;if(v)await F.put(`/categorias-financeiras/${v}`,{nome:u.nome,tipo:u.tipo,cor:u.cor,icone:u.icone,descricao:u.descricao,ativo:u.ativo}),le=v,ce.success("Categoria atualizada com sucesso!");else if(le=(await F.post("/categorias-financeiras/",{nome:u.nome,tipo:u.tipo,cor:u.cor,icone:u.icone,descricao:u.descricao,ativo:u.ativo})).data.id,ce.success("Categoria criada com sucesso!"),u.novasSubcategorias.length>0){const ee=u.novasSubcategorias.filter(de=>de.nome.trim());for(const de of ee)try{await F.post("/subcategorias/",{categoria_id:le,nome:de.nome,descricao:de.descricao,ativo:de.ativo})}catch(ue){console.error("Erro ao criar subcategoria:",ue),ce.error(`Erro ao criar subcategoria: ${de.nome}`)}ee.length>0&&ce.success(`${ee.length} subcategoria(s) criada(s)!`)}x(!1),M(),S()}catch(le){console.error("Erro ao salvar:",le),ce.error(((H=(ae=le.response)==null?void 0:ae.data)==null?void 0:H.detail)||"Erro ao salvar categoria")}},X=async q=>{console.log(`ðŸ”§ Editando categoria "${q.nome}" (ID: ${q.id})`);const ae=D(q);console.log(`ðŸ“¦ Subcategorias DRE encontradas: ${ae.length}`,ae);const H=ae.map(le=>({id:le.id,nome:le.nome,descricao:le.descricao||"",ativo:le.ativo,tipo_custo:le.tipo_custo,escopo_rateio:le.escopo_rateio}));h({nome:q.nome,tipo:q.tipo,cor:q.cor||"#6366f1",icone:q.icone||"ðŸ“‹",descricao:q.descricao||"",ativo:q.ativo,novasSubcategorias:H}),d(q.id),x(!0)},re=async q=>{var ae,H;if(window.confirm("Deseja realmente excluir esta categoria?"))try{await F.delete(`/categorias-financeiras/${q}`),ce.success("Categoria excluÃ­da com sucesso!"),S()}catch(le){console.error("Erro ao excluir:",le),ce.error(((H=(ae=le.response)==null?void 0:ae.data)==null?void 0:H.detail)||"Erro ao excluir categoria")}},M=()=>{h({nome:"",tipo:"despesa",cor:"#6366f1",icone:"ðŸ“‹",descricao:"",ativo:!0,novasSubcategorias:[]}),d(null)},Z=(q="")=>{h({...u,novasSubcategorias:[...u.novasSubcategorias,{nome:q,descricao:"",ativo:!0}]})},$=(q,ae,H)=>{const le=[...u.novasSubcategorias];le[q][ae]=H,h({...u,novasSubcategorias:le})},J=q=>{const ae=u.novasSubcategorias.filter((H,le)=>le!==q);h({...u,novasSubcategorias:ae})},E=(q,ae)=>{q.key==="Tab"&&!q.shiftKey&&ae===u.novasSubcategorias.length-1&&(q.preventDefault(),Z())},R=()=>{k({categoria_id:null,nome:"",descricao:"",ativo:!0}),C(null)},K=async q=>{var ae,H;if(q.preventDefault(),!p.categoria_id||!p.nome){ce.error("Preencha categoria e nome");return}try{m?(await F.put(`/subcategorias/${m}`,p),ce.success("Subcategoria atualizada!")):(await F.post("/subcategorias",p),ce.success("Subcategoria criada!")),g(!1),R(),carregarSubcategorias()}catch(le){console.error("Erro ao salvar:",le),ce.error(((H=(ae=le.response)==null?void 0:ae.data)==null?void 0:H.detail)||"Erro ao salvar subcategoria")}},B=a.filter(q=>f==="todos"?!0:q.tipo===f),_=a.filter(q=>q.tipo==="despesa").length,O=a.filter(q=>q.tipo==="receita").length;return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"ðŸ·ï¸ Categorias Financeiras"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Organize suas receitas e despesas |",e.jsxs("span",{className:"text-red-600 ml-2",children:["ðŸ’¸ ",_," despesas"]}),e.jsxs("span",{className:"text-green-600 ml-2",children:["ðŸ’° ",O," receitas"]})]})]}),e.jsxs("button",{onClick:()=>{M(),x(!0)},className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:[e.jsx(as,{})," Nova Categoria"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:()=>b("todos"),className:`px-4 py-2 rounded-lg ${f==="todos"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"}`,children:["ðŸ“Š Todas (",a.length,")"]}),e.jsxs("button",{onClick:()=>b("despesa"),className:`px-4 py-2 rounded-lg ${f==="despesa"?"bg-red-600 text-white":"bg-gray-200 text-gray-700"}`,children:["ðŸ’¸ Despesas (",_,")"]}),e.jsxs("button",{onClick:()=>b("receita"),className:`px-4 py-2 rounded-lg ${f==="receita"?"bg-green-600 text-white":"bg-gray-200 text-gray-700"}`,children:["ðŸ’° Receitas (",O,")"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:r?e.jsx("div",{className:"px-6 py-8 text-center text-gray-500",children:"Carregando..."}):B.length===0?e.jsx("div",{className:"px-6 py-8 text-center text-gray-500",children:"Nenhuma categoria encontrada"}):e.jsx("div",{className:"divide-y divide-gray-200",children:B.map(q=>{const ae=D(q),H=y.has(q.id),le=ae.length>0;return e.jsxs("div",{children:[e.jsxs("div",{className:"px-6 py-4 hover:bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("button",{onClick:()=>te(q.id),className:`flex items-center justify-center w-10 h-10 rounded-lg transition-all duration-200 transform hover:scale-105 ${le?H?"text-white bg-gradient-to-r from-purple-600 to-purple-700 shadow-lg hover:shadow-xl":"text-purple-600 bg-purple-100 hover:bg-purple-200 hover:text-purple-700 shadow-md hover:shadow-lg":"text-gray-300 cursor-not-allowed bg-gray-50"}`,disabled:!le,title:le?H?"Recolher subcategorias":"Expandir subcategorias":"Sem subcategorias DRE",children:le?H?e.jsx(nt,{size:22,strokeWidth:2.5}):e.jsx(Zs,{size:22,strokeWidth:2.5}):e.jsx(Zs,{size:22})}),e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("span",{style:{backgroundColor:q.cor},className:"w-10 h-10 rounded-full flex items-center justify-center text-white text-lg",children:q.icone||"ðŸ“‹"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800",children:q.nome}),q.descricao&&e.jsx("div",{className:"text-sm text-gray-500",children:q.descricao})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${q.tipo==="receita"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:q.tipo==="receita"?"ðŸ’° Receita":"ðŸ’¸ Despesa"}),le&&e.jsxs("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-medium flex items-center gap-1",children:[e.jsx("span",{children:"ðŸ“Š DRE"}),e.jsx("span",{className:"bg-purple-200 text-purple-900 px-1.5 rounded-full font-bold",children:ae.length})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>X(q),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-md",title:"Editar",children:e.jsx(Ts,{size:18})}),e.jsx("button",{onClick:()=>re(q.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-md",title:"Excluir",children:e.jsx(Ss,{size:18})})]})]}),H&&e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 border-t border-purple-100",children:le?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-6 py-2 bg-purple-100/50 border-b border-purple-200",children:e.jsxs("span",{className:"text-xs font-semibold text-purple-700 uppercase tracking-wide",children:["ðŸ—ï¸ Subcategorias DRE (",ae.length,")"]})}),ae.map(G=>e.jsxs("div",{className:"px-6 py-3 flex items-center gap-4 ml-9",children:[e.jsx("span",{className:"text-purple-400 text-lg",children:"â””â”€"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:G.nome}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500 bg-white px-2 py-0.5 rounded",children:G.tipo_custo}),G.escopo_rateio&&e.jsx("span",{className:"text-xs text-gray-500 bg-white px-2 py-0.5 rounded",children:G.escopo_rateio})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${G.ativo?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"}`,children:G.ativo?"âœ“ Ativo":"âœ— Inativo"})]},G.id))]}):e.jsx("div",{className:"px-6 py-4 ml-9 text-center",children:e.jsxs("div",{className:"text-gray-400 text-sm",children:[e.jsx("div",{className:"mb-2",children:"ðŸ“­"}),e.jsx("div",{className:"font-medium",children:"Nenhuma subcategoria DRE cadastrada"}),e.jsx("div",{className:"text-xs mt-1",children:"Configure subcategorias no mÃ³dulo DRE"})]})})})]},q.id)})})}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full m-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("h3",{className:"text-xl font-bold",children:v?"Editar Categoria":"Nova Categoria"}),e.jsx("button",{onClick:()=>{x(!1),M()},className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),e.jsxs("form",{onSubmit:A,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",value:u.nome,onChange:q=>h({...u,nome:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo *"}),e.jsxs("select",{value:u.tipo,onChange:q=>h({...u,tipo:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"despesa",children:"ðŸ’¸ Despesa"}),e.jsx("option",{value:"receita",children:"ðŸ’° Receita"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ãcone"}),e.jsx("select",{value:u.icone,onChange:q=>h({...u,icone:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:N.map(q=>e.jsx("option",{value:q,children:q},q))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cor"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:u.cor,onChange:q=>h({...u,cor:q.target.value}),className:"w-12 h-10 border border-gray-300 rounded-md"}),e.jsx("select",{value:u.cor,onChange:q=>h({...u,cor:q.target.value}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:w.map(q=>e.jsx("option",{value:q,children:q},q))})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:u.descricao,onChange:q=>h({...u,descricao:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",rows:"3"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"ativo",checked:u.ativo,onChange:q=>h({...u,ativo:q.target.checked}),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("label",{htmlFor:"ativo",className:"text-sm text-gray-700",children:"Categoria ativa"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subcategorias DRE (opcional)"}),e.jsxs("button",{type:"button",onClick:()=>Z(),className:"text-sm text-purple-600 hover:text-purple-800 flex items-center gap-1",children:[e.jsx(as,{size:14})," Adicionar"]})]}),u.novasSubcategorias.length>0&&e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:u.novasSubcategorias.map((q,ae)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-md",children:[e.jsx("input",{type:"text",value:q.nome,onChange:H=>$(ae,"nome",H.target.value),onKeyDown:H=>E(H,ae),placeholder:"Nome da subcategoria (Tab para adicionar mais)",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>J(ae),className:"text-red-600 hover:text-red-800 p-1",title:"Remover",children:e.jsx(Ss,{size:16})})]},ae))}),u.novasSubcategorias.length===0&&e.jsx("p",{className:"text-sm text-gray-500 italic",children:'Clique em "Adicionar" ou crie a categoria primeiro e depois adicione subcategorias'})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{x(!1),M()},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:v?"Atualizar":"Criar"})]})]})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:m?"Editar Subcategoria DRE":"Nova Subcategoria DRE"}),p.categoria_id&&a.find(q=>q.id===p.categoria_id)&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-md border border-blue-200",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Categoria: "}),e.jsx("span",{className:"font-semibold text-gray-800",children:a.find(q=>q.id===p.categoria_id).nome})]}),e.jsxs("form",{onSubmit:K,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Subcategoria *"}),e.jsx("input",{type:"text",value:p.nome,onChange:q=>k({...p,nome:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:p.descricao,onChange:q=>k({...p,descricao:q.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",rows:"3"})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:p.ativo,onChange:q=>k({...p,ativo:q.target.checked}),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Ativo"})]})}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{g(!1),R()},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:m?"Atualizar":"Criar"})]})]})]})})]})},hp=()=>{const[a,t]=n.useState([]),[s,o]=n.useState(!0),[r,i]=n.useState(new Set),[l,x]=n.useState(!1),[j,g]=n.useState(!1),[v,d]=n.useState(null),[m,C]=n.useState(null),[y,c]=n.useState(null),[f,b]=n.useState(""),[u,h]=n.useState(""),[p,k]=n.useState({nome:"",ativo:!0}),[N,w]=n.useState({nome:"",especie_id:"",ativo:!0});n.useEffect(()=>{S()},[]);const S=async()=>{try{o(!0);const[J,E]=await Promise.all([F.get("/cadastros/especies"),F.get("/cadastros/racas")]),R=J.data.map(B=>({...B,racas:E.data.filter(_=>_.especie_id===B.id)}));t(R);const K=new Set(R.map(B=>B.id));i(K)}catch(J){console.error("Erro ao carregar dados:",J),b("Erro ao carregar dados")}finally{o(!1)}},P=J=>{const E=new Set(r);E.has(J)?E.delete(J):E.add(J),i(E)},W=(J=null)=>{J?(d(J),k({nome:J.nome,ativo:J.ativo})):(d(null),k({nome:"",ativo:!0})),b(""),x(!0)},te=()=>{x(!1),d(null),k({nome:"",ativo:!0}),b("")},D=async J=>{var E,R;if(J.preventDefault(),b(""),!p.nome||p.nome.trim()===""){b("O nome da espÃ©cie Ã© obrigatÃ³rio");return}try{v?await F.put(`/cadastros/especies/${v.id}`,p):await F.post("/cadastros/especies",p),S(),te()}catch(K){console.error("Erro ao salvar espÃ©cie:",K),b(((R=(E=K.response)==null?void 0:E.data)==null?void 0:R.detail)||"Erro ao salvar espÃ©cie")}},A=async J=>{var E,R;if(window.confirm(`Deseja realmente desativar a espÃ©cie "${J.nome}"?

Isso tambÃ©m desativarÃ¡ todas as raÃ§as vinculadas.`))try{await F.delete(`/cadastros/especies/${J.id}`),S()}catch(K){console.error("Erro ao desativar espÃ©cie:",K),alert(((R=(E=K.response)==null?void 0:E.data)==null?void 0:R.detail)||"Erro ao desativar espÃ©cie")}},X=(J,E=null)=>{c(J),E?(C(E),w({nome:E.nome,especie_id:E.especie_id,ativo:E.ativo})):(C(null),w({nome:"",especie_id:J.id,ativo:!0})),b(""),g(!0)},re=()=>{g(!1),C(null),c(null),w({nome:"",especie_id:"",ativo:!0}),b("")},M=async J=>{var E,R;if(J.preventDefault(),b(""),!N.nome||N.nome.trim()===""){b("O nome da raÃ§a Ã© obrigatÃ³rio");return}try{const K={nome:N.nome,especie_id:parseInt(N.especie_id),ativo:N.ativo};m?await F.put(`/cadastros/racas/${m.id}`,K):await F.post("/cadastros/racas",K),S(),re()}catch(K){console.error("Erro ao salvar raÃ§a:",K),b(((R=(E=K.response)==null?void 0:E.data)==null?void 0:R.detail)||"Erro ao salvar raÃ§a")}},Z=async J=>{var E,R;if(window.confirm(`Deseja realmente desativar a raÃ§a "${J.nome}"?`))try{await F.delete(`/cadastros/racas/${J.id}`),S()}catch(K){console.error("Erro ao desativar raÃ§a:",K),alert(((R=(E=K.response)==null?void 0:E.data)==null?void 0:R.detail)||"Erro ao desativar raÃ§a")}},$=a.filter(J=>J.nome.toLowerCase().includes(u.toLowerCase())||J.racas.some(E=>E.nome.toLowerCase().includes(u.toLowerCase())));return s?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Carregando espÃ©cies e raÃ§as..."})]}):e.jsxs("div",{className:"cadastros-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"EspÃ©cies e RaÃ§as"}),e.jsx("p",{className:"page-subtitle",children:"Gerencie as espÃ©cies de animais e suas raÃ§as"})]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>W(),children:[e.jsx(as,{})," Nova EspÃ©cie"]})]}),e.jsxs("div",{className:"filters-bar",children:[e.jsx("input",{type:"text",placeholder:"Buscar espÃ©cie ou raÃ§a...",value:u,onChange:J=>h(J.target.value),className:"search-input"}),e.jsxs("div",{className:"filter-info",children:[$.length," espÃ©cie",$.length!==1?"s":""]})]}),e.jsx("div",{className:"especies-list",children:$.length===0?e.jsx("div",{className:"empty-state",children:u?"Nenhuma espÃ©cie ou raÃ§a encontrada":"Nenhuma espÃ©cie cadastrada"}):$.map(J=>{const E=r.has(J.id),R=J.racas.filter(K=>K.ativo);return e.jsxs("div",{className:`especie-card ${J.ativo?"":"inactive"}`,children:[e.jsxs("div",{className:"especie-header",children:[e.jsxs("div",{className:"especie-info",onClick:()=>P(J.id),children:[e.jsx("button",{className:"expand-btn",children:E?e.jsx(nt,{size:20}):e.jsx(Zs,{size:20})}),e.jsx($a,{className:"especie-icon",size:24}),e.jsxs("div",{children:[e.jsx("h3",{className:"especie-nome",children:J.nome}),e.jsxs("span",{className:"racas-count",children:[R.length," raÃ§a",R.length!==1?"s":""," ativa",R.length!==1?"s":""]})]}),!J.ativo&&e.jsx("span",{className:"badge badge-danger",children:"Inativa"})]}),e.jsxs("div",{className:"especie-actions",children:[e.jsx("button",{className:"btn-icon btn-success",onClick:()=>X(J),title:"Adicionar RaÃ§a",children:e.jsx(as,{})}),e.jsx("button",{className:"btn-icon btn-edit",onClick:()=>W(J),title:"Editar EspÃ©cie",children:e.jsx(Ts,{})}),J.ativo&&e.jsx("button",{className:"btn-icon btn-delete",onClick:()=>A(J),title:"Desativar EspÃ©cie",children:e.jsx(Ss,{})})]})]}),E&&e.jsx("div",{className:"racas-list",children:J.racas.length===0?e.jsxs("div",{className:"empty-racas",children:[e.jsx("p",{children:"Nenhuma raÃ§a cadastrada ainda"}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>X(J),children:[e.jsx(as,{})," Adicionar Primeira RaÃ§a"]})]}):e.jsx(e.Fragment,{children:J.racas.map(K=>e.jsxs("div",{className:`raca-item ${K.ativo?"":"inactive"}`,children:[e.jsxs("div",{className:"raca-info",children:[e.jsx(Wt,{className:"raca-icon",size:16}),e.jsx("span",{className:"raca-nome",children:K.nome}),!K.ativo&&e.jsx("span",{className:"badge badge-sm badge-danger",children:"Inativa"})]}),e.jsxs("div",{className:"raca-actions",children:[e.jsx("button",{className:"btn-icon-sm btn-edit",onClick:()=>X(J,K),title:"Editar RaÃ§a",children:e.jsx(Ts,{size:14})}),K.ativo&&e.jsx("button",{className:"btn-icon-sm btn-delete",onClick:()=>Z(K),title:"Desativar RaÃ§a",children:e.jsx(Ss,{size:14})})]})]},K.id))})})]},J.id)})}),l&&e.jsx("div",{className:"modal-overlay",onClick:te,children:e.jsxs("div",{className:"modal-content",onClick:J=>J.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:v?"Editar EspÃ©cie":"Nova EspÃ©cie"}),e.jsx("button",{className:"btn-close",onClick:te,children:e.jsx(ks,{})})]}),e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"modal-body",children:[f&&e.jsxs("div",{className:"alert alert-danger",children:[e.jsx(Ca,{})," ",f]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nome da EspÃ©cie *"}),e.jsx("input",{type:"text",value:p.nome,onChange:J=>k({...p,nome:J.target.value}),placeholder:"Ex: CÃ£o, Gato, Ave, RÃ©ptil...",required:!0,autoFocus:!0}),e.jsx("small",{children:"Exemplos: CÃ£o, Gato, Ave, RÃ©ptil, Coelho, Peixe, Hamster"})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:p.ativo,onChange:J=>k({...p,ativo:J.target.checked})}),e.jsx("span",{children:"EspÃ©cie ativa"})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:te,children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"btn btn-primary",children:[e.jsx(st,{})," Salvar"]})]})]})]})}),j&&e.jsx("div",{className:"modal-overlay",onClick:re,children:e.jsxs("div",{className:"modal-content",onClick:J=>J.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[m?"Editar RaÃ§a":"Nova RaÃ§a",y&&e.jsxs("span",{className:"subtitle",children:[" - ",y.nome]})]}),e.jsx("button",{className:"btn-close",onClick:re,children:e.jsx(ks,{})})]}),e.jsxs("form",{onSubmit:M,children:[e.jsxs("div",{className:"modal-body",children:[f&&e.jsxs("div",{className:"alert alert-danger",children:[e.jsx(Ca,{})," ",f]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nome da RaÃ§a *"}),e.jsx("input",{type:"text",value:N.nome,onChange:J=>w({...N,nome:J.target.value}),placeholder:"Ex: Labrador, SiamÃªs, SRD...",required:!0,autoFocus:!0}),e.jsx("small",{children:"Exemplos: Labrador, Golden Retriever, SRD (Sem RaÃ§a Definida)"})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:N.ativo,onChange:J=>w({...N,ativo:J.target.checked})}),e.jsx("span",{children:"RaÃ§a ativa"})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:re,children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"btn btn-primary",children:[e.jsx(st,{})," Salvar"]})]})]})]})})]})},bp=()=>{var M,Z,$,J;const{clienteId:a}=lt(),t=va(),[s,o]=n.useState(null),[r,i]=n.useState(null),[l,x]=n.useState([]),[j,g]=n.useState(null),[v,d]=n.useState(!0),[m,C]=n.useState(""),[y,c]=n.useState({}),[f,b]=n.useState({}),[u,h]=n.useState({}),[p,k]=n.useState({page:1,per_page:20,data_inicio:"",data_fim:"",tipo:"",status:""});n.useEffect(()=>{a&&N()},[a,p]);const N=async()=>{var E,R;try{d(!0),C("");const K=new URLSearchParams;K.append("page",p.page),K.append("per_page",p.per_page),p.data_inicio&&K.append("data_inicio",p.data_inicio),p.data_fim&&K.append("data_fim",p.data_fim),p.tipo&&K.append("tipo",p.tipo),p.status&&K.append("status",p.status);const B=await F.get(`/financeiro/cliente/${a}?${K.toString()}`);o(B.data.cliente),i(B.data.resumo),x(B.data.historico),g(B.data.paginacao)}catch(K){console.error("Erro ao carregar histÃ³rico financeiro:",K),C(((R=(E=K.response)==null?void 0:E.data)==null?void 0:R.detail)||"Erro ao carregar histÃ³rico financeiro")}finally{d(!1)}},w=E=>{k({...p,page:E})},S=E=>{k({...p,...E,page:1})},P=()=>{k({page:1,per_page:20,data_inicio:"",data_fim:"",tipo:"",status:""})},W=async(E,R)=>{var B,_;const K=`${E.tipo}-${R}`;if(y[K]){c({...y,[K]:!1});return}c({...y,[K]:!0}),E.tipo==="venda"&&!f[(B=E.detalhes)==null?void 0:B.venda_id]&&await te((_=E.detalhes)==null?void 0:_.venda_id)},te=async E=>{if(E)try{h({...u,[E]:!0});const R=await F.get(`/vendas/${E}`);b({...f,[E]:R.data})}catch(R){console.error("Erro ao carregar detalhes da venda:",R)}finally{h({...u,[E]:!1})}},D=E=>{E&&t(`/pdv?venda=${E}`)},A=E=>{switch(E){case"venda":return"ðŸ›’";case"devolucao":return"â†©ï¸";case"conta_receber":return"ðŸ“„";case"recebimento":return"ðŸ’°";case"credito":return"ðŸ’³";default:return"ðŸ“Š"}},X=E=>{switch(E){case"venda":return"Venda";case"devolucao":return"DevoluÃ§Ã£o";case"conta_receber":return"Conta a Receber";case"recebimento":return"Recebimento";case"credito":return"CrÃ©dito";default:return E}},re=E=>({finalizada:"bg-green-100 text-green-700",concluida:"bg-green-100 text-green-700",pendente:"bg-yellow-100 text-yellow-700",paga:"bg-blue-100 text-blue-700",cancelada:"bg-red-100 text-red-700",devolvida:"bg-red-100 text-red-700",efetivado:"bg-green-100 text-green-700"})[E]||"bg-gray-100 text-gray-700";return v&&!l.length?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando histÃ³rico financeiro..."})]})}):m?e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-red-50 border border-red-300 rounded-xl p-6 text-center",children:[e.jsx(Ca,{className:"text-red-600 text-4xl mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Erro ao Carregar Dados"}),e.jsx("p",{className:"text-red-600 mb-4",children:m}),e.jsx("button",{onClick:()=>t("/clientes"),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Voltar para Clientes"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>t("/clientes"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4 transition-colors",children:[e.jsx(wt,{}),e.jsx("span",{className:"font-medium",children:"Voltar para Clientes"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(Lr,{className:"text-purple-600"}),"HistÃ³rico Financeiro"]}),s&&e.jsxs("p",{className:"text-lg text-gray-600 mt-2 flex items-center gap-2",children:[e.jsx(vs,{className:"text-gray-400"}),s.nome,e.jsxs("span",{className:"text-sm text-gray-400",children:["(",s.codigo,")"]})]})]}),r&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 border border-purple-200 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"CrÃ©dito DisponÃ­vel"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["R$ ",((M=s.credito_atual)==null?void 0:M.toFixed(2).replace(".",","))||"0,00"]})]})]})]}),r&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Total Vendas (90d)"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["R$ ",((Z=r.total_vendas_90d)==null?void 0:Z.toFixed(2).replace(".",","))||"0,00"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Total em Aberto"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:["R$ ",(($=r.total_em_aberto)==null?void 0:$.toFixed(2).replace(".",","))||"0,00"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Ãšltima Compra"}),r.ultima_compra?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["R$ ",((J=r.ultima_compra.valor)==null?void 0:J.toFixed(2).replace(".",","))||"0,00"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(r.ultima_compra.data).toLocaleDateString("pt-BR")})]}):e.jsx("p",{className:"text-sm text-gray-400",children:"Nenhuma compra"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Total TransaÃ§Ãµes"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:r.total_transacoes_historico||0})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 mb-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-md font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Eo,{}),"Filtros"]}),e.jsx("button",{onClick:P,className:"text-sm text-gray-600 hover:text-gray-900 underline",children:"Limpar filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:[e.jsx(ps,{className:"inline mr-1"}),"Data InÃ­cio"]}),e.jsx("input",{type:"date",value:p.data_inicio,onChange:E=>S({data_inicio:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:[e.jsx(ps,{className:"inline mr-1"}),"Data Fim"]}),e.jsx("input",{type:"date",value:p.data_fim,onChange:E=>S({data_fim:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:p.tipo,onChange:E=>S({tipo:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todas as transaÃ§Ãµes"}),e.jsx("option",{value:"venda",children:"ðŸ›’ Vendas"}),e.jsx("option",{value:"devolucao",children:"â†©ï¸ DevoluÃ§Ãµes"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:p.status,onChange:E=>S({status:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todos os status"}),e.jsx("option",{value:"aberta",children:"ðŸ“‹ Em Aberto"}),e.jsx("option",{value:"finalizada",children:"âœ… Finalizada (Paga)"}),e.jsx("option",{value:"cancelada",children:"âŒ Cancelada"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Por pÃ¡gina"}),e.jsxs("select",{value:p.per_page,onChange:E=>S({per_page:parseInt(E.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]})]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:v?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Atualizando..."})]}):l.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"DescriÃ§Ã£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map((E,R)=>{var q,ae,H,le,G;const K=`${E.tipo}-${R}`,B=y[K],_=(q=E.detalhes)==null?void 0:q.venda_id,O=_?f[_]:null;return e.jsxs(ms.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("button",{onClick:()=>W(E,R),className:"text-gray-600 hover:text-purple-600 transition-colors",children:B?e.jsx(cl,{size:18}):e.jsx(nt,{size:18})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:E.data?new Date(E.data).toLocaleDateString("pt-BR"):"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"inline-flex items-center gap-1 text-sm font-medium",children:[e.jsx("span",{className:"text-xl",children:A(E.tipo)}),X(E.tipo)]})}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-md",children:[e.jsx("div",{className:"truncate",children:E.descricao}),((ae=E.detalhes)==null?void 0:ae.numero_venda)&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["#",E.detalhes.numero_venda]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:e.jsxs("span",{className:`font-bold ${E.valor<0?"text-red-600":"text-green-600"}`,children:[E.valor<0?"- ":"+ ","R$ ",Math.abs(E.valor).toFixed(2).replace(".",",")]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${re(E.status)}`,children:E.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:E.tipo==="venda"&&_&&e.jsxs("button",{onClick:()=>D(_),className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded-lg transition-colors flex items-center gap-1 mx-auto",children:[e.jsx(Nt,{size:14}),"Ver no PDV"]})})]}),B&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-4 bg-gray-50",children:E.tipo==="venda"&&_?u[_]?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Carregando detalhes..."})]}):O?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 pb-3",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Nt,{className:"text-blue-600"}),"Detalhes da Venda #",O.numero_venda]}),e.jsx("div",{className:"text-sm text-gray-600",children:new Date(O.data_venda).toLocaleString("pt-BR")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 bg-white rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"ðŸ’° Total da Venda"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["R$ ",(H=O.total)==null?void 0:H.toFixed(2).replace(".",",")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"ðŸ“¦ Total de Itens"}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:((le=O.itens)==null?void 0:le.length)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"ðŸŽ¯ Desconto Total"}),e.jsxs("p",{className:"text-xl font-bold text-orange-600",children:["R$ ",(O.desconto||0).toFixed(2).replace(".",",")]})]})]}),O.itens&&O.itens.length>0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-blue-50 px-4 py-2 border-b border-gray-200",children:e.jsxs("h5",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Zt,{className:"text-blue-600"}),"Produtos Vendidos"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:"Produto"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-500",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"PreÃ§o Unit."}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Desc. %"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Desc. R$"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Subtotal"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:O.itens.map((ee,de)=>{var ue,Ae;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:ee.produto_nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-center font-semibold text-gray-700",children:ee.quantidade}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-gray-700",children:["R$ ",(ue=ee.preco_unitario)==null?void 0:ue.toFixed(2).replace(".",",")]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-orange-600",children:[ee.desconto_percentual||0,"%"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-orange-600",children:["R$ ",(ee.desconto||0).toFixed(2).replace(".",",")]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right font-bold text-green-600",children:["R$ ",(Ae=ee.subtotal)==null?void 0:Ae.toFixed(2).replace(".",",")]})]},de)})}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Total Geral:"}),e.jsxs("td",{className:"px-4 py-3 text-right text-lg font-bold text-green-600",children:["R$ ",(G=O.total)==null?void 0:G.toFixed(2).replace(".",",")]})]})})]})})]}),O.observacoes&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-yellow-800 mb-1",children:"ðŸ“ ObservaÃ§Ãµes:"}),e.jsx("p",{className:"text-sm text-gray-700",children:O.observacoes})]})]}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"NÃ£o foi possÃ­vel carregar os detalhes da venda"})}):e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("h5",{className:"font-semibold text-gray-800 mb-3",children:"Detalhes da TransaÃ§Ã£o"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 text-sm",children:Object.entries(E.detalhes||{}).map(([ee,de])=>e.jsxs("div",{className:"flex justify-between border-b border-gray-100 pb-2",children:[e.jsxs("span",{className:"text-gray-600 capitalize",children:[ee.replace(/_/g," "),":"]}),e.jsx("span",{className:"font-semibold text-gray-900",children:typeof de=="number"?`R$ ${de.toFixed(2).replace(".",",")}`:(de==null?void 0:de.toString())||"N/A"})]},ee))})]})})})]},K)})})]})}),j&&j.total_paginas>1&&e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",(j.pagina_atual-1)*j.itens_por_pagina+1," a"," ",Math.min(j.pagina_atual*j.itens_por_pagina,j.total_itens)," de"," ",j.total_itens," transaÃ§Ãµes"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>w(j.pagina_atual-1),disabled:!j.tem_anterior,className:`px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${j.tem_anterior?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[e.jsx(fl,{}),"Anterior"]}),e.jsxs("span",{className:"px-4 py-2 text-sm text-gray-700",children:["PÃ¡gina ",j.pagina_atual," de ",j.total_paginas]}),e.jsxs("button",{onClick:()=>w(j.pagina_atual+1),disabled:!j.tem_proxima,className:`px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${j.tem_proxima?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:["PrÃ³xima",e.jsx(Zs,{})]})]})]})})]}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx(es,{className:"text-gray-300 text-6xl mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Nenhuma transaÃ§Ã£o encontrada"}),e.jsx("p",{className:"text-gray-500 mb-6",children:p.tipo||p.status||p.data_inicio||p.data_fim?"Tente ajustar os filtros para ver mais resultados":"Ainda nÃ£o hÃ¡ transaÃ§Ãµes financeiras para este cliente"}),(p.tipo||p.status||p.data_inicio||p.data_fim)&&e.jsx("button",{onClick:P,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Limpar Filtros"})]})})]})})},fp={vips_inativos:{titulo:"VIPs em Risco",descricao:"Clientes VIP sem compra hÃ¡ mais de 20 dias",icone:tl,cor:"red",bgGradient:"from-red-500 to-red-600",bgLight:"bg-red-50",borderLight:"border-red-200",textColor:"text-red-700"},clientes_inativos:{titulo:"Clientes Inativos",descricao:"Sem compra hÃ¡ mais de 90 dias",icone:et,cor:"orange",bgGradient:"from-orange-500 to-orange-600",bgLight:"bg-orange-50",borderLight:"border-orange-200",textColor:"text-orange-700"},clientes_endividados:{titulo:"Alto Endividamento",descricao:"Clientes com saldo devedor significativo",icone:es,cor:"yellow",bgGradient:"from-yellow-500 to-yellow-600",bgLight:"bg-yellow-50",borderLight:"border-yellow-200",textColor:"text-yellow-700"},oportunidades_novos:{titulo:"Novos Promissores",descricao:"Clientes novos com ticket alto",icone:ot,cor:"green",bgGradient:"from-green-500 to-green-600",bgLight:"bg-green-50",borderLight:"border-green-200",textColor:"text-green-700"},pets_sem_eventos:{titulo:"Pets Inativos",descricao:"Sem consulta hÃ¡ mais de 60 dias",icone:So,cor:"purple",bgGradient:"from-purple-500 to-purple-600",bgLight:"bg-purple-50",borderLight:"border-purple-200",textColor:"text-purple-700"},whatsapp_inativo:{titulo:"WhatsApp Faltando",descricao:"Clientes sem nÃºmero cadastrado",icone:Ls,cor:"blue",bgGradient:"from-blue-500 to-blue-600",bgLight:"bg-blue-50",borderLight:"border-blue-200",textColor:"text-blue-700"}};function gt({tipo:a,dados:t,onClick:s}){const o=fp[a],r=(o==null?void 0:o.icone)||at,i=t||{quantidade:0,impacto:null};return e.jsxs("div",{className:`${o.bgLight} border-2 ${o.borderLight} rounded-xl p-6 hover:shadow-lg transition-all cursor-pointer`,onClick:s,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`p-3 bg-gradient-to-br ${o.bgGradient} rounded-lg`,children:e.jsx(r,{className:"text-white",size:24})}),e.jsx(Mr,{className:o.textColor,size:20})]}),e.jsx("h3",{className:`text-2xl font-bold ${o.textColor} mb-1`,children:(i==null?void 0:i.quantidade)??0}),e.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:o.titulo}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:o.descricao}),(i==null?void 0:i.impacto)&&e.jsx("div",{className:"pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Impacto estimado:"}),e.jsx("span",{className:`font-bold ${o.textColor}`,children:i.impacto})]})}),e.jsxs("button",{className:`mt-3 w-full py-2 text-sm font-medium ${o.textColor} hover:bg-white rounded-lg transition-colors flex items-center justify-center gap-2`,children:["Ver detalhes",e.jsx(Mr,{size:14})]})]})}function jp(){var d,m,C,y,c;const a=va(),[t,s]=n.useState(!0),[o,r]=n.useState(null),[i,l]=n.useState(null);n.useEffect(()=>{x()},[]);const x=async()=>{var f;try{s(!0);const[b,u]=await Promise.all([F.get("/clientes/"),F.get("/segmentacao/estatisticas")]),h=b==null?void 0:b.data,p=Array.isArray(h)?h:Array.isArray(h==null?void 0:h.data)?h.data:[],N=(u==null?void 0:u.data)||{};console.log("ðŸ“Š [Dashboard] Clientes carregados:",p.length);const w=j(p,N);r(w),l(new Date)}catch(b){console.error("Erro ao carregar dashboard:",b),r({vips_inativos:{quantidade:0,clientes:[],impacto:"R$ 0"},clientes_inativos:{quantidade:0,clientes:[],diasMedia:0},clientes_novos:{quantidade:0,clientes:[]},oportunidades_upsell:{quantidade:0,clientes:[],potencial:"R$ 0"},clientes_risco_churn:{quantidade:0,clientes:[],diasMedia:0}}),((f=b.response)==null?void 0:f.status)===403?alert("VocÃª nÃ£o tem permissÃ£o para acessar o dashboard gerencial"):alert("Erro ao carregar dashboard gerencial")}finally{s(!1)}},j=(f,b)=>{const u=new Date,p=(Array.isArray(f)?f:[]).filter(Z=>(Z==null?void 0:Z.tipo_cadastro)==="cliente"),k=p.filter(Z=>{const $=(Z==null?void 0:Z.segmento)||"Regular",J=(Z==null?void 0:Z.dias_desde_ultima_compra)??999;return $==="VIP"&&J>20}),N=k.reduce((Z,$)=>Z+(($==null?void 0:$.total_90d)??0),0),w=p.filter(Z=>((Z==null?void 0:Z.dias_desde_ultima_compra)??0)>90),S=w.reduce((Z,$)=>Z+(($==null?void 0:$.total_historico)??0),0),P=p.filter(Z=>((Z==null?void 0:Z.saldo_devedor)??0)>0),W=P.reduce((Z,$)=>Z+(($==null?void 0:$.saldo_devedor)??0),0),te=p.filter(Z=>{const $=(Z==null?void 0:Z.segmento)||"Regular",J=(Z==null?void 0:Z.ticket_medio)??0;return $==="Novo"&&J>200}),D=te.reduce((Z,$)=>Z+(($==null?void 0:$.ticket_medio)??0),0),A=p.filter(Z=>Array.isArray(Z==null?void 0:Z.pets)&&Z.pets.length>0);let X=0,re=[];A.forEach(Z=>{const $=Array.isArray(Z==null?void 0:Z.pets)?Z.pets:[];if($.length>0){const J=$.filter(E=>{if(!(E!=null&&E.ultima_consulta))return!0;const R=new Date(E.ultima_consulta);return Math.floor((u-R)/(1e3*60*60*24))>60});J.length>0&&(X+=J.length,re.push(Z))}});const M=p.filter(Z=>!(Z!=null&&Z.celular)||Z.celular.trim()==="");return{vips_inativos:{quantidade:(k==null?void 0:k.length)??0,impacto:`R$ ${(N??0).toFixed(2)}`,clientes:k},clientes_inativos:{quantidade:(w==null?void 0:w.length)??0,impacto:`R$ ${((S??0)/12).toFixed(2)}/mÃªs`,clientes:w},clientes_endividados:{quantidade:(P==null?void 0:P.length)??0,impacto:`R$ ${(W??0).toFixed(2)}`,clientes:P},oportunidades_novos:{quantidade:(te==null?void 0:te.length)??0,impacto:`~R$ ${(D??0).toFixed(0)}/mÃªs`,clientes:te},pets_sem_eventos:{quantidade:X??0,impacto:`${(re==null?void 0:re.length)??0} donos`,clientes:re},whatsapp_inativo:{quantidade:(M==null?void 0:M.length)??0,impacto:"Canal perdido",clientes:M},total_clientes:(p==null?void 0:p.length)??0,estatisticas:b??{}}},g=f=>{a("/pessoas",{state:{filtro:f}})},v=()=>{x()};return t?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Carregando dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-6",children:[e.jsx("div",{className:"max-w-7xl mx-auto mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:"ðŸ“Š Dashboard Gerencial"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["VisÃ£o executiva do negÃ³cio â€¢ ",(o==null?void 0:o.total_clientes)||0," clientes ativos"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[i&&e.jsxs("div",{className:"text-sm text-gray-500",children:["Atualizado Ã s ",i.toLocaleTimeString("pt-BR")]}),e.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:[e.jsx(Ut,{size:18}),"Atualizar"]})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(gt,{tipo:"vips_inativos",dados:(o==null?void 0:o.vips_inativos)||{quantidade:0,impacto:"R$ 0",clientes:[]},onClick:()=>g("vips_inativos")}),e.jsx(gt,{tipo:"clientes_inativos",dados:(o==null?void 0:o.clientes_inativos)||{quantidade:0,impacto:"R$ 0",clientes:[]},onClick:()=>g("clientes_inativos")}),e.jsx(gt,{tipo:"clientes_endividados",dados:(o==null?void 0:o.clientes_endividados)||{quantidade:0,impacto:"R$ 0",clientes:[]},onClick:()=>g("clientes_endividados")}),e.jsx(gt,{tipo:"oportunidades_novos",dados:(o==null?void 0:o.oportunidades_novos)||{quantidade:0,impacto:"R$ 0",clientes:[]},onClick:()=>g("oportunidades_novos")}),e.jsx(gt,{tipo:"pets_sem_eventos",dados:(o==null?void 0:o.pets_sem_eventos)||{quantidade:0,impacto:"0 donos",clientes:[]},onClick:()=>g("pets_sem_eventos")}),e.jsx(gt,{tipo:"whatsapp_inativo",dados:(o==null?void 0:o.whatsapp_inativo)||{quantidade:0,impacto:"Canal perdido",clientes:[]},onClick:()=>g("whatsapp_inativo")})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(at,{className:"text-blue-600",size:24}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Resumo Executivo"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"border-l-4 border-red-500 pl-4",children:[e.jsx("h3",{className:"font-semibold text-red-700 mb-2",children:"ðŸš¨ AÃ§Ã£o Urgente"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("strong",{children:((d=o==null?void 0:o.vips_inativos)==null?void 0:d.quantidade)??0})," clientes VIP em risco de churn"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Contate imediatamente para evitar perda de ",((m=o==null?void 0:o.vips_inativos)==null?void 0:m.impacto)??"R$ 0"," em receita"]})]}),e.jsxs("div",{className:"border-l-4 border-yellow-500 pl-4",children:[e.jsx("h3",{className:"font-semibold text-yellow-700 mb-2",children:"âš ï¸ AtenÃ§Ã£o"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("strong",{children:((C=o==null?void 0:o.clientes_endividados)==null?void 0:C.quantidade)??0})," clientes endividados"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Total de ",((y=o==null?void 0:o.clientes_endividados)==null?void 0:y.impacto)??"R$ 0"," em aberto â€¢ Avaliar condiÃ§Ãµes"]})]}),e.jsxs("div",{className:"border-l-4 border-green-500 pl-4",children:[e.jsx("h3",{className:"font-semibold text-green-700 mb-2",children:"ðŸ’¡ Oportunidade"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("strong",{children:((c=o==null?void 0:o.oportunidades_novos)==null?void 0:c.quantidade)??0})," novos clientes promissores"]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Potencial de fidelizaÃ§Ã£o â€¢ Ticket mÃ©dio alto"})]})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(at,{size:12}),"Dados calculados em tempo real com base em regras de negÃ³cio prÃ©-definidas"]})})]})]})]})}function vp(){const[a,t]=n.useState([]),[s,o]=n.useState([]),[r,i]=n.useState(!0),[l,x]=n.useState(!1),[j,g]=n.useState(!1),[v,d]=n.useState({email:"",password:"",role_id:null});async function m(){try{i(!0);const f=await F.get("/usuarios");t(f.data)}catch(f){console.error("Erro ao carregar usuÃ¡rios:",f),alert("Erro ao carregar usuÃ¡rios")}finally{i(!1)}}async function C(){try{const f=await F.get("/roles");o(f.data)}catch(f){console.error("Erro ao carregar roles:",f)}}async function y(f,b){try{await F.patch(`/usuarios/${f}/status`,{is_active:!b}),m()}catch(u){console.error("Erro ao alterar status:",u),alert("Erro ao alterar status do usuÃ¡rio")}}async function c(f){var b,u;f.preventDefault();try{await F.post("/usuarios",v),alert("UsuÃ¡rio criado com sucesso!"),x(!1),d({email:"",password:"",role_id:null}),m()}catch(h){console.error("Erro ao criar usuÃ¡rio:",h),alert(((u=(b=h.response)==null?void 0:b.data)==null?void 0:u.detail)||"Erro ao criar usuÃ¡rio")}}return n.useEffect(()=>{m(),C()},[]),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"UsuÃ¡rios"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie os usuÃ¡rios do sistema"})]}),e.jsxs("button",{onClick:()=>{d({email:"",password:"",role_id:null}),g(!1),x(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Novo UsuÃ¡rio"]})]}),r?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Carregando..."})]}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"px-6 py-12 text-center text-gray-500",children:"Nenhum usuÃ¡rio encontrado"})}):a.map(f=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:f.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:f.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${f.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:f.is_active?"Ativo":"Inativo"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:e.jsx("button",{onClick:()=>y(f.user_id,f.is_active),className:`px-3 py-1 rounded text-white transition-colors ${f.is_active?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"}`,children:f.is_active?"Desativar":"Ativar"})})]},f.user_id))})]})}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Novo UsuÃ¡rio"}),e.jsx("button",{onClick:()=>{x(!1),d({email:"",password:"",role:"user"})},className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{type:"email",required:!0,value:v.email,onChange:f=>d({...v,email:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"usuario@exemplo.com",autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Senha *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:j?"text":"password",required:!0,value:v.password,onChange:f=>d({...v,password:f.target.value}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"MÃ­nimo 6 caracteres",autoComplete:"new-password"}),e.jsx("button",{type:"button",onClick:()=>g(!j),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:j?e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),e.jsx("select",{value:v.role_id||"",onChange:f=>d({...v,role_id:parseInt(f.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:s.length===0?e.jsx("option",{value:"",children:"Carregando..."}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",children:"Selecione uma role..."}),s.map(f=>e.jsx("option",{value:f.role_id,children:f.nome},f.role_id))]})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{x(!1),d({email:"",password:"",role_id:null})},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Criar UsuÃ¡rio"})]})]})]})})})]})}function yp(){const[a,t]=n.useState([]),[s,o]=n.useState([]),[r,i]=n.useState(!0),[l,x]=n.useState(!1),[j,g]=n.useState(null),[v,d]=n.useState({}),[m,C]=n.useState({nome:"",descricao:"",permissions:[]});async function y(){try{i(!0);const[P,W]=await Promise.all([F.get("/roles"),F.get("/permissions")]);t(P.data),o(W.data)}catch(P){console.error("Erro ao carregar dados:",P),alert("Erro ao carregar dados")}finally{i(!1)}}async function c(P){var W,te;P.preventDefault();try{j?(await F.put(`/roles/${j.role_id}`,m),alert("Role atualizada com sucesso!")):(await F.post("/roles",m),alert("Role criada com sucesso!")),x(!1),g(null),C({nome:"",descricao:"",permissions:[]}),y()}catch(D){console.error("Erro ao salvar role:",D),alert(((te=(W=D.response)==null?void 0:W.data)==null?void 0:te.detail)||"Erro ao salvar role")}}function f(P){g(P),C({nome:P.nome,descricao:P.descricao||"",permissions:P.permissions.map(W=>W.permission_id)}),x(!0)}function b(P){C(W=>({...W,permissions:W.permissions.includes(P)?W.permissions.filter(te=>te!==P):[...W.permissions,P]}))}function u(){const P={};return s.forEach(W=>{const te=W.nome&&W.nome.includes(".")?W.nome.split(".")[0]:"outras";P[te]||(P[te]=[]),P[te].push(W)}),P}function h(P){return{financeiro:"Financeiro",comissoes:"ComissÃµes",entregas:"Entregas",compras:"Compras",cadastros:"Cadastros",configuracoes:"ConfiguraÃ§Ãµes",rh:"Recursos Humanos",vendas:"Vendas",usuarios:"UsuÃ¡rios",relatorios:"RelatÃ³rios",ia:"InteligÃªncia Artificial",outras:"Outras"}[P]||P.charAt(0).toUpperCase()+P.slice(1)}function p(P){d(W=>({...W,[P]:!W[P]}))}function k(P,W){const te=W.map(A=>A.permission_id),D=te.every(A=>m.permissions.includes(A));C(A=>({...A,permissions:D?A.permissions.filter(X=>!te.includes(X)):[...new Set([...A.permissions,...te])]}))}function N(P){return P.every(W=>m.permissions.includes(W.permission_id))}function w(P){const W=P.filter(te=>m.permissions.includes(te.permission_id));return W.length>0&&W.length<P.length}async function S(P){if(confirm("Tem certeza que deseja excluir esta role?"))try{await F.delete(`/roles/${P}`),alert("Role excluÃ­da com sucesso!"),y()}catch(W){console.error("Erro ao excluir role:",W),alert("Erro ao excluir role")}}return n.useEffect(()=>{y()},[]),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"PermissÃµes (Roles)"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie roles e suas permissÃµes"})]}),e.jsxs("button",{onClick:()=>{g(null),C({nome:"",descricao:"",permissions:[]}),x(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Nova Role"]})]}),r?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Carregando..."})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:a.length===0?e.jsx("div",{className:"col-span-full text-center py-12 text-gray-500",children:"Nenhuma role encontrada"}):a.map(P=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:P.nome}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:P.descricao})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f(P),className:"text-blue-600 hover:text-blue-700",title:"Editar",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>S(P.role_id),className:"text-red-600 hover:text-red-700",title:"Excluir",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-2",children:"PermissÃµes:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:P.permissions.length===0?e.jsx("span",{className:"text-sm text-gray-400",children:"Nenhuma permissÃ£o"}):P.permissions.map(W=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:W.nome},W.permission_id))})]})]},P.role_id))}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:j?"Editar Role":"Nova Role"}),e.jsx("button",{onClick:()=>{x(!1),g(null)},className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Role *"}),e.jsx("input",{type:"text",required:!0,value:m.nome,onChange:P=>C({...m,nome:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: Gerente, Vendedor, etc"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{value:m.descricao||"",onChange:P=>C({...m,descricao:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"2",placeholder:"DescriÃ§Ã£o da role"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PermissÃµes *"}),e.jsx("div",{className:"border border-gray-300 rounded-lg p-4 max-h-96 overflow-y-auto",children:s.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhuma permissÃ£o disponÃ­vel"}):e.jsx("div",{className:"space-y-1",children:Object.entries(u()).map(([P,W])=>{const te=v[P],D=N(W),A=w(W);return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-center p-3 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>p(P),className:"text-gray-600 hover:text-gray-900 transition-colors",children:te?e.jsx(nt,{className:"w-5 h-5"}):e.jsx(Zs,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center flex-1 cursor-pointer",onClick:()=>k(P,W),children:[e.jsx("input",{type:"checkbox",checked:D,ref:X=>{X&&(X.indeterminate=A)},onChange:()=>{},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-3 font-medium text-gray-900",children:h(P)}),e.jsxs("span",{className:"ml-auto text-xs text-gray-500",children:["(",W.filter(X=>m.permissions.includes(X.permission_id)).length,"/",W.length,")"]})]})]})}),te&&e.jsx("div",{className:"bg-white p-3 space-y-1 border-t border-gray-200",children:W.map(X=>e.jsxs("label",{className:"flex items-start cursor-pointer hover:bg-gray-50 p-2 rounded ml-4",children:[e.jsx("input",{type:"checkbox",checked:m.permissions.includes(X.permission_id),onChange:()=>b(X.permission_id),className:"mt-1 mr-3 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:X.nome.split(".")[1]||X.nome}),X.descricao&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:X.descricao})]})]},X.permission_id))})]},P)})})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{x(!1),g(null)},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[j?"Atualizar":"Criar"," Role"]})]})]})]})})})]})}function Np(){console.log("ðŸ”§ Configuracoes carregou - Total de cards:",7);const a=[{title:"UsuÃ¡rios",description:"Gerenciar usuÃ¡rios do sistema",icon:el,link:"/admin/usuarios",color:"blue"},{title:"PermissÃµes",description:"Gerenciar roles e permissÃµes",icon:sl,link:"/admin/roles",color:"purple"},{title:"ConfiguraÃ§Ãµes Fiscais",description:"Configurar tributaÃ§Ã£o padrÃ£o da empresa",icon:Ot,link:"/configuracoes/fiscal",color:"green"},{title:"Entregas",description:"Configurar entregadores e ponto inicial de rotas",icon:ft,link:"/configuracoes/entregas",color:"blue"},{title:"Custos da Moto",description:"Configurar custos operacionais da moto de entregas",icon:Ot,link:"/configuracoes/custos-moto",color:"orange"},{title:"Estoque",description:"Configurar comportamento do controle de estoque",icon:Zt,link:"/configuracoes/estoque",color:"indigo"},{title:"Sistema",description:"ConfiguraÃ§Ãµes gerais do sistema",icon:Ot,link:"#",color:"gray",disabled:!0}];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ConfiguraÃ§Ãµes"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gerencie usuÃ¡rios, permissÃµes e configuraÃ§Ãµes do sistema"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(t=>{const s=t.icon,o={blue:"bg-blue-50 text-blue-600 hover:bg-blue-100",purple:"bg-purple-50 text-purple-600 hover:bg-purple-100",green:"bg-green-50 text-green-600 hover:bg-green-100",orange:"bg-orange-50 text-orange-600 hover:bg-orange-100",indigo:"bg-indigo-50 text-indigo-600 hover:bg-indigo-100",gray:"bg-gray-50 text-gray-400"};return t.disabled?e.jsxs("div",{className:`p-6 rounded-lg border-2 border-gray-200 ${o[t.color]} cursor-not-allowed opacity-60`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(s,{className:"text-2xl"}),e.jsx("h3",{className:"text-lg font-semibold",children:t.title})]}),e.jsx("p",{className:"text-sm text-gray-500",children:t.description}),e.jsx("span",{className:"text-xs text-gray-400 mt-2 block",children:"Em breve"})]},t.title):e.jsxs(_t,{to:t.link,className:`p-6 rounded-lg border-2 border-gray-200 ${o[t.color]} transition-all hover:shadow-lg`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(s,{className:"text-2xl"}),e.jsx("h3",{className:"text-lg font-semibold",children:t.title})]}),e.jsx("p",{className:"text-sm opacity-80",children:t.description}),e.jsxs("div",{className:"mt-4 flex items-center text-sm font-medium",children:["Acessar",e.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]},t.title)})})]})}function _p(){const[a,t]=n.useState(!0),[s,o]=n.useState(!1),[r,i]=n.useState(!1),l=k=>{if(console.log("ðŸ”§ normalizeCnaesSecundarios chamado com:",k,"tipo:",typeof k),!k)return[];if(Array.isArray(k))return k;if(typeof k=="string")try{const N=JSON.parse(k);return Array.isArray(N)?N:[]}catch{return[]}return console.warn("âš ï¸ Valor inesperado para CNAEs, retornando array vazio"),[]},[x,j]=n.useState(""),[g,v]=n.useState([]),[d,m]=n.useState({cnpj:"",razao_social:"",nome_fantasia:"",inscricao_estadual:"",inscricao_municipal:"",email:"",telefone:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",uf:""}),[C,y]=n.useState({regime_tributario:"",simples_anexo:"I",aliquota_simples_vigente:0,aliquota_simples_sugerida:0,cnae_principal:"",cnae_descricao:"",cnaes_secundarios:[],uf:""});n.useEffect(()=>{async function k(){try{const N=await ia.get("/empresa/fiscal");console.log("ðŸ“Š Dados fiscais carregados:",N.data),console.log("ðŸ” cnaes_secundarios recebido:",N.data.cnaes_secundarios),console.log("ðŸ” Tipo:",typeof N.data.cnaes_secundarios),console.log("ðŸ” Ã‰ array?",Array.isArray(N.data.cnaes_secundarios));const w=l(N.data.cnaes_secundarios);console.log("âœ… ApÃ³s normalizar:",w),console.log("âœ… Ã‰ array agora?",Array.isArray(w)),y({regime_tributario:N.data.regime_tributario||"",simples_anexo:N.data.simples_anexo||"I",aliquota_simples_vigente:N.data.aliquota_simples_vigente??0,aliquota_simples_sugerida:N.data.aliquota_simples_sugerida??0,cnae_principal:N.data.cnae_principal||"",cnae_descricao:N.data.cnae_descricao||"",cnaes_secundarios:w,uf:N.data.uf||""}),N.data.cnae_descricao&&j(N.data.cnae_descricao),v(w);try{const S=await ia.get("/empresa/dados-cadastrais");S.data&&m({cnpj:S.data.cnpj||"",razao_social:S.data.razao_social||"",nome_fantasia:S.data.nome_fantasia||"",inscricao_estadual:S.data.inscricao_estadual||"",inscricao_municipal:S.data.inscricao_municipal||"",email:S.data.email||"",telefone:S.data.telefone||"",cep:S.data.cep||"",endereco:S.data.endereco||"",numero:S.data.numero||"",complemento:S.data.complemento||"",bairro:S.data.bairro||"",cidade:S.data.cidade||"",uf:S.data.uf||""})}catch{console.log("Endpoint de dados cadastrais nÃ£o existe ainda")}}catch(N){console.error("âŒ Erro ao carregar configuraÃ§Ãµes:",N),console.error("âŒ Resposta completa:",N.response),Ee.error("Erro ao carregar configuraÃ§Ãµes da empresa"),v([]),y(w=>({...w,cnaes_secundarios:[]}))}finally{t(!1)}}k()},[]);function c(k){const{name:N,value:w}=k.target;y(S=>{const P={...S,[N]:w};return N==="regime_tributario"&&w==="Simples Nacional"&&((!P.simples_anexo||P.simples_anexo==="")&&(P.simples_anexo="I"),(!P.aliquota_simples_vigente||P.aliquota_simples_vigente===0)&&(P.aliquota_simples_vigente=4)),P})}function f(k){const{name:N,value:w}=k.target;m(S=>({...S,[N]:w}))}async function b(){const k=d.cnpj.replace(/[^0-9]/g,"");if(k.length!==14){Ee.error("CNPJ deve ter 14 dÃ­gitos");return}i(!0);try{const N=await fetch(`https://brasilapi.com.br/api/cnpj/v1/${k}`);if(!N.ok)throw new Error("CNPJ nÃ£o encontrado");const w=await N.json();console.log("ðŸ” Dados completos da API:",w),console.log("ðŸ“‹ CNAE Fiscal:",w.cnae_fiscal),console.log("ðŸ“‹ CNAE DescriÃ§Ã£o:",w.cnae_fiscal_descricao),console.log("ðŸ“‹ CNAEs SecundÃ¡rios:",w.cnaes_secundarios);const S={...d};w.razao_social&&(S.razao_social=w.razao_social),w.nome_fantasia&&(S.nome_fantasia=w.nome_fantasia),w.email&&(S.email=w.email),w.inscricao_estadual&&(S.inscricao_estadual=w.inscricao_estadual);const P=w.ddd_telefone_1||w.telefone;if(P&&(S.telefone=P),w.cep&&(S.cep=w.cep.replace(/[^0-9]/g,"")),w.logradouro&&(S.endereco=w.logradouro),w.numero&&(S.numero=w.numero),w.complemento&&(S.complemento=w.complemento),w.bairro&&(S.bairro=w.bairro),w.municipio&&(S.cidade=w.municipio),w.uf&&(S.uf=w.uf),m(S),w.cnae_fiscal){const W=w.cnae_fiscal.toString();console.log("âœ… CNAE encontrado:",W);const te=l(w.cnaes_secundarios);y(D=>({...D,cnae_principal:W,cnae_descricao:w.cnae_fiscal_descricao||"",cnaes_secundarios:te})),w.cnae_fiscal_descricao&&j(w.cnae_fiscal_descricao),v(te),te.length>0&&console.log(`ðŸ“‹ Encontrados ${te.length} CNAEs secundÃ¡rios`)}Ee.success("âœ… Dados preenchidos com sucesso!")}catch(N){console.error("Erro ao buscar CNPJ:",N),Ee.error("âŒ Erro ao buscar CNPJ. Verifique o nÃºmero.")}finally{i(!1)}}async function u(){var k,N;o(!0);try{const w={...C,cnaes_secundarios:l(C.cnaes_secundarios)};console.log("ðŸ’¾ Salvando dados fiscais:",w),console.log("ðŸ“‹ CNAE DescriÃ§Ã£o no form:",C.cnae_descricao),console.log("ðŸ“‹ CNAEs SecundÃ¡rios no form:",C.cnaes_secundarios);const S=await ia.put("/empresa/fiscal",w);console.log("âœ… Resposta do servidor (fiscal):",S.data);try{console.log("ðŸ’¾ Salvando dados cadastrais:",d),await ia.put("/empresa/dados-cadastrais",d)}catch{console.log("Endpoint de dados cadastrais nÃ£o implementado ainda")}Ee.success("ConfiguraÃ§Ãµes salvas com sucesso!")}catch(w){console.error("Erro ao salvar:",w),Ee.error(((N=(k=w.response)==null?void 0:k.data)==null?void 0:N.detail)||"Erro ao salvar configuraÃ§Ãµes")}finally{o(!1)}}if(a)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando configuraÃ§Ãµes..."})]})});const h=Array.isArray(g)?g:[],p=C.regime_tributario==="Simples Nacional";return e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ConfiguraÃ§Ã£o da Empresa"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure os dados cadastrais, fiscais e tributÃ¡rios da sua empresa"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"bg-blue-50 px-6 py-4 border-b border-blue-100",children:[e.jsx("h2",{className:"text-lg font-semibold text-blue-900",children:"ðŸ“‹ Dados Cadastrais"}),e.jsxs("p",{className:"text-sm text-blue-700 mt-2",children:["ðŸ’¡ ",e.jsx("strong",{children:"Dica:"})," Digite o CNPJ e clique no botÃ£o ðŸ” para preencher automaticamente os dados da empresa (razÃ£o social, endereÃ§o, CNAEs, etc.) consultando a Receita Federal."]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["CNPJ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",name:"cnpj",value:d.cnpj,onChange:f,placeholder:"00.000.000/0000-00",maxLength:"18",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:b,disabled:r||!d.cnpj,title:"Buscar dados da Receita Federal pelo CNPJ",className:"px-3 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed flex items-center justify-center shadow-md hover:shadow-lg transition-all duration-200",children:r?e.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["RazÃ£o Social ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"razao_social",value:d.razao_social,onChange:f,placeholder:"Nome empresarial completo",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome Fantasia"}),e.jsx("input",{type:"text",name:"nome_fantasia",value:d.nome_fantasia,onChange:f,placeholder:"Nome comercial",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"InscriÃ§Ã£o Estadual"}),e.jsx("input",{type:"text",name:"inscricao_estadual",value:d.inscricao_estadual,onChange:f,placeholder:"000.000.000.000",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"InscriÃ§Ã£o Municipal"}),e.jsx("input",{type:"text",name:"inscricao_municipal",value:d.inscricao_municipal,onChange:f,placeholder:"000000",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail"}),e.jsx("input",{type:"email",name:"email",value:d.email,onChange:f,placeholder:"contato@empresa.com.br",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefone"}),e.jsx("input",{type:"text",name:"telefone",value:d.telefone,onChange:f,placeholder:"(00) 0000-0000",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CEP"}),e.jsx("input",{type:"text",name:"cep",value:d.cep,onChange:f,placeholder:"00000-000",maxLength:"9",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"EndereÃ§o"}),e.jsx("input",{type:"text",name:"endereco",value:d.endereco,onChange:f,placeholder:"Rua, Avenida, etc",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"NÃºmero"}),e.jsx("input",{type:"text",name:"numero",value:d.numero,onChange:f,placeholder:"123",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Complemento"}),e.jsx("input",{type:"text",name:"complemento",value:d.complemento,onChange:f,placeholder:"Sala, Apto, etc",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bairro"}),e.jsx("input",{type:"text",name:"bairro",value:d.bairro,onChange:f,placeholder:"Centro",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"UF"}),e.jsxs("select",{name:"uf",value:d.uf,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"-"}),e.jsx("option",{value:"SP",children:"SP"}),e.jsx("option",{value:"RJ",children:"RJ"}),e.jsx("option",{value:"MG",children:"MG"}),e.jsx("option",{value:"RS",children:"RS"}),e.jsx("option",{value:"PR",children:"PR"}),e.jsx("option",{value:"SC",children:"SC"}),e.jsx("option",{value:"BA",children:"BA"}),e.jsx("option",{value:"PE",children:"PE"}),e.jsx("option",{value:"CE",children:"CE"}),e.jsx("option",{value:"GO",children:"GO"}),e.jsx("option",{value:"DF",children:"DF"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cidade"}),e.jsx("input",{type:"text",name:"cidade",value:d.cidade,onChange:f,placeholder:"Nome da cidade",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"bg-green-50 px-6 py-4 border-b border-green-100",children:e.jsx("h2",{className:"text-lg font-semibold text-green-900",children:"ðŸ’° ConfiguraÃ§Ã£o Fiscal e TributÃ¡ria"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CNAE Principal"}),e.jsx("input",{type:"text",name:"cnae_principal",value:C.cnae_principal,onChange:c,placeholder:"0000-0/00",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),x&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-900 font-medium",children:["ðŸ“‹ ",x]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"CÃ³digo da ClassificaÃ§Ã£o Nacional de Atividades EconÃ´micas"})]}),h.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["CNAEs SecundÃ¡rios (",h.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:h.map((k,N)=>e.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-md text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:(k==null?void 0:k.codigo)||"N/A"}),e.jsxs("span",{className:"text-gray-600",children:[" - ",(k==null?void 0:k.descricao)||"Sem descriÃ§Ã£o"]})]},N))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Regime TributÃ¡rio ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"regime_tributario",value:C.regime_tributario,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Simples Nacional",children:"Simples Nacional"}),e.jsx("option",{value:"Lucro Presumido",children:"Lucro Presumido"}),e.jsx("option",{value:"Lucro Real",children:"Lucro Real"})]})]}),p&&e.jsxs("div",{className:"border-l-4 border-blue-500 bg-blue-50 p-4 space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold text-blue-900",children:"ParÃ¢metros do Simples Nacional"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Anexo"}),e.jsxs("select",{name:"simples_anexo",value:C.simples_anexo||"I",onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"I",children:"Anexo I - ComÃ©rcio"}),e.jsx("option",{value:"II",children:"Anexo II - IndÃºstria"}),e.jsx("option",{value:"III",children:"Anexo III - ServiÃ§os"}),e.jsx("option",{value:"IV",children:"Anexo IV - ServiÃ§os (ConstruÃ§Ã£o)"}),e.jsx("option",{value:"V",children:"Anexo V - ServiÃ§os (Intelectual)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"AlÃ­quota Vigente (%)"}),e.jsx("input",{type:"number",name:"aliquota_simples_vigente",value:C.aliquota_simples_vigente||"",onChange:c,step:"0.01",min:"0",max:"100",placeholder:"Ex: 4.00",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"AlÃ­quota atual utilizada para calcular provisÃµes"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"AlÃ­quota Sugerida (%)"}),e.jsx("input",{type:"number",name:"aliquota_simples_sugerida",value:C.aliquota_simples_sugerida||"",onChange:c,step:"0.01",min:"0",max:"100",placeholder:"Ex: 4.50",className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"SugestÃ£o baseada no histÃ³rico de fechamentos (informativo)"})]})]})]})]}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx("button",{type:"button",onClick:u,disabled:s,className:"px-8 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium",children:s?"Salvando...":"Salvar Todas as ConfiguraÃ§Ãµes"})})]})]})}function wp(){const[a,t]=n.useState(!0),[s,o]=n.useState(!1),[r,i]=n.useState(!1),[l,x]=n.useState([]),[j,g]=n.useState({entregador_padrao_id:"",ponto_inicial_rota:"",cep:"",logradouro:"",numero:"",complemento:"",bairro:"",cidade:"",estado:""});n.useEffect(()=>{async function m(){var C,y;try{const[c,f]=await Promise.all([ia.get("/configuracoes/entregas"),ia.get("/clientes/",{params:{is_entregador:!0,entregador_ativo:!0}})]);g({entregador_padrao_id:c.data.entregador_padrao_id??"",ponto_inicial_rota:"",cep:c.data.cep??"",logradouro:c.data.logradouro??"",numero:c.data.numero??"",complemento:c.data.complemento??"",bairro:c.data.bairro??"",cidade:c.data.cidade??"",estado:c.data.estado??""});const b=Array.isArray(f.data)?f.data:((C=f.data)==null?void 0:C.clientes)||((y=f.data)==null?void 0:y.items)||[];console.log("ðŸšš Entregadores carregados:",b),x(b)}catch(c){console.error("âŒ Erro ao carregar configuraÃ§Ãµes:",c),alert("Erro ao carregar configuraÃ§Ãµes de entrega"),x([])}finally{t(!1)}}m()},[]);async function v(){const m=j.cep.replace(/\D/g,"");if(m.length!==8){alert("CEP invÃ¡lido. Digite 8 dÃ­gitos.");return}i(!0);try{const y=await(await fetch(`https://viacep.com.br/ws/${m}/json/`)).json();if(y.erro){alert("CEP nÃ£o encontrado");return}g({...j,logradouro:y.logradouro||"",bairro:y.bairro||"",cidade:y.localidade||"",estado:y.uf||""})}catch(C){console.error(C),alert("Erro ao buscar CEP")}finally{i(!1)}}async function d(m){m.preventDefault(),o(!0);try{await ia.put("/configuracoes/entregas",{entregador_padrao_id:j.entregador_padrao_id||null,cep:j.cep||null,logradouro:j.logradouro||null,numero:j.numero||null,complemento:j.complemento||null,bairro:j.bairro||null,cidade:j.cidade||null,estado:j.estado||null}),alert("ConfiguraÃ§Ãµes salvas com sucesso")}catch(C){console.error(C),alert("Erro ao salvar configuraÃ§Ãµes")}finally{o(!1)}}return a?e.jsx("div",{children:"Carregando..."}):e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"ConfiguraÃ§Ãµes de Entregas"}),e.jsxs("form",{onSubmit:d,style:{maxWidth:600},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Entregador padrÃ£o"}),e.jsxs("select",{value:j.entregador_padrao_id,onChange:m=>g({...j,entregador_padrao_id:m.target.value}),children:[e.jsx("option",{value:"",children:"Nenhum (escolher manualmente)"}),Array.isArray(l)&&l.map(m=>e.jsx("option",{value:m.id,children:m.nome},m.id))]}),e.jsx("p",{style:{fontSize:12,color:"#666",marginTop:5},children:"Este entregador serÃ¡ prÃ©-selecionado ao criar novas rotas."})]}),e.jsx("hr",{style:{margin:"30px 0",border:"none",borderTop:"1px solid #ddd"}}),e.jsx("h3",{style:{marginBottom:20},children:"Ponto Inicial PadrÃ£o da Rota"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"CEP *"}),e.jsxs("div",{style:{display:"flex",gap:10},children:[e.jsx("input",{type:"text",value:j.cep.replace(/(\d{5})(\d)/,"$1-$2"),onChange:m=>{const C=m.target.value.replace(/\D/g,"");g({...j,cep:C.slice(0,8)})},placeholder:"00000-000",maxLength:9,style:{flex:1}}),e.jsx("button",{type:"button",onClick:v,disabled:r||j.cep.length<8,style:{padding:"0 20px",display:"flex",alignItems:"center",gap:5},children:r?"Buscando...":e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"ðŸ”"}),"Buscar"]})})]}),e.jsx("p",{style:{fontSize:12,color:"#666",marginTop:5},children:"Digite o CEP e clique em Buscar para preencher automaticamente."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Logradouro (Rua/Avenida) *"}),e.jsx("input",{type:"text",value:j.logradouro,onChange:m=>g({...j,logradouro:m.target.value}),placeholder:"Ex: Rua das Flores"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:15},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"NÃºmero *"}),e.jsx("input",{type:"text",value:j.numero,onChange:m=>g({...j,numero:m.target.value}),placeholder:"123"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Complemento"}),e.jsx("input",{type:"text",value:j.complemento,onChange:m=>g({...j,complemento:m.target.value}),placeholder:"Ex: Loja 1"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Bairro *"}),e.jsx("input",{type:"text",value:j.bairro,onChange:m=>g({...j,bairro:m.target.value}),placeholder:"Ex: Centro"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:15},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cidade *"}),e.jsx("input",{type:"text",value:j.cidade,onChange:m=>g({...j,cidade:m.target.value}),placeholder:"Ex: SÃ£o Paulo"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Estado *"}),e.jsx("input",{type:"text",value:j.estado,onChange:m=>{const C=m.target.value.toUpperCase().slice(0,2);g({...j,estado:C})},placeholder:"SP",maxLength:2})]})]}),e.jsx("p",{style:{fontSize:12,color:"#666",marginTop:15,marginBottom:20},children:"Este endereÃ§o serÃ¡ usado como ponto de partida para calcular as rotas de entrega."}),e.jsx("button",{type:"submit",disabled:s,style:{backgroundColor:"#2563eb",color:"white",padding:"12px 24px",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"500",cursor:s?"not-allowed":"pointer",opacity:s?.6:1,transition:"all 0.2s"},onMouseOver:m=>{s||(m.target.style.backgroundColor="#1d4ed8")},onMouseOut:m=>{s||(m.target.style.backgroundColor="#2563eb")},children:s?"Salvando...":"Salvar ConfiguraÃ§Ãµes"})]})]})}function Cp(){const[a,t]=n.useState({preco_combustivel:"",km_por_litro:"",km_troca_oleo:"",custo_troca_oleo:"",km_troca_pneu_dianteiro:"",custo_pneu_dianteiro:"",km_troca_pneu_traseiro:"",custo_pneu_traseiro:"",km_troca_kit_traseiro:"",custo_kit_traseiro:"",km_manutencao_geral:"",custo_manutencao_geral:"",seguro_mensal:"",licenciamento_mensal:"",ipva_mensal:"",outros_custos_mensais:"",km_medio_mensal:""}),[s,o]=n.useState(!1),r=()=>{const c=parseFloat(a.preco_combustivel)||0,f=parseFloat(a.km_por_litro)||1;return f>0?(c/f).toFixed(4):"0.0000"},i=()=>{const c=parseFloat(a.custo_troca_oleo)||0,f=parseFloat(a.km_troca_oleo)||1;return f>0?(c/f).toFixed(4):"0.0000"},l=()=>{const c=parseFloat(a.custo_pneu_dianteiro)||0,f=parseFloat(a.km_troca_pneu_dianteiro)||1;return f>0?(c/f).toFixed(4):"0.0000"},x=()=>{const c=parseFloat(a.custo_pneu_traseiro)||0,f=parseFloat(a.km_troca_pneu_traseiro)||1;return f>0?(c/f).toFixed(4):"0.0000"},j=()=>{const c=parseFloat(a.custo_kit_traseiro)||0,f=parseFloat(a.km_troca_kit_traseiro)||1;return f>0?(c/f).toFixed(4):"0.0000"},g=()=>{const c=parseFloat(a.custo_manutencao_geral)||0,f=parseFloat(a.km_manutencao_geral)||1;return f>0?(c/f).toFixed(4):"0.0000"},v=()=>{const c=parseFloat(a.seguro_mensal)||0,f=parseFloat(a.licenciamento_mensal)||0,b=parseFloat(a.ipva_mensal)||0,u=parseFloat(a.outros_custos_mensais)||0,h=c+f+b+u,p=parseFloat(a.km_medio_mensal)||1;return p>0?(h/p).toFixed(4):"0.0000"};n.useEffect(()=>{d()},[]);async function d(){const f=(await ia.get("/configuracoes/custo-moto")).data;Object.keys(f).forEach(b=>{f[b]===null&&(f[b]="")}),t(f)}function m(c){t({...a,[c.target.name]:c.target.value})}function C(){confirm("Preencher com valores sugeridos baseados em uma moto de entrega tÃ­pica (CG 160, Biz 125, Pop 110)? Os valores atuais serÃ£o substituÃ­dos.")&&t({preco_combustivel:"6.30",km_por_litro:"38",km_troca_oleo:"3000",custo_troca_oleo:"95.00",km_troca_pneu_dianteiro:"14000",custo_pneu_dianteiro:"210.00",km_troca_pneu_traseiro:"10000",custo_pneu_traseiro:"240.00",km_troca_kit_traseiro:"18000",custo_kit_traseiro:"420.00",km_manutencao_geral:"5000",custo_manutencao_geral:"180.00",seguro_mensal:"110.00",licenciamento_mensal:"32.00",ipva_mensal:"55.00",outros_custos_mensais:"75.00",km_medio_mensal:"1200"})}async function y(){o(!0),await ia.put("/configuracoes/custo-moto",a),o(!1),alert("Custos da moto salvos com sucesso")}return e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"ðŸï¸ Custos da Moto"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure os custos operacionais da moto de entregas"}),e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-800",children:["ðŸ’¡ ",e.jsx("strong",{children:"Dica:"}),' NÃ£o sabe por onde comeÃ§ar? Clique em "Preencher com Valores Sugeridos" para usar custos tÃ­picos de uma moto de entrega (CG 160, Biz 125, Pop 110 na faixa de R$ 15 mil). Depois ajuste conforme sua realidade.']}),e.jsx("div",{className:"mt-4",children:e.jsxs("button",{onClick:C,className:"px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors shadow-sm flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ’¡"})," Preencher com Valores Sugeridos"]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"â›½"})," CombustÃ­vel"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PreÃ§o por Litro (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"preco_combustivel",placeholder:"Ex: 6.50",value:a.preco_combustivel,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Consumo MÃ©dio (KM/Litro)"}),e.jsx("input",{type:"number",step:"0.1",name:"km_por_litro",placeholder:"Ex: 35",value:a.km_por_litro,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ðŸ’° Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-blue-50 border border-blue-200 rounded-md text-blue-900 font-semibold text-lg",children:["R$ ",r()]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ› ï¸"})," ManutenÃ§Ã£o (Custos VariÃ¡veis por KM)"]}),e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Troca de Ã“leo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"KM para Troca"}),e.jsx("input",{type:"number",name:"km_troca_oleo",placeholder:"Ex: 3000",value:a.km_troca_oleo,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Custo por Troca (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"custo_troca_oleo",placeholder:"Ex: 150.00",value:a.custo_troca_oleo,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"ðŸ’° Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-green-50 border border-green-200 rounded-md text-green-900 font-semibold",children:["R$ ",i()]})]})]})]}),e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Pneu Dianteiro"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Vida Ãštil (KM)"}),e.jsx("input",{type:"number",name:"km_troca_pneu_dianteiro",placeholder:"Ex: 15000",value:a.km_troca_pneu_dianteiro,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"PreÃ§o do Pneu (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"custo_pneu_dianteiro",placeholder:"Ex: 250.00",value:a.custo_pneu_dianteiro,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"ðŸ’° Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-green-50 border border-green-200 rounded-md text-green-900 font-semibold",children:["R$ ",l()]})]})]})]}),e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Pneu Traseiro"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Vida Ãštil (KM)"}),e.jsx("input",{type:"number",name:"km_troca_pneu_traseiro",placeholder:"Ex: 12000",value:a.km_troca_pneu_traseiro,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"PreÃ§o do Pneu (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"custo_pneu_traseiro",placeholder:"Ex: 280.00",value:a.custo_pneu_traseiro,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"ðŸ’° Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-green-50 border border-green-200 rounded-md text-green-900 font-semibold",children:["R$ ",x()]})]})]})]}),e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Kit TransmissÃ£o (Corrente, Coroa, PinhÃ£o)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Vida Ãštil do Kit (KM)"}),e.jsx("input",{type:"number",name:"km_troca_kit_traseiro",placeholder:"Ex: 20000",value:a.km_troca_kit_traseiro,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"PreÃ§o do Kit (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"custo_kit_traseiro",placeholder:"Ex: 450.00",value:a.custo_kit_traseiro,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"ðŸ’° Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-green-50 border border-green-200 rounded-md text-green-900 font-semibold",children:["R$ ",j()]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"ManutenÃ§Ã£o Geral"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"FrequÃªncia (KM)"}),e.jsx("input",{type:"number",name:"km_manutencao_geral",placeholder:"Ex: 5000",value:a.km_manutencao_geral,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Custo por ManutenÃ§Ã£o (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"custo_manutencao_geral",placeholder:"Ex: 200.00",value:a.custo_manutencao_geral,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"ðŸ’° Custo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-green-50 border border-green-200 rounded-md text-green-900 font-semibold",children:["R$ ",g()]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“„"})," Custos Fixos Mensais"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Seguro Mensal (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"seguro_mensal",placeholder:"Ex: 120.00",value:a.seguro_mensal,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Licenciamento Mensal (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"licenciamento_mensal",placeholder:"Ex: 30.00",value:a.licenciamento_mensal,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"IPVA Mensal (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"ipva_mensal",placeholder:"Ex: 50.00",value:a.ipva_mensal,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Outros Custos Mensais (R$)"}),e.jsx("input",{type:"number",step:"0.01",name:"outros_custos_mensais",placeholder:"Ex: 100.00",value:a.outros_custos_mensais,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“Š"})," Controle"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"KM MÃ©dio Mensal (para cÃ¡lculo de custos fixos)"}),e.jsx("input",{type:"number",step:"0.01",name:"km_medio_mensal",placeholder:"Ex: 1000",value:a.km_medio_mensal,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Usado para ratear os custos fixos mensais por KM rodado"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ðŸ’° Custo Fixo por KM"}),e.jsxs("div",{className:"w-full px-3 py-2 bg-purple-50 border border-purple-200 rounded-md text-purple-900 font-semibold text-lg",children:["R$ ",v()]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Total dos custos fixos Ã· KM mÃ©dio mensal"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:y,disabled:s,className:"px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors shadow-sm",children:s?"Salvando...":"ðŸ’¾ Salvar ConfiguraÃ§Ãµes"})})]})}function kp(){const[a,t]=n.useState(!0),[s,o]=n.useState(!1),[r,i]=n.useState(!1);n.useEffect(()=>{async function x(){try{const j=await ia.get("/empresa/config-estoque");i(j.data.permite_estoque_negativo)}catch(j){console.error("Erro ao carregar configuraÃ§Ãµes de estoque",j),Ee.error("Erro ao carregar configuraÃ§Ãµes")}finally{t(!1)}}x()},[]);async function l(){o(!0);try{await ia.put("/empresa/config-estoque",{permite_estoque_negativo:r}),Ee.success("ConfiguraÃ§Ãµes de estoque atualizadas com sucesso!")}catch(x){console.error("Erro ao salvar configuraÃ§Ãµes",x),Ee.error("Erro ao salvar configuraÃ§Ãµes")}finally{o(!1)}}return a?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando configuraÃ§Ãµes..."})]})}):e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(_t,{to:"/configuracoes",className:"inline-flex items-center text-blue-600 hover:text-blue-700 mb-4",children:[e.jsx(fl,{className:"mr-1"}),"Voltar para ConfiguraÃ§Ãµes"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ConfiguraÃ§Ãµes de Estoque"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Configure o comportamento do controle de estoque do sistema"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Controle de Estoque Negativo"}),e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(rl,{className:"text-yellow-600 mt-1 mr-3 flex-shrink-0"}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"AtenÃ§Ã£o:"})," Esta configuraÃ§Ã£o afeta diretamente o controle de vendas e estoque."]})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-start p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"estoque-negativo",checked:!r,onChange:()=>i(!1),className:"mt-1 mr-3 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"ðŸ”’ Bloquear vendas sem estoque (Recomendado)"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"O sistema impedirÃ¡ finalizar vendas quando nÃ£o houver estoque suficiente. Ideal para controle rigoroso de estoque."})]})]}),e.jsxs("label",{className:"flex items-start p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"estoque-negativo",checked:r,onChange:()=>i(!0),className:"mt-1 mr-3 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"âœ… Permitir estoque negativo"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"O sistema permitirÃ¡ vendas mesmo sem estoque disponÃ­vel. Ãštil para negÃ³cios que trabalham com encomendas ou reposiÃ§Ã£o rÃ¡pida."}),e.jsx("div",{className:"text-xs text-red-600 mt-2 font-medium",children:"âš ï¸ Use com cuidado: pode gerar descontinuidade no controle de estoque"})]})]})]})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsxs("button",{onClick:l,disabled:s,className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:[e.jsx(st,{className:"mr-2"}),s?"Salvando...":"Salvar ConfiguraÃ§Ãµes"]})})]}),e.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ Como funciona?"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Estoque Bloqueado:"})," Ao tentar vender um produto sem estoque, o sistema exibirÃ¡ um erro e impedirÃ¡ a finalizaÃ§Ã£o da venda."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Estoque Negativo:"})," O sistema permite a venda e o estoque ficarÃ¡ com valor negativo atÃ© a prÃ³xima reposiÃ§Ã£o."]}),e.jsx("li",{children:"Esta configuraÃ§Ã£o Ã© global e afeta todas as vendas realizadas no PDV e outros pontos de venda."})]})]})]})}function Sp(){const a=new Date,[t,s]=n.useState(a.getMonth()+1),[o,r]=n.useState(a.getFullYear()),[i,l]=n.useState(!1),[x,j]=n.useState(null);n.useEffect(()=>{g()},[]);const g=async()=>{if(!t||!o){Ee.error("Informe mÃªs e ano");return}l(!0);try{const y=await F.get(`/auditoria/provisoes/mensal?mes=${t}&ano=${o}`);j(y.data)}catch(y){console.error("Erro ao buscar auditoria:",y),Ee.error("Erro ao buscar auditoria de provisÃµes")}finally{l(!1)}},v=y=>!y&&y!==0?"R$ 0,00":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Math.abs(y)),d=y=>!y&&y!==0?"0,0%":`${y.toFixed(1)}%`,m=(y,c)=>{const f={OK:"bg-green-100 text-green-800 border-green-300",AJUSTE:"bg-yellow-100 text-yellow-800 border-yellow-300",ACUMULANDO:"bg-blue-100 text-blue-800 border-blue-300",SEM_DADOS:"bg-gray-100 text-gray-600 border-gray-300"};return e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium border ${f[y]||f.SEM_DADOS}`,children:[c," ",y.replace("_"," ")]})},C=[{valor:1,nome:"Janeiro"},{valor:2,nome:"Fevereiro"},{valor:3,nome:"MarÃ§o"},{valor:4,nome:"Abril"},{valor:5,nome:"Maio"},{valor:6,nome:"Junho"},{valor:7,nome:"Julho"},{valor:8,nome:"Agosto"},{valor:9,nome:"Setembro"},{valor:10,nome:"Outubro"},{valor:11,nome:"Novembro"},{valor:12,nome:"Dezembro"}];return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx("svg",{className:"w-8 h-8 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),"Auditoria Mensal â€” ProvisÃ£o Ã— Realizado"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Compare valores provisionados com valores pagos para controle fiscal e trabalhista"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"MÃªs"}),e.jsx("select",{value:t,onChange:y=>s(Number(y.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:C.map(y=>e.jsx("option",{value:y.valor,children:y.nome},y.valor))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ano"}),e.jsx("input",{type:"number",value:o,onChange:y=>r(Number(y.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"2026"})]}),e.jsx("div",{children:e.jsx("button",{onClick:g,disabled:i,className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),"Buscando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"Buscar"]})})})]})}),x&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-400 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"InterpretaÃ§Ã£o dos Status:"}),e.jsxs("div",{className:"mt-2 text-sm text-blue-700 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"âœ… OK:"})," ProvisÃ£o igual ao realizado - situaÃ§Ã£o perfeita"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"âš ï¸ AJUSTE:"})," Tem pagamento mas valores divergem - revisar"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ðŸ•’ ACUMULANDO:"})," Provisionado mas nÃ£o pago ainda - normal para fÃ©rias e 13Âº"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"âž– SEM DADOS:"})," Sem provisÃ£o e sem pagamento no perÃ­odo"]})]})]})]})}),x&&e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ProvisÃ£o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Realizado"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"DiferenÃ§a"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"% Real."}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.itens.map((y,c)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:y.item})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm text-gray-900",children:v(y.provisao)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:v(y.realizado)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:`text-sm font-medium ${y.diferenca===0?"text-green-600":y.diferenca>0?"text-blue-600":"text-red-600"}`,children:[y.diferenca>0&&"+",v(y.diferenca)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm text-gray-600",children:d(y.percentual_realizado)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:m(y.status,y.status_emoji)})]},c))}),e.jsx("tfoot",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:"TOTAL"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:v(x.total_provisao)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:v(x.total_realizado)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:`text-sm font-bold ${x.total_diferenca===0?"text-green-600":x.total_diferenca>0?"text-blue-600":"text-red-600"}`,children:[x.total_diferenca>0&&"+",v(x.total_diferenca)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:d(x.total_provisao>0?x.total_realizado/x.total_provisao*100:0)})}),e.jsx("td",{className:"px-6 py-4"})]})})]})})}),!i&&!x&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),e.jsx("p",{className:"text-gray-600",children:'Selecione um mÃªs e ano e clique em "Buscar" para visualizar a auditoria'})]})]})}function Ep(){const[a,t]=n.useState(3),[s,o]=n.useState([]),[r,i]=n.useState(null),[l,x]=n.useState(!1),j=["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];n.useEffect(()=>{g()},[a]);const g=async()=>{x(!0);try{const[C,y]=await Promise.all([F.get(`/projecao-caixa/?meses_a_frente=${a}`),F.get(`/projecao-caixa/resumo?meses_a_frente=${a}`)]);C.data.sucesso&&o(C.data.projecao||[]),y.data.sucesso&&i(y.data.resumo||null)}catch(C){console.error("Erro ao buscar projeÃ§Ã£o:",C),Ee.error("Erro ao carregar projeÃ§Ã£o de caixa")}finally{x(!1)}},v=C=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(C),d=C=>{const y={POSITIVO:"bg-green-100 text-green-800",NEGATIVO:"bg-red-100 text-red-800",MISTO:"bg-yellow-100 text-yellow-800",NEUTRO:"bg-gray-100 text-gray-800"},c={POSITIVO:"ðŸ“ˆ Todos os meses positivos",NEGATIVO:"ðŸ“‰ Todos os meses negativos",MISTO:"âš ï¸ Meses positivos e negativos",NEUTRO:"âž– Sem dados"};return e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${y[C]||y.NEUTRO}`,children:c[C]||c.NEUTRO})},m=C=>C>0?e.jsx("span",{className:"text-green-600 font-bold",children:v(C)}):C<0?e.jsx("span",{className:"text-red-600 font-bold",children:v(C)}):e.jsx("span",{className:"text-gray-600 font-bold",children:v(C)});return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"ðŸ’° ProjeÃ§Ã£o de Caixa"}),e.jsx("p",{className:"text-gray-600",children:"ProjeÃ§Ã£o futura baseada em histÃ³rico real + provisÃµes obrigatÃ³rias"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Projetar para:"}),e.jsxs("select",{value:a,onChange:C=>t(Number(C.target.value)),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:3,children:"3 meses"}),e.jsx("option",{value:6,children:"6 meses"}),e.jsx("option",{value:12,children:"12 meses"})]})]})}),r&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"ðŸ“Š Resumo da ProjeÃ§Ã£o"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Receita Total Projetada"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:v(r.receita_total)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Despesas Totais Projetadas"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:v(r.despesas_totais)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Saldo Total Projetado"}),e.jsx("p",{className:`text-2xl font-bold ${r.saldo_total>=0?"text-green-600":"text-red-600"}`,children:v(r.saldo_total)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Meses Positivos / Negativos"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[e.jsx("span",{className:"text-green-600",children:r.meses_positivos})," / ",e.jsx("span",{className:"text-red-600",children:r.meses_negativos})]})]})]}),e.jsx("div",{className:"flex justify-center mt-4",children:d(r.tendencia)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"ðŸ“… ProjeÃ§Ã£o MÃªs a MÃªs"})}),l?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Calculando projeÃ§Ã£o..."})]}):s.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"ðŸ“Š Sem dados suficientes"}),e.jsx("p",{className:"text-sm",children:"Ã‰ necessÃ¡rio ter pelo menos 3 meses de histÃ³rico para gerar projeÃ§Ãµes."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"MÃªs"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Receita Prevista"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Imposto Simples"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Folha + Encargos"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Despesas Totais"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Saldo Previsto"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(C=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[j[C.mes-1],"/",C.ano]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["+",C.mes_futuro," ",C.mes_futuro===1?"mÃªs":"meses"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-green-600 font-semibold",children:v(C.receita_prevista)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-orange-600",children:v(C.imposto_simples_previsto)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-blue-600",children:v(C.folha_encargos_previstos)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-red-600",children:v(C.despesas_previstas)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:m(C.saldo_previsto)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:C.saldo_positivo?e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800",children:"âœ“ Positivo"}):e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800",children:"âš  Negativo"})})]},C.mes_futuro))})]})})]}),e.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-900",children:e.jsx("strong",{children:"ðŸ’¡ Como funciona a projeÃ§Ã£o:"})}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-800 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"MÃ©dia de receitas dos Ãºltimos 3 meses (valores reais)"}),e.jsx("li",{children:"MÃ©dia de despesas fixas (custos + operacionais)"}),e.jsx("li",{children:"AlÃ­quota atual do Simples Nacional aplicada sobre receita projetada"}),e.jsx("li",{children:"Folha de pagamento + encargos (INSS + FGTS ~28%)"}),e.jsxs("li",{children:[e.jsx("strong",{children:"Sem chutes"})," â€“ Apenas dados reais + regras contÃ¡beis"]})]})]})]})}function Fp(){const[a,t]=n.useState({salario_base:"",inss_percentual:"20",fgts_percentual:"8",meses:"6",cargo:""}),[s,o]=n.useState(null),[r,i]=n.useState(!1),[l,x]=n.useState(!0),j=["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],g=y=>{const{name:c,value:f}=y.target;t(b=>({...b,[c]:f}))},v=async y=>{if(y.preventDefault(),!a.salario_base||parseFloat(a.salario_base)<=0){Ee.error("Informe um salÃ¡rio vÃ¡lido");return}i(!0);try{const c={salario_base:parseFloat(a.salario_base),inss_percentual:parseFloat(a.inss_percentual),fgts_percentual:parseFloat(a.fgts_percentual),meses:parseInt(a.meses),cargo:a.cargo||null},f=await F.post("/simulacao-contratacao/",c);f.data.sucesso&&(o(f.data.simulacao),Ee.success("SimulaÃ§Ã£o realizada com sucesso!"))}catch(c){console.error("Erro ao simular contrataÃ§Ã£o:",c),Ee.error("Erro ao realizar simulaÃ§Ã£o")}finally{i(!1)}},d=y=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(y),m=y=>new Intl.NumberFormat("pt-BR",{style:"percent",minimumFractionDigits:2,maximumFractionDigits:2}).format(y/100),C=()=>{o(null),t({salario_base:"",inss_percentual:"20",fgts_percentual:"8",meses:"6",cargo:""})};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"ðŸ§® SimulaÃ§Ã£o de ContrataÃ§Ã£o"}),e.jsx("p",{className:"text-gray-600",children:"Calcule o impacto real de contratar um funcionÃ¡rio no seu negÃ³cio"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ðŸ“ Dados da ContrataÃ§Ã£o"}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cargo (opcional)"}),e.jsx("input",{type:"text",name:"cargo",value:a.cargo,onChange:g,placeholder:"Ex: Atendente, VeterinÃ¡rio...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["SalÃ¡rio Base ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"salario_base",value:a.salario_base,onChange:g,placeholder:"Ex: 2000.00",step:"0.01",min:"0",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"INSS Patronal (%)"}),e.jsx("input",{type:"number",name:"inss_percentual",value:a.inss_percentual,onChange:g,step:"0.01",min:"0",max:"100",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"FGTS (%)"}),e.jsx("input",{type:"number",name:"fgts_percentual",value:a.fgts_percentual,onChange:g,step:"0.01",min:"0",max:"100",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Simular por quantos meses?"}),e.jsxs("select",{name:"meses",value:a.meses,onChange:g,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"3",children:"3 meses"}),e.jsx("option",{value:"6",children:"6 meses"}),e.jsx("option",{value:"12",children:"12 meses (1 ano)"}),e.jsx("option",{value:"24",children:"24 meses (2 anos)"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:r,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed",children:r?"Calculando...":"ðŸ§® Simular ContrataÃ§Ã£o"}),s&&e.jsx("button",{type:"button",onClick:C,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"ðŸ”„ Nova SimulaÃ§Ã£o"})]})]})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"ðŸ“Š Resumo Executivo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Custo Mensal MÃ©dio"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:d(s.totais.media_mensal)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[m(s.analise.custo_total_vs_salario)," do salÃ¡rio base"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:["Custo Total (",s.parametros.meses_simulados," meses)"]}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:d(s.totais.total_geral)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Encargos Totais"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:d(s.totais.total_inss+s.totais.total_fgts)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[m(s.analise.percentual_encargos)," do salÃ¡rio"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"ProvisÃµes Totais"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:d(s.totais.total_provisao_ferias+s.totais.total_provisao_1_3+s.totais.total_provisao_13)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[m(s.analise.percentual_provisoes)," do salÃ¡rio"]})]})]}),e.jsx("div",{className:"mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-900",children:[e.jsx("strong",{children:"âš ï¸ AtenÃ§Ã£o:"})," O custo real mensal Ã©"," ",e.jsx("strong",{children:d(s.totais.media_mensal)}),", nÃ£o apenas"," ",e.jsx("strong",{children:d(s.parametros.salario_base)}),". Isso representa um aumento de"," ",e.jsx("strong",{children:m(s.analise.custo_total_vs_salario-100)})," ","devido a encargos e provisÃµes obrigatÃ³rias."]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"ðŸ“… Detalhamento Mensal"}),e.jsx("button",{onClick:()=>x(!l),className:"text-sm text-blue-600 hover:text-blue-700",children:l?"â–¼ Ocultar detalhes":"â–¶ Mostrar detalhes"})]}),l&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"MÃªs"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SalÃ¡rio"}),e.jsxs("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:["INSS (",s.parametros.inss_percentual,"%)"]}),e.jsxs("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:["FGTS (",s.parametros.fgts_percentual,"%)"]}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"FÃ©rias (1/12)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"1/3 Const."}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"13Âº (1/12)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Custo Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.resultado_mensal.map(y=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[j[y.mes_calendario-1],"/",y.ano]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:d(y.salario)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-orange-600",children:d(y.inss)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-blue-600",children:d(y.fgts)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-green-600",children:d(y.provisao_ferias)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-green-600",children:d(y.provisao_1_3)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-green-600",children:d(y.provisao_13)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-gray-900",children:d(y.custo_total)})]},y.mes))}),e.jsx("tfoot",{className:"bg-gray-100 font-bold",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:"TOTAL"}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-gray-900",children:d(s.totais.total_salarios)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-orange-600",children:d(s.totais.total_inss)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-blue-600",children:d(s.totais.total_fgts)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-green-600",children:d(s.totais.total_provisao_ferias)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-green-600",children:d(s.totais.total_provisao_1_3)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-green-600",children:d(s.totais.total_provisao_13)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-gray-900",children:d(s.totais.total_geral)})]})})]})})]}),e.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-900",children:e.jsx("strong",{children:"ðŸ’¡ Como funciona esta simulaÃ§Ã£o:"})}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-800 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Nada Ã© gravado no banco"})," - Ã© apenas uma projeÃ§Ã£o"]}),e.jsx("li",{children:"Custos diretos: SalÃ¡rio + INSS patronal + FGTS"}),e.jsx("li",{children:"ProvisÃµes obrigatÃ³rias: FÃ©rias (1/12) + 1/3 constitucional + 13Âº (1/12)"}),e.jsx("li",{children:"NÃ£o considera: Vale-transporte, Vale-refeiÃ§Ã£o, Plano de saÃºde"}),e.jsx("li",{children:"Baseado nas mesmas regras do motor de provisÃµes real"})]})]})]})]})}function Pp(){const[a,t]=n.useState([]),[s,o]=n.useState(null),[r,i]=n.useState(!0),l=async()=>{try{i(!0);const d=await F.get("/cargos");t(d.data)}catch(d){console.error("Erro ao carregar cargos:",d),Ee.error("Erro ao carregar cargos")}finally{i(!1)}};n.useEffect(()=>{l()},[]);const x=()=>{o({nome:"",descricao:"",salario_base:"",inss_patronal_percentual:20,fgts_percentual:8,gera_ferias:!0,gera_decimo_terceiro:!0,ativo:!0})},j=async()=>{var d,m;if(!s.nome||!s.salario_base){Ee.error("Nome e salÃ¡rio sÃ£o obrigatÃ³rios");return}try{s.id?(await F.put(`/cargos/${s.id}`,s),Ee.success("Cargo atualizado com sucesso!")):(await F.post("/cargos",s),Ee.success("Cargo cadastrado com sucesso!")),o(null),l()}catch(C){console.error("Erro ao salvar cargo:",C),Ee.error(((m=(d=C.response)==null?void 0:d.data)==null?void 0:m.detail)||"Erro ao salvar cargo")}},g=async d=>{var m,C;try{await F.patch(`/cargos/${d.id}/status?ativo=${!d.ativo}`),Ee.success(`Cargo ${d.ativo?"inativado":"ativado"} com sucesso!`),l()}catch(y){console.error("Erro ao alterar status:",y),Ee.error(((C=(m=y.response)==null?void 0:m.data)==null?void 0:C.detail)||"Erro ao alterar status")}},v=d=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(d);return r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Cadastro de Cargos"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie cargos, defina salÃ¡rios e encargos que alimentam provisÃµes, DRE e simulaÃ§Ãµes"})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("button",{className:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors flex items-center gap-2",onClick:x,children:[e.jsx("span",{className:"text-xl",children:"+"})," Novo Cargo"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SalÃ¡rio Base"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"INSS %"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"FGTS %"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"FÃ©rias"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"13Âº"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ativo"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(d=>e.jsxs("tr",{className:d.ativo?"":"bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:d.nome}),d.descricao&&e.jsx("div",{className:"text-sm text-gray-500",children:d.descricao})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium text-green-600",children:v(d.salario_base)}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[Number(d.inss_patronal_percentual).toFixed(2),"%"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[Number(d.fgts_percentual).toFixed(2),"%"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${d.gera_ferias?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:d.gera_ferias?"Sim":"NÃ£o"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${d.gera_decimo_terceiro?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:d.gera_decimo_terceiro?"Sim":"NÃ£o"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${d.ativo?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:d.ativo?"Sim":"NÃ£o"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:[e.jsx("button",{className:"text-indigo-600 hover:text-indigo-900 mr-4",onClick:()=>o(d),children:"Editar"}),e.jsx("button",{className:`${d.ativo?"text-yellow-600 hover:text-yellow-900":"text-green-600 hover:text-green-900"}`,onClick:()=>g(d),children:d.ativo?"Inativar":"Ativar"})]})]},d.id))})]}),a.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"Nenhum cargo cadastrado"})})]}),s&&e.jsxs("div",{className:"mt-6 bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800 mb-4",children:s.id?"Editar Cargo":"Novo Cargo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Cargo *"}),e.jsx("input",{type:"text",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Ex: Vendedor, Tosador, Gerente",value:s.nome,onChange:d=>o({...s,nome:d.target.value})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"DescriÃ§Ã£o das responsabilidades...",rows:2,value:s.descricao,onChange:d=>o({...s,descricao:d.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SalÃ¡rio Base (R$) *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"0.00",value:s.salario_base,onChange:d=>o({...s,salario_base:d.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"INSS Patronal (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",value:s.inss_patronal_percentual,onChange:d=>o({...s,inss_patronal_percentual:d.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"FGTS (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",value:s.fgts_percentual,onChange:d=>o({...s,fgts_percentual:d.target.value})})]}),e.jsxs("div",{className:"md:col-span-2 flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.gera_ferias,onChange:d=>o({...s,gera_ferias:d.target.checked}),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Gera fÃ©rias"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.gera_decimo_terceiro,onChange:d=>o({...s,gera_decimo_terceiro:d.target.checked}),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Gera 13Âº"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.ativo,onChange:d=>o({...s,ativo:d.target.checked}),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Ativo"})]})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx("button",{className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors",onClick:j,children:"Salvar"}),e.jsx("button",{className:"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors",onClick:()=>o(null),children:"Cancelar"})]})]})]})}function Rp({funcionario:a,onClose:t}){const[s,o]=n.useState(null),[r,i]=n.useState(!1),l=async()=>{const g=await ia.get(`/funcionarios/${a.id}/provisoes`);o(g.data)};n.useEffect(()=>{l()},[]);const x=async()=>{var g,v;if(window.confirm("Confirmar concessÃ£o de fÃ©rias?")){i(!0);try{const d=new Date,m={mes:d.getMonth()+1,ano:d.getFullYear(),dias_ferias:30,data_pagamento:null};await ia.post(`/funcionarios/${a.id}/ferias`,m),await l(),alert("FÃ©rias concedidas com sucesso")}catch(d){console.error("Erro ao conceder fÃ©rias:",d),alert(((v=(g=d.response)==null?void 0:g.data)==null?void 0:v.detail)||"Erro ao conceder fÃ©rias")}finally{i(!1)}}},j=async g=>{var v,d;if(window.confirm(`Confirmar pagamento da ${g}Âª parcela do 13Âº?`)){i(!0);try{const m=new Date,C={mes:m.getMonth()+1,ano:m.getFullYear(),percentual:g===1?50:100,descricao_parcela:g===1?"1Âª Parcela":"2Âª Parcela",data_pagamento:null};await ia.post(`/funcionarios/${a.id}/decimo-terceiro`,C),await l(),alert("13Âº registrado com sucesso")}catch(m){console.error("Erro ao pagar 13Âº:",m),alert(((d=(v=m.response)==null?void 0:v.data)==null?void 0:d.detail)||"Erro ao pagar 13Âº")}finally{i(!1)}}};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded p-6 w-[500px]",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Eventos â€” ",a.nome]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"ProvisÃµes"}),e.jsxs("p",{children:["FÃ©rias: R$ ",Number(s.ferias||0).toFixed(2)]}),e.jsxs("p",{children:["13Âº: R$ ",Number(s.decimo_terceiro||0).toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{disabled:r,onClick:x,className:"w-full bg-blue-600 text-white py-2 rounded",children:"Conceder FÃ©rias"}),e.jsx("button",{disabled:r,onClick:()=>j(1),className:"w-full bg-green-600 text-white py-2 rounded",children:"Pagar 1Âª Parcela do 13Âº"}),e.jsx("button",{disabled:r,onClick:()=>j(2),className:"w-full bg-green-700 text-white py-2 rounded",children:"Pagar 2Âª Parcela do 13Âº"})]}),e.jsx("div",{className:"mt-4 text-right",children:e.jsx("button",{onClick:t,className:"text-gray-600 underline",children:"Fechar"})})]})}):null}function $p(){const[a,t]=n.useState([]),[s,o]=n.useState([]),[r,i]=n.useState(null),[l,x]=n.useState(""),[j,g]=n.useState("todos"),[v,d]=n.useState(null),m=async()=>{const u=await F.get("/funcionarios");t(u.data)},C=async()=>{const u=await F.get("/cargos");o(u.data.filter(h=>h.ativo))};n.useEffect(()=>{m(),C()},[]);const y=()=>{i({nome:"",cpf:"",email:"",telefone:"",cargo_id:"",ativo:!0})},c=async()=>{var h,p,k,N,w;if(!r.nome||!r.cargo_id){alert("Nome e cargo sÃ£o obrigatÃ³rios");return}const u={nome:r.nome,cargo_id:Number(r.cargo_id),ativo:r.ativo,email:((h=r.email)==null?void 0:h.trim())||null,telefone:((p=r.telefone)==null?void 0:p.trim())||null,cpf:((k=r.cpf)==null?void 0:k.trim())||null};try{r.id?await F.put(`/funcionarios/${r.id}`,u):await F.post("/funcionarios",u),i(null),m()}catch(S){console.error("Erro ao salvar funcionÃ¡rio:",S),alert(((w=(N=S.response)==null?void 0:N.data)==null?void 0:w.detail)||"Erro ao salvar funcionÃ¡rio")}},f=async u=>{window.confirm("Deseja inativar este funcionÃ¡rio?")&&(await F.delete(`/funcionarios/${u}`),m())},b=a.filter(u=>{const h=u.nome.toLowerCase().includes(l.toLowerCase())||(u.cpf||"").includes(l),p=j==="todos"||j==="ativos"&&u.ativo||j==="inativos"&&!u.ativo;return h&&p});return e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"FuncionÃ¡rios"}),e.jsxs("div",{className:"flex justify-between items-center mb-4 gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"border p-2 w-64",placeholder:"Buscar por nome ou CPF",value:l,onChange:u=>x(u.target.value)}),e.jsxs("select",{className:"border p-2 bg-white",value:j,onChange:u=>g(u.target.value),children:[e.jsx("option",{value:"todos",children:"Todos"}),e.jsx("option",{value:"ativos",children:"Ativos"}),e.jsx("option",{value:"inativos",children:"Inativos"})]})]}),e.jsx("button",{onClick:y,className:"bg-blue-600 text-white px-4 py-2 rounded",children:"+ Novo FuncionÃ¡rio"})]}),e.jsxs("table",{className:"w-full border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Nome"}),e.jsx("th",{className:"border p-2",children:"Cargo"}),e.jsx("th",{className:"border p-2",children:"SalÃ¡rio"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{children:b.map(u=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2",children:u.nome}),e.jsx("td",{className:"border p-2",children:u.cargo?u.cargo.nome:"-"}),e.jsx("td",{className:"border p-2",children:u.cargo?`R$ ${Number(u.cargo.salario_base).toFixed(2)}`:"-"}),e.jsx("td",{className:"border p-2",children:u.ativo?"Ativo":"Inativo"}),e.jsxs("td",{className:"border p-2 space-x-2",children:[e.jsx("button",{className:"text-purple-600",onClick:()=>d(u),children:"Eventos"}),e.jsx("button",{className:"text-blue-600",onClick:()=>{var h;return i({...u,cargo_id:(h=u.cargo)==null?void 0:h.id})},children:"Editar"}),u.ativo&&e.jsx("button",{className:"text-red-600",onClick:()=>f(u.id),children:"Inativar"})]})]},u.id))})]}),r&&e.jsxs("div",{className:"border rounded p-4 mt-6",children:[e.jsx("h3",{className:"font-semibold mb-3",children:r.id?"Editar FuncionÃ¡rio":"Novo FuncionÃ¡rio"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{className:"border p-2",placeholder:"Nome",value:r.nome,onChange:u=>i({...r,nome:u.target.value})}),e.jsx("input",{className:"border p-2",placeholder:"CPF",value:r.cpf||"",onChange:u=>i({...r,cpf:u.target.value})}),e.jsx("input",{className:"border p-2",placeholder:"Email",value:r.email||"",onChange:u=>i({...r,email:u.target.value})}),e.jsx("input",{className:"border p-2",placeholder:"Telefone",value:r.telefone||"",onChange:u=>i({...r,telefone:u.target.value})}),e.jsxs("select",{className:"border p-2 col-span-2",value:r.cargo_id,onChange:u=>i({...r,cargo_id:u.target.value}),children:[e.jsx("option",{value:"",children:"Selecione o cargo"}),s.map(u=>e.jsx("option",{value:u.id,children:u.nome},u.id))]})]}),e.jsxs("div",{className:"mt-4 space-x-2",children:[e.jsx("button",{onClick:c,className:"bg-green-600 text-white px-4 py-2 rounded",children:"Salvar"}),e.jsx("button",{onClick:()=>i(null),className:"bg-gray-400 text-white px-4 py-2 rounded",children:"Cancelar"})]})]}),v&&e.jsx(Rp,{funcionario:v,onClose:()=>d(null)})]})}function Ap(){const[a,t]=n.useState(!0),[s,o]=n.useState([]),[r,i]=n.useState([]),[l,x]=n.useState(null),[j,g]=n.useState(!1);n.useEffect(()=>{v()},[]);async function v(){t(!0);try{const[y,c]=await Promise.all([ia.get("/rotas-entrega/vendas-pendentes/listar"),ia.get("/configuracoes/entregas").catch(()=>({data:null}))]);o(Array.isArray(y.data)?y.data:[]),x(c.data)}catch(y){console.error(y),alert("Erro ao carregar vendas pendentes"),o([])}finally{t(!1)}}async function d(){var f,b,u;if(s.length===0){alert("NÃ£o hÃ¡ vendas para otimizar");return}if(!l||!l.logradouro){alert("âš ï¸ Configure o endereÃ§o da loja em ConfiguraÃ§Ãµes > Entregas antes de otimizar rotas");return}if(confirm(`âš ï¸ ATENÃ‡ÃƒO - ESTA OPERAÃ‡ÃƒO TEM CUSTO!

ðŸ’µ Custo estimado: 5 centavos
ðŸ“ Entregas a otimizar: ${s.length}
ðŸ—ºï¸ SerÃ¡ feita 1 chamada ao Google Maps API
ðŸ’¾ A ordem serÃ¡ salva no banco (nÃ£o cobra novamente)

Deseja continuar?`)){g(!0);try{console.log("ðŸ—ºï¸ Chamando endpoint de otimizaÃ§Ã£o...");const h=await ia.post("/rotas-entrega/vendas-pendentes/otimizar");console.log("âœ… Resposta da otimizaÃ§Ã£o:",h.data),alert(`âœ… ROTAS OTIMIZADAS COM SUCESSO!

${h.data.message}

Total otimizado: ${h.data.total_otimizado||s.length} entregas`),await v()}catch(h){console.error("âŒ Erro ao otimizar:",h),console.error("Detalhes:",(f=h.response)==null?void 0:f.data);const p=((u=(b=h.response)==null?void 0:b.data)==null?void 0:u.detail)||"Erro ao otimizar rotas. Verifique se o Google Maps estÃ¡ configurado.";alert(`âŒ ERRO AO OTIMIZAR ROTAS

${p}`)}finally{g(!1)}}}function m(y){i(c=>c.includes(y)?c.filter(f=>f!==y):[...c,y])}async function C(){var y,c;if(r.length===0){alert("Selecione pelo menos uma entrega");return}if(confirm(`Deseja criar uma rota com ${r.length} entrega(s)?`))try{t(!0);const f=s.filter(u=>r.includes(u.id)),b=f.filter(u=>!u.entregador_id);if(b.length>0){alert(`âŒ As seguintes vendas nÃ£o tÃªm entregador atribuÃ­do:
${b.map(u=>u.numero_venda).join(", ")}

Atribua um entregador antes de criar a rota.`),t(!1);return}await ia.post("/rotas-entrega/",{vendas_ids:r,entregador_id:f[0].entregador_id,moto_da_loja:!1}),alert(`âœ… Rota criada com ${r.length} entrega(s)!

As entregas foram movidas para "Rotas de Entrega"`),i([]),v()}catch(f){console.error(f),alert(((c=(y=f.response)==null?void 0:y.data)==null?void 0:c.detail)||"Erro ao criar rota. Verifique se todas as entregas tÃªm entregador atribuÃ­do.")}finally{t(!1)}}return a?e.jsx("div",{className:"page",children:"Carregando..."}):e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"Entregas em Aberto"}),e.jsx("p",{style:{color:"#666",marginBottom:20},children:"Vendas com entrega que estÃ£o aguardando iniciar a rota"}),!Array.isArray(s)||s.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"âœ… NÃ£o hÃ¡ entregas pendentes"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:20,display:"flex",gap:10,alignItems:"center"},children:[e.jsx("button",{onClick:d,disabled:j||a,className:"btn-secondary",title:"Reorganizar entregas usando Google Maps para menor distÃ¢ncia",children:j?"ðŸ”„ Otimizando...":"ðŸ—ºï¸ Otimizar Rotas"}),e.jsxs("span",{style:{color:"#666",fontSize:"0.9em"},children:["â„¹ï¸ ",s.filter(y=>y.ordem_otimizada).length>0?`${s.filter(y=>y.ordem_otimizada).length} entregas jÃ¡ otimizadas. `:"","Clique para ordenar pela rota mais eficiente"]})]}),e.jsxs("table",{className:"table-entregas",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:40},children:e.jsx("input",{type:"checkbox",checked:r.length===s.length&&s.length>0,onChange:y=>i(y.target.checked?s.map(c=>c.id):[])})}),e.jsx("th",{children:"Ordem"}),e.jsx("th",{children:"Venda"}),e.jsx("th",{children:"Data da Venda"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Entregador"}),e.jsx("th",{children:"EndereÃ§o"}),e.jsx("th",{children:"Taxa Entrega"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:s.map((y,c)=>e.jsxs("tr",{style:{backgroundColor:r.includes(y.id)?"#e3f2fd":y.ordem_otimizada?"#f0f8ff":"white"},children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:r.includes(y.id),onChange:()=>m(y.id)})}),e.jsx("td",{children:e.jsxs("strong",{style:{color:y.ordem_otimizada?"#007bff":"#999",fontSize:"1.1em"},children:[c+1,y.ordem_otimizada&&" ðŸ—ºï¸"]})}),e.jsx("td",{children:y.numero_venda}),e.jsx("td",{style:{fontSize:"0.9em"},children:y.data_venda?new Date(y.data_venda).toLocaleDateString("pt-BR"):"N/A"}),e.jsx("td",{children:y.cliente_nome}),e.jsx("td",{children:e.jsx("span",{style:{color:y.entregador_nome?"#28a745":"#999",fontWeight:y.entregador_nome?"600":"normal"},children:y.entregador_nome||"NÃ£o atribuÃ­do"})}),e.jsx("td",{style:{maxWidth:300,fontSize:"0.9em"},children:y.endereco_entrega||"N/A"}),e.jsxs("td",{children:["R$ ",parseFloat(y.taxa_entrega||0).toFixed(2)]}),e.jsxs("td",{children:["R$ ",parseFloat(y.total||0).toFixed(2)]}),e.jsx("td",{children:e.jsx("span",{style:{padding:"4px 8px",borderRadius:4,fontSize:12,fontWeight:"bold",color:"#fff",backgroundColor:"#ffa500"},children:"AGUARDANDO"})})]},y.id))})]}),e.jsxs("div",{style:{marginTop:20,display:"flex",gap:10},children:[e.jsxs("button",{onClick:C,disabled:r.length===0||a,className:"btn-primary",style:{backgroundColor:r.length>0?"#28a745":"#ccc",cursor:r.length>0?"pointer":"not-allowed"},children:["âœ… Criar Rota (",r.length," selecionada",r.length!==1?"s":"",")"]}),e.jsx("span",{style:{color:"#666",fontSize:"0.9em",alignSelf:"center"},children:"ðŸ’¡ Selecione as entregas e clique para criar uma rota"})]})]})]})}function Dp(){const a=va(),[t,s]=n.useState([]),[o,r]=n.useState(!0),[i,l]=n.useState(""),[x,j]=n.useState(null);n.useEffect(()=>{g()},[i]);async function g(){try{r(!0);const h=new URLSearchParams;i&&h.append("status",i);const p=await F.get(`/rotas-entrega/?${h.toString()}`);s(p.data)}catch(h){console.error("Erro ao carregar rotas:",h),alert("Erro ao carregar rotas de entrega")}finally{r(!1)}}function v(h){j(x===h?null:h)}async function d(h,p){try{const k=p.map(N=>N.id);await F.put(`/rotas-entrega/${h}/paradas/reordenar`,k),s(N=>N.map(w=>w.id===h?{...w,paradas:p.map((S,P)=>({...S,ordem:P+1}))}:w)),alert("Ordem das paradas atualizada!")}catch(k){console.error("Erro ao reordenar paradas:",k),alert("Erro ao reordenar paradas")}}async function m(h){var k,N;if(!confirm("Deseja iniciar esta rota? Uma mensagem serÃ¡ enviada ao primeiro cliente."))return;const p=prompt(`ðŸï¸ Digite o KM atual da moto (opcional):

Deixe em branco se nÃ£o quiser registrar.`);try{const w={};p&&!isNaN(p)&&parseFloat(p)>0&&(w.km_inicial=parseFloat(p)),await F.post(`/rotas-entrega/${h}/iniciar`,null,{params:w}),alert("âœ… Rota iniciada! Mensagem enviada ao primeiro cliente."),g()}catch(w){console.error("Erro ao iniciar rota:",w);const S=((N=(k=w.response)==null?void 0:k.data)==null?void 0:N.detail)||"Erro ao iniciar rota";alert(`âŒ ${S}`)}}async function C(h){var p,k;if(confirm(`âš ï¸ Tem certeza que deseja excluir esta rota?

As vendas voltarÃ£o para a listagem de entregas pendentes.`))try{const N=await F.delete(`/rotas-entrega/${h}`),{total_vendas:w}=N.data;alert(`âœ… Rota excluÃ­da com sucesso!
${w} venda(s) voltaram para entregas pendentes.`),g()}catch(N){console.error("Erro ao excluir rota:",N);const w=((k=(p=N.response)==null?void 0:p.data)==null?void 0:k.detail)||"Erro ao excluir rota";alert(`âŒ ${w}`)}}async function y(h){var p,k;if(confirm(`â†©ï¸ Reverter inÃ­cio desta rota?

A rota voltarÃ¡ para status pendente e vocÃª poderÃ¡ adicionar mais entregas.`))try{await F.post(`/rotas-entrega/${h}/reverter-inicio`),alert("âœ… Rota revertida para pendente! Agora vocÃª pode adicionar mais entregas."),g()}catch(N){console.error("Erro ao reverter rota:",N);const w=((k=(p=N.response)==null?void 0:p.data)==null?void 0:k.detail)||"Erro ao reverter inÃ­cio da rota";alert(`âŒ ${w}`)}}function c(h){if(!h.paradas||h.paradas.length===0)return null;const p=h.paradas[h.paradas.length-1];return p.tempo_acumulado?p.tempo_acumulado:null}function f(h){if(!h)return"N/A";const p=Math.floor(h/60),k=Math.floor(p/60),N=p%60;return k>0?`${k}h${N}min`:`${N}min`}function b(h){switch(h){case"pendente":return"#FFA500";case"em_andamento":return"#007BFF";case"em_rota":return"#007BFF";case"concluida":return"#28A745";case"cancelada":return"#DC3545";default:return"#6C757D"}}function u(h){switch(h){case"pendente":return"ðŸŸ  Pendente";case"em_andamento":return"ðŸ”µ Em Andamento";case"em_rota":return"ðŸ”µ Em Rota";case"concluida":return"âœ… ConcluÃ­da";case"cancelada":return"âŒ Cancelada";default:return h}}return o?e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"Rotas de Entrega"}),e.jsx("p",{children:"Carregando rotas..."})]}):e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"Rotas de Entrega"}),e.jsx("p",{style:{color:"#666",marginBottom:20},children:"Rotas criadas e em andamento"}),e.jsxs("div",{style:{marginBottom:20,display:"flex",gap:10,alignItems:"center"},children:[e.jsxs("label",{children:["Filtrar por status:",e.jsxs("select",{value:i,onChange:h=>l(h.target.value),style:{marginLeft:10,padding:"5px 10px"},children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"pendente",children:"Pendente"}),e.jsx("option",{value:"em_andamento",children:"Em Andamento"}),e.jsx("option",{value:"concluida",children:"ConcluÃ­da"}),e.jsx("option",{value:"cancelada",children:"Cancelada"})]})]}),e.jsx("button",{onClick:g,className:"btn-secondary",style:{marginLeft:"auto"},children:"ðŸ”„ Atualizar"})]}),!Array.isArray(t)||t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"Nenhuma rota encontrada"}),e.jsx("button",{onClick:()=>a("/entregas/abertas"),className:"btn-primary",style:{marginTop:10},children:"Criar Nova Rota"})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:15},children:t.map(h=>e.jsx(Mp,{rota:h,expandida:x===h.id,onToggleExpand:()=>v(h.id),onReordenar:d,onIniciarRota:m,onExcluirRota:C,onReverterInicio:y,getStatusColor:b,getStatusLabel:u,calcularTempoEstimado:c,formatarTempo:f},h.id))})]})}function Mp({rota:a,expandida:t,onToggleExpand:s,onReordenar:o,onIniciarRota:r,onExcluirRota:i,onReverterInicio:l,getStatusColor:x,getStatusLabel:j,calcularTempoEstimado:g,formatarTempo:v}){var B,_;const[d,m]=n.useState(a.paradas||[]),[C,y]=n.useState(null),[c,f]=n.useState(null),[b,u]=n.useState(null),[h,p]=n.useState(!1),[k,N]=n.useState(null),[w,S]=n.useState(null),[P,W]=n.useState(!1);n.useEffect(()=>{m(a.paradas||[])},[a.paradas]);const te=g(a),D=d.filter(O=>O.status!=="entregue").length,A=d.length>0&&D===0;async function X(O,q){var ae,H,le;try{p(!0),f(O);const G=await F.get(`/vendas/${q}`);console.log("ðŸ“¦ Detalhes da venda carregados:",G.data),console.log("ðŸ“ž Telefones do cliente:",{telefone:(ae=G.data.cliente)==null?void 0:ae.telefone,celular:(H=G.data.cliente)==null?void 0:H.celular,email:(le=G.data.cliente)==null?void 0:le.email}),u(G.data)}catch(G){console.error("Erro ao carregar detalhes da venda:",G),alert("Erro ao carregar detalhes da venda"),f(null)}finally{p(!1)}}function re(){f(null),u(null)}async function M(O,q){var H,le;if(!confirm(`âœ… Confirmar entrega realizada?

Uma mensagem serÃ¡ enviada automaticamente para o prÃ³ximo cliente da rota.`))return;const ae=prompt(`ðŸï¸ Digite o KM atual da moto (opcional):

Deixe em branco se nÃ£o quiser registrar.`);try{N(O);const G={};ae&&!isNaN(ae)&&parseFloat(ae)>0&&(G.km_entrega=parseFloat(ae));const ee=await F.post(`/rotas-entrega/${q}/paradas/${O}/marcar-entregue`,null,{params:G});alert("âœ… "+ee.data.message),m(de=>de.map(ue=>ue.id===O?{...ue,status:"entregue",data_entrega:new Date().toISOString(),km_entrega:ae?parseFloat(ae):null}:ue)),window.location.reload()}catch(G){console.error("Erro ao marcar entrega:",G);const ee=((le=(H=G.response)==null?void 0:H.data)==null?void 0:le.detail)||"Erro ao marcar entrega como concluÃ­da";alert("âŒ "+ee)}finally{N(null)}}async function Z(O,q){const ae=prompt(`ðŸ“‹ Digite a observaÃ§Ã£o sobre esta entrega:

(Ex: 'Sempre entregar no vizinho', 'Chamar na casa da frente')`);if(!(!ae||ae.trim()===""))try{await F.put(`/rotas-entrega/${q}/paradas/${O}/observacao`,null,{params:{observacao:ae.trim()}}),alert("âœ… ObservaÃ§Ã£o salva com sucesso!"),m(H=>H.map(le=>le.id===O?{...le,observacoes:ae.trim()}:le))}catch(H){console.error("Erro ao salvar observaÃ§Ã£o:",H),alert("âŒ Erro ao salvar observaÃ§Ã£o")}}async function $(O,q,ae){const H=prompt(`âš ï¸ Por que a entrega nÃ£o foi realizada?

(Ex: 'Cliente ausente', 'CartÃ£o recusado', 'EndereÃ§o nÃ£o encontrado')`);if(!(!H||H.trim()==="")&&confirm(`âš ï¸ Confirmar que a entrega NÃƒO foi realizada?

A venda voltarÃ¡ para entregas em aberto.`))try{S(O),await F.post(`/rotas-entrega/${q}/paradas/${O}/nao-entregue`,null,{params:{motivo:H.trim()}}),alert("âœ… Entrega marcada como nÃ£o realizada. Venda #"+ae+" voltou para entregas em aberto."),window.location.reload()}catch(le){console.error("Erro ao marcar como nÃ£o entregue:",le),alert("âŒ Erro ao processar")}finally{S(null)}}async function J(O,q){var G,ee;const ae=prompt(`ðŸï¸ Digite o KM final da moto (opcional):

Deixe em branco se nÃ£o quiser registrar.`);let H=null;if(q&&ae&&!isNaN(ae)&&parseFloat(ae)>parseFloat(q)){const de=(parseFloat(ae)-parseFloat(q)).toFixed(2);confirm(`ðŸ“ DistÃ¢ncia calculada: ${de} km

KM Inicial: ${q}
KM Final: ${ae}

Deseja usar esta distÃ¢ncia?`)&&(H=parseFloat(de))}if(!H){const de=prompt(`ðŸ“ Digite a distÃ¢ncia percorrida em km (opcional):

Deixe em branco se nÃ£o souber.`);de&&!isNaN(de)&&parseFloat(de)>0&&(H=parseFloat(de))}const le=prompt("ðŸ“‹ ObservaÃ§Ãµes sobre a rota (opcional):")||"";if(confirm(`âœ… Finalizar esta rota?

Esta aÃ§Ã£o nÃ£o pode ser desfeita.`))try{W(!0);const de={observacoes:le.trim()};ae&&!isNaN(ae)&&parseFloat(ae)>0&&(de.km_final=parseFloat(ae)),H&&(de.distancia_real=H),await F.post(`/rotas-entrega/${O}/fechar`,de),alert("âœ… Rota finalizada com sucesso!"),window.location.reload()}catch(de){console.error("Erro ao finalizar rota:",de);const ue=((ee=(G=de.response)==null?void 0:G.data)==null?void 0:ee.detail)||"Erro ao finalizar rota";alert("âŒ "+ue)}finally{W(!1)}}const E=(O,q)=>{y(q),O.dataTransfer.effectAllowed="move"},R=(O,q)=>{if(O.preventDefault(),C===null||C===q)return;const ae=[...d],H=ae[C];ae.splice(C,1),ae.splice(q,0,H),m(ae),y(q)},K=()=>{C!==null&&o(a.id,d),y(null)};return e.jsxs("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:15,backgroundColor:"#fff"},children:[e.jsxs("div",{style:{cursor:"pointer",transition:"all 0.2s"},onClick:s,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("h3",{style:{margin:0,marginBottom:10},children:["ðŸšš ",a.numero||`Rota #${a.id}`,t?" ðŸ”½":" â–¶ï¸"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5,color:"#555"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Entregador:"})," ",((B=a.entregador)==null?void 0:B.nome)||"NÃ£o informado"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Paradas:"})," ",((_=a.paradas)==null?void 0:_.length)||0," entrega(s)"]}),a.distancia_prevista&&e.jsxs("div",{children:[e.jsx("strong",{children:"DistÃ¢ncia Prevista:"})," ",a.distancia_prevista," km"]}),te&&e.jsxs("div",{children:[e.jsx("strong",{children:"Tempo Estimado:"})," ",v(te)]}),a.km_inicial&&e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ KM Inicial:"})," ",parseFloat(a.km_inicial).toFixed(1)," km"]}),a.km_final&&e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ KM Final:"})," ",parseFloat(a.km_final).toFixed(1)," km"]}),a.km_inicial&&a.km_final&&e.jsxs("div",{style:{color:"#007BFF",fontWeight:"600"},children:[e.jsx("strong",{children:"ðŸ“ Total Rodado:"})," ",(parseFloat(a.km_final)-parseFloat(a.km_inicial)).toFixed(1)," km",a.distancia_prevista&&(()=>{const O=parseFloat(a.km_final)-parseFloat(a.km_inicial),q=parseFloat(a.distancia_prevista),ae=O-q,H=(ae/q*100).toFixed(1);return e.jsxs("span",{style:{marginLeft:10,color:ae>0?"#DC3545":"#28A745",fontSize:13},children:["(",ae>0?"+":"",ae.toFixed(1)," km / ",H>0?"+":"",H,"% vs projetado)"]})})()]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Criada em:"})," ",new Date(a.created_at).toLocaleString("pt-BR")]}),a.data_conclusao&&e.jsxs("div",{children:[e.jsx("strong",{children:"ConcluÃ­da em:"})," ",new Date(a.data_conclusao).toLocaleString("pt-BR")]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[a.status==="pendente"&&e.jsx("button",{onClick:O=>{O.stopPropagation(),r(a.id)},style:{padding:"8px 16px",backgroundColor:"#28A745",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontWeight:"bold",fontSize:14,display:"flex",alignItems:"center",gap:5},children:"ðŸš€ Iniciar Rota"}),(a.status==="em_rota"||a.status==="em_andamento")&&A&&e.jsx("button",{onClick:O=>{O.stopPropagation(),J(a.id,a.km_inicial)},disabled:P,style:{padding:"8px 16px",backgroundColor:P?"#ccc":"#007BFF",color:"#fff",border:"none",borderRadius:6,cursor:P?"not-allowed":"pointer",fontWeight:"bold",fontSize:14,display:"flex",alignItems:"center",gap:5},children:P?"â³ Processando...":"âœ… Finalizar Rota"}),(a.status==="em_rota"||a.status==="em_andamento")&&D===d.length&&e.jsx("button",{onClick:O=>{O.stopPropagation(),l(a.id)},style:{padding:"8px 16px",backgroundColor:"#FFC107",color:"#000",border:"none",borderRadius:6,cursor:"pointer",fontWeight:"bold",fontSize:14,display:"flex",alignItems:"center",gap:5},children:"â†©ï¸ Reverter InÃ­cio"}),(a.status==="pendente"||a.status==="em_rota"||a.status==="em_andamento")&&e.jsx("button",{onClick:O=>{O.stopPropagation(),i(a.id)},style:{padding:"8px 16px",backgroundColor:"#DC3545",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontWeight:"bold",fontSize:14,display:"flex",alignItems:"center",gap:5},children:"ðŸ—‘ï¸ Excluir"}),e.jsx("div",{style:{padding:"5px 15px",borderRadius:20,backgroundColor:x(a.status),color:"#fff",fontWeight:"bold",fontSize:14,whiteSpace:"nowrap"},children:j(a.status)})]})]}),a.observacoes&&e.jsxs("div",{style:{marginTop:10,padding:10,backgroundColor:"#f8f9fa",borderRadius:5,fontSize:14,color:"#666"},children:[e.jsx("strong",{children:"ObservaÃ§Ãµes:"})," ",a.observacoes]})]}),t&&d.length>0&&e.jsxs("div",{style:{marginTop:20,borderTop:"2px solid #eee",paddingTop:15},children:[e.jsx("h4",{style:{marginBottom:15},children:"ðŸ“ Paradas da Rota (arraste para reordenar)"}),d.map((O,q)=>{var ae,H,le,G;return e.jsxs("div",{children:[e.jsxs("div",{draggable:!0,onDragStart:ee=>E(ee,q),onDragOver:ee=>R(ee,q),onDragEnd:K,style:{padding:12,marginBottom:10,border:"1px solid #ddd",borderRadius:6,backgroundColor:C===q?"#f0f8ff":"#fafafa",cursor:"move",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:5},children:[e.jsxs("span",{style:{fontWeight:"bold",marginRight:10,fontSize:18,color:"#007BFF"},children:[O.ordem,"Âº"]}),e.jsxs("span",{style:{color:"#666",fontSize:14},children:["Venda #",O.venda_id]}),O.status&&e.jsx("span",{style:{marginLeft:10,padding:"2px 8px",borderRadius:12,fontSize:12,backgroundColor:O.status==="entregue"?"#d4edda":O.status==="tentativa"?"#fff3cd":"#e2e3e5",color:O.status==="entregue"?"#155724":O.status==="tentativa"?"#856404":"#383d41"},children:O.status==="entregue"?"âœ“ Entregue":O.status==="tentativa"?"âš  Tentativa":"Pendente"})]}),e.jsxs("div",{style:{fontSize:13,color:"#333",lineHeight:1.6},children:[O.cliente_nome&&e.jsxs("div",{style:{marginBottom:4},children:[e.jsxs("strong",{style:{color:"#1565C0"},children:["ðŸ‘¤ ",O.cliente_nome]}),O.cliente_telefone&&e.jsxs("span",{style:{marginLeft:12,color:"#555"},children:["ðŸ“ž ",O.cliente_telefone]}),O.cliente_celular&&e.jsxs("span",{style:{marginLeft:12,color:"#555"},children:["ðŸ“± ",O.cliente_celular]})]}),e.jsxs("div",{style:{color:"#555"},children:["ðŸ“ ",O.endereco,O.distancia_acumulada&&e.jsxs("span",{style:{marginLeft:12,color:"#777"},children:["â€¢ Dist: ",O.distancia_acumulada," km"]}),O.tempo_acumulado&&e.jsxs("span",{style:{marginLeft:12,color:"#777"},children:["â€¢ Tempo aprox: ",v(O.tempo_acumulado)]})]})]}),O.data_entrega&&e.jsxs("div",{style:{color:"#28a745",fontSize:12,marginTop:3},children:["âœ“ Entregue em: ",new Date(O.data_entrega).toLocaleString("pt-BR")]}),O.observacoes&&e.jsxs("div",{style:{marginTop:6,padding:6,backgroundColor:"#fff3cd",borderRadius:4,fontSize:12,color:"#856404",border:"1px solid #ffc107"},children:["ðŸ“‹ ",O.observacoes]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,alignItems:"flex-end"},children:[O.status!=="entregue"&&a.status==="em_rota"&&e.jsx("button",{onClick:ee=>{ee.stopPropagation(),M(O.id,a.id)},disabled:k===O.id,style:{padding:"8px 12px",backgroundColor:k===O.id?"#ccc":"#28A745",color:"#fff",border:"none",borderRadius:6,cursor:k===O.id?"not-allowed":"pointer",fontWeight:"600",fontSize:12,whiteSpace:"nowrap",width:"130px",textAlign:"center"},children:k===O.id?"â³...":"âœ… Entregue"}),O.status!=="entregue"&&(a.status==="em_rota"||a.status==="em_andamento")&&e.jsx("button",{onClick:ee=>{ee.stopPropagation(),$(O.id,a.id,O.venda_id)},disabled:w===O.id,style:{padding:"8px 12px",backgroundColor:w===O.id?"#ccc":"#FFC107",color:"#000",border:"none",borderRadius:6,cursor:w===O.id?"not-allowed":"pointer",fontWeight:"600",fontSize:12,whiteSpace:"nowrap",width:"130px",textAlign:"center"},children:w===O.id?"â³...":"âš ï¸ Falta Entregar"}),e.jsx("button",{onClick:ee=>{ee.stopPropagation(),Z(O.id,a.id)},style:{padding:"8px 12px",backgroundColor:"#6C757D",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:"600",whiteSpace:"nowrap",width:"130px",textAlign:"center"},children:"ðŸ“ ObservaÃ§Ã£o"}),e.jsx("button",{onClick:ee=>{ee.stopPropagation(),c===O.id?re():X(O.id,O.venda_id)},style:{padding:"8px 12px",backgroundColor:"#17A2B8",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:"600",whiteSpace:"nowrap",width:"130px",textAlign:"center"},children:"ðŸ“„ Detalhes"})]})]}),c===O.id&&e.jsx("div",{style:{marginTop:0,marginBottom:15,padding:15,backgroundColor:"#f8f9fa",borderRadius:8,border:"2px solid #007BFF",boxShadow:"0 2px 8px rgba(0,123,255,0.2)"},children:h?e.jsx("div",{style:{textAlign:"center",color:"#666",padding:20},children:"Carregando detalhes da venda..."}):b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:15,borderBottom:"2px solid #007BFF",paddingBottom:10},children:[e.jsxs("h4",{style:{margin:0,color:"#007BFF"},children:["ðŸ§¾ Detalhes da Venda #",b.id]}),e.jsx("button",{onClick:ee=>{ee.stopPropagation(),re()},style:{background:"#dc3545",color:"#fff",border:"none",borderRadius:4,padding:"6px 12px",cursor:"pointer",fontWeight:"bold",fontSize:13},children:"âœ• Fechar"})]}),e.jsx("div",{style:{backgroundColor:"#e7f3ff",padding:12,borderRadius:6,marginBottom:15,border:"1px solid #007BFF"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,fontSize:14},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ‘¤ Cliente:"})," ",((ae=b.cliente)==null?void 0:ae.nome)||b.nome_cliente||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ“… Data:"})," ",b.data_venda?new Date(b.data_venda).toLocaleString("pt-BR"):"N/A"]}),((H=b.cliente)==null?void 0:H.telefone)&&e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ“ž Telefone:"})," ",b.cliente.telefone]}),((le=b.cliente)==null?void 0:le.celular)&&e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ“± Celular:"})," ",b.cliente.celular]}),((G=b.cliente)==null?void 0:G.email)&&e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("strong",{children:"ðŸ“§ Email:"})," ",b.cliente.email]})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,fontSize:14,marginBottom:15},children:[e.jsxs("div",{style:{padding:10,backgroundColor:"#d4edda",borderRadius:4,border:"1px solid #28a745"},children:[e.jsx("div",{style:{fontSize:11,color:"#155724",marginBottom:3},children:"VALOR TOTAL"}),e.jsxs("div",{style:{fontWeight:"bold",fontSize:16,color:"#155724"},children:["R$ ",parseFloat(b.valor_total||b.total||0).toFixed(2)]})]}),e.jsxs("div",{style:{padding:10,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[e.jsx("div",{style:{fontSize:11,color:"#666",marginBottom:3},children:"PAGAMENTO"}),e.jsx("div",{style:{fontWeight:"bold",fontSize:14},children:b.forma_pagamento||"N/A"})]}),e.jsxs("div",{style:{padding:10,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[e.jsx("div",{style:{fontSize:11,color:"#666",marginBottom:3},children:"STATUS"}),e.jsx("div",{style:{fontWeight:"bold",fontSize:14},children:b.status_pagamento||"N/A"})]})]}),b.endereco_entrega&&e.jsxs("div",{style:{padding:12,backgroundColor:"#e3f2fd",borderRadius:6,marginBottom:15,border:"1px solid #2196F3"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:5,color:"#1976D2"},children:"ðŸ“ EndereÃ§o de Entrega"}),e.jsx("div",{style:{color:"#424242",fontSize:14},children:b.endereco_entrega})]}),b.observacoes&&e.jsxs("div",{style:{padding:12,backgroundColor:"#fff3cd",borderRadius:6,marginBottom:15,border:"1px solid #ffc107"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:5,color:"#f57c00"},children:"ðŸ’¬ ObservaÃ§Ãµes"}),e.jsx("div",{style:{color:"#424242",fontSize:14},children:b.observacoes})]}),b.itens&&b.itens.length>0&&e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold",fontSize:15,marginBottom:10,color:"#424242"},children:["ðŸ›’ Itens da Venda (",b.itens.length,")"]}),e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:6,border:"1px solid #ddd",overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[b.itens.map((ee,de)=>{var ue,Ae,se,we;return e.jsxs("div",{style:{padding:12,borderBottom:de<b.itens.length-1?"1px solid #eee":"none",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:de%2===0?"#fafafa":"#fff"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"600",marginBottom:3,color:"#333"},children:((ue=ee.produto)==null?void 0:ue.nome)||((Ae=ee.servico)==null?void 0:Ae.nome)||ee.produto_nome||ee.servico_descricao||"Item"}),(((se=ee.produto)==null?void 0:se.codigo)||ee.produto_codigo)&&e.jsxs("div",{style:{fontSize:12,color:"#999"},children:["CÃ³d: ",((we=ee.produto)==null?void 0:we.codigo)||ee.produto_codigo]})]}),e.jsxs("div",{style:{textAlign:"right",minWidth:120},children:[e.jsxs("div",{style:{color:"#666",fontSize:13,marginBottom:2},children:[ee.quantidade," Ã— R$ ",parseFloat(ee.valor_unitario||ee.preco_unitario||0).toFixed(2)]}),e.jsxs("div",{style:{fontSize:15,color:"#28a745",fontWeight:"bold"},children:["R$ ",parseFloat((ee.quantidade||0)*(ee.valor_unitario||ee.preco_unitario||0)).toFixed(2)]})]})]},de)}),e.jsxs("div",{style:{padding:14,backgroundColor:"#1976D2",display:"flex",justifyContent:"space-between",alignItems:"center",color:"#fff"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:16},children:"TOTAL DA VENDA"}),e.jsxs("span",{style:{fontWeight:"bold",fontSize:18},children:["R$ ",parseFloat(b.valor_total||b.total||0).toFixed(2)]})]})]})]})]}):null})]},O.id)})]})]})}function Lp(){const[a,t]=n.useState([]),[s,o]=n.useState(!0),[r,i]=n.useState(null);n.useEffect(()=>{l()},[]);async function l(){try{o(!0);const j=await F.get("/rotas-entrega/?status=concluida");t(j.data)}catch(j){console.error("Erro ao carregar histÃ³rico:",j),alert("Erro ao carregar histÃ³rico de entregas")}finally{o(!1)}}function x(j){i(r===j?null:j)}return s?e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"ðŸ“œ HistÃ³rico de Entregas"}),e.jsx("p",{children:"Carregando histÃ³rico..."})]}):e.jsxs("div",{className:"page",children:[e.jsx("h1",{children:"ðŸ“œ HistÃ³rico de Entregas"}),e.jsx("p",{style:{color:"#666",marginBottom:20},children:"Rotas finalizadas e conferidas"}),e.jsx("div",{style:{marginBottom:20,display:"flex",gap:10,alignItems:"center"},children:e.jsx("button",{onClick:l,className:"btn-secondary",style:{marginLeft:"auto"},children:"ðŸ”„ Atualizar"})}),!Array.isArray(a)||a.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"Nenhuma rota finalizada encontrada"})}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:15},children:a.map(j=>{var g,v;return e.jsxs("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:15,backgroundColor:"#fff"},children:[e.jsx("div",{style:{cursor:"pointer"},onClick:()=>x(j.id),children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("h3",{style:{margin:0,marginBottom:10},children:["ðŸšš ",j.numero||`Rota #${j.id}`,r===j.id?" ðŸ”½":" â–¶ï¸"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:10,color:"#555",fontSize:14},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Entregador:"})," ",((g=j.entregador)==null?void 0:g.nome)||"NÃ£o informado"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Paradas:"})," ",((v=j.paradas)==null?void 0:v.length)||0," entrega(s)"]}),j.distancia_prevista&&e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ“ Previsto:"})," ",parseFloat(j.distancia_prevista).toFixed(1)," km"]}),j.km_inicial&&e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ KM Inicial:"})," ",parseFloat(j.km_inicial).toFixed(1)]}),j.km_final&&e.jsxs("div",{children:[e.jsx("strong",{children:"ðŸ KM Final:"})," ",parseFloat(j.km_final).toFixed(1)]}),j.km_inicial&&j.km_final&&e.jsxs("div",{style:{color:"#007BFF",fontWeight:"600"},children:[e.jsx("strong",{children:"ðŸ“ Total:"})," ",(parseFloat(j.km_final)-parseFloat(j.km_inicial)).toFixed(1)," km",j.distancia_prevista&&(()=>{const d=parseFloat(j.km_final)-parseFloat(j.km_inicial),m=parseFloat(j.distancia_prevista),C=d-m,y=(C/m*100).toFixed(1);return e.jsxs("div",{style:{fontSize:12,color:C>0?"#DC3545":"#28A745",marginTop:2},children:[C>0?"â†‘":"â†“"," ",Math.abs(C).toFixed(1)," km (",C>0?"+":"",y,"%)"]})})()]}),j.distancia_real&&!(j.km_inicial&&j.km_final)&&e.jsxs("div",{children:[e.jsx("strong",{children:"DistÃ¢ncia:"})," ",parseFloat(j.distancia_real).toFixed(1)," km"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"ConcluÃ­da em:"})," ",new Date(j.data_conclusao).toLocaleString("pt-BR")]}),j.custo_real&&e.jsxs("div",{children:[e.jsx("strong",{children:"Custo:"})," R$ ",parseFloat(j.custo_real).toFixed(2)]})]}),j.observacoes&&e.jsxs("div",{style:{marginTop:10,padding:10,backgroundColor:"#f8f9fa",borderRadius:5,fontSize:14,color:"#666"},children:[e.jsx("strong",{children:"ObservaÃ§Ãµes:"})," ",j.observacoes]})]}),e.jsx("div",{style:{padding:"5px 15px",borderRadius:20,backgroundColor:"#28A745",color:"#fff",fontWeight:"bold",fontSize:14,whiteSpace:"nowrap"},children:"âœ… ConcluÃ­da"})]})}),r===j.id&&j.paradas&&j.paradas.length>0&&e.jsxs("div",{style:{marginTop:20,borderTop:"2px solid #eee",paddingTop:15},children:[e.jsx("h4",{style:{marginBottom:15},children:"ðŸ“ Entregas da Rota"}),j.paradas.map(d=>e.jsx("div",{style:{padding:12,marginBottom:10,border:"1px solid #ddd",borderRadius:6,backgroundColor:d.status==="entregue"?"#f0fff4":"#fafafa"},children:e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:5},children:[e.jsxs("span",{style:{fontWeight:"bold",marginRight:10,fontSize:18,color:"#007BFF"},children:[d.ordem,"Âº"]}),e.jsxs("span",{style:{color:"#666",fontSize:14},children:["Venda #",d.venda_id]}),e.jsx("span",{style:{marginLeft:10,padding:"2px 8px",borderRadius:12,fontSize:12,backgroundColor:d.status==="entregue"?"#d4edda":"#e2e3e5",color:d.status==="entregue"?"#155724":"#383d41"},children:d.status==="entregue"?"âœ“ Entregue":d.status})]}),e.jsxs("div",{style:{fontSize:13,color:"#333",lineHeight:1.6},children:[d.cliente_nome&&e.jsxs("div",{style:{marginBottom:4},children:[e.jsxs("strong",{style:{color:"#1565C0"},children:["ðŸ‘¤ ",d.cliente_nome]}),d.cliente_telefone&&e.jsxs("span",{style:{marginLeft:12,color:"#555"},children:["ðŸ“ž ",d.cliente_telefone]}),d.cliente_celular&&e.jsxs("span",{style:{marginLeft:12,color:"#555"},children:["ðŸ“± ",d.cliente_celular]})]}),e.jsxs("div",{style:{color:"#555"},children:["ðŸ“ ",d.endereco,d.distancia_acumulada&&e.jsxs("span",{style:{marginLeft:12,color:"#777"},children:["â€¢ Dist: ",d.distancia_acumulada," km"]}),d.km_entrega&&e.jsxs("span",{style:{marginLeft:12,color:"#777"},children:["â€¢ KM: ",d.km_entrega]})]})]}),d.data_entrega&&e.jsxs("div",{style:{color:"#28a745",fontSize:12,marginTop:3},children:["âœ“ Entregue em: ",new Date(d.data_entrega).toLocaleString("pt-BR")]}),d.observacoes&&e.jsxs("div",{style:{marginTop:6,padding:6,backgroundColor:"#fff3cd",borderRadius:4,fontSize:12,color:"#856404",border:"1px solid #ffc107"},children:["ðŸ“‹ ",d.observacoes]})]})})},d.id))]})]},j.id)})})]})}function Tp(){const[a,t]=n.useState(""),[s,o]=n.useState(""),[r,i]=n.useState(null),[l,x]=n.useState(null),[j,g]=n.useState(null),[v,d]=n.useState(!1),[m,C]=n.useState(null);async function y(){var f,b;if(!a||!s){C("Selecione o perÃ­odo para consulta");return}d(!0),C(null);try{const[u,h,p]=await Promise.all([F.get("/dashboard/entregas/financeiro",{params:{data_inicio:a,data_fim:s}}),F.get("/dashboard/entregas/financeiro/graficos",{params:{data_inicio:a,data_fim:s}}),F.get("/dashboard/entregas/financeiro/ia",{params:{data_inicio:a,data_fim:s}}).catch(()=>null)]);i(u.data),x(h.data),g((p==null?void 0:p.data)||{alertas:[],sugestoes:[]})}catch(u){console.error("Erro ao carregar dados:",u),C(((b=(f=u.response)==null?void 0:f.data)==null?void 0:b.detail)||"Erro ao carregar dados do dashboard")}finally{d(!1)}}n.useEffect(()=>{const f=new Date,b=new Date(f.getFullYear(),f.getMonth(),1);t(b.toISOString().slice(0,10)),o(f.toISOString().slice(0,10))},[]),n.useEffect(()=>{a&&s&&y()},[a,s]);const c=()=>{if(!r||r.total_entregas===0)return null;const f=r.margem_media,b=f>=0?"text-green-600":"text-red-600",u=f>=0?"âœ…":"âš ï¸";return e.jsxs("div",{className:`p-4 border rounded-lg ${f>=0?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:u}),e.jsx("h3",{className:"font-semibold text-gray-700",children:"AnÃ¡lise de Margem"})]}),e.jsx("p",{className:`text-sm ${b}`,children:f>=0?e.jsxs(e.Fragment,{children:["A taxa de entrega estÃ¡ ",e.jsx("strong",{children:"cobrindo os custos"})," com uma margem mÃ©dia de ",e.jsx("strong",{children:Ws(f)})," por entrega."]}):e.jsxs(e.Fragment,{children:["âš ï¸ A taxa de entrega estÃ¡ ",e.jsx("strong",{children:"abaixo dos custos"}),". DÃ©ficit mÃ©dio de ",e.jsx("strong",{children:Ws(Math.abs(f))})," por entrega."]})})]})};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ft,{className:"text-blue-600"}),"Dashboard Financeiro de Entregas"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Visualize os custos e receitas das entregas realizadas no perÃ­odo"})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ps,{className:"text-gray-500"}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"PerÃ­odo:"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"De:"}),e.jsx("input",{type:"date",value:a,onChange:f=>t(f.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"AtÃ©:"}),e.jsx("input",{type:"date",value:s,onChange:f=>o(f.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("button",{onClick:y,disabled:v,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(Ut,{className:v?"animate-spin":""}),v?"Carregando...":"Atualizar"]})]})}),m&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6 flex items-center gap-2",children:[e.jsx(Ca,{}),e.jsx("span",{children:m})]}),v&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(Yn,{}),e.jsx(Yn,{})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((f,b)=>e.jsx(qp,{},b))}),e.jsx(co,{}),e.jsx(co,{}),e.jsx(co,{})]}),!v&&r&&e.jsxs(e.Fragment,{children:[j&&j.alertas&&j.alertas.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(Vt,{className:"text-yellow-600"}),"Alertas AutomÃ¡ticos"]}),e.jsx("div",{className:"space-y-3",children:j.alertas.map((f,b)=>e.jsx("div",{className:"p-4 border border-yellow-200 bg-yellow-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700",children:f})},b))})]}),j&&j.sugestoes&&j.sugestoes.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ’¡"}),"SugestÃµes PrÃ¡ticas"]}),e.jsx("div",{className:"space-y-3",children:j.sugestoes.map((f,b)=>e.jsx("div",{className:"p-4 border border-blue-200 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700",children:f})},b))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[e.jsx(ht,{titulo:"Total de Entregas",valor:r.total_entregas,icon:e.jsx(ft,{className:"text-blue-600"}),colorClasse:"border-blue-200 bg-blue-50"}),e.jsx(ht,{titulo:"Custo Total",valor:Ws(r.custo_total_entregas),icon:e.jsx(es,{className:"text-red-600"}),colorClasse:"border-red-200 bg-red-50",subtitulo:"Entregadores + Moto"}),e.jsx(ht,{titulo:"Custo Entregadores",valor:Ws(r.custo_total_entregadores),icon:e.jsx(vs,{className:"text-purple-600"}),colorClasse:"border-purple-200 bg-purple-50"}),e.jsx(ht,{titulo:"Custo da Moto",valor:Ws(r.custo_total_moto),icon:e.jsx(qi,{className:"text-orange-600"}),colorClasse:"border-orange-200 bg-orange-50"}),e.jsx(ht,{titulo:"Repasse aos Entregadores",valor:Ws(r.total_repasse_taxa),icon:e.jsx(Lr,{className:"text-green-600"}),colorClasse:"border-green-200 bg-green-50"}),e.jsx(ht,{titulo:"Custo MÃ©dio por Entrega",valor:Ws(r.custo_medio_por_entrega),icon:e.jsx(Hr,{className:"text-indigo-600"}),colorClasse:"border-indigo-200 bg-indigo-50"})]}),c(),l&&e.jsxs("div",{className:"space-y-6 mt-6",children:[l.por_dia&&l.por_dia.length>0&&e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ðŸ“ˆ Custo Total por Dia"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:'Responde: "Estou gastando mais?"'}),e.jsx(za,{width:"100%",height:300,children:e.jsxs(Et,{data:l.por_dia,children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ga,{dataKey:"data",tick:{fontSize:12},tickFormatter:f=>{const[b,u,h]=f.split("-");return`${h}/${u}`}}),e.jsx(Ua,{tick:{fontSize:12}}),e.jsx(Ma,{formatter:f=>`R$ ${Number(f).toFixed(2)}`,labelFormatter:f=>{const[b,u,h]=f.split("-");return`${h}/${u}/${b}`}}),e.jsx(Wa,{}),e.jsx(gs,{type:"monotone",dataKey:"custo",stroke:"#ef4444",strokeWidth:2,name:"Custo Total (R$)"})]})})]}),l.custo_medio&&l.custo_medio.length>0&&e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ðŸ“‰ Custo MÃ©dio por Entrega"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:'Responde: "Entregar estÃ¡ ficando caro?"'}),e.jsx(za,{width:"100%",height:300,children:e.jsxs(Et,{data:l.custo_medio,children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ga,{dataKey:"data",tick:{fontSize:12},tickFormatter:f=>{const[b,u,h]=f.split("-");return`${h}/${u}`}}),e.jsx(Ua,{tick:{fontSize:12}}),e.jsx(Ma,{formatter:f=>`R$ ${Number(f).toFixed(2)}`,labelFormatter:f=>{const[b,u,h]=f.split("-");return`${h}/${u}/${b}`}}),e.jsx(Wa,{}),e.jsx(gs,{type:"monotone",dataKey:"valor",stroke:"#8b5cf6",strokeWidth:2,name:"Custo MÃ©dio (R$)"})]})})]}),l.taxa_vs_custo&&e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"ðŸ“Š Taxa Cobrada Ã— Custo Real"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:'Responde: "A taxa cobre o custo?"'}),e.jsx(za,{width:"100%",height:300,children:e.jsxs(bs,{data:[{name:"MÃ©dia","Taxa Cobrada":l.taxa_vs_custo.taxa_media,"Custo Real":l.taxa_vs_custo.custo_medio}],children:[e.jsx(Ka,{strokeDasharray:"3 3"}),e.jsx(Ga,{dataKey:"name"}),e.jsx(Ua,{}),e.jsx(Ma,{formatter:f=>`R$ ${Number(f).toFixed(2)}`}),e.jsx(Wa,{}),e.jsx(Ja,{dataKey:"Taxa Cobrada",fill:"#10b981"}),e.jsx(Ja,{dataKey:"Custo Real",fill:"#ef4444"})]})}),e.jsx("div",{className:"mt-4 text-center",children:l.taxa_vs_custo.taxa_media>=l.taxa_vs_custo.custo_medio?e.jsxs("p",{className:"text-green-600 font-medium",children:["âœ… Taxa mÃ©dia (R$ ",l.taxa_vs_custo.taxa_media.toFixed(2),") cobre o custo mÃ©dio (R$ ",l.taxa_vs_custo.custo_medio.toFixed(2),")"]}):e.jsxs("p",{className:"text-red-600 font-medium",children:["âš ï¸ Taxa mÃ©dia (R$ ",l.taxa_vs_custo.taxa_media.toFixed(2),") estÃ¡ abaixo do custo mÃ©dio (R$ ",l.taxa_vs_custo.custo_medio.toFixed(2),")"]})})]})]}),e.jsxs("div",{className:"mt-6 text-sm text-gray-500 text-center",children:["Dados do perÃ­odo: ",Zn(r.periodo.data_inicio)," atÃ© ",Zn(r.periodo.data_fim)]})]}),!v&&r&&r.total_entregas===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ft,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-2",children:"Nenhuma entrega encontrada"}),e.jsx("p",{className:"text-gray-500",children:"NÃ£o hÃ¡ entregas concluÃ­das no perÃ­odo selecionado"})]})]})}function ht({titulo:a,valor:t,icon:s,colorClasse:o,subtitulo:r}){return e.jsxs("div",{className:`p-5 rounded-lg border shadow-sm ${o||"border-gray-200 bg-white"}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsx("div",{className:"text-2xl",children:s})}),e.jsx("h4",{className:"text-sm font-medium text-gray-600 mb-1",children:a}),r&&e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:r}),e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:t})]})}function qp(){return e.jsx("div",{style:{height:110,borderRadius:8,background:"linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"}})}function co(){return e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{style:{height:20,width:"40%",borderRadius:4,background:"linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite",marginBottom:16}}),e.jsx("div",{style:{height:300,borderRadius:8,background:"linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"}})]})}function Yn(){return e.jsx("div",{style:{height:80,borderRadius:8,background:"linear-gradient(90deg, #e0e0e0 25%, #f0f0f0 50%, #e0e0e0 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"}})}function Ws(a){return a==null?"R$ 0,00":a.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}function Zn(a){if(!a)return"";const[t,s,o]=a.split("-");return`${o}/${s}/${t}`}function Ip(){return e.jsx(wc,{children:e.jsxs(Ii,{children:[e.jsx(zi,{position:"top-right"}),e.jsxs(Oi,{children:[e.jsx(Xe,{path:"/login",element:e.jsx(Ec,{})}),e.jsx(Xe,{path:"/register",element:e.jsx(Fc,{})}),e.jsxs(Xe,{path:"/",element:e.jsx(ja,{children:e.jsx(Sc,{})}),children:[e.jsx(Xe,{index:!0,element:e.jsx(xo,{to:"/lembretes",replace:!0})}),e.jsx(Xe,{path:"dashboard",element:e.jsx(ja,{permission:"relatorios.gerencial",children:e.jsx(In,{})})}),e.jsx(Xe,{path:"dashboard-gerencial",element:e.jsx(ja,{permission:"relatorios.gerencial",children:e.jsx(jp,{})})}),e.jsx(Xe,{path:"clientes",element:e.jsx(ja,{permission:"clientes.visualizar",children:e.jsx(qc,{})})}),e.jsx(Xe,{path:"clientes/:clienteId/financeiro",element:e.jsx(ja,{permission:"clientes.visualizar",children:e.jsx(bp,{})})}),e.jsx(Xe,{path:"clientes/:clienteId/timeline",element:e.jsx(ja,{permission:"clientes.visualizar",children:e.jsx(Kx,{})})}),e.jsx(Xe,{path:"pets",element:e.jsx(mx,{})}),e.jsx(Xe,{path:"pets/novo",element:e.jsx(Ln,{})}),e.jsx(Xe,{path:"pets/:petId",element:e.jsx(gx,{})}),e.jsx(Xe,{path:"pets/:petId/editar",element:e.jsx(Ln,{})}),e.jsx(Xe,{path:"produtos",element:e.jsx(ja,{permission:"produtos.visualizar",children:e.jsx(ax,{})})}),e.jsx(Xe,{path:"produtos/novo",element:e.jsx(ja,{permission:"produtos.criar",children:e.jsx(Mn,{})})}),e.jsx(Xe,{path:"produtos/:id/editar",element:e.jsx(ja,{permission:"produtos.editar",children:e.jsx(Mn,{})})}),e.jsx(Xe,{path:"produtos/:id/movimentacoes",element:e.jsx(Gx,{})}),e.jsx(Xe,{path:"produtos/relatorio",element:e.jsx(tx,{})}),e.jsx(Xe,{path:"estoque/alertas",element:e.jsx(ja,{permission:"produtos.visualizar",children:e.jsx(dx,{})})}),e.jsx(Xe,{path:"lembretes",element:e.jsx(cx,{})}),e.jsx(Xe,{path:"calculadora-racao",element:e.jsx(xx,{})}),e.jsx(Xe,{path:"pdv",element:e.jsx(ja,{permission:"vendas.criar",children:e.jsx(Bx,{})})}),e.jsx(Xe,{path:"meus-caixas",element:e.jsx(Wx,{})}),e.jsx(Xe,{path:"notas-fiscais",element:e.jsx(Hx,{})}),e.jsx(Xe,{path:"compras/pedidos",element:e.jsx(ja,{permission:"compras.gerenciar",children:e.jsx(Qx,{})})}),e.jsx(Xe,{path:"compras/entrada-xml",element:e.jsx(ja,{permission:"compras.gerenciar",children:e.jsx(Zx,{})})}),e.jsx(Xe,{path:"compras/bling",element:e.jsx(ja,{permission:"compras.gerenciar",children:e.jsx(Xx,{})})}),e.jsx(Xe,{path:"financeiro",element:e.jsx(ja,{permission:"relatorios.financeiro",children:e.jsx(In,{})})}),e.jsx(Xe,{path:"financeiro/vendas",element:e.jsx(ja,{permission:"relatorios.financeiro",children:e.jsx(wm,{})})}),e.jsx(Xe,{path:"financeiro/relatorio-vendas",element:e.jsx(ja,{permission:"relatorios.financeiro",children:e.jsx(_m,{})})}),e.jsx(Xe,{path:"financeiro/contas-pagar",element:e.jsx(ja,{permission:"relatorios.financeiro",children:e.jsx(rm,{})})}),e.jsx(Xe,{path:"financeiro/contas-receber",element:e.jsx(ja,{permission:"relatorios.financeiro",children:e.jsx(om,{})})}),e.jsx(Xe,{path:"financeiro/conciliacao-3abas",element:e.jsx(ja,{permission:"relatorios.financeiro",children:e.jsx(dm,{})})}),e.jsx(Xe,{path:"financeiro/historico-conciliacoes",element:e.jsx(ja,{permission:"relatorios.financeiro",children:e.jsx(cm,{})})}),e.jsx(Xe,{path:"financeiro/conciliacao-bancaria",element:e.jsx(ja,{permission:"relatorios.financeiro",children:e.jsx(um,{})})}),e.jsx(Xe,{path:"financeiro/fluxo-caixa",element:e.jsx(ja,{permission:"relatorios.financeiro",children:e.jsx(Nm,{})})}),e.jsx(Xe,{path:"financeiro/dre",element:e.jsx(ja,{permission:"relatorios.financeiro",children:e.jsx(Rm,{})})}),e.jsx(Xe,{path:"comissoes",element:e.jsx(op,{})}),e.jsx(Xe,{path:"comissoes/demonstrativo",element:e.jsx(ip,{})}),e.jsx(Xe,{path:"comissoes/relatorios",element:e.jsx(up,{})}),e.jsx(Xe,{path:"comissoes/abertas",element:e.jsx(dp,{})}),e.jsx(Xe,{path:"comissoes/fechamento/:funcionario_id",element:e.jsx(cp,{})}),e.jsx(Xe,{path:"comissoes/fechamentos",element:e.jsx(xp,{})}),e.jsx(Xe,{path:"comissoes/fechamentos/detalhe",element:e.jsx(mp,{})}),e.jsx(Xe,{path:"subcategorias",element:e.jsx(Jn,{})}),e.jsx(Xe,{path:"cadastros/categorias",element:e.jsx(pp,{})}),e.jsx(Xe,{path:"cadastros/categorias-financeiras",element:e.jsx(gp,{})}),e.jsx(Xe,{path:"cadastros/especies-racas",element:e.jsx(hp,{})}),e.jsx(Xe,{path:"cadastros/cargos",element:e.jsx(Pp,{})}),e.jsx(Xe,{path:"cadastros/financeiro/bancos",element:e.jsx(ja,{permission:"configuracoes.editar",children:e.jsx(sm,{})})}),e.jsx(Xe,{path:"cadastros/financeiro/formas-pagamento",element:e.jsx(ja,{permission:"configuracoes.editar",children:e.jsx(hm,{})})}),e.jsx(Xe,{path:"cadastros/financeiro/operadoras",element:e.jsx(ja,{permission:"configuracoes.editar",children:e.jsx(fm,{})})}),e.jsx(Xe,{path:"subcategorias",element:e.jsx(Jn,{})}),e.jsx(Xe,{path:"admin/usuarios",element:e.jsx(ja,{permission:"usuarios.manage",children:e.jsx(vp,{})})}),e.jsx(Xe,{path:"configuracoes",element:e.jsx(ja,{permission:"configuracoes.editar",children:e.jsx(Np,{})})}),e.jsx(Xe,{path:"configuracoes/fiscal",element:e.jsx(_p,{})}),e.jsx(Xe,{path:"configuracoes/entregas",element:e.jsx(wp,{})}),e.jsx(Xe,{path:"configuracoes/custos-moto",element:e.jsx(Cp,{})}),e.jsx(Xe,{path:"configuracoes/estoque",element:e.jsx(kp,{})}),e.jsx(Xe,{path:"auditoria/provisoes",element:e.jsx(Sp,{})}),e.jsx(Xe,{path:"projecao-caixa",element:e.jsx(Ep,{})}),e.jsx(Xe,{path:"simulacao-contratacao",element:e.jsx(Fp,{})}),e.jsx(Xe,{path:"rh/funcionarios",element:e.jsx($p,{})}),e.jsx(Xe,{path:"admin/roles",element:e.jsx(yp,{})}),e.jsx(Xe,{path:"entregas/abertas",element:e.jsx(Ap,{})}),e.jsx(Xe,{path:"entregas/rotas",element:e.jsx(Dp,{})}),e.jsx(Xe,{path:"entregas/historico",element:e.jsx(Lp,{})}),e.jsx(Xe,{path:"entregas/financeiro",element:e.jsx(Tp,{})}),e.jsx(Xe,{path:"ia/fluxo-caixa",element:e.jsx(ja,{permission:"ia.fluxo_caixa",children:e.jsx(W0,{})})}),e.jsx(Xe,{path:"ia/chat",element:e.jsx(H0,{})}),e.jsx(Xe,{path:"ia/whatsapp",element:e.jsx(ja,{permission:"ia.whatsapp",children:e.jsx(rp,{})})}),e.jsx(Xe,{path:"ia/alertas-racao",element:e.jsx(ja,{permission:"produtos.editar",children:e.jsx(Sm,{})})}),e.jsx(Xe,{path:"cadastros/opcoes-racao",element:e.jsx(ja,{permission:"produtos.editar",children:e.jsx(Em,{})})})]}),e.jsx(Xe,{path:"*",element:e.jsx(xo,{to:"/",replace:!0})})]})]})})}Vi.createRoot(document.getElementById("root")).render(e.jsx(ms.StrictMode,{children:e.jsx(Ip,{})}));
