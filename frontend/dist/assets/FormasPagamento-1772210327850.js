import{r as p,aP as m,j as e,aB as B,aC as A,aD as O,aE as q,ax as f}from"./vendor-react-1772210327850.js";import{a as u}from"./index-1772210327850.js";const L=(i,o)=>{const r=(i||o||"").toLowerCase();return r.includes("pix")?e.jsx(B,{className:"w-5 h-5"}):r.includes("dinheiro")||r.includes("cash")?e.jsx(A,{className:"w-5 h-5"}):r.includes("transfer")||r.includes("banc")?e.jsx(O,{className:"w-5 h-5"}):r.includes("boleto")?e.jsx(q,{className:"w-5 h-5"}):r.includes("debito")||r.includes("dÃ©bito")||r.includes("cartao_debito")?e.jsx(f,{className:"w-5 h-5"}):r.includes("credito")||r.includes("crÃ©dito")||r.includes("cartao_credito")||r.includes("parcelado")?e.jsx(f,{className:"w-5 h-5"}):e.jsx(f,{className:"w-5 h-5"})},N={dinheiro:"ðŸ’µ",cartao_credito:"ðŸ’³",cartao_debito:"ðŸ’³",pix:"ðŸ“±",boleto:"ðŸ“„",transferencia:"ðŸ¦"},M=i=>{if(typeof i!="string"||!i)return"";try{return decodeURIComponent(escape(i))}catch{return i}},b=i=>{const o=M(i).trim();return!o||o.includes("ï¿½")?"":o.replace(/\?{2,}/g," ").replace(/\s{2,}/g," ").trim().replace(/Cr dito/gi,"Credito").replace(/D bito/gi,"Debito").replace(/Transfer ncia/gi,"Transferencia").replace(/Banc ria/gi,"Bancaria")},S=(i,o)=>{const r=b(i),_=N[o]||"ðŸ’³";return!r||r.includes("?")||r.includes("Ã°")||r.includes("Ãƒ")?_:r},J=()=>{var E,D,F;const[i,o]=p.useState([]),[r,_]=p.useState([]),[x,y]=p.useState([]),[z,P]=p.useState(!0),[I,g]=p.useState(!1),[j,C]=p.useState(null),[s,c]=p.useState({nome:"",tipo:"dinheiro",taxa_percentual:0,taxa_fixa:0,prazo_dias:0,operadora:"",operadora_id:null,gera_contas_receber:!1,split_parcelas:!1,conta_bancaria_destino_id:null,requer_nsu:!1,tipo_cartao:"",bandeira:"",ativo:!0,permite_parcelamento:!1,parcelas_maximas:1,taxas_por_parcela:{},permite_antecipacao:!1,dias_recebimento_antecipado:null,taxa_antecipacao_percentual:null,icone:N.cartao_credito,cor:"#3B82F6"});p.useEffect(()=>{v()},[]);const v=async()=>{try{const[a,t,n]=await Promise.allSettled([u.get("/financeiro/formas-pagamento?apenas_ativas=false"),u.get("/contas-bancarias?apenas_ativas=true"),u.get("/operadoras-cartao?apenas_ativas=true")]);if(a.status==="fulfilled"){const d=(a.value.data||[]).map(l=>({...l,nome:b(l.nome)||l.nome,operadora:b(l.operadora)||l.operadora,icone:S(l.icone,l.tipo)}));o(d)}t.status==="fulfilled"&&_(t.value.data||[]),n.status==="fulfilled"?y(n.value.data||[]):(y([]),console.warn("Operadoras indisponiveis no ambiente atual. Usando lista vazia."))}catch(a){console.error("Erro ao carregar dados:",a),m.error("Erro ao carregar formas de pagamento")}finally{P(!1)}},w=(a=null)=>{if(a){C(a.id);let t={};if(a.taxas_por_parcela)try{t=typeof a.taxas_por_parcela=="string"?JSON.parse(a.taxas_por_parcela):a.taxas_por_parcela}catch(n){console.error("Erro ao parsear taxas_por_parcela:",n)}c({nome:b(a.nome)||a.nome,tipo:a.tipo,taxa_percentual:a.taxa_percentual,taxa_fixa:a.taxa_fixa,prazo_dias:a.prazo_dias,operadora:b(a.operadora)||a.operadora||"",operadora_id:a.operadora_id||null,gera_contas_receber:a.gera_contas_receber,split_parcelas:a.split_parcelas,conta_bancaria_destino_id:a.conta_bancaria_destino_id,requer_nsu:a.requer_nsu,tipo_cartao:a.tipo_cartao||"",bandeira:a.bandeira||"",ativo:a.ativo,permite_parcelamento:a.permite_parcelamento,parcelas_maximas:a.parcelas_maximas,taxas_por_parcela:t,permite_antecipacao:a.permite_antecipacao||!1,dias_recebimento_antecipado:a.dias_recebimento_antecipado??null,taxa_antecipacao_percentual:a.taxa_antecipacao_percentual??null,icone:S(a.icone,a.tipo),cor:a.cor||"#3B82F6"})}else C(null),c({nome:"",tipo:"dinheiro",taxa_percentual:0,taxa_fixa:0,prazo_dias:0,operadora:"",operadora_id:null,gera_contas_receber:!1,split_parcelas:!1,conta_bancaria_destino_id:null,requer_nsu:!1,tipo_cartao:"",bandeira:"",ativo:!0,permite_parcelamento:!1,parcelas_maximas:1,taxas_por_parcela:{},permite_antecipacao:!1,dias_recebimento_antecipado:null,taxa_antecipacao_percentual:null,icone:N.cartao_credito,cor:"#3B82F6"});g(!0)},R=async()=>{try{const a={...s,taxas_por_parcela:Object.keys(s.taxas_por_parcela).length>0?JSON.stringify(s.taxas_por_parcela):null};j?(await u.put(`/financeiro/formas-pagamento/${j}`,a),m.success("Forma de pagamento atualizada!")):(await u.post("/financeiro/formas-pagamento",a),m.success("Forma de pagamento criada!")),g(!1),v()}catch(a){console.error("Erro ao salvar:",a),m.error("Erro ao salvar forma de pagamento")}},T=async a=>{if(confirm("Deseja realmente excluir esta forma de pagamento?"))try{await u.delete(`/financeiro/formas-pagamento/${a}`),m.success("Forma de pagamento excluida!"),v()}catch(t){console.error("Erro ao excluir:",t),m.error("Erro ao excluir forma de pagamento")}},k=[{value:"dinheiro",label:"Dinheiro",icone:"ðŸ’µ"},{value:"cartao_credito",label:"Cartao de Credito",icone:"ðŸ’³"},{value:"cartao_debito",label:"Cartao de Debito",icone:"ðŸ’³"},{value:"pix",label:"PIX",icone:"ðŸ“±"},{value:"boleto",label:"Boleto",icone:"ðŸ“„"},{value:"transferencia",label:"Transferencia",icone:"ðŸ¦"}];return z?e.jsx("div",{className:"flex justify-center items-center h-64",children:"Carregando..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Formas de Pagamento/Recebimento"}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:()=>w(),children:"+ Nova Forma"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nome"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Taxa %"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Taxa Fixa"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Prazo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Conta Destino"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acoes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"px-6 py-4 text-center text-gray-500",children:"Nenhuma forma de pagamento cadastrada"})}):i.map(a=>{var t,n,d,l;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500",children:L(a.icone,a.tipo)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.nome}),a.operadora_id&&e.jsx("div",{className:"text-xs text-gray-500",children:((t=x.find(h=>h.id===a.operadora_id))==null?void 0:t.nome)||a.operadora||"Operadora nao encontrada"})]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:((n=k.find(h=>h.value===a.tipo))==null?void 0:n.label)||a.tipo}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[a.taxa_percentual,"%"]}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:["R$ ",((d=a.taxa_fixa)==null?void 0:d.toFixed(2))||"0.00"]}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[a.prazo_dias," dias"]}),e.jsx("td",{className:"px-6 py-4 text-sm",children:a.conta_bancaria_destino_id?((l=r.find(h=>h.id===a.conta_bancaria_destino_id))==null?void 0:l.nome)||"N/A":e.jsx("span",{className:"text-gray-400",children:"Nenhuma"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${a.ativo?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:a.ativo?"Ativo":"Inativo"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"text-blue-600 hover:text-blue-800",onClick:()=>w(a),children:"Editar"}),e.jsx("button",{className:"text-red-600 hover:text-red-800",onClick:()=>T(a.id),children:"Excluir"})]})})]},a.id)})})]})}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-6 py-4 flex justify-between items-center sticky top-0",children:[e.jsxs("h3",{className:"text-xl font-semibold",children:[j?"Editar":"Nova"," Forma de Pagamento"]}),e.jsx("button",{onClick:()=>g(!1),className:"text-white hover:bg-blue-700 px-3 py-1 rounded",children:"Fechar"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nome *"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",value:s.nome,onChange:a=>c({...s,nome:a.target.value}),placeholder:"Ex: Dinheiro, PIX, Stone Credito..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipo *"}),e.jsx("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:s.tipo,onChange:a=>c({...s,tipo:a.target.value}),children:k.map(a=>e.jsxs("option",{value:a.value,children:[a.icone," ",a.label]},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Icone"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",value:s.icone,onChange:a=>c({...s,icone:a.target.value}),placeholder:"\\uD83D\\uDCB5",maxLength:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa % (Ex: 2.5%)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:s.taxa_percentual,onChange:a=>c({...s,taxa_percentual:parseFloat(a.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa Fixa (R$)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:s.taxa_fixa,onChange:a=>c({...s,taxa_fixa:parseFloat(a.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Prazo (dias)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",value:s.prazo_dias,onChange:a=>c({...s,prazo_dias:parseInt(a.target.value)||0})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Conta Bancaria Destino"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:s.conta_bancaria_destino_id||"",onChange:a=>c({...s,conta_bancaria_destino_id:parseInt(a.target.value)||null}),children:[e.jsx("option",{value:"",children:"Selecione..."}),r.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Esta conta sera usada automaticamente quando esta forma for selecionada em pagamentos/recebimentos"})]}),(s.tipo==="cartao_credito"||s.tipo==="cartao_debito")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Operadora *"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:s.operadora_id||"",onChange:a=>{const t=parseInt(a.target.value)||null,n=x.find(l=>l.id===t);let d=(n==null?void 0:n.max_parcelas)||s.parcelas_maximas;c({...s,operadora_id:t,operadora:(n==null?void 0:n.nome)||"",parcelas_maximas:d})},children:[e.jsx("option",{value:"",children:"Selecione a operadora..."}),x.map(a=>e.jsxs("option",{value:a.id,children:[a.icone," ",a.nome," (ate ",a.max_parcelas,"x)"]},a.id))]}),s.operadora_id&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Limite de parcelas desta operadora: ",(E=x.find(a=>a.id===s.operadora_id))==null?void 0:E.max_parcelas,"x"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Bandeira"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:s.bandeira,onChange:a=>c({...s,bandeira:a.target.value}),children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"visa",children:"Visa"}),e.jsx("option",{value:"master",children:"Mastercard"}),e.jsx("option",{value:"elo",children:"Elo"}),e.jsx("option",{value:"amex",children:"American Express"}),e.jsx("option",{value:"hipercard",children:"Hipercard"})]})]})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.ativo,onChange:a=>c({...s,ativo:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Ativo"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.gera_contas_receber,onChange:a=>c({...s,gera_contas_receber:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Gera Contas a Receber (para cartoes com prazo)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.requer_nsu,onChange:a=>c({...s,requer_nsu:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Requer NSU (numero de transacao)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.permite_parcelamento,onChange:a=>c({...s,permite_parcelamento:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Permite Parcelamento"})]}),s.permite_parcelamento&&e.jsxs("div",{className:"ml-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Maximo de Parcelas"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",min:"1",max:s.operadora_id&&((D=x.find(a=>a.id===s.operadora_id))==null?void 0:D.max_parcelas)||24,value:s.parcelas_maximas,onChange:a=>{const t=parseInt(a.target.value)||1,n=x.find(l=>l.id===s.operadora_id),d=(n==null?void 0:n.max_parcelas)||24;if(t>d){m.error(`Esta operadora permite no maximo ${d}x`);return}c({...s,parcelas_maximas:t})}}),s.operadora_id&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["Limitado a ",(F=x.find(a=>a.id===s.operadora_id))==null?void 0:F.max_parcelas,"x pela operadora selecionada"]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Taxas Especificas por Numero de Parcelas"}),e.jsxs("p",{className:"text-xs text-blue-700 mb-3",children:["Configure taxas diferentes para cada quantidade de parcelas. Se nao informado, usa a taxa base (",s.taxa_percentual,"%)."]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-48 overflow-y-auto",children:Array.from({length:s.parcelas_maximas},(a,t)=>t+1).map(a=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"text-xs font-medium text-gray-700 w-10",children:[a,"x:"]}),e.jsx("input",{type:"number",step:"0.01",className:"flex-1 border border-gray-300 rounded px-2 py-1 text-sm",placeholder:s.taxa_percentual,value:s.taxas_por_parcela[a]||"",onChange:t=>{const n={...s.taxas_por_parcela};t.target.value?n[a]=parseFloat(t.target.value):delete n[a],c({...s,taxas_por_parcela:n})}}),e.jsx("span",{className:"text-xs text-gray-500",children:"%"})]},a))})]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.permite_antecipacao,onChange:a=>c({...s,permite_antecipacao:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Permite Antecipacao de Recebiveis"})]}),s.permite_antecipacao&&e.jsxs("div",{className:"ml-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Dias para Recebimento Antecipado"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",min:"0",max:"30",value:s.dias_recebimento_antecipado!=null?s.dias_recebimento_antecipado:"",onChange:a=>{const t=a.target.value;c({...s,dias_recebimento_antecipado:t===""?null:parseInt(t)})},placeholder:"Ex: 0 (D+0) ou 1 (D+1)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Quantos dias apos a venda o dinheiro cai na conta com antecipacao. Use 0 para D+0 (cai na hora), 1 para D+1, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa de Antecipacao (%) - OPCIONAL"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full border border-gray-300 rounded px-3 py-2",value:s.taxa_antecipacao_percentual||"",onChange:a=>c({...s,taxa_antecipacao_percentual:parseFloat(a.target.value)||null}),placeholder:"Ex: 0.50"}),e.jsxs("div",{className:"mt-2 p-3 bg-amber-50 border border-amber-200 rounded",children:[e.jsx("p",{className:"text-xs text-amber-800 font-semibold mb-1",children:"Duas formas de configurar:"}),e.jsxs("p",{className:"text-xs text-amber-700 mb-1",children:[e.jsx("strong",{children:"1. Com taxa de antecipacao:"})," Preencha este campo e a taxa sera somada automaticamente as taxas por parcela configuradas acima"]}),e.jsxs("p",{className:"text-xs text-amber-700",children:[e.jsx("strong",{children:"2. Sem taxa de antecipacao:"})," Deixe vazio e configure nos campos 1x a 12x acima ja com o valor final (taxa normal + antecipacao somadas)"]})]})]})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 border-t p-4",children:[e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",onClick:()=>g(!1),children:"Cancelar"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:R,children:"Salvar"})]})]})})]})};export{J as default};
