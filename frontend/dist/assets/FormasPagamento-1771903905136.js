import{r as n,j as e}from"./vendor-react-1771903905136.js";import{a as x}from"./index-1771903905136.js";import{n as i}from"./vendor-utils-1771903905136.js";import"./vendor-icons-1771903905136.js";const T=()=>{var N,y,f;const[b,C]=n.useState([]),[_,k]=n.useState([]),[c,w]=n.useState([]),[E,F]=n.useState(!0),[S,m]=n.useState(!1),[u,g]=n.useState(null),[s,r]=n.useState({nome:"",tipo:"dinheiro",taxa_percentual:0,taxa_fixa:0,prazo_dias:0,operadora:"",operadora_id:null,gera_contas_receber:!1,split_parcelas:!1,conta_bancaria_destino_id:null,requer_nsu:!1,tipo_cartao:"",bandeira:"",ativo:!0,permite_parcelamento:!1,parcelas_maximas:1,taxas_por_parcela:{},permite_antecipacao:!1,dias_recebimento_antecipado:null,taxa_antecipacao_percentual:null,icone:"ðŸ’³",cor:"#3B82F6"});n.useEffect(()=>{h()},[]);const h=async()=>{try{const[a,l,t]=await Promise.all([x.get("/financeiro/formas-pagamento?apenas_ativas=false"),x.get("/contas-bancarias?apenas_ativas=true"),x.get("/operadoras-cartao?apenas_ativas=true")]);C(a.data),k(l.data),w(t.data)}catch(a){console.error("Erro ao carregar dados:",a),i.error("Erro ao carregar formas de pagamento")}finally{F(!1)}},j=(a=null)=>{if(a){g(a.id);let l={};if(a.taxas_por_parcela)try{l=typeof a.taxas_por_parcela=="string"?JSON.parse(a.taxas_por_parcela):a.taxas_por_parcela}catch(t){console.error("Erro ao parsear taxas_por_parcela:",t)}r({nome:a.nome,tipo:a.tipo,taxa_percentual:a.taxa_percentual,taxa_fixa:a.taxa_fixa,prazo_dias:a.prazo_dias,operadora:a.operadora||"",operadora_id:a.operadora_id||null,gera_contas_receber:a.gera_contas_receber,split_parcelas:a.split_parcelas,conta_bancaria_destino_id:a.conta_bancaria_destino_id,requer_nsu:a.requer_nsu,tipo_cartao:a.tipo_cartao||"",bandeira:a.bandeira||"",ativo:a.ativo,permite_parcelamento:a.permite_parcelamento,parcelas_maximas:a.parcelas_maximas,taxas_por_parcela:l,permite_antecipacao:a.permite_antecipacao||!1,dias_recebimento_antecipado:a.dias_recebimento_antecipado||null,taxa_antecipacao_percentual:a.taxa_antecipacao_percentual||null,icone:a.icone||"ðŸ’³",cor:a.cor||"#3B82F6"})}else g(null),r({nome:"",tipo:"dinheiro",taxa_percentual:0,taxa_fixa:0,prazo_dias:0,operadora:"",operadora_id:null,gera_contas_receber:!1,split_parcelas:!1,conta_bancaria_destino_id:null,requer_nsu:!1,tipo_cartao:"",bandeira:"",ativo:!0,permite_parcelamento:!1,parcelas_maximas:1,taxas_por_parcela:{},permite_antecipacao:!1,dias_recebimento_antecipado:null,taxa_antecipacao_percentual:null,icone:"ðŸ’³",cor:"#3B82F6"});m(!0)},P=async()=>{try{const a={...s,taxas_por_parcela:Object.keys(s.taxas_por_parcela).length>0?JSON.stringify(s.taxas_por_parcela):null};u?(await x.put(`/financeiro/formas-pagamento/${u}`,a),i.success("Forma de pagamento atualizada!")):(await x.post("/financeiro/formas-pagamento",a),i.success("Forma de pagamento criada!")),m(!1),h()}catch(a){console.error("Erro ao salvar:",a),i.error("Erro ao salvar forma de pagamento")}},D=async a=>{if(confirm("Deseja realmente excluir esta forma de pagamento?"))try{await x.delete(`/financeiro/formas-pagamento/${a}`),i.success("Forma de pagamento excluÃ­da!"),h()}catch(l){console.error("Erro ao excluir:",l),i.error("Erro ao excluir forma de pagamento")}},v=[{value:"dinheiro",label:"Dinheiro",icone:"ðŸ’µ"},{value:"cartao_credito",label:"CartÃ£o de CrÃ©dito",icone:"ðŸ’³"},{value:"cartao_debito",label:"CartÃ£o de DÃ©bito",icone:"ðŸ’³"},{value:"pix",label:"PIX",icone:"ðŸ“±"},{value:"boleto",label:"Boleto",icone:"ðŸ“„"},{value:"transferencia",label:"TransferÃªncia",icone:"ðŸ¦"}];return E?e.jsx("div",{className:"flex justify-center items-center h-64",children:"Carregando..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Formas de Pagamento/Recebimento"}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:()=>j(),children:"+ Nova Forma"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nome"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Taxa %"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Taxa Fixa"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Prazo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Conta Destino"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:b.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"px-6 py-4 text-center text-gray-500",children:"Nenhuma forma de pagamento cadastrada"})}):b.map(a=>{var l,t,o,d;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:a.icone}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.nome}),a.operadora_id&&e.jsx("div",{className:"text-xs text-gray-500",children:((l=c.find(p=>p.id===a.operadora_id))==null?void 0:l.nome)||a.operadora||"Operadora nÃ£o encontrada"})]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:((t=v.find(p=>p.value===a.tipo))==null?void 0:t.label)||a.tipo}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[a.taxa_percentual,"%"]}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:["R$ ",((o=a.taxa_fixa)==null?void 0:o.toFixed(2))||"0.00"]}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[a.prazo_dias," dias"]}),e.jsx("td",{className:"px-6 py-4 text-sm",children:a.conta_bancaria_destino_id?((d=_.find(p=>p.id===a.conta_bancaria_destino_id))==null?void 0:d.nome)||"N/A":e.jsx("span",{className:"text-gray-400",children:"Nenhuma"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${a.ativo?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:a.ativo?"Ativo":"Inativo"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"text-blue-600 hover:text-blue-800",onClick:()=>j(a),children:"âœï¸"}),e.jsx("button",{className:"text-red-600 hover:text-red-800",onClick:()=>D(a.id),children:"ðŸ—‘ï¸"})]})})]},a.id)})})]})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-6 py-4 flex justify-between items-center sticky top-0",children:[e.jsxs("h3",{className:"text-xl font-semibold",children:[u?"Editar":"Nova"," Forma de Pagamento"]}),e.jsx("button",{onClick:()=>m(!1),className:"text-white hover:bg-blue-700 px-3 py-1 rounded",children:"âœ•"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nome *"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",value:s.nome,onChange:a=>r({...s,nome:a.target.value}),placeholder:"Ex: Dinheiro, PIX, Stone CrÃ©dito..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipo *"}),e.jsx("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:s.tipo,onChange:a=>r({...s,tipo:a.target.value}),children:v.map(a=>e.jsxs("option",{value:a.value,children:[a.icone," ",a.label]},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ãcone"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",value:s.icone,onChange:a=>r({...s,icone:a.target.value}),placeholder:"ðŸ’µ",maxLength:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa % (Ex: 2.5%)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:s.taxa_percentual,onChange:a=>r({...s,taxa_percentual:parseFloat(a.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa Fixa (R$)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",step:"0.01",value:s.taxa_fixa,onChange:a=>r({...s,taxa_fixa:parseFloat(a.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Prazo (dias)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",value:s.prazo_dias,onChange:a=>r({...s,prazo_dias:parseInt(a.target.value)||0})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Conta BancÃ¡ria Destino"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:s.conta_bancaria_destino_id||"",onChange:a=>r({...s,conta_bancaria_destino_id:parseInt(a.target.value)||null}),children:[e.jsx("option",{value:"",children:"Selecione..."}),_.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Esta conta serÃ¡ usada automaticamente quando esta forma for selecionada em pagamentos/recebimentos"})]}),(s.tipo==="cartao_credito"||s.tipo==="cartao_debito")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Operadora *"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:s.operadora_id||"",onChange:a=>{const l=parseInt(a.target.value)||null,t=c.find(d=>d.id===l);let o=(t==null?void 0:t.max_parcelas)||s.parcelas_maximas;r({...s,operadora_id:l,operadora:(t==null?void 0:t.nome)||"",parcelas_maximas:o})},children:[e.jsx("option",{value:"",children:"Selecione a operadora..."}),c.map(a=>e.jsxs("option",{value:a.id,children:[a.icone," ",a.nome," (atÃ© ",a.max_parcelas,"x)"]},a.id))]}),s.operadora_id&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Limite de parcelas desta operadora: ",(N=c.find(a=>a.id===s.operadora_id))==null?void 0:N.max_parcelas,"x"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Bandeira"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded px-3 py-2",value:s.bandeira,onChange:a=>r({...s,bandeira:a.target.value}),children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"visa",children:"Visa"}),e.jsx("option",{value:"master",children:"Mastercard"}),e.jsx("option",{value:"elo",children:"Elo"}),e.jsx("option",{value:"amex",children:"American Express"}),e.jsx("option",{value:"hipercard",children:"Hipercard"})]})]})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.ativo,onChange:a=>r({...s,ativo:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Ativo"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.gera_contas_receber,onChange:a=>r({...s,gera_contas_receber:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Gera Contas a Receber (para cartÃµes com prazo)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.requer_nsu,onChange:a=>r({...s,requer_nsu:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Requer NSU (nÃºmero de transaÃ§Ã£o)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.permite_parcelamento,onChange:a=>r({...s,permite_parcelamento:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Permite Parcelamento"})]}),s.permite_parcelamento&&e.jsxs("div",{className:"ml-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"MÃ¡ximo de Parcelas"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",min:"1",max:s.operadora_id&&((y=c.find(a=>a.id===s.operadora_id))==null?void 0:y.max_parcelas)||24,value:s.parcelas_maximas,onChange:a=>{const l=parseInt(a.target.value)||1,t=c.find(d=>d.id===s.operadora_id),o=(t==null?void 0:t.max_parcelas)||24;if(l>o){i.error(`âŒ Esta operadora permite no mÃ¡ximo ${o}x`);return}r({...s,parcelas_maximas:l})}}),s.operadora_id&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["âš ï¸ Limitado a ",(f=c.find(a=>a.id===s.operadora_id))==null?void 0:f.max_parcelas,"x pela operadora selecionada"]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"ðŸ“Š Taxas EspecÃ­ficas por NÃºmero de Parcelas"}),e.jsxs("p",{className:"text-xs text-blue-700 mb-3",children:["Configure taxas diferentes para cada quantidade de parcelas. Se nÃ£o informado, usa a taxa base (",s.taxa_percentual,"%)."]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-48 overflow-y-auto",children:Array.from({length:s.parcelas_maximas},(a,l)=>l+1).map(a=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"text-xs font-medium text-gray-700 w-10",children:[a,"x:"]}),e.jsx("input",{type:"number",step:"0.01",className:"flex-1 border border-gray-300 rounded px-2 py-1 text-sm",placeholder:s.taxa_percentual,value:s.taxas_por_parcela[a]||"",onChange:l=>{const t={...s.taxas_por_parcela};l.target.value?t[a]=parseFloat(l.target.value):delete t[a],r({...s,taxas_por_parcela:t})}}),e.jsx("span",{className:"text-xs text-gray-500",children:"%"})]},a))})]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.permite_antecipacao,onChange:a=>r({...s,permite_antecipacao:a.target.checked})}),e.jsx("span",{className:"text-sm",children:"Permite AntecipaÃ§Ã£o de RecebÃ­veis"})]}),s.permite_antecipacao&&e.jsxs("div",{className:"ml-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Dias para Recebimento Antecipado"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-3 py-2",min:"0",max:"30",value:s.dias_recebimento_antecipado||"",onChange:a=>r({...s,dias_recebimento_antecipado:parseInt(a.target.value)||null}),placeholder:"Ex: 1 (cai em D+1)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Quantos dias apÃ³s a venda o dinheiro cai na conta com antecipaÃ§Ã£o (geralmente D+1)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taxa de AntecipaÃ§Ã£o (%) - OPCIONAL"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full border border-gray-300 rounded px-3 py-2",value:s.taxa_antecipacao_percentual||"",onChange:a=>r({...s,taxa_antecipacao_percentual:parseFloat(a.target.value)||null}),placeholder:"Ex: 0.50"}),e.jsxs("div",{className:"mt-2 p-3 bg-amber-50 border border-amber-200 rounded",children:[e.jsx("p",{className:"text-xs text-amber-800 font-semibold mb-1",children:"ðŸ’¡ Duas formas de configurar:"}),e.jsxs("p",{className:"text-xs text-amber-700 mb-1",children:[e.jsx("strong",{children:"1. Com taxa de antecipaÃ§Ã£o:"})," Preencha este campo e a taxa serÃ¡ somada automaticamente Ã s taxas por parcela configuradas acima"]}),e.jsxs("p",{className:"text-xs text-amber-700",children:[e.jsx("strong",{children:"2. Sem taxa de antecipaÃ§Ã£o:"})," Deixe vazio e configure nos campos 1x a 12x acima jÃ¡ com o valor final (taxa normal + antecipaÃ§Ã£o somadas)"]})]})]})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 border-t p-4",children:[e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",onClick:()=>m(!1),children:"Cancelar"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:P,children:"âœ“ Salvar"})]})]})})]})};export{T as default};
