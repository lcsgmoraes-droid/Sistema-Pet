import{r as i,aP as d,j as e}from"./vendor-react-1772201433044.js";import{a as p}from"./index-1772201433044.js";const Le=()=>{const[S,E]=i.useState([]),[k,y]=i.useState([]),[c,b]=i.useState([]),[n,x]=i.useState(!1),[q,w]=i.useState(!1),[C,I]=i.useState(!1),[ee,M]=i.useState(null),[L,$]=i.useState(null),[te,F]=i.useState(!1),[ae,R]=i.useState(!1),[O,re]=i.useState(null),[v,z]=i.useState({email:"",whatsapp:"",formatos:{pdf:!0,excel:!1}}),[se,B]=i.useState(!1),[g,oe]=i.useState([]),[A,V]=i.useState(!1),[K,de]=i.useState(90),[W,ie]=i.useState(30),[J,ne]=i.useState(!1),[G,le]=i.useState(!0),[j,P]=i.useState([]),[H,Q]=i.useState({}),[o,m]=i.useState({fornecedor_id:"",data_prevista_entrega:"",valor_frete:"0",valor_desconto:"0",observacoes:"",itens:[]}),[u,_]=i.useState({produto_id:"",quantidade_pedida:"",preco_unitario:""}),[ce,pe]=i.useState(""),[xe,D]=i.useState("");i.useEffect(()=>{N()},[]);const N=async()=>{try{const[t,a]=await Promise.all([p.get("/pedidos-compra/"),p.get("/clientes/?tipo_cadastro=fornecedor&apenas_ativos=true")]),r=Array.isArray(t.data)?t.data:t.data.items||t.data.pedidos||[],s=Array.isArray(a.data)?a.data:a.data.items||a.data.clientes||[];E(r),y(s)}catch(t){console.error("Erro ao carregar dados:",t),d.error("Erro ao carregar dados")}},X=async t=>{if(!t){b([]);return}try{const a=await p.get(`/produtos/?fornecedor_id=${t}`);let r;Array.isArray(a.data)?r=a.data:a.data.items?r=a.data.items:a.data.produtos?r=a.data.produtos:r=[],r.length===0&&d.warning("‚ö†Ô∏è Este fornecedor n√£o possui produtos vinculados. Edite os produtos para vincular ao fornecedor."),b(r)}catch(a){console.error("Erro ao carregar produtos:",a),d.error("Erro ao carregar produtos do fornecedor")}},ue=t=>{const a=c.find(r=>r.id===parseInt(t));a&&(D(a.nome),a.preco_custo?_({...u,produto_id:t,preco_unitario:a.preco_custo.toFixed(2)}):_({...u,produto_id:t}))},me=()=>{if(!u.produto_id||!u.quantidade_pedida||!u.preco_unitario){d.error("Preencha todos os campos do item");return}const t=c.find(l=>l.id===parseInt(u.produto_id)),a=parseFloat(u.quantidade_pedida),r=parseFloat(u.preco_unitario),s=parseInt(u.produto_id),h=o.itens.findIndex(l=>l.produto_id===s);if(h!==-1){const l=o.itens[h];if(window.confirm(`‚ö†Ô∏è O produto "${t.nome}" j√° est√° no pedido!

Quantidade atual: ${l.quantidade_pedida}
Pre√ßo atual: R$ ${l.preco_unitario.toFixed(2)}

Nova quantidade: ${a}
Novo pre√ßo: R$ ${r.toFixed(2)}

Deseja SOMAR a quantidade ao item existente?

‚úÖ OK = Somar quantidade (${l.quantidade_pedida} + ${a} = ${l.quantidade_pedida+a})
‚ùå CANCELAR = N√£o adicionar`)){const Z=[...o.itens];Z[h]={...l,quantidade_pedida:l.quantidade_pedida+a,preco_unitario:r,total:(l.quantidade_pedida+a)*r},m({...o,itens:Z}),d.success(`‚úÖ Quantidade somada! Total: ${l.quantidade_pedida+a}`)}else d.info("Adi√ß√£o cancelada");D(""),_({produto_id:"",quantidade_pedida:"",preco_unitario:""});return}m({...o,itens:[...o.itens,{produto_id:s,produto_nome:t.nome,quantidade_pedida:a,preco_unitario:r,desconto_item:0,total:a*r}]}),D(""),_({produto_id:"",quantidade_pedida:"",preco_unitario:""})},he=t=>{m({...o,itens:o.itens.filter((a,r)=>r!==t)})},ge=()=>{const t=o.itens.reduce((s,h)=>s+h.total,0),a=parseFloat(o.valor_frete||0),r=parseFloat(o.valor_desconto||0);return t+a-r},Y=async()=>{if(!o.fornecedor_id){d.error("Selecione um fornecedor primeiro");return}V(!0);try{const t=await p.get(`/pedidos-compra/sugestao/${o.fornecedor_id}`,{params:{periodo_dias:K,dias_cobertura:W,apenas_criticos:J,incluir_alerta:G}});oe(t.data.sugestoes||[]),P([]),Q({}),t.data.sugestoes.length===0?d.info("Nenhuma sugest√£o encontrada com os filtros aplicados"):d.success(`${t.data.sugestoes.length} produtos analisados`)}catch(t){console.error("Erro ao buscar sugest√µes:",t),d.error("Erro ao gerar sugest√µes")}finally{V(!1)}},be=t=>{P(a=>a.includes(t)?a.filter(r=>r!==t):[...a,t])},fe=(t,a)=>{Q(r=>({...r,[t]:parseFloat(a)||0}))},T=t=>H[t.produto_id]!==void 0?H[t.produto_id]:t.quantidade_sugerida,U=()=>{B(!1),P([]),Q({})},je=()=>{const t=g.filter(a=>a.prioridade==="CR√çTICO"&&a.quantidade_sugerida>0).map(a=>a.produto_id);P(t)},ye=()=>{if(j.length===0){d.error("Selecione pelo menos um produto");return}const a=g.filter(r=>j.includes(r.produto_id)).map(r=>{const s=T(r);return{produto_id:r.produto_id,produto_nome:r.produto_nome,quantidade_pedida:Math.ceil(s),preco_unitario:r.preco_unitario,desconto_item:0,total:Math.ceil(s)*r.preco_unitario}});m({...o,itens:[...o.itens,...a]}),d.success(`${a.length} produtos adicionados ao pedido`),U()},ve=async t=>{var a,r;if(t.preventDefault(),o.itens.length===0){d.error("Adicione pelo menos 1 item ao pedido");return}x(!0);try{const s={...o,data_prevista_entrega:o.data_prevista_entrega?`${o.data_prevista_entrega}T12:00:00`:null};await p.post("/pedidos-compra/",s),d.success("‚úÖ Pedido criado com sucesso!"),w(!1),m({fornecedor_id:"",data_prevista_entrega:"",valor_frete:"0",valor_desconto:"0",observacoes:"",itens:[]}),N()}catch(s){d.error(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.detail)||"Erro ao criar pedido")}finally{x(!1)}},_e=async t=>{re(t),z({email:"",whatsapp:"",formatos:{pdf:!0,excel:!1}}),R(!0)},Ne=async()=>{var t,a;if(!v.email&&!v.whatsapp){d.error("Informe um e-mail ou WhatsApp");return}if(!v.formatos.pdf&&!v.formatos.excel){d.error("Selecione pelo menos um formato (PDF ou Excel)");return}try{await p.post(`/pedidos-compra/${O}/enviar`,{email:v.email,whatsapp:v.whatsapp,formatos:v.formatos}),d.success("‚úÖ Pedido marcado como enviado!"),R(!1),N()}catch(r){d.error(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.detail)||"Erro ao enviar pedido")}},we=async()=>{var t,a;try{await p.post(`/pedidos-compra/${O}/enviar`,{envio_manual:!0}),d.success("‚úÖ Pedido marcado como enviado manualmente!"),R(!1),N()}catch(r){d.error(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.detail)||"Erro ao marcar pedido")}},Ce=async t=>{var a,r;try{await p.post(`/pedidos-compra/${t}/confirmar`,{}),d.success("‚úÖ Pedido confirmado!"),N()}catch(s){d.error(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.detail)||"Erro ao confirmar pedido")}},Se=async t=>{try{const a=await p.get(`/pedidos-compra/${t}/export/pdf`,{responseType:"blob"}),r=window.URL.createObjectURL(new Blob([a.data])),s=document.createElement("a");s.href=r,s.setAttribute("download",`pedido_${t}.pdf`),document.body.appendChild(s),s.click(),s.remove(),d.success("üìÑ PDF exportado com sucesso!")}catch{d.error("Erro ao exportar PDF")}},Ee=async t=>{try{const a=await p.get(`/pedidos-compra/${t}/export/excel`,{responseType:"blob"}),r=window.URL.createObjectURL(new Blob([a.data])),s=document.createElement("a");s.href=r,s.setAttribute("download",`pedido_${t}.xlsx`),document.body.appendChild(s),s.click(),s.remove(),d.success("üìä Excel exportado com sucesso!")}catch{d.error("Erro ao exportar Excel")}},ke=async t=>{try{const a=await p.get(`/pedidos-compra/${t.id}`);$(a.data),F(!0)}catch{d.error("Erro ao carregar detalhes do pedido")}},Pe=async t=>{var a,r;if(confirm("‚ö†Ô∏è Deseja reverter o status deste pedido para a etapa anterior?"))try{const s=await p.post(`/pedidos-compra/${t}/reverter`,{});d.success(`‚è™ Status revertido: ${s.data.status_anterior} ‚Üí ${s.data.status_atual}`),N()}catch(s){d.error(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.detail)||"Erro ao reverter status")}},qe=async t=>{var a,r,s;if(t.status!=="rascunho"){d.error("‚ö†Ô∏è Apenas pedidos em rascunho podem ser editados");return}try{const l=(await p.get(`/pedidos-compra/${t.id}`)).data;I(!0),M(l),m({fornecedor_id:((a=l.fornecedor_id)==null?void 0:a.toString())||"",data_prevista_entrega:l.data_prevista_entrega?new Date(l.data_prevista_entrega).toISOString().split("T")[0]:"",valor_frete:((r=l.valor_frete)==null?void 0:r.toString())||"0",valor_desconto:((s=l.valor_desconto)==null?void 0:s.toString())||"0",observacoes:l.observacoes||"",itens:l.itens.map(f=>({produto_id:f.produto_id,produto_nome:f.produto_nome||`Produto ${f.produto_id}`,quantidade_pedida:f.quantidade_pedida,preco_unitario:f.preco_unitario,desconto_item:f.desconto_item||0,total:f.quantidade_pedida*f.preco_unitario-(f.desconto_item||0)}))}),l.fornecedor_id&&X(l.fornecedor_id),w(!0),d.success("üìù Modo de edi√ß√£o ativado")}catch{d.error("Erro ao carregar pedido para edi√ß√£o")}},$e=async t=>{var a,r;if(t.preventDefault(),o.itens.length===0){d.error("‚ö†Ô∏è Adicione pelo menos um item ao pedido");return}try{x(!0);const s={...o,fornecedor_id:parseInt(o.fornecedor_id),valor_frete:parseFloat(o.valor_frete),valor_desconto:parseFloat(o.valor_desconto),data_prevista_entrega:o.data_prevista_entrega?`${o.data_prevista_entrega}T12:00:00`:null,itens:o.itens.map(h=>({produto_id:h.produto_id,quantidade_pedida:parseFloat(h.quantidade_pedida),preco_unitario:parseFloat(h.preco_unitario),desconto_item:parseFloat(h.desconto_item||0)}))};await p.put(`/pedidos-compra/${ee.id}`,s),d.success("‚úèÔ∏è Pedido atualizado com sucesso!"),w(!1),I(!1),M(null),m({fornecedor_id:"",data_prevista_entrega:"",valor_frete:"0",valor_desconto:"0",observacoes:"",itens:[]}),N()}catch(s){d.error(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.detail)||"Erro ao atualizar pedido")}finally{x(!1)}},Fe=async t=>{try{const a=await p.get(`/pedidos-compra/${t.id}`);$(a.data),F(!0)}catch{d.error("Erro ao carregar detalhes do pedido")}},Re=async t=>{var a,r;try{await p.post(`/pedidos-compra/${L.id}/receber`,{itens:t}),d.success("‚úÖ Recebimento processado com sucesso!"),F(!1),$(null),N()}catch(s){d.error(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.detail)||"Erro ao processar recebimento")}},Ae=t=>{const a={rascunho:"bg-gray-200 text-gray-800",enviado:"bg-blue-200 text-blue-800",confirmado:"bg-green-200 text-green-800",recebido_parcial:"bg-yellow-200 text-yellow-800",recebido_total:"bg-green-500 text-white",cancelado:"bg-red-200 text-red-800"};return e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${a[t]||"bg-gray-200"}`,children:t.replace("_"," ").toUpperCase()})};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"üõí Pedidos de Compra"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie seus pedidos aos fornecedores"})]}),e.jsx("button",{onClick:()=>w(!q),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors",children:q?"‚ùå Cancelar":"‚ûï Novo Pedido"})]}),q&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:C?"‚úèÔ∏è Editar Pedido":"Novo Pedido de Compra"}),e.jsx("button",{type:"button",onClick:()=>{w(!1),I(!1),M(null)},className:"text-gray-500 hover:text-gray-700",children:"‚úñÔ∏è"})]}),e.jsxs("form",{onSubmit:C?$e:ve,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fornecedor *"}),e.jsx("input",{list:"fornecedores-list",value:ce,onChange:t=>{const a=t.target.value;pe(a);const r=k.find(s=>s.nome===a);r?(m({...o,fornecedor_id:r.id.toString(),itens:[]}),_({produto_id:"",quantidade_pedida:"",preco_unitario:""}),X(r.id)):(m({...o,fornecedor_id:"",itens:[]}),b([]))},placeholder:"Digite ou selecione o fornecedor",required:!!o.fornecedor_id,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsx("datalist",{id:"fornecedores-list",children:k.map(t=>e.jsx("option",{value:t.nome,children:t.cpf_cnpj?`- ${t.cpf_cnpj}`:""},t.id))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Digite ou selecione um fornecedor para carregar seus produtos"}),o.fornecedor_id&&e.jsx("button",{type:"button",onClick:()=>{B(!0),Y()},className:"mt-2 w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition-all flex items-center justify-center gap-2",children:"üí° Sugest√£o Inteligente de Pedido"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Prevista Entrega"}),e.jsx("input",{type:"date",value:o.data_prevista_entrega,onChange:t=>m({...o,data_prevista_entrega:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Itens do Pedido"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-4",children:[e.jsx("input",{list:"produtos-list",value:xe,onChange:t=>{const a=t.target.value;D(a);const r=c.find(s=>s.nome===a);r?ue(r.id.toString()):_({...u,produto_id:""})},placeholder:o.fornecedor_id?"Digite ou selecione o produto":"Selecione um fornecedor primeiro",disabled:!o.fornecedor_id,className:"col-span-2 px-4 py-2 border border-gray-300 rounded-lg disabled:bg-gray-100 focus:ring-2 focus:ring-blue-500"}),e.jsx("datalist",{id:"produtos-list",children:c.map(t=>e.jsx("option",{value:t.nome,children:`SKU: ${t.sku||t.codigo||"N/A"} | Barras: ${t.codigo_barras||"N/A"} | Estoque: ${t.estoque_atual||0}`},t.id))}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantidade",value:u.quantidade_pedida,onChange:t=>_({...u,quantidade_pedida:t.target.value}),className:"px-4 py-2 border border-gray-300 rounded-lg"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Pre√ßo",value:u.preco_unitario,onChange:t=>_({...u,preco_unitario:t.target.value}),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg"}),e.jsx("button",{type:"button",onClick:me,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:"‚ûï"})]})]}),o.itens.length>0&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-sm font-semibold",children:"Produto"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold",children:"Pre√ßo"}),e.jsx("th",{className:"px-4 py-2 text-right text-sm font-semibold",children:"Total"}),e.jsx("th",{className:"px-4 py-2"})]})}),e.jsx("tbody",{children:o.itens.map((t,a)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:t.produto_nome}),e.jsx("td",{className:"px-4 py-2 text-right",children:t.quantidade_pedida}),e.jsxs("td",{className:"px-4 py-2 text-right",children:["R$ ",t.preco_unitario.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-2 text-right font-semibold",children:["R$ ",t.total.toFixed(2)]}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx("button",{type:"button",onClick:()=>he(a),className:"text-red-600 hover:text-red-800",children:"üóëÔ∏è"})})]},a))})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Frete (R$)"}),e.jsx("input",{type:"number",step:"0.01",value:o.valor_frete,onChange:t=>m({...o,valor_frete:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Desconto (R$)"}),e.jsx("input",{type:"number",step:"0.01",value:o.valor_desconto,onChange:t=>m({...o,valor_desconto:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Total"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["R$ ",ge().toFixed(2)]})]})]}),e.jsx("button",{type:"submit",disabled:n,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-400",children:n?"‚è≥ Processando...":C?"‚úèÔ∏è Salvar Altera√ß√µes":"‚úÖ Criar Pedido"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"N√∫mero"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Fornecedor"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"A√ß√µes"})]})}),e.jsx("tbody",{children:S.map(t=>e.jsxs("tr",{className:`border-t hover:bg-gray-50 ${t.status==="rascunho"?"cursor-pointer":""}`,onClick:()=>t.status==="rascunho"&&qe(t),title:t.status==="rascunho"?"Clique para editar":"",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.numero_pedido,t.foi_alterado_apos_envio&&e.jsx("span",{className:"px-2 py-1 text-xs bg-orange-100 text-orange-700 rounded font-semibold",title:"Este pedido foi alterado ap√≥s o envio",children:"‚ö†Ô∏è Alterado"})]})}),e.jsx("td",{className:"px-4 py-3",children:t.fornecedor_id}),e.jsx("td",{className:"px-4 py-3",children:new Date(t.data_pedido).toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold",children:["R$ ",t.valor_final.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-center",children:Ae(t.status)}),e.jsx("td",{className:"px-4 py-3 text-center",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>ke(t),className:"px-2 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 text-xs font-semibold",title:"Ver detalhes completos do pedido",children:"üîç Ver"}),e.jsx("button",{onClick:()=>Se(t.id),className:"px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 text-xs font-semibold",title:"Exportar PDF",children:"üìÑ PDF"}),e.jsx("button",{onClick:()=>Ee(t.id),className:"px-2 py-1 bg-green-100 text-green-700 rounded hover:bg-green-200 text-xs font-semibold",title:"Exportar Excel",children:"üìä Excel"}),t.status==="rascunho"&&e.jsx("button",{onClick:()=>_e(t.id),className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs font-semibold",title:"Enviar pedido ao fornecedor",children:"üì§ Enviar"}),t.status==="enviado"&&e.jsx("button",{onClick:()=>Ce(t.id),className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-xs font-semibold",title:"Confirmar recebimento do pedido pelo fornecedor",children:"‚úÖ Confirmar"}),(t.status==="confirmado"||t.status==="recebido_parcial")&&e.jsx("button",{onClick:()=>Fe(t),className:"px-3 py-1 bg-purple-600 text-white rounded hover:bg-purple-700 text-xs font-semibold",title:"Registrar entrada de produtos no estoque",children:"üì¶ Receber"}),t.status!=="rascunho"&&t.status!=="recebido_total"&&e.jsx("button",{onClick:()=>Pe(t.id),className:"px-2 py-1 bg-orange-100 text-orange-700 rounded hover:bg-orange-200 text-xs font-semibold",title:"Reverter para status anterior",children:"‚è™ Reverter"})]})})]},t.id))})]})}),te&&L&&e.jsx(De,{pedido:L,onClose:()=>{F(!1),$(null)},onReceber:Re}),ae&&e.jsx(Te,{pedidoId:O,onClose:()=>R(!1),onEnviar:Ne,onEnvioManual:we,dadosEnvio:v,setDadosEnvio:z}),se&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-7xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"üí° Sugest√£o Inteligente de Pedido"}),e.jsx("p",{className:"text-purple-100",children:"An√°lise baseada em vendas e estoque atual"})]}),e.jsx("button",{onClick:U,className:"text-white hover:bg-white hover:bg-opacity-20 rounded-lg p-2",children:"‚úñÔ∏è"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-purple-100 mb-1",children:"Per√≠odo de An√°lise"}),e.jsxs("select",{value:K,onChange:t=>de(parseInt(t.target.value)),className:"w-full px-3 py-2 rounded-lg text-gray-800 focus:ring-2 focus:ring-purple-300",children:[e.jsx("option",{value:30,children:"√öltimos 30 dias"}),e.jsx("option",{value:60,children:"√öltimos 60 dias"}),e.jsx("option",{value:90,children:"√öltimos 90 dias"}),e.jsx("option",{value:180,children:"√öltimos 180 dias"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-purple-100 mb-1",children:"Cobertura de Estoque"}),e.jsxs("select",{value:W,onChange:t=>ie(parseInt(t.target.value)),className:"w-full px-3 py-2 rounded-lg text-gray-800 focus:ring-2 focus:ring-purple-300",children:[e.jsx("option",{value:15,children:"15 dias"}),e.jsx("option",{value:30,children:"30 dias"}),e.jsx("option",{value:45,children:"45 dias"}),e.jsx("option",{value:60,children:"60 dias"}),e.jsx("option",{value:90,children:"90 dias"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2 text-white cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:J,onChange:t=>ne(t.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{children:"Apenas Cr√≠ticos"})]})}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2 text-white cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:G,onChange:t=>le(t.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{children:"Incluir Alertas"})]})}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:Y,disabled:A,className:"w-full bg-white text-purple-600 px-4 py-2 rounded-lg font-semibold hover:bg-purple-50 disabled:opacity-50",children:A?"üîÑ Analisando...":"üîç Atualizar"})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:A?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Analisando produtos e calculando sugest√µes..."})]})}):g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhuma sugest√£o encontrada com os filtros aplicados"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Tente ajustar os filtros acima"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex gap-3",children:[e.jsx("button",{onClick:je,className:"bg-red-100 text-red-700 px-4 py-2 rounded-lg font-semibold hover:bg-red-200",children:"üî¥ Selecionar Todos Cr√≠ticos"}),e.jsx("div",{className:"flex-1"}),e.jsxs("span",{className:"text-gray-600",children:[j.length," de ",g.length," produtos selecionados"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:e.jsx("input",{type:"checkbox",onChange:t=>{t.target.checked?P(g.map(a=>a.produto_id)):P([])},checked:j.length===g.length,className:"w-4 h-4 rounded"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Prioridade"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Estoque"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Consumo/dia"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Dias Restantes"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Qtd Sugerida"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Pre√ßo Unit."}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Tend√™ncia"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:g.map(t=>e.jsxs("tr",{className:`hover:bg-gray-50 ${j.includes(t.produto_id)?"bg-purple-50":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:j.includes(t.produto_id),onChange:()=>be(t.produto_id),className:"w-4 h-4 rounded"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${t.prioridade==="CR√çTICO"?"bg-red-100 text-red-700":t.prioridade==="ALERTA"?"bg-yellow-100 text-yellow-700":t.prioridade==="ATEN√á√ÉO"?"bg-orange-100 text-orange-700":"bg-green-100 text-green-700"}`,children:t.prioridade})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.produto_nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:["SKU: ",t.produto_sku||"N/A"," | Barras: ",t.produto_codigo_barras||"N/A"]}),t.observacao&&e.jsx("div",{className:"text-xs text-gray-600 mt-1 italic",children:t.observacao})]})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("div",{className:"font-medium",children:t.estoque_atual}),e.jsxs("div",{className:"text-xs text-gray-500",children:["M√≠n: ",t.estoque_minimo]})]}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:t.consumo_diario.toFixed(2)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:`font-semibold ${t.dias_estoque&&t.dias_estoque<7?"text-red-600":t.dias_estoque&&t.dias_estoque<14?"text-yellow-600":"text-green-600"}`,children:t.dias_estoque?`${t.dias_estoque} dias`:"‚àû"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"number",min:"0",step:"1",value:Math.ceil(T(t)),onChange:a=>fe(t.produto_id,a.target.value),className:"w-20 px-2 py-1 text-right font-bold text-purple-600 border rounded focus:ring-2 focus:ring-purple-300"})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["R$ ",t.preco_unitario.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold",children:["R$ ",(T(t)*t.preco_unitario).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`text-xs ${t.tendencia==="CRESCIMENTO"?"text-green-600":t.tendencia==="QUEDA"?"text-red-600":"text-gray-600"}`,children:[t.tendencia==="CRESCIMENTO"?"üìà":t.tendencia==="QUEDA"?"üìâ":t.tendencia==="EST√ÅVEL"?"‚û°Ô∏è":"‚Äî",t.tendencia]})})]},t.produto_id))})]})})]})}),!A&&g.length>0&&e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Resumo da Sugest√£o:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:["üî¥ ",e.jsx("strong",{children:g.filter(t=>t.prioridade==="CR√çTICO").length})," cr√≠ticos"]}),e.jsxs("div",{children:["‚ö†Ô∏è ",e.jsx("strong",{children:g.filter(t=>t.prioridade==="ALERTA").length})," em alerta"]}),e.jsxs("div",{children:["üí∞ Total: ",e.jsxs("strong",{children:["R$ ",g.filter(t=>j.includes(t.produto_id)).reduce((t,a)=>t+T(a)*a.preco_unitario,0).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:U,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-100",children:"Cancelar"}),e.jsxs("button",{onClick:ye,disabled:j.length===0,className:"px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:["‚úÖ Adicionar ",j.length," Produtos ao Pedido"]})]})]})})]})})]})},De=({pedido:S,onClose:E,onReceber:k})=>{const[y,c]=i.useState(S.itens.map(n=>({item_id:n.id,quantidade_recebida:n.quantidade_pedida-n.quantidade_recebida,max:n.quantidade_pedida-n.quantidade_recebida}))),b=()=>{const n=y.filter(x=>x.quantidade_recebida>0).map(x=>({item_id:x.item_id,quantidade_recebida:parseFloat(x.quantidade_recebida)}));if(n.length===0){d.error("Informe a quantidade recebida de pelo menos 1 item");return}k(n)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["üì¶ Receber Pedido ",S.numero_pedido]}),e.jsx("div",{className:"space-y-4",children:S.itens.map((n,x)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold mb-2",children:n.produto_nome}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Pedido:"}),e.jsx("span",{className:"ml-2 font-semibold",children:n.quantidade_pedida})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"J√° Recebido:"}),e.jsx("span",{className:"ml-2 font-semibold",children:n.quantidade_recebida})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Pendente:"}),e.jsx("span",{className:"ml-2 font-semibold text-orange-600",children:n.quantidade_pedida-n.quantidade_recebida})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade a Receber"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:y[x].max,value:y[x].quantidade_recebida,onChange:q=>{const w=parseFloat(q.target.value)||0,C=[...y];C[x].quantidade_recebida=Math.min(w,C[x].max),c(C)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]},n.id))}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{onClick:b,className:"flex-1 bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700",children:"‚úÖ Confirmar Recebimento"}),e.jsx("button",{onClick:E,className:"px-6 py-3 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50",children:"‚ùå Cancelar"})]})]})})},Te=({pedidoId:S,onClose:E,onEnviar:k,onEnvioManual:y,dadosEnvio:c,setDadosEnvio:b})=>e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"üì§ Enviar Pedido ao Fornecedor"}),e.jsx("button",{onClick:E,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail do Fornecedor"}),e.jsx("input",{type:"email",value:c.email,onChange:n=>b({...c,email:n.target.value}),placeholder:"fornecedor@exemplo.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["WhatsApp (futuro)",e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Em breve)"})]}),e.jsx("input",{type:"tel",value:c.whatsapp,onChange:n=>b({...c,whatsapp:n.target.value}),placeholder:"(00) 00000-0000",className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Formatos para Envio"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:c.formatos.pdf,onChange:n=>b({...c,formatos:{...c.formatos,pdf:n.target.checked}}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm",children:"üìÑ PDF"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:c.formatos.excel,onChange:n=>b({...c,formatos:{...c.formatos,excel:n.target.checked}}),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),e.jsx("span",{className:"ml-2 text-sm",children:"üìä Excel"})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 pt-4",children:[e.jsx("button",{onClick:k,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors",children:"üìß Enviar por E-mail"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"ou"})})]}),e.jsx("button",{onClick:y,className:"w-full bg-gray-600 text-white py-3 rounded-lg font-semibold hover:bg-gray-700 transition-colors",children:"‚úÖ J√° enviei manualmente"}),e.jsx("button",{onClick:E,className:"w-full border border-gray-300 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-50",children:"‚ùå Cancelar"})]})]})]})});export{Le as default};
