import{r as i,aP as _,j as e,am as G,bk as Ee,bn as qe,aG as De,al as Se,aZ as Oe,b5 as Te,aF as Ie,bo as Le,b8 as Re,aA as ae,an as z,bp as ge,bq as pe,br as $e,aX as Ae,ao as ue,ak as ze,S as Ve,z as se,aj as Ne,bs as Be,bt as Ge}from"./vendor-react-1772126716650.js";import{a as M}from"./index-1772126716650.js";const Ke=()=>{const[K,p]=i.useState(!0),[b,u]=i.useState(!1),[k,D]=i.useState(null),[E,te]=i.useState([]),[O,Q]=i.useState([]),[C,T]=i.useState([]),[x,Z]=i.useState([]),[V,J]=i.useState({campo:null,direcao:"asc"}),[o,U]=i.useState({especies:[],linhas:[],portes:[],fases:[],tratamentos:[],sabores:[],pesos:[],marca_ids:[],categoria_ids:[],margem_min:null,margem_max:null,data_inicio:null,data_fim:null}),[S,H]=i.useState({marcas:[],categorias:[],especies:[],linhas:[],portes:[],fases:[],tratamentos:[],sabores:[],pesos:[]}),[r,j]=i.useState("porte"),[v,F]=i.useState(!0),[d,W]=i.useState("comparacao");i.useEffect(()=>{P()},[]);const P=async()=>{var s,g,f;try{p(!0);const n=localStorage.getItem("access_token");console.log("ðŸ” [DashboardAnaliseRacoes] Iniciando carregamento de dados",{hasToken:!!n,tokenPreview:n?`${n.substring(0,20)}...`:"NO TOKEN"}),console.log("ðŸ“¡ [DashboardAnaliseRacoes] Chamando: /racoes/analises/opcoes-filtros");const h=await M.get("/racoes/analises/opcoes-filtros");console.log("âœ… [DashboardAnaliseRacoes] OpÃ§Ãµes carregadas:",h.data),H(h.data),await oe(),p(!1)}catch(n){console.error("âŒ [DashboardAnaliseRacoes] Erro ao carregar dados:",{message:n.message,status:(s=n.response)==null?void 0:s.status,data:(g=n.response)==null?void 0:g.data,config:n.config}),((f=n.response)==null?void 0:f.status)===403?_.error("Acesso negado. Verifique suas permissÃµes ou faÃ§a login novamente."):_.error("Erro ao carregar dados do dashboard"),p(!1)}},oe=async(s=null,g=null)=>{try{const f={};s&&(f.data_inicio=s),g&&(f.data_fim=g);const n=await M.get("/racoes/analises/resumo",{params:f});D(n.data)}catch(f){console.error("Erro ao carregar resumo:",f),_.error("Erro ao carregar resumo")}},le=async()=>{try{u(!0);const s=await M.post(`/racoes/analises/margem-por-segmento?tipo_segmento=${r}`,o);te(s.data),u(!1)}catch(s){console.error("Erro ao carregar anÃ¡lise:",s),_.error("Erro ao carregar anÃ¡lise de segmento"),u(!1)}},de=async()=>{try{u(!0);const s=await M.post("/racoes/analises/comparacao-marcas",o);Q(s.data),u(!1)}catch(s){console.error("Erro ao carregar comparaÃ§Ã£o:",s),_.error("Erro ao carregar comparaÃ§Ã£o de marcas"),u(!1)}},ce=async()=>{try{if(!o.data_inicio||!o.data_fim){_.error("Selecione um perÃ­odo para ver o ranking de vendas");return}u(!0);const s=await M.get("/racoes/analises/ranking-vendas",{params:{data_inicio:o.data_inicio,data_fim:o.data_fim,limite:20}});T(s.data),u(!1)}catch(s){console.error("Erro ao carregar ranking:",s),_.error("Erro ao carregar ranking de vendas"),u(!1)}},ie=async()=>{try{u(!0);const s=await M.post("/racoes/analises/produtos-comparacao",o);Z(s.data),J({campo:null,direcao:"asc"}),u(!1)}catch(s){console.error("Erro ao carregar produtos para comparaÃ§Ã£o:",s),_.error("Erro ao carregar produtos"),u(!1)}},he=s=>{const g=V.campo===s&&V.direcao==="asc"?"desc":"asc";J({campo:s,direcao:g});const f=[...x].sort((n,h)=>{let y,w;switch(s){case"nome":y=n.nome,w=h.nome;break;case"custo":y=n.preco_custo||0,w=h.preco_custo||0;break;case"venda":y=n.preco_venda||0,w=h.preco_venda||0;break;case"lucro":y=(n.preco_venda||0)-(n.preco_custo||0),w=(h.preco_venda||0)-(h.preco_custo||0);break;case"margem":y=calcularMargem(n.preco_custo,n.preco_venda),w=calcularMargem(h.preco_custo,h.preco_venda);break;case"roi":y=calcularROI(n.preco_custo,n.preco_venda),w=calcularROI(h.preco_custo,h.preco_venda);break;case"custokg":y=(n.preco_custo||0)/(n.peso_embalagem||1),w=(h.preco_custo||0)/(h.peso_embalagem||1);break;case"vendakg":y=(n.preco_venda||0)/(n.peso_embalagem||1),w=(h.preco_venda||0)/(h.peso_embalagem||1);break;default:return 0}return typeof y=="string"?g==="asc"?y.localeCompare(w):w.localeCompare(y):g==="asc"?y-w:w-y});Z(f)},Y=(s,g)=>{U(f=>({...f,[s]:g}))},B=(s,g)=>{U(f=>{const n=f[s]||[],h=n.includes(g);return{...f,[s]:h?n.filter(y=>y!==g):[...n,g]}})},xe=()=>{d==="segmento"?le():d==="marcas"?de():d==="ranking"?ce():d==="comparacao"&&ie(),o.data_inicio&&o.data_fim&&oe(o.data_inicio,o.data_fim)},a=()=>{U({especies:[],linhas:[],portes:[],fases:[],tratamentos:[],sabores:[],pesos:[],marca_ids:[],categoria_ids:[],margem_min:null,margem_max:null,data_inicio:null,data_fim:null})},l=s=>{W(s),s==="segmento"&&E.length===0?le():s==="marcas"&&O.length===0?de():s==="ranking"&&C.length===0?o.data_inicio&&o.data_fim&&ce():s==="comparacao"&&x.length===0&&ie()},m=()=>k?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Se,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"RaÃ§Ãµes Cadastradas"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:k.total_racoes}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[k.total_classificadas," classificadas (",k.percentual_classificadas,"%)"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Te,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Margem MÃ©dia"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[k.margem_media_geral,"%"]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["em ",k.total_racoes," produtos"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ie,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Faturamento PerÃ­odo"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",k.faturamento_periodo.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[k.marcas_cadastradas," marcas ativas"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Le,{className:"h-5 w-5 text-purple-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Mais Vendido"})]}),k.produto_mais_vendido?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 truncate",children:k.produto_mais_vendido.nome}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[k.produto_mais_vendido.quantidade," unidades"]})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Sem dados de vendas"})]})]}):null,R=()=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Filtros"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:"Clique para selecionar/desmarcar"})]}),e.jsx("button",{onClick:()=>F(!v),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:v?"Ocultar â–²":"Mostrar â–¼"})]}),v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Marcas"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:S.marcas.map(s=>e.jsx("button",{onClick:()=>B("marca_ids",s.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${o.marca_ids.includes(s.id)?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:s.nome},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Linha de RaÃ§Ã£o"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:S.linhas.map(s=>e.jsx("button",{onClick:()=>B("linhas",s.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${o.linhas.includes(s.id)?"bg-purple-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:s.nome},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Porte do Animal"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:S.portes.map(s=>e.jsx("button",{onClick:()=>B("portes",s.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${o.portes.includes(s.id)?"bg-green-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:s.nome},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Fase/PÃºblico"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:S.fases.map(s=>e.jsx("button",{onClick:()=>B("fases",s.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${o.fases.includes(s.id)?"bg-amber-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:s.nome},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Sabor/ProteÃ­na"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:S.sabores.map(s=>e.jsx("button",{onClick:()=>B("sabores",s),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${o.sabores.includes(s)?"bg-pink-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Peso da Embalagem"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:S.pesos.map(s=>e.jsxs("button",{onClick:()=>B("pesos",s),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${o.pesos.includes(s)?"bg-indigo-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[s," kg"]},s))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Margem MÃ­nima (%)"}),e.jsx("input",{type:"number",step:"0.01",value:o.margem_min||"",onChange:s=>Y("margem_min",parseFloat(s.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"Ex: 25"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Margem MÃ¡xima (%)"}),e.jsx("input",{type:"number",step:"0.01",value:o.margem_max||"",onChange:s=>Y("margem_max",parseFloat(s.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"Ex: 50"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data InÃ­cio"}),e.jsx("input",{type:"date",value:o.data_inicio||"",onChange:s=>Y("data_inicio",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:o.data_fim||"",onChange:s=>Y("data_fim",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsxs("button",{onClick:xe,className:"px-6 py-2.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2 font-medium",children:[e.jsx(Re,{className:"h-4 w-4"}),"Aplicar Filtros"]}),e.jsx("button",{onClick:a,className:"px-6 py-2.5 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 font-medium",children:"Limpar Tudo"}),o.marca_ids.length+o.linhas.length+o.portes.length+o.fases.length+o.sabores.length+o.pesos.length>0&&e.jsxs("div",{className:"flex items-center gap-2 ml-auto text-sm text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:o.marca_ids.length+o.linhas.length+o.portes.length+o.fases.length+o.sabores.length+o.pesos.length}),"filtros ativos"]})]})]})]}),$=()=>b?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando anÃ¡lise..."}):E.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),'Nenhum dado encontrado. Aplique filtros e clique em "Aplicar Filtros"']}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Analisar por:"}),e.jsxs("select",{value:r,onChange:s=>{j(s.target.value),setTimeout(()=>le(),0)},className:"px-3 py-1.5 border border-gray-300 rounded-md text-sm",children:[e.jsx("option",{value:"porte",children:"Porte"}),e.jsx("option",{value:"fase",children:"Fase"}),e.jsx("option",{value:"sabor",children:"Sabor"}),e.jsx("option",{value:"linha",children:"Linha"}),e.jsx("option",{value:"especie",children:"EspÃ©cie"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Segmento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Produtos"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Margem MÃ©dia"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Margem Min/Max"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"PreÃ§o/Kg MÃ©dio"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Faturamento"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:E.map((s,g)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900",children:s.segmento}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:s.total_produtos}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("span",{className:`font-semibold ${s.margem_media>=30?"text-green-600":s.margem_media>=20?"text-yellow-600":"text-red-600"}`,children:[s.margem_media,"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:[s.margem_minima,"% - ",s.margem_maxima,"%"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:["R$ ",s.preco_medio_kg.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center font-semibold text-gray-900",children:["R$ ",s.faturamento.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]},g))})]})})]}),I=()=>b?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando comparaÃ§Ã£o..."}):O.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),'Nenhum dado encontrado. Aplique filtros e clique em "Aplicar Filtros"']}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Marca"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Produtos"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"PreÃ§o/Kg MÃ©dio"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Margem MÃ©dia"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Mais Barato"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Mais Caro"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:O.map(s=>{var g,f,n,h,y,w;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900",children:s.marca_nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:s.total_produtos}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center font-semibold text-gray-900",children:["R$ ",s.preco_medio_kg.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("span",{className:`font-semibold ${s.margem_media>=30?"text-green-600":s.margem_media>=20?"text-yellow-600":"text-red-600"}`,children:[s.margem_media,"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-xs text-gray-700",children:[((f=(g=s.produto_mais_barato)==null?void 0:g.nome)==null?void 0:f.substring(0,30))||"-",((n=s.produto_mais_barato)==null?void 0:n.preco_kg)&&e.jsxs("div",{className:"text-green-600 font-semibold",children:["R$ ",s.produto_mais_barato.preco_kg,"/kg"]})]}),e.jsxs("td",{className:"px-4 py-3 text-xs text-gray-700",children:[((y=(h=s.produto_mais_caro)==null?void 0:h.nome)==null?void 0:y.substring(0,30))||"-",((w=s.produto_mais_caro)==null?void 0:w.preco_kg)&&e.jsxs("div",{className:"text-red-600 font-semibold",children:["R$ ",s.produto_mais_caro.preco_kg,"/kg"]})]})]},s.marca_id)})})]})}),L=()=>b?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando ranking..."}):C.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),'Selecione um perÃ­odo nos filtros e clique em "Aplicar Filtros"']}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Marca"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Qtd Vendida"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Faturamento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"Margem MÃ©dia"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase",children:"PreÃ§o MÃ©dio"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:C.map((s,g)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold ${g===0?"bg-yellow-100 text-yellow-700":g===1?"bg-gray-200 text-gray-700":g===2?"bg-orange-100 text-orange-700":"bg-gray-50 text-gray-600"}`,children:g+1})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:s.nome}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:s.marca}),e.jsx("td",{className:"px-4 py-3 text-sm text-center font-semibold text-gray-900",children:s.quantidade_vendida}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center font-semibold text-green-600",children:["R$ ",s.faturamento.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("span",{className:`font-semibold ${s.margem_media>=30?"text-green-600":s.margem_media>=20?"text-yellow-600":"text-red-600"}`,children:[s.margem_media,"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-center text-gray-900",children:["R$ ",s.preco_medio_venda.toFixed(2)]})]},s.produto_id))})]})}),A=()=>{if(b)return e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(G,{className:"h-8 w-8 animate-spin text-blue-500 mr-3"}),e.jsx("span",{className:"text-gray-600",children:"Carregando produtos..."})]});if(x.length===0)return e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(ae,{className:"h-16 w-16 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Nenhum produto encontrado"}),e.jsx("p",{className:"text-sm",children:'Selecione filtros acima e clique em "Aplicar Filtros"'})]});const s=(t,c)=>!c||c===0?0:parseFloat(((c-t)/c*100).toFixed(2)),g=(t,c)=>!t||t===0?0:parseFloat(((c-t)/t*100).toFixed(2)),f=(t,c)=>parseFloat((c-t).toFixed(2)),n=(t,c)=>!t||t===0?0:parseFloat(((c-t)/t*100).toFixed(2)),h=x.map(t=>t.preco_custo||0),y=x.map(t=>s(t.preco_custo,t.preco_venda)),w=x.map(t=>f(t.preco_custo||0,t.preco_venda||0)),be=x.map(t=>n(t.preco_custo,t.preco_venda)),me=Math.min(...h.filter(t=>t>0)),je=Math.max(...y),ye=Math.max(...w),fe=Math.max(...be),re=(t,c,X,ne=!1)=>{if(X===c)return"bg-gray-50";const q=(t-c)/(X-c)*100;return ne?q<=20?"bg-green-50 text-green-800 font-semibold":q<=40?"bg-green-50 text-green-700":q<=60?"bg-yellow-50 text-yellow-700":q<=80?"bg-orange-50 text-orange-700":"bg-red-50 text-red-700":q>=80?"bg-green-50 text-green-800 font-semibold":q>=60?"bg-green-50 text-green-700":q>=40?"bg-yellow-50 text-yellow-700":q>=20?"bg-orange-50 text-orange-700":"bg-red-50 text-red-700"},Fe=t=>t>=40?"text-green-700 bg-green-100 border-green-300":t>=30?"text-green-600 bg-green-50 border-green-200":t>=20?"text-yellow-600 bg-yellow-50 border-yellow-200":t>=10?"text-orange-600 bg-orange-50 border-orange-200":"text-red-600 bg-red-50 border-red-200",ee=({campo:t,children:c,className:X=""})=>e.jsx("th",{onClick:()=>he(t),className:`px-3 py-3 text-xs font-bold text-gray-700 uppercase cursor-pointer hover:bg-gray-200 transition-colors ${X}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[c,V.campo===t&&e.jsx("span",{className:"text-blue-600",children:V.direcao==="asc"?"â–²":"â–¼"})]})});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4 border-2 border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ’°"}),e.jsx("span",{className:"text-xs font-semibold text-green-700 uppercase",children:"Menor Custo"})]}),e.jsxs("p",{className:"text-2xl font-bold text-green-900",children:["R$ ",me.toFixed(2)]}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Melhor preÃ§o de compra"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border-2 border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:"â­"}),e.jsx("span",{className:"text-xs font-semibold text-blue-700 uppercase",children:"Melhor Margem"})]}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[je.toFixed(2),"%"]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Maior percentual de lucro"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4 border-2 border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŽ¯"}),e.jsx("span",{className:"text-xs font-semibold text-purple-700 uppercase",children:"Melhor ROI"})]}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900",children:[fe.toFixed(2),"%"]}),e.jsx("p",{className:"text-xs text-purple-600 mt-1",children:"Retorno sobre investimento"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 rounded-lg p-4 border-2 border-amber-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ’µ"}),e.jsx("span",{className:"text-xs font-semibold text-amber-700 uppercase",children:"Maior Lucro"})]}),e.jsxs("p",{className:"text-2xl font-bold text-amber-900",children:["R$ ",ye.toFixed(2)]}),e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"Lucro absoluto por unidade"})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total de Produtos Encontrados"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:x.length})]}),x.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Margem MÃ©dia"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[(y.reduce((t,c)=>t+c,0)/y.length).toFixed(2),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Custo MÃ©dio/kg"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["R$ ",(x.reduce((t,c)=>t+(c.preco_custo||0)/(c.peso_embalagem||1),0)/x.length).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"PreÃ§o Venda MÃ©dio/kg"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["R$ ",(x.reduce((t,c)=>t+(c.preco_venda||0)/(c.peso_embalagem||1),0)/x.length).toFixed(2)]})]})]})]})}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-start gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("strong",{children:"ðŸ’¡ Dica:"})," Clique nos cabeÃ§alhos das colunas para ordenar. As cores indicam valores melhores (verde) e piores (vermelho). Produtos destacados com badges sÃ£o os melhores em cada categoria."]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border-2 border-gray-300 shadow-lg",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{className:"bg-gradient-to-r from-gray-100 to-gray-200 border-b-2 border-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase sticky left-0 bg-gray-100 border-r border-gray-300",children:"Produto / Marca"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-gray-700 uppercase border-r border-gray-300",children:"Linha"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-gray-700 uppercase border-r border-gray-300",children:"Peso"}),e.jsx(ee,{campo:"custo",className:"border-r border-gray-300",children:"ðŸ’° Custo"}),e.jsx(ee,{campo:"venda",className:"border-r border-gray-300",children:"ðŸ’µ Venda"}),e.jsx(ee,{campo:"lucro",className:"border-r border-gray-300",children:"Lucro R$"}),e.jsx(ee,{campo:"margem",className:"border-r border-gray-300",children:"ðŸ“Š Margem %"}),e.jsx(ee,{campo:"roi",className:"border-r border-gray-300",children:"ðŸŽ¯ ROI %"}),e.jsx(ee,{campo:"custokg",className:"border-r border-gray-300",children:"Custo/kg"}),e.jsx(ee,{campo:"vendakg",className:"border-r border-gray-300",children:"Venda/kg"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-bold text-gray-700 uppercase",children:"Estoque"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:x.map(t=>{var Me;const c=s(t.preco_custo,t.preco_venda);g(t.preco_custo,t.preco_venda);const X=f(t.preco_custo||0,t.preco_venda||0),ne=n(t.preco_custo,t.preco_venda),q=(t.preco_custo||0)/(t.peso_embalagem||1),ve=(t.preco_venda||0)/(t.peso_embalagem||1),we=(t.preco_custo||0)===me&&me>0,_e=c===je&&je>0,ke=X===ye&&ye>0,Ce=ne===fe&&fe>0,Pe=we||_e||ke||Ce;return e.jsxs("tr",{className:`hover:bg-blue-50 transition-colors ${Pe?"bg-yellow-50 border-l-4 border-yellow-400":""}`,children:[e.jsx("td",{className:"px-4 py-3 sticky left-0 bg-white border-r border-gray-200",children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm",children:t.nome}),e.jsxs("p",{className:"text-xs text-gray-600 mt-0.5",children:[((Me=t.marca)==null?void 0:Me.nome)||"Sem marca"," â€¢ CÃ³d: ",t.codigo]}),e.jsxs("div",{className:"flex gap-1 mt-1.5 flex-wrap",children:[t.porte_animal&&Array.isArray(t.porte_animal)&&t.porte_animal.map(N=>e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-1.5 py-0.5 rounded",children:N},N)),t.fase_publico&&Array.isArray(t.fase_publico)&&t.fase_publico.map(N=>e.jsx("span",{className:"text-xs bg-amber-100 text-amber-700 px-1.5 py-0.5 rounded",children:N},N)),t.sabor_proteina&&e.jsx("span",{className:"text-xs bg-pink-100 text-pink-700 px-1.5 py-0.5 rounded",children:t.sabor_proteina})]}),e.jsxs("div",{className:"flex gap-1 mt-2 flex-wrap",children:[we&&e.jsx("span",{className:"text-xs bg-green-600 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:"ðŸ’° MENOR CUSTO"}),_e&&e.jsx("span",{className:"text-xs bg-blue-600 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:"â­ MELHOR MARGEM"}),Ce&&e.jsx("span",{className:"text-xs bg-purple-600 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:"ðŸŽ¯ MELHOR ROI"}),ke&&e.jsx("span",{className:"text-xs bg-amber-600 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:"ðŸ’µ MAIOR LUCRO"})]})]})}),e.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-700 border-r border-gray-200",children:e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-medium",children:t.classificacao_racao||"-"})}),e.jsx("td",{className:"px-3 py-3 text-sm text-center font-medium text-gray-900 border-r border-gray-200",children:t.peso_embalagem?e.jsxs("span",{className:"px-2 py-1 bg-gray-100 rounded font-bold",children:[t.peso_embalagem," kg"]}):"-"}),e.jsxs("td",{className:`px-3 py-3 text-sm text-center font-bold border-r border-gray-200 ${re(t.preco_custo||0,me,Math.max(...h),!0)}`,children:["R$ ",(t.preco_custo||0).toFixed(2)]}),e.jsxs("td",{className:`px-3 py-3 text-sm text-center font-bold border-r border-gray-200 ${re(t.preco_venda||0,Math.min(...x.map(N=>N.preco_venda||0)),Math.max(...x.map(N=>N.preco_venda||0)))}`,children:["R$ ",(t.preco_venda||0).toFixed(2)]}),e.jsxs("td",{className:`px-3 py-3 text-sm text-center font-bold border-r border-gray-200 ${re(X,Math.min(...w),Math.max(...w))}`,children:["R$ ",X.toFixed(2)]}),e.jsx("td",{className:"px-3 py-3 text-center border-r border-gray-200",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsxs("span",{className:`px-3 py-1.5 rounded-lg font-bold text-sm border-2 ${Fe(c)}`,children:[c.toFixed(2),"%"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${c>=40?"bg-green-500":c>=30?"bg-green-400":c>=20?"bg-yellow-400":c>=10?"bg-orange-400":"bg-red-400"}`,style:{width:`${Math.min(c,100)}%`}})})]})}),e.jsxs("td",{className:`px-3 py-3 text-sm text-center font-bold border-r border-gray-200 ${re(ne,Math.min(...be),Math.max(...be))}`,children:[ne.toFixed(2),"%"]}),e.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-700 border-r border-gray-200",children:e.jsxs("span",{className:`px-2 py-1 rounded font-semibold ${re(q,Math.min(...x.map(N=>(N.preco_custo||0)/(N.peso_embalagem||1))),Math.max(...x.map(N=>(N.preco_custo||0)/(N.peso_embalagem||1))),!0)}`,children:["R$ ",q.toFixed(2)]})}),e.jsx("td",{className:"px-3 py-3 text-sm text-center text-gray-700 border-r border-gray-200",children:e.jsxs("span",{className:`px-2 py-1 rounded font-semibold ${re(ve,Math.min(...x.map(N=>(N.preco_venda||0)/(N.peso_embalagem||1))),Math.max(...x.map(N=>(N.preco_venda||0)/(N.peso_embalagem||1))))}`,children:["R$ ",ve.toFixed(2)]})}),e.jsx("td",{className:"px-3 py-3 text-sm text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${(t.estoque_atual||0)>10?"bg-green-100 text-green-700 border border-green-300":(t.estoque_atual||0)>0?"bg-yellow-100 text-yellow-700 border border-yellow-300":"bg-red-100 text-red-700 border border-red-300"}`,children:t.estoque_atual||0})})]},t.id)})})]})}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg p-4 border-2 border-gray-300",children:[e.jsxs("p",{className:"text-sm font-bold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“–"})," Legenda e Dicas de InterpretaÃ§Ã£o:"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx("span",{className:"font-bold text-green-700",children:"ðŸŸ¢ Verde:"}),e.jsx("span",{className:"text-gray-700",children:"Valores melhores (menor custo, maior margem/lucro)"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx("span",{className:"font-bold text-red-700",children:"ðŸ”´ Vermelho:"}),e.jsx("span",{className:"text-gray-700",children:"Valores piores (maior custo, menor margem/lucro)"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx("span",{className:"font-bold text-yellow-700",children:"ðŸŸ¡ Amarelo:"}),e.jsx("span",{className:"text-gray-700",children:"Destaque na linha = um dos melhores produtos"})]})]}),e.jsxs("div",{className:"space-y-1.5 text-xs text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Margem %:"})," (Venda - Custo) / Venda Ã— 100"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ROI %:"})," (Lucro / Custo) Ã— 100"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Lucro R$:"})," Venda - Custo (valor absoluto)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Custo/Venda por kg:"})," PreÃ§o dividido pelo peso"]})]})]})]})]})};return K?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(G,{className:"h-8 w-8 animate-spin text-blue-500"})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Ee,{className:"h-7 w-7 text-blue-600"}),"AnÃ¡lise Inteligente de RaÃ§Ãµes"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Dashboard dinÃ¢mico com anÃ¡lises avanÃ§adas de margem e vendas"})]}),e.jsxs("button",{onClick:()=>P(),className:"px-4 py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Atualizar"]})]}),m(),R(),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex space-x-1 p-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>l("comparacao"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${d==="comparacao"?"bg-blue-600 text-white shadow-md":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(qe,{className:"h-4 w-4 inline mr-2"}),"ðŸ“Š ComparaÃ§Ã£o Detalhada"]}),e.jsxs("button",{onClick:()=>l("segmento"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${d==="segmento"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(De,{className:"h-4 w-4 inline mr-2"}),"Margem por Segmento"]}),e.jsxs("button",{onClick:()=>l("marcas"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${d==="marcas"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Se,{className:"h-4 w-4 inline mr-2"}),"ComparaÃ§Ã£o de Marcas"]}),e.jsxs("button",{onClick:()=>l("ranking"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors whitespace-nowrap ${d==="ranking"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Oe,{className:"h-4 w-4 inline mr-2"}),"Ranking de Vendas"]})]})}),e.jsxs("div",{className:"p-4",children:[d==="comparacao"&&A(),d==="resumo"&&m(),d==="segmento"&&$(),d==="marcas"&&I(),d==="ranking"&&L()]})]})]})},Ue=()=>{var Y,B,xe;const[K,p]=i.useState(!0),[b,u]=i.useState(null),[k,D]=i.useState([]),[E,te]=i.useState([]),[O,Q]=i.useState([]),[C,T]=i.useState("resumo"),[x,Z]=i.useState(.8),[V,J]=i.useState("porte"),[o,U]=i.useState({}),[S,H]=i.useState({});i.useEffect(()=>{r()},[]);const r=async()=>{try{p(!0);const a=await M.get("/racoes/sugestoes/relatorio-completo");u(a.data),p(!1)}catch(a){console.error("Erro ao carregar relatÃ³rio:",a),_.error("Erro ao carregar relatÃ³rio de sugestÃµes"),p(!1)}},j=async()=>{try{p(!0);const a=await M.get(`/racoes/sugestoes/duplicatas?threshold_similaridade=${x}`);D(a.data),p(!1)}catch(a){console.error("Erro ao carregar duplicatas:",a),_.error("Erro ao carregar duplicatas"),p(!1)}},v=async()=>{try{p(!0);const a=await M.get("/racoes/sugestoes/padronizar-nomes?limite=50");te(a.data),p(!1)}catch(a){console.error("Erro ao carregar padronizaÃ§Ãµes:",a),_.error("Erro ao carregar sugestÃµes de padronizaÃ§Ã£o"),p(!1)}},F=async()=>{try{p(!0);const a=await M.get(`/racoes/sugestoes/gaps-estoque?tipo_segmento=${V}`);Q(a.data),p(!1)}catch(a){console.error("Erro ao carregar gaps:",a),_.error("Erro ao carregar gaps de estoque"),p(!1)}},d=a=>{T(a),a==="duplicatas"&&k.length===0?j():a==="padronizacao"&&E.length===0?v():a==="gaps"&&O.length===0&&F()},W=async a=>{try{const l=S[a.produto_id],m=(l==null?void 0:l.nome)||a.nome_sugerido;await M.patch(`/produtos/${a.produto_id}`,{nome:m}),_.success("Nome atualizado com sucesso!"),te(R=>R.filter($=>$.produto_id!==a.produto_id)),H(R=>{const $={...R};return delete $[a.produto_id],$}),r()}catch(l){console.error("Erro ao aplicar padronizaÃ§Ã£o:",l),_.error("Erro ao atualizar nome do produto")}},P=async a=>{try{await M.post("/racoes/sugestoes/duplicatas/ignorar",null,{params:{produto_id_1:a.produto_1.id,produto_id_2:a.produto_2.id}}),_.success("Duplicata ignorada com sucesso!"),D(l=>l.filter(m=>!(m.produto_1.id===a.produto_1.id&&m.produto_2.id===a.produto_2.id))),r()}catch(l){console.error("Erro ao ignorar duplicata:",l),_.error("Erro ao ignorar duplicata")}},oe=(a,l)=>{U(m=>({...m,[a]:l}))},le=async(a,l)=>{const m=o[l];if(!m){_.error("Selecione qual produto deseja manter antes de confirmar");return}const R=m==="produto_1"?a.produto_1.id:a.produto_2.id,$=m==="produto_1"?a.produto_2.id:a.produto_1.id;m==="produto_1"?a.produto_1.nome:a.produto_2.nome,m==="produto_1"?a.produto_2.nome:a.produto_1.nome;try{const I=await M.post("/racoes/sugestoes/duplicatas/mesclar",null,{params:{produto_id_manter:R,produto_id_remover:$,transferir_estoque:!0}});_.success(I.data.mensagem),D(L=>L.filter(A=>!(A.produto_1.id===a.produto_1.id&&A.produto_2.id===a.produto_2.id))),U(L=>{const A={...L};return delete A[l],A}),r()}catch(I){console.error("Erro ao mesclar produtos:",I),_.error("Erro ao mesclar produtos")}},de=()=>{if(!b)return null;const{score_saude:a,classificacao:l,cor:m,resumo:R,recomendacoes:$}=b;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Score de SaÃºde do Cadastro"}),e.jsx("button",{onClick:r,className:"text-blue-600 hover:text-blue-700",children:e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:`w-32 h-32 rounded-full flex items-center justify-center border-8 ${m==="green"?"border-green-500":m==="blue"?"border-blue-500":m==="yellow"?"border-yellow-500":"border-red-500"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:a}),e.jsx("div",{className:"text-xs text-gray-600",children:"pontos"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`inline-block px-4 py-2 rounded-full text-white font-semibold mb-3 ${m==="green"?"bg-green-500":m==="blue"?"bg-blue-500":m==="yellow"?"bg-yellow-500":"bg-red-500"}`,children:l}),e.jsxs("p",{className:"text-gray-700 mb-4",children:[a>=90&&"ParabÃ©ns! Seu cadastro de raÃ§Ãµes estÃ¡ excelente.",a>=70&&a<90&&"Seu cadastro estÃ¡ em bom estado, mas hÃ¡ algumas melhorias possÃ­veis.",a>=50&&a<70&&"AtenÃ§Ã£o! Existem vÃ¡rios pontos de melhoria no cadastro.",a<50&&"CRÃTICO! Ã‰ necessÃ¡rio realizar melhorias urgentes no cadastro."]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ge,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:R.duplicatas_detectadas})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Duplicatas Detectadas"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(pe,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:R.nomes_padronizar})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Nomes para Padronizar"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx($e,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:R.gaps_criticos})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Gaps de Estoque CrÃ­ticos"})]})]}),$&&$.filter(Boolean).length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"RecomendaÃ§Ãµes PrioritÃ¡rias"]}),e.jsx("ul",{className:"space-y-2",children:$.filter(Boolean).map((I,L)=>e.jsxs("li",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),I]},L))})]})]})},ce=()=>K?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando..."}):k.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-700 font-semibold",children:"Nenhuma duplicata detectada!"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Seu cadastro estÃ¡ livre de produtos duplicados"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mr-2",children:"Threshold de Similaridade:"}),e.jsx("input",{type:"range",min:"0.5",max:"1",step:"0.05",value:x,onChange:a=>Z(parseFloat(a.target.value)),className:"w-32"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:[(x*100).toFixed(0),"%"]})]}),e.jsxs("button",{onClick:j,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),"Buscar Duplicatas"]})]}),k.map((a,l)=>e.jsxs("div",{className:"bg-white border-2 border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5 text-orange-500"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["Similaridade: ",(a.score_similaridade*100).toFixed(0),"%"]})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${a.score_similaridade>=.9?"bg-red-100 text-red-700":a.score_similaridade>=.8?"bg-orange-100 text-orange-700":"bg-yellow-100 text-yellow-700"}`,children:a.sugestao_acao})]}),e.jsxs("div",{className:"mb-3 text-sm text-gray-700 bg-blue-50 p-2 rounded",children:["ðŸ‘† ",e.jsx("strong",{children:"Clique no produto que deseja MANTER"})," (o outro serÃ¡ inativado e terÃ¡ o estoque transferido)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{onClick:()=>oe(l,"produto_1"),className:`rounded p-3 cursor-pointer transition-all border-2 ${o[l]==="produto_1"?"bg-green-50 border-green-500 shadow-lg":o[l]==="produto_2"?"bg-red-50 border-red-300 opacity-60":"bg-gray-50 border-gray-200 hover:border-blue-400 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Produto 1 (ID: ",a.produto_1.id,")"]}),o[l]==="produto_1"&&e.jsx(z,{className:"h-5 w-5 text-green-600"})]}),e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:a.produto_1.nome}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Marca: ",a.produto_1.marca]}),e.jsxs("div",{children:["PreÃ§o: R$ ",a.produto_1.preco.toFixed(2)]}),e.jsxs("div",{children:["Estoque: ",a.produto_1.estoque]})]}),o[l]==="produto_1"&&e.jsx("div",{className:"mt-2 text-xs font-semibold text-green-700 bg-green-100 px-2 py-1 rounded",children:"âœ“ ESTE PRODUTO SERÃ MANTIDO"}),o[l]==="produto_2"&&e.jsx("div",{className:"mt-2 text-xs text-red-700 bg-red-100 px-2 py-1 rounded",children:"âœ— Este produto serÃ¡ inativado"})]}),e.jsxs("div",{onClick:()=>oe(l,"produto_2"),className:`rounded p-3 cursor-pointer transition-all border-2 ${o[l]==="produto_2"?"bg-green-50 border-green-500 shadow-lg":o[l]==="produto_1"?"bg-red-50 border-red-300 opacity-60":"bg-gray-50 border-gray-200 hover:border-blue-400 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Produto 2 (ID: ",a.produto_2.id,")"]}),o[l]==="produto_2"&&e.jsx(z,{className:"h-5 w-5 text-green-600"})]}),e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:a.produto_2.nome}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Marca: ",a.produto_2.marca]}),e.jsxs("div",{children:["PreÃ§o: R$ ",a.produto_2.preco.toFixed(2)]}),e.jsxs("div",{children:["Estoque: ",a.produto_2.estoque]})]}),o[l]==="produto_2"&&e.jsx("div",{className:"mt-2 text-xs font-semibold text-green-700 bg-green-100 px-2 py-1 rounded",children:"âœ“ ESTE PRODUTO SERÃ MANTIDO"}),o[l]==="produto_1"&&e.jsx("div",{className:"mt-2 text-xs text-red-700 bg-red-100 px-2 py-1 rounded",children:"âœ— Este produto serÃ¡ inativado"})]})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-1",children:a.razoes.map((m,R)=>e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:m},R))}),e.jsxs("div",{className:"mt-4 flex gap-2 justify-end",children:[e.jsxs("button",{onClick:()=>P(a),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 flex items-center gap-2 text-sm",children:[e.jsx(ue,{className:"h-4 w-4"}),"Ignorar (NÃ£o Ã© Duplicata)"]}),o[l]?e.jsxs("button",{onClick:()=>le(a,l),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center gap-2 text-sm font-semibold shadow-md",children:[e.jsx(z,{className:"h-4 w-4"}),"Confirmar Mesclagem"]}):e.jsxs("button",{disabled:!0,className:"px-4 py-2 bg-gray-300 text-gray-500 rounded-md flex items-center gap-2 text-sm cursor-not-allowed",children:[e.jsx(ge,{className:"h-4 w-4"}),"Selecione um Produto"]})]})]},l))]}),ie=()=>K?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando..."}):E.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-700 font-semibold",children:"Todos os nomes estÃ£o padronizados!"})]}):e.jsx("div",{className:"space-y-3",children:E.map((a,l)=>{var m,R,$,I,L;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:["ID: ",a.produto_id]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Nome Atual:"}),e.jsx("div",{className:"text-sm text-gray-700 bg-gray-50 p-2 rounded",children:a.nome_atual})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-green-700 mb-1",children:"Nome Sugerido:"}),(m=S[a.produto_id])!=null&&m.editando?e.jsx("input",{type:"text",value:((R=S[a.produto_id])==null?void 0:R.nome)||a.nome_sugerido,onChange:A=>H(s=>({...s,[a.produto_id]:{editando:!0,nome:A.target.value}})),className:"w-full text-sm text-green-900 bg-green-50 p-2 rounded font-medium border-2 border-blue-400 focus:outline-none focus:border-blue-600",autoFocus:!0}):e.jsx("div",{className:"text-sm text-green-900 bg-green-50 p-2 rounded font-medium",children:(($=S[a.produto_id])==null?void 0:$.nome)||a.nome_sugerido})]})]}),e.jsx("div",{className:"ml-4 flex items-center gap-2",children:e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:[(a.confianca*100).toFixed(0),"% confianÃ§a"]})})]}),e.jsxs("div",{className:"text-xs text-gray-600 mb-3",children:[e.jsx("strong",{children:"RazÃ£o:"})," ",a.razao]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>W(a),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm flex items-center gap-1",children:[e.jsx(z,{className:"h-4 w-4"}),"Aplicar ",(I=S[a.produto_id])!=null&&I.nome?"EdiÃ§Ã£o":"SugestÃ£o"]}),(L=S[a.produto_id])!=null&&L.editando?e.jsxs("button",{onClick:()=>H(A=>{const s={...A};return delete s[a.produto_id],s}),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 text-sm flex items-center gap-1",children:[e.jsx(ue,{className:"h-4 w-4"}),"Cancelar EdiÃ§Ã£o"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>H(A=>{var s;return{...A,[a.produto_id]:{editando:!0,nome:((s=S[a.produto_id])==null?void 0:s.nome)||a.nome_sugerido}}}),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm flex items-center gap-1",children:[e.jsx(pe,{className:"h-4 w-4"}),"Editar"]}),e.jsxs("button",{className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 text-sm flex items-center gap-1",children:[e.jsx(ue,{className:"h-4 w-4"}),"Ignorar"]})]})]})]},l)})}),he=()=>K?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Carregando..."}):O.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-700 font-semibold",children:"Nenhum gap crÃ­tico de estoque!"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mr-2",children:"Analisar por:"}),e.jsxs("select",{value:V,onChange:a=>J(a.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-md text-sm",children:[e.jsx("option",{value:"porte",children:"Porte"}),e.jsx("option",{value:"fase",children:"Fase"}),e.jsx("option",{value:"sabor",children:"Sabor"}),e.jsx("option",{value:"linha",children:"Linha"}),e.jsx("option",{value:"especie",children:"EspÃ©cie"})]})]}),e.jsxs("button",{onClick:F,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),"Analisar"]})]}),O.map((a,l)=>e.jsxs("div",{className:`rounded-lg p-4 border-2 ${a.importancia==="Alta"?"bg-red-50 border-red-300":a.importancia==="MÃ©dia"?"bg-yellow-50 border-yellow-300":"bg-gray-50 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ze,{className:`h-5 w-5 ${a.importancia==="Alta"?"text-red-600":a.importancia==="MÃ©dia"?"text-yellow-600":"text-gray-600"}`}),e.jsx("span",{className:"font-bold text-gray-900 text-lg",children:a.segmento_valor})]}),e.jsxs("div",{className:"text-sm text-gray-700",children:[a.produtos_sem_estoque," de ",a.total_produtos," produtos sem estoque (",a.percentual_sem_estoque,"%)"]})]}),e.jsx("span",{className:`px-3 py-1 rounded text-xs font-semibold ${a.importancia==="Alta"?"bg-red-600 text-white":a.importancia==="MÃ©dia"?"bg-yellow-500 text-white":"bg-gray-500 text-white"}`,children:a.importancia})]}),e.jsx("div",{className:"bg-white bg-opacity-50 rounded p-3 mb-3",children:e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Faturamento HistÃ³rico (90 dias):"})," R$ ",a.faturamento_historico.toLocaleString("pt-BR",{minimumFractionDigits:2})]})}),e.jsxs("div",{className:`text-sm font-medium ${a.importancia==="Alta"?"text-red-800":a.importancia==="MÃ©dia"?"text-yellow-800":"text-gray-800"}`,children:["ðŸ’¡ ",a.sugestao]})]},l))]});return K&&C==="resumo"?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(G,{className:"h-8 w-8 animate-spin text-blue-500"})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(ae,{className:"h-7 w-7 text-blue-600"}),"SugestÃµes Inteligentes"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Otimize seu cadastro de raÃ§Ãµes com sugestÃµes automÃ¡ticas"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex space-x-1 p-2",children:[e.jsxs("button",{onClick:()=>d("resumo"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${C==="resumo"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(z,{className:"h-4 w-4 inline mr-2"}),"Resumo Geral"]}),e.jsxs("button",{onClick:()=>d("duplicatas"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${C==="duplicatas"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(ge,{className:"h-4 w-4 inline mr-2"}),"Duplicatas",((Y=b==null?void 0:b.resumo)==null?void 0:Y.duplicatas_detectadas)>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-orange-500 text-white text-xs rounded-full",children:b.resumo.duplicatas_detectadas})]}),e.jsxs("button",{onClick:()=>d("padronizacao"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${C==="padronizacao"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(pe,{className:"h-4 w-4 inline mr-2"}),"PadronizaÃ§Ã£o",((B=b==null?void 0:b.resumo)==null?void 0:B.nomes_padronizar)>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-blue-500 text-white text-xs rounded-full",children:b.resumo.nomes_padronizar})]}),e.jsxs("button",{onClick:()=>d("gaps"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${C==="gaps"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx($e,{className:"h-4 w-4 inline mr-2"}),"Gaps de Estoque",((xe=b==null?void 0:b.resumo)==null?void 0:xe.gaps_criticos)>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-red-500 text-white text-xs rounded-full",children:b.resumo.gaps_criticos})]})]})}),e.jsxs("div",{className:"p-4",children:[C==="resumo"&&de(),C==="duplicatas"&&ce(),C==="padronizacao"&&ie(),C==="gaps"&&he()]})]})]})};function Qe(){const K=Ve(),[p,b]=i.useState("dashboard"),[u,k]=i.useState([]),[D,E]=i.useState(!1),[te,O]=i.useState(new Set),[Q,C]=i.useState({total:0,limite:50,offset:0}),[T,x]=i.useState(""),Z=[{value:"",label:"Todas as espÃ©cies"},{value:"dog",label:"CÃ£es"},{value:"cat",label:"Gatos"},{value:"bird",label:"PÃ¡ssaros"},{value:"rodent",label:"Roedores"},{value:"fish",label:"Peixes"}];i.useEffect(()=>{V()},[]),i.useEffect(()=>{p==="alertas"&&J()},[T,p]);const V=async()=>{try{const r=await M.get("/produtos/racao/alertas",{params:{limite:1,offset:0}});C(j=>({...j,total:r.data.total}))}catch(r){console.error("Erro ao carregar contagem de alertas:",r)}},J=async()=>{var r,j,v,F;E(!0);try{const d=localStorage.getItem("access_token");console.log("ðŸ” [AlertasRacao] Iniciando carregamento de alertas",{hasToken:!!d,tokenPreview:d?`${d.substring(0,20)}...`:"NO TOKEN",especieFiltro:T});const W={limite:50,offset:0};T&&(W.especie=T),console.log("ðŸ“¡ [AlertasRacao] Chamando: /produtos/racao/alertas",W);const P=await M.get("/produtos/racao/alertas",{params:W});console.log("âœ… [AlertasRacao] Alertas carregados:",{total:P.data.total,items:(r=P.data.items)==null?void 0:r.length}),k(P.data.items||[]),C({total:P.data.total,limite:P.data.limite,offset:P.data.offset})}catch(d){console.error("âŒ [AlertasRacao] Erro ao carregar alertas:",{message:d.message,status:(j=d.response)==null?void 0:j.status,data:(v=d.response)==null?void 0:v.data,config:d.config}),((F=d.response)==null?void 0:F.status)===403?se.error("Acesso negado. Verifique suas permissÃµes ou faÃ§a login novamente."):se.error("Erro ao carregar alertas de raÃ§Ãµes")}finally{E(!1)}},o=async r=>{O(j=>new Set(j).add(r));try{const j=await M.post(`/produtos/${r}/classificar-ia`,null,{params:{forcar:!0}});se.success(`${j.data.campos_atualizados.length} campos classificados! Score: ${j.data.confianca.score}%`,{duration:4e3}),k(v=>v.filter(F=>F.id!==r)),C(v=>({...v,total:v.total-1}))}catch(j){console.error("Erro ao classificar produto:",j),se.error("Erro ao classificar produto")}finally{O(j=>{const v=new Set(j);return v.delete(r),v})}},U=async()=>{E(!0);try{const r=await M.post("/produtos/classificar-lote",null,{params:{apenas_sem_classificacao:!0}});se.success(`${r.data.sucessos} produtos classificados com sucesso!`,{duration:5e3}),r.data.erros>0&&se.error(`${r.data.erros} produtos com erro na classificaÃ§Ã£o`),await J()}catch(r){console.error("Erro ao classificar lote:",r),se.error("Erro ao classificar produtos em lote")}finally{E(!1)}},S=r=>r>=75?{cor:"text-yellow-600 bg-yellow-50",texto:"Quase completo"}:r>=50?{cor:"text-orange-600 bg-orange-50",texto:"Incompleto"}:{cor:"text-red-600 bg-red-50",texto:"Muito incompleto"},H=r=>({porte_animal:"Porte",fase_publico:"Fase",sabor_proteina:"Sabor/ProteÃ­na",peso_embalagem:"Peso"})[r]||r;return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ne,{className:"w-8 h-8 text-amber-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Sistema Inteligente de RaÃ§Ãµes"})]}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>b("dashboard"),className:`px-6 py-3 font-medium text-sm transition-colors relative ${p==="dashboard"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Dashboard de AnÃ¡lise"]})}),e.jsx("button",{onClick:()=>b("alertas"),className:`px-6 py-3 font-medium text-sm transition-colors relative ${p==="alertas"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Alertas de ClassificaÃ§Ã£o",Q.total>0&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-red-500 text-white rounded-full",children:Q.total})]})}),e.jsx("button",{onClick:()=>b("sugestoes"),className:`px-6 py-3 font-medium text-sm transition-colors relative ${p==="sugestoes"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4"}),"SugestÃµes Inteligentes"]})})]})]}),p==="dashboard"&&e.jsx(Ke,{}),p==="sugestoes"&&e.jsx(Ue,{}),p==="alertas"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-gray-600",children:"Produtos classificados como raÃ§Ã£o mas sem informaÃ§Ãµes completas"}),e.jsxs("button",{onClick:U,disabled:D||u.length===0,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition",children:[e.jsx(G,{className:`w-4 h-4 ${D?"animate-spin":""}`}),"Classificar Todos"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Filtrar por:"}),e.jsx("select",{value:T,onChange:r=>x(r.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:Z.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),T&&e.jsx("button",{onClick:()=>x(""),className:"text-sm text-indigo-600 hover:text-indigo-800",children:"Limpar filtro"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-red-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Alertas"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:Q.total})]}),e.jsx(Ne,{className:"w-10 h-10 text-red-500 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-amber-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nesta PÃ¡gina"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:u.length})]}),e.jsx(Ge,{className:"w-10 h-10 text-amber-500 opacity-20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-green-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Completude MÃ©dia"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[u.length>0?Math.round(u.reduce((r,j)=>r+j.completude,0)/u.length):0,"%"]})]}),e.jsx(z,{className:"w-10 h-10 text-green-500 opacity-20"})]})})]}),D&&u.length===0&&e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(G,{className:"w-8 h-8 animate-spin text-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando alertas..."})]}),!D&&u.length===0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-8 text-center",children:[e.jsx(z,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-green-800 mb-2",children:"Nenhum alerta encontrado!"}),e.jsx("p",{className:"text-green-700",children:"Todas as raÃ§Ãµes cadastradas possuem informaÃ§Ãµes completas."})]}),u.length>0&&e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CÃ³digo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Categoria / Marca"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Campos Faltantes"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Completude"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(r=>{var F;const j=S(r.completude),v=te.has(r.id);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-mono",children:r.codigo}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"max-w-md",children:[e.jsx("p",{className:"font-medium",children:r.nome}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[r.classificacao_racao&&e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:r.classificacao_racao}),r.especies_indicadas&&e.jsx("span",{className:"text-xs text-white bg-indigo-600 px-2 py-1 rounded",children:((F=Z.find(d=>d.value===r.especies_indicadas))==null?void 0:F.label)||r.especies_indicadas})]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-700",children:r.categoria||"-"}),e.jsx("div",{className:"text-xs text-gray-500",children:r.marca||"-"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:r.campos_faltantes.map(d=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-red-100 text-red-800 text-xs rounded",children:[e.jsx(ue,{className:"w-3 h-3"}),H(d)]},d))})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${j.cor}`,children:[r.completude,"%"]})}),e.jsxs("td",{className:"px-4 py-3 text-center",children:[e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>o(r.id),disabled:v||!r.auto_classificar_ativo,className:"inline-flex items-center gap-2 px-3 py-1 bg-indigo-600 text-white text-sm rounded hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition",children:v?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4 animate-spin"}),"Classificando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4"}),"Classificar IA"]})}),e.jsxs("button",{onClick:()=>K(`/produtos/${r.id}/editar?aba=7`),className:"inline-flex items-center gap-2 px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition",title:"Editar produto manualmente",children:[e.jsx(pe,{className:"w-4 h-4"}),"Editar"]})]}),!r.auto_classificar_ativo&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Auto-class. desativada"})]})]},r.id)})})]})})})]})]})}export{Qe as default};
