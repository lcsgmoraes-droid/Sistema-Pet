import{S as k,r as d,z as n,j as e,aj as o,ak as y,al as m,am as N,an as v,ao as E}from"./vendor-react-1772138187586.js";import{g as z,a as C,b as D,r as P}from"./alertasEstoque-17721381875862.js";import"./index-1772138187586.js";function S(){const f=k(),[i,w]=d.useState([]),[h,_]=d.useState([]),[a,A]=d.useState(null),[l,g]=d.useState(!1),[t,c]=d.useState("pendentes");d.useEffect(()=>{x()},[t]);const x=async()=>{g(!0);try{if(t==="pendentes"){const s=await z();w(s.data)}else if(t==="historico"){const s=await C();_(s.data)}else if(t==="dashboard"){const s=await D();A(s.data)}}catch(s){console.error("Erro ao carregar alertas:",s),n.error("Erro ao carregar alertas de estoque")}finally{g(!1)}},p=async(s,r,b=null)=>{if(r==="resolvido"&&b){f(`/produtos?produto_id=${b}`),n.info("Redirecionando para ajustar o estoque do produto...");return}try{await P(s,r),n.success("Alerta ignorado com sucesso"),x()}catch(q){console.error("Erro ao ignorar alerta:",q),n.error("Erro ao processar alerta")}},u=s=>{const r={CRITICO:"bg-red-100 text-red-800 border-red-300",ALTO:"bg-orange-100 text-orange-800 border-orange-300",MEDIO:"bg-yellow-100 text-yellow-800 border-yellow-300",BAIXO:"bg-blue-100 text-blue-800 border-blue-300"};return r[s]||r.MEDIO},j=s=>new Date(s).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(o,{className:"text-red-500"}),"Alertas de Estoque Negativo"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Monitoramento em tempo real de produtos com estoque crítico"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[e.jsx("button",{onClick:()=>c("pendentes"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${t==="pendentes"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{size:18}),"Pendentes",i.length>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:i.length})]})}),e.jsx("button",{onClick:()=>c("dashboard"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${t==="dashboard"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{size:18}),"Dashboard"]})}),e.jsx("button",{onClick:()=>c("historico"),className:`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${t==="historico"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{size:18}),"Histórico"]})})]})})}),e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:x,disabled:l,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors",children:[e.jsx(N,{size:18,className:l?"animate-spin":""}),"Atualizar"]})}),l?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(N,{className:"animate-spin mx-auto text-gray-400",size:48}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Carregando..."})]}):e.jsxs(e.Fragment,{children:[t==="pendentes"&&e.jsx("div",{className:"space-y-4",children:i.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(v,{className:"mx-auto text-green-500",size:64}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mt-4",children:"Nenhum alerta pendente!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Todos os produtos estão com estoque adequado."})]}):i.map(s=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.produto_nome}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${u(s.criticidade)}`,children:s.criticidade})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Estoque Anterior"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.estoque_anterior})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Estoque Resultante"}),e.jsx("p",{className:"text-lg font-semibold text-red-600",children:s.estoque_resultante})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Quantidade Vendida"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.quantidade_vendida})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Venda"}),e.jsx("p",{className:"text-lg font-semibold text-blue-600",children:s.venda_codigo?`#${s.venda_codigo}`:s.venda_id?`ID: ${s.venda_id}`:"N/A"})]})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Data:"})," ",j(s.data_alerta)]}),s.observacao&&e.jsxs("p",{className:"mt-1",children:[e.jsx("strong",{children:"Observação:"})," ",s.observacao]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[e.jsxs("button",{onClick:()=>p(s.id,"resolvido",s.produto_id),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",title:"Ir para o produto e fazer ajuste de estoque",children:[e.jsx(m,{size:16}),"Ajustar Estoque"]}),e.jsxs("button",{onClick:()=>p(s.id,"ignorado"),className:"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm",title:"Ignorar este alerta (aceitar estoque negativo)",children:[e.jsx(E,{size:16}),"Ignorar"]})]})]})},s.id))}),t==="dashboard"&&a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total de Alertas"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:a.total_alertas})]}),e.jsx(o,{className:"text-gray-400",size:40})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pendentes"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 mt-2",children:a.alertas_pendentes})]}),e.jsx(o,{className:"text-red-400",size:40})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Críticos"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600 mt-2",children:a.alertas_criticos})]}),e.jsx(y,{className:"text-orange-400",size:40})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Resolvidos"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 mt-2",children:a.alertas_resolvidos})]}),e.jsx(v,{className:"text-green-400",size:40})]})})]}),a.produtos_estoque_negativo&&a.produtos_estoque_negativo.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(m,{className:"text-red-500"}),"Produtos com Estoque Negativo Atual"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque Atual"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Alertas Pendentes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.produtos_estoque_negativo.map((s,r)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-bold text-red-600",children:s.estoque_atual}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900",children:s.alertas_pendentes})]},r))})]})})]})]}),t==="historico"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produto"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Criticidade"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque Ant."}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estoque Res."}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Venda"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-12 text-center text-gray-500",children:"Nenhum alerta registrado"})}):h.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:j(s.data_alerta)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.produto_nome}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${u(s.criticidade)}`,children:s.criticidade})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900",children:s.estoque_anterior}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-semibold text-red-600",children:s.estoque_resultante}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.resolvido?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:s.resolvido?"Resolvido":"Pendente"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm text-blue-600 font-medium",children:s.venda_codigo?`#${s.venda_codigo}`:s.venda_id?`ID: ${s.venda_id}`:"N/A"})]},s.id))})]})})})]})]})}export{S as default};
