import{j as e,r,an as ha,aw as Ra,ax as Ye,X as ue,ay as fa,az as Ca,aA as we,aB as gt,aC as pt,aD as bt,aE as ea,aF as ia,C as pa,aG as ja,ak as Fa,aH as Rs,aI as Ds,al as ba,aJ as ht,z as Ae,am as ft,d as Va,aK as Ma,aL as Ns,aM as ws,aN as jt,aO as vt,aP as Ze,aQ as Ta,aR as _s,aS as yt,Z as Da,T as la,as as Nt,U as wt,aT as _t,a0 as Ct,p as As,o as Ft,h as St,l as kt,aU as $t,e as Pa,aV as Et,a5 as Rt,aW as Dt,B as At,y as Tt,$ as Pt,R as Vt,a3 as Cs,ap as Mt,L as It,aX as _a,aY as Ts,S as qt,ai as zt,aZ as Ot,a_ as Fs,a$ as Ss,b0 as ks,b1 as Na,aj as Lt,b2 as Bt,b3 as Aa,b4 as Kt,b5 as Qt,b6 as Ut}from"./vendor-react-1772137774299.js";import{a as P,e as Ht,u as Jt}from"./index-1772137774299.js";import{A as Gt}from"./produtos-17721377742992.js";import{v as Xt}from"./alertasEstoque-17721377742992.js";import{a as Wt,b as Ia,o as Ps,f as Zt,c as Yt}from"./caixa-1772137774299.js";const $s=async(l={})=>(await P.get("/vendas",{params:l})).data,wa=async l=>(await P.get(`/vendas/${l}`)).data,Vs=async l=>(await P.post("/vendas",l)).data,er=async(l,N)=>(await P.post(`/vendas/${l}/finalizar`,{pagamentos:N})).data,ar=async(l={})=>{const N=await P.get("/clientes/",{params:l});return N.data.items||N.data.clientes||N.data||[]},ga=async l=>(await P.get(`/clientes/${l}`)).data,sr=({status:l,className:N=""})=>{if(!l)return null;const c={verde:{cor:"bg-green-500",borda:"border-green-500",texto:"text-green-700",fundo:"bg-green-50",icone:"‚úÖ",mensagem:"Margem Saud√°vel",descricao:"Venda em condi√ß√µes ideais"},amarelo:{cor:"bg-yellow-500",borda:"border-yellow-500",texto:"text-yellow-700",fundo:"bg-yellow-50",icone:"‚ö†Ô∏è",mensagem:"Margem em Alerta",descricao:"Aten√ß√£o com parcelamento e descontos"},vermelho:{cor:"bg-red-500",borda:"border-red-500",texto:"text-red-700",fundo:"bg-red-50",icone:"üî¥",mensagem:"Margem Cr√≠tica",descricao:"Evite mais descontos ou parcelamentos longos"}},u=c[l]||c.verde;return e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg border ${u.borda} ${u.fundo} ${N}`,children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${u.cor} animate-pulse`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`text-sm font-semibold ${u.texto}`,children:[u.icone," ",u.mensagem]}),e.jsx("div",{className:"text-xs text-gray-600",children:u.descricao})]})]})},tr=(l,N)=>{const c=(l||N||"").toLowerCase();return c.includes("pix")?e.jsx(gt,{className:"w-6 h-6"}):c.includes("dinheiro")||c.includes("cash")?e.jsx(pt,{className:"w-6 h-6"}):c.includes("debito")||c.includes("d√©bito")?e.jsx(Ye,{className:"w-6 h-6"}):c.includes("parcelado")?e.jsx(Ye,{className:"w-6 h-6"}):c.includes("credito")||c.includes("cr√©dito")?e.jsx(Ye,{className:"w-6 h-6"}):c.includes("transfer")||c.includes("banc")?e.jsx(bt,{className:"w-6 h-6"}):c.includes("boleto")?e.jsx(ea,{className:"w-6 h-6"}):c.includes("wallet")||c.includes("carteira")?e.jsx(fa,{className:"w-6 h-6"}):e.jsx(Ye,{className:"w-6 h-6"})},rr=["Visa","Mastercard","Elo","American Express","Hipercard","Outros"];function or({venda:l,onClose:N,onConfirmar:c,onVendaAtualizada:u,onAnalisarVenda:s}){var ta;const[g,F]=r.useState([]),[m,b]=r.useState([]),[w,U]=r.useState([]),[h,M]=r.useState([]),[$,E]=r.useState(null),[t,q]=r.useState(null),[R,Q]=r.useState(""),[se,C]=r.useState(""),[S,I]=r.useState(1),[K,D]=r.useState(""),[oe,le]=r.useState(!1),[xe,v]=r.useState(!1),[H,J]=r.useState(""),[z,ne]=r.useState(0),[ye,y]=r.useState(!1),[X,ge]=r.useState(null),[he,ke]=r.useState(null),[Oe,x]=r.useState(!1),[k,_]=r.useState(""),[V,te]=r.useState(""),[T,fe]=r.useState({}),[me,re]=r.useState(!1),[ie,Pe]=r.useState(null),Ee=r.useRef(null);r.useEffect(()=>{(async()=>{try{const f=await P.get("/financeiro/formas-pagamento");U(f.data)}catch(f){console.error("Erro ao carregar formas:",f)}})()},[]),r.useEffect(()=>{(async()=>{try{const f=await P.get("/operadoras-cartao?apenas_ativas=true");M(f.data);const j=f.data.find(L=>L.padrao);j&&E(j)}catch(f){console.error("Erro ao carregar operadoras:",f)}})()},[]),r.useEffect(()=>{(async()=>{var f;if(l.id){v(!0);try{const j=await P.get(`/vendas/${l.id}/pagamentos`);b(j.data.pagamentos||[]),ne(j.data.total_pago||0)}catch(j){console.error("Erro ao buscar pagamentos:",j),((f=j.response)==null?void 0:f.status)!==404&&J("Erro ao carregar pagamentos existentes")}finally{v(!1)}}})()},[l.id,l.status]),r.useEffect(()=>{t!=null&&t.permite_parcelamento&&Ee.current&&setTimeout(()=>{var n;(n=Ee.current)==null||n.scrollIntoView({behavior:"smooth",block:"nearest"})},100)},[t==null?void 0:t.permite_parcelamento]);const ee=l.total,Ne=g.reduce((n,f)=>n+f.valor,0)+z,Fe=ee-Ne,Te=K?parseFloat(K)-Fe:0,da=async()=>{var n,f,j;x(!0);try{const L=[{forma_pagamento_id:1,valor:l.total,parcelas:1}],de=(l.itens||[]).map(ce=>({produto_id:ce.produto_id,quantidade:ce.quantidade,preco_venda:ce.preco_unitario||ce.preco_venda||0,custo:ce.custo||null})),W=await P.post("/formas-pagamento/analisar-venda",{items:de,formas_pagamento:L,desconto:l.desconto_valor||0,taxa_entrega:((n=l.entrega)==null?void 0:n.taxa_entrega_total)||0});(j=(f=W.data)==null?void 0:f.resultado)!=null&&j.cor_indicador&&(ke(W.data.resultado.cor_indicador),console.log("‚úÖ Status inicial calculado:",W.data.resultado.cor_indicador))}catch(L){console.error("‚ùå Erro ao calcular status inicial:",L),ke(null)}finally{x(!1)}},He=async()=>{var n,f,j;if(!(g.length===0&&m.length===0)){x(!0);try{const L=[...m,...g],de=(l.itens||[]).map(ce=>({produto_id:ce.produto_id,quantidade:ce.quantidade,preco_venda:ce.preco_unitario||ce.preco_venda||0,custo:ce.custo||null})),W=await P.post("/formas-pagamento/analisar-venda",{items:de,formas_pagamento:L,desconto:l.desconto_valor||0,taxa_entrega:((n=l.entrega)==null?void 0:n.taxa_entrega_total)||0});(j=(f=W.data)==null?void 0:f.resultado)!=null&&j.cor_indicador&&ke(W.data.resultado.cor_indicador)}catch(L){console.error("Erro ao calcular status de margem:",L),ke(null)}finally{x(!1)}}};r.useEffect(()=>{const n=setTimeout(()=>{He()},500);return()=>clearTimeout(n)},[g,S]),r.useEffect(()=>{console.log("üé¨ Modal de pagamento aberto - Calculando status inicial..."),da()},[]),r.useEffect(()=>{if(w&&w.length>0){const n=w.filter(f=>f.permite_parcelamento);n.length>0&&Object.keys(T).length===0&&(console.log("üìä Simulando parcelamentos ao carregar formas..."),O(n[0]))}},[w]);const O=async n=>{var L,de,W;if(!n||!n.permite_parcelamento){console.log("‚è≠Ô∏è Forma de pagamento inv√°lida ou n√£o permite parcelamento");return}const f=(n==null?void 0:n.parcelas_maximas)??12,j=n.id;console.log(`üé≤ Simulando parcelamentos para ${n.nome} (at√© ${f}x)...`),re(!0);try{const ce={},De=(l.itens||[]).map(be=>({produto_id:be.produto_id,quantidade:be.quantidade,preco_venda:be.preco_unitario||be.preco_venda||0,custo:be.custo||null}));for(let be=1;be<=f;be++){const $e=[{forma_pagamento_id:j,valor:l.total,parcelas:be}];try{const je=await P.post("/formas-pagamento/analisar-venda",{items:De,formas_pagamento:$e,desconto:l.desconto_valor||0,taxa_entrega:((L=l.entrega)==null?void 0:L.taxa_entrega_total)||0});(W=(de=je.data)==null?void 0:de.resultado)!=null&&W.cor_indicador&&(ce[be]={cor:je.data.resultado.cor_indicador,classificacao:je.data.resultado.cor_indicador})}catch(je){console.error(`Erro ao simular ${be}x:`,je),ce[be]={cor:null,classificacao:"verde"}}}fe(be=>({...be,[j]:ce}));const Se=Re(ce,f);Pe(Se),console.log("‚úÖ Simula√ß√µes conclu√≠das:",ce),console.log("üìä Faixas calculadas:",Se)}catch(ce){console.error("‚ùå Erro ao simular parcelamentos:",ce)}finally{re(!1)}},Re=(n,f)=>{const j={saudavel:{min:1,max:0},alerta:{min:0,max:0},proibido:{min:0,max:f}};let L=0,de=f+1;for(let W=1;W<=f;W++){const ce=n[W];ce&&(ce.cor==="verde"?L=W:ce.cor==="vermelho"&&W<de&&(de=W))}return j.saudavel.max=L,j.alerta.min=L+1,j.alerta.max=de-1,j.proibido.min=de,j};r.useEffect(()=>{if(t!=null&&t.permite_parcelamento)if(!T[t.id])O(t);else{const n=T[t.id],f=Re(n,(t==null?void 0:t.parcelas_maximas)??12);Pe(f),console.log("‚ôªÔ∏è Reutilizando simula√ß√£o existente")}else if(!t){const n=Object.keys(T)[0];if(n&&w.length>0){const f=w.find(j=>j.id===parseInt(n));if(f){const j=Re(T[n],(f==null?void 0:f.parcelas_maximas)??12);Pe(j)}}}},[t==null?void 0:t.id]);const Sa=()=>{var de;if(!t){J("Selecione uma forma de pagamento");return}const n=parseFloat(K)||0;if(n<=0){J("Informe o valor recebido");return}if(t.id==="credito_cliente"&&n>t.credito_disponivel){J(`Valor excede o cr√©dito dispon√≠vel (R$ ${t.credito_disponivel.toFixed(2)})`);return}if(["cartao_credito","cartao_debito"].includes(t.tipo)&&!R){J("Selecione a bandeira do cart√£o");return}if(["cartao_credito","cartao_debito"].includes(t.tipo)&&!$){J("Selecione a operadora do cart√£o");return}if($&&S>$.max_parcelas){J(`A operadora ${$.nome} permite no m√°ximo ${$.max_parcelas}x`);return}console.log("üîç DEBUG formaPagamentoSelecionada:",t);const f={forma_pagamento:t.nome,forma_id:t.id,forma_pagamento_id:t.id,nome:t.nome,valor:Math.min(n,Fe),bandeira:["cartao_credito","cartao_debito"].includes(t.tipo)?R:null,nsu_cartao:["cartao_credito","cartao_debito"].includes(t.tipo)&&se?se:null,operadora_id:($==null?void 0:$.id)||null,numero_parcelas:t.permite_parcelamento?S:1,parcelas:t.permite_parcelamento?S:1,valor_recebido:n,troco:t.tipo==="dinheiro"&&Te>0?Te:null,is_credito_cliente:t.nome==="Cr√©dito Cliente"||t.tipo==="credito_cliente"};console.log("üì§ DEBUG novoPagamento:",f);let j="verde";if(t!=null&&t.permite_parcelamento&&T[t.id]){const W=(de=T[t.id])==null?void 0:de[S];j=(W==null?void 0:W.cor)??"verde",console.log(`‚ôªÔ∏è Reutilizando simula√ß√£o do backend: ${S}x = cor ${j}`)}if(he==="vermelho"||j==="vermelho"){if(!k||k.trim().length<10){te("‚ö†Ô∏è Justificativa obrigat√≥ria para margem cr√≠tica (m√≠nimo 10 caracteres)"),J("Por favor, preencha a justificativa abaixo");return}const W=l.observacoes?`${l.observacoes}

‚ö†Ô∏è JUSTIFICATIVA (Margem Cr√≠tica): ${k}`:`‚ö†Ô∏è JUSTIFICATIVA (Margem Cr√≠tica): ${k}`;l.observacoes=W}F([...g,f]),q(null),D(""),Q(""),E(h.find(W=>W.padrao)||null),C(""),I(1),J(""),te("")},aa=n=>{F(g.filter((f,j)=>j!==n))},Je=async n=>{var f,j;if(confirm("Deseja realmente excluir este pagamento?")){le(!0),J("");try{console.log(`üóëÔ∏è Excluindo pagamento ID ${n}...`),await P.delete(`/vendas/pagamentos/${n}`),console.log("‚úÖ Pagamento exclu√≠do com sucesso!");const L=await P.get(`/vendas/${l.id}/pagamentos`);b(L.data.pagamentos||[]),ne(L.data.total_pago||0),L.data.pagamentos.length===0&&u&&await u(),J("")}catch(L){console.error("‚ùå Erro ao excluir pagamento:",L),console.error("   Response:",L.response),console.error("   Message:",L.message),L.message&&L.message.includes("CORS")?J("‚ö†Ô∏è Erro de CORS: O backend precisa ser reiniciado. Feche e abra novamente o servidor backend."):J(((j=(f=L.response)==null?void 0:f.data)==null?void 0:j.detail)||L.message||"Erro ao excluir pagamento")}finally{le(!1)}}},sa=async()=>{var n,f,j,L,de,W,ce,De;if(g.length===0){J("Adicione pelo menos uma forma de pagamento");return}le(!0),J("");try{const Se=l.itens.filter(je=>je.tipo==="produto"&&je.produto_id).map(je=>({produto_id:je.produto_id,quantidade:je.quantidade}));if(Se.length>0){const Y=(await Xt(Se)).data||[];if(Y.length>0){const Ve=Y.map(Me=>`‚Ä¢ ${Me.produto_nome}: estoque atual ${Me.estoque_atual}, ap√≥s venda ficar√° ${Me.estoque_resultante}`).join(`
`);if(!window.confirm(`‚ö†Ô∏è ATEN√á√ÉO: Os seguintes produtos ficar√£o com ESTOQUE NEGATIVO:

${Ve}

Deseja continuar mesmo assim?`)){le(!1);return}}}let be=l.id;if(!be){const je=((n=l.entrega)==null?void 0:n.taxa_entrega_total)||0,Y=((f=l.entrega)==null?void 0:f.taxa_loja)||0,Ve=((j=l.entrega)==null?void 0:j.taxa_entregador)||0,ca=je>0?(Y/je*100).toFixed(2):100,Me=je>0?(Ve/je*100).toFixed(2):0;be=(await Vs({cliente_id:(L=l.cliente)==null?void 0:L.id,funcionario_id:l.funcionario_id,itens:l.itens,desconto_valor:l.desconto_valor,desconto_percentual:l.desconto_percentual,observacoes:l.observacoes,tem_entrega:l.tem_entrega,taxa_entrega:je,percentual_taxa_loja:parseFloat(ca),percentual_taxa_entregador:parseFloat(Me),entregador_id:l.entregador_id,endereco_entrega:(de=l.entrega)==null?void 0:de.endereco_completo,observacoes_entrega:(W=l.entrega)==null?void 0:W.observacoes_entrega})).id}const $e=await er(be,g);ge(be),($e==null?void 0:$e.status)==="finalizada"||($e==null?void 0:$e.status)==="pago_nf"?y(!0):c()}catch(Se){console.error("Erro ao finalizar venda:",Se),J(((De=(ce=Se.response)==null?void 0:ce.data)==null?void 0:De.detail)||"Erro ao finalizar venda")}finally{le(!1)}},Le=async n=>{var f,j;le(!0),J("");try{await P.post("/nfe/emitir",{venda_id:X,tipo_nota:n}),alert(`${n==="nfe"?"NF-e":"NFC-e"} emitida com sucesso!`),c()}catch(L){console.error("Erro ao emitir nota:",L),alert(((j=(f=L.response)==null?void 0:f.data)==null?void 0:j.detail)||"Erro ao emitir nota fiscal. Voc√™ pode emiti-la depois na tela de vendas."),c()}finally{le(!1)}};return ye?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(ha,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Venda Finalizada!"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Deseja emitir nota fiscal?"})]})]}),e.jsxs("div",{className:"space-y-3",children:[(ta=l.cliente)!=null&&ta.cnpj?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>Le("nfe"),disabled:oe,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(Ra,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NF-e (Empresa)"})]}),e.jsxs("button",{onClick:()=>Le("nfce"),disabled:oe,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(Ra,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NFC-e (Cupom)"})]})]}):e.jsxs("button",{onClick:()=>Le("nfce"),disabled:oe,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:[e.jsx(Ra,{className:"w-5 h-5"}),e.jsx("span",{children:"Emitir NFC-e"})]}),e.jsx("button",{onClick:c,disabled:oe,className:"w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"N√£o emitir agora"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-4",children:"Voc√™ pode emitir a nota fiscal depois na tela de vendas"})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Ye,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Registrar Recebimento"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Selecione as formas de pagamento"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!1,e.jsx("button",{onClick:N,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Selecione a forma de pagamento"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[l.cliente&&l.cliente.credito>0&&e.jsxs("button",{onClick:()=>{q({id:"credito_cliente",nome:"Cr√©dito Cliente",tipo:"credito_cliente",icone:"üéÅ",credito_disponivel:parseFloat(l.cliente.credito)}),I(1),Q(""),C(""),D(Math.min(parseFloat(l.cliente.credito),Fe).toFixed(2))},className:`p-4 rounded-lg border-2 transition-all ${(t==null?void 0:t.id)==="credito_cliente"?"border-purple-500 bg-purple-50":"border-purple-200 bg-purple-50/50 hover:border-purple-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:"üéÅ"}),e.jsx("div",{className:`text-sm font-medium ${(t==null?void 0:t.id)==="credito_cliente"?"text-purple-900":"text-purple-700"}`,children:"Cr√©dito Cliente"}),e.jsxs("div",{className:"text-xs text-purple-600 mt-1 font-semibold",children:["R$ ",parseFloat(l.cliente.credito).toFixed(2).replace(".",",")]})]}),w.map(n=>{const f=(t==null?void 0:t.id)===n.id;return e.jsxs("button",{onClick:()=>{q(n),I(1),Q(""),C("")},className:`p-4 rounded-lg border-2 transition-all ${f?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"flex justify-center mb-1 text-gray-500",children:tr(n.icone,n.nome)}),e.jsx("div",{className:`text-sm font-medium ${f?"text-blue-900":"text-gray-700"}`,children:n.nome}),n.taxa_percentual>0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Taxa: ",n.taxa_percentual,"%"]})]},n.id)})]})]}),t&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[t.id==="credito_cliente"&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-800 mb-2",children:[e.jsx(fa,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"Cr√©dito Dispon√≠vel"})]}),e.jsxs("div",{className:"text-lg font-bold text-purple-600",children:["R$ ",t.credito_disponivel.toFixed(2).replace(".",",")]}),e.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"üí° N√£o gera movimenta√ß√£o de caixa"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t.id==="credito_cliente"?"Valor a Utilizar":"Valor Recebido"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:K,onChange:n=>{D(n.target.value)},onBlur:n=>{const f=parseFloat(n.target.value)||0;if(t.id==="credito_cliente"){const j=Math.min(t.credito_disponivel,Fe);f>j&&(D(j.toFixed(2)),J(`Valor ajustado para o cr√©dito dispon√≠vel: R$ ${j.toFixed(2)}`),setTimeout(()=>J(""),3e3))}},placeholder:Fe.toFixed(2),max:t.id==="credito_cliente"?Math.min(t.credito_disponivel,Fe):void 0,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]}),t.id==="credito_cliente"&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["M√°ximo: R$ ",Math.min(t.credito_disponivel,Fe).toFixed(2)]})]}),t.tipo==="dinheiro"&&K&&e.jsx("div",{className:`rounded-lg p-3 ${Te>0?"bg-yellow-50 border border-yellow-200":"bg-gray-100"}`,children:e.jsx("div",{className:"text-sm font-medium",children:e.jsxs("span",{className:Te>0?"text-yellow-800":"text-gray-600",children:["Troco: R$ ",Te.toFixed(2)]})})}),(t==null?void 0:t.tipo)&&["cartao_credito","cartao_debito"].includes(t.tipo)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Operadora *"}),e.jsxs("select",{value:($==null?void 0:$.id)||"",onChange:n=>{const f=h.find(j=>j.id===parseInt(n.target.value));E(f),f&&S>f.max_parcelas&&I(f.max_parcelas)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione a operadora..."}),h.map(n=>e.jsxs("option",{value:n.id,children:[n.nome," (",n.max_parcelas,"x m√°x)"]},n.id))]}),$&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["M√°ximo de ",$.max_parcelas," parcelas"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bandeira"}),e.jsxs("select",{value:R,onChange:n=>Q(n.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),rr.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["NSU (N√∫mero Sequencial √önico)",e.jsx("span",{className:"text-gray-500 text-xs ml-1",children:"(Opcional - para concilia√ß√£o)"})]}),e.jsx("input",{type:"text",value:se,onChange:n=>C(n.target.value),placeholder:"Ex: 123456789",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),(t==null?void 0:t.permite_parcelamento)&&e.jsxs("div",{ref:Ee,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"N√∫mero de Parcelas"}),e.jsx("select",{value:S,onChange:n=>I(parseInt(n.target.value)),className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${(()=>{var j;const n=(j=T[t.id])==null?void 0:j[S],f=(n==null?void 0:n.cor)||he||"verde";return f==="verde"?"border-gray-300 bg-white":f==="amarelo"?"border-yellow-400 bg-yellow-50 text-yellow-900":"border-red-400 bg-red-50 text-red-900"})()}`,children:Array.from({length:($==null?void 0:$.max_parcelas)||t.parcelas_maximas||12},(n,f)=>f+1).map(n=>{var W;const f=parseFloat(K)||Fe,j=f/n,L=(W=T[t.id])==null?void 0:W[n],de=(L==null?void 0:L.cor)||"verde";return e.jsxs("option",{value:n,className:de==="verde"?"":de==="amarelo"?"bg-yellow-100 text-yellow-900":"bg-red-100 text-red-900",children:[de==="vermelho"?"üö´ ":de==="amarelo"?"‚ö†Ô∏è ":"",n,"x de R$ ",j.toFixed(2)," ",K?`(Total: R$ ${f.toFixed(2)})`:""]},n)})}),K&&S>1&&e.jsxs("div",{className:`mt-2 p-3 border rounded-lg ${(()=>{var j;const n=(j=T[t.id])==null?void 0:j[S],f=(n==null?void 0:n.cor)||he||"verde";return f==="verde"?"bg-blue-50 border-blue-200":f==="amarelo"?"bg-yellow-50 border-yellow-300":"bg-red-50 border-red-300"})()}`,children:[e.jsx("p",{className:`text-sm font-medium ${(()=>{var j;const n=(j=T[t.id])==null?void 0:j[S],f=(n==null?void 0:n.cor)||he||"verde";return f==="verde"?"text-blue-800":f==="amarelo"?"text-yellow-800":"text-red-800"})()}`,children:(()=>{var j;const n=(j=T[t.id])==null?void 0:j[S],f=(n==null?void 0:n.cor)||he||"verde";return e.jsxs(e.Fragment,{children:[f==="vermelho"&&"üö´ ",f==="amarelo"&&"‚ö†Ô∏è ","üí≥ ",S,"x de R$ ",(parseFloat(K)/S).toFixed(2)]})})()}),e.jsxs("p",{className:`text-xs mt-1 ${(()=>{var j;const n=(j=T[t.id])==null?void 0:j[S],f=(n==null?void 0:n.cor)||he||"verde";return f==="verde"?"text-blue-600":f==="amarelo"?"text-yellow-700":"text-red-700"})()}`,children:["Valor total parcelado: R$ ",parseFloat(K).toFixed(2),(()=>{var j;const n=(j=T[t.id])==null?void 0:j[S],f=(n==null?void 0:n.cor)||he||"verde";return f==="amarelo"?" - Requer aten√ß√£o":f==="vermelho"?" - Requer justificativa":""})()]})]})]}),e.jsx("button",{onClick:Sa,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Adicionar Pagamento"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Resumo da Venda"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total da Venda:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",ee.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Valor Pago:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",Ne.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-blue-600 text-lg font-semibold border-t pt-3",children:[e.jsx("span",{children:"Restante:"}),e.jsxs("span",{children:["R$ ",Fe.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Formas de Pagamento"}),m.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-600 mb-2",children:["üí∞ Pagamentos Registrados (",m.length,")"]}),e.jsx("div",{className:"space-y-2",children:m.map((n,f)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:n.forma_pagamento==="dinheiro"?"üíµ Dinheiro":n.forma_pagamento==="pix"?"üì± PIX":n.forma_pagamento==="credito"?"üí≥ Cart√£o de Cr√©dito":n.forma_pagamento==="debito"?"üí≥ Cart√£o de D√©bito":n.forma_pagamento==="boleto"?"üìÑ Boleto":n.forma_pagamento}),e.jsxs("span",{className:"px-2 py-0.5 bg-green-200 text-green-800 text-xs rounded-full font-medium",children:["Pagamento ",f+1]})]}),n.bandeira&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Bandeira: ",n.bandeira]}),n.nsu_cartao&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1 font-mono",children:["üî¢ NSU: ",n.nsu_cartao]}),n.numero_parcelas&&n.numero_parcelas>1&&e.jsxs("div",{className:"text-sm text-blue-600 mt-1 font-medium",children:["üî¢ Parcelado em ",n.numero_parcelas,"x de R$ ",(parseFloat(n.valor)/n.numero_parcelas).toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["üìÖ ",new Date(n.data_pagamento).toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-green-700 text-lg",children:["R$ ",parseFloat(n.valor).toFixed(2)]}),n.troco&&parseFloat(n.troco)>0&&e.jsxs("div",{className:"text-xs text-yellow-600",children:["Troco: R$ ",parseFloat(n.troco).toFixed(2)]})]}),e.jsx("button",{onClick:()=>Je(n.id),disabled:oe,className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors disabled:opacity-50",title:"Excluir pagamento",children:e.jsx(Ca,{className:"w-4 h-4"})})]})]},n.id))})]}),g.length===0&&m.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400 bg-gray-50 rounded-lg border-2 border-dashed",children:[e.jsx(fa,{className:"w-12 h-12 mx-auto mb-2 opacity-40"}),e.jsx("p",{className:"text-sm font-medium",children:"Nenhuma forma de pagamento adicionada"}),e.jsx("p",{className:"text-xs mt-1",children:"Selecione uma forma acima para come√ßar"})]}):g.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 mb-2",children:"‚è≥ Novos Pagamentos (a confirmar)"}),e.jsx("div",{className:"space-y-3",children:g.map((n,f)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:n.nome}),e.jsx("span",{className:"px-2 py-0.5 bg-blue-200 text-blue-800 text-xs rounded-full font-medium",children:"Novo"})]}),n.bandeira&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Bandeira: ",n.bandeira]}),n.nsu_cartao&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1 font-mono",children:["üî¢ NSU: ",n.nsu_cartao]}),n.numero_parcelas>1&&e.jsxs("div",{className:"text-sm text-blue-600 mt-1 font-medium",children:["üî¢ ",n.numero_parcelas,"x de R$ ",(n.valor/n.numero_parcelas).toFixed(2)]}),n.troco&&n.troco>0&&e.jsxs("div",{className:"text-sm text-yellow-600 mt-1",children:["üíµ Troco: R$ ",n.troco.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"font-semibold text-blue-700 text-lg",children:["R$ ",n.valor.toFixed(2)]}),e.jsx("button",{onClick:()=>aa(f),className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors",title:"Remover",children:e.jsx(ue,{className:"w-5 h-5"})})]})]},f))})]}):null]}),he&&e.jsx(sr,{status:he,loading:Oe}),ie&&Object.keys(T).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center space-x-2",children:[e.jsx("span",{className:"text-xl",children:"üìä"}),e.jsx("span",{children:"Parcelamento Recomendado"})]}),me?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin inline-block w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full"}),e.jsx("p",{className:"text-sm text-blue-700 mt-2",children:"Analisando op√ß√µes..."})]}):e.jsxs("div",{className:"space-y-2",children:[ie.saudavel.max>0&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-green-100 border border-green-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"üü¢"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-green-900",children:[ie.saudavel.min===ie.saudavel.max?`${ie.saudavel.max}x`:`${ie.saudavel.min}x a ${ie.saudavel.max}x`,e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- Saud√°vel"})]}),e.jsx("div",{className:"text-xs text-green-700 mt-1",children:"Margem adequada, sem restri√ß√µes"})]})]}),ie.alerta.max>=ie.alerta.min&&ie.alerta.min>0&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-yellow-100 border border-yellow-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"üü°"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-yellow-900",children:[ie.alerta.min===ie.alerta.max?`${ie.alerta.max}x`:`${ie.alerta.min}x a ${ie.alerta.max}x`,e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- Aten√ß√£o"})]}),e.jsx("div",{className:"text-xs text-yellow-700 mt-1",children:"Margem pr√≥xima ao m√≠nimo, evite se poss√≠vel"})]})]}),ie.proibido.min<=((t==null?void 0:t.parcelas_maximas)??12)&&e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-red-100 border border-red-300 rounded-lg",children:[e.jsx("div",{className:"text-2xl",children:"üî¥"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-red-900",children:[ie.proibido.min,"x ou mais",e.jsx("span",{className:"ml-2 text-sm font-normal",children:"- Exige justificativa"})]}),e.jsx("div",{className:"text-xs text-red-700 mt-1",children:"Margem cr√≠tica, justificativa obrigat√≥ria"})]})]})]})]}),(()=>{var L,de;let n="verde";return t!=null&&t.permite_parcelamento&&((L=T[t.id])!=null&&L[S])&&(n=((de=T[t.id][S])==null?void 0:de.cor)??"verde"),he==="vermelho"||n==="vermelho"||k&&k.trim().length>0?e.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-3",children:[e.jsx(we,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-red-900",children:"‚ö†Ô∏è Justificativa Obrigat√≥ria"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Esta venda tem margem cr√≠tica. Informe o motivo para prosseguir."})]})]}),e.jsx("textarea",{value:k,onChange:W=>{_(W.target.value),W.target.value.trim().length>=10&&te("")},placeholder:"Ex: Cliente especial, promo√ß√£o de lan√ßamento, acordo comercial...",className:`w-full px-3 py-2 border-2 rounded-lg focus:ring-2 focus:ring-red-500 resize-none ${V?"border-red-500":"border-red-300"}`,rows:3}),V&&e.jsx("p",{className:"text-xs text-red-700 font-medium mt-2",children:V}),e.jsx("p",{className:"text-xs text-red-600 mt-2",children:"üí° M√≠nimo 10 caracteres"})]}):null})()]})]})}),e.jsxs("div",{className:"border-t p-6 bg-gray-50",children:[H&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(we,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:H})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:N,disabled:oe,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:sa,disabled:oe||g.length===0,className:"flex items-center space-x-2 px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:oe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ha,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"})]})})]})]})]})})}function nr({onClose:l,onSucesso:N}){const[c,u]=r.useState(""),[s,g]=r.useState(""),[F,m]=r.useState(""),[b,w]=r.useState({n2:0,n5:0,n10:0,n20:0,n50:0,n100:0,n200:0,moedas:0}),[U,h]=r.useState(!1),[M,$]=r.useState(!1),[E,t]=r.useState(""),q=()=>b.n200*200+b.n100*100+b.n50*50+b.n20*20+b.n10*10+b.n5*5+b.n2*2+parseFloat(b.moedas||0),R=()=>{const C=q();u(C.toFixed(2)),h(!1)},Q=()=>{w({n2:0,n5:0,n10:0,n20:0,n50:0,n100:0,n200:0,moedas:0})},se=async()=>{var S,I;const C=parseFloat(c);if(!C||C<0){t("Informe um valor v√°lido para abertura");return}$(!0),t("");try{await Wt({valor_abertura:C,conta_origem_nome:s||"Dinheiro em m√£os",observacoes_abertura:F}),N()}catch(K){console.error("Erro ao abrir caixa:",K),t(((I=(S=K.response)==null?void 0:S.data)==null?void 0:I.detail)||"Erro ao abrir caixa")}finally{$(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(ia,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Abrir Caixa"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Informe o valor inicial do caixa"})]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Valor de Abertura *"}),e.jsxs("button",{type:"button",onClick:()=>h(!U),className:"flex items-center space-x-1 px-3 py-1.5 text-sm bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 rounded-lg transition-colors",children:[e.jsx(pa,{className:"w-4 h-4"}),e.jsx("span",{children:"Auxiliar Contagem"})]})]}),U&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-xl p-5 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center",children:[e.jsx(pa,{className:"w-5 h-5 mr-2 text-blue-600"}),"Auxiliar de Contagem"]}),e.jsx("button",{onClick:()=>h(!1),className:"p-1 hover:bg-blue-100 rounded-lg transition-colors",type:"button",children:e.jsx(ue,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-gray-200 hover:border-gray-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-gray-500 to-gray-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 2"}),e.jsx("input",{type:"number",min:"0",value:b.n2,onChange:C=>w({...b,n2:parseInt(C.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-gray-500 focus:ring-2 focus:ring-gray-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-gray-600",children:["R$ ",(b.n2*2).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-purple-200 hover:border-purple-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 5"}),e.jsx("input",{type:"number",min:"0",value:b.n5,onChange:C=>w({...b,n5:parseInt(C.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-purple-600",children:["R$ ",(b.n5*5).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-red-200 hover:border-red-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-red-500 to-red-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 10"}),e.jsx("input",{type:"number",min:"0",value:b.n10,onChange:C=>w({...b,n10:parseInt(C.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-red-500 focus:ring-2 focus:ring-red-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-red-600",children:["R$ ",(b.n10*10).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-yellow-200 hover:border-yellow-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-yellow-500 to-yellow-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 20"}),e.jsx("input",{type:"number",min:"0",value:b.n20,onChange:C=>w({...b,n20:parseInt(C.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-yellow-600",children:["R$ ",(b.n20*20).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-blue-200 hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 50"}),e.jsx("input",{type:"number",min:"0",value:b.n50,onChange:C=>w({...b,n50:parseInt(C.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:["R$ ",(b.n50*50).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-green-200 hover:border-green-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-green-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 100"}),e.jsx("input",{type:"number",min:"0",value:b.n100,onChange:C=>w({...b,n100:parseInt(C.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-green-500 focus:ring-2 focus:ring-green-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",(b.n100*100).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-orange-200 hover:border-orange-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 200"}),e.jsx("input",{type:"number",min:"0",value:b.n200,onChange:C=>w({...b,n200:parseInt(C.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["R$ ",(b.n200*200).toFixed(2)]})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t-2 border-blue-300",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 border-2 border-amber-200 hover:border-amber-400 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-amber-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"üí∞ Moedas"})}),e.jsxs("span",{className:"text-lg font-bold text-amber-600",children:["R$ ",parseFloat(b.moedas||0).toFixed(2)]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:b.moedas,onChange:C=>w({...b,moedas:parseFloat(C.target.value)||0}),className:"w-full px-4 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200",placeholder:"0.00"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl p-4 mb-4 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-semibold text-sm",children:"TOTAL CONTADO"}),e.jsxs("span",{className:"text-3xl font-bold text-white",children:["R$ ",q().toFixed(2)]})]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:Q,className:"flex-1 px-4 py-3 border-2 border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-semibold transition-colors",children:"üóëÔ∏è Limpar"}),e.jsx("button",{type:"button",onClick:R,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg font-semibold shadow-md transition-colors",children:"‚úì Aplicar"})]})]}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:c,onChange:C=>u(C.target.value),placeholder:"0,00",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-lg font-semibold",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conta de Origem"}),e.jsxs("select",{value:s,onChange:C=>g(C.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Dinheiro em m√£os",children:"Dinheiro em m√£os"}),e.jsx("option",{value:"Caixa geral",children:"Caixa geral"}),e.jsx("option",{value:"Banco",children:"Banco"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes (opcional)"}),e.jsx("textarea",{value:F,onChange:C=>m(C.target.value),rows:3,placeholder:"Ex: Troco do dia anterior...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"border-t p-6 bg-gray-50",children:[E&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(we,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:E})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:l,disabled:M,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:se,disabled:M||!c,className:"px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:M?"Abrindo...":"Abrir Caixa"})]})]})]})})}function lr({caixaId:l,onClose:N,onSucesso:c}){const[u,s]=r.useState(""),[g,F]=r.useState(""),[m,b]=r.useState(""),[w,U]=r.useState(!1),[h,M]=r.useState(""),$=async()=>{var t,q;const E=parseFloat(u);if(!E||E<=0){M("Informe um valor v√°lido");return}U(!0);try{await Ia(l,{tipo:"suprimento",valor:E,forma_pagamento:"Dinheiro",conta_origem_nome:g||"N√£o informado",descricao:m}),c()}catch(R){M(((q=(t=R.response)==null?void 0:t.data)==null?void 0:q.detail)||"Erro ao adicionar suprimento")}finally{U(!1)}};return e.jsx(qa,{titulo:"Suprimento para o caixa",icone:ja,corIcone:"green",onClose:N,erro:h,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conta de origem*"}),e.jsxs("select",{value:g,onChange:E=>F(E.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Dinheiro em m√£os",children:"Dinheiro em m√£os"}),e.jsx("option",{value:"Caixa geral",children:"Caixa geral"}),e.jsx("option",{value:"Banco",children:"Banco"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:u,onChange:E=>s(E.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descri√ß√£o*"}),e.jsx("textarea",{value:m,onChange:E=>b(E.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Motivo do suprimento..."})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:N,disabled:w,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:$,disabled:w,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors",children:w?"Salvando...":"Salvar"})]})]})})}function ir({caixaId:l,saldoAtual:N,onClose:c,onSucesso:u}){const[s,g]=r.useState(""),[F,m]=r.useState(""),[b,w]=r.useState(""),[U,h]=r.useState(!1),[M,$]=r.useState(""),E=async()=>{var q,R;const t=parseFloat(s);if(!t||t<=0){$("Informe um valor v√°lido");return}h(!0);try{await Ia(l,{tipo:"sangria",valor:t,forma_pagamento:"Dinheiro",conta_destino_nome:F||"N√£o informado",descricao:b}),u()}catch(Q){$(((R=(q=Q.response)==null?void 0:q.data)==null?void 0:R.detail)||"Erro ao adicionar sangria")}finally{h(!1)}};return e.jsx(qa,{titulo:"Sangria no caixa",icone:Fa,corIcone:"orange",onClose:c,erro:M,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Em caixa:"})," R$ ",N.toFixed(2)]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor da Sangria*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:s,onChange:t=>g(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",autoFocus:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecione a conta de destino*"}),e.jsxs("select",{value:F,onChange:t=>m(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"Cofre",children:"Cofre"}),e.jsx("option",{value:"Banco",children:"Banco"}),e.jsx("option",{value:"Outro caixa",children:"Outro caixa"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descri√ß√£o"}),e.jsx("textarea",{value:b,onChange:t=>w(t.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Motivo da sangria..."})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:c,disabled:U,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:E,disabled:U,className:"flex-1 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors",children:U?"Salvando...":"Salvar"})]})]})})}function dr({caixaId:l,onClose:N,onSucesso:c}){const[u,s]=r.useState(""),[g,F]=r.useState(""),[m,b]=r.useState(""),[w,U]=r.useState("Dinheiro"),[h,M]=r.useState(""),[$,E]=r.useState(""),[t,q]=r.useState(!1),[R,Q]=r.useState(""),se=["√Ågua e Luz","Aluguel","Telefone/Internet","Material de Limpeza","Material de Escrit√≥rio","Manuten√ß√£o","Outros"],C=async()=>{var I,K;const S=parseFloat(m);if(!S||S<=0){Q("Informe um valor v√°lido");return}if(!u){Q("Selecione uma categoria");return}q(!0);try{await Ia(l,{tipo:"despesa",valor:S,categoria:u,descricao:g,forma_pagamento:w,fornecedor_nome:h,documento:$}),c()}catch(D){Q(((K=(I=D.response)==null?void 0:I.data)==null?void 0:K.detail)||"Erro ao adicionar despesa")}finally{q(!1)}};return e.jsx(qa,{titulo:"Despesa no caixa",icone:ea,corIcone:"red",onClose:N,erro:R,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categoria*"}),e.jsxs("select",{value:u,onChange:S=>s(S.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Selecione..."}),se.map(S=>e.jsx("option",{value:S,children:S},S))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descri√ß√£o*"}),e.jsx("input",{type:"text",value:g,onChange:S=>F(S.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Ex: Conta de luz - Janeiro"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de pagamento*"}),e.jsxs("select",{value:w,onChange:S=>U(S.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Dinheiro",children:"Dinheiro"}),e.jsx("option",{value:"PIX",children:"PIX"}),e.jsx("option",{value:"Cart√£o de Cr√©dito",children:"Cart√£o de Cr√©dito"}),e.jsx("option",{value:"Cart√£o de D√©bito",children:"Cart√£o de D√©bito"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor*"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:m,onChange:S=>b(S.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fornecedor"}),e.jsx("input",{type:"text",value:h,onChange:S=>M(S.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Documento / NF"}),e.jsx("input",{type:"text",value:$,onChange:S=>E(S.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:N,disabled:t,className:"flex-1 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors",children:"Fechar"}),e.jsx("button",{onClick:C,disabled:t,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors",children:t?"Salvando...":"Salvar"})]})]})})}function qa({titulo:l,icone:N,corIcone:c,children:u,onClose:s,erro:g}){const F={green:"bg-green-100 text-green-600",orange:"bg-orange-100 text-orange-600",red:"bg-red-100 text-red-600",blue:"bg-blue-100 text-blue-600",purple:"bg-purple-100 text-purple-600"};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-12 h-12 ${F[c]} rounded-full flex items-center justify-center`,children:e.jsx(N,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:l})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[g&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-700",children:[e.jsx(we,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:g})]}),u]})]})})}function cr({caixaId:l,onClose:N,onSuccess:c}){const[u,s]=r.useState(null),[g,F]=r.useState(""),[m,b]=r.useState(""),[w,U]=r.useState(!0),[h,M]=r.useState(!1),[$,E]=r.useState(!1),[t,q]=r.useState({n100:0,n50:0,n20:0,n10:0,n5:0,n2:0,moedas:0});r.useEffect(()=>{R()},[l]);const R=async()=>{try{const D=await Ps(l);console.log("üìä Resumo do caixa recebido:",D),console.log("üìä vendas_por_forma_pagamento:",D.vendas_por_forma_pagamento),s(D),F(D.totais.saldo_atual.toFixed(2))}catch(D){console.error("Erro ao carregar resumo:",D),alert("Erro ao carregar dados do caixa")}finally{U(!1)}},Q=()=>!u||!g?0:parseFloat(g)-u.totais.saldo_atual,se=()=>t.n100*100+t.n50*50+t.n20*20+t.n10*10+t.n5*5+t.n2*2+parseFloat(t.moedas||0),C=()=>{const D=se();F(D.toFixed(2)),E(!1)},S=()=>{q({n100:0,n50:0,n20:0,n10:0,n5:0,n2:0,moedas:0})},I=async()=>{var oe,le;if(!g){alert("Informe o valor contado no caixa");return}const D=Q();if(!(Math.abs(D)>.01&&!window.confirm(`Diferen√ßa de R$ ${Math.abs(D).toFixed(2)} ${D>0?"a mais":"a menos"}

Deseja continuar com o fechamento?`))){M(!0);try{await Zt(l,{valor_informado:parseFloat(g),observacoes_fechamento:m||null}),alert("Caixa fechado com sucesso!"),c(),N()}catch(xe){console.error("Erro ao fechar caixa:",xe),alert(((le=(oe=xe.response)==null?void 0:oe.data)==null?void 0:le.detail)||"Erro ao fechar caixa")}finally{M(!1)}}};if(w)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})});if(!u)return null;const K=Q();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-red-600 to-orange-600 text-white p-6 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center",children:[e.jsx(ea,{className:"w-7 h-7 mr-3"}),"Fechar Caixa"]}),e.jsxs("p",{className:"text-red-100 mt-1",children:["Caixa #",u.caixa.numero_caixa," - ",u.caixa.usuario_nome]})]}),e.jsx("button",{onClick:N,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-6 border-2 border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center",children:[e.jsx(pa,{className:"w-5 h-5 mr-2 text-gray-700"}),"Resumo do Movimento"]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Valor de Abertura"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",u.caixa.valor_abertura.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(u.caixa.data_abertura).toLocaleString("pt-BR")})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-green-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-green-700 mb-1",children:[e.jsx(ea,{className:"w-4 h-4 mr-1"}),"Entradas"]}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["+ R$ ",u.totais.vendas.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Movimento de entrada"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-blue-700 mb-1",children:[e.jsx(ja,{className:"w-4 h-4 mr-1"}),"Suprimentos"]}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["+ R$ ",u.totais.suprimentos.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-orange-700 mb-1",children:[e.jsx(Fa,{className:"w-4 h-4 mr-1"}),"Sangrias"]}),e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["- R$ ",u.totais.sangrias.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-red-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-red-700 mb-1",children:[e.jsx(ia,{className:"w-4 h-4 mr-1"}),"Despesas"]}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["- R$ ",u.totais.despesas.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900",children:"Valor Contado no Caixa *"}),e.jsxs("button",{type:"button",onClick:()=>E(!$),className:"flex items-center space-x-1 px-3 py-1.5 text-sm bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors border border-blue-200",title:"Auxiliar na contagem de notas",children:[e.jsx(pa,{className:"w-4 h-4"}),e.jsx("span",{children:"Auxiliar Contagem"})]})]}),$&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-xl p-5 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-900 flex items-center",children:[e.jsx(pa,{className:"w-5 h-5 mr-2 text-blue-600"}),"Auxiliar de Contagem"]}),e.jsx("button",{onClick:()=>E(!1),className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-gray-200 hover:border-gray-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-gray-500 to-gray-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 2"}),e.jsx("input",{type:"number",min:"0",value:t.n2,onChange:D=>q({...t,n2:parseInt(D.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-gray-500 focus:ring-2 focus:ring-gray-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-gray-600",children:["R$ ",(t.n2*2).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-purple-200 hover:border-purple-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 5"}),e.jsx("input",{type:"number",min:"0",value:t.n5,onChange:D=>q({...t,n5:parseInt(D.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-purple-600",children:["R$ ",(t.n5*5).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-red-200 hover:border-red-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-red-500 to-red-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 10"}),e.jsx("input",{type:"number",min:"0",value:t.n10,onChange:D=>q({...t,n10:parseInt(D.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-red-500 focus:ring-2 focus:ring-red-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-red-600",children:["R$ ",(t.n10*10).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-yellow-200 hover:border-yellow-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-yellow-500 to-yellow-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 20"}),e.jsx("input",{type:"number",min:"0",value:t.n20,onChange:D=>q({...t,n20:parseInt(D.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-yellow-600",children:["R$ ",(t.n20*20).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-blue-200 hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 50"}),e.jsx("input",{type:"number",min:"0",value:t.n50,onChange:D=>q({...t,n50:parseInt(D.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:["R$ ",(t.n50*50).toFixed(2)]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border-2 border-green-200 hover:border-green-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-green-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"R$ 100"}),e.jsx("input",{type:"number",min:"0",value:t.n100,onChange:D=>q({...t,n100:parseInt(D.target.value)||0}),className:"w-20 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-green-500 focus:ring-2 focus:ring-green-200",placeholder:"0"}),e.jsx("span",{className:"text-xs text-gray-500",children:"√ó"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",(t.n100*100).toFixed(2)]})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t-2 border-blue-300",children:e.jsx("div",{className:"bg-white rounded-lg p-4 border-2 border-amber-200 hover:border-amber-400 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-amber-600 text-white px-3 py-2 rounded-lg font-bold text-sm shadow-md",children:"üí∞ Moedas"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:t.moedas,onChange:D=>q({...t,moedas:parseFloat(D.target.value)||0}),className:"w-32 px-3 py-2 border-2 border-gray-300 rounded-lg text-center font-bold text-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200",placeholder:"0.00"})]}),e.jsxs("span",{className:"text-lg font-bold text-amber-600",children:["R$ ",(t.moedas||0).toFixed(2)]})]})})}),e.jsxs("div",{className:"mt-5 pt-5 border-t-2 border-blue-300",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl p-4 mb-4 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-semibold text-sm",children:"TOTAL CONTADO"}),e.jsxs("span",{className:"text-3xl font-bold text-white",children:["R$ ",se().toFixed(2)]})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:S,className:"flex-1 px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-semibold transition-colors",children:"üóëÔ∏è Limpar"}),e.jsx("button",{type:"button",onClick:C,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 font-bold shadow-md transition-all",children:"‚úì Aplicar"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ia,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:g,onChange:D=>F(D.target.value),className:"w-full pl-10 pr-4 py-3 text-lg font-semibold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",autoFocus:!0})]}),g&&Math.abs(K)>.01&&e.jsx("div",{className:`mt-3 p-4 rounded-lg border-2 ${K>0?"bg-blue-50 border-blue-300":"bg-yellow-50 border-yellow-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-semibold text-gray-900",children:[K>0?"Sobra":"Falta",":"]}),e.jsxs("span",{className:`text-xl font-bold ${K>0?"text-blue-600":"text-yellow-700"}`,children:["R$ ",Math.abs(K).toFixed(2)]})]})}),g&&Math.abs(K)<=.01&&e.jsx("div",{className:"mt-3 p-4 rounded-lg border-2 bg-green-50 border-green-300",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-green-700 font-semibold",children:[e.jsx("span",{className:"text-2xl",children:"‚úì"}),e.jsx("span",{children:"Caixa conferido - Valores corretos!"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Observa√ß√µes (opcional)"}),e.jsx("textarea",{value:m,onChange:D=>b(D.target.value),placeholder:"Adicione observa√ß√µes sobre o fechamento...",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),u.vendas_por_forma_pagamento&&Object.keys(u.vendas_por_forma_pagamento).length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center",children:[e.jsx(ea,{className:"w-4 h-4 mr-1.5 text-blue-600"}),"Vendas por Forma de Pagamento (Informativo)"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(u.vendas_por_forma_pagamento).map(([D,oe])=>{const le=D==="Dinheiro";return e.jsx("div",{className:`bg-white rounded-lg p-3 border ${le?"border-green-300 bg-green-50":"border-gray-200"} hover:shadow-sm transition-shadow cursor-pointer`,title:"Clique para ver detalhes das vendas",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${D==="Dinheiro"?"bg-green-500":D==="PIX"?"bg-purple-500":D.includes("D√©bito")?"bg-blue-500":D.includes("Cr√©dito")?"bg-orange-500":"bg-gray-400"}`}),e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:D}),le&&e.jsx("span",{className:"text-xs bg-green-600 text-white px-1.5 py-0.5 rounded",children:"CAIXA"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[oe.quantidade," venda",oe.quantidade!==1?"s":""]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:["R$ ",oe.total.toFixed(2)]})})]})},D)})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200 text-xs text-gray-600",children:["üí° ",e.jsx("strong",{children:"Dica:"})," Apenas ",e.jsx("strong",{children:"Dinheiro"})," afeta o saldo f√≠sico do caixa. Demais formas v√£o para banco/financeiro."]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:N,disabled:h,className:"px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),e.jsx("button",{onClick:I,disabled:h||!g,className:"px-8 py-3 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white rounded-lg font-bold transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Fechando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ea,{className:"w-5 h-5"}),e.jsx("span",{children:"Fechar Caixa"})]})})]})]})]})})}function xr({caixaId:l,onClose:N,onSucesso:c}){var Oe;const[u,s]=r.useState(1),[g,F]=r.useState([]),[m,b]=r.useState(null),[w,U]=r.useState({}),[h,M]=r.useState({}),[$,E]=r.useState(""),[t,q]=r.useState(!1),[R,Q]=r.useState(!1),[se,C]=r.useState(""),[S,I]=r.useState({}),[K,D]=r.useState({}),[oe,le]=r.useState({}),[xe,v]=r.useState({busca:"",data_inicio:"",data_fim:"",status:"finalizada"});r.useEffect(()=>{H()},[xe]);const H=async()=>{Q(!0),C("");try{const x={per_page:50,...xe},k=await P.get("/vendas",{params:x});F(k.data.vendas||[])}catch(x){console.error("Erro ao buscar vendas:",x),C("Erro ao carregar vendas")}finally{Q(!1)}},J=async x=>{var k,_;Q(!0),C("");try{const V=await P.get(`/vendas/${x.id}`);b(V.data);const te={};V.data.itens.forEach(T=>{te[T.id]=T.quantidade}),M(te),s(2)}catch(V){console.error("Erro ao buscar venda:",V),C(((_=(k=V.response)==null?void 0:k.data)==null?void 0:_.detail)||"Erro ao carregar detalhes da venda")}finally{Q(!1)}},z=x=>{const k=w[x];U(_=>({..._,[x]:!_[x]})),k&&(I(_=>{const V={..._};return delete V[x],V}),D(_=>{const V={..._};return delete V[x],V}),le(_=>{const V={..._};return delete V[x],V}))},ne=(x,k)=>{const V=m.itens.find(T=>T.id===x).quantidade,te=Math.min(Math.max(0,parseFloat(k)||0),V);M(T=>({...T,[x]:te}))},ye=x=>x.tipo_produto==="KIT"&&x.composicao_kit&&x.composicao_kit.length>0,y=(x,k)=>{if(I(_=>({..._,[x]:k})),k==="componentes"){const _=m.itens.find(V=>V.id===x);if(_&&_.composicao_kit){const V={},te={};_.composicao_kit.forEach((T,fe)=>{V[fe]=!1,te[fe]=T.quantidade*_.quantidade}),D(T=>({...T,[x]:V})),le(T=>({...T,[x]:te}))}}},X=(x,k)=>{D(_=>{var V;return{..._,[x]:{..._[x]||{},[k]:!((V=_[x])!=null&&V[k])}}})},ge=(x,k,_)=>{const V=m.itens.find(me=>me.id===x),T=V.composicao_kit[k].quantidade*V.quantidade,fe=Math.min(Math.max(0,parseFloat(_)||0),T);le(me=>({...me,[x]:{...me[x]||{},[k]:fe}}))},he=async()=>{var V,te;if(Object.keys(w).filter(T=>w[T]).filter(T=>{const fe=m.itens.find(me=>me.id===parseInt(T));return ye(fe)&&!S[T]}).length>0){C("Para itens KIT, voc√™ deve escolher entre devolver o KIT inteiro ou selecionar componentes");return}const k=[];if(Object.keys(w).filter(T=>w[T]).forEach(T=>{const fe=parseInt(T),me=m.itens.find(re=>re.id===fe);if(ye(me)){const re=S[T];if(re==="kit_inteiro")k.push({item_id:fe,quantidade:h[T]});else if(re==="componentes"){const ie=K[T]||{},Pe=oe[T]||{},Ee=Object.keys(ie).filter(ee=>ie[ee]).map(ee=>parseInt(ee));if(Ee.length===0){C(`Voc√™ deve selecionar pelo menos um componente do KIT "${me.produto_nome}"`);return}Ee.forEach(ee=>{const Ne=me.composicao_kit[ee],Fe=Pe[ee]||0;if(Fe<=0){C(`Quantidade do componente "${Ne.produto_nome}" deve ser maior que zero`);return}k.push({produto_id:Ne.produto_id,quantidade:Fe,preco_unitario:me.preco_unitario/me.composicao_kit.reduce((Te,da)=>Te+da.quantidade,0)*Ne.quantidade,is_componente_kit:!0,kit_item_id:fe})})}}else k.push({item_id:fe,quantidade:h[T]})}),k.length===0){C("Selecione pelo menos um item para devolu√ß√£o");return}if(k.some(T=>T.quantidade<=0)){C("Todas as quantidades devem ser maiores que zero");return}if(!$.trim()){C("Informe o motivo da devolu√ß√£o");return}Q(!0),C("");try{await P.post(`/vendas/${m.id}/devolucao`,{caixa_id:l,itens:k,motivo:$,gerar_credito:t}),alert("Devolu√ß√£o registrada com sucesso!"),c()}catch(T){console.error("Erro ao registrar devolu√ß√£o:",T),C(((te=(V=T.response)==null?void 0:V.data)==null?void 0:te.detail)||"Erro ao registrar devolu√ß√£o")}finally{Q(!1)}},ke=()=>{if(!m)return 0;let x=0;return Object.keys(w).filter(k=>w[k]).forEach(k=>{const _=m.itens.find(V=>V.id===parseInt(k));if(ye(_)){const V=S[k];if(V==="kit_inteiro"){const te=h[k]||0;x+=_.preco_unitario*te}else if(V==="componentes"){const te=K[k]||{},T=oe[k]||{},fe=_.composicao_kit.reduce((me,re)=>me+re.quantidade,0);Object.keys(te).filter(me=>te[me]).forEach(me=>{const re=_.composicao_kit[me],ie=T[me]||0,Pe=_.preco_unitario/fe*re.quantidade,Ee=ie/re.quantidade;x+=Pe*Ee})}}else{const V=h[k]||0;x+=_.preco_unitario*V}}),x};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(Rs,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Devolu√ß√£o"}),e.jsx("p",{className:"text-sm text-gray-500",children:u===1?"Selecione a venda":"Selecionar itens para devolu√ß√£o"})]})]}),e.jsx("button",{onClick:N,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[u===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar"}),e.jsx("input",{type:"text",value:xe.busca,onChange:x=>v({...xe,busca:x.target.value}),placeholder:"N√∫mero da venda, cliente...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data In√≠cio"}),e.jsx("input",{type:"date",value:xe.data_inicio,onChange:x=>v({...xe,data_inicio:x.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Fim"}),e.jsx("input",{type:"date",value:xe.data_fim,onChange:x=>v({...xe,data_fim:x.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})}),R?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando vendas..."})]}):g.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(we,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Nenhuma venda encontrada"})]}):e.jsx("div",{className:"space-y-2",children:g.map(x=>{var k;return e.jsx("button",{onClick:()=>J(x),className:"w-full text-left p-4 border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:["Venda #",x.numero_venda||x.id]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Cliente: ",((k=x.cliente)==null?void 0:k.nome)||"Consumidor Final"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:x.data_criacao?new Date(x.data_criacao).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Data n√£o dispon√≠vel"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold text-green-600",children:["R$ ",x.total.toFixed(2)]}),e.jsx("div",{className:`text-xs mt-1 px-2 py-1 rounded ${x.status==="finalizada"?"bg-green-100 text-green-800":x.status==="baixa_parcial"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:x.status==="finalizada"?"Finalizada":x.status==="baixa_parcial"?"Parcial":"Aberta"})]})]})},x.id)})}),se&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(we,{className:"w-5 h-5"}),e.jsx("span",{children:se})]})]}),u===2&&m&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-2",children:["Venda #",m.numero_venda||m.id]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{className:"ml-2 font-medium",children:m.data_criacao?new Date(m.data_criacao).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Data n√£o dispon√≠vel"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Cliente:"}),e.jsx("span",{className:"ml-2 font-medium",children:((Oe=m.cliente)==null?void 0:Oe.nome)||"Consumidor Final"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"ml-2 font-medium text-green-600",children:["R$ ",m.total.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Itens da Venda"}),e.jsx("div",{className:"space-y-2",children:m.itens.map(x=>{const k=ye(x),_=S[x.id];return e.jsx("div",{className:`border rounded-lg p-4 transition-colors ${w[x.id]?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("input",{type:"checkbox",checked:w[x.id]||!1,onChange:()=>z(x.id),className:"mt-1 w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:x.produto_nome}),k&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded",children:[e.jsx(Ds,{className:"w-3 h-3"}),"KIT"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Pre√ßo unit√°rio: R$ ",x.preco_unitario.toFixed(2)," | Qtd vendida: ",x.quantidade]}),w[x.id]&&k&&e.jsxs("div",{className:"mt-4 bg-white border-2 border-purple-300 rounded-lg p-4",children:[e.jsxs("div",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(ba,{className:"w-5 h-5 text-purple-600"}),"Como deseja devolver este KIT?"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:`modo-kit-${x.id}`,checked:_==="kit_inteiro",onChange:()=>y(x.id,"kit_inteiro"),className:"mt-1 w-4 h-4 text-blue-600 focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800 group-hover:text-blue-700 transition-colors",children:"üì¶ Devolver KIT Inteiro"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Devolve o KIT completo como uma unidade"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:`modo-kit-${x.id}`,checked:_==="componentes",onChange:()=>y(x.id,"componentes"),className:"mt-1 w-4 h-4 text-purple-600 focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800 group-hover:text-purple-700 transition-colors",children:"üß© Selecionar Componentes"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Escolha quais componentes do KIT devolver"})]})]})]})]}),w[x.id]&&!k&&e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantidade a devolver:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:x.quantidade,value:h[x.id],onChange:V=>ne(x.id,V.target.value),className:"w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Subtotal: R$ ",(x.preco_unitario*(h[x.id]||0)).toFixed(2)]})]}),w[x.id]&&k&&_==="kit_inteiro"&&e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Quantidade de KITs a devolver:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:x.quantidade,value:h[x.id],onChange:V=>ne(x.id,V.target.value),className:"w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Subtotal: R$ ",(x.preco_unitario*(h[x.id]||0)).toFixed(2)]})]}),w[x.id]&&k&&_==="componentes"&&e.jsxs("div",{className:"mt-4 bg-gradient-to-br from-purple-50 to-blue-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold text-gray-800 mb-3",children:"Selecione os componentes a devolver:"}),e.jsx("div",{className:"space-y-3",children:x.composicao_kit.map((V,te)=>{var me,re;const T=(me=K[x.id])==null?void 0:me[te],fe=V.quantidade*x.quantidade;return e.jsx("div",{className:`border rounded-lg p-3 transition-colors ${T?"border-purple-500 bg-white":"border-gray-200 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:T||!1,onChange:()=>X(x.id,te),className:"mt-1 w-4 h-4 text-purple-600 rounded focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ba,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-800",children:V.produto_nome})]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["Qtd no KIT: ",V.quantidade," | Qtd total dispon√≠vel: ",fe]}),T&&e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Quantidade:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:fe,value:((re=oe[x.id])==null?void 0:re[te])||0,onChange:ie=>ge(x.id,te,ie.target.value),className:"w-24 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500"})]})]})]})},te)})})]})]})]})},x.id)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Motivo da Devolu√ß√£o *"}),e.jsx("textarea",{value:$,onChange:x=>E(x.target.value),placeholder:"Descreva o motivo da devolu√ß√£o...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 border-2 border-purple-200 rounded-lg p-5",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-3",children:"üí≥ Tipo de Devolu√ß√£o"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",checked:!t,onChange:()=>q(!1),className:"mt-1 w-5 h-5 text-green-600 focus:ring-2 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800 group-hover:text-green-700 transition-colors",children:"üíµ Devolver em Dinheiro"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"O valor ser√° devolvido em dinheiro e registrado como sa√≠da de caixa"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",checked:t,onChange:()=>q(!0),className:"mt-1 w-5 h-5 text-purple-600 focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800 group-hover:text-purple-700 transition-colors",children:"üéÅ Gerar Cr√©dito para o Cliente"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"O valor ser√° convertido em cr√©dito para uso em futuras compras (sem movimenta√ß√£o de caixa)"})]})]})]}),t&&!(m!=null&&m.cliente_id)&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-300 rounded-lg",children:e.jsxs("p",{className:"text-xs text-yellow-800 flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Aten√ß√£o:"})," Esta venda n√£o possui cliente vinculado. Para gerar cr√©dito, √© necess√°rio ter um cliente cadastrado."]})]})})]}),e.jsx("div",{className:`border-2 rounded-lg p-4 ${t?"bg-purple-50 border-purple-300":"bg-orange-50 border-orange-200"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:t?"Cr√©dito a Gerar:":"Total da Devolu√ß√£o:"}),t&&(m==null?void 0:m.cliente)&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Cliente: ",e.jsx("strong",{children:m.cliente.nome})]})]}),e.jsxs("span",{className:`text-2xl font-bold ${t?"text-purple-600":"text-orange-600"}`,children:["R$ ",ke().toFixed(2)]})]})}),se&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(we,{className:"w-5 h-5"}),e.jsx("span",{children:se})]})]})]}),e.jsx("div",{className:"border-t p-6 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:u===1?N:()=>{s(1),b(null),U({}),M({}),E(""),C("")},disabled:R,className:"px-6 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg font-medium transition-colors disabled:opacity-50",children:u===1?"Cancelar":"Voltar"}),u===2&&e.jsx("button",{onClick:he,disabled:R||Object.values(w).filter(Boolean).length===0,className:"flex items-center gap-2 px-8 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:R?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ht,{className:"w-5 h-5"}),e.jsx("span",{children:"Confirmar Devolu√ß√£o"})]})})]})})]})})}function mr({caixaId:l,onClose:N}){const[c,u]=r.useState([]),[s,g]=r.useState(null),[F,m]=r.useState(!0);r.useEffect(()=>{b()},[l]);const b=async()=>{try{m(!0);const h=await P.get(`/caixas/${l}/movimentacoes`);u(h.data.movimentacoes),g(h.data.caixa)}catch(h){console.error("Erro ao carregar movimenta√ß√µes:",h),Ae.error("Erro ao carregar movimenta√ß√µes do caixa")}finally{m(!1)}},w=h=>{const M=new Date(h);return new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}).format(M)},U=h=>({venda:"Venda",suprimento:"Suprimento",sangria:"Sangria",despesa:"Despesa",devolucao:"Devolu√ß√£o",transferencia:"Transfer√™ncia"})[h]||h;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-blue-50 to-purple-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:"üìã Extrato do Caixa"}),s&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Caixa #",s.id," - ",s.nome," | Status: ",s.status]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,className:"p-2 hover:bg-white rounded-lg transition-colors",title:"Atualizar",children:e.jsx(ft,{className:`w-5 h-5 text-gray-600 ${F?"animate-spin":""}`})}),e.jsx("button",{onClick:N,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(ue,{className:"w-5 h-5 text-gray-600"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:F?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üì≠"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Nenhuma movimenta√ß√£o registrada"})]}):e.jsx("div",{className:"space-y-3",children:c.map(h=>e.jsx("div",{className:`p-4 rounded-lg border-2 ${h.natureza==="entrada"?"bg-green-50 border-green-200":h.natureza==="saida"?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"text-3xl",children:h.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:U(h.tipo)}),h.forma_pagamento&&e.jsx("span",{className:"text-xs bg-white px-2 py-1 rounded border",children:h.forma_pagamento})]}),h.descricao&&e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:h.descricao}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-2 text-xs text-gray-600",children:[e.jsxs("span",{children:["üïê ",w(h.data_movimento)]}),e.jsxs("span",{children:["üë§ ",h.usuario_nome]}),h.venda_id&&e.jsxs("span",{children:["üßæ Venda #",h.venda_numero||h.venda_id]}),h.documento&&e.jsxs("span",{children:["üìÑ ",h.documento]})]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("div",{className:`text-2xl font-bold ${h.natureza==="entrada"?"text-green-600":h.natureza==="saida"?"text-red-600":"text-gray-600"}`,children:[h.natureza==="entrada"&&"+",h.natureza==="saida"&&"-","R$ ",h.valor.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:h.natureza==="entrada"?e.jsxs("span",{className:"flex items-center gap-1 justify-end",children:[e.jsx(ja,{className:"w-3 h-3"})," Entrada"]}):h.natureza==="saida"?e.jsxs("span",{className:"flex items-center gap-1 justify-end",children:[e.jsx(Fa,{className:"w-3 h-3"})," Sa√≠da"]}):"Neutro"})]})]})},h.id))})}),e.jsx("div",{className:"border-t p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[c.length," movimenta√ß√£o(√µes) encontrada(s)"]}),e.jsx("button",{onClick:N,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Fechar"})]})})]})})}function ur({onAbrirCaixa:l}){var se,C,S;const[N,c]=r.useState(null),[u,s]=r.useState(null),[g,F]=r.useState(!1),[m,b]=r.useState(null),[w,U]=r.useState(!0),[h,M]=r.useState(!1),[$,E]=r.useState(!1);r.useEffect(()=>{q();const I=setInterval(q,3e4);return()=>clearInterval(I)},[]),r.useEffect(()=>{const I=()=>{M(!1)};if(h)return document.addEventListener("mouseup",I),()=>document.removeEventListener("mouseup",I)},[h]);const t=()=>{F(!1),E(!1),M(!1)},q=async()=>{try{const I=await Yt();if(c(I),I){const K=await Ps(I.id);s(K)}}catch(I){console.error("Erro ao carregar caixa:",I)}finally{U(!1)}},R=()=>{b(null),q()},Q=async()=>{await l(),setTimeout(q,500)};return w?e.jsx("div",{className:"px-4 py-2 bg-gray-100 rounded-lg",children:e.jsx("div",{className:"animate-pulse h-10 bg-gray-200 rounded"})}):N?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>F(!g),className:"flex items-center space-x-3 px-4 py-2 bg-white border-2 border-green-500 rounded-lg hover:bg-green-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["Caixa #",N.numero_caixa]})]}),e.jsx(Va,{className:`w-5 h-5 text-gray-400 transition-transform ${g?"rotate-180":""}`})]}),g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:t}),e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 z-50",children:[e.jsxs("div",{className:"p-4 border-b bg-gradient-to-r from-green-50 to-blue-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Caixa #",N.numero_caixa]}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:N.usuario_nome})]}),e.jsx("button",{onClick:t,className:"p-1 hover:bg-white rounded-lg transition-colors",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(Ma,{className:"w-4 h-4 mr-1"}),"Aberto em ",new Date(N.data_abertura).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Saldo Atual"}),e.jsx("div",{className:`text-sm font-bold ${h?"text-green-600":"text-gray-400"}`,children:h?`R$ ${((C=(se=u==null?void 0:u.totais)==null?void 0:se.saldo_atual)==null?void 0:C.toFixed(2))||"0,00"}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsx("button",{onMouseDown:()=>M(!0),className:"p-1 hover:bg-blue-100 rounded transition-colors",children:h?e.jsx(Ns,{className:"w-4 h-4 text-blue-600"}):e.jsx(ws,{className:"w-4 h-4 text-gray-400"})})]})]})]}),u&&e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900",children:"Resumo do Movimento"}),e.jsx("button",{onClick:()=>E(!$),className:"p-1 hover:bg-gray-200 rounded transition-colors",children:$?e.jsx(Ns,{className:"w-4 h-4 text-blue-600"}):e.jsx(ws,{className:"w-4 h-4 text-gray-400"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Abertura"}),e.jsx("div",{className:`font-semibold ${$?"text-gray-900":"text-gray-300"}`,children:$?`R$ ${N.valor_abertura.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Entradas"}),e.jsx("div",{className:`font-semibold ${$?"text-green-600":"text-green-300"}`,children:$?`+ R$ ${u.totais.vendas.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Suprimentos"}),e.jsx("div",{className:`font-semibold ${$?"text-green-600":"text-green-300"}`,children:$?`+ R$ ${u.totais.suprimentos.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Sangrias"}),e.jsx("div",{className:`font-semibold ${$?"text-orange-600":"text-orange-300"}`,children:$?`- R$ ${u.totais.sangrias.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Despesas"}),e.jsx("div",{className:`font-semibold ${$?"text-red-600":"text-red-300"}`,children:$?`- R$ ${u.totais.despesas.toFixed(2)}`:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]})]})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{onClick:()=>{b("suprimento"),F(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-green-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(ja,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Suprimento"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Adicionar dinheiro ao caixa"})]})]}),e.jsxs("button",{onClick:()=>{b("sangria"),F(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-orange-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(Fa,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Sangria"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Retirar dinheiro do caixa"})]})]}),e.jsxs("button",{onClick:()=>{b("despesa"),F(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-red-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(ea,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Despesa"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Registrar pagamento de despesa"})]})]}),e.jsxs("button",{onClick:()=>{b("devolucao"),F(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-purple-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(Rs,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Devolu√ß√£o"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Estornar venda e devolver ao estoque"})]})]}),e.jsxs("button",{onClick:()=>{b("movimentacoes"),F(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 hover:bg-blue-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(jt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Extrato do Caixa"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Ver todas as movimenta√ß√µes"})]})]})]}),e.jsx("div",{className:"p-4 border-t",children:e.jsx("button",{onClick:()=>{b("fechar"),F(!1)},className:"w-full px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Fechar Caixa"})})]})]})]}),m==="suprimento"&&e.jsx(lr,{caixaId:N.id,onClose:()=>b(null),onSucesso:R}),m==="sangria"&&e.jsx(ir,{caixaId:N.id,saldoAtual:((S=u==null?void 0:u.totais)==null?void 0:S.saldo_atual)||0,onClose:()=>b(null),onSucesso:R}),m==="despesa"&&e.jsx(dr,{caixaId:N.id,onClose:()=>b(null),onSucesso:R}),m==="fechar"&&e.jsx(cr,{caixaId:N.id,onClose:()=>b(null),onSuccess:()=>{b(null),q()}}),m==="devolucao"&&e.jsx(xr,{caixaId:N.id,onClose:()=>b(null),onSucesso:R}),m==="movimentacoes"&&e.jsx(mr,{caixaId:N.id,onClose:()=>b(null)})]}):e.jsxs("button",{onClick:Q,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(ia,{className:"w-5 h-5"}),e.jsx("span",{children:"Abrir Caixa"})]})}function gr({venda:l,onClose:N}){var u,s;const c=()=>{window.print()};return l?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:c,className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-800 text-white rounded-lg transition-colors print:hidden",children:[e.jsx(vt,{className:"w-5 h-5"}),e.jsx("span",{children:"Imprimir Cupom"})]}),e.jsx("style",{children:`
        @media print {
          /* Esconder tudo exceto o cupom */
          body * {
            visibility: hidden;
          }
          .cupom-impressao, .cupom-impressao * {
            visibility: visible;
          }
          .cupom-impressao {
            position: absolute;
            left: 0;
            top: 0;
            width: 80mm;
            margin: 0;
            padding: 0;
          }
          
          /* Reset de margens para impress√£o */
          @page {
            size: 80mm auto;
            margin: 5mm;
          }
        }
      `}),e.jsxs("div",{className:"cupom-impressao hidden print:block",style:{width:"80mm",fontFamily:"monospace"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"10px"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold"},children:"PET SHOP PRO"}),e.jsx("div",{style:{fontSize:"12px"},children:"Central de Gest\\u00e3o"}),e.jsx("div",{style:{fontSize:"10px",marginTop:"5px"},children:new Date().toLocaleString("pt-BR")})]}),e.jsxs("div",{style:{borderTop:"1px dashed #000",marginBottom:"10px",paddingTop:"10px"},children:[e.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"5px"},children:["VENDA #",l.numero_venda||l.id]}),e.jsxs("div",{style:{fontSize:"11px"},children:[e.jsxs("div",{children:["Data: ",l.data_venda?new Date(l.data_venda).toLocaleString("pt-BR"):new Date().toLocaleString("pt-BR")]}),l.cliente&&e.jsxs("div",{children:["Cliente: ",l.cliente.nome||l.cliente_nome]}),l.pet&&e.jsxs("div",{children:["Pet: ",l.pet.nome]})]})]}),e.jsx("div",{style:{borderTop:"1px dashed #000",marginBottom:"10px",paddingTop:"10px"},children:e.jsxs("table",{style:{width:"100%",fontSize:"10px",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid #000"},children:[e.jsx("th",{style:{textAlign:"left",paddingBottom:"5px"},children:"Item"}),e.jsx("th",{style:{textAlign:"center",paddingBottom:"5px"},children:"Qtd"}),e.jsx("th",{style:{textAlign:"right",paddingBottom:"5px"},children:"Valor"})]})}),e.jsx("tbody",{children:(u=l.itens)==null?void 0:u.map((g,F)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{paddingTop:"5px",paddingBottom:"5px"},children:[g.produto_nome,e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"9px",color:"#666"},children:[g.quantidade," x R$ ",g.preco_unitario.toFixed(2),g.desconto_valor>0&&e.jsxs("span",{style:{color:"#ff8c00"},children:[" ","com R$ ",g.desconto_valor.toFixed(2)," de desconto"]})]})]}),e.jsx("td",{style:{textAlign:"center",paddingTop:"5px",paddingBottom:"5px"},children:g.quantidade}),e.jsxs("td",{style:{textAlign:"right",paddingTop:"5px",paddingBottom:"5px"},children:["R$ ",g.subtotal.toFixed(2)]})]},F))})]})}),e.jsxs("div",{style:{borderTop:"1px dashed #000",paddingTop:"10px",fontSize:"11px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Total bruto:"}),e.jsxs("span",{children:["R$ ",(l.subtotal+l.desconto_valor).toFixed(2)]})]}),l.desconto_valor>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px",color:"#ff8c00"},children:[e.jsxs("span",{children:[(l.desconto_valor/(l.subtotal+l.desconto_valor)*100).toFixed(2),"% de desconto:"]}),e.jsxs("span",{children:["R$ ",l.desconto_valor.toFixed(2)]})]}),l.tem_entrega&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsxs("span",{children:["R$ ",(((s=l.entrega)==null?void 0:s.taxa_entrega_total)||0).toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",paddingTop:"10px",borderTop:"1px solid #000",fontSize:"14px",fontWeight:"bold"},children:[e.jsx("span",{children:"TOTAL:"}),e.jsxs("span",{children:["R$ ",l.total.toFixed(2)]})]})]}),l.pagamentos&&l.pagamentos.length>0&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"PAGAMENTOS:"}),l.pagamentos.map((g,F)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"3px"},children:[e.jsx("span",{children:g.forma_pagamento}),e.jsxs("span",{children:["R$ ",g.valor.toFixed(2)]})]},F))]}),l.tem_entrega&&l.entrega&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"ENTREGA:"}),e.jsx("div",{children:l.entrega.endereco_completo}),l.entrega.observacoes_entrega&&e.jsxs("div",{style:{marginTop:"3px",fontStyle:"italic"},children:["Obs: ",l.entrega.observacoes_entrega]})]}),l.observacoes&&e.jsxs("div",{style:{borderTop:"1px dashed #000",marginTop:"10px",paddingTop:"10px",fontSize:"10px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"OBSERVA\\u00c7\\u00d5ES:"}),e.jsx("div",{children:l.observacoes})]}),e.jsxs("div",{style:{textAlign:"center",marginTop:"15px",paddingTop:"10px",borderTop:"1px dashed #000",fontSize:"10px"},children:[e.jsx("div",{children:"Obrigado pela preferencia!"}),e.jsx("div",{style:{marginTop:"5px"},children:"Volte sempre!"})]})]})]}):null}function pr({clienteId:l,clienteNome:N,onClose:c,onSucesso:u}){const[s,g]=r.useState([]),[F,m]=r.useState([]),[b,w]=r.useState(!0),[U,h]=r.useState(!1),[M,$]=r.useState(""),[E,t]=r.useState("dinheiro"),[q,R]=r.useState(""),[Q,se]=r.useState(""),[C,S]=r.useState({total_vendas:0,total_em_aberto:0}),[I,K]=r.useState("antiga");r.useEffect(()=>{D()},[l]);const D=async()=>{try{w(!0);const z=await P.get(`/clientes/${l}/vendas-em-aberto`);g(z.data.vendas||[]),S(z.data.resumo||{total_vendas:0,total_em_aberto:0})}catch(z){console.error("Erro ao carregar vendas em aberto:",z),Ze.error("Erro ao carregar vendas em aberto")}finally{w(!1)}},oe=z=>{m(ne=>ne.includes(z)?ne.filter(ye=>ye!==z):[...ne,z])},le=()=>{F.length===s.length?m([]):m(s.map(z=>z.id))},xe=z=>{const ne=new Date,ye=new Date(z),y=Math.abs(ne-ye);return Math.ceil(y/(1e3*60*60*24))},v=[...s].sort((z,ne)=>I==="antiga"?new Date(z.data_venda)-new Date(ne.data_venda):new Date(ne.data_venda)-new Date(z.data_venda)),H=s.filter(z=>F.includes(z.id)).reduce((z,ne)=>z+parseFloat(ne.saldo_devedor),0),J=async()=>{var z,ne,ye,y;if(F.length===0){Ze.error("Selecione ao menos uma venda");return}if(!M||parseFloat(M)<=0){Ze.error("Informe um valor v√°lido");return}if(parseFloat(M)>H){Ze.error("Valor do pagamento n√£o pode ser maior que o total selecionado");return}try{h(!0),console.log("Enviando requisi√ß√£o:",{vendas_ids:F,valor_total:parseFloat(M),forma_pagamento:E,numero_transacao:q||null,observacoes:Q||null});const X=await P.post(`/clientes/${l}/baixar-vendas-lote`,{vendas_ids:F,valor_total:parseFloat(M),forma_pagamento:E,numero_transacao:q||null,observacoes:Q||null});if(console.log("Resposta completa:",X),console.log("Response.data:",X.data),!X.data)throw new Error("Resposta vazia do servidor");const{vendas_quitadas:ge,vendas_parciais:he,total_vendas_afetadas:ke,valor_total_baixado:Oe}=X.data;let x=`üí∞ Total baixado: R$ ${Oe.toFixed(2)}
`;ge.length>0&&(x+=`
‚úÖ ${ge.length} venda(s) quitada(s):`,ge.forEach(k=>{x+=`
  ‚Ä¢ ${k.numero_venda}: R$ ${k.valor_baixado.toFixed(2)}`})),he.length>0&&(x+=`

‚ö†Ô∏è ${he.length} venda(s) parcial:`,he.forEach(k=>{x+=`
  ‚Ä¢ ${k.numero_venda}:`,x+=`
    Baixado: R$ ${k.valor_baixado.toFixed(2)}`,x+=`
    Falta: R$ ${k.saldo_restante.toFixed(2)}`})),Ze.success(x,{duration:6e3}),u&&u(),c()}catch(X){console.error("Erro completo:",X),console.error("Erro response:",X.response),console.error("Erro response data:",(z=X.response)==null?void 0:z.data),console.error("Erro response status:",(ne=X.response)==null?void 0:ne.status);const ge=((y=(ye=X.response)==null?void 0:ye.data)==null?void 0:y.detail)||X.message||"Erro ao baixar vendas";Ze.error(ge)}finally{h(!1)}};return b?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-8 max-w-4xl w-full mx-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Ta,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando vendas..."})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-red-50 to-orange-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Vendas em Aberto"}),e.jsx("p",{className:"text-gray-600 mt-1",children:N})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Vendas"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:C.total_vendas})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total em Aberto"}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["R$ ",C.total_em_aberto.toFixed(2)]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ha,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-medium text-gray-900",children:"Nenhuma venda em aberto!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Este cliente n√£o possui d√©bitos pendentes."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:le,className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:F.length===s.length?"Desmarcar todas":"Selecionar todas"}),e.jsxs("button",{onClick:()=>K(I==="antiga"?"recente":"antiga"),className:"text-sm text-gray-600 hover:text-gray-700 flex items-center gap-1 font-medium",children:["üìÖ ",I==="antiga"?"‚Üë Mais Antigas":"‚Üì Mais Recentes"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[F.length," de ",s.length," selecionada(s)"]})]}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden mb-6",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:e.jsx("input",{type:"checkbox",checked:F.length===s.length,onChange:le,className:"rounded border-gray-300"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Venda"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Pago"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Saldo Devedor"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Dias"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v.map(z=>{const ne=xe(z.data_venda),ye=ne>30;return e.jsxs("tr",{className:`hover:bg-gray-50 ${F.includes(z.id)?"bg-blue-50":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:F.includes(z.id),onChange:()=>oe(z.id),className:"rounded border-gray-300"})}),e.jsxs("td",{className:"px-4 py-3 font-medium text-gray-900",children:["#",z.numero_venda]}),e.jsx("td",{className:"px-4 py-3 text-gray-600 text-sm",children:new Date(z.data_venda).toLocaleDateString("pt-BR")}),e.jsxs("td",{className:"px-4 py-3 text-right text-gray-900",children:["R$ ",parseFloat(z.total).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right text-green-600",children:["R$ ",parseFloat(z.total_pago).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-red-600",children:["R$ ",parseFloat(z.saldo_devedor).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${ye?"bg-red-100 text-red-800":ne>15?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:[ne," ",ne===1?"dia":"dias"]})})]},z.id)})})]})}),F.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Registrar Pagamento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor Total Selecionado"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["R$ ",H.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor do Pagamento *"}),e.jsx("input",{type:"number",step:"0.01",value:M,onChange:z=>$(z.target.value),placeholder:"0.00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Forma de Pagamento *"}),e.jsxs("select",{value:E,onChange:z=>t(z.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"dinheiro",children:"Dinheiro"}),e.jsx("option",{value:"pix",children:"PIX"}),e.jsx("option",{value:"debito",children:"Cart√£o de D√©bito"}),e.jsx("option",{value:"credito",children:"Cart√£o de Cr√©dito"}),e.jsx("option",{value:"transferencia",children:"Transfer√™ncia"})]})]}),(E==="pix"||E==="transferencia")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"N√∫mero da Transa√ß√£o"}),e.jsx("input",{type:"text",value:q,onChange:z=>R(z.target.value),placeholder:"C√≥digo/ID da transa√ß√£o",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes"}),e.jsx("textarea",{value:Q,onChange:z=>se(z.target.value),rows:"2",placeholder:"Informa√ß√µes adicionais sobre o pagamento...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-start space-x-2 mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(we,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Aten√ß√£o:"})," O valor ser√° aplicado automaticamente da venda mais antiga para a mais recente. Se o valor for insuficiente para quitar todas as vendas selecionadas, a √∫ltima venda ficar√° parcialmente paga."]})]}),e.jsx("button",{onClick:J,disabled:U||!M||parseFloat(M)<=0,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:U?e.jsxs(e.Fragment,{children:[e.jsx(Ta,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ia,{className:"w-5 h-5"}),e.jsx("span",{children:"Baixar Vendas Selecionadas"})]})})]})]})})]})})}function br({clienteId:l,clienteNome:N,onClose:c}){var M,$,E;const[u,s]=r.useState(null),[g,F]=r.useState(!0),[m,b]=r.useState("todos");r.useEffect(()=>{w()},[l]);const w=async()=>{try{F(!0);const t=await P.get(`/clientes/${l}/historico-compras`);s(t.data)}catch(t){console.error("Erro ao carregar hist√≥rico:",t),Ze.error("Erro ao carregar hist√≥rico do cliente")}finally{F(!1)}},U=t=>{const q={finalizada:"bg-green-100 text-green-800",baixa_parcial:"bg-yellow-100 text-yellow-800",pendente:"bg-blue-100 text-blue-800",cancelada:"bg-red-100 text-red-800",finalizada_devolucao_parcial:"bg-orange-100 text-orange-800",finalizada_devolucao_total:"bg-gray-100 text-gray-800"},R={finalizada:"Finalizada",baixa_parcial:"Baixa Parcial",pendente:"Pendente",cancelada:"Cancelada",finalizada_devolucao_parcial:"Dev. Parcial",finalizada_devolucao_total:"Dev. Total"};return e.jsx("span",{className:`inline-flex px-2 py-1 rounded-full text-xs font-medium ${q[t]||"bg-gray-100 text-gray-800"}`,children:R[t]||t})},h=((M=u==null?void 0:u.vendas)==null?void 0:M.filter(t=>m==="todos"?!0:t.status===m))||[];return g?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-8 max-w-4xl w-full mx-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Ta,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Carregando hist√≥rico..."})]})})}):u?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Hist√≥rico de Compras"}),e.jsx("p",{className:"text-gray-600 mt-1",children:N})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-white rounded-lg transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(_s,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total de Compras"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:u.total_compras})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(ia,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Gasto"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",u.valor_total_gasto.toFixed(2)]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(ja,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Ticket M√©dio"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",u.ticket_medio.toFixed(2)]})]})]})})]}),u.ultima_compra&&e.jsxs("div",{className:"mt-4 bg-white rounded-lg p-3 shadow-sm flex items-center space-x-2 text-sm",children:[e.jsx(yt,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-gray-600",children:["√öltima compra: ",new Date(u.ultima_compra).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"})]})]})]}),e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtrar por status:"}),e.jsxs("select",{value:m,onChange:t=>b(t.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500",children:[e.jsxs("option",{value:"todos",children:["Todos (",(($=u.vendas)==null?void 0:$.length)||0,")"]}),e.jsx("option",{value:"finalizada",children:"Finalizadas"}),e.jsx("option",{value:"baixa_parcial",children:"Baixa Parcial"}),e.jsx("option",{value:"pendente",children:"Pendentes"}),e.jsx("option",{value:"cancelada",children:"Canceladas"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:h.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_s,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:"Nenhuma venda encontrada"}),e.jsx("p",{className:"text-gray-600 mt-2",children:m==="todos"?"Este cliente ainda n√£o realizou compras.":"N√£o h√° vendas com este status."})]}):e.jsx("div",{className:"space-y-3",children:h.map(t=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Venda #",t.numero_venda]}),U(t.status)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Data:"}),e.jsx("div",{className:"font-medium text-gray-900",children:new Date(t.data_venda).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal:"}),e.jsxs("div",{className:"font-medium text-gray-900",children:["R$ ",t.subtotal.toFixed(2)]})]}),t.desconto_valor>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Desconto:"}),e.jsxs("div",{className:"font-medium text-red-600",children:["- R$ ",t.desconto_valor.toFixed(2)]})]}),t.taxa_entrega>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Taxa Entrega:"}),e.jsxs("div",{className:"font-medium text-gray-900",children:["R$ ",t.taxa_entrega.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total:"}),e.jsxs("div",{className:"font-bold text-gray-900 text-lg",children:["R$ ",t.total.toFixed(2)]})]}),t.saldo_devedor>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Saldo Devedor:"}),e.jsxs("div",{className:"font-bold text-red-600",children:["R$ ",t.saldo_devedor.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Itens:"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.total_itens})]}),t.vendedor_nome&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Vendedor:"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.vendedor_nome})]})]})]})})},t.id))})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[e.jsxs("span",{children:["Mostrando ",h.length," de ",((E=u.vendas)==null?void 0:E.length)||0," vendas"]}),e.jsx("button",{onClick:c,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:"Fechar"})]})})]})}):null}function hr({clienteId:l}){const[N,c]=r.useState(!1),[u,s]=r.useState(null),[g,F]=r.useState(null),[m,b]=r.useState(""),[w,U]=r.useState([]),[h,M]=r.useState(!1),$=r.useRef(null),[E,t]=r.useState({resumo:!1,pets:!1,compras:!1,oportunidades:!1,sugestoes:!1,relacionados:!1,sazonalidade:!1,chat:!1});r.useEffect(()=>{l&&q()},[l]);const q=async()=>{var v,H;try{c(!0),F(null);const J=await P.get(`/clientes/${l}/info-pdv`);s(J.data)}catch(J){console.error("Erro ao carregar informa√ß√µes do cliente:",J),F(((H=(v=J.response)==null?void 0:v.data)==null?void 0:H.detail)||"Erro ao carregar dados")}finally{c(!1)}},R=v=>{t(H=>({...H,[v]:!H[v]}))},Q=async()=>{if(!m.trim())return;const v=m;b(""),U(H=>[...H,{tipo:"user",texto:v}]);try{M(!0);const H=await P.post(`/clientes/${l}/chat-pdv`,{mensagem:v});U(J=>[...J,{tipo:"ia",texto:H.data.resposta,ia_disponivel:H.data.ia_disponivel}]),setTimeout(()=>{var J;return(J=$.current)==null?void 0:J.scrollIntoView({behavior:"smooth"})},100)}catch(H){console.error("Erro no chat:",H),U(J=>[...J,{tipo:"erro",texto:"Erro ao processar mensagem. Tente novamente."}])}finally{M(!1)}},se=v=>{v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),Q())};if(!l)return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 text-center text-gray-500",children:[e.jsx(Da,{className:"mx-auto text-4xl mb-2"}),e.jsx("p",{children:"Selecione um cliente para ver informa√ß√µes"})]});if(N)return e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})});if(g)return e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:[e.jsx(la,{className:"inline mr-2"}),g]});if(!u)return null;const{cliente:C,resumo_financeiro:S,pets:I,ultimas_compras:K,oportunidades:D,sugestoes:oe,produtos_relacionados:le,padroes_sazonais:xe}=u;return e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden max-h-[85vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-100 to-purple-100 p-4 border-b",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 mb-1",children:C.nome}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[C.cpf_cnpj&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(Da,{className:"text-xs"}),C.cpf_cnpj]}),C.telefone&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(Nt,{className:"text-xs"}),C.telefone]}),C.email&&e.jsxs("p",{className:"flex items-center gap-1 truncate",children:[e.jsx(wt,{className:"text-xs"}),C.email]}),C.endereco&&e.jsxs("p",{className:"flex items-center gap-1 text-xs",children:[e.jsx(_t,{className:"text-xs"}),C.endereco,", ",C.bairro," - ",C.cidade,"/",C.estado]})]})]})})}),e.jsxs(Ue,{titulo:"Resumo Financeiro",icone:e.jsx(As,{}),expandido:E.resumo,onToggle:()=>R("resumo"),badge:S.numero_compras,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:"Total Gasto"}),e.jsxs("p",{className:"text-lg font-bold text-green-700",children:["R$ ",S.total_gasto.toFixed(2)]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"Ticket M√©dio"}),e.jsxs("p",{className:"text-lg font-bold text-blue-700",children:["R$ ",S.ticket_medio.toFixed(2)]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-purple-600 font-medium mb-1",children:"N¬∫ Compras"}),e.jsx("p",{className:"text-lg font-bold text-purple-700",children:S.numero_compras})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-orange-600 font-medium mb-1",children:"Maior Compra"}),e.jsxs("p",{className:"text-lg font-bold text-orange-700",children:["R$ ",S.maior_compra.valor.toFixed(2)]}),S.maior_compra.data&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:S.maior_compra.data})]})]}),S.ultima_compra.data&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(Ct,{className:"text-xs"}),"√öltima compra: ",S.ultima_compra.data," - R$ ",S.ultima_compra.valor.toFixed(2)]})})]}),I&&I.length>0&&e.jsx(Ue,{titulo:"Pets Registrados",icone:e.jsx(Da,{}),expandido:E.pets,onToggle:()=>R("pets"),badge:I.length,children:e.jsx("div",{className:"space-y-2",children:I.map(v=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold",children:v.nome[0].toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800",children:v.nome}),e.jsxs("p",{className:"text-xs text-gray-500",children:[v.especie," ",v.raca&&`‚Ä¢ ${v.raca}`,v.peso&&` ‚Ä¢ ${v.peso}kg`,v.idade_anos!==null&&` ‚Ä¢ ${v.idade_anos} anos`]})]})]},v.id))})}),D&&D.length>0&&e.jsx(Ue,{titulo:"Oportunidades de Venda",icone:e.jsx(la,{}),expandido:E.oportunidades,onToggle:()=>R("oportunidades"),badge:D.length,badgeColor:"bg-orange-500",children:e.jsx("div",{className:"space-y-2",children:D.map((v,H)=>e.jsxs("div",{className:`p-3 rounded-lg border-l-4 ${v.urgencia==="alta"?"bg-red-50 border-red-400":"bg-yellow-50 border-yellow-400"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:v.produto_nome}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:v.mensagem})]}),v.urgencia==="alta"&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-red-500 text-white text-xs rounded-full",children:"Urgente"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Atrasado ",v.dias_atraso," dias"]})]},H))})}),oe&&oe.length>0&&e.jsx(Ue,{titulo:"Produtos Favoritos",icone:e.jsx(Ft,{}),expandido:E.sugestoes,onToggle:()=>R("sugestoes"),badge:oe.length,children:e.jsx("div",{className:"space-y-2",children:oe.map((v,H)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:v.nome}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Comprado ",v.vezes_comprado,"x",v.ultima_compra&&` ‚Ä¢ √öltima: ${v.ultima_compra}`]})]}),e.jsxs("p",{className:"font-bold text-indigo-600 ml-2",children:["R$ ",v.preco.toFixed(2)]})]},H))})}),K&&K.length>0&&e.jsx(Ue,{titulo:"√öltimas Compras",icone:e.jsx(kt,{}),expandido:E.compras,onToggle:()=>R("compras"),badge:K.length,children:e.jsx("div",{className:"space-y-3",children:K.map((v,H)=>e.jsxs("div",{className:"border-l-4 border-indigo-300 pl-3 py-2 bg-gray-50 rounded-r-lg",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500",children:[v.data," ‚Ä¢ Venda #",v.numero_venda]}),e.jsxs("p",{className:"font-bold text-indigo-600",children:["R$ ",v.valor_total.toFixed(2)]})]})}),v.produtos&&v.produtos.length>0&&e.jsx("div",{className:"space-y-1 mt-2",children:v.produtos.map((J,z)=>e.jsxs("p",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(St,{className:"text-xs"}),J.quantidade,"x ",J.nome," - R$ ",J.valor.toFixed(2)]},z))})]},H))})}),le&&le.length>0&&e.jsx(Ue,{titulo:"Produtos Comprados Juntos",icone:e.jsx($t,{}),expandido:E.relacionados,onToggle:()=>R("relacionados"),badge:le.length,badgeColor:"bg-purple-500",children:e.jsx("div",{className:"space-y-2",children:le.map((v,H)=>e.jsxs("div",{className:"p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("span",{className:"text-xs font-semibold text-purple-600",children:[v.vezes_juntos,"x comprados juntos"]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-800",children:v.produto1.nome}),e.jsxs("span",{className:"text-purple-600 font-bold",children:["R$ ",v.produto1.preco.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-800",children:v.produto2.nome}),e.jsxs("span",{className:"text-purple-600 font-bold",children:["R$ ",v.produto2.preco.toFixed(2)]})]})]}),e.jsx("p",{className:"text-xs text-purple-600 mt-2 italic",children:"üí° Sugest√£o: Oferecer combo!"})]},H))})}),xe&&xe.length>0&&e.jsx(Ue,{titulo:"Padr√µes de Compra",icone:e.jsx(Pa,{}),expandido:E.sazonalidade,onToggle:()=>R("sazonalidade"),badge:xe.length,badgeColor:"bg-green-500",children:e.jsx("div",{className:"space-y-2",children:xe.map((v,H)=>e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-green-700",children:v.mes_ano}),e.jsxs("span",{className:"text-sm text-green-600",children:[v.numero_compras," compras"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"font-bold text-green-700 ml-1",children:["R$ ",v.total_gasto.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Ticket m√©dio:"}),e.jsxs("span",{className:"font-bold text-green-700 ml-1",children:["R$ ",v.ticket_medio.toFixed(2)]})]})]})]},H))})}),e.jsx(Ue,{titulo:"Chat IA - Assistente de Vendas",icone:e.jsx(Rt,{}),expandido:E.chat,onToggle:()=>R("chat"),badgeColor:"bg-blue-500",children:e.jsxs("div",{className:"space-y-3",children:[w.length===0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Perguntas sugeridas:"}),["Quais os produtos favoritos?","Quando foi a √∫ltima compra?","Quais pets ele tem?","Quanto j√° gastou total?"].map((v,H)=>e.jsx("button",{onClick:()=>{b(v),setTimeout(()=>Q(),100)},className:"w-full text-left px-3 py-2 text-xs bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition-colors",children:v},H))]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto space-y-2",children:[w.map((v,H)=>e.jsx("div",{className:`flex ${v.tipo==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] px-3 py-2 rounded-lg text-sm ${v.tipo==="user"?"bg-blue-600 text-white":v.tipo==="erro"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-800"}`,children:[v.texto,v.tipo==="ia"&&!v.ia_disponivel&&e.jsx("p",{className:"text-xs mt-1 opacity-70",children:"üí° Modo b√°sico (IA n√£o configurada)"})]})},H)),e.jsx("div",{ref:$})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:m,onChange:v=>b(v.target.value),onKeyPress:se,placeholder:"Digite sua pergunta...",disabled:h,className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"}),e.jsx("button",{onClick:Q,disabled:h||!m.trim(),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Et,{className:"w-4 h-4"})})]})]})})]})}function Ue({titulo:l,icone:N,expandido:c,onToggle:u,badge:s,badgeColor:g="bg-indigo-500",children:F}){return e.jsxs("div",{className:"border-b border-gray-200",children:[e.jsxs("button",{onClick:u,className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-indigo-600",children:N}),e.jsx("h4",{className:"font-semibold text-gray-800",children:l}),s!==void 0&&e.jsx("span",{className:`${g} text-white text-xs px-2 py-1 rounded-full`,children:s})]}),c?e.jsx(Dt,{className:"text-gray-400"}):e.jsx(At,{className:"text-gray-400"})]}),c&&e.jsx("div",{className:"px-4 pb-4",children:F})]})}const fr=({mostrar:l,onFechar:N,dados:c,carregando:u})=>{if(r.useEffect(()=>{const m=b=>{b.key==="Escape"&&l&&N()};if(l)return window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)},[l,N]),!l)return null;const s=m=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(m||0),g=m=>{switch(m){case"verde":return"bg-green-100 border-green-500 text-green-800";case"amarelo":return"bg-yellow-100 border-yellow-500 text-yellow-800";case"vermelho":return"bg-red-100 border-red-500 text-red-800";default:return"bg-gray-100 border-gray-500 text-gray-800"}},F=m=>{switch(m){case"success":return e.jsx(Mt,{className:"text-green-500"});case"error":return e.jsx(la,{className:"text-red-500"});case"warning":return e.jsx(la,{className:"text-yellow-500"});case"info":return e.jsx(Cs,{className:"text-blue-500"});default:return e.jsx(Cs,{className:"text-gray-500"})}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:N}),e.jsxs("div",{className:"fixed right-0 top-0 h-full w-96 bg-white shadow-2xl z-50 flex flex-col animate-slide-in-right",children:[e.jsxs("div",{className:"p-4 border-b bg-gradient-to-r from-blue-600 to-blue-700 text-white flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pa,{className:"w-5 h-5"}),e.jsx("h3",{className:"text-lg font-bold",children:"An√°lise da Venda"})]}),e.jsx("button",{onClick:N,className:"hover:bg-white hover:bg-opacity-20 p-1 rounded transition-colors",children:e.jsx(Tt,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:u?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(As,{className:"text-blue-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"Composi√ß√£o Financeira"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Valor Total dos Produtos"}),e.jsx("span",{className:"font-semibold",children:s(c.composicao.total_produtos)})]}),c.composicao.desconto>0&&e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"(-) Descontos Aplicados"}),e.jsxs("span",{className:"font-semibold",children:[s(c.composicao.desconto),e.jsxs("span",{className:"text-xs ml-1",children:["(",(c.composicao.desconto/c.composicao.total_produtos*100).toFixed(1),"%)"]})]})]}),c.composicao.taxa_entrega>0&&e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"(-) Taxa de Entrega"}),e.jsx("span",{className:"font-semibold",children:s(c.composicao.taxa_entrega)})]}),e.jsx("div",{className:"border-t-2 border-blue-600 pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-blue-700",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:s(c.composicao.subtotal)})]})})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Pt,{className:"text-orange-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"Dedu√ß√µes"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[c.deducoes.comissao.valor>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Comiss√£o do Vendedor (",c.deducoes.comissao.percentual,"%)"]}),e.jsx("span",{className:"font-semibold text-red-600",children:s(c.deducoes.comissao.valor)})]}),c.detalhamento_taxas&&c.detalhamento_taxas.length>0&&e.jsx(e.Fragment,{children:c.detalhamento_taxas.map((m,b)=>e.jsxs(Vt.Fragment,{children:[m.taxa_percentual>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-600",children:["Taxa ",m.forma," (",m.taxa_percentual,"%)"]}),e.jsx("span",{className:"text-xs text-gray-500",children:s(m.valor_pagamento)})]}),e.jsx("span",{className:"font-semibold text-red-600",children:s(m.valor_taxa_percentual)})]}),m.taxa_fixa>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-600",children:["Taxa Fixa ",m.forma]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["R$ ",m.taxa_fixa.toFixed(2)]})]}),e.jsx("span",{className:"font-semibold text-red-600",children:s(m.valor_taxa_fixa)})]})]},b))}),(!c.detalhamento_taxas||c.detalhamento_taxas.length===0)&&c.deducoes.taxa_percentual>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Taxa Percentual"}),e.jsx("span",{className:"font-semibold text-red-600",children:s(c.deducoes.taxa_percentual)})]}),(!c.detalhamento_taxas||c.detalhamento_taxas.length===0)&&c.deducoes.taxa_fixa>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Taxa Fixa"}),e.jsx("span",{className:"font-semibold text-red-600",children:s(c.deducoes.taxa_fixa)})]}),c.deducoes.impostos.valor>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Impostos Estimados (",c.deducoes.impostos.percentual,"%)"]}),e.jsx("span",{className:"font-semibold text-red-600",children:s(c.deducoes.impostos.valor)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Custo dos Produtos"}),e.jsx("span",{className:"font-semibold text-red-600",children:s(c.deducoes.custos)})]}),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-semibold text-gray-700",children:[e.jsx("span",{children:"Total de Dedu√ß√µes"}),e.jsx("span",{className:"text-red-600",children:s(c.deducoes.total_deducoes)})]})})]})]}),e.jsxs("div",{className:`rounded-lg p-4 border-2 ${g(c.resultado.cor_indicador)}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Pa,{className:"w-5 h-5"}),e.jsx("h4",{className:"font-bold",children:"Resultado Final"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold",children:"Lucro L√≠quido Estimado"}),e.jsx("span",{className:"text-2xl font-bold",children:s(c.resultado.lucro_liquido)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Margem L√≠quida"}),e.jsxs("span",{className:"text-xl font-bold",children:[c.resultado.margem_liquida.toFixed(2),"%"]})]})]})]}),c.alertas&&c.alertas.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(la,{className:"text-purple-600"}),e.jsx("h4",{className:"font-bold text-gray-700",children:"Alertas e Sugest√µes"})]}),e.jsx("div",{className:"space-y-2",children:c.alertas.map((m,b)=>e.jsxs("div",{className:`flex items-start gap-2 p-2 rounded text-sm ${m.tipo==="success"?"bg-green-50":m.tipo==="error"?"bg-red-50":m.tipo==="warning"?"bg-yellow-50":"bg-blue-50"}`,children:[e.jsx("span",{className:"flex-shrink-0 mt-0.5",children:F(m.tipo)}),e.jsxs("span",{className:"flex-1",children:[e.jsx("span",{className:"mr-1",children:m.icone}),m.mensagem]})]},b))})]}),c.detalhamento_comissoes&&c.detalhamento_comissoes.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-3",children:"Detalhamento de Comiss√µes"}),e.jsx("div",{className:"space-y-2 text-sm",children:c.detalhamento_comissoes.map((m,b)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-700",children:m.produto}),e.jsxs("div",{className:"text-xs text-gray-500",children:[m.percentual,"% de comiss√£o"]})]}),e.jsx("span",{className:"font-semibold text-blue-600",children:s(m.valor)})]},b))})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(la,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"Erro ao carregar an√°lise"})]})})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("button",{onClick:N,className:"w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{children:"Fechar"}),e.jsx("span",{className:"text-xs text-gray-300",children:"(ESC)"})]})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes slide-in-right {
          from {
            transform: translateX(100%);
          }
          to {
            transform: translateX(0);
          }
        }
        
        .animate-slide-in-right {
          animation: slide-in-right 0.3s ease-out;
        }
      `})]})};function jr({itensCarrinho:l=[],onClose:N=()=>{},isOpen:c=!1,racaoIdFechada:u=null}){const[s,g]=r.useState(null),[F,m]=r.useState(!1),[b,w]=r.useState(null),[U,h]=r.useState(null),[M,$]=r.useState(!1),E=l.filter(R=>Ht(R));r.useEffect(()=>{c&&(console.log("ü•´ Modal: Ra√ß√µes encontradas:",E.length),E.forEach((R,Q)=>{console.log(`  ${Q+1}. ${R.produto_nome} - peso_embalagem: ${R.peso_embalagem}`)}))},[c,E.length]),r.useEffect(()=>{if(c&&E.length>0){const R=E[E.length-1];u!==R.produto_id&&(g(R.produto_id),w(null),h(null),m(!1))}},[c,E.length,u]);const t=E.find(R=>R.produto_id===s),q=async()=>{if(!t){h("Ra√ß√£o n√£o selecionada");return}if(!(t.peso_embalagem||t.peso_pacote_kg)||!t.preco_unitario){console.error("‚ùå Modal: Dados da ra√ß√£o incompletos",{peso_embalagem:t.peso_embalagem,peso_pacote_kg:t.peso_pacote_kg,preco_unitario:t.preco_unitario}),h("Dados da ra√ß√£o incompletos");return}try{m(!0),h(null),w(null);const Q=t.peso_embalagem||t.peso_pacote_kg||1,se={especie:"cao",peso_kg:15,fase:"adulto",porte:"medio",tipo_racao:"premium",peso_pacote_kg:parseFloat(Q),preco_pacote:parseFloat(t.preco_unitario)||0};console.log("üßë Modal: Enviando payload:",se);const C=await P.post("/internal/racao/calcular",se);C.data?w(C.data):h("Sem resposta do servidor")}catch(Q){console.error("Erro ao calcular:",Q),h(null)}finally{m(!1)}};return!c||E.length===0?(c&&E.length===0&&console.warn("‚ö†Ô∏è Modal: isOpen=true mas racoes.length=0"),null):(console.log("‚úÖ Modal: Renderizando com",E.length,"ra√ß√µes"),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-4 flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ü•´"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Calculadora de Ra√ß√£o"}),e.jsx("p",{className:"text-sm text-blue-100",children:"Informa√ß√µes r√°pidas"})]})]}),e.jsx("button",{onClick:()=>{N()},className:"p-1 hover:bg-blue-400 rounded-lg transition-colors",title:"Fechar",children:e.jsx(ue,{size:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[E.length>1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Selecionar Ra√ß√£o"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>$(!M),className:"w-full px-4 py-2 bg-white border border-gray-300 rounded-lg text-left flex items-center justify-between hover:border-blue-500 transition-colors",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:(t==null?void 0:t.produto_nome)||"Selecione uma ra√ß√£o"}),e.jsx(Va,{size:20,className:`text-gray-500 transition-transform ${M?"rotate-180":""}`})]}),M&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg z-10 max-h-48 overflow-y-auto",children:E.map((R,Q)=>e.jsxs("button",{onClick:()=>{g(R.produto_id),$(!1),w(null)},className:`w-full px-4 py-3 text-left border-b last:border-b-0 hover:bg-blue-50 transition-colors ${R.produto_id===s?"bg-blue-100 border-l-4 border-l-blue-600":""}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:R.produto_nome}),e.jsxs("div",{className:"text-xs text-gray-500",children:[R.peso_embalagem||R.peso_pacote_kg?`${R.peso_embalagem||R.peso_pacote_kg}kg`:""," ‚Ä¢ R$ ",(R.preco_unitario||0).toFixed(2)]})]},Q))})]})]}),t&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 space-y-2",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:t.produto_nome}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Pacote:"}),e.jsx("span",{className:"font-medium",children:t.peso_pacote_kg?`${t.peso_pacote_kg}kg`:"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Pre√ßo:"}),e.jsxs("span",{className:"font-medium text-blue-600",children:["R$ ",(t.preco_unitario||0).toFixed(2)]})]})]})]}),e.jsx("button",{onClick:q,disabled:F||!t,className:`w-full py-3 rounded-lg font-semibold transition-colors ${F||!t?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white cursor-pointer"}`,children:F?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(It,{size:18,className:"animate-spin"}),"Calculando..."]}):"üìä Calcular Consumo"}),b&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 space-y-3 border border-green-200",children:[e.jsx("h3",{className:"font-bold text-green-900 text-center",children:"‚úÖ C√°lculo Realizado"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Consumo Di√°rio"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:[(b.consumo_diario_gramas||0).toFixed(0),"g"]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Dura√ß√£o"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:[(b.duracao_pacote_dias||0).toFixed(1),"d"]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/Dia"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(b.custo_diario||0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/M√™s"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(b.custo_mensal||0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded p-3 border border-green-100 col-span-2",children:[e.jsx("div",{className:"text-gray-600 text-xs font-semibold",children:"Custo/kg"}),e.jsxs("div",{className:"text-lg font-bold text-green-700",children:["R$ ",(b.custo_por_kg||0).toFixed(2)]})]})]})]}),U&&e.jsx("div",{className:"bg-yellow-50 rounded-lg p-3 text-sm text-yellow-700 border border-yellow-200",children:"‚ö†Ô∏è N√£o foi poss√≠vel calcular. Tente novamente."}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 text-xs text-gray-600 border border-gray-200 italic",children:"üí° Valores calculados com base em dados padr√£o. Para an√°lises personalizadas, utilize a calculadora completa."})]}),e.jsx("div",{className:"bg-gray-50 border-t px-6 py-3 flex justify-end gap-3 flex-shrink-0",children:e.jsx("button",{onClick:N,className:"px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-medium transition-colors",children:"Fechar"})})]})}))}function vr({isOpen:l,onClose:N,clienteId:c,produtoId:u=null,onPendenciaAdicionada:s=()=>{}}){const[g,F]=r.useState("listar"),[m,b]=r.useState([]),[w,U]=r.useState([]),[h,M]=r.useState(!1),[$,E]=r.useState(""),[t,q]=r.useState([]),[R,Q]=r.useState(!1),[se,C]=r.useState(null),S=r.useRef(null),[I,K]=r.useState({produto_id:u||"",quantidade_desejada:1,prioridade:"media",observacoes:""});r.useEffect(()=>{l&&c&&(D(),u||oe())},[l,c]),r.useEffect(()=>{if($.trim()==="")q(w);else{const y=w.filter(X=>{var ge;return X.nome.toLowerCase().includes($.toLowerCase())||((ge=X.codigo)==null?void 0:ge.toLowerCase().includes($.toLowerCase()))});q(y)}},[$,w]),r.useEffect(()=>{const y=X=>{S.current&&!S.current.contains(X.target)&&Q(!1)};return document.addEventListener("mousedown",y),()=>{document.removeEventListener("mousedown",y)}},[]);const D=async()=>{try{M(!0);const X=(await P.get(`/pendencias-estoque/cliente/${c}`)).data;b(Array.isArray(X==null?void 0:X.pendencias)?X.pendencias:[])}catch(y){console.error("Erro ao carregar pend√™ncias:",y),Ae.error("Erro ao carregar lista de espera"),b([])}finally{M(!1)}},oe=async()=>{var y;try{const X=await P.get("/produtos/",{params:{page:1,page_size:1e3,ativo:!0}}),ge=Array.isArray((y=X.data)==null?void 0:y.items)?X.data.items:[];console.log("Produtos carregados:",ge.length,ge),U(ge),q(ge)}catch(X){console.error("Erro ao carregar produtos:",X),Ae.error("Erro ao carregar produtos"),U([]),q([])}},le=y=>{C(y),E(y.nome),K({...I,produto_id:y.id}),Q(!1)},xe=()=>{C(null),E(""),K({...I,produto_id:""}),q(w)},v=async()=>{var X,ge;if(!I.produto_id){Ae.error("Selecione um produto");return}const y={baixa:0,media:1,alta:2};try{M(!0),await P.post("/pendencias-estoque/",{cliente_id:c,produto_id:parseInt(I.produto_id),quantidade_desejada:parseFloat(I.quantidade_desejada),prioridade:y[I.prioridade]||1,observacoes:I.observacoes||null}),Ae.success("Cliente adicionado √† lista de espera!"),K({produto_id:"",quantidade_desejada:1,prioridade:"media",observacoes:""}),xe(),F("listar"),D(),s()}catch(he){console.error("Erro ao adicionar pend√™ncia:",he),Ae.error(((ge=(X=he.response)==null?void 0:X.data)==null?void 0:ge.detail)||"Erro ao adicionar √† lista de espera")}finally{M(!1)}},H=async y=>{if(confirm("Deseja realmente cancelar esta pend√™ncia?"))try{await P.delete(`/pendencias-estoque/${y}`),Ae.success("Pend√™ncia cancelada"),D()}catch(X){console.error("Erro ao cancelar pend√™ncia:",X),Ae.error("Erro ao cancelar pend√™ncia")}},J=async(y,X)=>{try{await P.put(`/pendencias-estoque/${y}`,{prioridade:parseInt(X)}),Ae.success("Prioridade atualizada"),D()}catch(ge){console.error("Erro ao alterar prioridade:",ge),Ae.error("Erro ao alterar prioridade")}};if(!l)return null;const z=y=>{switch(y){case 2:return"text-red-600 bg-red-50";case 1:return"text-yellow-600 bg-yellow-50";case 0:return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},ne=y=>{switch(y){case 2:return"ALTA";case 1:return"M√âDIA";case 0:return"BAIXA";default:return"N/A"}},ye=y=>{switch(y){case"pendente":return e.jsx(Ma,{className:"w-4 h-4 text-yellow-500"});case"notificado":return e.jsx(Ts,{className:"w-4 h-4 text-blue-500"});case"finalizado":return e.jsx(ha,{className:"w-4 h-4 text-green-500"});default:return e.jsx(we,{className:"w-4 h-4 text-gray-500"})}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-blue-50 to-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(we,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Lista de Espera - Produtos Sem Estoque"})]}),e.jsx("button",{onClick:N,className:"text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-200 transition-colors",children:e.jsx(ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex border-b",children:[e.jsxs("button",{onClick:()=>F("listar"),className:`flex-1 px-4 py-3 font-medium transition-colors ${g==="listar"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:bg-gray-50"}`,children:["Lista de Espera (",m.length,")"]}),e.jsx("button",{onClick:()=>F("adicionar"),className:`flex-1 px-4 py-3 font-medium transition-colors ${g==="adicionar"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:bg-gray-50"}`,children:"Adicionar Pend√™ncia"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:g==="listar"?e.jsx("div",{className:"space-y-3",children:h?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Carregando..."}):m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(we,{className:"w-16 h-16 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Nenhuma pend√™ncia registrada"}),e.jsx("button",{onClick:()=>F("adicionar"),className:"mt-4 text-blue-600 hover:text-blue-700 font-medium",children:"Adicionar primeira pend√™ncia"})]}):m.map(y=>e.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[ye(y.status),e.jsx("h3",{className:"font-semibold text-gray-900",children:y.produto_nome||"Produto n√£o encontrado"}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${z(y.prioridade)}`,children:ne(y.prioridade)})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[y.produto_codigo&&e.jsxs("p",{children:["C√≥digo: ",e.jsx("span",{className:"font-medium",children:y.produto_codigo})]}),e.jsxs("p",{children:["Quantidade: ",y.quantidade_desejada," un."]}),y.valor_referencia&&e.jsxs("p",{children:["Valor ref.: R$ ",parseFloat(y.valor_referencia).toFixed(2)]}),e.jsxs("p",{children:["Status: ",e.jsx("span",{className:"font-medium",children:y.status})]}),e.jsxs("p",{children:["Registrado em: ",new Date(y.data_registro).toLocaleDateString("pt-BR")]}),y.data_notificacao&&e.jsxs("p",{children:["Notificado em: ",new Date(y.data_notificacao).toLocaleDateString("pt-BR")]}),y.observacoes&&e.jsxs("p",{className:"italic",children:["Obs: ",y.observacoes]})]})]}),e.jsx("div",{className:"flex flex-col gap-2 ml-4",children:y.status==="pendente"&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:y.prioridade,onChange:X=>J(y.id,X.target.value),className:"text-xs border rounded px-2 py-1",children:[e.jsx("option",{value:"0",children:"Baixa"}),e.jsx("option",{value:"1",children:"M√©dia"}),e.jsx("option",{value:"2",children:"Alta"})]}),e.jsx("button",{onClick:()=>H(y.id),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Cancelar pend√™ncia",children:e.jsx(Ca,{className:"w-4 h-4"})})]})})]})},y.id))}):e.jsxs("div",{className:"space-y-4 max-w-lg mx-auto",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Produto *"}),u?e.jsx("input",{type:"text",value:"Produto selecionado",disabled:!0,className:"w-full px-3 py-2 border rounded-lg bg-gray-50"}):e.jsxs("div",{ref:S,className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_a,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",value:$,onChange:y=>E(y.target.value),onFocus:()=>Q(!0),placeholder:"Digite para buscar o produto...",className:"w-full pl-10 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),$&&e.jsx("button",{type:"button",onClick:xe,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(ue,{className:"w-4 h-4"})})]}),R&&t.length>0&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[t.slice(0,50).map(y=>e.jsxs("button",{type:"button",onClick:()=>le(y),className:"w-full px-4 py-3 text-left hover:bg-blue-50 border-b last:border-b-0 transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900",children:y.nome}),e.jsxs("div",{className:"text-sm text-gray-500",children:[y.codigo&&`C√≥digo: ${y.codigo} ‚Ä¢ `,"Estoque: ",y.estoque_atual||0,y.preco_venda&&` ‚Ä¢ R$ ${parseFloat(y.preco_venda).toFixed(2)}`]})]},y.id)),t.length>50&&e.jsxs("div",{className:"px-4 py-2 text-sm text-gray-500 text-center bg-gray-50",children:["Mostrando 50 de ",t.length," produtos. Continue digitando para refinar."]})]}),R&&$&&t.length===0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg p-4",children:e.jsx("p",{className:"text-gray-500 text-center",children:"Nenhum produto encontrado"})}),se&&e.jsx("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"‚úì Produto selecionado"}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:se.nome})]})})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantidade Desejada *"}),e.jsx("input",{type:"number",min:"1",value:I.quantidade_desejada,onChange:y=>K({...I,quantidade_desejada:parseInt(y.target.value)||1}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prioridade"}),e.jsxs("select",{value:I.prioridade,onChange:y=>K({...I,prioridade:y.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"baixa",children:"Baixa - N√£o tem pressa"}),e.jsx("option",{value:"media",children:"M√©dia - Normal"}),e.jsx("option",{value:"alta",children:"Alta - Urgente"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes"}),e.jsx("textarea",{value:I.observacoes,onChange:y=>K({...I,observacoes:y.target.value}),rows:"3",placeholder:"Ex: Cliente pediu para avisar assim que chegar...",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"üì≤ O cliente ser√° notificado automaticamente via WhatsApp"})," quando o produto entrar no estoque."]})}),e.jsx("button",{onClick:v,disabled:h,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition-colors",children:h?"Adicionando...":"Adicionar √† Lista de Espera"})]})})]})})}function Es(l){return l?l.variation_attributes&&typeof l.variation_attributes=="object"?Object.entries(l.variation_attributes).map(([c,u])=>`${c.charAt(0).toUpperCase()+c.slice(1)}: ${u}`).join(" | "):l.variation_signature?l.variation_signature.split("|").map(c=>{const[u,s]=c.split(":");return u&&s?`${u.charAt(0).toUpperCase()+u.slice(1)}: ${s}`:c}).join(" | "):"":""}function kr(){var ts,rs,os,ns,ls,is,ds,cs,xs;const l=qt(),[N]=zt(),{user:c}=Jt(),u=(c==null?void 0:c.is_admin)===!0,[s,g]=r.useState({cliente:null,pet:null,itens:[],subtotal:0,desconto_valor:0,desconto_percentual:0,total:0,observacoes:"",funcionario_id:null,entregador_id:null,tem_entrega:!1,entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}}),[F,m]=r.useState(""),[b,w]=r.useState(""),[U,h]=r.useState([]),[M,$]=r.useState([]),[E,t]=r.useState(!1),[q,R]=r.useState(!1),[Q,se]=r.useState(!1),[C,S]=r.useState(!1),[I,K]=r.useState(!1),[D,oe]=r.useState(!1),[le,xe]=r.useState(0),[v,H]=r.useState(null),[J,z]=r.useState([]),[ne,ye]=r.useState("24h"),[y,X]=r.useState("todas"),[ge,he]=r.useState(!1),[ke,Oe]=r.useState(""),[x,k]=r.useState(!1),[_,V]=r.useState(!1),[te,T]=r.useState(""),[fe,me]=r.useState(0),[re,ie]=r.useState(!1),[Pe,Ee]=r.useState(!1),[ee,Ne]=r.useState(null),[Fe,Te]=r.useState(!1),[da,He]=r.useState(!1),[O,Re]=r.useState(null),[Sa,aa]=r.useState(!1),[Je,sa]=r.useState("valor"),[Le,ta]=r.useState(0),[n,f]=r.useState(!1),[j,L]=r.useState(null),[de,W]=r.useState([]),[ce,De]=r.useState(""),[Se,be]=r.useState(null),[$e,je]=r.useState([]),[Y,Ve]=r.useState(null),[ca,Me]=r.useState(0);r.useEffect(()=>{g(a=>({...a,funcionario_id:(j==null?void 0:j.id)||null}))},[j]),r.useEffect(()=>{console.log("üîÑ Sincronizando entregador_id:",(Y==null?void 0:Y.id)||null),g(a=>({...a,entregador_id:(Y==null?void 0:Y.id)||null}))},[Y]);const[za,ka]=r.useState(!1),[Ms,Is]=r.useState(null),[qs,Oa]=r.useState(!1),[zs,Os]=r.useState({}),[Be,La]=r.useState(()=>{const a=localStorage.getItem("pdv_painel_vendas_aberto");return a?JSON.parse(a):!1}),[Ge,Ls]=r.useState(()=>{const a=localStorage.getItem("pdv_painel_cliente_aberto");return a?JSON.parse(a):!1}),[Bs,Ba]=r.useState(!1),[ra,xa]=r.useState([]),[Nr,Ka]=r.useState({}),[Qa,Ua]=r.useState(0),[Ha,Ks]=r.useState(!1),[Qs,Us]=r.useState(null),Ja=r.useRef(null);r.useEffect(()=>{localStorage.setItem("pdv_painel_vendas_aberto",JSON.stringify(Be))},[Be]),r.useEffect(()=>{s.cliente&&Xa()},[s.cliente]),r.useEffect(()=>{var a;s.itens&&s.itens.length>0?sessionStorage.setItem("pdv_calculadora_data",JSON.stringify({itens:s.itens,clienteId:((a=s.cliente)==null?void 0:a.id)||null})):sessionStorage.removeItem("pdv_calculadora_data")},[s.itens,s.cliente]),r.useEffect(()=>{localStorage.setItem("pdv_painel_cliente_aberto",JSON.stringify(Ge))},[Ge]),r.useEffect(()=>{Ga();const a=setInterval(()=>{Ga()},3e4);return()=>clearInterval(a)},[fe]);const Ga=async()=>{try{const a=await P.get("/caixas/aberto");ie(!!a.data)}catch{ie(!1)}};r.useEffect(()=>{Hs()},[]);const Hs=async()=>{try{const a=await P.get("/clientes/",{params:{is_entregador:!0,incluir_inativos:!1,limit:100}});let o=a.data.items||a.data.clientes||a.data||[];Array.isArray(o)||(console.error("‚ùå Resposta da API n√£o √© um array:",o),o=[]),je(o);const i=o.find(d=>d.entregador_padrao===!0);i&&(Ve(i),g(d=>({...d,entregador_id:i.id})),ma(i))}catch(a){console.error("Erro ao carregar entregadores:",a),Ae.error("Erro ao carregar lista de entregadores")}},ma=async a=>{if(!a){Me(0);return}let o=0;if(a.modelo_custo_entrega==="taxa_fixa"&&a.taxa_fixa_entrega)o=Number(a.taxa_fixa_entrega);else if(a.modelo_custo_entrega==="por_km"&&a.valor_por_km_entrega)o=0;else if(a.modelo_custo_entrega==="rateio_rh"&&a.controla_rh)try{o=(await P.get(`/entregadores/${a.id}/custo-operacional`)).data.custo_por_entrega||0}catch(i){console.error("Erro ao buscar custo RH:",i),o=a.custo_rh_ajustado||0}else try{o=(await P.get("/configuracoes/entregas")).data.taxa_fixa||0}catch(i){console.error("Erro ao buscar configura√ß√£o de entrega:",i),o=10}Me(o)};r.useEffect(()=>{s.tem_entrega&&Y?ma(Y):Me(0)},[Y,s.tem_entrega]);const Xa=async()=>{if(!s.cliente){xe(0);return}try{const o=(await P.get(`/pendencias-estoque/cliente/${s.cliente.id}`)).data.filter(i=>i.status==="pendente"||i.status==="notificado");xe(o.length)}catch{xe(0)}},Js=async a=>{if(!a||!s.cliente){xa([]);return}try{const i=(await P.get(`/internal/pdv/oportunidades/${a}`)).data;i&&Array.isArray(i.oportunidades)?xa(i.oportunidades):xa([])}catch{xa([])}},$a=async(a,o)=>{try{const i={opportunity_id:o.id,event_type:a,user_id:c==null?void 0:c.id,contexto:"PDV",extra_data:{produto_origem_id:o.produto_origem_id||null,produto_sugerido_id:o.produto_sugerido_id||null,tipo_oportunidade:o.tipo||null,venda_id:s.id||null}};P.post("/internal/pdv/eventos-oportunidade",i).catch(()=>{})}catch{}};async function Gs(a){try{const o={produto_id:a.produto_id,preco_unitario:a.preco_unitario,quantidade:a.quantidade},{data:i}=await P.post("/pdv/fiscal/calcular",o);return i}catch(o){return console.error("Erro ao calcular fiscal:",o),null}}r.useEffect(()=>{async function a(){let o=0;const i={};for(const d of s.itens){const p=await Gs(d);p&&(i[d.produto_id]=p,o+=Number(p.total_impostos))}Ka(i),Ua(o.toFixed(2))}s.itens&&s.itens.length>0?a():(Ka({}),Ua(0))},[s.itens]),r.useEffect(()=>{oa()},[ne,y,ge,ke]),r.useEffect(()=>{const a=N.get("venda");a&&va(parseInt(a))},[N]),r.useEffect(()=>{const a=sessionStorage.getItem("abrirVenda"),o=sessionStorage.getItem("abrirModalPagamento");a&&o==="true"&&(sessionStorage.removeItem("abrirVenda"),sessionStorage.removeItem("abrirModalPagamento"),va(parseInt(a),!0))},[]);const Xs=()=>{Ne({tipo:"entrega",apelido:"",cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",estado:""}),Ee(!0)},Ea=()=>{Ee(!1),Ne(null)},Ws=async a=>{if(!(!a||a.length!==9)){Te(!0);try{const i=await(await fetch(`https://viacep.com.br/ws/${a.replace("-","")}/json/`)).json();if(i.erro){alert("CEP n√£o encontrado");return}Ne(d=>({...d,endereco:i.logradouro||"",bairro:i.bairro||"",cidade:i.localidade||"",estado:i.uf||""}))}catch(o){console.error("Erro ao buscar CEP:",o),alert("Erro ao buscar CEP")}finally{Te(!1)}}},Zs=async()=>{if(!ee.cep||!ee.endereco||!ee.cidade){alert("Preencha pelo menos CEP, Endere√ßo e Cidade");return}if(!s.cliente||!s.cliente.id){alert("Selecione um cliente primeiro");return}try{const a=await ga(s.cliente.id),o=a.enderecos_adicionais||[];o.push({...ee}),await P.put(`/clientes/${s.cliente.id}`,{...a,enderecos_adicionais:o});const i=await ga(s.cliente.id);g({...s,cliente:i}),alert("Endere√ßo adicionado com sucesso!"),Ea()}catch(a){console.error("Erro ao salvar endere√ßo:",a),alert("Erro ao salvar endere√ßo. Tente novamente.")}},Ys=a=>{Re({...a,preco:a.preco_unitario,descontoValor:a.desconto_valor||0,descontoPercentual:a.desconto_percentual||0,tipoDesconto:"valor"}),He(!0)},et=()=>{const a=s.itens.map(o=>{if(o.produto_id===O.produto_id){const i=O.preco,d=o.quantidade,p=i*d;let A=0,B=0;O.tipoDesconto==="valor"?(A=parseFloat(O.descontoValor)||0,B=p>0?A/p*100:0):(B=parseFloat(O.descontoPercentual)||0,A=p*B/100);const ae=i-A/d,Z=p-A;return{...o,desconto_valor:A,desconto_percentual:B,tipo_desconto_aplicado:O.tipoDesconto,preco_com_desconto:ae,subtotal:Z}}return o});Xe(a),He(!1),Re(null)},at=()=>{s.desconto_valor>0?(sa("valor"),ta(s.desconto_valor)):(sa("valor"),ta(0)),aa(!0)},st=(a,o)=>{const i=s.itens;if(i.length===0)return;const d=i.map(Z=>(Z.preco_unitario||Z.preco_venda)*Z.quantidade),p=d.reduce((Z,G)=>Z+G,0);let A=0;if(a==="valor")A=Math.min(parseFloat(o)||0,p);else{const Z=Math.min(parseFloat(o)||0,100);A=p*Z/100}let B=0;const ae=i.map((Z,G)=>{const pe=d[G];let ve;if(G===i.length-1)ve=parseFloat((A-B).toFixed(2));else{const ya=p>0?pe/p:0;ve=parseFloat((A*ya).toFixed(2)),B+=ve}const Ie=pe>0?ve/pe*100:0,qe=pe-ve,na=Z.quantidade>0?qe/Z.quantidade:0;return{...Z,desconto_valor:ve,desconto_percentual:Ie,tipo_desconto_aplicado:a,preco_com_desconto:na,subtotal:qe}});Xe(ae),aa(!1)},tt=()=>{const a=s.itens.map(o=>{const i=(o.preco_unitario||o.preco_venda)*o.quantidade;return{...o,desconto_valor:0,desconto_percentual:0,tipo_desconto_aplicado:null,preco_com_desconto:o.preco_unitario||o.preco_venda,subtotal:i}});Xe(a)},oa=async()=>{try{const a=new Date;let o;ne==="24h"?o=new Date(a.getTime()-24*60*60*1e3):ne==="7d"?o=new Date(a.getTime()-7*24*60*60*1e3):o=new Date(a.getTime()-30*24*60*60*1e3);const i={data_inicio:o.toISOString().split("T")[0],data_fim:a.toISOString().split("T")[0],per_page:50};ke.trim()?(i.busca=ke.trim(),delete i.data_inicio,delete i.data_fim):(y==="pago"?i.status="finalizada":y==="aberta"&&(i.status="aberta"),ge===!0&&(i.tem_entrega=!0)),console.log("üìä Par√¢metros de busca de vendas:",i);const d=await $s(i);z(d.vendas||[])}catch(a){console.error("Erro ao carregar vendas:",a)}},rt=async(a,o)=>{a.stopPropagation();try{await fetch(`/api/vendas/${o}/marcar-entregue`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),oa()}catch(i){console.error("Erro ao marcar entregue:",i)}},va=async(a,o=!1)=>{var i;try{k(!0);const d=await wa(a);if(!d){alert("Venda n√£o encontrada");return}let p=null;if(d.cliente_id)try{p=await ga(d.cliente_id)}catch(G){console.error("Erro ao buscar cliente:",G)}let A=[],B=0;try{const G=await P.get(`/vendas/${a}/pagamentos`);A=G.data.pagamentos||[],B=G.data.total_pago||0}catch(G){console.error("Erro ao buscar pagamentos:",G)}console.log("üîç Venda carregada - funcionario_id:",d.funcionario_id);let ae=null;if(d.funcionario_id)try{const pe=((i=(await P.get("/comissoes/configuracoes/funcionarios")).data)==null?void 0:i.data)||[];console.log("üìã Funcion√°rios dispon√≠veis:",pe),ae=pe.find(ve=>ve.id===d.funcionario_id),ae?(f(!0),L(ae),console.log("‚úÖ Funcion√°rio comiss√£o carregado:",ae)):console.warn("‚ö†Ô∏è Funcion√°rio ID",d.funcionario_id,"n√£o encontrado na lista")}catch(G){console.error("Erro ao carregar funcion√°rio de comiss√£o:",G)}else console.log("‚ÑπÔ∏è Venda sem funcionario_id - limpando estados de comiss√£o"),f(!1),L(null),De("");const Z={id:d.id,numero_venda:d.numero_venda,status:d.status,data_venda:d.data_venda,cliente:p,pet:null,itens:d.itens||[],subtotal:d.subtotal||0,desconto_valor:d.desconto_valor||0,desconto_percentual:d.desconto_percentual||0,total:d.total||0,observacoes:d.observacoes||"",funcionario_id:d.funcionario_id||null,entregador_id:d.entregador_id||null,tem_entrega:d.tem_entrega||!1,entrega:d.entrega||{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""},pagamentos:A,total_pago:B};if(g(Z),V(!0),d.entregador_id){console.log("üîç Venda tem entregador_id:",d.entregador_id);try{const pe=(await P.get(`/clientes/${d.entregador_id}`)).data;pe&&pe.is_entregador?(console.log("‚úÖ Entregador carregado:",pe.nome),Ve(pe),ma(pe)):console.warn("‚ö†Ô∏è Cliente ID",d.entregador_id,"n√£o √© um entregador v√°lido")}catch(G){console.error("‚ùå Erro ao carregar entregador:",G);const pe=$e.find(ve=>ve.id===d.entregador_id);pe&&(console.log("‚úÖ Entregador encontrado no array (fallback):",pe.nome),Ve(pe),ma(pe))}}else console.log("‚ÑπÔ∏è Venda sem entregador_id - limpando entregadorSelecionado"),Ve(null);o&&setTimeout(()=>{t(!0)},500)}catch(d){console.error("Erro ao carregar venda:",d),alert("Erro ao carregar venda: "+(d.message||"Erro desconhecido"))}finally{k(!1)}},Wa=async()=>{var a;if(te.trim())try{k(!0);const o=te.replace(/\D/g,"");if(!o){alert("Digite um n√∫mero de venda v√°lido"),k(!1);return}console.log("üîç Buscando venda com n√∫mero:",o);const i=await $s({busca:o,per_page:50});if(console.log("üìä Vendas encontradas:",(a=i.vendas)==null?void 0:a.length),!i.vendas||i.vendas.length===0){alert(`Nenhuma venda encontrada com "${o}"`),k(!1);return}if(i.vendas.length===1){await va(i.vendas[0].id),T("");return}const d=i.vendas.slice(0,10).map((B,ae)=>`${ae+1}. ${B.numero_venda} - ${B.cliente_nome||"Sem cliente"} - ${B.status}`).join(`
`),p=prompt(`Encontradas ${i.vendas.length} vendas. Digite o n√∫mero da op√ß√£o:

${d}`),A=parseInt(p)-1;A>=0&&A<i.vendas.length&&(await va(i.vendas[A].id),T(""))}catch(o){console.error("Erro ao buscar venda:",o),alert("Erro ao buscar venda: "+(o.message||"Erro desconhecido"))}finally{k(!1)}};r.useEffect(()=>{if(F.length>=2){const a=setTimeout(async()=>{try{const o=F.replace(/[()\-\s]/g,""),i=await ar({search:o});h(i||[])}catch(o){console.error("Erro ao buscar clientes:",o),h([])}},300);return()=>clearTimeout(a)}else h([])},[F]),r.useEffect(()=>{if(b.length>=2){const a=setTimeout(async()=>{try{const i=(await Gt({busca:b})).data.items||[];$(i)}catch(o){console.error("Erro ao buscar produtos:",o),$([])}},300);return()=>clearTimeout(a)}else $([])},[b]);const Za=async a=>{g({...s,cliente:a,pet:null}),m(""),h([]);try{const o=await P.get(`/clientes/${a.id}/vendas-em-aberto`);o.data.resumo.total_vendas>0?H(o.data.resumo):H(null)}catch(o){console.error("Erro ao verificar vendas em aberto:",o),H(null)}},ot=a=>{g({...s,pet:a})},nt=a=>{var d,p;if(!re){alert("‚ùå N√£o √© poss√≠vel adicionar produtos sem caixa aberto. Abra um caixa primeiro.");return}console.log("üõí Produto sendo adicionado:",{nome:a.nome,categoria_id:a.categoria_id,categoria_nome:a.categoria_nome,peso_embalagem:a.peso_embalagem,classificacao_racao:a.classificacao_racao});const o=s.itens.find(A=>A.produto_id===a.id);let i;o?i=s.itens.map(A=>A.produto_id===a.id?{...A,quantidade:A.quantidade+1,subtotal:(A.quantidade+1)*A.preco_unitario}:A):i=[...s.itens,{tipo:"produto",produto_id:a.id,produto_nome:a.nome,quantidade:1,preco_unitario:parseFloat(a.preco_venda),desconto_item:0,subtotal:parseFloat(a.preco_venda),pet_id:((d=s.pet)==null?void 0:d.id)||null,tipo_produto:a.tipo_produto,tipo_kit:a.tipo_kit,composicao_kit:a.composicao_kit||[],categoria_id:a.categoria_id,categoria_nome:a.categoria_nome,peso_pacote_kg:a.peso_liquido||a.peso_bruto,peso_embalagem:a.peso_embalagem,classificacao_racao:a.classificacao_racao}],Xe(i),w(""),$([]),(p=Ja.current)==null||p.focus()},Ya=(a,o)=>{const i=s.itens.map((d,p)=>{if(p===a){const A=Math.max(1,d.quantidade+o),B=A*d.preco_unitario;let ae=d.desconto_valor||0;d.tipo_desconto_aplicado==="percentual"&&d.desconto_percentual>0&&(ae=B*d.desconto_percentual/100);const Z=B-ae;return{...d,quantidade:A,desconto_valor:ae,subtotal:Z}}return d});Xe(i)},es=a=>{const o=s.itens.filter((i,d)=>d!==a);Xe(o)},lt=a=>{Os(o=>({...o,[a]:!o[a]}))},Xe=a=>{var ae;const o=a.reduce((Z,G)=>Z+G.subtotal,0),i=a.reduce((Z,G)=>Z+(G.desconto_valor||0),0),d=o+i,p=d>0?i/d*100:0,A=s.tem_entrega&&((ae=s.entrega)==null?void 0:ae.taxa_entrega_total)||0,B=o+A;g({...s,itens:a,subtotal:o,desconto_valor:i,desconto_percentual:p,total:B})},as=async()=>{var a,o,i,d,p,A,B,ae,Z,G,pe,ve,Ie,qe,na,ya,ms,us,gs,ps,bs,hs,fs,js;if(s.itens.length===0){alert("Adicione pelo menos um produto ou servi√ßo");return}if(!re){alert("‚ùå N√£o √© poss√≠vel salvar venda sem caixa aberto. Abra um caixa primeiro.");return}if(!x){k(!0);try{if(s.id){await P.put(`/vendas/${s.id}`,{cliente_id:(a=s.cliente)==null?void 0:a.id,funcionario_id:s.funcionario_id,itens:s.itens.map(Ce=>{var ua;return{tipo:Ce.tipo,produto_id:Ce.produto_id,servico_descricao:Ce.servico_descricao,quantidade:Ce.quantidade,preco_unitario:Ce.preco_unitario||Ce.preco_venda,desconto_item:0,subtotal:Ce.subtotal,lote_id:Ce.lote_id,pet_id:Ce.pet_id||((ua=s.pet)==null?void 0:ua.id)}}),desconto_valor:0,desconto_percentual:0,observacoes:s.observacoes,tem_entrega:s.tem_entrega,taxa_entrega:((o=s.entrega)==null?void 0:o.taxa_entrega_total)||0,endereco_entrega:(i=s.entrega)==null?void 0:i.endereco_completo,observacoes_entrega:(d=s.entrega)==null?void 0:d.observacoes_entrega,distancia_km:(p=s.entrega)==null?void 0:p.distancia_km,valor_por_km:(A=s.entrega)==null?void 0:A.valor_por_km,loja_origem:(B=s.entrega)==null?void 0:B.loja_origem,entregador_id:s.entregador_id}),console.log("üö® DEBUG - Payload sendo enviado:",{tem_entrega:s.tem_entrega,entregador_id:s.entregador_id,vendaAtual_completo:s});let _e=0;try{_e=(await P.get(`/vendas/${s.id}/pagamentos`)).data.total_pago||0}catch(Ce){console.error("Erro ao buscar pagamentos:",Ce)}const We=s.total;let Qe="aberta";_e>=We-.01?Qe="finalizada":_e>0&&(Qe="baixa_parcial"),s.status!==Qe&&(await P.patch(`/vendas/${s.id}/status`,{status:Qe}),console.log(`‚úÖ Status atualizado: ${s.status} ‚Üí ${Qe}`)),alert("Venda atualizada com sucesso!"),Ke()}else{console.log("üöÄ CRIANDO VENDA - Vers√£o 2.0 - DESCONTOS ZERADOS"),console.log("Desconto valor:",0),console.log("Desconto percentual:",0),console.log("‚úÖ Checkbox Venda Comissionada:",n),console.log("üíº Funcion√°rio Comiss√£o:",j),console.log("üìã Funcion√°rio ID enviado:",(j==null?void 0:j.id)||null),n&&!j&&console.error("‚ö†Ô∏è ERRO: Checkbox marcado mas funcion√°rio n√£o selecionado!");const _e=((ae=s.entrega)==null?void 0:ae.taxa_entrega_total)||0,We=((Z=s.entrega)==null?void 0:Z.taxa_loja)||0,Qe=((G=s.entrega)==null?void 0:G.taxa_entregador)||0,Ce=_e>0?We/_e*100:100,ua=_e>0?Qe/_e*100:0,vs={cliente_id:(pe=s.cliente)==null?void 0:pe.id,funcionario_id:s.funcionario_id,itens:s.itens.map(ze=>{var ys;return{tipo:ze.tipo,produto_id:ze.produto_id,servico_descricao:ze.servico_descricao,quantidade:ze.quantidade,preco_unitario:ze.preco_unitario||ze.preco_venda,desconto_item:0,subtotal:ze.subtotal,lote_id:ze.lote_id,pet_id:ze.pet_id||((ys=s.pet)==null?void 0:ys.id)}}),desconto_valor:0,desconto_percentual:0,observacoes:s.observacoes,tem_entrega:s.tem_entrega,taxa_entrega:((ve=s.entrega)==null?void 0:ve.taxa_entrega_total)||0,percentual_taxa_loja:Ce,percentual_taxa_entregador:ua,endereco_entrega:(Ie=s.entrega)==null?void 0:Ie.endereco_completo,observacoes_entrega:(qe=s.entrega)==null?void 0:qe.observacoes_entrega,distancia_km:(na=s.entrega)==null?void 0:na.distancia_km,valor_por_km:(ya=s.entrega)==null?void 0:ya.valor_por_km,loja_origem:(ms=s.entrega)==null?void 0:ms.loja_origem,entregador_id:s.entregador_id};console.log("üì¶ PAYLOAD COMPLETO antes de enviar:",JSON.stringify(vs,null,2)),console.log("üöö Dados de entrega:",{tem_entrega:s.tem_entrega,entregador_id:s.entregador_id,entregadorSelecionado:Y==null?void 0:Y.id,vendaAtual_completo:s}),console.log("üí∞ Percentuais calculados:",{taxaTotal:_e,taxaLoja:We,taxaEntregador:Qe,percentualLoja:`${Ce.toFixed(2)}%`,percentualEntregador:`${ua.toFixed(2)}%`}),await Vs(vs),alert("Venda salva com sucesso!"),Ke()}oa()}catch(_e){console.error("‚ùå Erro ao salvar venda:",_e),console.error("‚ùå Resposta do servidor:",(us=_e.response)==null?void 0:us.data),console.error("‚ùå Status:",(gs=_e.response)==null?void 0:gs.status),console.error("‚ùå Headers:",(ps=_e.response)==null?void 0:ps.headers);const We=((hs=(bs=_e.response)==null?void 0:bs.data)==null?void 0:hs.detail)||((js=(fs=_e.response)==null?void 0:fs.data)==null?void 0:js.message)||"Erro ao salvar venda";console.error("‚ùå Detalhes do erro:",We),alert(`Erro ao salvar venda: ${We}`)}finally{k(!1)}}},it=async a=>{var o;console.log("üîç DEBUG formasPagamento recebidas:",a),Oa(!0),ka(!0);try{console.log("üí∞ Enviando an√°lise com m√∫ltiplas formas:",a);const i=await P.post("/formas-pagamento/analisar-venda",{items:s.itens.map(d=>({produto_id:d.produto_id,quantidade:d.quantidade,preco_venda:d.preco_unitario||d.preco_venda,custo:d.custo})),desconto:s.desconto_valor||0,taxa_entrega:((o=s.entrega)==null?void 0:o.taxa_entrega_total)||0,formas_pagamento:a,vendedor_id:s.funcionario_id});console.log("‚úÖ Resposta da an√°lise:",i.data),Is(i.data)}catch(i){console.error("Erro ao buscar an√°lise:",i),alert("Erro ao carregar an√°lise da venda"),ka(!1)}finally{Oa(!1)}},ss=()=>{if(s.itens.length===0){alert("Adicione pelo menos um produto ou servi√ßo");return}if(s.status==="finalizada"||s.status==="pago_nf"){alert('Esta venda est√° finalizada. Clique em "Reabrir Venda" para modificar.');return}t(!0)},Ke=()=>{g({cliente:null,pet:null,itens:[],subtotal:0,desconto_valor:0,desconto_percentual:0,total:0,observacoes:"",funcionario_id:null,entregador_id:(Y==null?void 0:Y.id)||null,tem_entrega:!1,entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}}),f(!1),L(null),De(""),V(!1)},dt=async a=>{var o,i,d;try{const p=await wa(a.id);let A=null;p.cliente_id&&(A=await ga(p.cliente_id));let B=[],ae=0;try{const G=await P.get(`/vendas/${a.id}/pagamentos`);B=G.data.pagamentos||[],ae=G.data.total_pago||0}catch(G){console.error("Erro ao buscar pagamentos:",G)}if(console.log("üîç Venda carregada - funcionario_id:",p.funcionario_id),p.funcionario_id)try{const ve=(((o=(await P.get("/comissoes/configuracoes/funcionarios")).data)==null?void 0:o.data)||[]).find(Ie=>Ie.id===p.funcionario_id);ve?(f(!0),L(ve),console.log("‚úÖ Funcion√°rio comiss√£o carregado:",ve)):console.warn("‚ö†Ô∏è Funcion√°rio ID",p.funcionario_id,"n√£o encontrado na lista")}catch(G){console.error("Erro ao carregar funcion√°rio de comiss√£o:",G)}else console.log("‚ÑπÔ∏è Venda sem funcionario_id - limpando estados de comiss√£o"),f(!1),L(null),De("");const Z={id:p.id,numero_venda:p.numero_venda,data_venda:p.data_venda,cliente:A,pet:null,itens:p.itens||[],subtotal:parseFloat(p.subtotal||p.total),desconto_valor:parseFloat(p.desconto_valor||0),desconto_percentual:parseFloat(p.desconto_percentual||0),total:parseFloat(p.total),observacoes:p.observacoes||"",status:p.status,tem_entrega:p.tem_entrega||!1,entregador_id:p.entregador_id||null,entrega:{endereco_completo:p.endereco_entrega||"",endereco_id:p.endereco_id||null,taxa_entrega_total:parseFloat(parseFloat(p.taxa_entrega||0).toFixed(2)),taxa_loja:parseFloat(parseFloat(((i=p.entrega)==null?void 0:i.taxa_loja)||0).toFixed(2)),taxa_entregador:parseFloat(parseFloat(((d=p.entrega)==null?void 0:d.taxa_entregador)||0).toFixed(2)),observacoes_entrega:p.observacoes_entrega||"",distancia_km:p.distancia_km||0,valor_por_km:p.valor_por_km||0,loja_origem:p.loja_origem||"",status_entrega:p.status_entrega||"pendente"},pagamentos:B,total_pago:ae};g(Z),V(!0),window.scrollTo({top:0,behavior:"smooth"})}catch(p){console.error("Erro ao reabrir venda:",p),alert("Erro ao carregar os dados da venda")}},ct=()=>{V(!1)},xt=async()=>{if(!s.id){Ke();return}if(Se&&s.status!==Se)try{k(!0),await P.patch(`/vendas/${s.id}/status`,{status:Se}),console.log(`‚úÖ Status restaurado para: ${Se} (altera√ß√µes descartadas)`)}catch(a){console.error("Erro ao restaurar status:",a)}finally{k(!1)}be(null),Ke()},mt=async()=>{var o,i;if(!(!s.id||!window.confirm(`Deseja realmente excluir esta venda?

Esta a√ß√£o n√£o pode ser desfeita e o estoque ser√° devolvido.`)))try{k(!0),await P.delete(`/vendas/${s.id}`),Ke(),oa(),alert("Venda exclu√≠da com sucesso!")}catch(d){console.error("Erro ao excluir venda:",d);const p=(i=(o=d.response)==null?void 0:o.data)==null?void 0:i.detail;if(p&&typeof p=="object"){let A=`‚ùå ${p.erro||"Erro ao excluir venda"}

`;A+=`${p.mensagem||""}

`,p.solucao&&(A+=`üí° Solu√ß√£o:
${p.solucao}

`),p.passos&&Array.isArray(p.passos)&&(A+=`üìã Passos para resolver:
`,p.passos.forEach(B=>{A+=`${B}
`})),p.rota_id&&(A+=`
üöö Rota ID: ${p.rota_id}`,p.rota_status&&(A+=` (${p.rota_status})`)),alert(A)}else alert(typeof p=="string"?p:"Erro ao excluir venda. Verifique se n√£o h√° v√≠nculos pendentes.")}finally{k(!1)}},ut=async()=>{var o,i;if(!(!s.id||!window.confirm(`Deseja reabrir esta venda?

Os pagamentos ser√£o mantidos e o status mudar√° para "aberta".`))){be(s.status);try{k(!0),await P.post(`/vendas/${s.id}/reabrir`);const d=await wa(s.id);let p=null;d.cliente_id&&(p=await ga(d.cliente_id)),g({id:d.id,numero_venda:d.numero_venda,data_venda:d.data_venda,cliente:p,pet:null,itens:d.itens||[],subtotal:parseFloat(d.subtotal||d.total),desconto_valor:parseFloat(d.desconto_valor||0),desconto_percentual:parseFloat(d.desconto_percentual||0),total:parseFloat(d.total),observacoes:d.observacoes||"",status:"aberta",tem_entrega:d.tem_entrega||!1,entrega:{endereco_completo:d.endereco_entrega||"",endereco_id:d.endereco_id||null,taxa_entrega_total:parseFloat(parseFloat(d.taxa_entrega||0).toFixed(2)),taxa_loja:parseFloat(parseFloat(d.taxa_loja||0).toFixed(2)),taxa_entregador:parseFloat(parseFloat(d.taxa_entregador||0).toFixed(2)),observacoes_entrega:d.observacoes_entrega||"",distancia_km:d.distancia_km||0,valor_por_km:d.valor_por_km||0,loja_origem:d.loja_origem||"",status_entrega:d.status_entrega||"pendente"}}),V(!1),alert(`Venda reaberta com sucesso! Agora voc√™ pode edit√°-la.

ATEN√á√ÉO: Se voc√™ n√£o fizer altera√ß√µes e sair, a venda voltar√° ao status anterior.`)}catch(d){console.error("Erro ao reabrir venda:",d),alert(((i=(o=d.response)==null?void 0:o.data)==null?void 0:i.detail)||"Erro ao reabrir venda")}finally{k(!1)}}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"bg-white border-b px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ot,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Ponto de Venda"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Buscar venda (Ex: 0011)",value:te,onChange:a=>T(a.target.value),onKeyPress:a=>{a.key==="Enter"&&te.trim()&&Wa()},className:"pl-10 pr-4 py-2 w-64 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"}),e.jsx(_a,{className:"w-5 h-5 text-gray-400 absolute left-3 top-2.5"})]}),e.jsx("button",{onClick:Wa,disabled:!te.trim()||x,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Buscar"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[s.cliente&&e.jsxs("button",{onClick:()=>oe(!0),className:"flex items-center space-x-2 px-4 py-2 bg-white hover:bg-orange-50 border-2 border-orange-400 rounded-lg transition-colors relative",title:"Lista de espera - Produtos sem estoque",children:[e.jsx(Ts,{className:"w-5 h-5 text-orange-500"}),le>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center",children:le})]}),s.cliente&&e.jsxs("button",{onClick:()=>{Ba(!0),s.id&&Js(s.id)},className:"flex items-center space-x-2 px-4 py-2 bg-white hover:bg-yellow-50 border-2 border-yellow-400 rounded-lg transition-colors",title:"Ver oportunidades de venda",children:[e.jsx(Fs,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"}),ra.length>0&&e.jsx("span",{className:"font-semibold text-yellow-600",children:Math.min(ra.length,6)})]}),e.jsx(ur,{onAbrirCaixa:()=>se(!0)},fe),e.jsxs("button",{onClick:()=>l("/meus-caixas"),className:"flex items-center space-x-2 px-4 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-colors",title:"Ver hist√≥rico de caixas",children:[e.jsx(fa,{className:"w-5 h-5"}),e.jsx("span",{children:"Meus Caixas"})]}),!_&&s.id&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:xt,disabled:x,className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ue,{className:"w-5 h-5"}),e.jsx("span",{children:"Cancelar Edi√ß√£o"})]}),e.jsxs("button",{onClick:mt,disabled:x,className:"flex items-center space-x-2 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ca,{className:"w-5 h-5"}),e.jsx("span",{children:"Excluir"})]})]}),e.jsxs("button",{onClick:as,disabled:x||_||!re,className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:re?"Salvar venda atual":"üîí Caixa fechado - Abra o caixa para salvar vendas",children:[e.jsx(Ss,{className:"w-5 h-5"}),e.jsx("span",{children:"Salvar"}),!re&&e.jsx("span",{className:"text-xs",children:"üîí"})]}),e.jsxs("button",{onClick:ss,disabled:x||s.status==="finalizada"||s.status==="pago_nf"||!re,className:"flex items-center space-x-2 px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:re?"Registrar pagamento da venda":"üîí Caixa fechado - Abra o caixa para registrar recebimentos",children:[e.jsx(Ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"}),!re&&e.jsx("span",{className:"text-xs",children:"üîí"})]})]})]})}),!re&&!_&&e.jsx("div",{className:"bg-red-50 border-b border-red-200 px-6 py-3",children:e.jsx("div",{className:"flex items-center justify-center max-w-5xl mx-auto",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-800",children:[e.jsx(we,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold text-lg",children:"üîí CAIXA FECHADO"}),e.jsx("span",{className:"text-sm",children:"- √â necess√°rio abrir o caixa para registrar vendas e recebimentos"})]})})}),s.id&&s.numero_venda&&e.jsx("div",{className:"bg-blue-50 border-b border-blue-200 px-4 py-1.5",children:e.jsxs("div",{className:"flex items-center justify-between max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-blue-800",children:"Venda:"}),e.jsxs("div",{className:"flex items-center gap-1.5 bg-white px-2 py-0.5 rounded border border-blue-300",children:[e.jsxs("span",{className:"font-bold text-blue-700 text-sm",children:["#",s.numero_venda]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(s.numero_venda);const a=event.target.closest("button"),o=a.innerHTML;a.innerHTML="‚úì",a.classList.add("text-green-600"),setTimeout(()=>{a.innerHTML=o,a.classList.remove("text-green-600")},1500)},className:"text-blue-600 hover:text-blue-800 transition-colors text-xs",title:"Copiar n√∫mero da venda",children:"üìã"})]})]}),s.data_venda&&e.jsx("span",{className:"text-xs text-blue-600",children:(()=>{const a=s.data_venda;if(typeof a=="string"&&a.includes("T")){const[o]=a.split("T"),[i,d,p]=o.split("-");return`${p}/${d}/${i}`}return new Date(a).toLocaleDateString("pt-BR")})()})]})}),_&&e.jsx("div",{className:"bg-yellow-50 border-b border-yellow-200 px-6 py-3",children:e.jsxs("div",{className:"flex items-center justify-between max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-800",children:[e.jsx(we,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Modo Visualiza√ß√£o - Venda ",s.status==="finalizada"?"Finalizada":s.status==="baixa_parcial"?"com Baixa Parcial":"Aberta"]}),e.jsx("span",{className:"text-sm",children:"(Clique em Editar para modificar)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gr,{venda:s}),e.jsxs("button",{onClick:()=>{V(!1),Ke()},className:"flex items-center gap-2 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(ue,{className:"w-4 h-4"}),"Voltar"]}),(s.status==="finalizada"||s.status==="baixa_parcial")&&e.jsxs("button",{onClick:ut,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(we,{className:"w-4 h-4"}),"Reabrir Venda"]}),s.status==="aberta"&&e.jsx("button",{onClick:ct,className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg font-medium transition-colors",children:"Editar"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"max-w-5xl mx-auto space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(ks,{className:"w-5 h-5 mr-2 text-blue-600"}),"Cliente"]}),s.cliente&&!_&&e.jsx("button",{onClick:()=>g({...s,cliente:null,pet:null}),className:"text-sm text-red-600 hover:text-red-700",children:"Remover"})]}),s.cliente?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-blue-900",children:s.cliente.nome}),e.jsxs("div",{className:"text-sm text-blue-700 mt-1",children:[s.cliente.cpf&&`CPF: ${s.cliente.cpf}`,s.cliente.telefone&&` ‚Ä¢ Tel: ${s.cliente.telefone}`]})]})}),s.cliente.credito>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fa,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Cr√©dito Dispon√≠vel:"})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",parseFloat(s.cliente.credito||0).toFixed(2).replace(".",",")]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"üí° Este cr√©dito pode ser usado como forma de pagamento"})]}),v&&v.total_vendas>0&&e.jsx("div",{className:"mt-3 pt-3 border-t border-blue-300",children:e.jsxs("div",{className:"flex items-center justify-between p-2 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lt,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-yellow-900",children:[v.total_vendas," venda(s) em aberto"]}),e.jsxs("div",{className:"text-xs text-yellow-700",children:["Total: R$ ",v.total_em_aberto.toFixed(2)]})]})]}),e.jsx("button",{onClick:()=>S(!0),className:"px-3 py-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs font-medium rounded transition-colors",children:"Ver Vendas"})]})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-300 flex gap-2",children:[e.jsxs("button",{onClick:()=>K(!0),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(Bt,{className:"w-4 h-4"}),"Hist√≥rico"]}),!_&&e.jsx("button",{onClick:()=>{g({...s,cliente:null,pet:null}),H(null)},className:"px-4 py-2 text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Trocar"})]})]}),s.cliente.pets&&s.cliente.pets.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pet (opcional)"}),e.jsxs("select",{value:((ts=s.pet)==null?void 0:ts.id)||"",onChange:a=>{const o=s.cliente.pets.find(i=>i.id===parseInt(a.target.value));ot(o||null)},disabled:_,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Sem pet espec√≠fico"}),s.cliente.pets.map(a=>e.jsxs("option",{value:a.id,children:[a.codigo," - ",a.nome," (",a.especie,a.raca&&` - ${a.raca}`,")"]},a.id))]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:F,onChange:a=>m(a.target.value),placeholder:"Digite nome, CPF ou telefone do cliente...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:_}),e.jsx(_a,{className:"w-5 h-5 text-gray-400 absolute right-3 top-1/2 -translate-y-1/2"})]}),e.jsxs("button",{onClick:()=>R(!0),disabled:_,className:"flex items-center space-x-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Na,{className:"w-5 h-5"}),e.jsx("span",{children:"Novo"})]})]}),U.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:U.map(a=>e.jsxs("button",{onClick:()=>Za(a),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.nome}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a.cpf&&`CPF: ${a.cpf}`,a.telefone&&` ‚Ä¢ ${a.telefone}`]}),a.pets&&a.pets.length>0&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:[a.pets.length," pet(s)"]})]},a.id))})]}),F.length>=2&&U.length===0&&e.jsx("div",{className:"text-sm text-gray-500 text-center py-2",children:"Nenhum cliente encontrado"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(ba,{className:"w-5 h-5 mr-2 text-blue-600"}),"Produtos e Servi√ßos"]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{ref:Ja,type:"text",value:b,onChange:a=>w(a.target.value),placeholder:"Digite o nome do produto, c√≥digo de barras ou servi√ßo...",disabled:_,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",autoFocus:!_}),e.jsx(_a,{className:"w-5 h-5 text-gray-400 absolute right-3"})]}),M.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:M.map(a=>e.jsx("button",{onClick:()=>nt(a),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b last:border-b-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.nome}),a.tipo_produto==="VARIACAO"&&Es(a)&&e.jsxs("div",{className:"text-xs text-blue-600 font-medium mt-0.5",children:["üîπ ",Es(a)]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a.codigo&&`C√≥d: ${a.codigo}`,a.tipo_produto==="KIT"&&a.tipo_kit==="VIRTUAL"?a.estoque_virtual!==void 0&&` ‚Ä¢ Estoque: ${a.estoque_virtual}`:a.estoque_atual!==void 0&&` ‚Ä¢ Estoque: ${a.estoque_atual}`]})]}),e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:["R$ ",parseFloat(a.preco_venda).toFixed(2)]})]})},a.id))})]}),s.itens.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(ba,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhum item adicionado"}),e.jsx("p",{className:"text-sm mt-1",children:"Busque e adicione produtos ou servi√ßos"})]}):e.jsx("div",{className:"space-y-3",children:s.itens.map((a,o)=>{var A;const i=a.tipo_produto==="KIT",d=zs[o],p=i&&a.composicao_kit&&a.composicao_kit.length>0;return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200 hover:border-blue-400 space-y-3 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>!_&&Ys(a),children:[e.jsxs("div",{className:"flex-1 flex items-start gap-2",children:[p&&e.jsx("button",{onClick:B=>{B.stopPropagation(),lt(o)},className:"mt-1 text-gray-500 hover:text-blue-600 transition-colors",children:d?e.jsx(Va,{className:"w-5 h-5"}):e.jsx(Aa,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.produto_nome}),i&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-700",children:[e.jsx(Ds,{className:"w-3 h-3"}),"KIT"]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a.quantidade," Unidade",a.quantidade!==1?"s":""," x R$ ",a.preco_unitario.toFixed(2),a.desconto_valor>0&&e.jsxs("span",{className:"text-orange-600 ml-1",children:["com R$ ",a.desconto_valor.toFixed(2)," de desconto"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",onClick:B=>B.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center space-x-2 bg-white border border-gray-300 rounded-lg",children:[e.jsx("button",{onClick:()=>Ya(o,-1),disabled:_,className:"p-2 hover:bg-gray-100 rounded-l-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Kt,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:a.quantidade,onChange:B=>{const ae=parseFloat(B.target.value)||0,Z=s.itens.map((G,pe)=>{if(pe===o){const ve=Math.max(.001,ae),Ie=ve*G.preco_unitario;let qe=G.desconto_valor||0;G.tipo_desconto_aplicado==="percentual"&&G.desconto_percentual>0&&(qe=Ie*G.desconto_percentual/100);const na=Ie-qe;return{...G,quantidade:ve,desconto_valor:qe,subtotal:na}}return G});Xe(Z)},disabled:_,step:"0.001",min:"0.001",className:"w-20 px-2 py-1 text-center font-medium border-none focus:ring-0 disabled:bg-gray-50"}),e.jsx("button",{onClick:()=>Ya(o,1),disabled:_,className:"p-2 hover:bg-gray-100 rounded-r-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Na,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900 w-24 text-right",children:["R$ ",a.subtotal.toFixed(2)]}),e.jsx("button",{onClick:()=>es(o),disabled:_,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Ca,{className:"w-5 h-5"})})]})]}),p&&d&&e.jsxs("div",{className:"ml-7 mt-3 p-3 bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-600 uppercase mb-2",children:"Composi√ß√£o do KIT"}),e.jsx("div",{className:"space-y-1.5",children:a.composicao_kit.map((B,ae)=>e.jsxs("div",{className:"flex items-center justify-between text-sm py-1.5 px-2 rounded hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ba,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:B.produto_nome})]}),e.jsxs("span",{className:"text-gray-500 font-medium",children:[B.quantidade,"x"]})]},ae))}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 italic",children:"Componentes apenas informativos (n√£o edit√°veis)"})]}),((A=s.cliente)==null?void 0:A.pets)&&s.cliente.pets.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",onClick:B=>B.stopPropagation(),children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 w-16",children:"Pet:"}),e.jsxs("select",{value:a.pet_id||"",onChange:B=>{const ae=s.itens.map((Z,G)=>G===o?{...Z,pet_id:B.target.value?parseInt(B.target.value):null}:Z);g({...s,itens:ae})},disabled:_,className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"N√£o especificado"}),s.cliente.pets.map(B=>e.jsxs("option",{value:B.id,children:[B.codigo," - ",B.nome]},B.id))]})]})]},o)})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Observa√ß√µes"}),e.jsx("textarea",{value:s.observacoes||"",onChange:a=>g({...s,observacoes:a.target.value}),placeholder:"Observa√ß√µes da venda (opcional)...",disabled:_,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:3})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Entrega"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.tem_entrega,onChange:a=>{var p;const o=a.target.checked,i=o&&((p=s.entrega)==null?void 0:p.taxa_entrega_total)||0,d=s.subtotal+i;g({...s,tem_entrega:o,total:d,entrega:o?s.entrega:{endereco_completo:"",taxa_entrega_total:0,taxa_loja:0,taxa_entregador:0,observacoes_entrega:""}})},disabled:_,className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Tem entrega?"})]})]}),s.tem_entrega&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Endere√ßo Completo *"}),s.cliente&&e.jsxs("div",{className:"mb-2 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Endere√ßos cadastrados:"}),e.jsxs("button",{type:"button",onClick:a=>{a.preventDefault(),a.stopPropagation(),Xs()},disabled:_,className:"flex items-center gap-1 px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Na,{size:14}),"Adicionar Endere√ßo"]})]}),e.jsxs("div",{className:"space-y-2",children:[(s.cliente.endereco||s.cliente.cidade)&&e.jsxs("button",{type:"button",onClick:a=>{a.preventDefault(),a.stopPropagation();const o=`${s.cliente.endereco}${s.cliente.numero?", "+s.cliente.numero:""}${s.cliente.complemento?" - "+s.cliente.complemento:""}, ${s.cliente.bairro}, ${s.cliente.cidade}/${s.cliente.estado}`;g({...s,entrega:{...s.entrega,endereco_completo:o}})},disabled:_,className:"w-full text-left px-3 py-2 bg-white hover:bg-blue-100 border border-blue-300 rounded text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"font-medium text-blue-700",children:"üè† Cadastro Principal:"})," ",e.jsxs("span",{className:"text-gray-700",children:[s.cliente.endereco,", ",s.cliente.numero," - ",s.cliente.bairro]})]}),s.cliente.enderecos_adicionais&&s.cliente.enderecos_adicionais.map((a,o)=>e.jsxs("button",{type:"button",onClick:i=>{i.preventDefault(),i.stopPropagation();const d=`${a.endereco}, ${a.numero}${a.complemento?" - "+a.complemento:""}, ${a.bairro}, ${a.cidade}/${a.estado}`;g({...s,entrega:{...s.entrega,endereco_completo:d}})},disabled:_,className:"w-full text-left px-3 py-2 bg-white hover:bg-blue-100 border border-blue-300 rounded text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsxs("span",{className:`inline-block px-2 py-0.5 text-xs font-medium rounded mr-2 ${a.tipo==="entrega"?"bg-blue-100 text-blue-800":a.tipo==="cobranca"?"bg-green-100 text-green-800":a.tipo==="comercial"?"bg-purple-100 text-purple-800":a.tipo==="residencial"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:[a.tipo==="entrega"?"üì¶":a.tipo==="cobranca"?"üí∞":a.tipo==="comercial"?"üè¢":a.tipo==="residencial"?"üè†":"üìç"," ",a.apelido||a.tipo]}),e.jsxs("span",{className:"text-gray-700",children:[a.endereco,", ",a.numero," - ",a.bairro]})]},o)),!s.cliente.endereco&&(!s.cliente.enderecos_adicionais||s.cliente.enderecos_adicionais.length===0)&&e.jsx("p",{className:"text-sm text-gray-600 italic",children:'Nenhum endere√ßo cadastrado. Clique em "+ Adicionar Endere√ßo"'})]})]}),e.jsx("textarea",{value:((rs=s.entrega)==null?void 0:rs.endereco_completo)??"",onChange:a=>g({...s,entrega:{...s.entrega,endereco_completo:a.target.value}}),placeholder:"Rua, n√∫mero, complemento, bairro, cidade...",disabled:_,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Entregador"}),e.jsxs("select",{value:(Y==null?void 0:Y.id)||"",onChange:a=>{const o=$e.find(i=>i.id===parseInt(a.target.value));Ve(o),g({...s,entregador_id:(o==null?void 0:o.id)||null}),o&&ma(o)},disabled:_,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Selecione um entregador"}),$e.map(a=>e.jsxs("option",{value:a.id,children:[a.nome_fantasia||a.nome,a.entregador_padrao&&" (Padr√£o)"]},a.id))]}),Y&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Modelo: ",Y.modelo_custo_entrega==="taxa_fixa"?"üíµ Taxa Fixa":Y.modelo_custo_entrega==="por_km"?"üöó Por KM":Y.modelo_custo_entrega==="rateio_rh"?"üëî Rateio RH":"‚öôÔ∏è Configura√ß√£o Global"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa de Entrega Total"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((os=s.entrega)==null?void 0:os.taxa_entrega_total)??0,onChange:a=>{var Z;const o=parseFloat(a.target.value)||0,i=parseFloat(o.toFixed(2)),d=((Z=s.entrega)==null?void 0:Z.taxa_loja)||0,p=parseFloat((o-d).toFixed(2)),A={...s,entrega:{...s.entrega,taxa_entrega_total:i,taxa_loja:parseFloat(d.toFixed(2)),taxa_entregador:p}},B=A.tem_entrega?i:0,ae=parseFloat((A.subtotal+B).toFixed(2));g({...A,total:ae})},disabled:_,className:"w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa Loja"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:((ns=s.entrega)==null?void 0:ns.taxa_entrega_total)??0,value:parseFloat((((ls=s.entrega)==null?void 0:ls.taxa_loja)??0).toFixed(2)),onChange:a=>{var A;const o=parseFloat(a.target.value)||0,i=((A=s.entrega)==null?void 0:A.taxa_entrega_total)||0,d=parseFloat(o.toFixed(2)),p=parseFloat((i-o).toFixed(2));g({...s,entrega:{...s.entrega,taxa_loja:d,taxa_entregador:p}})},disabled:_,className:"w-full pl-12 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxa Entregador"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:((is=s.entrega)==null?void 0:is.taxa_entrega_total)??0,value:parseFloat((((ds=s.entrega)==null?void 0:ds.taxa_entregador)??0).toFixed(2)),onChange:a=>{var A;const o=parseFloat(a.target.value)||0,i=((A=s.entrega)==null?void 0:A.taxa_entrega_total)||0,d=parseFloat(o.toFixed(2)),p=parseFloat((i-o).toFixed(2));g({...s,entrega:{...s.entrega,taxa_entregador:d,taxa_loja:p}})},disabled:_,className:"w-full pl-12 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Preencha a taxa total e depois divida entre loja e entregador. Ao alterar uma, a outra √© calculada automaticamente."}),Y&&ca>0&&e.jsxs("div",{className:"mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-amber-600",children:"üíº"}),e.jsx("span",{className:"text-sm font-medium text-amber-900",children:"Custo Operacional"})]}),e.jsxs("span",{className:"text-sm font-semibold text-amber-700",children:["R$ ",ca.toFixed(2)]})]}),e.jsxs("p",{className:"text-xs text-amber-600 mt-1 italic",children:[Y.nome_fantasia||Y.nome," -",Y.modelo_custo_entrega==="taxa_fixa"&&" Taxa Fixa",Y.modelo_custo_entrega==="por_km"&&" Valor por KM",Y.modelo_custo_entrega==="rateio_rh"&&" Rateio de RH"," ","(n√£o aparece no cupom)"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√µes da Entrega"}),e.jsx("textarea",{value:((cs=s.entrega)==null?void 0:cs.observacoes_entrega)??"",onChange:a=>g({...s,entrega:{...s.entrega,observacoes_entrega:a.target.value}}),placeholder:"Hor√°rio preferencial, ponto de refer√™ncia...",disabled:_,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",rows:2})]})]})]}),s.itens.length>0&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total bruto:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",(s.subtotal+s.desconto_valor).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:s.desconto_valor>0?"text-orange-600 text-sm":"text-gray-500 text-sm",children:s.desconto_valor>0?`${(s.desconto_valor/(s.subtotal+s.desconto_valor)*100).toFixed(2)}% de desconto:`:"Desconto:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.desconto_valor>0&&e.jsxs("span",{className:"font-medium text-orange-600 text-sm",children:["- R$ ",s.desconto_valor.toFixed(2)]}),e.jsxs("button",{onClick:at,disabled:_,className:"flex items-center gap-1 px-2 py-1 text-xs text-blue-600 hover:bg-blue-50 rounded border border-blue-200 disabled:opacity-50 transition-colors",title:"Aplicar desconto no total da venda",children:[e.jsx(Qt,{className:"w-3 h-3"}),e.jsx("span",{children:s.desconto_valor>0?"Editar":"Adicionar"})]}),s.desconto_valor>0&&e.jsx("button",{onClick:tt,disabled:_,className:"p-1 text-red-400 hover:bg-red-50 rounded disabled:opacity-50 transition-colors",title:"Remover desconto",children:e.jsx(ue,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",s.subtotal.toFixed(2)]})]}),s.tem_entrega&&e.jsxs("div",{className:"flex justify-between text-blue-600",children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsxs("span",{className:"font-medium",children:["+ R$ ",(((xs=s.entrega)==null?void 0:xs.taxa_entrega_total)||0).toFixed(2)]})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold text-gray-900",children:[e.jsx("span",{children:"Total da Venda:"}),e.jsxs("span",{children:["R$ ",s.total.toFixed(2)]})]})}),Qa>0&&e.jsxs("div",{className:"flex justify-between text-sm text-blue-600 bg-blue-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium",children:"Total de Impostos:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",Qa]})]}),s.total_pago>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-green-600 border-t pt-3",children:[e.jsx("span",{className:"font-medium",children:"(-) Valor Pago:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",s.total_pago.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-2xl font-bold border-t-2 pt-3",children:[e.jsx("span",{className:s.total-s.total_pago>0?"text-orange-600":"text-green-600",children:s.total-s.total_pago>0?"Saldo Restante:":"Totalmente Pago:"}),e.jsxs("span",{className:s.total-s.total_pago>0?"text-orange-600":"text-green-600",children:["R$ ",Math.max(0,s.total-s.total_pago).toFixed(2)]})]})]}),!s.total_pago&&e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"flex justify-between text-2xl font-bold text-gray-900",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["R$ ",s.total.toFixed(2)]})]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Comiss√£o"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:a=>{f(a.target.checked),a.target.checked||L(null)},disabled:_,className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Venda comissionada?"})]})]}),n&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Funcion√°rio/Veterin√°rio * ",e.jsx("span",{className:"text-xs text-gray-500",children:"(apenas com comiss√£o configurada)"})]}),j?e.jsxs("div",{className:"p-4 bg-green-50 border-2 border-green-300 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white font-bold",children:j.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-green-900",children:j.nome}),e.jsx("div",{className:"text-sm text-green-700 capitalize",children:j.cargo})]})]}),e.jsx("button",{onClick:()=>{L(null),De("")},disabled:_,className:"p-2 text-green-600 hover:bg-green-100 rounded-lg transition-colors disabled:cursor-not-allowed",title:"Remover sele√ß√£o",children:e.jsx(ue,{size:20})})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:ce,placeholder:"Buscar funcion√°rio ou veterin√°rio...",disabled:_,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed",onFocus:async()=>{if(!_)try{const a=await P.get("/comissoes/configuracoes/funcionarios");W(a.data.data||[])}catch(a){console.error("Erro ao buscar funcion√°rios:",a)}},onChange:async a=>{const o=a.target.value;De(o);try{const d=(await P.get("/comissoes/configuracoes/funcionarios")).data.data||[],p=o?d.filter(A=>A.nome.toLowerCase().includes(o.toLowerCase())):d;W(p)}catch(i){console.error("Erro ao buscar funcion√°rios:",i)}}}),de.length>0&&e.jsx("div",{className:"mt-2 border border-gray-200 rounded-lg max-h-48 overflow-y-auto",children:de.map(a=>e.jsxs("button",{onClick:()=>{L(a),W([]),De("")},className:"w-full px-4 py-2 text-left hover:bg-gray-50 border-b last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:a.nome}),e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:a.cargo})]},a.id))})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"‚ÑπÔ∏è A comiss√£o ser√° calculada automaticamente conforme configurado no m√≥dulo de comiss√µes"})]})]})]}),s.itens.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[!re&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-700",children:[e.jsx(we,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:'üîí Caixa fechado - Use o bot√£o "Abrir Caixa" no topo da p√°gina para continuar'})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[s.itens.length>0&&!s.id&&e.jsxs("button",{onClick:()=>{window.confirm("Descartar venda atual sem salvar?")&&Ke()},disabled:x||_,className:"flex items-center space-x-2 px-4 py-3 bg-red-50 hover:bg-red-100 text-red-600 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed border border-red-200",title:"Descartar venda atual e come√ßar uma nova",children:[e.jsx(ue,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Nova Venda"})]}),e.jsxs("button",{onClick:as,disabled:x||_||!re,className:"flex items-center space-x-2 px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:re?"Salvar venda atual":"üîí Caixa fechado - Abra o caixa para salvar vendas",children:[e.jsx(Ss,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Salvar Venda"}),!re&&e.jsx("span",{className:"text-xs",children:"üîí"})]}),e.jsxs("button",{onClick:ss,disabled:x||s.status==="finalizada"||s.status==="pago_nf"||!re,className:"flex items-center space-x-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors shadow-md disabled:opacity-50 disabled:cursor-not-allowed",title:re?"Registrar pagamento da venda":"üîí Caixa fechado - Abra o caixa para registrar recebimentos",children:[e.jsx(Ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Registrar Recebimento"}),!re&&e.jsx("span",{className:"text-xs",children:"üîí"})]})]})]})]})]}),s.cliente&&Ge&&e.jsx("div",{className:"w-80 bg-gray-50 border-l flex flex-col overflow-hidden",children:e.jsx(hr,{clienteId:s.cliente.id})}),s.cliente&&e.jsx("button",{onClick:()=>Ls(!Ge),className:"fixed right-0 top-1/2 -translate-y-1/2 bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-l-lg shadow-lg transition-all z-10",style:{right:Ge?"320px":"0"},title:Ge?"Recolher informa√ß√µes do cliente":"Expandir informa√ß√µes do cliente",children:Ge?e.jsx(Aa,{className:"w-5 h-5"}):e.jsx(ks,{className:"w-5 h-5"})}),Be&&e.jsxs("div",{className:"w-52 bg-white border-l flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 flex items-center",children:[e.jsx(Ma,{className:"w-4 h-4 mr-2 text-blue-600"}),"Vendas Recentes"]}),e.jsx("button",{onClick:()=>La(!1),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Fechar painel",children:e.jsx(ue,{className:"w-4 h-4 text-gray-500"})})]}),e.jsx("div",{className:"flex space-x-1 mb-3",children:["24h","7d","30d"].map(a=>e.jsxs("button",{onClick:()=>ye(a),className:`flex-1 px-2 py-1.5 rounded-lg text-xs font-medium transition-colors ${ne===a?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[a==="24h"&&"√öltimas 24h",a==="7d"&&"7 dias",a==="30d"&&"30 dias"]},a))}),e.jsx("div",{className:"flex space-x-1 mb-2",children:[{id:"todas",label:"Todas"},{id:"pago",label:"Pago"},{id:"aberta",label:"Aberta"}].map(a=>e.jsx("button",{onClick:()=>X(a.id),className:`flex-1 px-2 py-1.5 rounded-lg text-xs font-medium transition-colors ${y===a.id?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:a.label},a.id))}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 hover:bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",checked:ge,onChange:a=>he(a.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Apenas com entrega"})]}),e.jsx("div",{className:"px-2 pb-2",children:e.jsx("input",{type:"text",value:ke,onChange:a=>Oe(a.target.value),placeholder:"Buscar por n√∫mero...",className:"w-full px-3 py-2 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:J.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(we,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-xs",children:"Nenhuma venda encontrada"})]}):J.map(a=>{const o={ecommerce:{cor:"border-l-purple-500",bg:"bg-purple-50",icon:"üõí",label:"Ecommerce"},aplicativo:{cor:"border-l-green-500",bg:"bg-green-50",icon:"üì±",label:"App"},loja_fisica:{cor:"border-l-blue-500",bg:"bg-blue-50",icon:"üè™",label:"PDV"}}[a.canal]||{cor:"border-l-gray-400",bg:"bg-gray-50",icon:"üè™",label:"PDV"};return e.jsxs("div",{onClick:()=>dt(a),className:`rounded-lg p-2.5 border border-gray-200 border-l-4 ${o.cor} hover:border-blue-300 cursor-pointer transition-colors ${o.bg}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-[10px] text-gray-500 flex items-center gap-0.5",children:[e.jsx("span",{children:o.icon}),e.jsx("span",{children:o.label}),a.tem_entrega&&e.jsx("span",{className:"ml-1",title:"Entrega",children:"üöö"})]}),a.palavra_chave_retirada&&e.jsxs("span",{className:"text-[10px] bg-orange-100 text-orange-700 font-semibold px-1.5 py-0.5 rounded-full border border-orange-200",title:"Senha de retirada",children:["üîë ",a.palavra_chave_retirada]})]}),e.jsxs("div",{className:"flex items-start justify-between mb-1.5",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:a.cliente_nome||"Cliente n√£o informado"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["#",a.numero_venda]})]}),e.jsxs("div",{className:"text-right ml-2 flex-shrink-0",children:[a.status==="baixa_parcial"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[10px] text-gray-500",children:"Pago"}),e.jsxs("div",{className:"text-xs font-semibold text-green-600",children:["R$ ",(a.valor_pago||0).toFixed(2)]}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-0.5",children:["de R$ ",(a.total||0).toFixed(2)]})]}):e.jsxs("div",{className:"text-sm font-semibold text-green-600",children:["R$ ",(a.total||0).toFixed(2)]}),e.jsxs("div",{className:`text-[10px] font-medium px-1.5 py-0.5 rounded-full mt-1 inline-block ${a.status==="pago_nf"?"bg-emerald-100 text-emerald-700":a.status==="finalizada"?"bg-green-100 text-green-700":a.status==="baixa_parcial"?"bg-blue-100 text-blue-700":a.status==="aberta"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[a.status==="pago_nf"&&"Pago NF",a.status==="finalizada"&&"Pago",a.status==="baixa_parcial"&&"Parcial",a.status==="aberta"&&"Aberta",a.status==="cancelada"&&"Cancelada"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[10px] text-gray-500",children:(()=>{const i=a.data_venda;if(typeof i=="string"&&i.includes("T")){const[d,p]=i.split("T"),A=p.split("-")[0].split("+")[0],[B,ae,Z]=d.split("-"),[G,pe]=A.split(":");return`${Z}/${ae} ${G}:${pe}`}return new Date(i).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})()}),a.tipo_retirada==="terceiro"&&a.status_entrega!=="entregue"&&e.jsx("button",{onClick:i=>rt(i,a.id),className:"text-[10px] bg-green-600 hover:bg-green-700 text-white font-semibold px-2 py-0.5 rounded transition-colors",children:"‚úÖ Entregue"}),a.status_entrega==="entregue"&&e.jsx("span",{className:"text-[10px] text-green-600 font-medium",children:"‚úÖ Retirado"})]})]},a.id)})})]}),Bs&&s.cliente&&e.jsx("div",{className:"fixed inset-0 z-40",children:e.jsxs("div",{className:"absolute top-0 right-0 w-80 h-full bg-gray-50 border-l border-gray-300 shadow-lg flex flex-col animate-in slide-in-from-right duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-300 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fs,{className:"w-4 h-4 text-gray-600"}),e.jsx("h2",{className:"text-sm font-medium text-gray-700",children:"Oportunidades"})]}),e.jsx("button",{onClick:()=>Ba(!1),className:"p-1 hover:bg-gray-100 rounded transition-colors",children:e.jsx(ue,{className:"w-4 h-4 text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:[ra.slice(0,5).map(a=>e.jsxs("div",{className:"p-3 bg-white border border-gray-200 rounded hover:bg-gray-50 transition-colors",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 mb-1",children:a.titulo}),e.jsx("p",{className:"text-xs text-gray-700 mb-2 leading-relaxed",children:a.descricao_curta}),e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs mt-2",children:[e.jsxs("button",{onClick:()=>{$a("oportunidade_convertida",a),console.log("Adicionar ao carrinho:",a.id)},className:"flex items-center gap-1 text-green-500 hover:text-green-600 transition-colors whitespace-nowrap font-medium",title:"Adicionar ao carrinho",children:[e.jsx(Na,{className:"w-3 h-3"}),e.jsx("span",{children:"Adicionar"})]}),e.jsx("button",{onClick:()=>{$a("oportunidade_refinada",a),console.log("Buscar alternativa:",a.id)},className:"text-orange-600 hover:text-orange-700 transition-colors whitespace-nowrap flex-1 text-center font-medium",title:"Ver alternativa",children:"Alternativa"}),e.jsxs("button",{onClick:()=>{$a("oportunidade_rejeitada",a),xa(o=>o.filter(i=>i.id!==a.id))},className:"flex items-center gap-1 text-red-500 hover:text-red-600 transition-colors whitespace-nowrap font-medium",title:"Ignorar sugest√£o",children:[e.jsx("span",{children:"Ignorar"}),e.jsx(ue,{className:"w-3 h-3"})]})]})]},a.id)),ra.length===0&&e.jsx("div",{className:"flex items-center justify-center py-8 text-gray-400",children:e.jsx("p",{className:"text-xs",children:"Nenhuma oportunidade dispon√≠vel"})})]}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-200 bg-white",children:e.jsx("p",{className:"text-[10px] text-gray-400 text-center",children:ra.length>0?`${Math.min(ra.length,6)} oportunidades`:""})})]})}),e.jsx("button",{onClick:()=>La(!Be),className:"fixed right-0 bottom-20 bg-blue-600 hover:bg-blue-700 text-white rounded-l-lg shadow-lg transition-all z-10 flex items-center gap-1",style:{right:Be?"208px":"0",padding:Be?"6px":"6px 8px"},title:Be?"Recolher vendas recentes":"Expandir vendas recentes",children:Be?e.jsx(Aa,{className:"w-4 h-4"}):e.jsxs(e.Fragment,{children:[e.jsx(Ut,{className:"w-4 h-4"}),e.jsx("span",{className:"text-[10px] font-medium whitespace-nowrap",children:"Vendas"})]})}),E&&e.jsx(or,{venda:s,onClose:()=>t(!1),onAnalisarVenda:u?it:null,onConfirmar:async()=>{if(t(!1),_&&s.id)try{const o=(await P.get(`/vendas/${s.id}`)).data;let i=[],d=0;try{const p=await P.get(`/vendas/${s.id}/pagamentos`);i=p.data.pagamentos||[],d=p.data.total_pago||0}catch(p){console.error("Erro ao buscar pagamentos:",p)}g({...o,pagamentos:i,total_pago:d}),console.log("‚úÖ Venda recarregada:",o)}catch(a){console.error("Erro ao recarregar venda:",a)}else Ke();oa(),me(a=>a+1)},onVendaAtualizada:async()=>{if(s.id){const a=await wa(s.id);let o=[],i=0;try{const d=await P.get(`/vendas/${s.id}/pagamentos`);o=d.data.pagamentos||[],i=d.data.total_pago||0}catch(d){console.error("Erro ao buscar pagamentos:",d)}g({...a,pagamentos:o,total_pago:i}),V(a.status==="finalizada"||a.status==="baixa_parcial"),oa()}}}),Q&&e.jsx(nr,{onClose:()=>se(!1),onSucesso:()=>{se(!1),me(a=>a+1),ie(!0)}}),Ha&&e.jsx(jr,{isOpen:Ha,itensCarrinho:s.itens,racaoIdFechada:Qs,onClose:()=>{const a=s.itens.filter(o=>{const i=(o.categoria_nome||"").toLowerCase();return i.includes("ra√ß√£o")||i.includes("racao")});a.length>0&&Us(a[a.length-1].produto_id),Ks(!1)}}),D&&s.cliente&&e.jsx(vr,{isOpen:D,onClose:()=>oe(!1),clienteId:s.cliente.id,onPendenciaAdicionada:()=>Xa()}),q&&e.jsx(yr,{onClose:()=>R(!1),onClienteCriado:a=>{Za(a),R(!1)}}),Pe&&ee&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between z-10",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Adicionar Novo Endere√ßo ao Cliente"}),e.jsx("button",{onClick:Ea,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ue,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Endere√ßo *"}),e.jsxs("select",{value:ee.tipo,onChange:a=>Ne({...ee,tipo:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"entrega",children:"üì¶ Entrega"}),e.jsx("option",{value:"cobranca",children:"üí∞ Cobran√ßa"}),e.jsx("option",{value:"comercial",children:"üè¢ Comercial"}),e.jsx("option",{value:"residencial",children:"üè† Residencial"}),e.jsx("option",{value:"trabalho",children:"üìç Trabalho"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apelido (opcional)"}),e.jsx("input",{type:"text",value:ee.apelido,onChange:a=>Ne({...ee,apelido:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Ex: Casa da m√£e, Escrit√≥rio, Loja"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:ee.cep,onChange:a=>{const o=a.target.value.replace(/\D/g,""),i=o.length>5?`${o.slice(0,5)}-${o.slice(5,8)}`:o;Ne({...ee,cep:i})},onBlur:a=>Ws(a.target.value),maxLength:"9",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"00000-000"}),Fe&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Endere√ßo *"}),e.jsx("input",{type:"text",value:ee.endereco,onChange:a=>Ne({...ee,endereco:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Rua, Avenida, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N√∫mero"}),e.jsx("input",{type:"text",value:ee.numero,onChange:a=>Ne({...ee,numero:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"123"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Complemento"}),e.jsx("input",{type:"text",value:ee.complemento,onChange:a=>Ne({...ee,complemento:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Apto, Bloco, Sala..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bairro"}),e.jsx("input",{type:"text",value:ee.bairro,onChange:a=>Ne({...ee,bairro:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"Centro, Jardim..."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cidade *"}),e.jsx("input",{type:"text",value:ee.cidade,onChange:a=>Ne({...ee,cidade:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"S√£o Paulo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsx("input",{type:"text",value:ee.estado,onChange:a=>Ne({...ee,estado:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",maxLength:"2",placeholder:"SP"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"* Campos obrigat√≥rios"})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:Ea,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:Zs,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Salvar Endere√ßo"})]})]})}),da&&O&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Alterar item da venda"}),e.jsx("button",{onClick:()=>He(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ue,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:O.produto_nome}),e.jsxs("p",{className:"text-sm text-gray-600",children:["C√≥digo: ",O.produto_codigo]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Pre√ßo ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:O.preco,onChange:a=>Re({...O,preco:parseFloat(a.target.value)||0}),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade"}),e.jsx("input",{type:"number",step:"0.001",value:O.quantidade,readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subtotal"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:"R$"}),e.jsx("input",{type:"text",value:(O.preco*O.quantidade).toFixed(2),readOnly:!0,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-100"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de desconto"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Re({...O,tipoDesconto:"valor",descontoPercentual:0}),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${O.tipoDesconto==="valor"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"R$"}),e.jsx("button",{onClick:()=>Re({...O,tipoDesconto:"percentual",descontoValor:0}),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${O.tipoDesconto==="percentual"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor do desconto"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:O.tipoDesconto==="valor"?"R$":"%"}),e.jsx("input",{type:"number",step:"0.01",value:O.tipoDesconto==="valor"?O.descontoValor:O.descontoPercentual,onChange:a=>{const o=parseFloat(a.target.value)||0;O.tipoDesconto==="valor"?Re({...O,descontoValor:o}):Re({...O,descontoPercentual:o})},className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Total bruto"}),e.jsxs("span",{className:"font-medium",children:["R$ ",(O.preco*O.quantidade).toFixed(2)]})]}),(O.descontoValor>0||O.descontoPercentual>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm text-red-600 mt-1",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{className:"font-medium",children:["- R$ ",O.tipoDesconto==="valor"?O.descontoValor.toFixed(2):(O.preco*O.quantidade*O.descontoPercentual/100).toFixed(2)]})]}),e.jsx("div",{className:"flex justify-between text-sm text-orange-600 mt-1",children:e.jsxs("span",{children:[O.tipoDesconto==="percentual"&&`${O.descontoPercentual.toFixed(2)}% de desconto`,O.tipoDesconto==="valor"&&`${(O.descontoValor/(O.preco*O.quantidade)*100).toFixed(2)}% de desconto`]})})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg mt-2 pt-2 border-t border-blue-200",children:[e.jsx("span",{children:"Total l√≠quido"}),e.jsxs("span",{className:"text-green-600",children:["R$ ",(O.preco*O.quantidade-(O.tipoDesconto==="valor"?O.descontoValor:O.preco*O.quantidade*O.descontoPercentual/100)).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-between gap-3",children:[e.jsx("button",{onClick:()=>He(!1),className:"flex-1 px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Fechar"}),e.jsx("button",{onClick:()=>{s.itens.map(a=>(a.produto_id===O.produto_id&&es(s.itens.indexOf(a)),a)).filter(Boolean),He(!1)},className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Remover"}),e.jsx("button",{onClick:et,className:"flex-1 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Salvar"})]})]})}),Sa&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md",children:[e.jsxs("div",{className:"border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"üí∞ Aplicar desconto"}),e.jsx("button",{onClick:()=>aa(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ue,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total bruto (sem desconto)"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["R$ ",s.itens.reduce((a,o)=>a+(o.preco_unitario||o.preco_venda)*o.quantidade,0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de desconto"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>sa("valor"),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${Je==="valor"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"R$"}),e.jsx("button",{onClick:()=>sa("percentual"),className:`flex-1 px-4 py-2 rounded-lg border-2 transition-colors ${Je==="percentual"?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:border-blue-400"}`,children:"%"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-3 text-gray-500",children:Je==="valor"?"R$":"%"}),e.jsx("input",{type:"number",step:"0.01",value:Le,onChange:a=>ta(parseFloat(a.target.value)||0),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),(()=>{const a=s.itens.reduce((i,d)=>i+(d.preco_unitario||d.preco_venda)*d.quantidade,0),o=Je==="valor"?Math.min(Le,a):a*Math.min(Le,100)/100;return e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-700",children:"Desconto"}),e.jsxs("span",{className:"text-red-600 font-medium",children:["- R$ ",o.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-baseline border-t border-blue-200 pt-2 mt-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Total l√≠quido"}),e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:["R$ ",Math.max(0,a-o).toFixed(2)]})]})]})})()]}),e.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>aa(!1),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Fechar"}),e.jsx("button",{onClick:()=>st(Je,Le),className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Aplicar"})]})]})}),C&&s.cliente&&e.jsx(pr,{clienteId:s.cliente.id,clienteNome:s.cliente.nome,onClose:()=>S(!1),onSucesso:()=>{P.get(`/clientes/${s.cliente.id}/vendas-em-aberto`).then(a=>{a.data.resumo.total_vendas>0?H(a.data.resumo):H(null)}).catch(()=>H(null))}}),I&&s.cliente&&e.jsx(br,{clienteId:s.cliente.id,clienteNome:s.cliente.nome,onClose:()=>K(!1)}),u&&e.jsx(fr,{mostrar:za,onFechar:()=>ka(!1),dados:Ms,carregando:qs})]})})}function yr({onClose:l,onClienteCriado:N}){const[c,u]=r.useState({nome:"",telefone:"",cpf:"",email:""}),[s,g]=r.useState(!1),[F,m]=r.useState(""),b=async w=>{if(w.preventDefault(),!c.nome||!c.telefone){m("Nome e telefone s√£o obrigat√≥rios");return}g(!0),m("");try{const U=await P.post("/clientes",{...c,tipo_cadastro:"cliente",tipo_pessoa:"PF"});N(U.data)}catch(U){console.error("Erro:",U),m("Erro ao cadastrar cliente")}finally{g(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Cadastro R√°pido"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ue,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-4",children:[F&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:F}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome *"}),e.jsx("input",{type:"text",value:c.nome,onChange:w=>u({...c,nome:w.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefone *"}),e.jsx("input",{type:"tel",value:c.telefone,onChange:w=>u({...c,telefone:w.target.value}),placeholder:"(00) 00000-0000",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CPF"}),e.jsx("input",{type:"text",value:c.cpf,onChange:w=>u({...c,cpf:w.target.value}),placeholder:"000.000.000-00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail"}),e.jsx("input",{type:"email",value:c.email,onChange:w=>u({...c,email:w.target.value}),placeholder:"cliente@email.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:l,disabled:s,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:s,className:"flex items-center space-x-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Cadastrando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ha,{className:"w-5 h-5"}),e.jsx("span",{children:"Cadastrar"})]})})]})]})]})})}export{kr as default};
